{"version":3,"sources":["webpack:///./node_modules/terriajs-cesium/Source/Assets/Textures/waterNormalsSmall.jpg","webpack:///./node_modules/terriajs-cesium/Source/Assets/Textures/moonSmall.jpg","webpack:///./node_modules/terriajs-cesium/Source/Assets/Textures/LensFlare/DirtMask.jpg","webpack:///./node_modules/terriajs-cesium/Source/Assets/Textures/LensFlare/StarBurst.jpg","webpack:///./node_modules/terriajs-cesium/Source/Assets/Textures/SkyBox/tycho2t3_80_mx.jpg","webpack:///./node_modules/terriajs-cesium/Source/Assets/Textures/SkyBox/tycho2t3_80_my.jpg","webpack:///./node_modules/terriajs-cesium/Source/Assets/Textures/SkyBox/tycho2t3_80_mz.jpg","webpack:///./node_modules/terriajs-cesium/Source/Assets/Textures/SkyBox/tycho2t3_80_px.jpg","webpack:///./node_modules/terriajs-cesium/Source/Assets/Textures/SkyBox/tycho2t3_80_py.jpg","webpack:///./node_modules/terriajs-cesium/Source/Assets/Textures/SkyBox/tycho2t3_80_pz.jpg","webpack:///./node_modules/terriajs/lib/Map/CesiumSelectionIndicator.js","webpack:///./node_modules/terriajs-cesium/Source/Core/CornerType.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/CompositeProperty.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/CompositePositionProperty.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/ReferenceProperty.js","webpack:///./node_modules/terriajs-cesium/Source/Core/BoxGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/PrimitiveCollection.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/ScaledPositionProperty.js","webpack:///./node_modules/terriajs-cesium/Source/Core/EllipsoidGeometry.js","webpack:///./node_modules/terriajs/lib/Models/Cesium.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/createWorldImagery.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/GlobeFS.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/GlobeVS.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/GroundAtmosphere.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/GlobeSurfaceShaderSet.js","webpack:///./node_modules/terriajs-cesium/Source/Core/Visibility.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/QuadtreeTileLoadState.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/TerrainState.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/GlobeSurfaceTile.js","webpack:///./node_modules/terriajs-cesium/Source/Core/TileEdge.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/TileSelectionResult.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/TerrainFillMesh.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/GlobeSurfaceTileProvider.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/ImageryLayerCollection.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/QuadtreeOccluders.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/QuadtreeTile.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/TileReplacementQueue.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/QuadtreePrimitive.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/Globe.js","webpack:///./node_modules/terriajs-cesium/Source/Core/IauOrientationParameters.js","webpack:///./node_modules/terriajs-cesium/Source/Core/Iau2000Orientation.js","webpack:///./node_modules/terriajs-cesium/Source/Core/IauOrientationAxes.js","webpack:///./node_modules/terriajs-cesium/Source/Core/Simon1994PlanetaryPositions.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/EllipsoidFS.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/EllipsoidVS.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/EllipsoidPrimitive.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/Moon.js","webpack:///./node_modules/terriajs-cesium/Source/Core/mergeSort.js","webpack:///./node_modules/terriajs-cesium/Source/Core/Occluder.js","webpack:///./node_modules/terriajs-cesium/Source/Renderer/ComputeEngine.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/ViewportQuadVS.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/CheckFloatTexturePrecisionFS.js","webpack:///./node_modules/terriajs-cesium/Source/Renderer/checkFloatTexturePrecision.js","webpack:///./node_modules/terriajs-cesium/Source/Renderer/PassState.js","webpack:///./node_modules/terriajs-cesium/Source/Renderer/ShaderCache.js","webpack:///./node_modules/terriajs-cesium/Source/Renderer/TextureCache.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/SunLight.js","webpack:///./node_modules/terriajs-cesium/Source/Renderer/UniformState.js","webpack:///./node_modules/terriajs-cesium/Source/Renderer/Context.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/BrdfLutGeneratorFS.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/BrdfLutGenerator.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/MapMode2D.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/Camera.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/Cesium3DTilePassState.js","webpack:///./node_modules/terriajs-cesium/Source/Core/FrustumGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/Core/FrustumOutlineGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/DebugCameraPrimitive.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/DepthPlane.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/DepthPlaneVS.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/DepthPlaneFS.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/DerivedCommand.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/DeviceOrientationCameraController.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/Fog.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/FrameState.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/PassThrough.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/PassThroughDepth.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/GlobeDepth.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/InvertClassification.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/JobScheduler.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/PerformanceDisplay.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/PickDepth.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/FrustumCommands.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/AdjustTranslucentFS.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/OIT.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/CompositeOITFS.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/PickDepthFramebuffer.js","webpack:///./node_modules/terriajs-cesium/Source/Renderer/RenderbufferFormat.js","webpack:///./node_modules/terriajs-cesium/Source/Renderer/Renderbuffer.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/PickFramebuffer.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/SceneFramebuffer.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/ShadowMapShader.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/ShadowMap.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/View.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/Picking.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/GaussianBlur1D.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/AutoExposure.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/PostProcessStageSampleMode.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/PostProcessStage.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/PostProcessStageComposite.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/PostProcessStageLibrary.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/DepthOfField.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/EdgeDetection.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/Silhouette.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/ContrastBias.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/BloomComposite.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/AmbientOcclusionGenerate.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/AmbientOcclusionModulate.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/AcesTonemappingStage.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/FilmicTonemapping.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/ReinhardTonemapping.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/ModifiedReinhardTonemapping.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/BlackAndWhite.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/Brightness.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/NightVision.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/DepthView.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/LensFlare.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/PostProcessStageTextureCache.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/Tonemapper.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/PostProcessStageCollection.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/SceneTransitioner.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/CameraEventType.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/CameraEventAggregator.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/ScreenSpaceCameraController.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/AdditiveBlend.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/PostProcessStages/BrightPass.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/SunPostProcess.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/Scene.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/SkyAtmosphereFS.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/SkyAtmosphereVS.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/SkyAtmosphere.js","webpack:///./node_modules/terriajs-cesium/Source/Renderer/loadCubeMap.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/SkyBox.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/SkyBoxFS.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/SkyBoxVS.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/Sun.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/SunTextureFS.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/SunVS.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/SunFS.js","webpack:///./node_modules/terriajs-cesium/Source/Widgets/CesiumWidget/CesiumWidget.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/OrderedGroundPrimitiveCollection.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/BillboardVisualizer.js","webpack:///./node_modules/terriajs-cesium/Source/Scene/MaterialAppearance.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/Appearances/BasicMaterialAppearanceVS.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/Appearances/BasicMaterialAppearanceFS.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/Appearances/TexturedMaterialAppearanceVS.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/Appearances/TexturedMaterialAppearanceFS.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/Appearances/AllMaterialAppearanceVS.js","webpack:///./node_modules/terriajs-cesium/Source/Shaders/Appearances/AllMaterialAppearanceFS.js","webpack:///./node_modules/terriajs-cesium/Source/Core/DistanceDisplayConditionGeometryInstanceAttribute.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/MaterialProperty.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/DynamicGeometryUpdater.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/GeometryUpdater.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/TerrainOffsetProperty.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/heightReferenceOnEntityPropertyChanged.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/BoxGeometryUpdater.js","webpack:///./node_modules/terriajs-cesium/Source/Core/PolylineVolumeGeometryLibrary.js","webpack:///./node_modules/terriajs-cesium/Source/Core/CorridorGeometryLibrary.js","webpack:///./node_modules/terriajs-cesium/Source/Core/CorridorGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/Core/CorridorOutlineGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/GroundGeometryUpdater.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/CorridorGeometryUpdater.js","webpack:///./node_modules/terriajs-cesium/Source/Core/CylinderGeometryLibrary.js","webpack:///./node_modules/terriajs-cesium/Source/Core/CylinderGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/Core/CylinderOutlineGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/CylinderGeometryUpdater.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/DynamicGeometryBatch.js","webpack:///./node_modules/terriajs-cesium/Source/Core/EllipseGeometryLibrary.js","webpack:///./node_modules/terriajs-cesium/Source/Core/EllipseGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/Core/EllipseOutlineGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/EllipseGeometryUpdater.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/EllipsoidGeometryUpdater.js","webpack:///./node_modules/terriajs-cesium/Source/Core/PlaneGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/Core/PlaneOutlineGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/PlaneGeometryUpdater.js","webpack:///./node_modules/terriajs-cesium/Source/Core/CoplanarPolygonGeometryLibrary.js","webpack:///./node_modules/terriajs-cesium/Source/Core/CoplanarPolygonGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/Core/CoplanarPolygonOutlineGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/Core/PolygonGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/Core/PolygonOutlineGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/PolygonGeometryUpdater.js","webpack:///./node_modules/terriajs-cesium/Source/Core/PolylineVolumeGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/Core/PolylineVolumeOutlineGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/PolylineVolumeGeometryUpdater.js","webpack:///./node_modules/terriajs-cesium/Source/Core/RectangleGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/RectangleGeometryUpdater.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/StaticGeometryColorBatch.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/StaticGeometryPerMaterialBatch.js","webpack:///./node_modules/terriajs-cesium/Source/ThirdParty/quickselect.js","webpack:///./node_modules/terriajs-cesium/Source/ThirdParty/rbush.js","webpack:///./node_modules/terriajs-cesium/Source/Core/RectangleCollisionChecker.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/StaticGroundGeometryColorBatch.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/StaticGroundGeometryPerMaterialBatch.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/StaticOutlineGeometryBatch.js","webpack:///./node_modules/terriajs-cesium/Source/Core/WallGeometryLibrary.js","webpack:///./node_modules/terriajs-cesium/Source/Core/WallGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/Core/WallOutlineGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/WallGeometryUpdater.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/GeometryVisualizer.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/LabelVisualizer.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/ModelVisualizer.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/Cesium3DTilesetVisualizer.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/PathVisualizer.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/PointVisualizer.js","webpack:///./node_modules/terriajs-cesium/Source/Core/PolylineGeometry.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/PolylineGeometryUpdater.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/StaticGroundPolylinePerMaterialBatch.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/PolylineVisualizer.js","webpack:///./node_modules/terriajs-cesium/Source/DataSources/DataSourceDisplay.js","webpack:///./node_modules/terriajs-cesium/Source/Core/ShowGeometryInstanceAttribute.js"],"names":["module","exports","obj","_i18next","__esModule","Cartesian2","defined","DeveloperError","EasingFunction","knockout","SceneTransforms","selectionIndicatorUrl","screenSpacePos","CesiumSelectionIndicator","cesium","t","this","_cesium","_screenPositionX","_screenPositionY","_tweens","scene","tweens","_container","viewer","container","position","undefined","showSelection","transform","opacity","track","isVisible","defineProperty","get","computeScreenSpacePosition","result","wgs84ToWindowCoordinates","el","document","createElement","className","appendChild","_selectionIndicatorElement","img","setAttribute","that","update","style","top","left","_subscriptions","push","getObservable","subscribe","prototype","destroy","parentNode","removeChild","forEach","subscription","dispose","screenPosition","containerWidth","clientWidth","containerHeight","clientHeight","indicatorSize","halfSize","x","Math","min","max","y","floor","animateAppear","_selectionIndicatorTween","_selectionIndicatorIsAppearing","cancelTween","add","startObject","scale","rotate","stopObject","duration","easingFunction","EXPONENTIAL_OUT","value","complete","cancel","animateDepart","Object","defineProperties","selectionIndicatorElement","_scene","ROUNDED","MITERED","BEVELED","CompositeProperty","_eventHelper","_definitionChanged","_intervals","changedEvent","addEventListener","_intervalsChanged","isConstant","isEmpty","definitionChanged","intervals","getValue","time","innerProperty","findDataForIntervalContainingDate","equals","other","property","eventHelper","callback","raiseEvent","items","removeAll","length","i","interval","data","indexOf","subscribeAll","CompositePositionProperty","referenceFrame","_referenceFrame","FIXED","_composite","_raiseDefinitionChanged","set","getValueInReferenceFrame","resolve","targetProperty","_targetProperty","targetEntity","_targetEntity","_targetCollection","getById","_targetId","ReferenceProperty","_onTargetEntityDefinitionChanged","targetPropertyNames","_targetPropertyNames","len","targetCollection","targetId","collectionChanged","_onCollectionChanged","target","resolvedProperty","fromString","referenceString","identifier","values","inIdentifier","isEscaped","token","c","charAt","getType","names","otherNames","name","oldValue","collection","added","removed","removeEventListener","diffScratch","BoxGeometry","options","EMPTY_OBJECT","minimum","maximum","vertexFormat","DEFAULT","_minimum","clone","_maximum","_vertexFormat","_offsetAttribute","offsetAttribute","_workerName","fromDimensions","dimensions","corner","multiplyByScalar","negate","fromAxisAlignedBoundingBox","boundingBox","packedLength","pack","array","startingIndex","unitBoxGeometry","scratchMin","scratchMax","scratchVertexFormat","scratchOptions","unpack","createGeometry","boxGeometry","indices","positions","attributes","st","normal","tangent","bitangent","Float64Array","z","componentDatatype","DOUBLE","componentsPerAttribute","normals","Float32Array","FLOAT","texCoords","tangents","bitangents","Uint16Array","diff","subtract","radius","magnitude","applyOffset","Uint8Array","offsetValue","NONE","UNSIGNED_BYTE","primitiveType","TRIANGLES","boundingSphere","ZERO","getUnitBox","POSITION_ONLY","PrimitiveCollection","_primitives","_guid","_zIndex","show","destroyPrimitives","getPrimitiveIndex","compositePrimitive","primitive","index","hasIndex","external","_external","_composites","splice","remove","contains","removeAndDestroy","primitives","raise","p","raiseToTop","lower","lowerToBottom","unshift","frameState","prePassesUpdate","updateForPass","passState","postPassesUpdate","isDestroyed","ScaledPositionProperty","_value","_removeSubscription","setValue","WGS84","scaleToGeodeticSurface","scratchPosition","scratchNormal","scratchTangent","scratchBitangent","scratchNormalST","defaultRadii","cos","sin","EllipsoidGeometry","radii","innerRadii","minimumClock","maximumClock","TWO_PI","minimumCone","maximumCone","PI","stackPartitions","round","slicePartitions","_radii","_innerRadii","_minimumClock","_maximumClock","_minimumCone","_maximumCone","_stackPartitions","_slicePartitions","unitEllipsoidGeometry","scratchRadii","scratchInnerRadii","ellipsoidGeometry","j","abs","phis","thetas","numPhis","numThetas","extraIndices","vertexMultiplier","hasInnerSurface","isTopOpen","isBotOpen","isClockOpen","vertexCount","isInner","Array","negateNormal","indexCount","numIndices","createTypedArray","sinPhi","cosPhi","sinTheta","cosTheta","topOffset","bottomOffset","outerOffset","innerOffset","vertexIndex","offset","ellipsoid","stIndex","normalIndex","tangentIndex","bitangentIndex","vertexCountHalf","ellipsoidOuter","fromCartesian3","ellipsoidInner","fromArray","geodeticSurfaceNormal","normalST","atan2","asin","unit","tangetOffset","UNIT_X","UNIT_Z","cross","normalize","fromEllipsoid","getUnitEllipsoid","_toConsumableArray","arr","isArray","arr2","_arrayWithoutHoles","iter","Symbol","iterator","toString","call","from","_iterableToArray","TypeError","_nonIterableSpread","BoundingSphere","BoundingSphereState","Cartesian3","Cartographic","CesiumMath","defaultValue","destroyObject","Ellipsoid","Entity","formatError","getTimestamp","HeadingPitchRange","ImageryLayer","JulianDate","loadWithXhr","Matrix4","Rectangle","sampleTerrain","ScreenSpaceEventType","TaskProcessor","Transforms","when","EventHelper","ImagerySplitDirection","Feature","GlobeOrMap","inherit","pollToPromise","TerriaError","PickedFeatures","ViewerMode","i18next","Cesium","terria","stoppedRendering","verboseRendering","canShowSplitter","dataSourceDisplay","_lastClockTime","_lastCameraViewMatrix","_lastCameraMoveTime","_selectionIndicator","_removePostRenderListener","postRender","bind","_removeInfoBoxCloseListener","_boundNotifyRepaintRequired","notifyRepaintRequired","_pauseMapInteractionCount","imagerySplitPosition","splitPosition","supportsPolylinesOnTerrain","context","depthTexture","screenSpaceEventHandler","setInputAction","e","pickFromScreenPosition","LEFT_CLICK","canvas","window","PointerEvent","_wheelEvent","onmousewheel","infoBox","viewModel","closeClicked","_clockViewModel","clock","_shouldAnimateSubscription","_currentTimeSubscription","timeline","_selectedFeatureSubscription","selectFeature","_splitterPositionSubscription","_showSplitterSubscription","updateAllItemsForSplitter","_originalLoadWithXhr","load","url","responseType","method","headers","deferred","overrideMimeType","preferText","timeout","promise","always","_originalScheduleTask","scheduleTask","parameters","transferableObjects","_originalWorkerMessageSinkRepaint","_worker","onmessage","taskProcessor","event","renderError","error","sender","title","message","appName","email","supportEmail","viewerMode","Leaflet","globe","tileLoadProgressEvent","updateTilesLoadingCount","_setViewerResolution","disposeCommonListeners","cartesian3Scratch","enuToFixedScratch","southwestScratch","southeastScratch","northeastScratch","northwestScratch","southwestCartographicScratch","southeastCartographicScratch","northeastCartographicScratch","northwestCartographicScratch","getCurrentExtent","camera","width","height","centerOfScreen","pickRay","getPickRay","center","pick","homeView","rectangle","fovy","frustum","fovx","atan","tan","aspectRatio","cameraOffset","positionWC","cameraHeight","xDistance","yDistance","southwestEnu","southeastEnu","northeastEnu","northwestEnu","enuToFixed","eastNorthUpToFixedFrame","southwest","multiplyByPoint","southeast","northeast","northwest","southwestCartographic","cartesianToCartographic","southeastCartographic","northeastCartographic","northwestCartographic","longitude","rect","convertLongitudeRange","latitude","getContainer","zoomTo","flightDurationSeconds","lastTarget","then","destinationCartesian","getRectangleCameraCoordinates","destination","terrainProvider","results","finalDestinationCartographic","finalDestination","cartographicToCartesian","flyTo","entities","isLoading","loadingEvent","defer","removeEvent","zoomToDataSource","readyPromise","zoomToBoundingSphere","orientation","direction","up","boundingSphereScratch","boundingSpheres","state","PENDING","getBoundingSphere","FAILED","fromBoundingSpheres","flyToBoundingSphere","pollInterval","modelMatrix","countNumberOfSubItems","item","date","now","equalsEpsilon","viewMatrix","cameraMovedInLastSecond","surface","_surface","tilesWaiting","_tileProvider","ready","_tileLoadQueueHigh","_tileLoadQueueMedium","_tileLoadQueueLow","_debug","tilesWaitingForChildren","shouldAnimate","console","log","useDefaultRenderLoop","feature","selectedFeature","originalEntity","cesiumEntity","DONE","currentTime","_highlightFeature","captureScreenshot","removeCallback","cesiumCanvas","showSplitter","getContext","drawImage","strokeStyle","baseMapContrastColor","beginPath","moveTo","lineTo","stroke","toDataURL","reject","render","computePositionOnScreen","addAttribution","attribution","creditDisplay","addDefaultCredit","removeAttribution","removeDefaultCredit","getAllAttribution","_currentFrameCredits","screenCredits","concat","lightboxCredits","map","credit","html","updateLayerOrderToKeepOnTop","nowViewing","l","imageryLayer","keepOnTop","imageryLayers","updateLayerOrderAfterReorder","itemAbove","subItem","n","itemBelow","_imageryLayer","adjustDisclaimer","pickFromLocation","latlng","imageryLayerCoords","existingFeatures","ignoreSplitter","pickPosition","fromDegrees","lng","lat","pickPositionCartographic","promises","allowFeatureInfoRequests","imageryProvider","_imageryProvider","coords","pickFeatures","level","_buildPickedFeatures","mapInteractionModeStack","pickedFeatures","vectorFeatures","pickVectorFeatures","providerCoords","_attachProviderCoordHooks","pickRasterPromise","pickImageryLayerFeatures","Promise","pickedList","drillPick","picked","id","entityCollection","owner","_featureHighlightName","fromEntityCollectionOrEntity","_catalogItem","getFeaturesFromPickResult","apply","pickFeaturesHook","oldPick","featuresPromise","featurePromises","defaultHeight","allFeaturesAvailablePromise","all","allFeatures","features","reduce","resultFeaturesSoFar","imageryLayerFeatures","_createFeatureFromImageryLayerFeature","pickedSide","getSplitterSideForScreenPosition","filter","splitDirection","otherwise","addImageryProvider","errorEvent","onLoadError","alpha","clipToRectangle","isRequired","isRequiredForRendering","layerIndex","removeImageryLayer","layer","showImageryLayer","hideImageryLayer","isImageryLayerShown","updateItemForSplitter","_nextLayer","pauseMapInteraction","screenSpaceCameraController","enableInputs","resumeMapInteraction","_this","setTimeout","IonWorldImageryStyle","AERIAL","IonImageryProvider","assetId","GlobeSurfaceShader","numberOfDayTextures","flags","material","shaderProgram","clippingShaderState","GlobeSurfaceShaderSet","baseVertexShaderSource","baseFragmentShaderSource","_shadersByTexturesFlags","getShaderProgram","surfaceTile","applyBrightness","applyContrast","applyHue","applySaturation","applyGamma","applyAlpha","applySplit","showReflectiveOcean","showOceanWaves","enableLighting","dynamicAtmosphereLighting","dynamicAtmosphereLightingFromSun","showGroundAtmosphere","perFragmentGroundAtmosphere","hasVertexNormals","useWebMercatorProjection","enableFog","enableClippingPlanes","clippingPlanes","clippedByBoundaries","splitTerrain","hasImageryLayerCutout","colorCorrect","highlightFillTile","colorToAlpha","quantization","quantizationDefine","terrainEncoding","renderedMesh","encoding","TerrainQuantization","BITS12","cartographicLimitRectangleFlag","cartographicLimitRectangleDefine","imageryCutoutFlag","imageryCutoutDefine","sceneMode","mode","currentClippingShaderState","clippingPlanesState","surfaceShader","shadersByFlags","vs","fs","sources","getClippingFunction","defines","computeDayColor","positionMode","SceneMode","SCENE3D","SCENE2D","COLUMBUS_VIEW","MORPHING","getPositionMode","get2DYPositionFraction","shader","ShaderProgram","fromCache","vertexShaderSource","fragmentShaderSource","attributeLocations","getAttributeLocations","shadersByTexturesFlags","textureCount","hasOwnProperty","PARTIAL","FULL","START","LOADING","UNLOADED","RECEIVING","RECEIVED","TRANSFORMING","TRANSFORMED","READY","GlobeSurfaceTile","imagery","waterMaskTexture","waterMaskTranslationAndScale","Cartesian4","terrainData","vertexArray","orientedBoundingBox","boundingVolumeSourceTile","tileBoundingRegion","occludeePointInScaledSpace","terrainState","mesh","fill","pickBoundingSphere","isClipped","getPosition","projection","vertices","decodePosition","positionCart","project","fromElements","eligibleForUnloading","shouldRemoveTile","tileImagery","loadingImagery","ImageryState","TRANSITIONING","scratchV0","scratchV1","scratchV2","scratchResult","ray","cullBackFaces","indicesLength","minT","Number","MAX_VALUE","i0","i1","i2","v0","v1","v2","IntersectionTests","rayTriangleParametric","Ray","getPoint","pickTriangle","intersection","rayTriangle","freeResources","referenceCount","imageryList","freeVertexArray","_freeVertexArray","wireframeVertexArray","initialize","tile","imageryLayerCollection","available","getTileDataAvailable","parent","parentSurfaceTile","isChildAvailable","_createTileImagerySkeletons","prepareNewTile","processStateMachine","vertexArraysToDestroy","terrainOnly","canUpsample","sourceData","sourceX","sourceY","sourceLevel","terrainDataPromise","upsample","tilingScheme","success","request","failure","RequestState","CANCELLED","_requestError","TileProviderError","handleError","doRequest","Request","throttle","throttleByServer","type","RequestType","TERRAIN","requestPromise","requestTileGeometry","meshPromise","createMesh","terrainExaggeration","OrientedBoundingBox","_createVertexArrayForMesh","createResources","hasWaterMask","waterMask","texture","waterMaskData","cache","tile_waterMaskData","allWaterTexture","Texture","create","pixelFormat","PixelFormat","LUMINANCE","pixelDatatype","PixelDatatype","source","arrayBufferView","sampler","Sampler","wrapS","TextureWrap","CLAMP_TO_EDGE","wrapT","minificationFilter","TextureMinificationFilter","LINEAR","magnificationFilter","TextureMagnificationFilter","getContextWaterMaskData","waterMaskLength","textureSize","sqrt","flipY","createWaterMaskTextureIfNeeded","sourceTile","_findAncestorTileWithTerrainData","_computeWaterMaskTranslationAndScale","processTerrainStateMachine","wasAlreadyRenderable","renderable","isTerrainDoneLoading","upsampledFromParent","wasCreatedByUpsampling","isImageryDoneLoading","processImagery","callbacks","_loadedCallbacks","newCallbacks","layerId","skipLoading","isUpsampledOnly","isAnyTileLoaded","isDoneLoading","tileImageryCollection","PLACEHOLDER","thisTileDoneLoading","readyImagery","INVALID","typedArray","buffer","Buffer","createVertexBuffer","usage","BufferUsage","STATIC_DRAW","getAttributes","indexBuffers","indexBuffer","createIndexBuffer","indexDatatype","IndexDatatype","fromSizeInBytes","BYTES_PER_ELEMENT","vertexArrayDestroyable","VertexArray","sourceTileRectangle","tileRectangle","tileWidth","tileHeight","scaleX","scaleY","west","south","w","WEST","NORTH","EAST","SOUTH","NORTHWEST","NORTHEAST","SOUTHWEST","SOUTHEAST","TileSelectionResult","CULLED","RENDERED","REFINED","RENDERED_AND_KICKED","REFINED_AND_KICKED","CULLED_BUT_NEEDED","wasKicked","originalResult","kick","TerrainFillMesh","frameLastUpdated","westMeshes","westTiles","southMeshes","southTiles","eastMeshes","eastTiles","northMeshes","northTiles","southwestMesh","southwestTile","southeastMesh","southeastTile","northwestMesh","northwestTile","northeastMesh","northeastTile","changedThisFrame","visitedFrame","enqueuedFrame","tileProvider","createFillMesh","traversalQueueScratch","Queue","visitRenderedTiles","startTile","currentFrameNumber","tileEdge","downOnly","traversalQueue","_lastSelectionResultFrame","_lastSelectionResult","northwestChild","northeastChild","southwestChild","southeastChild","destinationTile","frameNumber","destinationSurfaceTile","enqueue","sourceMesh","edgeMeshes","edgeTiles","startIndex","endIndex","existingTile","existingRectangle","destinationFill","sourceFill","epsilon","sourceRectangle","destinationRectangle","north","EPSILON5","greaterThan","greaterThanOrEquals","east","lessThan","lessThanOrEquals","propagateEdge","visitTile","updateFillTiles","renderedTiles","quadtree","_quadtree","levelZeroTiles","_levelZeroTiles","lastSelectionFrameNumber","_lastSelectionFrameNumber","clear","renderedTile","dequeue","tileToWest","findTileToWest","tileToSouth","findTileToSouth","tileToEast","findTileToEast","tileToNorth","findTileToNorth","tileToNorthwest","tileToSouthwest","tileToNortheast","tileToSoutheast","cartographicScratch","centerCartographicScratch","cartesianScratch","normalScratch","octEncodedNormalScratch","uvScratch2","uvScratch","HeightAndNormal","encodedNormal","fillMissingCorner","u","v","adjacentCorner1","adjacentCorner2","oppositeCorner","vertex","minimumHeight","maximumHeight","getVertexWithHeightAtCorner","heightRangeScratch","swVertexScratch","seVertexScratch","nwVertexScratch","neVertexScratch","heightmapBuffer","_imageryLayers","nwCorner","getCorner","swCorner","seCorner","neCorner","southwestHeight","southeastHeight","northwestHeight","northeastHeight","middleHeight","geometricError","getLevelMaximumGeometricError","minCutThroughRadius","maximumRadius","maxTileWidth","acos","HeightmapTerrainData","structure","heightOffset","_createMeshSync","TerrainEncoding","centerCartographic","meshes","maxVertexCount","eastIndicesNorthToSouth","northIndicesWestToEast","westIndicesSouthToNorth","southIndicesEastToWest","heightRange","stride","getStride","nextIndex","northwestIndex","southwestIndex","addEdge","addVertexWithComputedPosition","southeastIndex","northeastIndex","obb","fromRectangle","southMercatorY","WebMercatorProjection","geodeticLatitudeToMercatorAngle","oneOverMercatorHeight","centerWebMercatorT","geodeticSurfaceNormalCartographic","centerEncodedNormal","AttributeCompression","octEncode","centerIndex","encode","indexDataBytes","indexOut","TerrainMesh","fromOrientedBoundingBox","ellipsoidalOccluder","_occluders","cornerPositions","cornerPositionsScratch","fromRadians","computeHorizonCullingPointPossiblyUnderEllipsoid","computeOccludeePoint","oldTexture","waterSourceTile","webMercatorT","cartographic","lerp","uv","sourceRectangleScratch","transformTextureCoordinates","targetTile","coordinates","targetRectangle","getNumberOfXTilesAtLevel","sourceWidth","umin","umax","sourceHeight","vmin","vmax","encodedNormalScratch","getVertexFromTileAtCorner","sourceIndex","sourceEncoding","sourceVertices","decodeHeight","getOctEncodedNormal","encodedNormalScratch2","cartesianScratch2","terrainFillMesh","cornerTile","cornerMesh","previousEdgeTiles","previousEdgeMeshes","nextEdgeTiles","nextEdgeMeshes","getCornerFromEdge","meshIsUsable","getClosestHeightToCorner","previousMeshes","previousTiles","previousEdge","nextMeshes","nextTiles","nextEdge","height1","getNearestHeightOnEdge","height2","addEdgeMesh","edgeTile","edgeMesh","lastU","lastV","compareU","decodeTextureCoordinates","targetStride","hasWebMercatorT","uOrV","nearlyEdgeU","nearlyEdgeV","tiles","isNext","edge","meshStart","meshEnd","meshStep","meshIndex","edgeVertices","increasing","vertexIndexIndex","targetUv","binarySearch","textureCoordinate","previousIndex","interpolateU","ratio","previousUv","nextUv","encodedNormal1","encodedNormal2","normal1","octDecode","normal2","getInterpolatedVertexAtCorner","GlobeSurfaceTileProvider","lightingFadeOutDistance","lightingFadeInDistance","oceanNormalMap","zoomedOutOceanSpecularIntensity","shadows","ShadowMode","RECEIVE_ONLY","fillHighlightColor","hueShift","saturationShift","brightnessShift","showSkirts","backFaceCulling","_terrainProvider","_surfaceShaderSet","surfaceShaderSet","_renderState","_blendRenderState","_disableCullingRenderState","_disableCullingBlendRenderState","_errorEvent","Event","layerAdded","_onLayerAdded","layerRemoved","_onLayerRemoved","layerMoved","_onLayerMoved","layerShownOrHidden","_onLayerShownOrHidden","_imageryLayersUpdatedEvent","_layerOrderChanged","_tilesToRenderByTextureCount","_drawCommands","_uniformMaps","_usedDrawCommands","_vertexArraysToDestroy","wireframe","boundingSphereTile","_baseColor","_firstPassInitialColor","baseColor","Color","_clippingPlanes","cartographicLimitRectangle","_hasLoadedTilesThisFrame","_hasFillTilesThisFrame","sortTileImageryByLayerIndex","a","b","aImagery","bImagery","_layerIndex","fromColor","imageryLayersUpdatedEvent","invalidateAllTiles","ClippingPlaneCollection","setOwner","_update","queueReprojectionCommands","forEachLoadedTile","sort","addCredit","updateCredits","beginUpdate","tilesToRenderByTextureCount","enabled","endUpdate","RenderState","cull","depthTest","func","DepthFunction","LESS","LESS_OR_EQUAL","blending","BlendingState","ALPHA_BLEND","rs","_tilesToRender","textureCountIndex","textureCountLength","tilesToRender","tileIndex","tileLength","addDrawCommandsForTile","minimumTerrainHeight","updateForPick","drawCommands","commandList","cancelReprojections","loadTile","terrainStateBefore","computeTileVisibility","occluders","rectangleIntersectionScratch","splitCartographicLimitRectangleScratch","rectangleCenterScratch","clipRectangleAntimeridian","splitRectangle","distance","computeDistanceToTile","_distance","fog","cameraUnderground","density","cullingVolume","boundingVolume","boundingSphere3D","clippedCartographicLimitRectangle","areaLimitIntersection","simpleIntersection","fromRectangleWithHeights2D","mapProjection","union","Intersect","INTERSECTING","planeIntersection","computeIntersectionWithBoundingVolume","INSIDE","OUTSIDE","computeVisibility","ortho3D","OrthographicFrustum","isScaledSpacePointVisiblePossiblyUnderEllipsoid","canRefine","readyImageryScratch","canRenderTraversalStack","canRenderWithoutLosingDetail","terrainReady","initialImageryState","isReady","lastFrame","stack","descendant","pop","lastFrameSelectionResult","descendantSurface","descendantImagery","descendantTileImagery","descendantLoadingImagery","descendantIsReady","descendantLayerIndex","tileDirectionScratch","computeTileLoadPriority","cameraPosition","cameraDirection","directionWC","tileDirection","divideByScalar","dot","modifiedModelViewScratch","modifiedModelViewProjectionScratch","tileRectangleScratch","localizedCartographicLimitRectangleScratch","rtcScratch","centerEyeScratch","showTileThisFrame","readyTextureCount","tileSet","debug","tilesRendered","texturesRendered","heightSource","TileBoundingRegion","computeBoundingVolumes","_minimumHeight","_maximumHeight","NaN","ancestor","ancestorSurfaceTile","ancestorMesh","ancestorTerrainData","updateTileBoundingRegion","positionCartographic","distanceToCamera","tileImageryUpdatedEvent","_reload","_imageryCache","tileImageriesToFree","insertionPoint","getTileReadyCallback","numDestroyed","newIndex","oldIndex","getDebugOrientedBoundingBox","getDebugBoundingSphere","debugDestroyPrimitive","scratchClippingPlaneMatrix","createTileUniformMap","globeSurfaceTileProvider","u_initialColor","properties","initialColor","u_fillHighlightColor","u_zoomedOutOceanSpecularIntensity","u_oceanNormalMap","u_lightingFadeDistance","lightingFadeDistance","u_nightFadeDistance","nightFadeDistance","u_center3D","center3D","u_tileRectangle","u_modifiedModelView","uniformState","view","centerEye","rtc","setTranslation","u_modifiedModelViewProjection","projectionMatrix","multiply","u_dayTextures","dayTextures","u_dayTextureTranslationAndScale","dayTextureTranslationAndScale","u_dayTextureTexCoordsRectangle","dayTextureTexCoordsRectangle","u_dayTextureUseWebMercatorT","dayTextureUseWebMercatorT","u_dayTextureAlpha","dayTextureAlpha","u_dayTextureBrightness","dayTextureBrightness","u_dayTextureContrast","dayTextureContrast","u_dayTextureHue","dayTextureHue","u_dayTextureSaturation","dayTextureSaturation","u_dayTextureOneOverGamma","dayTextureOneOverGamma","u_dayIntensity","dayIntensity","u_southAndNorthLatitude","southAndNorthLatitude","u_southMercatorYAndOneOverHeight","southMercatorYAndOneOverHeight","u_waterMask","u_waterMaskTranslationAndScale","u_minMaxHeight","minMaxHeight","u_scaleAndBias","scaleAndBias","u_dayTextureSplit","dayTextureSplit","u_dayTextureCutoutRectangles","dayTextureCutoutRectangles","u_clippingPlanes","defaultTexture","u_cartographicLimitRectangle","localizedCartographicLimitRectangle","u_clippingPlanesMatrix","IDENTITY","u_clippingPlanesEdgeStyle","clippingPlanesEdgeColor","clippingPlanesEdgeWidth","u_minimumBrightness","minimumBrightness","u_terrainSplitDirection","u_hsbShift","hsbShift","u_colorsToAlpha","colorsToAlpha","modifiedModelView","WHITE","createWireframeVertexArrayIfNecessary","provider","terrainMesh","geometry","PrimitiveType","GeometryPipeline","toWireframe","wireframeIndices","wireframeIndexBuffer","_attributes","createWireframeVertexArray","previousVolume","instanceOBB","GeometryInstance","BoxOutlineGeometry","instanceSphere","SphereOutlineGeometry","createDebugPrimitive","instance","Primitive","geometryInstances","appearance","PerInstanceColorAppearance","translucent","flat","asynchronous","color","fromRotationTranslation","halfAxes","ColorGeometryInstanceAttribute","sphere","fromTranslation","multiplyByUniformScale","otherPassesInitialColor","surfaceShaderSetOptionsScratch","credits","tileCredits","tileCreditIndex","tileCreditLength","maxTextures","ContextLimits","maximumTextureImageUnits","castShadows","receiveShadows","EPSILON7","cameraDistance","fadeOutDistance","nightFadeOutDistance","shadowState","shadowsEnabled","southLatitude","northLatitude","pow","widthEpsilon","heightEpsilon","surfaceShaderSetOptions","imageryIndex","imageryLen","firstPassRenderState","otherPassesRenderState","renderState","command","uniformMap","DrawCommand","RED","uniformMapProperties","nightFadeInDistance","cartographicTileRectangle","inverseTileWidth","inverseTileHeight","applyFog","EPSILON3","applyCutout","applyColorToAlpha","useWebMercatorT","textureWebMercator","textureTranslationAndScale","_calculateTextureTranslationAndScale","textureCoordinateRectangle","brightness","DEFAULT_BRIGHTNESS","contrast","DEFAULT_CONTRAST","hue","DEFAULT_HUE","saturation","DEFAULT_SATURATION","gamma","DEFAULT_GAMMA","dayTextureCutoutRectangle","cutoutRectangle","hasColorToAlpha","colorToAlphaThreshold","red","green","blue","creditIndex","creditLength","matrix","clippingPlanesEnabled","edgeColor","edgeWidth","combine","count","indexCountWithoutSkirts","pass","Pass","GLOBE","LINES","dirty","ImageryLayerCollection","_layers","getLayerIndex","layers","swapLayers","clamp","temp","applicableRectangleScratch","pickedPosition","pickedTile","pickedLocation","textureIndex","imageryTiles","terrainImagery","applicableRectangle","resultIndex","image","featureIndex","layersShownOrHidden","isBaseLayer","_isBaseLayer","_show","QuadtreeOccluders","_ellipsoid","EllipsoidalOccluder","QuadtreeTile","_tilingScheme","_x","_y","_level","_parent","_rectangle","tileXYToRectangle","_southwestChild","_southeastChild","_northwestChild","_northeastChild","replacementPrevious","replacementNext","_loadPriority","_customData","_frameUpdated","freeTile","createLevelZeroTiles","numberOfLevelZeroTilesX","numberOfLevelZeroTilesY","getNumberOfYTilesAtLevel","_updateCustomData","customData","parentCustomData","children","needsLoading","findLevelZeroTile","xTiles","westOfParent","eastOfParent","southOfParent","northOfParent","TileReplacementQueue","head","tail","_lastBeforeStartOfFrame","tileReplacementQueue","previous","next","markStartOfRenderFrame","trimTiles","maximumTiles","tileToTrim","keepTrimming","markTileRendered","comparisonPoint","QuadtreePrimitive","enableDebugOutput","maxDepth","maxDepthVisited","tilesVisited","tilesCulled","lastMaxDepth","lastMaxDepthVisited","lastTilesVisited","lastTilesCulled","lastTilesRendered","lastTilesWaitingForChildren","suspendLodUpdate","_tileReplacementQueue","_loadQueueTimeSlice","_tilesInvalidated","_addHeightCallbacks","_removeHeightCallbacks","_tileToUpdateHeights","_lastTileIndex","_updateHeightsTimeSlice","_cameraPositionCartographic","_cameraReferenceFrameOriginCartographic","maximumScreenSpaceError","tileCacheSize","loadingDescendantLimit","preloadAncestors","preloadSiblings","_tileLoadProgressEvent","_lastTileLoadQueueLength","clearTileLoadQueue","tileFunction","forEachRenderedTile","updateHeight","object","positionOnEllipsoidSurface","addedCallbacks","removeFunc","beginFrame","passes","replacementQueue","customDataLength","numberOfRootTiles","rootTraversalDetails","TraversalDetails","compareDistanceToPoint","customDataAdded","customDataRemoved","cameraFrameOrigin","getTranslation","cameraOriginScratch","visitIfVisible","queueTileLoad","selectTilesForRendering","createRenderCommandsForSelectedTiles","endFrame","tileLoadQueueHigh","tileLoadQueueMedium","tileLoadQueueLow","endTime","didSomeLoading","processSinglePriorityLoadQueue","processTileLoadQueue","tryNextFrame","scratchArray","tilesToUpdateHeights","startTime","timeSlice","timeSliceMax","surfaceNormal","scratchRay","rayOrigin","getSurfaceNormalIntersectionWithZAxis","origin","vectorToMinimumPoint","scratchCartographic","child","childrenLength","tileDataAvailable","parentTile","shift","selectionResult","updateHeights","currentLoadQueueLength","afterRender","updateTileLoadProgress","centerScratch","alon","alat","blon","blat","queue","allAreRenderable","anyWereRenderedLastFrame","notYetRenderableCount","TraversalQuadDetails","traversalQuadsByLevel","ancestorMeetsSse","traversalDetails","meetsSse","OrthographicOffCenterFrustum","_offCenterFrustum","drawingBufferWidth","drawingBufferHeight","maxGeometricError","pixelSize","bottom","right","sse","pixelRatio","screenSpaceError2D","sseDenominator","screenSpaceError","oneRenderedLastFrame","twoCulledOrNotVisited","threeCompletelyLoaded","addTileToRenderList","firstRenderedDescendantIndex","loadIndexLow","loadIndexMedium","loadIndexHigh","tilesToUpdateHeightsIndex","quadDetails","southwestDetails","southeastDetails","northwestDetails","northeastDetails","visitVisibleChildrenNearToFar","queuedForLoad","renderList","workTile","KICKED","wasRenderedLastFrame","containsNeededPosition","sortByLoadPriority","loadQueue","Globe","EllipsoidTerrainProvider","_imageryLayerCollection","_material","_terrainProviderChanged","makeShadersDirty","_oceanNormalMapResourceDirty","_oceanNormalMapResource","Resource","showWaterEffect","depthTestAgainstTerrain","atmosphereHueShift","atmosphereSaturationShift","atmosphereBrightnessShift","_oceanNormalMap","_zoomedOutOceanSpecularIntensity","requireNormals","shaderSource","match","fragmentSources","GroundAtmosphere","requestVertexNormals","_uniforms","GlobeFS","ShaderSource","GlobeVS","createComparePickTileFunction","distanceSquaredTo","tilesLoaded","oceanNormalMapUrl","terrainProviderChanged","scratchSphereIntersectionResult","start","stop","pickWorldCoordinates","sphereIntersections","boundingSphereIntersection","raySphere","cartoScratch","carto","unproject","scratchGetHeightCartesian","scratchGetHeightIntersection","scratchGetHeightCartographic","scratchGetHeightRay","tileIfContainsCartographic","getHeight","tileWithMesh","cartesian","oceanNormalMapResource","fetchImage","rightAscension","declination","rotation","rotationRate","Iau2000Orientation","c1","c2","c3","c4","c6","c7","c9","dateTT","ComputeMoon","addSeconds","d","totalDays","T","TimeConstants","DAYS_PER_JULIAN_CENTURY","E1","RADIANS_PER_DEGREE","E2","E3","E4","E5","E6","E7","E8","E9","E10","E11","E12","E13","sinE1","sinE2","sinE3","sinE4","sinE5","sinE6","sinE7","sinE8","sinE9","sinE10","sinE11","sinE12","sinE13","cosE1","cosE2","cosE3","cosE4","cosE5","cosE6","cosE7","cosE8","cosE9","cosE10","cosE11","cosE12","cosE13","IauOrientationAxes","computeFunction","_computeFunction","xAxisScratch","yAxisScratch","zAxisScratch","rotMtxScratch","Matrix3","quatScratch","Quaternion","evaluate","alphaDeltaW","precMtx","delta","xAxis","PI_OVER_TWO","cosDec","zAxis","yAxis","computeRotationMatrix","rot","zeroToTwoPi","quat","fromAxisAngle","rotMtx","fromQuaternion","conjugate","Simon1994PlanetaryPositions","taiToTdb","g","days","epoch","TimeStandard","TAI","MetersPerKilometer","RadiansPerDegree","RadiansPerArcSecond","RADIANS_PER_ARCSECOND","perifocalToEquatorial","elementsToCartesian","semimajorAxis","eccentricity","inclination","longitudeOfPerigee","longitudeOfNode","meanLongitude","radiusOfPeriapsis","argumentOfPeriapsis","rightAscensionOfAscendingNode","trueAnomaly","meanAnomaly","eccentricAnomaly","revs","trueAnomalyX","trueAnomalyY","eccentricAnomalyToTrueAnomaly","iterationValue","maxIterationCount","keplerEqConvergence","NRfunction","dNRfunction","meanAnomalyToEccentricAnomaly","meanAnomalyToTrueAnomaly","tolerance","chooseOrbit","cosap","sinap","cosi","sini","cosraan","sinraan","perifocalToCartesianMatrix","semilatus","costheta","sintheta","multiplyByVector","EPSILON8","semiMajorAxis0","meanLongitude0","meanLongitude1","p1u","p2u","p3u","p4u","p5u","p6u","p7u","p8u","Ca1","Ca2","Ca3","Ca4","Ca5","Ca6","Ca7","Ca8","Sa1","Sa2","Sa3","Sa4","Sa5","Sa6","Sa7","Sa8","q1u","q2u","q3u","q4u","q5u","q6u","q7u","q8u","Cl1","Cl2","Cl3","Cl4","Cl5","Cl6","Cl7","Cl8","Sl1","Sl2","Sl3","Sl4","Sl5","Sl6","Sl7","Sl8","scratchDate","computeSimonMoon","dayNumber","secondsOfDay","SECONDS_PER_DAY","t2","t3","t4","inclinationConstant","inclinationSecPart","longitudeOfPerigeeConstant","longitudeOfPerigeeSecPart","longitudeOfNodeConstant","longitudeOfNodeSecPart","meanLongitudeConstant","meanLongitudeSecPart","D","lprime","psi","twoD","fourD","sixD","twol","threel","fourl","twoF","twoPsi","threePsi","perigeeAndMean","factor","moonEarthMassRatio","axesTransformation","computeSunPositionInEarthInertialFrame","julianDate","computeSimonEarthMoonBarycenter","computeSimonEarth","computeMoonPositionInEarthInertialFrame","EllipsoidPrimitive","_center","_oneOverEllipsoidRadiiSquared","_boundingSphere","_modelMatrix","_computedModelMatrix","Material","fromType","ColorType","_translucent","_id","debugShowBoundingVolume","onlySunLighting","_onlySunLighting","_depthTestEnabled","depthTestEnabled","_useLogDepth","_sp","_rs","_va","_pickSP","_pickId","_colorCommand","_owner","_pickCommand","pickOnly","u_radii","u_oneOverEllipsoidRadiiSquared","_pickUniforms","czm_pickColor","logDepthExtension","isTranslucent","translucencyChanged","face","CullFace","FRONT","depthMask","fragmentDepth","ellipsoidPrimitive_vertexArray","VertexFormat","fromGeometry","bufferUsage","interleave","getVertexArray","boundingSphereDirty","r","multiplyByTranslation","maximumComponent","materialChanged","lightingChanged","useLogDepth","useLogDepthChanged","colorCommand","EllipsoidVS","EllipsoidFS","replaceCache","executeInClosestFrustum","TRANSLUCENT","OPAQUE","pickCommand","createPickId","pickColorQualifier","Moon","textureUrl","MOON","_ellipsoidPrimitive","ImageType","_axes","icrfToFixed","rotationScratch","translationScratch","scratchCommandList","ellipsoidPrimitive","uniforms","computeIcrfToFixedMatrix","computeTemeToPseudoFixedMatrix","transpose","translation","savedCommandList","leftScratchArray","rightScratchArray","compare","userDefinedObject","end","middle","leftLength","rightLength","k","leftElement","rightElement","merge","comparator","scratchLength","ceil","Occluder","occluderBoundingSphere","_occluderPosition","_occluderRadius","_horizonDistance","_horizonPlaneNormal","_horizonPlanePosition","_cameraPosition","scratchCartesian3","horizonDistance","horizonPlaneNormal","horizonPlanePosition","cameraToOccluderVec","invCameraToOccluderDistance","magnitudeSquared","occluderRadiusSqrd","nearPlaneDistance","fromBoundingSphere","tempVecScratch","isPointVisible","occludee","tempVec","occludeePositionScratch","isBoundingSphereVisible","occludeePosition","occludeeRadius","tempVecMagnitudeSquared","occluderRadiusSquared","occludeeRadiusSquared","tempScratch","occludeeBS","occluderToOccludeeDistSqrd","cameraToOccludeeDistSqrd","occludeePointScratch","occludeePos","occluderPosition","occluderRadius","numPositions","occluderPlaneNormal","occluderPlaneD","aRotationVector","_anyRotationVector","_horizonToPlaneNormalDotProduct","tempDot","computeOccludeePointFromRectangleScratch","computeOccludeePointFromRectangle","subsample","bs","fromPoints","ellipsoidCenter","minimumRadius","tempVec0Scratch","tempVec0","majorAxis","tempVec1","UNIT_Y","posDirectionScratch","_rotationVector","anyRotationVector","positionDirection","crossProduct","EPSILON13","posScratch1","occluerPosScratch","posScratch2","horizonPlanePosScratch","occluderBS","pos","positionToOccluder","occluderToPositionDistanceSquared","horizonDistanceSquared","horizonPlaneDistance","horizonCrossDistance","horizonCrossDirection","dot0","dot1","renderStateScratch","ComputeEngine","_context","drawCommandScratch","clearCommandScratch","ClearCommand","execute","computeCommand","preExecute","outputTexture","getViewportQuadVertexArray","ViewportQuadVS","textureCoordinates","createViewportQuadShader","framebuffer","Framebuffer","colorTextures","destroyAttachments","createFramebuffer","viewport","BoundingRectangle","createRenderState","clearCommand","drawCommand","persists","postExecute","checkFloatTexturePrecision","floatingPointTexture","computeEngine","RGBA","floatTexture","_getFloatPixelType","_getArray","readState","sixPlaces","ComputeCommand","CheckFloatTexturePrecisionFS","u_floatTexture","pixel","readPixels","blendingEnabled","scissorTest","ShaderCache","_shaders","_numberOfShaders","_shadersToRelease","destroyShader","cachedShader","derivedKeywords","keyword","finalDestroy","numberOfShaders","replaceShaderProgram","vertexShaderText","createCombinedVertexShader","fragmentShaderText","createCombinedFragmentShader","JSON","stringify","gl","_gl","logShaderCompilation","debugShaders","_cachedShader","replaceDerivedShaderProgram","derivedKeyword","cachedDerivedShader","createDerivedShaderProgram","getDerivedShaderProgram","derivedShaderProgram","derivedCachedShader","destroyReleasedShaderPrograms","shadersToRelease","releaseShaderProgram","shaders","TextureCache","_textures","_numberOfTextures","_texturesToRelease","numberOfTextures","getTexture","cachedTexture","addTexture","destroyReleasedTextures","texturesToRelease","textures","intensity","UniformState","globeDepthTexture","_viewport","_viewportCartesian4","_viewportDirty","_viewportOrthographicMatrix","_viewportTransformation","_model","_view","_inverseView","_projection","_infiniteProjection","_entireFrustum","_currentFrustum","_frustumPlanes","_farDepthFromNearPlusOne","_log2FarDepthFromNearPlusOne","_oneOverLog2FarDepthFromNearPlusOne","_frameState","_temeToPseudoFixed","_view3DDirty","_view3D","_inverseView3DDirty","_inverseView3D","_inverseModelDirty","_inverseModel","_inverseTransposeModelDirty","_inverseTransposeModel","_viewRotation","_inverseViewRotation","_viewRotation3D","_inverseViewRotation3D","_inverseProjectionDirty","_inverseProjection","_modelViewDirty","_modelView","_modelView3DDirty","_modelView3D","_modelViewRelativeToEyeDirty","_modelViewRelativeToEye","_inverseModelViewDirty","_inverseModelView","_inverseModelView3DDirty","_inverseModelView3D","_viewProjectionDirty","_viewProjection","_inverseViewProjectionDirty","_inverseViewProjection","_modelViewProjectionDirty","_modelViewProjection","_inverseModelViewProjectionDirty","_inverseModelViewProjection","_modelViewProjectionRelativeToEyeDirty","_modelViewProjectionRelativeToEye","_modelViewInfiniteProjectionDirty","_modelViewInfiniteProjection","_normalDirty","_normal","_normal3DDirty","_normal3D","_inverseNormalDirty","_inverseNormal","_inverseNormal3DDirty","_inverseNormal3D","_encodedCameraPositionMCDirty","_encodedCameraPositionMC","EncodedCartesian3","_sunPositionWC","_sunPositionColumbusView","_sunDirectionWC","_sunDirectionEC","_moonDirectionEC","_lightDirectionWC","_lightDirectionEC","_lightColor","_lightColorHdr","_pass","_mode","_mapProjection","_cameraDirection","_cameraRight","_cameraUp","_frustum2DWidth","_eyeHeight2D","_pixelRatio","_orthographicIn3D","_backgroundColor","_brdfLut","_environmentMap","_sphericalHarmonicCoefficients","_specularEnvironmentMaps","_specularEnvironmentMapsDimensions","_specularEnvironmentMapsMaximumLOD","_fogDensity","_invertClassificationColor","_imagerySplitPosition","_pixelSizePerMeter","_geometricToleranceOverMeter","_minimumDisableDepthTestDistance","vc","viewportCartesian4","viewportOrthographic","cleanViewport","viewportTransformation","model","inverseModel","inverse","inverseTransposeModel","m","getMatrix3","view3D","updateView3D","viewRotation","viewRotation3D","inverseView","inverseView3D","updateInverseView3D","inverseViewRotation","inverseViewRotation3D","inverseProjection","infiniteProjection","modelView","multiplyTransformation","modelView3D","modelViewRelativeToEye","mv","mvRte","cleanModelViewRelativeToEye","inverseModelView","inverseModelView3D","viewProjection","inverseViewProjection","modelViewProjection","inverseModelViewProjection","modelViewProjectionRelativeToEye","modelViewInfiniteProjection","getRotation","cleanNormal","normal3D","cleanNormal3D","inverseNormal","inverseNormal3D","entireFrustum","currentFrustum","frustumPlanes","farDepthFromNearPlusOne","log2FarDepthFromNearPlusOne","oneOverLog2FarDepthFromNearPlusOne","eyeHeight2D","sunPositionWC","sunPositionColumbusView","sunDirectionWC","sunDirectionEC","moonDirectionEC","lightDirectionWC","lightDirectionEC","lightColor","lightColorHdr","encodedCameraPositionMCHigh","cleanEncodedCameraPositionMC","high","encodedCameraPositionMCLow","low","temeToPseudoFixedMatrix","fogDensity","geometricToleranceOverMeter","backgroundColor","brdfLut","environmentMap","sphericalHarmonicCoefficients","specularEnvironmentMaps","specularEnvironmentMapsDimensions","specularEnvironmentMapsMaximumLOD","minimumDisableDepthTestDistance","invertClassificationColor","orthographicIn3D","transformMatrix","sunCartographicScratch","updateCamera","setInverseView","inverseViewMatrix","rightWC","upWC","setCamera","near","far","updateFrustum","infiniteProjectionMatrix","setInfiniteProjection","log2","updatePass","EMPTY_ARRAY","defaultLight","computeOrthographicOffCenter","computeViewportTransformation","sunCartographic","setSunAndMoonDirections","light","brdfLutGenerator","colorTexture","defaultCubeMap","pixelSizePerMeter","fov","POSITIVE_INFINITY","cameraPositionMC","fromCartesian","view2Dto3DPScratch","view2Dto3DRScratch","view2Dto3DUScratch","view2Dto3DDScratch","view2Dto3DCartographicScratch","view2Dto3DCartesian3Scratch","view2Dto3DMatrix4Scratch","position2D","direction2D","right2D","up2D","frustum2DWidth","position3D","multiplyByPointAsVector","view2Dto3D","inverseTransformation","throwOnError","glFunc","glFuncArguments","getError","NO_ERROR","RuntimeError","INVALID_ENUM","INVALID_VALUE","INVALID_OPERATION","OUT_OF_MEMORY","CONTEXT_LOST_WEBGL","errorToString","createErrorMessage","makeGetterSetter","propertyName","logFunction","getExtension","extension","Context","WebGLRenderingContext","_canvas","allowTextureFilterAnisotropic","webglOptions","webgl","stencil","glContext","requestWebgl2","WebGL2RenderingContext","webgl2","getWebGLStub","_originalGLContext","_webgl2","createGuid","validateFramebuffer","validateShaderProgram","_throwOnWebGLError","_shaderCache","_textureCache","_stencilBits","getParameter","STENCIL_BITS","_maximumCombinedTextureImageUnits","MAX_COMBINED_TEXTURE_IMAGE_UNITS","_maximumCubeMapSize","MAX_CUBE_MAP_TEXTURE_SIZE","_maximumFragmentUniformVectors","MAX_FRAGMENT_UNIFORM_VECTORS","_maximumTextureImageUnits","MAX_TEXTURE_IMAGE_UNITS","_maximumRenderbufferSize","MAX_RENDERBUFFER_SIZE","_maximumTextureSize","MAX_TEXTURE_SIZE","_maximumVaryingVectors","MAX_VARYING_VECTORS","_maximumVertexAttributes","MAX_VERTEX_ATTRIBS","_maximumVertexTextureImageUnits","MAX_VERTEX_TEXTURE_IMAGE_UNITS","_maximumVertexUniformVectors","MAX_VERTEX_UNIFORM_VECTORS","aliasedLineWidthRange","ALIASED_LINE_WIDTH_RANGE","_minimumAliasedLineWidth","_maximumAliasedLineWidth","aliasedPointSizeRange","ALIASED_POINT_SIZE_RANGE","_minimumAliasedPointSize","_maximumAliasedPointSize","maximumViewportDimensions","MAX_VIEWPORT_DIMS","_maximumViewportWidth","_maximumViewportHeight","highpFloat","getShaderPrecisionFormat","FRAGMENT_SHADER","HIGH_FLOAT","_highpFloatSupported","precision","highpInt","HIGH_INT","_highpIntSupported","rangeMax","_antialias","getContextAttributes","antialias","_standardDerivatives","_blendMinmax","_elementIndexUint","_depthTexture","_fragDepth","_debugShaders","_textureFloat","_textureHalfFloat","_textureFloatLinear","_textureHalfFloatLinear","_colorBufferFloat","_floatBlend","_colorBufferHalfFloat","_s3tc","_pvrtc","_etc1","glCreateVertexArray","glBindVertexArray","glDeleteVertexArray","glDrawElementsInstanced","glDrawArraysInstanced","glVertexAttribDivisor","glDrawBuffers","vertexArrayObject","instancedArrays","drawBuffers","textureFilterAnisotropic","_textureFilterAnisotropic","_maximumTextureFilterAnisotropy","MAX_TEXTURE_MAX_ANISOTROPY_EXT","createVertexArray","vao","bindVertexArray","deleteVertexArray","instanceCount","drawElementsInstanced","first","drawArraysInstanced","divisor","vertexAttribDivisor","buffers","createVertexArrayOES","bindVertexArrayOES","deleteVertexArrayOES","drawElementsInstancedANGLE","drawArraysInstancedANGLE","vertexAttribDivisorANGLE","drawBuffersWEBGL","_vertexArrayObject","_instancedArrays","_drawBuffers","_maximumDrawBuffers","WebGLConstants","MAX_DRAW_BUFFERS","_maximumColorAttachments","MAX_COLOR_ATTACHMENTS","_clearColor","_clearDepth","_clearStencil","us","ps","_defaultPassState","_defaultRenderState","_defaultTexture","_defaultCubeMap","_us","_currentRenderState","_currentPassState","_currentFramebuffer","_maxFrameTextureUnitIndex","_vertexAttribDivisors","_previousDrawInstanced","_pickObjects","_nextPickColor","Uint32Array","_floatTexSixPlaces","scratchBackBufferArray","defaultFramebufferMarker","applyRenderState","previousRenderState","previousPassState","partialApply","bindFramebuffer","_bind","_getActiveColorAttachments","FRAMEBUFFER","shaderCache","textureCache","stencilBits","stencilBuffer","standardDerivatives","floatBlend","blendMinmax","elementIndexUint","floatTextureSixPlaces","halfFloatingPointTexture","textureFloatLinear","textureHalfFloatLinear","s3tc","pvrtc","etc1","colorBufferFloat","colorBufferHalfFloat","throwOnWebGLError","wrapFunction","arguments","glWrapper","Function","wrapGL","CubeMap","positiveX","negativeX","positiveY","negativeY","positiveZ","negativeZ","defaultFramebuffer","BACK","defaultClearCommand","bitmask","depth","s","clearColor","COLOR_BUFFER_BIT","clearDepth","DEPTH_BUFFER_BIT","clearStencil","STENCIL_BUFFER_BIT","draw","_framebuffer","_shaderProgram","_uniformMap","maximumTextureUnitIndex","beginDraw","_primitiveType","va","_vertexArray","_offset","_count","_setUniforms","bytesPerIndex","numberOfIndices","drawElements","numberOfVertices","drawArrays","_unBind","continueDraw","useProgram","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","TEXTURE_CUBE_MAP","numberOfColorAttachments","getColorTexture","pixels","viewportQuadAttributeLocations","PickId","pickObjects","key","viewportQuad_vertexArray","Geometry","GeometryAttribute","ComponentDatatype","createViewportQuadCommand","overrides","getObjectByPickColor","pickColor","toRgba","fromRgba","propertyValue","BrdfLutGenerator","_colorTexture","_drawCommand","generator","NEAREST","BrdfLutGeneratorFS","createCommand","ROTATE","INFINITE_SCROLL","Camera","_transform","_invTransform","_actualTransform","_actualInvTransform","_transformChanged","_position","_positionWC","_positionCartographic","_oldPositionWC","positionWCDeltaMagnitude","positionWCDeltaMagnitudeLastFrame","timeSinceMoved","_lastMovedTimestamp","_direction","_directionWC","_up","_upWC","_right","_rightWC","PerspectiveFrustum","toRadians","defaultMoveAmount","defaultLookAmount","defaultRotateAmount","defaultZoomAmount","constrainedAxis","maximumZoomFactor","_moveStart","_moveEnd","_changed","_changedPosition","_changedDirection","_changedFrustum","percentageChanged","_viewMatrix","_invViewMatrix","updateViewMatrix","_modeChanged","_maxCoord","_max2Dfrustum","rectangleCameraPosition3D","DEFAULT_VIEW_RECTANGLE","mag","DEFAULT_VIEW_FACTOR","computeView","TRANSFORM_2D","TRANSFORM_2D_INVERSE","DEFAULT_OFFSET","PI_OVER_FOUR","canPreloadFlight","_currentFlight","_updateCameraChanged","updateCameraDeltas","numberOfListeners","dirPercentage","dirAngle","acosClamped","heightPercentage","areaPercentage","lastPosition","lastFrustum","x0","x1","x2","x3","y0","y1","y2","y3","leftX","rightX","bottomY","topY","areaRef","scratchCartesian3Projection","scratchCartesian4Origin","scratchCartesian4NewOrigin","scratchCartesian4NewXAxis","scratchCartesian4NewYAxis","scratchCartesian4NewZAxis","scratchCartesian","updateMembers","heightChanged","positionChanged","directionChanged","upChanged","rightChanged","transformChanged","basisTo2D","convertTransformForColumbusView","getColumn","projectedPosition","newOrigin","newZAxis","newXAxis","newYAxis","EPSILON10","setColumn","convertTransformFor2D","positionENU","det","EPSILON2","invUpMag","scalar","w0","getHeading","heading","getPitch","getRoll","roll","scratchHPRMatrix1","scratchHPRMatrix2","inverseTransform","oldTransform","_setTransform","pitch","moveStart","moveEnd","changed","clampMove2D","setTransformPosition","setTransformUp","setTransformDirection","scratchAdjustOrtghographicFrustumMousePosition","pickGlobeScratchRay","scratchRayIntersection","scratchDepthIntersection","_adjustOrthographicFrustum","zooming","rayIntersection","depthIntersection","mousePosition","pickPositionSupported","pickPositionWorldCoordinates","depthDistance","rayDistance","scratchSetViewCartesian","scratchSetViewTransform1","scratchSetViewTransform2","scratchSetViewQuaternion","scratchSetViewMatrix3","scratchSetViewCartographic","scratchToHPRDirection","scratchToHPRUp","scratchToHPRRight","directionUpToHeadingPitchRoll","invTransform","scratchSetViewOptions","convert","endTransform","scratchHpr","HeadingPitchRoll","setView","hpr","currentTransform","localTransform","rotQuat","fromHeadingPitchRoll","rotMat","setView3D","newLeft","newRight","mapMode2D","setView2D","setViewCV","pitchScratch","minX","maxX","rotatable2D","maxProjectedX","maxProjectedY","flyHome","completeMorph","maxRadii","worldToCameraCoordinates","worldToCameraCoordinatesPoint","worldToCameraCoordinatesVector","cameraToWorldCoordinates","cameraToWorldCoordinatesPoint","cameraToWorldCoordinatesVector","moveScratch","move","amount","moveForward","zoom2D","moveBackward","moveUp","moveDown","moveRight","moveLeft","lookLeft","look","lookRight","lookUp","lookDown","lookScratchQuaternion","lookScratchMatrix","axis","angle","turnAngle","quaternion","twistLeft","twistRight","rotateScratchQuaternion","rotateScratchMatrix","rotateDown","rotateVertical","rotateUp","rotateVertScratchP","rotateVertScratchA","rotateVertScratchTan","rotateVertScratchNegate","northParallel","southParallel","angleToAxis","EPSILON4","rotateHorizontal","newTop","newBottom","maxBottom","maxRight","zoom3D","rotateRight","rotateLeft","zoomIn","zoomOut","getMagnitude","scratchLookAtMatrix4","lookAt","lookAtTransform","scratchLookAtHeadingPitchRangeOffset","scratchLookAtHeadingPitchRangeQuaternion1","scratchLookAtHeadingPitchRangeQuaternion2","scratchHeadingPitchRangeMatrix3","offsetFromHeadingPitchRange","range","pitchQuat","headingQuat","rotMatrix","cartesianOffset","viewRectangle3DEllipsoidGeodesic","viewRectangle3DCartographic1","viewRectangle3DCartographic2","viewRectangle3DNorthEast","viewRectangle3DSouthWest","viewRectangle3DNorthWest","viewRectangle3DSouthEast","viewRectangle3DNorthCenter","viewRectangle3DSouthCenter","viewRectangle3DCenter","viewRectangle3DEquator","defaultRF","computeD","upOrRight","tanThetaOrPhi","cameraRF","northCartographic","southCartographic","ellipsoidGeodesic","EllipsoidGeodesic","setEndPoints","interpolateUsingFraction","cart","northEast","northWest","northCenter","southCenter","southEast","southWest","rightScalar","topScalar","heightRatio","tanPhi","tanTheta","equatorCartographic","equatorPosition","viewRectangleCVCartographic","viewRectangleCVNorthEast","viewRectangleCVSouthWest","viewRectangle2DCartographic","viewRectangle2DNorthEast","viewRectangle2DSouthWest","rectangleCameraPositionColumbusView","rectangleCameraPosition2D","pickEllipsoid3DRay","pickEllipsoid2DRay","pickEllipsoidCVRay","pickEllipsoid","windowPosition","rayEllipsoid","pickEllipsoid3D","pickMap2D","pickMapColumbusView","pickPerspCenter","pickPerspXDir","pickPerspYDir","scratchDirection","nearCenter","xDir","yDir","getPickRayPerspective","getPickRayOrthographic","scratchToCenter","scratchProj","distanceToBoundingSphere","toCenter","proj","scratchPixelSize","getPixelSize","getPixelDimensions","posScratch","scratchCartesian3Subtract","createAnimationCV","distToC","dWidth","dHeight","mapWidth","mapHeight","maxY","translateX","translateY","newPosition","interp","createAnimationTemplateCV","createCorrectPositionTween","scratchFlyToDestination","newOptions","cancelFlight","setViewOptions","isRectangle","flightTween","pitchAdjustHeight","flyOverLongitude","flyOverLongitudeWeight","tweenOptions","CameraFlightPath","createTween","preloadFlightCamera","preloadFlightCullingVolume","computeCullingVolume","MINIMUM_ZOOM","adjustBoundingSphereOffset","minimumZoom","minimumZoomDistance","maximumZoom","maximumZoomDistance","distanceToBoundingSphere2D","distanceToBoundingSphere3D","viewBoundingSphere","scratchflyToBoundingSphereTransform","scratchflyToBoundingSphereDestination","scratchflyToBoundingSphereDirection","scratchflyToBoundingSphereUp","scratchflyToBoundingSphereRight","scratchFlyToBoundingSphereCart4","scratchFlyToBoundingSphereQuaternion","scratchFlyToBoundingSphereMatrix3","scene2D","EPSILON6","rotateQuat","fromCartesian4","scratchCartesian3_1","scratchCartesian3_2","scratchCartesian3_3","scratchCartesian3_4","horizonPoints","scratchPickCartesian2","scratchRectCartesian","cartoArray","addToResult","computedHorizonQuad","computeViewRectangle","successfulPickCount","eUnit","nUnit","q","multiplyComponents","oneOverRadii","qMagnitude","qUnit","wMagnitude","eastOffset","northOffset","upperLeft","lowerLeft","lowerRight","upperRight","computeHorizonQuad","fromCartographicArray","lastLon","lon","EPSILON9","switchToPerspectiveFrustum","switchToOrthographicFrustum","PERSPECTIVE","ORTHOGRAPHIC","FrustumGeometry","frustumType","frustumPackedLength","drawNearPlane","_drawNearPlane","_frustumType","_frustum","_origin","_orientation","scratchPackPerspective","scratchPackOrthographic","scratchPackQuaternion","scratchPackorigin","stOffset","frustumResult","scratchRotationMatrix","scratchViewMatrix","scratchInverseMatrix","scratchXDirection","scratchYDirection","scratchZDirection","scratchNegativeX","scratchNegativeY","scratchNegativeZ","frustumCornersNDC","scratchFrustumCorners","_computeNearFarPlanes","xDirection","yDirection","zDirection","rotationMatrix","fac","frustumGeometry","numberOfPlanes","subarray","GeometryAttributes","indexOffset","fromVertices","FrustumOutlineGeometry","DebugCameraPrimitive","_camera","_color","CYAN","_updateOnChange","updateOnChange","_outlinePrimitives","_planesPrimitives","scratchRight","scratchRotation","scratchOrientation","scratchPerspective","scratchPerspectiveOffCenter","PerspectiveOffCenterFrustum","scratchOrthographic","scratchOrthographicOffCenter","scratchColor","scratchSplits","planesPrimitives","outlinePrimitives","cameraFrustum","frustumSplits","numFrustums","fromRotationMatrix","fromAlpha","pickPrimitive","DepthPlane","_command","depthQuadScratch","FeatureDetection","supportsTypedArrays","scratchCartesian1","scratchCartesian2","scratchCartesian4","colorMask","depthQuad","computeDepthQuad","getAttribute","vertexBuffer","copyFromArrayView","DYNAMIC_DRAW","DerivedCommand","fragDepthRegex","discardRegex","createDepthOnlyDerivedCommand","depthOnlyCommand","shallowClone","shaderProgramId","_attributeLocations","writesDepthOrDiscards","test","usesLogDepth","getDepthOnlyShaderProgram","_depthOnlyRenderStateCache","depthOnlyState","getState","getDepthOnlyRenderState","writeLogDepthRegex","vertexlogDepthRegex","extensionRegex","createLogDepthCommand","slice","writesLogDepth","replaceMain","addExtension","logSource","getLogDepthShaderProgram","createPickDerivedCommand","pickId","newMain","newSources","getPickShaderProgram","picking","pickRenderStateCache","pickState","getPickRenderState","createHdrCommand","getHdrShaderProgram","DeviceOrientationCameraController","_lastAlpha","_lastBeta","_lastGamma","_alpha","_beta","_gamma","beta","_removeListener","scratchQuaternion1","scratchQuaternion2","scratchMatrix3","bQuat","gQuat","aQuat","Fog","screenSpaceErrorFactor","heightsTable","densityTable","tableStartDensity","tableEndDensity","tableLastIndex","scratchPositionNormal","heights","findInterval","startDensity","positionNormal","jobScheduler","shadowMaps","morphTime","getMorphTime","newFrame","occluder","postProcess","offscreen","scene3DOnly","lightShadowsEnabled","lightShadowMaps","nearPlane","farPlane","closestObjectSize","lastDirtyTime","outOfView","invertClassification","tilesetPassState","GlobeDepth","_globeColorTexture","_primitiveColorTexture","_depthStencilTexture","_globeDepthTexture","_tempGlobeDepthTexture","_tempCopyDepthTexture","_globeColorFramebuffer","_primitiveColorFramebuffer","_copyDepthFramebuffer","_tempCopyDepthFramebuffer","_updateDepthFramebuffer","_clearGlobeColorCommand","_clearPrimitiveColorCommand","_copyColorCommand","_copyDepthCommand","_tempCopyDepthCommand","_updateDepthCommand","_mergeColorCommand","_rsBlend","_rsUpdate","_useScissorTest","_scissorRectangle","_useHdr","_clearGlobeDepth","_debugGlobeDepthViewportCommand","destroyTextures","globeDepth","destroyFramebuffers","destroyUpdateDepthResources","destroyPrimitiveFramebuffer","updateFramebuffers","hdr","clearGlobeDepth","textureChanged","HALF_FLOAT","DEPTH_STENCIL","UNSIGNED_INT_24_8","createTextures","depthStencilTexture","createFramebuffers","createPrimitiveFramebuffer","updateCopyCommands","useScissorTest","updateScissor","stencilTest","frontFunction","StencilFunction","EQUAL","frontOperation","fail","StencilOperation","KEEP","zFail","zPass","backFunction","NEVER","reference","StencilConstants","CESIUM_3D_TILE_MASK","mask","PassThroughDepth","u_depthTexture","PassThrough","primitiveFramebuffer","executeDebugGlobeDepth","executeCopyDepth","executeUpdateDepth","depthTextureToCopy","createUpdateDepthResources","executeCopyColor","executeMergeColor","InvertClassification","previousFramebuffer","_previousFramebuffer","_texture","_classifiedTexture","_fbo","_fboClassified","_rsUnclassified","_rsClassified","_unclassifiedCommand","_classifiedCommand","_translucentCommand","_clearColorCommand","_clearCommand","classifiedTexture","unclassifiedCommand","isTranslucencySupported","rsUnclassified","CLASSIFICATION_MASK","rsClassified","NOT_EQUAL","rsDefault","setCesium3DTileBit","stencilMask","previousFramebufferChanged","depthStencilRenderbuffer","_rsDefault","unclassifiedFSSource","classifiedFSSource","executeClassified","executeUnclassified","JobTypeBudget","total","_total","usedThisFrame","stolenFromMeThisFrame","starvedThisFrame","starvedLastFrame","JobScheduler","budgets","jobBudgets","JobType","NUMBER_OF_JOB_TYPES","TEXTURE","PROGRAM","BUFFER","totalBudget","executedThisFrame","_totalBudget","_totalUsedThisFrame","_budgets","_executedThisFrame","disableThisFrame","resetBudgets","budget","job","jobType","stolenBudget","progressThisFrame","PerformanceDisplay","getElement","display","fpsElement","_fpsText","createTextNode","msElement","_msText","_lastFpsSampleTime","_lastMsSampleTime","_fpsFrameCount","_msFrameCount","_throttled","throttledElement","_throttledText","throttled","nodeValue","renderedThisFrame","updateDisplay","fpsElapsedTime","fps","msElapsedTime","ms","toFixed","PickDepth","_textureToCopy","_debugPickDepthViewportCommand","pickDepth","executeDebugPickDepth","u_texture","scratchPackedDepth","packedDepthScale","getDepth","packedDepth","numPasses","NUMBER_OF_PASSES","commands","OIT","_translucentMultipassSupport","_translucentMRTSupport","extensionsSupported","_opaqueFBO","_opaqueTexture","_accumulationTexture","_translucentFBO","_alphaFBO","_adjustTranslucentFBO","_adjustAlphaFBO","_opaqueClearCommand","_translucentMRTClearCommand","_translucentMultipassClearCommand","_alphaClearCommand","_translucentRenderStateCache","_alphaRenderStateCache","_compositeCommand","_adjustTranslucentCommand","_adjustAlphaCommand","_useHDR","oit","_revealageTexture","destroyResources","useHDR","isSupported","accumulationTexture","updateTextures","completeFBO","FRAMEBUFFER_COMPLETE","supported","status","translucentComplete","alphaComplete","adjustTranslucentComplete","adjustAlphaComplete","u_opaque","u_accumulation","u_revealage","AdjustTranslucentFS","u_bgColor","translucentMRTBlend","equationRgb","BlendEquation","ADD","equationAlpha","functionSourceRgb","BlendFunction","ONE","functionDestinationRgb","functionSourceAlpha","functionDestinationAlpha","ONE_MINUS_SOURCE_ALPHA","translucentColorBlend","translucentAlphaBlend","getTranslucentRenderState","translucentBlending","translucentState","mrtShaderSource","colorShaderSource","alphaShaderSource","getTranslucentShaderProgram","replace","createDerivedCommands","translucentShader","translucentRenderState","colorShader","colorRenderState","alphaShader","alphaRenderState","translucentCommand","getTranslucentMRTShaderProgram","alphaCommand","getTranslucentColorShaderProgram","getTranslucentColorRenderState","getTranslucentAlphaShaderProgram","getTranslucentAlphaRenderState","executeCommands","executeFunction","useHdr","_hdr","debugFramebuffer","derivedCommands","logDepth","executeTranslucentCommandsSortedMRT","executeTranslucentCommandsSortedMultipass","PickDepthFramebuffer","_passState","drawingBufferPosition","RenderbufferFormat","RGBA4","RGB5_A1","RGB565","DEPTH_COMPONENT16","STENCIL_INDEX8","validate","renderbufferFormat","Renderbuffer","format","maximumRenderbufferSize","_format","_width","_height","_renderbuffer","createRenderbuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","_getRenderbuffer","deleteRenderbuffer","PickFramebuffer","_fb","begin","screenSpaceRectangle","colorScratch","halfWidth","halfHeight","dx","dy","byteToFloat","SceneFramebuffer","_idTexture","_depthStencilRenderbuffer","_idFramebuffer","_idClearColor","post","_depthStencilIdTexture","_depthStencilIdRenderbuffer","getFramebuffer","getIdFramebuffer","ShadowMapShader","getShadowCastShaderKeyword","isPointLight","isTerrain","usesDepthTexture","isOpaque","createShadowCastVertexShader","positionVaryingName","findPositionVarying","hasPositionVarying","createShadowCastFragmentShader","opaque","fsSource","getShadowReceiveShaderKeyword","shadowMap","hasTerrainNormal","_usesDepthTexture","_polygonOffsetSupported","_isPointLight","_isSpotLight","_numberOfCascades","debugCascadeColors","softShadows","createShadowReceiveVertexShader","createShadowReceiveFragmentShader","normalVaryingName","findNormalVarying","hasNormalVarying","polygonOffsetSupported","isSpotLight","hasCascades","bias","_pointBias","_terrainBias","_primitiveBias","normalShading","normalShadingSmooth","normalOffset","ShadowMap","_enabled","_softShadows","_normalOffset","fromLightSource","darkness","_darkness","maximumDistance","_outOfView","_outOfViewPrevious","_needsUpdate","numberOfPasses","isInternetExplorer","isEdge","isChrome","isFirefox","isWindows","polygonOffset","polygonOffsetFactor","polygonOffsetUnits","normalOffsetScale","depthBias","_depthAttachment","_colorAttachment","_shadowMapMatrix","_shadowMapTexture","_lightPositionEC","_lightCamera","lightCamera","_shadowMapCamera","ShadowMapCamera","_shadowMapCullingVolume","_sceneCamera","_pointLightRadius","pointLightRadius","_cascadesEnabled","cascadesEnabled","numberOfCascades","_fitNearFar","_maximumCascadeDistances","_textureSize","_cascadeSplits","_cascadeMatrices","_cascadeDistances","_passes","ShadowPass","debugShow","debugFreezeFrame","_debugFreezeFrame","_debugCascadeColors","_debugLightFrustum","_debugCameraFrustum","_debugCascadeFrustums","_debugShadowViewCommand","_primitiveRenderState","_terrainRenderState","_pointRenderState","createRenderStates","_clearPassState","_size","size","textureOffsets","units","destroyFramebuffer","depthRenderbuffer","cubeMap","faces","createFramebufferCube","createFramebufferDepth","createFramebufferColor","updateFramebuffer","checkFramebuffer","clearFramebuffer","shadowPass","MAXIMUM_DISTANCE","debugCreateRenderStates","maximumCubeMapSize","faceViewport","maximumTextureSize","biasX","biasY","resize","shadowMapCullingVolume","scratchViewport","updateDebugShadowViewCommand","screenWidth","screenHeight","debugCommand","shadowMap_texture","shadowMap_textureCube","OVERLAY","createDebugShadowViewCommand","scratchMatrix","debugOutlineColors","GREEN","BLUE","MAGENTA","scratchScale","applyDebugSettings","enterFreezeFrame","YELLOW","uniformScale","fromTranslationQuaternionRotationScale","box","createDebugPointLight","viewProjectionMatrix","scaleBiasMatrix","getViewProjection","scratchFrustum","scratchCascadeDistances","scratchLightView","scratchUp","scratchTranslation","ups","rights","scratchBoundingSphere","scratchCenter","updateCameras","sceneCamera","shadowMapCamera","lightDirection","darknessAmount","frustumRadius","frustumCenter","checkVisibility","computeOmnidirectional","lightDir","lightUp","lightRight","lightPosition","lightView","cameraToLight","minimumByComponent","maximumByComponent","translationMatrix","fitShadowMapToScene","cameraNear","cameraFar","lambda","clampCascadeDistances","cascadeDistances","splits","logScale","split","shadowFrustum","cascadeSubFrustum","shadowViewProjection","shadowMapMatrix","cascadeCamera","cascadeMatrix","computeCascades","CullingVolume","scratchTexelStepSize","combineUniforms","mapUniforms","shadowMap_matrix","shadowMap_cascadeSplits","shadowMap_cascadeMatrices","shadowMap_lightDirectionEC","shadowMap_lightPositionEC","shadowMap_cascadeDistances","shadowMap_texelSizeDepthBiasAndNormalShadingSmooth","texelStepSize","combinedUniforms1","shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness","combinedUniforms2","createCastDerivedCommand","shadowsDirty","oldShaderId","castShader","castRenderState","castUniformMap","castVS","castFS","createReceiveDerivedCommand","lightShadowMapsEnabled","receiveShader","receiveUniformMap","receiveCommand","castShadowsDirty","receiveShaderCastShadows","shaderDirty","receiveShaderProgramId","receiveVS","receiveFS","castCommands","castShaderProgramId","shadowMapLength","View","frustumCommandsList","farToNearRatio","logarithmicDepthBuffer","logarithmicDepthFarToNearRatio","updateFrustums","_useOIT","_cameraClone","_cameraStartFired","_cameraMovedTime","pickFramebuffer","pickDepthFramebuffer","sceneFramebuffer","pickDepths","debugGlobeDepths","debugFrustumStatistics","scratchPosition0","scratchPosition1","cameraEqual","camera0","camera1","is2D","nearToFarDistance2D","curNear","curFar","frustumCommands","insertIntoBin","debugShowFrustums","debugOverlappingFrustums","cf","commandsInFrustums","totalCommands","updateDerivedCommands","checkForCameraUpdates","cameraClone","EPSILON15","cameraEventWaitTime","scratchCullingVolume","distances","Interval","createPotentiallyVisibleSet","computeList","_computeCommandList","overlayList","_overlayCommandList","numberOfFrustums","undefBV","shadowNear","shadowFar","shadowClosestObjectSize","planes","COMPUTE","computePlaneDistances","offscreenDefaultWidth","mostDetailedPreloadTilesetPassState","Cesium3DTilePass","MOST_DETAILED_PRELOAD","mostDetailedPickTilesetPassState","MOST_DETAILED_PICK","pickTilesetPassState","PICK","Picking","_mostDetailedRayPicks","_pickPositionCache","_pickPositionCacheDirty","pickOffscreenViewport","pickOffscreenCamera","_pickOffscreenView","getPickDepth","scratchOrthoPickingFrustum","scratchOrthoOrigin","scratchOrthoDirection","scratchOrthoPixelSize","scratchOrthoPickVolumeMatrix4","scratchPerspPickingFrustum","scratchPerspPixelSize","getPickCullingVolume","ortho","getPickOrthographicCullingVolume","pickWidth","pickHeight","offCenter","getPickPerspectiveCullingVolume","scratchRectangleWidth","scratchRectangleHeight","scratchRectangle","scratchColorZero","defaultView","transformWindowToDrawingBuffer","updateFrameState","updateEnvironment","updateAndExecuteCommands","resolveFramebuffers","scratchPerspectiveFrustum","scratchPerspectiveOffCenterFrustum","scratchOrthographicFrustum","scratchOrthographicOffCenterFrustum","useDepthPicking","cacheKey","pickTranslucentDepth","environmentState","clearPasses","renderTranslucentDepthForPick","height2D","renderedFrustum","opaqueFrustumNearOffset","drawingBufferToWgs84Coordinates","scratchPickPositionCartographic","limit","pickCallback","pickedPrimitives","pickedAttributes","pickedResult","exclude","hasShowAttribute","getGeometryInstanceAttributes","ShowGeometryInstanceAttribute","toValue","Cesium3DTileFeature","element","MostDetailedRayPick","tilesets","updateOffscreenCameraFromRay","orthogonalAxis","mostOrthogonalAxis","updateMostDetailedRayPick","rayPick","tilesetsLength","tileset","launchMostDetailedRayPick","objectsToExclude","getTilesets","isCesium3DTileset","isExcluded","getRayIntersections","requirePosition","mostDetailed","getRayIntersection","pickFromRay","drillPickFromRay","deferPromiseUntilPostRender","requestRender","updateMostDetailedRayPicks","rayPicks","pickFromRayMostDetailed","drillPickFromRayMostDetailed","scratchSurfacePosition","scratchSurfaceNormal","scratchSurfaceRay","getRayForSampleHeight","ApproximateTerrainHeights","_defaultMaxTerrainHeight","surfacePosition","toCartesian","surfaceRay","getRayForClampToHeight","getHeightFromCartesian","sampleHeightMostDetailed","pickResult","clampToHeightMostDetailed","sampleHeight","clampToHeight","cartesians","clampedCartesians","AutoExposure","_ready","_name","_logDepthChanged","_framebuffers","_previousLuminance","_commands","_minMaxLuminance","minimumLuminance","maximumLuminance","autoexposure","framebuffers","destroyCommands","createUniformMap","colorTextureDimensions","minMaxLuminance","previousLuminance","getShaderSource","lastTexture","createCommands","PostProcessStage","fragmentShader","textureScale","_fragmentShader","_textureScale","_forcePowerOfTwo","forcePowerOfTwo","_sampleMode","sampleMode","_pixelFormat","_pixelDatatype","BLACK","_actualUniforms","_dirtyUniforms","_texturesToCreate","_texturePromise","scissorRectangle","_selectedIdTexture","_selected","_selectedShadow","_parentSelected","_parentSelectedShadow","_combinedSelected","_combinedSelectedShadow","_selectedLength","_parentSelectedLength","_selectedDirty","_index","selected","parentSelected","depthTextureRegex","getUniformValueGetterAndSetter","stage","currentValue","HTMLCanvasElement","HTMLImageElement","HTMLVideoElement","ImageData","actualUniforms","actualValue","getStageByName","getUniformMapFunction","getUniformMapDimensionsFunction","createLoadImageFunction","createStageOutputTextureFunction","getOutputTexture","releaseResources","_isSupported","parentLength","isSelectedTextureDirty","textureLength","pickIds","empty","ids","pickIdsLength","floatToByte","createSelectedTexture","newUniforms","depthTextureDimensions","czm_idTexture","czm_selectedIdTexture","czm_selectedIdTextureStep","texturesToCreate","textureToCreate","dirtyUniforms","stageNameUrlOrImage","stageWithName","resource","updateUniformTextures","createDrawCommand","minFilter","magFilter","_sampler","createSampler","idTexture","PostProcessStageComposite","_stages","stages","_inputPreviousStageTexture","inputPreviousStageTexture","PostProcessStageLibrary","createBlur","blurShader","GaussianBlur1D","blurX","sigma","stepSize","blurY","blurXUniforms","blurYUniforms","createBlurStage","createDepthOfFieldStage","blur","dof","focalDistance","blurTexture","isDepthOfFieldSupported","createEdgeDetectionStage","isEdgeDetectionSupported","createSilhouetteStage","edgeDetectionStages","edgeDetection","compositeUniforms","fsDecl","fsLoop","edgeComposite","getSilhouetteEdgeDetection","silhouetteProcess","silhouetteTexture","isSilhouetteSupported","createBloomStage","contrastBias","generateComposite","bloomComposite","glowOnly","bloomTexture","createAmbientOcclusionStage","generate","lengthCap","frustumLength","randomTexture","generateAndBlur","ambientOcclusionModulate","ambientOcclusionOnly","ambientOcclusionTexture","blurStepSize","isAmbientOcclusionSupported","createFXAAStage","createAcesTonemappingStage","useAutoExposure","autoExposure","createFilmicTonemappingStage","createReinhardTonemappingStage","createModifiedReinhardTonemappingStage","white","createAutoExposureStage","createBlackAndWhiteStage","gradations","createBrightnessStage","createNightVisionStage","createDepthViewStage","createLensFlareStage","dirtTexture","starTexture","distortion","ghostDispersal","haloWidth","dirtAmount","earthRadius","PostProcessStageTextureCache","postProcessStageCollection","_collection","_stageNameToFramebuffer","_updateDependencies","getLastStageName","getStageDependencies","dependencies","previousName","stageDependencies","uniformNames","getOwnPropertyNames","uniformNamesLength","dependent","getCompositeDependencies","composite","originalDependency","inSeries","currentName","currentDependencies","stageName","stageNames","stagesLength","foundConflict","ambientOcclusion","ao","bloom","tonemapping","_tonemapping","fxaa","getDependencies","updateDependencies","aoEnabled","bloomEnabled","tonemappingEnabled","fxaaEnabled","needsCheckDimensionsUpdate","_activeStages","dimensionsChanged","textureWidth","textureHeight","isPowerOfTwo","nextPowerOfTwo","Tonemapper","REINHARD","MODIFIED_REINHARD","FILMIC","ACES","tonemapper","stackScratch","PostProcessStageCollection","_autoExposureEnabled","_autoExposure","_tonemapper","_previousActiveStages","_randomTexture","_ao","_bloom","_fxaa","_lastLength","_aoEnabled","_bloomEnabled","_tonemappingEnabled","_fxaaEnabled","_stagesRemoved","_textureCacheDirty","_stageNames","removeStages","newStages","readyAndEnabled","hasSelected","arraySlice","currentStage","previousActiveStages","activeStages","activeStagesChanged","random","RGB","REPEAT","autoExposureEnabled","initialTexture","copy","SceneTransitioner","_currentTweens","_morphHandler","_morphCancelled","_completeMorph","_morphToOrthographic","morphTo2D","_previousMode","morphStart","transitioner","startPos","scratchCVTo2DStartPos","startDir","scratchCVTo2DStartDir","startUp","scratchCVTo2DStartUp","endDir","scratchCVTo2DEndDir","endUp","scratchCVTo2DEndUp","endPos","scratchCVTo2DEndPos","scratchCVTo2DRay","pickPos","scratchCVTo2DPickPos","scratchCVTo2DFrustum","camera2D","scratchCVTo2DCamera","complete2DCallback","createMorphHandler","tween","QUARTIC_OUT","columbusViewMorph","morphPerspectiveToOrthographic","morphFromColumbusViewTo2D","scratch3DTo2DCamera","scratch3DTo2DCartographic","scratch3DTo2DRay","rayDirection","surfacePoint","scratch3DTo2DSurfacePoint","toENU","scratch3DTo2DToENU","pickedPos","scratch3DTo2DPickPosition","endCamera","scratch3DTo2DEndCamera","morphFrom3DToColumbusView","morphFrom3DTo2D","scratchToCVPosition","scratchToCVDirection","scratchToCVUp","scratchToCVPosition2D","scratchToCVDirection2D","scratchToCVUp2D","scratchToCVSurfacePosition","scratchToCVCartographic","scratchToCVToENU","scratchToCVFrustumPerspective","scratchToCVFrustumOrthographic","scratchToCVCamera","morphToColumbusView","cameraCV","destroyMorphHandler","_previousModeMode","wasMorphing","morphComplete","completeColumbusViewCallback","scratch3DToCVEndPos","scratch3DToCVEndDir","scratch3DToCVEndUp","morph","scratch3DToCVStartPos","scratch3DToCVStartDir","scratch3DToCVStartUp","morphOrthographicToPerspective","morphFrom2DToColumbusView","scratchCVTo3DCamera","scratch2DTo3DFrustumPersp","completeMorphFunction","completeMorphOnUserInput","ScreenSpaceEventHandler","LEFT_DOWN","MIDDLE_DOWN","RIGHT_DOWN","WHEEL","morphTo3D","camera3D","getColumbusViewTo3DCamera","scratch2DTo3DFrustumOrtho","complete3DCallback","morphFromColumbusViewTo3D","morphFrom2DTo3D","scratchCVTo3DCartographic","scratchCVTo3DSurfacePoint","scratchCVTo3DFromENU","positionCarto","fromENU","scratchCVTo3DStartPos","scratchCVTo3DStartDir","scratchCVTo3DStartUp","scratchCVTo3DEndPos","scratchCVTo3DEndDir","scratchCVTo3DEndUp","addMorphTimeAnimations","startPosition","endPosition","startFOV","endFOV","startValue","stopValue","addProperty","LEFT_DRAG","RIGHT_DRAG","MIDDLE_DRAG","PINCH","getKey","modifier","listenToPinch","aggregator","isDown","_isDown","eventStartPosition","_eventStartPosition","pressTime","_pressTime","releaseTime","_releaseTime","movement","_movement","angleAndHeight","prevAngle","_eventHandler","_buttonsDown","Date","position1","position2","PINCH_START","PINCH_END","mouseMovement","pinchMovement","TwoPI","PINCH_MOVE","listenToWheel","arcLength","listenMouseButtonDownUp","down","lastMovement","_lastMovement","valid","LEFT_UP","RIGHT_UP","MIDDLE_UP","cloneMouseMovement","listenMouseMove","typeName","_currentMousePosition","MOUSE_MOVE","CameraEventAggregator","modifierName","KeyboardEventModifier","currentMousePosition","anyButtonDown","wheelMoved","SHIFT","CTRL","ALT","isMoving","getMovement","getLastMovement","isButtonDown","getStartMousePosition","getButtonPressTime","getButtonReleaseTime","reset","ScreenSpaceCameraController","enableTranslate","enableZoom","enableRotate","enableTilt","enableLook","inertiaSpin","inertiaTranslate","inertiaZoom","maximumMovementRatio","bounceAnimationTime","translateEventTypes","zoomEventTypes","rotateEventTypes","tiltEventTypes","eventType","lookEventTypes","minimumPickingTerrainHeight","_minimumPickingTerrainHeight","minimumCollisionTerrainHeight","_minimumCollisionTerrainHeight","minimumTrackBallHeight","_minimumTrackBallHeight","enableCollisionDetection","_globe","_aggregator","_lastInertiaSpinMovement","_lastInertiaZoomMovement","_lastInertiaTranslateMovement","_lastInertiaTiltMovement","TweenCollection","_tween","_horizontalRotationAxis","_tiltCenterMousePosition","_tiltCenter","_rotateMousePosition","_rotateStartPosition","_strafeStartPosition","_zoomMouseStart","_zoomWorldPosition","_useZoomWorldPosition","_tiltCVOffMap","_looking","_rotating","_strafing","_zoomingOnVector","_rotatingZoom","_adjustedHeightForTerrain","_zoomFactor","_rotateFactor","_rotateRateRangeAdjustment","_maximumRotateRate","_minimumRotateRate","_minimumZoomRate","_maximumZoomRate","inertiaMaxClickTimeThreshold","maintainInertia","decayCoef","action","lastMovementName","movementState","motion","active","ts","tr","threshold","getTime","fromNow","coefficient","tau","exp","decay","EPSILON14","isNaN","scratchEventTypeArray","reactToInput","controller","eventTypes","inertiaConstant","inertiaStateName","scratchZoomPickRay","scratchPickCartesian","scratchZoomOffset","scratchZoomDirection","scratchCenterPixel","scratchCenterPosition","scratchPickNormal","scratchZoomAxis","scratchCameraPositionNormal","scratchTargetNormal","scratchCameraPosition","scratchCameraUpNormal","scratchCameraRightNormal","scratchForwardNormal","scratchPositionToTarget","scratchPositionToTargetNormal","scratchPan","scratchCenterMovement","scratchCartesianTwo","scratchCartesianThree","scratchZoomViewOptions","handleZoom","zoomFactor","distanceMeasure","unitPositionDotDirection","percentage","minHeight","maxHeight","zoomRate","rangeWindowRatio","sameStartPosition","zoomingOnVector","rotatingZoom","pickGlobe","zoomOnVector","worldPosition","savedX","cameraPositionNormal","centerPixel","centerPosition","targetNormal","forward","positionToTarget","positionToTargetNormal","alphaDot","targetDistance","remainingDistance","positionToTargetDistance","pMid","cMid","pickedNormal","dotProduct","zoomMouseStart","translate2DStart","translate2DEnd","scratchTranslateP0","translate2D","twist2DStart","twist2DEnd","twist2D","rotateRate","phiWindowRatio","deltaPhi","singleAxisTwist2D","startTheta","endTheta","theta","translateCVStartRay","translateCVEndRay","translateCVStartPos","translateCVEndPos","translatCVDifference","translateCVOrigin","translateCVPlane","Plane","translateCVStartMouse","translateCVEndMouse","translateCV","_translateMousePosition","_strafeMousePosition","look3D","strafe","globePos","startMouse","endMouse","startRay","plane","fromPointNormal","startPlanePos","rayPlane","endRay","endPlanePos","rotateCVWindowPos","rotateCVWindowRay","rotateCVCenter","rotateCVVerticalCenter","rotateCVTransform","rotateCVVerticalTransform","rotateCVOrigin","rotateCVPlane","rotateCVCartesian3","rotateCVCart","rotateCVOldTransform","rotateCVQuaternion","rotateCVMatrix","tilt3DCartesian3","rotateCV","onMap","normalDotDirection","oldGlobe","oldEllipsoid","UNIT_SPHERE","rotate3D","rotateCVOnPlane","verticalCenter","verticalTransform","oldConstrainedAxis","originalPosition","adjustHeightForTerrain","magSqrd","angleBetween","rotateCVOnTerrain","zoomCVWindowPos","zoomCVWindowRay","zoomCVIntersection","zoomCV","scratchStrafeRay","scratchStrafePlane","scratchStrafeIntersection","scratchStrafeDirection","scratchMousePos","mouseStartPosition","spin3DPick","scratchEllipsoid","scratchLookUp","spin3D","mousePos","pan3D","rotateOnlyVertical","rotateOnlyHorizontal","oldAxis","rho","thetaWindowRatio","deltaTheta","pan3DP0","UNIT_W","pan3DP1","pan3DTemp0","pan3DTemp1","pan3DTemp2","pan3DTemp3","pan3DStartMousePosition","pan3DEndMousePosition","startMousePosition","endMousePosition","p0","p1","basis0","basis1","basis2","startRho","startDot","startRej","endRho","endDot","endRej","startPhi","endPhi","planeNormal","side0","side1","zoom3DUnitPosition","zoom3DCartographic","unitPosition","tilt3DWindowPos","tilt3DRay","tilt3DCenter","tilt3DVerticalCenter","tilt3DTransform","tilt3DVerticalTransform","tilt3DOldTransform","tilt3DQuaternion","tilt3DMatrix","tilt3DCart","tilt3DLookUp","tilt3D","_tiltOnEllipsoid","tilt3DOnEllipsoidCartographic","grazingAltitudeLocation","grazingAltitudeCart","tilt3DOnEllipsoid","newEllipsoid","tilt3DOnTerrain","look3DStartPos","look3DEndPos","look3DStartRay","look3DEndRay","look3DNegativeRot","look3DTan","rotationAxis","horizontalRotationAxis","negativeRotationAxis","scratchAdjustHeightTransform","scratchAdjustHeightCartographic","heightUpdated","scratchPreviousPosition","scratchPreviousDirection","previousPosition","previousDirection","update3D","adjustedHeightForTerrain","SunPostProcess","_sceneFramebuffer","brightPass","BrightPass","avgLuminance","_delta","_sigma","_blurStep","step","_uCenter","_uRadius","AdditiveBlend","colorTexture2","sunPositionECScratch","sunPositionWCScratch","sizeScratch","postProcessMatrix4Scratch","sunPosition","sunPositionEC","pointToGLWindowCoordinates","SOLAR_RADIUS","limbWC","sunSize","firstStage","downSampleWidth","downSampleHeight","downSampleViewport","updateSunPosition","requestRenderAfterFrame","Scene","creditContainer","creditViewport","contextOptions","powerPreference","hasCreditContainer","_jobScheduler","CreditDisplay","_removeCreditContainer","_creditContainer","_computeEngine","_groundPrimitives","_logDepthBuffer","_logDepthBufferDirty","_shaderFrameCount","_sunPostProcess","orderIndependentTranslucency","_executeOITFunction","_depthPlane","_depthClearCommand","_stencilClearCommand","_classificationStencilClearCommand","_transitioner","_preUpdate","_postUpdate","_renderError","_preRender","_postRender","rethrowRenderErrors","skyBox","skyAtmosphere","sun","sunBloom","_sunBloom","moon","GeographicProjection","debugCommandFilter","debugShowCommands","debugShowFramesPerSecond","debugShowGlobeDepth","debugShowDepthFrustum","debugShowFrustumPlanes","_debugShowFrustumPlanes","_debugFrustumPlanes","_actualInvertClassificationColor","_invertClassification","focalLength","eyeSeparation","postProcessStages","_brdfLutGenerator","_terrainExaggeration","_performanceDisplay","_debugVolume","_screenSpaceCameraController","_cameraUnderground","_mapMode2D","_environmentState","skyBoxCommand","skyAtmosphereCommand","sunDrawCommand","sunComputeCommand","moonCommand","isSunVisible","isMoonVisible","isReadyForAtmosphere","isSkyAtmosphereVisible","useDepthPlane","originalFramebuffer","useGlobeDepthFramebuffer","separatePrimitiveFramebuffer","useOIT","useInvertClassification","usePostProcess","usePostProcessSelected","useWebVR","_useWebVR","_cameraVR","_aspectRatioVR","requestRenderMode","_renderRequested","maximumRenderTimeChange","_lastRenderTime","_frameRateMonitor","_removeRequestListenerCallback","RequestScheduler","requestCompletedEvent","_removeTaskProcessorListenerCallback","taskCompletedEvent","_removeGlobeCallbacks","_picking","_defaultView","_hdrDirty","highDynamicRange","_specularEnvironmentMapAtlas","updateFrameNumber","initializeFrame","scratchSunColor","originalCommand","maximumAliasedLineWidth","sampleHeightSupported","clampToHeightSupported","invertClassificationSupported","specularEnvironmentMapsSupported","OctahedralProjectedCubeMap","removeGlobeCallbacks","updateGlobeListeners","groundPrimitives","preUpdate","postUpdate","preRender","lastRenderTime","visibility","_deviceOrientationCameraController","xOffset","highDynamicRangeSupported","sunColor","deprecationWarning","getCompressedTextureFormatSupported","hasLogDepthDerivedCommands","hasHdrCommands","hasDerivedCommands","needsLogDepthDerivedCommands","needsHdrCommands","needsDerivedCommands","scratchOccluder","renderTilesetPassState","RENDER","preloadTilesetPassState","PRELOAD","preloadFlightTilesetPassState","PRELOAD_FLIGHT","requestRenderModeDeferCheckPassState","REQUEST_RENDER_MODE_DEFER_CHECK","scratchOccluderBoundingSphere","executeDebugCommand","sp","targets","re","exec","_debugColor","fromRandom","vertexAttributes","createDebugFragmentShaderProgram","_cubeMap","getOccluder","maximumMipmapLevel","occlude","isOccluded","transformFrom2D","executeCommand","FLAT_VERTEX_FORMAT","executeIdCommand","backToFront","frontToBack","EPSILON12","executeTranslucentCommandsBackToFront","executeTranslucentCommandsFrontToBack","getDebugGlobeDepth","globeDepths","ENVIRONMENT","executeTranslucentCommands","clearClassificationStencil","depthPlane","fb","TERRAIN_CLASSIFICATION","CESIUM_3D_TILE","CESIUM_3D_TILE_CLASSIFICATION","opaqueClassificationFramebuffer","CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW","executeComputeCommands","insertShadowCastCommands","shadowVolume","wasVisible","cascadeVolume","executeShadowMapCastCommands","numberOfCommands","scratchEyeTranslation","updateAndClearFramebuffers","updateAndRenderPrimitives","savedCamera","fo","eyeTranslation","executeWebVRCommands","executeCommandsInViewport","originalViewport","scratch2DViewport","maxCartographic","scratch2DViewportCartographic","maxCoord","scratch2DViewportMaxCoord","scratch2DViewportSavedPosition","scratch2DViewportCameraTransform","scratch2DViewportTransform","eyePoint","sign","scratch2DViewportEyePoint","windowCoordinates","scratch2DViewportWindowCoords","viewportX","viewportWidth","execute2DViewportCommands","firstViewport","updateDebugFrustumPlanes","updateShadowMaps","depthFramebuffer","renderPass","offscreenPass","setDynamicAtmosphereColor","sunCommands","envMaps","envMapAtlas","globeFramebuffer","idFramebuffer","inputFramebuffer","debugShowPickDepth","cameraController","globeHeight","isCameraUnderground","scratchBackgroundColor","executeOverlayCommands","tryAndCatchError","functionToExecute","updatePreloadPass","updatePreloadFlightPass","updateRequestRenderModeDeferCheckPass","cameraChanged","shouldRender","difference","secondsDifference","incrementWrap","performanceContainer","performanceDisplay","_performanceContainer","updateDebugShowFramesPerSecond","functions","callAfterRenderFunctions","forceRender","clampLineWidth","minimumAliasedLineWidth","cartesianToCanvasCoordinates","_debugSphere","SkyAtmosphere","_spSkyFromSpace","_spSkyFromAtmosphere","_spSkyFromSpaceColorCorrect","_spSkyFromAtmosphereColorCorrect","_splitDirection","_hueSaturationBrightness","cameraAndRadiiAndDynamicAtmosphereColor","_cameraAndRadiiAndDynamicAtmosphereColor","u_cameraAndRadiiAndDynamicAtmosphereColor","u_splitDirection","useSunDirection","createAttributeLocations","SkyAtmosphereVS","SkyAtmosphereFS","useColorCorrect","contextColorCorrect","vsColorCorrect","fsColorCorrect","urls","flipOptions","preferImageBitmap","facePromises","createIfNeeded","images","SkyBox","_sources","u_cubeMap","Sun","_boundingVolume","_boundingVolume2D","_drawingBufferWidth","_drawingBufferHeight","_radiusTS","glowFactor","_glowFactorDirty","u_size","_glowFactor","scratchPositionWC","scratchLimbWC","scratchPositionEC","_glowLengthTS","u_radiusTS","directions","UNSIGNED_SHORT","sunPositionCV","boundingVolume2D","computeActualWgs84Position","dist","projMatrix","positionEC","positionCC","clipToGLWindowCoordinates","limbCC","getDefaultSkyBoxUrl","suffix","configurePixelRatio","widget","_useBrowserRecommendedResolution","devicePixelRatio","_resolutionScale","configureCanvasSize","_canvasClientWidth","_canvasClientHeight","_canRender","_lastDevicePixelRatio","configureCameraFrustum","CesiumWidget","supportsImageRenderingPixelated","blurActiveElement","ownerDocument","activeElement","_supportsImageRenderingPixelated","imageRendering","imageRenderingValue","oncontextmenu","onselectstart","innerCreditContainer","showRenderLoopErrors","useBrowserRecommendedResolution","_element","_creditViewport","_innerCreditContainer","_renderLoopRunning","_showRenderLoopErrors","_forceResize","_clock","Clock","terrainShadows","_screenSpaceEventHandler","_useDefaultRenderLoop","_targetFrameRate","targetFrameRate","showErrorPanel","lastFrameTime","requestAnimationFrame","frameTime","startRenderLoop","resolutionScale","overlay","content","errorHeader","errorPanelScroller","resizeCallback","errorMessage","innerHTML","errorDetails","errorMessageDetails","buttonPanel","okButton","onclick","forceResize","_lastWidth","tick","OrderedGroundPrimitiveCollection","_length","_collections","_collectionsArray","zIndex","doNotDestroy","collections","defaultColor","defaultEyeOffset","defaultHeightReference","HeightReference","defaultPixelOffset","defaultAlignedAxis","defaultHorizontalOrigin","HorizontalOrigin","CENTER","defaultVerticalOrigin","VerticalOrigin","positionScratch","eyeOffsetScratch","pixelOffsetScratch","scaleByDistanceScratch","NearFarScalar","translucencyByDistanceScratch","pixelOffsetScaleByDistanceScratch","boundingRectangleScratch","distanceDisplayConditionScratch","DistanceDisplayCondition","EntityData","entity","billboard","textureValue","BillboardVisualizer","entityCluster","_cluster","_entityCollection","_items","AssociativeArray","returnPrimitive","cluster","removeBillboard","billboardGraphics","_billboard","isShowing","isAvailable","Property","getValueOrDefault","getValueOrUndefined","_image","_clusterDirty","getBillboard","eyeOffset","_eyeOffset","heightReference","_heightReference","pixelOffset","_pixelOffset","_scale","_rotation","alignedAxis","_alignedAxis","horizontalOrigin","_horizontalOrigin","verticalOrigin","_verticalOrigin","scaleByDistance","_scaleByDistance","translucencyByDistance","_translucencyByDistance","pixelOffsetScaleByDistance","_pixelOffsetScaleByDistance","sizeInMeters","_sizeInMeters","distanceDisplayCondition","_distanceDisplayCondition","disableDepthTestDistance","_disableDepthTestDistance","subRegion","_imageSubRegion","setImageSubRegion","_imageId","_clampedPosition","MaterialAppearance","closed","materialSupport","MaterialSupport","TEXTURED","_vertexShaderSource","_fragmentShaderSource","Appearance","getDefaultRenderState","_closed","_materialSupport","_flat","_faceForward","faceForward","getFragmentShaderSource","getRenderState","BASIC","freeze","POSITION_AND_NORMAL","POSITION_NORMAL_AND_ST","ALL","DistanceDisplayConditionGeometryInstanceAttribute","fromDistanceDisplayCondition","MaterialProperty","throwInstantiationError","materialProperty","DynamicGeometryUpdater","geometryUpdater","orderedGroundPrimitives","_orderedGroundPrimitives","_primitive","_outlinePrimitive","_geometryUpdater","_options","_entity","_isHidden","_setOptions","onTerrain","_onTerrain","_geometryPropertyName","shadowsProperty","fillMaterialProperty","isColorAppearance","ColorMaterialProperty","_getIsClosed","_supportsMaterialsforEntitiesOnTerrain","VERTEX_FORMAT","GroundPrimitive","createFillGeometryInstance","classificationType","classificationTypeProperty","fillInstance","outline","outlineInstance","createOutlineGeometryInstance","outlineWidth","lineWidth","outlinePrimitive","defaultMaterial","defaultShow","ConstantProperty","defaultFill","defaultOutline","defaultOutlineColor","defaultShadows","DISABLED","defaultDistanceDisplayCondition","defaultClassificationType","ClassificationType","BOTH","GeometryUpdater","geometryPropertyName","_fillEnabled","_isClosed","_dynamic","_outlineEnabled","_geometryChanged","_showProperty","_materialProperty","_showOutlineProperty","_outlineColorProperty","_outlineWidth","_shadowsProperty","_distanceDisplayConditionProperty","_classificationTypeProperty","geometryOptions","_observedPropertyNames","observedPropertyNames","supportsMaterialsforEntitiesOnTerrain","fillEnabled","hasConstantFill","availability","_fillProperty","outlineEnabled","hasConstantOutline","outlineColorProperty","distanceDisplayConditionProperty","isDynamic","isClosed","geometryChanged","isOutlineVisible","visible","isFilled","Iso8601","MINIMUM_VALUE","_isOnTerrain","_isDynamic","_setStaticOptions","_onEntityPropertyChanged","newValue","fillProperty","outlineProperty","outlineColor","oneTimeWarning","geometryOutlines","createDynamicUpdater","constructor","scratchCarto","TerrainOffsetProperty","positionProperty","heightReferenceProperty","extrudedHeightReferenceProperty","_extrudedHeightReference","_positionProperty","_cartographicPosition","_terrainHeight","_removeCallbackFunc","_removeEventListener","_removeModeListener","_updateClamping","cartographicPosition","clampedPosition","extrudedHeightReference","RELATIVE_TO_GROUND","_terrainOffsetProperty","CallbackProperty","_computeCenter","defaultOffset","offsetScratch","BoxGeometryOptions","BoxGeometryUpdater","DynamicBoxGeometryUpdater","terrainOffsetProperty","currentColor","OffsetGeometryInstanceAttribute","computeModelMatrixForHeightReference","GeometryOffsetAttribute","scratch2Array","scratchCartesian5","scratchCartesian6","scratchCartesian7","scratchCartesian8","scratchCartesian9","scratch1","scratch2","PolylineVolumeGeometryLibrary","subdivideHeights","points","h0","h1","granularity","numPoints","heightPerVertex","h","nextScratch","prevScratch","rotationZ","scaleMatrix","westScratch","finalPosScratch","heightCartesian","addPosition","shape","finalPositions","xScalar","repeat","finalPosition","tangentPlane","EllipsoidTangentPlane","projectPointOntoPlane","prev","computeRotationAngle","fromRotationZ","addPositions","centers","convertShapeTo3D","shape2D","boundingRectangle","yOffset","quaterion","startPointScratch","computeRoundCorner","pivot","startPoint","endPoint","cornerType","leftIsOutside","duplicatePoints","CornerType","removeDuplicatesFromShape","shapePositions","cleanedPositions","angleIsGreaterThanPi","backward","scratchForwardProjection","scratchBackwardProjection","computePositions","scaleToSurface","_granularity","_cornerType","shapeForSides","point","convertShapeTo3DDuplicate","shapeForEnds","ends","cornerDirection","nextPosition","subdividedHeights","forwardProjection","backwardProjection","PolylinePipeline","generateArc","posLength","combinedPositions","CorridorGeometryLibrary","scratch3","scratch4","scaleArray2","cartesian1","cartesian2","cartesian3","cartesian4","cartesian5","cartesian6","cartesian7","cartesian8","cartesian9","cartesian10","cornerPoint","computeMiteredCorner","leftCornerDirection","lastPoint","addShiftedPositions","calculatedPositions","rightPositions","leftPositions","scaledLeft","scaledRight","rightIndex","leftIndex","rightPos","leftPos","addAttribute","attribute","front","back","params","saveAttributes","previousPos","calculatedLefts","calculatedNormals","endPositions","corners","leftEdge","firstEndCap","midpoint","rightEdge","addEndCaps","lefts","addNormals","attr","computedPositions","computedLefts","computedNormals","leftCount","rightCount","leftSide","endPositionLength","addEndPositions","UL","LL","UR","LR","halfLength","firstEndPositions","rightNormal","leftNormal","posIndex","compIndex","outsidePoint","previousPoint","nextPoint","lastEndPositions","rightSt","leftSt","halfEndPos","addWallPositions","wallPositions","computePositionsExtruded","topVertexFormat","extrudedHeight","newPositions","extrudedPositions","PolygonPipeline","scaleToGeodeticHeight","topNormals","topBitangents","threeSize","twoSize","sixSize","topPosition","bottomPosition","attrIndex","attrIndexOffset","topTangents","topSt","extrudedAttributes","extrudeNormals","extrudeDirection","TOP","arrayFill","applyOffsetValue","iLength","newIndices","computeOffsetPoints","offsetDirection","minLat","minLon","maxLat","maxLon","scratchCartesianOffset","scratchCartesianEnds","scratchCartographicMin","scratchCartographicMax","computeRectangle","cleanPositions","arrayRemoveDuplicates","NEGATIVE_INFINITY","last","CorridorGeometry","_positions","_extrudedHeight","_shadowVolume","corridorGeometry","extrude","createShadowVolume","minHeightFunc","maxHeightFunc","textureCoordinateRotationPoints","wallIndices","CorridorOutlineGeometry","corridorOutlineGeometry","defaultZIndex","GroundGeometryUpdater","geometryZIndex","getGeometryHeight","CLAMP_TO_GROUND","geometryHeightReference","getGeometryExtrudedHeight","geometryExtrudedHeightReference","computeGeometryOffsetAttribute","CorridorGeometryOptions","CorridorGeometryUpdater","corridor","DynamicCorridorGeometryUpdater","heightValue","heightReferenceValue","extrudedHeightValue","extrudedHeightReferenceValue","getMinimumMaximumHeights","CylinderGeometryLibrary","topRadius","bottomRadius","slices","topZ","bottomZ","twoSlice","tbIndex","bottomX","topX","radiusScratch","bitangentScratch","tangentScratch","CylinderGeometry","_topRadius","_bottomRadius","_slices","unitCylinderGeometry","cylinderGeometry","twoSlices","threeSlices","numVertices","computeNormal","computeTangent","normalScale","textureCoordIndex","rad","getUnitCylinder","CylinderOutlineGeometry","numberOfVerticalLines","_numberOfVerticalLines","numSide","numSideLines","CylinderGeometryOptions","CylinderGeometryUpdater","cylinder","DynamicCylinderGeometryUpdater","DynamicGeometryBatch","_dynamicUpdaters","updater","dynamicUpdater","geometries","removeAllPrimitives","EllipseGeometryLibrary","rotAxis","unitQuat","pointOnEllipsoid","northVec","eastVec","aSqr","ab","bSqr","unitPos","azimuth","cosThetaSquared","sinThetaSquared","raisePositionsToHeight","extrudedPosition","scaledNormal","unitPosScratch","eastVecScratch","northVecScratch","computeEllipsePositions","addFillPositions","addEdgePositions","semiMinorAxis","semiMajorAxis","numPts","numInterior","interiorPosition","positionIndex","reflectedPosition","outerPositionsLength","outerRightIndex","outerLeftIndex","outerPositions","texCoordScratch","textureMatrixScratch","tangentMatrixScratch","quaternionScratch","projectedCenterScratch","scratchMinTexCoord","scratchMaxTexCoord","computeTopBottomAttributes","stRotation","projectedCenter","geodeticNormal","textureMatrix","tangentMatrix","minTexCoord","maxTexCoord","rotatedPoint","projectedPoint","topIndices","prevIndex","indicesIndex","boundingSphereCenter","topBoundingSphere","bottomBoundingSphere","computeExtrudedEllipse","cep","topBottomAttributes","topBottomIndices","topBottomGeo","wallAttributes","computeWallAttributes","computeWallIndices","wallGeo","geo","combineInstances","positionsFlat","positionsCount","fromCartesianArray","EllipseGeometry","_semiMajorAxis","_semiMinorAxis","_stRotation","_textureCoordinateRotationPoints","ellipseGeometry","computeEllipse","EllipseOutlineGeometry","maxI","EllipseGeometryOptions","EllipseGeometryUpdater","ellipse","DynamicEllipseGeometryUpdater","radiiScratch","innerRadiiScratch","unitSphere","EllipsoidGeometryOptions","subdivisions","EllipsoidGeometryUpdater","DynamicEllipsoidGeometryUpdater","_outlineAttributes","_lastSceneMode","_lastShow","_lastOutlineShow","_lastOutlineWidth","_lastOutlineColor","_lastOffset","skipModelMatrix","modelMatrixResult","EllipsoidOutlineGeometry","showFill","showOutline","getValueOrClonedDefault","in3D","_lastDistanceDisplayCondition","outlineAttributes","multiplyByScale","PlaneGeometry","planeGeometry","PlaneOutlineGeometry","PlaneGeometryOptions","PlaneGeometryUpdater","DynamicPlaneGeometryUpdater","distanceDisplayConditionAttribute","planeGraphics","computeModelMatrix","createPrimitiveMatrix","isColorMaterial","scratchAxis","scratchAxis2","scratchQuaternion","transformedNormal","CoplanarPolygonGeometryLibrary","scratchIntersectionPoint","scratchXAxis","scratchYAxis","scratchZAxis","obbScratch","projectTo2D","axis1","axis2","validOutline","xMag","yMag","zMag","computeProjectTo2DArguments","centerResult","planeAxis1Result","planeAxis2Result","planeAxis1","planeAxis2","createProjectPointsTo2DFunction","positionResults","createProjectPointTo2DFunction","scratchBR","stScratch","textureCoordinatesOrigin","axis1Scratch","axis2Scratch","tangentRotationScratch","surfaceNormalScratch","createGeometryFromPolygon","polygon","projectPointTo2D","triangulate","positions2D","holes","tangentRotation","stOrigin","flatPositions","stx","sty","CoplanarPolygonGeometry","polygonHierarchy","_polygonHierarchy","PolygonGeometryLibrary","computeHierarchyPackedLength","fromPositions","packPolygonHierarchy","unpackPolygonHierarchy","polygonGeometry","projectPoints","projectPoint","polygonsFromHierarchy","hierarchy","polygons","outerRing","computeBoundingRectangle","geometryInstance","createGeometryFromPositions","CoplanarPolygonOutlineGeometry","polygonOutlinesFromHierarchy","scratchCarto1","scratchCarto2","adjustPosHeightsForNormal","p2","p1Carto","p2Carto","scratchBoundingRectangle","p1Scratch","p2Scratch","scratchPerPosNormal","scratchPerPosTangent","scratchPerPosBitangent","appendTextureCoordinatesOrigin","appendTextureCoordinatesCartesian2","appendTextureCoordinatesCartesian3","appendTextureCoordinatesQuaternion","appendTextureCoordinatesMatrix3","computeAttributes","wall","perPositionHeight","recomputeNormal","tangentRotationMatrix","_plane","bottomOffset2","attrIndex1","attrIndex2","startCartographicScratch","endCartographicScratch","westOverIDL","eastOverIDL","arcType","ArcType","RHUMB","swap","inverseChordLength","chordLength","positionsLength","endCartographic","startCartographic","interpolateAndGrowRectangle","interpolatedCartographicScratch","idlCross","segmentLength","surfaceDistance","subsegmentDistance","interpolationDistance","interpolatedCartographic","interpolateUsingSurfaceDistance","lonAdjusted","createGeometryFromPositionsExtrudedPositions","createGeometryFromPositionsExtruded","closeTop","closeBottom","geos","walls","topGeo","edgePoints","topBottomPositions","ilength","topAndBottom","projectPointsOntoPlane","windingOrder","computeWindingOrder2D","WindingOrder","CLOCKWISE","reverse","computeWallGeometry","hole","COUNTER_CLOCKWISE","PolygonGeometry","perPositionHeightExtrude","_closeTop","_closeBottom","_perPositionHeight","_perPositionHeightExtrude","_arcType","GEODESIC","dummyOptions","splitGeometry","scaleToGeodeticHeightExtruded","createGeometryFromPositionsPositions","createGeometryFromPositionsSubdivided","minDistance","subdividedPositions","subdivideLineCount","subdivideRhumbLineCount","tempPositions","subdivideLine","subdivideRhumbLine","tempPositionsLength","indicesSize","cornersLength","PolygonOutlineGeometry","scratch2DPositions","cart2Scratch","PolygonGeometryOptions","PolygonGeometryUpdater","DyanmicPolygonGeometryUpdater","area","centroid2D","f","sum","projectPointOntoEllipsoid","perPositionHeightProperty","perPositionHeightEnabled","hierarchyValue","perPositionHeightValue","isExtruded","PolylineVolumeGeometry","polylinePositions","_shape","numComponents","brScratch","polylineVolumeGeometry","ll","ul","ur","lr","shapeLength","firstEndIndices","indicesCount","lengthSt","heightSt","stindex","endOffset","computeTangentAndBitangent","PolylineVolumeOutlineGeometry","polylineVolumeOutlineGeometry","shapeCount","firstOffset","secondOffset","PolylineVolumeGeometryOptions","PolylineVolumeGeometryUpdater","polylineVolume","DynamicPolylineVolumeGeometryUpdater","rectangleScratch","createAttributes","v1Scratch","v2Scratch","constructRectangle","rectangleGeometry","computedOptions","northCap","southCap","rowStart","rowEnd","rowHeight","minY","row","col","RectangleGeometryLibrary","computePosition","calculateAttributes","northIndex","southIndex","topPositions","bottomPositions","addWallTextureCoordinates","wallTextures","constructExtrudedRectangle","offsetAttributeValue","_surfaceHeight","newVertexFormat","newLength","hasOffsets","widthMultiplier","perimeterPositions","dupliateCorners","wallCount","wallExtrudeNormals","wallOffsetAttribute","computeTopOffsets","threeI","extrudeNormalIndex","wallOffsetIndex","calculateAttributesWall","scratchRectanglePoints","nwScratch","stNwScratch","computeOptions","RectangleGeometry","_rotatedRectangle","surfaceHeight","tangentRotationMatrixScratch","lonScalar","latScalar","topBS","fromRectangle3D","bottomBS","unrotatedTextureRectangleScratch","points2DScratch","rotation2DScratch","Matrix2","unrotatedTextureRectangle","points2D","toDesiredInComputed","fromRotation","boundingRectangleCenter","point2D","minXYCorner","maxYCorner","maxXCorner","scratchCenterRect","RectangleGeometryOptions","RectangleGeometryUpdater","DynamicRectangleGeometryUpdater","RectangleOutlineGeometry","Batch","appearanceType","depthFailAppearanceType","depthFailMaterialProperty","removeMaterialSubscription","depthFailMaterial","createPrimitive","waitingOnCreate","oldPrimitive","updaters","updatersWithAttributes","subscriptions","showsUpdated","itemsToRemove","invalidated","onMaterialChanged","StaticGeometryColorBatch","_solidItems","_translucentItems","_appearanceType","_depthFailAppearanceType","_shadows","removeItem","moveItems","batch","itemsMoved","itemsToMoveLength","updateItems","isUpdated","updatersLength","isMaterial","updaterMaterial","unsubscribe","removedCount","depthFailAppearance","colorProperty","resultColor","_lastColor","depthFailColorProperty","depthColor","_lastDepthFailColor","depthFailColor","offsetProperty","updateShows","solidsMoved","translucentsMoved","updaterDepthFailMaterial","StaticGeometryPerMaterialBatch","tmp","defaultCompare","quickselectStep","sd","rbush","maxEntries","_maxEntries","_minEntries","_initFormat","findItem","equalsFn","calcBBox","node","toBBox","distBBox","destNode","createNode","Infinity","extend","leaf","compareNodeMinX","compareNodeMinY","bboxArea","bboxMargin","intersects","multiSelect","mid","_all","search","bbox","childBBox","nodesToSearch","collides","insert","_build","_splitRoot","tmpNode","_insert","goingUp","path","indexes","_condense","compareMinX","compareMinY","toJSON","fromJSON","N","M","right2","right3","N2","N1","_chooseSubtree","targetNode","enlargement","minArea","minEnlargement","isNode","insertPath","_split","_adjustParentBBoxes","_chooseSplitAxis","splitIndex","_chooseSplitIndex","newNode","bbox1","bbox2","overlap","minOverlap","_allDistMargin","leftBBox","rightBBox","margin","siblings","compareArr","join","RectangleCollisionChecker","_tree","RectangleWithId","idCompare","fromRectangleAndId","withId","removalScratch","collisionScratch","isDirty","rectangleCollisionCheck","StaticGroundGeometryColorBatch","_batches","_classificationType","overlapping","fillColor","batches","batchCount","oldBatch","newBatch","usingSphericalTextureCoordinates","StaticGroundGeometryPerMaterialBatch","ShadowVolumeAppearance","shouldUseSphericalCoordinates","StaticOutlineGeometryBatch","_solidBatches","_translucentBatches","solidBatches","solidBatchesLength","translucentBatches","translucentBatchesLength","needUpdate","solidsToMoveLength","translucentToMoveLength","solidBatch","translucentBatch","WallGeometryLibrary","latLonEquals","c0","scratchCartographic1","scratchCartographic2","positionsArrayScratch","heightsArrayScratch","generateArcOptionsScratch","maximumHeights","minimumHeights","duplicateCorners","o","topHeights","bottomHeights","hasBottomHeights","hasTopHeights","hasAllZeroHeights","cleanedTopHeights","cleanedBottomHeights","removeDuplicates","numCorners","generateArcOptions","numberOfPoints","generateArcPositions","generateArcHeights","scratchCartesian3Position1","scratchCartesian3Position2","scratchCartesian3Position3","scratchCartesian3Position4","scratchCartesian3Position5","WallGeometry","_minimumHeights","_maximumHeights","fromConstantHeights","minHeights","maxHeights","doMin","doMax","wallGeometry","ds","i3","nextTop","groundPosition","scalednextPosition","scaledGroundPosition","edgeIndex","pl","pr","WallOutlineGeometry","WallGeometryOptions","WallGeometryUpdater","DynamicWallGeometryUpdater","emptyArray","geometryUpdaters","GeometryUpdaterSet","_removeEntitySubscription","GeometryVisualizer","_addedObjects","_removedObjects","_changedObjects","numberOfShadowModes","NUMBER_OF_SHADOW_MODES","_outlineBatches","_closedColorBatches","_closedMaterialBatches","_openColorBatches","_openMaterialBatches","numberOfClassificationTypes","NUMBER_OF_CLASSIFICATION_TYPES","groundColorBatches","groundMaterialBatches","_groundColorBatches","_groundMaterialBatches","_dynamicBatch","_updaterSets","updaterSet","addedObjects","removedObjects","changedObjects","_removeUpdater","_insertUpdaterIntoBatch","_onGeometryChanged","getBoundingSphereArrayScratch","getBoundingSphereBoundingSphereScratch","batchesLength","updaterSets","defaultStyle","LabelStyle","FILL","defaultFillColor","defaultBackgroundColor","defaultBackgroundPadding","fillColorScratch","outlineColorScratch","backgroundColorScratch","backgroundPaddingScratch","label","LabelVisualizer","removeLabel","text","labelGraphics","_label","_text","updateClamping","getLabel","font","_font","_style","_fillColor","_outlineColor","showBackground","_showBackground","backgroundPadding","_backgroundPadding","ENABLED","defaultSilhouetteColor","defaultColorBlendMode","ColorBlendMode","HIGHLIGHT","defaultImageBasedLightingFactor","defaultUpAxis","Axis","Y","modelMatrixScratch","nodeMatrixScratch","ModelVisualizer","_modelHash","_entitiesToVisualize","removeModel","visualizer","modelHash","modelData","modelPrimitive","clearNodeTransformationsArticulationsScratch","nodeTransformationsScratch","articulationsScratch","checkModelLoad","loadFail","modelGraphics","_uri","Model","fromGltf","incrementallyLoadTextures","_incrementallyLoadTextures","animationsRunning","minimumPixelSize","_minimumPixelSize","maximumScale","_maximumScale","silhouetteColor","_silhouetteColor","silhouetteSize","_silhouetteSize","colorBlendMode","_colorBlendMode","colorBlendAmount","_colorBlendAmount","clampAnimations","_clampAnimations","imageBasedLightingFactor","_imageBasedLightingFactor","_upAxis","_forwardAxis","runAnimations","_runAnimations","activeAnimations","addAll","loop","ModelAnimationLoop","nodeTransformations","_nodeTransformations","nodeNames","keys","nodeIndex","nodeLength","nodeName","nodeTransformation","modelNode","getNode","transformationMatrix","fromTranslationRotationScale","originalMatrix","anyArticulationUpdated","articulations","_articulations","articulationStageKeys","numKeys","articulationStageValue","setArticulationStage","applyArticulations","_clampedModelMatrix","_heightChanged","Cesium3DTilesetVisualizer","_tilesetHash","removeTileset","tilesetHash","tilesetData","tilesetPrimitive","checkLoad","tilesetGraphics","_tileset","Cesium3DTileset","scratchTimeInterval","TimeInterval","subSampleCompositePropertyScratch","subSampleIntervalPropertyScratch","polyline","reallySubSample","updateTime","maximumStep","SampledPositionProperty","times","sampleStepsToTake","sampleStepsTaken","sampleStepSize","steppedOnNow","current","loopStop","sampling","secondsUntilNext","subSampleSampledProperty","_property","_times","intersect","intervalStart","intervalStop","sampleStart","sampleStop","subSampleCompositeProperty","TimeIntervalCollectionPositionProperty","isStartIncluded","isStopIncluded","subSampleIntervalProperty","ConstantPositionProperty","subSampleConstantProperty","subSampleGenericProperty","subSample","toFixedScratch","PolylineUpdater","_unusedIndexes","_polylineCollection","PolylineCollection","PathVisualizer","_updaters","ReferenceFrame","INERTIAL","updateObject","pathGraphics","_path","showProperty","leadTime","_leadTime","trailTime","_trailTime","_availability","hasAvailability","hasLeadTime","hasTrailTime","unusedIndexes","resolution","_resolution","removeObject","lastUpdater","frameToVisualize","currentUpdater","_subSample","pointPrimitive","PointVisualizer","removePoint","pointGraphics","_point","needsRedraw","_pixelSize","newColor","newOutlineColor","newOutlineWidth","newPixelSize","centerAlpha","cssColor","toCssColorString","cssOutlineColor","textureId","setImage","createBillboardPointCallback","scratchInterpolateColorsArray","interpolateColors","color0","color1","colors","r0","g0","b0","a0","r1","g1","b1","a1","redPerVertex","greenPerVertex","bluePerVertex","alphaPerVertex","PolylineGeometry","colorsPerVertex","_colors","_colorsPerVertex","scratchPrevPosition","scratchNextPosition","polylineGeometry","subdivisionSize","numberOfPointsFunction","numberOfPointsRhumbLine","extractHeights","colorLength","newColors","newColorIndex","numColors","interpolatedColors","interpolatedColorsLength","generateCartesianArc","generateCartesianRhumbArc","prevPositions","nextPositions","expandAndWidth","finalColors","expandAndWidthIndex","colorIndex","endK","prevPosition","geometryType","GeometryType","POLYLINES","polylineCollections","GeometryOptions","GroundGeometryOptions","PolylineGeometryUpdater","_entitySubscription","_depthFailMaterialProperty","_geometryOptions","_groundGeometryOptions","_clampToGround","_supportsPolylinesOnTerrain","clampToGround","GroundPolylineGeometry","positionsProperty","PolylineColorAppearance","PolylineMaterialAppearance","groundGeometryOptions","generateCartesianArcOptions","_line","_groundPolylinePrimitive","getLine","dynamicGeometryUpdater","sceneId","polylineCollection","line","GroundPolylinePrimitive","groundPolylinePrimitive","_asynchronous","StaticGroundPolylinePerMaterialBatch","removeUpdater","insertUpdaterIntoBatch","_groundBatches","multiplier","_colorBatches","_materialBatches","PolylineVisualizer","DataSourceDisplay","_displayID","initializeTerrainHeights","dataSourceCollection","dataSourceAdded","_onDataSourceAdded","dataSourceRemoved","_onDataSourceRemoved","dataSourceMoved","_onDataSourceMoved","_dataSourceCollection","_visualizersCallback","visualizersCallback","defaultVisualizersCallback","primitivesAdded","removeDefaultDataSourceListener","removeDataSourceCollectionListener","defaultDataSource","CustomDataSource","_defaultDataSource","addPrimitives","_removeDefaultDataSourceListener","_removeDataSourceCollectionListener","dataSource","dataSources","initialized","visualizers","vLength","_visualizersByDisplayID","_resourceCredits","creditCount","allowPartial","_visualizers","visualizersLength","displayPrimitives","displayGroundPrimitives","clustering","_initialize"],"mappings":"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","file":"4.TerriaMap.js","sourcesContent":["module.exports = __webpack_public_path__ + \"4fff67aa927fc4ecb16298f61b0cf84a.jpg\";","module.exports = __webpack_public_path__ + \"b592e228bf0641d6b4f0b79e664177ab.jpg\";","module.exports = __webpack_public_path__ + \"c6ab0a71c7048eb83585b34bd32f4ee0.jpg\";","module.exports = __webpack_public_path__ + \"27faaa4b21b2a66ac3496b20640e571f.jpg\";","module.exports = __webpack_public_path__ + \"0a8e3af0b451f232d7b8e5b1ec17575f.jpg\";","module.exports = __webpack_public_path__ + \"f0bbd92eb78a7cfc1106f0a0a3e4cba7.jpg\";","module.exports = __webpack_public_path__ + \"ce3752c9dd3b7c390190fb5f104bddd4.jpg\";","module.exports = __webpack_public_path__ + \"403aa235dad8bb7ee2a07556f9438677.jpg\";","module.exports = __webpack_public_path__ + \"65d2c74e5f08b7aeef95d017e5cb07a6.jpg\";","module.exports = __webpack_public_path__ + \"0442d80880107432ae51dd8c6803a249.jpg\";","\"use strict\";\n\nvar _i18next = _interopRequireDefault(require(\"i18next\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\n/*global require*/\nvar Cartesian2 = require(\"terriajs-cesium/Source/Core/Cartesian2\")[\"default\"];\n\nvar defined = require(\"terriajs-cesium/Source/Core/defined\")[\"default\"];\n\nvar DeveloperError = require(\"terriajs-cesium/Source/Core/DeveloperError\")[\"default\"];\n\nvar EasingFunction = require(\"terriajs-cesium/Source/Core/EasingFunction\")[\"default\"];\n\nvar knockout = require(\"terriajs-cesium/Source/ThirdParty/knockout\")[\"default\"];\n\nvar SceneTransforms = require(\"terriajs-cesium/Source/Scene/SceneTransforms\")[\"default\"];\n\nvar selectionIndicatorUrl = require(\"../../wwwroot/images/NM-LocationTarget.svg\");\n\nvar screenSpacePos = new Cartesian2();\nvar offScreen = \"-1000px\";\n\nvar CesiumSelectionIndicator = function CesiumSelectionIndicator(cesium) {\n  //>>includeStart('debug', pragmas.debug);\n  if (!defined(cesium)) {\n    throw new DeveloperError(_i18next[\"default\"].t(\"map.cesium.devError\"));\n  } //>>includeEnd('debug')\n\n\n  this._cesium = cesium;\n  this._screenPositionX = offScreen;\n  this._screenPositionY = offScreen;\n  this._tweens = cesium.scene.tweens;\n  this._container = cesium.viewer.container;\n  /**\r\n   * Gets or sets the world position of the object for which to display the selection indicator.\r\n   * @type {Cartesian3}\r\n   */\n\n  this.position = undefined;\n  /**\r\n   * Gets or sets the visibility of the selection indicator.\r\n   * @type {Boolean}\r\n   */\n\n  this.showSelection = true;\n  this.transform = \"\";\n  this.opacity = 1.0;\n  knockout.track(this, [\"position\", \"_screenPositionX\", \"_screenPositionY\", \"_scale\", \"rotate\", \"showSelection\", \"transform\", \"opacity\"]);\n  /**\r\n   * Gets the visibility of the position indicator.  This can be false even if an\r\n   * object is selected, when the selected object has no position.\r\n   * @type {Boolean}\r\n   */\n\n  this.isVisible = undefined;\n  knockout.defineProperty(this, \"isVisible\", {\n    get: function get() {\n      return this.showSelection && defined(this.position);\n    }\n  });\n  /**\r\n   * Gets or sets the function for converting the world position of the object to the screen space position.\r\n   *\r\n   * @member\r\n   * @type {SelectionIndicatorViewModel~ComputeScreenSpacePosition}\r\n   * @default SceneTransforms.wgs84ToWindowCoordinates\r\n   *\r\n   * @example\r\n   * selectionIndicatorViewModel.computeScreenSpacePosition = function(position, result) {\r\n   *     return Cesium.SceneTransforms.wgs84ToWindowCoordinates(scene, position, result);\r\n   * };\r\n   */\n\n  this.computeScreenSpacePosition = function (position, result) {\n    return SceneTransforms.wgs84ToWindowCoordinates(cesium.scene, position, result);\n  };\n\n  var el = document.createElement(\"div\");\n  el.className = \"selection-indicator\";\n\n  this._container.appendChild(el);\n\n  this._selectionIndicatorElement = el;\n  var img = document.createElement(\"img\");\n  img.setAttribute(\"src\", selectionIndicatorUrl);\n  img.setAttribute(\"alt\", \"\");\n  img.setAttribute(\"width\", 50);\n  img.setAttribute(\"height\", 50);\n  el.appendChild(img);\n  var that = this;\n\n  function update() {\n    el.style.top = that._screenPositionY;\n    el.style.left = that._screenPositionX;\n    el.style.transform = that.transform;\n    el.style.opacity = that.opacity;\n  }\n\n  update();\n  this._subscriptions = [];\n\n  this._subscriptions.push(knockout.getObservable(this, \"_screenPositionX\").subscribe(update));\n\n  this._subscriptions.push(knockout.getObservable(this, \"_screenPositionY\").subscribe(update));\n\n  this._subscriptions.push(knockout.getObservable(this, \"transform\").subscribe(update));\n\n  this._subscriptions.push(knockout.getObservable(this, \"opacity\").subscribe(update));\n};\n\nCesiumSelectionIndicator.prototype.destroy = function () {\n  this._selectionIndicatorElement.parentNode.removeChild(this._selectionIndicatorElement);\n\n  this._subscriptions.forEach(function (subscription) {\n    subscription.dispose();\n  });\n};\n/**\r\n * Updates the view of the selection indicator to match the position and content properties of the view model.\r\n * This function should be called as part of the render loop.\r\n */\n\n\nCesiumSelectionIndicator.prototype.update = function () {\n  if (this.showSelection && defined(this.position)) {\n    var screenPosition = this.computeScreenSpacePosition(this.position, screenSpacePos);\n\n    if (!defined(screenPosition)) {\n      this._screenPositionX = offScreen;\n      this._screenPositionY = offScreen;\n    } else {\n      var container = this._container;\n      var containerWidth = container.clientWidth;\n      var containerHeight = container.clientHeight;\n      var indicatorSize = this._selectionIndicatorElement.clientWidth;\n      var halfSize = indicatorSize * 0.5;\n      screenPosition.x = Math.min(Math.max(screenPosition.x, -indicatorSize), containerWidth + indicatorSize) - halfSize;\n      screenPosition.y = Math.min(Math.max(screenPosition.y, -indicatorSize), containerHeight + indicatorSize) - halfSize;\n      this._screenPositionX = Math.floor(screenPosition.x + 0.25) + \"px\";\n      this._screenPositionY = Math.floor(screenPosition.y + 0.25) + \"px\";\n    }\n  }\n};\n/**\r\n * Animate the indicator to draw attention to the selection.\r\n */\n\n\nCesiumSelectionIndicator.prototype.animateAppear = function () {\n  if (defined(this._selectionIndicatorTween)) {\n    if (this._selectionIndicatorIsAppearing) {\n      // Already appearing; don't restart the animation.\n      return;\n    }\n\n    this._selectionIndicatorTween.cancelTween();\n\n    this._selectionIndicatorTween = undefined;\n  }\n\n  this._selectionIndicatorIsAppearing = true;\n  var that = this;\n  this._selectionIndicatorTween = this._tweens.add({\n    startObject: {\n      scale: 2.0,\n      opacity: 0.0,\n      rotate: -180\n    },\n    stopObject: {\n      scale: 1.0,\n      opacity: 1.0,\n      rotate: 0\n    },\n    duration: 0.8,\n    easingFunction: EasingFunction.EXPONENTIAL_OUT,\n    update: function update(value) {\n      that.opacity = value.opacity;\n      that.transform = \"scale(\" + value.scale + \") rotate(\" + value.rotate + \"deg)\";\n    },\n    complete: function complete() {\n      that._selectionIndicatorTween = undefined;\n    },\n    cancel: function cancel() {\n      that._selectionIndicatorTween = undefined;\n    }\n  });\n};\n/**\r\n * Animate the indicator to release the selection.\r\n */\n\n\nCesiumSelectionIndicator.prototype.animateDepart = function () {\n  if (defined(this._selectionIndicatorTween)) {\n    if (!this._selectionIndicatorIsAppearing) {\n      // Already disappearing, don't restart the animation.\n      return;\n    }\n\n    this._selectionIndicatorTween.cancelTween();\n\n    this._selectionIndicatorTween = undefined;\n  }\n\n  this._selectionIndicatorIsAppearing = false;\n  var that = this;\n  this._selectionIndicatorTween = this._tweens.add({\n    startObject: {\n      scale: 1.0,\n      opacity: 1.0\n    },\n    stopObject: {\n      scale: 1.5,\n      opacity: 0.0\n    },\n    duration: 0.8,\n    easingFunction: EasingFunction.EXPONENTIAL_OUT,\n    update: function update(value) {\n      that.opacity = value.opacity;\n      that.transform = \"scale(\" + value.scale + \") rotate(0deg)\";\n    },\n    complete: function complete() {\n      that._selectionIndicatorTween = undefined;\n    },\n    cancel: function cancel() {\n      that._selectionIndicatorTween = undefined;\n    }\n  });\n};\n\nObject.defineProperties(CesiumSelectionIndicator.prototype, {\n  /**\r\n   * Gets the HTML element containing the selection indicator.\r\n   * @memberof CesiumSelectionIndicator.prototype\r\n   *\r\n   * @type {Element}\r\n   */\n  container: {\n    get: function get() {\n      return this._container;\n    }\n  },\n\n  /**\r\n   * Gets the HTML element that holds the selection indicator.\r\n   * @memberof CesiumSelectionIndicator.prototype\r\n   *\r\n   * @type {Element}\r\n   */\n  selectionIndicatorElement: {\n    get: function get() {\n      return this._selectionIndicatorElement;\n    }\n  },\n\n  /**\r\n   * Gets the scene being used.\r\n   * @memberof CesiumSelectionIndicator.prototype\r\n   *\r\n   * @type {Scene}\r\n   */\n  scene: {\n    get: function get() {\n      return this._scene;\n    }\n  }\n});\n/**\r\n * A function that converts the world position of an object to a screen space position.\r\n * @callback CesiumSelectionIndicator~ComputeScreenSpacePosition\r\n * @param {Cartesian3} position The position in WGS84 (world) coordinates.\r\n * @param {Cartesian2} result An object to return the input position transformed to window coordinates.\r\n * @returns {Cartesian2} The modified result parameter.\r\n */\n\nmodule.exports = CesiumSelectionIndicator;","\n    /**\n     * Style options for corners.\n     *\n     * @demo The {@link https://sandcastle.cesium.com/index.html?src=Corridor.html&label=Geometries|Corridor Demo}\n     * demonstrates the three corner types, as used by {@link CorridorGraphics}.\n     *\n     * @exports CornerType\n     */\n    var CornerType = {\n        /**\n         * <img src=\"Images/CornerTypeRounded.png\" style=\"vertical-align: middle;\" width=\"186\" height=\"189\" />\n         *\n         * Corner has a smooth edge.\n         * @type {Number}\n         * @constant\n         */\n        ROUNDED : 0,\n\n        /**\n         * <img src=\"Images/CornerTypeMitered.png\" style=\"vertical-align: middle;\" width=\"186\" height=\"189\" />\n         *\n         * Corner point is the intersection of adjacent edges.\n         * @type {Number}\n         * @constant\n         */\n        MITERED : 1,\n\n        /**\n         * <img src=\"Images/CornerTypeBeveled.png\" style=\"vertical-align: middle;\" width=\"186\" height=\"189\" />\n         *\n         * Corner is clipped.\n         * @type {Number}\n         * @constant\n         */\n        BEVELED : 2\n    };\nexport default Object.freeze(CornerType);\n","import defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport Event from '../Core/Event.js';\nimport EventHelper from '../Core/EventHelper.js';\nimport TimeIntervalCollection from '../Core/TimeIntervalCollection.js';\nimport Property from './Property.js';\n\n    function subscribeAll(property, eventHelper, definitionChanged, intervals) {\n        function callback() {\n            definitionChanged.raiseEvent(property);\n        }\n        var items = [];\n        eventHelper.removeAll();\n        var length = intervals.length;\n        for (var i = 0; i < length; i++) {\n            var interval = intervals.get(i);\n            if (defined(interval.data) && items.indexOf(interval.data) === -1) {\n                eventHelper.add(interval.data.definitionChanged, callback);\n            }\n        }\n    }\n\n    /**\n     * A {@link Property} which is defined by a {@link TimeIntervalCollection}, where the\n     * data property of each {@link TimeInterval} is another Property instance which is\n     * evaluated at the provided time.\n     *\n     * @alias CompositeProperty\n     * @constructor\n     *\n     *\n     * @example\n     * var constantProperty = ...;\n     * var sampledProperty = ...;\n     *\n     * //Create a composite property from two previously defined properties\n     * //where the property is valid on August 1st, 2012 and uses a constant\n     * //property for the first half of the day and a sampled property for the\n     * //remaining half.\n     * var composite = new Cesium.CompositeProperty();\n     * composite.intervals.addInterval(Cesium.TimeInterval.fromIso8601({\n     *     iso8601 : '2012-08-01T00:00:00.00Z/2012-08-01T12:00:00.00Z',\n     *     data : constantProperty\n     * }));\n     * composite.intervals.addInterval(Cesium.TimeInterval.fromIso8601({\n     *     iso8601 : '2012-08-01T12:00:00.00Z/2012-08-02T00:00:00.00Z',\n     *     isStartIncluded : false,\n     *     isStopIncluded : false,\n     *     data : sampledProperty\n     * }));\n     *\n     * @see CompositeMaterialProperty\n     * @see CompositePositionProperty\n     */\n    function CompositeProperty() {\n        this._eventHelper = new EventHelper();\n        this._definitionChanged = new Event();\n        this._intervals = new TimeIntervalCollection();\n        this._intervals.changedEvent.addEventListener(CompositeProperty.prototype._intervalsChanged, this);\n    }\n\n    Object.defineProperties(CompositeProperty.prototype, {\n        /**\n         * Gets a value indicating if this property is constant.  A property is considered\n         * constant if getValue always returns the same result for the current definition.\n         * @memberof CompositeProperty.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        isConstant : {\n            get : function() {\n                return this._intervals.isEmpty;\n            }\n        },\n        /**\n         * Gets the event that is raised whenever the definition of this property changes.\n         * The definition is changed whenever setValue is called with data different\n         * than the current value.\n         * @memberof CompositeProperty.prototype\n         *\n         * @type {Event}\n         * @readonly\n         */\n        definitionChanged : {\n            get : function() {\n                return this._definitionChanged;\n            }\n        },\n        /**\n         * Gets the interval collection.\n         * @memberof CompositeProperty.prototype\n         *\n         * @type {TimeIntervalCollection}\n         */\n        intervals : {\n            get : function() {\n                return this._intervals;\n            }\n        }\n    });\n\n    /**\n     * Gets the value of the property at the provided time.\n     *\n     * @param {JulianDate} time The time for which to retrieve the value.\n     * @param {Object} [result] The object to store the value into, if omitted, a new instance is created and returned.\n     * @returns {Object} The modified result parameter or a new instance if the result parameter was not supplied.\n     */\n    CompositeProperty.prototype.getValue = function(time, result) {\n        \n\n        var innerProperty = this._intervals.findDataForIntervalContainingDate(time);\n        if (defined(innerProperty)) {\n            return innerProperty.getValue(time, result);\n        }\n        return undefined;\n    };\n\n    /**\n     * Compares this property to the provided property and returns\n     * <code>true</code> if they are equal, <code>false</code> otherwise.\n     *\n     * @param {Property} [other] The other property.\n     * @returns {Boolean} <code>true</code> if left and right are equal, <code>false</code> otherwise.\n     */\n    CompositeProperty.prototype.equals = function(other) {\n        return this === other || //\n               (other instanceof CompositeProperty && //\n                this._intervals.equals(other._intervals, Property.equals));\n    };\n\n    /**\n     * @private\n     */\n    CompositeProperty.prototype._intervalsChanged = function() {\n        subscribeAll(this, this._eventHelper, this._definitionChanged, this._intervals);\n        this._definitionChanged.raiseEvent(this);\n    };\nexport default CompositeProperty;\n","import defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport Event from '../Core/Event.js';\nimport ReferenceFrame from '../Core/ReferenceFrame.js';\nimport CompositeProperty from './CompositeProperty.js';\nimport Property from './Property.js';\n\n    /**\n     * A {@link CompositeProperty} which is also a {@link PositionProperty}.\n     *\n     * @alias CompositePositionProperty\n     * @constructor\n     *\n     * @param {ReferenceFrame} [referenceFrame=ReferenceFrame.FIXED] The reference frame in which the position is defined.\n     */\n    function CompositePositionProperty(referenceFrame) {\n        this._referenceFrame = defaultValue(referenceFrame, ReferenceFrame.FIXED);\n        this._definitionChanged = new Event();\n        this._composite = new CompositeProperty();\n        this._composite.definitionChanged.addEventListener(CompositePositionProperty.prototype._raiseDefinitionChanged, this);\n    }\n\n    Object.defineProperties(CompositePositionProperty.prototype, {\n        /**\n         * Gets a value indicating if this property is constant.  A property is considered\n         * constant if getValue always returns the same result for the current definition.\n         * @memberof CompositePositionProperty.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        isConstant : {\n            get : function() {\n                return this._composite.isConstant;\n            }\n        },\n        /**\n         * Gets the event that is raised whenever the definition of this property changes.\n         * The definition is changed whenever setValue is called with data different\n         * than the current value.\n         * @memberof CompositePositionProperty.prototype\n         *\n         * @type {Event}\n         * @readonly\n         */\n        definitionChanged : {\n            get : function() {\n                return this._definitionChanged;\n            }\n        },\n        /**\n         * Gets the interval collection.\n         * @memberof CompositePositionProperty.prototype\n         *\n         * @type {TimeIntervalCollection}\n         */\n        intervals : {\n            get : function() {\n                return this._composite.intervals;\n            }\n        },\n        /**\n         * Gets or sets the reference frame which this position presents itself as.\n         * Each PositionProperty making up this object has it's own reference frame,\n         * so this property merely exposes a \"preferred\" reference frame for clients\n         * to use.\n         * @memberof CompositePositionProperty.prototype\n         *\n         * @type {ReferenceFrame}\n         */\n        referenceFrame : {\n            get : function() {\n                return this._referenceFrame;\n            },\n            set : function(value) {\n                this._referenceFrame = value;\n            }\n        }\n    });\n\n    /**\n     * Gets the value of the property at the provided time in the fixed frame.\n     *\n     * @param {JulianDate} time The time for which to retrieve the value.\n     * @param {Object} [result] The object to store the value into, if omitted, a new instance is created and returned.\n     * @returns {Object} The modified result parameter or a new instance if the result parameter was not supplied.\n     */\n    CompositePositionProperty.prototype.getValue = function(time, result) {\n        return this.getValueInReferenceFrame(time, ReferenceFrame.FIXED, result);\n    };\n\n    /**\n     * Gets the value of the property at the provided time and in the provided reference frame.\n     *\n     * @param {JulianDate} time The time for which to retrieve the value.\n     * @param {ReferenceFrame} referenceFrame The desired referenceFrame of the result.\n     * @param {Cartesian3} [result] The object to store the value into, if omitted, a new instance is created and returned.\n     * @returns {Cartesian3} The modified result parameter or a new instance if the result parameter was not supplied.\n     */\n    CompositePositionProperty.prototype.getValueInReferenceFrame = function(time, referenceFrame, result) {\n        \n\n        var innerProperty = this._composite._intervals.findDataForIntervalContainingDate(time);\n        if (defined(innerProperty)) {\n            return innerProperty.getValueInReferenceFrame(time, referenceFrame, result);\n        }\n        return undefined;\n    };\n\n    /**\n     * Compares this property to the provided property and returns\n     * <code>true</code> if they are equal, <code>false</code> otherwise.\n     *\n     * @param {Property} [other] The other property.\n     * @returns {Boolean} <code>true</code> if left and right are equal, <code>false</code> otherwise.\n     */\n    CompositePositionProperty.prototype.equals = function(other) {\n        return this === other || //\n               (other instanceof CompositePositionProperty && //\n                this._referenceFrame === other._referenceFrame && //\n                this._composite.equals(other._composite, Property.equals));\n    };\n\n    /**\n     * @private\n     */\n    CompositePositionProperty.prototype._raiseDefinitionChanged = function() {\n        this._definitionChanged.raiseEvent(this);\n    };\nexport default CompositePositionProperty;\n","import defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport Event from '../Core/Event.js';\nimport Property from './Property.js';\n\n    function resolve(that) {\n        var targetProperty = that._targetProperty;\n\n        if (!defined(targetProperty)) {\n            var targetEntity = that._targetEntity;\n\n            if (!defined(targetEntity)) {\n                targetEntity = that._targetCollection.getById(that._targetId);\n\n                if (!defined(targetEntity)) {\n                    // target entity not found\n                    that._targetEntity = that._targetProperty = undefined;\n                    return;\n                }\n\n                // target entity was found. listen for changes to entity definition\n                targetEntity.definitionChanged.addEventListener(ReferenceProperty.prototype._onTargetEntityDefinitionChanged, that);\n                that._targetEntity = targetEntity;\n            }\n\n            // walk the list of property names and resolve properties\n            var targetPropertyNames = that._targetPropertyNames;\n            targetProperty = that._targetEntity;\n            for (var i = 0, len = targetPropertyNames.length; i < len && defined(targetProperty); ++i) {\n                targetProperty = targetProperty[targetPropertyNames[i]];\n            }\n\n            // target property may or may not be defined, depending on if it was found\n            that._targetProperty = targetProperty;\n        }\n\n        return targetProperty;\n    }\n\n    /**\n     * A {@link Property} which transparently links to another property on a provided object.\n     *\n     * @alias ReferenceProperty\n     * @constructor\n     *\n     * @param {EntityCollection} targetCollection The entity collection which will be used to resolve the reference.\n     * @param {String} targetId The id of the entity which is being referenced.\n     * @param {String[]} targetPropertyNames The names of the property on the target entity which we will use.\n     *\n     * @example\n     * var collection = new Cesium.EntityCollection();\n     *\n     * //Create a new entity and assign a billboard scale.\n     * var object1 = new Cesium.Entity({id:'object1'});\n     * object1.billboard = new Cesium.BillboardGraphics();\n     * object1.billboard.scale = new Cesium.ConstantProperty(2.0);\n     * collection.add(object1);\n     *\n     * //Create a second entity and reference the scale from the first one.\n     * var object2 = new Cesium.Entity({id:'object2'});\n     * object2.model = new Cesium.ModelGraphics();\n     * object2.model.scale = new Cesium.ReferenceProperty(collection, 'object1', ['billboard', 'scale']);\n     * collection.add(object2);\n     *\n     * //Create a third object, but use the fromString helper function.\n     * var object3 = new Cesium.Entity({id:'object3'});\n     * object3.billboard = new Cesium.BillboardGraphics();\n     * object3.billboard.scale = Cesium.ReferenceProperty.fromString(collection, 'object1#billboard.scale');\n     * collection.add(object3);\n     *\n     * //You can refer to an entity with a # or . in id and property names by escaping them.\n     * var object4 = new Cesium.Entity({id:'#object.4'});\n     * object4.billboard = new Cesium.BillboardGraphics();\n     * object4.billboard.scale = new Cesium.ConstantProperty(2.0);\n     * collection.add(object4);\n     *\n     * var object5 = new Cesium.Entity({id:'object5'});\n     * object5.billboard = new Cesium.BillboardGraphics();\n     * object5.billboard.scale = Cesium.ReferenceProperty.fromString(collection, '\\\\#object\\\\.4#billboard.scale');\n     * collection.add(object5);\n     */\n    function ReferenceProperty(targetCollection, targetId, targetPropertyNames) {\n        \n\n        this._targetCollection = targetCollection;\n        this._targetId = targetId;\n        this._targetPropertyNames = targetPropertyNames;\n        this._targetProperty = undefined;\n        this._targetEntity = undefined;\n        this._definitionChanged = new Event();\n\n        targetCollection.collectionChanged.addEventListener(ReferenceProperty.prototype._onCollectionChanged, this);\n    }\n\n    Object.defineProperties(ReferenceProperty.prototype, {\n        /**\n         * Gets a value indicating if this property is constant.\n         * @memberof ReferenceProperty.prototype\n         * @type {Boolean}\n         * @readonly\n         */\n        isConstant : {\n            get : function() {\n                return Property.isConstant(resolve(this));\n            }\n        },\n        /**\n         * Gets the event that is raised whenever the definition of this property changes.\n         * The definition is changed whenever the referenced property's definition is changed.\n         * @memberof ReferenceProperty.prototype\n         * @type {Event}\n         * @readonly\n         */\n        definitionChanged : {\n            get : function() {\n                return this._definitionChanged;\n            }\n        },\n        /**\n         * Gets the reference frame that the position is defined in.\n         * This property is only valid if the referenced property is a {@link PositionProperty}.\n         * @memberof ReferenceProperty.prototype\n         * @type {ReferenceFrame}\n         * @readonly\n         */\n        referenceFrame : {\n            get : function() {\n                var target = resolve(this);\n                return defined(target) ? target.referenceFrame : undefined;\n            }\n        },\n        /**\n         * Gets the id of the entity being referenced.\n         * @memberof ReferenceProperty.prototype\n         * @type {String}\n         * @readonly\n         */\n        targetId : {\n            get : function() {\n                return this._targetId;\n            }\n        },\n        /**\n         * Gets the collection containing the entity being referenced.\n         * @memberof ReferenceProperty.prototype\n         * @type {EntityCollection}\n         * @readonly\n         */\n        targetCollection : {\n            get : function() {\n                return this._targetCollection;\n            }\n        },\n        /**\n         * Gets the array of property names used to retrieve the referenced property.\n         * @memberof ReferenceProperty.prototype\n         * @type {String[]}\n         * @readonly\n         */\n        targetPropertyNames : {\n            get : function() {\n                return this._targetPropertyNames;\n            }\n        },\n        /**\n         * Gets the resolved instance of the underlying referenced property.\n         * @memberof ReferenceProperty.prototype\n         * @type {Property}\n         * @readonly\n         */\n        resolvedProperty : {\n            get : function() {\n                return resolve(this);\n            }\n        }\n    });\n\n    /**\n     * Creates a new instance given the entity collection that will\n     * be used to resolve it and a string indicating the target entity id and property.\n     * The format of the string is \"objectId#foo.bar\", where # separates the id from\n     * property path and . separates sub-properties.  If the reference identifier or\n     * or any sub-properties contains a # . or \\ they must be escaped.\n     *\n     * @param {EntityCollection} targetCollection\n     * @param {String} referenceString\n     * @returns {ReferenceProperty} A new instance of ReferenceProperty.\n     *\n     * @exception {DeveloperError} invalid referenceString.\n     */\n    ReferenceProperty.fromString = function(targetCollection, referenceString) {\n        \n\n        var identifier;\n        var values = [];\n\n        var inIdentifier = true;\n        var isEscaped = false;\n        var token = '';\n        for (var i = 0; i < referenceString.length; ++i) {\n            var c = referenceString.charAt(i);\n\n            if (isEscaped) {\n                token += c;\n                isEscaped = false;\n            } else if (c === '\\\\') {\n                isEscaped = true;\n            } else if (inIdentifier && c === '#') {\n                identifier = token;\n                inIdentifier = false;\n                token = '';\n            } else if (!inIdentifier && c === '.') {\n                values.push(token);\n                token = '';\n            } else {\n                token += c;\n            }\n        }\n        values.push(token);\n\n        return new ReferenceProperty(targetCollection, identifier, values);\n    };\n\n    /**\n     * Gets the value of the property at the provided time.\n     *\n     * @param {JulianDate} time The time for which to retrieve the value.\n     * @param {Object} [result] The object to store the value into, if omitted, a new instance is created and returned.\n     * @returns {Object} The modified result parameter or a new instance if the result parameter was not supplied.\n     */\n    ReferenceProperty.prototype.getValue = function(time, result) {\n        var target = resolve(this);\n        return defined(target) ? target.getValue(time, result) : undefined;\n    };\n\n    /**\n     * Gets the value of the property at the provided time and in the provided reference frame.\n     * This method is only valid if the property being referenced is a {@link PositionProperty}.\n     *\n     * @param {JulianDate} time The time for which to retrieve the value.\n     * @param {ReferenceFrame} referenceFrame The desired referenceFrame of the result.\n     * @param {Cartesian3} [result] The object to store the value into, if omitted, a new instance is created and returned.\n     * @returns {Cartesian3} The modified result parameter or a new instance if the result parameter was not supplied.\n     */\n    ReferenceProperty.prototype.getValueInReferenceFrame = function(time, referenceFrame, result) {\n        var target = resolve(this);\n        return defined(target) ? target.getValueInReferenceFrame(time, referenceFrame, result) : undefined;\n    };\n\n    /**\n     * Gets the {@link Material} type at the provided time.\n     * This method is only valid if the property being referenced is a {@link MaterialProperty}.\n     *\n     * @param {JulianDate} time The time for which to retrieve the type.\n     * @returns {String} The type of material.\n     */\n    ReferenceProperty.prototype.getType = function(time) {\n        var target = resolve(this);\n        return defined(target) ? target.getType(time) : undefined;\n    };\n\n    /**\n     * Compares this property to the provided property and returns\n     * <code>true</code> if they are equal, <code>false</code> otherwise.\n     *\n     * @param {Property} [other] The other property.\n     * @returns {Boolean} <code>true</code> if left and right are equal, <code>false</code> otherwise.\n     */\n    ReferenceProperty.prototype.equals = function(other) {\n        if (this === other) {\n            return true;\n        }\n\n        var names = this._targetPropertyNames;\n        var otherNames = other._targetPropertyNames;\n\n        if (this._targetCollection !== other._targetCollection || //\n            this._targetId !== other._targetId || //\n            names.length !== otherNames.length) {\n            return false;\n        }\n\n        var length = this._targetPropertyNames.length;\n        for (var i = 0; i < length; i++) {\n            if (names[i] !== otherNames[i]) {\n                return false;\n            }\n        }\n\n        return true;\n    };\n\n    ReferenceProperty.prototype._onTargetEntityDefinitionChanged = function(targetEntity, name, value, oldValue) {\n        if (defined(this._targetProperty) && this._targetPropertyNames[0] === name) {\n            this._targetProperty = undefined;\n            this._definitionChanged.raiseEvent(this);\n        }\n    };\n\n    ReferenceProperty.prototype._onCollectionChanged = function(collection, added, removed) {\n        var targetEntity = this._targetEntity;\n        if (defined(targetEntity) && removed.indexOf(targetEntity) !== -1) {\n            targetEntity.definitionChanged.removeEventListener(ReferenceProperty.prototype._onTargetEntityDefinitionChanged, this);\n            this._targetEntity = this._targetProperty = undefined;\n        } else if (!defined(targetEntity)) {\n            targetEntity = resolve(this);\n            if (defined(targetEntity)) {\n                this._definitionChanged.raiseEvent(this);\n            }\n        }\n    };\nexport default ReferenceProperty;\n","import arrayFill from './arrayFill.js';\nimport BoundingSphere from './BoundingSphere.js';\nimport Cartesian3 from './Cartesian3.js';\nimport Check from './Check.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport DeveloperError from './DeveloperError.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport GeometryOffsetAttribute from './GeometryOffsetAttribute.js';\nimport PrimitiveType from './PrimitiveType.js';\nimport VertexFormat from './VertexFormat.js';\n\n    var diffScratch = new Cartesian3();\n\n    /**\n     * Describes a cube centered at the origin.\n     *\n     * @alias BoxGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3} options.minimum The minimum x, y, and z coordinates of the box.\n     * @param {Cartesian3} options.maximum The maximum x, y, and z coordinates of the box.\n     * @param {VertexFormat} [options.vertexFormat=VertexFormat.DEFAULT] The vertex attributes to be computed.\n     *\n     * @see BoxGeometry.fromDimensions\n     * @see BoxGeometry.createGeometry\n     * @see Packable\n     *\n     * @demo {@link https://sandcastle.cesium.com/index.html?src=Box.html|Cesium Sandcastle Box Demo}\n     *\n     * @example\n     * var box = new Cesium.BoxGeometry({\n     *   vertexFormat : Cesium.VertexFormat.POSITION_ONLY,\n     *   maximum : new Cesium.Cartesian3(250000.0, 250000.0, 250000.0),\n     *   minimum : new Cesium.Cartesian3(-250000.0, -250000.0, -250000.0)\n     * });\n     * var geometry = Cesium.BoxGeometry.createGeometry(box);\n     */\n    function BoxGeometry(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        var min = options.minimum;\n        var max = options.maximum;\n\n        \n\n        var vertexFormat = defaultValue(options.vertexFormat, VertexFormat.DEFAULT);\n\n        this._minimum = Cartesian3.clone(min);\n        this._maximum = Cartesian3.clone(max);\n        this._vertexFormat = vertexFormat;\n        this._offsetAttribute = options.offsetAttribute;\n        this._workerName = 'createBoxGeometry';\n    }\n\n    /**\n     * Creates a cube centered at the origin given its dimensions.\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3} options.dimensions The width, depth, and height of the box stored in the x, y, and z coordinates of the <code>Cartesian3</code>, respectively.\n     * @param {VertexFormat} [options.vertexFormat=VertexFormat.DEFAULT] The vertex attributes to be computed.\n     * @returns {BoxGeometry}\n     *\n     * @exception {DeveloperError} All dimensions components must be greater than or equal to zero.\n     *\n     *\n     * @example\n     * var box = Cesium.BoxGeometry.fromDimensions({\n     *   vertexFormat : Cesium.VertexFormat.POSITION_ONLY,\n     *   dimensions : new Cesium.Cartesian3(500000.0, 500000.0, 500000.0)\n     * });\n     * var geometry = Cesium.BoxGeometry.createGeometry(box);\n     *\n     * @see BoxGeometry.createGeometry\n     */\n    BoxGeometry.fromDimensions = function(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n        var dimensions = options.dimensions;\n\n        \n\n        var corner = Cartesian3.multiplyByScalar(dimensions, 0.5, new Cartesian3());\n\n        return new BoxGeometry({\n            minimum : Cartesian3.negate(corner, new Cartesian3()),\n            maximum : corner,\n            vertexFormat : options.vertexFormat,\n            offsetAttribute: options.offsetAttribute\n        });\n    };\n\n    /**\n     * Creates a cube from the dimensions of an AxisAlignedBoundingBox.\n     *\n     * @param {AxisAlignedBoundingBox} boundingBox A description of the AxisAlignedBoundingBox.\n     * @returns {BoxGeometry}\n     *\n     *\n     *\n     * @example\n     * var aabb = Cesium.AxisAlignedBoundingBox.fromPoints(Cesium.Cartesian3.fromDegreesArray([\n     *      -72.0, 40.0,\n     *      -70.0, 35.0,\n     *      -75.0, 30.0,\n     *      -70.0, 30.0,\n     *      -68.0, 40.0\n     * ]));\n     * var box = Cesium.BoxGeometry.fromAxisAlignedBoundingBox(aabb);\n     *\n     * @see BoxGeometry.createGeometry\n     */\n    BoxGeometry.fromAxisAlignedBoundingBox = function (boundingBox) {\n        \n\n        return new BoxGeometry({\n            minimum : boundingBox.minimum,\n            maximum : boundingBox.maximum\n        });\n    };\n\n    /**\n     * The number of elements used to pack the object into an array.\n     * @type {Number}\n     */\n    BoxGeometry.packedLength = 2 * Cartesian3.packedLength + VertexFormat.packedLength + 1;\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {BoxGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    BoxGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        Cartesian3.pack(value._minimum, array, startingIndex);\n        Cartesian3.pack(value._maximum, array, startingIndex + Cartesian3.packedLength);\n        VertexFormat.pack(value._vertexFormat, array, startingIndex + 2 * Cartesian3.packedLength);\n        array[startingIndex + 2 * Cartesian3.packedLength + VertexFormat.packedLength] = defaultValue(value._offsetAttribute, -1);\n\n        return array;\n    };\n\n    var scratchMin = new Cartesian3();\n    var scratchMax = new Cartesian3();\n    var scratchVertexFormat = new VertexFormat();\n    var scratchOptions = {\n        minimum: scratchMin,\n        maximum: scratchMax,\n        vertexFormat: scratchVertexFormat,\n        offsetAttribute : undefined\n    };\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {BoxGeometry} [result] The object into which to store the result.\n     * @returns {BoxGeometry} The modified result parameter or a new BoxGeometry instance if one was not provided.\n     */\n    BoxGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var min = Cartesian3.unpack(array, startingIndex, scratchMin);\n        var max = Cartesian3.unpack(array, startingIndex + Cartesian3.packedLength, scratchMax);\n        var vertexFormat = VertexFormat.unpack(array, startingIndex + 2 * Cartesian3.packedLength, scratchVertexFormat);\n        var offsetAttribute = array[startingIndex + 2 * Cartesian3.packedLength + VertexFormat.packedLength];\n\n        if (!defined(result)) {\n            scratchOptions.offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n            return new BoxGeometry(scratchOptions);\n        }\n\n        result._minimum = Cartesian3.clone(min, result._minimum);\n        result._maximum = Cartesian3.clone(max, result._maximum);\n        result._vertexFormat = VertexFormat.clone(vertexFormat, result._vertexFormat);\n        result._offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n\n        return result;\n    };\n\n    /**\n     * Computes the geometric representation of a box, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {BoxGeometry} boxGeometry A description of the box.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    BoxGeometry.createGeometry = function(boxGeometry) {\n        var min = boxGeometry._minimum;\n        var max = boxGeometry._maximum;\n        var vertexFormat = boxGeometry._vertexFormat;\n\n        if (Cartesian3.equals(min, max)) {\n            return;\n        }\n\n        var attributes = new GeometryAttributes();\n        var indices;\n        var positions;\n\n        if (vertexFormat.position &&\n                (vertexFormat.st || vertexFormat.normal || vertexFormat.tangent || vertexFormat.bitangent)) {\n            if (vertexFormat.position) {\n                // 8 corner points.  Duplicated 3 times each for each incident edge/face.\n                positions = new Float64Array(6 * 4 * 3);\n\n                // +z face\n                positions[0]  = min.x;\n                positions[1]  = min.y;\n                positions[2]  = max.z;\n                positions[3]  = max.x;\n                positions[4]  = min.y;\n                positions[5]  = max.z;\n                positions[6]  = max.x;\n                positions[7]  = max.y;\n                positions[8]  = max.z;\n                positions[9]  = min.x;\n                positions[10] = max.y;\n                positions[11] = max.z;\n\n                // -z face\n                positions[12] = min.x;\n                positions[13] = min.y;\n                positions[14] = min.z;\n                positions[15] = max.x;\n                positions[16] = min.y;\n                positions[17] = min.z;\n                positions[18] = max.x;\n                positions[19] = max.y;\n                positions[20] = min.z;\n                positions[21] = min.x;\n                positions[22] = max.y;\n                positions[23] = min.z;\n\n                // +x face\n                positions[24] = max.x;\n                positions[25] = min.y;\n                positions[26] = min.z;\n                positions[27] = max.x;\n                positions[28] = max.y;\n                positions[29] = min.z;\n                positions[30] = max.x;\n                positions[31] = max.y;\n                positions[32] = max.z;\n                positions[33] = max.x;\n                positions[34] = min.y;\n                positions[35] = max.z;\n\n                // -x face\n                positions[36] = min.x;\n                positions[37] = min.y;\n                positions[38] = min.z;\n                positions[39] = min.x;\n                positions[40] = max.y;\n                positions[41] = min.z;\n                positions[42] = min.x;\n                positions[43] = max.y;\n                positions[44] = max.z;\n                positions[45] = min.x;\n                positions[46] = min.y;\n                positions[47] = max.z;\n\n                // +y face\n                positions[48] = min.x;\n                positions[49] = max.y;\n                positions[50] = min.z;\n                positions[51] = max.x;\n                positions[52] = max.y;\n                positions[53] = min.z;\n                positions[54] = max.x;\n                positions[55] = max.y;\n                positions[56] = max.z;\n                positions[57] = min.x;\n                positions[58] = max.y;\n                positions[59] = max.z;\n\n                // -y face\n                positions[60] = min.x;\n                positions[61] = min.y;\n                positions[62] = min.z;\n                positions[63] = max.x;\n                positions[64] = min.y;\n                positions[65] = min.z;\n                positions[66] = max.x;\n                positions[67] = min.y;\n                positions[68] = max.z;\n                positions[69] = min.x;\n                positions[70] = min.y;\n                positions[71] = max.z;\n\n                attributes.position = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.DOUBLE,\n                    componentsPerAttribute : 3,\n                    values : positions\n                });\n            }\n\n            if (vertexFormat.normal) {\n                var normals = new Float32Array(6 * 4 * 3);\n\n                // +z face\n                normals[0]  = 0.0;\n                normals[1]  = 0.0;\n                normals[2]  = 1.0;\n                normals[3]  = 0.0;\n                normals[4]  = 0.0;\n                normals[5]  = 1.0;\n                normals[6]  = 0.0;\n                normals[7]  = 0.0;\n                normals[8]  = 1.0;\n                normals[9]  = 0.0;\n                normals[10] = 0.0;\n                normals[11] = 1.0;\n\n                // -z face\n                normals[12] = 0.0;\n                normals[13] = 0.0;\n                normals[14] = -1.0;\n                normals[15] = 0.0;\n                normals[16] = 0.0;\n                normals[17] = -1.0;\n                normals[18] = 0.0;\n                normals[19] = 0.0;\n                normals[20] = -1.0;\n                normals[21] = 0.0;\n                normals[22] = 0.0;\n                normals[23] = -1.0;\n\n                // +x face\n                normals[24] = 1.0;\n                normals[25] = 0.0;\n                normals[26] = 0.0;\n                normals[27] = 1.0;\n                normals[28] = 0.0;\n                normals[29] = 0.0;\n                normals[30] = 1.0;\n                normals[31] = 0.0;\n                normals[32] = 0.0;\n                normals[33] = 1.0;\n                normals[34] = 0.0;\n                normals[35] = 0.0;\n\n                // -x face\n                normals[36] = -1.0;\n                normals[37] = 0.0;\n                normals[38] = 0.0;\n                normals[39] = -1.0;\n                normals[40] = 0.0;\n                normals[41] = 0.0;\n                normals[42] = -1.0;\n                normals[43] = 0.0;\n                normals[44] = 0.0;\n                normals[45] = -1.0;\n                normals[46] = 0.0;\n                normals[47] = 0.0;\n\n                // +y face\n                normals[48] = 0.0;\n                normals[49] = 1.0;\n                normals[50] = 0.0;\n                normals[51] = 0.0;\n                normals[52] = 1.0;\n                normals[53] = 0.0;\n                normals[54] = 0.0;\n                normals[55] = 1.0;\n                normals[56] = 0.0;\n                normals[57] = 0.0;\n                normals[58] = 1.0;\n                normals[59] = 0.0;\n\n                // -y face\n                normals[60] = 0.0;\n                normals[61] = -1.0;\n                normals[62] = 0.0;\n                normals[63] = 0.0;\n                normals[64] = -1.0;\n                normals[65] = 0.0;\n                normals[66] = 0.0;\n                normals[67] = -1.0;\n                normals[68] = 0.0;\n                normals[69] = 0.0;\n                normals[70] = -1.0;\n                normals[71] = 0.0;\n\n                attributes.normal = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 3,\n                    values : normals\n                });\n            }\n\n            if (vertexFormat.st) {\n                var texCoords = new Float32Array(6 * 4 * 2);\n\n                // +z face\n                texCoords[0]  = 0.0;\n                texCoords[1]  = 0.0;\n                texCoords[2]  = 1.0;\n                texCoords[3]  = 0.0;\n                texCoords[4]  = 1.0;\n                texCoords[5]  = 1.0;\n                texCoords[6]  = 0.0;\n                texCoords[7]  = 1.0;\n\n                // -z face\n                texCoords[8]  = 1.0;\n                texCoords[9]  = 0.0;\n                texCoords[10] = 0.0;\n                texCoords[11] = 0.0;\n                texCoords[12] = 0.0;\n                texCoords[13] = 1.0;\n                texCoords[14] = 1.0;\n                texCoords[15] = 1.0;\n\n                //+x face\n                texCoords[16] = 0.0;\n                texCoords[17] = 0.0;\n                texCoords[18] = 1.0;\n                texCoords[19] = 0.0;\n                texCoords[20] = 1.0;\n                texCoords[21] = 1.0;\n                texCoords[22] = 0.0;\n                texCoords[23] = 1.0;\n\n                // -x face\n                texCoords[24] = 1.0;\n                texCoords[25] = 0.0;\n                texCoords[26] = 0.0;\n                texCoords[27] = 0.0;\n                texCoords[28] = 0.0;\n                texCoords[29] = 1.0;\n                texCoords[30] = 1.0;\n                texCoords[31] = 1.0;\n\n                // +y face\n                texCoords[32] = 1.0;\n                texCoords[33] = 0.0;\n                texCoords[34] = 0.0;\n                texCoords[35] = 0.0;\n                texCoords[36] = 0.0;\n                texCoords[37] = 1.0;\n                texCoords[38] = 1.0;\n                texCoords[39] = 1.0;\n\n                // -y face\n                texCoords[40] = 0.0;\n                texCoords[41] = 0.0;\n                texCoords[42] = 1.0;\n                texCoords[43] = 0.0;\n                texCoords[44] = 1.0;\n                texCoords[45] = 1.0;\n                texCoords[46] = 0.0;\n                texCoords[47] = 1.0;\n\n                attributes.st = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 2,\n                    values : texCoords\n                });\n            }\n\n            if (vertexFormat.tangent) {\n                var tangents = new Float32Array(6 * 4 * 3);\n\n                // +z face\n                tangents[0]  = 1.0;\n                tangents[1]  = 0.0;\n                tangents[2]  = 0.0;\n                tangents[3]  = 1.0;\n                tangents[4]  = 0.0;\n                tangents[5]  = 0.0;\n                tangents[6]  = 1.0;\n                tangents[7]  = 0.0;\n                tangents[8]  = 0.0;\n                tangents[9]  = 1.0;\n                tangents[10] = 0.0;\n                tangents[11] = 0.0;\n\n                // -z face\n                tangents[12] = -1.0;\n                tangents[13] = 0.0;\n                tangents[14] = 0.0;\n                tangents[15] = -1.0;\n                tangents[16] = 0.0;\n                tangents[17] = 0.0;\n                tangents[18] = -1.0;\n                tangents[19] = 0.0;\n                tangents[20] = 0.0;\n                tangents[21] = -1.0;\n                tangents[22] = 0.0;\n                tangents[23] = 0.0;\n\n                // +x face\n                tangents[24] = 0.0;\n                tangents[25] = 1.0;\n                tangents[26] = 0.0;\n                tangents[27] = 0.0;\n                tangents[28] = 1.0;\n                tangents[29] = 0.0;\n                tangents[30] = 0.0;\n                tangents[31] = 1.0;\n                tangents[32] = 0.0;\n                tangents[33] = 0.0;\n                tangents[34] = 1.0;\n                tangents[35] = 0.0;\n\n                // -x face\n                tangents[36] = 0.0;\n                tangents[37] = -1.0;\n                tangents[38] = 0.0;\n                tangents[39] = 0.0;\n                tangents[40] = -1.0;\n                tangents[41] = 0.0;\n                tangents[42] = 0.0;\n                tangents[43] = -1.0;\n                tangents[44] = 0.0;\n                tangents[45] = 0.0;\n                tangents[46] = -1.0;\n                tangents[47] = 0.0;\n\n                // +y face\n                tangents[48] = -1.0;\n                tangents[49] = 0.0;\n                tangents[50] = 0.0;\n                tangents[51] = -1.0;\n                tangents[52] = 0.0;\n                tangents[53] = 0.0;\n                tangents[54] = -1.0;\n                tangents[55] = 0.0;\n                tangents[56] = 0.0;\n                tangents[57] = -1.0;\n                tangents[58] = 0.0;\n                tangents[59] = 0.0;\n\n                // -y face\n                tangents[60] = 1.0;\n                tangents[61] = 0.0;\n                tangents[62] = 0.0;\n                tangents[63] = 1.0;\n                tangents[64] = 0.0;\n                tangents[65] = 0.0;\n                tangents[66] = 1.0;\n                tangents[67] = 0.0;\n                tangents[68] = 0.0;\n                tangents[69] = 1.0;\n                tangents[70] = 0.0;\n                tangents[71] = 0.0;\n\n                attributes.tangent = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 3,\n                    values : tangents\n                });\n            }\n\n            if (vertexFormat.bitangent) {\n                var bitangents = new Float32Array(6 * 4 * 3);\n\n                // +z face\n                bitangents[0] = 0.0;\n                bitangents[1] = 1.0;\n                bitangents[2] = 0.0;\n                bitangents[3] = 0.0;\n                bitangents[4] = 1.0;\n                bitangents[5] = 0.0;\n                bitangents[6] = 0.0;\n                bitangents[7] = 1.0;\n                bitangents[8] = 0.0;\n                bitangents[9] = 0.0;\n                bitangents[10] = 1.0;\n                bitangents[11] = 0.0;\n\n                // -z face\n                bitangents[12] = 0.0;\n                bitangents[13] = 1.0;\n                bitangents[14] = 0.0;\n                bitangents[15] = 0.0;\n                bitangents[16] = 1.0;\n                bitangents[17] = 0.0;\n                bitangents[18] = 0.0;\n                bitangents[19] = 1.0;\n                bitangents[20] = 0.0;\n                bitangents[21] = 0.0;\n                bitangents[22] = 1.0;\n                bitangents[23] = 0.0;\n\n                // +x face\n                bitangents[24] = 0.0;\n                bitangents[25] = 0.0;\n                bitangents[26] = 1.0;\n                bitangents[27] = 0.0;\n                bitangents[28] = 0.0;\n                bitangents[29] = 1.0;\n                bitangents[30] = 0.0;\n                bitangents[31] = 0.0;\n                bitangents[32] = 1.0;\n                bitangents[33] = 0.0;\n                bitangents[34] = 0.0;\n                bitangents[35] = 1.0;\n\n                // -x face\n                bitangents[36] = 0.0;\n                bitangents[37] = 0.0;\n                bitangents[38] = 1.0;\n                bitangents[39] = 0.0;\n                bitangents[40] = 0.0;\n                bitangents[41] = 1.0;\n                bitangents[42] = 0.0;\n                bitangents[43] = 0.0;\n                bitangents[44] = 1.0;\n                bitangents[45] = 0.0;\n                bitangents[46] = 0.0;\n                bitangents[47] = 1.0;\n\n                // +y face\n                bitangents[48] = 0.0;\n                bitangents[49] = 0.0;\n                bitangents[50] = 1.0;\n                bitangents[51] = 0.0;\n                bitangents[52] = 0.0;\n                bitangents[53] = 1.0;\n                bitangents[54] = 0.0;\n                bitangents[55] = 0.0;\n                bitangents[56] = 1.0;\n                bitangents[57] = 0.0;\n                bitangents[58] = 0.0;\n                bitangents[59] = 1.0;\n\n                // -y face\n                bitangents[60] = 0.0;\n                bitangents[61] = 0.0;\n                bitangents[62] = 1.0;\n                bitangents[63] = 0.0;\n                bitangents[64] = 0.0;\n                bitangents[65] = 1.0;\n                bitangents[66] = 0.0;\n                bitangents[67] = 0.0;\n                bitangents[68] = 1.0;\n                bitangents[69] = 0.0;\n                bitangents[70] = 0.0;\n                bitangents[71] = 1.0;\n\n                attributes.bitangent = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 3,\n                    values : bitangents\n                });\n            }\n\n            // 12 triangles:  6 faces, 2 triangles each.\n            indices = new Uint16Array(6 * 2 * 3);\n\n            // +z face\n            indices[0] = 0;\n            indices[1] = 1;\n            indices[2] = 2;\n            indices[3] = 0;\n            indices[4] = 2;\n            indices[5] = 3;\n\n            // -z face\n            indices[6] = 4 + 2;\n            indices[7] = 4 + 1;\n            indices[8] = 4 + 0;\n            indices[9] = 4 + 3;\n            indices[10] = 4 + 2;\n            indices[11] = 4 + 0;\n\n            // +x face\n            indices[12] = 8 + 0;\n            indices[13] = 8 + 1;\n            indices[14] = 8 + 2;\n            indices[15] = 8 + 0;\n            indices[16] = 8 + 2;\n            indices[17] = 8 + 3;\n\n            // -x face\n            indices[18] = 12 + 2;\n            indices[19] = 12 + 1;\n            indices[20] = 12 + 0;\n            indices[21] = 12 + 3;\n            indices[22] = 12 + 2;\n            indices[23] = 12 + 0;\n\n            // +y face\n            indices[24] = 16 + 2;\n            indices[25] = 16 + 1;\n            indices[26] = 16 + 0;\n            indices[27] = 16 + 3;\n            indices[28] = 16 + 2;\n            indices[29] = 16 + 0;\n\n            // -y face\n            indices[30] = 20 + 0;\n            indices[31] = 20 + 1;\n            indices[32] = 20 + 2;\n            indices[33] = 20 + 0;\n            indices[34] = 20 + 2;\n            indices[35] = 20 + 3;\n        } else {\n            // Positions only - no need to duplicate corner points\n            positions = new Float64Array(8 * 3);\n\n            positions[0] = min.x;\n            positions[1] = min.y;\n            positions[2] = min.z;\n            positions[3] = max.x;\n            positions[4] = min.y;\n            positions[5] = min.z;\n            positions[6] = max.x;\n            positions[7] = max.y;\n            positions[8] = min.z;\n            positions[9] = min.x;\n            positions[10] = max.y;\n            positions[11] = min.z;\n            positions[12] = min.x;\n            positions[13] = min.y;\n            positions[14] = max.z;\n            positions[15] = max.x;\n            positions[16] = min.y;\n            positions[17] = max.z;\n            positions[18] = max.x;\n            positions[19] = max.y;\n            positions[20] = max.z;\n            positions[21] = min.x;\n            positions[22] = max.y;\n            positions[23] = max.z;\n\n            attributes.position = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.DOUBLE,\n                componentsPerAttribute : 3,\n                values : positions\n            });\n\n            // 12 triangles:  6 faces, 2 triangles each.\n            indices = new Uint16Array(6 * 2 * 3);\n\n            // plane z = corner.Z\n            indices[0] = 4;\n            indices[1] = 5;\n            indices[2] = 6;\n            indices[3] = 4;\n            indices[4] = 6;\n            indices[5] = 7;\n\n            // plane z = -corner.Z\n            indices[6] = 1;\n            indices[7] = 0;\n            indices[8] = 3;\n            indices[9] = 1;\n            indices[10] = 3;\n            indices[11] = 2;\n\n            // plane x = corner.X\n            indices[12] = 1;\n            indices[13] = 6;\n            indices[14] = 5;\n            indices[15] = 1;\n            indices[16] = 2;\n            indices[17] = 6;\n\n            // plane y = corner.Y\n            indices[18] = 2;\n            indices[19] = 3;\n            indices[20] = 7;\n            indices[21] = 2;\n            indices[22] = 7;\n            indices[23] = 6;\n\n            // plane x = -corner.X\n            indices[24] = 3;\n            indices[25] = 0;\n            indices[26] = 4;\n            indices[27] = 3;\n            indices[28] = 4;\n            indices[29] = 7;\n\n            // plane y = -corner.Y\n            indices[30] = 0;\n            indices[31] = 1;\n            indices[32] = 5;\n            indices[33] = 0;\n            indices[34] = 5;\n            indices[35] = 4;\n        }\n\n        var diff = Cartesian3.subtract(max, min, diffScratch);\n        var radius = Cartesian3.magnitude(diff) * 0.5;\n\n        if (defined(boxGeometry._offsetAttribute)) {\n            var length = positions.length;\n            var applyOffset = new Uint8Array(length / 3);\n            var offsetValue = boxGeometry._offsetAttribute === GeometryOffsetAttribute.NONE ? 0 : 1;\n            arrayFill(applyOffset, offsetValue);\n            attributes.applyOffset = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                componentsPerAttribute : 1,\n                values: applyOffset\n            });\n        }\n\n        return new Geometry({\n            attributes : attributes,\n            indices : indices,\n            primitiveType : PrimitiveType.TRIANGLES,\n            boundingSphere : new BoundingSphere(Cartesian3.ZERO, radius),\n            offsetAttribute : boxGeometry._offsetAttribute\n        });\n    };\n\n    var unitBoxGeometry;\n\n    /**\n     * Returns the geometric representation of a unit box, including its vertices, indices, and a bounding sphere.\n     * @returns {Geometry} The computed vertices and indices.\n     *\n     * @private\n     */\n    BoxGeometry.getUnitBox = function() {\n        if (!defined(unitBoxGeometry)) {\n            unitBoxGeometry = BoxGeometry.createGeometry(BoxGeometry.fromDimensions({\n                dimensions : new Cartesian3(1.0, 1.0, 1.0),\n                vertexFormat : VertexFormat.POSITION_ONLY\n            }));\n        }\n        return unitBoxGeometry;\n    };\nexport default BoxGeometry;\n","import createGuid from '../Core/createGuid.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\n\n    /**\n     * A collection of primitives.  This is most often used with {@link Scene#primitives},\n     * but <code>PrimitiveCollection</code> is also a primitive itself so collections can\n     * be added to collections forming a hierarchy.\n     *\n     * @alias PrimitiveCollection\n     * @constructor\n     *\n     * @param {Object} [options] Object with the following properties:\n     * @param {Boolean} [options.show=true] Determines if the primitives in the collection will be shown.\n     * @param {Boolean} [options.destroyPrimitives=true] Determines if primitives in the collection are destroyed when they are removed.\n     *\n     * @example\n     * var billboards = new Cesium.BillboardCollection();\n     * var labels = new Cesium.LabelCollection();\n     *\n     * var collection = new Cesium.PrimitiveCollection();\n     * collection.add(billboards);\n     *\n     * scene.primitives.add(collection);  // Add collection\n     * scene.primitives.add(labels);      // Add regular primitive\n     */\n    function PrimitiveCollection(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        this._primitives = [];\n        this._guid = createGuid();\n\n        // Used by the OrderedGroundPrimitiveCollection\n        this._zIndex = undefined;\n\n        /**\n         * Determines if primitives in this collection will be shown.\n         *\n         * @type {Boolean}\n         * @default true\n         */\n        this.show = defaultValue(options.show, true);\n\n        /**\n         * Determines if primitives in the collection are destroyed when they are removed by\n         * {@link PrimitiveCollection#destroy} or  {@link PrimitiveCollection#remove} or implicitly\n         * by {@link PrimitiveCollection#removeAll}.\n         *\n         * @type {Boolean}\n         * @default true\n         *\n         * @example\n         * // Example 1. Primitives are destroyed by default.\n         * var primitives = new Cesium.PrimitiveCollection();\n         * var labels = primitives.add(new Cesium.LabelCollection());\n         * primitives = primitives.destroy();\n         * var b = labels.isDestroyed(); // true\n         *\n         * @example\n         * // Example 2. Do not destroy primitives in a collection.\n         * var primitives = new Cesium.PrimitiveCollection();\n         * primitives.destroyPrimitives = false;\n         * var labels = primitives.add(new Cesium.LabelCollection());\n         * primitives = primitives.destroy();\n         * var b = labels.isDestroyed(); // false\n         * labels = labels.destroy();    // explicitly destroy\n         */\n        this.destroyPrimitives = defaultValue(options.destroyPrimitives, true);\n    }\n\n    Object.defineProperties(PrimitiveCollection.prototype, {\n        /**\n         * Gets the number of primitives in the collection.\n         *\n         * @memberof PrimitiveCollection.prototype\n         *\n         * @type {Number}\n         * @readonly\n         */\n        length : {\n            get : function() {\n                return this._primitives.length;\n            }\n        }\n    });\n\n    /**\n     * Adds a primitive to the collection.\n     *\n     * @param {Object} primitive The primitive to add.\n     * @param {Number} [index] the index to add the layer at.  If omitted, the primitive will\n     *                         added at the bottom  of all existing primitives.\n     * @returns {Object} The primitive added to the collection.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     * @example\n     * var billboards = scene.primitives.add(new Cesium.BillboardCollection());\n     */\n    PrimitiveCollection.prototype.add = function(primitive, index) {\n        var hasIndex = defined(index);\n\n        \n\n        var external = (primitive._external = primitive._external || {});\n        var composites = (external._composites = external._composites || {});\n        composites[this._guid] = {\n            collection : this\n        };\n\n        if (!hasIndex) {\n            this._primitives.push(primitive);\n        } else {\n            this._primitives.splice(index, 0, primitive);\n        }\n\n        return primitive;\n    };\n\n    /**\n     * Removes a primitive from the collection.\n     *\n     * @param {Object} [primitive] The primitive to remove.\n     * @returns {Boolean} <code>true</code> if the primitive was removed; <code>false</code> if the primitive is <code>undefined</code> or was not found in the collection.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     *\n     * @example\n     * var billboards = scene.primitives.add(new Cesium.BillboardCollection());\n     * scene.primitives.remove(billboards);  // Returns true\n     *\n     * @see PrimitiveCollection#destroyPrimitives\n     */\n    PrimitiveCollection.prototype.remove = function(primitive) {\n        // PERFORMANCE_IDEA:  We can obviously make this a lot faster.\n        if (this.contains(primitive)) {\n            var index = this._primitives.indexOf(primitive);\n            if (index !== -1) {\n                this._primitives.splice(index, 1);\n\n                delete primitive._external._composites[this._guid];\n\n                if (this.destroyPrimitives) {\n                    primitive.destroy();\n                }\n\n                return true;\n            }\n            // else ... this is not possible, I swear.\n        }\n\n        return false;\n    };\n\n    /**\n     * Removes and destroys a primitive, regardless of destroyPrimitives setting.\n     * @private\n     */\n    PrimitiveCollection.prototype.removeAndDestroy = function(primitive) {\n        var removed = this.remove(primitive);\n        if (removed && !this.destroyPrimitives) {\n            primitive.destroy();\n        }\n        return removed;\n    };\n\n    /**\n     * Removes all primitives in the collection.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     * @see PrimitiveCollection#destroyPrimitives\n     */\n    PrimitiveCollection.prototype.removeAll = function() {\n        var primitives = this._primitives;\n        var length = primitives.length;\n        for (var i = 0; i < length; ++i) {\n            delete primitives[i]._external._composites[this._guid];\n            if (this.destroyPrimitives) {\n                primitives[i].destroy();\n            }\n        }\n        this._primitives = [];\n    };\n\n    /**\n     * Determines if this collection contains a primitive.\n     *\n     * @param {Object} [primitive] The primitive to check for.\n     * @returns {Boolean} <code>true</code> if the primitive is in the collection; <code>false</code> if the primitive is <code>undefined</code> or was not found in the collection.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     * @see PrimitiveCollection#get\n     */\n    PrimitiveCollection.prototype.contains = function(primitive) {\n        return !!(defined(primitive) &&\n                  primitive._external &&\n                  primitive._external._composites &&\n                  primitive._external._composites[this._guid]);\n    };\n\n    function getPrimitiveIndex(compositePrimitive, primitive) {\n        \n\n        return compositePrimitive._primitives.indexOf(primitive);\n    }\n\n    /**\n     * Raises a primitive \"up one\" in the collection.  If all primitives in the collection are drawn\n     * on the globe surface, this visually moves the primitive up one.\n     *\n     * @param {Object} [primitive] The primitive to raise.\n     *\n     * @exception {DeveloperError} primitive is not in this collection.\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     * @see PrimitiveCollection#raiseToTop\n     * @see PrimitiveCollection#lower\n     * @see PrimitiveCollection#lowerToBottom\n     */\n    PrimitiveCollection.prototype.raise = function(primitive) {\n        if (defined(primitive)) {\n            var index = getPrimitiveIndex(this, primitive);\n            var primitives = this._primitives;\n\n            if (index !== primitives.length - 1) {\n                var p = primitives[index];\n                primitives[index] = primitives[index + 1];\n                primitives[index + 1] = p;\n            }\n        }\n    };\n\n    /**\n     * Raises a primitive to the \"top\" of the collection.  If all primitives in the collection are drawn\n     * on the globe surface, this visually moves the primitive to the top.\n     *\n     * @param {Object} [primitive] The primitive to raise the top.\n     *\n     * @exception {DeveloperError} primitive is not in this collection.\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     * @see PrimitiveCollection#raise\n     * @see PrimitiveCollection#lower\n     * @see PrimitiveCollection#lowerToBottom\n     */\n    PrimitiveCollection.prototype.raiseToTop = function(primitive) {\n        if (defined(primitive)) {\n            var index = getPrimitiveIndex(this, primitive);\n            var primitives = this._primitives;\n\n            if (index !== primitives.length - 1) {\n                // PERFORMANCE_IDEA:  Could be faster\n                primitives.splice(index, 1);\n                primitives.push(primitive);\n            }\n        }\n    };\n\n    /**\n     * Lowers a primitive \"down one\" in the collection.  If all primitives in the collection are drawn\n     * on the globe surface, this visually moves the primitive down one.\n     *\n     * @param {Object} [primitive] The primitive to lower.\n     *\n     * @exception {DeveloperError} primitive is not in this collection.\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     * @see PrimitiveCollection#lowerToBottom\n     * @see PrimitiveCollection#raise\n     * @see PrimitiveCollection#raiseToTop\n     */\n    PrimitiveCollection.prototype.lower = function(primitive) {\n        if (defined(primitive)) {\n            var index = getPrimitiveIndex(this, primitive);\n            var primitives = this._primitives;\n\n            if (index !== 0) {\n                var p = primitives[index];\n                primitives[index] = primitives[index - 1];\n                primitives[index - 1] = p;\n            }\n        }\n    };\n\n    /**\n     * Lowers a primitive to the \"bottom\" of the collection.  If all primitives in the collection are drawn\n     * on the globe surface, this visually moves the primitive to the bottom.\n     *\n     * @param {Object} [primitive] The primitive to lower to the bottom.\n     *\n     * @exception {DeveloperError} primitive is not in this collection.\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     * @see PrimitiveCollection#lower\n     * @see PrimitiveCollection#raise\n     * @see PrimitiveCollection#raiseToTop\n     */\n    PrimitiveCollection.prototype.lowerToBottom = function(primitive) {\n        if (defined(primitive)) {\n            var index = getPrimitiveIndex(this, primitive);\n            var primitives = this._primitives;\n\n            if (index !== 0) {\n                // PERFORMANCE_IDEA:  Could be faster\n                primitives.splice(index, 1);\n                primitives.unshift(primitive);\n            }\n        }\n    };\n\n    /**\n     * Returns the primitive in the collection at the specified index.\n     *\n     * @param {Number} index The zero-based index of the primitive to return.\n     * @returns {Object} The primitive at the <code>index</code>.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     *\n     * @example\n     * // Toggle the show property of every primitive in the collection.\n     * var primitives = scene.primitives;\n     * var length = primitives.length;\n     * for (var i = 0; i < length; ++i) {\n     *   var p = primitives.get(i);\n     *   p.show = !p.show;\n     * }\n     *\n     * @see PrimitiveCollection#length\n     */\n    PrimitiveCollection.prototype.get = function(index) {\n        \n\n        return this._primitives[index];\n    };\n\n    /**\n     * @private\n     */\n    PrimitiveCollection.prototype.update = function(frameState) {\n        if (!this.show) {\n            return;\n        }\n\n        var primitives = this._primitives;\n        // Using primitives.length in the loop is a temporary workaround\n        // to allow quadtree updates to add and remove primitives in\n        // update().  This will be changed to manage added and removed lists.\n        for (var i = 0; i < primitives.length; ++i) {\n            primitives[i].update(frameState);\n        }\n    };\n\n    /**\n     * @private\n     */\n    PrimitiveCollection.prototype.prePassesUpdate = function(frameState) {\n        var primitives = this._primitives;\n        // Using primitives.length in the loop is a temporary workaround\n        // to allow quadtree updates to add and remove primitives in\n        // update().  This will be changed to manage added and removed lists.\n        for (var i = 0; i < primitives.length; ++i) {\n            var primitive = primitives[i];\n            if (defined(primitive.prePassesUpdate)) {\n                primitive.prePassesUpdate(frameState);\n            }\n        }\n    };\n\n    /**\n     * @private\n     */\n    PrimitiveCollection.prototype.updateForPass = function(frameState, passState) {\n        var primitives = this._primitives;\n        // Using primitives.length in the loop is a temporary workaround\n        // to allow quadtree updates to add and remove primitives in\n        // update().  This will be changed to manage added and removed lists.\n        for (var i = 0; i < primitives.length; ++i) {\n            var primitive = primitives[i];\n            if (defined(primitive.updateForPass)) {\n                primitive.updateForPass(frameState, passState);\n            }\n        }\n    };\n\n    /**\n     * @private\n     */\n    PrimitiveCollection.prototype.postPassesUpdate = function(frameState) {\n        var primitives = this._primitives;\n        // Using primitives.length in the loop is a temporary workaround\n        // to allow quadtree updates to add and remove primitives in\n        // update().  This will be changed to manage added and removed lists.\n        for (var i = 0; i < primitives.length; ++i) {\n            var primitive = primitives[i];\n            if (defined(primitive.postPassesUpdate)) {\n                primitive.postPassesUpdate(frameState);\n            }\n        }\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <br /><br />\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     *\n     * @returns {Boolean} True if this object was destroyed; otherwise, false.\n     *\n     * @see PrimitiveCollection#destroy\n     */\n    PrimitiveCollection.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the WebGL resources held by each primitive in this collection.  Explicitly destroying this\n     * collection allows for deterministic release of WebGL resources, instead of relying on the garbage\n     * collector to destroy this collection.\n     * <br /><br />\n     * Since destroying a collection destroys all the contained primitives, only destroy a collection\n     * when you are sure no other code is still using any of the contained primitives.\n     * <br /><br />\n     * Once this collection is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     *\n     * @example\n     * primitives = primitives && primitives.destroy();\n     *\n     * @see PrimitiveCollection#isDestroyed\n     */\n    PrimitiveCollection.prototype.destroy = function() {\n        this.removeAll();\n        return destroyObject(this);\n    };\nexport default PrimitiveCollection;\n","import defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport Ellipsoid from '../Core/Ellipsoid.js';\nimport Event from '../Core/Event.js';\nimport ReferenceFrame from '../Core/ReferenceFrame.js';\nimport Property from './Property.js';\n\n    /**\n     * This is a temporary class for scaling position properties to the WGS84 surface.\n     * It will go away or be refactored to support data with arbitrary height references.\n     * @private\n     */\n    function ScaledPositionProperty(value) {\n        this._definitionChanged = new Event();\n        this._value = undefined;\n        this._removeSubscription = undefined;\n        this.setValue(value);\n    }\n\n    Object.defineProperties(ScaledPositionProperty.prototype, {\n        isConstant : {\n            get : function() {\n                return Property.isConstant(this._value);\n            }\n        },\n        definitionChanged : {\n            get : function() {\n                return this._definitionChanged;\n            }\n        },\n        referenceFrame : {\n            get : function() {\n                return defined(this._value) ? this._value.referenceFrame : ReferenceFrame.FIXED;\n            }\n        }\n    });\n\n    ScaledPositionProperty.prototype.getValue = function(time, result) {\n        return this.getValueInReferenceFrame(time, ReferenceFrame.FIXED, result);\n    };\n\n    ScaledPositionProperty.prototype.setValue = function(value) {\n        if (this._value !== value) {\n            this._value = value;\n\n            if (defined(this._removeSubscription)) {\n                this._removeSubscription();\n                this._removeSubscription = undefined;\n            }\n\n            if (defined(value)) {\n                this._removeSubscription = value.definitionChanged.addEventListener(this._raiseDefinitionChanged, this);\n            }\n            this._definitionChanged.raiseEvent(this);\n        }\n    };\n\n    ScaledPositionProperty.prototype.getValueInReferenceFrame = function(time, referenceFrame, result) {\n        \n\n        if (!defined(this._value)) {\n            return undefined;\n        }\n\n        result = this._value.getValueInReferenceFrame(time, referenceFrame, result);\n        return defined(result) ? Ellipsoid.WGS84.scaleToGeodeticSurface(result, result) : undefined;\n    };\n\n    ScaledPositionProperty.prototype.equals = function(other) {\n        return this === other || (other instanceof ScaledPositionProperty && this._value === other._value);\n    };\n\n    ScaledPositionProperty.prototype._raiseDefinitionChanged = function() {\n        this._definitionChanged.raiseEvent(this);\n    };\nexport default ScaledPositionProperty;\n","import arrayFill from './arrayFill.js';\nimport BoundingSphere from './BoundingSphere.js';\nimport Cartesian2 from './Cartesian2.js';\nimport Cartesian3 from './Cartesian3.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport DeveloperError from './DeveloperError.js';\nimport Ellipsoid from './Ellipsoid.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport GeometryOffsetAttribute from './GeometryOffsetAttribute.js';\nimport IndexDatatype from './IndexDatatype.js';\nimport CesiumMath from './Math.js';\nimport PrimitiveType from './PrimitiveType.js';\nimport VertexFormat from './VertexFormat.js';\n\n    var scratchPosition = new Cartesian3();\n    var scratchNormal = new Cartesian3();\n    var scratchTangent = new Cartesian3();\n    var scratchBitangent = new Cartesian3();\n    var scratchNormalST = new Cartesian3();\n    var defaultRadii = new Cartesian3(1.0, 1.0, 1.0);\n\n    var cos = Math.cos;\n    var sin = Math.sin;\n\n    /**\n     * A description of an ellipsoid centered at the origin.\n     *\n     * @alias EllipsoidGeometry\n     * @constructor\n     *\n     * @param {Object} [options] Object with the following properties:\n     * @param {Cartesian3} [options.radii=Cartesian3(1.0, 1.0, 1.0)] The radii of the ellipsoid in the x, y, and z directions.\n     * @param {Cartesian3} [options.innerRadii=options.radii] The inner radii of the ellipsoid in the x, y, and z directions.\n     * @param {Number} [options.minimumClock=0.0] The minimum angle lying in the xy-plane measured from the positive x-axis and toward the positive y-axis.\n     * @param {Number} [options.maximumClock=2*PI] The maximum angle lying in the xy-plane measured from the positive x-axis and toward the positive y-axis.\n     * @param {Number} [options.minimumCone=0.0] The minimum angle measured from the positive z-axis and toward the negative z-axis.\n     * @param {Number} [options.maximumCone=PI] The maximum angle measured from the positive z-axis and toward the negative z-axis.\n     * @param {Number} [options.stackPartitions=64] The number of times to partition the ellipsoid into stacks.\n     * @param {Number} [options.slicePartitions=64] The number of times to partition the ellipsoid into radial slices.\n     * @param {VertexFormat} [options.vertexFormat=VertexFormat.DEFAULT] The vertex attributes to be computed.\n     *\n     * @exception {DeveloperError} options.slicePartitions cannot be less than three.\n     * @exception {DeveloperError} options.stackPartitions cannot be less than three.\n     *\n     * @see EllipsoidGeometry#createGeometry\n     *\n     * @example\n     * var ellipsoid = new Cesium.EllipsoidGeometry({\n     *   vertexFormat : Cesium.VertexFormat.POSITION_ONLY,\n     *   radii : new Cesium.Cartesian3(1000000.0, 500000.0, 500000.0)\n     * });\n     * var geometry = Cesium.EllipsoidGeometry.createGeometry(ellipsoid);\n     */\n    function EllipsoidGeometry(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        var radii = defaultValue(options.radii, defaultRadii);\n        var innerRadii = defaultValue(options.innerRadii, radii);\n        var minimumClock = defaultValue(options.minimumClock, 0.0);\n        var maximumClock = defaultValue(options.maximumClock, CesiumMath.TWO_PI);\n        var minimumCone = defaultValue(options.minimumCone, 0.0);\n        var maximumCone = defaultValue(options.maximumCone, CesiumMath.PI);\n        var stackPartitions = Math.round(defaultValue(options.stackPartitions, 64));\n        var slicePartitions = Math.round(defaultValue(options.slicePartitions, 64));\n        var vertexFormat = defaultValue(options.vertexFormat, VertexFormat.DEFAULT);\n\n        \n\n        this._radii = Cartesian3.clone(radii);\n        this._innerRadii = Cartesian3.clone(innerRadii);\n        this._minimumClock = minimumClock;\n        this._maximumClock = maximumClock;\n        this._minimumCone = minimumCone;\n        this._maximumCone = maximumCone;\n        this._stackPartitions = stackPartitions;\n        this._slicePartitions = slicePartitions;\n        this._vertexFormat = VertexFormat.clone(vertexFormat);\n        this._offsetAttribute = options.offsetAttribute;\n        this._workerName = 'createEllipsoidGeometry';\n    }\n\n    /**\n     * The number of elements used to pack the object into an array.\n     * @type {Number}\n     */\n    EllipsoidGeometry.packedLength = 2 * (Cartesian3.packedLength) + VertexFormat.packedLength + 7;\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {EllipsoidGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    EllipsoidGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        Cartesian3.pack(value._radii, array, startingIndex);\n        startingIndex += Cartesian3.packedLength;\n\n        Cartesian3.pack(value._innerRadii, array, startingIndex);\n        startingIndex += Cartesian3.packedLength;\n\n        VertexFormat.pack(value._vertexFormat, array, startingIndex);\n        startingIndex += VertexFormat.packedLength;\n\n        array[startingIndex++] = value._minimumClock;\n        array[startingIndex++] = value._maximumClock;\n        array[startingIndex++] = value._minimumCone;\n        array[startingIndex++] = value._maximumCone;\n        array[startingIndex++] = value._stackPartitions;\n        array[startingIndex++] = value._slicePartitions;\n        array[startingIndex] = defaultValue(value._offsetAttribute, -1);\n\n        return array;\n    };\n\n    var scratchRadii = new Cartesian3();\n    var scratchInnerRadii = new Cartesian3();\n    var scratchVertexFormat = new VertexFormat();\n    var scratchOptions = {\n        radii : scratchRadii,\n        innerRadii : scratchInnerRadii,\n        vertexFormat : scratchVertexFormat,\n        minimumClock : undefined,\n        maximumClock : undefined,\n        minimumCone : undefined,\n        maximumCone : undefined,\n        stackPartitions : undefined,\n        slicePartitions : undefined,\n        offsetAttribute : undefined\n    };\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {EllipsoidGeometry} [result] The object into which to store the result.\n     * @returns {EllipsoidGeometry} The modified result parameter or a new EllipsoidGeometry instance if one was not provided.\n     */\n    EllipsoidGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var radii = Cartesian3.unpack(array, startingIndex, scratchRadii);\n        startingIndex += Cartesian3.packedLength;\n\n        var innerRadii = Cartesian3.unpack(array, startingIndex, scratchInnerRadii);\n        startingIndex += Cartesian3.packedLength;\n\n        var vertexFormat = VertexFormat.unpack(array, startingIndex, scratchVertexFormat);\n        startingIndex += VertexFormat.packedLength;\n\n        var minimumClock = array[startingIndex++];\n        var maximumClock = array[startingIndex++];\n        var minimumCone = array[startingIndex++];\n        var maximumCone = array[startingIndex++];\n        var stackPartitions = array[startingIndex++];\n        var slicePartitions = array[startingIndex++];\n        var offsetAttribute = array[startingIndex];\n\n        if (!defined(result)) {\n            scratchOptions.minimumClock = minimumClock;\n            scratchOptions.maximumClock = maximumClock;\n            scratchOptions.minimumCone = minimumCone;\n            scratchOptions.maximumCone = maximumCone;\n            scratchOptions.stackPartitions = stackPartitions;\n            scratchOptions.slicePartitions = slicePartitions;\n            scratchOptions.offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n            return new EllipsoidGeometry(scratchOptions);\n        }\n\n        result._radii = Cartesian3.clone(radii, result._radii);\n        result._innerRadii = Cartesian3.clone(innerRadii, result._innerRadii);\n        result._vertexFormat = VertexFormat.clone(vertexFormat, result._vertexFormat);\n        result._minimumClock = minimumClock;\n        result._maximumClock = maximumClock;\n        result._minimumCone = minimumCone;\n        result._maximumCone = maximumCone;\n        result._stackPartitions = stackPartitions;\n        result._slicePartitions = slicePartitions;\n        result._offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n\n        return result;\n    };\n\n    /**\n     * Computes the geometric representation of an ellipsoid, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {EllipsoidGeometry} ellipsoidGeometry A description of the ellipsoid.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    EllipsoidGeometry.createGeometry = function(ellipsoidGeometry) {\n        var radii = ellipsoidGeometry._radii;\n        if ((radii.x <= 0) || (radii.y <= 0) || (radii.z <= 0)) {\n            return;\n        }\n\n        var innerRadii = ellipsoidGeometry._innerRadii;\n        if ((innerRadii.x <= 0) || (innerRadii.y <= 0) || innerRadii.z <= 0) {\n            return;\n        }\n\n        var minimumClock = ellipsoidGeometry._minimumClock;\n        var maximumClock = ellipsoidGeometry._maximumClock;\n        var minimumCone = ellipsoidGeometry._minimumCone;\n        var maximumCone = ellipsoidGeometry._maximumCone;\n        var vertexFormat = ellipsoidGeometry._vertexFormat;\n\n        // Add an extra slice and stack so that the number of partitions is the\n        // number of surfaces rather than the number of joints\n        var slicePartitions = ellipsoidGeometry._slicePartitions + 1;\n        var stackPartitions = ellipsoidGeometry._stackPartitions + 1;\n\n        slicePartitions = Math.round(slicePartitions * Math.abs(maximumClock - minimumClock) / CesiumMath.TWO_PI);\n        stackPartitions = Math.round(stackPartitions * Math.abs(maximumCone - minimumCone) / CesiumMath.PI);\n\n        if (slicePartitions < 2) {\n            slicePartitions = 2;\n        }\n        if (stackPartitions < 2) {\n            stackPartitions = 2;\n        }\n\n        var i;\n        var j;\n        var index = 0;\n\n        // Create arrays for theta and phi. Duplicate first and last angle to\n        // allow different normals at the intersections.\n        var phis = [minimumCone];\n        var thetas = [minimumClock];\n        for (i = 0; i < stackPartitions; i++) {\n            phis.push(minimumCone + i * (maximumCone - minimumCone) / (stackPartitions - 1));\n        }\n        phis.push(maximumCone);\n        for (j = 0; j < slicePartitions; j++) {\n            thetas.push(minimumClock + j * (maximumClock - minimumClock) / (slicePartitions - 1));\n        }\n        thetas.push(maximumClock);\n        var numPhis = phis.length;\n        var numThetas = thetas.length;\n\n        // Allow for extra indices if there is an inner surface and if we need\n        // to close the sides if the clock range is not a full circle\n        var extraIndices = 0;\n        var vertexMultiplier = 1.0;\n        var hasInnerSurface = ((innerRadii.x !== radii.x) || (innerRadii.y !== radii.y) || innerRadii.z !== radii.z);\n        var isTopOpen = false;\n        var isBotOpen = false;\n        var isClockOpen = false;\n        if (hasInnerSurface) {\n            vertexMultiplier = 2.0;\n            if (minimumCone > 0.0) {\n                isTopOpen = true;\n                extraIndices += (slicePartitions - 1);\n            }\n            if (maximumCone < Math.PI) {\n                isBotOpen = true;\n                extraIndices += (slicePartitions - 1);\n            }\n            if ((maximumClock - minimumClock) % CesiumMath.TWO_PI) {\n                isClockOpen = true;\n                extraIndices += ((stackPartitions - 1) * 2) + 1;\n            } else {\n                extraIndices += 1;\n            }\n        }\n\n        var vertexCount = numThetas * numPhis * vertexMultiplier;\n        var positions = new Float64Array(vertexCount * 3);\n        var isInner = arrayFill(new Array(vertexCount), false);\n        var negateNormal = arrayFill(new Array(vertexCount), false);\n\n        // Multiply by 6 because there are two triangles per sector\n        var indexCount = slicePartitions * stackPartitions * vertexMultiplier;\n        var numIndices = 6 * (indexCount + extraIndices + 1 - (slicePartitions + stackPartitions) * vertexMultiplier);\n        var indices = IndexDatatype.createTypedArray(indexCount, numIndices);\n\n        var normals = (vertexFormat.normal) ? new Float32Array(vertexCount * 3) : undefined;\n        var tangents = (vertexFormat.tangent) ? new Float32Array(vertexCount * 3) : undefined;\n        var bitangents = (vertexFormat.bitangent) ? new Float32Array(vertexCount * 3) : undefined;\n        var st = (vertexFormat.st) ? new Float32Array(vertexCount * 2) : undefined;\n\n        // Calculate sin/cos phi\n        var sinPhi = new Array(numPhis);\n        var cosPhi = new Array(numPhis);\n        for (i = 0; i < numPhis; i++) {\n            sinPhi[i] = sin(phis[i]);\n            cosPhi[i] = cos(phis[i]);\n        }\n\n        // Calculate sin/cos theta\n        var sinTheta = new Array(numThetas);\n        var cosTheta = new Array(numThetas);\n        for (j = 0; j < numThetas; j++) {\n            cosTheta[j] = cos(thetas[j]);\n            sinTheta[j] = sin(thetas[j]);\n        }\n\n        // Create outer surface\n        for (i = 0; i < numPhis; i++) {\n            for (j = 0; j < numThetas; j++) {\n                positions[index++] = radii.x * sinPhi[i] * cosTheta[j];\n                positions[index++] = radii.y * sinPhi[i] * sinTheta[j];\n                positions[index++] = radii.z * cosPhi[i];\n            }\n        }\n\n        // Create inner surface\n        var vertexIndex = vertexCount / 2.0;\n        if (hasInnerSurface) {\n            for (i = 0; i < numPhis; i++) {\n                for (j = 0; j < numThetas; j++) {\n                    positions[index++] = innerRadii.x * sinPhi[i] * cosTheta[j];\n                    positions[index++] = innerRadii.y * sinPhi[i] * sinTheta[j];\n                    positions[index++] = innerRadii.z * cosPhi[i];\n\n                    // Keep track of which vertices are the inner and which ones\n                    // need the normal to be negated\n                    isInner[vertexIndex] = true;\n                    if (i > 0 && i !== (numPhis - 1) && j !== 0 && j !== (numThetas - 1)) {\n                        negateNormal[vertexIndex] = true;\n                    }\n                    vertexIndex++;\n                }\n            }\n        }\n\n        // Create indices for outer surface\n        index = 0;\n        var topOffset;\n        var bottomOffset;\n        for (i = 1; i < (numPhis - 2); i++) {\n            topOffset = i * numThetas;\n            bottomOffset = (i + 1) * numThetas;\n\n            for (j = 1; j < numThetas - 2; j++) {\n                indices[index++] = bottomOffset + j;\n                indices[index++] = bottomOffset + j + 1;\n                indices[index++] = topOffset + j + 1;\n\n                indices[index++] = bottomOffset + j;\n                indices[index++] = topOffset + j + 1;\n                indices[index++] = topOffset + j;\n            }\n        }\n\n        // Create indices for inner surface\n        if (hasInnerSurface) {\n            var offset = numPhis * numThetas;\n            for (i = 1; i < (numPhis - 2); i++) {\n                topOffset = offset + i * numThetas;\n                bottomOffset = offset + (i + 1) * numThetas;\n\n                for (j = 1; j < numThetas - 2; j++) {\n                    indices[index++] = bottomOffset + j;\n                    indices[index++] = topOffset + j;\n                    indices[index++] = topOffset + j + 1;\n\n                    indices[index++] = bottomOffset + j;\n                    indices[index++] = topOffset + j + 1;\n                    indices[index++] = bottomOffset + j + 1;\n                }\n            }\n        }\n\n        var outerOffset;\n        var innerOffset;\n        if (hasInnerSurface) {\n            if (isTopOpen) {\n                // Connect the top of the inner surface to the top of the outer surface\n                innerOffset = numPhis * numThetas;\n                for (i = 1; i < numThetas - 2; i++) {\n                    indices[index++] = i;\n                    indices[index++] = i + 1;\n                    indices[index++] = innerOffset + i + 1;\n\n                    indices[index++] = i;\n                    indices[index++] = innerOffset + i + 1;\n                    indices[index++] = innerOffset + i;\n                }\n            }\n\n            if (isBotOpen) {\n                // Connect the bottom of the inner surface to the bottom of the outer surface\n                outerOffset = numPhis * numThetas - numThetas;\n                innerOffset = numPhis * numThetas * vertexMultiplier - numThetas;\n                for (i = 1; i < numThetas - 2; i++) {\n                    indices[index++] = outerOffset + i + 1;\n                    indices[index++] = outerOffset + i;\n                    indices[index++] = innerOffset + i;\n\n                    indices[index++] = outerOffset + i + 1;\n                    indices[index++] = innerOffset + i;\n                    indices[index++] = innerOffset + i + 1;\n                }\n            }\n        }\n\n        // Connect the edges if clock is not closed\n        if (isClockOpen) {\n            for (i = 1; i < numPhis - 2; i++) {\n                innerOffset = numThetas * numPhis + (numThetas * i);\n                outerOffset = numThetas * i;\n                indices[index++] = innerOffset;\n                indices[index++] = outerOffset + numThetas;\n                indices[index++] = outerOffset;\n\n                indices[index++] = innerOffset;\n                indices[index++] = innerOffset + numThetas;\n                indices[index++] = outerOffset + numThetas;\n            }\n\n            for (i = 1; i < numPhis - 2; i++) {\n                innerOffset = numThetas * numPhis + (numThetas * (i + 1)) - 1;\n                outerOffset = numThetas * (i + 1) - 1;\n                indices[index++] = outerOffset + numThetas;\n                indices[index++] = innerOffset;\n                indices[index++] = outerOffset;\n\n                indices[index++] = outerOffset + numThetas;\n                indices[index++] = innerOffset + numThetas;\n                indices[index++] = innerOffset;\n            }\n        }\n\n        var attributes = new GeometryAttributes();\n\n        if (vertexFormat.position) {\n            attributes.position = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.DOUBLE,\n                componentsPerAttribute : 3,\n                values : positions\n            });\n        }\n\n        var stIndex = 0;\n        var normalIndex = 0;\n        var tangentIndex = 0;\n        var bitangentIndex = 0;\n        var vertexCountHalf = vertexCount / 2.0;\n\n        var ellipsoid;\n        var ellipsoidOuter = Ellipsoid.fromCartesian3(radii);\n        var ellipsoidInner = Ellipsoid.fromCartesian3(innerRadii);\n\n        if (vertexFormat.st || vertexFormat.normal || vertexFormat.tangent || vertexFormat.bitangent) {\n            for (i = 0; i < vertexCount; i++) {\n                ellipsoid = (isInner[i]) ? ellipsoidInner : ellipsoidOuter;\n                var position = Cartesian3.fromArray(positions, i * 3, scratchPosition);\n                var normal = ellipsoid.geodeticSurfaceNormal(position, scratchNormal);\n                if (negateNormal[i]) {\n                    Cartesian3.negate(normal, normal);\n                }\n\n                if (vertexFormat.st) {\n                    var normalST = Cartesian2.negate(normal, scratchNormalST);\n                    st[stIndex++] = (Math.atan2(normalST.y, normalST.x) / CesiumMath.TWO_PI) + 0.5;\n                    st[stIndex++] = (Math.asin(normal.z) / Math.PI) + 0.5;\n                }\n\n                if (vertexFormat.normal) {\n                    normals[normalIndex++] = normal.x;\n                    normals[normalIndex++] = normal.y;\n                    normals[normalIndex++] = normal.z;\n                }\n\n                if (vertexFormat.tangent || vertexFormat.bitangent) {\n                    var tangent = scratchTangent;\n\n                    // Use UNIT_X for the poles\n                    var tangetOffset = 0;\n                    var unit;\n                    if (isInner[i]) {\n                        tangetOffset = vertexCountHalf;\n                    }\n                    if ((!isTopOpen && (i >= tangetOffset && i < (tangetOffset + numThetas * 2)))) {\n                        unit = Cartesian3.UNIT_X;\n                    } else {\n                        unit = Cartesian3.UNIT_Z;\n                    }\n                    Cartesian3.cross(unit, normal, tangent);\n                    Cartesian3.normalize(tangent, tangent);\n\n                    if (vertexFormat.tangent) {\n                        tangents[tangentIndex++] = tangent.x;\n                        tangents[tangentIndex++] = tangent.y;\n                        tangents[tangentIndex++] = tangent.z;\n                    }\n\n                    if (vertexFormat.bitangent) {\n                        var bitangent = Cartesian3.cross(normal, tangent, scratchBitangent);\n                        Cartesian3.normalize(bitangent, bitangent);\n\n                        bitangents[bitangentIndex++] = bitangent.x;\n                        bitangents[bitangentIndex++] = bitangent.y;\n                        bitangents[bitangentIndex++] = bitangent.z;\n                    }\n                }\n            }\n\n            if (vertexFormat.st) {\n                attributes.st = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 2,\n                    values : st\n                });\n            }\n\n            if (vertexFormat.normal) {\n                attributes.normal = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 3,\n                    values : normals\n                });\n            }\n\n            if (vertexFormat.tangent) {\n                attributes.tangent = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 3,\n                    values : tangents\n                });\n            }\n\n            if (vertexFormat.bitangent) {\n                attributes.bitangent = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 3,\n                    values : bitangents\n                });\n            }\n        }\n\n        if (defined(ellipsoidGeometry._offsetAttribute)) {\n            var length = positions.length;\n            var applyOffset = new Uint8Array(length / 3);\n            var offsetValue = ellipsoidGeometry._offsetAttribute === GeometryOffsetAttribute.NONE ? 0 : 1;\n            arrayFill(applyOffset, offsetValue);\n            attributes.applyOffset = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                componentsPerAttribute : 1,\n                values : applyOffset\n            });\n        }\n\n        return new Geometry({\n            attributes : attributes,\n            indices : indices,\n            primitiveType : PrimitiveType.TRIANGLES,\n            boundingSphere : BoundingSphere.fromEllipsoid(ellipsoidOuter),\n            offsetAttribute : ellipsoidGeometry._offsetAttribute\n        });\n    };\n\n    var unitEllipsoidGeometry;\n\n    /**\n     * Returns the geometric representation of a unit ellipsoid, including its vertices, indices, and a bounding sphere.\n     * @returns {Geometry} The computed vertices and indices.\n     *\n     * @private\n     */\n    EllipsoidGeometry.getUnitEllipsoid = function() {\n        if (!defined(unitEllipsoidGeometry)) {\n            unitEllipsoidGeometry = EllipsoidGeometry.createGeometry((new EllipsoidGeometry({\n                radii : new Cartesian3(1.0, 1.0, 1.0),\n                vertexFormat : VertexFormat.POSITION_ONLY\n            })));\n        }\n        return unitEllipsoidGeometry;\n    };\nexport default EllipsoidGeometry;\n","\"use strict\";\n/*global require*/\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nvar BoundingSphere = require(\"terriajs-cesium/Source/Core/BoundingSphere\")[\"default\"];\n\nvar BoundingSphereState = require(\"terriajs-cesium/Source/DataSources/BoundingSphereState\")[\"default\"];\n\nvar Cartesian2 = require(\"terriajs-cesium/Source/Core/Cartesian2\")[\"default\"];\n\nvar Cartesian3 = require(\"terriajs-cesium/Source/Core/Cartesian3\")[\"default\"];\n\nvar Cartographic = require(\"terriajs-cesium/Source/Core/Cartographic\")[\"default\"];\n\nvar CesiumMath = require(\"terriajs-cesium/Source/Core/Math\")[\"default\"];\n\nvar defaultValue = require(\"terriajs-cesium/Source/Core/defaultValue\")[\"default\"];\n\nvar defined = require(\"terriajs-cesium/Source/Core/defined\")[\"default\"];\n\nvar destroyObject = require(\"terriajs-cesium/Source/Core/destroyObject\")[\"default\"];\n\nvar DeveloperError = require(\"terriajs-cesium/Source/Core/DeveloperError\")[\"default\"];\n\nvar Ellipsoid = require(\"terriajs-cesium/Source/Core/Ellipsoid\")[\"default\"];\n\nvar Entity = require(\"terriajs-cesium/Source/DataSources/Entity\")[\"default\"];\n\nvar formatError = require(\"terriajs-cesium/Source/Core/formatError\")[\"default\"];\n\nvar getTimestamp = require(\"terriajs-cesium/Source/Core/getTimestamp\")[\"default\"];\n\nvar HeadingPitchRange = require(\"terriajs-cesium/Source/Core/HeadingPitchRange\")[\"default\"];\n\nvar ImageryLayer = require(\"terriajs-cesium/Source/Scene/ImageryLayer\")[\"default\"];\n\nvar JulianDate = require(\"terriajs-cesium/Source/Core/JulianDate\")[\"default\"];\n\nvar knockout = require(\"terriajs-cesium/Source/ThirdParty/knockout\")[\"default\"];\n\nvar loadWithXhr = require(\"../Core/loadWithXhr\");\n\nvar Matrix4 = require(\"terriajs-cesium/Source/Core/Matrix4\")[\"default\"];\n\nvar Rectangle = require(\"terriajs-cesium/Source/Core/Rectangle\")[\"default\"];\n\nvar sampleTerrain = require(\"terriajs-cesium/Source/Core/sampleTerrain\")[\"default\"];\n\nvar SceneTransforms = require(\"terriajs-cesium/Source/Scene/SceneTransforms\")[\"default\"];\n\nvar ScreenSpaceEventType = require(\"terriajs-cesium/Source/Core/ScreenSpaceEventType\")[\"default\"];\n\nvar TaskProcessor = require(\"terriajs-cesium/Source/Core/TaskProcessor\")[\"default\"];\n\nvar Transforms = require(\"terriajs-cesium/Source/Core/Transforms\")[\"default\"];\n\nvar when = require(\"terriajs-cesium/Source/ThirdParty/when\")[\"default\"];\n\nvar EventHelper = require(\"terriajs-cesium/Source/Core/EventHelper\")[\"default\"];\n\nvar ImagerySplitDirection = require(\"terriajs-cesium/Source/Scene/ImagerySplitDirection\")[\"default\"];\n\nvar CesiumSelectionIndicator = require(\"../Map/CesiumSelectionIndicator\");\n\nvar Feature = require(\"./Feature\");\n\nvar GlobeOrMap = require(\"./GlobeOrMap\");\n\nvar inherit = require(\"../Core/inherit\");\n\nvar pollToPromise = require(\"../Core/pollToPromise\");\n\nvar TerriaError = require(\"../Core/TerriaError\");\n\nvar PickedFeatures = require(\"../Map/PickedFeatures\");\n\nvar ViewerMode = require(\"./ViewerMode\");\n\nvar i18next = require(\"i18next\")[\"default\"];\n/**\r\n * The Cesium viewer component\r\n *\r\n * @alias Cesium\r\n * @constructor\r\n * @extends GlobeOrMap\r\n *\r\n * @param {Terria} terria The Terria instance.\r\n * @param {Viewer} viewer The Cesium viewer instance.\r\n */\n\n\nvar Cesium = function Cesium(terria, viewer) {\n  GlobeOrMap.call(this, terria);\n  /**\r\n   * Gets or sets the Cesium {@link Viewer} instance.\r\n   * @type {Viewer}\r\n   */\n\n  this.viewer = viewer;\n  /**\r\n   * Gets or sets the Cesium {@link Scene} instance.\r\n   * @type {Scene}\r\n   */\n\n  this.scene = viewer.scene;\n  /**\r\n   * Gets or sets whether the viewer has stopped rendering since startup or last set to false.\r\n   * @type {Boolean}\r\n   */\n\n  this.stoppedRendering = false;\n  /**\r\n   * Gets or sets whether to output info to the console when starting and stopping rendering loop.\r\n   * @type {Boolean}\r\n   */\n\n  this.verboseRendering = false;\n  /**\r\n   * Gets or sets whether this viewer _can_ show a splitter.\r\n   * @type {Boolean}\r\n   */\n\n  this.canShowSplitter = true;\n  /**\r\n   * Gets the {@link DataSourceDisplay} used to render a {@link DataSource}.\r\n   * @type {DataSourceDisplay}\r\n   */\n\n  this.dataSourceDisplay = undefined;\n  this._lastClockTime = new JulianDate(0, 0.0);\n  this._lastCameraViewMatrix = new Matrix4();\n  this._lastCameraMoveTime = 0;\n  this._selectionIndicator = new CesiumSelectionIndicator(this);\n  this._removePostRenderListener = this.scene.postRender.addEventListener(postRender.bind(undefined, this));\n  this._removeInfoBoxCloseListener = undefined;\n  this._boundNotifyRepaintRequired = this.notifyRepaintRequired.bind(this);\n  this._pauseMapInteractionCount = 0;\n  this.scene.imagerySplitPosition = this.terria.splitPosition;\n  this.supportsPolylinesOnTerrain = this.scene.context.depthTexture; // Handle left click by picking objects from the map.\n\n  viewer.screenSpaceEventHandler.setInputAction(function (e) {\n    this.pickFromScreenPosition(e.position);\n  }.bind(this), ScreenSpaceEventType.LEFT_CLICK); // Force a repaint when the mouse moves or the window changes size.\n\n  var canvas = this.viewer.canvas;\n  canvas.addEventListener(\"mousemove\", this._boundNotifyRepaintRequired, false);\n  canvas.addEventListener(\"mousedown\", this._boundNotifyRepaintRequired, false);\n  canvas.addEventListener(\"mouseup\", this._boundNotifyRepaintRequired, false);\n  canvas.addEventListener(\"touchstart\", this._boundNotifyRepaintRequired, false);\n  canvas.addEventListener(\"touchend\", this._boundNotifyRepaintRequired, false);\n  canvas.addEventListener(\"touchmove\", this._boundNotifyRepaintRequired, false);\n\n  if (defined(window.PointerEvent)) {\n    canvas.addEventListener(\"pointerdown\", this._boundNotifyRepaintRequired, false);\n    canvas.addEventListener(\"pointerup\", this._boundNotifyRepaintRequired, false);\n    canvas.addEventListener(\"pointermove\", this._boundNotifyRepaintRequired, false);\n  } // Detect available wheel event\n\n\n  this._wheelEvent = undefined;\n\n  if (\"onwheel\" in canvas) {\n    // spec event type\n    this._wheelEvent = \"wheel\";\n  } else if (defined(document.onmousewheel)) {\n    // legacy event type\n    this._wheelEvent = \"mousewheel\";\n  } else {\n    // older Firefox\n    this._wheelEvent = \"DOMMouseScroll\";\n  }\n\n  canvas.addEventListener(this._wheelEvent, this._boundNotifyRepaintRequired, false);\n  window.addEventListener(\"resize\", this._boundNotifyRepaintRequired, false); // Force a repaint when the feature info box is closed.  Cesium can't close its info box\n  // when the clock is not ticking, for reasons that are not clear.\n\n  if (defined(this.viewer.infoBox)) {\n    this._removeInfoBoxCloseListener = this.viewer.infoBox.viewModel.closeClicked.addEventListener(this._boundNotifyRepaintRequired);\n  }\n\n  if (defined(this.viewer._clockViewModel)) {\n    var clock = this.viewer._clockViewModel;\n    this._shouldAnimateSubscription = knockout.getObservable(clock, \"shouldAnimate\").subscribe(this._boundNotifyRepaintRequired);\n    this._currentTimeSubscription = knockout.getObservable(clock, \"currentTime\").subscribe(this._boundNotifyRepaintRequired);\n  }\n\n  if (defined(this.viewer.timeline)) {\n    this.viewer.timeline.addEventListener(\"settime\", this._boundNotifyRepaintRequired, false);\n  }\n\n  this._selectedFeatureSubscription = knockout.getObservable(this.terria, \"selectedFeature\").subscribe(function () {\n    selectFeature(this);\n  }, this);\n  this._splitterPositionSubscription = knockout.getObservable(this.terria, \"splitPosition\").subscribe(function () {\n    if (this.scene) {\n      this.scene.imagerySplitPosition = this.terria.splitPosition;\n      this.notifyRepaintRequired();\n    }\n  }, this);\n  this._showSplitterSubscription = knockout.getObservable(terria, \"showSplitter\").subscribe(function () {\n    this.updateAllItemsForSplitter();\n  }, this); // Hacky way to force a repaint when an async load request completes\n\n  var that = this;\n  this._originalLoadWithXhr = loadWithXhr.load;\n\n  loadWithXhr.load = function (url, responseType, method, data, headers, deferred, overrideMimeType, preferText, timeout) {\n    deferred.promise.always(that._boundNotifyRepaintRequired);\n\n    that._originalLoadWithXhr(url, responseType, method, data, headers, deferred, overrideMimeType, preferText, timeout);\n  }; // Hacky way to force a repaint when a web worker sends something back.\n\n\n  this._originalScheduleTask = TaskProcessor.prototype.scheduleTask;\n\n  TaskProcessor.prototype.scheduleTask = function (parameters, transferableObjects) {\n    var result = that._originalScheduleTask.call(this, parameters, transferableObjects);\n\n    if (!defined(this._originalWorkerMessageSinkRepaint)) {\n      this._originalWorkerMessageSinkRepaint = this._worker.onmessage;\n      var taskProcessor = this;\n\n      this._worker.onmessage = function (event) {\n        taskProcessor._originalWorkerMessageSinkRepaint(event);\n\n        if (that.isDestroyed()) {\n          taskProcessor._worker.onmessage = taskProcessor._originalWorkerMessageSinkRepaint;\n          taskProcessor._originalWorkerMessageSinkRepaint = undefined;\n        } else {\n          that.notifyRepaintRequired();\n        }\n      };\n    }\n\n    return result;\n  };\n\n  this.eventHelper = new EventHelper(); // If the render loop crashes, inform the user and then switch to 2D.\n\n  this.eventHelper.add(this.scene.renderError, function (scene, error) {\n    this.terria.error.raiseEvent(new TerriaError({\n      sender: this,\n      title: i18next.t(\"models.cesiumTerrain.errorRenderingTitle\"),\n      message: i18next.t(\"models.cesiumTerrain.errorRenderingTitle\", {\n        appName: terria.appName,\n        email: '<a href=\"mailto:' + terria.supportEmail + '\">' + terria.supportEmail + \"</a>.\"\n      }) + \"<pre>\" + formatError(error) + \"</pre>\"\n    }));\n    this.terria.viewerMode = ViewerMode.Leaflet;\n  }, this);\n  this.eventHelper.add(this.scene.globe.tileLoadProgressEvent, this.updateTilesLoadingCount.bind(this));\n  selectFeature(this);\n};\n\ninherit(GlobeOrMap, Cesium);\n\nCesium.prototype.destroy = function () {\n  if (defined(this._selectionIndicator)) {\n    this._selectionIndicator.destroy();\n\n    this._selectionIndicator = undefined;\n  }\n\n  if (defined(this._removePostRenderListener)) {\n    this._removePostRenderListener();\n\n    this._removePostRenderListener = undefined;\n  }\n\n  if (defined(this._removeInfoBoxCloseListener)) {\n    this._removeInfoBoxCloseListener();\n  }\n\n  if (defined(this._shouldAnimateSubscription)) {\n    this._shouldAnimateSubscription.dispose();\n\n    this._shouldAnimateSubscription = undefined;\n  }\n\n  if (defined(this._currentTimeSubscription)) {\n    this._currentTimeSubscription.dispose();\n\n    this._currentTimeSubscription = undefined;\n  }\n\n  if (defined(this.viewer.timeline)) {\n    this.viewer.timeline.removeEventListener(\"settime\", this._boundNotifyRepaintRequired, false);\n  }\n\n  if (defined(this._selectedFeatureSubscription)) {\n    this._selectedFeatureSubscription.dispose();\n\n    this._selectedFeatureSubscription = undefined;\n  }\n\n  if (defined(this._splitterPositionSubscription)) {\n    this._splitterPositionSubscription.dispose();\n\n    this._splitterPositionSubscription = undefined;\n  }\n\n  if (defined(this._showSplitterSubscription)) {\n    this._showSplitterSubscription.dispose();\n\n    this._showSplitterSubscription = undefined;\n  }\n\n  this.viewer.canvas.removeEventListener(\"mousemove\", this._boundNotifyRepaintRequired, false);\n  this.viewer.canvas.removeEventListener(\"mousedown\", this._boundNotifyRepaintRequired, false);\n  this.viewer.canvas.removeEventListener(\"mouseup\", this._boundNotifyRepaintRequired, false);\n  this.viewer.canvas.removeEventListener(\"touchstart\", this._boundNotifyRepaintRequired, false);\n  this.viewer.canvas.removeEventListener(\"touchend\", this._boundNotifyRepaintRequired, false);\n  this.viewer.canvas.removeEventListener(\"touchmove\", this._boundNotifyRepaintRequired, false);\n\n  if (defined(window.PointerEvent)) {\n    this.viewer.canvas.removeEventListener(\"pointerdown\", this._boundNotifyRepaintRequired, false);\n    this.viewer.canvas.removeEventListener(\"pointerup\", this._boundNotifyRepaintRequired, false);\n    this.viewer.canvas.removeEventListener(\"pointermove\", this._boundNotifyRepaintRequired, false);\n  }\n\n  this.viewer.canvas.removeEventListener(this._wheelEvent, this._boundNotifyRepaintRequired, false);\n  window.removeEventListener(\"resize\", this._boundNotifyRepaintRequired, false);\n  window.removeEventListener(\"resize\", this._setViewerResolution, false);\n  loadWithXhr.load = this._originalLoadWithXhr;\n  TaskProcessor.prototype.scheduleTask = this._originalScheduleTask;\n  this.eventHelper.removeAll();\n  GlobeOrMap.disposeCommonListeners(this);\n  return destroyObject(this);\n};\n\nCesium.prototype.isDestroyed = function () {\n  return false;\n};\n\nvar cartesian3Scratch = new Cartesian3();\nvar enuToFixedScratch = new Matrix4();\nvar southwestScratch = new Cartesian3();\nvar southeastScratch = new Cartesian3();\nvar northeastScratch = new Cartesian3();\nvar northwestScratch = new Cartesian3();\nvar southwestCartographicScratch = new Cartographic();\nvar southeastCartographicScratch = new Cartographic();\nvar northeastCartographicScratch = new Cartographic();\nvar northwestCartographicScratch = new Cartographic();\n/**\r\n * Gets the current extent of the camera.  This may be approximate if the viewer does not have a strictly rectangular view.\r\n * @return {Rectangle} The current visible extent.\r\n */\n\nCesium.prototype.getCurrentExtent = function () {\n  var scene = this.scene;\n  var camera = scene.camera;\n  var width = scene.canvas.clientWidth;\n  var height = scene.canvas.clientHeight;\n  var centerOfScreen = new Cartesian2(width / 2.0, height / 2.0);\n  var pickRay = scene.camera.getPickRay(centerOfScreen);\n  var center = scene.globe.pick(pickRay, scene);\n\n  if (!defined(center)) {\n    // TODO: binary search to find the horizon point and use that as the center.\n    return this.terria.homeView.rectangle;\n  }\n\n  var ellipsoid = this.scene.globe.ellipsoid;\n  var fovy = scene.camera.frustum.fovy * 0.5;\n  var fovx = Math.atan(Math.tan(fovy) * scene.camera.frustum.aspectRatio);\n  var cameraOffset = Cartesian3.subtract(camera.positionWC, center, cartesian3Scratch);\n  var cameraHeight = Cartesian3.magnitude(cameraOffset);\n  var xDistance = cameraHeight * Math.tan(fovx);\n  var yDistance = cameraHeight * Math.tan(fovy);\n  var southwestEnu = new Cartesian3(-xDistance, -yDistance, 0.0);\n  var southeastEnu = new Cartesian3(xDistance, -yDistance, 0.0);\n  var northeastEnu = new Cartesian3(xDistance, yDistance, 0.0);\n  var northwestEnu = new Cartesian3(-xDistance, yDistance, 0.0);\n  var enuToFixed = Transforms.eastNorthUpToFixedFrame(center, ellipsoid, enuToFixedScratch);\n  var southwest = Matrix4.multiplyByPoint(enuToFixed, southwestEnu, southwestScratch);\n  var southeast = Matrix4.multiplyByPoint(enuToFixed, southeastEnu, southeastScratch);\n  var northeast = Matrix4.multiplyByPoint(enuToFixed, northeastEnu, northeastScratch);\n  var northwest = Matrix4.multiplyByPoint(enuToFixed, northwestEnu, northwestScratch);\n  var southwestCartographic = ellipsoid.cartesianToCartographic(southwest, southwestCartographicScratch);\n  var southeastCartographic = ellipsoid.cartesianToCartographic(southeast, southeastCartographicScratch);\n  var northeastCartographic = ellipsoid.cartesianToCartographic(northeast, northeastCartographicScratch);\n  var northwestCartographic = ellipsoid.cartesianToCartographic(northwest, northwestCartographicScratch); // Account for date-line wrapping\n\n  if (southeastCartographic.longitude < southwestCartographic.longitude) {\n    southeastCartographic.longitude += CesiumMath.TWO_PI;\n  }\n\n  if (northeastCartographic.longitude < northwestCartographic.longitude) {\n    northeastCartographic.longitude += CesiumMath.TWO_PI;\n  }\n\n  var rect = new Rectangle(CesiumMath.convertLongitudeRange(Math.min(southwestCartographic.longitude, northwestCartographic.longitude)), Math.min(southwestCartographic.latitude, southeastCartographic.latitude), CesiumMath.convertLongitudeRange(Math.max(northeastCartographic.longitude, southeastCartographic.longitude)), Math.max(northeastCartographic.latitude, northwestCartographic.latitude));\n  rect.center = center;\n  return rect;\n};\n/**\r\n * Gets the current container element.\r\n * @return {Element} The current container element.\r\n */\n\n\nCesium.prototype.getContainer = function () {\n  return this.viewer.container;\n};\n/**\r\n * Zooms to a specified camera view or extent with a smooth flight animation.\r\n *\r\n * @param {CameraView|Rectangle|DataSource|Cesium3DTileset} target The view, extent, DataSource, or Cesium3DTileset to which to zoom.\r\n * @param {Number} [flightDurationSeconds=3.0] The length of the flight animation in seconds.\r\n */\n\n\nCesium.prototype.zoomTo = function (target, flightDurationSeconds) {\n  if (!defined(target)) {\n    throw new DeveloperError(\"target is required.\");\n  }\n\n  flightDurationSeconds = defaultValue(flightDurationSeconds, 3.0);\n  var that = this;\n  that.lastTarget = target;\n  return when().then(function () {\n    if (target instanceof Rectangle) {\n      var camera = that.scene.camera; // Work out the destination that the camera would naturally fly to\n\n      var destinationCartesian = camera.getRectangleCameraCoordinates(target);\n      var destination = Ellipsoid.WGS84.cartesianToCartographic(destinationCartesian);\n      var terrainProvider = that.scene.globe.terrainProvider;\n      var level = 6; // A sufficiently coarse tile level that still has approximately accurate height\n\n      var positions = [Rectangle.center(target)]; // Perform an elevation query at the centre of the rectangle\n\n      return sampleTerrain(terrainProvider, level, positions).then(function (results) {\n        if (that.lastTarget !== target) {\n          return;\n        } // Add terrain elevation to camera altitude\n\n\n        var finalDestinationCartographic = {\n          longitude: destination.longitude,\n          latitude: destination.latitude,\n          height: destination.height + results[0].height\n        };\n        var finalDestination = Ellipsoid.WGS84.cartographicToCartesian(finalDestinationCartographic);\n        camera.flyTo({\n          duration: flightDurationSeconds,\n          destination: finalDestination\n        });\n      });\n    } else if (defined(target.entities)) {\n      // Zooming to a DataSource\n      if (target.isLoading && defined(target.loadingEvent)) {\n        var deferred = when.defer();\n        var removeEvent = target.loadingEvent.addEventListener(function () {\n          removeEvent();\n          deferred.resolve();\n        });\n        return deferred.promise.then(function () {\n          if (that.lastTarget !== target) {\n            return;\n          }\n\n          return zoomToDataSource(that, target, flightDurationSeconds);\n        });\n      }\n\n      return zoomToDataSource(that, target);\n    } else if (defined(target.readyPromise)) {\n      return target.readyPromise.then(function () {\n        if (defined(target.boundingSphere) && that.lastTarget === target) {\n          zoomToBoundingSphere(that, target, flightDurationSeconds);\n        }\n      });\n    } else if (defined(target.boundingSphere)) {\n      return zoomToBoundingSphere(that, target);\n    } else if (defined(target.position)) {\n      that.scene.camera.flyTo({\n        duration: flightDurationSeconds,\n        destination: target.position,\n        orientation: {\n          direction: target.direction,\n          up: target.up\n        }\n      });\n    } else {\n      that.scene.camera.flyTo({\n        duration: flightDurationSeconds,\n        destination: target.rectangle\n      });\n    }\n  }).then(function () {\n    that.notifyRepaintRequired();\n  });\n};\n\nvar boundingSphereScratch = new BoundingSphere();\n\nfunction zoomToDataSource(cesium, target, flightDurationSeconds) {\n  return pollToPromise(function () {\n    var dataSourceDisplay = cesium.dataSourceDisplay;\n    var entities = target.entities.values;\n    var boundingSpheres = [];\n\n    for (var i = 0, len = entities.length; i < len; i++) {\n      var state = BoundingSphereState.PENDING;\n\n      try {\n        state = dataSourceDisplay.getBoundingSphere(entities[i], false, boundingSphereScratch);\n      } catch (e) {}\n\n      if (state === BoundingSphereState.PENDING) {\n        return false;\n      } else if (state !== BoundingSphereState.FAILED) {\n        boundingSpheres.push(BoundingSphere.clone(boundingSphereScratch));\n      }\n    }\n\n    var boundingSphere = BoundingSphere.fromBoundingSpheres(boundingSpheres);\n    cesium.scene.camera.flyToBoundingSphere(boundingSphere, {\n      duration: flightDurationSeconds\n    });\n    return true;\n  }, {\n    pollInterval: 100,\n    timeout: 5000\n  });\n}\n\nfunction zoomToBoundingSphere(cesium, target, flightDurationSeconds) {\n  var boundingSphere = target.boundingSphere;\n  var modelMatrix = target.modelMatrix;\n\n  if (modelMatrix) {\n    boundingSphere = BoundingSphere.transform(boundingSphere, modelMatrix);\n  }\n\n  cesium.scene.camera.flyToBoundingSphere(boundingSphere, {\n    offset: new HeadingPitchRange(0.0, -0.5, boundingSphere.radius),\n    duration: flightDurationSeconds\n  });\n}\n/**\r\n * Captures a screenshot of the map.\r\n * @return {Promise} A promise that resolves to a data URL when the screenshot is ready.\r\n */\n\n\nCesium.prototype.captureScreenshot = function () {\n  var deferred = when.defer();\n  var removeCallback = this.scene.postRender.addEventListener(function () {\n    removeCallback();\n\n    try {\n      var cesiumCanvas = this.scene.canvas; // If we're using the splitter, draw the split position as a vertical white line.\n\n      var canvas = cesiumCanvas;\n\n      if (this.terria.showSplitter) {\n        canvas = document.createElement(\"canvas\");\n        canvas.width = cesiumCanvas.width;\n        canvas.height = cesiumCanvas.height;\n        var context = canvas.getContext(\"2d\");\n        context.drawImage(cesiumCanvas, 0, 0);\n        var x = this.terria.splitPosition * cesiumCanvas.width;\n        context.strokeStyle = this.terria.baseMapContrastColor;\n        context.beginPath();\n        context.moveTo(x, 0);\n        context.lineTo(x, cesiumCanvas.height);\n        context.stroke();\n      }\n\n      deferred.resolve(canvas.toDataURL(\"image/png\"));\n    } catch (e) {\n      deferred.reject(e);\n    }\n  }, this);\n  this.scene.render(this.terria.clock.currentTime);\n  return deferred.promise;\n};\n/**\r\n * Notifies the viewer that a repaint is required.\r\n */\n\n\nCesium.prototype.notifyRepaintRequired = function () {\n  if (this.verboseRendering && !this.viewer.useDefaultRenderLoop) {\n    console.log(\"starting rendering @ \" + getTimestamp());\n  }\n\n  this._lastCameraMoveTime = getTimestamp();\n  this.viewer.useDefaultRenderLoop = true;\n};\n/**\r\n * Computes the screen position of a given world position.\r\n * @param  {Cartesian3} position The world position in Earth-centered Fixed coordinates.\r\n * @param  {Cartesian2} [result] The instance to which to copy the result.\r\n * @return {Cartesian2} The screen position, or undefined if the position is not on the screen.\r\n */\n\n\nCesium.prototype.computePositionOnScreen = function (position, result) {\n  return SceneTransforms.wgs84ToWindowCoordinates(this.scene, position, result);\n};\n/**\r\n * Adds an attribution to the globe.\r\n * @param {Credit} attribution The attribution to add.\r\n */\n\n\nCesium.prototype.addAttribution = function (attribution) {\n  if (attribution) {\n    this.scene.frameState.creditDisplay.addDefaultCredit(attribution);\n  }\n};\n/**\r\n * Removes an attribution from the globe.\r\n * @param {Credit} attribution The attribution to remove.\r\n */\n\n\nCesium.prototype.removeAttribution = function (attribution) {\n  if (attribution) {\n    this.scene.frameState.creditDisplay.removeDefaultCredit(attribution);\n  }\n};\n/**\r\n * Gets all attribution currently active on the globe or map.\r\n * @returns {String[]} The list of current attributions, as HTML strings.\r\n */\n\n\nCesium.prototype.getAllAttribution = function () {\n  var credits = this.scene.frameState.creditDisplay._currentFrameCredits.screenCredits.values.concat(this.scene.frameState.creditDisplay._currentFrameCredits.lightboxCredits.values);\n\n  return credits.map(function (credit) {\n    return credit.html;\n  });\n};\n/**\r\n * Updates the order of layers, moving layers where {@link CatalogItem#keepOnTop} is true to the top.\r\n */\n\n\nCesium.prototype.updateLayerOrderToKeepOnTop = function () {\n  // move alwaysOnTop layers to the top\n  var items = this.terria.nowViewing.items;\n  var scene = this.scene;\n\n  for (var l = items.length - 1; l >= 0; l--) {\n    if (items[l].imageryLayer && items[l].keepOnTop) {\n      scene.imageryLayers.raiseToTop(items[l].imageryLayer);\n    }\n  }\n};\n\nCesium.prototype.updateLayerOrderAfterReorder = function () {// because this Cesium model does the reordering via raise and lower, no action needed.\n}; // useful for counting the number of items in composite and non-composite items\n\n\nfunction countNumberOfSubItems(item) {\n  if (defined(item.items)) {\n    return item.items.length;\n  } else {\n    return 1;\n  }\n}\n/**\r\n * Raise an item's level in the viewer\r\n * This does not check that index is valid\r\n * @param {Number} index The index of the item to raise\r\n */\n\n\nCesium.prototype.raise = function (index) {\n  var items = this.terria.nowViewing.items;\n  var item = items[index];\n  var itemAbove = items[index - 1];\n\n  if (!defined(itemAbove.items) && !defined(itemAbove.imageryLayer)) {\n    return;\n  } // Both item and itemAbove may either have a single imageryLayer, or be a composite item\n  // Composite items have an items array of further items.\n  // Define n as the number of subitems in ItemAbove (1 except for composites)\n  // if item is a composite, then raise each subitem in item n times,\n  // starting with the one at the top - which is the last one in the list\n  // if item is not a composite, just raise the item n times directly.\n\n\n  var n = countNumberOfSubItems(itemAbove);\n  var i, j, subItem;\n\n  if (defined(item.items)) {\n    for (i = item.items.length - 1; i >= 0; --i) {\n      subItem = item.items[i];\n\n      if (defined(subItem.imageryLayer)) {\n        for (j = 0; j < n; ++j) {\n          this.scene.imageryLayers.raise(subItem.imageryLayer);\n        }\n      }\n    }\n  }\n\n  if (!defined(item.imageryLayer)) {\n    return;\n  }\n\n  for (j = 0; j < n; ++j) {\n    this.scene.imageryLayers.raise(item.imageryLayer);\n  }\n};\n/**\r\n * Lower an item's level in the viewer\r\n * This does not check that index is valid\r\n * @param {Number} index The index of the item to lower\r\n */\n\n\nCesium.prototype.lower = function (index) {\n  var items = this.terria.nowViewing.items;\n  var item = items[index];\n  var itemBelow = items[index + 1];\n\n  if (!defined(itemBelow.items) && !defined(itemBelow.imageryLayer)) {\n    return;\n  } // same considerations as above, but lower composite subitems starting at the other end of the list\n\n\n  var n = countNumberOfSubItems(itemBelow);\n  var i, j, subItem;\n\n  if (defined(item.items)) {\n    for (i = 0; i < item.items.length; ++i) {\n      subItem = item.items[i];\n\n      if (defined(subItem.imageryLayer)) {\n        for (j = 0; j < n; ++j) {\n          this.scene.imageryLayers.lower(subItem.imageryLayer);\n        }\n      }\n    }\n  }\n\n  if (!defined(item.imageryLayer)) {\n    return;\n  }\n\n  for (j = 0; j < n; ++j) {\n    this.scene.imageryLayers.lower(item.imageryLayer);\n  }\n};\n/**\r\n * Lowers this imagery layer to the bottom, underneath all other layers.  If this item is not enabled or not shown,\r\n * this method does nothing.\r\n * @param {CatalogItem} item The item to lower to the bottom (usually a basemap)\r\n */\n\n\nCesium.prototype.lowerToBottom = function (item) {\n  if (defined(item.items)) {\n    // the front item is at the end of the list.\n    // so to preserve order of any subitems, send any subitems to the bottom in order from the front\n    for (var i = item.items.length - 1; i >= 0; --i) {\n      var subItem = item.items[i];\n      this.lowerToBottom(subItem); // recursive\n    }\n  }\n\n  if (!defined(item._imageryLayer)) {\n    return;\n  }\n\n  this.terria.cesium.scene.imageryLayers.lowerToBottom(item._imageryLayer);\n};\n\nCesium.prototype.adjustDisclaimer = function () {};\n/**\r\n * Picks features based off a latitude, longitude and (optionally) height.\r\n * @param {Object} latlng The position on the earth to pick.\r\n * @param {Object} imageryLayerCoords A map of imagery provider urls to the coords used to get features for those imagery\r\n *     providers - i.e. x, y, level\r\n * @param existingFeatures An optional list of existing features to concatenate the ones found from asynchronous picking to.\r\n * @param {Boolean} ignoreSplitter An optional arg to ignore the splitter and return all feature picking results. Defaults to false.\r\n */\n\n\nCesium.prototype.pickFromLocation = function (latlng, imageryLayerCoords, existingFeatures, ignoreSplitter) {\n  var pickPosition = this.scene.globe.ellipsoid.cartographicToCartesian(Cartographic.fromDegrees(latlng.lng, latlng.lat, latlng.height));\n  var pickPositionCartographic = Ellipsoid.WGS84.cartesianToCartographic(pickPosition);\n  var promises = [];\n  var imageryLayers = [];\n\n  if (this.terria.allowFeatureInfoRequests) {\n    for (var i = this.scene.imageryLayers.length - 1; i >= 0; i--) {\n      var imageryLayer = this.scene.imageryLayers.get(i);\n      var imageryProvider = imageryLayer._imageryProvider;\n\n      if (imageryProvider.url && imageryLayerCoords[imageryProvider.url]) {\n        var coords = imageryLayerCoords[imageryProvider.url];\n        promises.push(imageryProvider.pickFeatures(coords.x, coords.y, coords.level, pickPositionCartographic.longitude, pickPositionCartographic.latitude));\n        imageryLayers.push(imageryLayer);\n      }\n    }\n  }\n\n  var result = this._buildPickedFeatures(imageryLayerCoords, pickPosition, existingFeatures, promises, imageryLayers, pickPositionCartographic.height, ignoreSplitter);\n\n  var mapInteractionModeStack = this.terria.mapInteractionModeStack;\n\n  if (defined(mapInteractionModeStack) && mapInteractionModeStack.length > 0) {\n    mapInteractionModeStack[mapInteractionModeStack.length - 1].pickedFeatures = result;\n  } else {\n    this.terria.pickedFeatures = result;\n  }\n};\n/**\r\n * Picks features based on coordinates relative to the Cesium window. Will draw a ray from the camera through the point\r\n * specified and set terria.pickedFeatures based on this.\r\n *\r\n * @param {Cartesian3} screenPosition The position on the screen.\r\n * @param {Boolean} ignoreSplitter An optional arg to ignore the splitter and return all feature picking results. Defaults to false.\r\n */\n\n\nCesium.prototype.pickFromScreenPosition = function (screenPosition, ignoreSplitter) {\n  var pickRay = this.scene.camera.getPickRay(screenPosition);\n  var pickPosition = this.scene.globe.pick(pickRay, this.scene);\n  var pickPositionCartographic = Ellipsoid.WGS84.cartesianToCartographic(pickPosition);\n  var vectorFeatures = this.pickVectorFeatures(screenPosition);\n\n  var providerCoords = this._attachProviderCoordHooks();\n\n  var pickRasterPromise = this.terria.allowFeatureInfoRequests ? this.scene.imageryLayers.pickImageryLayerFeatures(pickRay, this.scene) : Promise.resolve();\n\n  var result = this._buildPickedFeatures(providerCoords, pickPosition, vectorFeatures, [pickRasterPromise], undefined, pickPositionCartographic.height, ignoreSplitter);\n\n  var mapInteractionModeStack = this.terria.mapInteractionModeStack;\n\n  if (defined(mapInteractionModeStack) && mapInteractionModeStack.length > 0) {\n    mapInteractionModeStack[mapInteractionModeStack.length - 1].pickedFeatures = result;\n  } else {\n    this.terria.pickedFeatures = result;\n  }\n};\n/**\r\n * Picks all *vector* features (e.g. GeoJSON) shown at a certain position on the screen, ignoring raster features\r\n * (e.g. WFS). Because all vector features are already in memory, this is synchronous.\r\n *\r\n * @param {Cartesian2} screenPosition position on the screen to look for features\r\n * @returns {Feature[]} The features found.\r\n */\n\n\nCesium.prototype.pickVectorFeatures = function (screenPosition) {\n  // Pick vector features\n  var vectorFeatures = [];\n  var pickedList = this.scene.drillPick(screenPosition);\n\n  for (var i = 0; i < pickedList.length; ++i) {\n    var picked = pickedList[i];\n    var id = picked.id;\n\n    if (id && id.entityCollection && id.entityCollection.owner && id.entityCollection.owner.name === GlobeOrMap._featureHighlightName) {\n      continue;\n    }\n\n    if (!defined(id) && defined(picked.primitive)) {\n      id = picked.primitive.id;\n    }\n\n    if (id instanceof Entity && vectorFeatures.indexOf(id) === -1) {\n      var feature = Feature.fromEntityCollectionOrEntity(id);\n      vectorFeatures.push(feature);\n    } else if (picked.primitive && picked.primitive._catalogItem && picked.primitive._catalogItem.getFeaturesFromPickResult) {\n      var result = picked.primitive._catalogItem.getFeaturesFromPickResult(screenPosition, picked);\n\n      if (result) {\n        if (Array.isArray(result)) {\n          vectorFeatures.push.apply(vectorFeatures, _toConsumableArray(result));\n        } else {\n          vectorFeatures.push(result);\n        }\n      }\n    }\n  }\n\n  return vectorFeatures;\n};\n/**\r\n * Hooks into the {@link ImageryProvider#pickFeatures} method of every imagery provider in the scene - when this method is\r\n * evaluated (usually as part of feature picking), it will record the tile coordinates used against the url of the\r\n * imagery provider in an object that is returned by this method. Hooks are removed immediately after being executed once.\r\n *\r\n * @returns {{x, y, level}} A map of urls to the coords used by the imagery provider when picking features. Will\r\n *     initially be empty but will be updated as the hooks are evaluated.\r\n * @private\r\n */\n\n\nCesium.prototype._attachProviderCoordHooks = function () {\n  var providerCoords = {};\n\n  var pickFeaturesHook = function pickFeaturesHook(imageryProvider, oldPick, x, y, level, longitude, latitude) {\n    var featuresPromise = oldPick.call(imageryProvider, x, y, level, longitude, latitude); // Use url to uniquely identify providers because what else can we do?\n\n    if (imageryProvider.url) {\n      providerCoords[imageryProvider.url] = {\n        x: x,\n        y: y,\n        level: level\n      };\n    }\n\n    imageryProvider.pickFeatures = oldPick;\n    return featuresPromise;\n  };\n\n  for (var j = 0; j < this.scene.imageryLayers.length; j++) {\n    var imageryProvider = this.scene.imageryLayers.get(j).imageryProvider;\n    imageryProvider.pickFeatures = pickFeaturesHook.bind(undefined, imageryProvider, imageryProvider.pickFeatures);\n  }\n\n  return providerCoords;\n};\n/**\r\n * Builds a {@link PickedFeatures} object from a number of inputs.\r\n *\r\n * @param {{x, y, level}} providerCoords A map of imagery provider urls to the coords used to get features for that provider.\r\n * @param {Cartesian3} pickPosition The position in the 3D model that has been picked.\r\n * @param {Entity[]} existingFeatures Existing features - the results of feature promises will be appended to this.\r\n * @param {Promise[]} featurePromises Zero or more promises that each resolve to a list of {@link ImageryLayerFeatureInfo}s\r\n *     (usually there will be one promise per ImageryLayer. These will be combined as part of\r\n *     {@link PickedFeatures#allFeaturesAvailablePromise} and their results used to build the final\r\n *     {@link PickedFeatures#features} array.\r\n * @param {ImageryLayer[]} imageryLayers An array of ImageryLayers that should line up with the one passed as featurePromises.\r\n * @param {number} defaultHeight The height to use for feature position heights if none is available when picking.\r\n * @param {Boolean} ignoreSplitter Ignore the splitter and return all feature picking results\r\n * @returns {PickedFeatures} A {@link PickedFeatures} object that is a combination of everything passed.\r\n * @private\r\n */\n\n\nCesium.prototype._buildPickedFeatures = function (providerCoords, pickPosition, existingFeatures, featurePromises, imageryLayers, defaultHeight, ignoreSplitter) {\n  ignoreSplitter = defaultValue(ignoreSplitter, false);\n  var result = new PickedFeatures();\n  result.providerCoords = providerCoords;\n  result.pickPosition = pickPosition;\n  result.allFeaturesAvailablePromise = when.all(featurePromises).then(function (allFeatures) {\n    result.isLoading = false;\n    result.features = allFeatures.reduce(function (resultFeaturesSoFar, imageryLayerFeatures, i) {\n      if (!defined(imageryLayerFeatures)) {\n        return resultFeaturesSoFar;\n      }\n\n      var features = imageryLayerFeatures.map(function (feature) {\n        if (defined(imageryLayers)) {\n          feature.imageryLayer = imageryLayers[i];\n        }\n\n        if (!defined(feature.position)) {\n          feature.position = Ellipsoid.WGS84.cartesianToCartographic(pickPosition);\n        } // If the picked feature does not have a height, use the height of the picked location.\n        // This at least avoids major parallax effects on the selection indicator.\n\n\n        if (!defined(feature.position.height) || feature.position.height === 0.0) {\n          feature.position.height = defaultHeight;\n        }\n\n        return this._createFeatureFromImageryLayerFeature(feature);\n      }.bind(this));\n\n      if (this.terria.showSplitter && !ignoreSplitter) {\n        // Select only features from the same side or both sides of the splitter\n        var screenPosition = this.computePositionOnScreen(result.pickPosition);\n        var pickedSide = this.terria.getSplitterSideForScreenPosition(screenPosition);\n        features = features.filter(function (feature) {\n          var splitDirection = feature.imageryLayer.splitDirection;\n          return splitDirection === pickedSide || splitDirection === ImagerySplitDirection.NONE;\n        });\n      }\n\n      return resultFeaturesSoFar.concat(features);\n    }.bind(this), defaultValue(existingFeatures, []));\n  }.bind(this)).otherwise(function () {\n    result.isLoading = false;\n    result.error = \"An unknown error occurred while picking features.\";\n  });\n  return result;\n};\n/**\r\n * Returns a new layer using a provided ImageryProvider, and adds it to the scene.\r\n * Note the optional parameters are a superset of the Leaflet version of this function, with one deletion (onProjectionError).\r\n *\r\n * @param {Object} options Options\r\n * @param {ImageryProvider} options.imageryProvider The imagery provider to create a new layer for.\r\n * @param {Number} [layerIndex] The index to add the layer at.  If omitted, the layer will added on top of all existing layers.\r\n * @param {Rectangle} [options.rectangle=imageryProvider.rectangle] The rectangle of the layer.  This rectangle\r\n *        can limit the visible portion of the imagery provider.\r\n * @param {Number|Function} [options.opacity=1.0] The alpha blending value of this layer, from 0.0 to 1.0.\r\n *                          This can either be a simple number or a function with the signature\r\n *                          <code>function(frameState, layer, x, y, level)</code>.  The function is passed the\r\n *                          current frame state, this layer, and the x, y, and level coordinates of the\r\n *                          imagery tile for which the alpha is required, and it is expected to return\r\n *                          the alpha value to use for the tile.\r\n * @param {Boolean} [options.clipToRectangle]\r\n * @param {Boolean} [options.treat403AsError]\r\n * @param {Boolean} [options.treat403AsError]\r\n * @param {Boolean} [options.ignoreUnknownTileErrors]\r\n * @param {Function} [options.onLoadError]\r\n * @returns {ImageryLayer} The newly created layer.\r\n */\n\n\nCesium.prototype.addImageryProvider = function (options) {\n  var scene = this.scene;\n  var errorEvent = options.imageryProvider.errorEvent;\n\n  if (defined(errorEvent)) {\n    errorEvent.addEventListener(options.onLoadError);\n  }\n\n  var result = new ImageryLayer(options.imageryProvider, {\n    show: false,\n    alpha: options.opacity,\n    rectangle: options.clipToRectangle ? options.rectangle : undefined,\n    isRequired: options.isRequiredForRendering // TODO: This doesn't seem to be a valid option for ImageryLayer - remove (and upstream)?\n\n  }); // layerIndex is an optional parameter used when the imageryLayer corresponds to a CsvCatalogItem whose selected item has just changed\n  // to ensure that the layer is re-added in the correct position\n\n  scene.imageryLayers.add(result, options.layerIndex);\n  this.updateLayerOrderToKeepOnTop();\n  return result;\n};\n\nCesium.prototype.removeImageryLayer = function (options) {\n  var scene = this.scene;\n  scene.imageryLayers.remove(options.layer);\n};\n\nCesium.prototype.showImageryLayer = function (options) {\n  options.layer.show = true;\n};\n\nCesium.prototype.hideImageryLayer = function (options) {\n  options.layer.show = false;\n};\n\nCesium.prototype.isImageryLayerShown = function (options) {\n  return options.layer.show;\n};\n\nCesium.prototype.updateItemForSplitter = function (item) {\n  if (!defined(item.splitDirection) || !defined(item.imageryLayer)) {\n    return;\n  }\n\n  var terria = item.terria;\n\n  if (terria.showSplitter) {\n    item.imageryLayer.splitDirection = item.splitDirection;\n  } else {\n    item.imageryLayer.splitDirection = ImagerySplitDirection.NONE;\n  } // Also update the next layer, if any.\n\n\n  if (item._nextLayer) {\n    item._nextLayer.splitDirection = item.imageryLayer.splitDirection;\n  }\n\n  this.notifyRepaintRequired();\n};\n\nCesium.prototype.pauseMapInteraction = function () {\n  ++this._pauseMapInteractionCount;\n\n  if (this._pauseMapInteractionCount === 1) {\n    this.scene.screenSpaceCameraController.enableInputs = false;\n  }\n};\n\nCesium.prototype.resumeMapInteraction = function () {\n  var _this = this;\n\n  --this._pauseMapInteractionCount;\n\n  if (this._pauseMapInteractionCount === 0) {\n    setTimeout(function () {\n      if (_this._pauseMapInteractionCount === 0) {\n        _this.scene.screenSpaceCameraController.enableInputs = true;\n      }\n    }, 0);\n  }\n};\n\nfunction postRender(cesium, date) {\n  // We can safely stop rendering when:\n  //  - the camera position hasn't changed in over a second,\n  //  - there are no tiles waiting to load, and\n  //  - the clock is not animating\n  //  - there are no tweens in progress\n  var now = getTimestamp();\n  var scene = cesium.scene;\n\n  if (!Matrix4.equalsEpsilon(cesium._lastCameraViewMatrix, scene.camera.viewMatrix, 1e-5)) {\n    cesium._lastCameraMoveTime = now;\n  }\n\n  var cameraMovedInLastSecond = now - cesium._lastCameraMoveTime < 1000;\n  var surface = scene.globe._surface;\n  var tilesWaiting = !surface._tileProvider.ready || surface._tileLoadQueueHigh.length > 0 || surface._tileLoadQueueMedium.length > 0 || surface._tileLoadQueueLow.length > 0 || surface._debug.tilesWaitingForChildren > 0;\n\n  if (!cameraMovedInLastSecond && !tilesWaiting && !cesium.viewer.clock.shouldAnimate && cesium.scene.tweens.length === 0) {\n    if (cesium.verboseRendering) {\n      console.log(\"stopping rendering @ \" + getTimestamp());\n    }\n\n    cesium.viewer.useDefaultRenderLoop = false;\n    cesium.stoppedRendering = true;\n  }\n\n  Matrix4.clone(scene.camera.viewMatrix, cesium._lastCameraViewMatrix);\n  var feature = cesium.terria.selectedFeature;\n\n  if (defined(feature)) {\n    var position;\n\n    if (defined(cesium.dataSourceDisplay)) {\n      var originalEntity = defined(feature.cesiumEntity) ? feature.cesiumEntity : feature;\n      var state = cesium.dataSourceDisplay.getBoundingSphere(originalEntity, true, boundingSphereScratch);\n\n      if (state === BoundingSphereState.DONE) {\n        position = Cartesian3.clone(boundingSphereScratch.center);\n      }\n    }\n\n    if (!defined(position) && defined(feature.position)) {\n      position = feature.position.getValue(cesium.terria.clock.currentTime);\n    }\n\n    if (defined(position)) {\n      cesium._selectionIndicator.position = position;\n    }\n  }\n\n  cesium._selectionIndicator.update();\n}\n\nfunction selectFeature(cesium) {\n  var feature = cesium.terria.selectedFeature;\n\n  cesium._highlightFeature(feature);\n\n  if (defined(feature) && defined(feature.position)) {\n    cesium._selectionIndicator.position = feature.position.getValue(cesium.terria.clock.currentTime);\n\n    cesium._selectionIndicator.animateAppear();\n  } else {\n    cesium._selectionIndicator.animateDepart();\n  }\n\n  cesium._selectionIndicator.update();\n}\n\nmodule.exports = Cesium;","import defaultValue from '../Core/defaultValue.js';\nimport IonImageryProvider from './IonImageryProvider.js';\nimport IonWorldImageryStyle from './IonWorldImageryStyle.js';\n\n    /**\n     * Creates an {@link IonImageryProvider} instance for ion's default global base imagery layer, currently Bing Maps.\n     *\n     * @exports createWorldImagery\n     *\n     * @param {Object} [options] Object with the following properties:\n     * @param {IonWorldImageryStyle} [options.style=IonWorldImageryStyle] The style of base imagery, only AERIAL, AERIAL_WITH_LABELS, and ROAD are currently supported.\n     * @returns {IonImageryProvider}\n     *\n     * @see Ion\n     *\n     * @example\n     * // Create Cesium World Terrain with default settings\n     * var viewer = new Cesium.Viewer('cesiumContainer', {\n     *     imageryProvider : Cesium.createWorldImagery();\n     * });\n     *\n     * @example\n     * // Create Cesium World Terrain with water and normals.\n     * var viewer = new Cesium.Viewer('cesiumContainer', {\n     *     imageryProvider : Cesium.createWorldImagery({\n     *         style: Cesium.IonWorldImageryStyle.AERIAL_WITH_LABELS\n     *     })\n     * });\n     *\n     */\n    function createWorldImagery(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n        var style = defaultValue(options.style, IonWorldImageryStyle.AERIAL);\n        return new IonImageryProvider({\n            assetId: style\n        });\n    }\nexport default createWorldImagery;\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform vec4 u_initialColor;\\n\\\n\\n\\\n#if TEXTURE_UNITS > 0\\n\\\nuniform sampler2D u_dayTextures[TEXTURE_UNITS];\\n\\\nuniform vec4 u_dayTextureTranslationAndScale[TEXTURE_UNITS];\\n\\\nuniform bool u_dayTextureUseWebMercatorT[TEXTURE_UNITS];\\n\\\n\\n\\\n#ifdef APPLY_ALPHA\\n\\\nuniform float u_dayTextureAlpha[TEXTURE_UNITS];\\n\\\n#endif\\n\\\n\\n\\\n#ifdef APPLY_SPLIT\\n\\\nuniform float u_dayTextureSplit[TEXTURE_UNITS];\\n\\\n#endif\\n\\\n\\n\\\n#ifdef APPLY_BRIGHTNESS\\n\\\nuniform float u_dayTextureBrightness[TEXTURE_UNITS];\\n\\\n#endif\\n\\\n\\n\\\n#ifdef APPLY_CONTRAST\\n\\\nuniform float u_dayTextureContrast[TEXTURE_UNITS];\\n\\\n#endif\\n\\\n\\n\\\n#ifdef APPLY_HUE\\n\\\nuniform float u_dayTextureHue[TEXTURE_UNITS];\\n\\\n#endif\\n\\\n\\n\\\n#ifdef APPLY_SATURATION\\n\\\nuniform float u_dayTextureSaturation[TEXTURE_UNITS];\\n\\\n#endif\\n\\\n\\n\\\n#ifdef APPLY_GAMMA\\n\\\nuniform float u_dayTextureOneOverGamma[TEXTURE_UNITS];\\n\\\n#endif\\n\\\n\\n\\\n#ifdef APPLY_IMAGERY_CUTOUT\\n\\\nuniform vec4 u_dayTextureCutoutRectangles[TEXTURE_UNITS];\\n\\\n#endif\\n\\\n\\n\\\n#ifdef APPLY_COLOR_TO_ALPHA\\n\\\nuniform vec4 u_colorsToAlpha[TEXTURE_UNITS];\\n\\\n#endif\\n\\\n\\n\\\nuniform vec4 u_dayTextureTexCoordsRectangle[TEXTURE_UNITS];\\n\\\n#endif\\n\\\n\\n\\\n#ifdef SHOW_REFLECTIVE_OCEAN\\n\\\nuniform sampler2D u_waterMask;\\n\\\nuniform vec4 u_waterMaskTranslationAndScale;\\n\\\nuniform float u_zoomedOutOceanSpecularIntensity;\\n\\\n#endif\\n\\\n\\n\\\n#ifdef SHOW_OCEAN_WAVES\\n\\\nuniform sampler2D u_oceanNormalMap;\\n\\\n#endif\\n\\\n\\n\\\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\\n\\\nuniform vec2 u_lightingFadeDistance;\\n\\\n#endif\\n\\\n\\n\\\n#ifdef TILE_LIMIT_RECTANGLE\\n\\\nuniform vec4 u_cartographicLimitRectangle;\\n\\\n#endif\\n\\\n\\n\\\n#ifdef GROUND_ATMOSPHERE\\n\\\nuniform vec2 u_nightFadeDistance;\\n\\\n#endif\\n\\\n\\n\\\n#ifdef ENABLE_CLIPPING_PLANES\\n\\\nuniform sampler2D u_clippingPlanes;\\n\\\nuniform mat4 u_clippingPlanesMatrix;\\n\\\nuniform vec4 u_clippingPlanesEdgeStyle;\\n\\\n#endif\\n\\\n\\n\\\n#ifdef SPLIT_TERRAIN\\n\\\nuniform float u_terrainSplitDirection;\\n\\\n#endif\\n\\\n\\n\\\n#if defined(FOG) && defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))\\n\\\nuniform float u_minimumBrightness;\\n\\\n#endif\\n\\\n\\n\\\n#ifdef COLOR_CORRECT\\n\\\nuniform vec3 u_hsbShift; // Hue, saturation, brightness\\n\\\n#endif\\n\\\n\\n\\\n#ifdef HIGHLIGHT_FILL_TILE\\n\\\nuniform vec4 u_fillHighlightColor;\\n\\\n#endif\\n\\\n\\n\\\nvarying vec3 v_positionMC;\\n\\\nvarying vec3 v_positionEC;\\n\\\nvarying vec3 v_textureCoordinates;\\n\\\nvarying vec3 v_normalMC;\\n\\\nvarying vec3 v_normalEC;\\n\\\n\\n\\\n#ifdef APPLY_MATERIAL\\n\\\nvarying float v_height;\\n\\\nvarying float v_slope;\\n\\\nvarying float v_aspect;\\n\\\n#endif\\n\\\n\\n\\\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\\n\\\nvarying float v_distance;\\n\\\nvarying vec3 v_fogRayleighColor;\\n\\\nvarying vec3 v_fogMieColor;\\n\\\n#endif\\n\\\n\\n\\\n#ifdef GROUND_ATMOSPHERE\\n\\\nvarying vec3 v_rayleighColor;\\n\\\nvarying vec3 v_mieColor;\\n\\\n#endif\\n\\\n\\n\\\nvec4 sampleAndBlend(\\n\\\n    vec4 previousColor,\\n\\\n    sampler2D textureToSample,\\n\\\n    vec2 tileTextureCoordinates,\\n\\\n    vec4 textureCoordinateRectangle,\\n\\\n    vec4 textureCoordinateTranslationAndScale,\\n\\\n    float textureAlpha,\\n\\\n    float textureBrightness,\\n\\\n    float textureContrast,\\n\\\n    float textureHue,\\n\\\n    float textureSaturation,\\n\\\n    float textureOneOverGamma,\\n\\\n    float split,\\n\\\n    vec4 colorToAlpha)\\n\\\n{\\n\\\n    // This crazy step stuff sets the alpha to 0.0 if this following condition is true:\\n\\\n    //    tileTextureCoordinates.s < textureCoordinateRectangle.s ||\\n\\\n    //    tileTextureCoordinates.s > textureCoordinateRectangle.p ||\\n\\\n    //    tileTextureCoordinates.t < textureCoordinateRectangle.t ||\\n\\\n    //    tileTextureCoordinates.t > textureCoordinateRectangle.q\\n\\\n    // In other words, the alpha is zero if the fragment is outside the rectangle\\n\\\n    // covered by this texture.  Would an actual 'if' yield better performance?\\n\\\n    vec2 alphaMultiplier = step(textureCoordinateRectangle.st, tileTextureCoordinates);\\n\\\n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\\n\\\n\\n\\\n    alphaMultiplier = step(vec2(0.0), textureCoordinateRectangle.pq - tileTextureCoordinates);\\n\\\n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\\n\\\n\\n\\\n    vec2 translation = textureCoordinateTranslationAndScale.xy;\\n\\\n    vec2 scale = textureCoordinateTranslationAndScale.zw;\\n\\\n    vec2 textureCoordinates = tileTextureCoordinates * scale + translation;\\n\\\n    vec4 value = texture2D(textureToSample, textureCoordinates);\\n\\\n    vec3 color = value.rgb;\\n\\\n    float alpha = value.a;\\n\\\n\\n\\\n#ifdef APPLY_COLOR_TO_ALPHA\\n\\\n    vec3 colorDiff = abs(color.rgb - colorToAlpha.rgb);\\n\\\n    colorDiff.r = max(max(colorDiff.r, colorDiff.g), colorDiff.b);\\n\\\n    alpha = czm_branchFreeTernary(colorDiff.r < colorToAlpha.a, 0.0, alpha);\\n\\\n#endif\\n\\\n\\n\\\n#if !defined(APPLY_GAMMA)\\n\\\n    vec4 tempColor = czm_gammaCorrect(vec4(color, alpha));\\n\\\n    color = tempColor.rgb;\\n\\\n    alpha = tempColor.a;\\n\\\n#else\\n\\\n    color = pow(color, vec3(textureOneOverGamma));\\n\\\n#endif\\n\\\n\\n\\\n#ifdef APPLY_SPLIT\\n\\\n    float splitPosition = czm_imagerySplitPosition;\\n\\\n    // Split to the left\\n\\\n    if (split < 0.0 && gl_FragCoord.x > splitPosition) {\\n\\\n       alpha = 0.0;\\n\\\n    }\\n\\\n    // Split to the right\\n\\\n    else if (split > 0.0 && gl_FragCoord.x < splitPosition) {\\n\\\n       alpha = 0.0;\\n\\\n    }\\n\\\n#endif\\n\\\n\\n\\\n#ifdef APPLY_BRIGHTNESS\\n\\\n    color = mix(vec3(0.0), color, textureBrightness);\\n\\\n#endif\\n\\\n\\n\\\n#ifdef APPLY_CONTRAST\\n\\\n    color = mix(vec3(0.5), color, textureContrast);\\n\\\n#endif\\n\\\n\\n\\\n#ifdef APPLY_HUE\\n\\\n    color = czm_hue(color, textureHue);\\n\\\n#endif\\n\\\n\\n\\\n#ifdef APPLY_SATURATION\\n\\\n    color = czm_saturation(color, textureSaturation);\\n\\\n#endif\\n\\\n\\n\\\n    float sourceAlpha = alpha * textureAlpha;\\n\\\n    float outAlpha = mix(previousColor.a, 1.0, sourceAlpha);\\n\\\n    outAlpha += sign(outAlpha) - 1.0;\\n\\\n\\n\\\n    vec3 outColor = mix(previousColor.rgb * previousColor.a, color, sourceAlpha) / outAlpha;\\n\\\n\\n\\\n    // When rendering imagery for a tile in multiple passes,\\n\\\n    // some GPU/WebGL implementation combinations will not blend fragments in\\n\\\n    // additional passes correctly if their computation includes an unmasked\\n\\\n    // divide-by-zero operation,\\n\\\n    // even if it's not in the output or if the output has alpha zero.\\n\\\n    //\\n\\\n    // For example, without sanitization for outAlpha,\\n\\\n    // this renders without artifacts:\\n\\\n    //   if (outAlpha == 0.0) { outColor = vec3(0.0); }\\n\\\n    //\\n\\\n    // but using czm_branchFreeTernary will cause portions of the tile that are\\n\\\n    // alpha-zero in the additional pass to render as black instead of blending\\n\\\n    // with the previous pass:\\n\\\n    //   outColor = czm_branchFreeTernary(outAlpha == 0.0, vec3(0.0), outColor);\\n\\\n    //\\n\\\n    // So instead, sanitize against divide-by-zero,\\n\\\n    // store this state on the sign of outAlpha, and correct on return.\\n\\\n\\n\\\n    return vec4(outColor, max(outAlpha, 0.0));\\n\\\n}\\n\\\n\\n\\\nvec3 colorCorrect(vec3 rgb) {\\n\\\n#ifdef COLOR_CORRECT\\n\\\n    // Convert rgb color to hsb\\n\\\n    vec3 hsb = czm_RGBToHSB(rgb);\\n\\\n    // Perform hsb shift\\n\\\n    hsb.x += u_hsbShift.x; // hue\\n\\\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\\n\\\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\\n\\\n    // Convert shifted hsb back to rgb\\n\\\n    rgb = czm_HSBToRGB(hsb);\\n\\\n#endif\\n\\\n    return rgb;\\n\\\n}\\n\\\n\\n\\\nvec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates);\\n\\\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float specularMapValue, float fade);\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n#ifdef TILE_LIMIT_RECTANGLE\\n\\\n    if (v_textureCoordinates.x < u_cartographicLimitRectangle.x || u_cartographicLimitRectangle.z < v_textureCoordinates.x ||\\n\\\n        v_textureCoordinates.y < u_cartographicLimitRectangle.y || u_cartographicLimitRectangle.w < v_textureCoordinates.y)\\n\\\n        {\\n\\\n            discard;\\n\\\n        }\\n\\\n#endif\\n\\\n\\n\\\n#ifdef SPLIT_TERRAIN\\n\\\n    float splitPosition = czm_imagerySplitPosition;\\n\\\n    if (u_terrainSplitDirection < 0.0 && gl_FragCoord.x > splitPosition) {\\n\\\n        discard;\\n\\\n    } else if (u_terrainSplitDirection > 0.0 && gl_FragCoord.x < splitPosition) {\\n\\\n        discard;\\n\\\n    }\\n\\\n#endif\\n\\\n\\n\\\n#ifdef ENABLE_CLIPPING_PLANES\\n\\\n    float clipDistance = clip(gl_FragCoord, u_clippingPlanes, u_clippingPlanesMatrix);\\n\\\n#endif\\n\\\n\\n\\\n    // The clamp below works around an apparent bug in Chrome Canary v23.0.1241.0\\n\\\n    // where the fragment shader sees textures coordinates < 0.0 and > 1.0 for the\\n\\\n    // fragments on the edges of tiles even though the vertex shader is outputting\\n\\\n    // coordinates strictly in the 0-1 range.\\n\\\n    vec4 color = computeDayColor(u_initialColor, clamp(v_textureCoordinates, 0.0, 1.0));\\n\\\n\\n\\\n#ifdef SHOW_TILE_BOUNDARIES\\n\\\n    if (v_textureCoordinates.x < (1.0/256.0) || v_textureCoordinates.x > (255.0/256.0) ||\\n\\\n        v_textureCoordinates.y < (1.0/256.0) || v_textureCoordinates.y > (255.0/256.0))\\n\\\n    {\\n\\\n        color = vec4(1.0, 0.0, 0.0, 1.0);\\n\\\n    }\\n\\\n#endif\\n\\\n\\n\\\n#if defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(HDR)\\n\\\n    vec3 normalMC = czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0));   // normalized surface normal in model coordinates\\n\\\n    vec3 normalEC = czm_normal3D * normalMC;                                         // normalized surface normal in eye coordiantes\\n\\\n#endif\\n\\\n\\n\\\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\\n\\\n    float cameraDist;\\n\\\n    if (czm_sceneMode == czm_sceneMode2D)\\n\\\n    {\\n\\\n        cameraDist = max(czm_frustumPlanes.x - czm_frustumPlanes.y, czm_frustumPlanes.w - czm_frustumPlanes.z) * 0.5;\\n\\\n    }\\n\\\n    else if (czm_sceneMode == czm_sceneModeColumbusView)\\n\\\n    {\\n\\\n        cameraDist = -czm_view[3].z;\\n\\\n    }\\n\\\n    else\\n\\\n    {\\n\\\n        cameraDist = length(czm_view[3]);\\n\\\n    }\\n\\\n    float fadeOutDist = u_lightingFadeDistance.x;\\n\\\n    float fadeInDist = u_lightingFadeDistance.y;\\n\\\n    if (czm_sceneMode != czm_sceneMode3D) {\\n\\\n        vec3 radii = czm_ellipsoidRadii;\\n\\\n        float maxRadii = max(radii.x, max(radii.y, radii.z));\\n\\\n        fadeOutDist -= maxRadii;\\n\\\n        fadeInDist -= maxRadii;\\n\\\n    }\\n\\\n    float fade = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\\n\\\n#else\\n\\\n    float fade = 0.0;\\n\\\n#endif\\n\\\n\\n\\\n#ifdef SHOW_REFLECTIVE_OCEAN\\n\\\n    vec2 waterMaskTranslation = u_waterMaskTranslationAndScale.xy;\\n\\\n    vec2 waterMaskScale = u_waterMaskTranslationAndScale.zw;\\n\\\n    vec2 waterMaskTextureCoordinates = v_textureCoordinates.xy * waterMaskScale + waterMaskTranslation;\\n\\\n    waterMaskTextureCoordinates.y = 1.0 - waterMaskTextureCoordinates.y;\\n\\\n\\n\\\n    float mask = texture2D(u_waterMask, waterMaskTextureCoordinates).r;\\n\\\n\\n\\\n    if (mask > 0.0)\\n\\\n    {\\n\\\n        mat3 enuToEye = czm_eastNorthUpToEyeCoordinates(v_positionMC, normalEC);\\n\\\n\\n\\\n        vec2 ellipsoidTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC);\\n\\\n        vec2 ellipsoidFlippedTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC.zyx);\\n\\\n\\n\\\n        vec2 textureCoordinates = mix(ellipsoidTextureCoordinates, ellipsoidFlippedTextureCoordinates, czm_morphTime * smoothstep(0.9, 0.95, normalMC.z));\\n\\\n\\n\\\n        color = computeWaterColor(v_positionEC, textureCoordinates, enuToEye, color, mask, fade);\\n\\\n    }\\n\\\n#endif\\n\\\n\\n\\\n#ifdef APPLY_MATERIAL\\n\\\n    czm_materialInput materialInput;\\n\\\n    materialInput.st = v_textureCoordinates.st;\\n\\\n    materialInput.normalEC = normalize(v_normalEC);\\n\\\n    materialInput.slope = v_slope;\\n\\\n    materialInput.height = v_height;\\n\\\n    materialInput.aspect = v_aspect;\\n\\\n    czm_material material = czm_getMaterial(materialInput);\\n\\\n    color.xyz = mix(color.xyz, material.diffuse, material.alpha);\\n\\\n#endif\\n\\\n\\n\\\n#ifdef ENABLE_VERTEX_LIGHTING\\n\\\n    float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalize(v_normalEC)) * 0.9 + 0.3, 0.0, 1.0);\\n\\\n    vec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);\\n\\\n#elif defined(ENABLE_DAYNIGHT_SHADING)\\n\\\n    float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * 5.0 + 0.3, 0.0, 1.0);\\n\\\n    diffuseIntensity = mix(1.0, diffuseIntensity, fade);\\n\\\n    vec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);\\n\\\n#else\\n\\\n    vec4 finalColor = color;\\n\\\n#endif\\n\\\n\\n\\\n#ifdef ENABLE_CLIPPING_PLANES\\n\\\n    vec4 clippingPlanesEdgeColor = vec4(1.0);\\n\\\n    clippingPlanesEdgeColor.rgb = u_clippingPlanesEdgeStyle.rgb;\\n\\\n    float clippingPlanesEdgeWidth = u_clippingPlanesEdgeStyle.a;\\n\\\n\\n\\\n    if (clipDistance < clippingPlanesEdgeWidth)\\n\\\n    {\\n\\\n        finalColor = clippingPlanesEdgeColor;\\n\\\n    }\\n\\\n#endif\\n\\\n\\n\\\n#ifdef HIGHLIGHT_FILL_TILE\\n\\\n    finalColor = vec4(mix(finalColor.rgb, u_fillHighlightColor.rgb, u_fillHighlightColor.a), finalColor.a);\\n\\\n#endif\\n\\\n\\n\\\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\\n\\\n    vec3 fogColor = colorCorrect(v_fogMieColor) + finalColor.rgb * colorCorrect(v_fogRayleighColor);\\n\\\n#ifndef HDR\\n\\\n    const float fExposure = 2.0;\\n\\\n    fogColor = vec3(1.0) - exp(-fExposure * fogColor);\\n\\\n#endif\\n\\\n#endif\\n\\\n\\n\\\n#if defined(DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN)\\n\\\n    vec3 atmosphereLightDirection = czm_sunDirectionWC;\\n\\\n#else\\n\\\n    vec3 atmosphereLightDirection = czm_lightDirectionWC;\\n\\\n#endif\\n\\\n\\n\\\n#ifdef FOG\\n\\\n#if defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))\\n\\\n    float darken = clamp(dot(normalize(czm_viewerPositionWC), atmosphereLightDirection), u_minimumBrightness, 1.0);\\n\\\n    fogColor *= darken;\\n\\\n#endif\\n\\\n\\n\\\n#ifdef HDR\\n\\\n    const float modifier = 0.15;\\n\\\n    finalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor, modifier), finalColor.a);\\n\\\n#else\\n\\\n    finalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor), finalColor.a);\\n\\\n#endif\\n\\\n#endif\\n\\\n\\n\\\n#ifdef GROUND_ATMOSPHERE\\n\\\n    if (czm_sceneMode != czm_sceneMode3D)\\n\\\n    {\\n\\\n        gl_FragColor = finalColor;\\n\\\n        return;\\n\\\n    }\\n\\\n\\n\\\n#if defined(PER_FRAGMENT_GROUND_ATMOSPHERE) && defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_DAYNIGHT_SHADING) || defined(ENABLE_VERTEX_LIGHTING))\\n\\\n    float mpp = czm_metersPerPixel(vec4(0.0, 0.0, -czm_currentFrustum.x, 1.0), 1.0);\\n\\\n    vec2 xy = gl_FragCoord.xy / czm_viewport.zw * 2.0 - vec2(1.0);\\n\\\n    xy *= czm_viewport.zw * mpp * 0.5;\\n\\\n\\n\\\n    vec3 direction = normalize(vec3(xy, -czm_currentFrustum.x));\\n\\\n    czm_ray ray = czm_ray(vec3(0.0), direction);\\n\\\n\\n\\\n    vec3 ellipsoid_center = czm_view[3].xyz;\\n\\\n\\n\\\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center, czm_ellipsoidInverseRadii);\\n\\\n\\n\\\n    vec3 ellipsoidPosition = czm_pointAlongRay(ray, intersection.start);\\n\\\n    ellipsoidPosition = (czm_inverseView * vec4(ellipsoidPosition, 1.0)).xyz;\\n\\\n    AtmosphereColor atmosColor = computeGroundAtmosphereFromSpace(ellipsoidPosition, true, atmosphereLightDirection);\\n\\\n\\n\\\n    vec3 groundAtmosphereColor = colorCorrect(atmosColor.mie) + finalColor.rgb * colorCorrect(atmosColor.rayleigh);\\n\\\n#ifndef HDR\\n\\\n    groundAtmosphereColor = vec3(1.0) - exp(-fExposure * groundAtmosphereColor);\\n\\\n#endif\\n\\\n\\n\\\n    fadeInDist = u_nightFadeDistance.x;\\n\\\n    fadeOutDist = u_nightFadeDistance.y;\\n\\\n\\n\\\n    float sunlitAtmosphereIntensity = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\\n\\\n\\n\\\n#ifdef HDR\\n\\\n    // Some tweaking to make HDR look better\\n\\\n    sunlitAtmosphereIntensity = max(sunlitAtmosphereIntensity * sunlitAtmosphereIntensity, 0.03);\\n\\\n#endif\\n\\\n\\n\\\n    groundAtmosphereColor = mix(groundAtmosphereColor, fogColor, sunlitAtmosphereIntensity);\\n\\\n#else\\n\\\n    vec3 groundAtmosphereColor = fogColor;\\n\\\n#endif\\n\\\n\\n\\\n#ifdef HDR\\n\\\n    // Some tweaking to make HDR look better\\n\\\n    groundAtmosphereColor = czm_saturation(groundAtmosphereColor, 1.6);\\n\\\n#endif\\n\\\n\\n\\\n    finalColor = vec4(mix(finalColor.rgb, groundAtmosphereColor, fade), finalColor.a);\\n\\\n#endif\\n\\\n\\n\\\n    gl_FragColor = finalColor;\\n\\\n}\\n\\\n\\n\\\n#ifdef SHOW_REFLECTIVE_OCEAN\\n\\\n\\n\\\nfloat waveFade(float edge0, float edge1, float x)\\n\\\n{\\n\\\n    float y = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\\n\\\n    return pow(1.0 - y, 5.0);\\n\\\n}\\n\\\n\\n\\\nfloat linearFade(float edge0, float edge1, float x)\\n\\\n{\\n\\\n    return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\\n\\\n}\\n\\\n\\n\\\n// Based on water rendering by Jonas Wagner:\\n\\\n// http://29a.ch/2012/7/19/webgl-terrain-rendering-water-fog\\n\\\n\\n\\\n// low altitude wave settings\\n\\\nconst float oceanFrequencyLowAltitude = 825000.0;\\n\\\nconst float oceanAnimationSpeedLowAltitude = 0.004;\\n\\\nconst float oceanOneOverAmplitudeLowAltitude = 1.0 / 2.0;\\n\\\nconst float oceanSpecularIntensity = 0.5;\\n\\\n\\n\\\n// high altitude wave settings\\n\\\nconst float oceanFrequencyHighAltitude = 125000.0;\\n\\\nconst float oceanAnimationSpeedHighAltitude = 0.008;\\n\\\nconst float oceanOneOverAmplitudeHighAltitude = 1.0 / 2.0;\\n\\\n\\n\\\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float maskValue, float fade)\\n\\\n{\\n\\\n    vec3 positionToEyeEC = -positionEyeCoordinates;\\n\\\n    float positionToEyeECLength = length(positionToEyeEC);\\n\\\n\\n\\\n    // The double normalize below works around a bug in Firefox on Android devices.\\n\\\n    vec3 normalizedPositionToEyeEC = normalize(normalize(positionToEyeEC));\\n\\\n\\n\\\n    // Fade out the waves as the camera moves far from the surface.\\n\\\n    float waveIntensity = waveFade(70000.0, 1000000.0, positionToEyeECLength);\\n\\\n\\n\\\n#ifdef SHOW_OCEAN_WAVES\\n\\\n    // high altitude waves\\n\\\n    float time = czm_frameNumber * oceanAnimationSpeedHighAltitude;\\n\\\n    vec4 noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyHighAltitude, time, 0.0);\\n\\\n    vec3 normalTangentSpaceHighAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeHighAltitude);\\n\\\n\\n\\\n    // low altitude waves\\n\\\n    time = czm_frameNumber * oceanAnimationSpeedLowAltitude;\\n\\\n    noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyLowAltitude, time, 0.0);\\n\\\n    vec3 normalTangentSpaceLowAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeLowAltitude);\\n\\\n\\n\\\n    // blend the 2 wave layers based on distance to surface\\n\\\n    float highAltitudeFade = linearFade(0.0, 60000.0, positionToEyeECLength);\\n\\\n    float lowAltitudeFade = 1.0 - linearFade(20000.0, 60000.0, positionToEyeECLength);\\n\\\n    vec3 normalTangentSpace =\\n\\\n        (highAltitudeFade * normalTangentSpaceHighAltitude) +\\n\\\n        (lowAltitudeFade * normalTangentSpaceLowAltitude);\\n\\\n    normalTangentSpace = normalize(normalTangentSpace);\\n\\\n\\n\\\n    // fade out the normal perturbation as we move farther from the water surface\\n\\\n    normalTangentSpace.xy *= waveIntensity;\\n\\\n    normalTangentSpace = normalize(normalTangentSpace);\\n\\\n#else\\n\\\n    vec3 normalTangentSpace = vec3(0.0, 0.0, 1.0);\\n\\\n#endif\\n\\\n\\n\\\n    vec3 normalEC = enuToEye * normalTangentSpace;\\n\\\n\\n\\\n    const vec3 waveHighlightColor = vec3(0.3, 0.45, 0.6);\\n\\\n\\n\\\n    // Use diffuse light to highlight the waves\\n\\\n    float diffuseIntensity = czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * maskValue;\\n\\\n    vec3 diffuseHighlight = waveHighlightColor * diffuseIntensity * (1.0 - fade);\\n\\\n\\n\\\n#ifdef SHOW_OCEAN_WAVES\\n\\\n    // Where diffuse light is low or non-existent, use wave highlights based solely on\\n\\\n    // the wave bumpiness and no particular light direction.\\n\\\n    float tsPerturbationRatio = normalTangentSpace.z;\\n\\\n    vec3 nonDiffuseHighlight = mix(waveHighlightColor * 5.0 * (1.0 - tsPerturbationRatio), vec3(0.0), diffuseIntensity);\\n\\\n#else\\n\\\n    vec3 nonDiffuseHighlight = vec3(0.0);\\n\\\n#endif\\n\\\n\\n\\\n    // Add specular highlights in 3D, and in all modes when zoomed in.\\n\\\n    float specularIntensity = czm_getSpecular(czm_lightDirectionEC, normalizedPositionToEyeEC, normalEC, 10.0);\\n\\\n    float surfaceReflectance = mix(0.0, mix(u_zoomedOutOceanSpecularIntensity, oceanSpecularIntensity, waveIntensity), maskValue);\\n\\\n    float specular = specularIntensity * surfaceReflectance;\\n\\\n\\n\\\n#ifdef HDR\\n\\\n    specular *= 1.4;\\n\\\n\\n\\\n    float e = 0.2;\\n\\\n    float d = 3.3;\\n\\\n    float c = 1.7;\\n\\\n\\n\\\n    vec3 color = imageryColor.rgb + (c * (vec3(e) + imageryColor.rgb * d) * (diffuseHighlight + nonDiffuseHighlight + specular));\\n\\\n#else\\n\\\n    vec3 color = imageryColor.rgb + diffuseHighlight + nonDiffuseHighlight + specular;\\n\\\n#endif\\n\\\n\\n\\\n    return vec4(color, imageryColor.a);\\n\\\n}\\n\\\n\\n\\\n#endif // #ifdef SHOW_REFLECTIVE_OCEAN\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"#ifdef QUANTIZATION_BITS12\\n\\\nattribute vec4 compressed0;\\n\\\nattribute float compressed1;\\n\\\n#else\\n\\\nattribute vec4 position3DAndHeight;\\n\\\nattribute vec4 textureCoordAndEncodedNormals;\\n\\\n#endif\\n\\\n\\n\\\nuniform vec3 u_center3D;\\n\\\nuniform mat4 u_modifiedModelView;\\n\\\nuniform mat4 u_modifiedModelViewProjection;\\n\\\nuniform vec4 u_tileRectangle;\\n\\\n\\n\\\n// Uniforms for 2D Mercator projection\\n\\\nuniform vec2 u_southAndNorthLatitude;\\n\\\nuniform vec2 u_southMercatorYAndOneOverHeight;\\n\\\n\\n\\\nvarying vec3 v_positionMC;\\n\\\nvarying vec3 v_positionEC;\\n\\\n\\n\\\nvarying vec3 v_textureCoordinates;\\n\\\nvarying vec3 v_normalMC;\\n\\\nvarying vec3 v_normalEC;\\n\\\n\\n\\\n#ifdef APPLY_MATERIAL\\n\\\nvarying float v_slope;\\n\\\nvarying float v_aspect;\\n\\\nvarying float v_height;\\n\\\n#endif\\n\\\n\\n\\\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\\n\\\nvarying float v_distance;\\n\\\nvarying vec3 v_fogMieColor;\\n\\\nvarying vec3 v_fogRayleighColor;\\n\\\n#endif\\n\\\n\\n\\\n// These functions are generated at runtime.\\n\\\nvec4 getPosition(vec3 position, float height, vec2 textureCoordinates);\\n\\\nfloat get2DYPositionFraction(vec2 textureCoordinates);\\n\\\n\\n\\\nvec4 getPosition3DMode(vec3 position, float height, vec2 textureCoordinates)\\n\\\n{\\n\\\n    return u_modifiedModelViewProjection * vec4(position, 1.0);\\n\\\n}\\n\\\n\\n\\\nfloat get2DMercatorYPositionFraction(vec2 textureCoordinates)\\n\\\n{\\n\\\n    // The width of a tile at level 11, in radians and assuming a single root tile, is\\n\\\n    //   2.0 * czm_pi / pow(2.0, 11.0)\\n\\\n    // We want to just linearly interpolate the 2D position from the texture coordinates\\n\\\n    // when we're at this level or higher.  The constant below is the expression\\n\\\n    // above evaluated and then rounded up at the 4th significant digit.\\n\\\n    const float maxTileWidth = 0.003068;\\n\\\n    float positionFraction = textureCoordinates.y;\\n\\\n    float southLatitude = u_southAndNorthLatitude.x;\\n\\\n    float northLatitude = u_southAndNorthLatitude.y;\\n\\\n    if (northLatitude - southLatitude > maxTileWidth)\\n\\\n    {\\n\\\n        float southMercatorY = u_southMercatorYAndOneOverHeight.x;\\n\\\n        float oneOverMercatorHeight = u_southMercatorYAndOneOverHeight.y;\\n\\\n\\n\\\n        float currentLatitude = mix(southLatitude, northLatitude, textureCoordinates.y);\\n\\\n        currentLatitude = clamp(currentLatitude, -czm_webMercatorMaxLatitude, czm_webMercatorMaxLatitude);\\n\\\n        positionFraction = czm_latitudeToWebMercatorFraction(currentLatitude, southMercatorY, oneOverMercatorHeight);\\n\\\n    }\\n\\\n    return positionFraction;\\n\\\n}\\n\\\n\\n\\\nfloat get2DGeographicYPositionFraction(vec2 textureCoordinates)\\n\\\n{\\n\\\n    return textureCoordinates.y;\\n\\\n}\\n\\\n\\n\\\nvec4 getPositionPlanarEarth(vec3 position, float height, vec2 textureCoordinates)\\n\\\n{\\n\\\n    float yPositionFraction = get2DYPositionFraction(textureCoordinates);\\n\\\n    vec4 rtcPosition2D = vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);\\n\\\n    return u_modifiedModelViewProjection * rtcPosition2D;\\n\\\n}\\n\\\n\\n\\\nvec4 getPosition2DMode(vec3 position, float height, vec2 textureCoordinates)\\n\\\n{\\n\\\n    return getPositionPlanarEarth(position, 0.0, textureCoordinates);\\n\\\n}\\n\\\n\\n\\\nvec4 getPositionColumbusViewMode(vec3 position, float height, vec2 textureCoordinates)\\n\\\n{\\n\\\n    return getPositionPlanarEarth(position, height, textureCoordinates);\\n\\\n}\\n\\\n\\n\\\nvec4 getPositionMorphingMode(vec3 position, float height, vec2 textureCoordinates)\\n\\\n{\\n\\\n    // We do not do RTC while morphing, so there is potential for jitter.\\n\\\n    // This is unlikely to be noticeable, though.\\n\\\n    vec3 position3DWC = position + u_center3D;\\n\\\n    float yPositionFraction = get2DYPositionFraction(textureCoordinates);\\n\\\n    vec4 position2DWC = vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);\\n\\\n    vec4 morphPosition = czm_columbusViewMorph(position2DWC, vec4(position3DWC, 1.0), czm_morphTime);\\n\\\n    return czm_modelViewProjection * morphPosition;\\n\\\n}\\n\\\n\\n\\\n#ifdef QUANTIZATION_BITS12\\n\\\nuniform vec2 u_minMaxHeight;\\n\\\nuniform mat4 u_scaleAndBias;\\n\\\n#endif\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n#ifdef QUANTIZATION_BITS12\\n\\\n    vec2 xy = czm_decompressTextureCoordinates(compressed0.x);\\n\\\n    vec2 zh = czm_decompressTextureCoordinates(compressed0.y);\\n\\\n    vec3 position = vec3(xy, zh.x);\\n\\\n    float height = zh.y;\\n\\\n    vec2 textureCoordinates = czm_decompressTextureCoordinates(compressed0.z);\\n\\\n\\n\\\n    height = height * (u_minMaxHeight.y - u_minMaxHeight.x) + u_minMaxHeight.x;\\n\\\n    position = (u_scaleAndBias * vec4(position, 1.0)).xyz;\\n\\\n\\n\\\n#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)) && defined(INCLUDE_WEB_MERCATOR_Y)\\n\\\n    float webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;\\n\\\n    float encodedNormal = compressed1;\\n\\\n#elif defined(INCLUDE_WEB_MERCATOR_Y)\\n\\\n    float webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;\\n\\\n    float encodedNormal = 0.0;\\n\\\n#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)\\n\\\n    float webMercatorT = textureCoordinates.y;\\n\\\n    float encodedNormal = compressed0.w;\\n\\\n#else\\n\\\n    float webMercatorT = textureCoordinates.y;\\n\\\n    float encodedNormal = 0.0;\\n\\\n#endif\\n\\\n\\n\\\n#else\\n\\\n    // A single float per element\\n\\\n    vec3 position = position3DAndHeight.xyz;\\n\\\n    float height = position3DAndHeight.w;\\n\\\n    vec2 textureCoordinates = textureCoordAndEncodedNormals.xy;\\n\\\n\\n\\\n#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)) && defined(INCLUDE_WEB_MERCATOR_Y)\\n\\\n    float webMercatorT = textureCoordAndEncodedNormals.z;\\n\\\n    float encodedNormal = textureCoordAndEncodedNormals.w;\\n\\\n#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)\\n\\\n    float webMercatorT = textureCoordinates.y;\\n\\\n    float encodedNormal = textureCoordAndEncodedNormals.z;\\n\\\n#elif defined(INCLUDE_WEB_MERCATOR_Y)\\n\\\n    float webMercatorT = textureCoordAndEncodedNormals.z;\\n\\\n    float encodedNormal = 0.0;\\n\\\n#else\\n\\\n    float webMercatorT = textureCoordinates.y;\\n\\\n    float encodedNormal = 0.0;\\n\\\n#endif\\n\\\n\\n\\\n#endif\\n\\\n\\n\\\n    vec3 position3DWC = position + u_center3D;\\n\\\n    gl_Position = getPosition(position, height, textureCoordinates);\\n\\\n\\n\\\n    v_textureCoordinates = vec3(textureCoordinates, webMercatorT);\\n\\\n\\n\\\n#if defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)\\n\\\n    v_positionEC = (u_modifiedModelView * vec4(position, 1.0)).xyz;\\n\\\n    v_positionMC = position3DWC;  // position in model coordinates\\n\\\n    vec3 normalMC = czm_octDecode(encodedNormal);\\n\\\n    v_normalMC = normalMC;\\n\\\n    v_normalEC = czm_normal3D * v_normalMC;\\n\\\n#elif defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(GENERATE_POSITION) || defined(HDR)\\n\\\n    v_positionEC = (u_modifiedModelView * vec4(position, 1.0)).xyz;\\n\\\n    v_positionMC = position3DWC;  // position in model coordinates\\n\\\n#endif\\n\\\n\\n\\\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\\n\\\n    AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(position3DWC, false, vec3(0.0));\\n\\\n    v_fogMieColor = atmosFogColor.mie;\\n\\\n    v_fogRayleighColor = atmosFogColor.rayleigh;\\n\\\n    v_distance = length((czm_modelView3D * vec4(position3DWC, 1.0)).xyz);\\n\\\n#endif\\n\\\n\\n\\\n#ifdef APPLY_MATERIAL\\n\\\n    float northPoleZ = czm_ellipsoidRadii.z;\\n\\\n    vec3 northPolePositionMC = vec3(0.0, 0.0, northPoleZ);\\n\\\n    vec3 ellipsoidNormal = normalize(v_positionMC); // For a sphere this is correct, but not generally for an ellipsoid.\\n\\\n    vec3 vectorEastMC = normalize(cross(northPolePositionMC - v_positionMC, ellipsoidNormal));\\n\\\n    float dotProd = abs(dot(ellipsoidNormal, v_normalMC));\\n\\\n    v_slope = acos(dotProd);\\n\\\n    vec3 normalRejected = ellipsoidNormal * dotProd;\\n\\\n    vec3 normalProjected = v_normalMC - normalRejected;\\n\\\n    vec3 aspectVector = normalize(normalProjected);\\n\\\n    v_aspect = acos(dot(aspectVector, vectorEastMC));\\n\\\n    float determ = dot(cross(vectorEastMC, aspectVector), ellipsoidNormal);\\n\\\n    v_aspect = czm_branchFreeTernary(determ < 0.0, 2.0 * czm_pi - v_aspect, v_aspect);\\n\\\n    v_height = height;\\n\\\n#endif\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"/*!\\n\\\n * Atmosphere code:\\n\\\n *\\n\\\n * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)\\n\\\n * All rights reserved.\\n\\\n *\\n\\\n * Redistribution and use in source and binary forms, with or without\\n\\\n * modification, are permitted provided that the following conditions\\n\\\n * are met:\\n\\\n *\\n\\\n * * Redistributions of source code must retain the above copyright notice,\\n\\\n *   this list of conditions and the following disclaimer.\\n\\\n * * Redistributions in binary form must reproduce the above copyright notice,\\n\\\n *   this list of conditions and the following disclaimer in the documentation\\n\\\n *   and/or other materials provided with the distribution.\\n\\\n * * Neither the name of the project nor the names of its contributors may be\\n\\\n *   used to endorse or promote products derived from this software without\\n\\\n *   specific prior written permission.\\n\\\n *\\n\\\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \\\"AS IS\\\"\\n\\\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\\n\\\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\\n\\\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\\n\\\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\\n\\\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\\n\\\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\\n\\\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\\n\\\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\\n\\\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\\n\\\n *\\n\\\n * Modifications made by Analytical Graphics, Inc.\\n\\\n */\\n\\\n\\n\\\n // Atmosphere:\\n\\\n //   Code:  http://sponeil.net/\\n\\\n //   GPU Gems 2 Article:  https://developer.nvidia.com/gpugems/GPUGems2/gpugems2_chapter16.html\\n\\\n\\n\\\nconst float Kr = 0.0025;\\n\\\nconst float Km = 0.0015;\\n\\\nconst float ESun = 15.0;\\n\\\n\\n\\\nconst float fKrESun = Kr * ESun;\\n\\\nconst float fKmESun = Km * ESun;\\n\\\nconst float fKr4PI = Kr * 4.0 * czm_pi;\\n\\\nconst float fKm4PI = Km * 4.0 * czm_pi;\\n\\\n\\n\\\n// Original: vec3(1.0 / pow(0.650, 4.0), 1.0 / pow(0.570, 4.0), 1.0 / pow(0.475, 4.0));\\n\\\nconst vec3 v3InvWavelength = vec3(5.60204474633241, 9.473284437923038, 19.64380261047721);\\n\\\n\\n\\\nconst float fScaleDepth = 0.25;\\n\\\n\\n\\\nstruct AtmosphereColor\\n\\\n{\\n\\\n    vec3 mie;\\n\\\n    vec3 rayleigh;\\n\\\n};\\n\\\n\\n\\\nconst int nSamples = 2;\\n\\\nconst float fSamples = 2.0;\\n\\\n\\n\\\nfloat scale(float fCos)\\n\\\n{\\n\\\n    float x = 1.0 - fCos;\\n\\\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\\n\\\n}\\n\\\n\\n\\\nAtmosphereColor computeGroundAtmosphereFromSpace(vec3 v3Pos, bool dynamicLighting, vec3 lightDirectionWC)\\n\\\n{\\n\\\n    float fInnerRadius = czm_ellipsoidRadii.x;\\n\\\n    float fOuterRadius = czm_ellipsoidRadii.x * 1.025;\\n\\\n    float fOuterRadius2 = fOuterRadius * fOuterRadius;\\n\\\n\\n\\\n    float fScale = 1.0 / (fOuterRadius - fInnerRadius);\\n\\\n    float fScaleOverScaleDepth = fScale / fScaleDepth;\\n\\\n\\n\\\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\\n\\\n    vec3 v3Ray = v3Pos - czm_viewerPositionWC;\\n\\\n    float fFar = length(v3Ray);\\n\\\n    v3Ray /= fFar;\\n\\\n\\n\\\n    float fCameraHeight = length(czm_viewerPositionWC);\\n\\\n    float fCameraHeight2 = fCameraHeight * fCameraHeight;\\n\\\n\\n\\\n    // This next line is an ANGLE workaround. It is equivalent to B = 2.0 * dot(czm_viewerPositionWC, v3Ray),\\n\\\n    // which is what it should be, but there are problems at the poles.\\n\\\n    float B = 2.0 * length(czm_viewerPositionWC) * dot(normalize(czm_viewerPositionWC), v3Ray);\\n\\\n    float C = fCameraHeight2 - fOuterRadius2;\\n\\\n    float fDet = max(0.0, B*B - 4.0 * C);\\n\\\n    float fNear = 0.5 * (-B - sqrt(fDet));\\n\\\n\\n\\\n    // Calculate the ray's starting position, then calculate its scattering offset\\n\\\n    vec3 v3Start = czm_viewerPositionWC + v3Ray * fNear;\\n\\\n    fFar -= fNear;\\n\\\n    float fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);\\n\\\n\\n\\\n    // The light angle based on the scene's light source would be:\\n\\\n    //    dot(lightDirectionWC, v3Pos) / length(v3Pos);\\n\\\n    // When we want the atmosphere to be uniform over the globe so it is set to 1.0.\\n\\\n\\n\\\n    float fLightAngle = czm_branchFreeTernary(dynamicLighting, dot(lightDirectionWC, v3Pos) / length(v3Pos), 1.0);\\n\\\n    float fCameraAngle = dot(-v3Ray, v3Pos) / length(v3Pos);\\n\\\n    float fCameraScale = scale(fCameraAngle);\\n\\\n    float fLightScale = scale(fLightAngle);\\n\\\n    float fCameraOffset = fDepth*fCameraScale;\\n\\\n    float fTemp = (fLightScale + fCameraScale);\\n\\\n\\n\\\n    // Initialize the scattering loop variables\\n\\\n    float fSampleLength = fFar / fSamples;\\n\\\n    float fScaledLength = fSampleLength * fScale;\\n\\\n    vec3 v3SampleRay = v3Ray * fSampleLength;\\n\\\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\\n\\\n\\n\\\n    // Now loop through the sample rays\\n\\\n    vec3 v3FrontColor = vec3(0.0);\\n\\\n    vec3 v3Attenuate = vec3(0.0);\\n\\\n    for(int i=0; i<nSamples; i++)\\n\\\n    {\\n\\\n        float fHeight = length(v3SamplePoint);\\n\\\n        float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\\n\\\n        float fScatter = fDepth*fTemp - fCameraOffset;\\n\\\n        v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\\n\\\n        v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\\n\\\n        v3SamplePoint += v3SampleRay;\\n\\\n    }\\n\\\n\\n\\\n    AtmosphereColor color;\\n\\\n    color.mie = v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);\\n\\\n    color.rayleigh = v3Attenuate; // Calculate the attenuation factor for the ground\\n\\\n\\n\\\n    return color;\\n\\\n}\\n\\\n\\n\\\n\";\n","import defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport TerrainQuantization from '../Core/TerrainQuantization.js';\nimport ShaderProgram from '../Renderer/ShaderProgram.js';\nimport getClippingFunction from './getClippingFunction.js';\nimport SceneMode from './SceneMode.js';\n\n    function GlobeSurfaceShader(numberOfDayTextures, flags, material, shaderProgram, clippingShaderState) {\n        this.numberOfDayTextures = numberOfDayTextures;\n        this.flags = flags;\n        this.material = material;\n        this.shaderProgram = shaderProgram;\n        this.clippingShaderState = clippingShaderState;\n    }\n\n    /**\n     * Manages the shaders used to shade the surface of a {@link Globe}.\n     *\n     * @alias GlobeSurfaceShaderSet\n     * @private\n     */\n    function GlobeSurfaceShaderSet() {\n        this.baseVertexShaderSource = undefined;\n        this.baseFragmentShaderSource = undefined;\n\n        this._shadersByTexturesFlags = [];\n\n        this.material = undefined;\n    }\n\n    function getPositionMode(sceneMode) {\n        var getPosition3DMode = 'vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPosition3DMode(position, height, textureCoordinates); }';\n        var getPositionColumbusViewAnd2DMode = 'vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionColumbusViewMode(position, height, textureCoordinates); }';\n        var getPositionMorphingMode = 'vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionMorphingMode(position, height, textureCoordinates); }';\n\n        var positionMode;\n\n        switch (sceneMode) {\n        case SceneMode.SCENE3D:\n            positionMode = getPosition3DMode;\n            break;\n        case SceneMode.SCENE2D:\n        case SceneMode.COLUMBUS_VIEW:\n            positionMode = getPositionColumbusViewAnd2DMode;\n            break;\n        case SceneMode.MORPHING:\n            positionMode = getPositionMorphingMode;\n            break;\n        }\n\n        return positionMode;\n    }\n\n    function get2DYPositionFraction(useWebMercatorProjection) {\n        var get2DYPositionFractionGeographicProjection = 'float get2DYPositionFraction(vec2 textureCoordinates) { return get2DGeographicYPositionFraction(textureCoordinates); }';\n        var get2DYPositionFractionMercatorProjection = 'float get2DYPositionFraction(vec2 textureCoordinates) { return get2DMercatorYPositionFraction(textureCoordinates); }';\n        return useWebMercatorProjection ? get2DYPositionFractionMercatorProjection : get2DYPositionFractionGeographicProjection;\n    }\n\n    GlobeSurfaceShaderSet.prototype.getShaderProgram = function(options) {\n        var frameState = options.frameState;\n        var surfaceTile = options.surfaceTile;\n        var numberOfDayTextures = options.numberOfDayTextures;\n        var applyBrightness = options.applyBrightness;\n        var applyContrast = options.applyContrast;\n        var applyHue = options.applyHue;\n        var applySaturation = options.applySaturation;\n        var applyGamma = options.applyGamma;\n        var applyAlpha = options.applyAlpha;\n        var applySplit = options.applySplit;\n        var showReflectiveOcean = options.showReflectiveOcean;\n        var showOceanWaves = options.showOceanWaves;\n        var enableLighting = options.enableLighting;\n        var dynamicAtmosphereLighting = options.dynamicAtmosphereLighting;\n        var dynamicAtmosphereLightingFromSun = options.dynamicAtmosphereLightingFromSun;\n        var showGroundAtmosphere = options.showGroundAtmosphere;\n        var perFragmentGroundAtmosphere = options.perFragmentGroundAtmosphere;\n        var hasVertexNormals = options.hasVertexNormals;\n        var useWebMercatorProjection = options.useWebMercatorProjection;\n        var enableFog = options.enableFog;\n        var enableClippingPlanes = options.enableClippingPlanes;\n        var clippingPlanes = options.clippingPlanes;\n        var clippedByBoundaries = options.clippedByBoundaries;\n        var splitTerrain = options.splitTerrain;\n        var hasImageryLayerCutout = options.hasImageryLayerCutout;\n        var colorCorrect = options.colorCorrect;\n        var highlightFillTile = options.highlightFillTile;\n        var colorToAlpha = options.colorToAlpha;\n\n        var quantization = 0;\n        var quantizationDefine = '';\n\n        var mesh = surfaceTile.renderedMesh;\n        var terrainEncoding = mesh.encoding;\n        var quantizationMode = terrainEncoding.quantization;\n        if (quantizationMode === TerrainQuantization.BITS12) {\n            quantization = 1;\n            quantizationDefine = 'QUANTIZATION_BITS12';\n        }\n\n        var cartographicLimitRectangleFlag = 0;\n        var cartographicLimitRectangleDefine = '';\n        if (clippedByBoundaries) {\n            cartographicLimitRectangleFlag = 1;\n            cartographicLimitRectangleDefine = 'TILE_LIMIT_RECTANGLE';\n        }\n\n        var imageryCutoutFlag = 0;\n        var imageryCutoutDefine = '';\n        if (hasImageryLayerCutout) {\n            imageryCutoutFlag = 1;\n            imageryCutoutDefine = 'APPLY_IMAGERY_CUTOUT';\n        }\n\n        var sceneMode = frameState.mode;\n        // It turns out this flags parameter is really just a hash of the settings you use to create the shader\n        // And it uses the hash to memoize shaders\n        // So the values of these numbers don't really matter, \n        // as long as none of the numbers overlap/overwrite each other\n        var flags = sceneMode |\n                    (applyBrightness << 2) |\n                    (applyContrast << 3) |\n                    (applyHue << 4) |\n                    (applySaturation << 5) |\n                    (applyGamma << 6) |\n                    (applyAlpha << 7) |\n                    (showReflectiveOcean << 8) |\n                    (showOceanWaves << 9) |\n                    (enableLighting << 10) |\n                    (dynamicAtmosphereLighting << 11) |\n                    (dynamicAtmosphereLightingFromSun << 12) |\n                    (showGroundAtmosphere << 13) |\n                    (perFragmentGroundAtmosphere << 14) |\n                    (hasVertexNormals << 15) |\n                    (useWebMercatorProjection << 16) |\n                    (enableFog << 17) |\n                    (quantization << 18) |\n                    (applySplit << 19) |\n                    (enableClippingPlanes << 20) |\n                    (cartographicLimitRectangleFlag << 21) |\n                    (imageryCutoutFlag << 22) |\n                    (colorCorrect << 23) |\n                    (highlightFillTile << 24) |\n                    (colorToAlpha << 25) |\n                    (splitTerrain << 26);\n\n        var currentClippingShaderState = 0;\n        if (defined(clippingPlanes) && clippingPlanes.length > 0) {\n            currentClippingShaderState = enableClippingPlanes ? clippingPlanes.clippingPlanesState : 0;\n        }\n        var surfaceShader = surfaceTile.surfaceShader;\n        if (defined(surfaceShader) &&\n            surfaceShader.numberOfDayTextures === numberOfDayTextures &&\n            surfaceShader.flags === flags &&\n            surfaceShader.material === this.material &&\n            surfaceShader.clippingShaderState === currentClippingShaderState) {\n\n            return surfaceShader.shaderProgram;\n        }\n\n        // New tile, or tile changed number of textures, flags, or clipping planes\n        var shadersByFlags = this._shadersByTexturesFlags[numberOfDayTextures];\n        if (!defined(shadersByFlags)) {\n            shadersByFlags = this._shadersByTexturesFlags[numberOfDayTextures] = [];\n        }\n\n        surfaceShader = shadersByFlags[flags];\n        if (!defined(surfaceShader) || surfaceShader.material !== this.material || surfaceShader.clippingShaderState !== currentClippingShaderState) {\n            // Cache miss - we've never seen this combination of numberOfDayTextures and flags before.\n            var vs = this.baseVertexShaderSource.clone();\n            var fs = this.baseFragmentShaderSource.clone();\n\n            if (currentClippingShaderState !== 0) {\n                fs.sources.unshift(getClippingFunction(clippingPlanes, frameState.context)); // Need to go before GlobeFS\n            }\n\n            vs.defines.push(quantizationDefine);\n            fs.defines.push('TEXTURE_UNITS ' + numberOfDayTextures, cartographicLimitRectangleDefine, imageryCutoutDefine);\n\n            if (applyBrightness) {\n                fs.defines.push('APPLY_BRIGHTNESS');\n            }\n            if (applyContrast) {\n                fs.defines.push('APPLY_CONTRAST');\n            }\n            if (applyHue) {\n                fs.defines.push('APPLY_HUE');\n            }\n            if (applySaturation) {\n                fs.defines.push('APPLY_SATURATION');\n            }\n            if (applyGamma) {\n                fs.defines.push('APPLY_GAMMA');\n            }\n            if (applyAlpha) {\n                fs.defines.push('APPLY_ALPHA');\n            }\n            if (showReflectiveOcean) {\n                fs.defines.push('SHOW_REFLECTIVE_OCEAN');\n                vs.defines.push('SHOW_REFLECTIVE_OCEAN');\n            }\n            if (showOceanWaves) {\n                fs.defines.push('SHOW_OCEAN_WAVES');\n            }\n            if (colorToAlpha) {\n                fs.defines.push('APPLY_COLOR_TO_ALPHA');\n            }\n\n            if (enableLighting) {\n                if (hasVertexNormals) {\n                    vs.defines.push('ENABLE_VERTEX_LIGHTING');\n                    fs.defines.push('ENABLE_VERTEX_LIGHTING');\n                } else {\n                    vs.defines.push('ENABLE_DAYNIGHT_SHADING');\n                    fs.defines.push('ENABLE_DAYNIGHT_SHADING');\n                }\n            }\n\n            if (dynamicAtmosphereLighting) {\n                fs.defines.push('DYNAMIC_ATMOSPHERE_LIGHTING');\n                if (dynamicAtmosphereLightingFromSun) {\n                    fs.defines.push('DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN');\n                }\n            }\n\n            if (showGroundAtmosphere) {\n                vs.defines.push('GROUND_ATMOSPHERE');\n                fs.defines.push('GROUND_ATMOSPHERE');\n                if (perFragmentGroundAtmosphere) {\n                    fs.defines.push('PER_FRAGMENT_GROUND_ATMOSPHERE');\n                }\n            }\n\n            vs.defines.push('INCLUDE_WEB_MERCATOR_Y');\n            fs.defines.push('INCLUDE_WEB_MERCATOR_Y');\n\n            if (enableFog) {\n                vs.defines.push('FOG');\n                fs.defines.push('FOG');\n            }\n\n            if (applySplit) {\n                fs.defines.push('APPLY_SPLIT');\n            }\n\n            if (enableClippingPlanes) {\n                fs.defines.push('ENABLE_CLIPPING_PLANES');\n            }\n\n            if (splitTerrain) {\n                fs.defines.push('SPLIT_TERRAIN');\n            }\n\n            if (colorCorrect) {\n                fs.defines.push('COLOR_CORRECT');\n            }\n\n            if (highlightFillTile) {\n                fs.defines.push('HIGHLIGHT_FILL_TILE');\n            }\n\n            var computeDayColor = '\\\n    vec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates)\\n\\\n    {\\n\\\n        vec4 color = initialColor;\\n';\n\n        if (hasImageryLayerCutout) {\n            computeDayColor += '\\\n        vec4 cutoutAndColorResult;\\n\\\n        bool texelUnclipped;\\n';\n        }\n\n            for (var i = 0; i < numberOfDayTextures; ++i) {\n                if (hasImageryLayerCutout) {\n                    computeDayColor += '\\\n        cutoutAndColorResult = u_dayTextureCutoutRectangles[' + i + '];\\n\\\n        texelUnclipped = v_textureCoordinates.x < cutoutAndColorResult.x || cutoutAndColorResult.z < v_textureCoordinates.x || v_textureCoordinates.y < cutoutAndColorResult.y || cutoutAndColorResult.w < v_textureCoordinates.y;\\n\\\n        cutoutAndColorResult = sampleAndBlend(\\n';\n                } else {\n                    computeDayColor += '\\\n        color = sampleAndBlend(\\n';\n                }\n        computeDayColor += '\\\n            color,\\n\\\n            u_dayTextures[' + i + '],\\n\\\n            u_dayTextureUseWebMercatorT[' + i + '] ? textureCoordinates.xz : textureCoordinates.xy,\\n\\\n            u_dayTextureTexCoordsRectangle[' + i + '],\\n\\\n            u_dayTextureTranslationAndScale[' + i + '],\\n\\\n            ' + (applyAlpha ? 'u_dayTextureAlpha[' + i + ']' : '1.0') + ',\\n\\\n            ' + (applyBrightness ? 'u_dayTextureBrightness[' + i + ']' : '0.0') + ',\\n\\\n            ' + (applyContrast ? 'u_dayTextureContrast[' + i + ']' : '0.0') + ',\\n\\\n            ' + (applyHue ? 'u_dayTextureHue[' + i + ']' : '0.0') + ',\\n\\\n            ' + (applySaturation ? 'u_dayTextureSaturation[' + i + ']' : '0.0') + ',\\n\\\n            ' + (applyGamma ? 'u_dayTextureOneOverGamma[' + i + ']' : '0.0') + ',\\n\\\n            ' + (applySplit ? 'u_dayTextureSplit[' + i + ']' : '0.0') + ',\\n\\\n            ' + (colorToAlpha ? 'u_colorsToAlpha[' + i + ']' : 'vec4(0.0)') + '\\n\\\n        );\\n';\n                if (hasImageryLayerCutout) {\n                    computeDayColor += '\\\n        color = czm_branchFreeTernary(texelUnclipped, cutoutAndColorResult, color);\\n';\n                }\n            }\n\n            computeDayColor += '\\\n        return color;\\n\\\n    }';\n\n            fs.sources.push(computeDayColor);\n\n            vs.sources.push(getPositionMode(sceneMode));\n            vs.sources.push(get2DYPositionFraction(useWebMercatorProjection));\n\n            var shader = ShaderProgram.fromCache({\n                context : frameState.context,\n                vertexShaderSource : vs,\n                fragmentShaderSource : fs,\n                attributeLocations : terrainEncoding.getAttributeLocations()\n            });\n\n            surfaceShader = shadersByFlags[flags] = new GlobeSurfaceShader(numberOfDayTextures, flags, this.material, shader, currentClippingShaderState);\n        }\n\n        surfaceTile.surfaceShader = surfaceShader;\n        return surfaceShader.shaderProgram;\n    };\n\n    GlobeSurfaceShaderSet.prototype.destroy = function() {\n        var flags;\n        var shader;\n\n        var shadersByTexturesFlags = this._shadersByTexturesFlags;\n        for (var textureCount in shadersByTexturesFlags) {\n            if (shadersByTexturesFlags.hasOwnProperty(textureCount)) {\n                var shadersByFlags = shadersByTexturesFlags[textureCount];\n                if (!defined(shadersByFlags)) {\n                    continue;\n                }\n\n                for (flags in shadersByFlags) {\n                    if (shadersByFlags.hasOwnProperty(flags)) {\n                        shader = shadersByFlags[flags];\n                        if (defined(shader)) {\n                            shader.shaderProgram.destroy();\n                        }\n                    }\n                }\n            }\n        }\n\n        return destroyObject(this);\n    };\nexport default GlobeSurfaceShaderSet;\n","\n    /**\n     * This enumerated type is used in determining to what extent an object, the occludee,\n     * is visible during horizon culling. An occluder may fully block an occludee, in which case\n     * it has no visibility, may partially block an occludee from view, or may not block it at all,\n     * leading to full visibility.\n     *\n     * @exports Visibility\n     */\n    var Visibility = {\n        /**\n         * Represents that no part of an object is visible.\n         *\n         * @type {Number}\n         * @constant\n         */\n        NONE : -1,\n\n        /**\n        * Represents that part, but not all, of an object is visible\n        *\n        * @type {Number}\n        * @constant\n        */\n        PARTIAL : 0,\n\n        /**\n        * Represents that an object is visible in its entirety.\n        *\n        * @type {Number}\n        * @constant\n        */\n        FULL : 1\n    };\nexport default Object.freeze(Visibility);\n","\n    /**\n     * The state of a {@link QuadtreeTile} in the tile load pipeline.\n     * @exports QuadtreeTileLoadState\n     * @private\n     */\n    var QuadtreeTileLoadState = {\n        /**\n         * The tile is new and loading has not yet begun.\n         * @type QuadtreeTileLoadState\n         * @constant\n         * @default 0\n         */\n        START : 0,\n\n        /**\n         * Loading is in progress.\n         * @type QuadtreeTileLoadState\n         * @constant\n         * @default 1\n         */\n        LOADING : 1,\n\n        /**\n         * Loading is complete.\n         * @type QuadtreeTileLoadState\n         * @constant\n         * @default 2\n         */\n        DONE : 2,\n\n        /**\n         * The tile has failed to load.\n         * @type QuadtreeTileLoadState\n         * @constant\n         * @default 3\n         */\n        FAILED : 3\n    };\nexport default Object.freeze(QuadtreeTileLoadState);\n","\n    /**\n     * @private\n     */\n    var TerrainState = {\n        FAILED : 0,\n        UNLOADED : 1,\n        RECEIVING : 2,\n        RECEIVED : 3,\n        TRANSFORMING : 4,\n        TRANSFORMED : 5,\n        READY : 6\n    };\nexport default Object.freeze(TerrainState);\n","import BoundingSphere from '../Core/BoundingSphere.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Cartesian4 from '../Core/Cartesian4.js';\nimport defined from '../Core/defined.js';\nimport IndexDatatype from '../Core/IndexDatatype.js';\nimport IntersectionTests from '../Core/IntersectionTests.js';\nimport OrientedBoundingBox from '../Core/OrientedBoundingBox.js';\nimport PixelFormat from '../Core/PixelFormat.js';\nimport Ray from '../Core/Ray.js';\nimport Request from '../Core/Request.js';\nimport RequestState from '../Core/RequestState.js';\nimport RequestType from '../Core/RequestType.js';\nimport TileProviderError from '../Core/TileProviderError.js';\nimport Buffer from '../Renderer/Buffer.js';\nimport BufferUsage from '../Renderer/BufferUsage.js';\nimport PixelDatatype from '../Renderer/PixelDatatype.js';\nimport Sampler from '../Renderer/Sampler.js';\nimport Texture from '../Renderer/Texture.js';\nimport TextureMagnificationFilter from '../Renderer/TextureMagnificationFilter.js';\nimport TextureMinificationFilter from '../Renderer/TextureMinificationFilter.js';\nimport TextureWrap from '../Renderer/TextureWrap.js';\nimport VertexArray from '../Renderer/VertexArray.js';\nimport when from '../ThirdParty/when.js';\nimport ImageryState from './ImageryState.js';\nimport QuadtreeTileLoadState from './QuadtreeTileLoadState.js';\nimport SceneMode from './SceneMode.js';\nimport TerrainState from './TerrainState.js';\n\n    /**\n     * Contains additional information about a {@link QuadtreeTile} of the globe's surface, and\n     * encapsulates state transition logic for loading tiles.\n     *\n     * @constructor\n     * @alias GlobeSurfaceTile\n     * @private\n     */\n    function GlobeSurfaceTile() {\n        /**\n         * The {@link TileImagery} attached to this tile.\n         * @type {TileImagery[]}\n         * @default []\n         */\n        this.imagery = [];\n\n        this.waterMaskTexture = undefined;\n        this.waterMaskTranslationAndScale = new Cartesian4(0.0, 0.0, 1.0, 1.0);\n\n        this.terrainData = undefined;\n        this.vertexArray = undefined;\n        this.orientedBoundingBox = undefined;\n        this.boundingVolumeSourceTile = undefined;\n\n        /**\n         * A bounding region used to estimate distance to the tile. The horizontal bounds are always tight-fitting,\n         * but the `minimumHeight` and `maximumHeight` properties may be derived from the min/max of an ancestor tile\n         * and be quite loose-fitting and thus very poor for estimating distance. The {@link TileBoundingRegion#boundingVolume}\n         * and {@link TileBoundingRegion#boundingSphere} will always be undefined; tiles store these separately.\n         * @type {TileBoundingRegion}\n         */\n        this.tileBoundingRegion = undefined;\n        this.occludeePointInScaledSpace = new Cartesian3();\n\n        this.terrainState = TerrainState.UNLOADED;\n        this.mesh = undefined;\n        this.fill = undefined;\n\n        this.pickBoundingSphere = new BoundingSphere();\n\n        this.surfaceShader = undefined;\n        this.isClipped = true;\n\n        this.clippedByBoundaries = false;\n    }\n\n    Object.defineProperties(GlobeSurfaceTile.prototype, {\n        /**\n         * Gets a value indicating whether or not this tile is eligible to be unloaded.\n         * Typically, a tile is ineligible to be unloaded while an asynchronous operation,\n         * such as a request for data, is in progress on it.  A tile will never be\n         * unloaded while it is needed for rendering, regardless of the value of this\n         * property.\n         * @memberof GlobeSurfaceTile.prototype\n         * @type {Boolean}\n         */\n        eligibleForUnloading : {\n            get : function() {\n                // Do not remove tiles that are transitioning or that have\n                // imagery that is transitioning.\n                var terrainState = this.terrainState;\n                var loadingIsTransitioning = terrainState === TerrainState.RECEIVING || terrainState === TerrainState.TRANSFORMING;\n\n                var shouldRemoveTile = !loadingIsTransitioning;\n\n                var imagery = this.imagery;\n                for (var i = 0, len = imagery.length; shouldRemoveTile && i < len; ++i) {\n                    var tileImagery = imagery[i];\n                    shouldRemoveTile = !defined(tileImagery.loadingImagery) || tileImagery.loadingImagery.state !== ImageryState.TRANSITIONING;\n                }\n\n                return shouldRemoveTile;\n            }\n        },\n\n        /**\n         * Gets the {@link TerrainMesh} that is used for rendering this tile, if any.\n         * Returns the value of the {@link GlobeSurfaceTile#mesh} property if\n         * {@link GlobeSurfaceTile#vertexArray} is defined. Otherwise, It returns the\n         * {@link TerrainFillMesh#mesh} property of the {@link GlobeSurfaceTile#fill}.\n         * If there is no fill, it returns undefined.\n         *\n         * @memberof GlobeSurfaceTile.prototype\n         * @type {TerrainMesh}\n         */\n        renderedMesh : {\n            get : function() {\n                if (defined(this.vertexArray)) {\n                    return this.mesh;\n                } else if (defined(this.fill)) {\n                    return this.fill.mesh;\n                }\n                return undefined;\n            }\n        }\n    });\n\n    function getPosition(encoding, mode, projection, vertices, index, result) {\n        encoding.decodePosition(vertices, index, result);\n\n        if (defined(mode) && mode !== SceneMode.SCENE3D) {\n            var ellipsoid = projection.ellipsoid;\n            var positionCart = ellipsoid.cartesianToCartographic(result);\n            projection.project(positionCart, result);\n            Cartesian3.fromElements(result.z, result.x, result.y, result);\n        }\n\n        return result;\n    }\n\n    var scratchV0 = new Cartesian3();\n    var scratchV1 = new Cartesian3();\n    var scratchV2 = new Cartesian3();\n    var scratchResult = new Cartesian3();\n\n    GlobeSurfaceTile.prototype.pick = function(ray, mode, projection, cullBackFaces, result) {\n        var mesh = this.renderedMesh;\n        if (!defined(mesh)) {\n            return undefined;\n        }\n\n        var vertices = mesh.vertices;\n        var indices = mesh.indices;\n        var encoding = mesh.encoding;\n        var indicesLength = indices.length;\n\n        var minT = Number.MAX_VALUE;\n\n        for (var i = 0; i < indicesLength; i += 3) {\n            var i0 = indices[i];\n            var i1 = indices[i + 1];\n            var i2 = indices[i + 2];\n\n            var v0 = getPosition(encoding, mode, projection, vertices, i0, scratchV0);\n            var v1 = getPosition(encoding, mode, projection, vertices, i1, scratchV1);\n            var v2 = getPosition(encoding, mode, projection, vertices, i2, scratchV2);\n\n            var t = IntersectionTests.rayTriangleParametric(ray, v0, v1, v2, cullBackFaces);\n            if (defined(t) && t < minT && t >= 0.0) {\n                minT = t;\n            }\n        }\n\n        return minT !== Number.MAX_VALUE ? Ray.getPoint(ray, minT, result) : undefined;\n    };\n\n    GlobeSurfaceTile.prototype.pickTriangle = function(ray, mode, projection, cullBackFaces) {\n        var mesh = this.renderedMesh;\n        if (!defined(mesh)) {\n            return undefined;\n        }\n\n        var vertices = mesh.vertices;\n        var indices = mesh.indices;\n        var encoding = mesh.encoding;\n\n        var length = indices.length;\n        for (var i = 0; i < length; i += 3) {\n            var i0 = indices[i];\n            var i1 = indices[i + 1];\n            var i2 = indices[i + 2];\n\n            var v0 = getPosition(encoding, mode, projection, vertices, i0, scratchV0);\n            var v1 = getPosition(encoding, mode, projection, vertices, i1, scratchV1);\n            var v2 = getPosition(encoding, mode, projection, vertices, i2, scratchV2);\n\n            var intersection = IntersectionTests.rayTriangle(ray, v0, v1, v2, cullBackFaces, scratchResult);\n            if (defined(intersection)) {\n                return {\n                    intersection : intersection,\n                    v0 : v0,\n                    v1 : v1,\n                    v2 : v2\n                };\n            }\n        }\n\n        return undefined;\n    };\n\n    GlobeSurfaceTile.prototype.freeResources = function() {\n        if (defined(this.waterMaskTexture)) {\n            --this.waterMaskTexture.referenceCount;\n            if (this.waterMaskTexture.referenceCount === 0) {\n                this.waterMaskTexture.destroy();\n            }\n            this.waterMaskTexture = undefined;\n        }\n\n        this.terrainData = undefined;\n\n        this.terrainState = TerrainState.UNLOADED;\n        this.mesh = undefined;\n        this.fill = this.fill && this.fill.destroy();\n\n        var imageryList = this.imagery;\n        for (var i = 0, len = imageryList.length; i < len; ++i) {\n            imageryList[i].freeResources();\n        }\n        this.imagery.length = 0;\n\n        this.freeVertexArray();\n    };\n\n    GlobeSurfaceTile.prototype.freeVertexArray = function() {\n        GlobeSurfaceTile._freeVertexArray(this.vertexArray);\n        this.vertexArray = undefined;\n        GlobeSurfaceTile._freeVertexArray(this.wireframeVertexArray);\n        this.wireframeVertexArray = undefined;\n    };\n\n    GlobeSurfaceTile.initialize = function(tile, terrainProvider, imageryLayerCollection) {\n        var surfaceTile = tile.data;\n        if (!defined(surfaceTile)) {\n            surfaceTile = tile.data = new GlobeSurfaceTile();\n        }\n\n        if (tile.state === QuadtreeTileLoadState.START) {\n            prepareNewTile(tile, terrainProvider, imageryLayerCollection);\n            tile.state = QuadtreeTileLoadState.LOADING;\n        }\n    };\n\n    GlobeSurfaceTile.processStateMachine = function(tile, frameState, terrainProvider, imageryLayerCollection, vertexArraysToDestroy, terrainOnly) {\n        GlobeSurfaceTile.initialize(tile, terrainProvider, imageryLayerCollection);\n\n        var surfaceTile = tile.data;\n\n        if (tile.state === QuadtreeTileLoadState.LOADING) {\n            processTerrainStateMachine(tile, frameState, terrainProvider, imageryLayerCollection, vertexArraysToDestroy);\n        }\n\n        // From here down we're loading imagery, not terrain. We don't want to load imagery until\n        // we're certain that the terrain tiles are actually visible, though. We'll load terrainOnly\n        // in these scenarios:\n        //   * our bounding volume isn't accurate so we're not certain this tile is really visible (see GlobeSurfaceTileProvider#loadTile).\n        //   * we want to upsample from this tile but don't plan to render it (see processTerrainStateMachine).\n        if (terrainOnly) {\n            return;\n        }\n\n        var wasAlreadyRenderable = tile.renderable;\n\n        // The terrain is renderable as soon as we have a valid vertex array.\n        tile.renderable = defined(surfaceTile.vertexArray);\n\n        // But it's not done loading until it's in the READY state.\n        var isTerrainDoneLoading = surfaceTile.terrainState === TerrainState.READY;\n\n        // If this tile's terrain and imagery are just upsampled from its parent, mark the tile as\n        // upsampled only.  We won't refine a tile if its four children are upsampled only.\n        tile.upsampledFromParent = defined(surfaceTile.terrainData) && surfaceTile.terrainData.wasCreatedByUpsampling();\n\n        var isImageryDoneLoading = surfaceTile.processImagery(tile, terrainProvider, frameState);\n\n        if (isTerrainDoneLoading && isImageryDoneLoading) {\n            var callbacks = tile._loadedCallbacks;\n            var newCallbacks = {};\n            for(var layerId in callbacks) {\n                if (callbacks.hasOwnProperty(layerId)) {\n                    if(!callbacks[layerId](tile)) {\n                        newCallbacks[layerId] = callbacks[layerId];\n                    }\n                }\n            }\n            tile._loadedCallbacks = newCallbacks;\n\n            tile.state = QuadtreeTileLoadState.DONE;\n        }\n\n        // Once a tile is renderable, it stays renderable, because doing otherwise would\n        // cause detail (or maybe even the entire globe) to vanish when adding a new\n        // imagery layer. `GlobeSurfaceTileProvider._onLayerAdded` sets renderable to\n        // false for all affected tiles that are not currently being rendered.\n        if (wasAlreadyRenderable) {\n            tile.renderable = true;\n        }\n    };\n\n    GlobeSurfaceTile.prototype.processImagery = function(tile, terrainProvider, frameState, skipLoading) {\n        var surfaceTile = tile.data;\n        var isUpsampledOnly = tile.upsampledFromParent;\n        var isAnyTileLoaded = false;\n        var isDoneLoading = true;\n\n        // Transition imagery states\n        var tileImageryCollection = surfaceTile.imagery;\n        var i, len;\n        for (i = 0, len = tileImageryCollection.length; i < len; ++i) {\n            var tileImagery = tileImageryCollection[i];\n            if (!defined(tileImagery.loadingImagery)) {\n                isUpsampledOnly = false;\n                continue;\n            }\n\n            if (tileImagery.loadingImagery.state === ImageryState.PLACEHOLDER) {\n                var imageryLayer = tileImagery.loadingImagery.imageryLayer;\n                if (imageryLayer.imageryProvider.ready) {\n                    // Remove the placeholder and add the actual skeletons (if any)\n                    // at the same position.  Then continue the loop at the same index.\n                    tileImagery.freeResources();\n                    tileImageryCollection.splice(i, 1);\n                    imageryLayer._createTileImagerySkeletons(tile, terrainProvider, i);\n                    --i;\n                    len = tileImageryCollection.length;\n                    continue;\n                } else {\n                    isUpsampledOnly = false;\n                }\n            }\n\n            var thisTileDoneLoading = tileImagery.processStateMachine(tile, frameState, skipLoading);\n            isDoneLoading = isDoneLoading && thisTileDoneLoading;\n\n            // The imagery is renderable as soon as we have any renderable imagery for this region.\n            isAnyTileLoaded = isAnyTileLoaded || (thisTileDoneLoading || defined(tileImagery.readyImagery));\n\n            isUpsampledOnly = isUpsampledOnly && defined(tileImagery.loadingImagery) &&\n                              (tileImagery.loadingImagery.state === ImageryState.FAILED || tileImagery.loadingImagery.state === ImageryState.INVALID);\n        }\n\n        tile.upsampledFromParent = isUpsampledOnly;\n\n        // Allow rendering if any available layers are loaded\n        tile.renderable = tile.renderable && (isAnyTileLoaded || isDoneLoading);\n\n        return isDoneLoading;\n    };\n\n    function prepareNewTile(tile, terrainProvider, imageryLayerCollection) {\n        var available = terrainProvider.getTileDataAvailable(tile.x, tile.y, tile.level);\n\n        if (!defined(available) && defined(tile.parent)) {\n            // Provider doesn't know if this tile is available. Does the parent tile know?\n            var parent = tile.parent;\n            var parentSurfaceTile = parent.data;\n            if (defined(parentSurfaceTile) && defined(parentSurfaceTile.terrainData)) {\n                available = parentSurfaceTile.terrainData.isChildAvailable(parent.x, parent.y, tile.x, tile.y);\n            }\n        }\n\n        if (available === false) {\n            // This tile is not available, so mark it failed so we start upsampling right away.\n            tile.data.terrainState = TerrainState.FAILED;\n        }\n\n        // Map imagery tiles to this terrain tile\n        for (var i = 0, len = imageryLayerCollection.length; i < len; ++i) {\n            var layer = imageryLayerCollection.get(i);\n            if (layer.show) {\n                layer._createTileImagerySkeletons(tile, terrainProvider);\n            }\n        }\n    }\n\n    function processTerrainStateMachine(tile, frameState, terrainProvider, imageryLayerCollection, vertexArraysToDestroy) {\n        var surfaceTile = tile.data;\n\n        // If this tile is FAILED, we'll need to upsample from the parent. If the parent isn't\n        // ready for that, let's push it along.\n        var parent = tile.parent;\n        if (surfaceTile.terrainState === TerrainState.FAILED && parent !== undefined) {\n            var parentReady = parent.data !== undefined && parent.data.terrainData !== undefined && parent.data.terrainData.canUpsample !== false;\n            if (!parentReady) {\n                GlobeSurfaceTile.processStateMachine(parent, frameState, terrainProvider, imageryLayerCollection, true);\n            }\n        }\n\n        if (surfaceTile.terrainState === TerrainState.FAILED) {\n            upsample(surfaceTile, tile, frameState, terrainProvider, tile.x, tile.y, tile.level);\n        }\n\n        if (surfaceTile.terrainState === TerrainState.UNLOADED) {\n            requestTileGeometry(surfaceTile, terrainProvider, tile.x, tile.y, tile.level);\n        }\n\n        if (surfaceTile.terrainState === TerrainState.RECEIVED) {\n            transform(surfaceTile, frameState, terrainProvider, tile.x, tile.y, tile.level);\n        }\n\n        if (surfaceTile.terrainState === TerrainState.TRANSFORMED) {\n            createResources(surfaceTile, frameState.context, terrainProvider, tile.x, tile.y, tile.level, vertexArraysToDestroy);\n        }\n\n        if (surfaceTile.terrainState >= TerrainState.RECEIVED && surfaceTile.waterMaskTexture === undefined && terrainProvider.hasWaterMask) {\n            var terrainData = surfaceTile.terrainData;\n            if (terrainData.waterMask !== undefined) {\n                createWaterMaskTextureIfNeeded(frameState.context, surfaceTile);\n            } else {\n                var sourceTile = surfaceTile._findAncestorTileWithTerrainData(tile);\n                if (defined(sourceTile) && defined(sourceTile.data.waterMaskTexture)) {\n                    surfaceTile.waterMaskTexture = sourceTile.data.waterMaskTexture;\n                    ++surfaceTile.waterMaskTexture.referenceCount;\n                    surfaceTile._computeWaterMaskTranslationAndScale(tile, sourceTile, surfaceTile.waterMaskTranslationAndScale);\n                }\n            }\n        }\n    }\n\n    function upsample(surfaceTile, tile, frameState, terrainProvider, x, y, level) {\n        var parent = tile.parent;\n        if (!parent) {\n            // Trying to upsample from a root tile. No can do. This tile is a failure.\n            tile.state = QuadtreeTileLoadState.FAILED;\n            return;\n        }\n\n        var sourceData = parent.data.terrainData;\n        var sourceX = parent.x;\n        var sourceY = parent.y;\n        var sourceLevel = parent.level;\n\n        if (!defined(sourceData)) {\n            // Parent is not available, so we can't upsample this tile yet.\n            return;\n        }\n\n        var terrainDataPromise = sourceData.upsample(terrainProvider.tilingScheme, sourceX, sourceY, sourceLevel, x, y, level);\n        if (!defined(terrainDataPromise)) {\n            // The upsample request has been deferred - try again later.\n            return;\n        }\n\n        surfaceTile.terrainState = TerrainState.RECEIVING;\n\n        when(terrainDataPromise, function(terrainData) {\n            surfaceTile.terrainData = terrainData;\n            surfaceTile.terrainState = TerrainState.RECEIVED;\n        }, function() {\n            surfaceTile.terrainState = TerrainState.FAILED;\n        });\n    }\n\n    function requestTileGeometry(surfaceTile, terrainProvider, x, y, level) {\n        function success(terrainData) {\n            surfaceTile.terrainData = terrainData;\n            surfaceTile.terrainState = TerrainState.RECEIVED;\n            surfaceTile.request = undefined;\n        }\n\n        function failure() {\n            if (surfaceTile.request.state === RequestState.CANCELLED) {\n                // Cancelled due to low priority - try again later.\n                surfaceTile.terrainData = undefined;\n                surfaceTile.terrainState = TerrainState.UNLOADED;\n                surfaceTile.request = undefined;\n                return;\n            }\n\n            // Initially assume failure.  handleError may retry, in which case the state will\n            // change to RECEIVING or UNLOADED.\n            surfaceTile.terrainState = TerrainState.FAILED;\n            surfaceTile.request = undefined;\n\n            var message = 'Failed to obtain terrain tile X: ' + x + ' Y: ' + y + ' Level: ' + level + '.';\n            terrainProvider._requestError = TileProviderError.handleError(\n                terrainProvider._requestError,\n                terrainProvider,\n                terrainProvider.errorEvent,\n                message,\n                x, y, level,\n                doRequest);\n        }\n\n        function doRequest() {\n            // Request the terrain from the terrain provider.\n            var request = new Request({\n                throttle : false,\n                throttleByServer : true,\n                type : RequestType.TERRAIN\n            });\n            surfaceTile.request = request;\n            var requestPromise = terrainProvider.requestTileGeometry(x, y, level, request);\n\n            // If the request method returns undefined (instead of a promise), the request\n            // has been deferred.\n            if (defined(requestPromise)) {\n                surfaceTile.terrainState = TerrainState.RECEIVING;\n                when(requestPromise, success, failure);\n            } else {\n                // Deferred - try again later.\n                surfaceTile.terrainState = TerrainState.UNLOADED;\n                surfaceTile.request = undefined;\n            }\n        }\n\n        doRequest();\n    }\n\n    function transform(surfaceTile, frameState, terrainProvider, x, y, level) {\n        var tilingScheme = terrainProvider.tilingScheme;\n\n        var terrainData = surfaceTile.terrainData;\n        var meshPromise = terrainData.createMesh(tilingScheme, x, y, level, frameState.terrainExaggeration);\n\n        if (!defined(meshPromise)) {\n            // Postponed.\n            return;\n        }\n\n        surfaceTile.terrainState = TerrainState.TRANSFORMING;\n\n        when(meshPromise, function(mesh) {\n            surfaceTile.mesh = mesh;\n            surfaceTile.orientedBoundingBox = OrientedBoundingBox.clone(mesh.orientedBoundingBox, surfaceTile.orientedBoundingBox);\n            surfaceTile.occludeePointInScaledSpace = Cartesian3.clone(mesh.occludeePointInScaledSpace, surfaceTile.occludeePointInScaledSpace);\n            surfaceTile.terrainState = TerrainState.TRANSFORMED;\n        }, function() {\n            surfaceTile.terrainState = TerrainState.FAILED;\n        });\n    }\n\n    GlobeSurfaceTile._createVertexArrayForMesh = function(context, mesh) {\n        var typedArray = mesh.vertices;\n        var buffer = Buffer.createVertexBuffer({\n            context : context,\n            typedArray : typedArray,\n            usage : BufferUsage.STATIC_DRAW\n        });\n        var attributes = mesh.encoding.getAttributes(buffer);\n\n        var indexBuffers = mesh.indices.indexBuffers || {};\n        var indexBuffer = indexBuffers[context.id];\n        if (!defined(indexBuffer) || indexBuffer.isDestroyed()) {\n            var indices = mesh.indices;\n            indexBuffer = Buffer.createIndexBuffer({\n                context : context,\n                typedArray : indices,\n                usage : BufferUsage.STATIC_DRAW,\n                indexDatatype : IndexDatatype.fromSizeInBytes(indices.BYTES_PER_ELEMENT)\n            });\n            indexBuffer.vertexArrayDestroyable = false;\n            indexBuffer.referenceCount = 1;\n            indexBuffers[context.id] = indexBuffer;\n            mesh.indices.indexBuffers = indexBuffers;\n        } else {\n            ++indexBuffer.referenceCount;\n        }\n\n        return new VertexArray({\n            context : context,\n            attributes : attributes,\n            indexBuffer : indexBuffer\n        });\n    };\n\n    GlobeSurfaceTile._freeVertexArray = function(vertexArray) {\n        if (defined(vertexArray)) {\n            var indexBuffer = vertexArray.indexBuffer;\n\n            vertexArray.destroy();\n\n            if (defined(indexBuffer) && !indexBuffer.isDestroyed() && defined(indexBuffer.referenceCount)) {\n                --indexBuffer.referenceCount;\n                if (indexBuffer.referenceCount === 0) {\n                    indexBuffer.destroy();\n                }\n            }\n        }\n\n    };\n\n    function createResources(surfaceTile, context, terrainProvider, x, y, level, vertexArraysToDestroy) {\n        surfaceTile.vertexArray = GlobeSurfaceTile._createVertexArrayForMesh(context, surfaceTile.mesh);\n        surfaceTile.terrainState = TerrainState.READY;\n        surfaceTile.fill = surfaceTile.fill && surfaceTile.fill.destroy(vertexArraysToDestroy);\n    }\n\n    function getContextWaterMaskData(context) {\n        var data = context.cache.tile_waterMaskData;\n\n        if (!defined(data)) {\n            var allWaterTexture = Texture.create({\n                context : context,\n                pixelFormat : PixelFormat.LUMINANCE,\n                pixelDatatype : PixelDatatype.UNSIGNED_BYTE,\n                source : {\n                    arrayBufferView : new Uint8Array([255]),\n                    width : 1,\n                    height : 1\n                }\n            });\n            allWaterTexture.referenceCount = 1;\n\n            var sampler = new Sampler({\n                wrapS : TextureWrap.CLAMP_TO_EDGE,\n                wrapT : TextureWrap.CLAMP_TO_EDGE,\n                minificationFilter : TextureMinificationFilter.LINEAR,\n                magnificationFilter : TextureMagnificationFilter.LINEAR\n            });\n\n            data = {\n                allWaterTexture : allWaterTexture,\n                sampler : sampler,\n                destroy : function() {\n                    this.allWaterTexture.destroy();\n                }\n            };\n\n            context.cache.tile_waterMaskData = data;\n        }\n\n        return data;\n    }\n\n    function createWaterMaskTextureIfNeeded(context, surfaceTile) {\n        var waterMask = surfaceTile.terrainData.waterMask;\n        var waterMaskData = getContextWaterMaskData(context);\n        var texture;\n\n        var waterMaskLength = waterMask.length;\n        if (waterMaskLength === 1) {\n            // Length 1 means the tile is entirely land or entirely water.\n            // A value of 0 indicates entirely land, a value of 1 indicates entirely water.\n            if (waterMask[0] !== 0) {\n                texture = waterMaskData.allWaterTexture;\n            } else {\n                // Leave the texture undefined if the tile is entirely land.\n                return;\n            }\n        } else {\n            var textureSize = Math.sqrt(waterMaskLength);\n            texture = Texture.create({\n                context : context,\n                pixelFormat : PixelFormat.LUMINANCE,\n                pixelDatatype : PixelDatatype.UNSIGNED_BYTE,\n                source : {\n                    width : textureSize,\n                    height : textureSize,\n                    arrayBufferView : waterMask\n                },\n                sampler : waterMaskData.sampler,\n                flipY : false\n            });\n\n            texture.referenceCount = 0;\n        }\n\n        ++texture.referenceCount;\n        surfaceTile.waterMaskTexture = texture;\n\n        Cartesian4.fromElements(0.0, 0.0, 1.0, 1.0, surfaceTile.waterMaskTranslationAndScale);\n    }\n\n    GlobeSurfaceTile.prototype._findAncestorTileWithTerrainData = function(tile) {\n        var sourceTile = tile.parent;\n\n        while (defined(sourceTile) && (!defined(sourceTile.data) || !defined(sourceTile.data.terrainData) || sourceTile.data.terrainData.wasCreatedByUpsampling())) {\n            sourceTile = sourceTile.parent;\n        }\n\n        return sourceTile;\n    };\n\n    GlobeSurfaceTile.prototype._computeWaterMaskTranslationAndScale = function(tile, sourceTile, result) {\n        var sourceTileRectangle = sourceTile.rectangle;\n        var tileRectangle = tile.rectangle;\n        var tileWidth = tileRectangle.width;\n        var tileHeight = tileRectangle.height;\n\n        var scaleX = tileWidth / sourceTileRectangle.width;\n        var scaleY = tileHeight / sourceTileRectangle.height;\n        result.x = scaleX * (tileRectangle.west - sourceTileRectangle.west) / tileWidth;\n        result.y = scaleY * (tileRectangle.south - sourceTileRectangle.south) / tileHeight;\n        result.z = scaleX;\n        result.w = scaleY;\n\n        return result;\n    };\nexport default GlobeSurfaceTile;\n","\n    /**\n     * @private\n     */\n    var TileEdge = {\n        WEST: 0,\n        NORTH: 1,\n        EAST: 2,\n        SOUTH: 3,\n        NORTHWEST: 4,\n        NORTHEAST: 5,\n        SOUTHWEST: 6,\n        SOUTHEAST: 7\n    };\nexport default TileEdge;\n","\n    /**\n     * Indicates what happened the last time this tile was visited for selection.\n     * @private\n     */\n    var TileSelectionResult = {\n        /**\n         * There was no selection result, perhaps because the tile wasn't visited\n         * last frame.\n         */\n        NONE: 0,\n\n        /**\n         * This tile was deemed not visible and culled.\n         */\n        CULLED: 1,\n\n        /**\n         * The tile was selected for rendering.\n         */\n        RENDERED: 2,\n\n        /**\n         * This tile did not meet the required screen-space error and was refined.\n         */\n        REFINED: 3,\n\n        /**\n         * This tile was originally rendered, but it got kicked out of the render list\n         * in favor of an ancestor because it is not yet renderable.\n         */\n        RENDERED_AND_KICKED: 2 | 4,\n\n        /**\n         * This tile was originally refined, but its rendered descendants got kicked out of the\n         * render list in favor of an ancestor because it is not yet renderable.\n         */\n        REFINED_AND_KICKED: 3 | 4,\n\n        /**\n         * This tile was culled because it was not visible, but it still needs to be loaded\n         * and any heights on it need to be updated because the camera's position or the\n         * camera's reference frame's origin falls inside this tile. Loading this tile\n         * could affect the position of the camera if the camera is currently below\n         * terrain or if it is tracking an object whose height is referenced to terrain.\n         * And a change in the camera position may, in turn, affect what is culled.\n         */\n        CULLED_BUT_NEEDED: 1 | 8,\n\n        /**\n         * Determines if a selection result indicates that this tile or its descendants were\n         * kicked from the render list. In other words, if it is <code>RENDERED_AND_KICKED</code>\n         * or <code>REFINED_AND_KICKED</code>.\n         *\n         * @param {TileSelectionResult} value The selection result to test.\n         * @returns {Boolean} true if the tile was kicked, no matter if it was originally rendered or refined.\n         */\n        wasKicked: function(value) {\n            return value >= TileSelectionResult.RENDERED_AND_KICKED;\n        },\n\n        /**\n         * Determines the original selection result prior to being kicked or CULLED_BUT_NEEDED.\n         * If the tile wasn't kicked or CULLED_BUT_NEEDED, the original value is returned.\n         * @param {TileSelectionResult} value The selection result.\n         * @returns {TileSelectionResult} The original selection result prior to kicking.\n         */\n        originalResult: function(value) {\n            return value & 3;\n        },\n\n        /**\n         * Converts this selection result to a kick.\n         * @param {TileSelectionResult} value The original selection result.\n         * @returns {TileSelectionResult} The kicked form of the selection result.\n         */\n        kick: function(value) {\n            return value | 4;\n        }\n    };\nexport default TileSelectionResult;\n","import AttributeCompression from '../Core/AttributeCompression.js';\nimport binarySearch from '../Core/binarySearch.js';\nimport BoundingSphere from '../Core/BoundingSphere.js';\nimport Cartesian2 from '../Core/Cartesian2.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Cartesian4 from '../Core/Cartesian4.js';\nimport Cartographic from '../Core/Cartographic.js';\nimport defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport HeightmapTerrainData from '../Core/HeightmapTerrainData.js';\nimport CesiumMath from '../Core/Math.js';\nimport OrientedBoundingBox from '../Core/OrientedBoundingBox.js';\nimport Queue from '../Core/Queue.js';\nimport Rectangle from '../Core/Rectangle.js';\nimport TerrainEncoding from '../Core/TerrainEncoding.js';\nimport TerrainMesh from '../Core/TerrainMesh.js';\nimport TileEdge from '../Core/TileEdge.js';\nimport WebMercatorProjection from '../Core/WebMercatorProjection.js';\nimport GlobeSurfaceTile from './GlobeSurfaceTile.js';\nimport TileSelectionResult from './TileSelectionResult.js';\n\n    function TerrainFillMesh(tile) {\n        this.tile = tile;\n        this.frameLastUpdated = undefined;\n        this.westMeshes = []; // north to south (CCW)\n        this.westTiles = [];\n        this.southMeshes = []; // west to east (CCW)\n        this.southTiles = [];\n        this.eastMeshes = []; // south to north (CCW)\n        this.eastTiles = [];\n        this.northMeshes = []; // east to west (CCW)\n        this.northTiles = [];\n        this.southwestMesh = undefined;\n        this.southwestTile = undefined;\n        this.southeastMesh = undefined;\n        this.southeastTile = undefined;\n        this.northwestMesh = undefined;\n        this.northwestTile = undefined;\n        this.northeastMesh = undefined;\n        this.northeastTile = undefined;\n        this.changedThisFrame = true;\n        this.visitedFrame = undefined;\n        this.enqueuedFrame = undefined;\n        this.mesh = undefined;\n        this.vertexArray = undefined;\n        this.waterMaskTexture = undefined;\n        this.waterMaskTranslationAndScale = new Cartesian4();\n    }\n\n    TerrainFillMesh.prototype.update = function(tileProvider, frameState, vertexArraysToDestroy) {\n        if (this.changedThisFrame) {\n            createFillMesh(tileProvider, frameState, this.tile, vertexArraysToDestroy);\n            this.changedThisFrame = false;\n        }\n    };\n\n    TerrainFillMesh.prototype.destroy = function(vertexArraysToDestroy) {\n        if (defined(this.vertexArray)) {\n            if (defined(vertexArraysToDestroy)) {\n                vertexArraysToDestroy.push(this.vertexArray);\n            } else {\n                GlobeSurfaceTile._freeVertexArray(this.vertexArray, vertexArraysToDestroy);\n            }\n            this.vertexArray = undefined;\n        }\n\n        if (defined(this.waterMaskTexture)) {\n            --this.waterMaskTexture.referenceCount;\n            if (this.waterMaskTexture.referenceCount === 0) {\n                this.waterMaskTexture.destroy();\n            }\n            this.waterMaskTexture = undefined;\n        }\n\n        return undefined;\n    };\n\n    var traversalQueueScratch = new Queue();\n\n    TerrainFillMesh.updateFillTiles = function(tileProvider, renderedTiles, frameState, vertexArraysToDestroy) {\n        // We want our fill tiles to look natural, which means they should align perfectly with\n        // adjacent loaded tiles, and their edges that are not adjacent to loaded tiles should have\n        // sensible heights (e.g. the average of the heights of loaded edges). Some fill tiles may\n        // be adjacent only to other fill tiles, and in that case heights should be assigned fanning\n        // outward from the loaded tiles so that there are no sudden changes in height.\n\n        // We do this with a breadth-first traversal of the rendered tiles, starting with the loaded\n        // ones. Graph nodes are tiles and graph edges connect to other rendered tiles that are spatially adjacent\n        // to those tiles. As we visit each node, we propagate tile edges to adjacent tiles. If there's no data\n        // for a tile edge,  we create an edge with an average height and then propagate it. If an edge is partially defined\n        // (e.g. an edge is adjacent to multiple more-detailed tiles and only some of them are loaded), we\n        // fill in the rest of the edge with the same height.\n        var quadtree = tileProvider._quadtree;\n        var levelZeroTiles = quadtree._levelZeroTiles;\n        var lastSelectionFrameNumber = quadtree._lastSelectionFrameNumber;\n\n        var traversalQueue = traversalQueueScratch;\n        traversalQueue.clear();\n\n        // Add the tiles with real geometry to the traversal queue.\n        for (var i = 0; i < renderedTiles.length; ++i) {\n            var renderedTile = renderedTiles[i];\n            if (defined(renderedTile.data.vertexArray)) {\n                traversalQueue.enqueue(renderedTiles[i]);\n            }\n        }\n\n        var tile = traversalQueue.dequeue();\n\n        while (tile !== undefined) {\n            var tileToWest = tile.findTileToWest(levelZeroTiles);\n            var tileToSouth = tile.findTileToSouth(levelZeroTiles);\n            var tileToEast = tile.findTileToEast(levelZeroTiles);\n            var tileToNorth = tile.findTileToNorth(levelZeroTiles);\n            visitRenderedTiles(tileProvider, frameState, tile, tileToWest, lastSelectionFrameNumber, TileEdge.EAST, false, traversalQueue, vertexArraysToDestroy);\n            visitRenderedTiles(tileProvider, frameState, tile, tileToSouth, lastSelectionFrameNumber, TileEdge.NORTH, false, traversalQueue, vertexArraysToDestroy);\n            visitRenderedTiles(tileProvider, frameState, tile, tileToEast, lastSelectionFrameNumber, TileEdge.WEST, false, traversalQueue, vertexArraysToDestroy);\n            visitRenderedTiles(tileProvider, frameState, tile, tileToNorth, lastSelectionFrameNumber, TileEdge.SOUTH, false, traversalQueue, vertexArraysToDestroy);\n\n            var tileToNorthwest = tileToWest.findTileToNorth(levelZeroTiles);\n            var tileToSouthwest = tileToWest.findTileToSouth(levelZeroTiles);\n            var tileToNortheast = tileToEast.findTileToNorth(levelZeroTiles);\n            var tileToSoutheast = tileToEast.findTileToSouth(levelZeroTiles);\n            visitRenderedTiles(tileProvider, frameState, tile, tileToNorthwest, lastSelectionFrameNumber, TileEdge.SOUTHEAST, false, traversalQueue, vertexArraysToDestroy);\n            visitRenderedTiles(tileProvider, frameState, tile, tileToNortheast, lastSelectionFrameNumber, TileEdge.SOUTHWEST, false, traversalQueue, vertexArraysToDestroy);\n            visitRenderedTiles(tileProvider, frameState, tile, tileToSouthwest, lastSelectionFrameNumber, TileEdge.NORTHEAST, false, traversalQueue, vertexArraysToDestroy);\n            visitRenderedTiles(tileProvider, frameState, tile, tileToSoutheast, lastSelectionFrameNumber, TileEdge.NORTHWEST, false, traversalQueue, vertexArraysToDestroy);\n\n            tile = traversalQueue.dequeue();\n        }\n    };\n\n    function visitRenderedTiles(tileProvider, frameState, sourceTile, startTile, currentFrameNumber, tileEdge, downOnly, traversalQueue, vertexArraysToDestroy) {\n        if (startTile === undefined) {\n            // There are no tiles North or South of the poles.\n            return;\n        }\n\n        var tile = startTile;\n        while (tile && (tile._lastSelectionResultFrame !== currentFrameNumber || TileSelectionResult.wasKicked(tile._lastSelectionResult) || TileSelectionResult.originalResult(tile._lastSelectionResult) === TileSelectionResult.CULLED)) {\n            // This tile wasn't visited or it was visited and then kicked, so walk up to find the closest ancestor that was rendered.\n            // We also walk up if the tile was culled, because if siblings were kicked an ancestor may have been rendered.\n            if (downOnly) {\n                return;\n            }\n\n            var parent = tile.parent;\n            if (tileEdge >= TileEdge.NORTHWEST && parent !== undefined) {\n                // When we're looking for a corner, verify that the parent tile is still relevant.\n                // That is, the parent and child must share the corner in question.\n                switch (tileEdge) {\n                    case TileEdge.NORTHWEST:\n                        tile = tile === parent.northwestChild ? parent : undefined;\n                        break;\n                    case TileEdge.NORTHEAST:\n                        tile = tile === parent.northeastChild ? parent : undefined;\n                        break;\n                    case TileEdge.SOUTHWEST:\n                        tile = tile === parent.southwestChild ? parent : undefined;\n                        break;\n                    case TileEdge.SOUTHEAST:\n                        tile = tile === parent.southeastChild ? parent : undefined;\n                        break;\n                }\n            } else {\n                tile = parent;\n            }\n        }\n\n        if (tile === undefined) {\n            return;\n        }\n\n        if (tile._lastSelectionResult === TileSelectionResult.RENDERED) {\n            if (defined(tile.data.vertexArray)) {\n                // No further processing necessary for renderable tiles.\n                return;\n            }\n            visitTile(tileProvider, frameState, sourceTile, tile, tileEdge, currentFrameNumber, traversalQueue, vertexArraysToDestroy);\n            return;\n        }\n\n        if (TileSelectionResult.originalResult(startTile._lastSelectionResult) === TileSelectionResult.CULLED) {\n            return;\n        }\n\n        // This tile was refined, so find rendered children, if any.\n        // Visit the tiles in counter-clockwise order.\n        switch (tileEdge) {\n            case TileEdge.WEST:\n                visitRenderedTiles(tileProvider, frameState, sourceTile, startTile.northwestChild, currentFrameNumber, tileEdge, true, traversalQueue, vertexArraysToDestroy);\n                visitRenderedTiles(tileProvider, frameState, sourceTile, startTile.southwestChild, currentFrameNumber, tileEdge, true, traversalQueue, vertexArraysToDestroy);\n                break;\n            case TileEdge.EAST:\n                visitRenderedTiles(tileProvider, frameState, sourceTile, startTile.southeastChild, currentFrameNumber, tileEdge, true, traversalQueue, vertexArraysToDestroy);\n                visitRenderedTiles(tileProvider, frameState, sourceTile, startTile.northeastChild, currentFrameNumber, tileEdge, true, traversalQueue, vertexArraysToDestroy);\n                break;\n            case TileEdge.SOUTH:\n                visitRenderedTiles(tileProvider, frameState, sourceTile, startTile.southwestChild, currentFrameNumber, tileEdge, true, traversalQueue, vertexArraysToDestroy);\n                visitRenderedTiles(tileProvider, frameState, sourceTile, startTile.southeastChild, currentFrameNumber, tileEdge, true, traversalQueue, vertexArraysToDestroy);\n                break;\n            case TileEdge.NORTH:\n                visitRenderedTiles(tileProvider, frameState, sourceTile, startTile.northeastChild, currentFrameNumber, tileEdge, true, traversalQueue, vertexArraysToDestroy);\n                visitRenderedTiles(tileProvider, frameState, sourceTile, startTile.northwestChild, currentFrameNumber, tileEdge, true, traversalQueue, vertexArraysToDestroy);\n                break;\n            case TileEdge.NORTHWEST:\n                visitRenderedTiles(tileProvider, frameState, sourceTile, startTile.northwestChild, currentFrameNumber, tileEdge, true, traversalQueue, vertexArraysToDestroy);\n                break;\n            case TileEdge.NORTHEAST:\n                visitRenderedTiles(tileProvider, frameState, sourceTile, startTile.northeastChild, currentFrameNumber, tileEdge, true, traversalQueue, vertexArraysToDestroy);\n                break;\n            case TileEdge.SOUTHWEST:\n                visitRenderedTiles(tileProvider, frameState, sourceTile, startTile.southwestChild, currentFrameNumber, tileEdge, true, traversalQueue, vertexArraysToDestroy);\n                break;\n            case TileEdge.SOUTHEAST:\n                visitRenderedTiles(tileProvider, frameState, sourceTile, startTile.southeastChild, currentFrameNumber, tileEdge, true, traversalQueue, vertexArraysToDestroy);\n                break;\n            default:\n                throw new DeveloperError('Invalid edge');\n        }\n    }\n\n    function visitTile(tileProvider, frameState, sourceTile, destinationTile, tileEdge, frameNumber, traversalQueue, vertexArraysToDestroy) {\n        var destinationSurfaceTile = destinationTile.data;\n\n        if (destinationSurfaceTile.fill === undefined) {\n            destinationSurfaceTile.fill = new TerrainFillMesh(destinationTile);\n        } else if (destinationSurfaceTile.fill.visitedFrame === frameNumber) {\n            // Don't propagate edges to tiles that have already been visited this frame.\n            return;\n        }\n\n        if (destinationSurfaceTile.fill.enqueuedFrame !== frameNumber) {\n            // First time visiting this tile this frame, add it to the traversal queue.\n            destinationSurfaceTile.fill.enqueuedFrame = frameNumber;\n            destinationSurfaceTile.fill.changedThisFrame = false;\n            traversalQueue.enqueue(destinationTile);\n        }\n\n        propagateEdge(tileProvider, frameState, sourceTile, destinationTile, tileEdge, vertexArraysToDestroy);\n    }\n\n    function propagateEdge(tileProvider, frameState, sourceTile, destinationTile, tileEdge, vertexArraysToDestroy) {\n        var destinationFill = destinationTile.data.fill;\n\n        var sourceMesh;\n        var sourceFill = sourceTile.data.fill;\n        if (defined(sourceFill)) {\n            sourceFill.visitedFrame = frameState.frameNumber;\n\n            // Source is a fill, create/update it if necessary.\n            if (sourceFill.changedThisFrame) {\n                createFillMesh(tileProvider, frameState, sourceTile, vertexArraysToDestroy);\n                sourceFill.changedThisFrame = false;\n            }\n            sourceMesh = sourceTile.data.fill.mesh;\n        } else {\n            sourceMesh = sourceTile.data.mesh;\n        }\n\n        var edgeMeshes;\n        var edgeTiles;\n\n        switch (tileEdge) {\n            case TileEdge.WEST:\n                edgeMeshes = destinationFill.westMeshes;\n                edgeTiles = destinationFill.westTiles;\n                break;\n            case TileEdge.SOUTH:\n                edgeMeshes = destinationFill.southMeshes;\n                edgeTiles = destinationFill.southTiles;\n                break;\n            case TileEdge.EAST:\n                edgeMeshes = destinationFill.eastMeshes;\n                edgeTiles = destinationFill.eastTiles;\n                break;\n            case TileEdge.NORTH:\n                edgeMeshes = destinationFill.northMeshes;\n                edgeTiles = destinationFill.northTiles;\n                break;\n            // Corners are simpler.\n            case TileEdge.NORTHWEST:\n                destinationFill.changedThisFrame = destinationFill.changedThisFrame || destinationFill.northwestMesh !== sourceMesh;\n                destinationFill.northwestMesh = sourceMesh;\n                destinationFill.northwestTile = sourceTile;\n                return;\n            case TileEdge.NORTHEAST:\n                destinationFill.changedThisFrame = destinationFill.changedThisFrame || destinationFill.northeastMesh !== sourceMesh;\n                destinationFill.northeastMesh = sourceMesh;\n                destinationFill.northeastTile = sourceTile;\n                return;\n            case TileEdge.SOUTHWEST:\n                destinationFill.changedThisFrame = destinationFill.changedThisFrame || destinationFill.southwestMesh !== sourceMesh;\n                destinationFill.southwestMesh = sourceMesh;\n                destinationFill.southwestTile = sourceTile;\n                return;\n            case TileEdge.SOUTHEAST:\n                destinationFill.changedThisFrame = destinationFill.changedThisFrame || destinationFill.southeastMesh !== sourceMesh;\n                destinationFill.southeastMesh = sourceMesh;\n                destinationFill.southeastTile = sourceTile;\n                return;\n        }\n\n        if (sourceTile.level <= destinationTile.level) {\n            // Source edge completely spans the destination edge.\n            destinationFill.changedThisFrame = destinationFill.changedThisFrame || edgeMeshes[0] !== sourceMesh || edgeMeshes.length !== 1;\n            edgeMeshes[0] = sourceMesh;\n            edgeTiles[0] = sourceTile;\n            edgeMeshes.length = 1;\n            edgeTiles.length = 1;\n            return;\n        }\n\n        // Source edge is a subset of the destination edge.\n        // Figure out the range of meshes we're replacing.\n        var startIndex, endIndex, existingTile, existingRectangle;\n        var sourceRectangle = sourceTile.rectangle;\n\n        var epsilon;\n        var destinationRectangle = destinationTile.rectangle;\n\n        switch (tileEdge) {\n            case TileEdge.WEST:\n                epsilon = (destinationRectangle.north - destinationRectangle.south) * CesiumMath.EPSILON5;\n\n                for (startIndex = 0; startIndex < edgeTiles.length; ++startIndex) {\n                    existingTile = edgeTiles[startIndex];\n                    existingRectangle = existingTile.rectangle;\n                    if (CesiumMath.greaterThan(sourceRectangle.north, existingRectangle.south, epsilon)) {\n                        break;\n                    }\n                }\n                for (endIndex = startIndex; endIndex < edgeTiles.length; ++endIndex) {\n                    existingTile = edgeTiles[endIndex];\n                    existingRectangle = existingTile.rectangle;\n                    if (CesiumMath.greaterThanOrEquals(sourceRectangle.south, existingRectangle.north, epsilon)) {\n                        break;\n                    }\n                }\n                break;\n            case TileEdge.SOUTH:\n                epsilon = (destinationRectangle.east - destinationRectangle.west) * CesiumMath.EPSILON5;\n\n                for (startIndex = 0; startIndex < edgeTiles.length; ++startIndex) {\n                    existingTile = edgeTiles[startIndex];\n                    existingRectangle = existingTile.rectangle;\n                    if (CesiumMath.lessThan(sourceRectangle.west, existingRectangle.east, epsilon)) {\n                        break;\n                    }\n                }\n                for (endIndex = startIndex; endIndex < edgeTiles.length; ++endIndex) {\n                    existingTile = edgeTiles[endIndex];\n                    existingRectangle = existingTile.rectangle;\n                    if (CesiumMath.lessThanOrEquals(sourceRectangle.east, existingRectangle.west, epsilon)) {\n                        break;\n                    }\n                }\n                break;\n            case TileEdge.EAST:\n                epsilon = (destinationRectangle.north - destinationRectangle.south) * CesiumMath.EPSILON5;\n\n                for (startIndex = 0; startIndex < edgeTiles.length; ++startIndex) {\n                    existingTile = edgeTiles[startIndex];\n                    existingRectangle = existingTile.rectangle;\n                    if (CesiumMath.lessThan(sourceRectangle.south, existingRectangle.north, epsilon)) {\n                        break;\n                    }\n                }\n                for (endIndex = startIndex; endIndex < edgeTiles.length; ++endIndex) {\n                    existingTile = edgeTiles[endIndex];\n                    existingRectangle = existingTile.rectangle;\n                    if (CesiumMath.lessThanOrEquals(sourceRectangle.north, existingRectangle.south, epsilon)) {\n                        break;\n                    }\n                }\n                break;\n            case TileEdge.NORTH:\n                epsilon = (destinationRectangle.east - destinationRectangle.west) * CesiumMath.EPSILON5;\n\n                for (startIndex = 0; startIndex < edgeTiles.length; ++startIndex) {\n                    existingTile = edgeTiles[startIndex];\n                    existingRectangle = existingTile.rectangle;\n                    if (CesiumMath.greaterThan(sourceRectangle.east, existingRectangle.west, epsilon)) {\n                        break;\n                    }\n                }\n                for (endIndex = startIndex; endIndex < edgeTiles.length; ++endIndex) {\n                    existingTile = edgeTiles[endIndex];\n                    existingRectangle = existingTile.rectangle;\n                    if (CesiumMath.greaterThanOrEquals(sourceRectangle.west, existingRectangle.east, epsilon)) {\n                        break;\n                    }\n                }\n                break;\n        }\n\n        if (endIndex - startIndex === 1) {\n            destinationFill.changedThisFrame = destinationFill.changedThisFrame || edgeMeshes[startIndex] !== sourceMesh;\n            edgeMeshes[startIndex] = sourceMesh;\n            edgeTiles[startIndex] = sourceTile;\n        } else {\n            destinationFill.changedThisFrame = true;\n            edgeMeshes.splice(startIndex, endIndex - startIndex, sourceMesh);\n            edgeTiles.splice(startIndex, endIndex - startIndex, sourceTile);\n        }\n    }\n\n    var cartographicScratch = new Cartographic();\n    var centerCartographicScratch = new Cartographic();\n    var cartesianScratch = new Cartesian3();\n    var normalScratch = new Cartesian3();\n    var octEncodedNormalScratch = new Cartesian2();\n    var uvScratch2 = new Cartesian2();\n    var uvScratch = new Cartesian2();\n\n    function HeightAndNormal() {\n        this.height = 0.0;\n        this.encodedNormal = new Cartesian2();\n    }\n\n    function fillMissingCorner(fill, ellipsoid, u, v, corner, adjacentCorner1, adjacentCorner2, oppositeCorner, vertex) {\n        if (defined(corner)) {\n            return corner;\n        }\n\n        var height;\n\n        if (defined(adjacentCorner1) && defined(adjacentCorner2)) {\n            height = (adjacentCorner1.height + adjacentCorner2.height) * 0.5;\n        } else if (defined(adjacentCorner1)) {\n            height = adjacentCorner1.height;\n        } else if (defined(adjacentCorner2)) {\n            height = adjacentCorner2.height;\n        } else if (defined(oppositeCorner)) {\n            height = oppositeCorner.height;\n        } else {\n            var surfaceTile = fill.tile.data;\n            var tileBoundingRegion = surfaceTile.tileBoundingRegion;\n            var minimumHeight = 0.0;\n            var maximumHeight = 0.0;\n            if (defined(tileBoundingRegion)) {\n                minimumHeight = tileBoundingRegion.minimumHeight;\n                maximumHeight = tileBoundingRegion.maximumHeight;\n            }\n            height = (minimumHeight + maximumHeight) * 0.5;\n        }\n\n        getVertexWithHeightAtCorner(fill, ellipsoid, u, v, height, vertex);\n        return vertex;\n    }\n\n    var heightRangeScratch = {\n        minimumHeight: 0.0,\n        maximumHeight: 0.0\n    };\n\n    var swVertexScratch = new HeightAndNormal();\n    var seVertexScratch = new HeightAndNormal();\n    var nwVertexScratch = new HeightAndNormal();\n    var neVertexScratch = new HeightAndNormal();\n    var heightmapBuffer = typeof Uint8Array !== 'undefined' ? new Uint8Array(9 * 9) : undefined;\n\n    function createFillMesh(tileProvider, frameState, tile, vertexArraysToDestroy) {\n        GlobeSurfaceTile.initialize(tile, tileProvider.terrainProvider, tileProvider._imageryLayers);\n\n        var surfaceTile = tile.data;\n        var fill = surfaceTile.fill;\n        var rectangle = tile.rectangle;\n\n        var ellipsoid = tile.tilingScheme.ellipsoid;\n\n        var nwCorner = getCorner(fill, ellipsoid, 0.0, 1.0, fill.northwestTile, fill.northwestMesh, fill.northTiles, fill.northMeshes, fill.westTiles, fill.westMeshes, nwVertexScratch);\n        var swCorner = getCorner(fill, ellipsoid, 0.0, 0.0, fill.southwestTile, fill.southwestMesh, fill.westTiles, fill.westMeshes, fill.southTiles, fill.southMeshes, swVertexScratch);\n        var seCorner = getCorner(fill, ellipsoid, 1.0, 0.0, fill.southeastTile, fill.southeastMesh, fill.southTiles, fill.southMeshes, fill.eastTiles, fill.eastMeshes, seVertexScratch);\n        var neCorner = getCorner(fill, ellipsoid, 1.0, 1.0, fill.northeastTile, fill.northeastMesh, fill.eastTiles, fill.eastMeshes, fill.northTiles, fill.northMeshes, neVertexScratch);\n\n        nwCorner = fillMissingCorner(fill, ellipsoid, 0.0, 1.0, nwCorner, swCorner, neCorner, seCorner, nwVertexScratch);\n        swCorner = fillMissingCorner(fill, ellipsoid, 0.0, 0.0, swCorner, nwCorner, seCorner, neCorner, swVertexScratch);\n        seCorner = fillMissingCorner(fill, ellipsoid, 1.0, 1.0, seCorner, swCorner, neCorner, nwCorner, seVertexScratch);\n        neCorner = fillMissingCorner(fill, ellipsoid, 1.0, 1.0, neCorner, seCorner, nwCorner, swCorner, neVertexScratch);\n\n        var southwestHeight = swCorner.height;\n        var southeastHeight = seCorner.height;\n        var northwestHeight = nwCorner.height;\n        var northeastHeight = neCorner.height;\n\n        var minimumHeight = Math.min(southwestHeight, southeastHeight, northwestHeight, northeastHeight);\n        var maximumHeight = Math.max(southwestHeight, southeastHeight, northwestHeight, northeastHeight);\n\n        var middleHeight = (minimumHeight + maximumHeight) * 0.5;\n\n        var i;\n        var len;\n\n        // For low-detail tiles, our usual fill tile approach will create tiles that\n        // look really blocky because they don't have enough vertices to account for the\n        // Earth's curvature. But the height range will also typically be well within\n        // the allowed geometric error for those levels. So fill such tiles with a\n        // constant-height heightmap.\n        var geometricError = tileProvider.getLevelMaximumGeometricError(tile.level);\n        var minCutThroughRadius = ellipsoid.maximumRadius - geometricError;\n        var maxTileWidth = Math.acos(minCutThroughRadius / ellipsoid.maximumRadius) * 4.0;\n\n        // When the tile width is greater than maxTileWidth as computed above, the error\n        // of a normal fill tile from globe curvature alone will exceed the allowed geometric\n        // error. Terrain won't change that much. However, we can allow more error than that.\n        // A little blockiness during load is acceptable. For the WGS84 ellipsoid and\n        // standard geometric error setup, the value here will have us use a heightmap\n        // at levels 1, 2, and 3.\n        maxTileWidth *= 1.5;\n\n        if (rectangle.width > maxTileWidth && (maximumHeight - minimumHeight) <= geometricError) {\n            var terrainData = new HeightmapTerrainData({\n                width: 9,\n                height: 9,\n                buffer: heightmapBuffer,\n                structure: {\n                    // Use the maximum as the constant height so that this tile's skirt\n                    // covers any cracks with adjacent tiles.\n                    heightOffset: maximumHeight\n                }\n            });\n            fill.mesh = terrainData._createMeshSync(tile.tilingScheme, tile.x, tile.y, tile.level, 1.0);\n        } else {\n            var encoding = new TerrainEncoding(undefined, undefined, undefined, undefined, true, true);\n\n            var centerCartographic = centerCartographicScratch;\n            centerCartographic.longitude = (rectangle.east + rectangle.west) * 0.5;\n            centerCartographic.latitude = (rectangle.north + rectangle.south) * 0.5;\n            centerCartographic.height = middleHeight;\n            encoding.center = ellipsoid.cartographicToCartesian(centerCartographic, encoding.center);\n\n            // At _most_, we have vertices for the 4 corners, plus 1 center, plus every adjacent edge vertex.\n            // In reality there will be less most of the time, but close enough; better\n            // to overestimate than to re-allocate/copy/traverse the vertices twice.\n            // Also, we'll often be able to squeeze the index data into the extra space in the buffer.\n            var maxVertexCount = 5;\n            var meshes;\n\n            meshes = fill.westMeshes;\n            for (i = 0, len = meshes.length; i < len; ++i) {\n                maxVertexCount += meshes[i].eastIndicesNorthToSouth.length;\n            }\n\n            meshes = fill.southMeshes;\n            for (i = 0, len = meshes.length; i < len; ++i) {\n                maxVertexCount += meshes[i].northIndicesWestToEast.length;\n            }\n\n            meshes = fill.eastMeshes;\n            for (i = 0, len = meshes.length; i < len; ++i) {\n                maxVertexCount += meshes[i].westIndicesSouthToNorth.length;\n            }\n\n            meshes = fill.northMeshes;\n            for (i = 0, len = meshes.length; i < len; ++i) {\n                maxVertexCount += meshes[i].southIndicesEastToWest.length;\n            }\n\n            var heightRange = heightRangeScratch;\n            heightRange.minimumHeight = minimumHeight;\n            heightRange.maximumHeight = maximumHeight;\n\n            var stride = encoding.getStride();\n            var typedArray = new Float32Array(maxVertexCount * stride);\n\n            var nextIndex = 0;\n            var northwestIndex = nextIndex;\n            nextIndex = addVertexWithComputedPosition(ellipsoid, rectangle, encoding, typedArray, nextIndex, 0.0, 1.0, nwCorner.height, nwCorner.encodedNormal, 1.0, heightRange);\n            nextIndex = addEdge(fill, ellipsoid, encoding, typedArray, nextIndex, fill.westTiles, fill.westMeshes, TileEdge.EAST, heightRange);\n            var southwestIndex = nextIndex;\n            nextIndex = addVertexWithComputedPosition(ellipsoid, rectangle, encoding, typedArray, nextIndex, 0.0, 0.0, swCorner.height, swCorner.encodedNormal, 0.0, heightRange);\n            nextIndex = addEdge(fill, ellipsoid, encoding, typedArray, nextIndex, fill.southTiles, fill.southMeshes, TileEdge.NORTH, heightRange);\n            var southeastIndex = nextIndex;\n            nextIndex = addVertexWithComputedPosition(ellipsoid, rectangle, encoding, typedArray, nextIndex, 1.0, 0.0, seCorner.height, seCorner.encodedNormal, 0.0, heightRange);\n            nextIndex = addEdge(fill, ellipsoid, encoding, typedArray, nextIndex, fill.eastTiles, fill.eastMeshes, TileEdge.WEST, heightRange);\n            var northeastIndex = nextIndex;\n            nextIndex = addVertexWithComputedPosition(ellipsoid, rectangle, encoding, typedArray, nextIndex, 1.0, 1.0, neCorner.height, neCorner.encodedNormal, 1.0, heightRange);\n            nextIndex = addEdge(fill, ellipsoid, encoding, typedArray, nextIndex, fill.northTiles, fill.northMeshes, TileEdge.SOUTH, heightRange);\n\n            minimumHeight = heightRange.minimumHeight;\n            maximumHeight = heightRange.maximumHeight;\n\n            var obb = OrientedBoundingBox.fromRectangle(rectangle, minimumHeight, maximumHeight, tile.tilingScheme.ellipsoid);\n\n            // Add a single vertex at the center of the tile.\n            var southMercatorY = WebMercatorProjection.geodeticLatitudeToMercatorAngle(rectangle.south);\n            var oneOverMercatorHeight = 1.0 / (WebMercatorProjection.geodeticLatitudeToMercatorAngle(rectangle.north) - southMercatorY);\n            var centerWebMercatorT = (WebMercatorProjection.geodeticLatitudeToMercatorAngle(centerCartographic.latitude) - southMercatorY) * oneOverMercatorHeight;\n\n            ellipsoid.geodeticSurfaceNormalCartographic(cartographicScratch, normalScratch);\n            var centerEncodedNormal = AttributeCompression.octEncode(normalScratch, octEncodedNormalScratch);\n\n            var centerIndex = nextIndex;\n            encoding.encode(typedArray, nextIndex * stride, obb.center, Cartesian2.fromElements(0.5, 0.5, uvScratch), middleHeight, centerEncodedNormal, centerWebMercatorT);\n            ++nextIndex;\n\n            var vertexCount = nextIndex;\n\n            var bytesPerIndex = vertexCount < 256 ? 1 : 2;\n            var indexCount = (vertexCount - 1) * 3; // one triangle per edge vertex\n            var indexDataBytes = indexCount * bytesPerIndex;\n            var availableBytesInBuffer = (typedArray.length - vertexCount * stride) * Float32Array.BYTES_PER_ELEMENT;\n\n            var indices;\n            if (availableBytesInBuffer >= indexDataBytes) {\n                // Store the index data in the same buffer as the vertex data.\n                var startIndex = vertexCount * stride * Float32Array.BYTES_PER_ELEMENT;\n                indices = vertexCount < 256\n                    ? new Uint8Array(typedArray.buffer, startIndex, indexCount)\n                    : new Uint16Array(typedArray.buffer, startIndex, indexCount);\n            } else {\n                // Allocate a new buffer for the index data.\n                indices = vertexCount < 256 ? new Uint8Array(indexCount) : new Uint16Array(indexCount);\n            }\n\n            typedArray = new Float32Array(typedArray.buffer, 0, vertexCount * stride);\n\n            var indexOut = 0;\n            for (i = 0; i < vertexCount - 2; ++i) {\n                indices[indexOut++] = centerIndex;\n                indices[indexOut++] = i;\n                indices[indexOut++] = i + 1;\n            }\n\n            indices[indexOut++] = centerIndex;\n            indices[indexOut++] = i;\n            indices[indexOut++] = 0;\n\n            var westIndicesSouthToNorth = [];\n            for (i = southwestIndex; i >= northwestIndex; --i) {\n                westIndicesSouthToNorth.push(i);\n            }\n\n            var southIndicesEastToWest = [];\n            for (i = southeastIndex; i >= southwestIndex; --i) {\n                southIndicesEastToWest.push(i);\n            }\n\n            var eastIndicesNorthToSouth = [];\n            for (i = northeastIndex; i >= southeastIndex; --i) {\n                eastIndicesNorthToSouth.push(i);\n            }\n\n            var northIndicesWestToEast = [];\n            northIndicesWestToEast.push(0);\n            for (i = centerIndex - 1; i >= northeastIndex; --i) {\n                northIndicesWestToEast.push(i);\n            }\n\n            fill.mesh = new TerrainMesh(\n                encoding.center,\n                typedArray,\n                indices,\n                indexCount,\n                vertexCount,\n                minimumHeight,\n                maximumHeight,\n                BoundingSphere.fromOrientedBoundingBox(obb),\n                computeOccludeePoint(tileProvider, obb.center, rectangle, minimumHeight, maximumHeight),\n                encoding.getStride(),\n                obb,\n                encoding,\n                frameState.terrainExaggeration,\n                westIndicesSouthToNorth,\n                southIndicesEastToWest,\n                eastIndicesNorthToSouth,\n                northIndicesWestToEast\n            );\n        }\n\n        var context = frameState.context;\n\n        if (defined(fill.vertexArray)) {\n            if (defined(vertexArraysToDestroy)) {\n                vertexArraysToDestroy.push(fill.vertexArray);\n            } else {\n                GlobeSurfaceTile._freeVertexArray(fill.vertexArray);\n            }\n        }\n\n        fill.vertexArray = GlobeSurfaceTile._createVertexArrayForMesh(context, fill.mesh);\n        surfaceTile.processImagery(tile, tileProvider.terrainProvider, frameState, true);\n\n        var oldTexture = fill.waterMaskTexture;\n        fill.waterMaskTexture = undefined;\n\n        if (tileProvider.terrainProvider.hasWaterMask) {\n            var waterSourceTile = surfaceTile._findAncestorTileWithTerrainData(tile);\n            if (defined(waterSourceTile) && defined(waterSourceTile.data.waterMaskTexture)) {\n                fill.waterMaskTexture = waterSourceTile.data.waterMaskTexture;\n                ++fill.waterMaskTexture.referenceCount;\n                surfaceTile._computeWaterMaskTranslationAndScale(tile, waterSourceTile, fill.waterMaskTranslationAndScale);\n            }\n        }\n\n        if (defined(oldTexture)) {\n            --oldTexture.referenceCount;\n            if (oldTexture.referenceCount === 0) {\n                oldTexture.destroy();\n            }\n        }\n    }\n\n    function addVertexWithComputedPosition(ellipsoid, rectangle, encoding, buffer, index, u, v, height, encodedNormal, webMercatorT, heightRange) {\n        var cartographic = cartographicScratch;\n        cartographic.longitude = CesiumMath.lerp(rectangle.west, rectangle.east, u);\n        cartographic.latitude = CesiumMath.lerp(rectangle.south, rectangle.north, v);\n        cartographic.height = height;\n        var position = ellipsoid.cartographicToCartesian(cartographic, cartesianScratch);\n\n        var uv = uvScratch2;\n        uv.x = u;\n        uv.y = v;\n\n        encoding.encode(buffer, index * encoding.getStride(), position, uv, height, encodedNormal, webMercatorT);\n\n        heightRange.minimumHeight = Math.min(heightRange.minimumHeight, height);\n        heightRange.maximumHeight = Math.max(heightRange.maximumHeight, height);\n\n        return index + 1;\n    }\n\n    var sourceRectangleScratch = new Rectangle();\n\n    function transformTextureCoordinates(sourceTile, targetTile, coordinates, result) {\n        var sourceRectangle = sourceTile.rectangle;\n        var targetRectangle = targetTile.rectangle;\n\n        // Handle transforming across the anti-meridian.\n        if (targetTile.x === 0 && coordinates.x === 1.0 && sourceTile.x === sourceTile.tilingScheme.getNumberOfXTilesAtLevel(sourceTile.level) - 1) {\n            sourceRectangle = Rectangle.clone(sourceTile.rectangle, sourceRectangleScratch);\n            sourceRectangle.west -= CesiumMath.TWO_PI;\n            sourceRectangle.east -= CesiumMath.TWO_PI;\n        } else if (sourceTile.x === 0 && coordinates.x === 0.0 && targetTile.x === targetTile.tilingScheme.getNumberOfXTilesAtLevel(targetTile.level) - 1) {\n            sourceRectangle = Rectangle.clone(sourceTile.rectangle, sourceRectangleScratch);\n            sourceRectangle.west += CesiumMath.TWO_PI;\n            sourceRectangle.east += CesiumMath.TWO_PI;\n        }\n\n        var sourceWidth = sourceRectangle.east - sourceRectangle.west;\n        var umin = (targetRectangle.west - sourceRectangle.west) / sourceWidth;\n        var umax = (targetRectangle.east - sourceRectangle.west) / sourceWidth;\n\n        var sourceHeight = sourceRectangle.north - sourceRectangle.south;\n        var vmin = (targetRectangle.south - sourceRectangle.south) / sourceHeight;\n        var vmax = (targetRectangle.north - sourceRectangle.south) / sourceHeight;\n\n        var u = (coordinates.x - umin) / (umax - umin);\n        var v = (coordinates.y - vmin) / (vmax - vmin);\n\n        // Ensure that coordinates very near the corners are at the corners.\n        if (Math.abs(u) < Math.EPSILON5) {\n            u = 0.0;\n        } else if (Math.abs(u - 1.0) < Math.EPSILON5) {\n            u = 1.0;\n        }\n\n        if (Math.abs(v) < Math.EPSILON5) {\n            v = 0.0;\n        } else if (Math.abs(v - 1.0) < Math.EPSILON5) {\n            v = 1.0;\n        }\n\n        result.x = u;\n        result.y = v;\n        return result;\n    }\n\n    var encodedNormalScratch = new Cartesian2();\n\n    function getVertexFromTileAtCorner(sourceMesh, sourceIndex, u, v, vertex) {\n        var sourceEncoding = sourceMesh.encoding;\n        var sourceVertices = sourceMesh.vertices;\n\n        vertex.height = sourceEncoding.decodeHeight(sourceVertices, sourceIndex);\n\n        if (sourceEncoding.hasVertexNormals) {\n            sourceEncoding.getOctEncodedNormal(sourceVertices, sourceIndex, vertex.encodedNormal);\n        } else {\n            var normal = vertex.encodedNormal;\n            normal.x = 0.0;\n            normal.y = 0.0;\n        }\n    }\n\n    var encodedNormalScratch2 = new Cartesian2();\n    var cartesianScratch2 = new Cartesian3();\n\n    function getInterpolatedVertexAtCorner(ellipsoid, sourceTile, targetTile, sourceMesh, previousIndex, nextIndex, u, v, interpolateU, vertex) {\n        var sourceEncoding = sourceMesh.encoding;\n        var sourceVertices = sourceMesh.vertices;\n\n        var previousUv = transformTextureCoordinates(sourceTile, targetTile, sourceEncoding.decodeTextureCoordinates(sourceVertices, previousIndex, uvScratch), uvScratch);\n        var nextUv = transformTextureCoordinates(sourceTile, targetTile, sourceEncoding.decodeTextureCoordinates(sourceVertices, nextIndex, uvScratch2), uvScratch2);\n\n        var ratio;\n        if (interpolateU) {\n            ratio = (u - previousUv.x) / (nextUv.x - previousUv.x);\n        } else {\n            ratio = (v - previousUv.y) / (nextUv.y - previousUv.y);\n        }\n\n        var height1 = sourceEncoding.decodeHeight(sourceVertices, previousIndex);\n        var height2 = sourceEncoding.decodeHeight(sourceVertices, nextIndex);\n\n        var targetRectangle = targetTile.rectangle;\n        cartographicScratch.longitude = CesiumMath.lerp(targetRectangle.west, targetRectangle.east, u);\n        cartographicScratch.latitude = CesiumMath.lerp(targetRectangle.south, targetRectangle.north, v);\n        vertex.height = cartographicScratch.height = CesiumMath.lerp(height1, height2, ratio);\n\n        var normal;\n        if (sourceEncoding.hasVertexNormals) {\n            var encodedNormal1 = sourceEncoding.getOctEncodedNormal(sourceVertices, previousIndex, encodedNormalScratch);\n            var encodedNormal2 = sourceEncoding.getOctEncodedNormal(sourceVertices, nextIndex, encodedNormalScratch2);\n            var normal1 = AttributeCompression.octDecode(encodedNormal1.x, encodedNormal1.y, cartesianScratch);\n            var normal2 = AttributeCompression.octDecode(encodedNormal2.x, encodedNormal2.y, cartesianScratch2);\n            normal = Cartesian3.lerp(normal1, normal2, ratio, cartesianScratch);\n            Cartesian3.normalize(normal, normal);\n            AttributeCompression.octEncode(normal, vertex.encodedNormal);\n        } else {\n            normal = ellipsoid.geodeticSurfaceNormalCartographic(cartographicScratch, cartesianScratch);\n            AttributeCompression.octEncode(normal, vertex.encodedNormal);\n        }\n    }\n\n    function getVertexWithHeightAtCorner(terrainFillMesh, ellipsoid, u, v, height, vertex) {\n        vertex.height = height;\n        var normal = ellipsoid.geodeticSurfaceNormalCartographic(cartographicScratch, cartesianScratch);\n        AttributeCompression.octEncode(normal, vertex.encodedNormal);\n    }\n\n    function getCorner(\n        terrainFillMesh,\n        ellipsoid,\n        u, v,\n        cornerTile, cornerMesh,\n        previousEdgeTiles, previousEdgeMeshes,\n        nextEdgeTiles, nextEdgeMeshes,\n        vertex\n    ) {\n        var gotCorner =\n            getCornerFromEdge(terrainFillMesh, ellipsoid, previousEdgeMeshes, previousEdgeTiles, false, u, v, vertex) ||\n            getCornerFromEdge(terrainFillMesh, ellipsoid, nextEdgeMeshes, nextEdgeTiles, true, u, v, vertex);\n        if (gotCorner) {\n            return vertex;\n        }\n\n        var vertexIndex;\n\n        if (meshIsUsable(cornerTile, cornerMesh)) {\n            // Corner mesh is valid, copy its corner vertex to this mesh.\n            if (u === 0.0) {\n                if (v === 0.0) {\n                    // southwest destination, northeast source\n                    vertexIndex = cornerMesh.eastIndicesNorthToSouth[0];\n                } else {\n                    // northwest destination, southeast source\n                    vertexIndex = cornerMesh.southIndicesEastToWest[0];\n                }\n            } else if (v === 0.0) {\n                // southeast destination, northwest source\n                vertexIndex = cornerMesh.northIndicesWestToEast[0];\n            } else {\n                // northeast destination, southwest source\n                vertexIndex = cornerMesh.westIndicesSouthToNorth[0];\n            }\n            getVertexFromTileAtCorner(cornerMesh, vertexIndex, u, v, vertex);\n            return vertex;\n        }\n\n        // There is no precise vertex available from the corner or from either adjacent edge.\n        // This is either because there are no tiles at all at the edges and corner, or\n        // because the tiles at the edge are higher-level-number and don't extend all the way\n        // to the corner.\n        // Try to grab a height from the adjacent edges.\n        var height;\n        if (u === 0.0) {\n            if (v === 0.0) {\n                // southwest\n                height = getClosestHeightToCorner(\n                    terrainFillMesh.westMeshes, terrainFillMesh.westTiles, TileEdge.EAST,\n                    terrainFillMesh.southMeshes, terrainFillMesh.southTiles, TileEdge.NORTH,\n                    u, v);\n            } else {\n                // northwest\n                height = getClosestHeightToCorner(\n                    terrainFillMesh.northMeshes, terrainFillMesh.northTiles, TileEdge.SOUTH,\n                    terrainFillMesh.westMeshes, terrainFillMesh.westTiles, TileEdge.EAST,\n                    u, v);\n            }\n        } else if (v === 0.0) {\n            // southeast\n            height = getClosestHeightToCorner(\n                terrainFillMesh.southMeshes, terrainFillMesh.southTiles, TileEdge.NORTH,\n                terrainFillMesh.eastMeshes, terrainFillMesh.eastTiles, TileEdge.WEST,\n                u, v);\n        } else {\n            // northeast\n            height = getClosestHeightToCorner(\n                terrainFillMesh.eastMeshes, terrainFillMesh.eastTiles, TileEdge.WEST,\n                terrainFillMesh.northMeshes, terrainFillMesh.northTiles, TileEdge.SOUTH,\n                u, v);\n        }\n\n        if (defined(height)) {\n            getVertexWithHeightAtCorner(terrainFillMesh, ellipsoid, u, v, height, vertex);\n            return vertex;\n        }\n\n        // No heights available that are closer than the adjacent corners.\n        return undefined;\n    }\n\n    function getClosestHeightToCorner(\n        previousMeshes, previousTiles, previousEdge,\n        nextMeshes, nextTiles, nextEdge,\n        u, v\n    ) {\n        var height1 = getNearestHeightOnEdge(previousMeshes, previousTiles, false, previousEdge, u, v);\n        var height2 = getNearestHeightOnEdge(nextMeshes, nextTiles, true, nextEdge, u, v);\n        if (defined(height1) && defined(height2)) {\n            // It would be slightly better to do a weighted average of the two heights\n            // based on their distance from the corner, but it shouldn't matter much in practice.\n            return (height1 + height2) * 0.5;\n        } else if (defined(height1)) {\n            return height1;\n        }\n        return height2;\n    }\n\n    function addEdge(terrainFillMesh, ellipsoid, encoding, typedArray, nextIndex, edgeTiles, edgeMeshes, tileEdge, heightRange) {\n        for (var i = 0; i < edgeTiles.length; ++i) {\n            nextIndex = addEdgeMesh(terrainFillMesh, ellipsoid, encoding, typedArray, nextIndex, edgeTiles[i], edgeMeshes[i], tileEdge, heightRange);\n        }\n        return nextIndex;\n    }\n\n    function addEdgeMesh(terrainFillMesh, ellipsoid, encoding, typedArray, nextIndex, edgeTile, edgeMesh, tileEdge, heightRange) {\n        // Handle copying edges across the anti-meridian.\n        var sourceRectangle = edgeTile.rectangle;\n        if (tileEdge === TileEdge.EAST && terrainFillMesh.tile.x === 0) {\n            sourceRectangle = Rectangle.clone(edgeTile.rectangle, sourceRectangleScratch);\n            sourceRectangle.west -= CesiumMath.TWO_PI;\n            sourceRectangle.east -= CesiumMath.TWO_PI;\n        } else if (tileEdge === TileEdge.WEST && edgeTile.x === 0) {\n            sourceRectangle = Rectangle.clone(edgeTile.rectangle, sourceRectangleScratch);\n            sourceRectangle.west += CesiumMath.TWO_PI;\n            sourceRectangle.east += CesiumMath.TWO_PI;\n        }\n\n        var targetRectangle = terrainFillMesh.tile.rectangle;\n\n        var lastU;\n        var lastV;\n\n        if (nextIndex > 0) {\n            encoding.decodeTextureCoordinates(typedArray, nextIndex - 1, uvScratch);\n            lastU = uvScratch.x;\n            lastV = uvScratch.y;\n        }\n\n        var indices;\n        var compareU;\n\n        switch (tileEdge) {\n            case TileEdge.WEST:\n                indices = edgeMesh.westIndicesSouthToNorth;\n                compareU = false;\n                break;\n            case TileEdge.NORTH:\n                indices = edgeMesh.northIndicesWestToEast;\n                compareU = true;\n                break;\n            case TileEdge.EAST:\n                indices = edgeMesh.eastIndicesNorthToSouth;\n                compareU = false;\n                break;\n            case TileEdge.SOUTH:\n                indices = edgeMesh.southIndicesEastToWest;\n                compareU = true;\n                break;\n        }\n\n        var sourceTile = edgeTile;\n        var targetTile = terrainFillMesh.tile;\n        var sourceEncoding = edgeMesh.encoding;\n        var sourceVertices = edgeMesh.vertices;\n        var targetStride = encoding.getStride();\n\n        var southMercatorY;\n        var oneOverMercatorHeight;\n        if (sourceEncoding.hasWebMercatorT) {\n            southMercatorY = WebMercatorProjection.geodeticLatitudeToMercatorAngle(targetRectangle.south);\n            oneOverMercatorHeight = 1.0 / (WebMercatorProjection.geodeticLatitudeToMercatorAngle(targetRectangle.north) - southMercatorY);\n        }\n\n        for (var i = 0; i < indices.length; ++i) {\n            var index = indices[i];\n\n            var uv = sourceEncoding.decodeTextureCoordinates(sourceVertices, index, uvScratch);\n            transformTextureCoordinates(sourceTile, targetTile, uv, uv);\n            var u = uv.x;\n            var v = uv.y;\n            var uOrV = compareU ? u : v;\n\n            if (uOrV < 0.0 || uOrV > 1.0) {\n                // Vertex is outside the target tile - skip it.\n                continue;\n            }\n\n            if (Math.abs(u - lastU) < CesiumMath.EPSILON5 && Math.abs(v - lastV) < CesiumMath.EPSILON5) {\n                // Vertex is very close to the previous one - skip it.\n                continue;\n            }\n\n            var nearlyEdgeU = Math.abs(u) < CesiumMath.EPSILON5 || Math.abs(u - 1.0) < CesiumMath.EPSILON5;\n            var nearlyEdgeV = Math.abs(v) < CesiumMath.EPSILON5 || Math.abs(v - 1.0) < CesiumMath.EPSILON5;\n\n            if (nearlyEdgeU && nearlyEdgeV) {\n                // Corner vertex - skip it.\n                continue;\n            }\n\n            var position = sourceEncoding.decodePosition(sourceVertices, index, cartesianScratch);\n            var height = sourceEncoding.decodeHeight(sourceVertices, index);\n\n            var normal;\n            if (sourceEncoding.hasVertexNormals) {\n                normal = sourceEncoding.getOctEncodedNormal(sourceVertices, index, octEncodedNormalScratch);\n            } else {\n                normal = octEncodedNormalScratch;\n                normal.x = 0.0;\n                normal.y = 0.0;\n            }\n\n            var webMercatorT = v;\n            if (sourceEncoding.hasWebMercatorT) {\n                var latitude = CesiumMath.lerp(targetRectangle.south, targetRectangle.north, v);\n                webMercatorT = (WebMercatorProjection.geodeticLatitudeToMercatorAngle(latitude) - southMercatorY) * oneOverMercatorHeight;\n            }\n\n            encoding.encode(typedArray, nextIndex * targetStride, position, uv, height, normal, webMercatorT);\n\n            heightRange.minimumHeight = Math.min(heightRange.minimumHeight, height);\n            heightRange.maximumHeight = Math.max(heightRange.maximumHeight, height);\n\n            ++nextIndex;\n        }\n\n        return nextIndex;\n    }\n\n    function getNearestHeightOnEdge(meshes, tiles, isNext, edge, u, v) {\n        var meshStart;\n        var meshEnd;\n        var meshStep;\n\n        if (isNext) {\n            meshStart = 0;\n            meshEnd = meshes.length;\n            meshStep = 1;\n        } else {\n            meshStart = meshes.length - 1;\n            meshEnd = -1;\n            meshStep = -1;\n        }\n\n        for (var meshIndex = meshStart; meshIndex !== meshEnd; meshIndex += meshStep) {\n            var mesh = meshes[meshIndex];\n            var tile = tiles[meshIndex];\n            if (!meshIsUsable(tile, mesh)) {\n                continue;\n            }\n\n            var indices;\n            switch (edge) {\n                case TileEdge.WEST:\n                    indices = mesh.westIndicesSouthToNorth;\n                    break;\n                case TileEdge.SOUTH:\n                    indices = mesh.southIndicesEastToWest;\n                    break;\n                case TileEdge.EAST:\n                    indices = mesh.eastIndicesNorthToSouth;\n                    break;\n                case TileEdge.NORTH:\n                    indices = mesh.northIndicesWestToEast;\n                    break;\n            }\n\n            var index = indices[isNext ? 0 : indices.length - 1];\n            if (defined(index)) {\n                return mesh.encoding.decodeHeight(mesh.vertices, index);\n            }\n        }\n\n        return undefined;\n    }\n\n    function meshIsUsable(tile, mesh) {\n        return defined(mesh) && (!defined(tile.data.fill) || !tile.data.fill.changedThisFrame);\n    }\n\n    function getCornerFromEdge(terrainFillMesh, ellipsoid, edgeMeshes, edgeTiles, isNext, u, v, vertex) {\n        var edgeVertices;\n        var compareU;\n        var increasing;\n        var vertexIndexIndex;\n        var vertexIndex;\n        var sourceTile = edgeTiles[isNext ? 0 : edgeMeshes.length - 1];\n        var sourceMesh = edgeMeshes[isNext ? 0 : edgeMeshes.length - 1];\n\n        if (meshIsUsable(sourceTile, sourceMesh)) {\n            // Previous mesh is valid, but we don't know yet if it covers this corner.\n            if (u === 0.0) {\n                if (v === 0.0) {\n                    // southwest\n                    edgeVertices = isNext ? sourceMesh.northIndicesWestToEast : sourceMesh.eastIndicesNorthToSouth;\n                    compareU = isNext;\n                    increasing = isNext;\n                } else {\n                    // northwest\n                    edgeVertices = isNext ? sourceMesh.eastIndicesNorthToSouth : sourceMesh.southIndicesEastToWest;\n                    compareU = !isNext;\n                    increasing = false;\n                }\n            } else if (v === 0.0) {\n                // southeast\n                edgeVertices = isNext ? sourceMesh.westIndicesSouthToNorth : sourceMesh.northIndicesWestToEast;\n                compareU = !isNext;\n                increasing = true;\n            } else {\n                // northeast\n                edgeVertices = isNext ? sourceMesh.southIndicesEastToWest : sourceMesh.westIndicesSouthToNorth;\n                compareU = isNext;\n                increasing = !isNext;\n            }\n\n            if (edgeVertices.length > 0) {\n                // The vertex we want will very often be the first/last vertex so check that first.\n                vertexIndexIndex = isNext ? 0 : edgeVertices.length - 1;\n                vertexIndex = edgeVertices[vertexIndexIndex];\n                sourceMesh.encoding.decodeTextureCoordinates(sourceMesh.vertices, vertexIndex, uvScratch);\n                var targetUv = transformTextureCoordinates(sourceTile, terrainFillMesh.tile, uvScratch, uvScratch);\n                if (targetUv.x === u && targetUv.y === v) {\n                    // Vertex is good!\n                    getVertexFromTileAtCorner(sourceMesh, vertexIndex, u, v, vertex);\n                    return true;\n                }\n\n                // The last vertex is not the one we need, try binary searching for the right one.\n                vertexIndexIndex = binarySearch(edgeVertices, compareU ? u : v, function(vertexIndex, textureCoordinate) {\n                    sourceMesh.encoding.decodeTextureCoordinates(sourceMesh.vertices, vertexIndex, uvScratch);\n                    var targetUv = transformTextureCoordinates(sourceTile, terrainFillMesh.tile, uvScratch, uvScratch);\n                    if (increasing) {\n                        if (compareU) {\n                            return targetUv.x - u;\n                        }\n                        return targetUv.y - v;\n                    } else if (compareU) {\n                        return u - targetUv.x;\n                    }\n                    return v - targetUv.y;\n                });\n\n                if (vertexIndexIndex < 0) {\n                    vertexIndexIndex = ~vertexIndexIndex;\n\n                    if (vertexIndexIndex > 0 && vertexIndexIndex < edgeVertices.length) {\n                        // The corner falls between two vertices, so interpolate between them.\n                        getInterpolatedVertexAtCorner(ellipsoid, sourceTile, terrainFillMesh.tile, sourceMesh, edgeVertices[vertexIndexIndex - 1], edgeVertices[vertexIndexIndex], u, v, compareU, vertex);\n                        return true;\n                    }\n                } else {\n                    // Found a vertex that fits in the corner exactly.\n                    getVertexFromTileAtCorner(sourceMesh, edgeVertices[vertexIndexIndex], u, v, vertex);\n                    return true;\n                }\n            }\n        }\n\n        return false;\n    }\n\n    var cornerPositionsScratch = [new Cartesian3(), new Cartesian3(), new Cartesian3(), new Cartesian3()];\n\n    function computeOccludeePoint(tileProvider, center, rectangle, minimumHeight, maximumHeight, result) {\n        var ellipsoidalOccluder = tileProvider.quadtree._occluders.ellipsoid;\n        var ellipsoid = ellipsoidalOccluder.ellipsoid;\n\n        var cornerPositions = cornerPositionsScratch;\n        Cartesian3.fromRadians(rectangle.west, rectangle.south, maximumHeight, ellipsoid, cornerPositions[0]);\n        Cartesian3.fromRadians(rectangle.east, rectangle.south, maximumHeight, ellipsoid, cornerPositions[1]);\n        Cartesian3.fromRadians(rectangle.west, rectangle.north, maximumHeight, ellipsoid, cornerPositions[2]);\n        Cartesian3.fromRadians(rectangle.east, rectangle.north, maximumHeight, ellipsoid, cornerPositions[3]);\n\n        return ellipsoidalOccluder.computeHorizonCullingPointPossiblyUnderEllipsoid(center, cornerPositions, minimumHeight, result);\n    }\nexport default TerrainFillMesh;\n","import BoundingSphere from '../Core/BoundingSphere.js';\nimport BoxOutlineGeometry from '../Core/BoxOutlineGeometry.js';\nimport Cartesian2 from '../Core/Cartesian2.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Cartesian4 from '../Core/Cartesian4.js';\nimport Cartographic from '../Core/Cartographic.js';\nimport clone from '../Core/clone.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport combine from '../Core/combine.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport Event from '../Core/Event.js';\nimport GeometryInstance from '../Core/GeometryInstance.js';\nimport GeometryPipeline from '../Core/GeometryPipeline.js';\nimport IndexDatatype from '../Core/IndexDatatype.js';\nimport Intersect from '../Core/Intersect.js';\nimport CesiumMath from '../Core/Math.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport OrientedBoundingBox from '../Core/OrientedBoundingBox.js';\nimport OrthographicFrustum from '../Core/OrthographicFrustum.js';\nimport PrimitiveType from '../Core/PrimitiveType.js';\nimport Rectangle from '../Core/Rectangle.js';\nimport SphereOutlineGeometry from '../Core/SphereOutlineGeometry.js';\nimport TerrainQuantization from '../Core/TerrainQuantization.js';\nimport Visibility from '../Core/Visibility.js';\nimport WebMercatorProjection from '../Core/WebMercatorProjection.js';\nimport Buffer from '../Renderer/Buffer.js';\nimport BufferUsage from '../Renderer/BufferUsage.js';\nimport ContextLimits from '../Renderer/ContextLimits.js';\nimport DrawCommand from '../Renderer/DrawCommand.js';\nimport Pass from '../Renderer/Pass.js';\nimport RenderState from '../Renderer/RenderState.js';\nimport VertexArray from '../Renderer/VertexArray.js';\nimport BlendingState from './BlendingState.js';\nimport ClippingPlaneCollection from './ClippingPlaneCollection.js';\nimport DepthFunction from './DepthFunction.js';\nimport GlobeSurfaceTile from './GlobeSurfaceTile.js';\nimport ImageryLayer from './ImageryLayer.js';\nimport ImagerySplitDirection from './ImagerySplitDirection.js';\nimport ImageryState from './ImageryState.js';\nimport PerInstanceColorAppearance from './PerInstanceColorAppearance.js';\nimport Primitive from './Primitive.js';\nimport QuadtreeTileLoadState from './QuadtreeTileLoadState.js';\nimport SceneMode from './SceneMode.js';\nimport ShadowMode from './ShadowMode.js';\nimport TerrainFillMesh from './TerrainFillMesh.js';\nimport TerrainState from './TerrainState.js';\nimport TileBoundingRegion from './TileBoundingRegion.js';\nimport TileSelectionResult from './TileSelectionResult.js';\n\n    /**\n     * Provides quadtree tiles representing the surface of the globe.  This type is intended to be used\n     * with {@link QuadtreePrimitive}.\n     *\n     * @alias GlobeSurfaceTileProvider\n     * @constructor\n     *\n     * @param {TerrainProvider} options.terrainProvider The terrain provider that describes the surface geometry.\n     * @param {ImageryLayerCollection} option.imageryLayers The collection of imagery layers describing the shading of the surface.\n     * @param {GlobeSurfaceShaderSet} options.surfaceShaderSet The set of shaders used to render the surface.\n     *\n     * @private\n     */\n    function GlobeSurfaceTileProvider(options) {\n        \n\n        this.lightingFadeOutDistance = 6500000.0;\n        this.lightingFadeInDistance = 9000000.0;\n        this.hasWaterMask = false;\n        this.oceanNormalMap = undefined;\n        this.zoomedOutOceanSpecularIntensity = 0.5;\n        this.enableLighting = false;\n        this.dynamicAtmosphereLighting = false;\n        this.dynamicAtmosphereLightingFromSun = false;\n        this.showGroundAtmosphere = false;\n        this.shadows = ShadowMode.RECEIVE_ONLY;\n        this.splitDirection = ImagerySplitDirection.NONE;\n\n        /**\n         * The color to use to highlight terrain fill tiles. If undefined, fill tiles are not\n         * highlighted at all. The alpha value is used to alpha blend with the tile's\n         * actual color. Because terrain fill tiles do not represent the actual terrain surface,\n         * it may be useful in some applications to indicate visually that they are not to be trusted.\n         * @type {Color}\n         * @default undefined\n         */\n        this.fillHighlightColor = undefined;\n\n        this.hueShift = 0.0;\n        this.saturationShift = 0.0;\n        this.brightnessShift = 0.0;\n\n        this.showSkirts = true;\n        this.backFaceCulling = true;\n\n        this._quadtree = undefined;\n        this._terrainProvider = options.terrainProvider;\n        this._imageryLayers = options.imageryLayers;\n        this._surfaceShaderSet = options.surfaceShaderSet;\n\n        this._renderState = undefined;\n        this._blendRenderState = undefined;\n        this._disableCullingRenderState = undefined;\n        this._disableCullingBlendRenderState = undefined;\n\n        this._errorEvent = new Event();\n\n        this._imageryLayers.layerAdded.addEventListener(GlobeSurfaceTileProvider.prototype._onLayerAdded, this);\n        this._imageryLayers.layerRemoved.addEventListener(GlobeSurfaceTileProvider.prototype._onLayerRemoved, this);\n        this._imageryLayers.layerMoved.addEventListener(GlobeSurfaceTileProvider.prototype._onLayerMoved, this);\n        this._imageryLayers.layerShownOrHidden.addEventListener(GlobeSurfaceTileProvider.prototype._onLayerShownOrHidden, this);\n        this._imageryLayersUpdatedEvent = new Event();\n\n        this._layerOrderChanged = false;\n\n        this._tilesToRenderByTextureCount = [];\n        this._drawCommands = [];\n        this._uniformMaps = [];\n        this._usedDrawCommands = 0;\n\n        this._vertexArraysToDestroy = [];\n\n        this._debug = {\n            wireframe : false,\n            boundingSphereTile : undefined\n        };\n\n        this._baseColor = undefined;\n        this._firstPassInitialColor = undefined;\n        this.baseColor = new Color(0.0, 0.0, 0.5, 1.0);\n\n        /**\n         * A property specifying a {@link ClippingPlaneCollection} used to selectively disable rendering on the outside of each plane.\n         * @type {ClippingPlaneCollection}\n         * @private\n         */\n        this._clippingPlanes = undefined;\n\n        /**\n         * A property specifying a {@link Rectangle} used to selectively limit terrain and imagery rendering.\n         * @type {Rectangle}\n         */\n        this.cartographicLimitRectangle = Rectangle.clone(Rectangle.MAX_VALUE);\n\n        this._hasLoadedTilesThisFrame = false;\n        this._hasFillTilesThisFrame = false;\n    }\n\n    Object.defineProperties(GlobeSurfaceTileProvider.prototype, {\n        /**\n         * Gets or sets the color of the globe when no imagery is available.\n         * @memberof GlobeSurfaceTileProvider.prototype\n         * @type {Color}\n         */\n        baseColor : {\n            get : function() {\n                return this._baseColor;\n            },\n            set : function(value) {\n                \n\n                this._baseColor = value;\n                this._firstPassInitialColor = Cartesian4.fromColor(value, this._firstPassInitialColor);\n            }\n        },\n        /**\n         * Gets or sets the {@link QuadtreePrimitive} for which this provider is\n         * providing tiles.  This property may be undefined if the provider is not yet associated\n         * with a {@link QuadtreePrimitive}.\n         * @memberof GlobeSurfaceTileProvider.prototype\n         * @type {QuadtreePrimitive}\n         */\n        quadtree : {\n            get : function() {\n                return this._quadtree;\n            },\n            set : function(value) {\n                \n\n                this._quadtree = value;\n            }\n        },\n\n        /**\n         * Gets a value indicating whether or not the provider is ready for use.\n         * @memberof GlobeSurfaceTileProvider.prototype\n         * @type {Boolean}\n         */\n        ready : {\n            get : function() {\n                return this._terrainProvider.ready && (this._imageryLayers.length === 0 || this._imageryLayers.get(0).imageryProvider.ready);\n            }\n        },\n\n        /**\n         * Gets the tiling scheme used by the provider.  This property should\n         * not be accessed before {@link GlobeSurfaceTileProvider#ready} returns true.\n         * @memberof GlobeSurfaceTileProvider.prototype\n         * @type {TilingScheme}\n         */\n        tilingScheme : {\n            get : function() {\n                return this._terrainProvider.tilingScheme;\n            }\n        },\n\n        /**\n         * Gets an event that is raised when the geometry provider encounters an asynchronous error.  By subscribing\n         * to the event, you will be notified of the error and can potentially recover from it.  Event listeners\n         * are passed an instance of {@link TileProviderError}.\n         * @memberof GlobeSurfaceTileProvider.prototype\n         * @type {Event}\n         */\n        errorEvent : {\n            get : function() {\n                return this._errorEvent;\n            }\n        },\n\n        /**\n         * Gets an event that is raised when an imagery layer is added, shown, hidden, moved, or removed.\n         * @memberof GlobeSurfaceTileProvider.prototype\n         * @type {Event}\n         */\n        imageryLayersUpdatedEvent : {\n            get : function() {\n                return this._imageryLayersUpdatedEvent;\n            }\n        },\n\n        /**\n         * Gets or sets the terrain provider that describes the surface geometry.\n         * @memberof GlobeSurfaceTileProvider.prototype\n         * @type {TerrainProvider}\n         */\n        terrainProvider : {\n            get : function() {\n                return this._terrainProvider;\n            },\n            set : function(terrainProvider) {\n                if (this._terrainProvider === terrainProvider) {\n                    return;\n                }\n\n                \n\n                this._terrainProvider = terrainProvider;\n\n                if (defined(this._quadtree)) {\n                    this._quadtree.invalidateAllTiles();\n                }\n            }\n        },\n        /**\n         * The {@link ClippingPlaneCollection} used to selectively disable rendering the tileset.\n         *\n         * @type {ClippingPlaneCollection}\n         *\n         * @private\n         */\n        clippingPlanes : {\n            get : function() {\n                return this._clippingPlanes;\n            },\n            set : function(value) {\n                ClippingPlaneCollection.setOwner(value, this, '_clippingPlanes');\n            }\n        }\n    });\n\n    function sortTileImageryByLayerIndex(a, b) {\n        var aImagery = a.loadingImagery;\n        if (!defined(aImagery)) {\n            aImagery = a.readyImagery;\n        }\n\n        var bImagery = b.loadingImagery;\n        if (!defined(bImagery)) {\n            bImagery = b.readyImagery;\n        }\n\n        return aImagery.imageryLayer._layerIndex - bImagery.imageryLayer._layerIndex;\n    }\n\n     /**\n     * Make updates to the tile provider that are not involved in rendering. Called before the render update cycle.\n     */\n    GlobeSurfaceTileProvider.prototype.update = function(frameState) {\n        // update collection: imagery indices, base layers, raise layer show/hide event\n        this._imageryLayers._update();\n    };\n\n    function updateCredits(surface, frameState) {\n        var creditDisplay = frameState.creditDisplay;\n        if (surface._terrainProvider.ready && defined(surface._terrainProvider.credit)) {\n            creditDisplay.addCredit(surface._terrainProvider.credit);\n        }\n\n        var imageryLayers = surface._imageryLayers;\n        for (var i = 0, len = imageryLayers.length; i < len; ++i) {\n            var imageryProvider = imageryLayers.get(i).imageryProvider;\n            if (imageryProvider.ready && defined(imageryProvider.credit)) {\n                creditDisplay.addCredit(imageryProvider.credit);\n            }\n        }\n    }\n\n    /**\n     * Called at the beginning of each render frame, before {@link QuadtreeTileProvider#showTileThisFrame}\n     * @param {FrameState} frameState The frame state.\n     */\n    GlobeSurfaceTileProvider.prototype.initialize = function(frameState) {\n        // update each layer for texture reprojection.\n        this._imageryLayers.queueReprojectionCommands(frameState);\n\n        if (this._layerOrderChanged) {\n            this._layerOrderChanged = false;\n\n            // Sort the TileImagery instances in each tile by the layer index.\n            this._quadtree.forEachLoadedTile(function(tile) {\n                tile.data.imagery.sort(sortTileImageryByLayerIndex);\n            });\n        }\n\n        // Add credits for terrain and imagery providers.\n        updateCredits(this, frameState);\n\n        var vertexArraysToDestroy = this._vertexArraysToDestroy;\n        var length = vertexArraysToDestroy.length;\n        for (var j = 0; j < length; ++j) {\n            GlobeSurfaceTile._freeVertexArray(vertexArraysToDestroy[j]);\n        }\n        vertexArraysToDestroy.length = 0;\n    };\n\n    /**\n     * Called at the beginning of the update cycle for each render frame, before {@link QuadtreeTileProvider#showTileThisFrame}\n     * or any other functions.\n     *\n     * @param {FrameState} frameState The frame state.\n     */\n    GlobeSurfaceTileProvider.prototype.beginUpdate = function(frameState) {\n        var tilesToRenderByTextureCount = this._tilesToRenderByTextureCount;\n        for (var i = 0, len = tilesToRenderByTextureCount.length; i < len; ++i) {\n            var tiles = tilesToRenderByTextureCount[i];\n            if (defined(tiles)) {\n                tiles.length = 0;\n            }\n        }\n        // update clipping planes\n        var clippingPlanes = this._clippingPlanes;\n        if (defined(clippingPlanes) && clippingPlanes.enabled) {\n            clippingPlanes.update(frameState);\n        }\n        this._usedDrawCommands = 0;\n\n        this._hasLoadedTilesThisFrame = false;\n        this._hasFillTilesThisFrame = false;\n    };\n\n    /**\n     * Called at the end of the update cycle for each render frame, after {@link QuadtreeTileProvider#showTileThisFrame}\n     * and any other functions.\n     *\n     * @param {FrameState} frameState The frame state.\n     */\n    GlobeSurfaceTileProvider.prototype.endUpdate = function(frameState) {\n        if (!defined(this._renderState)) {\n            this._renderState = RenderState.fromCache({ // Write color and depth\n                cull : {\n                    enabled : true\n                },\n                depthTest : {\n                    enabled : true,\n                    func : DepthFunction.LESS\n                }\n            });\n\n            this._blendRenderState = RenderState.fromCache({ // Write color and depth\n                cull : {\n                    enabled : true\n                },\n                depthTest : {\n                    enabled : true,\n                    func : DepthFunction.LESS_OR_EQUAL\n                },\n                blending : BlendingState.ALPHA_BLEND\n            });\n\n            var rs = clone(this._renderState, true);\n            rs.cull.enabled = false;\n            this._disableCullingRenderState = RenderState.fromCache(rs);\n\n            rs = clone(this._blendRenderState, true);\n            rs.cull.enabled = false;\n            this._disableCullingBlendRenderState = RenderState.fromCache(rs);\n        }\n\n        // If this frame has a mix of loaded and fill tiles, we need to propagate\n        // loaded heights to the fill tiles.\n        if (this._hasFillTilesThisFrame && this._hasLoadedTilesThisFrame) {\n            TerrainFillMesh.updateFillTiles(this, this._quadtree._tilesToRender, frameState, this._vertexArraysToDestroy);\n        }\n\n        // Add the tile render commands to the command list, sorted by texture count.\n        var tilesToRenderByTextureCount = this._tilesToRenderByTextureCount;\n        for (var textureCountIndex = 0, textureCountLength = tilesToRenderByTextureCount.length; textureCountIndex < textureCountLength; ++textureCountIndex) {\n            var tilesToRender = tilesToRenderByTextureCount[textureCountIndex];\n            if (!defined(tilesToRender)) {\n                continue;\n            }\n\n            for (var tileIndex = 0, tileLength = tilesToRender.length; tileIndex < tileLength; ++tileIndex) {\n                var tile = tilesToRender[tileIndex];\n                var tileBoundingRegion = tile.data.tileBoundingRegion;\n                addDrawCommandsForTile(this, tile, frameState);\n                frameState.minimumTerrainHeight = Math.min(frameState.minimumTerrainHeight, tileBoundingRegion.minimumHeight);\n            }\n        }\n    };\n\n    /**\n     * Adds draw commands for tiles rendered in the previous frame for a pick pass.\n     *\n     * @param {FrameState} frameState The frame state.\n     */\n    GlobeSurfaceTileProvider.prototype.updateForPick = function(frameState) {\n        // Add the tile pick commands from the tiles drawn last frame.\n        var drawCommands = this._drawCommands;\n        for (var i = 0, length = this._usedDrawCommands; i < length; ++i) {\n            frameState.commandList.push(drawCommands[i]);\n        }\n    };\n\n    /**\n     * Cancels any imagery re-projections in the queue.\n     */\n    GlobeSurfaceTileProvider.prototype.cancelReprojections = function() {\n        this._imageryLayers.cancelReprojections();\n    };\n\n    /**\n     * Gets the maximum geometric error allowed in a tile at a given level, in meters.  This function should not be\n     * called before {@link GlobeSurfaceTileProvider#ready} returns true.\n     *\n     * @param {Number} level The tile level for which to get the maximum geometric error.\n     * @returns {Number} The maximum geometric error in meters.\n     */\n    GlobeSurfaceTileProvider.prototype.getLevelMaximumGeometricError = function(level) {\n        return this._terrainProvider.getLevelMaximumGeometricError(level);\n    };\n\n    /**\n     * Loads, or continues loading, a given tile.  This function will continue to be called\n     * until {@link QuadtreeTile#state} is no longer {@link QuadtreeTileLoadState#LOADING}.  This function should\n     * not be called before {@link GlobeSurfaceTileProvider#ready} returns true.\n     *\n     * @param {FrameState} frameState The frame state.\n     * @param {QuadtreeTile} tile The tile to load.\n     *\n     * @exception {DeveloperError} <code>loadTile</code> must not be called before the tile provider is ready.\n     */\n    GlobeSurfaceTileProvider.prototype.loadTile = function(frameState, tile) {\n        // We don't want to load imagery until we're certain that the terrain tiles are actually visible.\n        // So if our bounding volume isn't accurate because it came from another tile, load terrain only\n        // initially. If we load some terrain and suddenly have a more accurate bounding volume and the\n        // tile is _still_ visible, give the tile a chance to load imagery immediately rather than\n        // waiting for next frame.\n\n        var surfaceTile = tile.data;\n        var terrainOnly = true;\n        var terrainStateBefore;\n        if (defined(surfaceTile)) {\n            terrainOnly = surfaceTile.boundingVolumeSourceTile !== tile || tile._lastSelectionResult === TileSelectionResult.CULLED_BUT_NEEDED;\n            terrainStateBefore = surfaceTile.terrainState;\n        }\n\n        GlobeSurfaceTile.processStateMachine(tile, frameState, this.terrainProvider, this._imageryLayers, this._vertexArraysToDestroy, terrainOnly);\n\n        surfaceTile = tile.data;\n        if (terrainOnly && terrainStateBefore !== tile.data.terrainState) {\n            // Terrain state changed. If:\n            // a) The tile is visible, and\n            // b) The bounding volume is accurate (updated as a side effect of computing visibility)\n            // Then we'll load imagery, too.\n            if (this.computeTileVisibility(tile, frameState, this.quadtree.occluders) && surfaceTile.boundingVolumeSourceTile === tile) {\n                terrainOnly = false;\n                GlobeSurfaceTile.processStateMachine(tile, frameState, this.terrainProvider, this._imageryLayers, this._vertexArraysToDestroy, terrainOnly);\n            }\n        }\n    };\n\n    var boundingSphereScratch = new BoundingSphere();\n    var rectangleIntersectionScratch = new Rectangle();\n    var splitCartographicLimitRectangleScratch = new Rectangle();\n    var rectangleCenterScratch = new Cartographic();\n\n    // cartographicLimitRectangle may span the IDL, but tiles never will.\n    function clipRectangleAntimeridian(tileRectangle, cartographicLimitRectangle) {\n        if (cartographicLimitRectangle.west < cartographicLimitRectangle.east) {\n            return cartographicLimitRectangle;\n        }\n        var splitRectangle = Rectangle.clone(cartographicLimitRectangle, splitCartographicLimitRectangleScratch);\n        var tileCenter = Rectangle.center(tileRectangle, rectangleCenterScratch);\n        if (tileCenter.longitude > 0.0) {\n            splitRectangle.east = CesiumMath.PI;\n        } else {\n            splitRectangle.west = -CesiumMath.PI;\n        }\n        return splitRectangle;\n    }\n\n    /**\n     * Determines the visibility of a given tile.  The tile may be fully visible, partially visible, or not\n     * visible at all.  Tiles that are renderable and are at least partially visible will be shown by a call\n     * to {@link GlobeSurfaceTileProvider#showTileThisFrame}.\n     *\n     * @param {QuadtreeTile} tile The tile instance.\n     * @param {FrameState} frameState The state information about the current frame.\n     * @param {QuadtreeOccluders} occluders The objects that may occlude this tile.\n     *\n     * @returns {Visibility} The visibility of the tile.\n     */\n    GlobeSurfaceTileProvider.prototype.computeTileVisibility = function(tile, frameState, occluders) {\n        var distance = this.computeDistanceToTile(tile, frameState);\n        tile._distance = distance;\n\n        if (frameState.fog.enabled && !frameState.cameraUnderground) {\n            if (CesiumMath.fog(distance, frameState.fog.density) >= 1.0) {\n                // Tile is completely in fog so return that it is not visible.\n                return Visibility.NONE;\n            }\n        }\n\n        var surfaceTile = tile.data;\n        var tileBoundingRegion = surfaceTile.tileBoundingRegion;\n\n        if (surfaceTile.boundingVolumeSourceTile === undefined) {\n            // We have no idea where this tile is, so let's just call it partially visible.\n            return Visibility.PARTIAL;\n        }\n\n        var cullingVolume = frameState.cullingVolume;\n        var boundingVolume = surfaceTile.orientedBoundingBox;\n\n        if (!defined(boundingVolume) && defined(surfaceTile.renderedMesh)) {\n            boundingVolume = surfaceTile.renderedMesh.boundingSphere3D;\n        }\n\n        // Check if the tile is outside the limit area in cartographic space\n        surfaceTile.clippedByBoundaries = false;\n        var clippedCartographicLimitRectangle = clipRectangleAntimeridian(tile.rectangle, this.cartographicLimitRectangle);\n        var areaLimitIntersection = Rectangle.simpleIntersection(clippedCartographicLimitRectangle, tile.rectangle, rectangleIntersectionScratch);\n        if (!defined(areaLimitIntersection)) {\n            return Visibility.NONE;\n        }\n        if (!Rectangle.equals(areaLimitIntersection, tile.rectangle)) {\n            surfaceTile.clippedByBoundaries = true;\n        }\n\n        if (frameState.mode !== SceneMode.SCENE3D) {\n            boundingVolume = boundingSphereScratch;\n            BoundingSphere.fromRectangleWithHeights2D(tile.rectangle, frameState.mapProjection, tileBoundingRegion.minimumHeight, tileBoundingRegion.maximumHeight, boundingVolume);\n            Cartesian3.fromElements(boundingVolume.center.z, boundingVolume.center.x, boundingVolume.center.y, boundingVolume.center);\n\n            if (frameState.mode === SceneMode.MORPHING && defined(surfaceTile.renderedMesh)) {\n                boundingVolume = BoundingSphere.union(surfaceTile.renderedMesh.boundingSphere3D, boundingVolume, boundingVolume);\n            }\n        }\n\n        if (!defined(boundingVolume)) {\n            return Intersect.INTERSECTING;\n        }\n\n        var clippingPlanes = this._clippingPlanes;\n        if (defined(clippingPlanes) && clippingPlanes.enabled) {\n            var planeIntersection = clippingPlanes.computeIntersectionWithBoundingVolume(boundingVolume);\n            tile.isClipped = (planeIntersection !== Intersect.INSIDE);\n            if (planeIntersection === Intersect.OUTSIDE) {\n                return Visibility.NONE;\n            }\n        }\n\n        var intersection = cullingVolume.computeVisibility(boundingVolume);\n        if (intersection === Intersect.OUTSIDE) {\n            return Visibility.NONE;\n        }\n\n        var ortho3D = frameState.mode === SceneMode.SCENE3D && frameState.camera.frustum instanceof OrthographicFrustum;\n        if (frameState.mode === SceneMode.SCENE3D && !ortho3D && defined(occluders) && !frameState.cameraUnderground) {\n            var occludeePointInScaledSpace = surfaceTile.occludeePointInScaledSpace;\n            if (!defined(occludeePointInScaledSpace)) {\n                return intersection;\n            }\n\n            if (occluders.ellipsoid.isScaledSpacePointVisiblePossiblyUnderEllipsoid(occludeePointInScaledSpace, tileBoundingRegion.minimumHeight)) {\n                return intersection;\n            }\n\n            return Visibility.NONE;\n        }\n\n        return intersection;\n    };\n\n    /**\n     * Determines if the given tile can be refined\n     * @param {QuadtreeTile} tile The tile to check.\n     * @returns {boolean} True if the tile can be refined, false if it cannot.\n     */\n    GlobeSurfaceTileProvider.prototype.canRefine = function(tile) {\n        // Only allow refinement it we know whether or not the children of this tile exist.\n        // For a tileset with `availability`, we'll always be able to refine.\n        // We can ask for availability of _any_ child tile because we only need to confirm\n        // that we get a yes or no answer, it doesn't matter what the answer is.\n        if (defined(tile.data.terrainData)) {\n            return true;\n        }\n        var childAvailable = this.terrainProvider.getTileDataAvailable(tile.x * 2, tile.y * 2, tile.level + 1);\n        return childAvailable !== undefined;\n    };\n\n    var readyImageryScratch = [];\n    var canRenderTraversalStack = [];\n\n    /**\n     * Determines if the given not-fully-loaded tile can be rendered without losing detail that\n     * was present last frame as a result of rendering descendant tiles. This method will only be\n     * called if this tile's descendants were rendered last frame. If the tile is fully loaded,\n     * it is assumed that this method will return true and it will not be called.\n     * @param {QuadtreeTile} tile The tile to check.\n     * @returns {boolean} True if the tile can be rendered without losing detail.\n     */\n    GlobeSurfaceTileProvider.prototype.canRenderWithoutLosingDetail = function(tile, frameState) {\n        var surfaceTile = tile.data;\n\n        var readyImagery = readyImageryScratch;\n        readyImagery.length = this._imageryLayers.length;\n\n        var terrainReady = false;\n        var initialImageryState = false;\n        var imagery;\n\n        if (defined(surfaceTile)) {\n            // We can render even with non-ready terrain as long as all our rendered descendants\n            // are missing terrain geometry too. i.e. if we rendered fills for more detailed tiles\n            // last frame, it's ok to render a fill for this tile this frame.\n            terrainReady = surfaceTile.terrainState === TerrainState.READY;\n\n            // Initially assume all imagery layers are ready, unless imagery hasn't been initialized at all.\n            initialImageryState = true;\n\n            imagery = surfaceTile.imagery;\n        }\n\n        var i;\n        var len;\n\n        for (i = 0, len = readyImagery.length; i < len; ++i) {\n            readyImagery[i] = initialImageryState;\n        }\n\n        if (defined(imagery)) {\n            for (i = 0, len = imagery.length; i < len; ++i) {\n                var tileImagery = imagery[i];\n                var loadingImagery = tileImagery.loadingImagery;\n                var isReady = !defined(loadingImagery) || loadingImagery.state === ImageryState.FAILED || loadingImagery.state === ImageryState.INVALID;\n                var layerIndex = (tileImagery.loadingImagery || tileImagery.readyImagery).imageryLayer._layerIndex;\n\n                // For a layer to be ready, all tiles belonging to that layer must be ready.\n                readyImagery[layerIndex] = isReady && readyImagery[layerIndex];\n            }\n        }\n\n        var lastFrame = this.quadtree._lastSelectionFrameNumber;\n\n        // Traverse the descendants looking for one with terrain or imagery that is not loaded on this tile.\n        var stack = canRenderTraversalStack;\n        stack.length = 0;\n        stack.push(tile.southwestChild, tile.southeastChild, tile.northwestChild, tile.northeastChild);\n\n        while (stack.length > 0) {\n            var descendant = stack.pop();\n            var lastFrameSelectionResult = descendant._lastSelectionResultFrame === lastFrame ? descendant._lastSelectionResult : TileSelectionResult.NONE;\n\n            if (lastFrameSelectionResult === TileSelectionResult.RENDERED) {\n                var descendantSurface = descendant.data;\n\n                if (!defined(descendantSurface)) {\n                    // Descendant has no data, so it can't block rendering.\n                    continue;\n                }\n\n                if (!terrainReady && descendant.data.terrainState === TerrainState.READY) {\n                    // Rendered descendant has real terrain, but we don't. Rendering is blocked.\n                    return false;\n                }\n\n                var descendantImagery = descendant.data.imagery;\n                for (i = 0, len = descendantImagery.length; i < len; ++i) {\n                    var descendantTileImagery = descendantImagery[i];\n                    var descendantLoadingImagery = descendantTileImagery.loadingImagery;\n                    var descendantIsReady = !defined(descendantLoadingImagery) || descendantLoadingImagery.state === ImageryState.FAILED || descendantLoadingImagery.state === ImageryState.INVALID;\n                    var descendantLayerIndex = (descendantTileImagery.loadingImagery || descendantTileImagery.readyImagery).imageryLayer._layerIndex;\n\n                    // If this imagery tile of a descendant is ready but the layer isn't ready in this tile,\n                    // then rendering is blocked.\n                    if (descendantIsReady && !readyImagery[descendantLayerIndex]) {\n                        return false;\n                    }\n                }\n            } else if (lastFrameSelectionResult === TileSelectionResult.REFINED) {\n                stack.push(descendant.southwestChild, descendant.southeastChild, descendant.northwestChild, descendant.northeastChild);\n            }\n        }\n\n        return true;\n    };\n\n    var tileDirectionScratch = new Cartesian3();\n\n    /**\n     * Determines the priority for loading this tile. Lower priority values load sooner.\n     * @param {QuadtreeTile} tile The tile.\n     * @param {FrameState} frameState The frame state.\n     * @returns {Number} The load priority value.\n     */\n    GlobeSurfaceTileProvider.prototype.computeTileLoadPriority = function(tile, frameState) {\n        var surfaceTile = tile.data;\n        if (surfaceTile === undefined) {\n            return 0.0;\n        }\n\n        var obb = surfaceTile.orientedBoundingBox;\n        if (obb === undefined) {\n            return 0.0;\n        }\n\n        var cameraPosition = frameState.camera.positionWC;\n        var cameraDirection = frameState.camera.directionWC;\n        var tileDirection = Cartesian3.subtract(obb.center, cameraPosition, tileDirectionScratch);\n        var magnitude = Cartesian3.magnitude(tileDirection);\n        if (magnitude < CesiumMath.EPSILON5) {\n            return 0.0;\n        }\n        Cartesian3.divideByScalar(tileDirection, magnitude, tileDirection);\n        return (1.0 - Cartesian3.dot(tileDirection, cameraDirection)) * tile._distance;\n    };\n\n    var modifiedModelViewScratch = new Matrix4();\n    var modifiedModelViewProjectionScratch = new Matrix4();\n    var tileRectangleScratch = new Cartesian4();\n    var localizedCartographicLimitRectangleScratch = new Cartesian4();\n    var rtcScratch = new Cartesian3();\n    var centerEyeScratch = new Cartesian3();\n    var southwestScratch = new Cartesian3();\n    var northeastScratch = new Cartesian3();\n\n    /**\n     * Shows a specified tile in this frame.  The provider can cause the tile to be shown by adding\n     * render commands to the commandList, or use any other method as appropriate.  The tile is not\n     * expected to be visible next frame as well, unless this method is called next frame, too.\n     *\n     * @param {QuadtreeTile} tile The tile instance.\n     * @param {FrameState} frameState The state information of the current rendering frame.\n     */\n    GlobeSurfaceTileProvider.prototype.showTileThisFrame = function(tile, frameState) {\n        var readyTextureCount = 0;\n        var tileImageryCollection = tile.data.imagery;\n        for (var i = 0, len = tileImageryCollection.length; i < len; ++i) {\n            var tileImagery = tileImageryCollection[i];\n            if (defined(tileImagery.readyImagery) && tileImagery.readyImagery.imageryLayer.alpha !== 0.0) {\n                ++readyTextureCount;\n            }\n        }\n\n        var tileSet = this._tilesToRenderByTextureCount[readyTextureCount];\n        if (!defined(tileSet)) {\n            tileSet = [];\n            this._tilesToRenderByTextureCount[readyTextureCount] = tileSet;\n        }\n\n        tileSet.push(tile);\n\n        var surfaceTile = tile.data;\n        if (!defined(surfaceTile.vertexArray)) {\n            this._hasFillTilesThisFrame = true;\n        } else {\n            this._hasLoadedTilesThisFrame = true;\n        }\n\n        var debug = this._debug;\n        ++debug.tilesRendered;\n        debug.texturesRendered += readyTextureCount;\n    };\n\n    var cornerPositionsScratch = [new Cartesian3(), new Cartesian3(), new Cartesian3(), new Cartesian3()];\n\n    function computeOccludeePoint(tileProvider, center, rectangle, minimumHeight, maximumHeight, result) {\n        var ellipsoidalOccluder = tileProvider.quadtree._occluders.ellipsoid;\n        var ellipsoid = ellipsoidalOccluder.ellipsoid;\n\n        var cornerPositions = cornerPositionsScratch;\n        Cartesian3.fromRadians(rectangle.west, rectangle.south, maximumHeight, ellipsoid, cornerPositions[0]);\n        Cartesian3.fromRadians(rectangle.east, rectangle.south, maximumHeight, ellipsoid, cornerPositions[1]);\n        Cartesian3.fromRadians(rectangle.west, rectangle.north, maximumHeight, ellipsoid, cornerPositions[2]);\n        Cartesian3.fromRadians(rectangle.east, rectangle.north, maximumHeight, ellipsoid, cornerPositions[3]);\n\n        return ellipsoidalOccluder.computeHorizonCullingPointPossiblyUnderEllipsoid(center, cornerPositions, minimumHeight, result);\n    }\n\n    /**\n     * Gets the distance from the camera to the closest point on the tile.  This is used for level-of-detail selection.\n     *\n     * @param {QuadtreeTile} tile The tile instance.\n     * @param {FrameState} frameState The state information of the current rendering frame.\n     *\n     * @returns {Number} The distance from the camera to the closest point on the tile, in meters.\n     */\n    GlobeSurfaceTileProvider.prototype.computeDistanceToTile = function(tile, frameState) {\n        // The distance should be:\n        // 1. the actual distance to the tight-fitting bounding volume, or\n        // 2. a distance that is equal to or greater than the actual distance to the tight-fitting bounding volume.\n        //\n        // When we don't know the min/max heights for a tile, but we do know the min/max of an ancestor tile, we can\n        // build a tight-fitting bounding volume horizontally, but not vertically. The min/max heights from the\n        // ancestor will likely form a volume that is much bigger than it needs to be. This means that the volume may\n        // be deemed to be much closer to the camera than it really is, causing us to select tiles that are too detailed.\n        // Loading too-detailed tiles is super expensive, so we don't want to do that. We don't know where the child\n        // tile really lies within the parent range of heights, but we _do_ know the child tile can't be any closer than\n        // the ancestor height surface (min or max) that is _farthest away_ from the camera. So if we compute distance\n        // based that conservative metric, we may end up loading tiles that are not detailed enough, but that's much\n        // better (faster) than loading tiles that are too detailed.\n\n        var heightSource = updateTileBoundingRegion(tile, this.terrainProvider, frameState);\n        var surfaceTile = tile.data;\n        var tileBoundingRegion = surfaceTile.tileBoundingRegion;\n\n        if (heightSource === undefined) {\n            // Can't find any min/max heights anywhere? Ok, let's just say the\n            // tile is really far away so we'll load and render it rather than\n            // refining.\n            return 9999999999.0;\n        } else if (surfaceTile.boundingVolumeSourceTile !== heightSource) {\n            // Heights are from a new source tile, so update the bounding volume.\n            surfaceTile.boundingVolumeSourceTile = heightSource;\n\n            var rectangle = tile.rectangle;\n            if (defined(rectangle)) {\n                surfaceTile.orientedBoundingBox = OrientedBoundingBox.fromRectangle(\n                    tile.rectangle,\n                    tileBoundingRegion.minimumHeight,\n                    tileBoundingRegion.maximumHeight,\n                    tile.tilingScheme.ellipsoid,\n                    surfaceTile.orientedBoundingBox);\n\n                surfaceTile.occludeePointInScaledSpace = computeOccludeePoint(this, surfaceTile.orientedBoundingBox.center, tile.rectangle, tileBoundingRegion.minimumHeight, tileBoundingRegion.maximumHeight, surfaceTile.occludeePointInScaledSpace);\n            }\n        }\n\n        var min = tileBoundingRegion.minimumHeight;\n        var max = tileBoundingRegion.maximumHeight;\n\n        if (surfaceTile.boundingVolumeSourceTile !== tile) {\n            var cameraHeight = frameState.camera.positionCartographic.height;\n            var distanceToMin = Math.abs(cameraHeight - min);\n            var distanceToMax = Math.abs(cameraHeight - max);\n            if (distanceToMin > distanceToMax) {\n                tileBoundingRegion.minimumHeight = min;\n                tileBoundingRegion.maximumHeight = min;\n            } else {\n                tileBoundingRegion.minimumHeight = max;\n                tileBoundingRegion.maximumHeight = max;\n            }\n        }\n\n        var result = tileBoundingRegion.distanceToCamera(frameState);\n\n        tileBoundingRegion.minimumHeight = min;\n        tileBoundingRegion.maximumHeight = max;\n\n        return result;\n    };\n\n    function updateTileBoundingRegion(tile, terrainProvider, frameState) {\n        var surfaceTile = tile.data;\n        if (surfaceTile === undefined) {\n            surfaceTile = tile.data = new GlobeSurfaceTile();\n        }\n\n        if (surfaceTile.tileBoundingRegion === undefined) {\n            surfaceTile.tileBoundingRegion = new TileBoundingRegion({\n                computeBoundingVolumes : false,\n                rectangle : tile.rectangle,\n                ellipsoid : tile.tilingScheme.ellipsoid,\n                minimumHeight : 0.0,\n                maximumHeight : 0.0\n            });\n        }\n\n        var terrainData = surfaceTile.terrainData;\n        var mesh = surfaceTile.mesh;\n        var tileBoundingRegion = surfaceTile.tileBoundingRegion;\n\n        if (mesh !== undefined && mesh.minimumHeight !== undefined && mesh.maximumHeight !== undefined) {\n            // We have tight-fitting min/max heights from the mesh.\n            tileBoundingRegion.minimumHeight = mesh.minimumHeight;\n            tileBoundingRegion.maximumHeight = mesh.maximumHeight;\n            return tile;\n        }\n\n        if (terrainData !== undefined && terrainData._minimumHeight !== undefined && terrainData._maximumHeight !== undefined) {\n            // We have tight-fitting min/max heights from the terrain data.\n            tileBoundingRegion.minimumHeight = terrainData._minimumHeight * frameState.terrainExaggeration;\n            tileBoundingRegion.maximumHeight = terrainData._maximumHeight * frameState.terrainExaggeration;\n            return tile;\n        }\n\n        // No accurate min/max heights available, so we're stuck with min/max heights from an ancestor tile.\n        tileBoundingRegion.minimumHeight = Number.NaN;\n        tileBoundingRegion.maximumHeight = Number.NaN;\n\n        var ancestor = tile.parent;\n        while (ancestor !== undefined) {\n            var ancestorSurfaceTile = ancestor.data;\n            if (ancestorSurfaceTile !== undefined) {\n                var ancestorMesh = ancestorSurfaceTile.mesh;\n                if (ancestorMesh !== undefined && ancestorMesh.minimumHeight !== undefined && ancestorMesh.maximumHeight !== undefined) {\n                    tileBoundingRegion.minimumHeight = ancestorMesh.minimumHeight;\n                    tileBoundingRegion.maximumHeight = ancestorMesh.maximumHeight;\n                    return ancestor;\n                }\n\n                var ancestorTerrainData = ancestorSurfaceTile.terrainData;\n                if (ancestorTerrainData !== undefined && ancestorTerrainData._minimumHeight !== undefined && ancestorTerrainData._maximumHeight !== undefined) {\n                    tileBoundingRegion.minimumHeight = ancestorTerrainData._minimumHeight * frameState.terrainExaggeration;\n                    tileBoundingRegion.maximumHeight = ancestorTerrainData._maximumHeight * frameState.terrainExaggeration;\n                    return ancestor;\n                }\n            }\n            ancestor = ancestor.parent;\n        }\n\n        return undefined;\n    }\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <br /><br />\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     *\n     * @returns {Boolean} True if this object was destroyed; otherwise, false.\n     *\n     * @see GlobeSurfaceTileProvider#destroy\n     */\n    GlobeSurfaceTileProvider.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n     * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n     * <br /><br />\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     *\n     * @example\n     * provider = provider && provider();\n     *\n     * @see GlobeSurfaceTileProvider#isDestroyed\n     */\n    GlobeSurfaceTileProvider.prototype.destroy = function() {\n        this._tileProvider = this._tileProvider && this._tileProvider.destroy();\n        this._clippingPlanes = this._clippingPlanes && this._clippingPlanes.destroy();\n\n        return destroyObject(this);\n    };\n\n    function getTileReadyCallback(tileImageriesToFree, layer, terrainProvider) {\n        return function(tile) {\n            var tileImagery;\n            var imagery;\n            var startIndex = -1;\n            var tileImageryCollection = tile.data.imagery;\n            var length = tileImageryCollection.length;\n            var i;\n            for (i = 0; i < length; ++i) {\n                tileImagery = tileImageryCollection[i];\n                imagery = defaultValue(tileImagery.readyImagery, tileImagery.loadingImagery);\n                if (imagery.imageryLayer === layer) {\n                    startIndex = i;\n                    break;\n                }\n            }\n\n            if (startIndex !== -1) {\n                var endIndex = startIndex + tileImageriesToFree;\n                tileImagery = tileImageryCollection[endIndex];\n                imagery = defined(tileImagery) ? defaultValue(tileImagery.readyImagery, tileImagery.loadingImagery) : undefined;\n                if (!defined(imagery) || imagery.imageryLayer !== layer) {\n                    // Return false to keep the callback if we have to wait on the skeletons\n                    // Return true to remove the callback if something went wrong\n                    return !(layer._createTileImagerySkeletons(tile, terrainProvider, endIndex));\n                }\n\n                for (i = startIndex; i < endIndex; ++i) {\n                    tileImageryCollection[i].freeResources();\n                }\n\n                tileImageryCollection.splice(startIndex, tileImageriesToFree);\n            }\n\n            return true; // Everything is done, so remove the callback\n        };\n    }\n\n    GlobeSurfaceTileProvider.prototype._onLayerAdded = function(layer, index) {\n        if (layer.show) {\n            var terrainProvider = this._terrainProvider;\n\n            var that = this;\n            var imageryProvider = layer.imageryProvider;\n            var tileImageryUpdatedEvent = this._imageryLayersUpdatedEvent;\n            imageryProvider._reload = function() {\n                // Clear the layer's cache\n                layer._imageryCache = {};\n\n                that._quadtree.forEachLoadedTile(function(tile) {\n                    // If this layer is still waiting to for the loaded callback, just return\n                    if (defined(tile._loadedCallbacks[layer._layerIndex])) {\n                        return;\n                    }\n\n                    var i;\n\n                    // Figure out how many TileImageries we will need to remove and where to insert new ones\n                    var tileImageryCollection = tile.data.imagery;\n                    var length = tileImageryCollection.length;\n                    var startIndex = -1;\n                    var tileImageriesToFree = 0;\n                    for (i = 0; i < length; ++i) {\n                        var tileImagery = tileImageryCollection[i];\n                        var imagery = defaultValue(tileImagery.readyImagery, tileImagery.loadingImagery);\n                        if (imagery.imageryLayer === layer) {\n                            if (startIndex === -1) {\n                                startIndex = i;\n                            }\n\n                            ++tileImageriesToFree;\n                        } else if (startIndex !== -1) {\n                            // iterated past the section of TileImageries belonging to this layer, no need to continue.\n                            break;\n                        }\n                    }\n\n                    if (startIndex === -1) {\n                        return;\n                    }\n\n                    // Insert immediately after existing TileImageries\n                    var insertionPoint = startIndex + tileImageriesToFree;\n\n                    // Create new TileImageries for all loaded tiles\n                    if (layer._createTileImagerySkeletons(tile, terrainProvider, insertionPoint)) {\n                        // Add callback to remove old TileImageries when the new TileImageries are ready\n                        tile._loadedCallbacks[layer._layerIndex] = getTileReadyCallback(tileImageriesToFree, layer, terrainProvider);\n\n                        tile.state = QuadtreeTileLoadState.LOADING;\n                    }\n                });\n            };\n\n            // create TileImageries for this layer for all previously loaded tiles\n            this._quadtree.forEachLoadedTile(function(tile) {\n                if (layer._createTileImagerySkeletons(tile, terrainProvider)) {\n                    tile.state = QuadtreeTileLoadState.LOADING;\n\n                    // Tiles that are not currently being rendered need to load the new layer before they're renderable.\n                    // We don't mark the rendered tiles non-renderable, though, because that would make the globe disappear.\n                    if (tile.level !== 0 && (tile._lastSelectionResultFrame !== that.quadtree._lastSelectionFrameNumber || tile._lastSelectionResult !== TileSelectionResult.RENDERED)) {\n                        tile.renderable = false;\n                    }\n                }\n            });\n\n            this._layerOrderChanged = true;\n            tileImageryUpdatedEvent.raiseEvent();\n        }\n    };\n\n    GlobeSurfaceTileProvider.prototype._onLayerRemoved = function(layer, index) {\n        // destroy TileImagerys for this layer for all previously loaded tiles\n        this._quadtree.forEachLoadedTile(function(tile) {\n            var tileImageryCollection = tile.data.imagery;\n\n            var startIndex = -1;\n            var numDestroyed = 0;\n            for (var i = 0, len = tileImageryCollection.length; i < len; ++i) {\n                var tileImagery = tileImageryCollection[i];\n                var imagery = tileImagery.loadingImagery;\n                if (!defined(imagery)) {\n                    imagery = tileImagery.readyImagery;\n                }\n                if (imagery.imageryLayer === layer) {\n                    if (startIndex === -1) {\n                        startIndex = i;\n                    }\n\n                    tileImagery.freeResources();\n                    ++numDestroyed;\n                } else if (startIndex !== -1) {\n                    // iterated past the section of TileImagerys belonging to this layer, no need to continue.\n                    break;\n                }\n            }\n\n            if (startIndex !== -1) {\n                tileImageryCollection.splice(startIndex, numDestroyed);\n            }\n        });\n\n        if (defined(layer.imageryProvider)) {\n            layer.imageryProvider._reload = undefined;\n        }\n\n        this._imageryLayersUpdatedEvent.raiseEvent();\n    };\n\n    GlobeSurfaceTileProvider.prototype._onLayerMoved = function(layer, newIndex, oldIndex) {\n        this._layerOrderChanged = true;\n        this._imageryLayersUpdatedEvent.raiseEvent();\n    };\n\n    GlobeSurfaceTileProvider.prototype._onLayerShownOrHidden = function(layer, index, show) {\n        if (show) {\n            this._onLayerAdded(layer, index);\n        } else {\n            this._onLayerRemoved(layer, index);\n        }\n    };\n\n    var scratchClippingPlaneMatrix = new Matrix4();\n    function createTileUniformMap(frameState, globeSurfaceTileProvider) {\n        var uniformMap = {\n            u_initialColor : function() {\n                return this.properties.initialColor;\n            },\n            u_fillHighlightColor : function() {\n                return this.properties.fillHighlightColor;\n            },\n            u_zoomedOutOceanSpecularIntensity : function() {\n                return this.properties.zoomedOutOceanSpecularIntensity;\n            },\n            u_oceanNormalMap : function() {\n                return this.properties.oceanNormalMap;\n            },\n            u_lightingFadeDistance : function() {\n                return this.properties.lightingFadeDistance;\n            },\n            u_nightFadeDistance : function() {\n                return this.properties.nightFadeDistance;\n            },\n            u_center3D : function() {\n                return this.properties.center3D;\n            },\n            u_tileRectangle : function() {\n                return this.properties.tileRectangle;\n            },\n            u_modifiedModelView : function() {\n                var viewMatrix = frameState.context.uniformState.view;\n                var centerEye = Matrix4.multiplyByPoint(viewMatrix, this.properties.rtc, centerEyeScratch);\n                Matrix4.setTranslation(viewMatrix, centerEye, modifiedModelViewScratch);\n                return modifiedModelViewScratch;\n            },\n            u_modifiedModelViewProjection : function() {\n                var viewMatrix = frameState.context.uniformState.view;\n                var projectionMatrix = frameState.context.uniformState.projection;\n                var centerEye = Matrix4.multiplyByPoint(viewMatrix, this.properties.rtc, centerEyeScratch);\n                Matrix4.setTranslation(viewMatrix, centerEye, modifiedModelViewProjectionScratch);\n                Matrix4.multiply(projectionMatrix, modifiedModelViewProjectionScratch, modifiedModelViewProjectionScratch);\n                return modifiedModelViewProjectionScratch;\n            },\n            u_dayTextures : function() {\n                return this.properties.dayTextures;\n            },\n            u_dayTextureTranslationAndScale : function() {\n                return this.properties.dayTextureTranslationAndScale;\n            },\n            u_dayTextureTexCoordsRectangle : function() {\n                return this.properties.dayTextureTexCoordsRectangle;\n            },\n            u_dayTextureUseWebMercatorT : function() {\n                return this.properties.dayTextureUseWebMercatorT;\n            },\n            u_dayTextureAlpha : function() {\n                return this.properties.dayTextureAlpha;\n            },\n            u_dayTextureBrightness : function() {\n                return this.properties.dayTextureBrightness;\n            },\n            u_dayTextureContrast : function() {\n                return this.properties.dayTextureContrast;\n            },\n            u_dayTextureHue : function() {\n                return this.properties.dayTextureHue;\n            },\n            u_dayTextureSaturation : function() {\n                return this.properties.dayTextureSaturation;\n            },\n            u_dayTextureOneOverGamma : function() {\n                return this.properties.dayTextureOneOverGamma;\n            },\n            u_dayIntensity : function() {\n                return this.properties.dayIntensity;\n            },\n            u_southAndNorthLatitude : function() {\n                return this.properties.southAndNorthLatitude;\n            },\n            u_southMercatorYAndOneOverHeight : function() {\n                return this.properties.southMercatorYAndOneOverHeight;\n            },\n            u_waterMask : function() {\n                return this.properties.waterMask;\n            },\n            u_waterMaskTranslationAndScale : function() {\n                return this.properties.waterMaskTranslationAndScale;\n            },\n            u_minMaxHeight : function() {\n                return this.properties.minMaxHeight;\n            },\n            u_scaleAndBias : function() {\n                return this.properties.scaleAndBias;\n            },\n            u_dayTextureSplit : function() {\n                return this.properties.dayTextureSplit;\n            },\n            u_dayTextureCutoutRectangles : function() {\n                return this.properties.dayTextureCutoutRectangles;\n            },\n            u_clippingPlanes : function() {\n                var clippingPlanes = globeSurfaceTileProvider._clippingPlanes;\n                if (defined(clippingPlanes) && defined(clippingPlanes.texture)) {\n                    // Check in case clippingPlanes hasn't been updated yet.\n                    return clippingPlanes.texture;\n                }\n                return frameState.context.defaultTexture;\n            },\n            u_cartographicLimitRectangle : function() {\n                return this.properties.localizedCartographicLimitRectangle;\n            },\n            u_clippingPlanesMatrix : function() {\n                var clippingPlanes = globeSurfaceTileProvider._clippingPlanes;\n                return defined(clippingPlanes) ? Matrix4.multiply(frameState.context.uniformState.view, clippingPlanes.modelMatrix, scratchClippingPlaneMatrix) : Matrix4.IDENTITY;\n            },\n            u_clippingPlanesEdgeStyle : function() {\n                var style = this.properties.clippingPlanesEdgeColor;\n                style.alpha = this.properties.clippingPlanesEdgeWidth;\n                return style;\n            },\n            u_minimumBrightness : function() {\n                return frameState.fog.minimumBrightness;\n            },\n            u_terrainSplitDirection : function() {\n                return globeSurfaceTileProvider.splitDirection;\n            },\n            u_hsbShift : function() {\n                return this.properties.hsbShift;\n            },\n            u_colorsToAlpha : function() {\n                return this.properties.colorsToAlpha;\n            },\n\n            // make a separate object so that changes to the properties are seen on\n            // derived commands that combine another uniform map with this one.\n            properties : {\n                initialColor : new Cartesian4(0.0, 0.0, 0.5, 1.0),\n                fillHighlightColor : new Color(0.0, 0.0, 0.0, 0.0),\n                zoomedOutOceanSpecularIntensity : 0.5,\n                oceanNormalMap : undefined,\n                lightingFadeDistance : new Cartesian2(6500000.0, 9000000.0),\n                nightFadeDistance : new Cartesian2(10000000.0, 40000000.0),\n                hsbShift : new Cartesian3(),\n\n                center3D : undefined,\n                rtc : new Cartesian3(),\n                modifiedModelView : new Matrix4(),\n                tileRectangle : new Cartesian4(),\n\n                dayTextures : [],\n                dayTextureTranslationAndScale : [],\n                dayTextureTexCoordsRectangle : [],\n                dayTextureUseWebMercatorT : [],\n                dayTextureAlpha : [],\n                dayTextureBrightness : [],\n                dayTextureContrast : [],\n                dayTextureHue : [],\n                dayTextureSaturation : [],\n                dayTextureOneOverGamma : [],\n                dayTextureSplit : [],\n                dayTextureCutoutRectangles : [],\n                dayIntensity : 0.0,\n                colorsToAlpha : [],\n\n                southAndNorthLatitude : new Cartesian2(),\n                southMercatorYAndOneOverHeight : new Cartesian2(),\n\n                waterMask : undefined,\n                waterMaskTranslationAndScale : new Cartesian4(),\n\n                minMaxHeight : new Cartesian2(),\n                scaleAndBias : new Matrix4(),\n                clippingPlanesEdgeColor : Color.clone(Color.WHITE),\n                clippingPlanesEdgeWidth : 0.0,\n\n                localizedCartographicLimitRectangle : new Cartesian4()\n            }\n        };\n\n        return uniformMap;\n    }\n\n    function createWireframeVertexArrayIfNecessary(context, provider, tile) {\n        var surfaceTile = tile.data;\n\n        var mesh;\n        var vertexArray;\n\n        if (defined(surfaceTile.vertexArray)) {\n            mesh = surfaceTile.mesh;\n            vertexArray = surfaceTile.vertexArray;\n        } else if (defined(surfaceTile.fill) && defined(surfaceTile.fill.vertexArray)) {\n            mesh = surfaceTile.fill.mesh;\n            vertexArray = surfaceTile.fill.vertexArray;\n        }\n\n        if (!defined(mesh) || !defined(vertexArray)) {\n            return;\n        }\n\n        if (defined(surfaceTile.wireframeVertexArray)) {\n            if (surfaceTile.wireframeVertexArray.mesh === mesh) {\n                return;\n            }\n\n            surfaceTile.wireframeVertexArray.destroy();\n            surfaceTile.wireframeVertexArray = undefined;\n        }\n\n        surfaceTile.wireframeVertexArray = createWireframeVertexArray(context, vertexArray, mesh);\n        surfaceTile.wireframeVertexArray.mesh = mesh;\n    }\n\n    /**\n     * Creates a vertex array for wireframe rendering of a terrain tile.\n     *\n     * @private\n     *\n     * @param {Context} context The context in which to create the vertex array.\n     * @param {VertexArray} vertexArray The existing, non-wireframe vertex array.  The new vertex array\n     *                      will share vertex buffers with this existing one.\n     * @param {TerrainMesh} terrainMesh The terrain mesh containing non-wireframe indices.\n     * @returns {VertexArray} The vertex array for wireframe rendering.\n     */\n    function createWireframeVertexArray(context, vertexArray, terrainMesh) {\n        var indices = terrainMesh.indices;\n\n        var geometry = {\n            indices : indices,\n            primitiveType : PrimitiveType.TRIANGLES\n        };\n\n        GeometryPipeline.toWireframe(geometry);\n\n        var wireframeIndices = geometry.indices;\n        var wireframeIndexBuffer = Buffer.createIndexBuffer({\n            context : context,\n            typedArray : wireframeIndices,\n            usage : BufferUsage.STATIC_DRAW,\n            indexDatatype : IndexDatatype.fromSizeInBytes(wireframeIndices.BYTES_PER_ELEMENT)\n        });\n        return new VertexArray({\n            context : context,\n            attributes : vertexArray._attributes,\n            indexBuffer : wireframeIndexBuffer\n        });\n    }\n\n    var getDebugOrientedBoundingBox;\n    var getDebugBoundingSphere;\n    var debugDestroyPrimitive;\n\n    (function() {\n        var instanceOBB = new GeometryInstance({\n            geometry : BoxOutlineGeometry.fromDimensions({dimensions : new Cartesian3(2.0, 2.0, 2.0)})\n        });\n        var instanceSphere = new GeometryInstance({\n            geometry : new SphereOutlineGeometry({radius : 1.0})\n        });\n        var modelMatrix = new Matrix4();\n        var previousVolume;\n        var primitive;\n\n        function createDebugPrimitive(instance) {\n            return new Primitive({\n                geometryInstances : instance,\n                appearance : new PerInstanceColorAppearance({\n                    translucent : false,\n                    flat : true\n                }),\n                asynchronous : false\n            });\n        }\n\n        getDebugOrientedBoundingBox = function(obb, color) {\n            if (obb === previousVolume) {\n                return primitive;\n            }\n            debugDestroyPrimitive();\n\n            previousVolume = obb;\n            modelMatrix = Matrix4.fromRotationTranslation(obb.halfAxes, obb.center, modelMatrix);\n\n            instanceOBB.modelMatrix = modelMatrix;\n            instanceOBB.attributes.color = ColorGeometryInstanceAttribute.fromColor(color);\n\n            primitive = createDebugPrimitive(instanceOBB);\n            return primitive;\n        };\n\n        getDebugBoundingSphere = function(sphere, color) {\n            if (sphere === previousVolume) {\n                return primitive;\n            }\n            debugDestroyPrimitive();\n\n            previousVolume = sphere;\n            modelMatrix = Matrix4.fromTranslation(sphere.center, modelMatrix);\n            modelMatrix = Matrix4.multiplyByUniformScale(modelMatrix, sphere.radius, modelMatrix);\n\n            instanceSphere.modelMatrix = modelMatrix;\n            instanceSphere.attributes.color = ColorGeometryInstanceAttribute.fromColor(color);\n\n            primitive = createDebugPrimitive(instanceSphere);\n            return primitive;\n        };\n\n        debugDestroyPrimitive = function() {\n            if (defined(primitive)) {\n                primitive.destroy();\n                primitive = undefined;\n                previousVolume = undefined;\n            }\n        };\n    })();\n\n    var otherPassesInitialColor = new Cartesian4(0.0, 0.0, 0.0, 0.0);\n    var surfaceShaderSetOptionsScratch = {\n        frameState : undefined,\n        surfaceTile : undefined,\n        numberOfDayTextures : undefined,\n        applyBrightness : undefined,\n        applyContrast : undefined,\n        applyHue : undefined,\n        applySaturation : undefined,\n        applyGamma : undefined,\n        applyAlpha : undefined,\n        applySplit : undefined,\n        showReflectiveOcean : undefined,\n        showOceanWaves : undefined,\n        enableLighting : undefined,\n        dynamicAtmosphereLighting : undefined,\n        dynamicAtmosphereLightingFromSun : undefined,\n        showGroundAtmosphere : undefined,\n        perFragmentGroundAtmosphere : undefined,\n        hasVertexNormals : undefined,\n        useWebMercatorProjection : undefined,\n        enableFog : undefined,\n        enableClippingPlanes : undefined,\n        clippingPlanes : undefined,\n        clippedByBoundaries : undefined,\n        hasImageryLayerCutout : undefined,\n        colorCorrect : undefined,\n        colorToAlpha : undefined\n    };\n\n    function addDrawCommandsForTile(tileProvider, tile, frameState) {\n        var surfaceTile = tile.data;\n\n        if (!defined(surfaceTile.vertexArray)) {\n            if (surfaceTile.fill === undefined) {\n                // No fill was created for this tile, probably because this tile is not connected to\n                // any renderable tiles. So create a simple tile in the middle of the tile's possible\n                // height range.\n                surfaceTile.fill = new TerrainFillMesh(tile);\n            }\n            surfaceTile.fill.update(tileProvider, frameState);\n        }\n\n        var creditDisplay = frameState.creditDisplay;\n\n        var terrainData = surfaceTile.terrainData;\n        if (defined(terrainData) && defined(terrainData.credits)) {\n            var tileCredits = terrainData.credits;\n            for (var tileCreditIndex = 0,\n                     tileCreditLength = tileCredits.length; tileCreditIndex < tileCreditLength; ++tileCreditIndex) {\n                creditDisplay.addCredit(tileCredits[tileCreditIndex]);\n            }\n        }\n\n        var maxTextures = ContextLimits.maximumTextureImageUnits;\n\n        var waterMaskTexture = surfaceTile.waterMaskTexture;\n        var waterMaskTranslationAndScale = surfaceTile.waterMaskTranslationAndScale;\n        if (!defined(waterMaskTexture) && defined(surfaceTile.fill)) {\n            waterMaskTexture = surfaceTile.fill.waterMaskTexture;\n            waterMaskTranslationAndScale = surfaceTile.fill.waterMaskTranslationAndScale;\n        }\n\n        var cameraUnderground = frameState.cameraUnderground;\n\n        var showReflectiveOcean = tileProvider.hasWaterMask && defined(waterMaskTexture);\n        var oceanNormalMap = tileProvider.oceanNormalMap;\n        var showOceanWaves = showReflectiveOcean && defined(oceanNormalMap);\n        var hasVertexNormals = tileProvider.terrainProvider.ready && tileProvider.terrainProvider.hasVertexNormals;\n        var enableFog = frameState.fog.enabled && !cameraUnderground;\n        var showGroundAtmosphere = tileProvider.showGroundAtmosphere;\n        var castShadows = ShadowMode.castShadows(tileProvider.shadows);\n        var receiveShadows = ShadowMode.receiveShadows(tileProvider.shadows);\n\n        var hueShift = tileProvider.hueShift;\n        var saturationShift = tileProvider.saturationShift;\n        var brightnessShift = tileProvider.brightnessShift;\n\n        var colorCorrect = !(CesiumMath.equalsEpsilon(hueShift, 0.0, CesiumMath.EPSILON7) &&\n                             CesiumMath.equalsEpsilon(saturationShift, 0.0, CesiumMath.EPSILON7) &&\n                             CesiumMath.equalsEpsilon(brightnessShift, 0.0, CesiumMath.EPSILON7));\n\n        var perFragmentGroundAtmosphere = false;\n        if (showGroundAtmosphere) {\n            var mode = frameState.mode;\n            var camera = frameState.camera;\n            var cameraDistance;\n            if (mode === SceneMode.SCENE2D || mode === SceneMode.COLUMBUS_VIEW) {\n                cameraDistance = camera.positionCartographic.height;\n            } else {\n                cameraDistance = Cartesian3.magnitude(camera.positionWC);\n            }\n            var fadeOutDistance = tileProvider.nightFadeOutDistance;\n            if (mode !== SceneMode.SCENE3D) {\n                fadeOutDistance -= frameState.mapProjection.ellipsoid.maximumRadius;\n            }\n            perFragmentGroundAtmosphere = cameraDistance > fadeOutDistance;\n        }\n\n        if (showReflectiveOcean) {\n            --maxTextures;\n        }\n        if (showOceanWaves) {\n            --maxTextures;\n        }\n\n        if (defined(frameState.shadowState) && frameState.shadowState.shadowsEnabled) {\n            --maxTextures;\n        }\n        if (defined(tileProvider.clippingPlanes) && tileProvider.clippingPlanes.enabled) {\n            --maxTextures;\n        }\n\n        var mesh = surfaceTile.renderedMesh;\n        var rtc = mesh.center;\n        var encoding = mesh.encoding;\n\n        // Not used in 3D.\n        var tileRectangle = tileRectangleScratch;\n\n        // Only used for Mercator projections.\n        var southLatitude = 0.0;\n        var northLatitude = 0.0;\n        var southMercatorY = 0.0;\n        var oneOverMercatorHeight = 0.0;\n\n        var useWebMercatorProjection = false;\n\n        if (frameState.mode !== SceneMode.SCENE3D) {\n            var projection = frameState.mapProjection;\n            var southwest = projection.project(Rectangle.southwest(tile.rectangle), southwestScratch);\n            var northeast = projection.project(Rectangle.northeast(tile.rectangle), northeastScratch);\n\n            tileRectangle.x = southwest.x;\n            tileRectangle.y = southwest.y;\n            tileRectangle.z = northeast.x;\n            tileRectangle.w = northeast.y;\n\n            // In 2D and Columbus View, use the center of the tile for RTC rendering.\n            if (frameState.mode !== SceneMode.MORPHING) {\n                rtc = rtcScratch;\n                rtc.x = 0.0;\n                rtc.y = (tileRectangle.z + tileRectangle.x) * 0.5;\n                rtc.z = (tileRectangle.w + tileRectangle.y) * 0.5;\n                tileRectangle.x -= rtc.y;\n                tileRectangle.y -= rtc.z;\n                tileRectangle.z -= rtc.y;\n                tileRectangle.w -= rtc.z;\n            }\n\n            if (frameState.mode === SceneMode.SCENE2D && encoding.quantization === TerrainQuantization.BITS12) {\n                // In 2D, the texture coordinates of the tile are interpolated over the rectangle to get the position in the vertex shader.\n                // When the texture coordinates are quantized, error is introduced. This can be seen through the 1px wide cracking\n                // between the quantized tiles in 2D. To compensate for the error, move the expand the rectangle in each direction by\n                // half the error amount.\n                var epsilon = (1.0 / (Math.pow(2.0, 12.0) - 1.0)) * 0.5;\n                var widthEpsilon = (tileRectangle.z - tileRectangle.x) * epsilon;\n                var heightEpsilon = (tileRectangle.w - tileRectangle.y) * epsilon;\n                tileRectangle.x -= widthEpsilon;\n                tileRectangle.y -= heightEpsilon;\n                tileRectangle.z += widthEpsilon;\n                tileRectangle.w += heightEpsilon;\n            }\n\n            if (projection instanceof WebMercatorProjection) {\n                southLatitude = tile.rectangle.south;\n                northLatitude = tile.rectangle.north;\n\n                southMercatorY = WebMercatorProjection.geodeticLatitudeToMercatorAngle(southLatitude);\n\n                oneOverMercatorHeight = 1.0 / (WebMercatorProjection.geodeticLatitudeToMercatorAngle(northLatitude) - southMercatorY);\n\n                useWebMercatorProjection = true;\n            }\n        }\n\n        var surfaceShaderSetOptions = surfaceShaderSetOptionsScratch;\n        surfaceShaderSetOptions.frameState = frameState;\n        surfaceShaderSetOptions.surfaceTile = surfaceTile;\n        surfaceShaderSetOptions.showReflectiveOcean = showReflectiveOcean;\n        surfaceShaderSetOptions.showOceanWaves = showOceanWaves;\n        surfaceShaderSetOptions.enableLighting = tileProvider.enableLighting;\n        surfaceShaderSetOptions.dynamicAtmosphereLighting = tileProvider.dynamicAtmosphereLighting;\n        surfaceShaderSetOptions.dynamicAtmosphereLightingFromSun = tileProvider.dynamicAtmosphereLightingFromSun;\n        surfaceShaderSetOptions.showGroundAtmosphere = showGroundAtmosphere;\n        surfaceShaderSetOptions.perFragmentGroundAtmosphere = perFragmentGroundAtmosphere;\n        surfaceShaderSetOptions.hasVertexNormals = hasVertexNormals;\n        surfaceShaderSetOptions.useWebMercatorProjection = useWebMercatorProjection;\n        surfaceShaderSetOptions.clippedByBoundaries = surfaceTile.clippedByBoundaries;\n        surfaceShaderSetOptions.splitTerrain = tileProvider.splitDirection !== ImagerySplitDirection.NONE;\n\n        var tileImageryCollection = surfaceTile.imagery;\n        var imageryIndex = 0;\n        var imageryLen = tileImageryCollection.length;\n\n        var showSkirts = tileProvider.showSkirts && !cameraUnderground;\n        var backFaceCulling = tileProvider.backFaceCulling && !cameraUnderground;\n        var firstPassRenderState = backFaceCulling ? tileProvider._renderState : tileProvider._disableCullingRenderState;\n        var otherPassesRenderState = backFaceCulling ? tileProvider._blendRenderState : tileProvider._disableCullingBlendRenderState;\n        var renderState = firstPassRenderState;\n\n        var initialColor = tileProvider._firstPassInitialColor;\n\n        var context = frameState.context;\n\n        if (!defined(tileProvider._debug.boundingSphereTile)) {\n            debugDestroyPrimitive();\n        }\n\n        do {\n            var numberOfDayTextures = 0;\n\n            var command;\n            var uniformMap;\n\n            if (tileProvider._drawCommands.length <= tileProvider._usedDrawCommands) {\n                command = new DrawCommand();\n                command.owner = tile;\n                command.cull = false;\n                command.boundingVolume = new BoundingSphere();\n                command.orientedBoundingBox = undefined;\n\n                uniformMap = createTileUniformMap(frameState, tileProvider);\n\n                tileProvider._drawCommands.push(command);\n                tileProvider._uniformMaps.push(uniformMap);\n            } else {\n                command = tileProvider._drawCommands[tileProvider._usedDrawCommands];\n                uniformMap = tileProvider._uniformMaps[tileProvider._usedDrawCommands];\n            }\n\n            command.owner = tile;\n\n            ++tileProvider._usedDrawCommands;\n\n            if (tile === tileProvider._debug.boundingSphereTile) {\n                var obb = surfaceTile.orientedBoundingBox;\n                // If a debug primitive already exists for this tile, it will not be\n                // re-created, to avoid allocation every frame. If it were possible\n                // to have more than one selected tile, this would have to change.\n                if (defined(obb)) {\n                    getDebugOrientedBoundingBox(obb, Color.RED).update(frameState);\n                } else if (defined(mesh) && defined(mesh.boundingSphere3D)) {\n                    getDebugBoundingSphere(mesh.boundingSphere3D, Color.RED).update(frameState);\n                }\n            }\n\n            var uniformMapProperties = uniformMap.properties;\n            Cartesian4.clone(initialColor, uniformMapProperties.initialColor);\n            uniformMapProperties.oceanNormalMap = oceanNormalMap;\n            uniformMapProperties.lightingFadeDistance.x = tileProvider.lightingFadeOutDistance;\n            uniformMapProperties.lightingFadeDistance.y = tileProvider.lightingFadeInDistance;\n            uniformMapProperties.nightFadeDistance.x = tileProvider.nightFadeOutDistance;\n            uniformMapProperties.nightFadeDistance.y = tileProvider.nightFadeInDistance;\n            uniformMapProperties.zoomedOutOceanSpecularIntensity = tileProvider.zoomedOutOceanSpecularIntensity;\n\n            var highlightFillTile = !defined(surfaceTile.vertexArray) && defined(tileProvider.fillHighlightColor) && tileProvider.fillHighlightColor.alpha > 0.0;\n            if (highlightFillTile) {\n                Color.clone(tileProvider.fillHighlightColor, uniformMapProperties.fillHighlightColor);\n            }\n\n            uniformMapProperties.center3D = mesh.center;\n            Cartesian3.clone(rtc, uniformMapProperties.rtc);\n\n            Cartesian4.clone(tileRectangle, uniformMapProperties.tileRectangle);\n            uniformMapProperties.southAndNorthLatitude.x = southLatitude;\n            uniformMapProperties.southAndNorthLatitude.y = northLatitude;\n            uniformMapProperties.southMercatorYAndOneOverHeight.x = southMercatorY;\n            uniformMapProperties.southMercatorYAndOneOverHeight.y = oneOverMercatorHeight;\n\n            // Convert tile limiter rectangle from cartographic to texture space using the tileRectangle.\n            var localizedCartographicLimitRectangle = localizedCartographicLimitRectangleScratch;\n            var cartographicLimitRectangle = clipRectangleAntimeridian(tile.rectangle, tileProvider.cartographicLimitRectangle);\n\n            Cartesian3.fromElements(hueShift, saturationShift, brightnessShift, uniformMapProperties.hsbShift);\n\n            var cartographicTileRectangle = tile.rectangle;\n            var inverseTileWidth = 1.0 / cartographicTileRectangle.width;\n            var inverseTileHeight = 1.0 / cartographicTileRectangle.height;\n            localizedCartographicLimitRectangle.x = (cartographicLimitRectangle.west - cartographicTileRectangle.west) * inverseTileWidth;\n            localizedCartographicLimitRectangle.y = (cartographicLimitRectangle.south - cartographicTileRectangle.south) * inverseTileHeight;\n            localizedCartographicLimitRectangle.z = (cartographicLimitRectangle.east - cartographicTileRectangle.west) * inverseTileWidth;\n            localizedCartographicLimitRectangle.w = (cartographicLimitRectangle.north - cartographicTileRectangle.south) * inverseTileHeight;\n\n            Cartesian4.clone(localizedCartographicLimitRectangle, uniformMapProperties.localizedCartographicLimitRectangle);\n\n            // For performance, use fog in the shader only when the tile is in fog.\n            var applyFog = enableFog && CesiumMath.fog(tile._distance, frameState.fog.density) > CesiumMath.EPSILON3;\n            colorCorrect = colorCorrect && (applyFog || showGroundAtmosphere);\n\n            var applyBrightness = false;\n            var applyContrast = false;\n            var applyHue = false;\n            var applySaturation = false;\n            var applyGamma = false;\n            var applyAlpha = false;\n            var applySplit = false;\n            var applyCutout = false;\n            var applyColorToAlpha = false;\n\n            while (numberOfDayTextures < maxTextures && imageryIndex < imageryLen) {\n                var tileImagery = tileImageryCollection[imageryIndex];\n                var imagery = tileImagery.readyImagery;\n                ++imageryIndex;\n\n                if (!defined(imagery) || imagery.imageryLayer.alpha === 0.0) {\n                    continue;\n                }\n\n                var texture = tileImagery.useWebMercatorT ? imagery.textureWebMercator : imagery.texture;\n\n                \n\n                var imageryLayer = imagery.imageryLayer;\n\n                if (!defined(tileImagery.textureTranslationAndScale)) {\n                    tileImagery.textureTranslationAndScale = imageryLayer._calculateTextureTranslationAndScale(tile, tileImagery);\n                }\n\n                uniformMapProperties.dayTextures[numberOfDayTextures] = texture;\n                uniformMapProperties.dayTextureTranslationAndScale[numberOfDayTextures] = tileImagery.textureTranslationAndScale;\n                uniformMapProperties.dayTextureTexCoordsRectangle[numberOfDayTextures] = tileImagery.textureCoordinateRectangle;\n                uniformMapProperties.dayTextureUseWebMercatorT[numberOfDayTextures] = tileImagery.useWebMercatorT;\n\n                uniformMapProperties.dayTextureAlpha[numberOfDayTextures] = imageryLayer.alpha;\n                applyAlpha = applyAlpha || uniformMapProperties.dayTextureAlpha[numberOfDayTextures] !== 1.0;\n\n                uniformMapProperties.dayTextureBrightness[numberOfDayTextures] = imageryLayer.brightness;\n                applyBrightness = applyBrightness || uniformMapProperties.dayTextureBrightness[numberOfDayTextures] !== ImageryLayer.DEFAULT_BRIGHTNESS;\n\n                uniformMapProperties.dayTextureContrast[numberOfDayTextures] = imageryLayer.contrast;\n                applyContrast = applyContrast || uniformMapProperties.dayTextureContrast[numberOfDayTextures] !== ImageryLayer.DEFAULT_CONTRAST;\n\n                uniformMapProperties.dayTextureHue[numberOfDayTextures] = imageryLayer.hue;\n                applyHue = applyHue || uniformMapProperties.dayTextureHue[numberOfDayTextures] !== ImageryLayer.DEFAULT_HUE;\n\n                uniformMapProperties.dayTextureSaturation[numberOfDayTextures] = imageryLayer.saturation;\n                applySaturation = applySaturation || uniformMapProperties.dayTextureSaturation[numberOfDayTextures] !== ImageryLayer.DEFAULT_SATURATION;\n\n                uniformMapProperties.dayTextureOneOverGamma[numberOfDayTextures] = 1.0 / imageryLayer.gamma;\n                applyGamma = applyGamma || uniformMapProperties.dayTextureOneOverGamma[numberOfDayTextures] !== 1.0 / ImageryLayer.DEFAULT_GAMMA;\n\n                uniformMapProperties.dayTextureSplit[numberOfDayTextures] = imageryLayer.splitDirection;\n                applySplit = applySplit || uniformMapProperties.dayTextureSplit[numberOfDayTextures] !== 0.0;\n\n                // Update cutout rectangle\n                var dayTextureCutoutRectangle = uniformMapProperties.dayTextureCutoutRectangles[numberOfDayTextures];\n                if (!defined(dayTextureCutoutRectangle)) {\n                    dayTextureCutoutRectangle = uniformMapProperties.dayTextureCutoutRectangles[numberOfDayTextures] = new Cartesian4();\n                }\n\n                Cartesian4.clone(Cartesian4.ZERO, dayTextureCutoutRectangle);\n                if (defined(imageryLayer.cutoutRectangle)) {\n                    var cutoutRectangle = clipRectangleAntimeridian(cartographicTileRectangle, imageryLayer.cutoutRectangle);\n                    var intersection = Rectangle.simpleIntersection(cutoutRectangle, cartographicTileRectangle, rectangleIntersectionScratch);\n                    applyCutout = defined(intersection) || applyCutout;\n\n                    dayTextureCutoutRectangle.x = (cutoutRectangle.west - cartographicTileRectangle.west) * inverseTileWidth;\n                    dayTextureCutoutRectangle.y = (cutoutRectangle.south - cartographicTileRectangle.south) * inverseTileHeight;\n                    dayTextureCutoutRectangle.z = (cutoutRectangle.east - cartographicTileRectangle.west) * inverseTileWidth;\n                    dayTextureCutoutRectangle.w = (cutoutRectangle.north - cartographicTileRectangle.south) * inverseTileHeight;\n                }\n\n                // Update color to alpha\n                var colorToAlpha = uniformMapProperties.colorsToAlpha[numberOfDayTextures];\n                if (!defined(colorToAlpha)) {\n                    colorToAlpha = uniformMapProperties.colorsToAlpha[numberOfDayTextures] = new Cartesian4();\n                }\n\n                var hasColorToAlpha = defined(imageryLayer.colorToAlpha) && imageryLayer.colorToAlphaThreshold > 0.0;\n                applyColorToAlpha = applyColorToAlpha || hasColorToAlpha;\n\n                if (hasColorToAlpha) {\n                    var color = imageryLayer.colorToAlpha;\n                    colorToAlpha.x = color.red;\n                    colorToAlpha.y = color.green;\n                    colorToAlpha.z = color.blue;\n                    colorToAlpha.w = imageryLayer.colorToAlphaThreshold;\n                } else {\n                    colorToAlpha.w = -1.0;\n                }\n\n                if (defined(imagery.credits)) {\n                    var credits = imagery.credits;\n                    for (var creditIndex = 0, creditLength = credits.length; creditIndex < creditLength; ++creditIndex) {\n                        creditDisplay.addCredit(credits[creditIndex]);\n                    }\n                }\n\n                ++numberOfDayTextures;\n            }\n\n            // trim texture array to the used length so we don't end up using old textures\n            // which might get destroyed eventually\n            uniformMapProperties.dayTextures.length = numberOfDayTextures;\n            uniformMapProperties.waterMask = waterMaskTexture;\n            Cartesian4.clone(waterMaskTranslationAndScale, uniformMapProperties.waterMaskTranslationAndScale);\n\n            uniformMapProperties.minMaxHeight.x = encoding.minimumHeight;\n            uniformMapProperties.minMaxHeight.y = encoding.maximumHeight;\n            Matrix4.clone(encoding.matrix, uniformMapProperties.scaleAndBias);\n\n            // update clipping planes\n            var clippingPlanes = tileProvider._clippingPlanes;\n            var clippingPlanesEnabled = defined(clippingPlanes) && clippingPlanes.enabled && tile.isClipped;\n            if (clippingPlanesEnabled) {\n                uniformMapProperties.clippingPlanesEdgeColor = Color.clone(clippingPlanes.edgeColor, uniformMapProperties.clippingPlanesEdgeColor);\n                uniformMapProperties.clippingPlanesEdgeWidth = clippingPlanes.edgeWidth;\n            }\n\n            if (defined(tileProvider.uniformMap)) {\n                uniformMap = combine(uniformMap, tileProvider.uniformMap);\n            }\n\n            surfaceShaderSetOptions.numberOfDayTextures = numberOfDayTextures;\n            surfaceShaderSetOptions.applyBrightness = applyBrightness;\n            surfaceShaderSetOptions.applyContrast = applyContrast;\n            surfaceShaderSetOptions.applyHue = applyHue;\n            surfaceShaderSetOptions.applySaturation = applySaturation;\n            surfaceShaderSetOptions.applyGamma = applyGamma;\n            surfaceShaderSetOptions.applyAlpha = applyAlpha;\n            surfaceShaderSetOptions.applySplit = applySplit;\n            surfaceShaderSetOptions.enableFog = applyFog;\n            surfaceShaderSetOptions.enableClippingPlanes = clippingPlanesEnabled;\n            surfaceShaderSetOptions.clippingPlanes = clippingPlanes;\n            surfaceShaderSetOptions.hasImageryLayerCutout = applyCutout;\n            surfaceShaderSetOptions.colorCorrect = colorCorrect;\n            surfaceShaderSetOptions.highlightFillTile = highlightFillTile;\n            surfaceShaderSetOptions.colorToAlpha = applyColorToAlpha;\n\n            var count = surfaceTile.renderedMesh.indices.length;\n            if (!showSkirts) {\n                count = surfaceTile.renderedMesh.indexCountWithoutSkirts;\n            }\n\n            command.shaderProgram = tileProvider._surfaceShaderSet.getShaderProgram(surfaceShaderSetOptions);\n            command.castShadows = castShadows;\n            command.receiveShadows = receiveShadows;\n            command.renderState = renderState;\n            command.primitiveType = PrimitiveType.TRIANGLES;\n            command.vertexArray = surfaceTile.vertexArray || surfaceTile.fill.vertexArray;\n            command.count = count;\n            command.uniformMap = uniformMap;\n            command.pass = Pass.GLOBE;\n\n            if (tileProvider._debug.wireframe) {\n                createWireframeVertexArrayIfNecessary(context, tileProvider, tile);\n                if (defined(surfaceTile.wireframeVertexArray)) {\n                    command.vertexArray = surfaceTile.wireframeVertexArray;\n                    command.primitiveType = PrimitiveType.LINES;\n                    command.count = count * 2;\n                }\n            }\n\n            var boundingVolume = command.boundingVolume;\n            var orientedBoundingBox = command.orientedBoundingBox;\n\n            if (frameState.mode !== SceneMode.SCENE3D) {\n                var tileBoundingRegion = surfaceTile.tileBoundingRegion;\n                BoundingSphere.fromRectangleWithHeights2D(tile.rectangle, frameState.mapProjection, tileBoundingRegion.minimumHeight, tileBoundingRegion.maximumHeight, boundingVolume);\n                Cartesian3.fromElements(boundingVolume.center.z, boundingVolume.center.x, boundingVolume.center.y, boundingVolume.center);\n\n                if (frameState.mode === SceneMode.MORPHING) {\n                    boundingVolume = BoundingSphere.union(mesh.boundingSphere3D, boundingVolume, boundingVolume);\n                }\n            } else {\n                command.boundingVolume = BoundingSphere.clone(mesh.boundingSphere3D, boundingVolume);\n                command.orientedBoundingBox = OrientedBoundingBox.clone(surfaceTile.orientedBoundingBox, orientedBoundingBox);\n            }\n\n            command.dirty = true;\n            frameState.commandList.push(command);\n\n            renderState = otherPassesRenderState;\n            initialColor = otherPassesInitialColor;\n        } while (imageryIndex < imageryLen);\n    }\nexport default GlobeSurfaceTileProvider;\n","import defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport Event from '../Core/Event.js';\nimport CesiumMath from '../Core/Math.js';\nimport Rectangle from '../Core/Rectangle.js';\nimport when from '../ThirdParty/when.js';\nimport ImageryLayer from './ImageryLayer.js';\n\n    /**\n     * An ordered collection of imagery layers.\n     *\n     * @alias ImageryLayerCollection\n     * @constructor\n     *\n     * @demo {@link https://sandcastle.cesium.com/index.html?src=Imagery%20Adjustment.html|Cesium Sandcastle Imagery Adjustment Demo}\n     * @demo {@link https://sandcastle.cesium.com/index.html?src=Imagery%20Layers%20Manipulation.html|Cesium Sandcastle Imagery Manipulation Demo}\n     */\n    function ImageryLayerCollection() {\n        this._layers = [];\n\n        /**\n         * An event that is raised when a layer is added to the collection.  Event handlers are passed the layer that\n         * was added and the index at which it was added.\n         * @type {Event}\n         * @default Event()\n         */\n        this.layerAdded = new Event();\n\n        /**\n         * An event that is raised when a layer is removed from the collection.  Event handlers are passed the layer that\n         * was removed and the index from which it was removed.\n         * @type {Event}\n         * @default Event()\n         */\n        this.layerRemoved = new Event();\n\n        /**\n         * An event that is raised when a layer changes position in the collection.  Event handlers are passed the layer that\n         * was moved, its new index after the move, and its old index prior to the move.\n         * @type {Event}\n         * @default Event()\n         */\n        this.layerMoved = new Event();\n\n        /**\n         * An event that is raised when a layer is shown or hidden by setting the\n         * {@link ImageryLayer#show} property.  Event handlers are passed a reference to this layer,\n         * the index of the layer in the collection, and a flag that is true if the layer is now\n         * shown or false if it is now hidden.\n         *\n         * @type {Event}\n         * @default Event()\n         */\n        this.layerShownOrHidden = new Event();\n    }\n\n    Object.defineProperties(ImageryLayerCollection.prototype, {\n        /**\n         * Gets the number of layers in this collection.\n         * @memberof ImageryLayerCollection.prototype\n         * @type {Number}\n         */\n        length : {\n            get : function() {\n                return this._layers.length;\n            }\n        }\n    });\n\n    /**\n     * Adds a layer to the collection.\n     *\n     * @param {ImageryLayer} layer the layer to add.\n     * @param {Number} [index] the index to add the layer at.  If omitted, the layer will\n     *                         added on top of all existing layers.\n     *\n     * @exception {DeveloperError} index, if supplied, must be greater than or equal to zero and less than or equal to the number of the layers.\n     */\n    ImageryLayerCollection.prototype.add = function(layer, index) {\n        var hasIndex = defined(index);\n\n        \n\n        if (!hasIndex) {\n            index = this._layers.length;\n            this._layers.push(layer);\n        } else {\n            this._layers.splice(index, 0, layer);\n        }\n\n        this._update();\n        this.layerAdded.raiseEvent(layer, index);\n    };\n\n    /**\n     * Creates a new layer using the given ImageryProvider and adds it to the collection.\n     *\n     * @param {ImageryProvider} imageryProvider the imagery provider to create a new layer for.\n     * @param {Number} [index] the index to add the layer at.  If omitted, the layer will\n     *                         added on top of all existing layers.\n     * @returns {ImageryLayer} The newly created layer.\n     */\n    ImageryLayerCollection.prototype.addImageryProvider = function(imageryProvider, index) {\n        \n\n        var layer = new ImageryLayer(imageryProvider);\n        this.add(layer, index);\n        return layer;\n    };\n\n    /**\n     * Removes a layer from this collection, if present.\n     *\n     * @param {ImageryLayer} layer The layer to remove.\n     * @param {Boolean} [destroy=true] whether to destroy the layers in addition to removing them.\n     * @returns {Boolean} true if the layer was in the collection and was removed,\n     *                    false if the layer was not in the collection.\n     */\n    ImageryLayerCollection.prototype.remove = function(layer, destroy) {\n        destroy = defaultValue(destroy, true);\n\n        var index = this._layers.indexOf(layer);\n        if (index !== -1) {\n            this._layers.splice(index, 1);\n\n            this._update();\n\n            this.layerRemoved.raiseEvent(layer, index);\n\n            if (destroy) {\n                layer.destroy();\n            }\n\n            return true;\n        }\n\n        return false;\n    };\n\n    /**\n     * Removes all layers from this collection.\n     *\n     * @param {Boolean} [destroy=true] whether to destroy the layers in addition to removing them.\n     */\n    ImageryLayerCollection.prototype.removeAll = function(destroy) {\n        destroy = defaultValue(destroy, true);\n\n        var layers = this._layers;\n        for (var i = 0, len = layers.length; i < len; i++) {\n            var layer = layers[i];\n            this.layerRemoved.raiseEvent(layer, i);\n\n            if (destroy) {\n                layer.destroy();\n            }\n        }\n\n        this._layers = [];\n    };\n\n    /**\n     * Checks to see if the collection contains a given layer.\n     *\n     * @param {ImageryLayer} layer the layer to check for.\n     *\n     * @returns {Boolean} true if the collection contains the layer, false otherwise.\n     */\n    ImageryLayerCollection.prototype.contains = function(layer) {\n        return this.indexOf(layer) !== -1;\n    };\n\n    /**\n     * Determines the index of a given layer in the collection.\n     *\n     * @param {ImageryLayer} layer The layer to find the index of.\n     *\n     * @returns {Number} The index of the layer in the collection, or -1 if the layer does not exist in the collection.\n     */\n    ImageryLayerCollection.prototype.indexOf = function(layer) {\n        return this._layers.indexOf(layer);\n    };\n\n    /**\n     * Gets a layer by index from the collection.\n     *\n     * @param {Number} index the index to retrieve.\n     *\n     * @returns {ImageryLayer} The imagery layer at the given index.\n     */\n    ImageryLayerCollection.prototype.get = function(index) {\n        \n\n        return this._layers[index];\n    };\n\n    function getLayerIndex(layers, layer) {\n        \n\n        var index = layers.indexOf(layer);\n\n        \n\n        return index;\n    }\n\n    function swapLayers(collection, i, j) {\n        var arr = collection._layers;\n        i = CesiumMath.clamp(i, 0, arr.length - 1);\n        j = CesiumMath.clamp(j, 0, arr.length - 1);\n\n        if (i === j) {\n            return;\n        }\n\n        var temp = arr[i];\n        arr[i] = arr[j];\n        arr[j] = temp;\n\n        collection._update();\n\n        collection.layerMoved.raiseEvent(temp, j, i);\n    }\n\n    /**\n     * Raises a layer up one position in the collection.\n     *\n     * @param {ImageryLayer} layer the layer to move.\n     *\n     * @exception {DeveloperError} layer is not in this collection.\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     */\n    ImageryLayerCollection.prototype.raise = function(layer) {\n        var index = getLayerIndex(this._layers, layer);\n        swapLayers(this, index, index + 1);\n    };\n\n    /**\n     * Lowers a layer down one position in the collection.\n     *\n     * @param {ImageryLayer} layer the layer to move.\n     *\n     * @exception {DeveloperError} layer is not in this collection.\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     */\n    ImageryLayerCollection.prototype.lower = function(layer) {\n        var index = getLayerIndex(this._layers, layer);\n        swapLayers(this, index, index - 1);\n    };\n\n    /**\n     * Raises a layer to the top of the collection.\n     *\n     * @param {ImageryLayer} layer the layer to move.\n     *\n     * @exception {DeveloperError} layer is not in this collection.\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     */\n    ImageryLayerCollection.prototype.raiseToTop = function(layer) {\n        var index = getLayerIndex(this._layers, layer);\n        if (index === this._layers.length - 1) {\n            return;\n        }\n        this._layers.splice(index, 1);\n        this._layers.push(layer);\n\n        this._update();\n\n        this.layerMoved.raiseEvent(layer, this._layers.length - 1, index);\n    };\n\n    /**\n     * Lowers a layer to the bottom of the collection.\n     *\n     * @param {ImageryLayer} layer the layer to move.\n     *\n     * @exception {DeveloperError} layer is not in this collection.\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     */\n    ImageryLayerCollection.prototype.lowerToBottom = function(layer) {\n        var index = getLayerIndex(this._layers, layer);\n        if (index === 0) {\n            return;\n        }\n        this._layers.splice(index, 1);\n        this._layers.splice(0, 0, layer);\n\n        this._update();\n\n        this.layerMoved.raiseEvent(layer, 0, index);\n    };\n\n    var applicableRectangleScratch = new Rectangle();\n\n    /**\n     * Asynchronously determines the imagery layer features that are intersected by a pick ray.  The intersected imagery\n     * layer features are found by invoking {@link ImageryProvider#pickFeatures} for each imagery layer tile intersected\n     * by the pick ray.  To compute a pick ray from a location on the screen, use {@link Camera.getPickRay}.\n     *\n     * @param {Ray} ray The ray to test for intersection.\n     * @param {Scene} scene The scene.\n     * @return {Promise.<ImageryLayerFeatureInfo[]>|undefined} A promise that resolves to an array of features intersected by the pick ray.\n     *                                             If it can be quickly determined that no features are intersected (for example,\n     *                                             because no active imagery providers support {@link ImageryProvider#pickFeatures}\n     *                                             or because the pick ray does not intersect the surface), this function will\n     *                                             return undefined.\n     *\n     * @example\n     * var pickRay = viewer.camera.getPickRay(windowPosition);\n     * var featuresPromise = viewer.imageryLayers.pickImageryLayerFeatures(pickRay, viewer.scene);\n     * if (!Cesium.defined(featuresPromise)) {\n     *     console.log('No features picked.');\n     * } else {\n     *     Cesium.when(featuresPromise, function(features) {\n     *         // This function is called asynchronously when the list if picked features is available.\n     *         console.log('Number of features: ' + features.length);\n     *         if (features.length > 0) {\n     *             console.log('First feature name: ' + features[0].name);\n     *         }\n     *     });\n     * }\n     */\n    ImageryLayerCollection.prototype.pickImageryLayerFeatures = function(ray, scene) {\n        // Find the picked location on the globe.\n        var pickedPosition = scene.globe.pick(ray, scene);\n        if (!defined(pickedPosition)) {\n            return undefined;\n        }\n\n        var pickedLocation = scene.globe.ellipsoid.cartesianToCartographic(pickedPosition);\n\n        // Find the terrain tile containing the picked location.\n        var tilesToRender = scene.globe._surface._tilesToRender;\n        var pickedTile;\n\n        for (var textureIndex = 0; !defined(pickedTile) && textureIndex < tilesToRender.length; ++textureIndex) {\n            var tile = tilesToRender[textureIndex];\n            if (Rectangle.contains(tile.rectangle, pickedLocation)) {\n                pickedTile = tile;\n            }\n        }\n\n        if (!defined(pickedTile)) {\n            return undefined;\n        }\n\n        // Pick against all attached imagery tiles containing the pickedLocation.\n        var imageryTiles = pickedTile.data.imagery;\n\n        var promises = [];\n        var imageryLayers = [];\n        for (var i = imageryTiles.length - 1; i >= 0; --i) {\n            var terrainImagery = imageryTiles[i];\n            var imagery = terrainImagery.readyImagery;\n            if (!defined(imagery)) {\n                continue;\n            }\n            var provider = imagery.imageryLayer.imageryProvider;\n            if (!defined(provider.pickFeatures)) {\n                continue;\n            }\n\n            if (!Rectangle.contains(imagery.rectangle, pickedLocation)) {\n                continue;\n            }\n\n            // If this imagery came from a parent, it may not be applicable to its entire rectangle.\n            // Check the textureCoordinateRectangle.\n            var applicableRectangle = applicableRectangleScratch;\n\n            var epsilon = 1 / 1024; // 1/4 of a pixel in a typical 256x256 tile.\n            applicableRectangle.west = CesiumMath.lerp(pickedTile.rectangle.west, pickedTile.rectangle.east, terrainImagery.textureCoordinateRectangle.x - epsilon);\n            applicableRectangle.east = CesiumMath.lerp(pickedTile.rectangle.west, pickedTile.rectangle.east, terrainImagery.textureCoordinateRectangle.z + epsilon);\n            applicableRectangle.south = CesiumMath.lerp(pickedTile.rectangle.south, pickedTile.rectangle.north, terrainImagery.textureCoordinateRectangle.y - epsilon);\n            applicableRectangle.north = CesiumMath.lerp(pickedTile.rectangle.south, pickedTile.rectangle.north, terrainImagery.textureCoordinateRectangle.w + epsilon);\n            if (!Rectangle.contains(applicableRectangle, pickedLocation)) {\n                continue;\n            }\n\n            var promise = provider.pickFeatures(imagery.x, imagery.y, imagery.level, pickedLocation.longitude, pickedLocation.latitude);\n            if (!defined(promise)) {\n                continue;\n            }\n\n            promises.push(promise);\n            imageryLayers.push(imagery.imageryLayer);\n        }\n\n        if (promises.length === 0) {\n            return undefined;\n        }\n\n        return when.all(promises, function(results) {\n            var features = [];\n\n            for (var resultIndex = 0; resultIndex < results.length; ++resultIndex) {\n                var result = results[resultIndex];\n                var image = imageryLayers[resultIndex];\n\n                if (defined(result) && result.length > 0) {\n                    for (var featureIndex = 0; featureIndex < result.length; ++featureIndex) {\n                        var feature = result[featureIndex];\n                        feature.imageryLayer = image;\n\n                        // For features without a position, use the picked location.\n                        if (!defined(feature.position)) {\n                            feature.position = pickedLocation;\n                        }\n\n                        features.push(feature);\n                    }\n                }\n            }\n\n            return features;\n        });\n    };\n\n    /**\n     * Updates frame state to execute any queued texture re-projections.\n     *\n     * @private\n     *\n     * @param {FrameState} frameState The frameState.\n     */\n    ImageryLayerCollection.prototype.queueReprojectionCommands = function(frameState) {\n        var layers = this._layers;\n        for (var i = 0, len = layers.length; i < len; ++i) {\n            layers[i].queueReprojectionCommands(frameState);\n        }\n    };\n\n    /**\n     * Cancels re-projection commands queued for the next frame.\n     *\n     * @private\n     */\n    ImageryLayerCollection.prototype.cancelReprojections = function() {\n        var layers = this._layers;\n        for (var i = 0, len = layers.length; i < len; ++i) {\n            layers[i].cancelReprojections();\n        }\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <br /><br />\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     *\n     * @returns {Boolean} true if this object was destroyed; otherwise, false.\n     *\n     * @see ImageryLayerCollection#destroy\n     */\n    ImageryLayerCollection.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the WebGL resources held by all layers in this collection.  Explicitly destroying this\n     * object allows for deterministic release of WebGL resources, instead of relying on the garbage\n     * collector.\n     * <br /><br />\n     * Once this object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     *\n     * @example\n     * layerCollection = layerCollection && layerCollection.destroy();\n     *\n     * @see ImageryLayerCollection#isDestroyed\n     */\n    ImageryLayerCollection.prototype.destroy = function() {\n        this.removeAll(true);\n        return destroyObject(this);\n    };\n\n    ImageryLayerCollection.prototype._update = function() {\n        var isBaseLayer = true;\n        var layers = this._layers;\n        var layersShownOrHidden;\n        var layer;\n        var i, len;\n        for (i = 0, len = layers.length; i < len; ++i) {\n            layer = layers[i];\n\n            layer._layerIndex = i;\n\n            if (layer.show) {\n                layer._isBaseLayer = isBaseLayer;\n                isBaseLayer = false;\n            } else {\n                layer._isBaseLayer = false;\n            }\n\n            if (layer.show !== layer._show) {\n                if (defined(layer._show)) {\n                    if (!defined(layersShownOrHidden)) {\n                        layersShownOrHidden = [];\n                    }\n                    layersShownOrHidden.push(layer);\n                }\n                layer._show = layer.show;\n            }\n        }\n\n        if (defined(layersShownOrHidden)) {\n            for (i = 0, len = layersShownOrHidden.length; i < len; ++i) {\n                layer = layersShownOrHidden[i];\n                this.layerShownOrHidden.raiseEvent(layer, layer._layerIndex, layer.show);\n            }\n        }\n    };\nexport default ImageryLayerCollection;\n","import Cartesian3 from '../Core/Cartesian3.js';\nimport EllipsoidalOccluder from '../Core/EllipsoidalOccluder.js';\n\n    /**\n     * A set of occluders that can be used to test quadtree tiles for occlusion.\n     *\n     * @alias QuadtreeOccluders\n     * @constructor\n     * @private\n     *\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid that potentially occludes tiles.\n     */\n    function QuadtreeOccluders(options) {\n        this._ellipsoid = new EllipsoidalOccluder(options.ellipsoid, Cartesian3.ZERO);\n    }\n\n    Object.defineProperties(QuadtreeOccluders.prototype, {\n        /**\n         * Gets the {@link EllipsoidalOccluder} that can be used to determine if a point is\n         * occluded by an {@link Ellipsoid}.\n         * @type {EllipsoidalOccluder}\n         * @memberof QuadtreeOccluders.prototype\n         */\n        ellipsoid : {\n            get : function() {\n                return this._ellipsoid;\n            }\n        }\n    });\nexport default QuadtreeOccluders;\n","import defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport Rectangle from '../Core/Rectangle.js';\nimport QuadtreeTileLoadState from './QuadtreeTileLoadState.js';\nimport TileSelectionResult from './TileSelectionResult.js';\n\n    /**\n     * A single tile in a {@link QuadtreePrimitive}.\n     *\n     * @alias QuadtreeTile\n     * @constructor\n     * @private\n     *\n     * @param {Number} options.level The level of the tile in the quadtree.\n     * @param {Number} options.x The X coordinate of the tile in the quadtree.  0 is the westernmost tile.\n     * @param {Number} options.y The Y coordinate of the tile in the quadtree.  0 is the northernmost tile.\n     * @param {TilingScheme} options.tilingScheme The tiling scheme in which this tile exists.\n     * @param {QuadtreeTile} [options.parent] This tile's parent, or undefined if this is a root tile.\n     */\n    function QuadtreeTile(options) {\n        \n\n        this._tilingScheme = options.tilingScheme;\n        this._x = options.x;\n        this._y = options.y;\n        this._level = options.level;\n        this._parent = options.parent;\n        this._rectangle = this._tilingScheme.tileXYToRectangle(this._x, this._y, this._level);\n\n        this._southwestChild = undefined;\n        this._southeastChild = undefined;\n        this._northwestChild = undefined;\n        this._northeastChild = undefined;\n\n        // TileReplacementQueue gets/sets these private properties.\n        this.replacementPrevious = undefined;\n        this.replacementNext = undefined;\n\n        // The distance from the camera to this tile, updated when the tile is selected\n        // for rendering.  We can get rid of this if we have a better way to sort by\n        // distance - for example, by using the natural ordering of a quadtree.\n        // QuadtreePrimitive gets/sets this private property.\n        this._distance = 0.0;\n        this._loadPriority = 0.0;\n\n        this._customData = [];\n        this._frameUpdated = undefined;\n        this._lastSelectionResult = TileSelectionResult.NONE;\n        this._lastSelectionResultFrame = undefined;\n        this._loadedCallbacks = {};\n\n        /**\n         * Gets or sets the current state of the tile in the tile load pipeline.\n         * @type {QuadtreeTileLoadState}\n         * @default {@link QuadtreeTileLoadState.START}\n         */\n        this.state = QuadtreeTileLoadState.START;\n\n        /**\n         * Gets or sets a value indicating whether or not the tile is currently renderable.\n         * @type {Boolean}\n         * @default false\n         */\n        this.renderable = false;\n\n        /**\n         * Gets or set a value indicating whether or not the tile was entirely upsampled from its\n         * parent tile.  If all four children of a parent tile were upsampled from the parent,\n         * we will render the parent instead of the children even if the LOD indicates that\n         * the children would be preferable.\n         * @type {Boolean}\n         * @default false\n         */\n        this.upsampledFromParent = false;\n\n        /**\n         * Gets or sets the additional data associated with this tile.  The exact content is specific to the\n         * {@link QuadtreeTileProvider}.\n         * @type {Object}\n         * @default undefined\n         */\n        this.data = undefined;\n    }\n\n    /**\n     * Creates a rectangular set of tiles for level of detail zero, the coarsest, least detailed level.\n     *\n     * @memberof QuadtreeTile\n     *\n     * @param {TilingScheme} tilingScheme The tiling scheme for which the tiles are to be created.\n     * @returns {QuadtreeTile[]} An array containing the tiles at level of detail zero, starting with the\n     * tile in the northwest corner and followed by the tile (if any) to its east.\n     */\n    QuadtreeTile.createLevelZeroTiles = function(tilingScheme) {\n        \n\n        var numberOfLevelZeroTilesX = tilingScheme.getNumberOfXTilesAtLevel(0);\n        var numberOfLevelZeroTilesY = tilingScheme.getNumberOfYTilesAtLevel(0);\n\n        var result = new Array(numberOfLevelZeroTilesX * numberOfLevelZeroTilesY);\n\n        var index = 0;\n        for (var y = 0; y < numberOfLevelZeroTilesY; ++y) {\n            for (var x = 0; x < numberOfLevelZeroTilesX; ++x) {\n                result[index++] = new QuadtreeTile({\n                    tilingScheme : tilingScheme,\n                    x : x,\n                    y : y,\n                    level : 0\n                });\n            }\n        }\n\n        return result;\n    };\n\n    QuadtreeTile.prototype._updateCustomData = function(frameNumber, added, removed) {\n        var customData = this.customData;\n\n        var i;\n        var data;\n        var rectangle;\n\n        if (defined(added) && defined(removed)) {\n            customData = customData.filter(function(value) {\n                return removed.indexOf(value) === -1;\n            });\n            this._customData = customData;\n\n            rectangle = this._rectangle;\n            for (i = 0; i < added.length; ++i) {\n                data = added[i];\n                if (Rectangle.contains(rectangle, data.positionCartographic)) {\n                    customData.push(data);\n                }\n            }\n\n            this._frameUpdated = frameNumber;\n        } else {\n            // interior or leaf tile, update from parent\n            var parent = this._parent;\n            if (defined(parent) && this._frameUpdated !== parent._frameUpdated) {\n                customData.length = 0;\n\n                rectangle = this._rectangle;\n                var parentCustomData = parent.customData;\n                for (i = 0; i < parentCustomData.length; ++i) {\n                    data = parentCustomData[i];\n                    if (Rectangle.contains(rectangle, data.positionCartographic)) {\n                        customData.push(data);\n                    }\n                }\n\n                this._frameUpdated = parent._frameUpdated;\n            }\n        }\n    };\n\n    Object.defineProperties(QuadtreeTile.prototype, {\n        /**\n         * Gets the tiling scheme used to tile the surface.\n         * @memberof QuadtreeTile.prototype\n         * @type {TilingScheme}\n         */\n        tilingScheme : {\n            get : function() {\n                return this._tilingScheme;\n            }\n        },\n\n        /**\n         * Gets the tile X coordinate.\n         * @memberof QuadtreeTile.prototype\n         * @type {Number}\n         */\n        x : {\n            get : function() {\n                return this._x;\n            }\n        },\n\n        /**\n         * Gets the tile Y coordinate.\n         * @memberof QuadtreeTile.prototype\n         * @type {Number}\n         */\n        y : {\n            get : function() {\n                return this._y;\n            }\n        },\n\n        /**\n         * Gets the level-of-detail, where zero is the coarsest, least-detailed.\n         * @memberof QuadtreeTile.prototype\n         * @type {Number}\n         */\n        level : {\n            get : function() {\n                return this._level;\n            }\n        },\n\n        /**\n         * Gets the parent tile of this tile.\n         * @memberof QuadtreeTile.prototype\n         * @type {QuadtreeTile}\n         */\n        parent : {\n            get : function() {\n                return this._parent;\n            }\n        },\n\n        /**\n         * Gets the cartographic rectangle of the tile, with north, south, east and\n         * west properties in radians.\n         * @memberof QuadtreeTile.prototype\n         * @type {Rectangle}\n         */\n        rectangle : {\n            get : function() {\n                return this._rectangle;\n            }\n        },\n\n        /**\n         * An array of tiles that is at the next level of the tile tree.\n         * @memberof QuadtreeTile.prototype\n         * @type {QuadtreeTile[]}\n         */\n        children : {\n            get : function() {\n                return [this.northwestChild, this.northeastChild, this.southwestChild, this.southeastChild];\n            }\n        },\n\n        /**\n         * Gets the southwest child tile.\n         * @memberof QuadtreeTile.prototype\n         * @type {QuadtreeTile}\n         */\n        southwestChild : {\n            get : function() {\n                if (!defined(this._southwestChild)) {\n                    this._southwestChild = new QuadtreeTile({\n                        tilingScheme : this.tilingScheme,\n                        x : this.x * 2,\n                        y : this.y * 2 + 1,\n                        level : this.level + 1,\n                        parent : this\n                    });\n                }\n                return this._southwestChild;\n            }\n        },\n\n        /**\n         * Gets the southeast child tile.\n         * @memberof QuadtreeTile.prototype\n         * @type {QuadtreeTile}\n         */\n        southeastChild : {\n            get : function() {\n                if (!defined(this._southeastChild)) {\n                    this._southeastChild = new QuadtreeTile({\n                        tilingScheme : this.tilingScheme,\n                        x : this.x * 2 + 1,\n                        y : this.y * 2 + 1,\n                        level : this.level + 1,\n                        parent : this\n                    });\n                }\n                return this._southeastChild;\n            }\n        },\n\n        /**\n         * Gets the northwest child tile.\n         * @memberof QuadtreeTile.prototype\n         * @type {QuadtreeTile}\n         */\n        northwestChild : {\n            get : function() {\n                if (!defined(this._northwestChild)) {\n                    this._northwestChild = new QuadtreeTile({\n                        tilingScheme : this.tilingScheme,\n                        x : this.x * 2,\n                        y : this.y * 2,\n                        level : this.level + 1,\n                        parent : this\n                    });\n                }\n                return this._northwestChild;\n            }\n        },\n\n        /**\n         * Gets the northeast child tile.\n         * @memberof QuadtreeTile.prototype\n         * @type {QuadtreeTile}\n         */\n        northeastChild : {\n            get : function() {\n                if (!defined(this._northeastChild)) {\n                    this._northeastChild = new QuadtreeTile({\n                        tilingScheme : this.tilingScheme,\n                        x : this.x * 2 + 1,\n                        y : this.y * 2,\n                        level : this.level + 1,\n                        parent : this\n                    });\n                }\n                return this._northeastChild;\n            }\n        },\n\n        /**\n         * An array of objects associated with this tile.\n         * @memberof QuadtreeTile.prototype\n         * @type {Array}\n         */\n        customData : {\n            get : function() {\n                return this._customData;\n            }\n        },\n\n        /**\n         * Gets a value indicating whether or not this tile needs further loading.\n         * This property will return true if the {@link QuadtreeTile#state} is\n         * <code>START</code> or <code>LOADING</code>.\n         * @memberof QuadtreeTile.prototype\n         * @type {Boolean}\n         */\n        needsLoading : {\n            get : function() {\n                return this.state < QuadtreeTileLoadState.DONE;\n            }\n        },\n\n        /**\n         * Gets a value indicating whether or not this tile is eligible to be unloaded.\n         * Typically, a tile is ineligible to be unloaded while an asynchronous operation,\n         * such as a request for data, is in progress on it.  A tile will never be\n         * unloaded while it is needed for rendering, regardless of the value of this\n         * property.  If {@link QuadtreeTile#data} is defined and has an\n         * <code>eligibleForUnloading</code> property, the value of that property is returned.\n         * Otherwise, this property returns true.\n         * @memberof QuadtreeTile.prototype\n         * @type {Boolean}\n         */\n        eligibleForUnloading : {\n            get : function() {\n                var result = true;\n\n                if (defined(this.data)) {\n                    result = this.data.eligibleForUnloading;\n                    if (!defined(result)) {\n                        result = true;\n                    }\n                }\n\n                return result;\n            }\n        }\n    });\n\n    QuadtreeTile.prototype.findLevelZeroTile = function(levelZeroTiles, x, y) {\n        var xTiles = this.tilingScheme.getNumberOfXTilesAtLevel(0);\n        if (x < 0) {\n            x += xTiles;\n        } else if (x >= xTiles) {\n            x -= xTiles;\n        }\n\n        if (y < 0 || y >= this.tilingScheme.getNumberOfYTilesAtLevel(0)) {\n            return undefined;\n        }\n\n        return levelZeroTiles.filter(function(tile) {\n            return tile.x === x && tile.y === y;\n        })[0];\n    };\n\n    QuadtreeTile.prototype.findTileToWest = function(levelZeroTiles) {\n        var parent = this.parent;\n        if (parent === undefined) {\n            return this.findLevelZeroTile(levelZeroTiles, this.x - 1, this.y);\n        }\n\n        if (parent.southeastChild === this) {\n            return parent.southwestChild;\n        } else if (parent.northeastChild === this) {\n            return parent.northwestChild;\n        }\n\n        var westOfParent = parent.findTileToWest(levelZeroTiles);\n        if (westOfParent === undefined) {\n            return undefined;\n        } else if (parent.southwestChild === this) {\n            return westOfParent.southeastChild;\n        }\n        return westOfParent.northeastChild;\n    };\n\n    QuadtreeTile.prototype.findTileToEast = function(levelZeroTiles) {\n        var parent = this.parent;\n        if (parent === undefined) {\n            return this.findLevelZeroTile(levelZeroTiles, this.x + 1, this.y);\n        }\n\n        if (parent.southwestChild === this) {\n            return parent.southeastChild;\n        } else if (parent.northwestChild === this) {\n            return parent.northeastChild;\n        }\n\n        var eastOfParent = parent.findTileToEast(levelZeroTiles);\n        if (eastOfParent === undefined) {\n            return undefined;\n        } else if (parent.southeastChild === this) {\n            return eastOfParent.southwestChild;\n        }\n        return eastOfParent.northwestChild;\n    };\n\n    QuadtreeTile.prototype.findTileToSouth = function(levelZeroTiles) {\n        var parent = this.parent;\n        if (parent === undefined) {\n            return this.findLevelZeroTile(levelZeroTiles, this.x, this.y + 1);\n        }\n\n        if (parent.northwestChild === this) {\n            return parent.southwestChild;\n        } else if (parent.northeastChild === this) {\n            return parent.southeastChild;\n        }\n\n        var southOfParent = parent.findTileToSouth(levelZeroTiles);\n        if (southOfParent === undefined) {\n            return undefined;\n        } else if (parent.southwestChild === this) {\n            return southOfParent.northwestChild;\n        }\n        return southOfParent.northeastChild;\n    };\n\n    QuadtreeTile.prototype.findTileToNorth = function(levelZeroTiles) {\n        var parent = this.parent;\n        if (parent === undefined) {\n            return this.findLevelZeroTile(levelZeroTiles, this.x, this.y - 1);\n        }\n\n        if (parent.southwestChild === this) {\n            return parent.northwestChild;\n        } else if (parent.southeastChild === this) {\n            return parent.northeastChild;\n        }\n\n        var northOfParent = parent.findTileToNorth(levelZeroTiles);\n        if (northOfParent === undefined) {\n            return undefined;\n        } else if (parent.northwestChild === this) {\n            return northOfParent.southwestChild;\n        }\n        return northOfParent.southeastChild;\n    };\n\n    /**\n     * Frees the resources associated with this tile and returns it to the <code>START</code>\n     * {@link QuadtreeTileLoadState}.  If the {@link QuadtreeTile#data} property is defined and it\n     * has a <code>freeResources</code> method, the method will be invoked.\n     *\n     * @memberof QuadtreeTile\n     */\n    QuadtreeTile.prototype.freeResources = function() {\n        this.state = QuadtreeTileLoadState.START;\n        this.renderable = false;\n        this.upsampledFromParent = false;\n\n        if (defined(this.data) && defined(this.data.freeResources)) {\n            this.data.freeResources();\n        }\n\n        freeTile(this._southwestChild);\n        this._southwestChild = undefined;\n        freeTile(this._southeastChild);\n        this._southeastChild = undefined;\n        freeTile(this._northwestChild);\n        this._northwestChild = undefined;\n        freeTile(this._northeastChild);\n        this._northeastChild = undefined;\n    };\n\n    function freeTile(tile) {\n        if (defined(tile)) {\n            tile.freeResources();\n        }\n    }\nexport default QuadtreeTile;\n","import defined from '../Core/defined.js';\n\n    /**\n     * A priority queue of tiles to be replaced, if necessary, to make room for new tiles.  The queue\n     * is implemented as a linked list.\n     *\n     * @alias TileReplacementQueue\n     * @private\n     */\n    function TileReplacementQueue() {\n        this.head = undefined;\n        this.tail = undefined;\n        this.count = 0;\n        this._lastBeforeStartOfFrame = undefined;\n    }\n\n    /**\n     * Marks the start of the render frame.  Tiles before (closer to the head) this tile in the\n     * list were used last frame and must not be unloaded.\n     */\n    TileReplacementQueue.prototype.markStartOfRenderFrame = function() {\n        this._lastBeforeStartOfFrame = this.head;\n    };\n\n    /**\n     * Reduces the size of the queue to a specified size by unloading the least-recently used\n     * tiles.  Tiles that were used last frame will not be unloaded, even if that puts the number\n     * of tiles above the specified maximum.\n     *\n     * @param {Number} maximumTiles The maximum number of tiles in the queue.\n     */\n    TileReplacementQueue.prototype.trimTiles = function(maximumTiles) {\n        var tileToTrim = this.tail;\n        var keepTrimming = true;\n        while (keepTrimming &&\n               defined(this._lastBeforeStartOfFrame) &&\n               this.count > maximumTiles &&\n               defined(tileToTrim)) {\n            // Stop trimming after we process the last tile not used in the\n            // current frame.\n            keepTrimming = tileToTrim !== this._lastBeforeStartOfFrame;\n\n            var previous = tileToTrim.replacementPrevious;\n\n            if (tileToTrim.eligibleForUnloading) {\n                tileToTrim.freeResources();\n                remove(this, tileToTrim);\n            }\n\n            tileToTrim = previous;\n        }\n    };\n\n    function remove(tileReplacementQueue, item) {\n        var previous = item.replacementPrevious;\n        var next = item.replacementNext;\n\n        if (item === tileReplacementQueue._lastBeforeStartOfFrame) {\n            tileReplacementQueue._lastBeforeStartOfFrame = next;\n        }\n\n        if (item === tileReplacementQueue.head) {\n            tileReplacementQueue.head = next;\n        } else {\n            previous.replacementNext = next;\n        }\n\n        if (item === tileReplacementQueue.tail) {\n            tileReplacementQueue.tail = previous;\n        } else {\n            next.replacementPrevious = previous;\n        }\n\n        item.replacementPrevious = undefined;\n        item.replacementNext = undefined;\n\n        --tileReplacementQueue.count;\n    }\n\n    /**\n     * Marks a tile as rendered this frame and moves it before the first tile that was not rendered\n     * this frame.\n     *\n     * @param {TileReplacementQueue} item The tile that was rendered.\n     */\n    TileReplacementQueue.prototype.markTileRendered = function(item) {\n        var head = this.head;\n        if (head === item) {\n            if (item === this._lastBeforeStartOfFrame) {\n                this._lastBeforeStartOfFrame = item.replacementNext;\n            }\n            return;\n        }\n\n        ++this.count;\n\n        if (!defined(head)) {\n            // no other tiles in the list\n            item.replacementPrevious = undefined;\n            item.replacementNext = undefined;\n            this.head = item;\n            this.tail = item;\n            return;\n        }\n\n        if (defined(item.replacementPrevious) || defined(item.replacementNext)) {\n            // tile already in the list, remove from its current location\n            remove(this, item);\n        }\n\n        item.replacementPrevious = undefined;\n        item.replacementNext = head;\n        head.replacementPrevious = item;\n\n        this.head = item;\n    };\nexport default TileReplacementQueue;\n","import Cartesian3 from '../Core/Cartesian3.js';\nimport Cartographic from '../Core/Cartographic.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport Event from '../Core/Event.js';\nimport getTimestamp from '../Core/getTimestamp.js';\nimport CesiumMath from '../Core/Math.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport OrthographicFrustum from '../Core/OrthographicFrustum.js';\nimport OrthographicOffCenterFrustum from '../Core/OrthographicOffCenterFrustum.js';\nimport Ray from '../Core/Ray.js';\nimport Rectangle from '../Core/Rectangle.js';\nimport Visibility from '../Core/Visibility.js';\nimport QuadtreeOccluders from './QuadtreeOccluders.js';\nimport QuadtreeTile from './QuadtreeTile.js';\nimport QuadtreeTileLoadState from './QuadtreeTileLoadState.js';\nimport SceneMode from './SceneMode.js';\nimport TileReplacementQueue from './TileReplacementQueue.js';\nimport TileSelectionResult from './TileSelectionResult.js';\n\n    /**\n     * Renders massive sets of data by utilizing level-of-detail and culling.  The globe surface is divided into\n     * a quadtree of tiles with large, low-detail tiles at the root and small, high-detail tiles at the leaves.\n     * The set of tiles to render is selected by projecting an estimate of the geometric error in a tile onto\n     * the screen to estimate screen-space error, in pixels, which must be below a user-specified threshold.\n     * The actual content of the tiles is arbitrary and is specified using a {@link QuadtreeTileProvider}.\n     *\n     * @alias QuadtreePrimitive\n     * @constructor\n     * @private\n     *\n     * @param {QuadtreeTileProvider} options.tileProvider The tile provider that loads, renders, and estimates\n     *        the distance to individual tiles.\n     * @param {Number} [options.maximumScreenSpaceError=2] The maximum screen-space error, in pixels, that is allowed.\n     *        A higher maximum error will render fewer tiles and improve performance, while a lower\n     *        value will improve visual quality.\n     * @param {Number} [options.tileCacheSize=100] The maximum number of tiles that will be retained in the tile cache.\n     *        Note that tiles will never be unloaded if they were used for rendering the last\n     *        frame, so the actual number of resident tiles may be higher.  The value of\n     *        this property will not affect visual quality.\n     */\n    function QuadtreePrimitive(options) {\n        \n\n        this._tileProvider = options.tileProvider;\n        this._tileProvider.quadtree = this;\n\n        this._debug = {\n            enableDebugOutput : false,\n\n            maxDepth : 0,\n            maxDepthVisited : 0,\n            tilesVisited : 0,\n            tilesCulled : 0,\n            tilesRendered : 0,\n            tilesWaitingForChildren : 0,\n\n            lastMaxDepth : -1,\n            lastMaxDepthVisited : -1,\n            lastTilesVisited : -1,\n            lastTilesCulled : -1,\n            lastTilesRendered : -1,\n            lastTilesWaitingForChildren : -1,\n\n            suspendLodUpdate : false\n        };\n\n        var tilingScheme = this._tileProvider.tilingScheme;\n        var ellipsoid = tilingScheme.ellipsoid;\n\n        this._tilesToRender = [];\n        this._tileLoadQueueHigh = []; // high priority tiles are preventing refinement\n        this._tileLoadQueueMedium = []; // medium priority tiles are being rendered\n        this._tileLoadQueueLow = []; // low priority tiles were refined past or are non-visible parts of quads.\n        this._tileReplacementQueue = new TileReplacementQueue();\n        this._levelZeroTiles = undefined;\n        this._loadQueueTimeSlice = 5.0;\n        this._tilesInvalidated = false;\n\n        this._addHeightCallbacks = [];\n        this._removeHeightCallbacks = [];\n\n        this._tileToUpdateHeights = [];\n        this._lastTileIndex = 0;\n        this._updateHeightsTimeSlice = 2.0;\n\n        // If a culled tile contains _cameraPositionCartographic or _cameraReferenceFrameOriginCartographic, it will be marked\n        // TileSelectionResult.CULLED_BUT_NEEDED and added to the list of tiles to update heights,\n        // even though it is not rendered.\n        // These are updated each frame in `selectTilesForRendering`.\n        this._cameraPositionCartographic = undefined;\n        this._cameraReferenceFrameOriginCartographic = undefined;\n\n        /**\n         * Gets or sets the maximum screen-space error, in pixels, that is allowed.\n         * A higher maximum error will render fewer tiles and improve performance, while a lower\n         * value will improve visual quality.\n         * @type {Number}\n         * @default 2\n         */\n        this.maximumScreenSpaceError = defaultValue(options.maximumScreenSpaceError, 2);\n\n        /**\n         * Gets or sets the maximum number of tiles that will be retained in the tile cache.\n         * Note that tiles will never be unloaded if they were used for rendering the last\n         * frame, so the actual number of resident tiles may be higher.  The value of\n         * this property will not affect visual quality.\n         * @type {Number}\n         * @default 100\n         */\n        this.tileCacheSize = defaultValue(options.tileCacheSize, 100);\n\n        /**\n         * Gets or sets the number of loading descendant tiles that is considered \"too many\".\n         * If a tile has too many loading descendants, that tile will be loaded and rendered before any of\n         * its descendants are loaded and rendered. This means more feedback for the user that something\n         * is happening at the cost of a longer overall load time. Setting this to 0 will cause each\n         * tile level to be loaded successively, significantly increasing load time. Setting it to a large\n         * number (e.g. 1000) will minimize the number of tiles that are loaded but tend to make\n         * detail appear all at once after a long wait.\n         * @type {Number}\n         * @default 20\n         */\n        this.loadingDescendantLimit = 20;\n\n        /**\n         * Gets or sets a value indicating whether the ancestors of rendered tiles should be preloaded.\n         * Setting this to true optimizes the zoom-out experience and provides more detail in\n         * newly-exposed areas when panning. The down side is that it requires loading more tiles.\n         * @type {Boolean}\n         * @default true\n         */\n        this.preloadAncestors = true;\n\n        /**\n         * Gets or sets a value indicating whether the siblings of rendered tiles should be preloaded.\n         * Setting this to true causes tiles with the same parent as a rendered tile to be loaded, even\n         * if they are culled. Setting this to true may provide a better panning experience at the\n         * cost of loading more tiles.\n         * @type {Boolean}\n         * @default false\n         */\n        this.preloadSiblings = false;\n\n        this._occluders = new QuadtreeOccluders({\n            ellipsoid : ellipsoid\n        });\n\n        this._tileLoadProgressEvent = new Event();\n        this._lastTileLoadQueueLength = 0;\n\n        this._lastSelectionFrameNumber = undefined;\n    }\n\n    Object.defineProperties(QuadtreePrimitive.prototype, {\n        /**\n         * Gets the provider of {@link QuadtreeTile} instances for this quadtree.\n         * @type {QuadtreeTile}\n         * @memberof QuadtreePrimitive.prototype\n         */\n        tileProvider : {\n            get : function() {\n                return this._tileProvider;\n            }\n        },\n        /**\n         * Gets an event that's raised when the length of the tile load queue has changed since the last render frame.  When the load queue is empty,\n         * all terrain and imagery for the current view have been loaded.  The event passes the new length of the tile load queue.\n         *\n         * @memberof QuadtreePrimitive.prototype\n         * @type {Event}\n         */\n        tileLoadProgressEvent : {\n            get : function() {\n                return this._tileLoadProgressEvent;\n            }\n        },\n\n        occluders : {\n            get : function() {\n                return this._occluders;\n            }\n        }\n    });\n\n    /**\n     * Invalidates and frees all the tiles in the quadtree.  The tiles must be reloaded\n     * before they can be displayed.\n     *\n     * @memberof QuadtreePrimitive\n     */\n    QuadtreePrimitive.prototype.invalidateAllTiles = function() {\n        this._tilesInvalidated = true;\n    };\n\n    function invalidateAllTiles(primitive) {\n        // Clear the replacement queue\n        var replacementQueue = primitive._tileReplacementQueue;\n        replacementQueue.head = undefined;\n        replacementQueue.tail = undefined;\n        replacementQueue.count = 0;\n\n        clearTileLoadQueue(primitive);\n\n        // Free and recreate the level zero tiles.\n        var levelZeroTiles = primitive._levelZeroTiles;\n        if (defined(levelZeroTiles)) {\n            for (var i = 0; i < levelZeroTiles.length; ++i) {\n                var tile = levelZeroTiles[i];\n                var customData = tile.customData;\n                var customDataLength = customData.length;\n\n                for (var j = 0; j < customDataLength; ++j) {\n                    var data = customData[j];\n                    data.level = 0;\n                    primitive._addHeightCallbacks.push(data);\n                }\n\n                levelZeroTiles[i].freeResources();\n            }\n        }\n\n        primitive._levelZeroTiles = undefined;\n\n        primitive._tileProvider.cancelReprojections();\n    }\n\n    /**\n     * Invokes a specified function for each {@link QuadtreeTile} that is partially\n     * or completely loaded.\n     *\n     * @param {Function} tileFunction The function to invoke for each loaded tile.  The\n     *        function is passed a reference to the tile as its only parameter.\n     */\n    QuadtreePrimitive.prototype.forEachLoadedTile = function(tileFunction) {\n        var tile = this._tileReplacementQueue.head;\n        while (defined(tile)) {\n            if (tile.state !== QuadtreeTileLoadState.START) {\n                tileFunction(tile);\n            }\n            tile = tile.replacementNext;\n        }\n    };\n\n    /**\n     * Invokes a specified function for each {@link QuadtreeTile} that was rendered\n     * in the most recent frame.\n     *\n     * @param {Function} tileFunction The function to invoke for each rendered tile.  The\n     *        function is passed a reference to the tile as its only parameter.\n     */\n    QuadtreePrimitive.prototype.forEachRenderedTile = function(tileFunction) {\n        var tilesRendered = this._tilesToRender;\n        for (var i = 0, len = tilesRendered.length; i < len; ++i) {\n            tileFunction(tilesRendered[i]);\n        }\n    };\n\n    /**\n     * Calls the callback when a new tile is rendered that contains the given cartographic. The only parameter\n     * is the cartesian position on the tile.\n     *\n     * @param {Cartographic} cartographic The cartographic position.\n     * @param {Function} callback The function to be called when a new tile is loaded containing cartographic.\n     * @returns {Function} The function to remove this callback from the quadtree.\n     */\n    QuadtreePrimitive.prototype.updateHeight = function(cartographic, callback) {\n        var primitive = this;\n        var object = {\n            positionOnEllipsoidSurface : undefined,\n            positionCartographic : cartographic,\n            level : -1,\n            callback : callback\n        };\n\n        object.removeFunc = function() {\n            var addedCallbacks = primitive._addHeightCallbacks;\n            var length = addedCallbacks.length;\n            for (var i = 0; i < length; ++i) {\n                if (addedCallbacks[i] === object) {\n                    addedCallbacks.splice(i, 1);\n                    break;\n                }\n            }\n            primitive._removeHeightCallbacks.push(object);\n        };\n\n        primitive._addHeightCallbacks.push(object);\n        return object.removeFunc;\n    };\n\n    /**\n     * Updates the tile provider imagery and continues to process the tile load queue.\n     * @private\n     */\n    QuadtreePrimitive.prototype.update = function(frameState) {\n        if (defined(this._tileProvider.update)) {\n            this._tileProvider.update(frameState);\n        }\n    };\n\n    function clearTileLoadQueue(primitive) {\n        var debug = primitive._debug;\n        debug.maxDepth = 0;\n        debug.maxDepthVisited = 0;\n        debug.tilesVisited = 0;\n        debug.tilesCulled = 0;\n        debug.tilesRendered = 0;\n        debug.tilesWaitingForChildren = 0;\n\n        primitive._tileLoadQueueHigh.length = 0;\n        primitive._tileLoadQueueMedium.length = 0;\n        primitive._tileLoadQueueLow.length = 0;\n    }\n\n    /**\n     * Initializes values for a new render frame and prepare the tile load queue.\n     * @private\n     */\n    QuadtreePrimitive.prototype.beginFrame = function(frameState) {\n        var passes = frameState.passes;\n        if (!passes.render) {\n            return;\n        }\n\n        if (this._tilesInvalidated) {\n            invalidateAllTiles(this);\n            this._tilesInvalidated = false;\n        }\n\n        // Gets commands for any texture re-projections\n        this._tileProvider.initialize(frameState);\n\n        clearTileLoadQueue(this);\n\n        if (this._debug.suspendLodUpdate) {\n            return;\n        }\n\n        this._tileReplacementQueue.markStartOfRenderFrame();\n    };\n\n    /**\n     * Selects new tiles to load based on the frame state and creates render commands.\n     * @private\n     */\n    QuadtreePrimitive.prototype.render = function(frameState) {\n        var passes = frameState.passes;\n        var tileProvider = this._tileProvider;\n\n        if (passes.render) {\n            tileProvider.beginUpdate(frameState);\n\n            selectTilesForRendering(this, frameState);\n            createRenderCommandsForSelectedTiles(this, frameState);\n\n            tileProvider.endUpdate(frameState);\n        }\n\n        if (passes.pick && this._tilesToRender.length > 0) {\n            tileProvider.updateForPick(frameState);\n        }\n    };\n\n    /**\n     * Checks if the load queue length has changed since the last time we raised a queue change event - if so, raises\n     * a new change event at the end of the render cycle.\n     */\n    function updateTileLoadProgress(primitive, frameState) {\n        var currentLoadQueueLength = primitive._tileLoadQueueHigh.length + primitive._tileLoadQueueMedium.length + primitive._tileLoadQueueLow.length;\n\n        if (currentLoadQueueLength !== primitive._lastTileLoadQueueLength || primitive._tilesInvalidated) {\n            frameState.afterRender.push(Event.prototype.raiseEvent.bind(primitive._tileLoadProgressEvent, currentLoadQueueLength));\n            primitive._lastTileLoadQueueLength = currentLoadQueueLength;\n        }\n\n        var debug = primitive._debug;\n        if (debug.enableDebugOutput && !debug.suspendLodUpdate) {\n            debug.maxDepth = primitive._tilesToRender.reduce(function(max, tile) {\n                return Math.max(max, tile.level);\n            }, -1);\n            debug.tilesRendered = primitive._tilesToRender.length;\n\n            if (debug.tilesVisited !== debug.lastTilesVisited ||\n                debug.tilesRendered !== debug.lastTilesRendered ||\n                debug.tilesCulled !== debug.lastTilesCulled ||\n                debug.maxDepth !== debug.lastMaxDepth ||\n                debug.tilesWaitingForChildren !== debug.lastTilesWaitingForChildren ||\n                debug.maxDepthVisited !== debug.lastMaxDepthVisited) {\n\n                console.log('Visited ' + debug.tilesVisited + ', Rendered: ' + debug.tilesRendered + ', Culled: ' + debug.tilesCulled + ', Max Depth Rendered: ' + debug.maxDepth + ', Max Depth Visited: ' + debug.maxDepthVisited + ', Waiting for children: ' + debug.tilesWaitingForChildren);\n\n                debug.lastTilesVisited = debug.tilesVisited;\n                debug.lastTilesRendered = debug.tilesRendered;\n                debug.lastTilesCulled = debug.tilesCulled;\n                debug.lastMaxDepth = debug.maxDepth;\n                debug.lastTilesWaitingForChildren = debug.tilesWaitingForChildren;\n                debug.lastMaxDepthVisited = debug.maxDepthVisited;\n            }\n        }\n    }\n\n    /**\n     * Updates terrain heights.\n     * @private\n     */\n    QuadtreePrimitive.prototype.endFrame = function(frameState) {\n        var passes = frameState.passes;\n        if (!passes.render || frameState.mode === SceneMode.MORPHING) {\n            // Only process the load queue for a single pass.\n            // Don't process the load queue or update heights during the morph flights.\n            return;\n        }\n\n        // Load/create resources for terrain and imagery. Prepare texture re-projections for the next frame.\n        processTileLoadQueue(this, frameState);\n        updateHeights(this, frameState);\n        updateTileLoadProgress(this, frameState);\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <br /><br />\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     *\n     * @memberof QuadtreePrimitive\n     *\n     * @returns {Boolean} True if this object was destroyed; otherwise, false.\n     *\n     * @see QuadtreePrimitive#destroy\n     */\n    QuadtreePrimitive.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n     * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n     * <br /><br />\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     *\n     * @memberof QuadtreePrimitive\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     *\n     * @example\n     * primitive = primitive && primitive.destroy();\n     *\n     * @see QuadtreePrimitive#isDestroyed\n     */\n    QuadtreePrimitive.prototype.destroy = function() {\n        this._tileProvider = this._tileProvider && this._tileProvider.destroy();\n    };\n\n    var comparisonPoint;\n    var centerScratch = new Cartographic();\n    function compareDistanceToPoint(a, b) {\n        var center = Rectangle.center(a.rectangle, centerScratch);\n        var alon = center.longitude - comparisonPoint.longitude;\n        var alat = center.latitude - comparisonPoint.latitude;\n\n        center = Rectangle.center(b.rectangle, centerScratch);\n        var blon = center.longitude - comparisonPoint.longitude;\n        var blat = center.latitude - comparisonPoint.latitude;\n\n        return (alon * alon + alat * alat) - (blon * blon + blat * blat);\n    }\n\n    var cameraOriginScratch = new Cartesian3();\n    var rootTraversalDetails = [];\n\n    function selectTilesForRendering(primitive, frameState) {\n        var debug = primitive._debug;\n        if (debug.suspendLodUpdate) {\n            return;\n        }\n\n        // Clear the render list.\n        var tilesToRender = primitive._tilesToRender;\n        tilesToRender.length = 0;\n\n        // We can't render anything before the level zero tiles exist.\n        var i;\n        var tileProvider = primitive._tileProvider;\n        if (!defined(primitive._levelZeroTiles)) {\n            if (tileProvider.ready) {\n                var tilingScheme = tileProvider.tilingScheme;\n                primitive._levelZeroTiles = QuadtreeTile.createLevelZeroTiles(tilingScheme);\n                var numberOfRootTiles = primitive._levelZeroTiles.length;\n                if (rootTraversalDetails.length < numberOfRootTiles) {\n                    rootTraversalDetails = new Array(numberOfRootTiles);\n                    for (i = 0; i < numberOfRootTiles; ++i) {\n                        if (rootTraversalDetails[i] === undefined) {\n                            rootTraversalDetails[i] = new TraversalDetails();\n                        }\n                    }\n                }\n            } else {\n                // Nothing to do until the provider is ready.\n                return;\n            }\n        }\n\n        primitive._occluders.ellipsoid.cameraPosition = frameState.camera.positionWC;\n\n        var tile;\n        var levelZeroTiles = primitive._levelZeroTiles;\n        var occluders = levelZeroTiles.length > 1 ? primitive._occluders : undefined;\n\n        // Sort the level zero tiles by the distance from the center to the camera.\n        // The level zero tiles aren't necessarily a nice neat quad, so we can't use the\n        // quadtree ordering we use elsewhere in the tree\n        comparisonPoint = frameState.camera.positionCartographic;\n        levelZeroTiles.sort(compareDistanceToPoint);\n\n        var customDataAdded = primitive._addHeightCallbacks;\n        var customDataRemoved = primitive._removeHeightCallbacks;\n        var frameNumber = frameState.frameNumber;\n\n        var len;\n        if (customDataAdded.length > 0 || customDataRemoved.length > 0) {\n            for (i = 0, len = levelZeroTiles.length; i < len; ++i) {\n                tile = levelZeroTiles[i];\n                tile._updateCustomData(frameNumber, customDataAdded, customDataRemoved);\n            }\n\n            customDataAdded.length = 0;\n            customDataRemoved.length = 0;\n        }\n\n        var camera = frameState.camera;\n\n        primitive._cameraPositionCartographic = camera.positionCartographic;\n        var cameraFrameOrigin = Matrix4.getTranslation(camera.transform, cameraOriginScratch);\n        primitive._cameraReferenceFrameOriginCartographic = primitive.tileProvider.tilingScheme.ellipsoid.cartesianToCartographic(cameraFrameOrigin, primitive._cameraReferenceFrameOriginCartographic);\n\n        // Traverse in depth-first, near-to-far order.\n        for (i = 0, len = levelZeroTiles.length; i < len; ++i) {\n            tile = levelZeroTiles[i];\n            primitive._tileReplacementQueue.markTileRendered(tile);\n            if (!tile.renderable) {\n                queueTileLoad(primitive, primitive._tileLoadQueueHigh, tile, frameState);\n                ++debug.tilesWaitingForChildren;\n            } else {\n                visitIfVisible(primitive, tile, tileProvider, frameState, occluders, false, rootTraversalDetails[i]);\n            }\n        }\n\n        primitive._lastSelectionFrameNumber = frameNumber;\n    }\n\n    function queueTileLoad(primitive, queue, tile, frameState) {\n        if (!tile.needsLoading) {\n            return;\n        }\n\n        if (primitive.tileProvider.computeTileLoadPriority !== undefined) {\n            tile._loadPriority = primitive.tileProvider.computeTileLoadPriority(tile, frameState);\n        }\n        queue.push(tile);\n    }\n\n    /**\n     * Tracks details of traversing a tile while selecting tiles for rendering.\n     * @alias TraversalDetails\n     * @constructor\n     * @private\n     */\n    function TraversalDetails() {\n        /**\n         * True if all selected (i.e. not culled or refined) tiles in this tile's subtree\n         * are renderable. If the subtree is renderable, we'll render it; no drama.\n         */\n        this.allAreRenderable = true;\n\n        /**\n         * True if any tiles in this tile's subtree were rendered last frame. If any\n         * were, we must render the subtree rather than this tile, because rendering\n         * this tile would cause detail to vanish that was visible last frame, and\n         * that's no good.\n         */\n        this.anyWereRenderedLastFrame = false;\n\n        /**\n         * Counts the number of selected tiles in this tile's subtree that are\n         * not yet ready to be rendered because they need more loading. Note that\n         * this value will _not_ necessarily be zero when\n         * {@link TraversalDetails#allAreRenderable} is true, for subtle reasons.\n         * When {@link TraversalDetails#allAreRenderable} and\n         * {@link TraversalDetails#anyWereRenderedLastFrame} are both false, we\n         * will render this tile instead of any tiles in its subtree and\n         * the `allAreRenderable` value for this tile will reflect only whether _this_\n         * tile is renderable. The `notYetRenderableCount` value, however, will still\n         * reflect the total number of tiles that we are waiting on, including the\n         * ones that we're not rendering. `notYetRenderableCount` is only reset\n         * when a subtree is removed from the render queue because the\n         * `notYetRenderableCount` exceeds the\n         * {@link QuadtreePrimitive#loadingDescendantLimit}.\n         */\n        this.notYetRenderableCount = 0;\n    }\n\n    function TraversalQuadDetails() {\n        this.southwest = new TraversalDetails();\n        this.southeast = new TraversalDetails();\n        this.northwest = new TraversalDetails();\n        this.northeast = new TraversalDetails();\n    }\n\n    TraversalQuadDetails.prototype.combine = function(result) {\n        var southwest = this.southwest;\n        var southeast = this.southeast;\n        var northwest = this.northwest;\n        var northeast = this.northeast;\n\n        result.allAreRenderable = southwest.allAreRenderable && southeast.allAreRenderable && northwest.allAreRenderable && northeast.allAreRenderable;\n        result.anyWereRenderedLastFrame = southwest.anyWereRenderedLastFrame || southeast.anyWereRenderedLastFrame || northwest.anyWereRenderedLastFrame || northeast.anyWereRenderedLastFrame;\n        result.notYetRenderableCount = southwest.notYetRenderableCount + southeast.notYetRenderableCount + northwest.notYetRenderableCount + northeast.notYetRenderableCount;\n    };\n\n    var traversalQuadsByLevel = new Array(31); // level 30 tiles are ~2cm wide at the equator, should be good enough.\n    for (var i = 0; i < traversalQuadsByLevel.length; ++i) {\n        traversalQuadsByLevel[i] = new TraversalQuadDetails();\n    }\n\n    /**\n     * Visits a tile for possible rendering. When we call this function with a tile:\n     *\n     *    * the tile has been determined to be visible (possibly based on a bounding volume that is not very tight-fitting)\n     *    * its parent tile does _not_ meet the SSE (unless ancestorMeetsSse=true, see comments below)\n     *    * the tile may or may not be renderable\n     *\n     * @private\n     *\n     * @param {Primitive} primitive The QuadtreePrimitive.\n     * @param {FrameState} frameState The frame state.\n     * @param {QuadtreeTile} tile The tile to visit\n     * @param {Boolean} ancestorMeetsSse True if a tile higher in the tile tree already met the SSE and we're refining further only\n     *                  to maintain detail while that higher tile loads.\n     * @param {TraversalDetails} traveralDetails On return, populated with details of how the traversal of this tile went.\n     */\n    function visitTile(primitive, frameState, tile, ancestorMeetsSse, traversalDetails) {\n        var debug = primitive._debug;\n\n        ++debug.tilesVisited;\n\n        primitive._tileReplacementQueue.markTileRendered(tile);\n        tile._updateCustomData(frameState.frameNumber);\n\n        if (tile.level > debug.maxDepthVisited) {\n            debug.maxDepthVisited = tile.level;\n        }\n\n        var meetsSse = screenSpaceError(primitive, frameState, tile) < primitive.maximumScreenSpaceError;\n\n        var southwestChild = tile.southwestChild;\n        var southeastChild = tile.southeastChild;\n        var northwestChild = tile.northwestChild;\n        var northeastChild = tile.northeastChild;\n\n        var lastFrame = primitive._lastSelectionFrameNumber;\n        var lastFrameSelectionResult = tile._lastSelectionResultFrame === lastFrame ? tile._lastSelectionResult : TileSelectionResult.NONE;\n\n        var tileProvider = primitive.tileProvider;\n\n        if (meetsSse || ancestorMeetsSse) {\n            // This tile (or an ancestor) is the one we want to render this frame, but we'll do different things depending\n            // on the state of this tile and on what we did _last_ frame.\n\n            // We can render it if _any_ of the following are true:\n            // 1. We rendered it (or kicked it) last frame.\n            // 2. This tile was culled last frame, or it wasn't even visited because an ancestor was culled.\n            // 3. The tile is completely done loading.\n            // 4. a) Terrain is ready, and\n            //    b) All necessary imagery is ready. Necessary imagery is imagery that was rendered with this tile\n            //       or any descendants last frame. Such imagery is required because rendering this tile without\n            //       it would cause detail to disappear.\n            //\n            // Determining condition 4 is more expensive, so we check the others first.\n            //\n            // Note that even if we decide to render a tile here, it may later get \"kicked\" in favor of an ancestor.\n\n            var oneRenderedLastFrame = TileSelectionResult.originalResult(lastFrameSelectionResult) === TileSelectionResult.RENDERED;\n            var twoCulledOrNotVisited = TileSelectionResult.originalResult(lastFrameSelectionResult) === TileSelectionResult.CULLED || lastFrameSelectionResult === TileSelectionResult.NONE;\n            var threeCompletelyLoaded = tile.state === QuadtreeTileLoadState.DONE;\n\n            var renderable = oneRenderedLastFrame || twoCulledOrNotVisited || threeCompletelyLoaded;\n\n            if (!renderable) {\n                // Check the more expensive condition 4 above. This requires details of the thing\n                // we're rendering (e.g. the globe surface), so delegate it to the tile provider.\n                if (defined(tileProvider.canRenderWithoutLosingDetail)) {\n                    renderable = tileProvider.canRenderWithoutLosingDetail(tile);\n                }\n            }\n\n            if (renderable) {\n                // Only load this tile if it (not just an ancestor) meets the SSE.\n                if (meetsSse) {\n                    queueTileLoad(primitive, primitive._tileLoadQueueMedium, tile, frameState);\n                }\n                addTileToRenderList(primitive, tile);\n\n                traversalDetails.allAreRenderable = tile.renderable;\n                traversalDetails.anyWereRenderedLastFrame = lastFrameSelectionResult === TileSelectionResult.RENDERED;\n                traversalDetails.notYetRenderableCount = tile.renderable ? 0 : 1;\n\n                tile._lastSelectionResultFrame = frameState.frameNumber;\n                tile._lastSelectionResult = TileSelectionResult.RENDERED;\n\n                if (!traversalDetails.anyWereRenderedLastFrame) {\n                    // Tile is newly-rendered this frame, so update its heights.\n                    primitive._tileToUpdateHeights.push(tile);\n                }\n\n                return;\n            }\n\n            // Otherwise, we can't render this tile (or its fill) because doing so would cause detail to disappear\n            // that was visible last frame. Instead, keep rendering any still-visible descendants that were rendered\n            // last frame and render fills for newly-visible descendants. E.g. if we were rendering level 15 last\n            // frame but this frame we want level 14 and the closest renderable level <= 14 is 0, rendering level\n            // zero would be pretty jarring so instead we keep rendering level 15 even though its SSE is better\n            // than required. So fall through to continue traversal...\n            ancestorMeetsSse = true;\n\n            // Load this blocker tile with high priority, but only if this tile (not just an ancestor) meets the SSE.\n            if (meetsSse) {\n                queueTileLoad(primitive, primitive._tileLoadQueueHigh, tile, frameState);\n            }\n        }\n\n        if (tileProvider.canRefine(tile)) {\n            var allAreUpsampled = southwestChild.upsampledFromParent && southeastChild.upsampledFromParent &&\n                                  northwestChild.upsampledFromParent && northeastChild.upsampledFromParent;\n\n            if (allAreUpsampled) {\n                // No point in rendering the children because they're all upsampled.  Render this tile instead.\n                addTileToRenderList(primitive, tile);\n\n                // Rendered tile that's not waiting on children loads with medium priority.\n                queueTileLoad(primitive, primitive._tileLoadQueueMedium, tile, frameState);\n\n                // Make sure we don't unload the children and forget they're upsampled.\n                primitive._tileReplacementQueue.markTileRendered(southwestChild);\n                primitive._tileReplacementQueue.markTileRendered(southeastChild);\n                primitive._tileReplacementQueue.markTileRendered(northwestChild);\n                primitive._tileReplacementQueue.markTileRendered(northeastChild);\n\n                traversalDetails.allAreRenderable = tile.renderable;\n                traversalDetails.anyWereRenderedLastFrame = lastFrameSelectionResult === TileSelectionResult.RENDERED;\n                traversalDetails.notYetRenderableCount = tile.renderable ? 0 : 1;\n\n                tile._lastSelectionResultFrame = frameState.frameNumber;\n                tile._lastSelectionResult = TileSelectionResult.RENDERED;\n\n                if (!traversalDetails.anyWereRenderedLastFrame) {\n                    // Tile is newly-rendered this frame, so update its heights.\n                    primitive._tileToUpdateHeights.push(tile);\n                }\n\n                return;\n            }\n\n            // SSE is not good enough, so refine.\n            tile._lastSelectionResultFrame = frameState.frameNumber;\n            tile._lastSelectionResult = TileSelectionResult.REFINED;\n\n            var firstRenderedDescendantIndex = primitive._tilesToRender.length;\n            var loadIndexLow = primitive._tileLoadQueueLow.length;\n            var loadIndexMedium = primitive._tileLoadQueueMedium.length;\n            var loadIndexHigh = primitive._tileLoadQueueHigh.length;\n            var tilesToUpdateHeightsIndex = primitive._tileToUpdateHeights.length;\n\n            // No need to add the children to the load queue because they'll be added (if necessary) when they're visited.\n            visitVisibleChildrenNearToFar(primitive, southwestChild, southeastChild, northwestChild, northeastChild, frameState, ancestorMeetsSse, traversalDetails);\n\n            // If no descendant tiles were added to the render list by the function above, it means they were all\n            // culled even though this tile was deemed visible. That's pretty common.\n\n            if (firstRenderedDescendantIndex !== primitive._tilesToRender.length) {\n                // At least one descendant tile was added to the render list.\n                // The traversalDetails tell us what happened while visiting the children.\n\n                var allAreRenderable = traversalDetails.allAreRenderable;\n                var anyWereRenderedLastFrame = traversalDetails.anyWereRenderedLastFrame;\n                var notYetRenderableCount = traversalDetails.notYetRenderableCount;\n                var queuedForLoad = false;\n\n                if (!allAreRenderable && !anyWereRenderedLastFrame) {\n                    // Some of our descendants aren't ready to render yet, and none were rendered last frame,\n                    // so kick them all out of the render list and render this tile instead. Continue to load them though!\n\n                    // Mark the rendered descendants and their ancestors - up to this tile - as kicked.\n                    var renderList = primitive._tilesToRender;\n                    for (var i = firstRenderedDescendantIndex; i < renderList.length; ++i) {\n                        var workTile = renderList[i];\n                        while (workTile !== undefined && workTile._lastSelectionResult !== TileSelectionResult.KICKED && workTile !== tile) {\n                            workTile._lastSelectionResult = TileSelectionResult.kick(workTile._lastSelectionResult);\n                            workTile = workTile.parent;\n                        }\n                    }\n\n                    // Remove all descendants from the render list and add this tile.\n                    primitive._tilesToRender.length = firstRenderedDescendantIndex;\n                    primitive._tileToUpdateHeights.length = tilesToUpdateHeightsIndex;\n                    addTileToRenderList(primitive, tile);\n\n                    tile._lastSelectionResult = TileSelectionResult.RENDERED;\n\n                    // If we're waiting on heaps of descendants, the above will take too long. So in that case,\n                    // load this tile INSTEAD of loading any of the descendants, and tell the up-level we're only waiting\n                    // on this tile. Keep doing this until we actually manage to render this tile.\n                    var wasRenderedLastFrame = lastFrameSelectionResult === TileSelectionResult.RENDERED;\n                    if (!wasRenderedLastFrame && notYetRenderableCount > primitive.loadingDescendantLimit) {\n                        // Remove all descendants from the load queues.\n                        primitive._tileLoadQueueLow.length = loadIndexLow;\n                        primitive._tileLoadQueueMedium.length = loadIndexMedium;\n                        primitive._tileLoadQueueHigh.length = loadIndexHigh;\n                        queueTileLoad(primitive, primitive._tileLoadQueueMedium, tile, frameState);\n                        traversalDetails.notYetRenderableCount = tile.renderable ? 0 : 1;\n                        queuedForLoad = true;\n                    }\n\n                    traversalDetails.allAreRenderable = tile.renderable;\n                    traversalDetails.anyWereRenderedLastFrame = wasRenderedLastFrame;\n\n                    if (!wasRenderedLastFrame) {\n                        // Tile is newly-rendered this frame, so update its heights.\n                        primitive._tileToUpdateHeights.push(tile);\n                    }\n\n                    ++debug.tilesWaitingForChildren;\n                }\n\n                if (primitive.preloadAncestors && !queuedForLoad) {\n                    queueTileLoad(primitive, primitive._tileLoadQueueLow, tile, frameState);\n                }\n            }\n\n            return;\n        }\n\n        tile._lastSelectionResultFrame = frameState.frameNumber;\n        tile._lastSelectionResult = TileSelectionResult.RENDERED;\n\n        // We'd like to refine but can't because we have no availability data for this tile's children,\n        // so we have no idea if refinining would involve a load or an upsample. We'll have to finish\n        // loading this tile first in order to find that out, so load this refinement blocker with\n        // high priority.\n        addTileToRenderList(primitive, tile);\n        queueTileLoad(primitive, primitive._tileLoadQueueHigh, tile, frameState);\n\n        traversalDetails.allAreRenderable = tile.renderable;\n        traversalDetails.anyWereRenderedLastFrame = lastFrameSelectionResult === TileSelectionResult.RENDERED;\n        traversalDetails.notYetRenderableCount = tile.renderable ? 0 : 1;\n    }\n\n    function visitVisibleChildrenNearToFar(primitive, southwest, southeast, northwest, northeast, frameState, ancestorMeetsSse, traversalDetails) {\n        var cameraPosition = frameState.camera.positionCartographic;\n        var tileProvider = primitive._tileProvider;\n        var occluders = primitive._occluders;\n\n        var quadDetails = traversalQuadsByLevel[southwest.level];\n        var southwestDetails = quadDetails.southwest;\n        var southeastDetails = quadDetails.southeast;\n        var northwestDetails = quadDetails.northwest;\n        var northeastDetails = quadDetails.northeast;\n\n        if (cameraPosition.longitude < southwest.rectangle.east) {\n            if (cameraPosition.latitude < southwest.rectangle.north) {\n                // Camera in southwest quadrant\n                visitIfVisible(primitive, southwest, tileProvider, frameState, occluders, ancestorMeetsSse, southwestDetails);\n                visitIfVisible(primitive, southeast, tileProvider, frameState, occluders, ancestorMeetsSse, southeastDetails);\n                visitIfVisible(primitive, northwest, tileProvider, frameState, occluders, ancestorMeetsSse, northwestDetails);\n                visitIfVisible(primitive, northeast, tileProvider, frameState, occluders, ancestorMeetsSse, northeastDetails);\n            } else {\n                // Camera in northwest quadrant\n                visitIfVisible(primitive, northwest, tileProvider, frameState, occluders, ancestorMeetsSse, northwestDetails);\n                visitIfVisible(primitive, southwest, tileProvider, frameState, occluders, ancestorMeetsSse, southwestDetails);\n                visitIfVisible(primitive, northeast, tileProvider, frameState, occluders, ancestorMeetsSse, northeastDetails);\n                visitIfVisible(primitive, southeast, tileProvider, frameState, occluders, ancestorMeetsSse, southeastDetails);\n            }\n        } else if (cameraPosition.latitude < southwest.rectangle.north) {\n            // Camera southeast quadrant\n            visitIfVisible(primitive, southeast, tileProvider, frameState, occluders, ancestorMeetsSse, southeastDetails);\n            visitIfVisible(primitive, southwest, tileProvider, frameState, occluders, ancestorMeetsSse, southwestDetails);\n            visitIfVisible(primitive, northeast, tileProvider, frameState, occluders, ancestorMeetsSse, northeastDetails);\n            visitIfVisible(primitive, northwest, tileProvider, frameState, occluders, ancestorMeetsSse, northwestDetails);\n        } else {\n            // Camera in northeast quadrant\n            visitIfVisible(primitive, northeast, tileProvider, frameState, occluders, ancestorMeetsSse, northeastDetails);\n            visitIfVisible(primitive, northwest, tileProvider, frameState, occluders, ancestorMeetsSse, northwestDetails);\n            visitIfVisible(primitive, southeast, tileProvider, frameState, occluders, ancestorMeetsSse, southeastDetails);\n            visitIfVisible(primitive, southwest, tileProvider, frameState, occluders, ancestorMeetsSse, southwestDetails);\n        }\n\n        quadDetails.combine(traversalDetails);\n    }\n\n    function containsNeededPosition(primitive, tile) {\n        var rectangle = tile.rectangle;\n        return (defined(primitive._cameraPositionCartographic) && Rectangle.contains(rectangle, primitive._cameraPositionCartographic)) ||\n               (defined(primitive._cameraReferenceFrameOriginCartographic) && Rectangle.contains(rectangle, primitive._cameraReferenceFrameOriginCartographic));\n    }\n\n    function visitIfVisible(primitive, tile, tileProvider, frameState, occluders, ancestorMeetsSse, traversalDetails) {\n        if (tileProvider.computeTileVisibility(tile, frameState, occluders) !== Visibility.NONE) {\n            return visitTile(primitive, frameState, tile, ancestorMeetsSse, traversalDetails);\n        }\n\n        ++primitive._debug.tilesCulled;\n        primitive._tileReplacementQueue.markTileRendered(tile);\n\n        traversalDetails.allAreRenderable = true;\n        traversalDetails.anyWereRenderedLastFrame = false;\n        traversalDetails.notYetRenderableCount = 0;\n\n        if (containsNeededPosition(primitive, tile)) {\n            // Load the tile(s) that contains the camera's position and\n            // the origin of its reference frame with medium priority.\n            // But we only need to load until the terrain is available, no need to load imagery.\n            if (!defined(tile.data) || !defined(tile.data.vertexArray)) {\n                queueTileLoad(primitive, primitive._tileLoadQueueMedium, tile, frameState);\n            }\n\n            var lastFrame = primitive._lastSelectionFrameNumber;\n            var lastFrameSelectionResult = tile._lastSelectionResultFrame === lastFrame ? tile._lastSelectionResult : TileSelectionResult.NONE;\n            if (lastFrameSelectionResult !== TileSelectionResult.CULLED_BUT_NEEDED && lastFrameSelectionResult !== TileSelectionResult.RENDERED) {\n                primitive._tileToUpdateHeights.push(tile);\n            }\n\n            tile._lastSelectionResult = TileSelectionResult.CULLED_BUT_NEEDED;\n        } else if (primitive.preloadSiblings || tile.level === 0) {\n            // Load culled level zero tiles with low priority.\n            // For all other levels, only load culled tiles if preloadSiblings is enabled.\n            queueTileLoad(primitive, primitive._tileLoadQueueLow, tile, frameState);\n            tile._lastSelectionResult = TileSelectionResult.CULLED;\n        } else {\n            tile._lastSelectionResult = TileSelectionResult.CULLED;\n        }\n\n        tile._lastSelectionResultFrame = frameState.frameNumber;\n    }\n\n    function screenSpaceError(primitive, frameState, tile) {\n        if (frameState.mode === SceneMode.SCENE2D || frameState.camera.frustum instanceof OrthographicFrustum || frameState.camera.frustum instanceof OrthographicOffCenterFrustum) {\n            return screenSpaceError2D(primitive, frameState, tile);\n        }\n\n        var maxGeometricError = primitive._tileProvider.getLevelMaximumGeometricError(tile.level);\n\n        var distance = tile._distance;\n        var height = frameState.context.drawingBufferHeight;\n        var sseDenominator = frameState.camera.frustum.sseDenominator;\n\n        var error = (maxGeometricError * height) / (distance * sseDenominator);\n\n        if (frameState.fog.enabled) {\n            error -= CesiumMath.fog(distance, frameState.fog.density) * frameState.fog.sse;\n        }\n\n        error /= frameState.pixelRatio;\n\n        return error;\n    }\n\n    function screenSpaceError2D(primitive, frameState, tile) {\n        var camera = frameState.camera;\n        var frustum = camera.frustum;\n        if (defined(frustum._offCenterFrustum)) {\n            frustum = frustum._offCenterFrustum;\n        }\n\n        var context = frameState.context;\n        var width = context.drawingBufferWidth;\n        var height = context.drawingBufferHeight;\n\n        var maxGeometricError = primitive._tileProvider.getLevelMaximumGeometricError(tile.level);\n        var pixelSize = Math.max(frustum.top - frustum.bottom, frustum.right - frustum.left) / Math.max(width, height);\n        var error = maxGeometricError / pixelSize;\n\n        if (frameState.fog.enabled && frameState.mode !== SceneMode.SCENE2D) {\n            error -= CesiumMath.fog(tile._distance, frameState.fog.density) * frameState.fog.sse;\n        }\n\n        error /= frameState.pixelRatio;\n\n        return error;\n    }\n\n    function addTileToRenderList(primitive, tile) {\n        primitive._tilesToRender.push(tile);\n    }\n\n    function processTileLoadQueue(primitive, frameState) {\n        var tileLoadQueueHigh = primitive._tileLoadQueueHigh;\n        var tileLoadQueueMedium = primitive._tileLoadQueueMedium;\n        var tileLoadQueueLow = primitive._tileLoadQueueLow;\n\n        if (tileLoadQueueHigh.length === 0 && tileLoadQueueMedium.length === 0 && tileLoadQueueLow.length === 0) {\n            return;\n        }\n\n        // Remove any tiles that were not used this frame beyond the number\n        // we're allowed to keep.\n        primitive._tileReplacementQueue.trimTiles(primitive.tileCacheSize);\n\n        var endTime = getTimestamp() + primitive._loadQueueTimeSlice;\n        var tileProvider = primitive._tileProvider;\n\n        var didSomeLoading = processSinglePriorityLoadQueue(primitive, frameState, tileProvider, endTime, tileLoadQueueHigh, false);\n        didSomeLoading = processSinglePriorityLoadQueue(primitive, frameState, tileProvider, endTime, tileLoadQueueMedium, didSomeLoading);\n        processSinglePriorityLoadQueue(primitive, frameState, tileProvider, endTime, tileLoadQueueLow, didSomeLoading);\n    }\n\n    function sortByLoadPriority(a, b) {\n        return a._loadPriority - b._loadPriority;\n    }\n\n    function processSinglePriorityLoadQueue(primitive, frameState, tileProvider, endTime, loadQueue, didSomeLoading) {\n        if (tileProvider.computeTileLoadPriority !== undefined) {\n            loadQueue.sort(sortByLoadPriority);\n        }\n\n        for (var i = 0, len = loadQueue.length; i < len && (getTimestamp() < endTime || !didSomeLoading); ++i) {\n            var tile = loadQueue[i];\n            primitive._tileReplacementQueue.markTileRendered(tile);\n            tileProvider.loadTile(frameState, tile);\n            didSomeLoading = true;\n        }\n\n        return didSomeLoading;\n    }\n\n    var scratchRay = new Ray();\n    var scratchCartographic = new Cartographic();\n    var scratchPosition = new Cartesian3();\n    var scratchArray = [];\n\n    function updateHeights(primitive, frameState) {\n        if (!primitive.tileProvider.ready) {\n            return;\n        }\n\n        var tryNextFrame = scratchArray;\n        tryNextFrame.length = 0;\n        var tilesToUpdateHeights = primitive._tileToUpdateHeights;\n        var terrainProvider = primitive._tileProvider.terrainProvider;\n\n        var startTime = getTimestamp();\n        var timeSlice = primitive._updateHeightsTimeSlice;\n        var endTime = startTime + timeSlice;\n\n        var mode = frameState.mode;\n        var projection = frameState.mapProjection;\n        var ellipsoid = primitive.tileProvider.tilingScheme.ellipsoid;\n        var i;\n\n        while (tilesToUpdateHeights.length > 0) {\n            var tile = tilesToUpdateHeights[0];\n            if (!defined(tile.data) || !defined(tile.data.mesh)) {\n                // Tile isn't loaded enough yet, so try again next frame if this tile is still\n                // being rendered.\n                var selectionResult = tile._lastSelectionResultFrame === primitive._lastSelectionFrameNumber\n                    ? tile._lastSelectionResult\n                    : TileSelectionResult.NONE;\n                if (selectionResult === TileSelectionResult.RENDERED || selectionResult === TileSelectionResult.CULLED_BUT_NEEDED) {\n                    tryNextFrame.push(tile);\n                }\n                tilesToUpdateHeights.shift();\n                primitive._lastTileIndex = 0;\n                continue;\n            }\n            var customData = tile.customData;\n            var customDataLength = customData.length;\n\n            var timeSliceMax = false;\n            for (i = primitive._lastTileIndex; i < customDataLength; ++i) {\n                var data = customData[i];\n\n                if (tile.level > data.level) {\n                    if (!defined(data.positionOnEllipsoidSurface)) {\n                        // cartesian has to be on the ellipsoid surface for `ellipsoid.geodeticSurfaceNormal`\n                        data.positionOnEllipsoidSurface = Cartesian3.fromRadians(data.positionCartographic.longitude, data.positionCartographic.latitude, 0.0, ellipsoid);\n                    }\n\n                    if (mode === SceneMode.SCENE3D) {\n                        var surfaceNormal = ellipsoid.geodeticSurfaceNormal(data.positionOnEllipsoidSurface, scratchRay.direction);\n\n                        // compute origin point\n\n                        // Try to find the intersection point between the surface normal and z-axis.\n                        // minimum height (-11500.0) for the terrain set, need to get this information from the terrain provider\n                        var rayOrigin = ellipsoid.getSurfaceNormalIntersectionWithZAxis(data.positionOnEllipsoidSurface, 11500.0, scratchRay.origin);\n\n                        // Theoretically, not with Earth datums, the intersection point can be outside the ellipsoid\n                        if (!defined(rayOrigin)) {\n                            // intersection point is outside the ellipsoid, try other value\n                            // minimum height (-11500.0) for the terrain set, need to get this information from the terrain provider\n                            var minimumHeight;\n                            if (defined(tile.data.tileBoundingRegion)) {\n                                minimumHeight = tile.data.tileBoundingRegion.minimumHeight;\n                            }\n                            var magnitude = Math.min(defaultValue(minimumHeight, 0.0), -11500.0);\n\n                            // multiply by the *positive* value of the magnitude\n                            var vectorToMinimumPoint = Cartesian3.multiplyByScalar(surfaceNormal, Math.abs(magnitude) + 1, scratchPosition);\n                            Cartesian3.subtract(data.positionOnEllipsoidSurface, vectorToMinimumPoint, scratchRay.origin);\n                        }\n                    } else {\n                        Cartographic.clone(data.positionCartographic, scratchCartographic);\n\n                        // minimum height for the terrain set, need to get this information from the terrain provider\n                        scratchCartographic.height = -11500.0;\n                        projection.project(scratchCartographic, scratchPosition);\n                        Cartesian3.fromElements(scratchPosition.z, scratchPosition.x, scratchPosition.y, scratchPosition);\n                        Cartesian3.clone(scratchPosition, scratchRay.origin);\n                        Cartesian3.clone(Cartesian3.UNIT_X, scratchRay.direction);\n                    }\n\n                    var position = tile.data.pick(scratchRay, mode, projection, false, scratchPosition);\n                    if (defined(position)) {\n                        data.callback(position);\n                        data.level = tile.level;\n                    }\n                } else if (tile.level === data.level) {\n                    var children = tile.children;\n                    var childrenLength = children.length;\n\n                    var child;\n                    for (var j = 0; j < childrenLength; ++j) {\n                        child = children[j];\n                        if (Rectangle.contains(child.rectangle, data.positionCartographic)) {\n                            break;\n                        }\n                    }\n\n                    var tileDataAvailable = terrainProvider.getTileDataAvailable(child.x, child.y, child.level);\n                    var parentTile = tile.parent;\n                    if ((defined(tileDataAvailable) && !tileDataAvailable) ||\n                        (defined(parentTile) && defined(parentTile.data) && defined(parentTile.data.terrainData) &&\n                         !parentTile.data.terrainData.isChildAvailable(parentTile.x, parentTile.y, child.x, child.y))) {\n                        data.removeFunc();\n                    }\n                }\n\n                if (getTimestamp() >= endTime) {\n                    timeSliceMax = true;\n                    break;\n                }\n            }\n\n            if (timeSliceMax) {\n                primitive._lastTileIndex = i;\n                break;\n            } else {\n                primitive._lastTileIndex = 0;\n                tilesToUpdateHeights.shift();\n            }\n        }\n        for (i = 0; i < tryNextFrame.length; i++) {\n            tilesToUpdateHeights.push(tryNextFrame[i]);\n        }\n    }\n\n    function createRenderCommandsForSelectedTiles(primitive, frameState) {\n        var tileProvider = primitive._tileProvider;\n        var tilesToRender = primitive._tilesToRender;\n\n        for (var i = 0, len = tilesToRender.length; i < len; ++i) {\n            var tile = tilesToRender[i];\n            tileProvider.showTileThisFrame(tile, frameState);\n        }\n    }\nexport default QuadtreePrimitive;\n","import BoundingSphere from '../Core/BoundingSphere.js';\nimport buildModuleUrl from '../Core/buildModuleUrl.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Cartographic from '../Core/Cartographic.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport Ellipsoid from '../Core/Ellipsoid.js';\nimport EllipsoidTerrainProvider from '../Core/EllipsoidTerrainProvider.js';\nimport Event from '../Core/Event.js';\nimport ImagerySplitDirection from './ImagerySplitDirection.js';\nimport IntersectionTests from '../Core/IntersectionTests.js';\nimport Ray from '../Core/Ray.js';\nimport Rectangle from '../Core/Rectangle.js';\nimport Resource from '../Core/Resource.js';\nimport ShaderSource from '../Renderer/ShaderSource.js';\nimport Texture from '../Renderer/Texture.js';\nimport GlobeFS from '../Shaders/GlobeFS.js';\nimport GlobeVS from '../Shaders/GlobeVS.js';\nimport GroundAtmosphere from '../Shaders/GroundAtmosphere.js';\nimport when from '../ThirdParty/when.js';\nimport GlobeSurfaceShaderSet from './GlobeSurfaceShaderSet.js';\nimport GlobeSurfaceTileProvider from './GlobeSurfaceTileProvider.js';\nimport ImageryLayerCollection from './ImageryLayerCollection.js';\nimport QuadtreePrimitive from './QuadtreePrimitive.js';\nimport SceneMode from './SceneMode.js';\nimport ShadowMode from './ShadowMode.js';\n\n    /**\n     * The globe rendered in the scene, including its terrain ({@link Globe#terrainProvider})\n     * and imagery layers ({@link Globe#imageryLayers}).  Access the globe using {@link Scene#globe}.\n     *\n     * @alias Globe\n     * @constructor\n     *\n     * @param {Ellipsoid} [ellipsoid=Ellipsoid.WGS84] Determines the size and shape of the\n     * globe.\n     */\n    function Globe(ellipsoid) {\n        ellipsoid = defaultValue(ellipsoid, Ellipsoid.WGS84);\n        var terrainProvider = new EllipsoidTerrainProvider({\n            ellipsoid : ellipsoid\n        });\n        var imageryLayerCollection = new ImageryLayerCollection();\n\n        this._ellipsoid = ellipsoid;\n        this._imageryLayerCollection = imageryLayerCollection;\n\n        this._surfaceShaderSet = new GlobeSurfaceShaderSet();\n        this._material = undefined;\n\n        this._surface = new QuadtreePrimitive({\n            tileProvider : new GlobeSurfaceTileProvider({\n                terrainProvider : terrainProvider,\n                imageryLayers : imageryLayerCollection,\n                surfaceShaderSet : this._surfaceShaderSet\n            })\n        });\n\n        this._terrainProvider = terrainProvider;\n        this._terrainProviderChanged = new Event();\n\n        makeShadersDirty(this);\n\n        /**\n         * Determines if the globe will be shown.\n         *\n         * @type {Boolean}\n         * @default true\n         */\n        this.show = true;\n\n        this._oceanNormalMapResourceDirty = true;\n        this._oceanNormalMapResource = new Resource({\n            url: require('/home/remy/Calypso/Software/TerriaMap/node_modules/terriajs-cesium/Source/Assets/Textures/waterNormalsSmall.jpg')\n        });\n\n        /**\n         * The maximum screen-space error used to drive level-of-detail refinement.  Higher\n         * values will provide better performance but lower visual quality.\n         *\n         * @type {Number}\n         * @default 2\n         */\n        this.maximumScreenSpaceError = 2;\n\n        /**\n         * The size of the terrain tile cache, expressed as a number of tiles.  Any additional\n         * tiles beyond this number will be freed, as long as they aren't needed for rendering\n         * this frame.  A larger number will consume more memory but will show detail faster\n         * when, for example, zooming out and then back in.\n         *\n         * @type {Number}\n         * @default 100\n         */\n        this.tileCacheSize = 100;\n\n        /**\n         * Gets or sets the number of loading descendant tiles that is considered \"too many\".\n         * If a tile has too many loading descendants, that tile will be loaded and rendered before any of\n         * its descendants are loaded and rendered. This means more feedback for the user that something\n         * is happening at the cost of a longer overall load time. Setting this to 0 will cause each\n         * tile level to be loaded successively, significantly increasing load time. Setting it to a large\n         * number (e.g. 1000) will minimize the number of tiles that are loaded but tend to make\n         * detail appear all at once after a long wait.\n         * @type {Number}\n         * @default 20\n         */\n        this.loadingDescendantLimit = 20;\n\n        /**\n         * Gets or sets a value indicating whether the ancestors of rendered tiles should be preloaded.\n         * Setting this to true optimizes the zoom-out experience and provides more detail in\n         * newly-exposed areas when panning. The down side is that it requires loading more tiles.\n         * @type {Boolean}\n         * @default true\n         */\n        this.preloadAncestors = true;\n\n        /**\n         * Gets or sets a value indicating whether the siblings of rendered tiles should be preloaded.\n         * Setting this to true causes tiles with the same parent as a rendered tile to be loaded, even\n         * if they are culled. Setting this to true may provide a better panning experience at the\n         * cost of loading more tiles.\n         * @type {Boolean}\n         * @default false\n         */\n        this.preloadSiblings = false;\n\n        /**\n         * The color to use to highlight terrain fill tiles. If undefined, fill tiles are not\n         * highlighted at all. The alpha value is used to alpha blend with the tile's\n         * actual color. Because terrain fill tiles do not represent the actual terrain surface,\n         * it may be useful in some applications to indicate visually that they are not to be trusted.\n         * @type {Color}\n         * @default undefined\n         */\n        this.fillHighlightColor = undefined;\n\n        /**\n         * Enable lighting the globe with the scene's light source.\n         *\n         * @type {Boolean}\n         * @default false\n         */\n        this.enableLighting = false;\n\n        /**\n         * Enable dynamic lighting effects on atmosphere and fog. This only takes effect\n         * when <code>enableLighting</code> is <code>true</code>.\n         *\n         * @type {Boolean}\n         * @default true\n         */\n        this.dynamicAtmosphereLighting = true;\n\n        /**\n         * Whether dynamic atmosphere lighting uses the sun direction instead of the scene's\n         * light direction. This only takes effect when <code>enableLighting</code> and\n         * <code>dynamicAtmosphereLighting</code> are <code>true</code>.\n         *\n         * @type {Boolean}\n         * @default false\n         */\n        this.dynamicAtmosphereLightingFromSun = false;\n\n        /**\n         * Enable the ground atmosphere, which is drawn over the globe when viewed from a distance between <code>lightingFadeInDistance</code> and <code>lightingFadeOutDistance</code>.\n         *\n         * @demo {@link https://sandcastle.cesium.com/index.html?src=Ground%20Atmosphere.html|Ground atmosphere demo in Sandcastle}\n         *\n         * @type {Boolean}\n         * @default true\n         */\n        this.showGroundAtmosphere = true;\n\n        /**\n         * The distance where everything becomes lit. This only takes effect\n         * when <code>enableLighting</code> or <code>showGroundAtmosphere</code> is <code>true</code>.\n         *\n         * @type {Number}\n         * @default 10000000.0\n         */\n        this.lightingFadeOutDistance = 1.0e7;\n\n        /**\n         * The distance where lighting resumes. This only takes effect\n         * when <code>enableLighting</code> or <code>showGroundAtmosphere</code> is <code>true</code>.\n         *\n         * @type {Number}\n         * @default 20000000.0\n         */\n        this.lightingFadeInDistance = 2.0e7;\n\n        /**\n         * The distance where the darkness of night from the ground atmosphere fades out to a lit ground atmosphere.\n         * This only takes effect when <code>showGroundAtmosphere</code>, <code>enableLighting</code>, and\n         * <code>dynamicAtmosphereLighting</code> are <code>true</code>.\n         *\n         * @type {Number}\n         * @default 10000000.0\n         */\n        this.nightFadeOutDistance = 1.0e7;\n\n        /**\n         * The distance where the darkness of night from the ground atmosphere fades in to an unlit ground atmosphere.\n         * This only takes effect when <code>showGroundAtmosphere</code>, <code>enableLighting</code>, and\n         * <code>dynamicAtmosphereLighting</code> are <code>true</code>.\n         *\n         * @type {Number}\n         * @default 50000000.0\n         */\n        this.nightFadeInDistance = 5.0e7;\n\n        /**\n         * True if an animated wave effect should be shown in areas of the globe\n         * covered by water; otherwise, false.  This property is ignored if the\n         * <code>terrainProvider</code> does not provide a water mask.\n         *\n         * @type {Boolean}\n         * @default true\n         */\n        this.showWaterEffect = true;\n\n        /**\n         * True if primitives such as billboards, polylines, labels, etc. should be depth-tested\n         * against the terrain surface, or false if such primitives should always be drawn on top\n         * of terrain unless they're on the opposite side of the globe.  The disadvantage of depth\n         * testing primitives against terrain is that slight numerical noise or terrain level-of-detail\n         * switched can sometimes make a primitive that should be on the surface disappear underneath it.\n         *\n         * @type {Boolean}\n         * @default false\n         *\n         */\n        this.depthTestAgainstTerrain = false;\n\n        /**\n         * Determines whether the globe casts or receives shadows from light sources. Setting the globe\n         * to cast shadows may impact performance since the terrain is rendered again from the light's perspective.\n         * Currently only terrain that is in view casts shadows. By default the globe does not cast shadows.\n         *\n         * @type {ShadowMode}\n         * @default ShadowMode.RECEIVE_ONLY\n         */\n        this.shadows = ShadowMode.RECEIVE_ONLY;\n\n        /**\n         * The {@link ImagerySplitDirection} to apply, showing the terrain only on\n         * the left or right of the splitter control.\n         *\n         * @type {ImagerySplitDirection}\n         * @default {@link ImagerySplitDirection.NONE}\n         */\n        this.splitDirection = ImagerySplitDirection.NONE;\n\n        /**\n         * The hue shift to apply to the atmosphere. Defaults to 0.0 (no shift).\n         * A hue shift of 1.0 indicates a complete rotation of the hues available.\n         * @type {Number}\n         * @default 0.0\n         */\n        this.atmosphereHueShift = 0.0;\n\n        /**\n         * The saturation shift to apply to the atmosphere. Defaults to 0.0 (no shift).\n         * A saturation shift of -1.0 is monochrome.\n         * @type {Number}\n         * @default 0.0\n         */\n        this.atmosphereSaturationShift = 0.0;\n\n        /**\n         * The brightness shift to apply to the atmosphere. Defaults to 0.0 (no shift).\n         * A brightness shift of -1.0 is complete darkness, which will let space show through.\n         * @type {Number}\n         * @default 0.0\n         */\n        this.atmosphereBrightnessShift = 0.0;\n\n        /**\n         * Whether to show terrain skirts. Terrain skirts are geometry extending downwards from a tile's edges used to hide seams between neighboring tiles.\n         * It may be desirable to hide terrain skirts if terrain is translucent or when viewing terrain from below the surface.\n         *\n         * @type {Boolean}\n         * @default true\n         */\n        this.showSkirts = true;\n\n        /**\n         * Whether to cull back-facing terrain. Set this to false when viewing terrain from below the surface.\n         *\n         * @type {Boolean}\n         * @default true\n         */\n        this.backFaceCulling = true;\n\n        this._oceanNormalMap = undefined;\n        this._zoomedOutOceanSpecularIntensity = undefined;\n    }\n\n    Object.defineProperties(Globe.prototype, {\n        /**\n         * Gets an ellipsoid describing the shape of this globe.\n         * @memberof Globe.prototype\n         * @type {Ellipsoid}\n         */\n        ellipsoid : {\n            get : function() {\n                return this._ellipsoid;\n            }\n        },\n        /**\n         * Gets the collection of image layers that will be rendered on this globe.\n         * @memberof Globe.prototype\n         * @type {ImageryLayerCollection}\n         */\n        imageryLayers : {\n            get : function() {\n                return this._imageryLayerCollection;\n            }\n        },\n        /**\n         * Gets an event that's raised when an imagery layer is added, shown, hidden, moved, or removed.\n         *\n         * @memberof Globe.prototype\n         * @type {Event}\n         * @readonly\n         */\n        imageryLayersUpdatedEvent : {\n            get : function() {\n                return this._surface.tileProvider.imageryLayersUpdatedEvent;\n            }\n        },\n        /**\n         * Returns <code>true</code> when the tile load queue is empty, <code>false</code> otherwise.  When the load queue is empty,\n         * all terrain and imagery for the current view have been loaded.\n         * @memberof Globe.prototype\n         * @type {Boolean}\n         * @readonly\n         */\n        tilesLoaded: {\n            get: function() {\n                if (!defined(this._surface)) {\n                    return true;\n                }\n                return (this._surface.tileProvider.ready && this._surface._tileLoadQueueHigh.length === 0 && this._surface._tileLoadQueueMedium.length === 0 && this._surface._tileLoadQueueLow.length === 0);\n            }\n        },\n        /**\n         * Gets or sets the color of the globe when no imagery is available.\n         * @memberof Globe.prototype\n         * @type {Color}\n         */\n        baseColor : {\n            get : function() {\n                return this._surface.tileProvider.baseColor;\n            },\n            set : function(value) {\n                this._surface.tileProvider.baseColor = value;\n            }\n        },\n        /**\n         * A property specifying a {@link ClippingPlaneCollection} used to selectively disable rendering on the outside of each plane.\n         *\n         * @memberof Globe.prototype\n         * @type {ClippingPlaneCollection}\n         */\n        clippingPlanes : {\n            get : function() {\n                return this._surface.tileProvider.clippingPlanes;\n            },\n            set : function(value) {\n                this._surface.tileProvider.clippingPlanes = value;\n            }\n        },\n        /**\n         * A property specifying a {@link Rectangle} used to limit globe rendering to a cartographic area.\n         * Defaults to the maximum extent of cartographic coordinates.\n         *\n         * @member Globe.prototype\n         * @type {Rectangle}\n         * @default Rectangle.MAX_VALUE\n         */\n        cartographicLimitRectangle : {\n            get : function() {\n                return this._surface.tileProvider.cartographicLimitRectangle;\n            },\n            set : function(value) {\n                if (!defined(value)) {\n                    value = Rectangle.clone(Rectangle.MAX_VALUE);\n                }\n                this._surface.tileProvider.cartographicLimitRectangle = value;\n            }\n        },\n        /**\n         * The normal map to use for rendering waves in the ocean.  Setting this property will\n         * only have an effect if the configured terrain provider includes a water mask.\n         * @memberof Globe.prototype\n         * @type {String}\n         * @default require('/home/remy/Calypso/Software/TerriaMap/node_modules/terriajs-cesium/Source/Assets/Textures/waterNormalsSmall.jpg')\n         */\n        oceanNormalMapUrl: {\n            get: function() {\n                return this._oceanNormalMapResource.url;\n            },\n            set: function(value) {\n                this._oceanNormalMapResource.url = value;\n                this._oceanNormalMapResourceDirty = true;\n            }\n        },\n        /**\n         * The terrain provider providing surface geometry for this globe.\n         * @type {TerrainProvider}\n         *\n         * @memberof Globe.prototype\n         * @type {TerrainProvider}\n         *\n         */\n        terrainProvider : {\n            get : function() {\n                return this._terrainProvider;\n            },\n            set : function(value) {\n                if (value !== this._terrainProvider) {\n                    this._terrainProvider = value;\n                    this._terrainProviderChanged.raiseEvent(value);\n                    if (defined(this._material)) {\n                        makeShadersDirty(this);\n                    }\n                }\n            }\n        },\n        /**\n         * Gets an event that's raised when the terrain provider is changed\n         *\n         * @memberof Globe.prototype\n         * @type {Event}\n         * @readonly\n         */\n        terrainProviderChanged : {\n            get: function() {\n                return this._terrainProviderChanged;\n            }\n        },\n        /**\n         * Gets an event that's raised when the length of the tile load queue has changed since the last render frame.  When the load queue is empty,\n         * all terrain and imagery for the current view have been loaded.  The event passes the new length of the tile load queue.\n         *\n         * @memberof Globe.prototype\n         * @type {Event}\n         */\n        tileLoadProgressEvent : {\n            get: function() {\n                return this._surface.tileLoadProgressEvent;\n            }\n        },\n\n        /**\n         * Gets or sets the material appearance of the Globe.  This can be one of several built-in {@link Material} objects or a custom material, scripted with\n         * {@link https://github.com/CesiumGS/cesium/wiki/Fabric|Fabric}.\n         * @memberof Globe.prototype\n         * @type {Material}\n         */\n        material: {\n            get: function() {\n                return this._material;\n            },\n            set: function(material) {\n                if (this._material !== material) {\n                    this._material = material;\n                    makeShadersDirty(this);\n                }\n            }\n        }\n    });\n\n    function makeShadersDirty(globe) {\n        var defines = [];\n\n        var requireNormals = defined(globe._material) && (globe._material.shaderSource.match(/slope/) || globe._material.shaderSource.match('normalEC'));\n\n        var fragmentSources = [GroundAtmosphere];\n        if (defined(globe._material) && (!requireNormals || globe._terrainProvider.requestVertexNormals)) {\n            fragmentSources.push(globe._material.shaderSource);\n            defines.push('APPLY_MATERIAL');\n            globe._surface._tileProvider.uniformMap = globe._material._uniforms;\n        } else {\n            globe._surface._tileProvider.uniformMap = undefined;\n        }\n        fragmentSources.push(GlobeFS);\n\n        globe._surfaceShaderSet.baseVertexShaderSource = new ShaderSource({\n            sources : [GroundAtmosphere, GlobeVS],\n            defines : defines\n        });\n\n        globe._surfaceShaderSet.baseFragmentShaderSource = new ShaderSource({\n            sources : fragmentSources,\n            defines : defines\n        });\n        globe._surfaceShaderSet.material = globe._material;\n    }\n\n    function createComparePickTileFunction(rayOrigin) {\n        return function(a, b) {\n            var aDist = BoundingSphere.distanceSquaredTo(a.data.pickBoundingSphere, rayOrigin);\n            var bDist = BoundingSphere.distanceSquaredTo(b.data.pickBoundingSphere, rayOrigin);\n\n            return aDist - bDist;\n        };\n    }\n\n    var scratchArray = [];\n    var scratchSphereIntersectionResult = {\n        start : 0.0,\n        stop : 0.0\n    };\n\n    /**\n     * Find an intersection between a ray and the globe surface that was rendered. The ray must be given in world coordinates.\n     *\n     * @param {Ray} ray The ray to test for intersection.\n     * @param {Scene} scene The scene.\n     * @param {Cartesian3} [result] The object onto which to store the result.\n     * @returns {Cartesian3|undefined} The intersection or <code>undefined</code> if none was found.  The returned position is in projected coordinates for 2D and Columbus View.\n     *\n     * @private\n     */\n    Globe.prototype.pickWorldCoordinates = function(ray, scene, result) {\n        \n\n        var mode = scene.mode;\n        var projection = scene.mapProjection;\n\n        var sphereIntersections = scratchArray;\n        sphereIntersections.length = 0;\n\n        var tilesToRender = this._surface._tilesToRender;\n        var length = tilesToRender.length;\n\n        var tile;\n        var i;\n\n        for (i = 0; i < length; ++i) {\n            tile = tilesToRender[i];\n            var surfaceTile = tile.data;\n\n            if (!defined(surfaceTile)) {\n                continue;\n            }\n\n            var boundingVolume = surfaceTile.pickBoundingSphere;\n            if (mode !== SceneMode.SCENE3D) {\n                surfaceTile.pickBoundingSphere = boundingVolume = BoundingSphere.fromRectangleWithHeights2D(tile.rectangle, projection, surfaceTile.tileBoundingRegion.minimumHeight, surfaceTile.tileBoundingRegion.maximumHeight, boundingVolume);\n                Cartesian3.fromElements(boundingVolume.center.z, boundingVolume.center.x, boundingVolume.center.y, boundingVolume.center);\n            } else if (defined(surfaceTile.renderedMesh)) {\n                BoundingSphere.clone(surfaceTile.renderedMesh.boundingSphere3D, boundingVolume);\n            } else {\n                // So wait how did we render this thing then? It shouldn't be possible to get here.\n                continue;\n            }\n\n            var boundingSphereIntersection = IntersectionTests.raySphere(ray, boundingVolume, scratchSphereIntersectionResult);\n            if (defined(boundingSphereIntersection)) {\n                sphereIntersections.push(tile);\n            }\n        }\n\n        sphereIntersections.sort(createComparePickTileFunction(ray.origin));\n\n        var intersection;\n        length = sphereIntersections.length;\n        for (i = 0; i < length; ++i) {\n            intersection = sphereIntersections[i].data.pick(ray, scene.mode, scene.mapProjection, true, result);\n            if (defined(intersection)) {\n                break;\n            }\n        }\n\n        return intersection;\n    };\n\n    /**\n     * Find an intersection between a ray and the globe surface that was rendered. The ray must be given in world coordinates.\n     *\n     * @param {Ray} ray The ray to test for intersection.\n     * @param {Scene} scene The scene.\n     * @param {Cartesian3} [result] The object onto which to store the result.\n     * @returns {IntersectedTriangle|undefined} The intersection or <code>undefined</code> if none was found.\n     *\n     * @example\n     * // find intersection of ray through a pixel and the globe\n     * var ray = scene.camera.getPickRay(windowCoordinates);\n     * var intersection = globe.pick(ray, scene);\n     */\n    Globe.prototype.pickTriangle = function(ray, scene, result) {\n        \n\n        var mode = scene.mode;\n        var projection = scene.mapProjection;\n\n        var sphereIntersections = scratchArray;\n        sphereIntersections.length = 0;\n\n        var tilesToRender = this._surface._tilesToRender;\n        var length = tilesToRender.length;\n\n        var tile;\n        var i;\n\n        for (i = 0; i < length; ++i) {\n            tile = tilesToRender[i];\n            var surfaceTile = tile.data;\n\n            if (!defined(surfaceTile)) {\n                continue;\n            }\n\n            var boundingVolume = surfaceTile.pickBoundingSphere;\n            if (mode !== SceneMode.SCENE3D) {\n                BoundingSphere.fromRectangleWithHeights2D(tile.rectangle, projection, surfaceTile.minimumHeight, surfaceTile.maximumHeight, boundingVolume);\n                Cartesian3.fromElements(boundingVolume.center.z, boundingVolume.center.x, boundingVolume.center.y, boundingVolume.center);\n            } else {\n                BoundingSphere.clone(surfaceTile.boundingSphere3D, boundingVolume);\n            }\n\n            var boundingSphereIntersection = IntersectionTests.raySphere(ray, boundingVolume, scratchSphereIntersectionResult);\n            if (defined(boundingSphereIntersection)) {\n                sphereIntersections.push(tile);\n            }\n        }\n\n        sphereIntersections.sort(createComparePickTileFunction(ray.origin));\n\n        var intersection;\n        length = sphereIntersections.length;\n        for (i = 0; i < length; ++i) {\n            intersection = sphereIntersections[i].data.pickTriangle(ray, scene.mode, scene.mapProjection, true, result);\n            if (defined(intersection)) {\n                intersection.tile = sphereIntersections[i];\n                break;\n            }\n        }\n\n        return intersection;\n    };\n\n    var cartoScratch = new Cartographic();\n    /**\n     * Find an intersection between a ray and the globe surface that was rendered. The ray must be given in world coordinates.\n     *\n     * @param {Ray} ray The ray to test for intersection.\n     * @param {Scene} scene The scene.\n     * @param {Cartesian3} [result] The object onto which to store the result.\n     * @returns {Cartesian3|undefined} The intersection or <code>undefined</code> if none was found.\n     *\n     * @example\n     * // find intersection of ray through a pixel and the globe\n     * var ray = viewer.camera.getPickRay(windowCoordinates);\n     * var intersection = globe.pick(ray, scene);\n     */\n    Globe.prototype.pick = function(ray, scene, result) {\n        result = this.pickWorldCoordinates(ray, scene, result);\n        if (defined(result) && scene.mode !== SceneMode.SCENE3D) {\n            result = Cartesian3.fromElements(result.y, result.z, result.x, result);\n            var carto = scene.mapProjection.unproject(result, cartoScratch);\n            result = scene.globe.ellipsoid.cartographicToCartesian(carto, result);\n        }\n\n        return result;\n    };\n\n    var scratchGetHeightCartesian = new Cartesian3();\n    var scratchGetHeightIntersection = new Cartesian3();\n    var scratchGetHeightCartographic = new Cartographic();\n    var scratchGetHeightRay = new Ray();\n\n    function tileIfContainsCartographic(tile, cartographic) {\n        return defined(tile) && Rectangle.contains(tile.rectangle, cartographic) ? tile : undefined;\n    }\n\n    /**\n     * Get the height of the surface at a given cartographic.\n     *\n     * @param {Cartographic} cartographic The cartographic for which to find the height.\n     * @returns {Number|undefined} The height of the cartographic or undefined if it could not be found.\n     */\n    Globe.prototype.getHeight = function(cartographic) {\n        \n\n        var levelZeroTiles = this._surface._levelZeroTiles;\n        if (!defined(levelZeroTiles)) {\n            return;\n        }\n\n        var tile;\n        var i;\n\n        var length = levelZeroTiles.length;\n        for (i = 0; i < length; ++i) {\n            tile = levelZeroTiles[i];\n            if (Rectangle.contains(tile.rectangle, cartographic)) {\n                break;\n            }\n        }\n\n        if (i >= length) {\n            return undefined;\n        }\n\n        var tileWithMesh = tile;\n\n        while (defined(tile)) {\n            tile = tileIfContainsCartographic(tile._southwestChild, cartographic) ||\n                   tileIfContainsCartographic(tile._southeastChild, cartographic) ||\n                   tileIfContainsCartographic(tile._northwestChild, cartographic) ||\n                   tile._northeastChild;\n\n            if (defined(tile) && defined(tile.data) && defined(tile.data.renderedMesh)) {\n                tileWithMesh = tile;\n            }\n        }\n\n        tile = tileWithMesh;\n\n        // This tile was either rendered or culled.\n        // It is sometimes useful to get a height from a culled tile,\n        // e.g. when we're getting a height in order to place a billboard\n        // on terrain, and the camera is looking at that same billboard.\n        // The culled tile must have a valid mesh, though.\n        if (!defined(tile)) {\n            // Tile was not rendered (culled).\n            return undefined;\n        }\n\n        var ellipsoid = this._surface._tileProvider.tilingScheme.ellipsoid;\n\n        //cartesian has to be on the ellipsoid surface for `ellipsoid.geodeticSurfaceNormal`\n        var cartesian = Cartesian3.fromRadians(cartographic.longitude, cartographic.latitude, 0.0, ellipsoid, scratchGetHeightCartesian);\n\n        var ray = scratchGetHeightRay;\n        var surfaceNormal = ellipsoid.geodeticSurfaceNormal(cartesian, ray.direction);\n\n        // Try to find the intersection point between the surface normal and z-axis.\n        // minimum height (-11500.0) for the terrain set, need to get this information from the terrain provider\n        var rayOrigin = ellipsoid.getSurfaceNormalIntersectionWithZAxis(cartesian, 11500.0, ray.origin);\n\n        // Theoretically, not with Earth datums, the intersection point can be outside the ellipsoid\n        if (!defined(rayOrigin)) {\n            // intersection point is outside the ellipsoid, try other value\n            // minimum height (-11500.0) for the terrain set, need to get this information from the terrain provider\n            var minimumHeight;\n            if (defined(tile.data.tileBoundingRegion)) {\n                minimumHeight = tile.data.tileBoundingRegion.minimumHeight;\n            }\n            var magnitude = Math.min(defaultValue(minimumHeight, 0.0), -11500.0);\n\n            // multiply by the *positive* value of the magnitude\n            var vectorToMinimumPoint = Cartesian3.multiplyByScalar(surfaceNormal, Math.abs(magnitude) + 1, scratchGetHeightIntersection);\n            Cartesian3.subtract(cartesian, vectorToMinimumPoint, ray.origin);\n        }\n\n        var intersection = tile.data.pick(ray, undefined, undefined, false, scratchGetHeightIntersection);\n        if (!defined(intersection)) {\n            return undefined;\n        }\n\n        return ellipsoid.cartesianToCartographic(intersection, scratchGetHeightCartographic).height;\n    };\n\n    /**\n     * @private\n     */\n    Globe.prototype.update = function(frameState) {\n        if (!this.show) {\n            return;\n        }\n\n        if (frameState.passes.render) {\n            this._surface.update(frameState);\n        }\n    };\n\n    /**\n     * @private\n     */\n    Globe.prototype.beginFrame = function(frameState) {\n        var surface = this._surface;\n        var tileProvider = surface.tileProvider;\n        var terrainProvider = this.terrainProvider;\n        var hasWaterMask = this.showWaterEffect && terrainProvider.ready && terrainProvider.hasWaterMask;\n\n        if (hasWaterMask && this._oceanNormalMapResourceDirty) {\n            // url changed, load new normal map asynchronously\n            this._oceanNormalMapResourceDirty = false;\n            var oceanNormalMapResource = this._oceanNormalMapResource;\n            var oceanNormalMapUrl =  oceanNormalMapResource.url;\n            if (defined(oceanNormalMapUrl)) {\n                var that = this;\n                when(oceanNormalMapResource.fetchImage(), function(image) {\n                    if (oceanNormalMapUrl !== that._oceanNormalMapResource.url) {\n                        // url changed while we were loading\n                        return;\n                    }\n\n                    that._oceanNormalMap = that._oceanNormalMap && that._oceanNormalMap.destroy();\n                    that._oceanNormalMap = new Texture({\n                        context : frameState.context,\n                        source : image\n                    });\n                });\n            } else {\n                this._oceanNormalMap = this._oceanNormalMap && this._oceanNormalMap.destroy();\n            }\n        }\n\n        var pass = frameState.passes;\n        var mode = frameState.mode;\n\n        if (pass.render) {\n            if (this.showGroundAtmosphere) {\n                this._zoomedOutOceanSpecularIntensity = 0.4;\n            } else {\n                this._zoomedOutOceanSpecularIntensity = 0.5;\n            }\n\n            surface.maximumScreenSpaceError = this.maximumScreenSpaceError;\n            surface.tileCacheSize = this.tileCacheSize;\n            surface.loadingDescendantLimit = this.loadingDescendantLimit;\n            surface.preloadAncestors = this.preloadAncestors;\n            surface.preloadSiblings = this.preloadSiblings;\n\n            tileProvider.terrainProvider = this.terrainProvider;\n            tileProvider.lightingFadeOutDistance = this.lightingFadeOutDistance;\n            tileProvider.lightingFadeInDistance = this.lightingFadeInDistance;\n            tileProvider.nightFadeOutDistance = this.nightFadeOutDistance;\n            tileProvider.nightFadeInDistance = this.nightFadeInDistance;\n            tileProvider.zoomedOutOceanSpecularIntensity = mode === SceneMode.SCENE3D ? this._zoomedOutOceanSpecularIntensity : 0.0;\n            tileProvider.hasWaterMask = hasWaterMask;\n            tileProvider.oceanNormalMap = this._oceanNormalMap;\n            tileProvider.enableLighting = this.enableLighting;\n            tileProvider.dynamicAtmosphereLighting = this.dynamicAtmosphereLighting;\n            tileProvider.dynamicAtmosphereLightingFromSun = this.dynamicAtmosphereLightingFromSun;\n            tileProvider.showGroundAtmosphere = this.showGroundAtmosphere;\n            tileProvider.shadows = this.shadows;\n            tileProvider.splitDirection = this.splitDirection;\n            tileProvider.hueShift = this.atmosphereHueShift;\n            tileProvider.saturationShift = this.atmosphereSaturationShift;\n            tileProvider.brightnessShift = this.atmosphereBrightnessShift;\n            tileProvider.fillHighlightColor = this.fillHighlightColor;\n            tileProvider.showSkirts = this.showSkirts;\n            tileProvider.backFaceCulling = this.backFaceCulling;\n            surface.beginFrame(frameState);\n        }\n    };\n\n    /**\n     * @private\n     */\n    Globe.prototype.render = function(frameState) {\n        if (!this.show) {\n            return;\n        }\n\n        if (defined(this._material)) {\n            this._material.update(frameState.context);\n        }\n\n        this._surface.render(frameState);\n    };\n\n    /**\n     * @private\n     */\n    Globe.prototype.endFrame = function(frameState) {\n        if (!this.show) {\n            return;\n        }\n\n        if (frameState.passes.render) {\n            this._surface.endFrame(frameState);\n        }\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <br /><br />\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     *\n     * @returns {Boolean} True if this object was destroyed; otherwise, false.\n     *\n     * @see Globe#destroy\n     */\n    Globe.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n     * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n     * <br /><br />\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     *\n     * @example\n     * globe = globe && globe.destroy();\n     *\n     * @see Globe#isDestroyed\n     */\n    Globe.prototype.destroy = function() {\n        this._surfaceShaderSet = this._surfaceShaderSet && this._surfaceShaderSet.destroy();\n        this._surface = this._surface && this._surface.destroy();\n        this._oceanNormalMap = this._oceanNormalMap && this._oceanNormalMap.destroy();\n        return destroyObject(this);\n    };\nexport default Globe;\n","\n    /**\n     * A structure containing the orientation data computed at a particular time. The data\n     * represents the direction of the pole of rotation and the rotation about that pole.\n     * <p>\n     * These parameters correspond to the parameters in the Report from the IAU/IAG Working Group\n     * except that they are expressed in radians.\n     * </p>\n     *\n     * @exports IauOrientationParameters\n     *\n     * @private\n     */\n    function IauOrientationParameters(rightAscension, declination, rotation, rotationRate) {\n        /**\n         * The right ascension of the north pole of the body with respect to\n         * the International Celestial Reference Frame, in radians.\n         * @type {Number}\n         *\n         * @private\n         */\n        this.rightAscension = rightAscension;\n\n        /**\n         * The declination of the north pole of the body with respect to\n         * the International Celestial Reference Frame, in radians.\n         * @type {Number}\n         *\n         * @private\n         */\n        this.declination = declination;\n\n        /**\n         * The rotation about the north pole used to align a set of axes with\n         * the meridian defined by the IAU report, in radians.\n         * @type {Number}\n         *\n         * @private\n         */\n        this.rotation = rotation;\n\n        /**\n         * The instantaneous rotation rate about the north pole, in radians per second.\n         * @type {Number}\n         *\n         * @private\n         */\n        this.rotationRate = rotationRate;\n    }\nexport default IauOrientationParameters;\n","import defined from './defined.js';\nimport IauOrientationParameters from './IauOrientationParameters.js';\nimport JulianDate from './JulianDate.js';\nimport CesiumMath from './Math.js';\nimport TimeConstants from './TimeConstants.js';\n\n    /**\n     * This is a collection of the orientation information available for central bodies.\n     * The data comes from the Report of the IAU/IAG Working Group on Cartographic\n     * Coordinates and Rotational Elements: 2000.\n     *\n     * @exports Iau2000Orientation\n     *\n     * @private\n     */\n    var Iau2000Orientation = {};\n\n    var TdtMinusTai = 32.184;\n    var J2000d = 2451545.0;\n\n    var c1 = -0.0529921;\n    var c2 = -0.1059842;\n    var c3 = 13.0120009;\n    var c4 = 13.3407154;\n    var c5 = 0.9856003;\n    var c6 = 26.4057084;\n    var c7 = 13.0649930;\n    var c8 = 0.3287146;\n    var c9 = 1.7484877;\n    var c10 = -0.1589763;\n    var c11 = 0.0036096;\n    var c12 = 0.1643573;\n    var c13 = 12.9590088;\n    var dateTT = new JulianDate();\n\n    /**\n     * Compute the orientation parameters for the Moon.\n     *\n     * @param {JulianDate} [date=JulianDate.now()] The date to evaluate the parameters.\n     * @param {IauOrientationParameters} [result] The object onto which to store the result.\n     * @returns {IauOrientationParameters} The modified result parameter or a new instance representing the orientation of the Earth's Moon.\n     */\n    Iau2000Orientation.ComputeMoon = function(date, result) {\n        if (!defined(date)) {\n            date = JulianDate.now();\n        }\n\n        dateTT = JulianDate.addSeconds(date, TdtMinusTai, dateTT);\n        var d = JulianDate.totalDays(dateTT) - J2000d;\n        var T = d / TimeConstants.DAYS_PER_JULIAN_CENTURY;\n\n        var E1 = (125.045 + c1 * d) * CesiumMath.RADIANS_PER_DEGREE;\n        var E2 = (250.089 + c2 * d) * CesiumMath.RADIANS_PER_DEGREE;\n        var E3 = (260.008 + c3 * d) * CesiumMath.RADIANS_PER_DEGREE;\n        var E4 = (176.625 + c4 * d) * CesiumMath.RADIANS_PER_DEGREE;\n        var E5 = (357.529 + c5 * d) * CesiumMath.RADIANS_PER_DEGREE;\n        var E6 = (311.589 + c6 * d) * CesiumMath.RADIANS_PER_DEGREE;\n        var E7 = (134.963 + c7 * d) * CesiumMath.RADIANS_PER_DEGREE;\n        var E8 = (276.617 + c8 * d) * CesiumMath.RADIANS_PER_DEGREE;\n        var E9 = (34.226 + c9 * d) * CesiumMath.RADIANS_PER_DEGREE;\n        var E10 = (15.134 + c10 * d) * CesiumMath.RADIANS_PER_DEGREE;\n        var E11 = (119.743 + c11 * d) * CesiumMath.RADIANS_PER_DEGREE;\n        var E12 = (239.961 + c12 * d) * CesiumMath.RADIANS_PER_DEGREE;\n        var E13 = (25.053 + c13 * d) * CesiumMath.RADIANS_PER_DEGREE;\n\n        var sinE1 = Math.sin(E1);\n        var sinE2 = Math.sin(E2);\n        var sinE3 = Math.sin(E3);\n        var sinE4 = Math.sin(E4);\n        var sinE5 = Math.sin(E5);\n        var sinE6 = Math.sin(E6);\n        var sinE7 = Math.sin(E7);\n        var sinE8 = Math.sin(E8);\n        var sinE9 = Math.sin(E9);\n        var sinE10 = Math.sin(E10);\n        var sinE11 = Math.sin(E11);\n        var sinE12 = Math.sin(E12);\n        var sinE13 = Math.sin(E13);\n\n        var cosE1 = Math.cos(E1);\n        var cosE2 = Math.cos(E2);\n        var cosE3 = Math.cos(E3);\n        var cosE4 = Math.cos(E4);\n        var cosE5 = Math.cos(E5);\n        var cosE6 = Math.cos(E6);\n        var cosE7 = Math.cos(E7);\n        var cosE8 = Math.cos(E8);\n        var cosE9 = Math.cos(E9);\n        var cosE10 = Math.cos(E10);\n        var cosE11 = Math.cos(E11);\n        var cosE12 = Math.cos(E12);\n        var cosE13 = Math.cos(E13);\n\n        var rightAscension = (269.9949 + 0.0031 * T - 3.8787 * sinE1 - 0.1204 * sinE2 +\n            0.0700 * sinE3 - 0.0172 * sinE4 + 0.0072 * sinE6 -\n            0.0052 * sinE10 + 0.0043 * sinE13) *\n            CesiumMath.RADIANS_PER_DEGREE;\n        var declination = (66.5392 + 0.013 * T + 1.5419 * cosE1 + 0.0239 * cosE2 -\n            0.0278 * cosE3 + 0.0068 * cosE4 - 0.0029 * cosE6 +\n            0.0009 * cosE7 + 0.0008 * cosE10 - 0.0009 * cosE13) *\n            CesiumMath.RADIANS_PER_DEGREE;\n        var rotation = (38.3213 + 13.17635815 * d - 1.4e-12 * d * d + 3.5610 * sinE1 +\n            0.1208 * sinE2 - 0.0642 * sinE3 + 0.0158 * sinE4 +\n            0.0252 * sinE5 - 0.0066 * sinE6 - 0.0047 * sinE7 -\n            0.0046 * sinE8 + 0.0028 * sinE9 + 0.0052 * sinE10 +\n            0.004 * sinE11 + 0.0019 * sinE12 - 0.0044 * sinE13) *\n            CesiumMath.RADIANS_PER_DEGREE;\n\n        var rotationRate = ((13.17635815 - 1.4e-12 * (2.0 * d)) +\n            3.5610 * cosE1 * c1 +\n            0.1208 * cosE2*c2 - 0.0642 * cosE3*c3 + 0.0158 * cosE4*c4 +\n            0.0252 * cosE5*c5 - 0.0066 * cosE6*c6 - 0.0047 * cosE7*c7 -\n            0.0046 * cosE8*c8 + 0.0028 * cosE9*c9 + 0.0052 * cosE10*c10 +\n            0.004 * cosE11*c11 + 0.0019 * cosE12*c12 - 0.0044 * cosE13*c13) /\n            86400.0 * CesiumMath.RADIANS_PER_DEGREE;\n\n        if (!defined(result)) {\n            result = new IauOrientationParameters();\n        }\n\n        result.rightAscension = rightAscension;\n        result.declination = declination;\n        result.rotation = rotation;\n        result.rotationRate = rotationRate;\n\n        return result;\n    };\nexport default Iau2000Orientation;\n","import Cartesian3 from './Cartesian3.js';\nimport defined from './defined.js';\nimport Iau2000Orientation from './Iau2000Orientation.js';\nimport JulianDate from './JulianDate.js';\nimport CesiumMath from './Math.js';\nimport Matrix3 from './Matrix3.js';\nimport Quaternion from './Quaternion.js';\n\n    /**\n     * The Axes representing the orientation of a Globe as represented by the data\n     * from the IAU/IAG Working Group reports on rotational elements.\n     * @alias IauOrientationAxes\n     * @constructor\n     *\n     * @param {IauOrientationAxes~ComputeFunction} [computeFunction] The function that computes the {@link IauOrientationParameters} given a {@link JulianDate}.\n     *\n     * @see Iau2000Orientation\n     *\n     * @private\n     */\n    function IauOrientationAxes(computeFunction) {\n        if (!defined(computeFunction) || typeof computeFunction !== 'function') {\n            computeFunction = Iau2000Orientation.ComputeMoon;\n        }\n\n        this._computeFunction = computeFunction;\n    }\n\n    var xAxisScratch = new Cartesian3();\n    var yAxisScratch = new Cartesian3();\n    var zAxisScratch = new Cartesian3();\n\n    function computeRotationMatrix(alpha, delta, result) {\n        var xAxis = xAxisScratch;\n        xAxis.x = Math.cos(alpha + CesiumMath.PI_OVER_TWO);\n        xAxis.y = Math.sin(alpha + CesiumMath.PI_OVER_TWO);\n        xAxis.z = 0.0;\n\n        var cosDec = Math.cos(delta);\n\n        var zAxis = zAxisScratch;\n        zAxis.x = cosDec * Math.cos(alpha);\n        zAxis.y = cosDec * Math.sin(alpha);\n        zAxis.z = Math.sin(delta);\n\n        var yAxis = Cartesian3.cross(zAxis, xAxis, yAxisScratch);\n\n        if (!defined(result)) {\n            result = new Matrix3();\n        }\n\n        result[0] = xAxis.x;\n        result[1] = yAxis.x;\n        result[2] = zAxis.x;\n        result[3] = xAxis.y;\n        result[4] = yAxis.y;\n        result[5] = zAxis.y;\n        result[6] = xAxis.z;\n        result[7] = yAxis.z;\n        result[8] = zAxis.z;\n\n        return result;\n    }\n\n    var rotMtxScratch = new Matrix3();\n    var quatScratch = new Quaternion();\n\n    /**\n     * Computes a rotation from ICRF to a Globe's Fixed axes.\n     *\n     * @param {JulianDate} date The date to evaluate the matrix.\n     * @param {Matrix3} result The object onto which to store the result.\n     * @returns {Matrix3} The modified result parameter or a new instance of the rotation from ICRF to Fixed.\n     */\n    IauOrientationAxes.prototype.evaluate = function(date, result) {\n        if (!defined(date)) {\n            date = JulianDate.now();\n        }\n\n        var alphaDeltaW = this._computeFunction(date);\n        var precMtx = computeRotationMatrix(alphaDeltaW.rightAscension, alphaDeltaW.declination, result);\n\n        var rot = CesiumMath.zeroToTwoPi(alphaDeltaW.rotation);\n        var quat = Quaternion.fromAxisAngle(Cartesian3.UNIT_Z, rot, quatScratch);\n        var rotMtx = Matrix3.fromQuaternion(Quaternion.conjugate(quat, quat), rotMtxScratch);\n\n        var cbi2cbf = Matrix3.multiply(rotMtx, precMtx, precMtx);\n        return cbi2cbf;\n    };\n\n    /**\n     * A function that computes the {@link IauOrientationParameters} for a {@link JulianDate}.\n     * @callback IauOrientationAxes~ComputeFunction\n     * @param {JulianDate} date The date to evaluate the parameters.\n     * @returns {IauOrientationParameters} The orientation parameters.\n     */\nexport default IauOrientationAxes;\n","import Cartesian3 from './Cartesian3.js';\nimport defined from './defined.js';\nimport DeveloperError from './DeveloperError.js';\nimport JulianDate from './JulianDate.js';\nimport CesiumMath from './Math.js';\nimport Matrix3 from './Matrix3.js';\nimport TimeConstants from './TimeConstants.js';\nimport TimeStandard from './TimeStandard.js';\n\n    /**\n     * Contains functions for finding the Cartesian coordinates of the sun and the moon in the\n     * Earth-centered inertial frame.\n     *\n     * @exports Simon1994PlanetaryPositions\n     */\n    var Simon1994PlanetaryPositions = {};\n\n    function computeTdbMinusTtSpice(daysSinceJ2000InTerrestrialTime) {\n        /* STK Comments ------------------------------------------------------\n         * This function uses constants designed to be consistent with\n         * the SPICE Toolkit from JPL version N0051 (unitim.c)\n         * M0 = 6.239996\n         * M0Dot = 1.99096871e-7 rad/s = 0.01720197 rad/d\n         * EARTH_ECC = 1.671e-2\n         * TDB_AMPL = 1.657e-3 secs\n         *--------------------------------------------------------------------*/\n\n        //* Values taken as specified in STK Comments except: 0.01720197 rad/day = 1.99096871e-7 rad/sec\n        //* Here we use the more precise value taken from the SPICE value 1.99096871e-7 rad/sec converted to rad/day\n        //* All other constants are consistent with the SPICE implementation of the TDB conversion\n        //* except where we treat the independent time parameter to be in TT instead of TDB.\n        //* This is an approximation made to facilitate performance due to the higher prevalance of\n        //* the TT2TDB conversion over TDB2TT in order to avoid having to iterate when converting to TDB for the JPL ephemeris.\n        //* Days are used instead of seconds to provide a slight improvement in numerical precision.\n\n        //* For more information see:\n        //* http://www.cv.nrao.edu/~rfisher/Ephemerides/times.html#TDB\n        //* ftp://ssd.jpl.nasa.gov/pub/eph/planets/ioms/ExplSupplChap8.pdf\n\n        var g = 6.239996 + (0.0172019696544) * daysSinceJ2000InTerrestrialTime;\n        return 1.657e-3 * Math.sin(g + 1.671e-2 * Math.sin(g));\n    }\n\n    var TdtMinusTai = 32.184;\n    var J2000d = 2451545;\n    function taiToTdb(date, result) {\n        //Converts TAI to TT\n        result = JulianDate.addSeconds(date, TdtMinusTai, result);\n\n        //Converts TT to TDB\n        var days = JulianDate.totalDays(result) - J2000d;\n        result = JulianDate.addSeconds(result, computeTdbMinusTtSpice(days), result);\n\n        return result;\n    }\n\n    var epoch = new JulianDate(2451545, 0, TimeStandard.TAI); //Actually TDB (not TAI)\n    var MetersPerKilometer = 1000.0;\n    var RadiansPerDegree = CesiumMath.RADIANS_PER_DEGREE;\n    var RadiansPerArcSecond = CesiumMath.RADIANS_PER_ARCSECOND;\n    var MetersPerAstronomicalUnit = 1.49597870e+11; // IAU 1976 value\n\n    var perifocalToEquatorial = new Matrix3();\n    function elementsToCartesian(semimajorAxis, eccentricity, inclination, longitudeOfPerigee, longitudeOfNode, meanLongitude, result) {\n        if (inclination < 0.0) {\n            inclination = -inclination;\n            longitudeOfNode += CesiumMath.PI;\n        }\n\n        \n\n        var radiusOfPeriapsis = semimajorAxis * (1.0 - eccentricity);\n        var argumentOfPeriapsis = longitudeOfPerigee - longitudeOfNode;\n        var rightAscensionOfAscendingNode = longitudeOfNode;\n        var trueAnomaly = meanAnomalyToTrueAnomaly(meanLongitude - longitudeOfPerigee, eccentricity);\n        var type = chooseOrbit(eccentricity, 0.0);\n\n        \n\n        perifocalToCartesianMatrix(argumentOfPeriapsis, inclination, rightAscensionOfAscendingNode, perifocalToEquatorial);\n        var semilatus = radiusOfPeriapsis * (1.0 + eccentricity);\n        var costheta = Math.cos(trueAnomaly);\n        var sintheta = Math.sin(trueAnomaly);\n\n        var denom = (1.0 + eccentricity * costheta);\n\n        \n\n        var radius = semilatus / denom;\n        if (!defined(result)) {\n            result = new Cartesian3(radius * costheta, radius * sintheta, 0.0);\n        } else {\n            result.x = radius * costheta;\n            result.y = radius * sintheta;\n            result.z = 0.0;\n        }\n\n        return Matrix3.multiplyByVector(perifocalToEquatorial, result, result);\n    }\n\n    function chooseOrbit(eccentricity, tolerance) {\n        \n\n        if (eccentricity <= tolerance) {\n            return 'Circular';\n        } else if (eccentricity < 1.0 - tolerance) {\n            return 'Elliptical';\n        } else if (eccentricity <= 1.0 + tolerance) {\n            return 'Parabolic';\n        }\n        return 'Hyperbolic';\n    }\n\n    // Calculates the true anomaly given the mean anomaly and the eccentricity.\n    function meanAnomalyToTrueAnomaly(meanAnomaly, eccentricity) {\n        \n\n        var eccentricAnomaly = meanAnomalyToEccentricAnomaly(meanAnomaly, eccentricity);\n        return eccentricAnomalyToTrueAnomaly(eccentricAnomaly, eccentricity);\n    }\n\n    var maxIterationCount = 50;\n    var keplerEqConvergence = CesiumMath.EPSILON8;\n    // Calculates the eccentric anomaly given the mean anomaly and the eccentricity.\n    function meanAnomalyToEccentricAnomaly(meanAnomaly, eccentricity) {\n        \n\n        var revs = Math.floor(meanAnomaly / CesiumMath.TWO_PI);\n\n        // Find angle in current revolution\n        meanAnomaly -= revs * CesiumMath.TWO_PI;\n\n        // calculate starting value for iteration sequence\n        var iterationValue = meanAnomaly + (eccentricity * Math.sin(meanAnomaly)) /\n            (1.0 - Math.sin(meanAnomaly + eccentricity) + Math.sin(meanAnomaly));\n\n        // Perform Newton-Raphson iteration on Kepler's equation\n        var eccentricAnomaly = Number.MAX_VALUE;\n\n        var count;\n        for (count = 0;\n            count < maxIterationCount && Math.abs(eccentricAnomaly - iterationValue) > keplerEqConvergence;\n            ++count)\n        {\n            eccentricAnomaly = iterationValue;\n            var NRfunction = eccentricAnomaly - eccentricity * Math.sin(eccentricAnomaly) - meanAnomaly;\n            var dNRfunction = 1 - eccentricity * Math.cos(eccentricAnomaly);\n            iterationValue = eccentricAnomaly - NRfunction / dNRfunction;\n        }\n\n        \n\n        eccentricAnomaly = iterationValue + revs * CesiumMath.TWO_PI;\n        return eccentricAnomaly;\n    }\n\n     // Calculates the true anomaly given the eccentric anomaly and the eccentricity.\n    function eccentricAnomalyToTrueAnomaly(eccentricAnomaly, eccentricity) {\n        \n\n        // Calculate the number of previous revolutions\n        var revs = Math.floor(eccentricAnomaly / CesiumMath.TWO_PI);\n\n        // Find angle in current revolution\n        eccentricAnomaly -= revs * CesiumMath.TWO_PI;\n\n        // Calculate true anomaly from eccentric anomaly\n        var trueAnomalyX = Math.cos(eccentricAnomaly) - eccentricity;\n        var trueAnomalyY = Math.sin(eccentricAnomaly) * Math.sqrt(1 - eccentricity * eccentricity);\n\n        var trueAnomaly = Math.atan2(trueAnomalyY, trueAnomalyX);\n\n        // Ensure the correct quadrant\n        trueAnomaly = CesiumMath.zeroToTwoPi(trueAnomaly);\n        if (eccentricAnomaly < 0)\n        {\n            trueAnomaly -= CesiumMath.TWO_PI;\n        }\n\n        // Add on previous revolutions\n        trueAnomaly += revs * CesiumMath.TWO_PI;\n\n        return trueAnomaly;\n    }\n\n     // Calculates the transformation matrix to convert from the perifocal (PQW) coordinate\n     // system to inertial cartesian coordinates.\n    function perifocalToCartesianMatrix(argumentOfPeriapsis, inclination, rightAscension, result) {\n        \n\n        var cosap = Math.cos(argumentOfPeriapsis);\n        var sinap = Math.sin(argumentOfPeriapsis);\n\n        var cosi = Math.cos(inclination);\n        var sini = Math.sin(inclination);\n\n        var cosraan = Math.cos(rightAscension);\n        var sinraan = Math.sin(rightAscension);\n        if (!defined(result)) {\n            result = new Matrix3(\n                    cosraan * cosap - sinraan * sinap * cosi,\n                    -cosraan * sinap - sinraan * cosap * cosi,\n                    sinraan * sini,\n\n                    sinraan * cosap + cosraan * sinap * cosi,\n                    -sinraan * sinap + cosraan * cosap * cosi,\n                    -cosraan * sini,\n\n                    sinap * sini,\n                    cosap * sini,\n                    cosi);\n        } else {\n            result[0] = cosraan * cosap - sinraan * sinap * cosi;\n            result[1] = sinraan * cosap + cosraan * sinap * cosi;\n            result[2] = sinap * sini;\n            result[3] = -cosraan * sinap - sinraan * cosap * cosi;\n            result[4] = -sinraan * sinap + cosraan * cosap * cosi;\n            result[5] = cosap * sini;\n            result[6] = sinraan * sini;\n            result[7] = -cosraan * sini;\n            result[8] = cosi;\n        }\n        return result;\n    }\n\n    // From section 5.8\n    var semiMajorAxis0 = 1.0000010178 * MetersPerAstronomicalUnit;\n    var meanLongitude0 = 100.46645683 * RadiansPerDegree;\n    var meanLongitude1 = 1295977422.83429 * RadiansPerArcSecond;\n\n    // From table 6\n    var p1u = 16002;\n    var p2u = 21863;\n    var p3u = 32004;\n    var p4u = 10931;\n    var p5u = 14529;\n    var p6u = 16368;\n    var p7u = 15318;\n    var p8u = 32794;\n\n    var Ca1 = 64 * 1e-7 * MetersPerAstronomicalUnit;\n    var Ca2 = -152 * 1e-7 * MetersPerAstronomicalUnit;\n    var Ca3 = 62 * 1e-7 * MetersPerAstronomicalUnit;\n    var Ca4 = -8 * 1e-7 * MetersPerAstronomicalUnit;\n    var Ca5 = 32 * 1e-7 * MetersPerAstronomicalUnit;\n    var Ca6 = -41 * 1e-7 * MetersPerAstronomicalUnit;\n    var Ca7 = 19 * 1e-7 * MetersPerAstronomicalUnit;\n    var Ca8 = -11 * 1e-7 * MetersPerAstronomicalUnit;\n\n    var Sa1 = -150 * 1e-7 * MetersPerAstronomicalUnit;\n    var Sa2 = -46 * 1e-7 * MetersPerAstronomicalUnit;\n    var Sa3 = 68 * 1e-7 * MetersPerAstronomicalUnit;\n    var Sa4 = 54 * 1e-7 * MetersPerAstronomicalUnit;\n    var Sa5 = 14 * 1e-7 * MetersPerAstronomicalUnit;\n    var Sa6 = 24 * 1e-7 * MetersPerAstronomicalUnit;\n    var Sa7 = -28 * 1e-7 * MetersPerAstronomicalUnit;\n    var Sa8 = 22 * 1e-7 * MetersPerAstronomicalUnit;\n\n    var q1u = 10;\n    var q2u = 16002;\n    var q3u = 21863;\n    var q4u = 10931;\n    var q5u = 1473;\n    var q6u = 32004;\n    var q7u = 4387;\n    var q8u = 73;\n\n    var Cl1 = -325 * 1e-7;\n    var Cl2 = -322 * 1e-7;\n    var Cl3 = -79 * 1e-7;\n    var Cl4 = 232 * 1e-7;\n    var Cl5 = -52 * 1e-7;\n    var Cl6 = 97 * 1e-7;\n    var Cl7 = 55 * 1e-7;\n    var Cl8 = -41 * 1e-7;\n\n    var Sl1 = -105 * 1e-7;\n    var Sl2 = -137 * 1e-7;\n    var Sl3 = 258 * 1e-7;\n    var Sl4 = 35 * 1e-7;\n    var Sl5 = -116 * 1e-7;\n    var Sl6 = -88 * 1e-7;\n    var Sl7 = -112 * 1e-7;\n    var Sl8 = -80 * 1e-7;\n\n    var scratchDate = new JulianDate(0, 0.0, TimeStandard.TAI);\n     // Gets a point describing the motion of the Earth-Moon barycenter according to the equations described in section 6.\n    function computeSimonEarthMoonBarycenter(date, result) {\n\n        // t is thousands of years from J2000 TDB\n        taiToTdb(date, scratchDate);\n        var x = (scratchDate.dayNumber - epoch.dayNumber) + ((scratchDate.secondsOfDay - epoch.secondsOfDay)/TimeConstants.SECONDS_PER_DAY);\n        var t = x / (TimeConstants.DAYS_PER_JULIAN_CENTURY * 10.0);\n\n        var u = 0.35953620 * t;\n        var semimajorAxis = semiMajorAxis0 +\n                            Ca1 * Math.cos(p1u * u) + Sa1 * Math.sin(p1u * u) +\n                            Ca2 * Math.cos(p2u * u) + Sa2 * Math.sin(p2u * u) +\n                            Ca3 * Math.cos(p3u * u) + Sa3 * Math.sin(p3u * u) +\n                            Ca4 * Math.cos(p4u * u) + Sa4 * Math.sin(p4u * u) +\n                            Ca5 * Math.cos(p5u * u) + Sa5 * Math.sin(p5u * u) +\n                            Ca6 * Math.cos(p6u * u) + Sa6 * Math.sin(p6u * u) +\n                            Ca7 * Math.cos(p7u * u) + Sa7 * Math.sin(p7u * u) +\n                            Ca8 * Math.cos(p8u * u) + Sa8 * Math.sin(p8u * u);\n        var meanLongitude = meanLongitude0 + meanLongitude1 * t +\n                            Cl1 * Math.cos(q1u * u) + Sl1 * Math.sin(q1u * u) +\n                            Cl2 * Math.cos(q2u * u) + Sl2 * Math.sin(q2u * u) +\n                            Cl3 * Math.cos(q3u * u) + Sl3 * Math.sin(q3u * u) +\n                            Cl4 * Math.cos(q4u * u) + Sl4 * Math.sin(q4u * u) +\n                            Cl5 * Math.cos(q5u * u) + Sl5 * Math.sin(q5u * u) +\n                            Cl6 * Math.cos(q6u * u) + Sl6 * Math.sin(q6u * u) +\n                            Cl7 * Math.cos(q7u * u) + Sl7 * Math.sin(q7u * u) +\n                            Cl8 * Math.cos(q8u * u) + Sl8 * Math.sin(q8u * u);\n\n        // All constants in this part are from section 5.8\n        var eccentricity = 0.0167086342 - 0.0004203654 * t;\n        var longitudeOfPerigee = 102.93734808 * RadiansPerDegree + 11612.35290 * RadiansPerArcSecond * t;\n        var inclination = 469.97289 * RadiansPerArcSecond * t;\n        var longitudeOfNode = 174.87317577 * RadiansPerDegree - 8679.27034 * RadiansPerArcSecond * t;\n\n        return elementsToCartesian(semimajorAxis, eccentricity, inclination, longitudeOfPerigee,\n                longitudeOfNode, meanLongitude, result);\n    }\n\n     // Gets a point describing the position of the moon according to the equations described in section 4.\n    function computeSimonMoon(date, result) {\n        taiToTdb(date, scratchDate);\n        var x = (scratchDate.dayNumber - epoch.dayNumber) + ((scratchDate.secondsOfDay - epoch.secondsOfDay)/TimeConstants.SECONDS_PER_DAY);\n        var t = x / (TimeConstants.DAYS_PER_JULIAN_CENTURY);\n        var t2 = t * t;\n        var t3 = t2 * t;\n        var t4 = t3 * t;\n\n        // Terms from section 3.4 (b.1)\n        var semimajorAxis = 383397.7725 + 0.0040 * t;\n        var eccentricity = 0.055545526 - 0.000000016 * t;\n        var inclinationConstant = 5.15668983 * RadiansPerDegree;\n        var inclinationSecPart = -0.00008 * t + 0.02966 * t2 -\n                                  0.000042 * t3 - 0.00000013 * t4;\n        var longitudeOfPerigeeConstant = 83.35324312 * RadiansPerDegree;\n        var longitudeOfPerigeeSecPart = 14643420.2669 * t - 38.2702 * t2 -\n                                        0.045047 * t3 + 0.00021301 * t4;\n        var longitudeOfNodeConstant = 125.04455501 * RadiansPerDegree;\n        var longitudeOfNodeSecPart = -6967919.3631 * t + 6.3602 * t2 +\n                                      0.007625 * t3 - 0.00003586 * t4;\n        var meanLongitudeConstant = 218.31664563 * RadiansPerDegree;\n        var meanLongitudeSecPart = 1732559343.48470 * t - 6.3910 * t2 +\n                                   0.006588 * t3 - 0.00003169 * t4;\n\n        // Delaunay arguments from section 3.5 b\n        var D = 297.85019547 * RadiansPerDegree + RadiansPerArcSecond *\n                    (1602961601.2090 * t - 6.3706 * t2 + 0.006593 * t3 - 0.00003169 * t4);\n        var F = 93.27209062 * RadiansPerDegree + RadiansPerArcSecond *\n                    (1739527262.8478 * t - 12.7512 * t2 - 0.001037 * t3 + 0.00000417 * t4);\n        var l = 134.96340251 * RadiansPerDegree + RadiansPerArcSecond *\n                    (1717915923.2178 * t + 31.8792 * t2 + 0.051635 * t3 - 0.00024470 * t4);\n        var lprime = 357.52910918 * RadiansPerDegree + RadiansPerArcSecond *\n                    (129596581.0481 * t - 0.5532 * t2 + 0.000136 * t3 - 0.00001149 * t4);\n        var psi = 310.17137918 * RadiansPerDegree - RadiansPerArcSecond *\n                    (6967051.4360 * t + 6.2068 * t2 + 0.007618 * t3 - 0.00003219 * t4);\n\n        // Add terms from Table 4\n        var twoD = 2.0 * D;\n        var fourD = 4.0 * D;\n        var sixD = 6.0 * D;\n        var twol = 2.0 * l;\n        var threel = 3.0 * l;\n        var fourl = 4.0 * l;\n        var twoF = 2.0 * F;\n        semimajorAxis += 3400.4 * Math.cos(twoD) - 635.6 * Math.cos(twoD - l) -\n                         235.6 * Math.cos(l) + 218.1 * Math.cos(twoD - lprime) +\n                         181.0 * Math.cos(twoD + l);\n        eccentricity += 0.014216 * Math.cos(twoD - l) + 0.008551 * Math.cos(twoD - twol) -\n                        0.001383 * Math.cos(l) + 0.001356 * Math.cos(twoD + l) -\n                        0.001147 * Math.cos(fourD - threel) - 0.000914 * Math.cos(fourD - twol) +\n                        0.000869 * Math.cos(twoD - lprime - l) - 0.000627 * Math.cos(twoD) -\n                        0.000394 * Math.cos(fourD - fourl) + 0.000282 * Math.cos(twoD - lprime - twol) -\n                        0.000279 * Math.cos(D - l) - 0.000236 * Math.cos(twol) +\n                        0.000231 * Math.cos(fourD) + 0.000229 * Math.cos(sixD - fourl) -\n                        0.000201 * Math.cos(twol - twoF);\n        inclinationSecPart += 486.26 * Math.cos(twoD - twoF) - 40.13 * Math.cos(twoD) +\n                              37.51 * Math.cos(twoF) + 25.73 * Math.cos(twol - twoF) +\n                              19.97 * Math.cos(twoD - lprime - twoF);\n        longitudeOfPerigeeSecPart += -55609 * Math.sin(twoD - l) - 34711 * Math.sin(twoD - twol) -\n                                      9792 * Math.sin(l) + 9385 * Math.sin(fourD - threel) +\n                                      7505 * Math.sin(fourD - twol) + 5318 * Math.sin(twoD + l) +\n                                      3484 * Math.sin(fourD - fourl) - 3417 * Math.sin(twoD - lprime - l) -\n                                      2530 * Math.sin(sixD - fourl) - 2376 * Math.sin(twoD) -\n                                      2075 * Math.sin(twoD - threel) - 1883 * Math.sin(twol) -\n                                      1736 * Math.sin(sixD - 5.0 * l) + 1626 * Math.sin(lprime) -\n                                      1370 * Math.sin(sixD - threel);\n        longitudeOfNodeSecPart += -5392 * Math.sin(twoD - twoF) - 540 * Math.sin(lprime) -\n                                  441 * Math.sin(twoD) + 423 * Math.sin(twoF) -\n                                  288 * Math.sin(twol - twoF);\n        meanLongitudeSecPart += -3332.9 * Math.sin(twoD) + 1197.4 * Math.sin(twoD - l) -\n                                662.5 * Math.sin(lprime) + 396.3 * Math.sin(l) -\n                                218.0 * Math.sin(twoD - lprime);\n\n        // Add terms from Table 5\n        var twoPsi = 2.0 * psi;\n        var threePsi = 3.0 * psi;\n        inclinationSecPart += 46.997 * Math.cos(psi) * t - 0.614 * Math.cos(twoD - twoF + psi) * t +\n                              0.614 * Math.cos(twoD - twoF - psi) * t - 0.0297 * Math.cos(twoPsi) * t2 -\n                              0.0335 * Math.cos(psi) * t2 + 0.0012 * Math.cos(twoD - twoF + twoPsi) * t2 -\n                              0.00016 * Math.cos(psi) * t3 + 0.00004 * Math.cos(threePsi) * t3 +\n                              0.00004 * Math.cos(twoPsi) * t3;\n        var perigeeAndMean = 2.116 * Math.sin(psi) * t - 0.111 * Math.sin(twoD - twoF - psi) * t -\n                                0.0015 * Math.sin(psi) * t2;\n        longitudeOfPerigeeSecPart += perigeeAndMean;\n        meanLongitudeSecPart += perigeeAndMean;\n        longitudeOfNodeSecPart += -520.77 * Math.sin(psi) * t + 13.66 * Math.sin(twoD - twoF + psi) * t +\n                                  1.12 * Math.sin(twoD - psi) * t - 1.06 * Math.sin(twoF - psi) * t +\n                                  0.660 * Math.sin(twoPsi) * t2 + 0.371 * Math.sin(psi) * t2 -\n                                  0.035 * Math.sin(twoD - twoF + twoPsi) * t2 - 0.015 * Math.sin(twoD - twoF + psi) * t2 +\n                                  0.0014 * Math.sin(psi) * t3 - 0.0011 * Math.sin(threePsi) * t3 -\n                                  0.0009 * Math.sin(twoPsi) * t3;\n\n        // Add constants and convert units\n        semimajorAxis *= MetersPerKilometer;\n        var inclination = inclinationConstant + inclinationSecPart * RadiansPerArcSecond;\n        var longitudeOfPerigee = longitudeOfPerigeeConstant + longitudeOfPerigeeSecPart * RadiansPerArcSecond;\n        var meanLongitude = meanLongitudeConstant + meanLongitudeSecPart * RadiansPerArcSecond;\n        var longitudeOfNode = longitudeOfNodeConstant + longitudeOfNodeSecPart * RadiansPerArcSecond;\n\n        return elementsToCartesian(semimajorAxis, eccentricity, inclination, longitudeOfPerigee,\n                                   longitudeOfNode, meanLongitude, result);\n    }\n\n    // Gets a point describing the motion of the Earth.  This point uses the Moon point and\n    // the 1992 mu value (ratio between Moon and Earth masses) in Table 2 of the paper in order\n    // to determine the position of the Earth relative to the Earth-Moon barycenter.\n    var moonEarthMassRatio = 0.012300034; // From 1992 mu value in Table 2\n    var factor = moonEarthMassRatio / (moonEarthMassRatio + 1.0) * -1;\n    function computeSimonEarth(date, result) {\n        result = computeSimonMoon(date, result);\n        return Cartesian3.multiplyByScalar(result, factor, result);\n    }\n\n    // Values for the <code>axesTransformation</code> needed for the rotation were found using the STK Components\n    // GreographicTransformer on the position of the sun center of mass point and the earth J2000 frame.\n\n    var axesTransformation = new Matrix3(1.0000000000000002, 5.619723173785822e-16, 4.690511510146299e-19,\n            -5.154129427414611e-16, 0.9174820620691819, -0.39777715593191376,\n             -2.23970096136568e-16, 0.39777715593191376, 0.9174820620691819);\n    var translation = new Cartesian3();\n    /**\n     * Computes the position of the Sun in the Earth-centered inertial frame\n     *\n     * @param {JulianDate} [julianDate] The time at which to compute the Sun's position, if not provided the current system time is used.\n     * @param {Cartesian3} [result] The object onto which to store the result.\n     * @returns {Cartesian3} Calculated sun position\n     */\n    Simon1994PlanetaryPositions.computeSunPositionInEarthInertialFrame= function(julianDate, result){\n        if (!defined(julianDate)) {\n            julianDate = JulianDate.now();\n        }\n\n        if (!defined(result)) {\n            result = new Cartesian3();\n        }\n\n        //first forward transformation\n        translation = computeSimonEarthMoonBarycenter(julianDate, translation);\n        result = Cartesian3.negate(translation, result);\n\n        //second forward transformation\n        computeSimonEarth(julianDate, translation);\n\n        Cartesian3.subtract(result, translation, result);\n        Matrix3.multiplyByVector(axesTransformation, result, result);\n\n        return result;\n    };\n\n    /**\n     * Computes the position of the Moon in the Earth-centered inertial frame\n     *\n     * @param {JulianDate} [julianDate] The time at which to compute the Sun's position, if not provided the current system time is used.\n     * @param {Cartesian3} [result] The object onto which to store the result.\n     * @returns {Cartesian3} Calculated moon position\n     */\n    Simon1994PlanetaryPositions.computeMoonPositionInEarthInertialFrame = function(julianDate, result){\n        if (!defined(julianDate)) {\n            julianDate = JulianDate.now();\n        }\n\n        result = computeSimonMoon(julianDate, result);\n        Matrix3.multiplyByVector(axesTransformation, result, result);\n\n        return result;\n    };\nexport default Simon1994PlanetaryPositions;\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"#ifdef WRITE_DEPTH\\n\\\n#ifdef GL_EXT_frag_depth\\n\\\n#extension GL_EXT_frag_depth : enable\\n\\\n#endif\\n\\\n#endif\\n\\\n\\n\\\nuniform vec3 u_radii;\\n\\\nuniform vec3 u_oneOverEllipsoidRadiiSquared;\\n\\\n\\n\\\nvarying vec3 v_positionEC;\\n\\\n\\n\\\nvec4 computeEllipsoidColor(czm_ray ray, float intersection, float side)\\n\\\n{\\n\\\n    vec3 positionEC = czm_pointAlongRay(ray, intersection);\\n\\\n    vec3 positionMC = (czm_inverseModelView * vec4(positionEC, 1.0)).xyz;\\n\\\n    vec3 geodeticNormal = normalize(czm_geodeticSurfaceNormal(positionMC, vec3(0.0), u_oneOverEllipsoidRadiiSquared));\\n\\\n    vec3 sphericalNormal = normalize(positionMC / u_radii);\\n\\\n    vec3 normalMC = geodeticNormal * side;              // normalized surface normal (always facing the viewer) in model coordinates\\n\\\n    vec3 normalEC = normalize(czm_normal * normalMC);   // normalized surface normal in eye coordiantes\\n\\\n\\n\\\n    vec2 st = czm_ellipsoidWgs84TextureCoordinates(sphericalNormal);\\n\\\n    vec3 positionToEyeEC = -positionEC;\\n\\\n\\n\\\n    czm_materialInput materialInput;\\n\\\n    materialInput.s = st.s;\\n\\\n    materialInput.st = st;\\n\\\n    materialInput.str = (positionMC + u_radii) / u_radii;\\n\\\n    materialInput.normalEC = normalEC;\\n\\\n    materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(positionMC, normalEC);\\n\\\n    materialInput.positionToEyeEC = positionToEyeEC;\\n\\\n    czm_material material = czm_getMaterial(materialInput);\\n\\\n\\n\\\n#ifdef ONLY_SUN_LIGHTING\\n\\\n    return czm_private_phong(normalize(positionToEyeEC), material, czm_sunDirectionEC);\\n\\\n#else\\n\\\n    return czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\\n\\\n#endif\\n\\\n}\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    // PERFORMANCE_TODO: When dynamic branching is available, compute ratio of maximum and minimum radii\\n\\\n    // in the vertex shader. Only when it is larger than some constant, march along the ray.\\n\\\n    // Otherwise perform one intersection test which will be the common case.\\n\\\n\\n\\\n    // Test if the ray intersects a sphere with the ellipsoid's maximum radius.\\n\\\n    // For very oblate ellipsoids, using the ellipsoid's radii for an intersection test\\n\\\n    // may cause false negatives. This will discard fragments before marching the ray forward.\\n\\\n    float maxRadius = max(u_radii.x, max(u_radii.y, u_radii.z)) * 1.5;\\n\\\n    vec3 direction = normalize(v_positionEC);\\n\\\n    vec3 ellipsoidCenter = czm_modelView[3].xyz;\\n\\\n\\n\\\n    float t1 = -1.0;\\n\\\n    float t2 = -1.0;\\n\\\n\\n\\\n    float b = -2.0 * dot(direction, ellipsoidCenter);\\n\\\n    float c = dot(ellipsoidCenter, ellipsoidCenter) - maxRadius * maxRadius;\\n\\\n\\n\\\n    float discriminant = b * b - 4.0 * c;\\n\\\n    if (discriminant >= 0.0) {\\n\\\n        t1 = (-b - sqrt(discriminant)) * 0.5;\\n\\\n        t2 = (-b + sqrt(discriminant)) * 0.5;\\n\\\n    }\\n\\\n\\n\\\n    if (t1 < 0.0 && t2 < 0.0) {\\n\\\n        discard;\\n\\\n    }\\n\\\n\\n\\\n    float t = min(t1, t2);\\n\\\n    if (t < 0.0) {\\n\\\n        t = 0.0;\\n\\\n    }\\n\\\n\\n\\\n    // March ray forward to intersection with larger sphere and find\\n\\\n    czm_ray ray = czm_ray(t * direction, direction);\\n\\\n\\n\\\n    vec3 ellipsoid_inverseRadii = vec3(1.0 / u_radii.x, 1.0 / u_radii.y, 1.0 / u_radii.z);\\n\\\n\\n\\\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoidCenter, ellipsoid_inverseRadii);\\n\\\n\\n\\\n    if (czm_isEmpty(intersection))\\n\\\n    {\\n\\\n        discard;\\n\\\n    }\\n\\\n\\n\\\n    // If the viewer is outside, compute outsideFaceColor, with normals facing outward.\\n\\\n    vec4 outsideFaceColor = (intersection.start != 0.0) ? computeEllipsoidColor(ray, intersection.start, 1.0) : vec4(0.0);\\n\\\n\\n\\\n    // If the viewer either is inside or can see inside, compute insideFaceColor, with normals facing inward.\\n\\\n    vec4 insideFaceColor = (outsideFaceColor.a < 1.0) ? computeEllipsoidColor(ray, intersection.stop, -1.0) : vec4(0.0);\\n\\\n\\n\\\n    gl_FragColor = mix(insideFaceColor, outsideFaceColor, outsideFaceColor.a);\\n\\\n    gl_FragColor.a = 1.0 - (1.0 - insideFaceColor.a) * (1.0 - outsideFaceColor.a);\\n\\\n\\n\\\n#ifdef WRITE_DEPTH\\n\\\n#ifdef GL_EXT_frag_depth\\n\\\n    t = (intersection.start != 0.0) ? intersection.start : intersection.stop;\\n\\\n    vec3 positionEC = czm_pointAlongRay(ray, t);\\n\\\n    vec4 positionCC = czm_projection * vec4(positionEC, 1.0);\\n\\\n#ifdef LOG_DEPTH\\n\\\n    czm_writeLogDepth(1.0 + positionCC.w);\\n\\\n#else\\n\\\n    float z = positionCC.z / positionCC.w;\\n\\\n\\n\\\n    float n = czm_depthRange.near;\\n\\\n    float f = czm_depthRange.far;\\n\\\n\\n\\\n    gl_FragDepthEXT = (z * (f - n) + f + n) * 0.5;\\n\\\n#endif\\n\\\n#endif\\n\\\n#endif\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"attribute vec3 position;\\n\\\n\\n\\\nuniform vec3 u_radii;\\n\\\n\\n\\\nvarying vec3 v_positionEC;\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    // In the vertex data, the cube goes from (-1.0, -1.0, -1.0) to (1.0, 1.0, 1.0) in model coordinates.\\n\\\n    // Scale to consider the radii.  We could also do this once on the CPU when using the BoxGeometry,\\n\\\n    // but doing it here allows us to change the radii without rewriting the vertex data, and\\n\\\n    // allows all ellipsoids to reuse the same vertex data.\\n\\\n    vec4 p = vec4(u_radii * position, 1.0);\\n\\\n\\n\\\n    v_positionEC = (czm_modelView * p).xyz;     // position in eye coordinates\\n\\\n    gl_Position = czm_modelViewProjection * p;  // position in clip coordinates\\n\\\n\\n\\\n    // With multi-frustum, when the ellipsoid primitive is positioned on the intersection of two frustums\\n\\\n    // and close to terrain, the terrain (writes depth) in the closest frustum can overwrite part of the\\n\\\n    // ellipsoid (does not write depth) that was rendered in the farther frustum.\\n\\\n    //\\n\\\n    // Here, we clamp the depth in the vertex shader to avoid being overwritten; however, this creates\\n\\\n    // artifacts since some fragments can be alpha blended twice.  This is solved by only rendering\\n\\\n    // the ellipsoid in the closest frustum to the viewer.\\n\\\n    gl_Position.z = clamp(gl_Position.z, czm_depthRange.near, czm_depthRange.far);\\n\\\n\\n\\\n    czm_vertexLogDepth();\\n\\\n}\\n\\\n\";\n","import BoundingSphere from '../Core/BoundingSphere.js';\nimport BoxGeometry from '../Core/BoxGeometry.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport combine from '../Core/combine.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport VertexFormat from '../Core/VertexFormat.js';\nimport BufferUsage from '../Renderer/BufferUsage.js';\nimport DrawCommand from '../Renderer/DrawCommand.js';\nimport Pass from '../Renderer/Pass.js';\nimport RenderState from '../Renderer/RenderState.js';\nimport ShaderProgram from '../Renderer/ShaderProgram.js';\nimport ShaderSource from '../Renderer/ShaderSource.js';\nimport VertexArray from '../Renderer/VertexArray.js';\nimport EllipsoidFS from '../Shaders/EllipsoidFS.js';\nimport EllipsoidVS from '../Shaders/EllipsoidVS.js';\nimport BlendingState from './BlendingState.js';\nimport CullFace from './CullFace.js';\nimport Material from './Material.js';\nimport SceneMode from './SceneMode.js';\n\n    var attributeLocations = {\n        position : 0\n    };\n\n    /**\n     * A renderable ellipsoid.  It can also draw spheres when the three {@link EllipsoidPrimitive#radii} components are equal.\n     * <p>\n     * This is only supported in 3D.  The ellipsoid is not shown in 2D or Columbus view.\n     * </p>\n     *\n     * @alias EllipsoidPrimitive\n     * @constructor\n     *\n     * @param {Object} [options] Object with the following properties:\n     * @param {Cartesian3} [options.center=Cartesian3.ZERO] The center of the ellipsoid in the ellipsoid's model coordinates.\n     * @param {Cartesian3} [options.radii] The radius of the ellipsoid along the <code>x</code>, <code>y</code>, and <code>z</code> axes in the ellipsoid's model coordinates.\n     * @param {Matrix4} [options.modelMatrix=Matrix4.IDENTITY] The 4x4 transformation matrix that transforms the ellipsoid from model to world coordinates.\n     * @param {Boolean} [options.show=true] Determines if this primitive will be shown.\n     * @param {Material} [options.material=Material.ColorType] The surface appearance of the primitive.\n     * @param {Object} [options.id] A user-defined object to return when the instance is picked with {@link Scene#pick}\n     * @param {Boolean} [options.debugShowBoundingVolume=false] For debugging only. Determines if this primitive's commands' bounding spheres are shown.\n     *\n     * @private\n     */\n    function EllipsoidPrimitive(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        /**\n         * The center of the ellipsoid in the ellipsoid's model coordinates.\n         * <p>\n         * The default is {@link Cartesian3.ZERO}.\n         * </p>\n         *\n         * @type {Cartesian3}\n         * @default {@link Cartesian3.ZERO}\n         *\n         * @see EllipsoidPrimitive#modelMatrix\n         */\n        this.center = Cartesian3.clone(defaultValue(options.center, Cartesian3.ZERO));\n        this._center = new Cartesian3();\n\n        /**\n         * The radius of the ellipsoid along the <code>x</code>, <code>y</code>, and <code>z</code> axes in the ellipsoid's model coordinates.\n         * When these are the same, the ellipsoid is a sphere.\n         * <p>\n         * The default is <code>undefined</code>.  The ellipsoid is not drawn until a radii is provided.\n         * </p>\n         *\n         * @type {Cartesian3}\n         * @default undefined\n         *\n         *\n         * @example\n         * // A sphere with a radius of 2.0\n         * e.radii = new Cesium.Cartesian3(2.0, 2.0, 2.0);\n         *\n         * @see EllipsoidPrimitive#modelMatrix\n         */\n        this.radii = Cartesian3.clone(options.radii);\n        this._radii = new Cartesian3();\n\n        this._oneOverEllipsoidRadiiSquared = new Cartesian3();\n        this._boundingSphere = new BoundingSphere();\n\n        /**\n         * The 4x4 transformation matrix that transforms the ellipsoid from model to world coordinates.\n         * When this is the identity matrix, the ellipsoid is drawn in world coordinates, i.e., Earth's WGS84 coordinates.\n         * Local reference frames can be used by providing a different transformation matrix, like that returned\n         * by {@link Transforms.eastNorthUpToFixedFrame}.\n         *\n         * @type {Matrix4}\n         * @default {@link Matrix4.IDENTITY}\n         *\n         * @example\n         * var origin = Cesium.Cartesian3.fromDegrees(-95.0, 40.0, 200000.0);\n         * e.modelMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(origin);\n         */\n        this.modelMatrix = Matrix4.clone(defaultValue(options.modelMatrix, Matrix4.IDENTITY));\n        this._modelMatrix = new Matrix4();\n        this._computedModelMatrix = new Matrix4();\n\n        /**\n         * Determines if the ellipsoid primitive will be shown.\n         *\n         * @type {Boolean}\n         * @default true\n         */\n        this.show = defaultValue(options.show, true);\n\n        /**\n         * The surface appearance of the ellipsoid.  This can be one of several built-in {@link Material} objects or a custom material, scripted with\n         * {@link https://github.com/CesiumGS/cesium/wiki/Fabric|Fabric}.\n         * <p>\n         * The default material is <code>Material.ColorType</code>.\n         * </p>\n         *\n         * @type {Material}\n         * @default Material.fromType(Material.ColorType)\n         *\n         *\n         * @example\n         * // 1. Change the color of the default material to yellow\n         * e.material.uniforms.color = new Cesium.Color(1.0, 1.0, 0.0, 1.0);\n         *\n         * // 2. Change material to horizontal stripes\n         * e.material = Cesium.Material.fromType(Cesium.Material.StripeType);\n         *\n         * @see {@link https://github.com/CesiumGS/cesium/wiki/Fabric|Fabric}\n         */\n        this.material = defaultValue(options.material, Material.fromType(Material.ColorType));\n        this._material = undefined;\n        this._translucent = undefined;\n\n        /**\n         * User-defined object returned when the ellipsoid is picked.\n         *\n         * @type Object\n         *\n         * @default undefined\n         *\n         * @see Scene#pick\n         */\n        this.id = options.id;\n        this._id = undefined;\n\n        /**\n         * This property is for debugging only; it is not for production use nor is it optimized.\n         * <p>\n         * Draws the bounding sphere for each draw command in the primitive.\n         * </p>\n         *\n         * @type {Boolean}\n         *\n         * @default false\n         */\n        this.debugShowBoundingVolume = defaultValue(options.debugShowBoundingVolume, false);\n\n        /**\n         * @private\n         */\n        this.onlySunLighting = defaultValue(options.onlySunLighting, false);\n        this._onlySunLighting = false;\n\n        /**\n         * @private\n         */\n        this._depthTestEnabled = defaultValue(options.depthTestEnabled, true);\n\n        this._useLogDepth = false;\n\n        this._sp = undefined;\n        this._rs = undefined;\n        this._va = undefined;\n\n        this._pickSP = undefined;\n        this._pickId = undefined;\n\n        this._colorCommand = new DrawCommand({\n            owner : defaultValue(options._owner, this)\n        });\n        this._pickCommand = new DrawCommand({\n            owner : defaultValue(options._owner, this),\n            pickOnly : true\n        });\n\n        var that = this;\n        this._uniforms = {\n            u_radii : function() {\n                return that.radii;\n            },\n            u_oneOverEllipsoidRadiiSquared : function() {\n                return that._oneOverEllipsoidRadiiSquared;\n            }\n        };\n\n        this._pickUniforms = {\n            czm_pickColor : function() {\n                return that._pickId.color;\n            }\n        };\n    }\n\n    function getVertexArray(context) {\n        var vertexArray = context.cache.ellipsoidPrimitive_vertexArray;\n\n        if (defined(vertexArray)) {\n            return vertexArray;\n        }\n\n        var geometry = BoxGeometry.createGeometry(BoxGeometry.fromDimensions({\n            dimensions : new Cartesian3(2.0, 2.0, 2.0),\n            vertexFormat : VertexFormat.POSITION_ONLY\n        }));\n\n        vertexArray = VertexArray.fromGeometry({\n            context : context,\n            geometry : geometry,\n            attributeLocations : attributeLocations,\n            bufferUsage : BufferUsage.STATIC_DRAW,\n            interleave : true\n        });\n\n        context.cache.ellipsoidPrimitive_vertexArray = vertexArray;\n        return vertexArray;\n    }\n\n    var logDepthExtension =\n        '#ifdef GL_EXT_frag_depth \\n' +\n        '#extension GL_EXT_frag_depth : enable \\n' +\n        '#endif \\n\\n';\n\n    /**\n     * Called when {@link Viewer} or {@link CesiumWidget} render the scene to\n     * get the draw commands needed to render this primitive.\n     * <p>\n     * Do not call this function directly.  This is documented just to\n     * list the exceptions that may be propagated when the scene is rendered:\n     * </p>\n     *\n     * @exception {DeveloperError} this.material must be defined.\n     */\n    EllipsoidPrimitive.prototype.update = function(frameState) {\n        if (!this.show ||\n            (frameState.mode !== SceneMode.SCENE3D) ||\n            (!defined(this.center)) ||\n            (!defined(this.radii))) {\n            return;\n        }\n\n        \n\n        var context = frameState.context;\n        var translucent = this.material.isTranslucent();\n        var translucencyChanged = this._translucent !== translucent;\n\n        if (!defined(this._rs) || translucencyChanged) {\n            this._translucent = translucent;\n\n            // If this render state is ever updated to use a non-default\n            // depth range, the hard-coded values in EllipsoidVS.glsl need\n            // to be updated as well.\n\n            this._rs = RenderState.fromCache({\n                // Cull front faces - not back faces - so the ellipsoid doesn't\n                // disappear if the viewer enters the bounding box.\n                cull : {\n                    enabled : true,\n                    face : CullFace.FRONT\n                },\n                depthTest : {\n                    enabled : this._depthTestEnabled\n                },\n                // Only write depth when EXT_frag_depth is supported since the depth for\n                // the bounding box is wrong; it is not the true depth of the ray casted ellipsoid.\n                depthMask : !translucent && context.fragmentDepth,\n                blending : translucent ? BlendingState.ALPHA_BLEND : undefined\n            });\n        }\n\n        if (!defined(this._va)) {\n            this._va = getVertexArray(context);\n        }\n\n        var boundingSphereDirty = false;\n\n        var radii = this.radii;\n        if (!Cartesian3.equals(this._radii, radii)) {\n            Cartesian3.clone(radii, this._radii);\n\n            var r = this._oneOverEllipsoidRadiiSquared;\n            r.x = 1.0 / (radii.x * radii.x);\n            r.y = 1.0 / (radii.y * radii.y);\n            r.z = 1.0 / (radii.z * radii.z);\n\n            boundingSphereDirty = true;\n        }\n\n        if (!Matrix4.equals(this.modelMatrix, this._modelMatrix) || !Cartesian3.equals(this.center, this._center)) {\n            Matrix4.clone(this.modelMatrix, this._modelMatrix);\n            Cartesian3.clone(this.center, this._center);\n\n            // Translate model coordinates used for rendering such that the origin is the center of the ellipsoid.\n            Matrix4.multiplyByTranslation(this.modelMatrix, this.center, this._computedModelMatrix);\n            boundingSphereDirty = true;\n        }\n\n        if (boundingSphereDirty) {\n            Cartesian3.clone(Cartesian3.ZERO, this._boundingSphere.center);\n            this._boundingSphere.radius = Cartesian3.maximumComponent(radii);\n            BoundingSphere.transform(this._boundingSphere, this._computedModelMatrix, this._boundingSphere);\n        }\n\n        var materialChanged = this._material !== this.material;\n        this._material = this.material;\n        this._material.update(context);\n\n        var lightingChanged = this.onlySunLighting !== this._onlySunLighting;\n        this._onlySunLighting = this.onlySunLighting;\n\n        var useLogDepth = frameState.useLogDepth;\n        var useLogDepthChanged = this._useLogDepth !== useLogDepth;\n        this._useLogDepth = useLogDepth;\n\n        var colorCommand = this._colorCommand;\n        var vs;\n        var fs;\n\n        // Recompile shader when material, lighting, or translucency changes\n        if (materialChanged || lightingChanged || translucencyChanged || useLogDepthChanged) {\n            vs = new ShaderSource({\n                sources : [EllipsoidVS]\n            });\n            fs = new ShaderSource({\n                sources : [this.material.shaderSource, EllipsoidFS]\n            });\n            if (this.onlySunLighting) {\n                fs.defines.push('ONLY_SUN_LIGHTING');\n            }\n            if (!translucent && context.fragmentDepth) {\n                fs.defines.push('WRITE_DEPTH');\n            }\n            if (this._useLogDepth) {\n                vs.defines.push('LOG_DEPTH');\n                fs.defines.push('LOG_DEPTH');\n                fs.sources.push(logDepthExtension);\n            }\n\n            this._sp = ShaderProgram.replaceCache({\n                context : context,\n                shaderProgram : this._sp,\n                vertexShaderSource : vs,\n                fragmentShaderSource : fs,\n                attributeLocations : attributeLocations\n            });\n\n            colorCommand.vertexArray = this._va;\n            colorCommand.renderState = this._rs;\n            colorCommand.shaderProgram = this._sp;\n            colorCommand.uniformMap = combine(this._uniforms, this.material._uniforms);\n            colorCommand.executeInClosestFrustum = translucent;\n        }\n\n        var commandList = frameState.commandList;\n        var passes = frameState.passes;\n\n        if (passes.render) {\n            colorCommand.boundingVolume = this._boundingSphere;\n            colorCommand.debugShowBoundingVolume = this.debugShowBoundingVolume;\n            colorCommand.modelMatrix = this._computedModelMatrix;\n            colorCommand.pass = translucent ? Pass.TRANSLUCENT : Pass.OPAQUE;\n\n            commandList.push(colorCommand);\n        }\n\n        if (passes.pick) {\n            var pickCommand = this._pickCommand;\n\n            if (!defined(this._pickId) || (this._id !== this.id)) {\n                this._id = this.id;\n                this._pickId = this._pickId && this._pickId.destroy();\n                this._pickId = context.createPickId({\n                    primitive : this,\n                    id : this.id\n                });\n            }\n\n            // Recompile shader when material changes\n            if (materialChanged || lightingChanged || !defined(this._pickSP) || useLogDepthChanged) {\n                vs = new ShaderSource({\n                    sources : [EllipsoidVS]\n                });\n                fs = new ShaderSource({\n                    sources : [this.material.shaderSource, EllipsoidFS],\n                    pickColorQualifier : 'uniform'\n                });\n                if (this.onlySunLighting) {\n                    fs.defines.push('ONLY_SUN_LIGHTING');\n                }\n                if (!translucent && context.fragmentDepth) {\n                    fs.defines.push('WRITE_DEPTH');\n                }\n                if (this._useLogDepth) {\n                    vs.defines.push('LOG_DEPTH');\n                    fs.defines.push('LOG_DEPTH');\n                    fs.sources.push(logDepthExtension);\n                }\n\n                this._pickSP = ShaderProgram.replaceCache({\n                    context : context,\n                    shaderProgram : this._pickSP,\n                    vertexShaderSource : vs,\n                    fragmentShaderSource : fs,\n                    attributeLocations : attributeLocations\n                });\n\n                pickCommand.vertexArray = this._va;\n                pickCommand.renderState = this._rs;\n                pickCommand.shaderProgram = this._pickSP;\n                pickCommand.uniformMap = combine(combine(this._uniforms, this._pickUniforms), this.material._uniforms);\n                pickCommand.executeInClosestFrustum = translucent;\n            }\n\n            pickCommand.boundingVolume = this._boundingSphere;\n            pickCommand.modelMatrix = this._computedModelMatrix;\n            pickCommand.pass = translucent ? Pass.TRANSLUCENT : Pass.OPAQUE;\n\n            commandList.push(pickCommand);\n        }\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <br /><br />\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     *\n     * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n     *\n     * @see EllipsoidPrimitive#destroy\n     */\n    EllipsoidPrimitive.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n     * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n     * <br /><br />\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     *\n     * @example\n     * e = e && e.destroy();\n     *\n     * @see EllipsoidPrimitive#isDestroyed\n     */\n    EllipsoidPrimitive.prototype.destroy = function() {\n        this._sp = this._sp && this._sp.destroy();\n        this._pickSP = this._pickSP && this._pickSP.destroy();\n        this._pickId = this._pickId && this._pickId.destroy();\n        return destroyObject(this);\n    };\nexport default EllipsoidPrimitive;\n","import buildModuleUrl from '../Core/buildModuleUrl.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport Ellipsoid from '../Core/Ellipsoid.js';\nimport IauOrientationAxes from '../Core/IauOrientationAxes.js';\nimport Matrix3 from '../Core/Matrix3.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport Simon1994PlanetaryPositions from '../Core/Simon1994PlanetaryPositions.js';\nimport Transforms from '../Core/Transforms.js';\nimport EllipsoidPrimitive from './EllipsoidPrimitive.js';\nimport Material from './Material.js';\n\n    /**\n     * Draws the Moon in 3D.\n     * @alias Moon\n     * @constructor\n     *\n     * @param {Object} [options] Object with the following properties:\n     * @param {Boolean} [options.show=true] Determines whether the moon will be rendered.\n     * @param {String} [options.textureUrl=require('/home/remy/Calypso/Software/TerriaMap/node_modules/terriajs-cesium/Source/Assets/Textures/moonSmall.jpg')] The moon texture.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.MOON] The moon ellipsoid.\n     * @param {Boolean} [options.onlySunLighting=true] Use the sun as the only light source.\n     *\n     *\n     * @example\n     * scene.moon = new Cesium.Moon();\n     *\n     * @see Scene#moon\n     */\n    function Moon(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        var url = options.textureUrl;\n        if (!defined(url)) {\n            url = require('/home/remy/Calypso/Software/TerriaMap/node_modules/terriajs-cesium/Source/Assets/Textures/moonSmall.jpg');\n        }\n\n        /**\n         * Determines if the moon will be shown.\n         *\n         * @type {Boolean}\n         * @default true\n         */\n        this.show = defaultValue(options.show, true);\n\n        /**\n         * The moon texture.\n         * @type {String}\n         * @default require('/home/remy/Calypso/Software/TerriaMap/node_modules/terriajs-cesium/Source/Assets/Textures/moonSmall.jpg')\n         */\n        this.textureUrl = url;\n\n        this._ellipsoid = defaultValue(options.ellipsoid, Ellipsoid.MOON);\n\n        /**\n         * Use the sun as the only light source.\n         * @type {Boolean}\n         * @default true\n         */\n        this.onlySunLighting = defaultValue(options.onlySunLighting, true);\n\n        this._ellipsoidPrimitive = new EllipsoidPrimitive({\n            radii : this.ellipsoid.radii,\n            material : Material.fromType(Material.ImageType),\n            depthTestEnabled : false,\n            _owner : this\n        });\n        this._ellipsoidPrimitive.material.translucent = false;\n\n        this._axes = new IauOrientationAxes();\n    }\n\n    Object.defineProperties(Moon.prototype, {\n        /**\n         * Get the ellipsoid that defines the shape of the moon.\n         *\n         * @memberof Moon.prototype\n         *\n         * @type {Ellipsoid}\n         * @readonly\n         *\n         * @default {@link Ellipsoid.MOON}\n         */\n        ellipsoid : {\n            get : function() {\n                return this._ellipsoid;\n            }\n        }\n    });\n\n    var icrfToFixed = new Matrix3();\n    var rotationScratch = new Matrix3();\n    var translationScratch = new Cartesian3();\n    var scratchCommandList = [];\n\n    /**\n     * @private\n     */\n    Moon.prototype.update = function(frameState) {\n        if (!this.show) {\n            return;\n        }\n\n        var ellipsoidPrimitive = this._ellipsoidPrimitive;\n        ellipsoidPrimitive.material.uniforms.image = this.textureUrl;\n        ellipsoidPrimitive.onlySunLighting = this.onlySunLighting;\n\n        var date = frameState.time;\n        if (!defined(Transforms.computeIcrfToFixedMatrix(date, icrfToFixed))) {\n            Transforms.computeTemeToPseudoFixedMatrix(date, icrfToFixed);\n        }\n\n        var rotation = this._axes.evaluate(date, rotationScratch);\n        Matrix3.transpose(rotation, rotation);\n        Matrix3.multiply(icrfToFixed, rotation, rotation);\n\n        var translation = Simon1994PlanetaryPositions.computeMoonPositionInEarthInertialFrame(date, translationScratch);\n        Matrix3.multiplyByVector(icrfToFixed, translation, translation);\n\n        Matrix4.fromRotationTranslation(rotation, translation, ellipsoidPrimitive.modelMatrix);\n\n        var savedCommandList = frameState.commandList;\n        frameState.commandList = scratchCommandList;\n        scratchCommandList.length = 0;\n        ellipsoidPrimitive.update(frameState);\n        frameState.commandList = savedCommandList;\n        return (scratchCommandList.length === 1) ? scratchCommandList[0] : undefined;\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <br /><br />\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     *\n     * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n     *\n     * @see Moon#destroy\n     */\n    Moon.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n     * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n     * <br /><br />\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     *\n     * @example\n     * moon = moon && moon.destroy();\n     *\n     * @see Moon#isDestroyed\n     */\n    Moon.prototype.destroy = function() {\n        this._ellipsoidPrimitive = this._ellipsoidPrimitive && this._ellipsoidPrimitive.destroy();\n        return destroyObject(this);\n    };\nexport default Moon;\n","import defined from './defined.js';\nimport DeveloperError from './DeveloperError.js';\n\n    var leftScratchArray = [];\n    var rightScratchArray = [];\n\n    function merge(array, compare, userDefinedObject, start, middle, end) {\n        var leftLength = middle - start + 1;\n        var rightLength = end - middle;\n\n        var left = leftScratchArray;\n        var right = rightScratchArray;\n\n        var i;\n        var j;\n\n        for (i = 0; i < leftLength; ++i) {\n            left[i] = array[start + i];\n        }\n\n        for (j = 0; j < rightLength; ++j) {\n            right[j] = array[middle + j + 1];\n        }\n\n        i = 0;\n        j = 0;\n        for (var k = start; k <= end; ++k) {\n            var leftElement = left[i];\n            var rightElement = right[j];\n            if (i < leftLength && (j >= rightLength || compare(leftElement, rightElement, userDefinedObject) <= 0)) {\n                array[k] = leftElement;\n                ++i;\n            } else if (j < rightLength) {\n                array[k] = rightElement;\n                ++j;\n            }\n        }\n    }\n\n    function sort(array, compare, userDefinedObject, start, end) {\n        if (start >= end) {\n            return;\n        }\n\n        var middle = Math.floor((start + end) * 0.5);\n        sort(array, compare, userDefinedObject, start, middle);\n        sort(array, compare, userDefinedObject, middle + 1, end);\n        merge(array, compare, userDefinedObject, start, middle, end);\n    }\n\n    /**\n     * A stable merge sort.\n     *\n     * @exports mergeSort\n     * @param {Array} array The array to sort.\n     * @param {mergeSort~Comparator} comparator The function to use to compare elements in the array.\n     * @param {*} [userDefinedObject] Any item to pass as the third parameter to <code>comparator</code>.\n     *\n     * @example\n     * // Assume array contains BoundingSpheres in world coordinates.\n     * // Sort them in ascending order of distance from the camera.\n     * var position = camera.positionWC;\n     * Cesium.mergeSort(array, function(a, b, position) {\n     *     return Cesium.BoundingSphere.distanceSquaredTo(b, position) - Cesium.BoundingSphere.distanceSquaredTo(a, position);\n     * }, position);\n     */\n    function mergeSort(array, comparator, userDefinedObject) {\n        \n\n        var length = array.length;\n        var scratchLength = Math.ceil(length * 0.5);\n\n        // preallocate space in scratch arrays\n        leftScratchArray.length = scratchLength;\n        rightScratchArray.length = scratchLength;\n\n        sort(array, comparator, userDefinedObject, 0, length - 1);\n\n        // trim scratch arrays\n        leftScratchArray.length = 0;\n        rightScratchArray.length = 0;\n    }\n\n    /**\n     * A function used to compare two items while performing a merge sort.\n     * @callback mergeSort~Comparator\n     *\n     * @param {*} a An item in the array.\n     * @param {*} b An item in the array.\n     * @param {*} [userDefinedObject] An object that was passed to {@link mergeSort}.\n     * @returns {Number} Returns a negative value if <code>a</code> is less than <code>b</code>,\n     *          a positive value if <code>a</code> is greater than <code>b</code>, or\n     *          0 if <code>a</code> is equal to <code>b</code>.\n     *\n     * @example\n     * function compareNumbers(a, b, userDefinedObject) {\n     *     return a - b;\n     * }\n     */\nexport default mergeSort;\n","import BoundingSphere from './BoundingSphere.js';\nimport Cartesian3 from './Cartesian3.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport DeveloperError from './DeveloperError.js';\nimport Ellipsoid from './Ellipsoid.js';\nimport CesiumMath from './Math.js';\nimport Rectangle from './Rectangle.js';\nimport Visibility from './Visibility.js';\n\n    /**\n     * Creates an Occluder derived from an object's position and radius, as well as the camera position.\n     * The occluder can be used to determine whether or not other objects are visible or hidden behind the\n     * visible horizon defined by the occluder and camera position.\n     *\n     * @alias Occluder\n     *\n     * @param {BoundingSphere} occluderBoundingSphere The bounding sphere surrounding the occluder.\n     * @param {Cartesian3} cameraPosition The coordinate of the viewer/camera.\n     *\n     * @constructor\n     *\n     * @example\n     * // Construct an occluder one unit away from the origin with a radius of one.\n     * var cameraPosition = Cesium.Cartesian3.ZERO;\n     * var occluderBoundingSphere = new Cesium.BoundingSphere(new Cesium.Cartesian3(0, 0, -1), 1);\n     * var occluder = new Cesium.Occluder(occluderBoundingSphere, cameraPosition);\n     */\n    function Occluder(occluderBoundingSphere, cameraPosition) {\n        \n\n        this._occluderPosition = Cartesian3.clone(occluderBoundingSphere.center);\n        this._occluderRadius = occluderBoundingSphere.radius;\n\n        this._horizonDistance = 0.0;\n        this._horizonPlaneNormal = undefined;\n        this._horizonPlanePosition = undefined;\n        this._cameraPosition = undefined;\n\n        // cameraPosition fills in the above values\n        this.cameraPosition = cameraPosition;\n    }\n\n    var scratchCartesian3 = new Cartesian3();\n\n    Object.defineProperties(Occluder.prototype, {\n        /**\n         * The position of the occluder.\n         * @memberof Occluder.prototype\n         * @type {Cartesian3}\n         */\n        position: {\n            get: function() {\n                return this._occluderPosition;\n            }\n        },\n\n        /**\n         * The radius of the occluder.\n         * @memberof Occluder.prototype\n         * @type {Number}\n         */\n        radius: {\n            get: function() {\n                return this._occluderRadius;\n            }\n        },\n\n        /**\n         * The position of the camera.\n         * @memberof Occluder.prototype\n         * @type {Cartesian3}\n         */\n        cameraPosition: {\n            set: function(cameraPosition) {\n                \n\n                cameraPosition = Cartesian3.clone(cameraPosition, this._cameraPosition);\n\n                var cameraToOccluderVec = Cartesian3.subtract(this._occluderPosition, cameraPosition, scratchCartesian3);\n                var invCameraToOccluderDistance = Cartesian3.magnitudeSquared(cameraToOccluderVec);\n                var occluderRadiusSqrd = this._occluderRadius * this._occluderRadius;\n\n                var horizonDistance;\n                var horizonPlaneNormal;\n                var horizonPlanePosition;\n                if (invCameraToOccluderDistance > occluderRadiusSqrd) {\n                    horizonDistance = Math.sqrt(invCameraToOccluderDistance - occluderRadiusSqrd);\n                    invCameraToOccluderDistance = 1.0 / Math.sqrt(invCameraToOccluderDistance);\n                    horizonPlaneNormal = Cartesian3.multiplyByScalar(cameraToOccluderVec, invCameraToOccluderDistance, scratchCartesian3);\n                    var nearPlaneDistance = horizonDistance * horizonDistance * invCameraToOccluderDistance;\n                    horizonPlanePosition = Cartesian3.add(cameraPosition, Cartesian3.multiplyByScalar(horizonPlaneNormal, nearPlaneDistance, scratchCartesian3), scratchCartesian3);\n                } else {\n                    horizonDistance = Number.MAX_VALUE;\n                }\n\n                this._horizonDistance = horizonDistance;\n                this._horizonPlaneNormal = horizonPlaneNormal;\n                this._horizonPlanePosition = horizonPlanePosition;\n                this._cameraPosition = cameraPosition;\n            }\n        }\n    });\n\n    /**\n     * Creates an occluder from a bounding sphere and the camera position.\n     *\n     * @param {BoundingSphere} occluderBoundingSphere The bounding sphere surrounding the occluder.\n     * @param {Cartesian3} cameraPosition The coordinate of the viewer/camera.\n     * @param {Occluder} [result] The object onto which to store the result.\n     * @returns {Occluder} The occluder derived from an object's position and radius, as well as the camera position.\n     */\n    Occluder.fromBoundingSphere = function(occluderBoundingSphere, cameraPosition, result) {\n        \n\n        if (!defined(result)) {\n            return new Occluder(occluderBoundingSphere, cameraPosition);\n        }\n\n        Cartesian3.clone(occluderBoundingSphere.center, result._occluderPosition);\n        result._occluderRadius = occluderBoundingSphere.radius;\n        result.cameraPosition = cameraPosition;\n\n        return result;\n    };\n\n    var tempVecScratch = new Cartesian3();\n\n    /**\n     * Determines whether or not a point, the <code>occludee</code>, is hidden from view by the occluder.\n     *\n     * @param {Cartesian3} occludee The point surrounding the occludee object.\n     * @returns {Boolean} <code>true</code> if the occludee is visible; otherwise <code>false</code>.\n     *\n     *\n     * @example\n     * var cameraPosition = new Cesium.Cartesian3(0, 0, 0);\n     * var littleSphere = new Cesium.BoundingSphere(new Cesium.Cartesian3(0, 0, -1), 0.25);\n     * var occluder = new Cesium.Occluder(littleSphere, cameraPosition);\n     * var point = new Cesium.Cartesian3(0, 0, -3);\n     * occluder.isPointVisible(point); //returns true\n     *\n     * @see Occluder#computeVisibility\n     */\n    Occluder.prototype.isPointVisible = function(occludee) {\n        if (this._horizonDistance !== Number.MAX_VALUE) {\n            var tempVec = Cartesian3.subtract(occludee, this._occluderPosition, tempVecScratch);\n            var temp = this._occluderRadius;\n            temp = Cartesian3.magnitudeSquared(tempVec) - (temp * temp);\n            if (temp > 0.0) {\n                temp = Math.sqrt(temp) + this._horizonDistance;\n                tempVec = Cartesian3.subtract(occludee, this._cameraPosition, tempVec);\n                return temp * temp > Cartesian3.magnitudeSquared(tempVec);\n            }\n        }\n        return false;\n    };\n\n    var occludeePositionScratch = new Cartesian3();\n\n    /**\n    * Determines whether or not a sphere, the <code>occludee</code>, is hidden from view by the occluder.\n    *\n    * @param {BoundingSphere} occludee The bounding sphere surrounding the occludee object.\n    * @returns {Boolean} <code>true</code> if the occludee is visible; otherwise <code>false</code>.\n    *\n    *\n    * @example\n    * var cameraPosition = new Cesium.Cartesian3(0, 0, 0);\n    * var littleSphere = new Cesium.BoundingSphere(new Cesium.Cartesian3(0, 0, -1), 0.25);\n    * var occluder = new Cesium.Occluder(littleSphere, cameraPosition);\n    * var bigSphere = new Cesium.BoundingSphere(new Cesium.Cartesian3(0, 0, -3), 1);\n    * occluder.isBoundingSphereVisible(bigSphere); //returns true\n    *\n    * @see Occluder#computeVisibility\n    */\n    Occluder.prototype.isBoundingSphereVisible = function(occludee) {\n        var occludeePosition = Cartesian3.clone(occludee.center, occludeePositionScratch);\n        var occludeeRadius = occludee.radius;\n\n        if (this._horizonDistance !== Number.MAX_VALUE) {\n            var tempVec = Cartesian3.subtract(occludeePosition, this._occluderPosition, tempVecScratch);\n            var temp = this._occluderRadius - occludeeRadius;\n            temp = Cartesian3.magnitudeSquared(tempVec) - (temp * temp);\n            if (occludeeRadius < this._occluderRadius) {\n                if (temp > 0.0) {\n                    temp = Math.sqrt(temp) + this._horizonDistance;\n                    tempVec = Cartesian3.subtract(occludeePosition, this._cameraPosition, tempVec);\n                    return ((temp * temp) + (occludeeRadius * occludeeRadius)) > Cartesian3.magnitudeSquared(tempVec);\n                }\n                return false;\n            }\n\n            // Prevent against the case where the occludee radius is larger than the occluder's; since this is\n            // an uncommon case, the following code should rarely execute.\n            if (temp > 0.0) {\n                tempVec = Cartesian3.subtract(occludeePosition, this._cameraPosition, tempVec);\n                var tempVecMagnitudeSquared = Cartesian3.magnitudeSquared(tempVec);\n                var occluderRadiusSquared = this._occluderRadius * this._occluderRadius;\n                var occludeeRadiusSquared = occludeeRadius * occludeeRadius;\n                if ((((this._horizonDistance * this._horizonDistance) + occluderRadiusSquared) * occludeeRadiusSquared) >\n                    (tempVecMagnitudeSquared * occluderRadiusSquared)) {\n                    // The occludee is close enough that the occluder cannot possible occlude the occludee\n                    return true;\n                }\n                temp = Math.sqrt(temp) + this._horizonDistance;\n                return ((temp * temp) + occludeeRadiusSquared) > tempVecMagnitudeSquared;\n            }\n\n            // The occludee completely encompasses the occluder\n            return true;\n        }\n\n        return false;\n    };\n\n    var tempScratch = new Cartesian3();\n    /**\n     * Determine to what extent an occludee is visible (not visible, partially visible,  or fully visible).\n     *\n     * @param {BoundingSphere} occludeeBS The bounding sphere of the occludee.\n     * @returns {Number} Visibility.NONE if the occludee is not visible,\n     *                       Visibility.PARTIAL if the occludee is partially visible, or\n     *                       Visibility.FULL if the occludee is fully visible.\n     *\n     *\n     * @example\n     * var sphere1 = new Cesium.BoundingSphere(new Cesium.Cartesian3(0, 0, -1.5), 0.5);\n     * var sphere2 = new Cesium.BoundingSphere(new Cesium.Cartesian3(0, 0, -2.5), 0.5);\n     * var cameraPosition = new Cesium.Cartesian3(0, 0, 0);\n     * var occluder = new Cesium.Occluder(sphere1, cameraPosition);\n     * occluder.computeVisibility(sphere2); //returns Visibility.NONE\n     *\n     * @see Occluder#isVisible\n     */\n    Occluder.prototype.computeVisibility = function(occludeeBS) {\n        \n\n        // If the occludee radius is larger than the occluders, this will return that\n        // the entire ocludee is visible, even though that may not be the case, though this should\n        // not occur too often.\n        var occludeePosition = Cartesian3.clone(occludeeBS.center);\n        var occludeeRadius = occludeeBS.radius;\n\n        if (occludeeRadius > this._occluderRadius) {\n            return Visibility.FULL;\n        }\n\n        if (this._horizonDistance !== Number.MAX_VALUE) {\n            // The camera is outside the occluder\n            var tempVec = Cartesian3.subtract(occludeePosition, this._occluderPosition, tempScratch);\n            var temp = this._occluderRadius - occludeeRadius;\n            var occluderToOccludeeDistSqrd = Cartesian3.magnitudeSquared(tempVec);\n            temp = occluderToOccludeeDistSqrd - (temp * temp);\n            if (temp > 0.0) {\n                // The occludee is not completely inside the occluder\n                // Check to see if the occluder completely hides the occludee\n                temp = Math.sqrt(temp) + this._horizonDistance;\n                tempVec = Cartesian3.subtract(occludeePosition, this._cameraPosition, tempVec);\n                var cameraToOccludeeDistSqrd = Cartesian3.magnitudeSquared(tempVec);\n                if (((temp * temp) + (occludeeRadius * occludeeRadius)) < cameraToOccludeeDistSqrd) {\n                    return Visibility.NONE;\n                }\n\n                // Check to see whether the occluder is fully or partially visible\n                // when the occludee does not intersect the occluder\n                temp = this._occluderRadius + occludeeRadius;\n                temp = occluderToOccludeeDistSqrd - (temp * temp);\n                if (temp > 0.0) {\n                    // The occludee does not intersect the occluder.\n                    temp = Math.sqrt(temp) + this._horizonDistance;\n                    return (cameraToOccludeeDistSqrd < ((temp * temp)) + (occludeeRadius * occludeeRadius)) ? Visibility.FULL : Visibility.PARTIAL;\n                }\n\n                //Check to see if the occluder is fully or partially visible when the occludee DOES\n                //intersect the occluder\n                tempVec = Cartesian3.subtract(occludeePosition, this._horizonPlanePosition, tempVec);\n                return (Cartesian3.dot(tempVec, this._horizonPlaneNormal) > -occludeeRadius) ? Visibility.PARTIAL : Visibility.FULL;\n            }\n        }\n        return Visibility.NONE;\n    };\n\n    var occludeePointScratch = new Cartesian3();\n    /**\n     * Computes a point that can be used as the occludee position to the visibility functions.\n     * Use a radius of zero for the occludee radius.  Typically, a user computes a bounding sphere around\n     * an object that is used for visibility; however it is also possible to compute a point that if\n     * seen/not seen would also indicate if an object is visible/not visible.  This function is better\n     * called for objects that do not move relative to the occluder and is large, such as a chunk of\n     * terrain.  You are better off not calling this and using the object's bounding sphere for objects\n     * such as a satellite or ground vehicle.\n     *\n     * @param {BoundingSphere} occluderBoundingSphere The bounding sphere surrounding the occluder.\n     * @param {Cartesian3} occludeePosition The point where the occludee (bounding sphere of radius 0) is located.\n     * @param {Cartesian3[]} positions List of altitude points on the horizon near the surface of the occluder.\n     * @returns {Object} An object containing two attributes: <code>occludeePoint</code> and <code>valid</code>\n     * which is a boolean value.\n     *\n     * @exception {DeveloperError} <code>positions</code> must contain at least one element.\n     * @exception {DeveloperError} <code>occludeePosition</code> must have a value other than <code>occluderBoundingSphere.center</code>.\n     *\n     * @example\n     * var cameraPosition = new Cesium.Cartesian3(0, 0, 0);\n     * var occluderBoundingSphere = new Cesium.BoundingSphere(new Cesium.Cartesian3(0, 0, -8), 2);\n     * var occluder = new Cesium.Occluder(occluderBoundingSphere, cameraPosition);\n     * var positions = [new Cesium.Cartesian3(-0.25, 0, -5.3), new Cesium.Cartesian3(0.25, 0, -5.3)];\n     * var tileOccluderSphere = Cesium.BoundingSphere.fromPoints(positions);\n     * var occludeePosition = tileOccluderSphere.center;\n     * var occludeePt = Cesium.Occluder.computeOccludeePoint(occluderBoundingSphere, occludeePosition, positions);\n     */\n    Occluder.computeOccludeePoint = function(occluderBoundingSphere, occludeePosition, positions) {\n        \n\n        var occludeePos = Cartesian3.clone(occludeePosition);\n        var occluderPosition = Cartesian3.clone(occluderBoundingSphere.center);\n        var occluderRadius = occluderBoundingSphere.radius;\n        var numPositions = positions.length;\n\n        \n\n        // Compute a plane with a normal from the occluder to the occludee position.\n        var occluderPlaneNormal = Cartesian3.normalize(Cartesian3.subtract(occludeePos, occluderPosition, occludeePointScratch), occludeePointScratch);\n        var occluderPlaneD = -(Cartesian3.dot(occluderPlaneNormal, occluderPosition));\n\n        //For each position, determine the horizon intersection. Choose the position and intersection\n        //that results in the greatest angle with the occcluder plane.\n        var aRotationVector = Occluder._anyRotationVector(occluderPosition, occluderPlaneNormal, occluderPlaneD);\n        var dot = Occluder._horizonToPlaneNormalDotProduct(occluderBoundingSphere, occluderPlaneNormal, occluderPlaneD, aRotationVector, positions[0]);\n        if (!dot) {\n            //The position is inside the mimimum radius, which is invalid\n            return undefined;\n        }\n        var tempDot;\n        for ( var i = 1; i < numPositions; ++i) {\n            tempDot = Occluder._horizonToPlaneNormalDotProduct(occluderBoundingSphere, occluderPlaneNormal, occluderPlaneD, aRotationVector, positions[i]);\n            if (!tempDot) {\n                //The position is inside the minimum radius, which is invalid\n                return undefined;\n            }\n            if (tempDot < dot) {\n                dot = tempDot;\n            }\n        }\n        //Verify that the dot is not near 90 degress\n        if (dot < 0.00174532836589830883577820272085) {\n            return undefined;\n        }\n\n        var distance = occluderRadius / dot;\n        return Cartesian3.add(occluderPosition, Cartesian3.multiplyByScalar(occluderPlaneNormal, distance, occludeePointScratch), occludeePointScratch);\n    };\n\n    var computeOccludeePointFromRectangleScratch = [];\n    /**\n     * Computes a point that can be used as the occludee position to the visibility functions from a rectangle.\n     *\n     * @param {Rectangle} rectangle The rectangle used to create a bounding sphere.\n     * @param {Ellipsoid} [ellipsoid=Ellipsoid.WGS84] The ellipsoid used to determine positions of the rectangle.\n     * @returns {Object} An object containing two attributes: <code>occludeePoint</code> and <code>valid</code>\n     * which is a boolean value.\n     */\n    Occluder.computeOccludeePointFromRectangle = function(rectangle, ellipsoid) {\n        \n\n        ellipsoid = defaultValue(ellipsoid, Ellipsoid.WGS84);\n        var positions = Rectangle.subsample(rectangle, ellipsoid, 0.0, computeOccludeePointFromRectangleScratch);\n        var bs = BoundingSphere.fromPoints(positions);\n\n        // TODO: get correct ellipsoid center\n        var ellipsoidCenter = Cartesian3.ZERO;\n        if (!Cartesian3.equals(ellipsoidCenter, bs.center)) {\n            return Occluder.computeOccludeePoint(new BoundingSphere(ellipsoidCenter, ellipsoid.minimumRadius), bs.center, positions);\n        }\n\n        return undefined;\n    };\n\n    var tempVec0Scratch = new Cartesian3();\n    Occluder._anyRotationVector = function(occluderPosition, occluderPlaneNormal, occluderPlaneD) {\n        var tempVec0 = Cartesian3.abs(occluderPlaneNormal, tempVec0Scratch);\n        var majorAxis = tempVec0.x > tempVec0.y ? 0 : 1;\n        if (((majorAxis === 0) && (tempVec0.z > tempVec0.x)) || ((majorAxis === 1) && (tempVec0.z > tempVec0.y))) {\n            majorAxis = 2;\n        }\n        var tempVec = new Cartesian3();\n        var tempVec1;\n        if (majorAxis === 0) {\n            tempVec0.x = occluderPosition.x;\n            tempVec0.y = occluderPosition.y + 1.0;\n            tempVec0.z = occluderPosition.z + 1.0;\n            tempVec1 = Cartesian3.UNIT_X;\n        } else if (majorAxis === 1) {\n            tempVec0.x = occluderPosition.x + 1.0;\n            tempVec0.y = occluderPosition.y;\n            tempVec0.z = occluderPosition.z + 1.0;\n            tempVec1 = Cartesian3.UNIT_Y;\n        } else {\n            tempVec0.x = occluderPosition.x + 1.0;\n            tempVec0.y = occluderPosition.y + 1.0;\n            tempVec0.z = occluderPosition.z;\n            tempVec1 = Cartesian3.UNIT_Z;\n        }\n        var u = (Cartesian3.dot(occluderPlaneNormal, tempVec0) + occluderPlaneD) / -(Cartesian3.dot(occluderPlaneNormal, tempVec1));\n        return Cartesian3.normalize(Cartesian3.subtract(Cartesian3.add(tempVec0, Cartesian3.multiplyByScalar(tempVec1, u, tempVec), tempVec0), occluderPosition, tempVec0), tempVec0);\n    };\n\n    var posDirectionScratch = new Cartesian3();\n    Occluder._rotationVector = function(occluderPosition, occluderPlaneNormal, occluderPlaneD, position, anyRotationVector) {\n        //Determine the angle between the occluder plane normal and the position direction\n        var positionDirection = Cartesian3.subtract(position, occluderPosition, posDirectionScratch);\n        positionDirection = Cartesian3.normalize(positionDirection, positionDirection);\n        if (Cartesian3.dot(occluderPlaneNormal, positionDirection) < 0.99999998476912904932780850903444) {\n            var crossProduct = Cartesian3.cross(occluderPlaneNormal, positionDirection, positionDirection);\n            var length = Cartesian3.magnitude(crossProduct);\n            if (length > CesiumMath.EPSILON13) {\n                return Cartesian3.normalize(crossProduct, new Cartesian3());\n            }\n        }\n        //The occluder plane normal and the position direction are colinear. Use any\n        //vector in the occluder plane as the rotation vector\n        return anyRotationVector;\n    };\n\n    var posScratch1 = new Cartesian3();\n    var occluerPosScratch = new Cartesian3();\n    var posScratch2 = new Cartesian3();\n    var horizonPlanePosScratch = new Cartesian3();\n    Occluder._horizonToPlaneNormalDotProduct = function(occluderBS, occluderPlaneNormal, occluderPlaneD, anyRotationVector, position) {\n        var pos = Cartesian3.clone(position, posScratch1);\n        var occluderPosition = Cartesian3.clone(occluderBS.center, occluerPosScratch);\n        var occluderRadius = occluderBS.radius;\n\n        //Verify that the position is outside the occluder\n        var positionToOccluder = Cartesian3.subtract(occluderPosition, pos, posScratch2);\n        var occluderToPositionDistanceSquared = Cartesian3.magnitudeSquared(positionToOccluder);\n        var occluderRadiusSquared = occluderRadius * occluderRadius;\n        if (occluderToPositionDistanceSquared < occluderRadiusSquared) {\n            return false;\n        }\n\n        //Horizon parameters\n        var horizonDistanceSquared = occluderToPositionDistanceSquared - occluderRadiusSquared;\n        var horizonDistance = Math.sqrt(horizonDistanceSquared);\n        var occluderToPositionDistance = Math.sqrt(occluderToPositionDistanceSquared);\n        var invOccluderToPositionDistance = 1.0 / occluderToPositionDistance;\n        var cosTheta = horizonDistance * invOccluderToPositionDistance;\n        var horizonPlaneDistance = cosTheta * horizonDistance;\n        positionToOccluder = Cartesian3.normalize(positionToOccluder, positionToOccluder);\n        var horizonPlanePosition = Cartesian3.add(pos, Cartesian3.multiplyByScalar(positionToOccluder, horizonPlaneDistance, horizonPlanePosScratch), horizonPlanePosScratch);\n        var horizonCrossDistance = Math.sqrt(horizonDistanceSquared - (horizonPlaneDistance * horizonPlaneDistance));\n\n        //Rotate the position to occluder vector 90 degrees\n        var tempVec = this._rotationVector(occluderPosition, occluderPlaneNormal, occluderPlaneD, pos, anyRotationVector);\n        var horizonCrossDirection = Cartesian3.fromElements(\n                (tempVec.x * tempVec.x * positionToOccluder.x) + ((tempVec.x * tempVec.y - tempVec.z) * positionToOccluder.y) + ((tempVec.x * tempVec.z + tempVec.y) * positionToOccluder.z),\n                ((tempVec.x * tempVec.y + tempVec.z) * positionToOccluder.x) + (tempVec.y * tempVec.y * positionToOccluder.y) + ((tempVec.y * tempVec.z - tempVec.x) * positionToOccluder.z),\n                ((tempVec.x * tempVec.z - tempVec.y) * positionToOccluder.x) + ((tempVec.y * tempVec.z + tempVec.x) * positionToOccluder.y) + (tempVec.z * tempVec.z * positionToOccluder.z),\n                posScratch1);\n        horizonCrossDirection = Cartesian3.normalize(horizonCrossDirection, horizonCrossDirection);\n\n        //Horizon positions\n        var offset = Cartesian3.multiplyByScalar(horizonCrossDirection, horizonCrossDistance, posScratch1);\n        tempVec = Cartesian3.normalize(Cartesian3.subtract(Cartesian3.add(horizonPlanePosition, offset, posScratch2), occluderPosition, posScratch2), posScratch2);\n        var dot0 = Cartesian3.dot(occluderPlaneNormal, tempVec);\n        tempVec = Cartesian3.normalize(Cartesian3.subtract(Cartesian3.subtract(horizonPlanePosition, offset, tempVec), occluderPosition, tempVec), tempVec);\n        var dot1 = Cartesian3.dot(occluderPlaneNormal, tempVec);\n        return (dot0 < dot1) ? dot0 : dot1;\n    };\nexport default Occluder;\n","import BoundingRectangle from '../Core/BoundingRectangle.js';\nimport Check from '../Core/Check.js';\nimport Color from '../Core/Color.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport PrimitiveType from '../Core/PrimitiveType.js';\nimport ViewportQuadVS from '../Shaders/ViewportQuadVS.js';\nimport ClearCommand from './ClearCommand.js';\nimport DrawCommand from './DrawCommand.js';\nimport Framebuffer from './Framebuffer.js';\nimport RenderState from './RenderState.js';\nimport ShaderProgram from './ShaderProgram.js';\n\n    /**\n     * @private\n     */\n    function ComputeEngine(context) {\n        this._context = context;\n    }\n\n    var renderStateScratch;\n    var drawCommandScratch = new DrawCommand({\n        primitiveType : PrimitiveType.TRIANGLES\n    });\n    var clearCommandScratch = new ClearCommand({\n        color : new Color(0.0, 0.0, 0.0, 0.0)\n    });\n\n    function createFramebuffer(context, outputTexture) {\n        return new Framebuffer({\n            context : context,\n            colorTextures : [outputTexture],\n            destroyAttachments : false\n        });\n    }\n\n    function createViewportQuadShader(context, fragmentShaderSource) {\n        return ShaderProgram.fromCache({\n            context : context,\n            vertexShaderSource : ViewportQuadVS,\n            fragmentShaderSource : fragmentShaderSource,\n            attributeLocations : {\n                position : 0,\n                textureCoordinates : 1\n            }\n        });\n    }\n\n    function createRenderState(width, height) {\n        if ((!defined(renderStateScratch)) ||\n            (renderStateScratch.viewport.width !== width) ||\n            (renderStateScratch.viewport.height !== height)) {\n\n            renderStateScratch = RenderState.fromCache({\n                viewport : new BoundingRectangle(0, 0, width, height)\n            });\n        }\n        return renderStateScratch;\n    }\n\n    ComputeEngine.prototype.execute = function(computeCommand) {\n        \n\n        // This may modify the command's resources, so do error checking afterwards\n        if (defined(computeCommand.preExecute)) {\n            computeCommand.preExecute(computeCommand);\n        }\n\n        \n\n        var outputTexture = computeCommand.outputTexture;\n        var width = outputTexture.width;\n        var height = outputTexture.height;\n\n        var context = this._context;\n        var vertexArray = defined(computeCommand.vertexArray) ? computeCommand.vertexArray : context.getViewportQuadVertexArray();\n        var shaderProgram = defined(computeCommand.shaderProgram) ? computeCommand.shaderProgram : createViewportQuadShader(context, computeCommand.fragmentShaderSource);\n        var framebuffer = createFramebuffer(context, outputTexture);\n        var renderState = createRenderState(width, height);\n        var uniformMap = computeCommand.uniformMap;\n\n        var clearCommand = clearCommandScratch;\n        clearCommand.framebuffer = framebuffer;\n        clearCommand.renderState = renderState;\n        clearCommand.execute(context);\n\n        var drawCommand = drawCommandScratch;\n        drawCommand.vertexArray = vertexArray;\n        drawCommand.renderState = renderState;\n        drawCommand.shaderProgram = shaderProgram;\n        drawCommand.uniformMap = uniformMap;\n        drawCommand.framebuffer = framebuffer;\n        drawCommand.execute(context);\n\n        framebuffer.destroy();\n\n        if (!computeCommand.persists) {\n            shaderProgram.destroy();\n            if (defined(computeCommand.vertexArray)) {\n                vertexArray.destroy();\n            }\n        }\n\n        if (defined(computeCommand.postExecute)) {\n            computeCommand.postExecute(outputTexture);\n        }\n    };\n\n    ComputeEngine.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    ComputeEngine.prototype.destroy = function() {\n        return destroyObject(this);\n    };\nexport default ComputeEngine;\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"attribute vec4 position;\\n\\\nattribute vec2 textureCoordinates;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nvoid main() \\n\\\n{\\n\\\n    gl_Position = position;\\n\\\n    v_textureCoordinates = textureCoordinates;\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D u_floatTexture;\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    float actual = texture2D(u_floatTexture, vec2(0.5, 0.5)).r;\\n\\\n    float expected = 123456.0;\\n\\\n    gl_FragColor = vec4(abs(actual - expected), 0.0, 0.0, 1.0);\\n\\\n}\\n\\\n\";\n","import PixelFormat from '../Core/PixelFormat.js';\nimport CheckFloatTexturePrecisionFS from '../Shaders/CheckFloatTexturePrecisionFS.js';\nimport ComputeCommand from './ComputeCommand.js';\nimport ComputeEngine from './ComputeEngine.js';\nimport Framebuffer from './Framebuffer.js';\nimport PixelDatatype from './PixelDatatype.js';\nimport Texture from './Texture.js';\n\n    /**\n     * Checks if the context's floating point textures support 6 decimal places of precision.\n     *\n     * @param {Context} context A context wrapping a gl implementation.\n     * @returns {Boolean} Whether or not the context's floating point textures support 6 decimal places of precision\n     *\n     * @private\n     */\n    function checkFloatTexturePrecision(context) {\n        if (!context.floatingPointTexture) {\n            return false;\n        }\n\n        var computeEngine = new ComputeEngine(context);\n        var outputTexture = new Texture({\n            context : context,\n            width : 1,\n            height : 1,\n            pixelFormat : PixelFormat.RGBA\n        });\n\n        var floatTexture = new Texture({\n            context : context,\n            width : 1,\n            height : 1,\n            pixelFormat : PixelFormat.RGBA,\n            pixelDatatype : checkFloatTexturePrecision._getFloatPixelType(),\n            source : {\n                width : 1,\n                height : 1,\n                arrayBufferView : checkFloatTexturePrecision._getArray([123456, 0, 0, 0])\n            }\n        });\n\n        var framebuffer = new Framebuffer({\n            context : context,\n            colorTextures : [outputTexture],\n            destroyAttachments : false\n        });\n\n        var readState = {\n            framebuffer : framebuffer,\n            x : 0,\n            y : 0,\n            width : 1,\n            height : 1\n        };\n\n        var sixPlaces = false;\n        var computeCommand = new ComputeCommand({\n            fragmentShaderSource : CheckFloatTexturePrecisionFS,\n            outputTexture : outputTexture,\n            uniformMap : {\n                u_floatTexture : function() {\n                    return floatTexture;\n                }\n            },\n            persists : false,\n            postExecute : function() {\n                var pixel = context.readPixels(readState);\n                sixPlaces = pixel[0] === 0;\n            }\n        });\n\n        computeCommand.execute(computeEngine);\n\n        computeEngine.destroy();\n        framebuffer.destroy();\n\n        return sixPlaces;\n    }\n\n    checkFloatTexturePrecision._getFloatPixelType = function() {\n        return PixelDatatype.FLOAT;\n    };\n\n    checkFloatTexturePrecision._getArray = function(array) {\n        return new Float32Array(array);\n    };\nexport default checkFloatTexturePrecision;\n","\n    /**\n     * The state for a particular rendering pass.  This is used to supplement the state\n     * in a command being executed.\n     *\n     * @private\n     */\n    function PassState(context) {\n        /**\n         * The context used to execute commands for this pass.\n         *\n         * @type {Context}\n         */\n        this.context = context;\n\n        /**\n         * The framebuffer to render to.  This framebuffer is used unless a {@link DrawCommand}\n         * or {@link ClearCommand} explicitly define a framebuffer, which is used for off-screen\n         * rendering.\n         *\n         * @type {Framebuffer}\n         * @default undefined\n         */\n        this.framebuffer = undefined;\n\n        /**\n         * When defined, this overrides the blending property of a {@link DrawCommand}'s render state.\n         * This is used to, for example, to allow the renderer to turn off blending during the picking pass.\n         * <p>\n         * When this is <code>undefined</code>, the {@link DrawCommand}'s property is used.\n         * </p>\n         *\n         * @type {Boolean}\n         * @default undefined\n         */\n        this.blendingEnabled = undefined;\n\n        /**\n         * When defined, this overrides the scissor test property of a {@link DrawCommand}'s render state.\n         * This is used to, for example, to allow the renderer to scissor out the pick region during the picking pass.\n         * <p>\n         * When this is <code>undefined</code>, the {@link DrawCommand}'s property is used.\n         * </p>\n         *\n         * @type {Object}\n         * @default undefined\n         */\n        this.scissorTest = undefined;\n\n        /**\n         * The viewport used when one is not defined by a {@link DrawCommand}'s render state.\n         * @type {BoundingRectangle}\n         * @default undefined\n         */\n        this.viewport = undefined;\n    }\nexport default PassState;\n","import defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport ShaderProgram from './ShaderProgram.js';\nimport ShaderSource from './ShaderSource.js';\n\n    /**\n     * @private\n     */\n    function ShaderCache(context) {\n        this._context = context;\n        this._shaders = {};\n        this._numberOfShaders = 0;\n        this._shadersToRelease = {};\n    }\n\n    Object.defineProperties(ShaderCache.prototype, {\n        numberOfShaders : {\n            get : function() {\n                return this._numberOfShaders;\n            }\n        }\n    });\n\n    /**\n     * Returns a shader program from the cache, or creates and caches a new shader program,\n     * given the GLSL vertex and fragment shader source and attribute locations.\n     * <p>\n     * The difference between this and {@link ShaderCache#getShaderProgram}, is this is used to\n     * replace an existing reference to a shader program, which is passed as the first argument.\n     * </p>\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {ShaderProgram} [options.shaderProgram] The shader program that is being reassigned.\n     * @param {String|ShaderSource} options.vertexShaderSource The GLSL source for the vertex shader.\n     * @param {String|ShaderSource} options.fragmentShaderSource The GLSL source for the fragment shader.\n     * @param {Object} options.attributeLocations Indices for the attribute inputs to the vertex shader.\n\n     * @returns {ShaderProgram} The cached or newly created shader program.\n     *\n     *\n     * @example\n     * this._shaderProgram = context.shaderCache.replaceShaderProgram({\n     *     shaderProgram : this._shaderProgram,\n     *     vertexShaderSource : vs,\n     *     fragmentShaderSource : fs,\n     *     attributeLocations : attributeLocations\n     * });\n     *\n     * @see ShaderCache#getShaderProgram\n     */\n    ShaderCache.prototype.replaceShaderProgram = function(options) {\n        if (defined(options.shaderProgram)) {\n            options.shaderProgram.destroy();\n        }\n\n        return this.getShaderProgram(options);\n    };\n\n    /**\n     * Returns a shader program from the cache, or creates and caches a new shader program,\n     * given the GLSL vertex and fragment shader source and attribute locations.\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {String|ShaderSource} options.vertexShaderSource The GLSL source for the vertex shader.\n     * @param {String|ShaderSource} options.fragmentShaderSource The GLSL source for the fragment shader.\n     * @param {Object} options.attributeLocations Indices for the attribute inputs to the vertex shader.\n     *\n     * @returns {ShaderProgram} The cached or newly created shader program.\n     */\n    ShaderCache.prototype.getShaderProgram = function(options) {\n        // convert shaders which are provided as strings into ShaderSource objects\n        // because ShaderSource handles all the automatic including of built-in functions, etc.\n\n        var vertexShaderSource = options.vertexShaderSource;\n        var fragmentShaderSource = options.fragmentShaderSource;\n        var attributeLocations = options.attributeLocations;\n\n        if (typeof vertexShaderSource === 'string') {\n            vertexShaderSource = new ShaderSource({\n                sources : [vertexShaderSource]\n            });\n        }\n\n        if (typeof fragmentShaderSource === 'string') {\n            fragmentShaderSource = new ShaderSource({\n                sources : [fragmentShaderSource]\n            });\n        }\n\n        var vertexShaderText = vertexShaderSource.createCombinedVertexShader(this._context);\n        var fragmentShaderText = fragmentShaderSource.createCombinedFragmentShader(this._context);\n\n        var keyword = vertexShaderText + fragmentShaderText + JSON.stringify(attributeLocations);\n        var cachedShader;\n\n        if (defined(this._shaders[keyword])) {\n            cachedShader = this._shaders[keyword];\n\n            // No longer want to release this if it was previously released.\n            delete this._shadersToRelease[keyword];\n        } else {\n            var context = this._context;\n            var shaderProgram = new ShaderProgram({\n                gl : context._gl,\n                logShaderCompilation : context.logShaderCompilation,\n                debugShaders : context.debugShaders,\n                vertexShaderSource : vertexShaderSource,\n                vertexShaderText : vertexShaderText,\n                fragmentShaderSource : fragmentShaderSource,\n                fragmentShaderText : fragmentShaderText,\n                attributeLocations : attributeLocations\n            });\n\n            cachedShader = {\n                cache : this,\n                shaderProgram : shaderProgram,\n                keyword : keyword,\n                derivedKeywords : [],\n                count : 0\n            };\n\n            // A shader can't be in more than one cache.\n            shaderProgram._cachedShader = cachedShader;\n            this._shaders[keyword] = cachedShader;\n            ++this._numberOfShaders;\n        }\n\n        ++cachedShader.count;\n        return cachedShader.shaderProgram;\n    };\n\n    ShaderCache.prototype.replaceDerivedShaderProgram = function(shaderProgram, keyword, options) {\n        var cachedShader = shaderProgram._cachedShader;\n        var derivedKeyword = keyword + cachedShader.keyword;\n        var cachedDerivedShader = this._shaders[derivedKeyword];\n        if (defined(cachedDerivedShader)) {\n            destroyShader(this, cachedDerivedShader);\n            var index = cachedShader.derivedKeywords.indexOf(keyword);\n            if (index > -1) {\n                cachedShader.derivedKeywords.splice(index, 1);\n            }\n        }\n\n        return this.createDerivedShaderProgram(shaderProgram, keyword, options);\n    };\n\n    ShaderCache.prototype.getDerivedShaderProgram = function(shaderProgram, keyword) {\n        var cachedShader = shaderProgram._cachedShader;\n        var derivedKeyword = keyword + cachedShader.keyword;\n        var cachedDerivedShader = this._shaders[derivedKeyword];\n        if (!defined(cachedDerivedShader)) {\n            return undefined;\n        }\n\n        return cachedDerivedShader.shaderProgram;\n    };\n\n    ShaderCache.prototype.createDerivedShaderProgram = function(shaderProgram, keyword, options) {\n        var cachedShader = shaderProgram._cachedShader;\n        var derivedKeyword = keyword + cachedShader.keyword;\n\n        var vertexShaderSource = options.vertexShaderSource;\n        var fragmentShaderSource = options.fragmentShaderSource;\n        var attributeLocations = options.attributeLocations;\n\n        if (typeof vertexShaderSource === 'string') {\n            vertexShaderSource = new ShaderSource({\n                sources : [vertexShaderSource]\n            });\n        }\n\n        if (typeof fragmentShaderSource === 'string') {\n            fragmentShaderSource = new ShaderSource({\n                sources : [fragmentShaderSource]\n            });\n        }\n\n        var context = this._context;\n\n        var vertexShaderText = vertexShaderSource.createCombinedVertexShader(context);\n        var fragmentShaderText = fragmentShaderSource.createCombinedFragmentShader(context);\n\n        var derivedShaderProgram = new ShaderProgram({\n            gl : context._gl,\n            logShaderCompilation : context.logShaderCompilation,\n            debugShaders : context.debugShaders,\n            vertexShaderSource : vertexShaderSource,\n            vertexShaderText : vertexShaderText,\n            fragmentShaderSource : fragmentShaderSource,\n            fragmentShaderText : fragmentShaderText,\n            attributeLocations : attributeLocations\n        });\n\n        var derivedCachedShader = {\n            cache : this,\n            shaderProgram : derivedShaderProgram,\n            keyword : derivedKeyword,\n            derivedKeywords : [],\n            count : 0\n        };\n\n        cachedShader.derivedKeywords.push(keyword);\n        derivedShaderProgram._cachedShader = derivedCachedShader;\n        this._shaders[derivedKeyword] = derivedCachedShader;\n        return derivedShaderProgram;\n    };\n\n    function destroyShader(cache, cachedShader) {\n        var derivedKeywords = cachedShader.derivedKeywords;\n        var length = derivedKeywords.length;\n        for (var i = 0; i < length; ++i) {\n            var keyword = derivedKeywords[i] + cachedShader.keyword;\n            var derivedCachedShader = cache._shaders[keyword];\n            destroyShader(cache, derivedCachedShader);\n        }\n\n        delete cache._shaders[cachedShader.keyword];\n        cachedShader.shaderProgram.finalDestroy();\n    }\n\n    ShaderCache.prototype.destroyReleasedShaderPrograms = function() {\n        var shadersToRelease = this._shadersToRelease;\n\n        for ( var keyword in shadersToRelease) {\n            if (shadersToRelease.hasOwnProperty(keyword)) {\n                var cachedShader = shadersToRelease[keyword];\n                destroyShader(this, cachedShader);\n                --this._numberOfShaders;\n            }\n        }\n\n        this._shadersToRelease = {};\n    };\n\n    ShaderCache.prototype.releaseShaderProgram = function(shaderProgram) {\n        if (defined(shaderProgram)) {\n            var cachedShader = shaderProgram._cachedShader;\n            if (cachedShader && (--cachedShader.count === 0)) {\n                this._shadersToRelease[cachedShader.keyword] = cachedShader;\n            }\n        }\n    };\n\n    ShaderCache.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    ShaderCache.prototype.destroy = function() {\n        var shaders = this._shaders;\n        for (var keyword in shaders) {\n            if (shaders.hasOwnProperty(keyword)) {\n                shaders[keyword].shaderProgram.finalDestroy();\n            }\n        }\n        return destroyObject(this);\n    };\nexport default ShaderCache;\n","import defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\n\n    /**\n     * @private\n     */\n    function TextureCache() {\n        this._textures = {};\n        this._numberOfTextures = 0;\n        this._texturesToRelease = {};\n    }\n\n    Object.defineProperties(TextureCache.prototype, {\n        numberOfTextures : {\n            get : function() {\n                return this._numberOfTextures;\n            }\n        }\n    });\n\n    TextureCache.prototype.getTexture = function(keyword) {\n        var cachedTexture = this._textures[keyword];\n        if (!defined(cachedTexture)) {\n            return undefined;\n        }\n\n        // No longer want to release this if it was previously released.\n        delete this._texturesToRelease[keyword];\n\n        ++cachedTexture.count;\n        return cachedTexture.texture;\n    };\n\n    TextureCache.prototype.addTexture = function(keyword, texture) {\n        var cachedTexture = {\n            texture : texture,\n            count : 1\n        };\n\n        texture.finalDestroy = texture.destroy;\n\n        var that = this;\n        texture.destroy = function() {\n            if (--cachedTexture.count === 0) {\n                that._texturesToRelease[keyword] = cachedTexture;\n            }\n        };\n\n        this._textures[keyword] = cachedTexture;\n        ++this._numberOfTextures;\n    };\n\n    TextureCache.prototype.destroyReleasedTextures = function() {\n        var texturesToRelease = this._texturesToRelease;\n\n        for (var keyword in texturesToRelease) {\n            if (texturesToRelease.hasOwnProperty(keyword)) {\n                var cachedTexture = texturesToRelease[keyword];\n                delete this._textures[keyword];\n                cachedTexture.texture.finalDestroy();\n                --this._numberOfTextures;\n            }\n        }\n\n        this._texturesToRelease = {};\n    };\n\n    TextureCache.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    TextureCache.prototype.destroy = function() {\n        var textures = this._textures;\n        for (var keyword in textures) {\n            if (textures.hasOwnProperty(keyword)) {\n                textures[keyword].texture.finalDestroy();\n            }\n        }\n        return destroyObject(this);\n    };\nexport default TextureCache;\n","import Color from '../Core/Color.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\n\n    /**\n     * A directional light source that originates from the Sun.\n     *\n     * @param {Object} [options] Object with the following properties:\n     * @param {Color} [options.color=Color.WHITE] The light's color.\n     * @param {Number} [options.intensity=2.0] The light's intensity.\n     *\n     * @alias SunLight\n     * @constructor\n     */\n    function SunLight(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n        /**\n         * The color of the light.\n         * @type {Color}\n         * @default Color.WHITE\n         */\n        this.color = defined(options.color) ? Color.clone(options.color) : Color.WHITE;\n\n        /**\n         * The intensity of the light.\n         * @type {Number}\n         * @default 2.0\n         */\n        this.intensity = defaultValue(options.intensity, 2.0);\n    }\n\nexport default SunLight;\n","import BoundingRectangle from '../Core/BoundingRectangle.js';\nimport Cartesian2 from '../Core/Cartesian2.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Cartesian4 from '../Core/Cartesian4.js';\nimport Cartographic from '../Core/Cartographic.js';\nimport Color from '../Core/Color.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport Ellipsoid from '../Core/Ellipsoid.js';\nimport EncodedCartesian3 from '../Core/EncodedCartesian3.js';\nimport CesiumMath from '../Core/Math.js';\nimport Matrix3 from '../Core/Matrix3.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport OrthographicFrustum from '../Core/OrthographicFrustum.js';\nimport Simon1994PlanetaryPositions from '../Core/Simon1994PlanetaryPositions.js';\nimport Transforms from '../Core/Transforms.js';\nimport SceneMode from '../Scene/SceneMode.js';\nimport SunLight from '../Scene/SunLight.js';\n\n    /**\n     * @private\n     */\n    function UniformState() {\n        /**\n         * @type {Texture}\n         */\n        this.globeDepthTexture = undefined;\n        /**\n         * @type {Number}\n         */\n        this.gamma = undefined;\n\n        this._viewport = new BoundingRectangle();\n        this._viewportCartesian4 = new Cartesian4();\n        this._viewportDirty = false;\n        this._viewportOrthographicMatrix = Matrix4.clone(Matrix4.IDENTITY);\n        this._viewportTransformation = Matrix4.clone(Matrix4.IDENTITY);\n\n        this._model = Matrix4.clone(Matrix4.IDENTITY);\n        this._view = Matrix4.clone(Matrix4.IDENTITY);\n        this._inverseView = Matrix4.clone(Matrix4.IDENTITY);\n        this._projection = Matrix4.clone(Matrix4.IDENTITY);\n        this._infiniteProjection = Matrix4.clone(Matrix4.IDENTITY);\n        this._entireFrustum = new Cartesian2();\n        this._currentFrustum = new Cartesian2();\n        this._frustumPlanes = new Cartesian4();\n        this._farDepthFromNearPlusOne = undefined;\n        this._log2FarDepthFromNearPlusOne = undefined;\n        this._oneOverLog2FarDepthFromNearPlusOne = undefined;\n\n        this._frameState = undefined;\n        this._temeToPseudoFixed = Matrix3.clone(Matrix4.IDENTITY);\n\n        // Derived members\n        this._view3DDirty = true;\n        this._view3D = new Matrix4();\n\n        this._inverseView3DDirty = true;\n        this._inverseView3D = new Matrix4();\n\n        this._inverseModelDirty = true;\n        this._inverseModel = new Matrix4();\n\n        this._inverseTransposeModelDirty = true;\n        this._inverseTransposeModel = new Matrix3();\n\n        this._viewRotation = new Matrix3();\n        this._inverseViewRotation = new Matrix3();\n\n        this._viewRotation3D = new Matrix3();\n        this._inverseViewRotation3D = new Matrix3();\n\n        this._inverseProjectionDirty = true;\n        this._inverseProjection = new Matrix4();\n\n        this._modelViewDirty = true;\n        this._modelView = new Matrix4();\n\n        this._modelView3DDirty = true;\n        this._modelView3D = new Matrix4();\n\n        this._modelViewRelativeToEyeDirty = true;\n        this._modelViewRelativeToEye = new Matrix4();\n\n        this._inverseModelViewDirty = true;\n        this._inverseModelView = new Matrix4();\n\n        this._inverseModelView3DDirty = true;\n        this._inverseModelView3D = new Matrix4();\n\n        this._viewProjectionDirty = true;\n        this._viewProjection = new Matrix4();\n\n        this._inverseViewProjectionDirty = true;\n        this._inverseViewProjection = new Matrix4();\n\n        this._modelViewProjectionDirty = true;\n        this._modelViewProjection = new Matrix4();\n\n        this._inverseModelViewProjectionDirty = true;\n        this._inverseModelViewProjection = new Matrix4();\n\n        this._modelViewProjectionRelativeToEyeDirty = true;\n        this._modelViewProjectionRelativeToEye = new Matrix4();\n\n        this._modelViewInfiniteProjectionDirty = true;\n        this._modelViewInfiniteProjection = new Matrix4();\n\n        this._normalDirty = true;\n        this._normal = new Matrix3();\n\n        this._normal3DDirty = true;\n        this._normal3D = new Matrix3();\n\n        this._inverseNormalDirty = true;\n        this._inverseNormal = new Matrix3();\n\n        this._inverseNormal3DDirty = true;\n        this._inverseNormal3D = new Matrix3();\n\n        this._encodedCameraPositionMCDirty = true;\n        this._encodedCameraPositionMC = new EncodedCartesian3();\n        this._cameraPosition = new Cartesian3();\n\n        this._sunPositionWC = new Cartesian3();\n        this._sunPositionColumbusView = new Cartesian3();\n        this._sunDirectionWC = new Cartesian3();\n        this._sunDirectionEC = new Cartesian3();\n        this._moonDirectionEC = new Cartesian3();\n\n        this._lightDirectionWC = new Cartesian3();\n        this._lightDirectionEC = new Cartesian3();\n        this._lightColor = new Cartesian3();\n        this._lightColorHdr = new Cartesian3();\n\n        this._pass = undefined;\n        this._mode = undefined;\n        this._mapProjection = undefined;\n        this._ellipsoid = undefined;\n        this._cameraDirection = new Cartesian3();\n        this._cameraRight = new Cartesian3();\n        this._cameraUp = new Cartesian3();\n        this._frustum2DWidth = 0.0;\n        this._eyeHeight2D = new Cartesian2();\n        this._pixelRatio = 1.0;\n        this._orthographicIn3D = false;\n        this._backgroundColor = new Color();\n\n        this._brdfLut = undefined;\n        this._environmentMap = undefined;\n\n        this._sphericalHarmonicCoefficients = undefined;\n        this._specularEnvironmentMaps = undefined;\n        this._specularEnvironmentMapsDimensions = new Cartesian2();\n        this._specularEnvironmentMapsMaximumLOD = undefined;\n\n        this._fogDensity = undefined;\n\n        this._invertClassificationColor = undefined;\n\n        this._imagerySplitPosition = 0.0;\n        this._pixelSizePerMeter = undefined;\n        this._geometricToleranceOverMeter = undefined;\n\n        this._minimumDisableDepthTestDistance = undefined;\n    }\n\n    Object.defineProperties(UniformState.prototype, {\n        /**\n         * @memberof UniformState.prototype\n         * @type {FrameState}\n         * @readonly\n         */\n        frameState : {\n            get : function() {\n                return this._frameState;\n            }\n        },\n        /**\n         * @memberof UniformState.prototype\n         * @type {BoundingRectangle}\n         */\n        viewport : {\n            get : function() {\n                return this._viewport;\n            },\n            set : function(viewport) {\n                if (!BoundingRectangle.equals(viewport, this._viewport)) {\n                    BoundingRectangle.clone(viewport, this._viewport);\n\n                    var v = this._viewport;\n                    var vc = this._viewportCartesian4;\n                    vc.x = v.x;\n                    vc.y = v.y;\n                    vc.z = v.width;\n                    vc.w = v.height;\n\n                    this._viewportDirty = true;\n                }\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @private\n         */\n        viewportCartesian4 : {\n            get : function() {\n                return this._viewportCartesian4;\n            }\n        },\n\n        viewportOrthographic : {\n            get : function() {\n                cleanViewport(this);\n                return this._viewportOrthographicMatrix;\n            }\n        },\n\n        viewportTransformation : {\n            get : function() {\n                cleanViewport(this);\n                return this._viewportTransformation;\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        model : {\n            get : function() {\n                return this._model;\n            },\n            set : function(matrix) {\n                Matrix4.clone(matrix, this._model);\n\n                this._modelView3DDirty = true;\n                this._inverseModelView3DDirty = true;\n                this._inverseModelDirty = true;\n                this._inverseTransposeModelDirty = true;\n                this._modelViewDirty = true;\n                this._inverseModelViewDirty = true;\n                this._modelViewRelativeToEyeDirty = true;\n                this._inverseModelViewDirty = true;\n                this._modelViewProjectionDirty = true;\n                this._inverseModelViewProjectionDirty = true;\n                this._modelViewProjectionRelativeToEyeDirty = true;\n                this._modelViewInfiniteProjectionDirty = true;\n                this._normalDirty = true;\n                this._inverseNormalDirty = true;\n                this._normal3DDirty = true;\n                this._inverseNormal3DDirty = true;\n                this._encodedCameraPositionMCDirty = true;\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        inverseModel : {\n            get : function() {\n                if (this._inverseModelDirty) {\n                    this._inverseModelDirty = false;\n\n                    Matrix4.inverse(this._model, this._inverseModel);\n                }\n\n                return this._inverseModel;\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @private\n         */\n        inverseTransposeModel : {\n            get : function() {\n                var m = this._inverseTransposeModel;\n                if (this._inverseTransposeModelDirty) {\n                    this._inverseTransposeModelDirty = false;\n\n                    Matrix4.getMatrix3(this.inverseModel, m);\n                    Matrix3.transpose(m, m);\n                }\n\n                return m;\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        view : {\n            get : function() {\n                return this._view;\n            }\n        },\n\n        /**\n         * The 3D view matrix.  In 3D mode, this is identical to {@link UniformState#view},\n         * but in 2D and Columbus View it is a synthetic matrix based on the equivalent position\n         * of the camera in the 3D world.\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        view3D : {\n            get : function() {\n                updateView3D(this);\n                return this._view3D;\n            }\n        },\n\n        /**\n         * The 3x3 rotation matrix of the current view matrix ({@link UniformState#view}).\n         * @memberof UniformState.prototype\n         * @type {Matrix3}\n         */\n        viewRotation : {\n            get : function() {\n                updateView3D(this);\n                return this._viewRotation;\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @type {Matrix3}\n         */\n        viewRotation3D : {\n            get : function() {\n                updateView3D(this);\n                return this._viewRotation3D;\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        inverseView : {\n            get : function() {\n                return this._inverseView;\n            }\n        },\n\n        /**\n         * the 4x4 inverse-view matrix that transforms from eye to 3D world coordinates.  In 3D mode, this is\n         * identical to {@link UniformState#inverseView}, but in 2D and Columbus View it is a synthetic matrix\n         * based on the equivalent position of the camera in the 3D world.\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        inverseView3D : {\n            get : function() {\n                updateInverseView3D(this);\n                return this._inverseView3D;\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @type {Matrix3}\n         */\n        inverseViewRotation : {\n            get : function() {\n                return this._inverseViewRotation;\n            }\n        },\n\n        /**\n         * The 3x3 rotation matrix of the current 3D inverse-view matrix ({@link UniformState#inverseView3D}).\n         * @memberof UniformState.prototype\n         * @type {Matrix3}\n         */\n        inverseViewRotation3D : {\n            get : function() {\n                updateInverseView3D(this);\n                return this._inverseViewRotation3D;\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        projection : {\n            get : function() {\n                return this._projection;\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        inverseProjection : {\n            get : function() {\n                cleanInverseProjection(this);\n                return this._inverseProjection;\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        infiniteProjection : {\n            get : function() {\n                return this._infiniteProjection;\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        modelView : {\n            get : function() {\n                cleanModelView(this);\n                return this._modelView;\n            }\n        },\n\n        /**\n         * The 3D model-view matrix.  In 3D mode, this is equivalent to {@link UniformState#modelView}.  In 2D and\n         * Columbus View, however, it is a synthetic matrix based on the equivalent position of the camera in the 3D world.\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        modelView3D : {\n            get : function() {\n                cleanModelView3D(this);\n                return this._modelView3D;\n            }\n        },\n\n        /**\n         * Model-view relative to eye matrix.\n         *\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        modelViewRelativeToEye : {\n            get : function() {\n                cleanModelViewRelativeToEye(this);\n                return this._modelViewRelativeToEye;\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        inverseModelView : {\n            get : function() {\n                cleanInverseModelView(this);\n                return this._inverseModelView;\n            }\n        },\n\n        /**\n         * The inverse of the 3D model-view matrix.  In 3D mode, this is equivalent to {@link UniformState#inverseModelView}.\n         * In 2D and Columbus View, however, it is a synthetic matrix based on the equivalent position of the camera in the 3D world.\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        inverseModelView3D : {\n            get : function() {\n                cleanInverseModelView3D(this);\n                return this._inverseModelView3D;\n\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        viewProjection : {\n            get : function() {\n                cleanViewProjection(this);\n                return this._viewProjection;\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        inverseViewProjection : {\n            get : function() {\n                cleanInverseViewProjection(this);\n                return this._inverseViewProjection;\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        modelViewProjection : {\n            get : function() {\n                cleanModelViewProjection(this);\n                return this._modelViewProjection;\n\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        inverseModelViewProjection : {\n            get : function() {\n                cleanInverseModelViewProjection(this);\n                return this._inverseModelViewProjection;\n\n            }\n        },\n\n        /**\n         * Model-view-projection relative to eye matrix.\n         *\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        modelViewProjectionRelativeToEye : {\n            get : function() {\n                cleanModelViewProjectionRelativeToEye(this);\n                return this._modelViewProjectionRelativeToEye;\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @type {Matrix4}\n         */\n        modelViewInfiniteProjection : {\n            get : function() {\n                cleanModelViewInfiniteProjection(this);\n                return this._modelViewInfiniteProjection;\n            }\n        },\n\n        /**\n         * A 3x3 normal transformation matrix that transforms normal vectors in model coordinates to\n         * eye coordinates.\n         * @memberof UniformState.prototype\n         * @type {Matrix3}\n         */\n        normal : {\n            get : function() {\n                cleanNormal(this);\n                return this._normal;\n            }\n        },\n\n        /**\n         * A 3x3 normal transformation matrix that transforms normal vectors in 3D model\n         * coordinates to eye coordinates.  In 3D mode, this is identical to\n         * {@link UniformState#normal}, but in 2D and Columbus View it represents the normal transformation\n         * matrix as if the camera were at an equivalent location in 3D mode.\n         * @memberof UniformState.prototype\n         * @type {Matrix3}\n         */\n        normal3D : {\n            get : function() {\n                cleanNormal3D(this);\n                return this._normal3D;\n\n            }\n        },\n\n        /**\n         * An inverse 3x3 normal transformation matrix that transforms normal vectors in model coordinates\n         * to eye coordinates.\n         * @memberof UniformState.prototype\n         * @type {Matrix3}\n         */\n        inverseNormal : {\n            get : function() {\n                cleanInverseNormal(this);\n                return this._inverseNormal;\n            }\n        },\n\n        /**\n         * An inverse 3x3 normal transformation matrix that transforms normal vectors in eye coordinates\n         * to 3D model coordinates.  In 3D mode, this is identical to\n         * {@link UniformState#inverseNormal}, but in 2D and Columbus View it represents the normal transformation\n         * matrix as if the camera were at an equivalent location in 3D mode.\n         * @memberof UniformState.prototype\n         * @type {Matrix3}\n         */\n        inverseNormal3D : {\n            get : function() {\n                cleanInverseNormal3D(this);\n                return this._inverseNormal3D;\n            }\n        },\n\n        /**\n         * The near distance (<code>x</code>) and the far distance (<code>y</code>) of the frustum defined by the camera.\n         * This is the largest possible frustum, not an individual frustum used for multi-frustum rendering.\n         * @memberof UniformState.prototype\n         * @type {Cartesian2}\n         */\n        entireFrustum : {\n            get : function() {\n                return this._entireFrustum;\n            }\n        },\n\n        /**\n         * The near distance (<code>x</code>) and the far distance (<code>y</code>) of the frustum defined by the camera.\n         * This is the individual frustum used for multi-frustum rendering.\n         * @memberof UniformState.prototype\n         * @type {Cartesian2}\n         */\n        currentFrustum : {\n            get : function() {\n                return this._currentFrustum;\n            }\n        },\n\n        /**\n         * The distances to the frustum planes. The top, bottom, left and right distances are\n         * the x, y, z, and w components, respectively.\n         * @memberof UniformState.prototype\n         * @type {Cartesian4}\n         */\n        frustumPlanes : {\n            get : function() {\n                return this._frustumPlanes;\n            }\n        },\n\n        /**\n         * The far plane's distance from the near plane, plus 1.0.\n         *\n         * @memberof UniformState.prototype\n         * @type {Number}\n         */\n        farDepthFromNearPlusOne : {\n            get : function() {\n                return this._farDepthFromNearPlusOne;\n            }\n        },\n\n        /**\n         * The log2 of {@link UniformState#farDepthFromNearPlusOne}.\n         *\n         * @memberof UniformState.prototype\n         * @type {Number}\n         */\n        log2FarDepthFromNearPlusOne : {\n            get : function() {\n                return this._log2FarDepthFromNearPlusOne;\n            }\n        },\n\n        /**\n         * 1.0 divided by {@link UniformState#log2FarDepthFromNearPlusOne}.\n         *\n         * @memberof UniformState.prototype\n         * @type {Number}\n         */\n        oneOverLog2FarDepthFromNearPlusOne : {\n            get : function() {\n                return this._oneOverLog2FarDepthFromNearPlusOne;\n            }\n        },\n\n        /**\n         * The the height (<code>x</code>) and the height squared (<code>y</code>)\n         * in meters of the camera above the 2D world plane. This uniform is only valid\n         * when the {@link SceneMode} equal to <code>SCENE2D</code>.\n         * @memberof UniformState.prototype\n         * @type {Cartesian2}\n         */\n        eyeHeight2D : {\n            get : function() {\n                return this._eyeHeight2D;\n            }\n        },\n\n        /**\n         * The sun position in 3D world coordinates at the current scene time.\n         * @memberof UniformState.prototype\n         * @type {Cartesian3}\n         */\n        sunPositionWC : {\n            get : function() {\n                return this._sunPositionWC;\n            }\n        },\n\n        /**\n         * The sun position in 2D world coordinates at the current scene time.\n         * @memberof UniformState.prototype\n         * @type {Cartesian3}\n         */\n        sunPositionColumbusView : {\n            get : function(){\n                return this._sunPositionColumbusView;\n            }\n        },\n\n        /**\n         * A normalized vector to the sun in 3D world coordinates at the current scene time.  Even in 2D or\n         * Columbus View mode, this returns the direction to the sun in the 3D scene.\n         * @memberof UniformState.prototype\n         * @type {Cartesian3}\n         */\n        sunDirectionWC : {\n            get : function() {\n                return this._sunDirectionWC;\n            }\n        },\n\n        /**\n         * A normalized vector to the sun in eye coordinates at the current scene time.  In 3D mode, this\n         * returns the actual vector from the camera position to the sun position.  In 2D and Columbus View, it returns\n         * the vector from the equivalent 3D camera position to the position of the sun in the 3D scene.\n         * @memberof UniformState.prototype\n         * @type {Cartesian3}\n         */\n        sunDirectionEC : {\n            get : function() {\n                return this._sunDirectionEC;\n            }\n        },\n\n        /**\n         * A normalized vector to the moon in eye coordinates at the current scene time.  In 3D mode, this\n         * returns the actual vector from the camera position to the moon position.  In 2D and Columbus View, it returns\n         * the vector from the equivalent 3D camera position to the position of the moon in the 3D scene.\n         * @memberof UniformState.prototype\n         * @type {Cartesian3}\n         */\n        moonDirectionEC : {\n            get : function() {\n                return this._moonDirectionEC;\n            }\n        },\n\n        /**\n         * A normalized vector to the scene's light source in 3D world coordinates.  Even in 2D or\n         * Columbus View mode, this returns the direction to the light in the 3D scene.\n         * @memberof UniformState.prototype\n         * @type {Cartesian3}\n         */\n        lightDirectionWC : {\n            get : function() {\n                return this._lightDirectionWC;\n            }\n        },\n\n        /**\n         * A normalized vector to the scene's light source in eye coordinates.  In 3D mode, this\n         * returns the actual vector from the camera position to the light.  In 2D and Columbus View, it returns\n         * the vector from the equivalent 3D camera position in the 3D scene.\n         * @memberof UniformState.prototype\n         * @type {Cartesian3}\n         */\n        lightDirectionEC : {\n            get : function() {\n                return this._lightDirectionEC;\n            }\n        },\n\n        /**\n         * The color of light emitted by the scene's light source. This is equivalent to the light\n         * color multiplied by the light intensity limited to a maximum luminance of 1.0 suitable\n         * for non-HDR lighting.\n         * @memberof UniformState.prototype\n         * @type {Cartesian3}\n         */\n        lightColor : {\n            get : function() {\n                return this._lightColor;\n            }\n        },\n\n        /**\n         * The high dynamic range color of light emitted by the scene's light source. This is equivalent to\n         * the light color multiplied by the light intensity suitable for HDR lighting.\n         * @memberof UniformState.prototype\n         * @type {Cartesian3}\n         */\n        lightColorHdr : {\n            get : function() {\n                return this._lightColorHdr;\n            }\n        },\n\n        /**\n         * The high bits of the camera position.\n         * @memberof UniformState.prototype\n         * @type {Cartesian3}\n         */\n        encodedCameraPositionMCHigh : {\n            get : function() {\n                cleanEncodedCameraPositionMC(this);\n                return this._encodedCameraPositionMC.high;\n            }\n        },\n\n        /**\n         * The low bits of the camera position.\n         * @memberof UniformState.prototype\n         * @type {Cartesian3}\n         */\n        encodedCameraPositionMCLow : {\n            get : function() {\n                cleanEncodedCameraPositionMC(this);\n                return this._encodedCameraPositionMC.low;\n            }\n        },\n\n        /**\n         * A 3x3 matrix that transforms from True Equator Mean Equinox (TEME) axes to the\n         * pseudo-fixed axes at the Scene's current time.\n         * @memberof UniformState.prototype\n         * @type {Matrix3}\n         */\n        temeToPseudoFixedMatrix : {\n            get : function() {\n                return this._temeToPseudoFixed;\n            }\n        },\n\n        /**\n         * Gets the scaling factor for transforming from the canvas\n         * pixel space to canvas coordinate space.\n         * @memberof UniformState.prototype\n         * @type {Number}\n         */\n        pixelRatio : {\n            get : function() {\n                return this._pixelRatio;\n            }\n        },\n\n        /**\n         * A scalar used to mix a color with the fog color based on the distance to the camera.\n         * @memberof UniformState.prototype\n         * @type {Number}\n         */\n        fogDensity : {\n            get : function() {\n                return this._fogDensity;\n            }\n        },\n\n        /**\n         * A scalar that represents the geometric tolerance per meter\n         * @memberof UniformStat.prototype\n         * @type {Number}\n         */\n        geometricToleranceOverMeter: {\n            get : function() {\n                return this._geometricToleranceOverMeter;\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @type {Pass}\n         */\n        pass : {\n            get : function() {\n                return this._pass;\n            }\n        },\n\n        /**\n         * The current background color\n         * @memberof UniformState.prototype\n         * @type {Color}\n         */\n        backgroundColor : {\n            get : function() {\n                return this._backgroundColor;\n            }\n        },\n\n        /**\n         * The look up texture used to find the BRDF for a material\n         * @memberof UniformState.prototype\n         * @type {Texture}\n         */\n        brdfLut : {\n            get : function() {\n                return this._brdfLut;\n            }\n        },\n\n        /**\n         * The environment map of the scene\n         * @memberof UniformState.prototype\n         * @type {CubeMap}\n         */\n        environmentMap : {\n            get : function() {\n                return this._environmentMap;\n            }\n        },\n\n        /**\n         * The spherical harmonic coefficients of the scene.\n         * @memberof UniformState.prototype\n         * @type {Cartesian3[]}\n         */\n        sphericalHarmonicCoefficients : {\n            get : function() {\n                return this._sphericalHarmonicCoefficients;\n            }\n        },\n\n        /**\n         * The specular environment map atlas of the scene.\n         * @memberof UniformState.prototype\n         * @type {Texture}\n         */\n        specularEnvironmentMaps : {\n            get : function() {\n                return this._specularEnvironmentMaps;\n            }\n        },\n\n        /**\n         * The dimensions of the specular environment map atlas of the scene.\n         * @memberof UniformState.prototype\n         * @type {Cartesian2}\n         */\n        specularEnvironmentMapsDimensions : {\n            get : function() {\n                return this._specularEnvironmentMapsDimensions;\n            }\n        },\n\n        /**\n         * The maximum level-of-detail of the specular environment map atlas of the scene.\n         * @memberof UniformState.prototype\n         * @type {Number}\n         */\n        specularEnvironmentMapsMaximumLOD : {\n            get : function() {\n                return this._specularEnvironmentMapsMaximumLOD;\n            }\n        },\n\n        /**\n         * @memberof UniformState.prototype\n         * @type {Number}\n         */\n        imagerySplitPosition : {\n            get : function() {\n                return this._imagerySplitPosition;\n            }\n        },\n\n        /**\n         * The distance from the camera at which to disable the depth test of billboards, labels and points\n         * to, for example, prevent clipping against terrain. When set to zero, the depth test should always\n         * be applied. When less than zero, the depth test should never be applied.\n         *\n         * @memberof UniformState.prototype\n         * @type {Number}\n         */\n        minimumDisableDepthTestDistance : {\n            get : function() {\n                return this._minimumDisableDepthTestDistance;\n            }\n        },\n\n        /**\n         * The highlight color of unclassified 3D Tiles.\n         *\n         * @memberof UniformState.prototype\n         * @type {Color}\n         */\n        invertClassificationColor : {\n            get : function() {\n                return this._invertClassificationColor;\n            }\n        },\n\n        /**\n         * Whether or not the current projection is orthographic in 3D.\n         *\n         * @memberOf UniformState.prototype\n         * @type {Boolean}\n         */\n        orthographicIn3D : {\n            get : function() {\n                return this._orthographicIn3D;\n            }\n        },\n\n        /**\n         * The current ellipsoid.\n         *\n         * @memberOf UniformState.prototype\n         * @type {Ellipsoid}\n         */\n        ellipsoid : {\n            get : function() {\n                return defaultValue(this._ellipsoid, Ellipsoid.WGS84);\n            }\n        }\n    });\n\n    function setView(uniformState, matrix) {\n        Matrix4.clone(matrix, uniformState._view);\n        Matrix4.getMatrix3(matrix, uniformState._viewRotation);\n\n        uniformState._view3DDirty = true;\n        uniformState._inverseView3DDirty = true;\n        uniformState._modelViewDirty = true;\n        uniformState._modelView3DDirty = true;\n        uniformState._modelViewRelativeToEyeDirty = true;\n        uniformState._inverseModelViewDirty = true;\n        uniformState._inverseModelView3DDirty = true;\n        uniformState._viewProjectionDirty = true;\n        uniformState._inverseViewProjectionDirty = true;\n        uniformState._modelViewProjectionDirty = true;\n        uniformState._modelViewProjectionRelativeToEyeDirty = true;\n        uniformState._modelViewInfiniteProjectionDirty = true;\n        uniformState._normalDirty = true;\n        uniformState._inverseNormalDirty = true;\n        uniformState._normal3DDirty = true;\n        uniformState._inverseNormal3DDirty = true;\n    }\n\n    function setInverseView(uniformState, matrix) {\n        Matrix4.clone(matrix, uniformState._inverseView);\n        Matrix4.getMatrix3(matrix, uniformState._inverseViewRotation);\n    }\n\n    function setProjection(uniformState, matrix) {\n        Matrix4.clone(matrix, uniformState._projection);\n\n        uniformState._inverseProjectionDirty = true;\n        uniformState._viewProjectionDirty = true;\n        uniformState._inverseViewProjectionDirty = true;\n        uniformState._modelViewProjectionDirty = true;\n        uniformState._modelViewProjectionRelativeToEyeDirty = true;\n    }\n\n    function setInfiniteProjection(uniformState, matrix) {\n        Matrix4.clone(matrix, uniformState._infiniteProjection);\n\n        uniformState._modelViewInfiniteProjectionDirty = true;\n    }\n\n    function setCamera(uniformState, camera) {\n        Cartesian3.clone(camera.positionWC, uniformState._cameraPosition);\n        Cartesian3.clone(camera.directionWC, uniformState._cameraDirection);\n        Cartesian3.clone(camera.rightWC, uniformState._cameraRight);\n        Cartesian3.clone(camera.upWC, uniformState._cameraUp);\n        uniformState._encodedCameraPositionMCDirty = true;\n    }\n\n    var transformMatrix = new Matrix3();\n    var sunCartographicScratch = new Cartographic();\n    function setSunAndMoonDirections(uniformState, frameState) {\n        if (!defined(Transforms.computeIcrfToFixedMatrix(frameState.time, transformMatrix))) {\n            transformMatrix = Transforms.computeTemeToPseudoFixedMatrix(frameState.time, transformMatrix);\n        }\n\n        var position = Simon1994PlanetaryPositions.computeSunPositionInEarthInertialFrame(frameState.time, uniformState._sunPositionWC);\n        Matrix3.multiplyByVector(transformMatrix, position, position);\n\n        Cartesian3.normalize(position, uniformState._sunDirectionWC);\n\n        position = Matrix3.multiplyByVector(uniformState.viewRotation3D, position, uniformState._sunDirectionEC);\n        Cartesian3.normalize(position, position);\n\n        position = Simon1994PlanetaryPositions.computeMoonPositionInEarthInertialFrame(frameState.time, uniformState._moonDirectionEC);\n        Matrix3.multiplyByVector(transformMatrix, position, position);\n        Matrix3.multiplyByVector(uniformState.viewRotation3D, position, position);\n        Cartesian3.normalize(position, position);\n\n        var projection = frameState.mapProjection;\n        var ellipsoid = projection.ellipsoid;\n        var sunCartographic = ellipsoid.cartesianToCartographic(uniformState._sunPositionWC, sunCartographicScratch);\n        projection.project(sunCartographic, uniformState._sunPositionColumbusView);\n    }\n\n    /**\n     * Synchronizes the frustum's state with the camera state.  This is called\n     * by the {@link Scene} when rendering to ensure that automatic GLSL uniforms\n     * are set to the right value.\n     *\n     * @param {Object} camera The camera to synchronize with.\n     */\n    UniformState.prototype.updateCamera = function(camera) {\n        setView(this, camera.viewMatrix);\n        setInverseView(this, camera.inverseViewMatrix);\n        setCamera(this, camera);\n\n        this._entireFrustum.x = camera.frustum.near;\n        this._entireFrustum.y = camera.frustum.far;\n        this.updateFrustum(camera.frustum);\n\n        this._orthographicIn3D = this._mode !== SceneMode.SCENE2D && camera.frustum instanceof OrthographicFrustum;\n    };\n\n    /**\n     * Synchronizes the frustum's state with the uniform state.  This is called\n     * by the {@link Scene} when rendering to ensure that automatic GLSL uniforms\n     * are set to the right value.\n     *\n     * @param {Object} frustum The frustum to synchronize with.\n     */\n    UniformState.prototype.updateFrustum = function(frustum) {\n        setProjection(this, frustum.projectionMatrix);\n        if (defined(frustum.infiniteProjectionMatrix)) {\n            setInfiniteProjection(this, frustum.infiniteProjectionMatrix);\n        }\n        this._currentFrustum.x = frustum.near;\n        this._currentFrustum.y = frustum.far;\n\n        this._farDepthFromNearPlusOne = (frustum.far - frustum.near) + 1.0;\n        this._log2FarDepthFromNearPlusOne = CesiumMath.log2(this._farDepthFromNearPlusOne);\n        this._oneOverLog2FarDepthFromNearPlusOne = 1.0 / this._log2FarDepthFromNearPlusOne;\n\n        if (defined(frustum._offCenterFrustum)) {\n            frustum = frustum._offCenterFrustum;\n        }\n\n        this._frustumPlanes.x = frustum.top;\n        this._frustumPlanes.y = frustum.bottom;\n        this._frustumPlanes.z = frustum.left;\n        this._frustumPlanes.w = frustum.right;\n    };\n\n    UniformState.prototype.updatePass = function(pass) {\n        this._pass = pass;\n    };\n\n    var EMPTY_ARRAY = [];\n    var defaultLight = new SunLight();\n\n    /**\n     * Synchronizes frame state with the uniform state.  This is called\n     * by the {@link Scene} when rendering to ensure that automatic GLSL uniforms\n     * are set to the right value.\n     *\n     * @param {FrameState} frameState The frameState to synchronize with.\n     */\n    UniformState.prototype.update = function(frameState) {\n        this._mode = frameState.mode;\n        this._mapProjection = frameState.mapProjection;\n        this._ellipsoid = frameState.mapProjection.ellipsoid;\n        this._pixelRatio = frameState.pixelRatio;\n\n        var camera = frameState.camera;\n        this.updateCamera(camera);\n\n        if (frameState.mode === SceneMode.SCENE2D) {\n            this._frustum2DWidth = camera.frustum.right - camera.frustum.left;\n            this._eyeHeight2D.x = this._frustum2DWidth * 0.5;\n            this._eyeHeight2D.y = this._eyeHeight2D.x * this._eyeHeight2D.x;\n        } else {\n            this._frustum2DWidth = 0.0;\n            this._eyeHeight2D.x = 0.0;\n            this._eyeHeight2D.y = 0.0;\n        }\n\n        setSunAndMoonDirections(this, frameState);\n\n        var light = defaultValue(frameState.light, defaultLight);\n        if (light instanceof SunLight) {\n            this._lightDirectionWC = Cartesian3.clone(this._sunDirectionWC, this._lightDirectionWC);\n            this._lightDirectionEC = Cartesian3.clone(this._sunDirectionEC, this._lightDirectionEC);\n        } else {\n            this._lightDirectionWC = Cartesian3.normalize(Cartesian3.negate(light.direction, this._lightDirectionWC), this._lightDirectionWC);\n            this._lightDirectionEC = Matrix3.multiplyByVector(this.viewRotation3D, this._lightDirectionWC, this._lightDirectionEC);\n        }\n\n        var lightColor = light.color;\n        var lightColorHdr = Cartesian3.fromElements(lightColor.red, lightColor.green, lightColor.blue, this._lightColorHdr);\n        lightColorHdr = Cartesian3.multiplyByScalar(lightColorHdr, light.intensity, lightColorHdr);\n        var maximumComponent = Cartesian3.maximumComponent(lightColorHdr);\n        if (maximumComponent > 1.0) {\n            Cartesian3.divideByScalar(lightColorHdr, maximumComponent, this._lightColor);\n        } else {\n            Cartesian3.clone(lightColorHdr, this._lightColor);\n        }\n\n        var brdfLutGenerator = frameState.brdfLutGenerator;\n        var brdfLut = defined(brdfLutGenerator) ? brdfLutGenerator.colorTexture : undefined;\n        this._brdfLut = brdfLut;\n\n        this._environmentMap = defaultValue(frameState.environmentMap, frameState.context.defaultCubeMap);\n\n        // IE 11 doesn't optimize out uniforms that are #ifdef'd out. So undefined values for the spherical harmonic\n        // coefficients and specular environment map atlas dimensions cause a crash.\n        this._sphericalHarmonicCoefficients = defaultValue(frameState.sphericalHarmonicCoefficients, EMPTY_ARRAY);\n        this._specularEnvironmentMaps = frameState.specularEnvironmentMaps;\n        this._specularEnvironmentMapsMaximumLOD = frameState.specularEnvironmentMapsMaximumLOD;\n\n        if (defined(this._specularEnvironmentMaps)) {\n            Cartesian2.clone(this._specularEnvironmentMaps.dimensions, this._specularEnvironmentMapsDimensions);\n        }\n\n        this._fogDensity = frameState.fog.density;\n\n        this._invertClassificationColor = frameState.invertClassificationColor;\n\n        this._frameState = frameState;\n        this._temeToPseudoFixed = Transforms.computeTemeToPseudoFixedMatrix(frameState.time, this._temeToPseudoFixed);\n\n        // Convert the relative imagerySplitPosition to absolute pixel coordinates\n        this._imagerySplitPosition = frameState.imagerySplitPosition * frameState.context.drawingBufferWidth;\n        var fov = camera.frustum.fov;\n        var viewport = this._viewport;\n        var pixelSizePerMeter;\n        if (viewport.height > viewport.width) {\n            pixelSizePerMeter = Math.tan(0.5 * fov) * 2.0 / viewport.height;\n        } else {\n            pixelSizePerMeter = Math.tan(0.5 * fov) * 2.0 / viewport.width;\n        }\n\n        this._geometricToleranceOverMeter = pixelSizePerMeter * frameState.maximumScreenSpaceError;\n        Color.clone(frameState.backgroundColor, this._backgroundColor);\n\n        this._minimumDisableDepthTestDistance = frameState.minimumDisableDepthTestDistance;\n        this._minimumDisableDepthTestDistance *= this._minimumDisableDepthTestDistance;\n        if (this._minimumDisableDepthTestDistance === Number.POSITIVE_INFINITY) {\n            this._minimumDisableDepthTestDistance = -1.0;\n        }\n    };\n\n    function cleanViewport(uniformState) {\n        if (uniformState._viewportDirty) {\n            var v = uniformState._viewport;\n            Matrix4.computeOrthographicOffCenter(v.x, v.x + v.width, v.y, v.y + v.height, 0.0, 1.0, uniformState._viewportOrthographicMatrix);\n            Matrix4.computeViewportTransformation(v, 0.0, 1.0, uniformState._viewportTransformation);\n            uniformState._viewportDirty = false;\n        }\n    }\n\n    function cleanInverseProjection(uniformState) {\n        if (uniformState._inverseProjectionDirty) {\n            uniformState._inverseProjectionDirty = false;\n\n            if (uniformState._mode !== SceneMode.SCENE2D && uniformState._mode !== SceneMode.MORPHING && !uniformState._orthographicIn3D) {\n                Matrix4.inverse(uniformState._projection, uniformState._inverseProjection);\n            } else {\n                Matrix4.clone(Matrix4.ZERO, uniformState._inverseProjection);\n            }\n        }\n    }\n\n    // Derived\n    function cleanModelView(uniformState) {\n        if (uniformState._modelViewDirty) {\n            uniformState._modelViewDirty = false;\n\n            Matrix4.multiplyTransformation(uniformState._view, uniformState._model, uniformState._modelView);\n        }\n    }\n\n    function cleanModelView3D(uniformState) {\n        if (uniformState._modelView3DDirty) {\n            uniformState._modelView3DDirty = false;\n\n            Matrix4.multiplyTransformation(uniformState.view3D, uniformState._model, uniformState._modelView3D);\n        }\n    }\n\n    function cleanInverseModelView(uniformState) {\n        if (uniformState._inverseModelViewDirty) {\n            uniformState._inverseModelViewDirty = false;\n\n            Matrix4.inverse(uniformState.modelView, uniformState._inverseModelView);\n        }\n    }\n\n    function cleanInverseModelView3D(uniformState) {\n        if (uniformState._inverseModelView3DDirty) {\n            uniformState._inverseModelView3DDirty = false;\n\n            Matrix4.inverse(uniformState.modelView3D, uniformState._inverseModelView3D);\n        }\n    }\n\n    function cleanViewProjection(uniformState) {\n        if (uniformState._viewProjectionDirty) {\n            uniformState._viewProjectionDirty = false;\n\n            Matrix4.multiply(uniformState._projection, uniformState._view, uniformState._viewProjection);\n        }\n    }\n\n    function cleanInverseViewProjection(uniformState) {\n        if (uniformState._inverseViewProjectionDirty) {\n            uniformState._inverseViewProjectionDirty = false;\n\n            Matrix4.inverse(uniformState.viewProjection, uniformState._inverseViewProjection);\n        }\n    }\n\n    function cleanModelViewProjection(uniformState) {\n        if (uniformState._modelViewProjectionDirty) {\n            uniformState._modelViewProjectionDirty = false;\n\n            Matrix4.multiply(uniformState._projection, uniformState.modelView, uniformState._modelViewProjection);\n        }\n    }\n\n    function cleanModelViewRelativeToEye(uniformState) {\n        if (uniformState._modelViewRelativeToEyeDirty) {\n            uniformState._modelViewRelativeToEyeDirty = false;\n\n            var mv = uniformState.modelView;\n            var mvRte = uniformState._modelViewRelativeToEye;\n            mvRte[0] = mv[0];\n            mvRte[1] = mv[1];\n            mvRte[2] = mv[2];\n            mvRte[3] = mv[3];\n            mvRte[4] = mv[4];\n            mvRte[5] = mv[5];\n            mvRte[6] = mv[6];\n            mvRte[7] = mv[7];\n            mvRte[8] = mv[8];\n            mvRte[9] = mv[9];\n            mvRte[10] = mv[10];\n            mvRte[11] = mv[11];\n            mvRte[12] = 0.0;\n            mvRte[13] = 0.0;\n            mvRte[14] = 0.0;\n            mvRte[15] = mv[15];\n        }\n    }\n\n    function cleanInverseModelViewProjection(uniformState) {\n        if (uniformState._inverseModelViewProjectionDirty) {\n            uniformState._inverseModelViewProjectionDirty = false;\n\n            Matrix4.inverse(uniformState.modelViewProjection, uniformState._inverseModelViewProjection);\n        }\n    }\n\n    function cleanModelViewProjectionRelativeToEye(uniformState) {\n        if (uniformState._modelViewProjectionRelativeToEyeDirty) {\n            uniformState._modelViewProjectionRelativeToEyeDirty = false;\n\n            Matrix4.multiply(uniformState._projection, uniformState.modelViewRelativeToEye, uniformState._modelViewProjectionRelativeToEye);\n        }\n    }\n\n    function cleanModelViewInfiniteProjection(uniformState) {\n        if (uniformState._modelViewInfiniteProjectionDirty) {\n            uniformState._modelViewInfiniteProjectionDirty = false;\n\n            Matrix4.multiply(uniformState._infiniteProjection, uniformState.modelView, uniformState._modelViewInfiniteProjection);\n        }\n    }\n\n    function cleanNormal(uniformState) {\n        if (uniformState._normalDirty) {\n            uniformState._normalDirty = false;\n\n            var m = uniformState._normal;\n            Matrix4.getMatrix3(uniformState.inverseModelView, m);\n            Matrix3.getRotation(m, m);\n            Matrix3.transpose(m, m);\n        }\n    }\n\n    function cleanNormal3D(uniformState) {\n        if (uniformState._normal3DDirty) {\n            uniformState._normal3DDirty = false;\n\n            var m = uniformState._normal3D;\n            Matrix4.getMatrix3(uniformState.inverseModelView3D, m);\n            Matrix3.getRotation(m, m);\n            Matrix3.transpose(m, m);\n        }\n    }\n\n    function cleanInverseNormal(uniformState) {\n        if (uniformState._inverseNormalDirty) {\n            uniformState._inverseNormalDirty = false;\n            Matrix4.getMatrix3(uniformState.inverseModelView, uniformState._inverseNormal);\n            Matrix3.getRotation(uniformState._inverseNormal, uniformState._inverseNormal);\n        }\n    }\n\n    function cleanInverseNormal3D(uniformState) {\n        if (uniformState._inverseNormal3DDirty) {\n            uniformState._inverseNormal3DDirty = false;\n            Matrix4.getMatrix3(uniformState.inverseModelView3D, uniformState._inverseNormal3D);\n            Matrix3.getRotation(uniformState._inverseNormal3D, uniformState._inverseNormal3D);\n        }\n    }\n\n    var cameraPositionMC = new Cartesian3();\n\n    function cleanEncodedCameraPositionMC(uniformState) {\n        if (uniformState._encodedCameraPositionMCDirty) {\n            uniformState._encodedCameraPositionMCDirty = false;\n\n            Matrix4.multiplyByPoint(uniformState.inverseModel, uniformState._cameraPosition, cameraPositionMC);\n            EncodedCartesian3.fromCartesian(cameraPositionMC, uniformState._encodedCameraPositionMC);\n        }\n    }\n\n    var view2Dto3DPScratch = new Cartesian3();\n    var view2Dto3DRScratch = new Cartesian3();\n    var view2Dto3DUScratch = new Cartesian3();\n    var view2Dto3DDScratch = new Cartesian3();\n    var view2Dto3DCartographicScratch = new Cartographic();\n    var view2Dto3DCartesian3Scratch = new Cartesian3();\n    var view2Dto3DMatrix4Scratch = new Matrix4();\n\n    function view2Dto3D(position2D, direction2D, right2D, up2D, frustum2DWidth, mode, projection, result) {\n        // The camera position and directions are expressed in the 2D coordinate system where the Y axis is to the East,\n        // the Z axis is to the North, and the X axis is out of the map.  Express them instead in the ENU axes where\n        // X is to the East, Y is to the North, and Z is out of the local horizontal plane.\n        var p = view2Dto3DPScratch;\n        p.x = position2D.y;\n        p.y = position2D.z;\n        p.z = position2D.x;\n\n        var r = view2Dto3DRScratch;\n        r.x = right2D.y;\n        r.y = right2D.z;\n        r.z = right2D.x;\n\n        var u = view2Dto3DUScratch;\n        u.x = up2D.y;\n        u.y = up2D.z;\n        u.z = up2D.x;\n\n        var d = view2Dto3DDScratch;\n        d.x = direction2D.y;\n        d.y = direction2D.z;\n        d.z = direction2D.x;\n\n        // In 2D, the camera height is always 12.7 million meters.\n        // The apparent height is equal to half the frustum width.\n        if (mode === SceneMode.SCENE2D) {\n            p.z = frustum2DWidth * 0.5;\n        }\n\n        // Compute the equivalent camera position in the real (3D) world.\n        // In 2D and Columbus View, the camera can travel outside the projection, and when it does so\n        // there's not really any corresponding location in the real world.  So clamp the unprojected\n        // longitude and latitude to their valid ranges.\n        var cartographic = projection.unproject(p, view2Dto3DCartographicScratch);\n        cartographic.longitude = CesiumMath.clamp(cartographic.longitude, -Math.PI, Math.PI);\n        cartographic.latitude = CesiumMath.clamp(cartographic.latitude, -CesiumMath.PI_OVER_TWO, CesiumMath.PI_OVER_TWO);\n        var ellipsoid = projection.ellipsoid;\n        var position3D = ellipsoid.cartographicToCartesian(cartographic, view2Dto3DCartesian3Scratch);\n\n        // Compute the rotation from the local ENU at the real world camera position to the fixed axes.\n        var enuToFixed = Transforms.eastNorthUpToFixedFrame(position3D, ellipsoid, view2Dto3DMatrix4Scratch);\n\n        // Transform each camera direction to the fixed axes.\n        Matrix4.multiplyByPointAsVector(enuToFixed, r, r);\n        Matrix4.multiplyByPointAsVector(enuToFixed, u, u);\n        Matrix4.multiplyByPointAsVector(enuToFixed, d, d);\n\n        // Compute the view matrix based on the new fixed-frame camera position and directions.\n        if (!defined(result)) {\n            result = new Matrix4();\n        }\n\n        result[0] = r.x;\n        result[1] = u.x;\n        result[2] = -d.x;\n        result[3] = 0.0;\n        result[4] = r.y;\n        result[5] = u.y;\n        result[6] = -d.y;\n        result[7] = 0.0;\n        result[8] = r.z;\n        result[9] = u.z;\n        result[10] = -d.z;\n        result[11] = 0.0;\n        result[12] = -Cartesian3.dot(r, position3D);\n        result[13] = -Cartesian3.dot(u, position3D);\n        result[14] = Cartesian3.dot(d, position3D);\n        result[15] = 1.0;\n\n        return result;\n    }\n\n    function updateView3D(that) {\n        if (that._view3DDirty) {\n            if (that._mode === SceneMode.SCENE3D) {\n                Matrix4.clone(that._view, that._view3D);\n            } else {\n                view2Dto3D(that._cameraPosition, that._cameraDirection, that._cameraRight, that._cameraUp, that._frustum2DWidth, that._mode, that._mapProjection, that._view3D);\n            }\n            Matrix4.getMatrix3(that._view3D, that._viewRotation3D);\n            that._view3DDirty = false;\n        }\n    }\n\n    function updateInverseView3D(that){\n        if (that._inverseView3DDirty) {\n            Matrix4.inverseTransformation(that.view3D, that._inverseView3D);\n            Matrix4.getMatrix3(that._inverseView3D, that._inverseViewRotation3D);\n            that._inverseView3DDirty = false;\n        }\n    }\nexport default UniformState;\n","import Check from '../Core/Check.js';\nimport clone from '../Core/clone.js';\nimport Color from '../Core/Color.js';\nimport ComponentDatatype from '../Core/ComponentDatatype.js';\nimport createGuid from '../Core/createGuid.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport Geometry from '../Core/Geometry.js';\nimport GeometryAttribute from '../Core/GeometryAttribute.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport PixelFormat from '../Core/PixelFormat.js';\nimport PrimitiveType from '../Core/PrimitiveType.js';\nimport RuntimeError from '../Core/RuntimeError.js';\nimport WebGLConstants from '../Core/WebGLConstants.js';\nimport ViewportQuadVS from '../Shaders/ViewportQuadVS.js';\nimport BufferUsage from './BufferUsage.js';\nimport checkFloatTexturePrecision from './checkFloatTexturePrecision.js';\nimport ClearCommand from './ClearCommand.js';\nimport ContextLimits from './ContextLimits.js';\nimport CubeMap from './CubeMap.js';\nimport DrawCommand from './DrawCommand.js';\nimport PassState from './PassState.js';\nimport PixelDatatype from './PixelDatatype.js';\nimport RenderState from './RenderState.js';\nimport ShaderCache from './ShaderCache.js';\nimport ShaderProgram from './ShaderProgram.js';\nimport Texture from './Texture.js';\nimport TextureCache from './TextureCache.js';\nimport UniformState from './UniformState.js';\nimport VertexArray from './VertexArray.js';\n\n    function errorToString(gl, error) {\n        var message = 'WebGL Error:  ';\n        switch (error) {\n            case gl.INVALID_ENUM:\n                message += 'INVALID_ENUM';\n                break;\n            case gl.INVALID_VALUE:\n                message += 'INVALID_VALUE';\n                break;\n            case gl.INVALID_OPERATION:\n                message += 'INVALID_OPERATION';\n                break;\n            case gl.OUT_OF_MEMORY:\n                message += 'OUT_OF_MEMORY';\n                break;\n            case gl.CONTEXT_LOST_WEBGL:\n                message += 'CONTEXT_LOST_WEBGL lost';\n                break;\n            default:\n                message += 'Unknown (' + error + ')';\n        }\n\n        return message;\n    }\n\n    function createErrorMessage(gl, glFunc, glFuncArguments, error) {\n        var message = errorToString(gl, error) + ': ' + glFunc.name + '(';\n\n        for (var i = 0; i < glFuncArguments.length; ++i) {\n            if (i !== 0) {\n                message += ', ';\n            }\n            message += glFuncArguments[i];\n        }\n        message += ');';\n\n        return message;\n    }\n\n    function throwOnError(gl, glFunc, glFuncArguments) {\n        var error = gl.getError();\n        if (error !== gl.NO_ERROR) {\n            throw new RuntimeError(createErrorMessage(gl, glFunc, glFuncArguments, error));\n        }\n    }\n\n    function makeGetterSetter(gl, propertyName, logFunction) {\n        return {\n            get : function() {\n                var value = gl[propertyName];\n                logFunction(gl, 'get: ' + propertyName, value);\n                return gl[propertyName];\n            },\n            set : function(value) {\n                gl[propertyName] = value;\n                logFunction(gl, 'set: ' + propertyName, value);\n            }\n        };\n    }\n\n    function wrapGL(gl, logFunction) {\n        if (!defined(logFunction)) {\n            return gl;\n        }\n\n        function wrapFunction(property) {\n            return function() {\n                var result = property.apply(gl, arguments);\n                logFunction(gl, property, arguments);\n                return result;\n            };\n        }\n\n        var glWrapper = {};\n\n        // JavaScript linters normally demand that a for..in loop must directly contain an if,\n        // but in our loop below, we actually intend to iterate all properties, including\n        // those in the prototype.\n        /*eslint-disable guard-for-in*/\n        for (var propertyName in gl) {\n            var property = gl[propertyName];\n\n            // wrap any functions we encounter, otherwise just copy the property to the wrapper.\n            if (property instanceof Function) {\n                glWrapper[propertyName] = wrapFunction(property);\n            } else {\n                Object.defineProperty(glWrapper, propertyName, makeGetterSetter(gl, propertyName, logFunction));\n            }\n        }\n        /*eslint-enable guard-for-in*/\n\n        return glWrapper;\n    }\n\n    function getExtension(gl, names) {\n        var length = names.length;\n        for (var i = 0; i < length; ++i) {\n            var extension = gl.getExtension(names[i]);\n            if (extension) {\n                return extension;\n            }\n        }\n\n        return undefined;\n    }\n\n    /**\n     * @private\n     */\n    function Context(canvas, options) {\n        // this check must use typeof, not defined, because defined doesn't work with undeclared variables.\n        if (typeof WebGLRenderingContext === 'undefined') {\n            throw new RuntimeError('The browser does not support WebGL.  Visit http://get.webgl.org.');\n        }\n\n        \n\n        this._canvas = canvas;\n\n        options = clone(options, true);\n        // Don't use defaultValue.EMPTY_OBJECT here because the options object gets modified in the next line.\n        options = defaultValue(options, {});\n        options.allowTextureFilterAnisotropic = defaultValue(options.allowTextureFilterAnisotropic, true);\n        var webglOptions = defaultValue(options.webgl, {});\n\n        // Override select WebGL defaults\n        webglOptions.alpha = defaultValue(webglOptions.alpha, false); // WebGL default is true\n        webglOptions.stencil = defaultValue(webglOptions.stencil, true); // WebGL default is false\n\n        var requestWebgl2 = defaultValue(options.requestWebgl2, false) && (typeof WebGL2RenderingContext !== 'undefined');\n        var webgl2 = false;\n\n        var glContext;\n        var getWebGLStub = options.getWebGLStub;\n\n        if (!defined(getWebGLStub)) {\n            if (requestWebgl2) {\n                glContext = canvas.getContext('webgl2', webglOptions) || canvas.getContext('experimental-webgl2', webglOptions) || undefined;\n                if (defined(glContext)) {\n                    webgl2 = true;\n                }\n            }\n            if (!defined(glContext)) {\n                glContext = canvas.getContext('webgl', webglOptions) || canvas.getContext('experimental-webgl', webglOptions) || undefined;\n            }\n            if (!defined(glContext)) {\n                throw new RuntimeError('The browser supports WebGL, but initialization failed.');\n            }\n        } else {\n            // Use WebGL stub when requested for unit tests\n            glContext = getWebGLStub(canvas, webglOptions);\n        }\n\n        this._originalGLContext = glContext;\n        this._gl = glContext;\n        this._webgl2 = webgl2;\n        this._id = createGuid();\n\n        // Validation and logging disabled by default for speed.\n        this.validateFramebuffer = false;\n        this.validateShaderProgram = false;\n        this.logShaderCompilation = false;\n\n        this._throwOnWebGLError = false;\n\n        this._shaderCache = new ShaderCache(this);\n        this._textureCache = new TextureCache();\n\n        var gl = glContext;\n\n        this._stencilBits = gl.getParameter(gl.STENCIL_BITS);\n\n        ContextLimits._maximumCombinedTextureImageUnits = gl.getParameter(gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS); // min: 8\n        ContextLimits._maximumCubeMapSize = gl.getParameter(gl.MAX_CUBE_MAP_TEXTURE_SIZE); // min: 16\n        ContextLimits._maximumFragmentUniformVectors = gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS); // min: 16\n        ContextLimits._maximumTextureImageUnits = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS); // min: 8\n        ContextLimits._maximumRenderbufferSize = gl.getParameter(gl.MAX_RENDERBUFFER_SIZE); // min: 1\n        ContextLimits._maximumTextureSize = gl.getParameter(gl.MAX_TEXTURE_SIZE); // min: 64\n        ContextLimits._maximumVaryingVectors = gl.getParameter(gl.MAX_VARYING_VECTORS); // min: 8\n        ContextLimits._maximumVertexAttributes = gl.getParameter(gl.MAX_VERTEX_ATTRIBS); // min: 8\n        ContextLimits._maximumVertexTextureImageUnits = gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS); // min: 0\n        ContextLimits._maximumVertexUniformVectors = gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS); // min: 128\n\n        var aliasedLineWidthRange = gl.getParameter(gl.ALIASED_LINE_WIDTH_RANGE); // must include 1\n        ContextLimits._minimumAliasedLineWidth = aliasedLineWidthRange[0];\n        ContextLimits._maximumAliasedLineWidth = aliasedLineWidthRange[1];\n\n        var aliasedPointSizeRange = gl.getParameter(gl.ALIASED_POINT_SIZE_RANGE); // must include 1\n        ContextLimits._minimumAliasedPointSize = aliasedPointSizeRange[0];\n        ContextLimits._maximumAliasedPointSize = aliasedPointSizeRange[1];\n\n        var maximumViewportDimensions = gl.getParameter(gl.MAX_VIEWPORT_DIMS);\n        ContextLimits._maximumViewportWidth = maximumViewportDimensions[0];\n        ContextLimits._maximumViewportHeight = maximumViewportDimensions[1];\n\n        var highpFloat = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT);\n        ContextLimits._highpFloatSupported = highpFloat.precision !== 0;\n        var highpInt = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_INT);\n        ContextLimits._highpIntSupported = highpInt.rangeMax !== 0;\n\n        this._antialias = gl.getContextAttributes().antialias;\n\n        // Query and initialize extensions\n        this._standardDerivatives = !!getExtension(gl, ['OES_standard_derivatives']);\n        this._blendMinmax = !!getExtension(gl, ['EXT_blend_minmax']);\n        this._elementIndexUint = !!getExtension(gl, ['OES_element_index_uint']);\n        this._depthTexture = !!getExtension(gl, ['WEBGL_depth_texture', 'WEBKIT_WEBGL_depth_texture']);\n        this._fragDepth = !!getExtension(gl, ['EXT_frag_depth']);\n        this._debugShaders = getExtension(gl, ['WEBGL_debug_shaders']);\n\n        this._textureFloat = !!getExtension(gl, ['OES_texture_float']);\n        this._textureHalfFloat = !!getExtension(gl, ['OES_texture_half_float']);\n\n        this._textureFloatLinear = !!getExtension(gl, ['OES_texture_float_linear']);\n        this._textureHalfFloatLinear = !!getExtension(gl, ['OES_texture_half_float_linear']);\n\n        this._colorBufferFloat = !!getExtension(gl, ['EXT_color_buffer_float', 'WEBGL_color_buffer_float']);\n        this._floatBlend = !!getExtension(gl, ['EXT_float_blend']);\n        this._colorBufferHalfFloat = !!getExtension(gl, ['EXT_color_buffer_half_float']);\n\n        this._s3tc = !!getExtension(gl, ['WEBGL_compressed_texture_s3tc', 'MOZ_WEBGL_compressed_texture_s3tc', 'WEBKIT_WEBGL_compressed_texture_s3tc']);\n        this._pvrtc = !!getExtension(gl, ['WEBGL_compressed_texture_pvrtc', 'WEBKIT_WEBGL_compressed_texture_pvrtc']);\n        this._etc1 = !!getExtension(gl, ['WEBGL_compressed_texture_etc1']);\n\n        var textureFilterAnisotropic = options.allowTextureFilterAnisotropic ? getExtension(gl, ['EXT_texture_filter_anisotropic', 'WEBKIT_EXT_texture_filter_anisotropic']) : undefined;\n        this._textureFilterAnisotropic = textureFilterAnisotropic;\n        ContextLimits._maximumTextureFilterAnisotropy = defined(textureFilterAnisotropic) ? gl.getParameter(textureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT) : 1.0;\n\n        var glCreateVertexArray;\n        var glBindVertexArray;\n        var glDeleteVertexArray;\n\n        var glDrawElementsInstanced;\n        var glDrawArraysInstanced;\n        var glVertexAttribDivisor;\n\n        var glDrawBuffers;\n\n        var vertexArrayObject;\n        var instancedArrays;\n        var drawBuffers;\n\n        if (webgl2) {\n            var that = this;\n\n            glCreateVertexArray = function() {\n                return that._gl.createVertexArray();\n            };\n            glBindVertexArray = function(vao) {\n                that._gl.bindVertexArray(vao);\n            };\n            glDeleteVertexArray = function(vao) {\n                that._gl.deleteVertexArray(vao);\n            };\n\n            glDrawElementsInstanced = function(mode, count, type, offset, instanceCount) {\n                gl.drawElementsInstanced(mode, count, type, offset, instanceCount);\n            };\n            glDrawArraysInstanced = function(mode, first, count, instanceCount) {\n                gl.drawArraysInstanced(mode, first, count, instanceCount);\n            };\n            glVertexAttribDivisor = function(index, divisor) {\n                gl.vertexAttribDivisor(index, divisor);\n            };\n\n            glDrawBuffers = function(buffers) {\n                gl.drawBuffers(buffers);\n            };\n        } else {\n            vertexArrayObject = getExtension(gl, ['OES_vertex_array_object']);\n            if (defined(vertexArrayObject)) {\n                glCreateVertexArray = function() {\n                    return vertexArrayObject.createVertexArrayOES();\n                };\n                glBindVertexArray = function(vertexArray) {\n                    vertexArrayObject.bindVertexArrayOES(vertexArray);\n                };\n                glDeleteVertexArray = function(vertexArray) {\n                    vertexArrayObject.deleteVertexArrayOES(vertexArray);\n                };\n            }\n\n            instancedArrays = getExtension(gl, ['ANGLE_instanced_arrays']);\n            if (defined(instancedArrays)) {\n                glDrawElementsInstanced = function(mode, count, type, offset, instanceCount) {\n                    instancedArrays.drawElementsInstancedANGLE(mode, count, type, offset, instanceCount);\n                };\n                glDrawArraysInstanced = function(mode, first, count, instanceCount) {\n                    instancedArrays.drawArraysInstancedANGLE(mode, first, count, instanceCount);\n                };\n                glVertexAttribDivisor = function(index, divisor) {\n                    instancedArrays.vertexAttribDivisorANGLE(index, divisor);\n                };\n            }\n\n            drawBuffers = getExtension(gl, ['WEBGL_draw_buffers']);\n            if (defined(drawBuffers)) {\n                glDrawBuffers = function(buffers) {\n                    drawBuffers.drawBuffersWEBGL(buffers);\n                };\n            }\n        }\n\n        this.glCreateVertexArray = glCreateVertexArray;\n        this.glBindVertexArray = glBindVertexArray;\n        this.glDeleteVertexArray = glDeleteVertexArray;\n\n        this.glDrawElementsInstanced = glDrawElementsInstanced;\n        this.glDrawArraysInstanced = glDrawArraysInstanced;\n        this.glVertexAttribDivisor = glVertexAttribDivisor;\n\n        this.glDrawBuffers = glDrawBuffers;\n\n        this._vertexArrayObject = !!vertexArrayObject;\n        this._instancedArrays = !!instancedArrays;\n        this._drawBuffers = !!drawBuffers;\n\n        ContextLimits._maximumDrawBuffers = this.drawBuffers ? gl.getParameter(WebGLConstants.MAX_DRAW_BUFFERS) : 1;\n        ContextLimits._maximumColorAttachments = this.drawBuffers ? gl.getParameter(WebGLConstants.MAX_COLOR_ATTACHMENTS) : 1;\n\n        this._clearColor = new Color(0.0, 0.0, 0.0, 0.0);\n        this._clearDepth = 1.0;\n        this._clearStencil = 0;\n\n        var us = new UniformState();\n        var ps = new PassState(this);\n        var rs = RenderState.fromCache();\n\n        this._defaultPassState = ps;\n        this._defaultRenderState = rs;\n        this._defaultTexture = undefined;\n        this._defaultCubeMap = undefined;\n\n        this._us = us;\n        this._currentRenderState = rs;\n        this._currentPassState = ps;\n        this._currentFramebuffer = undefined;\n        this._maxFrameTextureUnitIndex = 0;\n\n        // Vertex attribute divisor state cache. Workaround for ANGLE (also look at VertexArray.setVertexAttribDivisor)\n        this._vertexAttribDivisors = [];\n        this._previousDrawInstanced = false;\n        for (var i = 0; i < ContextLimits._maximumVertexAttributes; i++) {\n            this._vertexAttribDivisors.push(0);\n        }\n\n        this._pickObjects = {};\n        this._nextPickColor = new Uint32Array(1);\n\n        /**\n         * @example\n         * {\n         *   webgl : {\n         *     alpha : false,\n         *     depth : true,\n         *     stencil : false,\n         *     antialias : true,\n         *     premultipliedAlpha : true,\n         *     preserveDrawingBuffer : false,\n         *     failIfMajorPerformanceCaveat : true\n         *   },\n         *   allowTextureFilterAnisotropic : true\n         * }\n         */\n        this.options = options;\n\n        /**\n         * A cache of objects tied to this context.  Just before the Context is destroyed,\n         * <code>destroy</code> will be invoked on each object in this object literal that has\n         * such a method.  This is useful for caching any objects that might otherwise\n         * be stored globally, except they're tied to a particular context, and to manage\n         * their lifetime.\n         *\n         * @type {Object}\n         */\n        this.cache = {};\n\n        RenderState.apply(gl, rs, ps);\n\n        this._floatTexSixPlaces = checkFloatTexturePrecision(this);\n    }\n\n    var defaultFramebufferMarker = {};\n\n    Object.defineProperties(Context.prototype, {\n        id : {\n            get : function() {\n                return this._id;\n            }\n        },\n        webgl2 : {\n            get : function() {\n                return this._webgl2;\n            }\n        },\n        canvas : {\n            get : function() {\n                return this._canvas;\n            }\n        },\n        shaderCache : {\n            get : function() {\n                return this._shaderCache;\n            }\n        },\n        textureCache : {\n            get : function() {\n                return this._textureCache;\n            }\n        },\n        uniformState : {\n            get : function() {\n                return this._us;\n            }\n        },\n\n        /**\n         * The number of stencil bits per pixel in the default bound framebuffer.  The minimum is eight bits.\n         * @memberof Context.prototype\n         * @type {Number}\n         * @see {@link https://www.khronos.org/opengles/sdk/docs/man/xhtml/glGet.xml|glGet} with <code>STENCIL_BITS</code>.\n         */\n        stencilBits : {\n            get : function() {\n                return this._stencilBits;\n            }\n        },\n\n        /**\n         * <code>true</code> if the WebGL context supports stencil buffers.\n         * Stencil buffers are not supported by all systems.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         */\n        stencilBuffer : {\n            get : function() {\n                return this._stencilBits >= 8;\n            }\n        },\n\n        /**\n         * <code>true</code> if the WebGL context supports antialiasing.  By default\n         * antialiasing is requested, but it is not supported by all systems.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         */\n        antialias : {\n            get : function() {\n                return this._antialias;\n            }\n        },\n\n        /**\n         * <code>true</code> if the OES_standard_derivatives extension is supported.  This\n         * extension provides access to <code>dFdx</code>, <code>dFdy</code>, and <code>fwidth</code>\n         * functions from GLSL.  A shader using these functions still needs to explicitly enable the\n         * extension with <code>#extension GL_OES_standard_derivatives : enable</code>.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link http://www.khronos.org/registry/gles/extensions/OES/OES_standard_derivatives.txt|OES_standard_derivatives}\n         */\n        standardDerivatives : {\n            get : function() {\n                return this._standardDerivatives || this._webgl2;\n            }\n        },\n\n        /**\n         * <code>true</code> if the EXT_float_blend extension is supported. This\n         * extension enables blending with 32-bit float values.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link https://www.khronos.org/registry/webgl/extensions/EXT_float_blend/}\n         */\n        floatBlend : {\n            get : function() {\n                return this._floatBlend;\n            }\n        },\n\n        /**\n         * <code>true</code> if the EXT_blend_minmax extension is supported.  This\n         * extension extends blending capabilities by adding two new blend equations:\n         * the minimum or maximum color components of the source and destination colors.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link https://www.khronos.org/registry/webgl/extensions/EXT_blend_minmax/}\n         */\n        blendMinmax : {\n            get : function() {\n                return this._blendMinmax || this._webgl2;\n            }\n        },\n\n        /**\n         * <code>true</code> if the OES_element_index_uint extension is supported.  This\n         * extension allows the use of unsigned int indices, which can improve performance by\n         * eliminating batch breaking caused by unsigned short indices.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link http://www.khronos.org/registry/webgl/extensions/OES_element_index_uint/|OES_element_index_uint}\n         */\n        elementIndexUint : {\n            get : function() {\n                return this._elementIndexUint || this._webgl2;\n            }\n        },\n\n        /**\n         * <code>true</code> if WEBGL_depth_texture is supported.  This extension provides\n         * access to depth textures that, for example, can be attached to framebuffers for shadow mapping.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link http://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/|WEBGL_depth_texture}\n         */\n        depthTexture : {\n            get : function() {\n                return this._depthTexture || this._webgl2;\n            }\n        },\n\n        /**\n         * <code>true</code> if OES_texture_float is supported. This extension provides\n         * access to floating point textures that, for example, can be attached to framebuffers for high dynamic range.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link https://www.khronos.org/registry/webgl/extensions/OES_texture_float/}\n         */\n        floatingPointTexture : {\n            get : function() {\n                return this._webgl2 || this._textureFloat;\n            }\n        },\n\n        /**\n         * Returns <code>true</code> if the context's floating point textures support 6 decimal places of precision.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link https://www.khronos.org/registry/webgl/extensions/OES_texture_float/}\n         */\n        floatTextureSixPlaces : {\n            get : function() {\n                return this._floatTexSixPlaces;\n            }\n        },\n\n        /**\n         * <code>true</code> if OES_texture_half_float is supported. This extension provides\n         * access to floating point textures that, for example, can be attached to framebuffers for high dynamic range.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link https://www.khronos.org/registry/webgl/extensions/OES_texture_float/}\n         */\n        halfFloatingPointTexture : {\n            get : function() {\n                return this._webgl2 || this._textureHalfFloat;\n            }\n        },\n\n        /**\n         * <code>true</code> if OES_texture_float_linear is supported. This extension provides\n         * access to linear sampling methods for minification and magnification filters of floating-point textures.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link https://www.khronos.org/registry/webgl/extensions/OES_texture_float_linear/}\n         */\n        textureFloatLinear : {\n            get : function() {\n                return this._textureFloatLinear;\n            }\n        },\n\n        /**\n         * <code>true</code> if OES_texture_half_float_linear is supported. This extension provides\n         * access to linear sampling methods for minification and magnification filters of half floating-point textures.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link https://www.khronos.org/registry/webgl/extensions/OES_texture_half_float_linear/}\n         */\n        textureHalfFloatLinear : {\n            get : function() {\n                return (this._webgl2 && this._textureFloatLinear) || (!this._webgl2 && this._textureHalfFloatLinear);\n            }\n        },\n\n        /**\n         * <code>true</code> if EXT_texture_filter_anisotropic is supported. This extension provides\n         * access to anisotropic filtering for textured surfaces at an oblique angle from the viewer.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link https://www.khronos.org/registry/webgl/extensions/EXT_texture_filter_anisotropic/}\n         */\n        textureFilterAnisotropic : {\n            get : function() {\n                return !!this._textureFilterAnisotropic;\n            }\n        },\n\n        /**\n         * <code>true</code> if WEBGL_texture_compression_s3tc is supported.  This extension provides\n         * access to DXT compressed textures.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link https://www.khronos.org/registry/webgl/extensions/WEBGL_compressed_texture_s3tc/}\n         */\n        s3tc : {\n            get : function() {\n                return this._s3tc;\n            }\n        },\n\n        /**\n         * <code>true</code> if WEBGL_texture_compression_pvrtc is supported.  This extension provides\n         * access to PVR compressed textures.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link https://www.khronos.org/registry/webgl/extensions/WEBGL_compressed_texture_pvrtc/}\n         */\n        pvrtc : {\n            get : function() {\n                return this._pvrtc;\n            }\n        },\n\n        /**\n         * <code>true</code> if WEBGL_texture_compression_etc1 is supported.  This extension provides\n         * access to ETC1 compressed textures.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link https://www.khronos.org/registry/webgl/extensions/WEBGL_compressed_texture_etc1/}\n         */\n        etc1 : {\n            get : function() {\n                return this._etc1;\n            }\n        },\n\n        /**\n         * <code>true</code> if the OES_vertex_array_object extension is supported.  This\n         * extension can improve performance by reducing the overhead of switching vertex arrays.\n         * When enabled, this extension is automatically used by {@link VertexArray}.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link http://www.khronos.org/registry/webgl/extensions/OES_vertex_array_object/|OES_vertex_array_object}\n         */\n        vertexArrayObject : {\n            get : function() {\n                return this._vertexArrayObject || this._webgl2;\n            }\n        },\n\n        /**\n         * <code>true</code> if the EXT_frag_depth extension is supported.  This\n         * extension provides access to the <code>gl_FragDepthEXT</code> built-in output variable\n         * from GLSL fragment shaders.  A shader using these functions still needs to explicitly enable the\n         * extension with <code>#extension GL_EXT_frag_depth : enable</code>.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link http://www.khronos.org/registry/webgl/extensions/EXT_frag_depth/|EXT_frag_depth}\n         */\n        fragmentDepth : {\n            get : function() {\n                return this._fragDepth || this._webgl2;\n            }\n        },\n\n        /**\n         * <code>true</code> if the ANGLE_instanced_arrays extension is supported.  This\n         * extension provides access to instanced rendering.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link https://www.khronos.org/registry/webgl/extensions/ANGLE_instanced_arrays}\n         */\n        instancedArrays : {\n            get : function() {\n                return this._instancedArrays || this._webgl2;\n            }\n        },\n\n        /**\n         * <code>true</code> if the EXT_color_buffer_float extension is supported.  This\n         * extension makes the gl.RGBA32F format color renderable.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link https://www.khronos.org/registry/webgl/extensions/WEBGL_color_buffer_float/}\n         * @see {@link https://www.khronos.org/registry/webgl/extensions/EXT_color_buffer_float/}\n         */\n        colorBufferFloat : {\n            get : function() {\n                return this._colorBufferFloat;\n            }\n        },\n\n        /**\n         * <code>true</code> if the EXT_color_buffer_half_float extension is supported.  This\n         * extension makes the format gl.RGBA16F format color renderable.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link https://www.khronos.org/registry/webgl/extensions/EXT_color_buffer_half_float/}\n         * @see {@link https://www.khronos.org/registry/webgl/extensions/EXT_color_buffer_float/}\n         */\n        colorBufferHalfFloat : {\n            get : function() {\n                return (this._webgl2 && this._colorBufferFloat) || (!this._webgl2 && this._colorBufferHalfFloat);\n            }\n        },\n\n        /**\n         * <code>true</code> if the WEBGL_draw_buffers extension is supported. This\n         * extensions provides support for multiple render targets. The framebuffer object can have mutiple\n         * color attachments and the GLSL fragment shader can write to the built-in output array <code>gl_FragData</code>.\n         * A shader using this feature needs to explicitly enable the extension with\n         * <code>#extension GL_EXT_draw_buffers : enable</code>.\n         * @memberof Context.prototype\n         * @type {Boolean}\n         * @see {@link http://www.khronos.org/registry/webgl/extensions/WEBGL_draw_buffers/|WEBGL_draw_buffers}\n         */\n        drawBuffers : {\n            get : function() {\n                return this._drawBuffers || this._webgl2;\n            }\n        },\n\n        debugShaders : {\n            get : function() {\n                return this._debugShaders;\n            }\n        },\n\n        throwOnWebGLError : {\n            get : function() {\n                return this._throwOnWebGLError;\n            },\n            set : function(value) {\n                this._throwOnWebGLError = value;\n                this._gl = wrapGL(this._originalGLContext, value ? throwOnError : undefined);\n            }\n        },\n\n        /**\n         * A 1x1 RGBA texture initialized to [255, 255, 255, 255].  This can\n         * be used as a placeholder texture while other textures are downloaded.\n         * @memberof Context.prototype\n         * @type {Texture}\n         */\n        defaultTexture : {\n            get : function() {\n                if (this._defaultTexture === undefined) {\n                    this._defaultTexture = new Texture({\n                        context : this,\n                        source : {\n                            width : 1,\n                            height : 1,\n                            arrayBufferView : new Uint8Array([255, 255, 255, 255])\n                        },\n                        flipY : false\n                    });\n                }\n\n                return this._defaultTexture;\n            }\n        },\n\n        /**\n         * A cube map, where each face is a 1x1 RGBA texture initialized to\n         * [255, 255, 255, 255].  This can be used as a placeholder cube map while\n         * other cube maps are downloaded.\n         * @memberof Context.prototype\n         * @type {CubeMap}\n         */\n        defaultCubeMap : {\n            get : function() {\n                if (this._defaultCubeMap === undefined) {\n                    var face = {\n                        width : 1,\n                        height : 1,\n                        arrayBufferView : new Uint8Array([255, 255, 255, 255])\n                    };\n\n                    this._defaultCubeMap = new CubeMap({\n                        context : this,\n                        source : {\n                            positiveX : face,\n                            negativeX : face,\n                            positiveY : face,\n                            negativeY : face,\n                            positiveZ : face,\n                            negativeZ : face\n                        },\n                        flipY : false\n                    });\n                }\n\n                return this._defaultCubeMap;\n\n            }\n        },\n\n        /**\n         * The drawingBufferHeight of the underlying GL context.\n         * @memberof Context.prototype\n         * @type {Number}\n         * @see {@link https://www.khronos.org/registry/webgl/specs/1.0/#DOM-WebGLRenderingContext-drawingBufferHeight|drawingBufferHeight}\n         */\n        drawingBufferHeight : {\n            get : function() {\n                return this._gl.drawingBufferHeight;\n            }\n        },\n\n        /**\n         * The drawingBufferWidth of the underlying GL context.\n         * @memberof Context.prototype\n         * @type {Number}\n         * @see {@link https://www.khronos.org/registry/webgl/specs/1.0/#DOM-WebGLRenderingContext-drawingBufferWidth|drawingBufferWidth}\n         */\n        drawingBufferWidth : {\n            get : function() {\n                return this._gl.drawingBufferWidth;\n            }\n        },\n\n        /**\n         * Gets an object representing the currently bound framebuffer.  While this instance is not an actual\n         * {@link Framebuffer}, it is used to represent the default framebuffer in calls to\n         * {@link Texture.fromFramebuffer}.\n         * @memberof Context.prototype\n         * @type {Object}\n         */\n        defaultFramebuffer : {\n            get : function() {\n                return defaultFramebufferMarker;\n            }\n        }\n    });\n\n    /**\n     * Validates a framebuffer.\n     * Available in debug builds only.\n     * @private\n     */\n    function validateFramebuffer(context) {\n        \n    }\n\n    function applyRenderState(context, renderState, passState, clear) {\n        var previousRenderState = context._currentRenderState;\n        var previousPassState = context._currentPassState;\n        context._currentRenderState = renderState;\n        context._currentPassState = passState;\n        RenderState.partialApply(context._gl, previousRenderState, renderState, previousPassState, passState, clear);\n    }\n\n    var scratchBackBufferArray;\n    // this check must use typeof, not defined, because defined doesn't work with undeclared variables.\n    if (typeof WebGLRenderingContext !== 'undefined') {\n        scratchBackBufferArray = [WebGLConstants.BACK];\n    }\n\n    function bindFramebuffer(context, framebuffer) {\n        if (framebuffer !== context._currentFramebuffer) {\n            context._currentFramebuffer = framebuffer;\n            var buffers = scratchBackBufferArray;\n\n            if (defined(framebuffer)) {\n                framebuffer._bind();\n                validateFramebuffer(context);\n\n                // TODO: Need a way for a command to give what draw buffers are active.\n                buffers = framebuffer._getActiveColorAttachments();\n            } else {\n                var gl = context._gl;\n                gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n            }\n\n            if (context.drawBuffers) {\n                context.glDrawBuffers(buffers);\n            }\n        }\n    }\n\n    var defaultClearCommand = new ClearCommand();\n\n    Context.prototype.clear = function(clearCommand, passState) {\n        clearCommand = defaultValue(clearCommand, defaultClearCommand);\n        passState = defaultValue(passState, this._defaultPassState);\n\n        var gl = this._gl;\n        var bitmask = 0;\n\n        var c = clearCommand.color;\n        var d = clearCommand.depth;\n        var s = clearCommand.stencil;\n\n        if (defined(c)) {\n            if (!Color.equals(this._clearColor, c)) {\n                Color.clone(c, this._clearColor);\n                gl.clearColor(c.red, c.green, c.blue, c.alpha);\n            }\n            bitmask |= gl.COLOR_BUFFER_BIT;\n        }\n\n        if (defined(d)) {\n            if (d !== this._clearDepth) {\n                this._clearDepth = d;\n                gl.clearDepth(d);\n            }\n            bitmask |= gl.DEPTH_BUFFER_BIT;\n        }\n\n        if (defined(s)) {\n            if (s !== this._clearStencil) {\n                this._clearStencil = s;\n                gl.clearStencil(s);\n            }\n            bitmask |= gl.STENCIL_BUFFER_BIT;\n        }\n\n        var rs = defaultValue(clearCommand.renderState, this._defaultRenderState);\n        applyRenderState(this, rs, passState, true);\n\n        // The command's framebuffer takes presidence over the pass' framebuffer, e.g., for off-screen rendering.\n        var framebuffer = defaultValue(clearCommand.framebuffer, passState.framebuffer);\n        bindFramebuffer(this, framebuffer);\n\n        gl.clear(bitmask);\n    };\n\n    function beginDraw(context, framebuffer, passState, shaderProgram, renderState) {\n        \n\n        bindFramebuffer(context, framebuffer);\n        applyRenderState(context, renderState, passState, false);\n        shaderProgram._bind();\n        context._maxFrameTextureUnitIndex = Math.max(context._maxFrameTextureUnitIndex, shaderProgram.maximumTextureUnitIndex);\n    }\n\n    function continueDraw(context, drawCommand, shaderProgram, uniformMap) {\n        var primitiveType = drawCommand._primitiveType;\n        var va = drawCommand._vertexArray;\n        var offset = drawCommand._offset;\n        var count = drawCommand._count;\n        var instanceCount = drawCommand.instanceCount;\n\n        \n\n        context._us.model = defaultValue(drawCommand._modelMatrix, Matrix4.IDENTITY);\n        shaderProgram._setUniforms(uniformMap, context._us, context.validateShaderProgram);\n\n        va._bind();\n        var indexBuffer = va.indexBuffer;\n\n        if (defined(indexBuffer)) {\n            offset = offset * indexBuffer.bytesPerIndex; // offset in vertices to offset in bytes\n            count = defaultValue(count, indexBuffer.numberOfIndices);\n            if (instanceCount === 0) {\n                context._gl.drawElements(primitiveType, count, indexBuffer.indexDatatype, offset);\n            } else {\n                context.glDrawElementsInstanced(primitiveType, count, indexBuffer.indexDatatype, offset, instanceCount);\n            }\n        } else {\n            count = defaultValue(count, va.numberOfVertices);\n            if (instanceCount === 0) {\n                context._gl.drawArrays(primitiveType, offset, count);\n            } else {\n                context.glDrawArraysInstanced(primitiveType, offset, count, instanceCount);\n            }\n        }\n\n        va._unBind();\n    }\n\n    Context.prototype.draw = function(drawCommand, passState, shaderProgram, uniformMap) {\n        \n\n        passState = defaultValue(passState, this._defaultPassState);\n        // The command's framebuffer takes presidence over the pass' framebuffer, e.g., for off-screen rendering.\n        var framebuffer = defaultValue(drawCommand._framebuffer, passState.framebuffer);\n        var renderState = defaultValue(drawCommand._renderState, this._defaultRenderState);\n        shaderProgram = defaultValue(shaderProgram, drawCommand._shaderProgram);\n        uniformMap = defaultValue(uniformMap, drawCommand._uniformMap);\n\n        beginDraw(this, framebuffer, passState, shaderProgram, renderState);\n        continueDraw(this, drawCommand, shaderProgram, uniformMap);\n    };\n\n    Context.prototype.endFrame = function() {\n        var gl = this._gl;\n        gl.useProgram(null);\n\n        this._currentFramebuffer = undefined;\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n        var buffers = scratchBackBufferArray;\n        if (this.drawBuffers) {\n            this.glDrawBuffers(buffers);\n        }\n\n        var length = this._maxFrameTextureUnitIndex;\n        this._maxFrameTextureUnitIndex = 0;\n\n        for (var i = 0; i < length; ++i) {\n            gl.activeTexture(gl.TEXTURE0 + i);\n            gl.bindTexture(gl.TEXTURE_2D, null);\n            gl.bindTexture(gl.TEXTURE_CUBE_MAP, null);\n        }\n    };\n\n    Context.prototype.readPixels = function(readState) {\n        var gl = this._gl;\n\n        readState = defaultValue(readState, defaultValue.EMPTY_OBJECT);\n        var x = Math.max(defaultValue(readState.x, 0), 0);\n        var y = Math.max(defaultValue(readState.y, 0), 0);\n        var width = defaultValue(readState.width, gl.drawingBufferWidth);\n        var height = defaultValue(readState.height, gl.drawingBufferHeight);\n        var framebuffer = readState.framebuffer;\n\n        \n\n        var pixelDatatype = PixelDatatype.UNSIGNED_BYTE;\n        if (defined(framebuffer) && framebuffer.numberOfColorAttachments > 0) {\n            pixelDatatype = framebuffer.getColorTexture(0).pixelDatatype;\n        }\n\n        var pixels = PixelFormat.createTypedArray(PixelFormat.RGBA, pixelDatatype, width, height);\n\n        bindFramebuffer(this, framebuffer);\n\n        gl.readPixels(x, y, width, height, PixelFormat.RGBA, pixelDatatype, pixels);\n\n        return pixels;\n    };\n\n    var viewportQuadAttributeLocations = {\n        position : 0,\n        textureCoordinates : 1\n    };\n\n    Context.prototype.getViewportQuadVertexArray = function() {\n        // Per-context cache for viewport quads\n        var vertexArray = this.cache.viewportQuad_vertexArray;\n\n        if (!defined(vertexArray)) {\n            var geometry = new Geometry({\n                attributes : {\n                    position : new GeometryAttribute({\n                        componentDatatype : ComponentDatatype.FLOAT,\n                        componentsPerAttribute : 2,\n                        values : [\n                            -1.0, -1.0,\n                            1.0, -1.0,\n                            1.0, 1.0,\n                            -1.0, 1.0\n                        ]\n                    }),\n\n                    textureCoordinates : new GeometryAttribute({\n                        componentDatatype : ComponentDatatype.FLOAT,\n                        componentsPerAttribute : 2,\n                        values : [\n                            0.0, 0.0,\n                            1.0, 0.0,\n                            1.0, 1.0,\n                            0.0, 1.0\n                        ]\n                    })\n                },\n                // Workaround Internet Explorer 11.0.8 lack of TRIANGLE_FAN\n                indices : new Uint16Array([0, 1, 2, 0, 2, 3]),\n                primitiveType : PrimitiveType.TRIANGLES\n            });\n\n            vertexArray = VertexArray.fromGeometry({\n                context : this,\n                geometry : geometry,\n                attributeLocations : viewportQuadAttributeLocations,\n                bufferUsage : BufferUsage.STATIC_DRAW,\n                interleave : true\n            });\n\n            this.cache.viewportQuad_vertexArray = vertexArray;\n        }\n\n        return vertexArray;\n    };\n\n    Context.prototype.createViewportQuadCommand = function(fragmentShaderSource, overrides) {\n        overrides = defaultValue(overrides, defaultValue.EMPTY_OBJECT);\n\n        return new DrawCommand({\n            vertexArray : this.getViewportQuadVertexArray(),\n            primitiveType : PrimitiveType.TRIANGLES,\n            renderState : overrides.renderState,\n            shaderProgram : ShaderProgram.fromCache({\n                context : this,\n                vertexShaderSource : ViewportQuadVS,\n                fragmentShaderSource : fragmentShaderSource,\n                attributeLocations : viewportQuadAttributeLocations\n            }),\n            uniformMap : overrides.uniformMap,\n            owner : overrides.owner,\n            framebuffer : overrides.framebuffer,\n            pass : overrides.pass\n        });\n    };\n\n    /**\n     * Gets the object associated with a pick color.\n     *\n     * @param {Color} pickColor The pick color.\n     * @returns {Object} The object associated with the pick color, or undefined if no object is associated with that color.\n     *\n     * @example\n     * var object = context.getObjectByPickColor(pickColor);\n     *\n     * @see Context#createPickId\n     */\n    Context.prototype.getObjectByPickColor = function(pickColor) {\n        \n\n        return this._pickObjects[pickColor.toRgba()];\n    };\n\n    function PickId(pickObjects, key, color) {\n        this._pickObjects = pickObjects;\n        this.key = key;\n        this.color = color;\n    }\n\n    Object.defineProperties(PickId.prototype, {\n        object : {\n            get : function() {\n                return this._pickObjects[this.key];\n            },\n            set : function(value) {\n                this._pickObjects[this.key] = value;\n            }\n        }\n    });\n\n    PickId.prototype.destroy = function() {\n        delete this._pickObjects[this.key];\n        return undefined;\n    };\n\n    /**\n     * Creates a unique ID associated with the input object for use with color-buffer picking.\n     * The ID has an RGBA color value unique to this context.  You must call destroy()\n     * on the pick ID when destroying the input object.\n     *\n     * @param {Object} object The object to associate with the pick ID.\n     * @returns {Object} A PickId object with a <code>color</code> property.\n     *\n     * @exception {RuntimeError} Out of unique Pick IDs.\n     *\n     *\n     * @example\n     * this._pickId = context.createPickId({\n     *   primitive : this,\n     *   id : this.id\n     * });\n     *\n     * @see Context#getObjectByPickColor\n     */\n    Context.prototype.createPickId = function(object) {\n        \n\n        // the increment and assignment have to be separate statements to\n        // actually detect overflow in the Uint32 value\n        ++this._nextPickColor[0];\n        var key = this._nextPickColor[0];\n        if (key === 0) {\n            // In case of overflow\n            throw new RuntimeError('Out of unique Pick IDs.');\n        }\n\n        this._pickObjects[key] = object;\n        return new PickId(this._pickObjects, key, Color.fromRgba(key));\n    };\n\n    Context.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    Context.prototype.destroy = function() {\n        // Destroy all objects in the cache that have a destroy method.\n        var cache = this.cache;\n        for (var property in cache) {\n            if (cache.hasOwnProperty(property)) {\n                var propertyValue = cache[property];\n                if (defined(propertyValue.destroy)) {\n                    propertyValue.destroy();\n                }\n            }\n        }\n\n        this._shaderCache = this._shaderCache.destroy();\n        this._textureCache = this._textureCache.destroy();\n        this._defaultTexture = this._defaultTexture && this._defaultTexture.destroy();\n        this._defaultCubeMap = this._defaultCubeMap && this._defaultCubeMap.destroy();\n\n        return destroyObject(this);\n    };\nexport default Context;\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"varying vec2 v_textureCoordinates;\\n\\\nconst float M_PI = 3.141592653589793;\\n\\\n\\n\\\nfloat vdcRadicalInverse(int i)\\n\\\n{\\n\\\n    float r;\\n\\\n    float base = 2.0;\\n\\\n    float value = 0.0;\\n\\\n    float invBase = 1.0 / base;\\n\\\n    float invBi = invBase;\\n\\\n    for (int x = 0; x < 100; x++)\\n\\\n    {\\n\\\n        if (i <= 0)\\n\\\n        {\\n\\\n            break;\\n\\\n        }\\n\\\n        r = mod(float(i), base);\\n\\\n        value += r * invBi;\\n\\\n        invBi *= invBase;\\n\\\n        i = int(float(i) * invBase);\\n\\\n    }\\n\\\n    return value;\\n\\\n}\\n\\\n\\n\\\nvec2 hammersley2D(int i, int N)\\n\\\n{\\n\\\n    return vec2(float(i) / float(N), vdcRadicalInverse(i));\\n\\\n}\\n\\\n\\n\\\nvec3 importanceSampleGGX(vec2 xi, float roughness, vec3 N)\\n\\\n{\\n\\\n    float a = roughness * roughness;\\n\\\n    float phi = 2.0 * M_PI * xi.x;\\n\\\n    float cosTheta = sqrt((1.0 - xi.y) / (1.0 + (a * a - 1.0) * xi.y));\\n\\\n    float sinTheta = sqrt(1.0 - cosTheta * cosTheta);\\n\\\n    vec3 H = vec3(sinTheta * cos(phi), sinTheta * sin(phi), cosTheta);\\n\\\n    vec3 upVector = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\\n\\\n    vec3 tangentX = normalize(cross(upVector, N));\\n\\\n    vec3 tangentY = cross(N, tangentX);\\n\\\n    return tangentX * H.x + tangentY * H.y + N * H.z;\\n\\\n}\\n\\\n\\n\\\nfloat G1_Smith(float NdotV, float k)\\n\\\n{\\n\\\n    return NdotV / (NdotV * (1.0 - k) + k);\\n\\\n}\\n\\\n\\n\\\nfloat G_Smith(float roughness, float NdotV, float NdotL)\\n\\\n{\\n\\\n    float k = roughness * roughness / 2.0;\\n\\\n    return G1_Smith(NdotV, k) * G1_Smith(NdotL, k);\\n\\\n}\\n\\\n\\n\\\nvec2 integrateBrdf(float roughness, float NdotV)\\n\\\n{\\n\\\n    vec3 V = vec3(sqrt(1.0 - NdotV * NdotV), 0.0, NdotV);\\n\\\n    float A = 0.0;\\n\\\n    float B = 0.0;\\n\\\n    const int NumSamples = 1024;\\n\\\n    for (int i = 0; i < NumSamples; i++)\\n\\\n    {\\n\\\n        vec2 xi = hammersley2D(i, NumSamples);\\n\\\n        vec3 H = importanceSampleGGX(xi, roughness, vec3(0.0, 0.0, 1.0));\\n\\\n        vec3 L = 2.0 * dot(V, H) * H - V;\\n\\\n        float NdotL = clamp(L.z, 0.0, 1.0);\\n\\\n        float NdotH = clamp(H.z, 0.0, 1.0);\\n\\\n        float VdotH = clamp(dot(V, H), 0.0, 1.0);\\n\\\n        if (NdotL > 0.0)\\n\\\n        {\\n\\\n            float G = G_Smith(roughness, NdotV, NdotL);\\n\\\n            float G_Vis = G * VdotH / (NdotH * NdotV);\\n\\\n            float Fc = pow(1.0 - VdotH, 5.0);\\n\\\n            A += (1.0 - Fc) * G_Vis;\\n\\\n            B += Fc * G_Vis;\\n\\\n        }\\n\\\n    }\\n\\\n    return vec2(A, B) / float(NumSamples);\\n\\\n}\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    gl_FragColor = vec4(integrateBrdf(v_textureCoordinates.y, v_textureCoordinates.x), 0.0, 1.0);\\n\\\n}\\n\\\n\";\n","import BoundingRectangle from '../Core/BoundingRectangle.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport PixelFormat from '../Core/PixelFormat.js';\nimport Framebuffer from '../Renderer/Framebuffer.js';\nimport PixelDatatype from '../Renderer/PixelDatatype.js';\nimport RenderState from '../Renderer/RenderState.js';\nimport Sampler from '../Renderer/Sampler.js';\nimport Texture from '../Renderer/Texture.js';\nimport BrdfLutGeneratorFS from '../Shaders/BrdfLutGeneratorFS.js';\n\n    /**\n     * @private\n     */\n    function BrdfLutGenerator() {\n        this._framebuffer = undefined;\n        this._colorTexture = undefined;\n        this._drawCommand = undefined;\n    }\n\n    Object.defineProperties(BrdfLutGenerator.prototype, {\n        colorTexture : {\n            get : function() {\n                return this._colorTexture;\n            }\n        }\n    });\n\n    function createCommand(generator, context) {\n        var framebuffer = generator._framebuffer;\n\n        var drawCommand = context.createViewportQuadCommand(BrdfLutGeneratorFS, {\n            framebuffer : framebuffer,\n            renderState : RenderState.fromCache({\n                viewport : new BoundingRectangle(0.0, 0.0, 256.0, 256.0)\n            })\n        });\n\n        generator._drawCommand = drawCommand;\n    }\n\n    function createFramebuffer(generator, context) {\n        var colorTexture = new Texture({\n            context : context,\n            width : 256,\n            height: 256,\n            pixelFormat : PixelFormat.RGBA,\n            pixelDatatype : PixelDatatype.UNSIGNED_BYTE,\n            sampler : Sampler.NEAREST\n        });\n\n        generator._colorTexture = colorTexture;\n\n        var framebuffer = new Framebuffer({\n            context : context,\n            colorTextures : [colorTexture],\n            destroyAttachments : false\n        });\n\n        generator._framebuffer = framebuffer;\n    }\n\n    BrdfLutGenerator.prototype.update = function(frameState) {\n        if (!defined(this._colorTexture)) {\n            var context = frameState.context;\n\n            createFramebuffer(this, context);\n            createCommand(this, context);\n            this._drawCommand.execute(context);\n            this._framebuffer = this._framebuffer && this._framebuffer.destroy();\n            this._drawCommand.shaderProgram = this._drawCommand.shaderProgram && this._drawCommand.shaderProgram.destroy();\n        }\n    };\n\n    BrdfLutGenerator.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    BrdfLutGenerator.prototype.destroy = function() {\n        this._colorTexture = this._colorTexture && this._colorTexture.destroy();\n        return destroyObject(this);\n    };\nexport default BrdfLutGenerator;\n","\n    /**\n     * Describes how the map will operate in 2D.\n     *\n     * @exports MapMode2D\n     */\n    var MapMode2D = {\n        /**\n         * The 2D map can be rotated about the z axis.\n         *\n         * @type {Number}\n         * @constant\n         */\n        ROTATE : 0,\n\n        /**\n         * The 2D map can be scrolled infinitely in the horizontal direction.\n         *\n         * @type {Number}\n         * @constant\n         */\n        INFINITE_SCROLL : 1\n    };\nexport default Object.freeze(MapMode2D);\n","import BoundingSphere from '../Core/BoundingSphere.js';\nimport Cartesian2 from '../Core/Cartesian2.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Cartesian4 from '../Core/Cartesian4.js';\nimport Cartographic from '../Core/Cartographic.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport EasingFunction from '../Core/EasingFunction.js';\nimport Ellipsoid from '../Core/Ellipsoid.js';\nimport EllipsoidGeodesic from '../Core/EllipsoidGeodesic.js';\nimport Event from '../Core/Event.js';\nimport getTimestamp from '../Core/getTimestamp.js';\nimport HeadingPitchRange from '../Core/HeadingPitchRange.js';\nimport HeadingPitchRoll from '../Core/HeadingPitchRoll.js';\nimport Intersect from '../Core/Intersect.js';\nimport IntersectionTests from '../Core/IntersectionTests.js';\nimport CesiumMath from '../Core/Math.js';\nimport Matrix3 from '../Core/Matrix3.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport OrthographicFrustum from '../Core/OrthographicFrustum.js';\nimport OrthographicOffCenterFrustum from '../Core/OrthographicOffCenterFrustum.js';\nimport PerspectiveFrustum from '../Core/PerspectiveFrustum.js';\nimport Quaternion from '../Core/Quaternion.js';\nimport Ray from '../Core/Ray.js';\nimport Rectangle from '../Core/Rectangle.js';\nimport Transforms from '../Core/Transforms.js';\nimport CameraFlightPath from './CameraFlightPath.js';\nimport MapMode2D from './MapMode2D.js';\nimport SceneMode from './SceneMode.js';\n\n    /**\n     * The camera is defined by a position, orientation, and view frustum.\n     * <br /><br />\n     * The orientation forms an orthonormal basis with a view, up and right = view x up unit vectors.\n     * <br /><br />\n     * The viewing frustum is defined by 6 planes.\n     * Each plane is represented by a {@link Cartesian4} object, where the x, y, and z components\n     * define the unit vector normal to the plane, and the w component is the distance of the\n     * plane from the origin/camera position.\n     *\n     * @alias Camera\n     *\n     * @constructor\n     *\n     * @param {Scene} scene The scene.\n     *\n     * @demo {@link https://sandcastle.cesium.com/index.html?src=Camera.html|Cesium Sandcastle Camera Demo}\n     * @demo {@link https://sandcastle.cesium.com/index.html?src=Camera%20Tutorial.html\">Sandcastle Example</a> from the <a href=\"https://cesium.com/docs/tutorials/camera/|Camera Tutorial}\n     *\n     * @example\n     * // Create a camera looking down the negative z-axis, positioned at the origin,\n     * // with a field of view of 60 degrees, and 1:1 aspect ratio.\n     * var camera = new Cesium.Camera(scene);\n     * camera.position = new Cesium.Cartesian3();\n     * camera.direction = Cesium.Cartesian3.negate(Cesium.Cartesian3.UNIT_Z, new Cesium.Cartesian3());\n     * camera.up = Cesium.Cartesian3.clone(Cesium.Cartesian3.UNIT_Y);\n     * camera.frustum.fov = Cesium.Math.PI_OVER_THREE;\n     * camera.frustum.near = 1.0;\n     * camera.frustum.far = 2.0;\n     */\n    function Camera(scene) {\n        \n        this._scene = scene;\n\n        this._transform = Matrix4.clone(Matrix4.IDENTITY);\n        this._invTransform = Matrix4.clone(Matrix4.IDENTITY);\n        this._actualTransform = Matrix4.clone(Matrix4.IDENTITY);\n        this._actualInvTransform = Matrix4.clone(Matrix4.IDENTITY);\n        this._transformChanged = false;\n\n        /**\n         * The position of the camera.\n         *\n         * @type {Cartesian3}\n         */\n        this.position = new Cartesian3();\n        this._position = new Cartesian3();\n        this._positionWC = new Cartesian3();\n        this._positionCartographic = new Cartographic();\n        this._oldPositionWC = undefined;\n\n        /**\n         * The position delta magnitude.\n         *\n         * @private\n         */\n        this.positionWCDeltaMagnitude = 0.0;\n\n        /**\n         * The position delta magnitude last frame.\n         *\n         * @private\n         */\n        this.positionWCDeltaMagnitudeLastFrame = 0.0;\n\n        /**\n         * How long in seconds since the camera has stopped moving\n         *\n         * @private\n         */\n        this.timeSinceMoved = 0.0;\n        this._lastMovedTimestamp = 0.0;\n\n        /**\n         * The view direction of the camera.\n         *\n         * @type {Cartesian3}\n         */\n        this.direction = new Cartesian3();\n        this._direction = new Cartesian3();\n        this._directionWC = new Cartesian3();\n\n        /**\n         * The up direction of the camera.\n         *\n         * @type {Cartesian3}\n         */\n        this.up = new Cartesian3();\n        this._up = new Cartesian3();\n        this._upWC = new Cartesian3();\n\n        /**\n         * The right direction of the camera.\n         *\n         * @type {Cartesian3}\n         */\n        this.right = new Cartesian3();\n        this._right = new Cartesian3();\n        this._rightWC = new Cartesian3();\n\n        /**\n         * The region of space in view.\n         *\n         * @type {Frustum}\n         * @default PerspectiveFrustum()\n         *\n         * @see PerspectiveFrustum\n         * @see PerspectiveOffCenterFrustum\n         * @see OrthographicFrustum\n         */\n        this.frustum = new PerspectiveFrustum();\n        this.frustum.aspectRatio = scene.drawingBufferWidth / scene.drawingBufferHeight;\n        this.frustum.fov = CesiumMath.toRadians(60.0);\n\n        /**\n         * The default amount to move the camera when an argument is not\n         * provided to the move methods.\n         * @type {Number}\n         * @default 100000.0;\n         */\n        this.defaultMoveAmount = 100000.0;\n        /**\n         * The default amount to rotate the camera when an argument is not\n         * provided to the look methods.\n         * @type {Number}\n         * @default Math.PI / 60.0\n         */\n        this.defaultLookAmount = Math.PI / 60.0;\n        /**\n         * The default amount to rotate the camera when an argument is not\n         * provided to the rotate methods.\n         * @type {Number}\n         * @default Math.PI / 3600.0\n         */\n        this.defaultRotateAmount = Math.PI / 3600.0;\n        /**\n         * The default amount to move the camera when an argument is not\n         * provided to the zoom methods.\n         * @type {Number}\n         * @default 100000.0;\n         */\n        this.defaultZoomAmount = 100000.0;\n        /**\n         * If set, the camera will not be able to rotate past this axis in either direction.\n         * @type {Cartesian3}\n         * @default undefined\n         */\n        this.constrainedAxis = undefined;\n        /**\n         * The factor multiplied by the the map size used to determine where to clamp the camera position\n         * when zooming out from the surface. The default is 1.5. Only valid for 2D and the map is rotatable.\n         * @type {Number}\n         * @default 1.5\n         */\n        this.maximumZoomFactor = 1.5;\n\n        this._moveStart = new Event();\n        this._moveEnd = new Event();\n\n        this._changed = new Event();\n        this._changedPosition = undefined;\n        this._changedDirection = undefined;\n        this._changedFrustum = undefined;\n\n        /**\n         * The amount the camera has to change before the <code>changed</code> event is raised. The value is a percentage in the [0, 1] range.\n         * @type {number}\n         * @default 0.5\n         */\n        this.percentageChanged = 0.5;\n\n        this._viewMatrix = new Matrix4();\n        this._invViewMatrix = new Matrix4();\n        updateViewMatrix(this);\n\n        this._mode = SceneMode.SCENE3D;\n        this._modeChanged = true;\n        var projection = scene.mapProjection;\n        this._projection = projection;\n        this._maxCoord = projection.project(new Cartographic(Math.PI, CesiumMath.PI_OVER_TWO));\n        this._max2Dfrustum = undefined;\n\n        // set default view\n        rectangleCameraPosition3D(this, Camera.DEFAULT_VIEW_RECTANGLE, this.position, true);\n\n        var mag = Cartesian3.magnitude(this.position);\n        mag += mag * Camera.DEFAULT_VIEW_FACTOR;\n        Cartesian3.normalize(this.position, this.position);\n        Cartesian3.multiplyByScalar(this.position, mag, this.position);\n    }\n\n    /**\n     * @private\n     */\n    Camera.TRANSFORM_2D = new Matrix4(\n        0.0, 0.0, 1.0, 0.0,\n        1.0, 0.0, 0.0, 0.0,\n        0.0, 1.0, 0.0, 0.0,\n        0.0, 0.0, 0.0, 1.0);\n\n    /**\n     * @private\n     */\n    Camera.TRANSFORM_2D_INVERSE = Matrix4.inverseTransformation(Camera.TRANSFORM_2D, new Matrix4());\n\n    /**\n     * The default rectangle the camera will view on creation.\n     * @type Rectangle\n     */\n    Camera.DEFAULT_VIEW_RECTANGLE = Rectangle.fromDegrees(-95.0, -20.0, -70.0, 90.0);\n\n    /**\n     * A scalar to multiply to the camera position and add it back after setting the camera to view the rectangle.\n     * A value of zero means the camera will view the entire {@link Camera#DEFAULT_VIEW_RECTANGLE}, a value greater than zero\n     * will move it further away from the extent, and a value less than zero will move it close to the extent.\n     * @type Number\n     */\n    Camera.DEFAULT_VIEW_FACTOR = 0.5;\n\n    /**\n     * The default heading/pitch/range that is used when the camera flies to a location that contains a bounding sphere.\n     * @type HeadingPitchRange\n     */\n    Camera.DEFAULT_OFFSET = new HeadingPitchRange(0.0, -CesiumMath.PI_OVER_FOUR, 0.0);\n\n    function updateViewMatrix(camera) {\n        Matrix4.computeView(camera._position, camera._direction, camera._up, camera._right, camera._viewMatrix);\n        Matrix4.multiply(camera._viewMatrix, camera._actualInvTransform, camera._viewMatrix);\n        Matrix4.inverseTransformation(camera._viewMatrix, camera._invViewMatrix);\n    }\n\n    function updateCameraDeltas(camera) {\n        if (!defined(camera._oldPositionWC)) {\n            camera._oldPositionWC = Cartesian3.clone(camera.positionWC, camera._oldPositionWC);\n        } else {\n            camera.positionWCDeltaMagnitudeLastFrame = camera.positionWCDeltaMagnitude;\n            var delta = Cartesian3.subtract(camera.positionWC, camera._oldPositionWC, camera._oldPositionWC);\n            camera.positionWCDeltaMagnitude = Cartesian3.magnitude(delta);\n            camera._oldPositionWC = Cartesian3.clone(camera.positionWC, camera._oldPositionWC);\n\n            // Update move timers\n            if (camera.positionWCDeltaMagnitude > 0.0) {\n                camera.timeSinceMoved = 0.0;\n                camera._lastMovedTimestamp = getTimestamp();\n            } else {\n                camera.timeSinceMoved = Math.max(getTimestamp() - camera._lastMovedTimestamp, 0.0) / 1000.0;\n            }\n        }\n    }\n\n    /**\n     * Checks if there's a camera flight with preload for this camera.\n     *\n     * @returns {Boolean} Whether or not this camera has a current flight with a valid preloadFlightCamera in scene.\n     *\n     * @private\n     *\n     */\n    Camera.prototype.canPreloadFlight = function() {\n        return defined(this._currentFlight) && this._mode !== SceneMode.SCENE2D;\n    };\n\n    Camera.prototype._updateCameraChanged = function() {\n        var camera = this;\n\n        updateCameraDeltas(camera);\n\n        if (camera._changed.numberOfListeners === 0) {\n            return;\n        }\n\n        var percentageChanged = camera.percentageChanged;\n\n        if (camera._mode === SceneMode.SCENE2D) {\n            if (!defined(camera._changedFrustum)) {\n                camera._changedPosition = Cartesian3.clone(camera.position, camera._changedPosition);\n                camera._changedFrustum = camera.frustum.clone();\n                return;\n            }\n\n            var position = camera.position;\n            var lastPosition = camera._changedPosition;\n\n            var frustum = camera.frustum;\n            var lastFrustum = camera._changedFrustum;\n\n            var x0 = position.x + frustum.left;\n            var x1 = position.x + frustum.right;\n            var x2 = lastPosition.x + lastFrustum.left;\n            var x3 = lastPosition.x + lastFrustum.right;\n\n            var y0 = position.y + frustum.bottom;\n            var y1 = position.y + frustum.top;\n            var y2 = lastPosition.y + lastFrustum.bottom;\n            var y3 = lastPosition.y + lastFrustum.top;\n\n            var leftX = Math.max(x0, x2);\n            var rightX = Math.min(x1, x3);\n            var bottomY = Math.max(y0, y2);\n            var topY = Math.min(y1, y3);\n\n            var areaPercentage;\n            if (leftX >= rightX || bottomY >= y1) {\n                areaPercentage = 1.0;\n            } else {\n                var areaRef = lastFrustum;\n                if (x0 < x2 && x1 > x3 && y0 < y2 && y1 > y3) {\n                    areaRef = frustum;\n                }\n                areaPercentage = 1.0 - ((rightX - leftX) * (topY - bottomY)) / ((areaRef.right - areaRef.left) * (areaRef.top - areaRef.bottom));\n            }\n\n            if (areaPercentage > percentageChanged) {\n                camera._changed.raiseEvent(areaPercentage);\n                camera._changedPosition = Cartesian3.clone(camera.position, camera._changedPosition);\n                camera._changedFrustum = camera.frustum.clone(camera._changedFrustum);\n            }\n            return;\n        }\n\n        if (!defined(camera._changedDirection)) {\n            camera._changedPosition = Cartesian3.clone(camera.positionWC, camera._changedPosition);\n            camera._changedDirection = Cartesian3.clone(camera.directionWC, camera._changedDirection);\n            return;\n        }\n\n        var dirAngle = CesiumMath.acosClamped(Cartesian3.dot(camera.directionWC, camera._changedDirection));\n\n        var dirPercentage;\n        if (defined(camera.frustum.fovy)) {\n            dirPercentage = dirAngle / (camera.frustum.fovy * 0.5);\n        } else {\n            dirPercentage = dirAngle;\n        }\n\n        var distance = Cartesian3.distance(camera.positionWC, camera._changedPosition);\n        var heightPercentage = distance / camera.positionCartographic.height;\n\n        if (dirPercentage > percentageChanged || heightPercentage > percentageChanged) {\n            camera._changed.raiseEvent(Math.max(dirPercentage, heightPercentage));\n            camera._changedPosition = Cartesian3.clone(camera.positionWC, camera._changedPosition);\n            camera._changedDirection = Cartesian3.clone(camera.directionWC, camera._changedDirection);\n        }\n    };\n\n    function convertTransformForColumbusView(camera) {\n        Transforms.basisTo2D(camera._projection, camera._transform, camera._actualTransform);\n    }\n\n    var scratchCartographic = new Cartographic();\n    var scratchCartesian3Projection = new Cartesian3();\n    var scratchCartesian3 = new Cartesian3();\n    var scratchCartesian4Origin = new Cartesian4();\n    var scratchCartesian4NewOrigin = new Cartesian4();\n    var scratchCartesian4NewXAxis = new Cartesian4();\n    var scratchCartesian4NewYAxis = new Cartesian4();\n    var scratchCartesian4NewZAxis = new Cartesian4();\n\n    function convertTransformFor2D(camera) {\n        var projection = camera._projection;\n        var ellipsoid = projection.ellipsoid;\n\n        var origin = Matrix4.getColumn(camera._transform, 3, scratchCartesian4Origin);\n        var cartographic = ellipsoid.cartesianToCartographic(origin, scratchCartographic);\n\n        var projectedPosition = projection.project(cartographic, scratchCartesian3Projection);\n        var newOrigin = scratchCartesian4NewOrigin;\n        newOrigin.x = projectedPosition.z;\n        newOrigin.y = projectedPosition.x;\n        newOrigin.z = projectedPosition.y;\n        newOrigin.w = 1.0;\n\n        var newZAxis = Cartesian4.clone(Cartesian4.UNIT_X, scratchCartesian4NewZAxis);\n\n        var xAxis = Cartesian4.add(Matrix4.getColumn(camera._transform, 0, scratchCartesian3), origin, scratchCartesian3);\n        ellipsoid.cartesianToCartographic(xAxis, cartographic);\n\n        projection.project(cartographic, projectedPosition);\n        var newXAxis = scratchCartesian4NewXAxis;\n        newXAxis.x = projectedPosition.z;\n        newXAxis.y = projectedPosition.x;\n        newXAxis.z = projectedPosition.y;\n        newXAxis.w = 0.0;\n\n        Cartesian3.subtract(newXAxis, newOrigin, newXAxis);\n        newXAxis.x = 0.0;\n\n        var newYAxis = scratchCartesian4NewYAxis;\n        if (Cartesian3.magnitudeSquared(newXAxis) > CesiumMath.EPSILON10) {\n            Cartesian3.cross(newZAxis, newXAxis, newYAxis);\n        } else {\n            var yAxis = Cartesian4.add(Matrix4.getColumn(camera._transform, 1, scratchCartesian3), origin, scratchCartesian3);\n            ellipsoid.cartesianToCartographic(yAxis, cartographic);\n\n            projection.project(cartographic, projectedPosition);\n            newYAxis.x = projectedPosition.z;\n            newYAxis.y = projectedPosition.x;\n            newYAxis.z = projectedPosition.y;\n            newYAxis.w = 0.0;\n\n            Cartesian3.subtract(newYAxis, newOrigin, newYAxis);\n            newYAxis.x = 0.0;\n\n            if (Cartesian3.magnitudeSquared(newYAxis) < CesiumMath.EPSILON10) {\n                Cartesian4.clone(Cartesian4.UNIT_Y, newXAxis);\n                Cartesian4.clone(Cartesian4.UNIT_Z, newYAxis);\n            }\n        }\n\n        Cartesian3.cross(newYAxis, newZAxis, newXAxis);\n        Cartesian3.normalize(newXAxis, newXAxis);\n        Cartesian3.cross(newZAxis, newXAxis, newYAxis);\n        Cartesian3.normalize(newYAxis, newYAxis);\n\n        Matrix4.setColumn(camera._actualTransform, 0, newXAxis, camera._actualTransform);\n        Matrix4.setColumn(camera._actualTransform, 1, newYAxis, camera._actualTransform);\n        Matrix4.setColumn(camera._actualTransform, 2, newZAxis, camera._actualTransform);\n        Matrix4.setColumn(camera._actualTransform, 3, newOrigin, camera._actualTransform);\n    }\n\n    var scratchCartesian = new Cartesian3();\n\n    function updateMembers(camera) {\n        var mode = camera._mode;\n\n        var heightChanged = false;\n        var height = 0.0;\n        if (mode === SceneMode.SCENE2D) {\n            height = camera.frustum.right - camera.frustum.left;\n            heightChanged = height !== camera._positionCartographic.height;\n        }\n\n        var position = camera._position;\n        var positionChanged = !Cartesian3.equals(position, camera.position) || heightChanged;\n        if (positionChanged) {\n            position = Cartesian3.clone(camera.position, camera._position);\n        }\n\n        var direction = camera._direction;\n        var directionChanged = !Cartesian3.equals(direction, camera.direction);\n        if (directionChanged) {\n            Cartesian3.normalize(camera.direction, camera.direction);\n            direction = Cartesian3.clone(camera.direction, camera._direction);\n        }\n\n        var up = camera._up;\n        var upChanged = !Cartesian3.equals(up, camera.up);\n        if (upChanged) {\n            Cartesian3.normalize(camera.up, camera.up);\n            up = Cartesian3.clone(camera.up, camera._up);\n        }\n\n        var right = camera._right;\n        var rightChanged = !Cartesian3.equals(right, camera.right);\n        if (rightChanged) {\n            Cartesian3.normalize(camera.right, camera.right);\n            right = Cartesian3.clone(camera.right, camera._right);\n        }\n\n        var transformChanged = camera._transformChanged || camera._modeChanged;\n        camera._transformChanged = false;\n\n        if (transformChanged) {\n            Matrix4.inverseTransformation(camera._transform, camera._invTransform);\n\n            if (camera._mode === SceneMode.COLUMBUS_VIEW || camera._mode === SceneMode.SCENE2D) {\n                if (Matrix4.equals(Matrix4.IDENTITY, camera._transform)) {\n                    Matrix4.clone(Camera.TRANSFORM_2D, camera._actualTransform);\n                } else if (camera._mode === SceneMode.COLUMBUS_VIEW) {\n                    convertTransformForColumbusView(camera);\n                } else {\n                    convertTransformFor2D(camera);\n                }\n            } else {\n                Matrix4.clone(camera._transform, camera._actualTransform);\n            }\n\n            Matrix4.inverseTransformation(camera._actualTransform, camera._actualInvTransform);\n\n            camera._modeChanged = false;\n        }\n\n        var transform = camera._actualTransform;\n\n        if (positionChanged || transformChanged) {\n            camera._positionWC = Matrix4.multiplyByPoint(transform, position, camera._positionWC);\n\n            // Compute the Cartographic position of the camera.\n            if (mode === SceneMode.SCENE3D || mode === SceneMode.MORPHING) {\n                camera._positionCartographic = camera._projection.ellipsoid.cartesianToCartographic(camera._positionWC, camera._positionCartographic);\n            } else {\n                // The camera position is expressed in the 2D coordinate system where the Y axis is to the East,\n                // the Z axis is to the North, and the X axis is out of the map.  Express them instead in the ENU axes where\n                // X is to the East, Y is to the North, and Z is out of the local horizontal plane.\n                var positionENU = scratchCartesian;\n                positionENU.x = camera._positionWC.y;\n                positionENU.y = camera._positionWC.z;\n                positionENU.z = camera._positionWC.x;\n\n                // In 2D, the camera height is always 12.7 million meters.\n                // The apparent height is equal to half the frustum width.\n                if (mode === SceneMode.SCENE2D) {\n                    positionENU.z = height;\n                }\n\n                camera._projection.unproject(positionENU, camera._positionCartographic);\n            }\n        }\n\n        if (directionChanged || upChanged || rightChanged) {\n            var det = Cartesian3.dot(direction, Cartesian3.cross(up, right, scratchCartesian));\n            if (Math.abs(1.0 - det) > CesiumMath.EPSILON2) {\n                //orthonormalize axes\n                var invUpMag = 1.0 / Cartesian3.magnitudeSquared(up);\n                var scalar = Cartesian3.dot(up, direction) * invUpMag;\n                var w0 = Cartesian3.multiplyByScalar(direction, scalar, scratchCartesian);\n                up = Cartesian3.normalize(Cartesian3.subtract(up, w0, camera._up), camera._up);\n                Cartesian3.clone(up, camera.up);\n\n                right = Cartesian3.cross(direction, up, camera._right);\n                Cartesian3.clone(right, camera.right);\n            }\n        }\n\n        if (directionChanged || transformChanged) {\n            camera._directionWC = Matrix4.multiplyByPointAsVector(transform, direction, camera._directionWC);\n            Cartesian3.normalize(camera._directionWC, camera._directionWC);\n        }\n\n        if (upChanged || transformChanged) {\n            camera._upWC = Matrix4.multiplyByPointAsVector(transform, up, camera._upWC);\n            Cartesian3.normalize(camera._upWC, camera._upWC);\n        }\n\n        if (rightChanged || transformChanged) {\n            camera._rightWC = Matrix4.multiplyByPointAsVector(transform, right, camera._rightWC);\n            Cartesian3.normalize(camera._rightWC, camera._rightWC);\n        }\n\n        if (positionChanged || directionChanged || upChanged || rightChanged || transformChanged) {\n            updateViewMatrix(camera);\n        }\n    }\n\n    function getHeading(direction, up) {\n        var heading;\n        if (!CesiumMath.equalsEpsilon(Math.abs(direction.z), 1.0, CesiumMath.EPSILON3)) {\n            heading = Math.atan2(direction.y, direction.x) - CesiumMath.PI_OVER_TWO;\n        } else {\n            heading = Math.atan2(up.y, up.x) - CesiumMath.PI_OVER_TWO;\n        }\n\n        return CesiumMath.TWO_PI - CesiumMath.zeroToTwoPi(heading);\n    }\n\n    function getPitch(direction) {\n        return CesiumMath.PI_OVER_TWO - CesiumMath.acosClamped(direction.z);\n    }\n\n    function getRoll(direction, up, right) {\n        var roll = 0.0;\n        if (!CesiumMath.equalsEpsilon(Math.abs(direction.z), 1.0, CesiumMath.EPSILON3)) {\n            roll = Math.atan2(-right.z, up.z);\n            roll = CesiumMath.zeroToTwoPi(roll + CesiumMath.TWO_PI);\n        }\n\n        return roll;\n    }\n\n    var scratchHPRMatrix1 = new Matrix4();\n    var scratchHPRMatrix2 = new Matrix4();\n\n    Object.defineProperties(Camera.prototype, {\n        /**\n         * Gets the camera's reference frame. The inverse of this transformation is appended to the view matrix.\n         * @memberof Camera.prototype\n         *\n         * @type {Matrix4}\n         * @readonly\n         *\n         * @default {@link Matrix4.IDENTITY}\n         */\n        transform : {\n            get : function() {\n                return this._transform;\n            }\n        },\n\n        /**\n         * Gets the inverse camera transform.\n         * @memberof Camera.prototype\n         *\n         * @type {Matrix4}\n         * @readonly\n         *\n         * @default {@link Matrix4.IDENTITY}\n         */\n        inverseTransform : {\n            get : function() {\n                updateMembers(this);\n                return this._invTransform;\n            }\n        },\n\n        /**\n         * Gets the view matrix.\n         * @memberof Camera.prototype\n         *\n         * @type {Matrix4}\n         * @readonly\n         *\n         * @see Camera#inverseViewMatrix\n         */\n        viewMatrix : {\n            get : function() {\n                updateMembers(this);\n                return this._viewMatrix;\n            }\n        },\n\n        /**\n         * Gets the inverse view matrix.\n         * @memberof Camera.prototype\n         *\n         * @type {Matrix4}\n         * @readonly\n         *\n         * @see Camera#viewMatrix\n         */\n        inverseViewMatrix : {\n            get : function() {\n                updateMembers(this);\n                return this._invViewMatrix;\n            }\n        },\n\n        /**\n         * Gets the {@link Cartographic} position of the camera, with longitude and latitude\n         * expressed in radians and height in meters.  In 2D and Columbus View, it is possible\n         * for the returned longitude and latitude to be outside the range of valid longitudes\n         * and latitudes when the camera is outside the map.\n         * @memberof Camera.prototype\n         *\n         * @type {Cartographic}\n         * @readonly\n         */\n        positionCartographic : {\n            get : function() {\n                updateMembers(this);\n                return this._positionCartographic;\n            }\n        },\n\n        /**\n         * Gets the position of the camera in world coordinates.\n         * @memberof Camera.prototype\n         *\n         * @type {Cartesian3}\n         * @readonly\n         */\n        positionWC : {\n            get : function() {\n                updateMembers(this);\n                return this._positionWC;\n            }\n        },\n\n        /**\n         * Gets the view direction of the camera in world coordinates.\n         * @memberof Camera.prototype\n         *\n         * @type {Cartesian3}\n         * @readonly\n         */\n        directionWC : {\n            get : function() {\n                updateMembers(this);\n                return this._directionWC;\n            }\n        },\n\n        /**\n         * Gets the up direction of the camera in world coordinates.\n         * @memberof Camera.prototype\n         *\n         * @type {Cartesian3}\n         * @readonly\n         */\n        upWC : {\n            get : function() {\n                updateMembers(this);\n                return this._upWC;\n            }\n        },\n\n        /**\n         * Gets the right direction of the camera in world coordinates.\n         * @memberof Camera.prototype\n         *\n         * @type {Cartesian3}\n         * @readonly\n         */\n        rightWC : {\n            get : function() {\n                updateMembers(this);\n                return this._rightWC;\n            }\n        },\n\n        /**\n         * Gets the camera heading in radians.\n         * @memberof Camera.prototype\n         *\n         * @type {Number}\n         * @readonly\n         */\n        heading : {\n            get : function() {\n                if (this._mode !== SceneMode.MORPHING) {\n                    var ellipsoid = this._projection.ellipsoid;\n\n                    var oldTransform = Matrix4.clone(this._transform, scratchHPRMatrix1);\n                    var transform = Transforms.eastNorthUpToFixedFrame(this.positionWC, ellipsoid, scratchHPRMatrix2);\n                    this._setTransform(transform);\n\n                    var heading = getHeading(this.direction, this.up);\n\n                    this._setTransform(oldTransform);\n\n                    return heading;\n                }\n\n                return undefined;\n            }\n        },\n\n        /**\n         * Gets the camera pitch in radians.\n         * @memberof Camera.prototype\n         *\n         * @type {Number}\n         * @readonly\n         */\n        pitch : {\n            get : function() {\n                if (this._mode !== SceneMode.MORPHING) {\n                    var ellipsoid = this._projection.ellipsoid;\n\n                    var oldTransform = Matrix4.clone(this._transform, scratchHPRMatrix1);\n                    var transform = Transforms.eastNorthUpToFixedFrame(this.positionWC, ellipsoid, scratchHPRMatrix2);\n                    this._setTransform(transform);\n\n                    var pitch = getPitch(this.direction);\n\n                    this._setTransform(oldTransform);\n\n                    return pitch;\n                }\n\n                return undefined;\n            }\n        },\n\n        /**\n         * Gets the camera roll in radians.\n         * @memberof Camera.prototype\n         *\n         * @type {Number}\n         * @readonly\n         */\n        roll : {\n            get : function() {\n                if (this._mode !== SceneMode.MORPHING) {\n                    var ellipsoid = this._projection.ellipsoid;\n\n                    var oldTransform = Matrix4.clone(this._transform, scratchHPRMatrix1);\n                    var transform = Transforms.eastNorthUpToFixedFrame(this.positionWC, ellipsoid, scratchHPRMatrix2);\n                    this._setTransform(transform);\n\n                    var roll = getRoll(this.direction, this.up, this.right);\n\n                    this._setTransform(oldTransform);\n\n                    return roll;\n                }\n\n                return undefined;\n            }\n        },\n\n        /**\n         * Gets the event that will be raised at when the camera starts to move.\n         * @memberof Camera.prototype\n         * @type {Event}\n         * @readonly\n         */\n        moveStart : {\n            get : function() {\n                return this._moveStart;\n            }\n        },\n\n        /**\n         * Gets the event that will be raised when the camera has stopped moving.\n         * @memberof Camera.prototype\n         * @type {Event}\n         * @readonly\n         */\n        moveEnd : {\n            get : function() {\n                return this._moveEnd;\n            }\n        },\n\n        /**\n         * Gets the event that will be raised when the camera has changed by <code>percentageChanged</code>.\n         * @memberof Camera.prototype\n         * @type {Event}\n         * @readonly\n         */\n        changed : {\n            get : function() {\n                return this._changed;\n            }\n        }\n    });\n\n    /**\n     * @private\n     */\n    Camera.prototype.update = function(mode) {\n        \n\n        var updateFrustum = false;\n        if (mode !== this._mode) {\n            this._mode = mode;\n            this._modeChanged = mode !== SceneMode.MORPHING;\n            updateFrustum = this._mode === SceneMode.SCENE2D;\n        }\n\n        if (updateFrustum) {\n            var frustum = this._max2Dfrustum = this.frustum.clone();\n\n            \n\n            var maxZoomOut = 2.0;\n            var ratio = frustum.top / frustum.right;\n            frustum.right = this._maxCoord.x * maxZoomOut;\n            frustum.left = -frustum.right;\n            frustum.top = ratio * frustum.right;\n            frustum.bottom = -frustum.top;\n        }\n\n        if (this._mode === SceneMode.SCENE2D) {\n            clampMove2D(this, this.position);\n        }\n    };\n\n    var setTransformPosition = new Cartesian3();\n    var setTransformUp = new Cartesian3();\n    var setTransformDirection = new Cartesian3();\n\n    Camera.prototype._setTransform = function(transform) {\n        var position = Cartesian3.clone(this.positionWC, setTransformPosition);\n        var up = Cartesian3.clone(this.upWC, setTransformUp);\n        var direction = Cartesian3.clone(this.directionWC, setTransformDirection);\n\n        Matrix4.clone(transform, this._transform);\n        this._transformChanged = true;\n        updateMembers(this);\n        var inverse = this._actualInvTransform;\n\n        Matrix4.multiplyByPoint(inverse, position, this.position);\n        Matrix4.multiplyByPointAsVector(inverse, direction, this.direction);\n        Matrix4.multiplyByPointAsVector(inverse, up, this.up);\n        Cartesian3.cross(this.direction, this.up, this.right);\n\n        updateMembers(this);\n    };\n\n    var scratchAdjustOrtghographicFrustumMousePosition = new Cartesian2();\n    var pickGlobeScratchRay = new Ray();\n    var scratchRayIntersection = new Cartesian3();\n    var scratchDepthIntersection = new Cartesian3();\n\n    Camera.prototype._adjustOrthographicFrustum = function(zooming) {\n        if (!(this.frustum instanceof OrthographicFrustum)) {\n            return;\n        }\n\n        if (!zooming && this._positionCartographic.height < 150000.0) {\n            return;\n        }\n\n        if (!Matrix4.equals(Matrix4.IDENTITY, this.transform)) {\n            this.frustum.width = Cartesian3.magnitude(this.position);\n            return;\n        }\n\n        var scene = this._scene;\n        var globe = scene.globe;\n        var rayIntersection;\n        var depthIntersection;\n\n        if (defined(globe)) {\n            var mousePosition = scratchAdjustOrtghographicFrustumMousePosition;\n            mousePosition.x = scene.drawingBufferWidth / 2.0;\n            mousePosition.y = scene.drawingBufferHeight / 2.0;\n\n            var ray = this.getPickRay(mousePosition, pickGlobeScratchRay);\n            rayIntersection = globe.pickWorldCoordinates(ray, scene, scratchRayIntersection);\n\n            if (scene.pickPositionSupported) {\n                depthIntersection = scene.pickPositionWorldCoordinates(mousePosition, scratchDepthIntersection);\n            }\n\n            if (defined(rayIntersection) && defined(depthIntersection)) {\n                var depthDistance = defined(depthIntersection) ? Cartesian3.distance(depthIntersection, this.positionWC) : Number.POSITIVE_INFINITY;\n                var rayDistance = defined(rayIntersection) ? Cartesian3.distance(rayIntersection, this.positionWC) : Number.POSITIVE_INFINITY;\n                this.frustum.width = Math.min(depthDistance, rayDistance);\n            } else if (defined(depthIntersection)) {\n                this.frustum.width = Cartesian3.distance(depthIntersection, this.positionWC);\n            } else if (defined(rayIntersection)) {\n                this.frustum.width = Cartesian3.distance(rayIntersection, this.positionWC);\n            }\n        }\n\n        if (!defined(globe) || (!defined(rayIntersection) && !defined(depthIntersection))) {\n            var distance = Math.max(this.positionCartographic.height, 0.0);\n            this.frustum.width = distance;\n        }\n    };\n\n    var scratchSetViewCartesian = new Cartesian3();\n    var scratchSetViewTransform1 = new Matrix4();\n    var scratchSetViewTransform2 = new Matrix4();\n    var scratchSetViewQuaternion = new Quaternion();\n    var scratchSetViewMatrix3 = new Matrix3();\n    var scratchSetViewCartographic = new Cartographic();\n\n    function setView3D(camera, position, hpr) {\n        var currentTransform = Matrix4.clone(camera.transform, scratchSetViewTransform1);\n        var localTransform = Transforms.eastNorthUpToFixedFrame(position, camera._projection.ellipsoid, scratchSetViewTransform2);\n        camera._setTransform(localTransform);\n\n        Cartesian3.clone(Cartesian3.ZERO, camera.position);\n        hpr.heading = hpr.heading - CesiumMath.PI_OVER_TWO;\n\n        var rotQuat = Quaternion.fromHeadingPitchRoll(hpr, scratchSetViewQuaternion);\n        var rotMat = Matrix3.fromQuaternion(rotQuat, scratchSetViewMatrix3);\n\n        Matrix3.getColumn(rotMat, 0, camera.direction);\n        Matrix3.getColumn(rotMat, 2, camera.up);\n        Cartesian3.cross(camera.direction, camera.up, camera.right);\n\n        camera._setTransform(currentTransform);\n\n        camera._adjustOrthographicFrustum(true);\n    }\n\n    function setViewCV(camera, position,hpr, convert) {\n        var currentTransform = Matrix4.clone(camera.transform, scratchSetViewTransform1);\n        camera._setTransform(Matrix4.IDENTITY);\n\n        if (!Cartesian3.equals(position, camera.positionWC)) {\n            if (convert) {\n                var projection = camera._projection;\n                var cartographic = projection.ellipsoid.cartesianToCartographic(position, scratchSetViewCartographic);\n                position = projection.project(cartographic, scratchSetViewCartesian);\n            }\n            Cartesian3.clone(position, camera.position);\n        }\n        hpr.heading = hpr.heading - CesiumMath.PI_OVER_TWO;\n\n        var rotQuat = Quaternion.fromHeadingPitchRoll(hpr, scratchSetViewQuaternion);\n        var rotMat = Matrix3.fromQuaternion(rotQuat, scratchSetViewMatrix3);\n\n        Matrix3.getColumn(rotMat, 0, camera.direction);\n        Matrix3.getColumn(rotMat, 2, camera.up);\n        Cartesian3.cross(camera.direction, camera.up, camera.right);\n\n        camera._setTransform(currentTransform);\n\n        camera._adjustOrthographicFrustum(true);\n    }\n\n    function setView2D(camera, position, hpr, convert) {\n        var currentTransform = Matrix4.clone(camera.transform, scratchSetViewTransform1);\n        camera._setTransform(Matrix4.IDENTITY);\n\n        if (!Cartesian3.equals(position, camera.positionWC)) {\n            if (convert) {\n                var projection = camera._projection;\n                var cartographic = projection.ellipsoid.cartesianToCartographic(position, scratchSetViewCartographic);\n                position = projection.project(cartographic, scratchSetViewCartesian);\n            }\n\n            Cartesian2.clone(position, camera.position);\n\n            var newLeft = -position.z * 0.5;\n            var newRight = -newLeft;\n\n            var frustum = camera.frustum;\n            if (newRight > newLeft) {\n                var ratio = frustum.top / frustum.right;\n                frustum.right = newRight;\n                frustum.left = newLeft;\n                frustum.top = frustum.right * ratio;\n                frustum.bottom = -frustum.top;\n            }\n        }\n\n        if (camera._scene.mapMode2D === MapMode2D.ROTATE) {\n            hpr.heading = hpr.heading  - CesiumMath.PI_OVER_TWO;\n            hpr.pitch = -CesiumMath.PI_OVER_TWO;\n            hpr.roll =  0.0;\n            var rotQuat = Quaternion.fromHeadingPitchRoll(hpr, scratchSetViewQuaternion);\n            var rotMat = Matrix3.fromQuaternion(rotQuat, scratchSetViewMatrix3);\n\n            Matrix3.getColumn(rotMat, 2, camera.up);\n            Cartesian3.cross(camera.direction, camera.up, camera.right);\n        }\n\n        camera._setTransform(currentTransform);\n    }\n\n    var scratchToHPRDirection = new Cartesian3();\n    var scratchToHPRUp = new Cartesian3();\n    var scratchToHPRRight = new Cartesian3();\n\n    function directionUpToHeadingPitchRoll(camera, position, orientation, result) {\n        var direction = Cartesian3.clone(orientation.direction, scratchToHPRDirection);\n        var up = Cartesian3.clone(orientation.up, scratchToHPRUp);\n\n        if (camera._scene.mode === SceneMode.SCENE3D) {\n            var ellipsoid = camera._projection.ellipsoid;\n            var transform = Transforms.eastNorthUpToFixedFrame(position, ellipsoid, scratchHPRMatrix1);\n            var invTransform = Matrix4.inverseTransformation(transform, scratchHPRMatrix2);\n\n            Matrix4.multiplyByPointAsVector(invTransform, direction, direction);\n            Matrix4.multiplyByPointAsVector(invTransform, up, up);\n        }\n\n        var right = Cartesian3.cross(direction, up, scratchToHPRRight);\n\n        result.heading = getHeading(direction, up);\n        result.pitch = getPitch(direction);\n        result.roll = getRoll(direction, up, right);\n\n        return result;\n    }\n\n    var scratchSetViewOptions = {\n        destination : undefined,\n        orientation : {\n            direction : undefined,\n            up : undefined,\n            heading : undefined,\n            pitch : undefined,\n            roll : undefined\n        },\n        convert : undefined,\n        endTransform : undefined\n    };\n\n    var scratchHpr = new HeadingPitchRoll();\n    /**\n     * Sets the camera position, orientation and transform.\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3|Rectangle} [options.destination] The final position of the camera in WGS84 (world) coordinates or a rectangle that would be visible from a top-down view.\n     * @param {Object} [options.orientation] An object that contains either direction and up properties or heading, pitch and roll properties. By default, the direction will point\n     * towards the center of the frame in 3D and in the negative z direction in Columbus view. The up direction will point towards local north in 3D and in the positive\n     * y direction in Columbus view. Orientation is not used in 2D when in infinite scrolling mode.\n     * @param {Matrix4} [options.endTransform] Transform matrix representing the reference frame of the camera.\n     * @param {Boolean} [options.convert] Whether to convert the destination from world coordinates to scene coordinates (only relevant when not using 3D). Defaults to <code>true</code>.\n     *\n     * @example\n     * // 1. Set position with a top-down view\n     * viewer.camera.setView({\n     *     destination : Cesium.Cartesian3.fromDegrees(-117.16, 32.71, 15000.0)\n     * });\n     *\n     * // 2 Set view with heading, pitch and roll\n     * viewer.camera.setView({\n     *     destination : cartesianPosition,\n     *     orientation: {\n     *         heading : Cesium.Math.toRadians(90.0), // east, default value is 0.0 (north)\n     *         pitch : Cesium.Math.toRadians(-90),    // default value (looking down)\n     *         roll : 0.0                             // default value\n     *     }\n     * });\n     *\n     * // 3. Change heading, pitch and roll with the camera position remaining the same.\n     * viewer.camera.setView({\n     *     orientation: {\n     *         heading : Cesium.Math.toRadians(90.0), // east, default value is 0.0 (north)\n     *         pitch : Cesium.Math.toRadians(-90),    // default value (looking down)\n     *         roll : 0.0                             // default value\n     *     }\n     * });\n     *\n     *\n     * // 4. View rectangle with a top-down view\n     * viewer.camera.setView({\n     *     destination : Cesium.Rectangle.fromDegrees(west, south, east, north)\n     * });\n     *\n     * // 5. Set position with an orientation using unit vectors.\n     * viewer.camera.setView({\n     *     destination : Cesium.Cartesian3.fromDegrees(-122.19, 46.25, 5000.0),\n     *     orientation : {\n     *         direction : new Cesium.Cartesian3(-0.04231243104240401, -0.20123236049443421, -0.97862924300734),\n     *         up : new Cesium.Cartesian3(-0.47934589305293746, -0.8553216253114552, 0.1966022179118339)\n     *     }\n     * });\n     */\n    Camera.prototype.setView = function(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n        var orientation = defaultValue(options.orientation, defaultValue.EMPTY_OBJECT);\n\n        var mode = this._mode;\n        if (mode === SceneMode.MORPHING) {\n            return;\n        }\n\n        if (defined(options.endTransform)) {\n            this._setTransform(options.endTransform);\n        }\n\n        var convert = defaultValue(options.convert, true);\n        var destination = defaultValue(options.destination, Cartesian3.clone(this.positionWC, scratchSetViewCartesian));\n        if (defined(destination) && defined(destination.west)) {\n            destination = this.getRectangleCameraCoordinates(destination, scratchSetViewCartesian);\n            convert = false;\n        }\n\n        if (defined(orientation.direction)) {\n            orientation = directionUpToHeadingPitchRoll(this, destination, orientation, scratchSetViewOptions.orientation);\n        }\n\n        scratchHpr.heading = defaultValue(orientation.heading, 0.0);\n        scratchHpr.pitch = defaultValue(orientation.pitch, -CesiumMath.PI_OVER_TWO);\n        scratchHpr.roll = defaultValue(orientation.roll, 0.0);\n\n        if (mode === SceneMode.SCENE3D) {\n            setView3D(this, destination, scratchHpr);\n        } else if (mode === SceneMode.SCENE2D) {\n            setView2D(this, destination, scratchHpr, convert);\n        } else {\n            setViewCV(this, destination, scratchHpr, convert);\n        }\n    };\n\n    var pitchScratch = new Cartesian3();\n    /**\n     * Fly the camera to the home view.  Use {@link Camera#.DEFAULT_VIEW_RECTANGLE} to set\n     * the default view for the 3D scene.  The home view for 2D and columbus view shows the\n     * entire map.\n     *\n     * @param {Number} [duration] The duration of the flight in seconds. If omitted, Cesium attempts to calculate an ideal duration based on the distance to be traveled by the flight. See {@link Camera#flyTo}\n     */\n    Camera.prototype.flyHome = function(duration) {\n        var mode = this._mode;\n\n        if (mode === SceneMode.MORPHING) {\n            this._scene.completeMorph();\n        }\n\n        if (mode === SceneMode.SCENE2D) {\n            this.flyTo({\n                destination : Camera.DEFAULT_VIEW_RECTANGLE,\n                duration : duration,\n                endTransform : Matrix4.IDENTITY\n            });\n        } else if (mode === SceneMode.SCENE3D) {\n            var destination = this.getRectangleCameraCoordinates(Camera.DEFAULT_VIEW_RECTANGLE);\n\n            var mag = Cartesian3.magnitude(destination);\n            mag += mag * Camera.DEFAULT_VIEW_FACTOR;\n            Cartesian3.normalize(destination, destination);\n            Cartesian3.multiplyByScalar(destination, mag, destination);\n\n            this.flyTo({\n                destination : destination,\n                duration : duration,\n                endTransform : Matrix4.IDENTITY\n            });\n        } else if (mode === SceneMode.COLUMBUS_VIEW) {\n            var maxRadii = this._projection.ellipsoid.maximumRadius;\n            var position = new Cartesian3(0.0, -1.0, 1.0);\n            position = Cartesian3.multiplyByScalar(Cartesian3.normalize(position, position), 5.0 * maxRadii, position);\n            this.flyTo({\n                destination : position,\n                duration : duration,\n                orientation : {\n                    heading : 0.0,\n                    pitch : -Math.acos(Cartesian3.normalize(position, pitchScratch).z),\n                    roll : 0.0\n                },\n                endTransform : Matrix4.IDENTITY,\n                convert : false\n            });\n        }\n    };\n\n    /**\n     * Transform a vector or point from world coordinates to the camera's reference frame.\n     *\n     * @param {Cartesian4} cartesian The vector or point to transform.\n     * @param {Cartesian4} [result] The object onto which to store the result.\n     * @returns {Cartesian4} The transformed vector or point.\n     */\n    Camera.prototype.worldToCameraCoordinates = function(cartesian, result) {\n        \n\n        if (!defined(result)) {\n            result = new Cartesian4();\n        }\n        updateMembers(this);\n        return Matrix4.multiplyByVector(this._actualInvTransform, cartesian, result);\n    };\n\n    /**\n     * Transform a point from world coordinates to the camera's reference frame.\n     *\n     * @param {Cartesian3} cartesian The point to transform.\n     * @param {Cartesian3} [result] The object onto which to store the result.\n     * @returns {Cartesian3} The transformed point.\n     */\n    Camera.prototype.worldToCameraCoordinatesPoint = function(cartesian, result) {\n        \n\n        if (!defined(result)) {\n            result = new Cartesian3();\n        }\n        updateMembers(this);\n        return Matrix4.multiplyByPoint(this._actualInvTransform, cartesian, result);\n    };\n\n    /**\n     * Transform a vector from world coordinates to the camera's reference frame.\n     *\n     * @param {Cartesian3} cartesian The vector to transform.\n     * @param {Cartesian3} [result] The object onto which to store the result.\n     * @returns {Cartesian3} The transformed vector.\n     */\n    Camera.prototype.worldToCameraCoordinatesVector = function(cartesian, result) {\n        \n\n        if (!defined(result)) {\n            result = new Cartesian3();\n        }\n        updateMembers(this);\n        return Matrix4.multiplyByPointAsVector(this._actualInvTransform, cartesian, result);\n    };\n\n    /**\n     * Transform a vector or point from the camera's reference frame to world coordinates.\n     *\n     * @param {Cartesian4} cartesian The vector or point to transform.\n     * @param {Cartesian4} [result] The object onto which to store the result.\n     * @returns {Cartesian4} The transformed vector or point.\n     */\n    Camera.prototype.cameraToWorldCoordinates = function(cartesian, result) {\n        \n\n        if (!defined(result)) {\n            result = new Cartesian4();\n        }\n        updateMembers(this);\n        return Matrix4.multiplyByVector(this._actualTransform, cartesian, result);\n    };\n\n    /**\n     * Transform a point from the camera's reference frame to world coordinates.\n     *\n     * @param {Cartesian3} cartesian The point to transform.\n     * @param {Cartesian3} [result] The object onto which to store the result.\n     * @returns {Cartesian3} The transformed point.\n     */\n    Camera.prototype.cameraToWorldCoordinatesPoint = function(cartesian, result) {\n        \n\n        if (!defined(result)) {\n            result = new Cartesian3();\n        }\n        updateMembers(this);\n        return Matrix4.multiplyByPoint(this._actualTransform, cartesian, result);\n    };\n\n    /**\n     * Transform a vector from the camera's reference frame to world coordinates.\n     *\n     * @param {Cartesian3} cartesian The vector to transform.\n     * @param {Cartesian3} [result] The object onto which to store the result.\n     * @returns {Cartesian3} The transformed vector.\n     */\n    Camera.prototype.cameraToWorldCoordinatesVector = function(cartesian, result) {\n        \n\n        if (!defined(result)) {\n            result = new Cartesian3();\n        }\n        updateMembers(this);\n        return Matrix4.multiplyByPointAsVector(this._actualTransform, cartesian, result);\n    };\n\n    function clampMove2D(camera, position) {\n        var rotatable2D = camera._scene.mapMode2D === MapMode2D.ROTATE;\n        var maxProjectedX = camera._maxCoord.x;\n        var maxProjectedY = camera._maxCoord.y;\n\n        var minX;\n        var maxX;\n        if (rotatable2D) {\n            maxX = maxProjectedX;\n            minX = -maxX;\n        } else {\n            maxX = position.x - maxProjectedX * 2.0;\n            minX = position.x + maxProjectedX * 2.0;\n        }\n\n        if (position.x > maxProjectedX) {\n            position.x = maxX;\n        }\n        if (position.x < -maxProjectedX) {\n            position.x = minX;\n        }\n\n        if (position.y > maxProjectedY) {\n            position.y = maxProjectedY;\n        }\n        if (position.y < -maxProjectedY) {\n            position.y = -maxProjectedY;\n        }\n    }\n\n    var moveScratch = new Cartesian3();\n    /**\n     * Translates the camera's position by <code>amount</code> along <code>direction</code>.\n     *\n     * @param {Cartesian3} direction The direction to move.\n     * @param {Number} [amount] The amount, in meters, to move. Defaults to <code>defaultMoveAmount</code>.\n     *\n     * @see Camera#moveBackward\n     * @see Camera#moveForward\n     * @see Camera#moveLeft\n     * @see Camera#moveRight\n     * @see Camera#moveUp\n     * @see Camera#moveDown\n     */\n    Camera.prototype.move = function(direction, amount) {\n        \n\n        var cameraPosition = this.position;\n        Cartesian3.multiplyByScalar(direction, amount, moveScratch);\n        Cartesian3.add(cameraPosition, moveScratch, cameraPosition);\n\n        if (this._mode === SceneMode.SCENE2D) {\n            clampMove2D(this, cameraPosition);\n        }\n        this._adjustOrthographicFrustum(true);\n    };\n\n    /**\n     * Translates the camera's position by <code>amount</code> along the camera's view vector.\n     * When in 2D mode, this will zoom in the camera instead of translating the camera's position.\n     *\n     * @param {Number} [amount] The amount, in meters, to move. Defaults to <code>defaultMoveAmount</code>.\n     *\n     * @see Camera#moveBackward\n     */\n    Camera.prototype.moveForward = function(amount) {\n        amount = defaultValue(amount, this.defaultMoveAmount);\n\n        if (this._mode === SceneMode.SCENE2D) {\n            // 2D mode\n            zoom2D(this, amount);\n        } else {\n            // 3D or Columbus view mode\n            this.move(this.direction, amount);\n        }\n    };\n\n    /**\n     * Translates the camera's position by <code>amount</code> along the opposite direction\n     * of the camera's view vector.\n     * When in 2D mode, this will zoom out the camera instead of translating the camera's position.\n     *\n     * @param {Number} [amount] The amount, in meters, to move. Defaults to <code>defaultMoveAmount</code>.\n     *\n     * @see Camera#moveForward\n     */\n    Camera.prototype.moveBackward = function(amount) {\n        amount = defaultValue(amount, this.defaultMoveAmount);\n\n        if (this._mode === SceneMode.SCENE2D) {\n            // 2D mode\n            zoom2D(this, -amount);\n        } else {\n            // 3D or Columbus view mode\n            this.move(this.direction, -amount);\n        }\n    };\n\n    /**\n     * Translates the camera's position by <code>amount</code> along the camera's up vector.\n     *\n     * @param {Number} [amount] The amount, in meters, to move. Defaults to <code>defaultMoveAmount</code>.\n     *\n     * @see Camera#moveDown\n     */\n    Camera.prototype.moveUp = function(amount) {\n        amount = defaultValue(amount, this.defaultMoveAmount);\n        this.move(this.up, amount);\n    };\n\n    /**\n     * Translates the camera's position by <code>amount</code> along the opposite direction\n     * of the camera's up vector.\n     *\n     * @param {Number} [amount] The amount, in meters, to move. Defaults to <code>defaultMoveAmount</code>.\n     *\n     * @see Camera#moveUp\n     */\n    Camera.prototype.moveDown = function(amount) {\n        amount = defaultValue(amount, this.defaultMoveAmount);\n        this.move(this.up, -amount);\n    };\n\n    /**\n     * Translates the camera's position by <code>amount</code> along the camera's right vector.\n     *\n     * @param {Number} [amount] The amount, in meters, to move. Defaults to <code>defaultMoveAmount</code>.\n     *\n     * @see Camera#moveLeft\n     */\n    Camera.prototype.moveRight = function(amount) {\n        amount = defaultValue(amount, this.defaultMoveAmount);\n        this.move(this.right, amount);\n    };\n\n    /**\n     * Translates the camera's position by <code>amount</code> along the opposite direction\n     * of the camera's right vector.\n     *\n     * @param {Number} [amount] The amount, in meters, to move. Defaults to <code>defaultMoveAmount</code>.\n     *\n     * @see Camera#moveRight\n     */\n    Camera.prototype.moveLeft = function(amount) {\n        amount = defaultValue(amount, this.defaultMoveAmount);\n        this.move(this.right, -amount);\n    };\n\n    /**\n     * Rotates the camera around its up vector by amount, in radians, in the opposite direction\n     * of its right vector if not in 2D mode.\n     *\n     * @param {Number} [amount] The amount, in radians, to rotate by. Defaults to <code>defaultLookAmount</code>.\n     *\n     * @see Camera#lookRight\n     */\n    Camera.prototype.lookLeft = function(amount) {\n        amount = defaultValue(amount, this.defaultLookAmount);\n\n        // only want view of map to change in 3D mode, 2D visual is incorrect when look changes\n        if (this._mode !== SceneMode.SCENE2D) {\n            this.look(this.up, -amount);\n        }\n    };\n\n    /**\n     * Rotates the camera around its up vector by amount, in radians, in the direction\n     * of its right vector if not in 2D mode.\n     *\n     * @param {Number} [amount] The amount, in radians, to rotate by. Defaults to <code>defaultLookAmount</code>.\n     *\n     * @see Camera#lookLeft\n     */\n    Camera.prototype.lookRight = function(amount) {\n        amount = defaultValue(amount, this.defaultLookAmount);\n\n        // only want view of map to change in 3D mode, 2D visual is incorrect when look changes\n        if (this._mode !== SceneMode.SCENE2D) {\n            this.look(this.up, amount);\n        }\n    };\n\n    /**\n     * Rotates the camera around its right vector by amount, in radians, in the direction\n     * of its up vector if not in 2D mode.\n     *\n     * @param {Number} [amount] The amount, in radians, to rotate by. Defaults to <code>defaultLookAmount</code>.\n     *\n     * @see Camera#lookDown\n     */\n    Camera.prototype.lookUp = function(amount) {\n        amount = defaultValue(amount, this.defaultLookAmount);\n\n        // only want view of map to change in 3D mode, 2D visual is incorrect when look changes\n        if (this._mode !== SceneMode.SCENE2D) {\n            this.look(this.right, -amount);\n        }\n    };\n\n    /**\n     * Rotates the camera around its right vector by amount, in radians, in the opposite direction\n     * of its up vector if not in 2D mode.\n     *\n     * @param {Number} [amount] The amount, in radians, to rotate by. Defaults to <code>defaultLookAmount</code>.\n     *\n     * @see Camera#lookUp\n     */\n    Camera.prototype.lookDown = function(amount) {\n        amount = defaultValue(amount, this.defaultLookAmount);\n\n        // only want view of map to change in 3D mode, 2D visual is incorrect when look changes\n        if (this._mode !== SceneMode.SCENE2D) {\n            this.look(this.right, amount);\n        }\n    };\n\n    var lookScratchQuaternion = new Quaternion();\n    var lookScratchMatrix = new Matrix3();\n    /**\n     * Rotate each of the camera's orientation vectors around <code>axis</code> by <code>angle</code>\n     *\n     * @param {Cartesian3} axis The axis to rotate around.\n     * @param {Number} [angle] The angle, in radians, to rotate by. Defaults to <code>defaultLookAmount</code>.\n     *\n     * @see Camera#lookUp\n     * @see Camera#lookDown\n     * @see Camera#lookLeft\n     * @see Camera#lookRight\n     */\n    Camera.prototype.look = function(axis, angle) {\n        \n\n        var turnAngle = defaultValue(angle, this.defaultLookAmount);\n        var quaternion = Quaternion.fromAxisAngle(axis, -turnAngle, lookScratchQuaternion);\n        var rotation = Matrix3.fromQuaternion(quaternion, lookScratchMatrix);\n\n        var direction = this.direction;\n        var up = this.up;\n        var right = this.right;\n\n        Matrix3.multiplyByVector(rotation, direction, direction);\n        Matrix3.multiplyByVector(rotation, up, up);\n        Matrix3.multiplyByVector(rotation, right, right);\n    };\n\n    /**\n     * Rotate the camera counter-clockwise around its direction vector by amount, in radians.\n     *\n     * @param {Number} [amount] The amount, in radians, to rotate by. Defaults to <code>defaultLookAmount</code>.\n     *\n     * @see Camera#twistRight\n     */\n    Camera.prototype.twistLeft = function(amount) {\n        amount = defaultValue(amount, this.defaultLookAmount);\n        this.look(this.direction, amount);\n    };\n\n    /**\n     * Rotate the camera clockwise around its direction vector by amount, in radians.\n     *\n     * @param {Number} [amount] The amount, in radians, to rotate by. Defaults to <code>defaultLookAmount</code>.\n     *\n     * @see Camera#twistLeft\n     */\n    Camera.prototype.twistRight = function(amount) {\n        amount = defaultValue(amount, this.defaultLookAmount);\n        this.look(this.direction, -amount);\n    };\n\n    var rotateScratchQuaternion = new Quaternion();\n    var rotateScratchMatrix = new Matrix3();\n    /**\n     * Rotates the camera around <code>axis</code> by <code>angle</code>. The distance\n     * of the camera's position to the center of the camera's reference frame remains the same.\n     *\n     * @param {Cartesian3} axis The axis to rotate around given in world coordinates.\n     * @param {Number} [angle] The angle, in radians, to rotate by. Defaults to <code>defaultRotateAmount</code>.\n     *\n     * @see Camera#rotateUp\n     * @see Camera#rotateDown\n     * @see Camera#rotateLeft\n     * @see Camera#rotateRight\n     */\n    Camera.prototype.rotate = function(axis, angle) {\n        \n\n        var turnAngle = defaultValue(angle, this.defaultRotateAmount);\n        var quaternion = Quaternion.fromAxisAngle(axis, -turnAngle, rotateScratchQuaternion);\n        var rotation = Matrix3.fromQuaternion(quaternion, rotateScratchMatrix);\n        Matrix3.multiplyByVector(rotation, this.position, this.position);\n        Matrix3.multiplyByVector(rotation, this.direction, this.direction);\n        Matrix3.multiplyByVector(rotation, this.up, this.up);\n        Cartesian3.cross(this.direction, this.up, this.right);\n        Cartesian3.cross(this.right, this.direction, this.up);\n\n        this._adjustOrthographicFrustum(false);\n    };\n\n    /**\n     * Rotates the camera around the center of the camera's reference frame by angle downwards.\n     *\n     * @param {Number} [angle] The angle, in radians, to rotate by. Defaults to <code>defaultRotateAmount</code>.\n     *\n     * @see Camera#rotateUp\n     * @see Camera#rotate\n     */\n    Camera.prototype.rotateDown = function(angle) {\n        angle = defaultValue(angle, this.defaultRotateAmount);\n        rotateVertical(this, angle);\n    };\n\n    /**\n     * Rotates the camera around the center of the camera's reference frame by angle upwards.\n     *\n     * @param {Number} [angle] The angle, in radians, to rotate by. Defaults to <code>defaultRotateAmount</code>.\n     *\n     * @see Camera#rotateDown\n     * @see Camera#rotate\n     */\n    Camera.prototype.rotateUp = function(angle) {\n        angle = defaultValue(angle, this.defaultRotateAmount);\n        rotateVertical(this, -angle);\n    };\n\n    var rotateVertScratchP = new Cartesian3();\n    var rotateVertScratchA = new Cartesian3();\n    var rotateVertScratchTan = new Cartesian3();\n    var rotateVertScratchNegate = new Cartesian3();\n    function rotateVertical(camera, angle) {\n        var position = camera.position;\n        if (defined(camera.constrainedAxis) && !Cartesian3.equalsEpsilon(camera.position, Cartesian3.ZERO, CesiumMath.EPSILON2)) {\n            var p = Cartesian3.normalize(position, rotateVertScratchP);\n            var northParallel = Cartesian3.equalsEpsilon(p, camera.constrainedAxis, CesiumMath.EPSILON2);\n            var southParallel = Cartesian3.equalsEpsilon(p, Cartesian3.negate(camera.constrainedAxis, rotateVertScratchNegate), CesiumMath.EPSILON2);\n            if ((!northParallel && !southParallel)) {\n                var constrainedAxis = Cartesian3.normalize(camera.constrainedAxis, rotateVertScratchA);\n\n                var dot = Cartesian3.dot(p, constrainedAxis);\n                var angleToAxis = CesiumMath.acosClamped(dot);\n                if (angle > 0 && angle > angleToAxis) {\n                    angle = angleToAxis - CesiumMath.EPSILON4;\n                }\n\n                dot = Cartesian3.dot(p, Cartesian3.negate(constrainedAxis, rotateVertScratchNegate));\n                angleToAxis = CesiumMath.acosClamped(dot);\n                if (angle < 0 && -angle > angleToAxis) {\n                    angle = -angleToAxis + CesiumMath.EPSILON4;\n                }\n\n                var tangent = Cartesian3.cross(constrainedAxis, p, rotateVertScratchTan);\n                camera.rotate(tangent, angle);\n            } else if ((northParallel && angle < 0) || (southParallel && angle > 0)) {\n                camera.rotate(camera.right, angle);\n            }\n        } else {\n            camera.rotate(camera.right, angle);\n        }\n    }\n\n    /**\n     * Rotates the camera around the center of the camera's reference frame by angle to the right.\n     *\n     * @param {Number} [angle] The angle, in radians, to rotate by. Defaults to <code>defaultRotateAmount</code>.\n     *\n     * @see Camera#rotateLeft\n     * @see Camera#rotate\n     */\n    Camera.prototype.rotateRight = function(angle) {\n        angle = defaultValue(angle, this.defaultRotateAmount);\n        rotateHorizontal(this, -angle);\n    };\n\n    /**\n     * Rotates the camera around the center of the camera's reference frame by angle to the left.\n     *\n     * @param {Number} [angle] The angle, in radians, to rotate by. Defaults to <code>defaultRotateAmount</code>.\n     *\n     * @see Camera#rotateRight\n     * @see Camera#rotate\n     */\n    Camera.prototype.rotateLeft = function(angle) {\n        angle = defaultValue(angle, this.defaultRotateAmount);\n        rotateHorizontal(this, angle);\n    };\n\n    function rotateHorizontal(camera, angle) {\n        if (defined(camera.constrainedAxis)) {\n            camera.rotate(camera.constrainedAxis, angle);\n        } else {\n            camera.rotate(camera.up, angle);\n        }\n    }\n\n    function zoom2D(camera, amount) {\n        var frustum = camera.frustum;\n\n        \n\n        var ratio;\n        amount = amount * 0.5;\n\n        if((Math.abs(frustum.top) + Math.abs(frustum.bottom)) > (Math.abs(frustum.left) + Math.abs(frustum.right))) {\n            var newTop = frustum.top - amount;\n            var newBottom = frustum.bottom + amount;\n\n            var maxBottom = camera._maxCoord.y;\n            if (camera._scene.mapMode2D === MapMode2D.ROTATE) {\n                maxBottom *= camera.maximumZoomFactor;\n            }\n\n            if (newBottom > maxBottom) {\n                newBottom = maxBottom;\n                newTop = -maxBottom;\n            }\n\n            if (newTop <= newBottom) {\n                newTop = 1.0;\n                newBottom = -1.0;\n            }\n\n            ratio = frustum.right / frustum.top;\n            frustum.top = newTop;\n            frustum.bottom = newBottom;\n            frustum.right = frustum.top * ratio;\n            frustum.left = -frustum.right;\n        } else {\n            var newRight = frustum.right - amount;\n            var newLeft = frustum.left + amount;\n\n            var maxRight = camera._maxCoord.x;\n            if (camera._scene.mapMode2D === MapMode2D.ROTATE) {\n                maxRight *= camera.maximumZoomFactor;\n            }\n\n            if (newRight > maxRight) {\n                newRight = maxRight;\n                newLeft = -maxRight;\n            }\n\n            if (newRight <= newLeft) {\n                newRight = 1.0;\n                newLeft = -1.0;\n            }\n            ratio = frustum.top / frustum.right;\n            frustum.right = newRight;\n            frustum.left = newLeft;\n            frustum.top = frustum.right * ratio;\n            frustum.bottom = -frustum.top;\n        }\n    }\n\n    function zoom3D(camera, amount) {\n        camera.move(camera.direction, amount);\n    }\n\n    /**\n     * Zooms <code>amount</code> along the camera's view vector.\n     *\n     * @param {Number} [amount] The amount to move. Defaults to <code>defaultZoomAmount</code>.\n     *\n     * @see Camera#zoomOut\n     */\n    Camera.prototype.zoomIn = function(amount) {\n        amount = defaultValue(amount, this.defaultZoomAmount);\n        if (this._mode === SceneMode.SCENE2D) {\n            zoom2D(this, amount);\n        } else {\n            zoom3D(this, amount);\n        }\n    };\n\n    /**\n     * Zooms <code>amount</code> along the opposite direction of\n     * the camera's view vector.\n     *\n     * @param {Number} [amount] The amount to move. Defaults to <code>defaultZoomAmount</code>.\n     *\n     * @see Camera#zoomIn\n     */\n    Camera.prototype.zoomOut = function(amount) {\n        amount = defaultValue(amount, this.defaultZoomAmount);\n        if (this._mode === SceneMode.SCENE2D) {\n            zoom2D(this, -amount);\n        } else {\n            zoom3D(this, -amount);\n        }\n    };\n\n    /**\n     * Gets the magnitude of the camera position. In 3D, this is the vector magnitude. In 2D and\n     * Columbus view, this is the distance to the map.\n     *\n     * @returns {Number} The magnitude of the position.\n     */\n    Camera.prototype.getMagnitude = function() {\n        if (this._mode === SceneMode.SCENE3D) {\n            return Cartesian3.magnitude(this.position);\n        } else if (this._mode === SceneMode.COLUMBUS_VIEW) {\n            return Math.abs(this.position.z);\n        } else if (this._mode === SceneMode.SCENE2D) {\n            return Math.max(this.frustum.right - this.frustum.left, this.frustum.top - this.frustum.bottom);\n        }\n    };\n\n    var scratchLookAtMatrix4 = new Matrix4();\n\n    /**\n     * Sets the camera position and orientation using a target and offset. The target must be given in\n     * world coordinates. The offset can be either a cartesian or heading/pitch/range in the local east-north-up reference frame centered at the target.\n     * If the offset is a cartesian, then it is an offset from the center of the reference frame defined by the transformation matrix. If the offset\n     * is heading/pitch/range, then the heading and the pitch angles are defined in the reference frame defined by the transformation matrix.\n     * The heading is the angle from y axis and increasing towards the x axis. Pitch is the rotation from the xy-plane. Positive pitch\n     * angles are below the plane. Negative pitch angles are above the plane. The range is the distance from the center.\n     *\n     * In 2D, there must be a top down view. The camera will be placed above the target looking down. The height above the\n     * target will be the magnitude of the offset. The heading will be determined from the offset. If the heading cannot be\n     * determined from the offset, the heading will be north.\n     *\n     * @param {Cartesian3} target The target position in world coordinates.\n     * @param {Cartesian3|HeadingPitchRange} offset The offset from the target in the local east-north-up reference frame centered at the target.\n     *\n     * @exception {DeveloperError} lookAt is not supported while morphing.\n     *\n     * @example\n     * // 1. Using a cartesian offset\n     * var center = Cesium.Cartesian3.fromDegrees(-98.0, 40.0);\n     * viewer.camera.lookAt(center, new Cesium.Cartesian3(0.0, -4790000.0, 3930000.0));\n     *\n     * // 2. Using a HeadingPitchRange offset\n     * var center = Cesium.Cartesian3.fromDegrees(-72.0, 40.0);\n     * var heading = Cesium.Math.toRadians(50.0);\n     * var pitch = Cesium.Math.toRadians(-20.0);\n     * var range = 5000.0;\n     * viewer.camera.lookAt(center, new Cesium.HeadingPitchRange(heading, pitch, range));\n     */\n    Camera.prototype.lookAt = function(target, offset) {\n        \n\n        var transform = Transforms.eastNorthUpToFixedFrame(target, Ellipsoid.WGS84, scratchLookAtMatrix4);\n        this.lookAtTransform(transform, offset);\n    };\n\n    var scratchLookAtHeadingPitchRangeOffset = new Cartesian3();\n    var scratchLookAtHeadingPitchRangeQuaternion1 = new Quaternion();\n    var scratchLookAtHeadingPitchRangeQuaternion2 = new Quaternion();\n    var scratchHeadingPitchRangeMatrix3 = new Matrix3();\n\n    function offsetFromHeadingPitchRange(heading, pitch, range) {\n        pitch = CesiumMath.clamp(pitch, -CesiumMath.PI_OVER_TWO, CesiumMath.PI_OVER_TWO);\n        heading = CesiumMath.zeroToTwoPi(heading) - CesiumMath.PI_OVER_TWO;\n\n        var pitchQuat = Quaternion.fromAxisAngle(Cartesian3.UNIT_Y, -pitch, scratchLookAtHeadingPitchRangeQuaternion1);\n        var headingQuat = Quaternion.fromAxisAngle(Cartesian3.UNIT_Z, -heading, scratchLookAtHeadingPitchRangeQuaternion2);\n        var rotQuat = Quaternion.multiply(headingQuat, pitchQuat, headingQuat);\n        var rotMatrix = Matrix3.fromQuaternion(rotQuat, scratchHeadingPitchRangeMatrix3);\n\n        var offset = Cartesian3.clone(Cartesian3.UNIT_X, scratchLookAtHeadingPitchRangeOffset);\n        Matrix3.multiplyByVector(rotMatrix, offset, offset);\n        Cartesian3.negate(offset, offset);\n        Cartesian3.multiplyByScalar(offset, range, offset);\n        return offset;\n    }\n\n    /**\n     * Sets the camera position and orientation using a target and transformation matrix. The offset can be either a cartesian or heading/pitch/range.\n     * If the offset is a cartesian, then it is an offset from the center of the reference frame defined by the transformation matrix. If the offset\n     * is heading/pitch/range, then the heading and the pitch angles are defined in the reference frame defined by the transformation matrix.\n     * The heading is the angle from y axis and increasing towards the x axis. Pitch is the rotation from the xy-plane. Positive pitch\n     * angles are below the plane. Negative pitch angles are above the plane. The range is the distance from the center.\n     *\n     * In 2D, there must be a top down view. The camera will be placed above the center of the reference frame. The height above the\n     * target will be the magnitude of the offset. The heading will be determined from the offset. If the heading cannot be\n     * determined from the offset, the heading will be north.\n     *\n     * @param {Matrix4} transform The transformation matrix defining the reference frame.\n     * @param {Cartesian3|HeadingPitchRange} [offset] The offset from the target in a reference frame centered at the target.\n     *\n     * @exception {DeveloperError} lookAtTransform is not supported while morphing.\n     *\n     * @example\n     * // 1. Using a cartesian offset\n     * var transform = Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(-98.0, 40.0));\n     * viewer.camera.lookAtTransform(transform, new Cesium.Cartesian3(0.0, -4790000.0, 3930000.0));\n     *\n     * // 2. Using a HeadingPitchRange offset\n     * var transform = Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(-72.0, 40.0));\n     * var heading = Cesium.Math.toRadians(50.0);\n     * var pitch = Cesium.Math.toRadians(-20.0);\n     * var range = 5000.0;\n     * viewer.camera.lookAtTransform(transform, new Cesium.HeadingPitchRange(heading, pitch, range));\n     */\n    Camera.prototype.lookAtTransform = function(transform, offset) {\n        \n\n        this._setTransform(transform);\n        if (!defined(offset)) {\n            return;\n        }\n\n        var cartesianOffset;\n        if (defined(offset.heading)) {\n            cartesianOffset = offsetFromHeadingPitchRange(offset.heading, offset.pitch, offset.range);\n        } else {\n            cartesianOffset = offset;\n        }\n\n        if (this._mode === SceneMode.SCENE2D) {\n            Cartesian2.clone(Cartesian2.ZERO, this.position);\n\n            Cartesian3.negate(cartesianOffset, this.up);\n            this.up.z = 0.0;\n\n            if (Cartesian3.magnitudeSquared(this.up) < CesiumMath.EPSILON10) {\n                Cartesian3.clone(Cartesian3.UNIT_Y, this.up);\n            }\n\n            Cartesian3.normalize(this.up, this.up);\n\n            this._setTransform(Matrix4.IDENTITY);\n\n            Cartesian3.negate(Cartesian3.UNIT_Z, this.direction);\n            Cartesian3.cross(this.direction, this.up, this.right);\n            Cartesian3.normalize(this.right, this.right);\n\n            var frustum = this.frustum;\n            var ratio = frustum.top / frustum.right;\n            frustum.right = Cartesian3.magnitude(cartesianOffset) * 0.5;\n            frustum.left = -frustum.right;\n            frustum.top = ratio * frustum.right;\n            frustum.bottom = -frustum.top;\n\n            this._setTransform(transform);\n\n            return;\n        }\n\n        Cartesian3.clone(cartesianOffset, this.position);\n        Cartesian3.negate(this.position, this.direction);\n        Cartesian3.normalize(this.direction, this.direction);\n        Cartesian3.cross(this.direction, Cartesian3.UNIT_Z, this.right);\n\n        if (Cartesian3.magnitudeSquared(this.right) < CesiumMath.EPSILON10) {\n            Cartesian3.clone(Cartesian3.UNIT_X, this.right);\n        }\n\n        Cartesian3.normalize(this.right, this.right);\n        Cartesian3.cross(this.right, this.direction, this.up);\n        Cartesian3.normalize(this.up, this.up);\n\n        this._adjustOrthographicFrustum(true);\n    };\n\n    var viewRectangle3DCartographic1 = new Cartographic();\n    var viewRectangle3DCartographic2 = new Cartographic();\n    var viewRectangle3DNorthEast = new Cartesian3();\n    var viewRectangle3DSouthWest = new Cartesian3();\n    var viewRectangle3DNorthWest = new Cartesian3();\n    var viewRectangle3DSouthEast = new Cartesian3();\n    var viewRectangle3DNorthCenter = new Cartesian3();\n    var viewRectangle3DSouthCenter = new Cartesian3();\n    var viewRectangle3DCenter = new Cartesian3();\n    var viewRectangle3DEquator = new Cartesian3();\n    var defaultRF = {\n        direction : new Cartesian3(),\n        right : new Cartesian3(),\n        up : new Cartesian3()\n    };\n    var viewRectangle3DEllipsoidGeodesic;\n\n    function computeD(direction, upOrRight, corner, tanThetaOrPhi) {\n        var opposite = Math.abs(Cartesian3.dot(upOrRight, corner));\n        return opposite / tanThetaOrPhi - Cartesian3.dot(direction, corner);\n    }\n\n    function rectangleCameraPosition3D(camera, rectangle, result, updateCamera) {\n        var ellipsoid = camera._projection.ellipsoid;\n        var cameraRF = updateCamera ? camera : defaultRF;\n\n        var north = rectangle.north;\n        var south = rectangle.south;\n        var east = rectangle.east;\n        var west = rectangle.west;\n\n        // If we go across the International Date Line\n        if (west > east) {\n            east += CesiumMath.TWO_PI;\n        }\n\n        // Find the midpoint latitude.\n        //\n        // EllipsoidGeodesic will fail if the north and south edges are very close to being on opposite sides of the ellipsoid.\n        // Ideally we'd just call EllipsoidGeodesic.setEndPoints and let it throw when it detects this case, but sadly it doesn't\n        // even look for this case in optimized builds, so we have to test for it here instead.\n        //\n        // Fortunately, this case can only happen (here) when north is very close to the north pole and south is very close to the south pole,\n        // so handle it just by using 0 latitude as the center.  It's certainliy possible to use a smaller tolerance\n        // than one degree here, but one degree is safe and putting the center at 0 latitude should be good enough for any\n        // rectangle that spans 178+ of the 180 degrees of latitude.\n        var longitude = (west + east) * 0.5;\n        var latitude;\n        if (south < -CesiumMath.PI_OVER_TWO + CesiumMath.RADIANS_PER_DEGREE && north > CesiumMath.PI_OVER_TWO - CesiumMath.RADIANS_PER_DEGREE) {\n            latitude = 0.0;\n        } else {\n            var northCartographic = viewRectangle3DCartographic1;\n            northCartographic.longitude = longitude;\n            northCartographic.latitude = north;\n            northCartographic.height = 0.0;\n\n            var southCartographic = viewRectangle3DCartographic2;\n            southCartographic.longitude = longitude;\n            southCartographic.latitude = south;\n            southCartographic.height = 0.0;\n\n            var ellipsoidGeodesic = viewRectangle3DEllipsoidGeodesic;\n            if (!defined(ellipsoidGeodesic) || ellipsoidGeodesic.ellipsoid !== ellipsoid) {\n                viewRectangle3DEllipsoidGeodesic = ellipsoidGeodesic = new EllipsoidGeodesic(undefined, undefined, ellipsoid);\n            }\n\n            ellipsoidGeodesic.setEndPoints(northCartographic, southCartographic);\n            latitude = ellipsoidGeodesic.interpolateUsingFraction(0.5, viewRectangle3DCartographic1).latitude;\n        }\n\n        var centerCartographic = viewRectangle3DCartographic1;\n        centerCartographic.longitude = longitude;\n        centerCartographic.latitude = latitude;\n        centerCartographic.height = 0.0;\n\n        var center = ellipsoid.cartographicToCartesian(centerCartographic, viewRectangle3DCenter);\n\n        var cart = viewRectangle3DCartographic1;\n        cart.longitude = east;\n        cart.latitude = north;\n        var northEast = ellipsoid.cartographicToCartesian(cart, viewRectangle3DNorthEast);\n        cart.longitude = west;\n        var northWest = ellipsoid.cartographicToCartesian(cart, viewRectangle3DNorthWest);\n        cart.longitude = longitude;\n        var northCenter = ellipsoid.cartographicToCartesian(cart, viewRectangle3DNorthCenter);\n        cart.latitude = south;\n        var southCenter = ellipsoid.cartographicToCartesian(cart, viewRectangle3DSouthCenter);\n        cart.longitude = east;\n        var southEast = ellipsoid.cartographicToCartesian(cart, viewRectangle3DSouthEast);\n        cart.longitude = west;\n        var southWest = ellipsoid.cartographicToCartesian(cart, viewRectangle3DSouthWest);\n\n        Cartesian3.subtract(northWest, center, northWest);\n        Cartesian3.subtract(southEast, center, southEast);\n        Cartesian3.subtract(northEast, center, northEast);\n        Cartesian3.subtract(southWest, center, southWest);\n        Cartesian3.subtract(northCenter, center, northCenter);\n        Cartesian3.subtract(southCenter, center, southCenter);\n\n        var direction = ellipsoid.geodeticSurfaceNormal(center, cameraRF.direction);\n        Cartesian3.negate(direction, direction);\n        var right = Cartesian3.cross(direction, Cartesian3.UNIT_Z, cameraRF.right);\n        Cartesian3.normalize(right, right);\n        var up = Cartesian3.cross(right, direction, cameraRF.up);\n\n        var d;\n        if (camera.frustum instanceof OrthographicFrustum) {\n            var width = Math.max(Cartesian3.distance(northEast, northWest), Cartesian3.distance(southEast, southWest));\n            var height = Math.max(Cartesian3.distance(northEast, southEast), Cartesian3.distance(northWest, southWest));\n\n            var rightScalar;\n            var topScalar;\n            var ratio = camera.frustum._offCenterFrustum.right / camera.frustum._offCenterFrustum.top;\n            var heightRatio = height * ratio;\n            if (width > heightRatio) {\n                rightScalar = width;\n                topScalar = rightScalar / ratio;\n            } else {\n                topScalar = height;\n                rightScalar = heightRatio;\n            }\n\n            d = Math.max(rightScalar, topScalar);\n        } else {\n            var tanPhi = Math.tan(camera.frustum.fovy * 0.5);\n            var tanTheta = camera.frustum.aspectRatio * tanPhi;\n\n            d = Math.max(\n                computeD(direction, up, northWest, tanPhi),\n                computeD(direction, up, southEast, tanPhi),\n                computeD(direction, up, northEast, tanPhi),\n                computeD(direction, up, southWest, tanPhi),\n                computeD(direction, up, northCenter, tanPhi),\n                computeD(direction, up, southCenter, tanPhi),\n                computeD(direction, right, northWest, tanTheta),\n                computeD(direction, right, southEast, tanTheta),\n                computeD(direction, right, northEast, tanTheta),\n                computeD(direction, right, southWest, tanTheta),\n                computeD(direction, right, northCenter, tanTheta),\n                computeD(direction, right, southCenter, tanTheta));\n\n            // If the rectangle crosses the equator, compute D at the equator, too, because that's the\n            // widest part of the rectangle when projected onto the globe.\n            if (south < 0 && north > 0) {\n                var equatorCartographic = viewRectangle3DCartographic1;\n                equatorCartographic.longitude = west;\n                equatorCartographic.latitude = 0.0;\n                equatorCartographic.height = 0.0;\n                var equatorPosition = ellipsoid.cartographicToCartesian(equatorCartographic, viewRectangle3DEquator);\n                Cartesian3.subtract(equatorPosition, center, equatorPosition);\n                d = Math.max(d, computeD(direction, up, equatorPosition, tanPhi), computeD(direction, right, equatorPosition, tanTheta));\n\n                equatorCartographic.longitude = east;\n                equatorPosition = ellipsoid.cartographicToCartesian(equatorCartographic, viewRectangle3DEquator);\n                Cartesian3.subtract(equatorPosition, center, equatorPosition);\n                d = Math.max(d, computeD(direction, up, equatorPosition, tanPhi), computeD(direction, right, equatorPosition, tanTheta));\n            }\n        }\n\n        return Cartesian3.add(center, Cartesian3.multiplyByScalar(direction, -d, viewRectangle3DEquator), result);\n    }\n\n    var viewRectangleCVCartographic = new Cartographic();\n    var viewRectangleCVNorthEast = new Cartesian3();\n    var viewRectangleCVSouthWest = new Cartesian3();\n    function rectangleCameraPositionColumbusView(camera, rectangle, result) {\n        var projection = camera._projection;\n        if (rectangle.west > rectangle.east) {\n            rectangle = Rectangle.MAX_VALUE;\n        }\n        var transform = camera._actualTransform;\n        var invTransform = camera._actualInvTransform;\n\n        var cart = viewRectangleCVCartographic;\n        cart.longitude = rectangle.east;\n        cart.latitude = rectangle.north;\n        var northEast = projection.project(cart, viewRectangleCVNorthEast);\n        Matrix4.multiplyByPoint(transform, northEast, northEast);\n        Matrix4.multiplyByPoint(invTransform, northEast, northEast);\n\n        cart.longitude = rectangle.west;\n        cart.latitude = rectangle.south;\n        var southWest = projection.project(cart, viewRectangleCVSouthWest);\n        Matrix4.multiplyByPoint(transform, southWest, southWest);\n        Matrix4.multiplyByPoint(invTransform, southWest, southWest);\n\n        result.x = (northEast.x - southWest.x) * 0.5 + southWest.x;\n        result.y = (northEast.y - southWest.y) * 0.5 + southWest.y;\n\n        if (defined(camera.frustum.fovy)) {\n            var tanPhi = Math.tan(camera.frustum.fovy * 0.5);\n            var tanTheta = camera.frustum.aspectRatio * tanPhi;\n            result.z = Math.max((northEast.x - southWest.x) / tanTheta, (northEast.y - southWest.y) / tanPhi) * 0.5;\n        } else {\n            var width = northEast.x - southWest.x;\n            var height = northEast.y - southWest.y;\n            result.z = Math.max(width, height);\n        }\n\n        return result;\n    }\n\n    var viewRectangle2DCartographic = new Cartographic();\n    var viewRectangle2DNorthEast = new Cartesian3();\n    var viewRectangle2DSouthWest = new Cartesian3();\n    function rectangleCameraPosition2D(camera, rectangle, result) {\n        var projection = camera._projection;\n\n        // Account for the rectangle crossing the International Date Line in 2D mode\n        var east = rectangle.east;\n        if (rectangle.west > rectangle.east) {\n            if(camera._scene.mapMode2D === MapMode2D.INFINITE_SCROLL) {\n                east += CesiumMath.TWO_PI;\n            } else {\n                rectangle = Rectangle.MAX_VALUE;\n                east = rectangle.east;\n            }\n        }\n\n        var cart = viewRectangle2DCartographic;\n        cart.longitude = east;\n        cart.latitude = rectangle.north;\n        var northEast = projection.project(cart, viewRectangle2DNorthEast);\n        cart.longitude = rectangle.west;\n        cart.latitude = rectangle.south;\n        var southWest = projection.project(cart, viewRectangle2DSouthWest);\n\n        var width = Math.abs(northEast.x - southWest.x) * 0.5;\n        var height = Math.abs(northEast.y - southWest.y) * 0.5;\n\n        var right, top;\n        var ratio = camera.frustum.right / camera.frustum.top;\n        var heightRatio = height * ratio;\n        if (width > heightRatio) {\n            right = width;\n            top = right / ratio;\n        } else {\n            top = height;\n            right = heightRatio;\n        }\n\n        height = Math.max(2.0 * right, 2.0 * top);\n\n        result.x = (northEast.x - southWest.x) * 0.5 + southWest.x;\n        result.y = (northEast.y - southWest.y) * 0.5 + southWest.y;\n\n        cart = projection.unproject(result, cart);\n        cart.height = height;\n        result = projection.project(cart, result);\n\n        return result;\n    }\n\n    /**\n     * Get the camera position needed to view a rectangle on an ellipsoid or map\n     *\n     * @param {Rectangle} rectangle The rectangle to view.\n     * @param {Cartesian3} [result] The camera position needed to view the rectangle\n     * @returns {Cartesian3} The camera position needed to view the rectangle\n     */\n    Camera.prototype.getRectangleCameraCoordinates = function(rectangle, result) {\n        \n        var mode = this._mode;\n\n        if (!defined(result)) {\n            result = new Cartesian3();\n        }\n\n        if (mode === SceneMode.SCENE3D) {\n            return rectangleCameraPosition3D(this, rectangle, result);\n        } else if (mode === SceneMode.COLUMBUS_VIEW) {\n            return rectangleCameraPositionColumbusView(this, rectangle, result);\n        } else if (mode === SceneMode.SCENE2D) {\n            return rectangleCameraPosition2D(this, rectangle, result);\n        }\n\n        return undefined;\n    };\n\n    var pickEllipsoid3DRay = new Ray();\n    function pickEllipsoid3D(camera, windowPosition, ellipsoid, result) {\n        ellipsoid = defaultValue(ellipsoid, Ellipsoid.WGS84);\n        var ray = camera.getPickRay(windowPosition, pickEllipsoid3DRay);\n        var intersection = IntersectionTests.rayEllipsoid(ray, ellipsoid);\n        if (!intersection) {\n            return undefined;\n        }\n\n        var t = intersection.start > 0.0 ? intersection.start : intersection.stop;\n        return Ray.getPoint(ray, t, result);\n    }\n\n    var pickEllipsoid2DRay = new Ray();\n    function pickMap2D(camera, windowPosition, projection, result) {\n        var ray = camera.getPickRay(windowPosition, pickEllipsoid2DRay);\n        var position = ray.origin;\n        position = Cartesian3.fromElements(position.y, position.z, 0.0, position);\n        var cart = projection.unproject(position);\n\n        if (cart.latitude < -CesiumMath.PI_OVER_TWO || cart.latitude > CesiumMath.PI_OVER_TWO) {\n            return undefined;\n        }\n\n        return projection.ellipsoid.cartographicToCartesian(cart, result);\n    }\n\n    var pickEllipsoidCVRay = new Ray();\n    function pickMapColumbusView(camera, windowPosition, projection, result) {\n        var ray = camera.getPickRay(windowPosition, pickEllipsoidCVRay);\n        var scalar = -ray.origin.x / ray.direction.x;\n        Ray.getPoint(ray, scalar, result);\n\n        var cart = projection.unproject(new Cartesian3(result.y, result.z, 0.0));\n\n        if (cart.latitude < -CesiumMath.PI_OVER_TWO || cart.latitude > CesiumMath.PI_OVER_TWO ||\n            cart.longitude < -Math.PI || cart.longitude > Math.PI) {\n            return undefined;\n        }\n\n        return projection.ellipsoid.cartographicToCartesian(cart, result);\n    }\n\n    /**\n     * Pick an ellipsoid or map.\n     *\n     * @param {Cartesian2} windowPosition The x and y coordinates of a pixel.\n     * @param {Ellipsoid} [ellipsoid=Ellipsoid.WGS84] The ellipsoid to pick.\n     * @param {Cartesian3} [result] The object onto which to store the result.\n     * @returns {Cartesian3} If the ellipsoid or map was picked, returns the point on the surface of the ellipsoid or map\n     * in world coordinates. If the ellipsoid or map was not picked, returns undefined.\n     *\n     * @example\n     * var canvas = viewer.scene.canvas;\n     * var center = new Cesium.Cartesian2(canvas.clientWidth / 2.0, canvas.clientHeight / 2.0);\n     * var ellipsoid = viewer.scene.globe.ellipsoid;\n     * var result = viewer.camera.pickEllipsoid(center, ellipsoid);\n     */\n    Camera.prototype.pickEllipsoid = function(windowPosition, ellipsoid, result) {\n        \n\n        var canvas = this._scene.canvas;\n        if (canvas.clientWidth === 0 || canvas.clientHeight === 0) {\n            return undefined;\n        }\n\n        if (!defined(result)) {\n            result = new Cartesian3();\n        }\n\n        ellipsoid = defaultValue(ellipsoid, Ellipsoid.WGS84);\n\n        if (this._mode === SceneMode.SCENE3D) {\n            result = pickEllipsoid3D(this, windowPosition, ellipsoid, result);\n        } else if (this._mode === SceneMode.SCENE2D) {\n            result = pickMap2D(this, windowPosition, this._projection, result);\n        } else if (this._mode === SceneMode.COLUMBUS_VIEW) {\n            result = pickMapColumbusView(this, windowPosition, this._projection, result);\n        } else {\n            return undefined;\n        }\n\n        return result;\n    };\n\n    var pickPerspCenter = new Cartesian3();\n    var pickPerspXDir = new Cartesian3();\n    var pickPerspYDir = new Cartesian3();\n    function getPickRayPerspective(camera, windowPosition, result) {\n        var canvas = camera._scene.canvas;\n        var width = canvas.clientWidth;\n        var height = canvas.clientHeight;\n\n        var tanPhi = Math.tan(camera.frustum.fovy * 0.5);\n        var tanTheta = camera.frustum.aspectRatio * tanPhi;\n        var near = camera.frustum.near;\n\n        var x = (2.0 / width) * windowPosition.x - 1.0;\n        var y = (2.0 / height) * (height - windowPosition.y) - 1.0;\n\n        var position = camera.positionWC;\n        Cartesian3.clone(position, result.origin);\n\n        var nearCenter = Cartesian3.multiplyByScalar(camera.directionWC, near, pickPerspCenter);\n        Cartesian3.add(position, nearCenter, nearCenter);\n        var xDir = Cartesian3.multiplyByScalar(camera.rightWC, x * near * tanTheta, pickPerspXDir);\n        var yDir = Cartesian3.multiplyByScalar(camera.upWC, y * near * tanPhi, pickPerspYDir);\n        var direction = Cartesian3.add(nearCenter, xDir, result.direction);\n        Cartesian3.add(direction, yDir, direction);\n        Cartesian3.subtract(direction, position, direction);\n        Cartesian3.normalize(direction, direction);\n\n        return result;\n    }\n\n    var scratchDirection = new Cartesian3();\n\n    function getPickRayOrthographic(camera, windowPosition, result) {\n        var canvas = camera._scene.canvas;\n        var width = canvas.clientWidth;\n        var height = canvas.clientHeight;\n\n        var frustum = camera.frustum;\n        if (defined(frustum._offCenterFrustum)) {\n            frustum = frustum._offCenterFrustum;\n        }\n        var x = (2.0 / width) * windowPosition.x - 1.0;\n        x *= (frustum.right - frustum.left) * 0.5;\n        var y = (2.0 / height) * (height - windowPosition.y) - 1.0;\n        y *= (frustum.top - frustum.bottom) * 0.5;\n\n        var origin = result.origin;\n        Cartesian3.clone(camera.position, origin);\n\n        Cartesian3.multiplyByScalar(camera.right, x, scratchDirection);\n        Cartesian3.add(scratchDirection, origin, origin);\n        Cartesian3.multiplyByScalar(camera.up, y, scratchDirection);\n        Cartesian3.add(scratchDirection, origin, origin);\n\n        Cartesian3.clone(camera.directionWC, result.direction);\n\n        if (camera._mode === SceneMode.COLUMBUS_VIEW || camera._mode === SceneMode.SCENE2D) {\n            Cartesian3.fromElements(result.origin.z, result.origin.x, result.origin.y, result.origin);\n        }\n\n        return result;\n    }\n\n    /**\n     * Create a ray from the camera position through the pixel at <code>windowPosition</code>\n     * in world coordinates.\n     *\n     * @param {Cartesian2} windowPosition The x and y coordinates of a pixel.\n     * @param {Ray} [result] The object onto which to store the result.\n     * @returns {Ray} Returns the {@link Cartesian3} position and direction of the ray.\n     */\n    Camera.prototype.getPickRay = function(windowPosition, result) {\n        \n\n        if (!defined(result)) {\n            result = new Ray();\n        }\n\n        var frustum = this.frustum;\n        if (defined(frustum.aspectRatio) && defined(frustum.fov) && defined(frustum.near)) {\n            return getPickRayPerspective(this, windowPosition, result);\n        }\n\n        return getPickRayOrthographic(this, windowPosition, result);\n    };\n\n    var scratchToCenter = new Cartesian3();\n    var scratchProj = new Cartesian3();\n\n    /**\n     * Return the distance from the camera to the front of the bounding sphere.\n     *\n     * @param {BoundingSphere} boundingSphere The bounding sphere in world coordinates.\n     * @returns {Number} The distance to the bounding sphere.\n     */\n    Camera.prototype.distanceToBoundingSphere = function(boundingSphere) {\n        \n\n        var toCenter = Cartesian3.subtract(this.positionWC, boundingSphere.center, scratchToCenter);\n        var proj = Cartesian3.multiplyByScalar(this.directionWC, Cartesian3.dot(toCenter, this.directionWC), scratchProj);\n        return Math.max(0.0, Cartesian3.magnitude(proj) - boundingSphere.radius);\n    };\n\n    var scratchPixelSize = new Cartesian2();\n\n    /**\n     * Return the pixel size in meters.\n     *\n     * @param {BoundingSphere} boundingSphere The bounding sphere in world coordinates.\n     * @param {Number} drawingBufferWidth The drawing buffer width.\n     * @param {Number} drawingBufferHeight The drawing buffer height.\n     * @returns {Number} The pixel size in meters.\n     */\n    Camera.prototype.getPixelSize = function(boundingSphere, drawingBufferWidth, drawingBufferHeight) {\n        \n\n        var distance = this.distanceToBoundingSphere(boundingSphere);\n        var pixelSize = this.frustum.getPixelDimensions(drawingBufferWidth, drawingBufferHeight, distance, this._scene.pixelRatio, scratchPixelSize);\n        return Math.max(pixelSize.x, pixelSize.y);\n    };\n\n    function createAnimationTemplateCV(camera, position, center, maxX, maxY, duration) {\n        var newPosition = Cartesian3.clone(position);\n\n        if (center.y > maxX) {\n            newPosition.y -= center.y - maxX;\n        } else if (center.y < -maxX) {\n            newPosition.y += -maxX - center.y;\n        }\n\n        if (center.z > maxY) {\n            newPosition.z -= center.z - maxY;\n        } else if (center.z < -maxY) {\n            newPosition.z += -maxY - center.z;\n        }\n\n        function updateCV(value) {\n            var interp = Cartesian3.lerp(position, newPosition, value.time, new Cartesian3());\n            camera.worldToCameraCoordinatesPoint(interp, camera.position);\n        }\n        return {\n            easingFunction : EasingFunction.EXPONENTIAL_OUT,\n            startObject : {\n                time : 0.0\n            },\n            stopObject : {\n                time : 1.0\n            },\n            duration : duration,\n            update : updateCV\n        };\n    }\n\n    var normalScratch = new Cartesian3();\n    var centerScratch = new Cartesian3();\n    var posScratch = new Cartesian3();\n    var scratchCartesian3Subtract = new Cartesian3();\n\n    function createAnimationCV(camera, duration) {\n        var position = camera.position;\n        var direction = camera.direction;\n\n        var normal = camera.worldToCameraCoordinatesVector(Cartesian3.UNIT_X, normalScratch);\n        var scalar = -Cartesian3.dot(normal, position) / Cartesian3.dot(normal, direction);\n        var center = Cartesian3.add(position, Cartesian3.multiplyByScalar(direction, scalar, centerScratch), centerScratch);\n        camera.cameraToWorldCoordinatesPoint(center, center);\n\n        position = camera.cameraToWorldCoordinatesPoint(camera.position, posScratch);\n\n        var tanPhi = Math.tan(camera.frustum.fovy * 0.5);\n        var tanTheta = camera.frustum.aspectRatio * tanPhi;\n        var distToC = Cartesian3.magnitude(Cartesian3.subtract(position, center, scratchCartesian3Subtract));\n        var dWidth = tanTheta * distToC;\n        var dHeight = tanPhi * distToC;\n\n        var mapWidth = camera._maxCoord.x;\n        var mapHeight = camera._maxCoord.y;\n\n        var maxX = Math.max(dWidth - mapWidth, mapWidth);\n        var maxY = Math.max(dHeight - mapHeight, mapHeight);\n\n        if (position.z < -maxX || position.z > maxX || position.y < -maxY || position.y > maxY) {\n            var translateX = center.y < -maxX || center.y > maxX;\n            var translateY = center.z < -maxY || center.z > maxY;\n            if (translateX || translateY) {\n                return createAnimationTemplateCV(camera, position, center, maxX, maxY, duration);\n            }\n        }\n\n        return undefined;\n    }\n\n    /**\n     * Create an animation to move the map into view. This method is only valid for 2D and Columbus modes.\n     *\n     * @param {Number} duration The duration, in seconds, of the animation.\n     * @returns {Object} The animation or undefined if the scene mode is 3D or the map is already ion view.\n     *\n     * @private\n     */\n    Camera.prototype.createCorrectPositionTween = function(duration) {\n        \n\n        if (this._mode === SceneMode.COLUMBUS_VIEW) {\n            return createAnimationCV(this, duration);\n        }\n\n        return undefined;\n    };\n\n    var scratchFlyToDestination = new Cartesian3();\n    var newOptions = {\n        destination : undefined,\n        heading : undefined,\n        pitch : undefined,\n        roll : undefined,\n        duration : undefined,\n        complete : undefined,\n        cancel : undefined,\n        endTransform : undefined,\n        maximumHeight : undefined,\n        easingFunction : undefined\n    };\n\n    /**\n     * Cancels the current camera flight if one is in progress.\n     * The camera is left at it's current location.\n     */\n    Camera.prototype.cancelFlight = function () {\n        if (defined(this._currentFlight)) {\n            this._currentFlight.cancelTween();\n            this._currentFlight = undefined;\n        }\n    };\n\n    /**\n     * Flies the camera from its current position to a new position.\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3|Rectangle} options.destination The final position of the camera in WGS84 (world) coordinates or a rectangle that would be visible from a top-down view.\n     * @param {Object} [options.orientation] An object that contains either direction and up properties or heading, pitch and roll properties. By default, the direction will point\n     * towards the center of the frame in 3D and in the negative z direction in Columbus view. The up direction will point towards local north in 3D and in the positive\n     * y direction in Columbus view.  Orientation is not used in 2D when in infinite scrolling mode.\n     * @param {Number} [options.duration] The duration of the flight in seconds. If omitted, Cesium attempts to calculate an ideal duration based on the distance to be traveled by the flight.\n     * @param {Camera~FlightCompleteCallback} [options.complete] The function to execute when the flight is complete.\n     * @param {Camera~FlightCancelledCallback} [options.cancel] The function to execute if the flight is cancelled.\n     * @param {Matrix4} [options.endTransform] Transform matrix representing the reference frame the camera will be in when the flight is completed.\n     * @param {Number} [options.maximumHeight] The maximum height at the peak of the flight.\n     * @param {Number} [options.pitchAdjustHeight] If camera flyes higher than that value, adjust pitch duiring the flight to look down, and keep Earth in viewport.\n     * @param {Number} [options.flyOverLongitude] There are always two ways between 2 points on globe. This option force camera to choose fight direction to fly over that longitude.\n     * @param {Number} [options.flyOverLongitudeWeight] Fly over the lon specifyed via flyOverLongitude only if that way is not longer than short way times flyOverLongitudeWeight.\n     * @param {Boolean} [options.convert] Whether to convert the destination from world coordinates to scene coordinates (only relevant when not using 3D). Defaults to <code>true</code>.\n     * @param {EasingFunction|EasingFunction~Callback} [options.easingFunction] Controls how the time is interpolated over the duration of the flight.\n     *\n     * @exception {DeveloperError} If either direction or up is given, then both are required.\n     *\n     * @example\n     * // 1. Fly to a position with a top-down view\n     * viewer.camera.flyTo({\n     *     destination : Cesium.Cartesian3.fromDegrees(-117.16, 32.71, 15000.0)\n     * });\n     *\n     * // 2. Fly to a Rectangle with a top-down view\n     * viewer.camera.flyTo({\n     *     destination : Cesium.Rectangle.fromDegrees(west, south, east, north)\n     * });\n     *\n     * // 3. Fly to a position with an orientation using unit vectors.\n     * viewer.camera.flyTo({\n     *     destination : Cesium.Cartesian3.fromDegrees(-122.19, 46.25, 5000.0),\n     *     orientation : {\n     *         direction : new Cesium.Cartesian3(-0.04231243104240401, -0.20123236049443421, -0.97862924300734),\n     *         up : new Cesium.Cartesian3(-0.47934589305293746, -0.8553216253114552, 0.1966022179118339)\n     *     }\n     * });\n     *\n     * // 4. Fly to a position with an orientation using heading, pitch and roll.\n     * viewer.camera.flyTo({\n     *     destination : Cesium.Cartesian3.fromDegrees(-122.19, 46.25, 5000.0),\n     *     orientation : {\n     *         heading : Cesium.Math.toRadians(175.0),\n     *         pitch : Cesium.Math.toRadians(-35.0),\n     *         roll : 0.0\n     *     }\n     * });\n     */\n    Camera.prototype.flyTo = function(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n        var destination = options.destination;\n        \n\n        var mode = this._mode;\n        if (mode === SceneMode.MORPHING) {\n            return;\n        }\n\n        this.cancelFlight();\n\n        var orientation = defaultValue(options.orientation, defaultValue.EMPTY_OBJECT);\n        if (defined(orientation.direction)) {\n            orientation = directionUpToHeadingPitchRoll(this, destination, orientation, scratchSetViewOptions.orientation);\n        }\n\n        if (defined(options.duration) && options.duration <= 0.0) {\n            var setViewOptions = scratchSetViewOptions;\n            setViewOptions.destination = options.destination;\n            setViewOptions.orientation.heading = orientation.heading;\n            setViewOptions.orientation.pitch = orientation.pitch;\n            setViewOptions.orientation.roll = orientation.roll;\n            setViewOptions.convert = options.convert;\n            setViewOptions.endTransform = options.endTransform;\n            this.setView(setViewOptions);\n            if (typeof options.complete === 'function') {\n                options.complete();\n            }\n            return;\n        }\n\n        var isRectangle = defined(destination.west);\n        if (isRectangle) {\n            destination = this.getRectangleCameraCoordinates(destination, scratchFlyToDestination);\n        }\n\n        var that = this;\n        var flightTween;\n\n        newOptions.destination = destination;\n        newOptions.heading = orientation.heading;\n        newOptions.pitch = orientation.pitch;\n        newOptions.roll = orientation.roll;\n        newOptions.duration = options.duration;\n        newOptions.complete = function () {\n            if(flightTween === that._currentFlight){\n                that._currentFlight = undefined;\n            }\n            if (defined(options.complete)) {\n                options.complete();\n            }\n        };\n        newOptions.cancel = options.cancel;\n        newOptions.endTransform = options.endTransform;\n        newOptions.convert = isRectangle ? false : options.convert;\n        newOptions.maximumHeight = options.maximumHeight;\n        newOptions.pitchAdjustHeight = options.pitchAdjustHeight;\n        newOptions.flyOverLongitude = options.flyOverLongitude;\n        newOptions.flyOverLongitudeWeight = options.flyOverLongitudeWeight;\n        newOptions.easingFunction = options.easingFunction;\n\n        var scene = this._scene;\n        var tweenOptions = CameraFlightPath.createTween(scene, newOptions);\n        // If the camera doesn't actually need to go anywhere, duration\n        // will be 0 and we can just complete the current flight.\n        if (tweenOptions.duration === 0) {\n            if (typeof tweenOptions.complete === 'function') {\n                tweenOptions.complete();\n            }\n            return;\n        }\n        flightTween = scene.tweens.add(tweenOptions);\n        this._currentFlight = flightTween;\n\n        // Save the final destination view information for the PRELOAD_FLIGHT pass.\n        var preloadFlightCamera = this._scene.preloadFlightCamera;\n        if (this._mode !== SceneMode.SCENE2D) {\n            if (!defined(preloadFlightCamera)) {\n                preloadFlightCamera = Camera.clone(this);\n            }\n            preloadFlightCamera.setView({ destination: destination, orientation: orientation });\n\n            this._scene.preloadFlightCullingVolume = preloadFlightCamera.frustum.computeCullingVolume(preloadFlightCamera.positionWC, preloadFlightCamera.directionWC, preloadFlightCamera.upWC);\n        }\n    };\n\n    function distanceToBoundingSphere3D(camera, radius) {\n        var frustum = camera.frustum;\n        var tanPhi = Math.tan(frustum.fovy * 0.5);\n        var tanTheta = frustum.aspectRatio * tanPhi;\n        return Math.max(radius / tanTheta, radius / tanPhi);\n    }\n\n    function distanceToBoundingSphere2D(camera, radius) {\n        var frustum = camera.frustum;\n        if (defined(frustum._offCenterFrustum)) {\n            frustum = frustum._offCenterFrustum;\n        }\n\n        var right, top;\n        var ratio = frustum.right / frustum.top;\n        var heightRatio = radius * ratio;\n        if (radius > heightRatio) {\n            right = radius;\n            top = right / ratio;\n        } else {\n            top = radius;\n            right = heightRatio;\n        }\n\n        return Math.max(right, top) * 1.50;\n    }\n\n    var MINIMUM_ZOOM = 100.0;\n\n    function adjustBoundingSphereOffset(camera, boundingSphere, offset) {\n        offset = HeadingPitchRange.clone(defined(offset) ? offset : Camera.DEFAULT_OFFSET);\n\n        var minimumZoom = camera._scene.screenSpaceCameraController.minimumZoomDistance;\n        var maximumZoom = camera._scene.screenSpaceCameraController.maximumZoomDistance;\n        var range = offset.range;\n        if (!defined(range) || range === 0.0) {\n            var radius = boundingSphere.radius;\n            if (radius === 0.0) {\n                offset.range = MINIMUM_ZOOM;\n            } else if (camera.frustum instanceof OrthographicFrustum || camera._mode === SceneMode.SCENE2D) {\n                offset.range = distanceToBoundingSphere2D(camera, radius);\n            } else {\n                offset.range = distanceToBoundingSphere3D(camera, radius);\n            }\n            offset.range = CesiumMath.clamp(offset.range, minimumZoom, maximumZoom);\n        }\n\n        return offset;\n    }\n\n    /**\n     * Sets the camera so that the current view contains the provided bounding sphere.\n     *\n     * <p>The offset is heading/pitch/range in the local east-north-up reference frame centered at the center of the bounding sphere.\n     * The heading and the pitch angles are defined in the local east-north-up reference frame.\n     * The heading is the angle from y axis and increasing towards the x axis. Pitch is the rotation from the xy-plane. Positive pitch\n     * angles are below the plane. Negative pitch angles are above the plane. The range is the distance from the center. If the range is\n     * zero, a range will be computed such that the whole bounding sphere is visible.</p>\n     *\n     * <p>In 2D, there must be a top down view. The camera will be placed above the target looking down. The height above the\n     * target will be the range. The heading will be determined from the offset. If the heading cannot be\n     * determined from the offset, the heading will be north.</p>\n     *\n     * @param {BoundingSphere} boundingSphere The bounding sphere to view, in world coordinates.\n     * @param {HeadingPitchRange} [offset] The offset from the target in the local east-north-up reference frame centered at the target.\n     *\n     * @exception {DeveloperError} viewBoundingSphere is not supported while morphing.\n     */\n    Camera.prototype.viewBoundingSphere = function(boundingSphere, offset) {\n        \n\n        offset = adjustBoundingSphereOffset(this, boundingSphere, offset);\n        this.lookAt(boundingSphere.center, offset);\n    };\n\n    var scratchflyToBoundingSphereTransform = new Matrix4();\n    var scratchflyToBoundingSphereDestination = new Cartesian3();\n    var scratchflyToBoundingSphereDirection = new Cartesian3();\n    var scratchflyToBoundingSphereUp = new Cartesian3();\n    var scratchflyToBoundingSphereRight = new Cartesian3();\n    var scratchFlyToBoundingSphereCart4 = new Cartesian4();\n    var scratchFlyToBoundingSphereQuaternion = new Quaternion();\n    var scratchFlyToBoundingSphereMatrix3 = new Matrix3();\n\n    /**\n     * Flies the camera to a location where the current view contains the provided bounding sphere.\n     *\n     * <p> The offset is heading/pitch/range in the local east-north-up reference frame centered at the center of the bounding sphere.\n     * The heading and the pitch angles are defined in the local east-north-up reference frame.\n     * The heading is the angle from y axis and increasing towards the x axis. Pitch is the rotation from the xy-plane. Positive pitch\n     * angles are below the plane. Negative pitch angles are above the plane. The range is the distance from the center. If the range is\n     * zero, a range will be computed such that the whole bounding sphere is visible.</p>\n     *\n     * <p>In 2D and Columbus View, there must be a top down view. The camera will be placed above the target looking down. The height above the\n     * target will be the range. The heading will be aligned to local north.</p>\n     *\n     * @param {BoundingSphere} boundingSphere The bounding sphere to view, in world coordinates.\n     * @param {Object} [options] Object with the following properties:\n     * @param {Number} [options.duration] The duration of the flight in seconds. If omitted, Cesium attempts to calculate an ideal duration based on the distance to be traveled by the flight.\n     * @param {HeadingPitchRange} [options.offset] The offset from the target in the local east-north-up reference frame centered at the target.\n     * @param {Camera~FlightCompleteCallback} [options.complete] The function to execute when the flight is complete.\n     * @param {Camera~FlightCancelledCallback} [options.cancel] The function to execute if the flight is cancelled.\n     * @param {Matrix4} [options.endTransform] Transform matrix representing the reference frame the camera will be in when the flight is completed.\n     * @param {Number} [options.maximumHeight] The maximum height at the peak of the flight.\n     * @param {Number} [options.pitchAdjustHeight] If camera flyes higher than that value, adjust pitch duiring the flight to look down, and keep Earth in viewport.\n     * @param {Number} [options.flyOverLongitude] There are always two ways between 2 points on globe. This option force camera to choose fight direction to fly over that longitude.\n     * @param {Number} [options.flyOverLongitudeWeight] Fly over the lon specifyed via flyOverLongitude only if that way is not longer than short way times flyOverLongitudeWeight.\n     * @param {EasingFunction|EasingFunction~Callback} [options.easingFunction] Controls how the time is interpolated over the duration of the flight.\n     */\n    Camera.prototype.flyToBoundingSphere = function(boundingSphere, options) {\n        \n\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n        var scene2D = this._mode === SceneMode.SCENE2D || this._mode === SceneMode.COLUMBUS_VIEW;\n        this._setTransform(Matrix4.IDENTITY);\n        var offset = adjustBoundingSphereOffset(this, boundingSphere, options.offset);\n\n        var position;\n        if (scene2D) {\n            position = Cartesian3.multiplyByScalar(Cartesian3.UNIT_Z, offset.range, scratchflyToBoundingSphereDestination);\n        } else {\n            position = offsetFromHeadingPitchRange(offset.heading, offset.pitch, offset.range);\n        }\n\n        var transform = Transforms.eastNorthUpToFixedFrame(boundingSphere.center, Ellipsoid.WGS84, scratchflyToBoundingSphereTransform);\n        Matrix4.multiplyByPoint(transform, position, position);\n\n        var direction;\n        var up;\n\n        if (!scene2D) {\n            direction = Cartesian3.subtract(boundingSphere.center, position, scratchflyToBoundingSphereDirection);\n            Cartesian3.normalize(direction, direction);\n\n            up = Matrix4.multiplyByPointAsVector(transform, Cartesian3.UNIT_Z, scratchflyToBoundingSphereUp);\n            if (1.0 - Math.abs(Cartesian3.dot(direction, up)) < CesiumMath.EPSILON6) {\n                var rotateQuat = Quaternion.fromAxisAngle(direction, offset.heading, scratchFlyToBoundingSphereQuaternion);\n                var rotation = Matrix3.fromQuaternion(rotateQuat, scratchFlyToBoundingSphereMatrix3);\n\n                Cartesian3.fromCartesian4(Matrix4.getColumn(transform, 1, scratchFlyToBoundingSphereCart4), up);\n                Matrix3.multiplyByVector(rotation, up, up);\n            }\n\n            var right = Cartesian3.cross(direction, up, scratchflyToBoundingSphereRight);\n            Cartesian3.cross(right, direction, up);\n            Cartesian3.normalize(up, up);\n        }\n\n        this.flyTo({\n            destination : position,\n            orientation : {\n                direction : direction,\n                up : up\n            },\n            duration : options.duration,\n            complete : options.complete,\n            cancel : options.cancel,\n            endTransform : options.endTransform,\n            maximumHeight : options.maximumHeight,\n            easingFunction : options.easingFunction,\n            flyOverLongitude : options.flyOverLongitude,\n            flyOverLongitudeWeight : options.flyOverLongitudeWeight,\n            pitchAdjustHeight : options.pitchAdjustHeight\n        });\n    };\n\n    var scratchCartesian3_1 = new Cartesian3();\n    var scratchCartesian3_2 = new Cartesian3();\n    var scratchCartesian3_3 = new Cartesian3();\n    var scratchCartesian3_4 = new Cartesian3();\n    var horizonPoints = [new Cartesian3(), new Cartesian3(), new Cartesian3(), new Cartesian3()];\n\n    function computeHorizonQuad(camera, ellipsoid) {\n        var radii = ellipsoid.radii;\n        var p = camera.positionWC;\n\n        // Find the corresponding position in the scaled space of the ellipsoid.\n        var q = Cartesian3.multiplyComponents(ellipsoid.oneOverRadii, p, scratchCartesian3_1);\n\n        var qMagnitude = Cartesian3.magnitude(q);\n        var qUnit = Cartesian3.normalize(q, scratchCartesian3_2);\n\n        // Determine the east and north directions at q.\n        var eUnit;\n        var nUnit;\n        if (Cartesian3.equalsEpsilon(qUnit, Cartesian3.UNIT_Z, CesiumMath.EPSILON10)) {\n            eUnit = new Cartesian3(0, 1, 0);\n            nUnit = new Cartesian3(0, 0, 1);\n        } else {\n            eUnit = Cartesian3.normalize(Cartesian3.cross(Cartesian3.UNIT_Z, qUnit, scratchCartesian3_3), scratchCartesian3_3);\n            nUnit = Cartesian3.normalize(Cartesian3.cross(qUnit, eUnit, scratchCartesian3_4), scratchCartesian3_4);\n        }\n\n        // Determine the radius of the 'limb' of the ellipsoid.\n        var wMagnitude = Math.sqrt(Cartesian3.magnitudeSquared(q) - 1.0);\n\n        // Compute the center and offsets.\n        var center = Cartesian3.multiplyByScalar(qUnit, 1.0 / qMagnitude, scratchCartesian3_1);\n        var scalar = wMagnitude / qMagnitude;\n        var eastOffset = Cartesian3.multiplyByScalar(eUnit, scalar, scratchCartesian3_2);\n        var northOffset = Cartesian3.multiplyByScalar(nUnit, scalar, scratchCartesian3_3);\n\n        // A conservative measure for the longitudes would be to use the min/max longitudes of the bounding frustum.\n        var upperLeft = Cartesian3.add(center, northOffset, horizonPoints[0]);\n        Cartesian3.subtract(upperLeft, eastOffset, upperLeft);\n        Cartesian3.multiplyComponents(radii, upperLeft, upperLeft);\n\n        var lowerLeft = Cartesian3.subtract(center, northOffset, horizonPoints[1]);\n        Cartesian3.subtract(lowerLeft, eastOffset, lowerLeft);\n        Cartesian3.multiplyComponents(radii, lowerLeft, lowerLeft);\n\n        var lowerRight = Cartesian3.subtract(center, northOffset, horizonPoints[2]);\n        Cartesian3.add(lowerRight, eastOffset, lowerRight);\n        Cartesian3.multiplyComponents(radii, lowerRight, lowerRight);\n\n        var upperRight = Cartesian3.add(center, northOffset, horizonPoints[3]);\n        Cartesian3.add(upperRight, eastOffset, upperRight);\n        Cartesian3.multiplyComponents(radii, upperRight, upperRight);\n\n        return horizonPoints;\n    }\n\n    var scratchPickCartesian2 = new Cartesian2();\n    var scratchRectCartesian = new Cartesian3();\n    var cartoArray = [new Cartographic(), new Cartographic(), new Cartographic(), new Cartographic()];\n    function addToResult(x, y, index, camera, ellipsoid, computedHorizonQuad) {\n        scratchPickCartesian2.x = x;\n        scratchPickCartesian2.y = y;\n        var r = camera.pickEllipsoid(scratchPickCartesian2, ellipsoid, scratchRectCartesian);\n        if (defined(r)) {\n            cartoArray[index] = ellipsoid.cartesianToCartographic(r, cartoArray[index]);\n            return 1;\n        }\n        cartoArray[index] = ellipsoid.cartesianToCartographic(computedHorizonQuad[index], cartoArray[index]);\n        return 0;\n    }\n    /**\n     * Computes the approximate visible rectangle on the ellipsoid.\n     *\n     * @param {Ellipsoid} [ellipsoid=Ellipsoid.WGS84] The ellipsoid that you want to know the visible region.\n     * @param {Rectangle} [result] The rectangle in which to store the result\n     *\n     * @returns {Rectangle|undefined} The visible rectangle or undefined if the ellipsoid isn't visible at all.\n     */\n    Camera.prototype.computeViewRectangle = function(ellipsoid, result) {\n        ellipsoid = defaultValue(ellipsoid, Ellipsoid.WGS84);\n        var cullingVolume = this.frustum.computeCullingVolume(this.positionWC, this.directionWC, this.upWC);\n        var boundingSphere = new BoundingSphere(Cartesian3.ZERO, ellipsoid.maximumRadius);\n        var visibility = cullingVolume.computeVisibility(boundingSphere);\n        if (visibility === Intersect.OUTSIDE) {\n            return undefined;\n        }\n\n        var canvas = this._scene.canvas;\n        var width = canvas.clientWidth;\n        var height = canvas.clientHeight;\n\n        var successfulPickCount = 0;\n\n        var computedHorizonQuad = computeHorizonQuad(this, ellipsoid);\n\n        successfulPickCount += addToResult(0, 0, 0, this, ellipsoid, computedHorizonQuad);\n        successfulPickCount += addToResult(0, height, 1, this, ellipsoid, computedHorizonQuad);\n        successfulPickCount += addToResult(width, height, 2, this, ellipsoid, computedHorizonQuad);\n        successfulPickCount += addToResult(width, 0, 3, this, ellipsoid, computedHorizonQuad);\n\n        if (successfulPickCount < 2) {\n            // If we have space non-globe in 3 or 4 corners then return the whole globe\n            return Rectangle.MAX_VALUE;\n        }\n\n        result = Rectangle.fromCartographicArray(cartoArray, result);\n\n        // Detect if we go over the poles\n        var distance = 0;\n        var lastLon = cartoArray[3].longitude;\n        for (var i = 0; i < 4; ++i) {\n            var lon = cartoArray[i].longitude;\n            var diff = Math.abs(lon - lastLon);\n            if (diff > CesiumMath.PI) {\n                // Crossed the dateline\n                distance += CesiumMath.TWO_PI - diff;\n            } else {\n                distance += diff;\n            }\n\n            lastLon = lon;\n        }\n\n        // We are over one of the poles so adjust the rectangle accordingly\n        if (CesiumMath.equalsEpsilon(Math.abs(distance), CesiumMath.TWO_PI, CesiumMath.EPSILON9)) {\n            result.west = -CesiumMath.PI;\n            result.east = CesiumMath.PI;\n            if (cartoArray[0].latitude >= 0.0) {\n                result.north = CesiumMath.PI_OVER_TWO;\n            } else {\n                result.south = -CesiumMath.PI_OVER_TWO;\n            }\n        }\n\n        return result;\n    };\n\n    /**\n     * Switches the frustum/projection to perspective.\n     *\n     * This function is a no-op in 2D which must always be orthographic.\n     */\n    Camera.prototype.switchToPerspectiveFrustum = function() {\n        if (this._mode === SceneMode.SCENE2D || this.frustum instanceof PerspectiveFrustum) {\n            return;\n        }\n\n        var scene = this._scene;\n        this.frustum = new PerspectiveFrustum();\n        this.frustum.aspectRatio = scene.drawingBufferWidth / scene.drawingBufferHeight;\n        this.frustum.fov = CesiumMath.toRadians(60.0);\n    };\n\n    /**\n     * Switches the frustum/projection to orthographic.\n     *\n     * This function is a no-op in 2D which will always be orthographic.\n     */\n    Camera.prototype.switchToOrthographicFrustum = function() {\n        if (this._mode === SceneMode.SCENE2D || this.frustum instanceof OrthographicFrustum) {\n            return;\n        }\n\n        var scene = this._scene;\n        this.frustum = new OrthographicFrustum();\n        this.frustum.aspectRatio = scene.drawingBufferWidth / scene.drawingBufferHeight;\n\n        // It doesn't matter what we set this to. The adjust below will correct the width based on the camera position.\n        this.frustum.width = Cartesian3.magnitude(this.position);\n\n        // Check the projection matrix. It will always be defined, but we need to force an off-center update.\n        var projectionMatrix = this.frustum.projectionMatrix;\n        if (defined(projectionMatrix)) {\n            this._adjustOrthographicFrustum(true);\n        }\n    };\n\n    /**\n     * @private\n     */\n    Camera.clone = function(camera, result) {\n        if (!defined(result)) {\n            result = new Camera(camera._scene);\n        }\n\n        Cartesian3.clone(camera.position, result.position);\n        Cartesian3.clone(camera.direction, result.direction);\n        Cartesian3.clone(camera.up, result.up);\n        Cartesian3.clone(camera.right, result.right);\n        Matrix4.clone(camera._transform, result.transform);\n        result._transformChanged = true;\n        result.frustum = camera.frustum.clone();\n\n        return result;\n    };\n\n    /**\n     * A function that will execute when a flight completes.\n     * @callback Camera~FlightCompleteCallback\n     */\n\n    /**\n     * A function that will execute when a flight is cancelled.\n     * @callback Camera~FlightCancelledCallback\n     */\nexport default Camera;\n","import Check from '../Core/Check.js';\n\n    /**\n     * The state for a 3D Tiles update pass.\n     *\n     * @private\n     */\n    function Cesium3DTilePassState(options) {\n        \n\n        /**\n         * The pass.\n         *\n         * @type {Cesium3DTilePass}\n         */\n        this.pass = options.pass;\n\n        /**\n         * An array of rendering commands to use instead of {@link FrameState.commandList} for the current pass.\n         *\n         * @type {DrawCommand[]}\n         */\n        this.commandList = options.commandList;\n\n        /**\n         * A camera to use instead of {@link FrameState.camera} for the current pass.\n         *\n         * @type {Camera}\n         */\n        this.camera = options.camera;\n\n        /**\n         * A culling volume to use instead of {@link FrameState.cullingVolume} for the current pass.\n         *\n         * @type {CullingVolume}\n         */\n        this.cullingVolume = options.cullingVolume;\n\n        /**\n         * A read-only property that indicates whether the pass is ready, i.e. all tiles needed by the pass are loaded.\n         *\n         * @type {Boolean}\n         * @readonly\n         * @default false\n         */\n        this.ready = false;\n    }\nexport default Cesium3DTilePassState;\n","import BoundingSphere from './BoundingSphere.js';\nimport Cartesian3 from './Cartesian3.js';\nimport Cartesian4 from './Cartesian4.js';\nimport Check from './Check.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport Matrix3 from './Matrix3.js';\nimport Matrix4 from './Matrix4.js';\nimport OrthographicFrustum from './OrthographicFrustum.js';\nimport PerspectiveFrustum from './PerspectiveFrustum.js';\nimport PrimitiveType from './PrimitiveType.js';\nimport Quaternion from './Quaternion.js';\nimport VertexFormat from './VertexFormat.js';\n\n    var PERSPECTIVE = 0;\n    var ORTHOGRAPHIC = 1;\n\n    /**\n     * Describes a frustum at the given the origin and orientation.\n     *\n     * @alias FrustumGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {PerspectiveFrustum|OrthographicFrustum} options.frustum The frustum.\n     * @param {Cartesian3} options.origin The origin of the frustum.\n     * @param {Quaternion} options.orientation The orientation of the frustum.\n     * @param {VertexFormat} [options.vertexFormat=VertexFormat.DEFAULT] The vertex attributes to be computed.\n     */\n    function FrustumGeometry(options) {\n        \n\n        var frustum = options.frustum;\n        var orientation = options.orientation;\n        var origin = options.origin;\n        var vertexFormat = defaultValue(options.vertexFormat, VertexFormat.DEFAULT);\n\n        // This is private because it is used by DebugCameraPrimitive to draw a multi-frustum by\n        // creating multiple FrustumGeometrys. This way the near plane of one frustum doesn't overlap\n        // the far plane of another.\n        var drawNearPlane = defaultValue(options._drawNearPlane, true);\n\n        var frustumType;\n        var frustumPackedLength;\n        if (frustum instanceof PerspectiveFrustum) {\n            frustumType = PERSPECTIVE;\n            frustumPackedLength = PerspectiveFrustum.packedLength;\n        } else if (frustum instanceof OrthographicFrustum) {\n            frustumType = ORTHOGRAPHIC;\n            frustumPackedLength = OrthographicFrustum.packedLength;\n        }\n\n        this._frustumType = frustumType;\n        this._frustum = frustum.clone();\n        this._origin = Cartesian3.clone(origin);\n        this._orientation = Quaternion.clone(orientation);\n        this._drawNearPlane = drawNearPlane;\n        this._vertexFormat = vertexFormat;\n        this._workerName = 'createFrustumGeometry';\n\n        /**\n         * The number of elements used to pack the object into an array.\n         * @type {Number}\n         */\n        this.packedLength = 2 + frustumPackedLength + Cartesian3.packedLength + Quaternion.packedLength + VertexFormat.packedLength;\n    }\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {FrustumGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    FrustumGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var frustumType = value._frustumType;\n        var frustum = value._frustum;\n\n        array[startingIndex++] = frustumType;\n\n        if (frustumType === PERSPECTIVE) {\n            PerspectiveFrustum.pack(frustum, array, startingIndex);\n            startingIndex += PerspectiveFrustum.packedLength;\n        } else {\n            OrthographicFrustum.pack(frustum, array, startingIndex);\n            startingIndex += OrthographicFrustum.packedLength;\n        }\n\n        Cartesian3.pack(value._origin, array, startingIndex);\n        startingIndex += Cartesian3.packedLength;\n        Quaternion.pack(value._orientation, array, startingIndex);\n        startingIndex += Quaternion.packedLength;\n        VertexFormat.pack(value._vertexFormat, array, startingIndex);\n        startingIndex += VertexFormat.packedLength;\n        array[startingIndex] = value._drawNearPlane ? 1.0 : 0.0;\n\n        return array;\n    };\n\n    var scratchPackPerspective = new PerspectiveFrustum();\n    var scratchPackOrthographic = new OrthographicFrustum();\n    var scratchPackQuaternion = new Quaternion();\n    var scratchPackorigin = new Cartesian3();\n    var scratchVertexFormat = new VertexFormat();\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {FrustumGeometry} [result] The object into which to store the result.\n     */\n    FrustumGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var frustumType = array[startingIndex++];\n\n        var frustum;\n        if (frustumType === PERSPECTIVE) {\n            frustum = PerspectiveFrustum.unpack(array, startingIndex, scratchPackPerspective);\n            startingIndex += PerspectiveFrustum.packedLength;\n        } else {\n            frustum = OrthographicFrustum.unpack(array, startingIndex, scratchPackOrthographic);\n            startingIndex += OrthographicFrustum.packedLength;\n        }\n\n        var origin = Cartesian3.unpack(array, startingIndex, scratchPackorigin);\n        startingIndex += Cartesian3.packedLength;\n        var orientation = Quaternion.unpack(array, startingIndex, scratchPackQuaternion);\n        startingIndex += Quaternion.packedLength;\n        var vertexFormat = VertexFormat.unpack(array, startingIndex, scratchVertexFormat);\n        startingIndex += VertexFormat.packedLength;\n        var drawNearPlane = array[startingIndex] === 1.0;\n\n        if (!defined(result)) {\n            return new FrustumGeometry({\n                frustum : frustum,\n                origin : origin,\n                orientation : orientation,\n                vertexFormat : vertexFormat,\n                _drawNearPlane : drawNearPlane\n            });\n        }\n\n        var frustumResult = frustumType === result._frustumType ? result._frustum : undefined;\n        result._frustum = frustum.clone(frustumResult);\n\n        result._frustumType = frustumType;\n        result._origin = Cartesian3.clone(origin, result._origin);\n        result._orientation = Quaternion.clone(orientation, result._orientation);\n        result._vertexFormat = VertexFormat.clone(vertexFormat, result._vertexFormat);\n        result._drawNearPlane = drawNearPlane;\n\n        return result;\n    };\n\n    function getAttributes(offset, normals, tangents, bitangents, st, normal, tangent, bitangent) {\n        var stOffset = offset / 3 * 2;\n\n        for (var i = 0; i < 4; ++i) {\n            if (defined(normals)) {\n                normals[offset] = normal.x;\n                normals[offset + 1] = normal.y;\n                normals[offset + 2] = normal.z;\n            }\n            if (defined(tangents)) {\n                tangents[offset] = tangent.x;\n                tangents[offset + 1] = tangent.y;\n                tangents[offset + 2] = tangent.z;\n            }\n            if (defined(bitangents)) {\n                bitangents[offset] = bitangent.x;\n                bitangents[offset + 1] = bitangent.y;\n                bitangents[offset + 2] = bitangent.z;\n            }\n            offset += 3;\n        }\n\n        st[stOffset] = 0.0;\n        st[stOffset + 1] = 0.0;\n        st[stOffset + 2] = 1.0;\n        st[stOffset + 3] = 0.0;\n        st[stOffset + 4] = 1.0;\n        st[stOffset + 5] = 1.0;\n        st[stOffset + 6] = 0.0;\n        st[stOffset + 7] = 1.0;\n    }\n\n    var scratchRotationMatrix = new Matrix3();\n    var scratchViewMatrix = new Matrix4();\n    var scratchInverseMatrix = new Matrix4();\n\n    var scratchXDirection = new Cartesian3();\n    var scratchYDirection = new Cartesian3();\n    var scratchZDirection = new Cartesian3();\n    var scratchNegativeX = new Cartesian3();\n    var scratchNegativeY = new Cartesian3();\n    var scratchNegativeZ = new Cartesian3();\n\n    var frustumSplits = new Array(3);\n\n    var frustumCornersNDC = new Array(4);\n    frustumCornersNDC[0] = new Cartesian4(-1.0, -1.0, 1.0, 1.0);\n    frustumCornersNDC[1] = new Cartesian4(1.0, -1.0, 1.0, 1.0);\n    frustumCornersNDC[2] = new Cartesian4(1.0, 1.0, 1.0, 1.0);\n    frustumCornersNDC[3] = new Cartesian4(-1.0, 1.0, 1.0, 1.0);\n\n    var scratchFrustumCorners = new Array(4);\n    for (var i = 0; i < 4; ++i) {\n        scratchFrustumCorners[i] = new Cartesian4();\n    }\n\n    FrustumGeometry._computeNearFarPlanes = function(origin, orientation, frustumType, frustum, positions, xDirection, yDirection, zDirection) {\n        var rotationMatrix = Matrix3.fromQuaternion(orientation, scratchRotationMatrix);\n        var x = defaultValue(xDirection, scratchXDirection);\n        var y = defaultValue(yDirection, scratchYDirection);\n        var z = defaultValue(zDirection, scratchZDirection);\n\n        x = Matrix3.getColumn(rotationMatrix, 0, x);\n        y = Matrix3.getColumn(rotationMatrix, 1, y);\n        z = Matrix3.getColumn(rotationMatrix, 2, z);\n\n        Cartesian3.normalize(x, x);\n        Cartesian3.normalize(y, y);\n        Cartesian3.normalize(z, z);\n\n        Cartesian3.negate(x, x);\n\n        var view = Matrix4.computeView(origin, z, y, x, scratchViewMatrix);\n\n        var inverseView;\n        var inverseViewProjection;\n        if (frustumType === PERSPECTIVE) {\n            var projection = frustum.projectionMatrix;\n            var viewProjection = Matrix4.multiply(projection, view, scratchInverseMatrix);\n            inverseViewProjection = Matrix4.inverse(viewProjection, scratchInverseMatrix);\n        } else {\n            inverseView = Matrix4.inverseTransformation(view, scratchInverseMatrix);\n        }\n\n        if (defined(inverseViewProjection)) {\n            frustumSplits[0] = frustum.near;\n            frustumSplits[1] = frustum.far;\n        } else {\n            frustumSplits[0] = 0.0;\n            frustumSplits[1] = frustum.near;\n            frustumSplits[2] = frustum.far;\n        }\n\n        for (var i = 0; i < 2; ++i) {\n            for (var j = 0; j < 4; ++j) {\n                var corner = Cartesian4.clone(frustumCornersNDC[j], scratchFrustumCorners[j]);\n\n                if (!defined(inverseViewProjection)) {\n                    if (defined(frustum._offCenterFrustum)) {\n                        frustum = frustum._offCenterFrustum;\n                    }\n\n                    var near = frustumSplits[i];\n                    var far = frustumSplits[i + 1];\n\n                    corner.x = (corner.x * (frustum.right - frustum.left) + frustum.left + frustum.right) * 0.5;\n                    corner.y = (corner.y * (frustum.top - frustum.bottom) + frustum.bottom + frustum.top) * 0.5;\n                    corner.z = (corner.z * (near - far) - near - far) * 0.5;\n                    corner.w = 1.0;\n\n                    Matrix4.multiplyByVector(inverseView, corner, corner);\n                } else {\n                    corner = Matrix4.multiplyByVector(inverseViewProjection, corner, corner);\n\n                    // Reverse perspective divide\n                    var w = 1.0 / corner.w;\n                    Cartesian3.multiplyByScalar(corner, w, corner);\n\n                    Cartesian3.subtract(corner, origin, corner);\n                    Cartesian3.normalize(corner, corner);\n\n                    var fac = Cartesian3.dot(z, corner);\n                    Cartesian3.multiplyByScalar(corner, frustumSplits[i] / fac, corner);\n                    Cartesian3.add(corner, origin, corner);\n                }\n\n                positions[12 * i + j * 3] = corner.x;\n                positions[12 * i + j * 3 + 1] = corner.y;\n                positions[12 * i + j * 3 + 2] = corner.z;\n            }\n        }\n    };\n\n    /**\n     * Computes the geometric representation of a frustum, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {FrustumGeometry} frustumGeometry A description of the frustum.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    FrustumGeometry.createGeometry = function(frustumGeometry) {\n        var frustumType = frustumGeometry._frustumType;\n        var frustum = frustumGeometry._frustum;\n        var origin = frustumGeometry._origin;\n        var orientation = frustumGeometry._orientation;\n        var drawNearPlane = frustumGeometry._drawNearPlane;\n        var vertexFormat = frustumGeometry._vertexFormat;\n\n        var numberOfPlanes = drawNearPlane ? 6 : 5;\n        var positions = new Float64Array(3 * 4 * 6);\n        FrustumGeometry._computeNearFarPlanes(origin, orientation, frustumType, frustum, positions);\n\n        // -x plane\n        var offset = 3 * 4 * 2;\n        positions[offset]      = positions[3 * 4];\n        positions[offset + 1]  = positions[3 * 4 + 1];\n        positions[offset + 2]  = positions[3 * 4 + 2];\n        positions[offset + 3]  = positions[0];\n        positions[offset + 4]  = positions[1];\n        positions[offset + 5]  = positions[2];\n        positions[offset + 6]  = positions[3 * 3];\n        positions[offset + 7]  = positions[3 * 3 + 1];\n        positions[offset + 8]  = positions[3 * 3 + 2];\n        positions[offset + 9]  = positions[3 * 7];\n        positions[offset + 10] = positions[3 * 7 + 1];\n        positions[offset + 11] = positions[3 * 7 + 2];\n\n        // -y plane\n        offset += 3 * 4;\n        positions[offset]      = positions[3 * 5];\n        positions[offset + 1]  = positions[3 * 5 + 1];\n        positions[offset + 2]  = positions[3 * 5 + 2];\n        positions[offset + 3]  = positions[3];\n        positions[offset + 4]  = positions[3 + 1];\n        positions[offset + 5]  = positions[3 + 2];\n        positions[offset + 6]  = positions[0];\n        positions[offset + 7]  = positions[1];\n        positions[offset + 8]  = positions[2];\n        positions[offset + 9]  = positions[3 * 4];\n        positions[offset + 10] = positions[3 * 4 + 1];\n        positions[offset + 11] = positions[3 * 4 + 2];\n\n        // +x plane\n        offset += 3 * 4;\n        positions[offset]      = positions[3];\n        positions[offset + 1]  = positions[3 + 1];\n        positions[offset + 2]  = positions[3 + 2];\n        positions[offset + 3]  = positions[3 * 5];\n        positions[offset + 4]  = positions[3 * 5 + 1];\n        positions[offset + 5]  = positions[3 * 5 + 2];\n        positions[offset + 6]  = positions[3 * 6];\n        positions[offset + 7]  = positions[3 * 6 + 1];\n        positions[offset + 8]  = positions[3 * 6 + 2];\n        positions[offset + 9]  = positions[3 * 2];\n        positions[offset + 10] = positions[3 * 2 + 1];\n        positions[offset + 11] = positions[3 * 2 + 2];\n\n        // +y plane\n        offset += 3 * 4;\n        positions[offset]      = positions[3 * 2];\n        positions[offset + 1]  = positions[3 * 2 + 1];\n        positions[offset + 2]  = positions[3 * 2 + 2];\n        positions[offset + 3]  = positions[3 * 6];\n        positions[offset + 4]  = positions[3 * 6 + 1];\n        positions[offset + 5]  = positions[3 * 6 + 2];\n        positions[offset + 6]  = positions[3 * 7];\n        positions[offset + 7]  = positions[3 * 7 + 1];\n        positions[offset + 8]  = positions[3 * 7 + 2];\n        positions[offset + 9]  = positions[3 * 3];\n        positions[offset + 10] = positions[3 * 3 + 1];\n        positions[offset + 11] = positions[3 * 3 + 2];\n\n        if (!drawNearPlane) {\n            positions = positions.subarray(3 * 4);\n        }\n\n        var attributes = new GeometryAttributes({\n            position : new GeometryAttribute({\n                componentDatatype : ComponentDatatype.DOUBLE,\n                componentsPerAttribute : 3,\n                values : positions\n            })\n        });\n\n        if (defined(vertexFormat.normal) || defined(vertexFormat.tangent) || defined(vertexFormat.bitangent) || defined(vertexFormat.st)) {\n            var normals = defined(vertexFormat.normal) ? new Float32Array(3 * 4 * numberOfPlanes) : undefined;\n            var tangents = defined(vertexFormat.tangent) ? new Float32Array(3 * 4 * numberOfPlanes) : undefined;\n            var bitangents = defined(vertexFormat.bitangent) ? new Float32Array(3 * 4 * numberOfPlanes) : undefined;\n            var st = defined(vertexFormat.st) ? new Float32Array(2 * 4 * numberOfPlanes) : undefined;\n\n            var x = scratchXDirection;\n            var y = scratchYDirection;\n            var z = scratchZDirection;\n\n            var negativeX = Cartesian3.negate(x, scratchNegativeX);\n            var negativeY = Cartesian3.negate(y, scratchNegativeY);\n            var negativeZ = Cartesian3.negate(z, scratchNegativeZ);\n\n            offset = 0;\n            if (drawNearPlane) {\n                getAttributes(offset, normals, tangents, bitangents, st, negativeZ, x, y); // near\n                offset += 3 * 4;\n            }\n            getAttributes(offset, normals, tangents, bitangents, st, z, negativeX, y); // far\n            offset += 3 * 4;\n            getAttributes(offset, normals, tangents, bitangents, st, negativeX, negativeZ, y); // -x\n            offset += 3 * 4;\n            getAttributes(offset, normals, tangents, bitangents, st, negativeY, negativeZ, negativeX); // -y\n            offset += 3 * 4;\n            getAttributes(offset, normals, tangents, bitangents, st, x, z, y); // +x\n            offset += 3 * 4;\n            getAttributes(offset, normals, tangents, bitangents, st, y, z, negativeX); // +y\n\n            if (defined(normals)) {\n                attributes.normal = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 3,\n                    values : normals\n                });\n            }\n            if (defined(tangents)) {\n                attributes.tangent = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 3,\n                    values : tangents\n                });\n            }\n            if (defined(bitangents)) {\n                attributes.bitangent = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 3,\n                    values : bitangents\n                });\n            }\n            if (defined(st)) {\n                attributes.st = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 2,\n                    values : st\n                });\n            }\n        }\n\n        var indices = new Uint16Array(6 * numberOfPlanes);\n        for (var i = 0; i < numberOfPlanes; ++i) {\n            var indexOffset = i * 6;\n            var index = i * 4;\n\n            indices[indexOffset] = index;\n            indices[indexOffset + 1] = index + 1;\n            indices[indexOffset + 2] = index + 2;\n            indices[indexOffset + 3] = index;\n            indices[indexOffset + 4] = index + 2;\n            indices[indexOffset + 5] = index + 3;\n        }\n\n        return new Geometry({\n            attributes : attributes,\n            indices : indices,\n            primitiveType : PrimitiveType.TRIANGLES,\n            boundingSphere : BoundingSphere.fromVertices(positions)\n        });\n    };\nexport default FrustumGeometry;\n","import BoundingSphere from './BoundingSphere.js';\nimport Cartesian3 from './Cartesian3.js';\nimport Check from './Check.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport FrustumGeometry from './FrustumGeometry.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport OrthographicFrustum from './OrthographicFrustum.js';\nimport PerspectiveFrustum from './PerspectiveFrustum.js';\nimport PrimitiveType from './PrimitiveType.js';\nimport Quaternion from './Quaternion.js';\n\n    var PERSPECTIVE = 0;\n    var ORTHOGRAPHIC = 1;\n\n    /**\n     * A description of the outline of a frustum with the given the origin and orientation.\n     *\n     * @alias FrustumOutlineGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {PerspectiveFrustum|OrthographicFrustum} options.frustum The frustum.\n     * @param {Cartesian3} options.origin The origin of the frustum.\n     * @param {Quaternion} options.orientation The orientation of the frustum.\n     */\n    function FrustumOutlineGeometry(options) {\n        \n\n        var frustum = options.frustum;\n        var orientation = options.orientation;\n        var origin = options.origin;\n\n        // This is private because it is used by DebugCameraPrimitive to draw a multi-frustum by\n        // creating multiple FrustumOutlineGeometrys. This way the near plane of one frustum doesn't overlap\n        // the far plane of another.\n        var drawNearPlane = defaultValue(options._drawNearPlane, true);\n\n        var frustumType;\n        var frustumPackedLength;\n        if (frustum instanceof PerspectiveFrustum) {\n            frustumType = PERSPECTIVE;\n            frustumPackedLength = PerspectiveFrustum.packedLength;\n        } else if (frustum instanceof OrthographicFrustum) {\n            frustumType = ORTHOGRAPHIC;\n            frustumPackedLength = OrthographicFrustum.packedLength;\n        }\n\n        this._frustumType = frustumType;\n        this._frustum = frustum.clone();\n        this._origin = Cartesian3.clone(origin);\n        this._orientation = Quaternion.clone(orientation);\n        this._drawNearPlane = drawNearPlane;\n        this._workerName = 'createFrustumOutlineGeometry';\n\n        /**\n         * The number of elements used to pack the object into an array.\n         * @type {Number}\n         */\n        this.packedLength = 2 + frustumPackedLength + Cartesian3.packedLength + Quaternion.packedLength;\n    }\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {FrustumOutlineGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    FrustumOutlineGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var frustumType = value._frustumType;\n        var frustum = value._frustum;\n\n        array[startingIndex++] = frustumType;\n\n        if (frustumType === PERSPECTIVE) {\n            PerspectiveFrustum.pack(frustum, array, startingIndex);\n            startingIndex += PerspectiveFrustum.packedLength;\n        } else {\n            OrthographicFrustum.pack(frustum, array, startingIndex);\n            startingIndex += OrthographicFrustum.packedLength;\n        }\n\n        Cartesian3.pack(value._origin, array, startingIndex);\n        startingIndex += Cartesian3.packedLength;\n        Quaternion.pack(value._orientation, array, startingIndex);\n        startingIndex += Quaternion.packedLength;\n        array[startingIndex] = value._drawNearPlane ? 1.0 : 0.0;\n\n        return array;\n    };\n\n    var scratchPackPerspective = new PerspectiveFrustum();\n    var scratchPackOrthographic = new OrthographicFrustum();\n    var scratchPackQuaternion = new Quaternion();\n    var scratchPackorigin = new Cartesian3();\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {FrustumOutlineGeometry} [result] The object into which to store the result.\n     */\n    FrustumOutlineGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var frustumType = array[startingIndex++];\n\n        var frustum;\n        if (frustumType === PERSPECTIVE) {\n            frustum = PerspectiveFrustum.unpack(array, startingIndex, scratchPackPerspective);\n            startingIndex += PerspectiveFrustum.packedLength;\n        } else {\n            frustum = OrthographicFrustum.unpack(array, startingIndex, scratchPackOrthographic);\n            startingIndex += OrthographicFrustum.packedLength;\n        }\n\n        var origin = Cartesian3.unpack(array, startingIndex, scratchPackorigin);\n        startingIndex += Cartesian3.packedLength;\n        var orientation = Quaternion.unpack(array, startingIndex, scratchPackQuaternion);\n        startingIndex += Quaternion.packedLength;\n        var drawNearPlane = array[startingIndex] === 1.0;\n\n        if (!defined(result)) {\n            return new FrustumOutlineGeometry({\n                frustum : frustum,\n                origin : origin,\n                orientation : orientation,\n                _drawNearPlane : drawNearPlane\n            });\n        }\n\n        var frustumResult = frustumType === result._frustumType ? result._frustum : undefined;\n        result._frustum = frustum.clone(frustumResult);\n\n        result._frustumType = frustumType;\n        result._origin = Cartesian3.clone(origin, result._origin);\n        result._orientation = Quaternion.clone(orientation, result._orientation);\n        result._drawNearPlane = drawNearPlane;\n\n        return result;\n    };\n\n    /**\n     * Computes the geometric representation of a frustum outline, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {FrustumOutlineGeometry} frustumGeometry A description of the frustum.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    FrustumOutlineGeometry.createGeometry = function(frustumGeometry) {\n        var frustumType = frustumGeometry._frustumType;\n        var frustum = frustumGeometry._frustum;\n        var origin = frustumGeometry._origin;\n        var orientation = frustumGeometry._orientation;\n        var drawNearPlane = frustumGeometry._drawNearPlane;\n\n        var positions = new Float64Array(3 * 4 * 2);\n        FrustumGeometry._computeNearFarPlanes(origin, orientation, frustumType, frustum, positions);\n\n        var attributes = new GeometryAttributes({\n            position : new GeometryAttribute({\n                componentDatatype : ComponentDatatype.DOUBLE,\n                componentsPerAttribute : 3,\n                values : positions\n            })\n        });\n\n        var offset;\n        var index;\n\n        var numberOfPlanes = drawNearPlane ? 2 : 1;\n        var indices = new Uint16Array(8 * (numberOfPlanes + 1));\n\n        // Build the near/far planes\n        var i = drawNearPlane ? 0 : 1;\n        for (; i < 2; ++i) {\n            offset = drawNearPlane ? i * 8 : 0;\n            index = i * 4;\n\n            indices[offset] = index;\n            indices[offset + 1] = index + 1;\n            indices[offset + 2] = index + 1;\n            indices[offset + 3] = index + 2;\n            indices[offset + 4] = index + 2;\n            indices[offset + 5] = index + 3;\n            indices[offset + 6] = index + 3;\n            indices[offset + 7] = index;\n        }\n\n        // Build the sides of the frustums\n        for (i = 0; i < 2; ++i) {\n            offset = (numberOfPlanes + i) * 8;\n            index = i * 4;\n\n            indices[offset] = index;\n            indices[offset + 1] = index + 4;\n            indices[offset + 2] = index + 1;\n            indices[offset + 3] = index + 5;\n            indices[offset + 4] = index + 2;\n            indices[offset + 5] = index + 6;\n            indices[offset + 6] = index + 3;\n            indices[offset + 7] = index + 7;\n        }\n\n        return new Geometry({\n            attributes : attributes,\n            indices : indices,\n            primitiveType : PrimitiveType.LINES,\n            boundingSphere : BoundingSphere.fromVertices(positions)\n        });\n    };\nexport default FrustumOutlineGeometry;\n","import Cartesian3 from '../Core/Cartesian3.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport FrustumGeometry from '../Core/FrustumGeometry.js';\nimport FrustumOutlineGeometry from '../Core/FrustumOutlineGeometry.js';\nimport GeometryInstance from '../Core/GeometryInstance.js';\nimport Matrix3 from '../Core/Matrix3.js';\nimport OrthographicFrustum from '../Core/OrthographicFrustum.js';\nimport OrthographicOffCenterFrustum from '../Core/OrthographicOffCenterFrustum.js';\nimport PerspectiveFrustum from '../Core/PerspectiveFrustum.js';\nimport PerspectiveOffCenterFrustum from '../Core/PerspectiveOffCenterFrustum.js';\nimport Quaternion from '../Core/Quaternion.js';\nimport PerInstanceColorAppearance from './PerInstanceColorAppearance.js';\nimport Primitive from './Primitive.js';\n\n    /**\n     * Draws the outline of the camera's view frustum.\n     *\n     * @alias DebugCameraPrimitive\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Camera} options.camera The camera.\n     * @param {Color} [options.color=Color.CYAN] The color of the debug outline.\n     * @param {Boolean} [options.updateOnChange=true] Whether the primitive updates when the underlying camera changes.\n     * @param {Boolean} [options.show=true] Determines if this primitive will be shown.\n     * @param {Object} [options.id] A user-defined object to return when the instance is picked with {@link Scene#pick}.\n     *\n     * @example\n     * primitives.add(new Cesium.DebugCameraPrimitive({\n     *   camera : camera,\n     *   color : Cesium.Color.YELLOW\n     * }));\n     */\n    function DebugCameraPrimitive(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        \n\n        this._camera = options.camera;\n        this._color = defaultValue(options.color, Color.CYAN);\n        this._updateOnChange = defaultValue(options.updateOnChange, true);\n\n        /**\n         * Determines if this primitive will be shown.\n         *\n         * @type Boolean\n         * @default true\n         */\n        this.show = defaultValue(options.show, true);\n\n        /**\n         * User-defined value returned when the primitive is picked.\n         *\n         * @type {*}\n         * @default undefined\n         *\n         * @see Scene#pick\n         */\n        this.id = options.id;\n        this._id = undefined;\n\n        this._outlinePrimitives = [];\n        this._planesPrimitives = [];\n    }\n\n    var scratchRight = new Cartesian3();\n    var scratchRotation = new Matrix3();\n    var scratchOrientation = new Quaternion();\n    var scratchPerspective = new PerspectiveFrustum();\n    var scratchPerspectiveOffCenter = new PerspectiveOffCenterFrustum();\n    var scratchOrthographic = new OrthographicFrustum();\n    var scratchOrthographicOffCenter = new OrthographicOffCenterFrustum();\n\n    var scratchColor = new Color();\n    var scratchSplits = [1.0, 100000.0];\n\n    /**\n     * @private\n     */\n    DebugCameraPrimitive.prototype.update = function(frameState) {\n        if (!this.show) {\n            return;\n        }\n\n        var planesPrimitives = this._planesPrimitives;\n        var outlinePrimitives = this._outlinePrimitives;\n        var i;\n        var length;\n\n        if (this._updateOnChange) {\n            // Recreate the primitive every frame\n            length = planesPrimitives.length;\n            for (i = 0; i < length; ++i) {\n                outlinePrimitives[i] = outlinePrimitives[i] && outlinePrimitives[i].destroy();\n                planesPrimitives[i] = planesPrimitives[i] && planesPrimitives[i].destroy();\n            }\n            planesPrimitives.length = 0;\n            outlinePrimitives.length = 0;\n        }\n\n        if (planesPrimitives.length === 0) {\n            var camera = this._camera;\n            var cameraFrustum = camera.frustum;\n            var frustum;\n            if (cameraFrustum instanceof PerspectiveFrustum) {\n                frustum = scratchPerspective;\n            } else if (cameraFrustum instanceof PerspectiveOffCenterFrustum) {\n                frustum = scratchPerspectiveOffCenter;\n            } else if (cameraFrustum instanceof OrthographicFrustum) {\n                frustum = scratchOrthographic;\n            } else {\n                frustum = scratchOrthographicOffCenter;\n            }\n            frustum = cameraFrustum.clone(frustum);\n\n            var frustumSplits = frameState.frustumSplits;\n            var numFrustums = frustumSplits.length - 1;\n            if (numFrustums <= 0) {\n                frustumSplits = scratchSplits; // Use near and far planes if no splits created\n                frustumSplits[0] = this._camera.frustum.near;\n                frustumSplits[1] = this._camera.frustum.far;\n                numFrustums = 1;\n            }\n\n            var position = camera.positionWC;\n            var direction = camera.directionWC;\n            var up = camera.upWC;\n            var right = camera.rightWC;\n            right = Cartesian3.negate(right, scratchRight);\n\n            var rotation = scratchRotation;\n            Matrix3.setColumn(rotation, 0, right, rotation);\n            Matrix3.setColumn(rotation, 1, up, rotation);\n            Matrix3.setColumn(rotation, 2, direction, rotation);\n\n            var orientation = Quaternion.fromRotationMatrix(rotation, scratchOrientation);\n\n            planesPrimitives.length = outlinePrimitives.length = numFrustums;\n\n            for (i = 0; i < numFrustums; ++i) {\n                frustum.near = frustumSplits[i];\n                frustum.far = frustumSplits[i + 1];\n\n                planesPrimitives[i] = new Primitive({\n                    geometryInstances : new GeometryInstance({\n                        geometry : new FrustumGeometry({\n                            origin : position,\n                            orientation : orientation,\n                            frustum : frustum,\n                            _drawNearPlane : i === 0\n                        }),\n                        attributes : {\n                            color : ColorGeometryInstanceAttribute.fromColor(Color.fromAlpha(this._color, 0.1, scratchColor))\n                        },\n                        id : this.id,\n                        pickPrimitive : this\n                    }),\n                    appearance : new PerInstanceColorAppearance({\n                        translucent : true,\n                        flat : true\n                    }),\n                    asynchronous : false\n                });\n\n                outlinePrimitives[i] = new Primitive({\n                    geometryInstances : new GeometryInstance({\n                        geometry : new FrustumOutlineGeometry({\n                            origin : position,\n                            orientation : orientation,\n                            frustum : frustum,\n                            _drawNearPlane : i === 0\n                        }),\n                        attributes : {\n                            color : ColorGeometryInstanceAttribute.fromColor(this._color)\n                        },\n                        id : this.id,\n                        pickPrimitive : this\n                    }),\n                    appearance : new PerInstanceColorAppearance({\n                        translucent : false,\n                        flat : true\n                    }),\n                    asynchronous : false\n                });\n            }\n        }\n\n        length = planesPrimitives.length;\n        for (i = 0; i < length; ++i) {\n            outlinePrimitives[i].update(frameState);\n            planesPrimitives[i].update(frameState);\n        }\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <p>\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     * </p>\n     *\n     * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n     *\n     * @see DebugCameraPrimitive#destroy\n     */\n    DebugCameraPrimitive.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n     * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n     * <p>\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     * </p>\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     * @example\n     * p = p && p.destroy();\n     *\n     * @see DebugCameraPrimitive#isDestroyed\n     */\n    DebugCameraPrimitive.prototype.destroy = function() {\n        var length = this._planesPrimitives.length;\n        for (var i = 0; i < length; ++i) {\n            this._outlinePrimitives[i] = this._outlinePrimitives[i] && this._outlinePrimitives[i].destroy();\n            this._planesPrimitives[i] = this._planesPrimitives[i] && this._planesPrimitives[i].destroy();\n        }\n        return destroyObject(this);\n    };\nexport default DebugCameraPrimitive;\n","import BoundingSphere from '../Core/BoundingSphere.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport ComponentDatatype from '../Core/ComponentDatatype.js';\nimport defined from '../Core/defined.js';\nimport FeatureDetection from '../Core/FeatureDetection.js';\nimport Geometry from '../Core/Geometry.js';\nimport GeometryAttribute from '../Core/GeometryAttribute.js';\nimport PrimitiveType from '../Core/PrimitiveType.js';\nimport BufferUsage from '../Renderer/BufferUsage.js';\nimport DrawCommand from '../Renderer/DrawCommand.js';\nimport Pass from '../Renderer/Pass.js';\nimport RenderState from '../Renderer/RenderState.js';\nimport ShaderProgram from '../Renderer/ShaderProgram.js';\nimport ShaderSource from '../Renderer/ShaderSource.js';\nimport VertexArray from '../Renderer/VertexArray.js';\nimport DepthPlaneFS from '../Shaders/DepthPlaneFS.js';\nimport DepthPlaneVS from '../Shaders/DepthPlaneVS.js';\nimport SceneMode from './SceneMode.js';\n\n    /**\n     * @private\n     */\n    function DepthPlane() {\n        this._rs = undefined;\n        this._sp = undefined;\n        this._va = undefined;\n        this._command = undefined;\n        this._mode = undefined;\n        this._useLogDepth = false;\n    }\n\n    var depthQuadScratch = FeatureDetection.supportsTypedArrays() ? new Float32Array(12) : [];\n    var scratchCartesian1 = new Cartesian3();\n    var scratchCartesian2 = new Cartesian3();\n    var scratchCartesian3 = new Cartesian3();\n    var scratchCartesian4 = new Cartesian3();\n\n    function computeDepthQuad(ellipsoid, frameState) {\n        var radii = ellipsoid.radii;\n        var p = frameState.camera.positionWC;\n\n        // Find the corresponding position in the scaled space of the ellipsoid.\n        var q = Cartesian3.multiplyComponents(ellipsoid.oneOverRadii, p, scratchCartesian1);\n\n        var qMagnitude = Cartesian3.magnitude(q);\n        var qUnit = Cartesian3.normalize(q, scratchCartesian2);\n\n        // Determine the east and north directions at q.\n        var eUnit = Cartesian3.normalize(Cartesian3.cross(Cartesian3.UNIT_Z, q, scratchCartesian3), scratchCartesian3);\n        var nUnit = Cartesian3.normalize(Cartesian3.cross(qUnit, eUnit, scratchCartesian4), scratchCartesian4);\n\n        // Determine the radius of the 'limb' of the ellipsoid.\n        var wMagnitude = Math.sqrt(Cartesian3.magnitudeSquared(q) - 1.0);\n\n        // Compute the center and offsets.\n        var center = Cartesian3.multiplyByScalar(qUnit, 1.0 / qMagnitude, scratchCartesian1);\n        var scalar = wMagnitude / qMagnitude;\n        var eastOffset = Cartesian3.multiplyByScalar(eUnit, scalar, scratchCartesian2);\n        var northOffset = Cartesian3.multiplyByScalar(nUnit, scalar, scratchCartesian3);\n\n        // A conservative measure for the longitudes would be to use the min/max longitudes of the bounding frustum.\n        var upperLeft = Cartesian3.add(center, northOffset, scratchCartesian4);\n        Cartesian3.subtract(upperLeft, eastOffset, upperLeft);\n        Cartesian3.multiplyComponents(radii, upperLeft, upperLeft);\n        Cartesian3.pack(upperLeft, depthQuadScratch, 0);\n\n        var lowerLeft = Cartesian3.subtract(center, northOffset, scratchCartesian4);\n        Cartesian3.subtract(lowerLeft, eastOffset, lowerLeft);\n        Cartesian3.multiplyComponents(radii, lowerLeft, lowerLeft);\n        Cartesian3.pack(lowerLeft, depthQuadScratch, 3);\n\n        var upperRight = Cartesian3.add(center, northOffset, scratchCartesian4);\n        Cartesian3.add(upperRight, eastOffset, upperRight);\n        Cartesian3.multiplyComponents(radii, upperRight, upperRight);\n        Cartesian3.pack(upperRight, depthQuadScratch, 6);\n\n        var lowerRight = Cartesian3.subtract(center, northOffset, scratchCartesian4);\n        Cartesian3.add(lowerRight, eastOffset, lowerRight);\n        Cartesian3.multiplyComponents(radii, lowerRight, lowerRight);\n        Cartesian3.pack(lowerRight, depthQuadScratch, 9);\n\n        return depthQuadScratch;\n    }\n\n    DepthPlane.prototype.update = function(frameState) {\n        this._mode = frameState.mode;\n        if (frameState.mode !== SceneMode.SCENE3D) {\n            return;\n        }\n\n        var context = frameState.context;\n        var ellipsoid = frameState.mapProjection.ellipsoid;\n        var useLogDepth = frameState.useLogDepth;\n\n        if (!defined(this._command)) {\n            this._rs = RenderState.fromCache({ // Write depth, not color\n                cull : {\n                    enabled : true\n                },\n                depthTest : {\n                    enabled : true\n                },\n                colorMask : {\n                    red : false,\n                    green : false,\n                    blue : false,\n                    alpha : false\n                }\n            });\n\n            this._command = new DrawCommand({\n                renderState : this._rs,\n                boundingVolume : new BoundingSphere(Cartesian3.ZERO, ellipsoid.maximumRadius),\n                pass : Pass.OPAQUE,\n                owner : this\n            });\n        }\n\n        if (!defined(this._sp) || this._useLogDepth !== useLogDepth) {\n            this._useLogDepth = useLogDepth;\n\n            var vs = new ShaderSource({\n                sources : [DepthPlaneVS]\n            });\n            var fs = new ShaderSource({\n                sources : [DepthPlaneFS]\n            });\n            if (useLogDepth) {\n                var extension =\n                    '#ifdef GL_EXT_frag_depth \\n' +\n                    '#extension GL_EXT_frag_depth : enable \\n' +\n                    '#endif \\n\\n';\n\n                fs.sources.push(extension);\n                fs.defines.push('LOG_DEPTH');\n                vs.defines.push('LOG_DEPTH');\n            }\n\n            this._sp = ShaderProgram.replaceCache({\n                shaderProgram : this._sp,\n                context : context,\n                vertexShaderSource : vs,\n                fragmentShaderSource : fs,\n                attributeLocations : {\n                    position : 0\n                }\n            });\n\n            this._command.shaderProgram = this._sp;\n        }\n\n        // update depth plane\n        var depthQuad = computeDepthQuad(ellipsoid, frameState);\n\n        // depth plane\n        if (!defined(this._va)) {\n            var geometry = new Geometry({\n                attributes : {\n                    position : new GeometryAttribute({\n                        componentDatatype : ComponentDatatype.FLOAT,\n                        componentsPerAttribute : 3,\n                        values : depthQuad\n                    })\n                },\n                indices : [0, 1, 2, 2, 1, 3],\n                primitiveType : PrimitiveType.TRIANGLES\n            });\n\n            this._va = VertexArray.fromGeometry({\n                context : context,\n                geometry : geometry,\n                attributeLocations : {\n                    position : 0\n                },\n                bufferUsage : BufferUsage.DYNAMIC_DRAW\n            });\n\n            this._command.vertexArray = this._va;\n        } else {\n            this._va.getAttribute(0).vertexBuffer.copyFromArrayView(depthQuad);\n        }\n    };\n\n    DepthPlane.prototype.execute = function(context, passState) {\n        if (this._mode === SceneMode.SCENE3D) {\n            this._command.execute(context, passState);\n        }\n    };\n\n    DepthPlane.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    DepthPlane.prototype.destroy = function() {\n        this._sp = this._sp && this._sp.destroy();\n        this._va = this._va && this._va.destroy();\n    };\nexport default DepthPlane;\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"attribute vec4 position;\\n\\\n\\n\\\nvarying vec4 positionEC;\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    positionEC = czm_modelView * position;\\n\\\n    gl_Position = czm_projection * positionEC;\\n\\\n\\n\\\n    czm_vertexLogDepth();\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"varying vec4 positionEC;\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    vec3 direction = normalize(positionEC.xyz);\\n\\\n    czm_ray ray = czm_ray(vec3(0.0), direction);\\n\\\n\\n\\\n    vec3 ellipsoid_center = czm_view[3].xyz;\\n\\\n\\n\\\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center, czm_ellipsoidInverseRadii);\\n\\\n    if (!czm_isEmpty(intersection))\\n\\\n    {\\n\\\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\\n\\\n    }\\n\\\n    else\\n\\\n    {\\n\\\n        discard;\\n\\\n    }\\n\\\n\\n\\\n    czm_writeLogDepth();\\n\\\n}\\n\\\n\";\n","import defined from '../Core/defined.js';\nimport DrawCommand from '../Renderer/DrawCommand.js';\nimport RenderState from '../Renderer/RenderState.js';\nimport ShaderSource from '../Renderer/ShaderSource.js';\n\n    /**\n     * @private\n     */\n    function DerivedCommand() {}\n\n    var fragDepthRegex = /\\bgl_FragDepthEXT\\b/;\n    var discardRegex = /\\bdiscard\\b/;\n\n    function getDepthOnlyShaderProgram(context, shaderProgram) {\n        var shader = context.shaderCache.getDerivedShaderProgram(shaderProgram, 'depthOnly');\n        if (!defined(shader)) {\n            var attributeLocations = shaderProgram._attributeLocations;\n            var fs = shaderProgram.fragmentShaderSource;\n\n            var i;\n            var writesDepthOrDiscards = false;\n            var sources = fs.sources;\n            var length = sources.length;\n            for (i = 0; i < length; ++i) {\n                if (fragDepthRegex.test(sources[i]) || discardRegex.test(sources[i])) {\n                    writesDepthOrDiscards = true;\n                    break;\n                }\n            }\n\n            var usesLogDepth = false;\n            var defines = fs.defines;\n            length = defines.length;\n            for (i = 0; i < length; ++i) {\n                if (defines[i] === 'LOG_DEPTH') {\n                    usesLogDepth = true;\n                    break;\n                }\n            }\n\n            var source;\n            if (!writesDepthOrDiscards && !usesLogDepth) {\n                source =\n                    'void main() \\n' +\n                    '{ \\n' +\n                    '    gl_FragColor = vec4(1.0); \\n' +\n                    '} \\n';\n                fs = new ShaderSource({\n                    sources : [source]\n                });\n            } else if (!writesDepthOrDiscards && usesLogDepth) {\n                source =\n                    '#ifdef GL_EXT_frag_depth \\n' +\n                    '#extension GL_EXT_frag_depth : enable \\n' +\n                    '#endif \\n\\n' +\n                    'void main() \\n' +\n                    '{ \\n' +\n                    '    gl_FragColor = vec4(1.0); \\n' +\n                    '    czm_writeLogDepth(); \\n' +\n                    '} \\n';\n                fs = new ShaderSource({\n                    defines : ['LOG_DEPTH'],\n                    sources : [source]\n                });\n            }\n\n            shader = context.shaderCache.createDerivedShaderProgram(shaderProgram, 'depthOnly', {\n                vertexShaderSource : shaderProgram.vertexShaderSource,\n                fragmentShaderSource : fs,\n                attributeLocations : attributeLocations\n            });\n        }\n\n        return shader;\n    }\n\n    function getDepthOnlyRenderState(scene, renderState) {\n        var cache = scene._depthOnlyRenderStateCache;\n        var depthOnlyState = cache[renderState.id];\n        if (!defined(depthOnlyState)) {\n            var rs = RenderState.getState(renderState);\n            rs.depthMask = true;\n            rs.colorMask = {\n                red : false,\n                green : false,\n                blue : false,\n                alpha : false\n            };\n\n            depthOnlyState = RenderState.fromCache(rs);\n            cache[renderState.id] = depthOnlyState;\n        }\n\n        return depthOnlyState;\n    }\n\n    DerivedCommand.createDepthOnlyDerivedCommand = function(scene, command, context, result) {\n        // For a depth only pass, we bind a framebuffer with only a depth attachment (no color attachments),\n        // do not write color, and write depth. If the fragment shader doesn't modify the fragment depth\n        // or discard, the driver can replace the fragment shader with a pass-through shader. We're unsure if this\n        // actually happens so we modify the shader to use a pass-through fragment shader.\n\n        if (!defined(result)) {\n            result = {};\n        }\n\n        var shader;\n        var renderState;\n        if (defined(result.depthOnlyCommand)) {\n            shader = result.depthOnlyCommand.shaderProgram;\n            renderState = result.depthOnlyCommand.renderState;\n        }\n\n        result.depthOnlyCommand = DrawCommand.shallowClone(command, result.depthOnlyCommand);\n\n        if (!defined(shader) || result.shaderProgramId !== command.shaderProgram.id) {\n            result.depthOnlyCommand.shaderProgram = getDepthOnlyShaderProgram(context, command.shaderProgram);\n            result.depthOnlyCommand.renderState = getDepthOnlyRenderState(scene, command.renderState);\n            result.shaderProgramId = command.shaderProgram.id;\n        } else {\n            result.depthOnlyCommand.shaderProgram = shader;\n            result.depthOnlyCommand.renderState = renderState;\n        }\n\n        return result;\n    };\n\n    var writeLogDepthRegex = /\\s+czm_writeLogDepth\\(/;\n    var vertexlogDepthRegex = /\\s+czm_vertexLogDepth\\(/;\n    var extensionRegex = /\\s*#extension\\s+GL_EXT_frag_depth\\s*:\\s*enable/;\n\n    function getLogDepthShaderProgram(context, shaderProgram) {\n        var shader = context.shaderCache.getDerivedShaderProgram(shaderProgram, 'logDepth');\n        if (!defined(shader)) {\n            var attributeLocations = shaderProgram._attributeLocations;\n            var vs = shaderProgram.vertexShaderSource.clone();\n            var fs = shaderProgram.fragmentShaderSource.clone();\n\n            vs.defines = defined(vs.defines) ? vs.defines.slice(0) : [];\n            vs.defines.push('LOG_DEPTH');\n            fs.defines = defined(fs.defines) ? fs.defines.slice(0) : [];\n            fs.defines.push('LOG_DEPTH');\n\n            var i;\n            var logMain;\n            var writesLogDepth = false;\n            var sources = vs.sources;\n            var length = sources.length;\n            for (i = 0; i < length; ++i) {\n                if (vertexlogDepthRegex.test(sources[i])) {\n                    writesLogDepth = true;\n                    break;\n                }\n            }\n\n            if (!writesLogDepth) {\n                for (i = 0; i < length; ++i) {\n                    sources[i] = ShaderSource.replaceMain(sources[i], 'czm_log_depth_main');\n                }\n\n                logMain =\n                    '\\n\\n' +\n                    'void main() \\n' +\n                    '{ \\n' +\n                    '    czm_log_depth_main(); \\n' +\n                    '    czm_vertexLogDepth(); \\n' +\n                    '} \\n';\n                sources.push(logMain);\n            }\n\n            var addExtension = true;\n            writesLogDepth = false;\n            sources = fs.sources;\n            length = sources.length;\n            for (i = 0; i < length; ++i) {\n                if (writeLogDepthRegex.test(sources[i])) {\n                    writesLogDepth = true;\n                }\n                if (extensionRegex.test(sources[i])) {\n                    addExtension = false;\n                }\n            }\n\n            var logSource = '';\n            if (addExtension) {\n                logSource +=\n                    '#ifdef GL_EXT_frag_depth \\n' +\n                    '#extension GL_EXT_frag_depth : enable \\n' +\n                    '#endif \\n\\n';\n            }\n\n            if (!writesLogDepth) {\n                for (i = 0; i < length; i++) {\n                    sources[i] = ShaderSource.replaceMain(sources[i], 'czm_log_depth_main');\n                }\n\n                logSource +=\n                    '\\n' +\n                    'void main() \\n' +\n                    '{ \\n' +\n                    '    czm_log_depth_main(); \\n' +\n                    '    czm_writeLogDepth(); \\n' +\n                    '} \\n';\n            }\n\n            sources.push(logSource);\n\n            shader = context.shaderCache.createDerivedShaderProgram(shaderProgram, 'logDepth', {\n                vertexShaderSource : vs,\n                fragmentShaderSource : fs,\n                attributeLocations : attributeLocations\n            });\n        }\n\n        return shader;\n    }\n\n    DerivedCommand.createLogDepthCommand = function(command, context, result) {\n        if (!defined(result)) {\n            result = {};\n        }\n\n        var shader;\n        if (defined(result.command)) {\n            shader = result.command.shaderProgram;\n        }\n\n        result.command = DrawCommand.shallowClone(command, result.command);\n\n        if (!defined(shader) || result.shaderProgramId !== command.shaderProgram.id) {\n            result.command.shaderProgram = getLogDepthShaderProgram(context, command.shaderProgram);\n            result.shaderProgramId = command.shaderProgram.id;\n        } else {\n            result.command.shaderProgram = shader;\n        }\n\n        return result;\n    };\n\n    function getPickShaderProgram(context, shaderProgram, pickId) {\n        var shader = context.shaderCache.getDerivedShaderProgram(shaderProgram, 'pick');\n        if (!defined(shader)) {\n            var attributeLocations = shaderProgram._attributeLocations;\n            var fs = shaderProgram.fragmentShaderSource;\n\n            var sources = fs.sources;\n            var length = sources.length;\n\n            var newMain =\n                'void main() \\n' +\n                '{ \\n' +\n                '    czm_non_pick_main(); \\n' +\n                '    if (gl_FragColor.a == 0.0) { \\n' +\n                '        discard; \\n' +\n                '    } \\n' +\n                '    gl_FragColor = ' + pickId + '; \\n' +\n                '} \\n';\n            var newSources = new Array(length + 1);\n            for (var i = 0; i < length; ++i) {\n                newSources[i] = ShaderSource.replaceMain(sources[i], 'czm_non_pick_main');\n            }\n            newSources[length] = newMain;\n            fs = new ShaderSource({\n                sources : newSources,\n                defines : fs.defines\n            });\n            shader = context.shaderCache.createDerivedShaderProgram(shaderProgram, 'pick', {\n                vertexShaderSource : shaderProgram.vertexShaderSource,\n                fragmentShaderSource : fs,\n                attributeLocations : attributeLocations\n            });\n        }\n\n        return shader;\n    }\n\n    function getPickRenderState(scene, renderState) {\n        var cache = scene.picking.pickRenderStateCache;\n        var pickState = cache[renderState.id];\n        if (!defined(pickState)) {\n            var rs = RenderState.getState(renderState);\n            rs.blending.enabled = false;\n\n            // Turns on depth writing for opaque and translucent passes\n            // Overlapping translucent geometry on the globe surface may exhibit z-fighting\n            // during the pick pass which may not match the rendered scene. Once\n            // terrain is on by default and ground primitives are used instead\n            // this will become less of a problem.\n            rs.depthMask = true;\n\n            pickState = RenderState.fromCache(rs);\n            cache[renderState.id] = pickState;\n        }\n\n        return pickState;\n    }\n\n    DerivedCommand.createPickDerivedCommand = function(scene, command, context, result) {\n        if (!defined(result)) {\n            result = {};\n        }\n\n        var shader;\n        var renderState;\n        if (defined(result.pickCommand)) {\n            shader = result.pickCommand.shaderProgram;\n            renderState = result.pickCommand.renderState;\n        }\n\n        result.pickCommand = DrawCommand.shallowClone(command, result.pickCommand);\n\n        if (!defined(shader) || result.shaderProgramId !== command.shaderProgram.id) {\n            result.pickCommand.shaderProgram = getPickShaderProgram(context, command.shaderProgram, command.pickId);\n            result.pickCommand.renderState = getPickRenderState(scene, command.renderState);\n            result.shaderProgramId = command.shaderProgram.id;\n        } else {\n            result.pickCommand.shaderProgram = shader;\n            result.pickCommand.renderState = renderState;\n        }\n\n        return result;\n    };\n\n    function getHdrShaderProgram(context, shaderProgram) {\n        var shader = context.shaderCache.getDerivedShaderProgram(shaderProgram, 'HDR');\n        if (!defined(shader)) {\n            var attributeLocations = shaderProgram._attributeLocations;\n            var vs = shaderProgram.vertexShaderSource.clone();\n            var fs = shaderProgram.fragmentShaderSource.clone();\n\n            vs.defines = defined(vs.defines) ? vs.defines.slice(0) : [];\n            vs.defines.push('HDR');\n            fs.defines = defined(fs.defines) ? fs.defines.slice(0) : [];\n            fs.defines.push('HDR');\n\n            shader = context.shaderCache.createDerivedShaderProgram(shaderProgram, 'HDR', {\n                vertexShaderSource : vs,\n                fragmentShaderSource : fs,\n                attributeLocations : attributeLocations\n            });\n        }\n\n        return shader;\n    }\n\n    DerivedCommand.createHdrCommand = function(command, context, result) {\n        if (!defined(result)) {\n            result = {};\n        }\n\n        var shader;\n        if (defined(result.command)) {\n            shader = result.command.shaderProgram;\n        }\n\n        result.command = DrawCommand.shallowClone(command, result.command);\n\n        if (!defined(shader) || result.shaderProgramId !== command.shaderProgram.id) {\n            result.command.shaderProgram = getHdrShaderProgram(context, command.shaderProgram);\n            result.shaderProgramId = command.shaderProgram.id;\n        } else {\n            result.command.shaderProgram = shader;\n        }\n\n        return result;\n    };\nexport default DerivedCommand;\n","import defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport CesiumMath from '../Core/Math.js';\nimport Matrix3 from '../Core/Matrix3.js';\nimport Quaternion from '../Core/Quaternion.js';\n\n    /**\n     * @private\n     */\n    function DeviceOrientationCameraController(scene) {\n        \n\n        this._scene = scene;\n\n        this._lastAlpha = undefined;\n        this._lastBeta = undefined;\n        this._lastGamma = undefined;\n\n        this._alpha = undefined;\n        this._beta = undefined;\n        this._gamma = undefined;\n\n        var that = this;\n\n        function callback(e) {\n            var alpha = e.alpha;\n            if (!defined(alpha)) {\n                that._alpha = undefined;\n                that._beta = undefined;\n                that._gamma = undefined;\n                return;\n            }\n\n            that._alpha = CesiumMath.toRadians(alpha);\n            that._beta = CesiumMath.toRadians(e.beta);\n            that._gamma = CesiumMath.toRadians(e.gamma);\n        }\n\n        window.addEventListener('deviceorientation', callback, false);\n\n        this._removeListener = function() {\n            window.removeEventListener('deviceorientation', callback, false);\n        };\n    }\n\n    var scratchQuaternion1 = new Quaternion();\n    var scratchQuaternion2 = new Quaternion();\n    var scratchMatrix3 = new Matrix3();\n\n    function rotate(camera, alpha, beta, gamma) {\n        var direction = camera.direction;\n        var right = camera.right;\n        var up = camera.up;\n\n        var bQuat = Quaternion.fromAxisAngle(direction, beta, scratchQuaternion2);\n        var gQuat = Quaternion.fromAxisAngle(right, gamma, scratchQuaternion1);\n\n        var rotQuat = Quaternion.multiply(gQuat, bQuat, gQuat);\n\n        var aQuat = Quaternion.fromAxisAngle(up, alpha, scratchQuaternion2);\n        Quaternion.multiply(aQuat, rotQuat, rotQuat);\n\n        var matrix = Matrix3.fromQuaternion(rotQuat, scratchMatrix3);\n        Matrix3.multiplyByVector(matrix, right, right);\n        Matrix3.multiplyByVector(matrix, up, up);\n        Matrix3.multiplyByVector(matrix, direction, direction);\n    }\n\n    DeviceOrientationCameraController.prototype.update = function() {\n        if (!defined(this._alpha)) {\n            return;\n        }\n\n        if (!defined(this._lastAlpha)) {\n            this._lastAlpha = this._alpha;\n            this._lastBeta = this._beta;\n            this._lastGamma = this._gamma;\n        }\n\n        var a = this._lastAlpha - this._alpha;\n        var b = this._lastBeta - this._beta;\n        var g = this._lastGamma - this._gamma;\n\n        rotate(this._scene.camera, -a, b, g);\n\n        this._lastAlpha = this._alpha;\n        this._lastBeta = this._beta;\n        this._lastGamma = this._gamma;\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <br /><br />\n     *\n     * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n     */\n    DeviceOrientationCameraController.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the resources held by this object.  Destroying an object allows for deterministic\n     * release of resources, instead of relying on the garbage collector to destroy this object.\n     * <br /><br />\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     */\n    DeviceOrientationCameraController.prototype.destroy = function() {\n        this._removeListener();\n        return destroyObject(this);\n    };\nexport default DeviceOrientationCameraController;\n","import Cartesian3 from '../Core/Cartesian3.js';\nimport defined from '../Core/defined.js';\nimport CesiumMath from '../Core/Math.js';\nimport SceneMode from './SceneMode.js';\n\n    /**\n     * Blends the atmosphere to geometry far from the camera for horizon views. Allows for additional\n     * performance improvements by rendering less geometry and dispatching less terrain requests.\n     *\n     * @alias Fog\n     * @constructor\n     */\n    function Fog() {\n        /**\n         * <code>true</code> if fog is enabled, <code>false</code> otherwise.\n         * @type {Boolean}\n         * @default true\n         */\n        this.enabled = true;\n        /**\n         * A scalar that determines the density of the fog. Terrain that is in full fog are culled.\n         * The density of the fog increases as this number approaches 1.0 and becomes less dense as it approaches zero.\n         * The more dense the fog is, the more aggressively the terrain is culled. For example, if the camera is a height of\n         * 1000.0m above the ellipsoid, increasing the value to 3.0e-3 will cause many tiles close to the viewer be culled.\n         * Decreasing the value will push the fog further from the viewer, but decrease performance as more of the terrain is rendered.\n         * @type {Number}\n         * @default 2.0e-4\n         */\n        this.density = 2.0e-4;\n        /**\n         * A factor used to increase the screen space error of terrain tiles when they are partially in fog. The effect is to reduce\n         * the number of terrain tiles requested for rendering. If set to zero, the feature will be disabled. If the value is increased\n         * for mountainous regions, less tiles will need to be requested, but the terrain meshes near the horizon may be a noticeably\n         * lower resolution. If the value is increased in a relatively flat area, there will be little noticeable change on the horizon.\n         * @type {Number}\n         * @default 2.0\n         */\n        this.screenSpaceErrorFactor = 2.0;\n        /**\n         * The minimum brightness of the fog color from lighting. A value of 0.0 can cause the fog to be completely black. A value of 1.0 will not affect\n         * the brightness at all.\n         * @type {Number}\n         * @default 0.03\n         */\n        this.minimumBrightness = 0.03;\n    }\n\n    // These values were found by sampling the density at certain views and finding at what point culled tiles impacted the view at the horizon.\n    var heightsTable = [359.393, 800.749, 1275.6501, 2151.1192, 3141.7763, 4777.5198, 6281.2493, 12364.307, 15900.765, 49889.0549, 78026.8259, 99260.7344, 120036.3873, 151011.0158, 156091.1953, 203849.3112, 274866.9803, 319916.3149, 493552.0528, 628733.5874];\n    var densityTable = [2.0e-5, 2.0e-4, 1.0e-4, 7.0e-5, 5.0e-5, 4.0e-5, 3.0e-5, 1.9e-5, 1.0e-5, 8.5e-6, 6.2e-6, 5.8e-6, 5.3e-6, 5.2e-6, 5.1e-6, 4.2e-6, 4.0e-6, 3.4e-6, 2.6e-6, 2.2e-6];\n\n    // Scale densities by 1e6 to bring lowest value to ~1. Prevents divide by zero.\n    for (var i = 0; i < densityTable.length; ++i) {\n        densityTable[i] *= 1.0e6;\n    }\n    // Change range to [0, 1].\n    var tableStartDensity = densityTable[1];\n    var tableEndDensity = densityTable[densityTable.length - 1];\n    for (var j = 0; j < densityTable.length; ++j) {\n        densityTable[j] = (densityTable[j] - tableEndDensity) / (tableStartDensity - tableEndDensity);\n    }\n\n    var tableLastIndex = 0;\n\n    function findInterval(height) {\n        var heights = heightsTable;\n        var length = heights.length;\n\n        if (height < heights[0]) {\n            tableLastIndex = 0;\n            return tableLastIndex;\n        } else if (height > heights[length - 1]) {\n            tableLastIndex = length - 2;\n            return tableLastIndex;\n        }\n\n        // Take advantage of temporal coherence by checking current, next and previous intervals\n        // for containment of time.\n        if (height >= heights[tableLastIndex]) {\n            if (tableLastIndex + 1 < length && height < heights[tableLastIndex + 1]) {\n                return tableLastIndex;\n            } else if (tableLastIndex + 2 < length && height < heights[tableLastIndex + 2]) {\n                ++tableLastIndex;\n                return tableLastIndex;\n            }\n        } else if (tableLastIndex - 1 >= 0 && height >= heights[tableLastIndex - 1]) {\n            --tableLastIndex;\n            return tableLastIndex;\n        }\n\n        // The above failed so do a linear search.\n        var i;\n        for (i = 0; i < length - 2; ++i) {\n            if (height >= heights[i] && height < heights[i + 1]) {\n                break;\n            }\n        }\n\n        tableLastIndex = i;\n        return tableLastIndex;\n    }\n\n    var scratchPositionNormal = new Cartesian3();\n\n    Fog.prototype.update = function(frameState) {\n        var enabled = frameState.fog.enabled = this.enabled;\n        if (!enabled) {\n            return;\n        }\n\n        var camera = frameState.camera;\n        var positionCartographic = camera.positionCartographic;\n\n        // Turn off fog in space.\n        if (!defined(positionCartographic) || positionCartographic.height > 800000.0 || frameState.mode !== SceneMode.SCENE3D) {\n            frameState.fog.enabled = false;\n            return;\n        }\n\n        var height = positionCartographic.height;\n        var i = findInterval(height);\n        var t = CesiumMath.clamp((height - heightsTable[i]) / (heightsTable[i + 1] - heightsTable[i]), 0.0, 1.0);\n        var density = CesiumMath.lerp(densityTable[i], densityTable[i + 1], t);\n\n        // Again, scale value to be in the range of densityTable (prevents divide by zero) and change to new range.\n        var startDensity = this.density * 1.0e6;\n        var endDensity = (startDensity / tableStartDensity) * tableEndDensity;\n        density = (density * (startDensity - endDensity)) * 1.0e-6;\n\n        // Fade fog in as the camera tilts toward the horizon.\n        var positionNormal = Cartesian3.normalize(camera.positionWC, scratchPositionNormal);\n        var dot = Math.abs(Cartesian3.dot(camera.directionWC, positionNormal));\n        density *= 1.0 - dot;\n\n        frameState.fog.density = density;\n        frameState.fog.sse = this.screenSpaceErrorFactor;\n        frameState.fog.minimumBrightness = this.minimumBrightness;\n    };\nexport default Fog;\n","import SceneMode from './SceneMode.js';\n\n    /**\n     * State information about the current frame.  An instance of this class\n     * is provided to update functions.\n     *\n     * @param {Context} context The rendering context\n     * @param {CreditDisplay} creditDisplay Handles adding and removing credits from an HTML element\n     * @param {JobScheduler} jobScheduler The job scheduler\n     *\n     * @alias FrameState\n     * @constructor\n     *\n     * @private\n     */\n    function FrameState(context, creditDisplay, jobScheduler) {\n        /**\n         * The rendering context.\n         *\n         * @type {Context}\n         */\n        this.context = context;\n\n        /**\n         * An array of rendering commands.\n         *\n         * @type {DrawCommand[]}\n         */\n        this.commandList = [];\n\n        /**\n         * An array of shadow maps.\n         * @type {ShadowMap[]}\n         */\n        this.shadowMaps = [];\n\n        /**\n         * The BRDF look up texture generator used for image-based lighting for PBR models\n         * @type {BrdfLutGenerator}\n         */\n        this.brdfLutGenerator = undefined;\n\n        /**\n         * The environment map used for image-based lighting for PBR models\n         * @type {CubeMap}\n         */\n        this.environmentMap = undefined;\n\n        /**\n         * The spherical harmonic coefficients used for image-based lighting for PBR models.\n         * @type {Cartesian3[]}\n         */\n        this.sphericalHarmonicCoefficients = undefined;\n\n        /**\n         * The specular environment atlas used for image-based lighting for PBR models.\n         * @type {Texture}\n         */\n        this.specularEnvironmentMaps = undefined;\n\n        /**\n         * The maximum level-of-detail of the specular environment atlas used for image-based lighting for PBR models.\n         * @type {Number}\n         */\n        this.specularEnvironmentMapsMaximumLOD = undefined;\n\n        /**\n         * The current mode of the scene.\n         *\n         * @type {SceneMode}\n         * @default {@link SceneMode.SCENE3D}\n         */\n        this.mode = SceneMode.SCENE3D;\n\n        /**\n         * The current morph transition time between 2D/Columbus View and 3D,\n         * with 0.0 being 2D or Columbus View and 1.0 being 3D.\n         *\n         * @type {Number}\n         */\n        this.morphTime = SceneMode.getMorphTime(SceneMode.SCENE3D);\n\n        /**\n         * The current frame number.\n         *\n         * @type {Number}\n         * @default 0\n         */\n        this.frameNumber = 0;\n\n        /**\n         * <code>true</code> if a new frame has been issued and the frame number has been updated.\n         *\n         * @type {Boolean}\n         * @default false\n         */\n        this.newFrame = false;\n\n        /**\n         * The scene's current time.\n         *\n         * @type {JulianDate}\n         * @default undefined\n         */\n        this.time = undefined;\n\n        /**\n         * The job scheduler.\n         *\n         * @type {JobScheduler}\n         */\n        this.jobScheduler = jobScheduler;\n\n        /**\n         * The map projection to use in 2D and Columbus View modes.\n         *\n         * @type {MapProjection}\n         * @default undefined\n         */\n        this.mapProjection = undefined;\n\n        /**\n         * The current camera.\n         *\n         * @type {Camera}\n         * @default undefined\n         */\n        this.camera = undefined;\n\n        /**\n         * Whether the camera is underground.\n         *\n         * @type {Boolean}\n         * @default false\n         */\n        this.cameraUnderground = false;\n\n        /**\n         * The culling volume.\n         *\n         * @type {CullingVolume}\n         * @default undefined\n         */\n        this.cullingVolume = undefined;\n\n        /**\n         * The current occluder.\n         *\n         * @type {Occluder}\n         * @default undefined\n         */\n        this.occluder = undefined;\n\n        /**\n         * The maximum screen-space error used to drive level-of-detail refinement.  Higher\n         * values will provide better performance but lower visual quality.\n         *\n         * @type {Number}\n         * @default 2\n         */\n        this.maximumScreenSpaceError = undefined;\n\n        /**\n         * Ratio between a pixel and a density-independent pixel. Provides a standard unit of\n         * measure for real pixel measurements appropriate to a particular device.\n         *\n         * @type {Number}\n         * @default 1.0\n         */\n        this.pixelRatio = 1.0;\n\n        this.passes = {\n            /**\n             * <code>true</code> if the primitive should update for a render pass, <code>false</code> otherwise.\n             *\n             * @type {Boolean}\n             * @default false\n             */\n            render : false,\n\n            /**\n             * <code>true</code> if the primitive should update for a picking pass, <code>false</code> otherwise.\n             *\n             * @type {Boolean}\n             * @default false\n             */\n            pick : false,\n\n            /**\n             * <code>true</code> if the primitive should update for a depth only pass, <code>false</code> otherwise.\n             * @type {Boolean}\n             * @default false\n             */\n            depth : false,\n\n            /**\n             * <code>true</code> if the primitive should update for a per-feature post-process pass, <code>false</code> otherwise.\n             * @type {Boolean}\n             * @default false\n             */\n            postProcess : false,\n\n            /**\n             * <code>true</code> if the primitive should update for an offscreen pass, <code>false</code> otherwise.\n             * @type {Boolean}\n             * @default false\n             */\n            offscreen : false\n        };\n\n        /**\n        * The credit display.\n         *\n        * @type {CreditDisplay}\n        */\n        this.creditDisplay = creditDisplay;\n\n        /**\n         * An array of functions to be called at the end of the frame.  This array\n         * will be cleared after each frame.\n         * <p>\n         * This allows queueing up events in <code>update</code> functions and\n         * firing them at a time when the subscribers are free to change the\n         * scene state, e.g., manipulate the camera, instead of firing events\n         * directly in <code>update</code> functions.\n         * </p>\n         *\n         * @type {FrameState~AfterRenderCallback[]}\n         *\n         * @example\n         * frameState.afterRender.push(function() {\n         *   // take some action, raise an event, etc.\n         * });\n         */\n        this.afterRender = [];\n\n        /**\n         * Gets whether or not to optimized for 3D only.\n         *\n         * @type {Boolean}\n         * @default false\n         */\n        this.scene3DOnly = false;\n\n        this.fog = {\n            /**\n             * <code>true</code> if fog is enabled, <code>false</code> otherwise.\n             * @type {Boolean}\n             * @default false\n             */\n            enabled : false,\n            /**\n             * A positive number used to mix the color and fog color based on camera distance.\n             *\n             * @type {Number}\n             * @default undefined\n             */\n            density : undefined,\n            /**\n             * A scalar used to modify the screen space error of geometry partially in fog.\n             *\n             * @type {Number}\n             * @default undefined\n             */\n            sse : undefined,\n            /**\n             * The minimum brightness of terrain with fog applied.\n             *\n             * @type {Number}\n             * @default undefined\n             */\n            minimumBrightness : undefined\n        };\n\n        /**\n         * A scalar used to exaggerate the terrain.\n         * @type {Number}\n         * @default 1.0\n         */\n        this.terrainExaggeration = 1.0;\n\n        this.shadowState = {\n            /**\n             * Whether there are any active shadow maps this frame.\n             * @type {Boolean}\n             */\n            shadowsEnabled : true,\n\n            /**\n             * Whether there are any active shadow maps that originate from light sources. Does not\n             * include shadow maps that are used for analytical purposes.\n             */\n            lightShadowsEnabled : true,\n\n            /**\n             * All shadow maps that are enabled this frame.\n             */\n            shadowMaps : [],\n\n            /**\n             * Shadow maps that originate from light sources. Does not include shadow maps that are used for\n             * analytical purposes. Only these shadow maps will be used to generate receive shadows shaders.\n             */\n            lightShadowMaps : [],\n\n            /**\n             * The near plane of the scene's frustum commands. Used for fitting cascaded shadow maps.\n             * @type {Number}\n             */\n            nearPlane : 1.0,\n\n            /**\n             * The far plane of the scene's frustum commands. Used for fitting cascaded shadow maps.\n             * @type {Number}\n             */\n            farPlane : 5000.0,\n\n            /**\n             * The size of the bounding volume that is closest to the camera. This is used to place more shadow detail near the object.\n             * @type {Number}\n             */\n            closestObjectSize : 1000.0,\n\n            /**\n             * The time when a shadow map was last dirty\n             * @type {Number}\n             */\n            lastDirtyTime : 0,\n\n            /**\n             * Whether the shadows maps are out of view this frame\n             * @type {Boolean}\n             */\n            outOfView : true\n        };\n\n        /**\n        * The position of the splitter to use when rendering imagery layers on either side of a splitter.\n        * This value should be between 0.0 and 1.0 with 0 being the far left of the viewport and 1 being the far right of the viewport.\n        * @type {Number}\n        * @default 0.0\n        */\n        this.imagerySplitPosition = 0.0;\n\n        /**\n         * Distances to the near and far planes of the camera frustums\n         * @type {Number[]}\n         * @default []\n         */\n        this.frustumSplits = [];\n\n        /**\n         * The current scene background color\n         *\n         * @type {Color}\n         */\n        this.backgroundColor = undefined;\n\n        /**\n         * The light used to shade the scene.\n         *\n         * @type {Light}\n         */\n        this.light = undefined;\n\n        /**\n         * The distance from the camera at which to disable the depth test of billboards, labels and points\n         * to, for example, prevent clipping against terrain. When set to zero, the depth test should always\n         * be applied. When less than zero, the depth test should never be applied.\n         * @type {Number}\n         */\n        this.minimumDisableDepthTestDistance = undefined;\n\n        /**\n         * When <code>false</code>, 3D Tiles will render normally. When <code>true</code>, classified 3D Tile geometry will render normally and\n         * unclassified 3D Tile geometry will render with the color multiplied with {@link FrameState#invertClassificationColor}.\n         * @type {Boolean}\n         * @default false\n         */\n        this.invertClassification = false;\n\n        /**\n         * The highlight color of unclassified 3D Tile geometry when {@link FrameState#invertClassification} is <code>true</code>.\n         * @type {Color}\n         */\n        this.invertClassificationColor = undefined;\n\n        /**\n         * Whether or not the scene uses a logarithmic depth buffer.\n         *\n         * @type {Boolean}\n         * @default false\n         */\n        this.useLogDepth = false;\n\n        /**\n         * Additional state used to update 3D Tilesets.\n         *\n         * @type {Cesium3DTilePassState}\n         */\n        this.tilesetPassState = undefined;\n\n        /**\n         * The minimum terrain height out of all rendered terrain tiles. Used to improve culling for objects underneath the ellipsoid but above terrain.\n         *\n         * @type {Number}\n         * @default 0.0\n         */\n        this.minimumTerrainHeight = 0.0;\n    }\n\n    /**\n     * A function that will be called at the end of the frame.\n     *\n     * @callback FrameState~AfterRenderCallback\n     */\nexport default FrameState;\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D colorTexture;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D u_depthTexture;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    gl_FragColor = czm_packDepth(texture2D(u_depthTexture, v_textureCoordinates).r);\\n\\\n}\\n\\\n\";\n","import BoundingRectangle from '../Core/BoundingRectangle.js';\nimport Color from '../Core/Color.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport PixelFormat from '../Core/PixelFormat.js';\nimport ClearCommand from '../Renderer/ClearCommand.js';\nimport Framebuffer from '../Renderer/Framebuffer.js';\nimport PixelDatatype from '../Renderer/PixelDatatype.js';\nimport RenderState from '../Renderer/RenderState.js';\nimport Sampler from '../Renderer/Sampler.js';\nimport ShaderSource from '../Renderer/ShaderSource.js';\nimport Texture from '../Renderer/Texture.js';\nimport PassThrough from '../Shaders/PostProcessStages/PassThrough.js';\nimport PassThroughDepth from '../Shaders/PostProcessStages/PassThroughDepth.js';\nimport BlendingState from './BlendingState.js';\nimport StencilConstants from './StencilConstants.js';\nimport StencilFunction from './StencilFunction.js';\nimport StencilOperation from './StencilOperation.js';\n\n    /**\n     * @private\n     */\n    function GlobeDepth() {\n        this._globeColorTexture = undefined;\n        this._primitiveColorTexture = undefined;\n        this._depthStencilTexture = undefined;\n        this._globeDepthTexture = undefined;\n        this._tempGlobeDepthTexture = undefined;\n        this._tempCopyDepthTexture = undefined;\n\n        this._globeColorFramebuffer = undefined;\n        this._primitiveColorFramebuffer = undefined;\n        this._copyDepthFramebuffer = undefined;\n        this._tempCopyDepthFramebuffer = undefined;\n        this._updateDepthFramebuffer = undefined;\n\n        this._clearGlobeColorCommand = undefined;\n        this._clearPrimitiveColorCommand = undefined;\n        this._copyColorCommand = undefined;\n        this._copyDepthCommand = undefined;\n        this._tempCopyDepthCommand = undefined;\n        this._updateDepthCommand = undefined;\n        this._mergeColorCommand = undefined;\n\n        this._viewport = new BoundingRectangle();\n        this._rs = undefined;\n        this._rsBlend = undefined;\n        this._rsUpdate = undefined;\n\n        this._useScissorTest = false;\n        this._scissorRectangle = undefined;\n\n        this._useLogDepth = undefined;\n        this._useHdr = undefined;\n        this._clearGlobeDepth = undefined;\n\n        this._debugGlobeDepthViewportCommand = undefined;\n    }\n\n    Object.defineProperties(GlobeDepth.prototype, {\n        framebuffer : {\n            get : function() {\n                return this._globeColorFramebuffer;\n            }\n        },\n        primitiveFramebuffer : {\n            get : function() {\n                return this._primitiveColorFramebuffer;\n            }\n        }\n    });\n\n    function executeDebugGlobeDepth(globeDepth, context, passState, useLogDepth) {\n        if (!defined(globeDepth._debugGlobeDepthViewportCommand) || useLogDepth !== globeDepth._useLogDepth) {\n            var fsSource =\n                'uniform sampler2D u_depthTexture;\\n' +\n                'varying vec2 v_textureCoordinates;\\n' +\n                'void main()\\n' +\n                '{\\n' +\n                '    float z_window = czm_unpackDepth(texture2D(u_depthTexture, v_textureCoordinates));\\n' +\n                '    z_window = czm_reverseLogDepth(z_window); \\n' +\n                '    float n_range = czm_depthRange.near;\\n' +\n                '    float f_range = czm_depthRange.far;\\n' +\n                '    float z_ndc = (2.0 * z_window - n_range - f_range) / (f_range - n_range);\\n' +\n                '    float scale = pow(z_ndc * 0.5 + 0.5, 8.0);\\n' +\n                '    gl_FragColor = vec4(mix(vec3(0.0), vec3(1.0), scale), 1.0);\\n' +\n                '}\\n';\n            var fs = new ShaderSource({\n                defines : [useLogDepth ? 'LOG_DEPTH' : ''],\n                sources : [fsSource]\n            });\n\n            globeDepth._debugGlobeDepthViewportCommand = context.createViewportQuadCommand(fs, {\n                uniformMap : {\n                    u_depthTexture : function() {\n                        return globeDepth._globeDepthTexture;\n                    }\n                },\n                owner : globeDepth\n            });\n\n            globeDepth._useLogDepth = useLogDepth;\n        }\n\n        globeDepth._debugGlobeDepthViewportCommand.execute(context, passState);\n    }\n\n    function destroyTextures(globeDepth) {\n        globeDepth._globeColorTexture = globeDepth._globeColorTexture && !globeDepth._globeColorTexture.isDestroyed() && globeDepth._globeColorTexture.destroy();\n        globeDepth._depthStencilTexture = globeDepth._depthStencilTexture && !globeDepth._depthStencilTexture.isDestroyed() && globeDepth._depthStencilTexture.destroy();\n        globeDepth._globeDepthTexture = globeDepth._globeDepthTexture && !globeDepth._globeDepthTexture.isDestroyed() && globeDepth._globeDepthTexture.destroy();\n    }\n\n    function destroyFramebuffers(globeDepth) {\n        globeDepth._globeColorFramebuffer = globeDepth._globeColorFramebuffer && !globeDepth._globeColorFramebuffer.isDestroyed() && globeDepth._globeColorFramebuffer.destroy();\n        globeDepth._copyDepthFramebuffer = globeDepth._copyDepthFramebuffer && !globeDepth._copyDepthFramebuffer.isDestroyed() && globeDepth._copyDepthFramebuffer.destroy();\n    }\n\n    function destroyUpdateDepthResources(globeDepth) {\n        globeDepth._tempCopyDepthFramebuffer = globeDepth._tempCopyDepthFramebuffer && !globeDepth._tempCopyDepthFramebuffer.isDestroyed() && globeDepth._tempCopyDepthFramebuffer.destroy();\n        globeDepth._updateDepthFramebuffer = globeDepth._updateDepthFramebuffer && !globeDepth._updateDepthFramebuffer.isDestroyed() && globeDepth._updateDepthFramebuffer.destroy();\n        globeDepth._tempGlobeDepthTexture = globeDepth._tempGlobeDepthTexture && !globeDepth._tempGlobeDepthTexture.isDestroyed() && globeDepth._tempGlobeDepthTexture.destroy();\n    }\n\n    function createUpdateDepthResources(globeDepth, context, width, height, passState) {\n        globeDepth._tempGlobeDepthTexture = new Texture({\n            context : context,\n            width : width,\n            height : height,\n            pixelFormat : PixelFormat.RGBA,\n            pixelDatatype : PixelDatatype.UNSIGNED_BYTE,\n            sampler : Sampler.NEAREST\n        });\n        globeDepth._tempCopyDepthFramebuffer = new Framebuffer({\n            context : context,\n            colorTextures : [globeDepth._tempGlobeDepthTexture],\n            destroyAttachments : false\n        });\n        globeDepth._updateDepthFramebuffer = new Framebuffer({\n            context : context,\n            colorTextures : [globeDepth._globeDepthTexture],\n            depthStencilTexture : passState.framebuffer.depthStencilTexture,\n            destroyAttachments : false\n        });\n    }\n\n    function createTextures(globeDepth, context, width, height, hdr) {\n        var pixelDatatype = hdr ? (context.halfFloatingPointTexture ? PixelDatatype.HALF_FLOAT : PixelDatatype.FLOAT) : PixelDatatype.UNSIGNED_BYTE;\n        globeDepth._globeColorTexture = new Texture({\n            context : context,\n            width : width,\n            height : height,\n            pixelFormat : PixelFormat.RGBA,\n            pixelDatatype : pixelDatatype,\n            sampler : Sampler.NEAREST\n        });\n\n        globeDepth._depthStencilTexture = new Texture({\n            context : context,\n            width : width,\n            height : height,\n            pixelFormat : PixelFormat.DEPTH_STENCIL,\n            pixelDatatype : PixelDatatype.UNSIGNED_INT_24_8\n        });\n\n        globeDepth._globeDepthTexture = new Texture({\n            context : context,\n            width : width,\n            height : height,\n            pixelFormat : PixelFormat.RGBA,\n            pixelDatatype : PixelDatatype.UNSIGNED_BYTE,\n            sampler : Sampler.NEAREST\n        });\n    }\n\n    function createFramebuffers(globeDepth, context) {\n        globeDepth._globeColorFramebuffer = new Framebuffer({\n            context : context,\n            colorTextures : [globeDepth._globeColorTexture],\n            depthStencilTexture : globeDepth._depthStencilTexture,\n            destroyAttachments : false\n        });\n\n        globeDepth._copyDepthFramebuffer = new Framebuffer({\n            context : context,\n            colorTextures : [globeDepth._globeDepthTexture],\n            destroyAttachments : false\n        });\n    }\n\n    function createPrimitiveFramebuffer(globeDepth, context, width, height, hdr) {\n        var pixelDatatype = hdr ? (context.halfFloatingPointTexture ? PixelDatatype.HALF_FLOAT : PixelDatatype.FLOAT) : PixelDatatype.UNSIGNED_BYTE;\n        globeDepth._primitiveColorTexture = new Texture({\n            context : context,\n            width : width,\n            height : height,\n            pixelFormat : PixelFormat.RGBA,\n            pixelDatatype : pixelDatatype,\n            sampler : Sampler.NEAREST\n        });\n\n        globeDepth._primitiveColorFramebuffer = new Framebuffer({\n            context : context,\n            colorTextures : [globeDepth._primitiveColorTexture],\n            depthStencilTexture : globeDepth._depthStencilTexture,\n            destroyAttachments : false\n        });\n    }\n\n    function destroyPrimitiveFramebuffer(globeDepth) {\n        globeDepth._primitiveColorTexture = globeDepth._primitiveColorTexture && !globeDepth._primitiveColorTexture.isDestroyed() && globeDepth._primitiveColorTexture.destroy();\n        globeDepth._primitiveColorFramebuffer = globeDepth._primitiveColorFramebuffer && !globeDepth._primitiveColorFramebuffer.isDestroyed() && globeDepth._primitiveColorFramebuffer.destroy();\n    }\n\n    function updateFramebuffers(globeDepth, context, width, height, hdr, clearGlobeDepth) {\n        var colorTexture = globeDepth._globeColorTexture;\n        var textureChanged = !defined(colorTexture) || colorTexture.width !== width || colorTexture.height !== height || hdr !== globeDepth._useHdr;\n        if (textureChanged) {\n            destroyTextures(globeDepth);\n            destroyFramebuffers(globeDepth);\n            createTextures(globeDepth, context, width, height, hdr, clearGlobeDepth);\n            createFramebuffers(globeDepth, context, clearGlobeDepth);\n        }\n\n        if (textureChanged || clearGlobeDepth !== globeDepth._clearGlobeDepth) {\n            destroyPrimitiveFramebuffer(globeDepth);\n            if (clearGlobeDepth) {\n                createPrimitiveFramebuffer(globeDepth, context, width, height, hdr);\n            }\n        }\n    }\n\n    function updateCopyCommands(globeDepth, context, width, height, passState) {\n        globeDepth._viewport.width = width;\n        globeDepth._viewport.height = height;\n\n        var useScissorTest = !BoundingRectangle.equals(globeDepth._viewport, passState.viewport);\n        var updateScissor = useScissorTest !== globeDepth._useScissorTest;\n        globeDepth._useScissorTest = useScissorTest;\n\n        if (!BoundingRectangle.equals(globeDepth._scissorRectangle, passState.viewport)) {\n            globeDepth._scissorRectangle = BoundingRectangle.clone(passState.viewport, globeDepth._scissorRectangle);\n            updateScissor = true;\n        }\n\n        if (!defined(globeDepth._rs) || !BoundingRectangle.equals(globeDepth._viewport, globeDepth._rs.viewport) || updateScissor) {\n            globeDepth._rs = RenderState.fromCache({\n                viewport : globeDepth._viewport,\n                scissorTest : {\n                    enabled : globeDepth._useScissorTest,\n                    rectangle : globeDepth._scissorRectangle\n                }\n            });\n            globeDepth._rsBlend = RenderState.fromCache({\n                viewport : globeDepth._viewport,\n                scissorTest : {\n                    enabled : globeDepth._useScissorTest,\n                    rectangle : globeDepth._scissorRectangle\n                },\n                blending: BlendingState.ALPHA_BLEND\n            });\n\n            // Copy packed depth only if the 3D Tiles bit is set\n            globeDepth._rsUpdate = RenderState.fromCache({\n                viewport : globeDepth._viewport,\n                scissorTest : {\n                    enabled : globeDepth._useScissorTest,\n                    rectangle : globeDepth._scissorRectangle\n                },\n                stencilTest : {\n                    enabled : true,\n                    frontFunction : StencilFunction.EQUAL,\n                    frontOperation : {\n                        fail : StencilOperation.KEEP,\n                        zFail : StencilOperation.KEEP,\n                        zPass : StencilOperation.KEEP\n                    },\n                    backFunction : StencilFunction.NEVER,\n                    reference : StencilConstants.CESIUM_3D_TILE_MASK,\n                    mask : StencilConstants.CESIUM_3D_TILE_MASK\n                }\n            });\n        }\n\n        if (!defined(globeDepth._copyDepthCommand)) {\n            globeDepth._copyDepthCommand = context.createViewportQuadCommand(PassThroughDepth, {\n                uniformMap : {\n                    u_depthTexture : function() {\n                        return globeDepth._depthStencilTexture;\n                    }\n                },\n                owner : globeDepth\n            });\n        }\n\n        globeDepth._copyDepthCommand.framebuffer = globeDepth._copyDepthFramebuffer;\n        globeDepth._copyDepthCommand.renderState = globeDepth._rs;\n\n        if (!defined(globeDepth._copyColorCommand)) {\n            globeDepth._copyColorCommand = context.createViewportQuadCommand(PassThrough, {\n                uniformMap : {\n                    colorTexture : function() {\n                        return globeDepth._globeColorTexture;\n                    }\n                },\n                owner : globeDepth\n            });\n        }\n\n        globeDepth._copyColorCommand.renderState = globeDepth._rs;\n\n        if (!defined(globeDepth._tempCopyDepthCommand)) {\n            globeDepth._tempCopyDepthCommand = context.createViewportQuadCommand(PassThroughDepth, {\n                uniformMap : {\n                    u_depthTexture : function() {\n                        return globeDepth._tempCopyDepthTexture;\n                    }\n                },\n                owner : globeDepth\n            });\n        }\n\n        globeDepth._tempCopyDepthCommand.framebuffer = globeDepth._tempCopyDepthFramebuffer;\n        globeDepth._tempCopyDepthCommand.renderState = globeDepth._rs;\n\n        if (!defined(globeDepth._updateDepthCommand)) {\n            globeDepth._updateDepthCommand = context.createViewportQuadCommand(PassThrough, {\n                uniformMap : {\n                    colorTexture : function() {\n                        return globeDepth._tempGlobeDepthTexture;\n                    }\n                },\n                owner : globeDepth\n            });\n        }\n\n        globeDepth._updateDepthCommand.framebuffer = globeDepth._updateDepthFramebuffer;\n        globeDepth._updateDepthCommand.renderState = globeDepth._rsUpdate;\n\n        if (!defined(globeDepth._clearGlobeColorCommand)) {\n            globeDepth._clearGlobeColorCommand = new ClearCommand({\n                color : new Color(0.0, 0.0, 0.0, 0.0),\n                stencil : 0.0,\n                owner : globeDepth\n            });\n        }\n\n        globeDepth._clearGlobeColorCommand.framebuffer = globeDepth._globeColorFramebuffer;\n\n        if (!defined(globeDepth._clearPrimitiveColorCommand)) {\n            globeDepth._clearPrimitiveColorCommand = new ClearCommand({\n                color : new Color(0.0, 0.0, 0.0, 0.0),\n                stencil : 0.0,\n                owner : globeDepth\n            });\n        }\n\n        globeDepth._clearPrimitiveColorCommand.framebuffer = globeDepth._primitiveColorFramebuffer;\n\n        if (!defined(globeDepth._mergeColorCommand)) {\n            globeDepth._mergeColorCommand = context.createViewportQuadCommand(PassThrough, {\n                uniformMap : {\n                    colorTexture : function() {\n                        return globeDepth._primitiveColorTexture;\n                    }\n                },\n                owner : globeDepth\n            });\n        }\n\n        globeDepth._mergeColorCommand.framebuffer = globeDepth._globeColorFramebuffer;\n        globeDepth._mergeColorCommand.renderState = globeDepth._rsBlend;\n    }\n\n    GlobeDepth.prototype.executeDebugGlobeDepth = function(context, passState, useLogDepth) {\n        executeDebugGlobeDepth(this, context, passState, useLogDepth);\n    };\n\n    GlobeDepth.prototype.update = function(context, passState, viewport, hdr, clearGlobeDepth) {\n        var width = viewport.width;\n        var height = viewport.height;\n\n        updateFramebuffers(this, context, width, height, hdr, clearGlobeDepth);\n        updateCopyCommands(this, context, width, height, passState);\n        context.uniformState.globeDepthTexture = undefined;\n\n        this._useHdr = hdr;\n        this._clearGlobeDepth = clearGlobeDepth;\n    };\n\n    GlobeDepth.prototype.executeCopyDepth = function(context, passState) {\n        if (defined(this._copyDepthCommand)) {\n            this._copyDepthCommand.execute(context, passState);\n            context.uniformState.globeDepthTexture = this._globeDepthTexture;\n        }\n    };\n\n    GlobeDepth.prototype.executeUpdateDepth = function(context, passState, clearGlobeDepth) {\n        var depthTextureToCopy = passState.framebuffer.depthStencilTexture;\n        if (clearGlobeDepth || (depthTextureToCopy !== this._depthStencilTexture)) {\n            // First copy the depth to a temporary globe depth texture, then update the\n            // main globe depth texture where the stencil bit for 3D Tiles is set.\n            // This preserves the original globe depth except where 3D Tiles is rendered.\n            // The additional texture and framebuffer resources are created on demand.\n            if (defined(this._updateDepthCommand)) {\n                if (!defined(this._updateDepthFramebuffer) ||\n                    (this._updateDepthFramebuffer.depthStencilTexture !== depthTextureToCopy) ||\n                    (this._updateDepthFramebuffer.getColorTexture(0) !== this._globeDepthTexture)) {\n                    var width = this._globeDepthTexture.width;\n                    var height = this._globeDepthTexture.height;\n                    destroyUpdateDepthResources(this);\n                    createUpdateDepthResources(this, context, width, height, passState);\n                    updateCopyCommands(this, context, width, height, passState);\n                }\n                this._tempCopyDepthTexture = depthTextureToCopy;\n                this._tempCopyDepthCommand.execute(context, passState);\n                this._updateDepthCommand.execute(context, passState);\n            }\n            return;\n        }\n\n        // Fast path - the depth texture can be copied normally.\n        if (defined(this._copyDepthCommand)) {\n            this._copyDepthCommand.execute(context, passState);\n        }\n    };\n\n    GlobeDepth.prototype.executeCopyColor = function(context, passState) {\n        if (defined(this._copyColorCommand)) {\n            this._copyColorCommand.execute(context, passState);\n        }\n    };\n\n    GlobeDepth.prototype.executeMergeColor = function(context, passState) {\n        if (defined(this._mergeColorCommand)) {\n            this._mergeColorCommand.execute(context, passState);\n        }\n    };\n\n    GlobeDepth.prototype.clear = function(context, passState, clearColor) {\n        var clear = this._clearGlobeColorCommand;\n        if (defined(clear)) {\n            Color.clone(clearColor, clear.color);\n            clear.execute(context, passState);\n        }\n        clear = this._clearPrimitiveColorCommand;\n        if (defined(clear) && defined(this._primitiveColorFramebuffer)) {\n            clear.execute(context, passState);\n        }\n    };\n\n    GlobeDepth.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    GlobeDepth.prototype.destroy = function() {\n        destroyTextures(this);\n        destroyFramebuffers(this);\n        destroyPrimitiveFramebuffer(this);\n        destroyUpdateDepthResources(this);\n\n        if (defined(this._copyColorCommand)) {\n            this._copyColorCommand.shaderProgram = this._copyColorCommand.shaderProgram.destroy();\n        }\n\n        if (defined(this._copyDepthCommand)) {\n            this._copyDepthCommand.shaderProgram = this._copyDepthCommand.shaderProgram.destroy();\n        }\n\n        if (defined(this._tempCopyDepthCommand)) {\n            this._tempCopyDepthCommand.shaderProgram = this._tempCopyDepthCommand.shaderProgram.destroy();\n        }\n\n        if (defined(this._updateDepthCommand)) {\n            this._updateDepthCommand.shaderProgram = this._updateDepthCommand.shaderProgram.destroy();\n        }\n\n        if (defined(this._mergeColorCommand)) {\n            this._mergeColorCommand.shaderProgram = this._mergeColorCommand.shaderProgram.destroy();\n        }\n\n        if (defined(this._debugGlobeDepthViewportCommand)) {\n            this._debugGlobeDepthViewportCommand.shaderProgram = this._debugGlobeDepthViewportCommand.shaderProgram.destroy();\n        }\n\n        return destroyObject(this);\n    };\nexport default GlobeDepth;\n","import Color from '../Core/Color.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport PixelFormat from '../Core/PixelFormat.js';\nimport ClearCommand from '../Renderer/ClearCommand.js';\nimport Framebuffer from '../Renderer/Framebuffer.js';\nimport PixelDatatype from '../Renderer/PixelDatatype.js';\nimport RenderState from '../Renderer/RenderState.js';\nimport Sampler from '../Renderer/Sampler.js';\nimport ShaderSource from '../Renderer/ShaderSource.js';\nimport Texture from '../Renderer/Texture.js';\nimport TextureMagnificationFilter from '../Renderer/TextureMagnificationFilter.js';\nimport TextureMinificationFilter from '../Renderer/TextureMinificationFilter.js';\nimport TextureWrap from '../Renderer/TextureWrap.js';\nimport PassThrough from '../Shaders/PostProcessStages/PassThrough.js';\nimport BlendingState from './BlendingState.js';\nimport StencilConstants from './StencilConstants.js';\nimport StencilFunction from './StencilFunction.js';\nimport StencilOperation from './StencilOperation.js';\n\n    /**\n     * @private\n     */\n    function InvertClassification() {\n        this.previousFramebuffer = undefined;\n        this._previousFramebuffer = undefined;\n\n        this._texture = undefined;\n        this._classifiedTexture = undefined;\n        this._depthStencilTexture = undefined;\n        this._fbo = undefined;\n        this._fboClassified = undefined;\n\n        this._rsUnclassified = undefined;\n        this._rsClassified = undefined;\n\n        this._unclassifiedCommand = undefined;\n        this._classifiedCommand = undefined;\n        this._translucentCommand = undefined;\n\n        this._clearColorCommand = new ClearCommand({\n            color : new Color(0.0, 0.0, 0.0, 0.0),\n            owner : this\n        });\n        this._clearCommand = new ClearCommand({\n            color : new Color(0.0, 0.0, 0.0, 0.0),\n            depth : 1.0,\n            stencil : 0\n        });\n\n        var that = this;\n        this._uniformMap = {\n            colorTexture : function() {\n                return that._texture;\n            },\n            depthTexture : function() {\n                return that._depthStencilTexture;\n            },\n            classifiedTexture : function() {\n                return that._classifiedTexture;\n            }\n        };\n    }\n\n    Object.defineProperties(InvertClassification.prototype, {\n        unclassifiedCommand : {\n            get : function() {\n                return this._unclassifiedCommand;\n            }\n        }\n    });\n\n    InvertClassification.isTranslucencySupported = function(context) {\n        return context.depthTexture && context.fragmentDepth;\n    };\n\n    var rsUnclassified = {\n        depthMask : false,\n        stencilTest : {\n            enabled : true,\n            frontFunction : StencilFunction.EQUAL,\n            frontOperation : {\n                fail : StencilOperation.KEEP,\n                zFail : StencilOperation.KEEP,\n                zPass : StencilOperation.KEEP\n            },\n            backFunction : StencilFunction.NEVER,\n            reference : 0,\n            mask : StencilConstants.CLASSIFICATION_MASK\n        },\n        blending : BlendingState.ALPHA_BLEND\n    };\n\n    var rsClassified = {\n        depthMask : false,\n        stencilTest : {\n            enabled : true,\n            frontFunction : StencilFunction.NOT_EQUAL,\n            frontOperation : {\n                fail : StencilOperation.KEEP,\n                zFail : StencilOperation.KEEP,\n                zPass : StencilOperation.KEEP\n            },\n            backFunction : StencilFunction.NEVER,\n            reference : 0,\n            mask : StencilConstants.CLASSIFICATION_MASK\n        },\n        blending : BlendingState.ALPHA_BLEND\n    };\n\n    // Set the 3D Tiles bit when rendering back into the scene's framebuffer. This is only needed if\n    // invert classification does not use the scene's depth-stencil texture, which is the case if the invert\n    // classification color is translucent.\n    var rsDefault = {\n        depthMask : true,\n        depthTest : {\n            enabled : true\n        },\n        stencilTest : StencilConstants.setCesium3DTileBit(),\n        stencilMask : StencilConstants.CESIUM_3D_TILE_MASK,\n        blending : BlendingState.ALPHA_BLEND\n    };\n\n    var translucentFS =\n        '#extension GL_EXT_frag_depth : enable\\n'+\n        'uniform sampler2D colorTexture;\\n' +\n        'uniform sampler2D depthTexture;\\n' +\n        'uniform sampler2D classifiedTexture;\\n' +\n        'varying vec2 v_textureCoordinates;\\n' +\n        'void main()\\n' +\n        '{\\n' +\n        '    vec4 color = texture2D(colorTexture, v_textureCoordinates);\\n' +\n        '    if (color.a == 0.0)\\n' +\n        '    {\\n' +\n        '        discard;\\n' +\n        '    }\\n' +\n        '    bool isClassified = all(equal(texture2D(classifiedTexture, v_textureCoordinates), vec4(0.0)));\\n' +\n        '#ifdef UNCLASSIFIED\\n' +\n        '    vec4 highlightColor = czm_invertClassificationColor;\\n' +\n        '    if (isClassified)\\n' +\n        '    {\\n' +\n        '        discard;\\n' +\n        '    }\\n' +\n        '#else\\n' +\n        '    vec4 highlightColor = vec4(1.0);\\n' +\n        '    if (!isClassified)\\n' +\n        '    {\\n' +\n        '        discard;\\n' +\n        '    }\\n' +\n        '#endif\\n' +\n        '    gl_FragColor = color * highlightColor;\\n' +\n        '    gl_FragDepthEXT = texture2D(depthTexture, v_textureCoordinates).r;\\n' +\n        '}\\n';\n\n    var opaqueFS =\n        'uniform sampler2D colorTexture;\\n' +\n        'varying vec2 v_textureCoordinates;\\n' +\n        'void main()\\n' +\n        '{\\n' +\n        '    vec4 color = texture2D(colorTexture, v_textureCoordinates);\\n' +\n        '    if (color.a == 0.0)\\n' +\n        '    {\\n' +\n        '        discard;\\n' +\n        '    }\\n' +\n        '#ifdef UNCLASSIFIED\\n' +\n        '    gl_FragColor = color * czm_invertClassificationColor;\\n' +\n        '#else\\n' +\n        '    gl_FragColor = color;\\n' +\n        '#endif\\n' +\n        '}\\n';\n\n    InvertClassification.prototype.update = function(context) {\n        var texture = this._texture;\n        var previousFramebufferChanged = !defined(texture) || this.previousFramebuffer !== this._previousFramebuffer;\n        this._previousFramebuffer = this.previousFramebuffer;\n\n        var width = context.drawingBufferWidth;\n        var height = context.drawingBufferHeight;\n\n        var textureChanged = !defined(texture) || texture.width !== width || texture.height !== height;\n        if (textureChanged || previousFramebufferChanged) {\n            this._texture = this._texture && this._texture.destroy();\n            this._classifiedTexture = this._classifiedTexture && this._classifiedTexture.destroy();\n            this._depthStencilTexture = this._depthStencilTexture && this._depthStencilTexture.destroy();\n\n            this._texture = new Texture({\n                context : context,\n                width : width,\n                height : height,\n                pixelFormat : PixelFormat.RGBA,\n                pixelDatatype : PixelDatatype.UNSIGNED_BYTE,\n                sampler : new Sampler({\n                    wrapS : TextureWrap.CLAMP_TO_EDGE,\n                    wrapT : TextureWrap.CLAMP_TO_EDGE,\n                    minificationFilter : TextureMinificationFilter.LINEAR,\n                    magnificationFilter : TextureMagnificationFilter.LINEAR\n                })\n            });\n\n            if (!defined(this._previousFramebuffer)) {\n                this._classifiedTexture = new Texture({\n                    context : context,\n                    width : width,\n                    height : height,\n                    pixelFormat : PixelFormat.RGBA,\n                    pixelDatatype : PixelDatatype.UNSIGNED_BYTE,\n                    sampler : new Sampler({\n                        wrapS : TextureWrap.CLAMP_TO_EDGE,\n                        wrapT : TextureWrap.CLAMP_TO_EDGE,\n                        minificationFilter : TextureMinificationFilter.LINEAR,\n                        magnificationFilter : TextureMagnificationFilter.LINEAR\n                    })\n                });\n                this._depthStencilTexture = new Texture({\n                    context : context,\n                    width : width,\n                    height : height,\n                    pixelFormat : PixelFormat.DEPTH_STENCIL,\n                    pixelDatatype : PixelDatatype.UNSIGNED_INT_24_8\n                });\n            }\n        }\n\n        if (!defined(this._fbo) || textureChanged || previousFramebufferChanged) {\n            this._fbo = this._fbo && this._fbo.destroy();\n            this._fboClassified = this._fboClassified && this._fboClassified.destroy();\n\n            var depthStencilTexture;\n            var depthStencilRenderbuffer;\n            if (defined(this._previousFramebuffer)) {\n                depthStencilTexture = this._previousFramebuffer.depthStencilTexture;\n                depthStencilRenderbuffer = this._previousFramebuffer.depthStencilRenderbuffer;\n            } else {\n                depthStencilTexture = this._depthStencilTexture;\n            }\n\n            this._fbo = new Framebuffer({\n                context : context,\n                colorTextures : [this._texture],\n                depthStencilTexture : depthStencilTexture,\n                depthStencilRenderbuffer : depthStencilRenderbuffer,\n                destroyAttachments : false\n            });\n\n            if (!defined(this._previousFramebuffer)) {\n                this._fboClassified = new Framebuffer({\n                    context : context,\n                    colorTextures : [this._classifiedTexture],\n                    depthStencilTexture : depthStencilTexture,\n                    destroyAttachments : false\n                });\n            }\n        }\n\n        if (!defined(this._rsUnclassified)) {\n            this._rsUnclassified = RenderState.fromCache(rsUnclassified);\n            this._rsClassified = RenderState.fromCache(rsClassified);\n            this._rsDefault = RenderState.fromCache(rsDefault);\n        }\n\n        if (!defined(this._unclassifiedCommand) || previousFramebufferChanged) {\n            if (defined(this._unclassifiedCommand)) {\n                this._unclassifiedCommand.shaderProgram = this._unclassifiedCommand.shaderProgram && this._unclassifiedCommand.shaderProgram.destroy();\n                this._classifiedCommand.shaderProgram = this._classifiedCommand.shaderProgram && this._classifiedCommand.shaderProgram.destroy();\n            }\n\n            var fs = defined(this._previousFramebuffer) ? opaqueFS : translucentFS;\n            var unclassifiedFSSource = new ShaderSource({\n                defines : ['UNCLASSIFIED'],\n                sources : [fs]\n            });\n            var classifiedFSSource = new ShaderSource({\n                sources : [fs]\n            });\n            this._unclassifiedCommand = context.createViewportQuadCommand(unclassifiedFSSource, {\n                renderState : defined(this._previousFramebuffer) ? this._rsUnclassified : this._rsDefault,\n                uniformMap : this._uniformMap,\n                owner : this\n            });\n            this._classifiedCommand = context.createViewportQuadCommand(classifiedFSSource, {\n                renderState : defined(this._previousFramebuffer) ? this._rsClassified : this._rsDefault,\n                uniformMap : this._uniformMap,\n                owner : this\n            });\n\n            if (defined(this._translucentCommand)) {\n                this._translucentCommand.shaderProgram = this._translucentCommand.shaderProgram && this._translucentCommand.shaderProgram.destroy();\n            }\n            if (!defined(this._previousFramebuffer)) {\n                this._translucentCommand = context.createViewportQuadCommand(PassThrough, {\n                    renderState : this._rsUnclassified,\n                    uniformMap : this._uniformMap,\n                    owner : this\n                });\n            }\n        }\n    };\n\n    InvertClassification.prototype.clear = function(context, passState) {\n        var framebuffer = passState.framebuffer;\n\n        if (defined(this._previousFramebuffer)) {\n            passState.framebuffer = this._fbo;\n            this._clearColorCommand.execute(context, passState);\n        } else {\n            passState.framebuffer = this._fbo;\n            this._clearCommand.execute(context, passState);\n            passState.framebuffer = this._fboClassified;\n            this._clearCommand.execute(context, passState);\n        }\n\n        passState.framebuffer = framebuffer;\n    };\n\n    InvertClassification.prototype.executeClassified = function(context, passState) {\n        if (!defined(this._previousFramebuffer)) {\n            var framebuffer = passState.framebuffer;\n\n            passState.framebuffer = this._fboClassified;\n            this._translucentCommand.execute(context, passState);\n\n            passState.framebuffer = framebuffer;\n        }\n        this._classifiedCommand.execute(context, passState);\n    };\n\n    InvertClassification.prototype.executeUnclassified = function(context, passState) {\n        this._unclassifiedCommand.execute(context, passState);\n    };\n\n    InvertClassification.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    InvertClassification.prototype.destroy = function() {\n        this._fbo = this._fbo && this._fbo.destroy();\n        this._texture = this._texture && this._texture.destroy();\n        this._depthStencilTexture = this._depthStencilTexture && this._depthStencilTexture.destroy();\n\n        if (defined(this._unclassifiedCommand)) {\n            this._unclassifiedCommand.shaderProgram = this._unclassifiedCommand.shaderProgram && this._unclassifiedCommand.shaderProgram.destroy();\n            this._classifiedCommand.shaderProgram = this._classifiedCommand.shaderProgram && this._classifiedCommand.shaderProgram.destroy();\n        }\n\n        return destroyObject(this);\n    };\nexport default InvertClassification;\n","import defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport getTimestamp from '../Core/getTimestamp.js';\nimport JobType from './JobType.js';\n\n    function JobTypeBudget(total) {\n        /**\n         * Total budget, in milliseconds, allowed for one frame\n         */\n        this._total = total;\n\n        /**\n         * Time, in milliseconds, used so far during this frame\n         */\n        this.usedThisFrame = 0.0;\n\n        /**\n         * Time, in milliseconds, that other job types stole this frame\n         */\n        this.stolenFromMeThisFrame = 0.0;\n\n        /**\n         * Indicates if this job type was starved this frame, i.e., a job\n         * tried to run but didn't have budget\n         */\n        this.starvedThisFrame = false;\n\n        /**\n         * Indicates if this job was starved last frame.  This prevents it\n         * from being stolen from this frame.\n         */\n        this.starvedLastFrame = false;\n    }\n\n    Object.defineProperties(JobTypeBudget.prototype, {\n        total : {\n            get : function() {\n                return this._total;\n            }\n        }\n    });\n\n    /**\n     * Engine for time slicing jobs during a frame to amortize work over multiple frames.  This supports:\n     * <ul>\n     *   <li>\n     *     Separate budgets for different job types, e.g., texture, shader program, and buffer creation.  This\n     *     allows all job types to make progress each frame.\n     *   </li>\n     *   <li>\n     *     Stealing from other jobs type budgets if they were not exhausted in the previous frame.  This allows\n     *     using the entire budget for all job types each frame even if, for example, all the jobs are the same type.\n     *   </li>\n     *   <li>\n     *     Guaranteed progress on all job types each frame, even if it means exceeding the total budget for the frame.\n     *     This prevents, for example, several expensive texture uploads over many frames from prevent a shader compile.\n     *   </li>\n     * </ul>\n     *\n     * @private\n     */\n    function JobScheduler(budgets) {\n        \n\n        // Total for defaults is half of of one frame at 10 fps\n        var jobBudgets = new Array(JobType.NUMBER_OF_JOB_TYPES);\n        jobBudgets[JobType.TEXTURE] = new JobTypeBudget(defined(budgets) ? budgets[JobType.TEXTURE] : 10.0);\n        // On cache miss, this most likely only allows one shader compile per frame\n        jobBudgets[JobType.PROGRAM] = new JobTypeBudget(defined(budgets) ? budgets[JobType.PROGRAM] : 10.0);\n        jobBudgets[JobType.BUFFER] = new JobTypeBudget(defined(budgets) ? budgets[JobType.BUFFER] : 30.0);\n\n        var length = jobBudgets.length;\n        var i;\n\n        var totalBudget = 0.0;\n        for (i = 0; i < length; ++i) {\n            totalBudget += jobBudgets[i].total;\n        }\n\n        var executedThisFrame = new Array(length);\n        for (i = 0; i < length; ++i) {\n            executedThisFrame[i] = false;\n        }\n\n        this._totalBudget = totalBudget;\n        this._totalUsedThisFrame = 0.0;\n        this._budgets = jobBudgets;\n        this._executedThisFrame = executedThisFrame;\n    }\n\n    // For unit testing\n    JobScheduler.getTimestamp = getTimestamp;\n\n    Object.defineProperties(JobScheduler.prototype, {\n        totalBudget : {\n            get : function() {\n                return this._totalBudget;\n            }\n        }\n    });\n\n    JobScheduler.prototype.disableThisFrame = function() {\n        // Prevent jobs from running this frame\n        this._totalUsedThisFrame = this._totalBudget;\n    };\n\n    JobScheduler.prototype.resetBudgets = function() {\n        var budgets = this._budgets;\n        var length = budgets.length;\n        for (var i = 0; i < length; ++i) {\n            var budget = budgets[i];\n            budget.starvedLastFrame = budget.starvedThisFrame;\n            budget.starvedThisFrame = false;\n            budget.usedThisFrame = 0.0;\n            budget.stolenFromMeThisFrame = 0.0;\n        }\n        this._totalUsedThisFrame = 0.0;\n    };\n\n    JobScheduler.prototype.execute = function(job, jobType) {\n        var budgets = this._budgets;\n        var budget = budgets[jobType];\n\n        // This ensures each job type makes progress each frame by executing at least once\n        var progressThisFrame = this._executedThisFrame[jobType];\n\n        if ((this._totalUsedThisFrame >= this._totalBudget) && progressThisFrame) {\n            // No budget left this frame for jobs of any type\n            budget.starvedThisFrame = true;\n            return false;\n        }\n\n        var stolenBudget;\n\n        if ((budget.usedThisFrame + budget.stolenFromMeThisFrame >= budget.total)) {\n            // No budget remaining for jobs of this type. Try to steal from other job types.\n            var length = budgets.length;\n            var i;\n            for (i = 0; i < length; ++i) {\n                stolenBudget = budgets[i];\n\n                // Steal from this budget if it has time left and it wasn't starved last fame\n                if ((stolenBudget.usedThisFrame + stolenBudget.stolenFromMeThisFrame < stolenBudget.total) &&\n                    (!stolenBudget.starvedLastFrame)) {\n                    break;\n                }\n            }\n\n            if (i === length && progressThisFrame) {\n                // No other job types can give up their budget this frame, and\n                // this job type already progressed this frame\n                return false;\n            }\n\n            if (progressThisFrame) {\n                // It is considered \"starved\" even if it executes using stolen time so that\n                // next frame, no other job types can steal time from it.\n                budget.starvedThisFrame = true;\n            }\n        }\n\n        var startTime = JobScheduler.getTimestamp();\n        job.execute();\n        var duration = JobScheduler.getTimestamp() - startTime;\n\n        // Track both time remaining for this job type and all jobs\n        // so budget stealing does send us way over the total budget.\n        this._totalUsedThisFrame += duration;\n\n        if (stolenBudget) {\n            stolenBudget.stolenFromMeThisFrame += duration;\n        } else {\n            budget.usedThisFrame += duration;\n        }\n        this._executedThisFrame[jobType] = true;\n\n        return true;\n    };\nexport default JobScheduler;\n","import defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport getTimestamp from '../Core/getTimestamp.js';\nimport getElement from '../Widgets/getElement.js';\n\n    /**\n     * @private\n     */\n    function PerformanceDisplay(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        var container = getElement(options.container);\n        \n\n        this._container = container;\n\n        var display = document.createElement('div');\n        display.className = 'cesium-performanceDisplay';\n        var fpsElement = document.createElement('div');\n        fpsElement.className = 'cesium-performanceDisplay-fps';\n        this._fpsText = document.createTextNode('');\n        fpsElement.appendChild(this._fpsText);\n        var msElement = document.createElement('div');\n        msElement.className = 'cesium-performanceDisplay-ms';\n        this._msText = document.createTextNode('');\n        msElement.appendChild(this._msText);\n        display.appendChild(msElement);\n        display.appendChild(fpsElement);\n        this._container.appendChild(display);\n\n        this._lastFpsSampleTime = getTimestamp();\n        this._lastMsSampleTime = getTimestamp();\n        this._fpsFrameCount = 0;\n        this._msFrameCount = 0;\n\n        this._throttled = false;\n        var throttledElement = document.createElement('div');\n        throttledElement.className = 'cesium-performanceDisplay-throttled';\n        this._throttledText = document.createTextNode('');\n        throttledElement.appendChild(this._throttledText);\n        display.appendChild(throttledElement);\n    }\n\n     Object.defineProperties(PerformanceDisplay.prototype, {\n        /**\n         * The display should indicate the FPS is being throttled.\n         * @memberof PerformanceDisplay.prototype\n         *\n         * @type {Boolean}\n         */\n        throttled : {\n            get : function() {\n                return this._throttled;\n            },\n            set : function(value) {\n                if (this._throttled === value) {\n                    return;\n                }\n\n                if (value) {\n                    this._throttledText.nodeValue = '(throttled)';\n                } else {\n                    this._throttledText.nodeValue = '';\n                }\n\n                this._throttled = value;\n            }\n        }\n    });\n\n    /**\n     * Update the display.  This function should only be called once per frame, because\n     * each call records a frame in the internal buffer and redraws the display.\n     *\n     * @param {Boolean} [renderedThisFrame=true] If provided, the FPS count will only update and display if true.\n     */\n    PerformanceDisplay.prototype.update = function(renderedThisFrame) {\n        var time = getTimestamp();\n        var updateDisplay = defaultValue(renderedThisFrame, true);\n\n        this._fpsFrameCount++;\n        var fpsElapsedTime = time - this._lastFpsSampleTime;\n        if (fpsElapsedTime > 1000) {\n            var fps = 'N/A';\n            if (updateDisplay) {\n                fps = this._fpsFrameCount * 1000 / fpsElapsedTime | 0;\n            }\n\n            this._fpsText.nodeValue = fps + ' FPS';\n            this._lastFpsSampleTime = time;\n            this._fpsFrameCount = 0;\n        }\n\n        this._msFrameCount++;\n        var msElapsedTime = time - this._lastMsSampleTime;\n        if (msElapsedTime > 200) {\n            var ms = 'N/A';\n            if (updateDisplay) {\n                ms = (msElapsedTime / this._msFrameCount).toFixed(2);\n            }\n\n            this._msText.nodeValue = ms + ' MS';\n            this._lastMsSampleTime = time;\n            this._msFrameCount = 0;\n        }\n    };\n\n    /**\n     * Destroys the WebGL resources held by this object.\n     */\n    PerformanceDisplay.prototype.destroy = function() {\n        return destroyObject(this);\n    };\nexport default PerformanceDisplay;\n","import Cartesian4 from '../Core/Cartesian4.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport PixelFormat from '../Core/PixelFormat.js';\nimport Framebuffer from '../Renderer/Framebuffer.js';\nimport PixelDatatype from '../Renderer/PixelDatatype.js';\nimport RenderState from '../Renderer/RenderState.js';\nimport ShaderSource from '../Renderer/ShaderSource.js';\nimport Texture from '../Renderer/Texture.js';\n\n    /**\n     * @private\n     */\n    function PickDepth() {\n        this._framebuffer = undefined;\n\n        this._depthTexture = undefined;\n        this._textureToCopy = undefined;\n        this._copyDepthCommand = undefined;\n\n        this._useLogDepth = undefined;\n\n        this._debugPickDepthViewportCommand = undefined;\n    }\n\n    function executeDebugPickDepth(pickDepth, context, passState, useLogDepth) {\n        if (!defined(pickDepth._debugPickDepthViewportCommand) || useLogDepth !== pickDepth._useLogDepth) {\n            var fsSource =\n                'uniform sampler2D u_texture;\\n' +\n                'varying vec2 v_textureCoordinates;\\n' +\n                'void main()\\n' +\n                '{\\n' +\n                '    float z_window = czm_unpackDepth(texture2D(u_texture, v_textureCoordinates));\\n' +\n                '    z_window = czm_reverseLogDepth(z_window); \\n' +\n                '    float n_range = czm_depthRange.near;\\n' +\n                '    float f_range = czm_depthRange.far;\\n' +\n                '    float z_ndc = (2.0 * z_window - n_range - f_range) / (f_range - n_range);\\n' +\n                '    float scale = pow(z_ndc * 0.5 + 0.5, 8.0);\\n' +\n                '    gl_FragColor = vec4(mix(vec3(0.0), vec3(1.0), scale), 1.0);\\n' +\n                '}\\n';\n            var fs = new ShaderSource({\n                defines : [useLogDepth ? 'LOG_DEPTH' : ''],\n                sources : [fsSource]\n            });\n\n            pickDepth._debugPickDepthViewportCommand = context.createViewportQuadCommand(fs, {\n                uniformMap : {\n                    u_texture : function() {\n                        return pickDepth._depthTexture;\n                    }\n                },\n                owner : pickDepth\n            });\n\n            pickDepth._useLogDepth = useLogDepth;\n        }\n\n        pickDepth._debugPickDepthViewportCommand.execute(context, passState);\n    }\n\n    function destroyTextures(pickDepth) {\n        pickDepth._depthTexture = pickDepth._depthTexture && !pickDepth._depthTexture.isDestroyed() && pickDepth._depthTexture.destroy();\n    }\n\n    function destroyFramebuffers(pickDepth) {\n        pickDepth._framebuffer = pickDepth._framebuffer && !pickDepth._framebuffer.isDestroyed() && pickDepth._framebuffer.destroy();\n    }\n\n    function createTextures(pickDepth, context, width, height) {\n        pickDepth._depthTexture = new Texture({\n            context : context,\n            width : width,\n            height : height,\n            pixelFormat : PixelFormat.RGBA,\n            pixelDatatype : PixelDatatype.UNSIGNED_BYTE\n        });\n    }\n\n    function createFramebuffers(pickDepth, context, width, height) {\n        destroyTextures(pickDepth);\n        destroyFramebuffers(pickDepth);\n\n        createTextures(pickDepth, context, width, height);\n\n        pickDepth._framebuffer = new Framebuffer({\n            context : context,\n            colorTextures : [pickDepth._depthTexture],\n            destroyAttachments : false\n        });\n    }\n\n    function updateFramebuffers(pickDepth, context, depthTexture) {\n        var width = depthTexture.width;\n        var height = depthTexture.height;\n\n        var texture = pickDepth._depthTexture;\n        var textureChanged = !defined(texture) || texture.width !== width || texture.height !== height;\n        if (!defined(pickDepth._framebuffer) || textureChanged) {\n            createFramebuffers(pickDepth, context, width, height);\n        }\n    }\n\n    function updateCopyCommands(pickDepth, context, depthTexture) {\n        if (!defined(pickDepth._copyDepthCommand)) {\n            var fs =\n                'uniform sampler2D u_texture;\\n' +\n                'varying vec2 v_textureCoordinates;\\n' +\n                'void main()\\n' +\n                '{\\n' +\n                '    gl_FragColor = czm_packDepth(texture2D(u_texture, v_textureCoordinates).r);\\n' +\n                '}\\n';\n            pickDepth._copyDepthCommand = context.createViewportQuadCommand(fs, {\n                renderState : RenderState.fromCache(),\n                uniformMap : {\n                    u_texture : function() {\n                        return pickDepth._textureToCopy;\n                    }\n                },\n                owner : pickDepth\n            });\n        }\n\n        pickDepth._textureToCopy = depthTexture;\n        pickDepth._copyDepthCommand.framebuffer = pickDepth._framebuffer;\n    }\n\n    PickDepth.prototype.executeDebugPickDepth = function(context, passState, useLogDepth) {\n        executeDebugPickDepth(this, context, passState, useLogDepth);\n    };\n\n    PickDepth.prototype.update = function(context, depthTexture) {\n        updateFramebuffers(this, context, depthTexture);\n        updateCopyCommands(this, context, depthTexture);\n    };\n\n    var scratchPackedDepth = new Cartesian4();\n    var packedDepthScale = new Cartesian4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0);\n\n    PickDepth.prototype.getDepth = function(context, x, y) {\n        var pixels = context.readPixels({\n            x : x,\n            y : y,\n            width : 1,\n            height : 1,\n            framebuffer : this._framebuffer\n        });\n\n        var packedDepth = Cartesian4.unpack(pixels, 0, scratchPackedDepth);\n        Cartesian4.divideByScalar(packedDepth, 255.0, packedDepth);\n        return Cartesian4.dot(packedDepth, packedDepthScale);\n    };\n\n    PickDepth.prototype.executeCopyDepth = function(context, passState) {\n        this._copyDepthCommand.execute(context, passState);\n    };\n\n    PickDepth.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    PickDepth.prototype.destroy = function() {\n        destroyTextures(this);\n        destroyFramebuffers(this);\n\n        this._copyDepthCommand.shaderProgram = defined(this._copyDepthCommand.shaderProgram) && this._copyDepthCommand.shaderProgram.destroy();\n\n        return destroyObject(this);\n    };\nexport default PickDepth;\n","import defaultValue from '../Core/defaultValue.js';\nimport Pass from '../Renderer/Pass.js';\n\n    /**\n     * Defines a list of commands whose geometry are bound by near and far distances from the camera.\n     * @alias FrustumCommands\n     * @constructor\n     *\n     * @param {Number} [near=0.0] The lower bound or closest distance from the camera.\n     * @param {Number} [far=0.0] The upper bound or farthest distance from the camera.\n     *\n     * @private\n     */\n    function FrustumCommands(near, far) {\n        this.near = defaultValue(near, 0.0);\n        this.far = defaultValue(far, 0.0);\n\n        var numPasses = Pass.NUMBER_OF_PASSES;\n        var commands = new Array(numPasses);\n        var indices = new Array(numPasses);\n\n        for (var i = 0; i < numPasses; ++i) {\n            commands[i] = [];\n            indices[i] = 0;\n        }\n\n        this.commands = commands;\n        this.indices = indices;\n    }\nexport default FrustumCommands;\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"#ifdef MRT\\n\\\n#extension GL_EXT_draw_buffers : enable\\n\\\n#endif\\n\\\n\\n\\\nuniform vec4 u_bgColor;\\n\\\nuniform sampler2D u_depthTexture;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    if (texture2D(u_depthTexture, v_textureCoordinates).r < 1.0)\\n\\\n    {\\n\\\n#ifdef MRT\\n\\\n        gl_FragData[0] = u_bgColor;\\n\\\n        gl_FragData[1] = vec4(u_bgColor.a);\\n\\\n#else\\n\\\n        gl_FragColor = u_bgColor;\\n\\\n#endif\\n\\\n        return;\\n\\\n    }\\n\\\n    \\n\\\n    discard;\\n\\\n}\\n\\\n\";\n","import BoundingRectangle from '../Core/BoundingRectangle.js';\nimport Color from '../Core/Color.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport PixelFormat from '../Core/PixelFormat.js';\nimport WebGLConstants from '../Core/WebGLConstants.js';\nimport ClearCommand from '../Renderer/ClearCommand.js';\nimport DrawCommand from '../Renderer/DrawCommand.js';\nimport Framebuffer from '../Renderer/Framebuffer.js';\nimport PixelDatatype from '../Renderer/PixelDatatype.js';\nimport RenderState from '../Renderer/RenderState.js';\nimport ShaderSource from '../Renderer/ShaderSource.js';\nimport Texture from '../Renderer/Texture.js';\nimport AdjustTranslucentFS from '../Shaders/AdjustTranslucentFS.js';\nimport CompositeOITFS from '../Shaders/CompositeOITFS.js';\nimport BlendEquation from './BlendEquation.js';\nimport BlendFunction from './BlendFunction.js';\n\n    /**\n     * @private\n     */\n    function OIT(context) {\n        // We support multipass for the Chrome D3D9 backend and ES 2.0 on mobile.\n        this._translucentMultipassSupport = false;\n        this._translucentMRTSupport = false;\n\n        var extensionsSupported = context.colorBufferFloat && context.depthTexture;\n        this._translucentMRTSupport = context.drawBuffers && extensionsSupported;\n        this._translucentMultipassSupport = !this._translucentMRTSupport && extensionsSupported;\n\n        this._opaqueFBO = undefined;\n        this._opaqueTexture = undefined;\n        this._depthStencilTexture = undefined;\n\n        this._accumulationTexture = undefined;\n\n        this._translucentFBO = undefined;\n        this._alphaFBO = undefined;\n\n        this._adjustTranslucentFBO = undefined;\n        this._adjustAlphaFBO = undefined;\n\n        this._opaqueClearCommand = new ClearCommand({\n            color : new Color(0.0, 0.0, 0.0, 0.0),\n            owner : this\n        });\n        this._translucentMRTClearCommand = new ClearCommand({\n            color : new Color(0.0, 0.0, 0.0, 1.0),\n            owner : this\n        });\n        this._translucentMultipassClearCommand = new ClearCommand({\n            color : new Color(0.0, 0.0, 0.0, 0.0),\n            owner : this\n        });\n        this._alphaClearCommand = new ClearCommand({\n            color : new Color(1.0, 1.0, 1.0, 1.0),\n            owner : this\n        });\n\n        this._translucentRenderStateCache = {};\n        this._alphaRenderStateCache = {};\n\n        this._compositeCommand = undefined;\n        this._adjustTranslucentCommand = undefined;\n        this._adjustAlphaCommand = undefined;\n\n        this._viewport = new BoundingRectangle();\n        this._rs = undefined;\n\n        this._useScissorTest = false;\n        this._scissorRectangle = undefined;\n\n        this._useHDR = false;\n    }\n\n    function destroyTextures(oit) {\n        oit._accumulationTexture = oit._accumulationTexture && !oit._accumulationTexture.isDestroyed() && oit._accumulationTexture.destroy();\n        oit._revealageTexture = oit._revealageTexture && !oit._revealageTexture.isDestroyed() && oit._revealageTexture.destroy();\n    }\n\n    function destroyFramebuffers(oit) {\n        oit._translucentFBO = oit._translucentFBO && !oit._translucentFBO.isDestroyed() && oit._translucentFBO.destroy();\n        oit._alphaFBO = oit._alphaFBO && !oit._alphaFBO.isDestroyed() && oit._alphaFBO.destroy();\n        oit._adjustTranslucentFBO = oit._adjustTranslucentFBO && !oit._adjustTranslucentFBO.isDestroyed() && oit._adjustTranslucentFBO.destroy();\n        oit._adjustAlphaFBO = oit._adjustAlphaFBO && !oit._adjustAlphaFBO.isDestroyed() && oit._adjustAlphaFBO.destroy();\n    }\n\n    function destroyResources(oit) {\n        destroyTextures(oit);\n        destroyFramebuffers(oit);\n    }\n\n    function updateTextures(oit, context, width, height) {\n        destroyTextures(oit);\n\n        oit._accumulationTexture = new Texture({\n            context : context,\n            width : width,\n            height : height,\n            pixelFormat : PixelFormat.RGBA,\n            pixelDatatype : PixelDatatype.FLOAT\n        });\n\n        // Use zeroed arraybuffer instead of null to initialize texture\n        // to workaround Firefox. Only needed for the second color attachment.\n        var source = new Float32Array(width * height * 4);\n        oit._revealageTexture = new Texture({\n            context : context,\n            pixelFormat : PixelFormat.RGBA,\n            pixelDatatype : PixelDatatype.FLOAT,\n            source : {\n                arrayBufferView : source,\n                width : width,\n                height : height\n            },\n            flipY : false\n        });\n    }\n\n    function updateFramebuffers(oit, context) {\n        destroyFramebuffers(oit);\n\n        var completeFBO = WebGLConstants.FRAMEBUFFER_COMPLETE;\n        var supported = true;\n\n        // if MRT is supported, attempt to make an FBO with multiple color attachments\n        if (oit._translucentMRTSupport) {\n            oit._translucentFBO = new Framebuffer({\n                context : context,\n                colorTextures : [oit._accumulationTexture, oit._revealageTexture],\n                depthStencilTexture : oit._depthStencilTexture,\n                destroyAttachments : false\n            });\n            oit._adjustTranslucentFBO = new Framebuffer({\n                context : context,\n                colorTextures : [oit._accumulationTexture, oit._revealageTexture],\n                destroyAttachments : false\n            });\n\n            if (oit._translucentFBO.status !== completeFBO || oit._adjustTranslucentFBO.status !== completeFBO) {\n                destroyFramebuffers(oit);\n                oit._translucentMRTSupport = false;\n            }\n        }\n\n        // either MRT isn't supported or FBO creation failed, attempt multipass\n        if (!oit._translucentMRTSupport) {\n            oit._translucentFBO = new Framebuffer({\n                context : context,\n                colorTextures : [oit._accumulationTexture],\n                depthStencilTexture : oit._depthStencilTexture,\n                destroyAttachments : false\n            });\n            oit._alphaFBO = new Framebuffer({\n                context : context,\n                colorTextures : [oit._revealageTexture],\n                depthStencilTexture : oit._depthStencilTexture,\n                destroyAttachments : false\n            });\n            oit._adjustTranslucentFBO = new Framebuffer({\n                context : context,\n                colorTextures : [oit._accumulationTexture],\n                destroyAttachments : false\n            });\n            oit._adjustAlphaFBO = new Framebuffer({\n                context : context,\n                colorTextures : [oit._revealageTexture],\n                destroyAttachments : false\n            });\n\n            var translucentComplete = oit._translucentFBO.status === completeFBO;\n            var alphaComplete = oit._alphaFBO.status === completeFBO;\n            var adjustTranslucentComplete = oit._adjustTranslucentFBO.status === completeFBO;\n            var adjustAlphaComplete = oit._adjustAlphaFBO.status === completeFBO;\n            if (!translucentComplete || !alphaComplete || !adjustTranslucentComplete || !adjustAlphaComplete) {\n                destroyResources(oit);\n                oit._translucentMultipassSupport = false;\n                supported = false;\n            }\n        }\n\n        return supported;\n    }\n\n    OIT.prototype.update = function(context, passState, framebuffer, useHDR) {\n        if (!this.isSupported()) {\n            return;\n        }\n\n        this._opaqueFBO = framebuffer;\n        this._opaqueTexture = framebuffer.getColorTexture(0);\n        this._depthStencilTexture = framebuffer.depthStencilTexture;\n\n        var width = this._opaqueTexture.width;\n        var height = this._opaqueTexture.height;\n\n        var accumulationTexture = this._accumulationTexture;\n        var textureChanged = !defined(accumulationTexture) || accumulationTexture.width !== width || accumulationTexture.height !== height || useHDR !== this._useHDR;\n        if (textureChanged) {\n            updateTextures(this, context, width, height);\n        }\n\n        if (!defined(this._translucentFBO) || textureChanged) {\n            if (!updateFramebuffers(this, context)) {\n                // framebuffer creation failed\n                return;\n            }\n        }\n\n        this._useHDR = useHDR;\n\n        var that = this;\n        var fs;\n        var uniformMap;\n\n        if (!defined(this._compositeCommand)) {\n            fs = new ShaderSource({\n                sources : [CompositeOITFS]\n            });\n            if (this._translucentMRTSupport) {\n                fs.defines.push('MRT');\n            }\n\n            uniformMap = {\n                u_opaque : function() {\n                    return that._opaqueTexture;\n                },\n                u_accumulation : function() {\n                    return that._accumulationTexture;\n                },\n                u_revealage : function() {\n                    return that._revealageTexture;\n                }\n            };\n            this._compositeCommand = context.createViewportQuadCommand(fs, {\n                uniformMap : uniformMap,\n                owner : this\n            });\n        }\n\n        if (!defined(this._adjustTranslucentCommand)) {\n            if (this._translucentMRTSupport) {\n                fs = new ShaderSource({\n                    defines : ['MRT'],\n                    sources : [AdjustTranslucentFS]\n                });\n\n                uniformMap = {\n                    u_bgColor : function() {\n                        return that._translucentMRTClearCommand.color;\n                    },\n                    u_depthTexture : function() {\n                        return that._depthStencilTexture;\n                    }\n                };\n\n                this._adjustTranslucentCommand = context.createViewportQuadCommand(fs, {\n                    uniformMap : uniformMap,\n                    owner : this\n                });\n            } else if (this._translucentMultipassSupport) {\n                fs = new ShaderSource({\n                    sources : [AdjustTranslucentFS]\n                });\n\n                uniformMap = {\n                    u_bgColor : function() {\n                        return that._translucentMultipassClearCommand.color;\n                    },\n                    u_depthTexture : function() {\n                        return that._depthStencilTexture;\n                    }\n                };\n\n                this._adjustTranslucentCommand = context.createViewportQuadCommand(fs, {\n                    uniformMap : uniformMap,\n                    owner : this\n                });\n\n                uniformMap = {\n                    u_bgColor : function() {\n                        return that._alphaClearCommand.color;\n                    },\n                    u_depthTexture : function() {\n                        return that._depthStencilTexture;\n                    }\n                };\n\n                this._adjustAlphaCommand = context.createViewportQuadCommand(fs, {\n                    uniformMap : uniformMap,\n                    owner : this\n                });\n            }\n        }\n\n        this._viewport.width = width;\n        this._viewport.height = height;\n\n        var useScissorTest = !BoundingRectangle.equals(this._viewport, passState.viewport);\n        var updateScissor = useScissorTest !== this._useScissorTest;\n        this._useScissorTest = useScissorTest;\n\n        if (!BoundingRectangle.equals(this._scissorRectangle, passState.viewport)) {\n            this._scissorRectangle = BoundingRectangle.clone(passState.viewport, this._scissorRectangle);\n            updateScissor = true;\n        }\n\n        if (!defined(this._rs) || !BoundingRectangle.equals(this._viewport, this._rs.viewport) || updateScissor) {\n            this._rs = RenderState.fromCache({\n                viewport : this._viewport,\n                scissorTest : {\n                    enabled : this._useScissorTest,\n                    rectangle : this._scissorRectangle\n                }\n            });\n        }\n\n        if (defined(this._compositeCommand)) {\n            this._compositeCommand.renderState = this._rs;\n        }\n\n        if (this._adjustTranslucentCommand) {\n            this._adjustTranslucentCommand.renderState = this._rs;\n        }\n\n        if (defined(this._adjustAlphaCommand)) {\n            this._adjustAlphaCommand.renderState = this._rs;\n        }\n    };\n\n    var translucentMRTBlend = {\n        enabled : true,\n        color : new Color(0.0, 0.0, 0.0, 0.0),\n        equationRgb : BlendEquation.ADD,\n        equationAlpha : BlendEquation.ADD,\n        functionSourceRgb : BlendFunction.ONE,\n        functionDestinationRgb : BlendFunction.ONE,\n        functionSourceAlpha : BlendFunction.ZERO,\n        functionDestinationAlpha : BlendFunction.ONE_MINUS_SOURCE_ALPHA\n    };\n\n    var translucentColorBlend = {\n        enabled : true,\n        color : new Color(0.0, 0.0, 0.0, 0.0),\n        equationRgb : BlendEquation.ADD,\n        equationAlpha : BlendEquation.ADD,\n        functionSourceRgb : BlendFunction.ONE,\n        functionDestinationRgb : BlendFunction.ONE,\n        functionSourceAlpha : BlendFunction.ONE,\n        functionDestinationAlpha : BlendFunction.ONE\n    };\n\n    var translucentAlphaBlend = {\n        enabled : true,\n        color : new Color(0.0, 0.0, 0.0, 0.0),\n        equationRgb : BlendEquation.ADD,\n        equationAlpha : BlendEquation.ADD,\n        functionSourceRgb : BlendFunction.ZERO,\n        functionDestinationRgb : BlendFunction.ONE_MINUS_SOURCE_ALPHA,\n        functionSourceAlpha : BlendFunction.ZERO,\n        functionDestinationAlpha : BlendFunction.ONE_MINUS_SOURCE_ALPHA\n    };\n\n    function getTranslucentRenderState(context, translucentBlending, cache, renderState) {\n        var translucentState = cache[renderState.id];\n        if (!defined(translucentState)) {\n            var rs = RenderState.getState(renderState);\n            rs.depthMask = false;\n            rs.blending = translucentBlending;\n\n            translucentState = RenderState.fromCache(rs);\n            cache[renderState.id] = translucentState;\n        }\n\n        return translucentState;\n    }\n\n    function getTranslucentMRTRenderState(oit, context, renderState) {\n        return getTranslucentRenderState(context, translucentMRTBlend, oit._translucentRenderStateCache, renderState);\n    }\n\n    function getTranslucentColorRenderState(oit, context, renderState) {\n        return getTranslucentRenderState(context, translucentColorBlend, oit._translucentRenderStateCache, renderState);\n    }\n\n    function getTranslucentAlphaRenderState(oit, context, renderState) {\n        return getTranslucentRenderState(context, translucentAlphaBlend, oit._alphaRenderStateCache, renderState);\n    }\n\n    var mrtShaderSource =\n        '    vec3 Ci = czm_gl_FragColor.rgb * czm_gl_FragColor.a;\\n' +\n        '    float ai = czm_gl_FragColor.a;\\n' +\n        '    float wzi = czm_alphaWeight(ai);\\n' +\n        '    gl_FragData[0] = vec4(Ci * wzi, ai);\\n' +\n        '    gl_FragData[1] = vec4(ai * wzi);\\n';\n\n    var colorShaderSource =\n        '    vec3 Ci = czm_gl_FragColor.rgb * czm_gl_FragColor.a;\\n' +\n        '    float ai = czm_gl_FragColor.a;\\n' +\n        '    float wzi = czm_alphaWeight(ai);\\n' +\n        '    gl_FragColor = vec4(Ci, ai) * wzi;\\n';\n\n    var alphaShaderSource =\n        '    float ai = czm_gl_FragColor.a;\\n' +\n        '    gl_FragColor = vec4(ai);\\n';\n\n    function getTranslucentShaderProgram(context, shaderProgram, keyword, source) {\n        var shader = context.shaderCache.getDerivedShaderProgram(shaderProgram, keyword);\n        if (!defined(shader)) {\n            var attributeLocations = shaderProgram._attributeLocations;\n\n            var fs = shaderProgram.fragmentShaderSource.clone();\n\n            fs.sources = fs.sources.map(function(source) {\n                source = ShaderSource.replaceMain(source, 'czm_translucent_main');\n                source = source.replace(/gl_FragColor/g, 'czm_gl_FragColor');\n                source = source.replace(/\\bdiscard\\b/g, 'czm_discard = true');\n                source = source.replace(/czm_phong/g, 'czm_translucentPhong');\n                return source;\n            });\n\n            // Discarding the fragment in main is a workaround for ANGLE D3D9\n            // shader compilation errors.\n\n            fs.sources.splice(0, 0,\n                (source.indexOf('gl_FragData') !== -1 ? '#extension GL_EXT_draw_buffers : enable \\n' : '') +\n                'vec4 czm_gl_FragColor;\\n' +\n                'bool czm_discard = false;\\n');\n\n            fs.sources.push(\n                'void main()\\n' +\n                '{\\n' +\n                '    czm_translucent_main();\\n' +\n                '    if (czm_discard)\\n' +\n                '    {\\n' +\n                '        discard;\\n' +\n                '    }\\n' +\n                source +\n                '}\\n');\n\n            shader = context.shaderCache.createDerivedShaderProgram(shaderProgram, keyword, {\n                vertexShaderSource : shaderProgram.vertexShaderSource,\n                fragmentShaderSource : fs,\n                attributeLocations : attributeLocations\n            });\n        }\n\n        return shader;\n    }\n\n    function getTranslucentMRTShaderProgram(context, shaderProgram) {\n        return getTranslucentShaderProgram(context, shaderProgram, 'translucentMRT', mrtShaderSource);\n    }\n\n    function getTranslucentColorShaderProgram(context, shaderProgram) {\n        return getTranslucentShaderProgram(context, shaderProgram, 'translucentMultipass', colorShaderSource);\n    }\n\n    function getTranslucentAlphaShaderProgram(context, shaderProgram) {\n        return getTranslucentShaderProgram(context, shaderProgram, 'alphaMultipass', alphaShaderSource);\n    }\n\n    OIT.prototype.createDerivedCommands = function(command, context, result) {\n        if (!defined(result)) {\n            result = {};\n        }\n\n        if (this._translucentMRTSupport) {\n            var translucentShader;\n            var translucentRenderState;\n            if (defined(result.translucentCommand)) {\n                translucentShader = result.translucentCommand.shaderProgram;\n                translucentRenderState = result.translucentCommand.renderState;\n            }\n\n            result.translucentCommand = DrawCommand.shallowClone(command, result.translucentCommand);\n\n            if (!defined(translucentShader) || result.shaderProgramId !== command.shaderProgram.id) {\n                result.translucentCommand.shaderProgram = getTranslucentMRTShaderProgram(context, command.shaderProgram);\n                result.translucentCommand.renderState = getTranslucentMRTRenderState(this, context, command.renderState);\n                result.shaderProgramId = command.shaderProgram.id;\n            } else {\n                result.translucentCommand.shaderProgram = translucentShader;\n                result.translucentCommand.renderState = translucentRenderState;\n            }\n        } else {\n            var colorShader;\n            var colorRenderState;\n            var alphaShader;\n            var alphaRenderState;\n            if (defined(result.translucentCommand)) {\n                colorShader = result.translucentCommand.shaderProgram;\n                colorRenderState = result.translucentCommand.renderState;\n                alphaShader = result.alphaCommand.shaderProgram;\n                alphaRenderState = result.alphaCommand.renderState;\n            }\n\n            result.translucentCommand = DrawCommand.shallowClone(command, result.translucentCommand);\n            result.alphaCommand = DrawCommand.shallowClone(command, result.alphaCommand);\n\n            if (!defined(colorShader) || result.shaderProgramId !== command.shaderProgram.id) {\n                result.translucentCommand.shaderProgram = getTranslucentColorShaderProgram(context, command.shaderProgram);\n                result.translucentCommand.renderState = getTranslucentColorRenderState(this, context, command.renderState);\n                result.alphaCommand.shaderProgram = getTranslucentAlphaShaderProgram(context, command.shaderProgram);\n                result.alphaCommand.renderState = getTranslucentAlphaRenderState(this, context, command.renderState);\n                result.shaderProgramId = command.shaderProgram.id;\n            } else {\n                result.translucentCommand.shaderProgram = colorShader;\n                result.translucentCommand.renderState = colorRenderState;\n                result.alphaCommand.shaderProgram = alphaShader;\n                result.alphaCommand.renderState = alphaRenderState;\n            }\n        }\n\n        return result;\n    };\n\n    function executeTranslucentCommandsSortedMultipass(oit, scene, executeFunction, passState, commands, invertClassification) {\n        var command;\n        var derivedCommand;\n        var j;\n\n        var context = scene.context;\n        var useLogDepth = scene.frameState.useLogDepth;\n        var useHdr = scene._hdr;\n        var framebuffer = passState.framebuffer;\n        var length = commands.length;\n\n        var lightShadowsEnabled = scene.frameState.shadowState.lightShadowsEnabled;\n\n        passState.framebuffer = oit._adjustTranslucentFBO;\n        oit._adjustTranslucentCommand.execute(context, passState);\n        passState.framebuffer = oit._adjustAlphaFBO;\n        oit._adjustAlphaCommand.execute(context, passState);\n\n        var debugFramebuffer = oit._opaqueFBO;\n        passState.framebuffer = oit._translucentFBO;\n\n        for (j = 0; j < length; ++j) {\n            command = commands[j];\n            command = useLogDepth ? command.derivedCommands.logDepth.command : command;\n            command = useHdr ? command.derivedCommands.hdr.command : command;\n            derivedCommand = (lightShadowsEnabled && command.receiveShadows) ? command.derivedCommands.oit.shadows.translucentCommand : command.derivedCommands.oit.translucentCommand;\n            executeFunction(derivedCommand, scene, context, passState, debugFramebuffer);\n        }\n\n        if (defined(invertClassification)) {\n            command = invertClassification.unclassifiedCommand;\n            derivedCommand = (lightShadowsEnabled && command.receiveShadows) ? command.derivedCommands.oit.shadows.translucentCommand : command.derivedCommands.oit.translucentCommand;\n            executeFunction(derivedCommand, scene, context, passState, debugFramebuffer);\n        }\n\n        passState.framebuffer = oit._alphaFBO;\n\n        for (j = 0; j < length; ++j) {\n            command = commands[j];\n            command = useLogDepth ? command.derivedCommands.logDepth.command : command;\n            command = useHdr ? command.derivedCommands.hdr.command : command;\n            derivedCommand = (lightShadowsEnabled && command.receiveShadows) ? command.derivedCommands.oit.shadows.alphaCommand : command.derivedCommands.oit.alphaCommand;\n            executeFunction(derivedCommand, scene, context, passState, debugFramebuffer);\n        }\n\n        if (defined(invertClassification)) {\n            command = invertClassification.unclassifiedCommand;\n            derivedCommand = (lightShadowsEnabled && command.receiveShadows) ? command.derivedCommands.oit.shadows.alphaCommand : command.derivedCommands.oit.alphaCommand;\n            executeFunction(derivedCommand, scene, context, passState, debugFramebuffer);\n        }\n\n        passState.framebuffer = framebuffer;\n    }\n\n    function executeTranslucentCommandsSortedMRT(oit, scene, executeFunction, passState, commands, invertClassification) {\n        var context = scene.context;\n        var useLogDepth = scene.frameState.useLogDepth;\n        var useHdr = scene._hdr;\n        var framebuffer = passState.framebuffer;\n        var length = commands.length;\n\n        var lightShadowsEnabled = scene.frameState.shadowState.lightShadowsEnabled;\n\n        passState.framebuffer = oit._adjustTranslucentFBO;\n        oit._adjustTranslucentCommand.execute(context, passState);\n\n        var debugFramebuffer = oit._opaqueFBO;\n        passState.framebuffer = oit._translucentFBO;\n\n        var command;\n        var derivedCommand;\n\n        for (var j = 0; j < length; ++j) {\n            command = commands[j];\n            command = useLogDepth ? command.derivedCommands.logDepth.command : command;\n            command = useHdr ? command.derivedCommands.hdr.command : command;\n            derivedCommand = (lightShadowsEnabled && command.receiveShadows) ? command.derivedCommands.oit.shadows.translucentCommand : command.derivedCommands.oit.translucentCommand;\n            executeFunction(derivedCommand, scene, context, passState, debugFramebuffer);\n        }\n\n        if (defined(invertClassification)) {\n            command = invertClassification.unclassifiedCommand;\n            derivedCommand = (lightShadowsEnabled && command.receiveShadows) ? command.derivedCommands.oit.shadows.translucentCommand : command.derivedCommands.oit.translucentCommand;\n            executeFunction(derivedCommand, scene, context, passState, debugFramebuffer);\n        }\n\n        passState.framebuffer = framebuffer;\n    }\n\n    OIT.prototype.executeCommands = function(scene, executeFunction, passState, commands, invertClassification) {\n        if (this._translucentMRTSupport) {\n            executeTranslucentCommandsSortedMRT(this, scene, executeFunction, passState, commands, invertClassification);\n            return;\n        }\n\n        executeTranslucentCommandsSortedMultipass(this, scene, executeFunction, passState, commands, invertClassification);\n    };\n\n    OIT.prototype.execute = function(context, passState) {\n        this._compositeCommand.execute(context, passState);\n    };\n\n    OIT.prototype.clear = function(context, passState, clearColor) {\n        var framebuffer = passState.framebuffer;\n\n        passState.framebuffer = this._opaqueFBO;\n        Color.clone(clearColor, this._opaqueClearCommand.color);\n        this._opaqueClearCommand.execute(context, passState);\n\n        passState.framebuffer = this._translucentFBO;\n        var translucentClearCommand = this._translucentMRTSupport ? this._translucentMRTClearCommand : this._translucentMultipassClearCommand;\n        translucentClearCommand.execute(context, passState);\n\n        if (this._translucentMultipassSupport) {\n            passState.framebuffer = this._alphaFBO;\n            this._alphaClearCommand.execute(context, passState);\n        }\n\n        passState.framebuffer = framebuffer;\n    };\n\n    OIT.prototype.isSupported = function() {\n        return this._translucentMRTSupport || this._translucentMultipassSupport;\n    };\n\n    OIT.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    OIT.prototype.destroy = function() {\n        destroyResources(this);\n\n        if (defined(this._compositeCommand)) {\n            this._compositeCommand.shaderProgram = this._compositeCommand.shaderProgram && this._compositeCommand.shaderProgram.destroy();\n        }\n\n        if (defined(this._adjustTranslucentCommand)) {\n            this._adjustTranslucentCommand.shaderProgram = this._adjustTranslucentCommand.shaderProgram && this._adjustTranslucentCommand.shaderProgram.destroy();\n        }\n\n        if (defined(this._adjustAlphaCommand)) {\n            this._adjustAlphaCommand.shaderProgram = this._adjustAlphaCommand.shaderProgram && this._adjustAlphaCommand.shaderProgram.destroy();\n        }\n\n        return destroyObject(this);\n    };\nexport default OIT;\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"/**\\n\\\n * Compositing for Weighted Blended Order-Independent Transparency. See:\\n\\\n * - http://jcgt.org/published/0002/02/09/\\n\\\n * - http://casual-effects.blogspot.com/2014/03/weighted-blended-order-independent.html\\n\\\n */\\n\\\n\\n\\\nuniform sampler2D u_opaque;\\n\\\nuniform sampler2D u_accumulation;\\n\\\nuniform sampler2D u_revealage;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    vec4 opaque = texture2D(u_opaque, v_textureCoordinates);\\n\\\n    vec4 accum = texture2D(u_accumulation, v_textureCoordinates);\\n\\\n    float r = texture2D(u_revealage, v_textureCoordinates).r;\\n\\\n\\n\\\n#ifdef MRT\\n\\\n    vec4 transparent = vec4(accum.rgb / clamp(r, 1e-4, 5e4), accum.a);\\n\\\n#else\\n\\\n    vec4 transparent = vec4(accum.rgb / clamp(accum.a, 1e-4, 5e4), r);\\n\\\n#endif\\n\\\n\\n\\\n    gl_FragColor = (1.0 - transparent.a) * transparent + transparent.a * opaque;\\n\\\n\\n\\\n    if (opaque != czm_backgroundColor)\\n\\\n    {\\n\\\n        gl_FragColor.a = 1.0;\\n\\\n    }\\n\\\n}\\n\\\n\";\n","import BoundingRectangle from '../Core/BoundingRectangle.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport PixelFormat from '../Core/PixelFormat.js';\nimport Framebuffer from '../Renderer/Framebuffer.js';\nimport PassState from '../Renderer/PassState.js';\nimport PixelDatatype from '../Renderer/PixelDatatype.js';\nimport Texture from '../Renderer/Texture.js';\n\n    /**\n     * @private\n     */\n    function PickDepthFramebuffer() {\n        this._depthStencilTexture = undefined;\n        this._framebuffer = undefined;\n        this._passState = undefined;\n    }\n\n    function destroyResources(pickDepth) {\n        pickDepth._framebuffer = pickDepth._framebuffer && pickDepth._framebuffer.destroy();\n        pickDepth._depthStencilTexture = pickDepth._depthStencilTexture && pickDepth._depthStencilTexture.destroy();\n    }\n\n    function createResources(pickDepth, context) {\n        var width = context.drawingBufferWidth;\n        var height = context.drawingBufferHeight;\n\n        pickDepth._depthStencilTexture = new Texture({\n            context : context,\n            width : width,\n            height : height,\n            pixelFormat : PixelFormat.DEPTH_STENCIL,\n            pixelDatatype : PixelDatatype.UNSIGNED_INT_24_8\n        });\n\n        pickDepth._framebuffer = new Framebuffer({\n            context : context,\n            depthStencilTexture : pickDepth._depthStencilTexture,\n            destroyAttachments : false\n        });\n\n        var passState = new PassState(context);\n        passState.blendingEnabled = false;\n        passState.scissorTest = {\n            enabled : true,\n            rectangle : new BoundingRectangle()\n        };\n        passState.viewport = new BoundingRectangle();\n        pickDepth._passState = passState;\n    }\n\n    PickDepthFramebuffer.prototype.update = function(context, drawingBufferPosition, viewport) {\n        var width = viewport.width;\n        var height = viewport.height;\n\n        if (!defined(this._framebuffer) || width !== this._depthStencilTexture.width || height !== this._depthStencilTexture.height) {\n            destroyResources(this);\n            createResources(this, context);\n        }\n\n        var framebuffer = this._framebuffer;\n        var passState = this._passState;\n        passState.framebuffer = framebuffer;\n        passState.viewport.width = width;\n        passState.viewport.height = height;\n        passState.scissorTest.rectangle.x = drawingBufferPosition.x;\n        passState.scissorTest.rectangle.y = height - drawingBufferPosition.y;\n        passState.scissorTest.rectangle.width = 1;\n        passState.scissorTest.rectangle.height = 1;\n\n        return passState;\n    };\n\n    PickDepthFramebuffer.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    PickDepthFramebuffer.prototype.destroy = function() {\n        destroyResources(this);\n        return destroyObject(this);\n    };\nexport default PickDepthFramebuffer;\n","import WebGLConstants from '../Core/WebGLConstants.js';\n\n    /**\n     * @private\n     */\n    var RenderbufferFormat = {\n        RGBA4 : WebGLConstants.RGBA4,\n        RGB5_A1 : WebGLConstants.RGB5_A1,\n        RGB565 : WebGLConstants.RGB565,\n        DEPTH_COMPONENT16 : WebGLConstants.DEPTH_COMPONENT16,\n        STENCIL_INDEX8 : WebGLConstants.STENCIL_INDEX8,\n        DEPTH_STENCIL : WebGLConstants.DEPTH_STENCIL,\n\n        validate : function(renderbufferFormat) {\n            return ((renderbufferFormat === RenderbufferFormat.RGBA4) ||\n                    (renderbufferFormat === RenderbufferFormat.RGB5_A1) ||\n                    (renderbufferFormat === RenderbufferFormat.RGB565) ||\n                    (renderbufferFormat === RenderbufferFormat.DEPTH_COMPONENT16) ||\n                    (renderbufferFormat === RenderbufferFormat.STENCIL_INDEX8) ||\n                    (renderbufferFormat === RenderbufferFormat.DEPTH_STENCIL));\n        }\n    };\nexport default Object.freeze(RenderbufferFormat);\n","import Check from '../Core/Check.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport ContextLimits from './ContextLimits.js';\nimport RenderbufferFormat from './RenderbufferFormat.js';\n\n    /**\n     * @private\n     */\n    function Renderbuffer(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        \n\n        var context = options.context;\n        var gl = context._gl;\n        var maximumRenderbufferSize = ContextLimits.maximumRenderbufferSize;\n\n        var format = defaultValue(options.format, RenderbufferFormat.RGBA4);\n        var width = defined(options.width) ? options.width : gl.drawingBufferWidth;\n        var height = defined(options.height) ? options.height : gl.drawingBufferHeight;\n\n        \n\n        this._gl = gl;\n        this._format = format;\n        this._width = width;\n        this._height = height;\n        this._renderbuffer = this._gl.createRenderbuffer();\n\n        gl.bindRenderbuffer(gl.RENDERBUFFER, this._renderbuffer);\n        gl.renderbufferStorage(gl.RENDERBUFFER, format, width, height);\n        gl.bindRenderbuffer(gl.RENDERBUFFER, null);\n    }\n\n    Object.defineProperties(Renderbuffer.prototype, {\n        format: {\n            get : function() {\n                return this._format;\n            }\n        },\n        width: {\n            get : function() {\n                return this._width;\n            }\n        },\n        height: {\n            get : function() {\n                return this._height;\n            }\n        }\n    });\n\n    Renderbuffer.prototype._getRenderbuffer = function() {\n        return this._renderbuffer;\n    };\n\n    Renderbuffer.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    Renderbuffer.prototype.destroy = function() {\n        this._gl.deleteRenderbuffer(this._renderbuffer);\n        return destroyObject(this);\n    };\nexport default Renderbuffer;\n","import BoundingRectangle from '../Core/BoundingRectangle.js';\nimport Color from '../Core/Color.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport Framebuffer from '../Renderer/Framebuffer.js';\nimport PassState from '../Renderer/PassState.js';\nimport Renderbuffer from '../Renderer/Renderbuffer.js';\nimport RenderbufferFormat from '../Renderer/RenderbufferFormat.js';\nimport Texture from '../Renderer/Texture.js';\n\n    /**\n     * @private\n     */\n    function PickFramebuffer(context) {\n        // Override per-command states\n        var passState = new PassState(context);\n        passState.blendingEnabled = false;\n        passState.scissorTest = {\n            enabled : true,\n            rectangle : new BoundingRectangle()\n        };\n        passState.viewport = new BoundingRectangle();\n\n        this._context = context;\n        this._fb = undefined;\n        this._passState = passState;\n        this._width = 0;\n        this._height = 0;\n    }\n    PickFramebuffer.prototype.begin = function(screenSpaceRectangle, viewport) {\n        var context = this._context;\n        var width = viewport.width;\n        var height = viewport.height;\n\n        BoundingRectangle.clone(screenSpaceRectangle, this._passState.scissorTest.rectangle);\n\n        // Initially create or recreate renderbuffers and framebuffer used for picking\n        if ((!defined(this._fb)) || (this._width !== width) || (this._height !== height)) {\n            this._width = width;\n            this._height = height;\n\n            this._fb = this._fb && this._fb.destroy();\n            this._fb = new Framebuffer({\n                context : context,\n                colorTextures : [new Texture({\n                    context : context,\n                    width : width,\n                    height : height\n                })],\n                depthStencilRenderbuffer : new Renderbuffer({\n                    context : context,\n                    width : width,\n                    height : height,\n                    format : RenderbufferFormat.DEPTH_STENCIL\n                })\n            });\n            this._passState.framebuffer = this._fb;\n        }\n\n        this._passState.viewport.width = width;\n        this._passState.viewport.height = height;\n\n        return this._passState;\n    };\n\n    var colorScratch = new Color();\n\n    PickFramebuffer.prototype.end = function(screenSpaceRectangle) {\n        var width = defaultValue(screenSpaceRectangle.width, 1.0);\n        var height = defaultValue(screenSpaceRectangle.height, 1.0);\n\n        var context = this._context;\n        var pixels = context.readPixels({\n            x : screenSpaceRectangle.x,\n            y : screenSpaceRectangle.y,\n            width : width,\n            height : height,\n            framebuffer : this._fb\n        });\n\n        var max = Math.max(width, height);\n        var length = max * max;\n        var halfWidth = Math.floor(width * 0.5);\n        var halfHeight = Math.floor(height * 0.5);\n\n        var x = 0;\n        var y = 0;\n        var dx = 0;\n        var dy = -1;\n\n        // Spiral around the center pixel, this is a workaround until\n        // we can access the depth buffer on all browsers.\n\n        // The region does not have to square and the dimensions do not have to be odd, but\n        // loop iterations would be wasted. Prefer square regions where the size is odd.\n        for (var i = 0; i < length; ++i) {\n            if (-halfWidth <= x && x <= halfWidth && -halfHeight <= y && y <= halfHeight) {\n                var index = 4 * ((halfHeight - y) * width + x + halfWidth);\n\n                colorScratch.red = Color.byteToFloat(pixels[index]);\n                colorScratch.green = Color.byteToFloat(pixels[index + 1]);\n                colorScratch.blue = Color.byteToFloat(pixels[index + 2]);\n                colorScratch.alpha = Color.byteToFloat(pixels[index + 3]);\n\n                var object = context.getObjectByPickColor(colorScratch);\n                if (defined(object)) {\n                    return object;\n                }\n            }\n\n            // if (top right || bottom left corners) || (top left corner) || (bottom right corner + (1, 0))\n            // change spiral direction\n            if (x === y || (x < 0 && -x === y) || (x > 0 && x === 1 - y)) {\n                var temp = dx;\n                dx = -dy;\n                dy = temp;\n            }\n\n            x += dx;\n            y += dy;\n        }\n\n        return undefined;\n    };\n\n    PickFramebuffer.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    PickFramebuffer.prototype.destroy = function() {\n        this._fb = this._fb && this._fb.destroy();\n        return destroyObject(this);\n    };\nexport default PickFramebuffer;\n","import Color from '../Core/Color.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport PixelFormat from '../Core/PixelFormat.js';\nimport ClearCommand from '../Renderer/ClearCommand.js';\nimport Framebuffer from '../Renderer/Framebuffer.js';\nimport PixelDatatype from '../Renderer/PixelDatatype.js';\nimport Renderbuffer from '../Renderer/Renderbuffer.js';\nimport RenderbufferFormat from '../Renderer/RenderbufferFormat.js';\nimport Sampler from '../Renderer/Sampler.js';\nimport Texture from '../Renderer/Texture.js';\n\n    /**\n     * @private\n     */\n    function SceneFramebuffer() {\n        this._colorTexture = undefined;\n        this._idTexture = undefined;\n        this._depthStencilTexture = undefined;\n        this._depthStencilRenderbuffer = undefined;\n        this._framebuffer = undefined;\n        this._idFramebuffer = undefined;\n\n        this._idClearColor = new Color(0.0, 0.0, 0.0, 0.0);\n\n        this._useHdr = undefined;\n\n        this._clearCommand = new ClearCommand({\n            color : new Color(0.0, 0.0, 0.0, 0.0),\n            depth : 1.0,\n            owner : this\n        });\n    }\n\n    function destroyResources(post) {\n        post._framebuffer = post._framebuffer && post._framebuffer.destroy();\n        post._idFramebuffer = post._idFramebuffer && post._idFramebuffer.destroy();\n        post._colorTexture = post._colorTexture && post._colorTexture.destroy();\n        post._idTexture = post._idTexture && post._idTexture.destroy();\n        post._depthStencilTexture = post._depthStencilTexture && post._depthStencilTexture.destroy();\n        post._depthStencilRenderbuffer = post._depthStencilRenderbuffer && post._depthStencilRenderbuffer.destroy();\n        post._depthStencilIdTexture = post._depthStencilIdTexture && post._depthStencilIdTexture.destroy();\n        post._depthStencilIdRenderbuffer = post._depthStencilIdRenderbuffer && post._depthStencilIdRenderbuffer.destroy();\n\n        post._framebuffer = undefined;\n        post._idFramebuffer = undefined;\n        post._colorTexture = undefined;\n        post._idTexture = undefined;\n        post._depthStencilTexture = undefined;\n        post._depthStencilRenderbuffer = undefined;\n        post._depthStencilIdTexture = undefined;\n        post._depthStencilIdRenderbuffer = undefined;\n    }\n\n    SceneFramebuffer.prototype.update = function(context, viewport, hdr) {\n        var width = viewport.width;\n        var height = viewport.height;\n        var colorTexture = this._colorTexture;\n        if (defined(colorTexture) && colorTexture.width === width && colorTexture.height === height && hdr === this._useHdr) {\n            return;\n        }\n\n        destroyResources(this);\n        this._useHdr = hdr;\n\n        var pixelDatatype = hdr ? (context.halfFloatingPointTexture ? PixelDatatype.HALF_FLOAT : PixelDatatype.FLOAT) : PixelDatatype.UNSIGNED_BYTE;\n        this._colorTexture = new Texture({\n            context : context,\n            width : width,\n            height : height,\n            pixelFormat : PixelFormat.RGBA,\n            pixelDatatype : pixelDatatype,\n            sampler : Sampler.NEAREST\n        });\n\n        this._idTexture = new Texture({\n            context : context,\n            width : width,\n            height : height,\n            pixelFormat : PixelFormat.RGBA,\n            pixelDatatype : PixelDatatype.UNSIGNED_BYTE,\n            sampler : Sampler.NEAREST\n        });\n\n        if (context.depthTexture) {\n            this._depthStencilTexture = new Texture({\n                context : context,\n                width : width,\n                height : height,\n                pixelFormat : PixelFormat.DEPTH_STENCIL,\n                pixelDatatype : PixelDatatype.UNSIGNED_INT_24_8,\n                sampler : Sampler.NEAREST\n            });\n            this._depthStencilIdTexture = new Texture({\n                context : context,\n                width : width,\n                height : height,\n                pixelFormat : PixelFormat.DEPTH_STENCIL,\n                pixelDatatype : PixelDatatype.UNSIGNED_INT_24_8,\n                sampler : Sampler.NEAREST\n            });\n        } else {\n            this._depthStencilRenderbuffer = new Renderbuffer({\n                context : context,\n                width : width,\n                height : height,\n                format : RenderbufferFormat.DEPTH_STENCIL\n            });\n            this._depthStencilIdRenderbuffer = new Renderbuffer({\n                context : context,\n                width : width,\n                height : height,\n                format : RenderbufferFormat.DEPTH_STENCIL\n            });\n        }\n\n        this._framebuffer = new Framebuffer({\n            context : context,\n            colorTextures : [this._colorTexture],\n            depthStencilTexture : this._depthStencilTexture,\n            depthStencilRenderbuffer : this._depthStencilRenderbuffer,\n            destroyAttachments : false\n        });\n\n        this._idFramebuffer = new Framebuffer({\n            context : context,\n            colorTextures : [this._idTexture],\n            depthStencilTexture : this._depthStencilIdTexture,\n            depthStencilRenderbuffer : this._depthStencilIdRenderbuffer,\n            destroyAttachments : false\n        });\n    };\n\n    SceneFramebuffer.prototype.clear = function(context, passState, clearColor) {\n        var framebuffer = passState.framebuffer;\n\n        passState.framebuffer = this._framebuffer;\n        Color.clone(clearColor, this._clearCommand.color);\n        this._clearCommand.execute(context, passState);\n\n        passState.framebuffer = this._idFramebuffer;\n        Color.clone(this._idClearColor, this._clearCommand.color);\n        this._clearCommand.execute(context, passState);\n\n        passState.framebuffer = framebuffer;\n    };\n\n    SceneFramebuffer.prototype.getFramebuffer = function() {\n        return this._framebuffer;\n    };\n\n    SceneFramebuffer.prototype.getIdFramebuffer = function() {\n        return this._idFramebuffer;\n    };\n\n    SceneFramebuffer.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    SceneFramebuffer.prototype.destroy = function() {\n        destroyResources(this);\n        return destroyObject(this);\n    };\nexport default SceneFramebuffer;\n","import defined from '../Core/defined.js';\nimport ShaderSource from '../Renderer/ShaderSource.js';\n\n    /**\n     * @private\n     */\n    function ShadowMapShader() {\n    }\n\n    ShadowMapShader.getShadowCastShaderKeyword = function(isPointLight, isTerrain, usesDepthTexture, isOpaque) {\n        return 'castShadow ' + isPointLight + ' ' + isTerrain + ' ' + usesDepthTexture + ' ' + isOpaque;\n    };\n\n    ShadowMapShader.createShadowCastVertexShader = function(vs, isPointLight, isTerrain) {\n        var defines = vs.defines.slice(0);\n        var sources = vs.sources.slice(0);\n\n        defines.push('SHADOW_MAP');\n\n        if (isTerrain) {\n            defines.push('GENERATE_POSITION');\n        }\n\n        var positionVaryingName = ShaderSource.findPositionVarying(vs);\n        var hasPositionVarying = defined(positionVaryingName);\n\n        if (isPointLight && !hasPositionVarying) {\n            var length = sources.length;\n            for (var j = 0; j < length; ++j) {\n                sources[j] = ShaderSource.replaceMain(sources[j], 'czm_shadow_cast_main');\n            }\n\n            var shadowVS =\n                'varying vec3 v_positionEC; \\n' +\n                'void main() \\n' +\n                '{ \\n' +\n                '    czm_shadow_cast_main(); \\n' +\n                '    v_positionEC = (czm_inverseProjection * gl_Position).xyz; \\n' +\n                '}';\n            sources.push(shadowVS);\n        }\n\n        return new ShaderSource({\n            defines : defines,\n            sources : sources\n        });\n    };\n\n    ShadowMapShader.createShadowCastFragmentShader = function(fs, isPointLight, usesDepthTexture, opaque) {\n        var defines = fs.defines.slice(0);\n        var sources = fs.sources.slice(0);\n\n        var positionVaryingName = ShaderSource.findPositionVarying(fs);\n        var hasPositionVarying = defined(positionVaryingName);\n        if (!hasPositionVarying) {\n            positionVaryingName = 'v_positionEC';\n        }\n\n        var length = sources.length;\n        for (var i = 0; i < length; ++i) {\n            sources[i] = ShaderSource.replaceMain(sources[i], 'czm_shadow_cast_main');\n        }\n\n        var fsSource = '';\n\n        if (isPointLight) {\n            if (!hasPositionVarying) {\n                fsSource += 'varying vec3 v_positionEC; \\n';\n            }\n            fsSource += 'uniform vec4 shadowMap_lightPositionEC; \\n';\n        }\n\n        if (opaque) {\n            fsSource +=\n                'void main() \\n' +\n                '{ \\n';\n        } else {\n            fsSource +=\n                'void main() \\n' +\n                '{ \\n' +\n                '    czm_shadow_cast_main(); \\n' +\n                '    if (gl_FragColor.a == 0.0) \\n' +\n                '    { \\n' +\n                '       discard; \\n' +\n                '    } \\n';\n        }\n\n        if (isPointLight) {\n            fsSource +=\n                '    float distance = length(' + positionVaryingName + '); \\n' +\n                '    if (distance >= shadowMap_lightPositionEC.w) \\n' +\n                '    { \\n' +\n                '        discard; \\n' +\n                '    } \\n' +\n                '    distance /= shadowMap_lightPositionEC.w; // radius \\n' +\n                '    gl_FragColor = czm_packDepth(distance); \\n';\n        } else if (usesDepthTexture) {\n            fsSource += '    gl_FragColor = vec4(1.0); \\n';\n        } else {\n            fsSource += '    gl_FragColor = czm_packDepth(gl_FragCoord.z); \\n';\n        }\n\n        fsSource += '} \\n';\n\n        sources.push(fsSource);\n\n        return new ShaderSource({\n            defines : defines,\n            sources : sources\n        });\n    };\n\n    ShadowMapShader.getShadowReceiveShaderKeyword = function(shadowMap, castShadows, isTerrain, hasTerrainNormal) {\n        var usesDepthTexture = shadowMap._usesDepthTexture;\n        var polygonOffsetSupported = shadowMap._polygonOffsetSupported;\n        var isPointLight = shadowMap._isPointLight;\n        var isSpotLight = shadowMap._isSpotLight;\n        var hasCascades = shadowMap._numberOfCascades > 1;\n        var debugCascadeColors = shadowMap.debugCascadeColors;\n        var softShadows = shadowMap.softShadows;\n\n        return 'receiveShadow ' + usesDepthTexture + polygonOffsetSupported + isPointLight + isSpotLight +\n               hasCascades + debugCascadeColors + softShadows + castShadows + isTerrain + hasTerrainNormal;\n    };\n\n    ShadowMapShader.createShadowReceiveVertexShader = function(vs, isTerrain, hasTerrainNormal) {\n        var defines = vs.defines.slice(0);\n        var sources = vs.sources.slice(0);\n\n        defines.push('SHADOW_MAP');\n\n        if (isTerrain) {\n            if (hasTerrainNormal) {\n                defines.push('GENERATE_POSITION_AND_NORMAL');\n            } else {\n                defines.push('GENERATE_POSITION');\n            }\n        }\n\n        return new ShaderSource({\n            defines : defines,\n            sources : sources\n        });\n    };\n\n    ShadowMapShader.createShadowReceiveFragmentShader = function(fs, shadowMap, castShadows, isTerrain, hasTerrainNormal) {\n        var normalVaryingName = ShaderSource.findNormalVarying(fs);\n        var hasNormalVarying = (!isTerrain && defined(normalVaryingName)) || (isTerrain && hasTerrainNormal);\n\n        var positionVaryingName = ShaderSource.findPositionVarying(fs);\n        var hasPositionVarying = defined(positionVaryingName);\n\n        var usesDepthTexture = shadowMap._usesDepthTexture;\n        var polygonOffsetSupported = shadowMap._polygonOffsetSupported;\n        var isPointLight = shadowMap._isPointLight;\n        var isSpotLight = shadowMap._isSpotLight;\n        var hasCascades = shadowMap._numberOfCascades > 1;\n        var debugCascadeColors = shadowMap.debugCascadeColors;\n        var softShadows = shadowMap.softShadows;\n        var bias = isPointLight ? shadowMap._pointBias : (isTerrain ? shadowMap._terrainBias : shadowMap._primitiveBias);\n\n        var defines = fs.defines.slice(0);\n        var sources = fs.sources.slice(0);\n\n        var length = sources.length;\n        for (var i = 0; i < length; ++i) {\n            sources[i] = ShaderSource.replaceMain(sources[i], 'czm_shadow_receive_main');\n        }\n\n        if (isPointLight) {\n            defines.push('USE_CUBE_MAP_SHADOW');\n        } else if (usesDepthTexture) {\n            defines.push('USE_SHADOW_DEPTH_TEXTURE');\n        }\n\n        if (softShadows && !isPointLight) {\n            defines.push('USE_SOFT_SHADOWS');\n        }\n\n        // Enable day-night shading so that the globe is dark when the light is below the horizon\n        if (hasCascades && castShadows && isTerrain) {\n            if (hasNormalVarying) {\n                defines.push('ENABLE_VERTEX_LIGHTING');\n            } else {\n                defines.push('ENABLE_DAYNIGHT_SHADING');\n            }\n        }\n\n        if (castShadows && bias.normalShading && hasNormalVarying) {\n            defines.push('USE_NORMAL_SHADING');\n            if (bias.normalShadingSmooth > 0.0) {\n                defines.push('USE_NORMAL_SHADING_SMOOTH');\n            }\n        }\n\n        var fsSource = '';\n\n        if (isPointLight) {\n            fsSource += 'uniform samplerCube shadowMap_textureCube; \\n';\n        } else {\n            fsSource += 'uniform sampler2D shadowMap_texture; \\n';\n        }\n\n        var returnPositionEC;\n        if (hasPositionVarying) {\n            returnPositionEC = '    return vec4(' + positionVaryingName + ', 1.0); \\n';\n        } else {\n            returnPositionEC =\n                '#ifndef LOG_DEPTH \\n' +\n                '    return czm_windowToEyeCoordinates(gl_FragCoord); \\n' +\n                '#else \\n' +\n                '    return vec4(v_logPositionEC, 1.0); \\n' +\n                '#endif \\n';\n        }\n\n        fsSource +=\n            'uniform mat4 shadowMap_matrix; \\n' +\n            'uniform vec3 shadowMap_lightDirectionEC; \\n' +\n            'uniform vec4 shadowMap_lightPositionEC; \\n' +\n            'uniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness; \\n' +\n            'uniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth; \\n' +\n            '#ifdef LOG_DEPTH \\n' +\n            'varying vec3 v_logPositionEC; \\n' +\n            '#endif \\n' +\n            'vec4 getPositionEC() \\n' +\n            '{ \\n' +\n            returnPositionEC +\n            '} \\n' +\n            'vec3 getNormalEC() \\n' +\n            '{ \\n' +\n            (hasNormalVarying ?\n            '    return normalize(' + normalVaryingName + '); \\n' :\n            '    return vec3(1.0); \\n') +\n            '} \\n' +\n\n            // Offset the shadow position in the direction of the normal for perpendicular and back faces\n            'void applyNormalOffset(inout vec4 positionEC, vec3 normalEC, float nDotL) \\n' +\n            '{ \\n' +\n            (bias.normalOffset && hasNormalVarying ?\n            '    float normalOffset = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.x; \\n' +\n            '    float normalOffsetScale = 1.0 - nDotL; \\n' +\n            '    vec3 offset = normalOffset * normalOffsetScale * normalEC; \\n' +\n            '    positionEC.xyz += offset; \\n' : '') +\n            '} \\n';\n\n        fsSource +=\n            'void main() \\n' +\n            '{ \\n' +\n            '    czm_shadow_receive_main(); \\n' +\n            '    vec4 positionEC = getPositionEC(); \\n' +\n            '    vec3 normalEC = getNormalEC(); \\n' +\n            '    float depth = -positionEC.z; \\n';\n\n        fsSource +=\n            '    czm_shadowParameters shadowParameters; \\n' +\n            '    shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy; \\n' +\n            '    shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z; \\n' +\n            '    shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w; \\n' +\n            '    shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w; \\n';\n\n        if (isTerrain) {\n            // Scale depth bias based on view distance to reduce z-fighting in distant terrain\n            fsSource += '    shadowParameters.depthBias *= max(depth * 0.01, 1.0); \\n';\n        } else if (!polygonOffsetSupported) {\n            // If polygon offset isn't supported push the depth back based on view, however this\n            // causes light leaking at further away views\n            fsSource += '    shadowParameters.depthBias *= mix(1.0, 100.0, depth * 0.0015); \\n';\n        }\n\n        if (isPointLight) {\n            fsSource +=\n                '    vec3 directionEC = positionEC.xyz - shadowMap_lightPositionEC.xyz; \\n' +\n                '    float distance = length(directionEC); \\n' +\n                '    directionEC = normalize(directionEC); \\n' +\n                '    float radius = shadowMap_lightPositionEC.w; \\n' +\n                '    // Stop early if the fragment is beyond the point light radius \\n' +\n                '    if (distance > radius) \\n' +\n                '    { \\n' +\n                '        return; \\n' +\n                '    } \\n' +\n                '    vec3 directionWC  = czm_inverseViewRotation * directionEC; \\n' +\n\n                '    shadowParameters.depth = distance / radius; \\n' +\n                '    shadowParameters.nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \\n' +\n\n                '    shadowParameters.texCoords = directionWC; \\n' +\n                '    float visibility = czm_shadowVisibility(shadowMap_textureCube, shadowParameters); \\n';\n        } else if (isSpotLight) {\n            fsSource +=\n                '    vec3 directionEC = normalize(positionEC.xyz - shadowMap_lightPositionEC.xyz); \\n' +\n                '    float nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \\n' +\n                '    applyNormalOffset(positionEC, normalEC, nDotL); \\n' +\n\n                '    vec4 shadowPosition = shadowMap_matrix * positionEC; \\n' +\n                '    // Spot light uses a perspective projection, so perform the perspective divide \\n' +\n                '    shadowPosition /= shadowPosition.w; \\n' +\n\n                '    // Stop early if the fragment is not in the shadow bounds \\n' +\n                '    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \\n' +\n                '    { \\n' +\n                '        return; \\n' +\n                '    } \\n' +\n\n                '    shadowParameters.texCoords = shadowPosition.xy; \\n' +\n                '    shadowParameters.depth = shadowPosition.z; \\n' +\n                '    shadowParameters.nDotL = nDotL; \\n' +\n\n                '    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \\n';\n        } else if (hasCascades) {\n            fsSource +=\n                '    float maxDepth = shadowMap_cascadeSplits[1].w; \\n' +\n\n                '    // Stop early if the eye depth exceeds the last cascade \\n' +\n                '    if (depth > maxDepth) \\n' +\n                '    { \\n' +\n                '        return; \\n' +\n                '    } \\n' +\n\n                '    // Get the cascade based on the eye-space depth \\n' +\n                '    vec4 weights = czm_cascadeWeights(depth); \\n' +\n\n                '    // Apply normal offset \\n' +\n                '    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \\n' +\n                '    applyNormalOffset(positionEC, normalEC, nDotL); \\n' +\n\n                '    // Transform position into the cascade \\n' +\n                '    vec4 shadowPosition = czm_cascadeMatrix(weights) * positionEC; \\n' +\n\n                '    // Get visibility \\n' +\n                '    shadowParameters.texCoords = shadowPosition.xy; \\n' +\n                '    shadowParameters.depth = shadowPosition.z; \\n' +\n                '    shadowParameters.nDotL = nDotL; \\n' +\n                '    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \\n' +\n\n                '    // Fade out shadows that are far away \\n' +\n                '    float shadowMapMaximumDistance = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.z; \\n' +\n                '    float fade = max((depth - shadowMapMaximumDistance * 0.8) / (shadowMapMaximumDistance * 0.2), 0.0); \\n' +\n                '    visibility = mix(visibility, 1.0, fade); \\n' +\n\n                (debugCascadeColors ?\n                '    // Draw cascade colors for debugging \\n' +\n                '    gl_FragColor *= czm_cascadeColor(weights); \\n' : '');\n        } else {\n            fsSource +=\n                '    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \\n' +\n                '    applyNormalOffset(positionEC, normalEC, nDotL); \\n' +\n                '    vec4 shadowPosition = shadowMap_matrix * positionEC; \\n' +\n\n                '    // Stop early if the fragment is not in the shadow bounds \\n' +\n                '    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \\n' +\n                '    { \\n' +\n                '        return; \\n' +\n                '    } \\n' +\n\n                '    shadowParameters.texCoords = shadowPosition.xy; \\n' +\n                '    shadowParameters.depth = shadowPosition.z; \\n' +\n                '    shadowParameters.nDotL = nDotL; \\n' +\n                '    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \\n';\n        }\n\n        fsSource +=\n            '    gl_FragColor.rgb *= visibility; \\n' +\n            '} \\n';\n\n        sources.push(fsSource);\n\n        return new ShaderSource({\n            defines : defines,\n            sources : sources\n        });\n    };\nexport default ShadowMapShader;\n","import BoundingRectangle from '../Core/BoundingRectangle.js';\nimport BoundingSphere from '../Core/BoundingSphere.js';\nimport BoxOutlineGeometry from '../Core/BoxOutlineGeometry.js';\nimport Cartesian2 from '../Core/Cartesian2.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Cartesian4 from '../Core/Cartesian4.js';\nimport Cartographic from '../Core/Cartographic.js';\nimport clone from '../Core/clone.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport combine from '../Core/combine.js';\nimport CullingVolume from '../Core/CullingVolume.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport FeatureDetection from '../Core/FeatureDetection.js';\nimport GeometryInstance from '../Core/GeometryInstance.js';\nimport Intersect from '../Core/Intersect.js';\nimport CesiumMath from '../Core/Math.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport OrthographicOffCenterFrustum from '../Core/OrthographicOffCenterFrustum.js';\nimport PerspectiveFrustum from '../Core/PerspectiveFrustum.js';\nimport PixelFormat from '../Core/PixelFormat.js';\nimport Quaternion from '../Core/Quaternion.js';\nimport SphereOutlineGeometry from '../Core/SphereOutlineGeometry.js';\nimport WebGLConstants from '../Core/WebGLConstants.js';\nimport ClearCommand from '../Renderer/ClearCommand.js';\nimport ContextLimits from '../Renderer/ContextLimits.js';\nimport CubeMap from '../Renderer/CubeMap.js';\nimport DrawCommand from '../Renderer/DrawCommand.js';\nimport Framebuffer from '../Renderer/Framebuffer.js';\nimport Pass from '../Renderer/Pass.js';\nimport PassState from '../Renderer/PassState.js';\nimport PixelDatatype from '../Renderer/PixelDatatype.js';\nimport Renderbuffer from '../Renderer/Renderbuffer.js';\nimport RenderbufferFormat from '../Renderer/RenderbufferFormat.js';\nimport RenderState from '../Renderer/RenderState.js';\nimport Sampler from '../Renderer/Sampler.js';\nimport Texture from '../Renderer/Texture.js';\nimport Camera from './Camera.js';\nimport CullFace from './CullFace.js';\nimport DebugCameraPrimitive from './DebugCameraPrimitive.js';\nimport PerInstanceColorAppearance from './PerInstanceColorAppearance.js';\nimport Primitive from './Primitive.js';\nimport ShadowMapShader from './ShadowMapShader.js';\n\n    /**\n     * Use {@link Viewer#shadowMap} to get the scene's shadow map. Do not construct this directly.\n     *\n     * <p>\n     * The normalOffset bias pushes the shadows forward slightly, and may be disabled\n     * for applications that require ultra precise shadows.\n     * </p>\n     *\n     * @alias ShadowMap\n     * @internalConstructor\n     * @class\n     *\n     * @param {Object} options An object containing the following properties:\n     * @param {Camera} options.lightCamera A camera representing the light source.\n     * @param {Boolean} [options.enabled=true] Whether the shadow map is enabled.\n     * @param {Boolean} [options.isPointLight=false] Whether the light source is a point light. Point light shadows do not use cascades.\n     * @param {Boolean} [options.pointLightRadius=100.0] Radius of the point light.\n     * @param {Boolean} [options.cascadesEnabled=true] Use multiple shadow maps to cover different partitions of the view frustum.\n     * @param {Number} [options.numberOfCascades=4] The number of cascades to use for the shadow map. Supported values are one and four.\n     * @param {Number} [options.maximumDistance=5000.0] The maximum distance used for generating cascaded shadows. Lower values improve shadow quality.\n     * @param {Number} [options.size=2048] The width and height, in pixels, of each shadow map.\n     * @param {Boolean} [options.softShadows=false] Whether percentage-closer-filtering is enabled for producing softer shadows.\n     * @param {Number} [options.darkness=0.3] The shadow darkness.\n     * @param {Boolean} [options.normalOffset=true] Whether a normal bias is applied to shadows.\n     *\n     * @exception {DeveloperError} Only one or four cascades are supported.\n     *\n     * @demo {@link https://sandcastle.cesium.com/index.html?src=Shadows.html|Cesium Sandcastle Shadows Demo}\n     */\n    function ShadowMap(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n        // options.context is an undocumented option\n        var context = options.context;\n\n        \n\n        this._enabled = defaultValue(options.enabled, true);\n        this._softShadows = defaultValue(options.softShadows, false);\n        this._normalOffset = defaultValue(options.normalOffset, true);\n        this.dirty = true;\n\n        /**\n         * Specifies whether the shadow map originates from a light source. Shadow maps that are used for analytical\n         * purposes should set this to false so as not to affect scene rendering.\n         *\n         * @private\n         */\n        this.fromLightSource = defaultValue(options.fromLightSource, true);\n\n        /**\n         * Determines the darkness of the shadows.\n         *\n         * @type {Number}\n         * @default 0.3\n         */\n        this.darkness = defaultValue(options.darkness, 0.3);\n        this._darkness = this.darkness;\n\n        /**\n         * Determines the maximum distance of the shadow map. Only applicable for cascaded shadows. Larger distances may result in lower quality shadows.\n         *\n         * @type {Number}\n         * @default 5000.0\n         */\n        this.maximumDistance = defaultValue(options.maximumDistance, 5000.0);\n\n        this._outOfView = false;\n        this._outOfViewPrevious = false;\n        this._needsUpdate = true;\n\n        // In IE11 and Edge polygon offset is not functional.\n        // TODO : Also disabled for instances of Firefox and Chrome running ANGLE that do not support depth textures.\n        // Re-enable once https://github.com/CesiumGS/cesium/issues/4560 is resolved.\n        var polygonOffsetSupported = true;\n        if (FeatureDetection.isInternetExplorer() || FeatureDetection.isEdge() || ((FeatureDetection.isChrome() || FeatureDetection.isFirefox()) && FeatureDetection.isWindows() && !context.depthTexture)) {\n            polygonOffsetSupported = false;\n        }\n        this._polygonOffsetSupported = polygonOffsetSupported;\n\n        this._terrainBias = {\n            polygonOffset : polygonOffsetSupported,\n            polygonOffsetFactor : 1.1,\n            polygonOffsetUnits : 4.0,\n            normalOffset : this._normalOffset,\n            normalOffsetScale : 0.5,\n            normalShading : true,\n            normalShadingSmooth : 0.3,\n            depthBias : 0.0001\n        };\n\n        this._primitiveBias = {\n            polygonOffset : polygonOffsetSupported,\n            polygonOffsetFactor : 1.1,\n            polygonOffsetUnits : 4.0,\n            normalOffset : this._normalOffset,\n            normalOffsetScale : 0.1,\n            normalShading : true,\n            normalShadingSmooth : 0.05,\n            depthBias : 0.00002\n        };\n\n        this._pointBias = {\n            polygonOffset : false,\n            polygonOffsetFactor : 1.1,\n            polygonOffsetUnits : 4.0,\n            normalOffset : this._normalOffset,\n            normalOffsetScale : 0.0,\n            normalShading : true,\n            normalShadingSmooth : 0.1,\n            depthBias : 0.0005\n        };\n\n        // Framebuffer resources\n        this._depthAttachment = undefined;\n        this._colorAttachment = undefined;\n\n        // Uniforms\n        this._shadowMapMatrix = new Matrix4();\n        this._shadowMapTexture = undefined;\n        this._lightDirectionEC = new Cartesian3();\n        this._lightPositionEC = new Cartesian4();\n        this._distance = 0.0;\n\n        this._lightCamera = options.lightCamera;\n        this._shadowMapCamera = new ShadowMapCamera();\n        this._shadowMapCullingVolume = undefined;\n        this._sceneCamera = undefined;\n        this._boundingSphere = new BoundingSphere();\n\n        this._isPointLight = defaultValue(options.isPointLight, false);\n        this._pointLightRadius = defaultValue(options.pointLightRadius, 100.0);\n\n        this._cascadesEnabled = this._isPointLight ? false : defaultValue(options.cascadesEnabled, true);\n        this._numberOfCascades = !this._cascadesEnabled ? 0 : defaultValue(options.numberOfCascades, 4);\n        this._fitNearFar = true;\n        this._maximumCascadeDistances = [25.0, 150.0, 700.0, Number.MAX_VALUE];\n\n        this._textureSize = new Cartesian2();\n\n        this._isSpotLight = false;\n        if (this._cascadesEnabled) {\n            // Cascaded shadows are always orthographic. The frustum dimensions are calculated on the fly.\n            this._shadowMapCamera.frustum = new OrthographicOffCenterFrustum();\n        } else if (defined(this._lightCamera.frustum.fov)) {\n            // If the light camera uses a perspective frustum, then the light source is a spot light\n            this._isSpotLight = true;\n        }\n\n        // Uniforms\n        this._cascadeSplits = [new Cartesian4(), new Cartesian4()];\n        this._cascadeMatrices = [new Matrix4(), new Matrix4(), new Matrix4(), new Matrix4()];\n        this._cascadeDistances = new Cartesian4();\n\n        var numberOfPasses;\n        if (this._isPointLight) {\n            numberOfPasses = 6; // One shadow map for each direction\n        } else if (!this._cascadesEnabled) {\n            numberOfPasses = 1;\n        } else {\n            numberOfPasses = this._numberOfCascades;\n        }\n\n        this._passes = new Array(numberOfPasses);\n        for (var i = 0; i < numberOfPasses; ++i) {\n            this._passes[i] = new ShadowPass(context);\n        }\n\n        this.debugShow = false;\n        this.debugFreezeFrame = false;\n        this._debugFreezeFrame = false;\n        this._debugCascadeColors = false;\n        this._debugLightFrustum = undefined;\n        this._debugCameraFrustum = undefined;\n        this._debugCascadeFrustums = new Array(this._numberOfCascades);\n        this._debugShadowViewCommand = undefined;\n\n        this._usesDepthTexture = context.depthTexture;\n\n        if (this._isPointLight) {\n            this._usesDepthTexture = false;\n        }\n\n        // Create render states for shadow casters\n        this._primitiveRenderState = undefined;\n        this._terrainRenderState = undefined;\n        this._pointRenderState = undefined;\n        createRenderStates(this);\n\n        // For clearing the shadow map texture every frame\n        this._clearCommand = new ClearCommand({\n            depth : 1.0,\n            color : new Color()\n        });\n\n        this._clearPassState = new PassState(context);\n\n        this._size = defaultValue(options.size, 2048);\n        this.size = this._size;\n    }\n\n    /**\n     * Global maximum shadow distance used to prevent far off receivers from extending\n     * the shadow far plane. This helps set a tighter near/far when viewing objects from space.\n     *\n     * @private\n     */\n    ShadowMap.MAXIMUM_DISTANCE = 20000.0;\n\n    function ShadowPass(context) {\n        this.camera = new ShadowMapCamera();\n        this.passState = new PassState(context);\n        this.framebuffer = undefined;\n        this.textureOffsets = undefined;\n        this.commandList = [];\n        this.cullingVolume = undefined;\n    }\n\n    function createRenderState(colorMask, bias) {\n        return RenderState.fromCache({\n            cull : {\n                enabled : true,\n                face : CullFace.BACK\n            },\n            depthTest : {\n                enabled : true\n            },\n            colorMask : {\n                red : colorMask,\n                green : colorMask,\n                blue : colorMask,\n                alpha : colorMask\n            },\n            depthMask : true,\n            polygonOffset : {\n                enabled : bias.polygonOffset,\n                factor : bias.polygonOffsetFactor,\n                units : bias.polygonOffsetUnits\n            }\n        });\n    }\n\n    function createRenderStates(shadowMap) {\n        // Enable the color mask if the shadow map is backed by a color texture, e.g. when depth textures aren't supported\n        var colorMask = !shadowMap._usesDepthTexture;\n        shadowMap._primitiveRenderState = createRenderState(colorMask, shadowMap._primitiveBias);\n        shadowMap._terrainRenderState = createRenderState(colorMask, shadowMap._terrainBias);\n        shadowMap._pointRenderState = createRenderState(colorMask, shadowMap._pointBias);\n    }\n\n    /**\n     * @private\n     */\n    ShadowMap.prototype.debugCreateRenderStates = function() {\n        createRenderStates(this);\n    };\n\n    Object.defineProperties(ShadowMap.prototype, {\n        /**\n         * Determines if the shadow map will be shown.\n         *\n         * @memberof ShadowMap.prototype\n         * @type {Boolean}\n         * @default true\n         */\n        enabled : {\n            get : function() {\n                return this._enabled;\n            },\n            set : function(value) {\n                this.dirty = this._enabled !== value;\n                this._enabled = value;\n            }\n        },\n\n        /**\n         * Determines if a normal bias will be applied to shadows.\n         *\n         * @memberof ShadowMap.prototype\n         * @type {Boolean}\n         * @default true\n         */\n        normalOffset : {\n            get : function() {\n                return this._normalOffset;\n            },\n            set : function(value) {\n                this.dirty = this._normalOffset !== value;\n                this._normalOffset = value;\n                this._terrainBias.normalOffset = value;\n                this._primitiveBias.normalOffset = value;\n                this._pointBias.normalOffset = value;\n            }\n        },\n\n        /**\n         * Determines if soft shadows are enabled. Uses pcf filtering which requires more texture reads and may hurt performance.\n         *\n         * @memberof ShadowMap.prototype\n         * @type {Boolean}\n         * @default false\n         */\n        softShadows : {\n            get : function() {\n                return this._softShadows;\n            },\n            set : function(value) {\n                this.dirty = this._softShadows !== value;\n                this._softShadows = value;\n            }\n        },\n\n        /**\n         * The width and height, in pixels, of each shadow map.\n         *\n         * @memberof ShadowMap.prototype\n         * @type {Number}\n         * @default 2048\n         */\n        size : {\n            get : function() {\n                return this._size;\n            },\n            set : function(value) {\n                resize(this, value);\n            }\n        },\n\n        /**\n         * Whether the shadow map is out of view of the scene camera.\n         *\n         * @memberof ShadowMap.prototype\n         * @type {Boolean}\n         * @readonly\n         * @private\n         */\n        outOfView : {\n            get : function() {\n                return this._outOfView;\n            }\n        },\n\n        /**\n         * The culling volume of the shadow frustum.\n         *\n         * @memberof ShadowMap.prototype\n         * @type {CullingVolume}\n         * @readonly\n         * @private\n         */\n        shadowMapCullingVolume : {\n            get : function() {\n                return this._shadowMapCullingVolume;\n            }\n        },\n\n        /**\n         * The passes used for rendering shadows. Each face of a point light or each cascade for a cascaded shadow map is a separate pass.\n         *\n         * @memberof ShadowMap.prototype\n         * @type {ShadowPass[]}\n         * @readonly\n         * @private\n         */\n        passes : {\n            get : function() {\n                return this._passes;\n            }\n        },\n\n        /**\n         * Whether the light source is a point light.\n         *\n         * @memberof ShadowMap.prototype\n         * @type {Boolean}\n         * @readonly\n         * @private\n         */\n        isPointLight : {\n            get : function() {\n                return this._isPointLight;\n            }\n        },\n\n        /**\n         * Debug option for visualizing the cascades by color.\n         *\n         * @memberof ShadowMap.prototype\n         * @type {Boolean}\n         * @default false\n         * @private\n         */\n        debugCascadeColors : {\n            get : function() {\n                return this._debugCascadeColors;\n            },\n            set : function(value) {\n                this.dirty = this._debugCascadeColors !== value;\n                this._debugCascadeColors = value;\n            }\n        }\n    });\n\n    function destroyFramebuffer(shadowMap) {\n        var length = shadowMap._passes.length;\n        for (var i = 0; i < length; ++i) {\n            var pass = shadowMap._passes[i];\n            var framebuffer = pass.framebuffer;\n            if (defined(framebuffer) && !framebuffer.isDestroyed()) {\n                framebuffer.destroy();\n            }\n            pass.framebuffer = undefined;\n        }\n\n        // Destroy the framebuffer attachments\n        shadowMap._depthAttachment = shadowMap._depthAttachment && shadowMap._depthAttachment.destroy();\n        shadowMap._colorAttachment = shadowMap._colorAttachment && shadowMap._colorAttachment.destroy();\n    }\n\n    function createFramebufferColor(shadowMap, context) {\n        var depthRenderbuffer = new Renderbuffer({\n            context : context,\n            width : shadowMap._textureSize.x,\n            height : shadowMap._textureSize.y,\n            format : RenderbufferFormat.DEPTH_COMPONENT16\n        });\n\n        var colorTexture = new Texture({\n            context : context,\n            width : shadowMap._textureSize.x,\n            height : shadowMap._textureSize.y,\n            pixelFormat : PixelFormat.RGBA,\n            pixelDatatype : PixelDatatype.UNSIGNED_BYTE,\n            sampler : Sampler.NEAREST\n        });\n\n        var framebuffer = new Framebuffer({\n            context : context,\n            depthRenderbuffer : depthRenderbuffer,\n            colorTextures : [colorTexture],\n            destroyAttachments : false\n        });\n\n        var length = shadowMap._passes.length;\n        for (var i = 0; i < length; ++i) {\n            var pass = shadowMap._passes[i];\n            pass.framebuffer = framebuffer;\n            pass.passState.framebuffer = framebuffer;\n        }\n\n        shadowMap._shadowMapTexture = colorTexture;\n        shadowMap._depthAttachment = depthRenderbuffer;\n        shadowMap._colorAttachment = colorTexture;\n    }\n\n    function createFramebufferDepth(shadowMap, context) {\n        var depthStencilTexture = new Texture({\n            context : context,\n            width : shadowMap._textureSize.x,\n            height : shadowMap._textureSize.y,\n            pixelFormat : PixelFormat.DEPTH_STENCIL,\n            pixelDatatype : PixelDatatype.UNSIGNED_INT_24_8,\n            sampler : Sampler.NEAREST\n        });\n\n        var framebuffer = new Framebuffer({\n            context : context,\n            depthStencilTexture : depthStencilTexture,\n            destroyAttachments : false\n        });\n\n        var length = shadowMap._passes.length;\n        for (var i = 0; i < length; ++i) {\n            var pass = shadowMap._passes[i];\n            pass.framebuffer = framebuffer;\n            pass.passState.framebuffer = framebuffer;\n        }\n\n        shadowMap._shadowMapTexture = depthStencilTexture;\n        shadowMap._depthAttachment = depthStencilTexture;\n    }\n\n    function createFramebufferCube(shadowMap, context) {\n        var depthRenderbuffer = new Renderbuffer({\n            context : context,\n            width : shadowMap._textureSize.x,\n            height : shadowMap._textureSize.y,\n            format : RenderbufferFormat.DEPTH_COMPONENT16\n        });\n\n        var cubeMap = new CubeMap({\n            context : context,\n            width : shadowMap._textureSize.x,\n            height : shadowMap._textureSize.y,\n            pixelFormat : PixelFormat.RGBA,\n            pixelDatatype : PixelDatatype.UNSIGNED_BYTE,\n            sampler : Sampler.NEAREST\n        });\n\n        var faces = [cubeMap.negativeX, cubeMap.negativeY, cubeMap.negativeZ, cubeMap.positiveX, cubeMap.positiveY, cubeMap.positiveZ];\n\n        for (var i = 0; i < 6; ++i) {\n            var framebuffer = new Framebuffer({\n                context : context,\n                depthRenderbuffer : depthRenderbuffer,\n                colorTextures : [faces[i]],\n                destroyAttachments : false\n            });\n            var pass = shadowMap._passes[i];\n            pass.framebuffer = framebuffer;\n            pass.passState.framebuffer = framebuffer;\n        }\n\n        shadowMap._shadowMapTexture = cubeMap;\n        shadowMap._depthAttachment = depthRenderbuffer;\n        shadowMap._colorAttachment = cubeMap;\n    }\n\n    function createFramebuffer(shadowMap, context) {\n        if (shadowMap._isPointLight) {\n            createFramebufferCube(shadowMap, context);\n        } else if (shadowMap._usesDepthTexture) {\n            createFramebufferDepth(shadowMap, context);\n        } else {\n            createFramebufferColor(shadowMap, context);\n        }\n    }\n\n    function checkFramebuffer(shadowMap, context) {\n        // Attempt to make an FBO with only a depth texture. If it fails, fallback to a color texture.\n        if (shadowMap._usesDepthTexture && (shadowMap._passes[0].framebuffer.status !== WebGLConstants.FRAMEBUFFER_COMPLETE)) {\n            shadowMap._usesDepthTexture = false;\n            createRenderStates(shadowMap);\n            destroyFramebuffer(shadowMap);\n            createFramebuffer(shadowMap, context);\n        }\n    }\n\n    function updateFramebuffer(shadowMap, context) {\n        if (!defined(shadowMap._passes[0].framebuffer) || (shadowMap._shadowMapTexture.width !== shadowMap._textureSize.x)) {\n            destroyFramebuffer(shadowMap);\n            createFramebuffer(shadowMap, context);\n            checkFramebuffer(shadowMap, context);\n            clearFramebuffer(shadowMap, context);\n        }\n    }\n\n    function clearFramebuffer(shadowMap, context, shadowPass) {\n        shadowPass = defaultValue(shadowPass, 0);\n        if (shadowMap._isPointLight || (shadowPass === 0)) {\n            shadowMap._clearCommand.framebuffer = shadowMap._passes[shadowPass].framebuffer;\n            shadowMap._clearCommand.execute(context, shadowMap._clearPassState);\n        }\n    }\n\n    function resize(shadowMap, size) {\n        shadowMap._size = size;\n        var passes = shadowMap._passes;\n        var numberOfPasses = passes.length;\n        var textureSize = shadowMap._textureSize;\n\n        if (shadowMap._isPointLight) {\n            size = (ContextLimits.maximumCubeMapSize >= size) ? size : ContextLimits.maximumCubeMapSize;\n            textureSize.x = size;\n            textureSize.y = size;\n            var faceViewport = new BoundingRectangle(0, 0, size, size);\n            passes[0].passState.viewport = faceViewport;\n            passes[1].passState.viewport = faceViewport;\n            passes[2].passState.viewport = faceViewport;\n            passes[3].passState.viewport = faceViewport;\n            passes[4].passState.viewport = faceViewport;\n            passes[5].passState.viewport = faceViewport;\n        } else if (numberOfPasses === 1) {\n            // +----+\n            // |  1 |\n            // +----+\n            size = (ContextLimits.maximumTextureSize >= size) ? size : ContextLimits.maximumTextureSize;\n            textureSize.x = size;\n            textureSize.y = size;\n            passes[0].passState.viewport = new BoundingRectangle(0, 0, size, size);\n        } else if (numberOfPasses === 4) {\n            // +----+----+\n            // |  3 |  4 |\n            // +----+----+\n            // |  1 |  2 |\n            // +----+----+\n            size = (ContextLimits.maximumTextureSize >= size * 2) ? size : ContextLimits.maximumTextureSize / 2;\n            textureSize.x = size * 2;\n            textureSize.y = size * 2;\n            passes[0].passState.viewport = new BoundingRectangle(0, 0, size, size);\n            passes[1].passState.viewport = new BoundingRectangle(size, 0, size, size);\n            passes[2].passState.viewport = new BoundingRectangle(0, size, size, size);\n            passes[3].passState.viewport = new BoundingRectangle(size, size, size, size);\n        }\n\n        // Update clear pass state\n        shadowMap._clearPassState.viewport = new BoundingRectangle(0, 0, textureSize.x, textureSize.y);\n\n        // Transforms shadow coordinates [0, 1] into the pass's region of the texture\n        for (var i = 0; i < numberOfPasses; ++i) {\n            var pass = passes[i];\n            var viewport = pass.passState.viewport;\n            var biasX = viewport.x / textureSize.x;\n            var biasY = viewport.y / textureSize.y;\n            var scaleX = viewport.width / textureSize.x;\n            var scaleY = viewport.height / textureSize.y;\n            pass.textureOffsets = new Matrix4(scaleX, 0.0, 0.0, biasX, 0.0, scaleY, 0.0, biasY, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    var scratchViewport = new BoundingRectangle();\n\n    function createDebugShadowViewCommand(shadowMap, context) {\n        var fs;\n        if (shadowMap._isPointLight) {\n            fs = 'uniform samplerCube shadowMap_textureCube; \\n' +\n                 'varying vec2 v_textureCoordinates; \\n' +\n                 'void main() \\n' +\n                 '{ \\n' +\n                 '    vec2 uv = v_textureCoordinates; \\n' +\n                 '    vec3 dir; \\n' +\n                 ' \\n' +\n                 '    if (uv.y < 0.5) \\n' +\n                 '    { \\n' +\n                 '        if (uv.x < 0.333) \\n' +\n                 '        { \\n' +\n                 '            dir.x = -1.0; \\n' +\n                 '            dir.y = uv.x * 6.0 - 1.0; \\n' +\n                 '            dir.z = uv.y * 4.0 - 1.0; \\n' +\n                 '        } \\n' +\n                 '        else if (uv.x < 0.666) \\n' +\n                 '        { \\n' +\n                 '            dir.y = -1.0; \\n' +\n                 '            dir.x = uv.x * 6.0 - 3.0; \\n' +\n                 '            dir.z = uv.y * 4.0 - 1.0; \\n' +\n                 '        } \\n' +\n                 '        else \\n' +\n                 '        { \\n' +\n                 '            dir.z = -1.0; \\n' +\n                 '            dir.x = uv.x * 6.0 - 5.0; \\n' +\n                 '            dir.y = uv.y * 4.0 - 1.0; \\n' +\n                 '        } \\n' +\n                 '    } \\n' +\n                 '    else \\n' +\n                 '    { \\n' +\n                 '        if (uv.x < 0.333) \\n' +\n                 '        { \\n' +\n                 '            dir.x = 1.0; \\n' +\n                 '            dir.y = uv.x * 6.0 - 1.0; \\n' +\n                 '            dir.z = uv.y * 4.0 - 3.0; \\n' +\n                 '        } \\n' +\n                 '        else if (uv.x < 0.666) \\n' +\n                 '        { \\n' +\n                 '            dir.y = 1.0; \\n' +\n                 '            dir.x = uv.x * 6.0 - 3.0; \\n' +\n                 '            dir.z = uv.y * 4.0 - 3.0; \\n' +\n                 '        } \\n' +\n                 '        else \\n' +\n                 '        { \\n' +\n                 '            dir.z = 1.0; \\n' +\n                 '            dir.x = uv.x * 6.0 - 5.0; \\n' +\n                 '            dir.y = uv.y * 4.0 - 3.0; \\n' +\n                 '        } \\n' +\n                 '    } \\n' +\n                 ' \\n' +\n                 '    float shadow = czm_unpackDepth(textureCube(shadowMap_textureCube, dir)); \\n' +\n                 '    gl_FragColor = vec4(vec3(shadow), 1.0); \\n' +\n                 '} \\n';\n        } else {\n            fs = 'uniform sampler2D shadowMap_texture; \\n' +\n                 'varying vec2 v_textureCoordinates; \\n' +\n                 'void main() \\n' +\n                 '{ \\n' +\n\n                 (shadowMap._usesDepthTexture ?\n                 '    float shadow = texture2D(shadowMap_texture, v_textureCoordinates).r; \\n' :\n                 '    float shadow = czm_unpackDepth(texture2D(shadowMap_texture, v_textureCoordinates)); \\n') +\n\n                 '    gl_FragColor = vec4(vec3(shadow), 1.0); \\n' +\n                 '} \\n';\n        }\n\n        var drawCommand = context.createViewportQuadCommand(fs, {\n            uniformMap : {\n                shadowMap_texture : function() {\n                    return shadowMap._shadowMapTexture;\n                },\n                shadowMap_textureCube : function() {\n                    return shadowMap._shadowMapTexture;\n                }\n            }\n        });\n        drawCommand.pass = Pass.OVERLAY;\n        return drawCommand;\n    }\n\n    function updateDebugShadowViewCommand(shadowMap, frameState) {\n        // Draws the shadow map on the bottom-right corner of the screen\n        var context = frameState.context;\n        var screenWidth = frameState.context.drawingBufferWidth;\n        var screenHeight = frameState.context.drawingBufferHeight;\n        var size = Math.min(screenWidth, screenHeight) * 0.3;\n\n        var viewport = scratchViewport;\n        viewport.x = screenWidth - size;\n        viewport.y = 0;\n        viewport.width = size;\n        viewport.height = size;\n\n        var debugCommand = shadowMap._debugShadowViewCommand;\n        if (!defined(debugCommand)) {\n            debugCommand = createDebugShadowViewCommand(shadowMap, context);\n            shadowMap._debugShadowViewCommand = debugCommand;\n        }\n\n        // Get a new RenderState for the updated viewport size\n        if (!defined(debugCommand.renderState) || !BoundingRectangle.equals(debugCommand.renderState.viewport, viewport)) {\n            debugCommand.renderState = RenderState.fromCache({\n                viewport : BoundingRectangle.clone(viewport)\n            });\n        }\n\n        frameState.commandList.push(shadowMap._debugShadowViewCommand);\n    }\n\n    var frustumCornersNDC = new Array(8);\n    frustumCornersNDC[0] = new Cartesian4(-1.0, -1.0, -1.0, 1.0);\n    frustumCornersNDC[1] = new Cartesian4(1.0, -1.0, -1.0, 1.0);\n    frustumCornersNDC[2] = new Cartesian4(1.0, 1.0, -1.0, 1.0);\n    frustumCornersNDC[3] = new Cartesian4(-1.0, 1.0, -1.0, 1.0);\n    frustumCornersNDC[4] = new Cartesian4(-1.0, -1.0, 1.0, 1.0);\n    frustumCornersNDC[5] = new Cartesian4(1.0, -1.0, 1.0, 1.0);\n    frustumCornersNDC[6] = new Cartesian4(1.0, 1.0, 1.0, 1.0);\n    frustumCornersNDC[7] = new Cartesian4(-1.0, 1.0, 1.0, 1.0);\n\n    var scratchMatrix = new Matrix4();\n    var scratchFrustumCorners = new Array(8);\n    for (var i = 0; i < 8; ++i) {\n        scratchFrustumCorners[i] = new Cartesian4();\n    }\n\n    function createDebugPointLight(modelMatrix, color) {\n        var box = new GeometryInstance({\n            geometry : new BoxOutlineGeometry({\n                minimum : new Cartesian3(-0.5, -0.5, -0.5),\n                maximum : new Cartesian3(0.5, 0.5, 0.5)\n            }),\n            attributes : {\n                color : ColorGeometryInstanceAttribute.fromColor(color)\n            }\n        });\n\n        var sphere = new GeometryInstance({\n            geometry : new SphereOutlineGeometry({\n                radius : 0.5\n            }),\n            attributes : {\n                color : ColorGeometryInstanceAttribute.fromColor(color)\n            }\n        });\n\n        return new Primitive({\n            geometryInstances : [box, sphere],\n            appearance : new PerInstanceColorAppearance({\n                translucent : false,\n                flat : true\n            }),\n            asynchronous : false,\n            modelMatrix : modelMatrix\n        });\n    }\n\n    var debugOutlineColors = [Color.RED, Color.GREEN, Color.BLUE, Color.MAGENTA];\n    var scratchScale = new Cartesian3();\n\n    function applyDebugSettings(shadowMap, frameState) {\n        updateDebugShadowViewCommand(shadowMap, frameState);\n\n        var enterFreezeFrame = shadowMap.debugFreezeFrame && !shadowMap._debugFreezeFrame;\n        shadowMap._debugFreezeFrame = shadowMap.debugFreezeFrame;\n\n        // Draw scene camera in freeze frame mode\n        if (shadowMap.debugFreezeFrame) {\n            if (enterFreezeFrame) {\n                // Recreate debug camera when entering freeze frame mode\n                shadowMap._debugCameraFrustum = shadowMap._debugCameraFrustum && shadowMap._debugCameraFrustum.destroy();\n                shadowMap._debugCameraFrustum = new DebugCameraPrimitive({\n                    camera : shadowMap._sceneCamera,\n                    color : Color.CYAN,\n                    updateOnChange : false\n                });\n            }\n            shadowMap._debugCameraFrustum.update(frameState);\n        }\n\n        if (shadowMap._cascadesEnabled) {\n            // Draw cascades only in freeze frame mode\n            if (shadowMap.debugFreezeFrame) {\n                if (enterFreezeFrame) {\n                    // Recreate debug frustum when entering freeze frame mode\n                    shadowMap._debugLightFrustum = shadowMap._debugLightFrustum && shadowMap._debugLightFrustum.destroy();\n                    shadowMap._debugLightFrustum = new DebugCameraPrimitive({\n                        camera : shadowMap._shadowMapCamera,\n                        color : Color.YELLOW,\n                        updateOnChange : false\n                    });\n                }\n                shadowMap._debugLightFrustum.update(frameState);\n\n                for (var i = 0; i < shadowMap._numberOfCascades; ++i) {\n                    if (enterFreezeFrame) {\n                        // Recreate debug frustum when entering freeze frame mode\n                        shadowMap._debugCascadeFrustums[i] = shadowMap._debugCascadeFrustums[i] && shadowMap._debugCascadeFrustums[i].destroy();\n                        shadowMap._debugCascadeFrustums[i] = new DebugCameraPrimitive({\n                            camera : shadowMap._passes[i].camera,\n                            color : debugOutlineColors[i],\n                            updateOnChange : false\n                        });\n                    }\n                    shadowMap._debugCascadeFrustums[i].update(frameState);\n                }\n            }\n        } else if (shadowMap._isPointLight) {\n            if (!defined(shadowMap._debugLightFrustum) || shadowMap._needsUpdate) {\n                var translation = shadowMap._shadowMapCamera.positionWC;\n                var rotation = Quaternion.IDENTITY;\n                var uniformScale = shadowMap._pointLightRadius * 2.0;\n                var scale = Cartesian3.fromElements(uniformScale, uniformScale, uniformScale, scratchScale);\n                var modelMatrix = Matrix4.fromTranslationQuaternionRotationScale(translation, rotation, scale, scratchMatrix);\n\n                shadowMap._debugLightFrustum = shadowMap._debugLightFrustum && shadowMap._debugLightFrustum.destroy();\n                shadowMap._debugLightFrustum = createDebugPointLight(modelMatrix, Color.YELLOW);\n            }\n            shadowMap._debugLightFrustum.update(frameState);\n        } else {\n            if (!defined(shadowMap._debugLightFrustum) || shadowMap._needsUpdate) {\n                shadowMap._debugLightFrustum = new DebugCameraPrimitive({\n                    camera : shadowMap._shadowMapCamera,\n                    color : Color.YELLOW,\n                    updateOnChange : false\n                });\n            }\n            shadowMap._debugLightFrustum.update(frameState);\n        }\n    }\n\n    function ShadowMapCamera() {\n        this.viewMatrix = new Matrix4();\n        this.inverseViewMatrix = new Matrix4();\n        this.frustum = undefined;\n        this.positionCartographic = new Cartographic();\n        this.positionWC = new Cartesian3();\n        this.directionWC = Cartesian3.clone(Cartesian3.UNIT_Z);\n        this.upWC = Cartesian3.clone(Cartesian3.UNIT_Y);\n        this.rightWC = Cartesian3.clone(Cartesian3.UNIT_X);\n        this.viewProjectionMatrix = new Matrix4();\n    }\n\n    ShadowMapCamera.prototype.clone = function(camera) {\n        Matrix4.clone(camera.viewMatrix, this.viewMatrix);\n        Matrix4.clone(camera.inverseViewMatrix, this.inverseViewMatrix);\n        this.frustum = camera.frustum.clone(this.frustum);\n        Cartographic.clone(camera.positionCartographic, this.positionCartographic);\n        Cartesian3.clone(camera.positionWC, this.positionWC);\n        Cartesian3.clone(camera.directionWC, this.directionWC);\n        Cartesian3.clone(camera.upWC, this.upWC);\n        Cartesian3.clone(camera.rightWC, this.rightWC);\n    };\n\n    // Converts from NDC space to texture space\n    var scaleBiasMatrix = new Matrix4(0.5, 0.0, 0.0, 0.5, 0.0, 0.5, 0.0, 0.5, 0.0, 0.0, 0.5, 0.5, 0.0, 0.0, 0.0, 1.0);\n\n    ShadowMapCamera.prototype.getViewProjection = function() {\n        var view = this.viewMatrix;\n        var projection = this.frustum.projectionMatrix;\n        Matrix4.multiply(projection, view, this.viewProjectionMatrix);\n        Matrix4.multiply(scaleBiasMatrix, this.viewProjectionMatrix, this.viewProjectionMatrix);\n        return this.viewProjectionMatrix;\n    };\n\n    var scratchSplits = new Array(5);\n    var scratchFrustum = new PerspectiveFrustum();\n    var scratchCascadeDistances = new Array(4);\n    var scratchMin = new Cartesian3();\n    var scratchMax = new Cartesian3();\n\n    function computeCascades(shadowMap, frameState) {\n        var shadowMapCamera = shadowMap._shadowMapCamera;\n        var sceneCamera = shadowMap._sceneCamera;\n        var cameraNear = sceneCamera.frustum.near;\n        var cameraFar = sceneCamera.frustum.far;\n        var numberOfCascades = shadowMap._numberOfCascades;\n\n        // Split cascades. Use a mix of linear and log splits.\n        var i;\n        var range = cameraFar - cameraNear;\n        var ratio = cameraFar / cameraNear;\n\n        var lambda = 0.9;\n        var clampCascadeDistances = false;\n\n        // When the camera is close to a relatively small model, provide more detail in the closer cascades.\n        // If the camera is near or inside a large model, such as the root tile of a city, then use the default values.\n        // To get the most accurate cascade splits we would need to find the min and max values from the depth texture.\n        if (frameState.shadowState.closestObjectSize < 200.0) {\n            clampCascadeDistances = true;\n            lambda = 0.9;\n        }\n\n        var cascadeDistances = scratchCascadeDistances;\n        var splits = scratchSplits;\n        splits[0] = cameraNear;\n        splits[numberOfCascades] = cameraFar;\n\n        // Find initial splits\n        for (i = 0; i < numberOfCascades; ++i) {\n            var p = (i + 1) / numberOfCascades;\n            var logScale = cameraNear * Math.pow(ratio, p);\n            var uniformScale = cameraNear + range * p;\n            var split = CesiumMath.lerp(uniformScale, logScale, lambda);\n            splits[i + 1] = split;\n            cascadeDistances[i] = split - splits[i];\n        }\n\n        if (clampCascadeDistances) {\n            // Clamp each cascade to its maximum distance\n            for (i = 0; i < numberOfCascades; ++i) {\n                cascadeDistances[i] = Math.min(cascadeDistances[i], shadowMap._maximumCascadeDistances[i]);\n            }\n\n            // Recompute splits\n            var distance = splits[0];\n            for (i = 0; i < numberOfCascades - 1; ++i) {\n                distance += cascadeDistances[i];\n                splits[i + 1] = distance;\n            }\n        }\n\n        Cartesian4.unpack(splits, 0, shadowMap._cascadeSplits[0]);\n        Cartesian4.unpack(splits, 1, shadowMap._cascadeSplits[1]);\n        Cartesian4.unpack(cascadeDistances, 0, shadowMap._cascadeDistances);\n\n        var shadowFrustum = shadowMapCamera.frustum;\n        var left = shadowFrustum.left;\n        var right = shadowFrustum.right;\n        var bottom = shadowFrustum.bottom;\n        var top = shadowFrustum.top;\n        var near = shadowFrustum.near;\n        var far = shadowFrustum.far;\n\n        var position = shadowMapCamera.positionWC;\n        var direction = shadowMapCamera.directionWC;\n        var up = shadowMapCamera.upWC;\n\n        var cascadeSubFrustum = sceneCamera.frustum.clone(scratchFrustum);\n        var shadowViewProjection = shadowMapCamera.getViewProjection();\n\n        for (i = 0; i < numberOfCascades; ++i) {\n            // Find the bounding box of the camera sub-frustum in shadow map texture space\n            cascadeSubFrustum.near = splits[i];\n            cascadeSubFrustum.far = splits[i + 1];\n            var viewProjection = Matrix4.multiply(cascadeSubFrustum.projectionMatrix, sceneCamera.viewMatrix, scratchMatrix);\n            var inverseViewProjection = Matrix4.inverse(viewProjection, scratchMatrix);\n            var shadowMapMatrix = Matrix4.multiply(shadowViewProjection, inverseViewProjection, scratchMatrix);\n\n            // Project each corner from camera NDC space to shadow map texture space. Min and max will be from 0 to 1.\n            var min = Cartesian3.fromElements(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE, scratchMin);\n            var max = Cartesian3.fromElements(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE, scratchMax);\n\n            for (var k = 0; k < 8; ++k) {\n                var corner = Cartesian4.clone(frustumCornersNDC[k], scratchFrustumCorners[k]);\n                Matrix4.multiplyByVector(shadowMapMatrix, corner, corner);\n                Cartesian3.divideByScalar(corner, corner.w, corner); // Handle the perspective divide\n                Cartesian3.minimumByComponent(corner, min, min);\n                Cartesian3.maximumByComponent(corner, max, max);\n            }\n\n            // Limit light-space coordinates to the [0, 1] range\n            min.x = Math.max(min.x, 0.0);\n            min.y = Math.max(min.y, 0.0);\n            min.z = 0.0; // Always start cascade frustum at the top of the light frustum to capture objects in the light's path\n            max.x = Math.min(max.x, 1.0);\n            max.y = Math.min(max.y, 1.0);\n            max.z = Math.min(max.z, 1.0);\n\n            var pass = shadowMap._passes[i];\n            var cascadeCamera = pass.camera;\n            cascadeCamera.clone(shadowMapCamera); // PERFORMANCE_IDEA : could do a shallow clone for all properties except the frustum\n\n            var frustum = cascadeCamera.frustum;\n            frustum.left = left + min.x * (right - left);\n            frustum.right = left + max.x * (right - left);\n            frustum.bottom = bottom + min.y * (top - bottom);\n            frustum.top = bottom + max.y * (top - bottom);\n            frustum.near = near + min.z * (far - near);\n            frustum.far = near + max.z * (far - near);\n\n            pass.cullingVolume = cascadeCamera.frustum.computeCullingVolume(position, direction, up);\n\n            // Transforms from eye space to the cascade's texture space\n            var cascadeMatrix = shadowMap._cascadeMatrices[i];\n            Matrix4.multiply(cascadeCamera.getViewProjection(), sceneCamera.inverseViewMatrix, cascadeMatrix);\n            Matrix4.multiply(pass.textureOffsets, cascadeMatrix, cascadeMatrix);\n        }\n    }\n\n    var scratchLightView = new Matrix4();\n    var scratchRight = new Cartesian3();\n    var scratchUp = new Cartesian3();\n    var scratchTranslation = new Cartesian3();\n\n    function fitShadowMapToScene(shadowMap, frameState) {\n        var shadowMapCamera = shadowMap._shadowMapCamera;\n        var sceneCamera = shadowMap._sceneCamera;\n\n        // 1. First find a tight bounding box in light space that contains the entire camera frustum.\n        var viewProjection = Matrix4.multiply(sceneCamera.frustum.projectionMatrix, sceneCamera.viewMatrix, scratchMatrix);\n        var inverseViewProjection = Matrix4.inverse(viewProjection, scratchMatrix);\n\n        // Start to construct the light view matrix. Set translation later once the bounding box is found.\n        var lightDir = shadowMapCamera.directionWC;\n        var lightUp = sceneCamera.directionWC; // Align shadows to the camera view.\n        if (Cartesian3.equalsEpsilon(lightDir, lightUp, CesiumMath.EPSILON10)) {\n            lightUp = sceneCamera.upWC;\n        }\n        var lightRight = Cartesian3.cross(lightDir, lightUp, scratchRight);\n        lightUp = Cartesian3.cross(lightRight, lightDir, scratchUp); // Recalculate up now that right is derived\n        Cartesian3.normalize(lightUp, lightUp);\n        Cartesian3.normalize(lightRight, lightRight);\n        var lightPosition = Cartesian3.fromElements(0.0, 0.0, 0.0, scratchTranslation);\n\n        var lightView = Matrix4.computeView(lightPosition, lightDir, lightUp, lightRight, scratchLightView);\n        var cameraToLight = Matrix4.multiply(lightView, inverseViewProjection, scratchMatrix);\n\n        // Project each corner from NDC space to light view space, and calculate a min and max in light view space\n        var min = Cartesian3.fromElements(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE, scratchMin);\n        var max = Cartesian3.fromElements(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE, scratchMax);\n\n        for (var i = 0; i < 8; ++i) {\n            var corner = Cartesian4.clone(frustumCornersNDC[i], scratchFrustumCorners[i]);\n            Matrix4.multiplyByVector(cameraToLight, corner, corner);\n            Cartesian3.divideByScalar(corner, corner.w, corner); // Handle the perspective divide\n            Cartesian3.minimumByComponent(corner, min, min);\n            Cartesian3.maximumByComponent(corner, max, max);\n        }\n\n        // 2. Set bounding box back to include objects in the light's view\n        max.z += 1000.0; // Note: in light space, a positive number is behind the camera\n        min.z -= 10.0; // Extend the shadow volume forward slightly to avoid problems right at the edge\n\n        // 3. Adjust light view matrix so that it is centered on the bounding volume\n        var translation = scratchTranslation;\n        translation.x = -(0.5 * (min.x + max.x));\n        translation.y = -(0.5 * (min.y + max.y));\n        translation.z = -max.z;\n\n        var translationMatrix = Matrix4.fromTranslation(translation, scratchMatrix);\n        lightView = Matrix4.multiply(translationMatrix, lightView, lightView);\n\n        // 4. Create an orthographic frustum that covers the bounding box extents\n        var halfWidth = 0.5 * (max.x - min.x);\n        var halfHeight = 0.5 * (max.y - min.y);\n        var depth = max.z - min.z;\n\n        var frustum = shadowMapCamera.frustum;\n        frustum.left = -halfWidth;\n        frustum.right = halfWidth;\n        frustum.bottom = -halfHeight;\n        frustum.top = halfHeight;\n        frustum.near = 0.01;\n        frustum.far = depth;\n\n        // 5. Update the shadow map camera\n        Matrix4.clone(lightView, shadowMapCamera.viewMatrix);\n        Matrix4.inverse(lightView, shadowMapCamera.inverseViewMatrix);\n        Matrix4.getTranslation(shadowMapCamera.inverseViewMatrix, shadowMapCamera.positionWC);\n        frameState.mapProjection.ellipsoid.cartesianToCartographic(shadowMapCamera.positionWC, shadowMapCamera.positionCartographic);\n        Cartesian3.clone(lightDir, shadowMapCamera.directionWC);\n        Cartesian3.clone(lightUp, shadowMapCamera.upWC);\n        Cartesian3.clone(lightRight, shadowMapCamera.rightWC);\n    }\n\n    var directions = [\n        new Cartesian3(-1.0, 0.0, 0.0),\n        new Cartesian3(0.0, -1.0, 0.0),\n        new Cartesian3(0.0, 0.0, -1.0),\n        new Cartesian3(1.0, 0.0, 0.0),\n        new Cartesian3(0.0, 1.0, 0.0),\n        new Cartesian3(0.0, 0.0, 1.0)\n    ];\n\n    var ups = [\n        new Cartesian3(0.0, -1.0, 0.0),\n        new Cartesian3(0.0, 0.0, -1.0),\n        new Cartesian3(0.0, -1.0, 0.0),\n        new Cartesian3(0.0, -1.0, 0.0),\n        new Cartesian3(0.0, 0.0, 1.0),\n        new Cartesian3(0.0, -1.0, 0.0)\n    ];\n\n    var rights = [\n        new Cartesian3(0.0, 0.0, 1.0),\n        new Cartesian3(1.0, 0.0, 0.0),\n        new Cartesian3(-1.0, 0.0, 0.0),\n        new Cartesian3(0.0, 0.0, -1.0),\n        new Cartesian3(1.0, 0.0, 0.0),\n        new Cartesian3(1.0, 0.0, 0.0)\n    ];\n\n    function computeOmnidirectional(shadowMap, frameState) {\n        // All sides share the same frustum\n        var frustum = new PerspectiveFrustum();\n        frustum.fov = CesiumMath.PI_OVER_TWO;\n        frustum.near = 1.0;\n        frustum.far = shadowMap._pointLightRadius;\n        frustum.aspectRatio = 1.0;\n\n        for (var i = 0; i < 6; ++i) {\n            var camera = shadowMap._passes[i].camera;\n            camera.positionWC = shadowMap._shadowMapCamera.positionWC;\n            camera.positionCartographic = frameState.mapProjection.ellipsoid.cartesianToCartographic(camera.positionWC, camera.positionCartographic);\n            camera.directionWC = directions[i];\n            camera.upWC = ups[i];\n            camera.rightWC = rights[i];\n\n            Matrix4.computeView(camera.positionWC, camera.directionWC, camera.upWC, camera.rightWC, camera.viewMatrix);\n            Matrix4.inverse(camera.viewMatrix, camera.inverseViewMatrix);\n\n            camera.frustum = frustum;\n        }\n    }\n\n    var scratchCartesian1 = new Cartesian3();\n    var scratchCartesian2 = new Cartesian3();\n    var scratchBoundingSphere = new BoundingSphere();\n    var scratchCenter = scratchBoundingSphere.center;\n\n    function checkVisibility(shadowMap, frameState) {\n        var sceneCamera = shadowMap._sceneCamera;\n        var shadowMapCamera = shadowMap._shadowMapCamera;\n\n        var boundingSphere = scratchBoundingSphere;\n\n        // Check whether the shadow map is in view and needs to be updated\n        if (shadowMap._cascadesEnabled) {\n            // If the nearest shadow receiver is further than the shadow map's maximum distance then the shadow map is out of view.\n            if (sceneCamera.frustum.near >= shadowMap.maximumDistance) {\n                shadowMap._outOfView = true;\n                shadowMap._needsUpdate = false;\n                return;\n            }\n\n            // If the light source is below the horizon then the shadow map is out of view\n            var surfaceNormal = frameState.mapProjection.ellipsoid.geodeticSurfaceNormal(sceneCamera.positionWC, scratchCartesian1);\n            var lightDirection = Cartesian3.negate(shadowMapCamera.directionWC, scratchCartesian2);\n            var dot = Cartesian3.dot(surfaceNormal, lightDirection);\n\n            // Shadows start to fade out once the light gets closer to the horizon.\n            // At this point the globe uses vertex lighting alone to darken the surface.\n            var darknessAmount = CesiumMath.clamp(dot / 0.1, 0.0, 1.0);\n            shadowMap._darkness = CesiumMath.lerp(1.0, shadowMap.darkness, darknessAmount);\n\n            if (dot < 0.0) {\n                shadowMap._outOfView = true;\n                shadowMap._needsUpdate = false;\n                return;\n            }\n\n            // By default cascaded shadows need to update and are always in view\n            shadowMap._needsUpdate = true;\n            shadowMap._outOfView = false;\n        } else if (shadowMap._isPointLight) {\n            // Sphere-frustum intersection test\n            boundingSphere.center = shadowMapCamera.positionWC;\n            boundingSphere.radius = shadowMap._pointLightRadius;\n            shadowMap._outOfView = frameState.cullingVolume.computeVisibility(boundingSphere) === Intersect.OUTSIDE;\n            shadowMap._needsUpdate = !shadowMap._outOfView && !shadowMap._boundingSphere.equals(boundingSphere);\n            BoundingSphere.clone(boundingSphere, shadowMap._boundingSphere);\n        } else {\n            // Simplify frustum-frustum intersection test as a sphere-frustum test\n            var frustumRadius = shadowMapCamera.frustum.far / 2.0;\n            var frustumCenter = Cartesian3.add(shadowMapCamera.positionWC, Cartesian3.multiplyByScalar(shadowMapCamera.directionWC, frustumRadius, scratchCenter), scratchCenter);\n            boundingSphere.center = frustumCenter;\n            boundingSphere.radius = frustumRadius;\n            shadowMap._outOfView = frameState.cullingVolume.computeVisibility(boundingSphere) === Intersect.OUTSIDE;\n            shadowMap._needsUpdate = !shadowMap._outOfView && !shadowMap._boundingSphere.equals(boundingSphere);\n            BoundingSphere.clone(boundingSphere, shadowMap._boundingSphere);\n        }\n    }\n\n    function updateCameras(shadowMap, frameState) {\n        var camera = frameState.camera; // The actual camera in the scene\n        var lightCamera = shadowMap._lightCamera; // The external camera representing the light source\n        var sceneCamera = shadowMap._sceneCamera; // Clone of camera, with clamped near and far planes\n        var shadowMapCamera = shadowMap._shadowMapCamera; // Camera representing the shadow volume, initially cloned from lightCamera\n\n        // Clone light camera into the shadow map camera\n        if (shadowMap._cascadesEnabled) {\n            Cartesian3.clone(lightCamera.directionWC, shadowMapCamera.directionWC);\n        } else if (shadowMap._isPointLight) {\n            Cartesian3.clone(lightCamera.positionWC, shadowMapCamera.positionWC);\n        } else {\n            shadowMapCamera.clone(lightCamera);\n        }\n\n        // Get the light direction in eye coordinates\n        var lightDirection = shadowMap._lightDirectionEC;\n        Matrix4.multiplyByPointAsVector(camera.viewMatrix, shadowMapCamera.directionWC, lightDirection);\n        Cartesian3.normalize(lightDirection, lightDirection);\n        Cartesian3.negate(lightDirection, lightDirection);\n\n        // Get the light position in eye coordinates\n        Matrix4.multiplyByPoint(camera.viewMatrix, shadowMapCamera.positionWC, shadowMap._lightPositionEC);\n        shadowMap._lightPositionEC.w = shadowMap._pointLightRadius;\n\n        // Get the near and far of the scene camera\n        var near;\n        var far;\n        if (shadowMap._fitNearFar) {\n            // shadowFar can be very large, so limit to shadowMap.maximumDistance\n            // Push the far plane slightly further than the near plane to avoid degenerate frustum\n            near = Math.min(frameState.shadowState.nearPlane, shadowMap.maximumDistance);\n            far = Math.min(frameState.shadowState.farPlane, shadowMap.maximumDistance + 1.0);\n        } else {\n            near = camera.frustum.near;\n            far = shadowMap.maximumDistance;\n        }\n\n        shadowMap._sceneCamera = Camera.clone(camera, sceneCamera);\n        camera.frustum.clone(shadowMap._sceneCamera.frustum);\n        shadowMap._sceneCamera.frustum.near = near;\n        shadowMap._sceneCamera.frustum.far = far;\n        shadowMap._distance = far - near;\n\n        checkVisibility(shadowMap, frameState);\n\n        if (!shadowMap._outOfViewPrevious && shadowMap._outOfView) {\n            shadowMap._needsUpdate = true;\n        }\n        shadowMap._outOfViewPrevious = shadowMap._outOfView;\n    }\n\n    /**\n     * @private\n     */\n    ShadowMap.prototype.update = function(frameState) {\n        updateCameras(this, frameState);\n\n        if (this._needsUpdate) {\n            updateFramebuffer(this, frameState.context);\n\n            if (this._isPointLight) {\n                computeOmnidirectional(this, frameState);\n            }\n\n            if (this._cascadesEnabled) {\n                fitShadowMapToScene(this, frameState);\n\n                if (this._numberOfCascades > 1) {\n                    computeCascades(this, frameState);\n                }\n            }\n\n            if (!this._isPointLight) {\n                // Compute the culling volume\n                var shadowMapCamera = this._shadowMapCamera;\n                var position = shadowMapCamera.positionWC;\n                var direction = shadowMapCamera.directionWC;\n                var up = shadowMapCamera.upWC;\n                this._shadowMapCullingVolume = shadowMapCamera.frustum.computeCullingVolume(position, direction, up);\n\n                if (this._passes.length === 1) {\n                    // Since there is only one pass, use the shadow map camera as the pass camera.\n                    this._passes[0].camera.clone(shadowMapCamera);\n                }\n            } else {\n                this._shadowMapCullingVolume = CullingVolume.fromBoundingSphere(this._boundingSphere);\n            }\n        }\n\n        if (this._passes.length === 1) {\n            // Transforms from eye space to shadow texture space.\n            // Always requires an update since the scene camera constantly changes.\n            var inverseView = this._sceneCamera.inverseViewMatrix;\n            Matrix4.multiply(this._shadowMapCamera.getViewProjection(), inverseView, this._shadowMapMatrix);\n        }\n\n        if (this.debugShow) {\n            applyDebugSettings(this, frameState);\n        }\n    };\n\n    /**\n     * @private\n     */\n    ShadowMap.prototype.updatePass = function(context, shadowPass) {\n        clearFramebuffer(this, context, shadowPass);\n    };\n\n    var scratchTexelStepSize = new Cartesian2();\n\n    function combineUniforms(shadowMap, uniforms, isTerrain) {\n        var bias = shadowMap._isPointLight ? shadowMap._pointBias : (isTerrain ? shadowMap._terrainBias : shadowMap._primitiveBias);\n\n        var mapUniforms = {\n            shadowMap_texture :function() {\n                return shadowMap._shadowMapTexture;\n            },\n            shadowMap_textureCube : function() {\n                return shadowMap._shadowMapTexture;\n            },\n            shadowMap_matrix : function() {\n                return shadowMap._shadowMapMatrix;\n            },\n            shadowMap_cascadeSplits : function() {\n                return shadowMap._cascadeSplits;\n            },\n            shadowMap_cascadeMatrices : function() {\n                return shadowMap._cascadeMatrices;\n            },\n            shadowMap_lightDirectionEC : function() {\n                return shadowMap._lightDirectionEC;\n            },\n            shadowMap_lightPositionEC : function() {\n                return shadowMap._lightPositionEC;\n            },\n            shadowMap_cascadeDistances : function() {\n                return shadowMap._cascadeDistances;\n            },\n            shadowMap_texelSizeDepthBiasAndNormalShadingSmooth : function() {\n                var texelStepSize = scratchTexelStepSize;\n                texelStepSize.x = 1.0 / shadowMap._textureSize.x;\n                texelStepSize.y = 1.0 / shadowMap._textureSize.y;\n\n                return Cartesian4.fromElements(texelStepSize.x, texelStepSize.y, bias.depthBias, bias.normalShadingSmooth, this.combinedUniforms1);\n            },\n            shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness : function() {\n                return Cartesian4.fromElements(bias.normalOffsetScale, shadowMap._distance, shadowMap.maximumDistance, shadowMap._darkness, this.combinedUniforms2);\n            },\n\n            combinedUniforms1 : new Cartesian4(),\n            combinedUniforms2 : new Cartesian4()\n        };\n\n        return combine(uniforms, mapUniforms, false);\n    }\n\n    function createCastDerivedCommand(shadowMap, shadowsDirty, command, context, oldShaderId, result) {\n        var castShader;\n        var castRenderState;\n        var castUniformMap;\n        if (defined(result)) {\n            castShader = result.shaderProgram;\n            castRenderState = result.renderState;\n            castUniformMap = result.uniformMap;\n        }\n\n        result = DrawCommand.shallowClone(command, result);\n        result.castShadows = true;\n        result.receiveShadows = false;\n\n        if (!defined(castShader) || oldShaderId !== command.shaderProgram.id || shadowsDirty) {\n            var shaderProgram = command.shaderProgram;\n\n            var isTerrain = command.pass === Pass.GLOBE;\n            var isOpaque = command.pass !== Pass.TRANSLUCENT;\n            var isPointLight = shadowMap._isPointLight;\n            var usesDepthTexture= shadowMap._usesDepthTexture;\n\n            var keyword =  ShadowMapShader.getShadowCastShaderKeyword(isPointLight, isTerrain, usesDepthTexture, isOpaque);\n            castShader = context.shaderCache.getDerivedShaderProgram(shaderProgram, keyword);\n            if (!defined(castShader)) {\n                var vertexShaderSource = shaderProgram.vertexShaderSource;\n                var fragmentShaderSource = shaderProgram.fragmentShaderSource;\n\n                var castVS = ShadowMapShader.createShadowCastVertexShader(vertexShaderSource, isPointLight, isTerrain);\n                var castFS = ShadowMapShader.createShadowCastFragmentShader(fragmentShaderSource, isPointLight, usesDepthTexture, isOpaque);\n\n                castShader = context.shaderCache.createDerivedShaderProgram(shaderProgram, keyword, {\n                    vertexShaderSource : castVS,\n                    fragmentShaderSource : castFS,\n                    attributeLocations : shaderProgram._attributeLocations\n                });\n            }\n\n            castRenderState = shadowMap._primitiveRenderState;\n            if (isPointLight) {\n                castRenderState = shadowMap._pointRenderState;\n            } else if (isTerrain) {\n                castRenderState = shadowMap._terrainRenderState;\n            }\n\n            // Modify the render state for commands that do not use back-face culling, e.g. flat textured walls\n            var cullEnabled = command.renderState.cull.enabled;\n            if (!cullEnabled) {\n                castRenderState = clone(castRenderState, false);\n                castRenderState.cull = clone(castRenderState.cull, false);\n                castRenderState.cull.enabled = false;\n                castRenderState = RenderState.fromCache(castRenderState);\n            }\n\n            castUniformMap = combineUniforms(shadowMap, command.uniformMap, isTerrain);\n        }\n\n        result.shaderProgram = castShader;\n        result.renderState = castRenderState;\n        result.uniformMap = castUniformMap;\n\n        return result;\n    }\n\n    ShadowMap.createReceiveDerivedCommand = function(lightShadowMaps, command, shadowsDirty, context, result) {\n        if (!defined(result)) {\n            result = {};\n        }\n\n        var lightShadowMapsEnabled = (lightShadowMaps.length > 0);\n        var shaderProgram = command.shaderProgram;\n        var vertexShaderSource = shaderProgram.vertexShaderSource;\n        var fragmentShaderSource = shaderProgram.fragmentShaderSource;\n        var isTerrain = command.pass === Pass.GLOBE;\n\n        var hasTerrainNormal = false;\n        if (isTerrain) {\n            hasTerrainNormal = command.owner.data.renderedMesh.encoding.hasVertexNormals;\n        }\n\n        if (command.receiveShadows && lightShadowMapsEnabled) {\n            // Only generate a receiveCommand if there is a shadow map originating from a light source.\n            var receiveShader;\n            var receiveUniformMap;\n            if (defined(result.receiveCommand)) {\n                receiveShader = result.receiveCommand.shaderProgram;\n                receiveUniformMap = result.receiveCommand.uniformMap;\n            }\n\n            result.receiveCommand = DrawCommand.shallowClone(command, result.receiveCommand);\n            result.castShadows = false;\n            result.receiveShadows = true;\n\n            // If castShadows changed, recompile the receive shadows shader. The normal shading technique simulates\n            // self-shadowing so it should be turned off if castShadows is false.\n            var castShadowsDirty = result.receiveShaderCastShadows !== command.castShadows;\n            var shaderDirty = result.receiveShaderProgramId !== command.shaderProgram.id;\n\n            if (!defined(receiveShader) || shaderDirty || shadowsDirty || castShadowsDirty) {\n                var keyword = ShadowMapShader.getShadowReceiveShaderKeyword(lightShadowMaps[0], command.castShadows, isTerrain, hasTerrainNormal);\n                receiveShader = context.shaderCache.getDerivedShaderProgram(shaderProgram, keyword);\n                if (!defined(receiveShader)) {\n                    var receiveVS = ShadowMapShader.createShadowReceiveVertexShader(vertexShaderSource, isTerrain, hasTerrainNormal);\n                    var receiveFS = ShadowMapShader.createShadowReceiveFragmentShader(fragmentShaderSource, lightShadowMaps[0], command.castShadows, isTerrain, hasTerrainNormal);\n\n                    receiveShader = context.shaderCache.createDerivedShaderProgram(shaderProgram, keyword, {\n                        vertexShaderSource : receiveVS,\n                        fragmentShaderSource : receiveFS,\n                        attributeLocations : shaderProgram._attributeLocations\n                    });\n                }\n\n                receiveUniformMap = combineUniforms(lightShadowMaps[0], command.uniformMap, isTerrain);\n            }\n\n            result.receiveCommand.shaderProgram = receiveShader;\n            result.receiveCommand.uniformMap = receiveUniformMap;\n            result.receiveShaderProgramId = command.shaderProgram.id;\n            result.receiveShaderCastShadows = command.castShadows;\n        }\n\n        return result;\n    };\n\n    ShadowMap.createCastDerivedCommand = function(shadowMaps, command, shadowsDirty, context, result) {\n        if (!defined(result)) {\n            result = {};\n        }\n\n        if (command.castShadows) {\n            var castCommands = result.castCommands;\n            if (!defined(castCommands)) {\n                castCommands = result.castCommands = [];\n            }\n\n            var oldShaderId = result.castShaderProgramId;\n\n            var shadowMapLength = shadowMaps.length;\n            castCommands.length = shadowMapLength;\n\n            for (var i = 0; i < shadowMapLength; ++i) {\n                castCommands[i] = createCastDerivedCommand(shadowMaps[i], shadowsDirty, command, context, oldShaderId, castCommands[i]);\n            }\n\n            result.castShaderProgramId = command.shaderProgram.id;\n        }\n\n        return result;\n    };\n\n    /**\n     * @private\n     */\n    ShadowMap.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * @private\n     */\n    ShadowMap.prototype.destroy = function() {\n        destroyFramebuffer(this);\n\n        this._debugLightFrustum = this._debugLightFrustum && this._debugLightFrustum.destroy();\n        this._debugCameraFrustum = this._debugCameraFrustum && this._debugCameraFrustum.destroy();\n        this._debugShadowViewCommand = this._debugShadowViewCommand && this._debugShadowViewCommand.shaderProgram && this._debugShadowViewCommand.shaderProgram.destroy();\n\n        for (var i = 0; i < this._numberOfCascades; ++i) {\n            this._debugCascadeFrustums[i] = this._debugCascadeFrustums[i] && this._debugCascadeFrustums[i].destroy();\n        }\n\n        return destroyObject(this);\n    };\nexport default ShadowMap;\n","import BoundingRectangle from '../Core/BoundingRectangle.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport CullingVolume from '../Core/CullingVolume.js';\nimport defined from '../Core/defined.js';\nimport getTimestamp from '../Core/getTimestamp.js';\nimport Interval from '../Core/Interval.js';\nimport CesiumMath from '../Core/Math.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport ClearCommand from '../Renderer/ClearCommand.js';\nimport Pass from '../Renderer/Pass.js';\nimport PassState from '../Renderer/PassState.js';\nimport Camera from './Camera.js';\nimport FrustumCommands from './FrustumCommands.js';\nimport GlobeDepth from './GlobeDepth.js';\nimport OIT from './OIT.js';\nimport PickDepthFramebuffer from './PickDepthFramebuffer.js';\nimport PickFramebuffer from './PickFramebuffer.js';\nimport SceneFramebuffer from './SceneFramebuffer.js';\nimport SceneMode from './SceneMode.js';\nimport ShadowMap from './ShadowMap.js';\n\n    /**\n     * @private\n     */\n    function View(scene, camera, viewport) {\n        var context = scene.context;\n\n        var frustumCommandsList = [];\n\n        // Initial guess at frustums.\n        var near = camera.frustum.near;\n        var far = camera.frustum.far;\n        var farToNearRatio = scene.logarithmicDepthBuffer ? scene.logarithmicDepthFarToNearRatio : scene.farToNearRatio;\n\n        var numFrustums = Math.ceil(Math.log(far / near) / Math.log(farToNearRatio));\n        updateFrustums(near, far, farToNearRatio, numFrustums, scene.logarithmicDepthBuffer, frustumCommandsList, false, undefined);\n\n        var globeDepth;\n        if (context.depthTexture) {\n            globeDepth = new GlobeDepth();\n        }\n\n        var oit;\n        if (scene._useOIT && context.depthTexture) {\n            oit = new OIT(context);\n        }\n\n        var passState = new PassState(context);\n        passState.viewport = BoundingRectangle.clone(viewport);\n\n        this.camera = camera;\n        this._cameraClone = Camera.clone(camera);\n        this._cameraStartFired = false;\n        this._cameraMovedTime = undefined;\n\n        this.viewport = viewport;\n        this.passState = passState;\n        this.pickFramebuffer = new PickFramebuffer(context);\n        this.pickDepthFramebuffer = new PickDepthFramebuffer();\n        this.sceneFramebuffer = new SceneFramebuffer();\n        this.globeDepth = globeDepth;\n        this.oit = oit;\n        this.pickDepths = [];\n        this.debugGlobeDepths = [];\n        this.frustumCommandsList = frustumCommandsList;\n        this.debugFrustumStatistics = undefined;\n        this.updateFrustums = false;\n    }\n\n    var scratchPosition0 = new Cartesian3();\n    var scratchPosition1 = new Cartesian3();\n    function maxComponent(a, b) {\n        var x = Math.max(Math.abs(a.x), Math.abs(b.x));\n        var y = Math.max(Math.abs(a.y), Math.abs(b.y));\n        var z = Math.max(Math.abs(a.z), Math.abs(b.z));\n        return Math.max(Math.max(x, y), z);\n    }\n\n    function cameraEqual(camera0, camera1, epsilon) {\n        var scalar = 1 / Math.max(1, maxComponent(camera0.position, camera1.position));\n        Cartesian3.multiplyByScalar(camera0.position, scalar, scratchPosition0);\n        Cartesian3.multiplyByScalar(camera1.position, scalar, scratchPosition1);\n        return Cartesian3.equalsEpsilon(scratchPosition0, scratchPosition1, epsilon) &&\n               Cartesian3.equalsEpsilon(camera0.direction, camera1.direction, epsilon) &&\n               Cartesian3.equalsEpsilon(camera0.up, camera1.up, epsilon) &&\n               Cartesian3.equalsEpsilon(camera0.right, camera1.right, epsilon) &&\n               Matrix4.equalsEpsilon(camera0.transform, camera1.transform, epsilon) &&\n               camera0.frustum.equalsEpsilon(camera1.frustum, epsilon);\n    }\n\n    View.prototype.checkForCameraUpdates = function(scene) {\n        var camera = this.camera;\n        var cameraClone = this._cameraClone;\n        if (!cameraEqual(camera, cameraClone, CesiumMath.EPSILON15)) {\n            if (!this._cameraStartFired) {\n                camera.moveStart.raiseEvent();\n                this._cameraStartFired = true;\n            }\n            this._cameraMovedTime = getTimestamp();\n            Camera.clone(camera, cameraClone);\n\n            return true;\n        }\n\n        if (this._cameraStartFired && getTimestamp() - this._cameraMovedTime > scene.cameraEventWaitTime) {\n            camera.moveEnd.raiseEvent();\n            this._cameraStartFired = false;\n        }\n\n        return false;\n    };\n\n    function updateFrustums(near, far, farToNearRatio, numFrustums, logDepth, frustumCommandsList, is2D, nearToFarDistance2D) {\n        frustumCommandsList.length = numFrustums;\n        for (var m = 0; m < numFrustums; ++m) {\n            var curNear;\n            var curFar;\n\n            if (is2D) {\n                curNear = Math.min(far - nearToFarDistance2D, near + m * nearToFarDistance2D);\n                curFar = Math.min(far, curNear + nearToFarDistance2D);\n            } else  {\n                curNear = Math.max(near, Math.pow(farToNearRatio, m) * near);\n                curFar = farToNearRatio * curNear;\n                if (!logDepth) {\n                    curFar = Math.min(far, curFar);\n                }\n            }\n\n            var frustumCommands = frustumCommandsList[m];\n            if (!defined(frustumCommands)) {\n                frustumCommands = frustumCommandsList[m] = new FrustumCommands(curNear, curFar);\n            } else {\n                frustumCommands.near = curNear;\n                frustumCommands.far = curFar;\n            }\n        }\n    }\n\n    function insertIntoBin(scene, view, command, distance) {\n        if (scene.debugShowFrustums) {\n            command.debugOverlappingFrustums = 0;\n        }\n\n        var frustumCommandsList = view.frustumCommandsList;\n        var length = frustumCommandsList.length;\n\n        for (var i = 0; i < length; ++i) {\n            var frustumCommands = frustumCommandsList[i];\n            var curNear = frustumCommands.near;\n            var curFar = frustumCommands.far;\n\n            if (distance.start > curFar) {\n                continue;\n            }\n\n            if (distance.stop < curNear) {\n                break;\n            }\n\n            var pass = command.pass;\n            var index = frustumCommands.indices[pass]++;\n            frustumCommands.commands[pass][index] = command;\n\n            if (scene.debugShowFrustums) {\n                command.debugOverlappingFrustums |= (1 << i);\n            }\n\n            if (command.executeInClosestFrustum) {\n                break;\n            }\n        }\n\n        if (scene.debugShowFrustums) {\n            var cf = view.debugFrustumStatistics.commandsInFrustums;\n            cf[command.debugOverlappingFrustums] = defined(cf[command.debugOverlappingFrustums]) ? cf[command.debugOverlappingFrustums] + 1 : 1;\n            ++view.debugFrustumStatistics.totalCommands;\n        }\n\n        scene.updateDerivedCommands(command);\n    }\n\n    var scratchCullingVolume = new CullingVolume();\n    var distances = new Interval();\n\n    View.prototype.createPotentiallyVisibleSet = function(scene) {\n        var frameState = scene.frameState;\n        var camera = frameState.camera;\n        var direction = camera.directionWC;\n        var position = camera.positionWC;\n\n        var computeList = scene._computeCommandList;\n        var overlayList = scene._overlayCommandList;\n        var commandList = frameState.commandList;\n\n        if (scene.debugShowFrustums) {\n            this.debugFrustumStatistics = {\n                totalCommands : 0,\n                commandsInFrustums : {}\n            };\n        }\n\n        var frustumCommandsList = this.frustumCommandsList;\n        var numberOfFrustums = frustumCommandsList.length;\n        var numberOfPasses = Pass.NUMBER_OF_PASSES;\n        for (var n = 0; n < numberOfFrustums; ++n) {\n            for (var p = 0; p < numberOfPasses; ++p) {\n                frustumCommandsList[n].indices[p] = 0;\n            }\n        }\n\n        computeList.length = 0;\n        overlayList.length = 0;\n\n        var near = Number.MAX_VALUE;\n        var far = -Number.MAX_VALUE;\n        var undefBV = false;\n\n        var shadowsEnabled = frameState.shadowState.shadowsEnabled;\n        var shadowNear = Number.MAX_VALUE;\n        var shadowFar = -Number.MAX_VALUE;\n        var shadowClosestObjectSize = Number.MAX_VALUE;\n\n        var occluder = (frameState.mode === SceneMode.SCENE3D) ? frameState.occluder: undefined;\n        var cullingVolume = frameState.cullingVolume;\n\n        // get user culling volume minus the far plane.\n        var planes = scratchCullingVolume.planes;\n        for (var k = 0; k < 5; ++k) {\n            planes[k] = cullingVolume.planes[k];\n        }\n        cullingVolume = scratchCullingVolume;\n\n        var length = commandList.length;\n        for (var i = 0; i < length; ++i) {\n            var command = commandList[i];\n            var pass = command.pass;\n\n            if (pass === Pass.COMPUTE) {\n                computeList.push(command);\n            } else if (pass === Pass.OVERLAY) {\n                overlayList.push(command);\n            } else {\n                var boundingVolume = command.boundingVolume;\n                if (defined(boundingVolume)) {\n                    if (!scene.isVisible(command, cullingVolume, occluder)) {\n                        continue;\n                    }\n\n                    distances = boundingVolume.computePlaneDistances(position, direction, distances);\n                    near = Math.min(near, distances.start);\n                    far = Math.max(far, distances.stop);\n\n                    // Compute a tight near and far plane for commands that receive shadows. This helps compute\n                    // good splits for cascaded shadow maps. Ignore commands that exceed the maximum distance.\n                    // When moving the camera low LOD globe tiles begin to load, whose bounding volumes\n                    // throw off the near/far fitting for the shadow map. Only update for globe tiles that the\n                    // camera isn't inside.\n                    if (shadowsEnabled && command.receiveShadows && (distances.start < ShadowMap.MAXIMUM_DISTANCE) &&\n                        !((pass === Pass.GLOBE) && (distances.start < -100.0) && (distances.stop > 100.0))) {\n\n                        // Get the smallest bounding volume the camera is near. This is used to place more shadow detail near the object.\n                        var size = distances.stop - distances.start;\n                        if ((pass !== Pass.GLOBE) && (distances.start < 100.0)) {\n                            shadowClosestObjectSize = Math.min(shadowClosestObjectSize, size);\n                        }\n                        shadowNear = Math.min(shadowNear, distances.start);\n                        shadowFar = Math.max(shadowFar, distances.stop);\n                    }\n                } else {\n                    // Clear commands don't need a bounding volume - just add the clear to all frustums.\n                    // If another command has no bounding volume, though, we need to use the camera's\n                    // worst-case near and far planes to avoid clipping something important.\n                    distances.start = camera.frustum.near;\n                    distances.stop = camera.frustum.far;\n                    undefBV = undefBV || !(command instanceof ClearCommand);\n                }\n\n                insertIntoBin(scene, this, command, distances);\n            }\n        }\n\n        if (undefBV) {\n            near = camera.frustum.near;\n            far = camera.frustum.far;\n        } else {\n            // The computed near plane must be between the user defined near and far planes.\n            // The computed far plane must between the user defined far and computed near.\n            // This will handle the case where the computed near plane is further than the user defined far plane.\n            near = Math.min(Math.max(near, camera.frustum.near), camera.frustum.far);\n            far = Math.max(Math.min(far, camera.frustum.far), near);\n\n            if (shadowsEnabled) {\n                shadowNear = Math.min(Math.max(shadowNear, camera.frustum.near), camera.frustum.far);\n                shadowFar = Math.max(Math.min(shadowFar, camera.frustum.far), shadowNear);\n            }\n        }\n\n        // Use the computed near and far for shadows\n        if (shadowsEnabled) {\n            frameState.shadowState.nearPlane = shadowNear;\n            frameState.shadowState.farPlane = shadowFar;\n            frameState.shadowState.closestObjectSize = shadowClosestObjectSize;\n        }\n\n        // Exploit temporal coherence. If the frustums haven't changed much, use the frustums computed\n        // last frame, else compute the new frustums and sort them by frustum again.\n        var is2D = scene.mode === SceneMode.SCENE2D;\n        var logDepth = frameState.useLogDepth;\n        var farToNearRatio = logDepth ? scene.logarithmicDepthFarToNearRatio : scene.farToNearRatio;\n        var numFrustums;\n\n        if (is2D) {\n            // The multifrustum for 2D is uniformly distributed. To avoid z-fighting in 2D,\n            // the camera is moved to just before the frustum and the frustum depth is scaled\n            // to be in [1.0, nearToFarDistance2D].\n            far = Math.min(far, camera.position.z + scene.nearToFarDistance2D);\n            near = Math.min(near, far);\n            numFrustums = Math.ceil(Math.max(1.0, far - near) / scene.nearToFarDistance2D);\n        } else {\n            // The multifrustum for 3D/CV is non-uniformly distributed.\n            numFrustums = Math.ceil(Math.log(far / near) / Math.log(farToNearRatio));\n        }\n\n        if (this.updateFrustums || (near !== Number.MAX_VALUE && (numFrustums !== numberOfFrustums || (frustumCommandsList.length !== 0 &&\n                (near < frustumCommandsList[0].near || (far > frustumCommandsList[numberOfFrustums - 1].far && (logDepth || !CesiumMath.equalsEpsilon(far, frustumCommandsList[numberOfFrustums - 1].far, CesiumMath.EPSILON8)))))))) {\n            this.updateFrustums = false;\n            updateFrustums(near, far, farToNearRatio, numFrustums, logDepth, frustumCommandsList, is2D, scene.nearToFarDistance2D);\n            this.createPotentiallyVisibleSet(scene);\n        }\n\n        var frustumSplits = frameState.frustumSplits;\n        frustumSplits.length = numFrustums + 1;\n        for (var j = 0; j < numFrustums; ++j) {\n            frustumSplits[j] = frustumCommandsList[j].near;\n            if (j === numFrustums - 1) {\n                frustumSplits[j + 1] = frustumCommandsList[j].far;\n            }\n        }\n    };\n\n    View.prototype.destroy = function() {\n        this.pickFramebuffer = this.pickFramebuffer && this.pickFramebuffer.destroy();\n        this.pickDepthFramebuffer = this.pickDepthFramebuffer && this.pickDepthFramebuffer.destroy();\n        this.sceneFramebuffer = this.sceneFramebuffer && this.sceneFramebuffer.destroy();\n        this.globeDepth = this.globeDepth && this.globeDepth.destroy();\n        this.oit = this.oit && this.oit.destroy();\n\n        var i;\n        var length;\n\n        var pickDepths = this.pickDepths;\n        var debugGlobeDepths = this.debugGlobeDepths;\n\n        length = pickDepths.length;\n        for (i = 0; i < length; ++i) {\n            pickDepths[i].destroy();\n        }\n\n        length = debugGlobeDepths.length;\n        for (i = 0; i < length; ++i) {\n            debugGlobeDepths[i].destroy();\n        }\n    };\nexport default View;\n","import  ApproximateTerrainHeights from '../Core/ApproximateTerrainHeights.js';\nimport  BoundingRectangle from '../Core/BoundingRectangle.js';\nimport  Cartesian2 from '../Core/Cartesian2.js';\nimport  Cartesian3 from '../Core/Cartesian3.js';\nimport  Cartographic from '../Core/Cartographic.js';\nimport  Check from '../Core/Check.js';\nimport  Color from '../Core/Color.js';\nimport  defaultValue from '../Core/defaultValue.js';\nimport  defined from '../Core/defined.js';\nimport  DeveloperError from '../Core/DeveloperError.js';\nimport  Matrix4 from '../Core/Matrix4.js';\nimport  OrthographicFrustum from '../Core/OrthographicFrustum.js';\nimport  OrthographicOffCenterFrustum from '../Core/OrthographicOffCenterFrustum.js';\nimport  PerspectiveFrustum from '../Core/PerspectiveFrustum.js';\nimport  PerspectiveOffCenterFrustum from '../Core/PerspectiveOffCenterFrustum.js';\nimport  Ray from '../Core/Ray.js';\nimport  ShowGeometryInstanceAttribute from '../Core/ShowGeometryInstanceAttribute.js';\nimport  when from '../ThirdParty/when.js';\nimport  Camera from './Camera.js';\nimport  Cesium3DTileFeature from './Cesium3DTileFeature.js';\nimport  Cesium3DTilePass from './Cesium3DTilePass.js';\nimport  Cesium3DTilePassState from './Cesium3DTilePassState.js';\nimport  PickDepth from './PickDepth.js';\nimport  PrimitiveCollection from './PrimitiveCollection.js';\nimport  SceneMode from './SceneMode.js';\nimport  SceneTransforms from './SceneTransforms.js';\nimport  View from './View.js';\n\n    var offscreenDefaultWidth = 0.1;\n\n    var mostDetailedPreloadTilesetPassState = new Cesium3DTilePassState({\n        pass : Cesium3DTilePass.MOST_DETAILED_PRELOAD\n    });\n\n    var mostDetailedPickTilesetPassState = new Cesium3DTilePassState({\n        pass : Cesium3DTilePass.MOST_DETAILED_PICK\n    });\n\n    var pickTilesetPassState = new Cesium3DTilePassState({\n        pass : Cesium3DTilePass.PICK\n    });\n\n    /**\n     * @private\n     */\n    function Picking(scene) {\n        this._mostDetailedRayPicks = [];\n        this.pickRenderStateCache = {};\n        this._pickPositionCache = {};\n        this._pickPositionCacheDirty = false;\n\n        var pickOffscreenViewport = new BoundingRectangle(0, 0, 1, 1);\n        var pickOffscreenCamera = new Camera(scene);\n        pickOffscreenCamera.frustum = new OrthographicFrustum({\n            width: offscreenDefaultWidth,\n            aspectRatio: 1.0,\n            near: 0.1\n        });\n\n        this._pickOffscreenView = new View(scene, pickOffscreenCamera, pickOffscreenViewport);\n    }\n\n    Picking.prototype.update = function() {\n        this._pickPositionCacheDirty = true;\n    };\n\n    Picking.prototype.getPickDepth = function(scene, index) {\n        var pickDepths = scene.view.pickDepths;\n        var pickDepth = pickDepths[index];\n        if (!defined(pickDepth)) {\n            pickDepth = new PickDepth();\n            pickDepths[index] = pickDepth;\n        }\n        return pickDepth;\n    };\n\n    var scratchOrthoPickingFrustum = new OrthographicOffCenterFrustum();\n    var scratchOrthoOrigin = new Cartesian3();\n    var scratchOrthoDirection = new Cartesian3();\n    var scratchOrthoPixelSize = new Cartesian2();\n    var scratchOrthoPickVolumeMatrix4 = new Matrix4();\n\n    function getPickOrthographicCullingVolume(scene, drawingBufferPosition, width, height, viewport) {\n        var camera = scene.camera;\n        var frustum = camera.frustum;\n        if (defined(frustum._offCenterFrustum)) {\n            frustum = frustum._offCenterFrustum;\n        }\n\n        var x = 2.0 * (drawingBufferPosition.x - viewport.x) / viewport.width - 1.0;\n        x *= (frustum.right - frustum.left) * 0.5;\n        var y = 2.0 * (viewport.height - drawingBufferPosition.y - viewport.y) / viewport.height - 1.0;\n        y *= (frustum.top - frustum.bottom) * 0.5;\n\n        var transform = Matrix4.clone(camera.transform, scratchOrthoPickVolumeMatrix4);\n        camera._setTransform(Matrix4.IDENTITY);\n\n        var origin = Cartesian3.clone(camera.position, scratchOrthoOrigin);\n        Cartesian3.multiplyByScalar(camera.right, x, scratchOrthoDirection);\n        Cartesian3.add(scratchOrthoDirection, origin, origin);\n        Cartesian3.multiplyByScalar(camera.up, y, scratchOrthoDirection);\n        Cartesian3.add(scratchOrthoDirection, origin, origin);\n\n        camera._setTransform(transform);\n\n        if (scene.mode === SceneMode.SCENE2D) {\n            Cartesian3.fromElements(origin.z, origin.x, origin.y, origin);\n        }\n\n        var pixelSize = frustum.getPixelDimensions(viewport.width, viewport.height, 1.0, 1.0, scratchOrthoPixelSize);\n\n        var ortho = scratchOrthoPickingFrustum;\n        ortho.right = pixelSize.x * 0.5;\n        ortho.left = -ortho.right;\n        ortho.top = pixelSize.y * 0.5;\n        ortho.bottom = -ortho.top;\n        ortho.near = frustum.near;\n        ortho.far = frustum.far;\n\n        return ortho.computeCullingVolume(origin, camera.directionWC, camera.upWC);\n    }\n\n    var scratchPerspPickingFrustum = new PerspectiveOffCenterFrustum();\n    var scratchPerspPixelSize = new Cartesian2();\n\n    function getPickPerspectiveCullingVolume(scene, drawingBufferPosition, width, height, viewport) {\n        var camera = scene.camera;\n        var frustum = camera.frustum;\n        var near = frustum.near;\n\n        var tanPhi = Math.tan(frustum.fovy * 0.5);\n        var tanTheta = frustum.aspectRatio * tanPhi;\n\n        var x = 2.0 * (drawingBufferPosition.x - viewport.x) / viewport.width - 1.0;\n        var y = 2.0 * (viewport.height - drawingBufferPosition.y - viewport.y) / viewport.height - 1.0;\n\n        var xDir = x * near * tanTheta;\n        var yDir = y * near * tanPhi;\n\n        var pixelSize = frustum.getPixelDimensions(viewport.width, viewport.height, 1.0, 1.0, scratchPerspPixelSize);\n        var pickWidth = pixelSize.x * width * 0.5;\n        var pickHeight = pixelSize.y * height * 0.5;\n\n        var offCenter = scratchPerspPickingFrustum;\n        offCenter.top = yDir + pickHeight;\n        offCenter.bottom = yDir - pickHeight;\n        offCenter.right = xDir + pickWidth;\n        offCenter.left = xDir - pickWidth;\n        offCenter.near = near;\n        offCenter.far = frustum.far;\n\n        return offCenter.computeCullingVolume(camera.positionWC, camera.directionWC, camera.upWC);\n    }\n\n    function getPickCullingVolume(scene, drawingBufferPosition, width, height, viewport) {\n        var frustum = scene.camera.frustum;\n        if (frustum instanceof OrthographicFrustum || frustum instanceof OrthographicOffCenterFrustum) {\n            return getPickOrthographicCullingVolume(scene, drawingBufferPosition, width, height, viewport);\n        }\n\n        return getPickPerspectiveCullingVolume(scene, drawingBufferPosition, width, height, viewport);\n    }\n\n    // pick rectangle width and height, assumed odd\n    var scratchRectangleWidth = 3.0;\n    var scratchRectangleHeight = 3.0;\n    var scratchRectangle = new BoundingRectangle(0.0, 0.0, scratchRectangleWidth, scratchRectangleHeight);\n    var scratchPosition = new Cartesian2();\n    var scratchColorZero = new Color(0.0, 0.0, 0.0, 0.0);\n\n    Picking.prototype.pick = function(scene, windowPosition, width, height) {\n        \n\n        scratchRectangleWidth = defaultValue(width, 3.0);\n        scratchRectangleHeight = defaultValue(height, scratchRectangleWidth);\n\n        var context = scene.context;\n        var us = context.uniformState;\n        var frameState = scene.frameState;\n\n        var view = scene.defaultView;\n        scene.view = view;\n\n        var viewport = view.viewport;\n        viewport.x = 0;\n        viewport.y = 0;\n        viewport.width = context.drawingBufferWidth;\n        viewport.height = context.drawingBufferHeight;\n\n        var passState = view.passState;\n        passState.viewport = BoundingRectangle.clone(viewport, passState.viewport);\n\n        var drawingBufferPosition = SceneTransforms.transformWindowToDrawingBuffer(scene, windowPosition, scratchPosition);\n\n        scene.jobScheduler.disableThisFrame();\n\n        scene.updateFrameState();\n        frameState.cullingVolume = getPickCullingVolume(scene, drawingBufferPosition, scratchRectangleWidth, scratchRectangleHeight, viewport);\n        frameState.invertClassification = false;\n        frameState.passes.pick = true;\n        frameState.tilesetPassState = pickTilesetPassState;\n\n        us.update(frameState);\n\n        scene.updateEnvironment();\n\n        scratchRectangle.x = drawingBufferPosition.x - ((scratchRectangleWidth - 1.0) * 0.5);\n        scratchRectangle.y = (scene.drawingBufferHeight - drawingBufferPosition.y) - ((scratchRectangleHeight - 1.0) * 0.5);\n        scratchRectangle.width = scratchRectangleWidth;\n        scratchRectangle.height = scratchRectangleHeight;\n        passState = view.pickFramebuffer.begin(scratchRectangle, view.viewport);\n\n        scene.updateAndExecuteCommands(passState, scratchColorZero);\n        scene.resolveFramebuffers(passState);\n\n        var object = view.pickFramebuffer.end(scratchRectangle);\n        context.endFrame();\n        return object;\n    };\n\n    function renderTranslucentDepthForPick(scene, drawingBufferPosition) {\n        // PERFORMANCE_IDEA: render translucent only and merge with the previous frame\n        var context = scene.context;\n        var frameState = scene.frameState;\n        var environmentState = scene.environmentState;\n\n        var view = scene.defaultView;\n        scene.view = view;\n\n        var viewport = view.viewport;\n        viewport.x = 0;\n        viewport.y = 0;\n        viewport.width = context.drawingBufferWidth;\n        viewport.height = context.drawingBufferHeight;\n\n        var passState = view.passState;\n        passState.viewport = BoundingRectangle.clone(viewport, passState.viewport);\n\n        scene.clearPasses(frameState.passes);\n        frameState.passes.pick = true;\n        frameState.passes.depth = true;\n        frameState.cullingVolume = getPickCullingVolume(scene, drawingBufferPosition, 1, 1, viewport);\n        frameState.tilesetPassState = pickTilesetPassState;\n\n        scene.updateEnvironment();\n        environmentState.renderTranslucentDepthForPick = true;\n        passState = view.pickDepthFramebuffer.update(context, drawingBufferPosition, viewport);\n\n        scene.updateAndExecuteCommands(passState, scratchColorZero);\n        scene.resolveFramebuffers(passState);\n\n        context.endFrame();\n    }\n\n    var scratchPerspectiveFrustum = new PerspectiveFrustum();\n    var scratchPerspectiveOffCenterFrustum = new PerspectiveOffCenterFrustum();\n    var scratchOrthographicFrustum = new OrthographicFrustum();\n    var scratchOrthographicOffCenterFrustum = new OrthographicOffCenterFrustum();\n\n    Picking.prototype.pickPositionWorldCoordinates = function(scene, windowPosition, result) {\n        if (!scene.useDepthPicking) {\n            return undefined;\n        }\n\n        \n\n        var cacheKey = windowPosition.toString();\n\n        if (this._pickPositionCacheDirty){\n            this._pickPositionCache = {};\n            this._pickPositionCacheDirty = false;\n        } else if (this._pickPositionCache.hasOwnProperty(cacheKey)){\n            return Cartesian3.clone(this._pickPositionCache[cacheKey], result);\n        }\n\n        var frameState = scene.frameState;\n        var context = scene.context;\n        var uniformState = context.uniformState;\n\n        var view = scene.defaultView;\n        scene.view = view;\n\n        var drawingBufferPosition = SceneTransforms.transformWindowToDrawingBuffer(scene, windowPosition, scratchPosition);\n        if (scene.pickTranslucentDepth) {\n            renderTranslucentDepthForPick(scene, drawingBufferPosition);\n        } else {\n            scene.updateFrameState();\n            uniformState.update(frameState);\n            scene.updateEnvironment();\n        }\n        drawingBufferPosition.y = scene.drawingBufferHeight - drawingBufferPosition.y;\n\n        var camera = scene.camera;\n\n        // Create a working frustum from the original camera frustum.\n        var frustum;\n        if (defined(camera.frustum.fov)) {\n            frustum = camera.frustum.clone(scratchPerspectiveFrustum);\n        } else if (defined(camera.frustum.infiniteProjectionMatrix)){\n            frustum = camera.frustum.clone(scratchPerspectiveOffCenterFrustum);\n        } else if (defined(camera.frustum.width)) {\n            frustum = camera.frustum.clone(scratchOrthographicFrustum);\n        } else {\n            frustum = camera.frustum.clone(scratchOrthographicOffCenterFrustum);\n        }\n\n        var frustumCommandsList = view.frustumCommandsList;\n        var numFrustums = frustumCommandsList.length;\n        for (var i = 0; i < numFrustums; ++i) {\n            var pickDepth = this.getPickDepth(scene, i);\n            var depth = pickDepth.getDepth(context, drawingBufferPosition.x, drawingBufferPosition.y);\n            if (depth > 0.0 && depth < 1.0) {\n                var renderedFrustum = frustumCommandsList[i];\n                var height2D;\n                if (scene.mode === SceneMode.SCENE2D) {\n                    height2D = camera.position.z;\n                    camera.position.z = height2D - renderedFrustum.near + 1.0;\n                    frustum.far = Math.max(1.0, renderedFrustum.far - renderedFrustum.near);\n                    frustum.near = 1.0;\n                    uniformState.update(frameState);\n                    uniformState.updateFrustum(frustum);\n                } else {\n                    frustum.near = renderedFrustum.near * (i !== 0 ? scene.opaqueFrustumNearOffset : 1.0);\n                    frustum.far = renderedFrustum.far;\n                    uniformState.updateFrustum(frustum);\n                }\n\n                result = SceneTransforms.drawingBufferToWgs84Coordinates(scene, drawingBufferPosition, depth, result);\n\n                if (scene.mode === SceneMode.SCENE2D) {\n                    camera.position.z = height2D;\n                    uniformState.update(frameState);\n                }\n\n                this._pickPositionCache[cacheKey] = Cartesian3.clone(result);\n                return result;\n            }\n        }\n\n        this._pickPositionCache[cacheKey] = undefined;\n        return undefined;\n    };\n\n    var scratchPickPositionCartographic = new Cartographic();\n\n    Picking.prototype.pickPosition = function(scene, windowPosition, result) {\n        result = this.pickPositionWorldCoordinates(scene, windowPosition, result);\n        if (defined(result) && scene.mode !== SceneMode.SCENE3D) {\n            Cartesian3.fromElements(result.y, result.z, result.x, result);\n\n            var projection = scene.mapProjection;\n            var ellipsoid = projection.ellipsoid;\n\n            var cart = projection.unproject(result, scratchPickPositionCartographic);\n            ellipsoid.cartographicToCartesian(cart, result);\n        }\n\n        return result;\n    };\n\n    function drillPick(limit, pickCallback) {\n        // PERFORMANCE_IDEA: This function calls each primitive's update for each pass. Instead\n        // we could update the primitive once, and then just execute their commands for each pass,\n        // and cull commands for picked primitives.  e.g., base on the command's owner.\n        var i;\n        var attributes;\n        var result = [];\n        var pickedPrimitives = [];\n        var pickedAttributes = [];\n        var pickedFeatures = [];\n        if (!defined(limit)) {\n            limit = Number.MAX_VALUE;\n        }\n\n        var pickedResult = pickCallback();\n        while (defined(pickedResult)) {\n            var object = pickedResult.object;\n            var position = pickedResult.position;\n            var exclude = pickedResult.exclude;\n\n            if (defined(position) && !defined(object)) {\n                result.push(pickedResult);\n                break;\n            }\n\n            if (!defined(object) || !defined(object.primitive)) {\n                break;\n            }\n\n            if (!exclude) {\n                result.push(pickedResult);\n                if (0 >= --limit) {\n                    break;\n                }\n            }\n\n            var primitive = object.primitive;\n            var hasShowAttribute = false;\n\n            // If the picked object has a show attribute, use it.\n            if (typeof primitive.getGeometryInstanceAttributes === 'function') {\n                if (defined(object.id)) {\n                    attributes = primitive.getGeometryInstanceAttributes(object.id);\n                    if (defined(attributes) && defined(attributes.show)) {\n                        hasShowAttribute = true;\n                        attributes.show = ShowGeometryInstanceAttribute.toValue(false, attributes.show);\n                        pickedAttributes.push(attributes);\n                    }\n                }\n            }\n\n            if (object instanceof Cesium3DTileFeature) {\n                hasShowAttribute = true;\n                object.show = false;\n                pickedFeatures.push(object);\n            }\n\n            // Otherwise, hide the entire primitive\n            if (!hasShowAttribute) {\n                primitive.show = false;\n                pickedPrimitives.push(primitive);\n            }\n\n            pickedResult = pickCallback();\n        }\n\n        // Unhide everything we hid while drill picking\n        for (i = 0; i < pickedPrimitives.length; ++i) {\n            pickedPrimitives[i].show = true;\n        }\n\n        for (i = 0; i < pickedAttributes.length; ++i) {\n            attributes = pickedAttributes[i];\n            attributes.show = ShowGeometryInstanceAttribute.toValue(true, attributes.show);\n        }\n\n        for (i = 0; i < pickedFeatures.length; ++i) {\n            pickedFeatures[i].show = true;\n        }\n\n        return result;\n    }\n\n    Picking.prototype.drillPick = function(scene, windowPosition, limit, width, height) {\n        var that = this;\n        var pickCallback = function() {\n            var object = that.pick(scene, windowPosition, width, height);\n            if (defined(object)) {\n                return {\n                    object : object,\n                    position : undefined,\n                    exclude : false\n                };\n            }\n        };\n        var objects = drillPick(limit, pickCallback);\n        return objects.map(function(element) {\n            return element.object;\n        });\n    };\n\n    var scratchRight = new Cartesian3();\n    var scratchUp = new Cartesian3();\n\n    function MostDetailedRayPick(ray, width, tilesets) {\n        this.ray = ray;\n        this.width = width;\n        this.tilesets = tilesets;\n        this.ready = false;\n        this.deferred = when.defer();\n        this.promise = this.deferred.promise;\n    }\n\n    function updateOffscreenCameraFromRay(picking, ray, width, camera) {\n        var direction = ray.direction;\n        var orthogonalAxis = Cartesian3.mostOrthogonalAxis(direction, scratchRight);\n        var right = Cartesian3.cross(direction, orthogonalAxis, scratchRight);\n        var up = Cartesian3.cross(direction, right, scratchUp);\n\n        camera.position = ray.origin;\n        camera.direction = direction;\n        camera.up = up;\n        camera.right = right;\n\n        camera.frustum.width = defaultValue(width, offscreenDefaultWidth);\n        return camera.frustum.computeCullingVolume(camera.positionWC, camera.directionWC, camera.upWC);\n    }\n\n    function updateMostDetailedRayPick(picking, scene, rayPick) {\n        var frameState = scene.frameState;\n\n        var ray = rayPick.ray;\n        var width = rayPick.width;\n        var tilesets = rayPick.tilesets;\n\n        var camera = picking._pickOffscreenView.camera;\n        var cullingVolume = updateOffscreenCameraFromRay(picking, ray, width, camera);\n\n        var tilesetPassState = mostDetailedPreloadTilesetPassState;\n        tilesetPassState.camera = camera;\n        tilesetPassState.cullingVolume = cullingVolume;\n\n        var ready = true;\n        var tilesetsLength = tilesets.length;\n        for (var i = 0; i < tilesetsLength; ++i) {\n            var tileset = tilesets[i];\n            if (tileset.show && scene.primitives.contains(tileset)) {\n                // Only update tilesets that are still contained in the scene's primitive collection and are still visible\n                // Update tilesets continually until all tilesets are ready. This way tiles are never removed from the cache.\n                tileset.updateForPass(frameState, tilesetPassState);\n                ready = (ready && tilesetPassState.ready);\n            }\n        }\n\n        if (ready) {\n            rayPick.deferred.resolve();\n        }\n\n        return ready;\n    }\n\n    Picking.prototype.updateMostDetailedRayPicks = function(scene) {\n        // Modifies array during iteration\n        var rayPicks = this._mostDetailedRayPicks;\n        for (var i = 0; i < rayPicks.length; ++i) {\n            if (updateMostDetailedRayPick(this, scene, rayPicks[i])) {\n                rayPicks.splice(i--, 1);\n            }\n        }\n    };\n\n    function getTilesets(primitives, objectsToExclude, tilesets) {\n        var length = primitives.length;\n        for (var i = 0; i < length; ++i) {\n            var primitive = primitives.get(i);\n            if (primitive.show) {\n                if (defined(primitive.isCesium3DTileset)) {\n                    if (!defined(objectsToExclude) || objectsToExclude.indexOf(primitive) === -1) {\n                        tilesets.push(primitive);\n                    }\n                } else if (primitive instanceof PrimitiveCollection) {\n                    getTilesets(primitive, objectsToExclude, tilesets);\n                }\n            }\n        }\n    }\n\n    function launchMostDetailedRayPick(picking, scene, ray, objectsToExclude, width, callback) {\n        var tilesets = [];\n        getTilesets(scene.primitives, objectsToExclude, tilesets);\n        if (tilesets.length === 0) {\n            return when.resolve(callback());\n        }\n\n        var rayPick = new MostDetailedRayPick(ray, width, tilesets);\n        picking._mostDetailedRayPicks.push(rayPick);\n        return rayPick.promise.then(function() {\n            return callback();\n        });\n    }\n\n    function isExcluded(object, objectsToExclude) {\n        if (!defined(object) || !defined(objectsToExclude) || objectsToExclude.length === 0) {\n            return false;\n        }\n        return (objectsToExclude.indexOf(object) > -1) ||\n               (objectsToExclude.indexOf(object.primitive) > -1) ||\n               (objectsToExclude.indexOf(object.id) > -1);\n    }\n\n    function getRayIntersection(picking, scene, ray, objectsToExclude, width, requirePosition, mostDetailed) {\n        var context = scene.context;\n        var uniformState = context.uniformState;\n        var frameState = scene.frameState;\n\n        var view = picking._pickOffscreenView;\n        scene.view = view;\n\n        updateOffscreenCameraFromRay(picking, ray, width, view.camera);\n\n        scratchRectangle = BoundingRectangle.clone(view.viewport, scratchRectangle);\n\n        var passState = view.pickFramebuffer.begin(scratchRectangle, view.viewport);\n\n        scene.jobScheduler.disableThisFrame();\n\n        scene.updateFrameState();\n        frameState.invertClassification = false;\n        frameState.passes.pick = true;\n        frameState.passes.offscreen = true;\n\n        if (mostDetailed) {\n            frameState.tilesetPassState = mostDetailedPickTilesetPassState;\n        } else {\n            frameState.tilesetPassState = pickTilesetPassState;\n        }\n\n        uniformState.update(frameState);\n\n        scene.updateEnvironment();\n        scene.updateAndExecuteCommands(passState, scratchColorZero);\n        scene.resolveFramebuffers(passState);\n\n        var position;\n        var object = view.pickFramebuffer.end(context);\n\n        if (scene.context.depthTexture) {\n            var numFrustums = view.frustumCommandsList.length;\n            for (var i = 0; i < numFrustums; ++i) {\n                var pickDepth = picking.getPickDepth(scene, i);\n                var depth = pickDepth.getDepth(context, 0, 0);\n                if (depth > 0.0 && depth < 1.0) {\n                    var renderedFrustum = view.frustumCommandsList[i];\n                    var near = renderedFrustum.near * (i !== 0 ? scene.opaqueFrustumNearOffset : 1.0);\n                    var far = renderedFrustum.far;\n                    var distance = near + depth * (far - near);\n                    position = Ray.getPoint(ray, distance);\n                    break;\n                }\n            }\n        }\n\n        scene.view = scene.defaultView;\n        context.endFrame();\n\n        if (defined(object) || defined(position)) {\n            return {\n                object : object,\n                position : position,\n                exclude : (!defined(position) && requirePosition) || isExcluded(object, objectsToExclude)\n            };\n        }\n    }\n\n    function getRayIntersections(picking, scene, ray, limit, objectsToExclude, width, requirePosition, mostDetailed) {\n        var pickCallback = function() {\n            return getRayIntersection(picking, scene, ray, objectsToExclude, width, requirePosition, mostDetailed);\n        };\n        return drillPick(limit, pickCallback);\n    }\n\n    function pickFromRay(picking, scene, ray, objectsToExclude, width, requirePosition, mostDetailed) {\n        var results = getRayIntersections(picking, scene, ray, 1, objectsToExclude, width, requirePosition, mostDetailed);\n        if (results.length > 0) {\n            return results[0];\n        }\n    }\n\n    function drillPickFromRay(picking, scene, ray, limit, objectsToExclude, width, requirePosition, mostDetailed) {\n        return getRayIntersections(picking, scene, ray, limit, objectsToExclude, width, requirePosition, mostDetailed);\n    }\n\n    function deferPromiseUntilPostRender(scene, promise) {\n        // Resolve promise after scene's postRender in case entities are created when the promise resolves.\n        // Entities can't be created between viewer._onTick and viewer._postRender.\n        var deferred = when.defer();\n        promise.then(function(result) {\n            var removeCallback = scene.postRender.addEventListener(function() {\n                deferred.resolve(result);\n                removeCallback();\n            });\n            scene.requestRender();\n        }).otherwise(function(error) {\n            deferred.reject(error);\n        });\n        return deferred.promise;\n    }\n\n    Picking.prototype.pickFromRay = function(scene, ray, objectsToExclude, width) {\n        \n\n        return pickFromRay(this, scene, ray, objectsToExclude, width, false, false);\n    };\n\n    Picking.prototype.drillPickFromRay = function(scene, ray, limit, objectsToExclude, width) {\n        \n\n        return drillPickFromRay(this, scene, ray, limit, objectsToExclude, width,false, false);\n    };\n\n    Picking.prototype.pickFromRayMostDetailed = function(scene, ray, objectsToExclude, width) {\n        \n\n        var that = this;\n        ray = Ray.clone(ray);\n        objectsToExclude = defined(objectsToExclude) ? objectsToExclude.slice() : objectsToExclude;\n        return deferPromiseUntilPostRender(scene, launchMostDetailedRayPick(that, scene, ray, objectsToExclude, width, function() {\n            return pickFromRay(that, scene, ray, objectsToExclude, width, false, true);\n        }));\n    };\n\n    Picking.prototype.drillPickFromRayMostDetailed = function(scene, ray, limit, objectsToExclude, width) {\n        \n\n        var that = this;\n        ray = Ray.clone(ray);\n        objectsToExclude = defined(objectsToExclude) ? objectsToExclude.slice() : objectsToExclude;\n        return deferPromiseUntilPostRender(scene, launchMostDetailedRayPick(that, scene, ray, objectsToExclude, width, function() {\n            return drillPickFromRay(that, scene, ray, limit, objectsToExclude, width, false, true);\n        }));\n    };\n\n    var scratchSurfacePosition = new Cartesian3();\n    var scratchSurfaceNormal = new Cartesian3();\n    var scratchSurfaceRay = new Ray();\n    var scratchCartographic = new Cartographic();\n\n    function getRayForSampleHeight(scene, cartographic) {\n        var globe = scene.globe;\n        var ellipsoid = defined(globe) ? globe.ellipsoid : scene.mapProjection.ellipsoid;\n        var height = ApproximateTerrainHeights._defaultMaxTerrainHeight;\n        var surfaceNormal = ellipsoid.geodeticSurfaceNormalCartographic(cartographic, scratchSurfaceNormal);\n        var surfacePosition = Cartographic.toCartesian(cartographic, ellipsoid, scratchSurfacePosition);\n        var surfaceRay = scratchSurfaceRay;\n        surfaceRay.origin = surfacePosition;\n        surfaceRay.direction =  surfaceNormal;\n        var ray = new Ray();\n        Ray.getPoint(surfaceRay, height, ray.origin);\n        Cartesian3.negate(surfaceNormal, ray.direction);\n        return ray;\n    }\n\n    function getRayForClampToHeight(scene, cartesian) {\n        var globe = scene.globe;\n        var ellipsoid = defined(globe) ? globe.ellipsoid : scene.mapProjection.ellipsoid;\n        var cartographic = Cartographic.fromCartesian(cartesian, ellipsoid, scratchCartographic);\n        return getRayForSampleHeight(scene, cartographic);\n    }\n\n    function getHeightFromCartesian(scene, cartesian) {\n        var globe = scene.globe;\n        var ellipsoid = defined(globe) ? globe.ellipsoid : scene.mapProjection.ellipsoid;\n        var cartographic = Cartographic.fromCartesian(cartesian, ellipsoid, scratchCartographic);\n        return cartographic.height;\n    }\n\n    function sampleHeightMostDetailed(picking, scene, cartographic, objectsToExclude, width) {\n        var ray = getRayForSampleHeight(scene, cartographic);\n        return launchMostDetailedRayPick(picking, scene, ray, objectsToExclude, width, function() {\n            var pickResult = pickFromRay(picking, scene, ray, objectsToExclude, width, true, true);\n            if (defined(pickResult)) {\n                return getHeightFromCartesian(scene, pickResult.position);\n            }\n        });\n    }\n\n    function clampToHeightMostDetailed(picking, scene, cartesian, objectsToExclude, width, result) {\n        var ray = getRayForClampToHeight(scene, cartesian);\n        return launchMostDetailedRayPick(picking, scene, ray, objectsToExclude, width, function() {\n            var pickResult = pickFromRay(picking, scene, ray, objectsToExclude, width, true, true);\n            if (defined(pickResult)) {\n                return Cartesian3.clone(pickResult.position, result);\n            }\n        });\n    }\n\n    Picking.prototype.sampleHeight = function(scene, position, objectsToExclude, width) {\n        \n\n        var ray = getRayForSampleHeight(scene, position);\n        var pickResult = pickFromRay(this, scene, ray, objectsToExclude, width, true, false);\n        if (defined(pickResult)) {\n            return getHeightFromCartesian(scene, pickResult.position);\n        }\n    };\n\n    Picking.prototype.clampToHeight = function(scene, cartesian, objectsToExclude, width, result) {\n        \n\n        var ray = getRayForClampToHeight(scene, cartesian);\n        var pickResult = pickFromRay(this, scene, ray, objectsToExclude, width, true, false);\n        if (defined(pickResult)) {\n            return Cartesian3.clone(pickResult.position, result);\n        }\n    };\n\n    Picking.prototype.sampleHeightMostDetailed = function(scene, positions, objectsToExclude, width) {\n        \n\n        objectsToExclude = defined(objectsToExclude) ? objectsToExclude.slice() : objectsToExclude;\n        var length = positions.length;\n        var promises = new Array(length);\n        for (var i = 0; i < length; ++i) {\n            promises[i] = sampleHeightMostDetailed(this, scene, positions[i], objectsToExclude, width);\n        }\n        return deferPromiseUntilPostRender(scene, when.all(promises).then(function(heights) {\n            var length = heights.length;\n            for (var i = 0; i < length; ++i) {\n                positions[i].height = heights[i];\n            }\n            return positions;\n        }));\n    };\n\n    Picking.prototype.clampToHeightMostDetailed = function(scene, cartesians, objectsToExclude, width) {\n        \n\n        objectsToExclude = defined(objectsToExclude) ? objectsToExclude.slice() : objectsToExclude;\n        var length = cartesians.length;\n        var promises = new Array(length);\n        for (var i = 0; i < length; ++i) {\n            promises[i] = clampToHeightMostDetailed(this, scene, cartesians[i], objectsToExclude, width, cartesians[i]);\n        }\n        return deferPromiseUntilPostRender(scene, when.all(promises).then(function(clampedCartesians) {\n            var length = clampedCartesians.length;\n            for (var i = 0; i < length; ++i) {\n                cartesians[i] = clampedCartesians[i];\n            }\n            return cartesians;\n        }));\n    };\n\n    Picking.prototype.destroy = function() {\n        this._pickOffscreenView = this._pickOffscreenView && this._pickOffscreenView.destroy();\n    };\nexport default Picking;\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"#define SAMPLES 8\\n\\\n\\n\\\nuniform float delta;\\n\\\nuniform float sigma;\\n\\\nuniform float direction; // 0.0 for x direction, 1.0 for y direction\\n\\\n\\n\\\nuniform sampler2D colorTexture;\\n\\\n\\n\\\n#ifdef USE_STEP_SIZE\\n\\\nuniform float stepSize;\\n\\\n#else\\n\\\nuniform vec2 step;\\n\\\n#endif\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\n//  Incremental Computation of the Gaussian:\\n\\\n//  https://developer.nvidia.com/gpugems/GPUGems3/gpugems3_ch40.html\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    vec2 st = v_textureCoordinates;\\n\\\n    vec2 dir = vec2(1.0 - direction, direction);\\n\\\n\\n\\\n#ifdef USE_STEP_SIZE\\n\\\n    vec2 step = vec2(stepSize * (czm_pixelRatio / czm_viewport.zw));\\n\\\n#else\\n\\\n    vec2 step = step;\\n\\\n#endif\\n\\\n\\n\\\n    vec3 g;\\n\\\n    g.x = 1.0 / (sqrt(czm_twoPi) * sigma);\\n\\\n    g.y = exp((-0.5 * delta * delta) / (sigma * sigma));\\n\\\n    g.z = g.y * g.y;\\n\\\n\\n\\\n    vec4 result = texture2D(colorTexture, st) * g.x;\\n\\\n    for (int i = 1; i < SAMPLES; ++i)\\n\\\n    {\\n\\\n        g.xy *= g.yz;\\n\\\n\\n\\\n        vec2 offset = float(i) * dir * step;\\n\\\n        result += texture2D(colorTexture, st - offset) * g.x;\\n\\\n        result += texture2D(colorTexture, st + offset) * g.x;\\n\\\n    }\\n\\\n\\n\\\n    gl_FragColor = result;\\n\\\n}\\n\\\n\";\n","import Cartesian2 from '../Core/Cartesian2.js';\nimport Color from '../Core/Color.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport PixelFormat from '../Core/PixelFormat.js';\nimport ClearCommand from '../Renderer/ClearCommand.js';\nimport Framebuffer from '../Renderer/Framebuffer.js';\nimport PixelDatatype from '../Renderer/PixelDatatype.js';\nimport Sampler from '../Renderer/Sampler.js';\nimport Texture from '../Renderer/Texture.js';\n\n    /**\n     * A post process stage that will get the luminance value at each pixel and\n     * uses parallel reduction to compute the average luminance in a 1x1 texture.\n     * This texture can be used as input for tone mapping.\n     *\n     * @constructor\n     * @private\n     */\n    function AutoExposure() {\n        this._uniformMap = undefined;\n        this._command = undefined;\n\n        this._colorTexture = undefined;\n        this._depthTexture = undefined;\n\n        this._ready = false;\n\n        this._name = 'czm_autoexposure';\n\n        this._logDepthChanged = undefined;\n        this._useLogDepth = undefined;\n\n        this._framebuffers = undefined;\n        this._previousLuminance = undefined;\n\n        this._commands = undefined;\n        this._clearCommand = undefined;\n\n        this._minMaxLuminance = new Cartesian2();\n\n        /**\n         * Whether or not to execute this post-process stage when ready.\n         *\n         * @type {Boolean}\n         */\n        this.enabled = true;\n        this._enabled = true;\n\n        /**\n         * The minimum value used to clamp the luminance.\n         *\n         * @type {Number}\n         * @default 0.1\n         */\n        this.minimumLuminance = 0.1;\n\n        /**\n         * The maximum value used to clamp the luminance.\n         *\n         * @type {Number}\n         * @default 10.0\n         */\n        this.maximumLuminance = 10.0;\n    }\n\n    Object.defineProperties(AutoExposure.prototype, {\n        /**\n         * Determines if this post-process stage is ready to be executed. A stage is only executed when both <code>ready</code>\n         * and {@link AutoExposure#enabled} are <code>true</code>. A stage will not be ready while it is waiting on textures\n         * to load.\n         *\n         * @memberof AutoExposure.prototype\n         * @type {Boolean}\n         * @readonly\n         */\n        ready : {\n            get : function() {\n                return this._ready;\n            }\n        },\n        /**\n         * The unique name of this post-process stage for reference by other stages.\n         *\n         * @memberof AutoExposure.prototype\n         * @type {String}\n         * @readonly\n         */\n        name : {\n            get : function() {\n                return this._name;\n            }\n        },\n\n        /**\n         * A reference to the texture written to when executing this post process stage.\n         *\n         * @memberof AutoExposure.prototype\n         * @type {Texture}\n         * @readonly\n         * @private\n         */\n        outputTexture : {\n            get : function() {\n                var framebuffers = this._framebuffers;\n                if (!defined(framebuffers)) {\n                    return undefined;\n                }\n                return framebuffers[framebuffers.length - 1].getColorTexture(0);\n            }\n        }\n    });\n\n    function destroyFramebuffers(autoexposure) {\n        var framebuffers = autoexposure._framebuffers;\n        if (!defined(framebuffers)) {\n            return;\n        }\n\n        var length = framebuffers.length;\n        for (var i = 0; i < length; ++i) {\n            framebuffers[i].destroy();\n        }\n        autoexposure._framebuffers = undefined;\n\n        autoexposure._previousLuminance.destroy();\n        autoexposure._previousLuminance = undefined;\n    }\n\n    function createFramebuffers(autoexposure, context) {\n        destroyFramebuffers(autoexposure);\n\n        var width = autoexposure._width;\n        var height = autoexposure._height;\n\n        var pixelFormat = PixelFormat.RGBA;\n        var pixelDatatype = context.halfFloatingPointTexture ? PixelDatatype.HALF_FLOAT : PixelDatatype.FLOAT;\n\n        var length = Math.ceil(Math.log(Math.max(width, height)) / Math.log(3.0));\n        var framebuffers = new Array(length);\n        for (var i = 0; i < length; ++i) {\n            width = Math.max(Math.ceil(width / 3.0), 1.0);\n            height = Math.max(Math.ceil(height / 3.0), 1.0);\n            framebuffers[i] = new Framebuffer({\n                context : context,\n                colorTextures : [new Texture({\n                    context : context,\n                    width : width,\n                    height : height,\n                    pixelFormat : pixelFormat,\n                    pixelDatatype : pixelDatatype,\n                    sampler : Sampler.NEAREST\n                })]\n            });\n        }\n\n        var lastTexture = framebuffers[length - 1].getColorTexture(0);\n        autoexposure._previousLuminance = new Framebuffer({\n            context : context,\n            colorTextures : [new Texture({\n                context : context,\n                width : lastTexture.width,\n                height : lastTexture.height,\n                pixelFormat : pixelFormat,\n                pixelDatatype : pixelDatatype,\n                sampler : Sampler.NEAREST\n            })]\n        });\n\n        autoexposure._framebuffers = framebuffers;\n    }\n\n    function destroyCommands(autoexposure) {\n        var commands = autoexposure._commands;\n        if (!defined(commands)) {\n            return;\n        }\n\n        var length = commands.length;\n        for (var i = 0; i < length; ++i) {\n            commands[i].shaderProgram.destroy();\n        }\n        autoexposure._commands = undefined;\n    }\n\n    function createUniformMap(autoexposure, index) {\n        var uniforms;\n        if (index === 0) {\n            uniforms = {\n                colorTexture : function() {\n                    return autoexposure._colorTexture;\n                },\n                colorTextureDimensions : function() {\n                    return autoexposure._colorTexture.dimensions;\n                }\n            };\n        } else {\n            var texture = autoexposure._framebuffers[index - 1].getColorTexture(0);\n            uniforms = {\n                colorTexture : function() {\n                    return texture;\n                },\n                colorTextureDimensions : function() {\n                    return texture.dimensions;\n                }\n            };\n        }\n\n        uniforms.minMaxLuminance = function() {\n            return autoexposure._minMaxLuminance;\n        };\n        uniforms.previousLuminance = function() {\n            return autoexposure._previousLuminance.getColorTexture(0);\n        };\n\n        return uniforms;\n    }\n\n    function getShaderSource(index, length) {\n        var source =\n            'uniform sampler2D colorTexture; \\n' +\n            'varying vec2 v_textureCoordinates; \\n' +\n            'float sampleTexture(vec2 offset) { \\n';\n\n        if (index === 0) {\n            source +=\n                '    vec4 color = texture2D(colorTexture, v_textureCoordinates + offset); \\n' +\n                '    return czm_luminance(color.rgb); \\n';\n        } else {\n            source +=\n                '    return texture2D(colorTexture, v_textureCoordinates + offset).r; \\n';\n        }\n\n        source += '}\\n\\n';\n\n        source +=\n            'uniform vec2 colorTextureDimensions; \\n' +\n            'uniform vec2 minMaxLuminance; \\n' +\n            'uniform sampler2D previousLuminance; \\n' +\n            'void main() { \\n' +\n            '    float color = 0.0; \\n' +\n            '    float xStep = 1.0 / colorTextureDimensions.x; \\n' +\n            '    float yStep = 1.0 / colorTextureDimensions.y; \\n' +\n            '    int count = 0; \\n' +\n            '    for (int i = 0; i < 3; ++i) { \\n' +\n            '        for (int j = 0; j < 3; ++j) { \\n' +\n            '            vec2 offset; \\n' +\n            '            offset.x = -xStep + float(i) * xStep; \\n' +\n            '            offset.y = -yStep + float(j) * yStep; \\n' +\n            '            if (offset.x < 0.0 || offset.x > 1.0 || offset.y < 0.0 || offset.y > 1.0) { \\n' +\n            '                continue; \\n' +\n            '            } \\n' +\n            '            color += sampleTexture(offset); \\n' +\n            '            ++count; \\n' +\n            '        } \\n' +\n            '    } \\n' +\n            '    if (count > 0) { \\n' +\n            '        color /= float(count); \\n' +\n            '    } \\n';\n\n        if (index === length - 1) {\n            source +=\n                '    float previous = texture2D(previousLuminance, vec2(0.5)).r; \\n' +\n                '    color = clamp(color, minMaxLuminance.x, minMaxLuminance.y); \\n' +\n                '    color = previous + (color - previous) / (60.0 * 1.5); \\n' +\n                '    color = clamp(color, minMaxLuminance.x, minMaxLuminance.y); \\n';\n        }\n\n        source +=\n            '    gl_FragColor = vec4(color); \\n' +\n            '} \\n';\n        return source;\n    }\n\n    function createCommands(autoexposure, context) {\n        destroyCommands(autoexposure);\n        var framebuffers = autoexposure._framebuffers;\n        var length = framebuffers.length;\n\n        var commands = new Array(length);\n\n        for (var i = 0; i < length; ++i) {\n            commands[i] = context.createViewportQuadCommand(getShaderSource(i, length), {\n                framebuffer : framebuffers[i],\n                uniformMap : createUniformMap(autoexposure, i)\n            });\n        }\n        autoexposure._commands = commands;\n    }\n\n    /**\n     * A function that will be called before execute. Used to clear any textures attached to framebuffers.\n     * @param {Context} context The context.\n     * @private\n     */\n    AutoExposure.prototype.clear = function(context) {\n        var framebuffers = this._framebuffers;\n        if (!defined(framebuffers)) {\n            return;\n        }\n\n        var clearCommand = this._clearCommand;\n        if (!defined(clearCommand)) {\n            clearCommand = this._clearCommand = new ClearCommand({\n                color : new Color(0.0, 0.0, 0.0, 0.0),\n                framebuffer : undefined\n            });\n        }\n\n        var length = framebuffers.length;\n        for (var i = 0; i < length; ++i) {\n            clearCommand.framebuffer = framebuffers[i];\n            clearCommand.execute(context);\n        }\n    };\n\n    /**\n     * A function that will be called before execute. Used to create WebGL resources and load any textures.\n     * @param {Context} context The context.\n     * @private\n     */\n    AutoExposure.prototype.update = function(context) {\n        var width = context.drawingBufferWidth;\n        var height = context.drawingBufferHeight;\n\n        if (width !== this._width || height !== this._height) {\n            this._width = width;\n            this._height = height;\n\n            createFramebuffers(this, context);\n            createCommands(this, context);\n\n            if (!this._ready) {\n                this._ready = true;\n            }\n        }\n\n        this._minMaxLuminance.x = this.minimumLuminance;\n        this._minMaxLuminance.y = this.maximumLuminance;\n\n        var framebuffers = this._framebuffers;\n        var temp = framebuffers[framebuffers.length - 1];\n        framebuffers[framebuffers.length - 1] = this._previousLuminance;\n        this._commands[this._commands.length - 1].framebuffer = this._previousLuminance;\n        this._previousLuminance = temp;\n    };\n\n    /**\n     * Executes the post-process stage. The color texture is the texture rendered to by the scene or from the previous stage.\n     * @param {Context} context The context.\n     * @param {Texture} colorTexture The input color texture.\n     * @private\n     */\n    AutoExposure.prototype.execute = function(context, colorTexture) {\n        this._colorTexture = colorTexture;\n\n        var commands = this._commands;\n        if (!defined(commands)) {\n            return;\n        }\n\n        var length = commands.length;\n        for (var i = 0; i < length; ++i) {\n            commands[i].execute(context);\n        }\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <p>\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     * </p>\n     *\n     * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n     *\n     * @see AutoExposure#destroy\n     */\n    AutoExposure.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n     * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n     * <p>\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     * </p>\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     * @see AutoExposure#isDestroyed\n     */\n    AutoExposure.prototype.destroy = function() {\n        destroyFramebuffers(this);\n        destroyCommands(this);\n        return destroyObject(this);\n    };\nexport default AutoExposure;\n","\n    /**\n     * Determines how input texture to a {@link PostProcessStage} is sampled.\n     *\n     * @exports PostProcessStageSampleMode\n     */\n    var PostProcessStageSampleMode = {\n        /**\n         * Samples the texture by returning the closest texel.\n         *\n         * @type {Number}\n         * @constant\n         */\n        NEAREST : 0,\n        /**\n         * Samples the texture through bi-linear interpolation of the four nearest texels.\n         *\n         * @type {Number}\n         * @constant\n         */\n        LINEAR : 1\n    };\nexport default PostProcessStageSampleMode;\n","import BoundingRectangle from '../Core/BoundingRectangle.js';\nimport Check from '../Core/Check.js';\nimport Color from '../Core/Color.js';\nimport combine from '../Core/combine.js';\nimport createGuid from '../Core/createGuid.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport PixelFormat from '../Core/PixelFormat.js';\nimport Resource from '../Core/Resource.js';\nimport PassState from '../Renderer/PassState.js';\nimport PixelDatatype from '../Renderer/PixelDatatype.js';\nimport RenderState from '../Renderer/RenderState.js';\nimport Sampler from '../Renderer/Sampler.js';\nimport ShaderSource from '../Renderer/ShaderSource.js';\nimport Texture from '../Renderer/Texture.js';\nimport TextureMagnificationFilter from '../Renderer/TextureMagnificationFilter.js';\nimport TextureMinificationFilter from '../Renderer/TextureMinificationFilter.js';\nimport TextureWrap from '../Renderer/TextureWrap.js';\nimport when from '../ThirdParty/when.js';\nimport PostProcessStageSampleMode from './PostProcessStageSampleMode.js';\n\n    /**\n     * Runs a post-process stage on either the texture rendered by the scene or the output of a previous post-process stage.\n     *\n     * @alias PostProcessStage\n     * @constructor\n     *\n     * @param {Object} options An object with the following properties:\n     * @param {String} options.fragmentShader The fragment shader to use. The default <code>sampler2D</code> uniforms are <code>colorTexture</code> and <code>depthTexture</code>. The color texture is the output of rendering the scene or the previous stage. The depth texture is the output from rendering the scene. The shader should contain one or both uniforms. There is also a <code>vec2</code> varying named <code>v_textureCoordinates</code> that can be used to sample the textures.\n     * @param {Object} [options.uniforms] An object whose properties will be used to set the shaders uniforms. The properties can be constant values or a function. A constant value can also be a URI, data URI, or HTML element to use as a texture.\n     * @param {Number} [options.textureScale=1.0] A number in the range (0.0, 1.0] used to scale the texture dimensions. A scale of 1.0 will render this post-process stage  to a texture the size of the viewport.\n     * @param {Boolean} [options.forcePowerOfTwo=false] Whether or not to force the texture dimensions to be both equal powers of two. The power of two will be the next power of two of the minimum of the dimensions.\n     * @param {PostProcessStageSampleMode} [options.sampleMode=PostProcessStageSampleMode.NEAREST] How to sample the input color texture.\n     * @param {PixelFormat} [options.pixelFormat=PixelFormat.RGBA] The color pixel format of the output texture.\n     * @param {PixelDatatype} [options.pixelDatatype=PixelDatatype.UNSIGNED_BYTE] The pixel data type of the output texture.\n     * @param {Color} [options.clearColor=Color.BLACK] The color to clear the output texture to.\n     * @param {BoundingRectangle} [options.scissorRectangle] The rectangle to use for the scissor test.\n     * @param {String} [options.name=createGuid()] The unique name of this post-process stage for reference by other stages in a composite. If a name is not supplied, a GUID will be generated.\n     *\n     * @exception {DeveloperError} options.textureScale must be greater than 0.0 and less than or equal to 1.0.\n     * @exception {DeveloperError} options.pixelFormat must be a color format.\n     * @exception {DeveloperError} When options.pixelDatatype is FLOAT, this WebGL implementation must support the OES_texture_float extension.  Check context.floatingPointTexture.\n     *\n     * @see PostProcessStageComposite\n     *\n     * @example\n     * // Simple stage to change the color\n     * var fs =\n     *     'uniform sampler2D colorTexture;\\n' +\n     *     'varying vec2 v_textureCoordinates;\\n' +\n     *     'uniform float scale;\\n' +\n     *     'uniform vec3 offset;\\n' +\n     *     'void main() {\\n' +\n     *     '    vec4 color = texture2D(colorTexture, v_textureCoordinates);\\n' +\n     *     '    gl_FragColor = vec4(color.rgb * scale + offset, 1.0);\\n' +\n     *     '}\\n';\n     * scene.postProcessStages.add(new Cesium.PostProcessStage({\n     *     fragmentShader : fs,\n     *     uniforms : {\n     *         scale : 1.1,\n     *         offset : function() {\n     *             return new Cesium.Cartesian3(0.1, 0.2, 0.3);\n     *         }\n     *     }\n     * }));\n     *\n     * @example\n     * // Simple stage to change the color of what is selected.\n     * // If czm_selected returns true, the current fragment belongs to geometry in the selected array.\n     * var fs =\n     *     'uniform sampler2D colorTexture;\\n' +\n     *     'varying vec2 v_textureCoordinates;\\n' +\n     *     'uniform vec4 highlight;\\n' +\n     *     'void main() {\\n' +\n     *     '    vec4 color = texture2D(colorTexture, v_textureCoordinates);\\n' +\n     *     '    if (czm_selected()) {\\n' +\n     *     '        vec3 highlighted = highlight.a * highlight.rgb + (1.0 - highlight.a) * color.rgb;\\n' +\n     *     '        gl_FragColor = vec4(highlighted, 1.0);\\n' +\n     *     '    } else { \\n' +\n     *     '        gl_FragColor = color;\\n' +\n     *     '    }\\n' +\n     *     '}\\n';\n     * var stage = scene.postProcessStages.add(new Cesium.PostProcessStage({\n     *     fragmentShader : fs,\n     *     uniforms : {\n     *         highlight : function() {\n     *             return new Cesium.Color(1.0, 0.0, 0.0, 0.5);\n     *         }\n     *     }\n     * }));\n     * stage.selected = [cesium3DTileFeature];\n     */\n    function PostProcessStage(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n        var fragmentShader = options.fragmentShader;\n        var textureScale = defaultValue(options.textureScale, 1.0);\n        var pixelFormat = defaultValue(options.pixelFormat, PixelFormat.RGBA);\n\n        \n\n        this._fragmentShader = fragmentShader;\n        this._uniforms = options.uniforms;\n        this._textureScale = textureScale;\n        this._forcePowerOfTwo = defaultValue(options.forcePowerOfTwo, false);\n        this._sampleMode = defaultValue(options.sampleMode, PostProcessStageSampleMode.NEAREST);\n        this._pixelFormat = pixelFormat;\n        this._pixelDatatype = defaultValue(options.pixelDatatype, PixelDatatype.UNSIGNED_BYTE);\n        this._clearColor = defaultValue(options.clearColor, Color.BLACK);\n\n        this._uniformMap = undefined;\n        this._command = undefined;\n\n        this._colorTexture = undefined;\n        this._depthTexture = undefined;\n        this._idTexture = undefined;\n\n        this._actualUniforms = {};\n        this._dirtyUniforms = [];\n        this._texturesToRelease = [];\n        this._texturesToCreate = [];\n        this._texturePromise = undefined;\n\n        var passState = new PassState();\n        passState.scissorTest = {\n            enabled : true,\n            rectangle : defined(options.scissorRectangle) ? BoundingRectangle.clone(options.scissorRectangle) : new BoundingRectangle()\n        };\n        this._passState = passState;\n\n        this._ready = false;\n\n        var name = options.name;\n        if (!defined(name)) {\n            name = createGuid();\n        }\n        this._name = name;\n\n        this._logDepthChanged = undefined;\n        this._useLogDepth = undefined;\n\n        this._selectedIdTexture = undefined;\n        this._selected = undefined;\n        this._selectedShadow = undefined;\n        this._parentSelected = undefined;\n        this._parentSelectedShadow = undefined;\n        this._combinedSelected = undefined;\n        this._combinedSelectedShadow = undefined;\n        this._selectedLength = 0;\n        this._parentSelectedLength = 0;\n        this._selectedDirty = true;\n\n        // set by PostProcessStageCollection\n        this._textureCache = undefined;\n        this._index = undefined;\n\n        /**\n         * Whether or not to execute this post-process stage when ready.\n         *\n         * @type {Boolean}\n         */\n        this.enabled = true;\n        this._enabled = true;\n    }\n\n    Object.defineProperties(PostProcessStage.prototype, {\n        /**\n         * Determines if this post-process stage is ready to be executed. A stage is only executed when both <code>ready</code>\n         * and {@link PostProcessStage#enabled} are <code>true</code>. A stage will not be ready while it is waiting on textures\n         * to load.\n         *\n         * @memberof PostProcessStage.prototype\n         * @type {Boolean}\n         * @readonly\n         */\n        ready : {\n            get : function() {\n                return this._ready;\n            }\n        },\n        /**\n         * The unique name of this post-process stage for reference by other stages in a {@link PostProcessStageComposite}.\n         *\n         * @memberof PostProcessStage.prototype\n         * @type {String}\n         * @readonly\n         */\n        name : {\n            get : function() {\n                return this._name;\n            }\n        },\n        /**\n         * The fragment shader to use when execute this post-process stage.\n         * <p>\n         * The shader must contain a sampler uniform declaration for <code>colorTexture</code>, <code>depthTexture</code>,\n         * or both.\n         * </p>\n         * <p>\n         * The shader must contain a <code>vec2</code> varying declaration for <code>v_textureCoordinates</code> for sampling\n         * the texture uniforms.\n         * </p>\n         *\n         * @memberof PostProcessStage.prototype\n         * @type {String}\n         * @readonly\n         */\n        fragmentShader : {\n            get : function() {\n                return this._fragmentShader;\n            }\n        },\n        /**\n         * An object whose properties are used to set the uniforms of the fragment shader.\n         * <p>\n         * The object property values can be either a constant or a function. The function will be called\n         * each frame before the post-process stage is executed.\n         * </p>\n         * <p>\n         * A constant value can also be a URI to an image, a data URI, or an HTML element that can be used as a texture, such as HTMLImageElement or HTMLCanvasElement.\n         * </p>\n         * <p>\n         * If this post-process stage is part of a {@link PostProcessStageComposite} that does not execute in series, the constant value can also be\n         * the name of another stage in a composite. This will set the uniform to the output texture the stage with that name.\n         * </p>\n         *\n         * @memberof PostProcessStage.prototype\n         * @type {Object}\n         * @readonly\n         */\n        uniforms : {\n            get : function() {\n                return this._uniforms;\n            }\n        },\n        /**\n         * A number in the range (0.0, 1.0] used to scale the output texture dimensions. A scale of 1.0 will render this post-process stage to a texture the size of the viewport.\n         *\n         * @memberof PostProcessStage.prototype\n         * @type {Number}\n         * @readonly\n         */\n        textureScale : {\n            get : function() {\n                return this._textureScale;\n            }\n        },\n        /**\n         * Whether or not to force the output texture dimensions to be both equal powers of two. The power of two will be the next power of two of the minimum of the dimensions.\n         *\n         * @memberof PostProcessStage.prototype\n         * @type {Number}\n         * @readonly\n         */\n        forcePowerOfTwo : {\n            get : function() {\n                return this._forcePowerOfTwo;\n            }\n        },\n        /**\n         * How to sample the input color texture.\n         *\n         * @memberof PostProcessStage.prototype\n         * @type {PostProcessStageSampleMode}\n         * @readonly\n         */\n        sampleMode : {\n            get : function() {\n                return this._sampleMode;\n            }\n        },\n        /**\n         * The color pixel format of the output texture.\n         *\n         * @memberof PostProcessStage.prototype\n         * @type {PixelFormat}\n         * @readonly\n         */\n        pixelFormat : {\n            get : function() {\n                return this._pixelFormat;\n            }\n        },\n        /**\n         * The pixel data type of the output texture.\n         *\n         * @memberof PostProcessStage.prototype\n         * @type {PixelDatatype}\n         * @readonly\n         */\n        pixelDatatype : {\n            get : function() {\n                return this._pixelDatatype;\n            }\n        },\n        /**\n         * The color to clear the output texture to.\n         *\n         * @memberof PostProcessStage.prototype\n         * @type {Color}\n         * @readonly\n         */\n        clearColor : {\n            get : function() {\n                return this._clearColor;\n            }\n        },\n        /**\n         * The {@link BoundingRectangle} to use for the scissor test. A default bounding rectangle will disable the scissor test.\n         *\n         * @memberof PostProcessStage.prototype\n         * @type {BoundingRectangle}\n         * @readonly\n         */\n        scissorRectangle : {\n            get : function() {\n                return this._passState.scissorTest.rectangle;\n            }\n        },\n        /**\n         * A reference to the texture written to when executing this post process stage.\n         *\n         * @memberof PostProcessStage.prototype\n         * @type {Texture}\n         * @readonly\n         * @private\n         */\n        outputTexture : {\n            get : function() {\n                if (defined(this._textureCache)) {\n                    var framebuffer = this._textureCache.getFramebuffer(this._name);\n                    if (defined(framebuffer)) {\n                        return framebuffer.getColorTexture(0);\n                    }\n                }\n                return undefined;\n            }\n        },\n        /**\n         * The features selected for applying the post-process.\n         * <p>\n         * In the fragment shader, use <code>czm_selected</code> to determine whether or not to apply the post-process\n         * stage to that fragment. For example:\n         * <code>\n         * if (czm_selected(v_textureCoordinates)) {\n         *     // apply post-process stage\n         * } else {\n         *     gl_FragColor = texture2D(colorTexture, v_textureCordinates);\n         * }\n         * </code>\n         * </p>\n         *\n         * @memberof PostProcessStage.prototype\n         * @type {Array}\n         */\n        selected : {\n            get : function() {\n                return this._selected;\n            },\n            set : function(value) {\n                this._selected = value;\n            }\n        },\n        /**\n         * @private\n         */\n        parentSelected : {\n            get : function() {\n                return this._parentSelected;\n            },\n            set : function(value) {\n                this._parentSelected = value;\n            }\n        }\n    });\n\n    var depthTextureRegex = /uniform\\s+sampler2D\\s+depthTexture/g;\n\n    /**\n     * @private\n     */\n    PostProcessStage.prototype._isSupported = function(context) {\n        return !depthTextureRegex.test(this._fragmentShader) || context.depthTexture;\n    };\n\n    function getUniformValueGetterAndSetter(stage, uniforms, name) {\n        var currentValue = uniforms[name];\n        if (typeof currentValue === 'string' || currentValue instanceof HTMLCanvasElement || currentValue instanceof HTMLImageElement ||\n            currentValue instanceof HTMLVideoElement || currentValue instanceof ImageData) {\n            stage._dirtyUniforms.push(name);\n        }\n\n        return {\n            get : function() {\n                return uniforms[name];\n            },\n            set : function(value) {\n                var currentValue = uniforms[name];\n                uniforms[name] = value;\n\n                var actualUniforms = stage._actualUniforms;\n                var actualValue = actualUniforms[name];\n                if (defined(actualValue) && actualValue !== currentValue && actualValue instanceof Texture && !defined(stage._textureCache.getStageByName(name))) {\n                    stage._texturesToRelease.push(actualValue);\n                    delete actualUniforms[name];\n                    delete actualUniforms[name + 'Dimensions'];\n                }\n\n                if (currentValue instanceof Texture) {\n                    stage._texturesToRelease.push(currentValue);\n                }\n\n                if (typeof value === 'string' || value instanceof HTMLCanvasElement || value instanceof HTMLImageElement ||\n                    value instanceof HTMLVideoElement || value instanceof ImageData) {\n                    stage._dirtyUniforms.push(name);\n                } else {\n                    actualUniforms[name] = value;\n                }\n            }\n        };\n    }\n\n    function getUniformMapFunction(stage, name) {\n        return function() {\n            var value = stage._actualUniforms[name];\n            if (typeof value === 'function') {\n                return value();\n            }\n            return value;\n        };\n    }\n\n    function getUniformMapDimensionsFunction(uniformMap, name) {\n        return function() {\n            var texture = uniformMap[name]();\n            if (defined(texture)) {\n                return texture.dimensions;\n            }\n            return undefined;\n        };\n    }\n\n    function createUniformMap(stage) {\n        if (defined(stage._uniformMap)) {\n            return;\n        }\n\n        var uniformMap = {};\n        var newUniforms = {};\n        var uniforms = stage._uniforms;\n        var actualUniforms = stage._actualUniforms;\n        for (var name in uniforms) {\n            if (uniforms.hasOwnProperty(name)) {\n                if (typeof uniforms[name] !== 'function') {\n                    uniformMap[name] = getUniformMapFunction(stage, name);\n                    newUniforms[name] = getUniformValueGetterAndSetter(stage, uniforms, name);\n                } else {\n                    uniformMap[name] = uniforms[name];\n                    newUniforms[name] = uniforms[name];\n                }\n\n                actualUniforms[name] = uniforms[name];\n\n                var value = uniformMap[name]();\n                if (typeof value === 'string' || value instanceof Texture || value instanceof HTMLImageElement ||\n                    value instanceof HTMLCanvasElement || value instanceof HTMLVideoElement) {\n                    uniformMap[name + 'Dimensions'] = getUniformMapDimensionsFunction(uniformMap, name);\n                }\n            }\n        }\n\n        stage._uniforms = {};\n        Object.defineProperties(stage._uniforms, newUniforms);\n\n        stage._uniformMap = combine(uniformMap, {\n            colorTexture : function() {\n                return stage._colorTexture;\n            },\n            colorTextureDimensions : function() {\n                return stage._colorTexture.dimensions;\n            },\n            depthTexture : function() {\n                return stage._depthTexture;\n            },\n            depthTextureDimensions : function() {\n                return stage._depthTexture.dimensions;\n            },\n            czm_idTexture : function() {\n                return stage._idTexture;\n            },\n            czm_selectedIdTexture : function() {\n                return stage._selectedIdTexture;\n            },\n            czm_selectedIdTextureStep : function() {\n                return 1.0 / stage._selectedIdTexture.width;\n            }\n        });\n    }\n\n    function createDrawCommand(stage, context) {\n        if (defined(stage._command) && !stage._logDepthChanged && !stage._selectedDirty) {\n            return;\n        }\n\n        var fs = stage._fragmentShader;\n        if (defined(stage._selectedIdTexture)) {\n            var width = stage._selectedIdTexture.width;\n\n            fs = fs.replace(/varying\\s+vec2\\s+v_textureCoordinates;/g, '');\n            fs =\n                '#define CZM_SELECTED_FEATURE \\n' +\n                'uniform sampler2D czm_idTexture; \\n' +\n                'uniform sampler2D czm_selectedIdTexture; \\n' +\n                'uniform float czm_selectedIdTextureStep; \\n' +\n                'varying vec2 v_textureCoordinates; \\n' +\n                'bool czm_selected(vec2 offset) \\n' +\n                '{ \\n' +\n                '    bool selected = false;\\n' +\n                '    vec4 id = texture2D(czm_idTexture, v_textureCoordinates + offset); \\n' +\n                '    for (int i = 0; i < ' + width + '; ++i) \\n' +\n                '    { \\n' +\n                '        vec4 selectedId = texture2D(czm_selectedIdTexture, vec2((float(i) + 0.5) * czm_selectedIdTextureStep, 0.5)); \\n' +\n                '        if (all(equal(id, selectedId))) \\n' +\n                '        { \\n' +\n                '            return true; \\n' +\n                '        } \\n' +\n                '    } \\n' +\n                '    return false; \\n' +\n                '} \\n\\n' +\n                'bool czm_selected() \\n' +\n                '{ \\n' +\n                '    return czm_selected(vec2(0.0)); \\n' +\n                '} \\n\\n' +\n                fs;\n        }\n\n        var fragmentShader = new ShaderSource({\n            defines : [stage._useLogDepth ? 'LOG_DEPTH' : ''],\n            sources : [fs]\n        });\n        stage._command = context.createViewportQuadCommand(fragmentShader, {\n            uniformMap : stage._uniformMap,\n            owner : stage\n        });\n    }\n\n    function createSampler(stage) {\n        var mode = stage._sampleMode;\n\n        var minFilter;\n        var magFilter;\n\n        if (mode === PostProcessStageSampleMode.LINEAR) {\n            minFilter = TextureMinificationFilter.LINEAR;\n            magFilter = TextureMagnificationFilter.LINEAR;\n        } else {\n            minFilter = TextureMinificationFilter.NEAREST;\n            magFilter = TextureMagnificationFilter.NEAREST;\n        }\n\n        var sampler = stage._sampler;\n        if (!defined(sampler) || sampler.minificationFilter !== minFilter || sampler.magnificationFilter !== magFilter) {\n            stage._sampler = new Sampler({\n                wrapS : TextureWrap.CLAMP_TO_EDGE,\n                wrapT : TextureWrap.CLAMP_TO_EDGE,\n                minificationFilter : minFilter,\n                magnificationFilter : magFilter\n            });\n        }\n    }\n\n    function createLoadImageFunction(stage, name) {\n        return function(image) {\n            stage._texturesToCreate.push({\n                name : name,\n                source : image\n            });\n        };\n    }\n\n    function createStageOutputTextureFunction(stage, name) {\n        return function() {\n            return stage._textureCache.getOutputTexture(name);\n        };\n    }\n\n    function updateUniformTextures(stage, context) {\n        var i;\n        var texture;\n        var name;\n\n        var texturesToRelease = stage._texturesToRelease;\n        var length = texturesToRelease.length;\n        for (i = 0; i < length; ++i) {\n            texture = texturesToRelease[i];\n            texture = texture && texture.destroy();\n        }\n        texturesToRelease.length = 0;\n\n        var texturesToCreate = stage._texturesToCreate;\n        length = texturesToCreate.length;\n        for (i = 0; i < length; ++i) {\n            var textureToCreate = texturesToCreate[i];\n            name = textureToCreate.name;\n            var source = textureToCreate.source;\n            stage._actualUniforms[name] = new Texture({\n                context : context,\n                source : source\n            });\n        }\n        texturesToCreate.length = 0;\n\n        var dirtyUniforms = stage._dirtyUniforms;\n        if (dirtyUniforms.length === 0 && !defined(stage._texturePromise)) {\n            stage._ready = true;\n            return;\n        }\n\n        if (dirtyUniforms.length === 0 || defined(stage._texturePromise)) {\n            return;\n        }\n\n        length = dirtyUniforms.length;\n        var uniforms = stage._uniforms;\n        var promises = [];\n        for (i = 0; i < length; ++i) {\n            name = dirtyUniforms[i];\n            var stageNameUrlOrImage = uniforms[name];\n            var stageWithName = stage._textureCache.getStageByName(stageNameUrlOrImage);\n            if (defined(stageWithName)) {\n                stage._actualUniforms[name] = createStageOutputTextureFunction(stage, stageNameUrlOrImage);\n            } else if (typeof stageNameUrlOrImage === 'string') {\n                var resource = new Resource({\n                    url : stageNameUrlOrImage\n                });\n\n                promises.push(resource.fetchImage().then(createLoadImageFunction(stage, name)));\n            } else {\n                stage._texturesToCreate.push({\n                    name : name,\n                    source : stageNameUrlOrImage\n                });\n            }\n        }\n\n        dirtyUniforms.length = 0;\n\n        if (promises.length > 0) {\n            stage._ready = false;\n            stage._texturePromise = when.all(promises).then(function() {\n                stage._ready = true;\n                stage._texturePromise = undefined;\n            });\n        } else {\n            stage._ready = true;\n        }\n    }\n\n    function releaseResources(stage) {\n        if (defined(stage._command)) {\n            stage._command.shaderProgram = stage._command.shaderProgram && stage._command.shaderProgram.destroy();\n            stage._command = undefined;\n        }\n\n        stage._selectedIdTexture = stage._selectedIdTexture && stage._selectedIdTexture.destroy();\n\n        var textureCache = stage._textureCache;\n        if (!defined(textureCache)) {\n            return;\n        }\n\n        var uniforms = stage._uniforms;\n        var actualUniforms = stage._actualUniforms;\n        for (var name in actualUniforms) {\n            if (actualUniforms.hasOwnProperty(name)) {\n                if (actualUniforms[name] instanceof Texture) {\n                    if (!defined(textureCache.getStageByName(uniforms[name]))) {\n                        actualUniforms[name].destroy();\n                    }\n                    stage._dirtyUniforms.push(name);\n                }\n            }\n        }\n    }\n\n    function isSelectedTextureDirty(stage) {\n        var length = defined(stage._selected) ? stage._selected.length : 0;\n        var parentLength = defined(stage._parentSelected) ? stage._parentSelected : 0;\n        var dirty = stage._selected !== stage._selectedShadow || length !== stage._selectedLength;\n        dirty = dirty || stage._parentSelected !== stage._parentSelectedShadow || parentLength !== stage._parentSelectedLength;\n\n        if (defined(stage._selected) && defined(stage._parentSelected)) {\n            stage._combinedSelected = stage._selected.concat(stage._parentSelected);\n        } else if (defined(stage._parentSelected)) {\n            stage._combinedSelected = stage._parentSelected;\n        } else {\n            stage._combinedSelected = stage._selected;\n        }\n\n        if (!dirty && defined(stage._combinedSelected)) {\n            if (!defined(stage._combinedSelectedShadow)) {\n                return true;\n            }\n\n            length = stage._combinedSelected.length;\n            for (var i = 0; i < length; ++i) {\n                if (stage._combinedSelected[i] !== stage._combinedSelectedShadow[i]) {\n                    return true;\n                }\n            }\n        }\n        return dirty;\n    }\n\n    function createSelectedTexture(stage, context) {\n        if (!stage._selectedDirty) {\n            return;\n        }\n\n        stage._selectedIdTexture = stage._selectedIdTexture && stage._selectedIdTexture.destroy();\n        stage._selectedIdTexture = undefined;\n\n        var features = stage._combinedSelected;\n        if (!defined(features)) {\n            return;\n        }\n\n        var i;\n        var feature;\n\n        var textureLength = 0;\n        var length = features.length;\n        for (i = 0; i < length; ++i) {\n            feature = features[i];\n            if (defined(feature.pickIds)) {\n                textureLength += feature.pickIds.length;\n            } else if (defined(feature.pickId)) {\n                ++textureLength;\n            }\n        }\n\n        if (length === 0 || textureLength === 0) {\n            // max pick id is reserved\n            var empty = new Uint8Array(4);\n            empty[0] = 255;\n            empty[1] = 255;\n            empty[2] = 255;\n            empty[3] = 255;\n\n            stage._selectedIdTexture = new Texture({\n                context : context,\n                pixelFormat : PixelFormat.RGBA,\n                pixelDatatype : PixelDatatype.UNSIGNED_BYTE,\n                source : {\n                    arrayBufferView : empty,\n                    width : 1,\n                    height : 1\n                },\n                sampler : Sampler.NEAREST\n            });\n            return;\n        }\n\n        var pickColor;\n        var offset = 0;\n        var ids = new Uint8Array(textureLength * 4);\n        for (i = 0; i < length; ++i) {\n            feature = features[i];\n            if (defined(feature.pickIds)) {\n                var pickIds = feature.pickIds;\n                var pickIdsLength = pickIds.length;\n                for (var j = 0; j < pickIdsLength; ++j) {\n                    pickColor = pickIds[j].color;\n                    ids[offset] = Color.floatToByte(pickColor.red);\n                    ids[offset + 1] = Color.floatToByte(pickColor.green);\n                    ids[offset + 2] = Color.floatToByte(pickColor.blue);\n                    ids[offset + 3] = Color.floatToByte(pickColor.alpha);\n                    offset += 4;\n                }\n            } else if (defined(feature.pickId)) {\n                pickColor = feature.pickId.color;\n                ids[offset] = Color.floatToByte(pickColor.red);\n                ids[offset + 1] = Color.floatToByte(pickColor.green);\n                ids[offset + 2] = Color.floatToByte(pickColor.blue);\n                ids[offset + 3] = Color.floatToByte(pickColor.alpha);\n                offset += 4;\n            }\n        }\n\n        stage._selectedIdTexture = new Texture({\n            context : context,\n            pixelFormat : PixelFormat.RGBA,\n            pixelDatatype : PixelDatatype.UNSIGNED_BYTE,\n            source : {\n                arrayBufferView : ids,\n                width : textureLength,\n                height : 1\n            },\n            sampler : Sampler.NEAREST\n        });\n    }\n\n    /**\n     * A function that will be called before execute. Used to create WebGL resources and load any textures.\n     * @param {Context} context The context.\n     * @param {Boolean} useLogDepth Whether the scene uses a logarithmic depth buffer.\n     * @private\n     */\n    PostProcessStage.prototype.update = function(context, useLogDepth) {\n        if (this.enabled !== this._enabled && !this.enabled) {\n            releaseResources(this);\n        }\n\n        this._enabled = this.enabled;\n        if (!this._enabled) {\n            return;\n        }\n\n        this._logDepthChanged = useLogDepth !== this._useLogDepth;\n        this._useLogDepth = useLogDepth;\n\n        this._selectedDirty = isSelectedTextureDirty(this);\n\n        this._selectedShadow = this._selected;\n        this._parentSelectedShadow = this._parentSelected;\n        this._combinedSelectedShadow = this._combinedSelected;\n        this._selectedLength = defined(this._selected) ? this._selected.length : 0;\n        this._parentSelectedLength = defined(this._parentSelected) ? this._parentSelected.length : 0;\n\n        createSelectedTexture(this, context);\n        createUniformMap(this);\n        updateUniformTextures(this, context);\n        createDrawCommand(this, context);\n        createSampler(this);\n\n        this._selectedDirty = false;\n\n        if (!this._ready) {\n            return;\n        }\n\n        var framebuffer = this._textureCache.getFramebuffer(this._name);\n        this._command.framebuffer = framebuffer;\n\n        if (!defined(framebuffer)) {\n            return;\n        }\n\n        var colorTexture = framebuffer.getColorTexture(0);\n        var renderState;\n        if (colorTexture.width !== context.drawingBufferWidth || colorTexture.height !== context.drawingBufferHeight) {\n            renderState = this._renderState;\n            if (!defined(renderState) || colorTexture.width !== renderState.viewport.width || colorTexture.height !== renderState.viewport.height) {\n                this._renderState = RenderState.fromCache({\n                    viewport : new BoundingRectangle(0, 0, colorTexture.width, colorTexture.height)\n                });\n            }\n        }\n\n        this._command.renderState = renderState;\n    };\n\n    /**\n     * Executes the post-process stage. The color texture is the texture rendered to by the scene or from the previous stage.\n     * @param {Context} context The context.\n     * @param {Texture} colorTexture The input color texture.\n     * @param {Texture} depthTexture The input depth texture.\n     * @param {Texture} idTexture The id texture.\n     * @private\n     */\n    PostProcessStage.prototype.execute = function(context, colorTexture, depthTexture, idTexture) {\n        if (!defined(this._command) || !defined(this._command.framebuffer) || !this._ready || !this._enabled) {\n            return;\n        }\n\n        this._colorTexture = colorTexture;\n        this._depthTexture = depthTexture;\n        this._idTexture = idTexture;\n\n        if (!Sampler.equals(this._colorTexture.sampler, this._sampler)) {\n            this._colorTexture.sampler = this._sampler;\n        }\n\n        var passState = this.scissorRectangle.width > 0 && this.scissorRectangle.height > 0 ? this._passState : undefined;\n        if (defined(passState)) {\n            passState.context = context;\n        }\n\n        this._command.execute(context, passState);\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <p>\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     * </p>\n     *\n     * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n     *\n     * @see PostProcessStage#destroy\n     */\n    PostProcessStage.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n     * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n     * <p>\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     * </p>\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     * @see PostProcessStage#isDestroyed\n     */\n    PostProcessStage.prototype.destroy = function() {\n        releaseResources(this);\n        return destroyObject(this);\n    };\nexport default PostProcessStage;\n","import Check from '../Core/Check.js';\nimport createGuid from '../Core/createGuid.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\n\n    /**\n     * A collection of {@link PostProcessStage}s or other post-process composite stages that execute together logically.\n     * <p>\n     * All stages are executed in the order of the array. The input texture changes based on the value of <code>inputPreviousStageTexture</code>.\n     * If <code>inputPreviousStageTexture</code> is <code>true</code>, the input to each stage is the output texture rendered to by the scene or of the stage that executed before it.\n     * If <code>inputPreviousStageTexture</code> is <code>false</code>, the input texture is the same for each stage in the composite. The input texture is the texture rendered to by the scene\n     * or the output texture of the previous stage.\n     * </p>\n     *\n     * @alias PostProcessStageComposite\n     * @constructor\n     *\n     * @param {Object} options An object with the following properties:\n     * @param {Array} options.stages An array of {@link PostProcessStage}s or composites to be executed in order.\n     * @param {Boolean} [options.inputPreviousStageTexture=true] Whether to execute each post-process stage where the input to one stage is the output of the previous. Otherwise, the input to each contained stage is the output of the stage that executed before the composite.\n     * @param {String} [options.name=createGuid()] The unique name of this post-process stage for reference by other composites. If a name is not supplied, a GUID will be generated.\n     * @param {Object} [options.uniforms] An alias to the uniforms of post-process stages.\n     *\n     * @exception {DeveloperError} options.stages.length must be greater than 0.0.\n     *\n     * @see PostProcessStage\n     *\n     * @example\n     * // Example 1: separable blur filter\n     * // The input to blurXDirection is the texture rendered to by the scene or the output of the previous stage.\n     * // The input to blurYDirection is the texture rendered to by blurXDirection.\n     * scene.postProcessStages.add(new Cesium.PostProcessStageComposite({\n     *     stages : [blurXDirection, blurYDirection]\n     * }));\n     *\n     * @example\n     * // Example 2: referencing the output of another post-process stage\n     * scene.postProcessStages.add(new Cesium.PostProcessStageComposite({\n     *     inputPreviousStageTexture : false,\n     *     stages : [\n     *         // The same as Example 1.\n     *         new Cesium.PostProcessStageComposite({\n     *             inputPreviousStageTexture : true\n     *             stages : [blurXDirection, blurYDirection],\n     *             name : 'blur'\n     *         }),\n     *         // The input texture for this stage is the same input texture to blurXDirection since inputPreviousStageTexture is false\n     *         new Cesium.PostProcessStage({\n     *             fragmentShader : compositeShader,\n     *             uniforms : {\n     *                 blurTexture : 'blur' // The output of the composite with name 'blur' (the texture that blurYDirection rendered to).\n     *             }\n     *         })\n     *     ]\n     * });\n     *\n     * @example\n     * // Example 3: create a uniform alias\n     * var uniforms = {};\n     * Cesium.defineProperties(uniforms, {\n     *     filterSize : {\n     *         get : function() {\n     *             return blurXDirection.uniforms.filterSize;\n     *         },\n     *         set : function(value) {\n     *             blurXDirection.uniforms.filterSize = blurYDirection.uniforms.filterSize = value;\n     *         }\n     *     }\n     * });\n     * scene.postProcessStages.add(new Cesium.PostProcessStageComposite({\n     *     stages : [blurXDirection, blurYDirection],\n     *     uniforms : uniforms\n     * }));\n     */\n    function PostProcessStageComposite(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        \n\n        this._stages = options.stages;\n        this._inputPreviousStageTexture = defaultValue(options.inputPreviousStageTexture, true);\n\n        var name = options.name;\n        if (!defined(name)) {\n            name = createGuid();\n        }\n        this._name = name;\n\n        this._uniforms = options.uniforms;\n\n        // used by PostProcessStageCollection\n        this._textureCache = undefined;\n        this._index = undefined;\n\n        this._selected = undefined;\n        this._selectedShadow = undefined;\n        this._parentSelected = undefined;\n        this._parentSelectedShadow = undefined;\n        this._combinedSelected = undefined;\n        this._combinedSelectedShadow = undefined;\n        this._selectedLength = 0;\n        this._parentSelectedLength = 0;\n        this._selectedDirty = true;\n    }\n\n    Object.defineProperties(PostProcessStageComposite.prototype, {\n        /**\n         * Determines if this post-process stage is ready to be executed.\n         *\n         * @memberof PostProcessStageComposite.prototype\n         * @type {Boolean}\n         * @readonly\n         */\n        ready : {\n            get : function() {\n                var stages = this._stages;\n                var length = stages.length;\n                for (var i = 0; i < length; ++i) {\n                    if (!stages[i].ready) {\n                        return false;\n                    }\n                }\n                return true;\n            }\n        },\n        /**\n         * The unique name of this post-process stage for reference by other stages in a PostProcessStageComposite.\n         *\n         * @memberof PostProcessStageComposite.prototype\n         * @type {String}\n         * @readonly\n         */\n        name : {\n            get : function() {\n                return this._name;\n            }\n        },\n        /**\n         * Whether or not to execute this post-process stage when ready.\n         *\n         * @memberof PostProcessStageComposite.prototype\n         * @type {Boolean}\n         */\n        enabled : {\n            get : function() {\n                return this._stages[0].enabled;\n            },\n            set : function(value) {\n                var stages = this._stages;\n                var length = stages.length;\n                for (var i = 0; i < length; ++i) {\n                    stages[i].enabled = value;\n                }\n            }\n        },\n        /**\n         * An alias to the uniform values of the post-process stages. May be <code>undefined</code>; in which case, get each stage to set uniform values.\n         * @memberof PostProcessStageComposite.prototype\n         * @type {Object}\n         */\n        uniforms : {\n            get : function() {\n                return this._uniforms;\n            }\n        },\n        /**\n         * All post-process stages are executed in the order of the array. The input texture changes based on the value of <code>inputPreviousStageTexture</code>.\n         * If <code>inputPreviousStageTexture</code> is <code>true</code>, the input to each stage is the output texture rendered to by the scene or of the stage that executed before it.\n         * If <code>inputPreviousStageTexture</code> is <code>false</code>, the input texture is the same for each stage in the composite. The input texture is the texture rendered to by the scene\n         * or the output texture of the previous stage.\n         *\n         * @memberof PostProcessStageComposite.prototype\n         * @type {Boolean}\n         * @readonly\n         */\n        inputPreviousStageTexture : {\n            get : function() {\n                return this._inputPreviousStageTexture;\n            }\n        },\n        /**\n         * The number of post-process stages in this composite.\n         *\n         * @memberof PostProcessStageComposite.prototype\n         * @type {Number}\n         * @readonly\n         */\n        length : {\n            get : function() {\n                return this._stages.length;\n            }\n        },\n        /**\n         * The features selected for applying the post-process.\n         *\n         * @memberof PostProcessStageComposite.prototype\n         * @type {Array}\n         */\n        selected : {\n            get : function() {\n                return this._selected;\n            },\n            set : function(value) {\n                this._selected = value;\n            }\n        },\n        /**\n         * @private\n         */\n        parentSelected : {\n            get : function() {\n                return this._parentSelected;\n            },\n            set : function(value) {\n                this._parentSelected = value;\n            }\n        }\n    });\n\n    /**\n     * @private\n     */\n    PostProcessStageComposite.prototype._isSupported = function(context) {\n        var stages = this._stages;\n        var length = stages.length;\n        for (var i = 0; i < length; ++i) {\n            if (!stages[i]._isSupported(context)) {\n                return false;\n            }\n        }\n        return true;\n    };\n\n    /**\n     * Gets the post-process stage at <code>index</code>\n     *\n     * @param {Number} index The index of the post-process stage or composite.\n     * @return {PostProcessStage|PostProcessStageComposite} The post-process stage or composite at index.\n     *\n     * @exception {DeveloperError} index must be greater than or equal to 0.\n     * @exception {DeveloperError} index must be less than {@link PostProcessStageComposite#length}.\n     */\n    PostProcessStageComposite.prototype.get = function(index) {\n        \n        return this._stages[index];\n    };\n\n    function isSelectedTextureDirty(stage) {\n        var length = defined(stage._selected) ? stage._selected.length : 0;\n        var parentLength = defined(stage._parentSelected) ? stage._parentSelected : 0;\n        var dirty = stage._selected !== stage._selectedShadow || length !== stage._selectedLength;\n        dirty = dirty || stage._parentSelected !== stage._parentSelectedShadow || parentLength !== stage._parentSelectedLength;\n\n        if (defined(stage._selected) && defined(stage._parentSelected)) {\n            stage._combinedSelected = stage._selected.concat(stage._parentSelected);\n        } else if (defined(stage._parentSelected)) {\n            stage._combinedSelected = stage._parentSelected;\n        } else {\n            stage._combinedSelected = stage._selected;\n        }\n\n        if (!dirty && defined(stage._combinedSelected)) {\n            if (!defined(stage._combinedSelectedShadow)) {\n                return true;\n            }\n\n            length = stage._combinedSelected.length;\n            for (var i = 0; i < length; ++i) {\n                if (stage._combinedSelected[i] !== stage._combinedSelectedShadow[i]) {\n                    return true;\n                }\n            }\n        }\n        return dirty;\n    }\n\n    /**\n     * A function that will be called before execute. Updates each post-process stage in the composite.\n     * @param {Context} context The context.\n     * @param {Boolean} useLogDepth Whether the scene uses a logarithmic depth buffer.\n     * @private\n     */\n    PostProcessStageComposite.prototype.update = function(context, useLogDepth) {\n        this._selectedDirty = isSelectedTextureDirty(this);\n\n        this._selectedShadow = this._selected;\n        this._parentSelectedShadow = this._parentSelected;\n        this._combinedSelectedShadow = this._combinedSelected;\n        this._selectedLength = defined(this._selected) ? this._selected.length : 0;\n        this._parentSelectedLength = defined(this._parentSelected) ? this._parentSelected.length : 0;\n\n        var stages = this._stages;\n        var length = stages.length;\n        for (var i = 0; i < length; ++i) {\n            var stage = stages[i];\n            if (this._selectedDirty) {\n                stage.parentSelected = this._combinedSelected;\n            }\n            stage.update(context, useLogDepth);\n        }\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <p>\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     * </p>\n     *\n     * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n     *\n     * @see PostProcessStageComposite#destroy\n     */\n    PostProcessStageComposite.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n     * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n     * <p>\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     * </p>\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     * @see PostProcessStageComposite#isDestroyed\n     */\n    PostProcessStageComposite.prototype.destroy = function() {\n        var stages = this._stages;\n        var length = stages.length;\n        for (var i = 0; i < length; ++i) {\n            stages[i].destroy();\n        }\n        return destroyObject(this);\n    };\nexport default PostProcessStageComposite;\n","import buildModuleUrl from '../Core/buildModuleUrl.js';\nimport Color from '../Core/Color.js';\nimport createGuid from '../Core/createGuid.js';\nimport defined from '../Core/defined.js';\nimport Ellipsoid from '../Core/Ellipsoid.js';\nimport AcesTonemapping from '../Shaders/PostProcessStages/AcesTonemappingStage.js';\nimport AmbientOcclusionGenerate from '../Shaders/PostProcessStages/AmbientOcclusionGenerate.js';\nimport AmbientOcclusionModulate from '../Shaders/PostProcessStages/AmbientOcclusionModulate.js';\nimport BlackAndWhite from '../Shaders/PostProcessStages/BlackAndWhite.js';\nimport BloomComposite from '../Shaders/PostProcessStages/BloomComposite.js';\nimport Brightness from '../Shaders/PostProcessStages/Brightness.js';\nimport ContrastBias from '../Shaders/PostProcessStages/ContrastBias.js';\nimport DepthOfField from '../Shaders/PostProcessStages/DepthOfField.js';\nimport DepthView from '../Shaders/PostProcessStages/DepthView.js';\nimport EdgeDetection from '../Shaders/PostProcessStages/EdgeDetection.js';\nimport FilmicTonemapping from '../Shaders/PostProcessStages/FilmicTonemapping.js';\nimport FXAA from '../Shaders/PostProcessStages/FXAA.js';\nimport GaussianBlur1D from '../Shaders/PostProcessStages/GaussianBlur1D.js';\nimport LensFlare from '../Shaders/PostProcessStages/LensFlare.js';\nimport ModifiedReinhardTonemapping from '../Shaders/PostProcessStages/ModifiedReinhardTonemapping.js';\nimport NightVision from '../Shaders/PostProcessStages/NightVision.js';\nimport ReinhardTonemapping from '../Shaders/PostProcessStages/ReinhardTonemapping.js';\nimport Silhouette from '../Shaders/PostProcessStages/Silhouette.js';\nimport FXAA3_11 from '../ThirdParty/Shaders/FXAA3_11.js';\nimport AutoExposure from './AutoExposure.js';\nimport PostProcessStage from './PostProcessStage.js';\nimport PostProcessStageComposite from './PostProcessStageComposite.js';\nimport PostProcessStageSampleMode from './PostProcessStageSampleMode.js';\n\n    /**\n     * Contains functions for creating common post-process stages.\n     *\n     * @exports PostProcessStageLibrary\n     */\n    var PostProcessStageLibrary = {};\n\n    function createBlur(name) {\n        var delta = 1.0;\n        var sigma = 2.0;\n        var stepSize = 1.0;\n\n        var blurShader = '#define USE_STEP_SIZE\\n' + GaussianBlur1D;\n        var blurX = new PostProcessStage({\n            name : name + '_x_direction',\n            fragmentShader : blurShader,\n            uniforms: {\n                delta : delta,\n                sigma : sigma,\n                stepSize : stepSize,\n                direction : 0.0\n            },\n            sampleMode : PostProcessStageSampleMode.LINEAR\n        });\n        var blurY = new PostProcessStage({\n            name : name + '_y_direction',\n            fragmentShader : blurShader,\n            uniforms: {\n                delta : delta,\n                sigma : sigma,\n                stepSize : stepSize,\n                direction : 1.0\n            },\n            sampleMode : PostProcessStageSampleMode.LINEAR\n        });\n\n        var uniforms = {};\n        Object.defineProperties(uniforms, {\n            delta : {\n                get : function() {\n                    return blurX.uniforms.delta;\n                },\n                set : function(value) {\n                    var blurXUniforms = blurX.uniforms;\n                    var blurYUniforms = blurY.uniforms;\n                    blurXUniforms.delta = blurYUniforms.delta = value;\n                }\n            },\n            sigma : {\n                get : function() {\n                    return blurX.uniforms.sigma;\n                },\n                set : function(value) {\n                    var blurXUniforms = blurX.uniforms;\n                    var blurYUniforms = blurY.uniforms;\n                    blurXUniforms.sigma = blurYUniforms.sigma = value;\n                }\n            },\n            stepSize : {\n                get : function() {\n                    return blurX.uniforms.stepSize;\n                },\n                set : function(value) {\n                    var blurXUniforms = blurX.uniforms;\n                    var blurYUniforms = blurY.uniforms;\n                    blurXUniforms.stepSize = blurYUniforms.stepSize = value;\n                }\n            }\n        });\n        return new PostProcessStageComposite({\n            name : name,\n            stages : [blurX, blurY],\n            uniforms : uniforms\n        });\n    }\n\n    /**\n     * Creates a post-process stage that applies a Gaussian blur to the input texture. This stage is usually applied in conjunction with another stage.\n     * <p>\n     * This stage has the following uniforms: <code>delta</code>, <code>sigma</code>, and <code>stepSize</code>.\n     * </p>\n     * <p>\n     * <code>delta</code> and <code>sigma</code> are used to compute the weights of a Gaussian filter. The equation is <code>exp((-0.5 * delta * delta) / (sigma * sigma))</code>.\n     * The default value for <code>delta</code> is <code>1.0</code>. The default value for <code>sigma</code> is <code>2.0</code>.\n     * <code>stepSize</code> is the distance to the next texel. The default is <code>1.0</code>.\n     * </p>\n     * @return {PostProcessStageComposite} A post-process stage that applies a Gaussian blur to the input texture.\n     */\n    PostProcessStageLibrary.createBlurStage = function() {\n        return createBlur('czm_blur');\n    };\n\n    /**\n     * Creates a post-process stage that applies a depth of field effect.\n     * <p>\n     * Depth of field simulates camera focus. Objects in the scene that are in focus\n     * will be clear whereas objects not in focus will be blurred.\n     * </p>\n     * <p>\n     * This stage has the following uniforms: <code>focalDistance</code>, <code>delta</code>, <code>sigma</code>, and <code>stepSize</code>.\n     * </p>\n     * <p>\n     * <code>focalDistance</code> is the distance in meters from the camera to set the camera focus.\n     * </p>\n     * <p>\n     * <code>delta</code>, <code>sigma</code>, and <code>stepSize</code> are the same properties as {@link PostProcessStageLibrary#createBlurStage}.\n     * The blur is applied to the areas out of focus.\n     * </p>\n     * @return {PostProcessStageComposite} A post-process stage that applies a depth of field effect.\n     */\n    PostProcessStageLibrary.createDepthOfFieldStage = function() {\n        var blur = createBlur('czm_depth_of_field_blur');\n        var dof = new PostProcessStage({\n            name : 'czm_depth_of_field_composite',\n            fragmentShader : DepthOfField,\n            uniforms : {\n                focalDistance : 5.0,\n                blurTexture : blur.name\n            }\n        });\n\n        var uniforms = {};\n        Object.defineProperties(uniforms, {\n            focalDistance : {\n                get : function() {\n                    return dof.uniforms.focalDistance;\n                },\n                set : function(value) {\n                    dof.uniforms.focalDistance = value;\n                }\n            },\n            delta : {\n                get : function() {\n                    return blur.uniforms.delta;\n                },\n                set : function(value) {\n                    blur.uniforms.delta = value;\n                }\n            },\n            sigma : {\n                get : function() {\n                    return blur.uniforms.sigma;\n                },\n                set : function(value) {\n                    blur.uniforms.sigma = value;\n                }\n            },\n            stepSize : {\n                get : function() {\n                    return blur.uniforms.stepSize;\n                },\n                set : function(value) {\n                    blur.uniforms.stepSize = value;\n                }\n            }\n        });\n        return new PostProcessStageComposite({\n            name : 'czm_depth_of_field',\n            stages : [blur, dof],\n            inputPreviousStageTexture : false,\n            uniforms : uniforms\n        });\n    };\n\n    /**\n     * Whether or not a depth of field stage is supported.\n     * <p>\n     * This stage requires the WEBGL_depth_texture extension.\n     * </p>\n     *\n     * @param {Scene} scene The scene.\n     * @return {Boolean} Whether this post process stage is supported.\n     *\n     * @see {Context#depthTexture}\n     * @see {@link http://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/|WEBGL_depth_texture}\n     */\n    PostProcessStageLibrary.isDepthOfFieldSupported = function(scene) {\n        return scene.context.depthTexture;\n    };\n\n    /**\n     * Creates a post-process stage that detects edges.\n     * <p>\n     * Writes the color to the output texture with alpha set to 1.0 when it is on an edge.\n     * </p>\n     * <p>\n     * This stage has the following uniforms: <code>color</code> and <code>length</code>\n     * </p>\n     * <ul>\n     * <li><code>color</code> is the color of the highlighted edge. The default is {@link Color#BLACK}.</li>\n     * <li><code>length</code> is the length of the edges in pixels. The default is <code>0.5</code>.</li>\n     * </ul>\n     * <p>\n     * This stage is not supported in 2D.\n     * </p>\n     * @return {PostProcessStageComposite} A post-process stage that applies an edge detection effect.\n     *\n     * @example\n     * // multiple silhouette effects\n     * var yellowEdge = Cesium.PostProcessLibrary.createEdgeDetectionStage();\n     * yellowEdge.uniforms.color = Cesium.Color.YELLOW;\n     * yellowEdge.selected = [feature0];\n     *\n     * var greenEdge = Cesium.PostProcessLibrary.createEdgeDetectionStage();\n     * greenEdge.uniforms.color = Cesium.Color.LIME;\n     * greenEdge.selected = [feature1];\n     *\n     * // draw edges around feature0 and feature1\n     * postProcessStages.add(Cesium.PostProcessLibrary.createSilhouetteEffect([yellowEdge, greenEdge]);\n     */\n    PostProcessStageLibrary.createEdgeDetectionStage = function() {\n        // unique name generated on call so more than one effect can be added\n        var name = createGuid();\n        return new PostProcessStage({\n            name : 'czm_edge_detection_' + name,\n            fragmentShader : EdgeDetection,\n            uniforms : {\n                length : 0.25,\n                color : Color.clone(Color.BLACK)\n            }\n        });\n    };\n\n    /**\n     * Whether or not an edge detection stage is supported.\n     * <p>\n     * This stage requires the WEBGL_depth_texture extension.\n     * </p>\n     *\n     * @param {Scene} scene The scene.\n     * @return {Boolean} Whether this post process stage is supported.\n     *\n     * @see {Context#depthTexture}\n     * @see {@link http://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/|WEBGL_depth_texture}\n     */\n    PostProcessStageLibrary.isEdgeDetectionSupported = function(scene) {\n        return scene.context.depthTexture;\n    };\n\n    function getSilhouetteEdgeDetection(edgeDetectionStages) {\n        if (!defined(edgeDetectionStages)) {\n            return PostProcessStageLibrary.createEdgeDetectionStage();\n        }\n\n        var edgeDetection = new PostProcessStageComposite({\n            name : 'czm_edge_detection_multiple',\n            stages : edgeDetectionStages,\n            inputPreviousStageTexture : false\n        });\n\n        var compositeUniforms = {};\n        var fsDecl = '';\n        var fsLoop = '';\n        for (var i = 0; i < edgeDetectionStages.length; ++i) {\n            fsDecl += 'uniform sampler2D edgeTexture' + i + '; \\n';\n            fsLoop +=\n                '        vec4 edge' + i + ' = texture2D(edgeTexture' + i + ', v_textureCoordinates); \\n' +\n                '        if (edge' + i + '.a > 0.0) \\n' +\n                '        { \\n' +\n                '            color = edge' + i + '; \\n' +\n                '            break; \\n' +\n                '        } \\n';\n            compositeUniforms['edgeTexture' + i] = edgeDetectionStages[i].name;\n        }\n\n        var fs =\n            fsDecl +\n            'varying vec2 v_textureCoordinates; \\n' +\n            'void main() { \\n' +\n            '    vec4 color = vec4(0.0); \\n' +\n            '    for (int i = 0; i < ' + edgeDetectionStages.length + '; i++) \\n' +\n            '    { \\n' +\n            fsLoop +\n            '    } \\n' +\n            '    gl_FragColor = color; \\n' +\n            '} \\n';\n\n        var edgeComposite = new PostProcessStage({\n            name : 'czm_edge_detection_combine',\n            fragmentShader : fs,\n            uniforms : compositeUniforms\n        });\n        return new PostProcessStageComposite({\n            name : 'czm_edge_detection_composite',\n            stages : [edgeDetection, edgeComposite]\n        });\n    }\n\n    /**\n     * Creates a post-process stage that applies a silhouette effect.\n     * <p>\n     * A silhouette effect composites the color from the edge detection pass with input color texture.\n     * </p>\n     * <p>\n     * This stage has the following uniforms when <code>edgeDetectionStages</code> is <code>undefined</code>: <code>color</code> and <code>length</code>\n     * </p>\n     * <p>\n     * <code>color</code> is the color of the highlighted edge. The default is {@link Color#BLACK}.\n     * <code>length</code> is the length of the edges in pixels. The default is <code>0.5</code>.\n     * </p>\n     * @return {PostProcessStageComposite} A post-process stage that applies a silhouette effect.\n     */\n    PostProcessStageLibrary.createSilhouetteStage = function(edgeDetectionStages) {\n        var edgeDetection = getSilhouetteEdgeDetection(edgeDetectionStages);\n        var silhouetteProcess = new PostProcessStage({\n            name : 'czm_silhouette_color_edges',\n            fragmentShader : Silhouette,\n            uniforms : {\n                silhouetteTexture : edgeDetection.name\n            }\n        });\n\n        return new PostProcessStageComposite({\n            name : 'czm_silhouette',\n            stages : [edgeDetection, silhouetteProcess],\n            inputPreviousStageTexture : false,\n            uniforms : edgeDetection.uniforms\n        });\n    };\n\n    /**\n     * Whether or not a silhouette stage is supported.\n     * <p>\n     * This stage requires the WEBGL_depth_texture extension.\n     * </p>\n     *\n     * @param {Scene} scene The scene.\n     * @return {Boolean} Whether this post process stage is supported.\n     *\n     * @see {Context#depthTexture}\n     * @see {@link http://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/|WEBGL_depth_texture}\n     */\n    PostProcessStageLibrary.isSilhouetteSupported = function(scene) {\n        return scene.context.depthTexture;\n    };\n\n    /**\n     * Creates a post-process stage that applies a bloom effect to the input texture.\n     * <p>\n     * A bloom effect adds glow effect, makes bright areas brighter, and dark areas darker.\n     * </p>\n     * <p>\n     * This post-process stage has the following uniforms: <code>contrast</code>, <code>brightness</code>, <code>glowOnly</code>,\n     * <code>delta</code>, <code>sigma</code>, and <code>stepSize</code>.\n     * </p>\n     * <ul>\n     * <li><code>contrast</code> is a scalar value in the range [-255.0, 255.0] and affects the contract of the effect. The default value is <code>128.0</code>.</li>\n     * <li><code>brightness</code> is a scalar value. The input texture RGB value is converted to hue, saturation, and brightness (HSB) then this value is\n     * added to the brightness. The default value is <code>-0.3</code>.</li>\n     * <li><code>glowOnly</code> is a boolean value. When <code>true</code>, only the glow effect will be shown. When <code>false</code>, the glow will be added to the input texture.\n     * The default value is <code>false</code>. This is a debug option for viewing the effects when changing the other uniform values.</li>\n     * </ul>\n     * <p>\n     * <code>delta</code>, <code>sigma</code>, and <code>stepSize</code> are the same properties as {@link PostProcessStageLibrary#createBlurStage}.\n     * </p>\n     * @return {PostProcessStageComposite} A post-process stage to applies a bloom effect.\n     *\n     * @private\n     */\n    PostProcessStageLibrary.createBloomStage = function() {\n        var contrastBias = new PostProcessStage({\n            name : 'czm_bloom_contrast_bias',\n            fragmentShader : ContrastBias,\n            uniforms : {\n                contrast : 128.0,\n                brightness : -0.3\n            }\n        });\n        var blur = createBlur('czm_bloom_blur');\n        var generateComposite = new PostProcessStageComposite({\n            name : 'czm_bloom_contrast_bias_blur',\n            stages : [contrastBias, blur]\n        });\n\n        var bloomComposite = new PostProcessStage({\n            name : 'czm_bloom_generate_composite',\n            fragmentShader : BloomComposite,\n            uniforms : {\n                glowOnly : false,\n                bloomTexture : generateComposite.name\n            }\n        });\n\n        var uniforms = {};\n        Object.defineProperties(uniforms, {\n            glowOnly : {\n                get : function() {\n                    return bloomComposite.uniforms.glowOnly;\n                },\n                set : function(value) {\n                    bloomComposite.uniforms.glowOnly = value;\n                }\n            },\n            contrast : {\n                get : function() {\n                    return contrastBias.uniforms.contrast;\n                },\n                set : function(value) {\n                    contrastBias.uniforms.contrast = value;\n                }\n            },\n            brightness : {\n                get : function() {\n                    return contrastBias.uniforms.brightness;\n                },\n                set : function(value) {\n                    contrastBias.uniforms.brightness = value;\n                }\n            },\n            delta : {\n                get : function() {\n                    return blur.uniforms.delta;\n                },\n                set : function(value) {\n                    blur.uniforms.delta = value;\n                }\n            },\n            sigma : {\n                get : function() {\n                    return blur.uniforms.sigma;\n                },\n                set : function(value) {\n                    blur.uniforms.sigma = value;\n                }\n            },\n            stepSize : {\n                get : function() {\n                    return blur.uniforms.stepSize;\n                },\n                set : function(value) {\n                    blur.uniforms.stepSize = value;\n                }\n            }\n        });\n\n        return new PostProcessStageComposite({\n            name : 'czm_bloom',\n            stages : [generateComposite, bloomComposite],\n            inputPreviousStageTexture : false,\n            uniforms : uniforms\n        });\n    };\n\n    /**\n     * Creates a post-process stage that Horizon-based Ambient Occlusion (HBAO) to the input texture.\n     * <p>\n     * Ambient occlusion simulates shadows from ambient light. These shadows would always be present when the\n     * surface receives light and regardless of the light's position.\n     * </p>\n     * <p>\n     * The uniforms have the following properties: <code>intensity</code>, <code>bias</code>, <code>lengthCap</code>,\n     * <code>stepSize</code>, <code>frustumLength</code>, <code>randomTexture</code>, <code>ambientOcclusionOnly</code>,\n     * <code>delta</code>, <code>sigma</code>, and <code>blurStepSize</code>.\n     * </p>\n     * <ul>\n     * <li><code>intensity</code> is a scalar value used to lighten or darken the shadows exponentially. Higher values make the shadows darker. The default value is <code>3.0</code>.</li>\n     * <li><code>bias</code> is a scalar value representing an angle in radians. If the dot product between the normal of the sample and the vector to the camera is less than this value,\n     * sampling stops in the current direction. This is used to remove shadows from near planar edges. The default value is <code>0.1</code>.</li>\n     * <li><code>lengthCap</code> is a scalar value representing a length in meters. If the distance from the current sample to first sample is greater than this value,\n     * sampling stops in the current direction. The default value is <code>0.26</code>.</li>\n     * <li><code>stepSize</code> is a scalar value indicating the distance to the next texel sample in the current direction. The default value is <code>1.95</code>.</li>\n     * <li><code>frustumLength</code> is a scalar value in meters. If the current fragment has a distance from the camera greater than this value, ambient occlusion is not computed for the fragment.\n     * The default value is <code>1000.0</code>.</li>\n     * <li><code>randomTexture</code> is a texture where the red channel is a random value in [0.0, 1.0]. The default value is <code>undefined</code>. This texture needs to be set.</li>\n     * <li><code>ambientOcclusionOnly</code> is a boolean value. When <code>true</code>, only the shadows generated are written to the output. When <code>false</code>, the input texture is modulated\n     * with the ambient occlusion. This is a useful debug option for seeing the effects of changing the uniform values. The default value is <code>false</code>.</li>\n     * </ul>\n     * <p>\n     * <code>delta</code>, <code>sigma</code>, and <code>blurStepSize</code> are the same properties as {@link PostProcessStageLibrary#createBlurStage}.\n     * The blur is applied to the shadows generated from the image to make them smoother.\n     * </p>\n     * @return {PostProcessStageComposite} A post-process stage that applies an ambient occlusion effect.\n     *\n     * @private\n     */\n    PostProcessStageLibrary.createAmbientOcclusionStage = function() {\n        var generate = new PostProcessStage({\n            name : 'czm_ambient_occlusion_generate',\n            fragmentShader : AmbientOcclusionGenerate,\n            uniforms : {\n                intensity : 3.0,\n                bias : 0.1,\n                lengthCap : 0.26,\n                stepSize : 1.95,\n                frustumLength : 1000.0,\n                randomTexture : undefined\n            }\n        });\n        var blur = createBlur('czm_ambient_occlusion_blur');\n        blur.uniforms.stepSize = 0.86;\n        var generateAndBlur = new PostProcessStageComposite({\n            name : 'czm_ambient_occlusion_generate_blur',\n            stages : [generate, blur]\n        });\n\n        var ambientOcclusionModulate = new PostProcessStage({\n            name : 'czm_ambient_occlusion_composite',\n            fragmentShader : AmbientOcclusionModulate,\n            uniforms : {\n                ambientOcclusionOnly : false,\n                ambientOcclusionTexture : generateAndBlur.name\n            }\n        });\n\n        var uniforms = {};\n        Object.defineProperties(uniforms, {\n            intensity : {\n                get : function() {\n                    return generate.uniforms.intensity;\n                },\n                set : function(value) {\n                    generate.uniforms.intensity = value;\n                }\n            },\n            bias : {\n                get : function() {\n                    return generate.uniforms.bias;\n                },\n                set : function(value) {\n                    generate.uniforms.bias = value;\n                }\n            },\n            lengthCap : {\n                get : function() {\n                    return generate.uniforms.lengthCap;\n                },\n                set : function(value) {\n                    generate.uniforms.lengthCap = value;\n                }\n            },\n            stepSize : {\n                get : function() {\n                    return generate.uniforms.stepSize;\n                },\n                set : function(value) {\n                    generate.uniforms.stepSize = value;\n                }\n            },\n            frustumLength : {\n                get : function() {\n                    return generate.uniforms.frustumLength;\n                },\n                set : function(value) {\n                    generate.uniforms.frustumLength = value;\n                }\n            },\n            randomTexture : {\n                get : function() {\n                    return generate.uniforms.randomTexture;\n                },\n                set : function(value) {\n                    generate.uniforms.randomTexture = value;\n                }\n            },\n            delta : {\n                get : function() {\n                    return blur.uniforms.delta;\n                },\n                set : function(value) {\n                    blur.uniforms.delta = value;\n                }\n            },\n            sigma : {\n                get : function() {\n                    return blur.uniforms.sigma;\n                },\n                set : function(value) {\n                    blur.uniforms.sigma = value;\n                }\n            },\n            blurStepSize : {\n                get : function() {\n                    return blur.uniforms.stepSize;\n                },\n                set : function(value) {\n                    blur.uniforms.stepSize = value;\n                }\n            },\n            ambientOcclusionOnly : {\n                get : function() {\n                    return ambientOcclusionModulate.uniforms.ambientOcclusionOnly;\n                },\n                set : function(value) {\n                    ambientOcclusionModulate.uniforms.ambientOcclusionOnly = value;\n                }\n            }\n        });\n\n        return new PostProcessStageComposite({\n            name : 'czm_ambient_occlusion',\n            stages : [generateAndBlur, ambientOcclusionModulate],\n            inputPreviousStageTexture : false,\n            uniforms : uniforms\n        });\n    };\n\n    /**\n     * Whether or not an ambient occlusion stage is supported.\n     * <p>\n     * This stage requires the WEBGL_depth_texture extension.\n     * </p>\n     *\n     * @param {Scene} scene The scene.\n     * @return {Boolean} Whether this post process stage is supported.\n     *\n     * @see {Context#depthTexture}\n     * @see {@link http://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/|WEBGL_depth_texture}\n     */\n    PostProcessStageLibrary.isAmbientOcclusionSupported = function(scene) {\n        return scene.context.depthTexture;\n    };\n\n    var fxaaFS =\n        '#define FXAA_QUALITY_PRESET 39 \\n' +\n        FXAA3_11 + '\\n' +\n        FXAA;\n\n    /**\n     * Creates a post-process stage that applies Fast Approximate Anti-aliasing (FXAA) to the input texture.\n     * @return {PostProcessStage} A post-process stage that applies Fast Approximate Anti-aliasing to the input texture.\n     *\n     * @private\n     */\n    PostProcessStageLibrary.createFXAAStage = function() {\n        return new PostProcessStage({\n            name : 'czm_FXAA',\n            fragmentShader : fxaaFS,\n            sampleMode : PostProcessStageSampleMode.LINEAR\n        });\n    };\n\n    /**\n     * Creates a post-process stage that applies ACES tonemapping operator.\n     * @param {Boolean} useAutoExposure Whether or not to use auto-exposure.\n     * @return {PostProcessStage} A post-process stage that applies ACES tonemapping operator.\n     * @private\n     */\n    PostProcessStageLibrary.createAcesTonemappingStage = function(useAutoExposure) {\n        var fs = useAutoExposure ? '#define AUTO_EXPOSURE\\n' : '';\n        fs += AcesTonemapping;\n        return new PostProcessStage({\n            name : 'czm_aces',\n            fragmentShader : fs,\n            uniforms : {\n                autoExposure : undefined\n            }\n        });\n    };\n\n    /**\n     * Creates a post-process stage that applies filmic tonemapping operator.\n     * @param {Boolean} useAutoExposure Whether or not to use auto-exposure.\n     * @return {PostProcessStage} A post-process stage that applies filmic tonemapping operator.\n     * @private\n     */\n    PostProcessStageLibrary.createFilmicTonemappingStage = function(useAutoExposure) {\n        var fs = useAutoExposure ? '#define AUTO_EXPOSURE\\n' : '';\n        fs += FilmicTonemapping;\n        return new PostProcessStage({\n            name : 'czm_filmic',\n            fragmentShader : fs,\n            uniforms : {\n                autoExposure : undefined\n            }\n        });\n    };\n\n    /**\n     * Creates a post-process stage that applies Reinhard tonemapping operator.\n     * @param {Boolean} useAutoExposure Whether or not to use auto-exposure.\n     * @return {PostProcessStage} A post-process stage that applies Reinhard tonemapping operator.\n     * @private\n     */\n    PostProcessStageLibrary.createReinhardTonemappingStage = function(useAutoExposure) {\n        var fs = useAutoExposure ? '#define AUTO_EXPOSURE\\n' : '';\n        fs += ReinhardTonemapping;\n        return new PostProcessStage({\n            name : 'czm_reinhard',\n            fragmentShader : fs,\n            uniforms : {\n                autoExposure : undefined\n            }\n        });\n    };\n\n    /**\n     * Creates a post-process stage that applies modified Reinhard tonemapping operator.\n     * @param {Boolean} useAutoExposure Whether or not to use auto-exposure.\n     * @return {PostProcessStage} A post-process stage that applies modified Reinhard tonemapping operator.\n     * @private\n     */\n    PostProcessStageLibrary.createModifiedReinhardTonemappingStage = function(useAutoExposure) {\n        var fs = useAutoExposure ? '#define AUTO_EXPOSURE\\n' : '';\n        fs += ModifiedReinhardTonemapping;\n        return new PostProcessStage({\n            name : 'czm_modified_reinhard',\n            fragmentShader : fs,\n            uniforms : {\n                white : Color.WHITE,\n                autoExposure : undefined\n            }\n        });\n    };\n\n    /**\n     * Creates a post-process stage that finds the average luminance of the input texture.\n     * @return {PostProcessStage} A post-process stage that finds the average luminance of the input texture.\n     * @private\n     */\n    PostProcessStageLibrary.createAutoExposureStage = function() {\n        return new AutoExposure();\n    };\n\n    /**\n     * Creates a post-process stage that renders the input texture with black and white gradations.\n     * <p>\n     * This stage has one uniform value, <code>gradations</code>, which scales the luminance of each pixel.\n     * </p>\n     * @return {PostProcessStage} A post-process stage that renders the input texture with black and white gradations.\n     */\n    PostProcessStageLibrary.createBlackAndWhiteStage = function() {\n        return new PostProcessStage({\n            name : 'czm_black_and_white',\n            fragmentShader : BlackAndWhite,\n            uniforms : {\n                gradations : 5.0\n            }\n        });\n    };\n\n    /**\n     * Creates a post-process stage that saturates the input texture.\n     * <p>\n     * This stage has one uniform value, <code>brightness</code>, which scales the saturation of each pixel.\n     * </p>\n     * @return {PostProcessStage} A post-process stage that saturates the input texture.\n     */\n    PostProcessStageLibrary.createBrightnessStage = function() {\n        return new PostProcessStage({\n            name : 'czm_brightness',\n            fragmentShader : Brightness,\n            uniforms : {\n                brightness : 0.5\n            }\n        });\n    };\n\n    /**\n     * Creates a post-process stage that adds a night vision effect to the input texture.\n     * @return {PostProcessStage} A post-process stage that adds a night vision effect to the input texture.\n     */\n    PostProcessStageLibrary.createNightVisionStage = function() {\n        return new PostProcessStage({\n            name : 'czm_night_vision',\n            fragmentShader : NightVision\n        });\n    };\n\n    /**\n     * Creates a post-process stage that replaces the input color texture with a black and white texture representing the fragment depth at each pixel.\n     * @return {PostProcessStage} A post-process stage that replaces the input color texture with a black and white texture representing the fragment depth at each pixel.\n     *\n     * @private\n     */\n    PostProcessStageLibrary.createDepthViewStage = function() {\n        return new PostProcessStage({\n            name : 'czm_depth_view',\n            fragmentShader : DepthView\n        });\n    };\n\n    /**\n     * Creates a post-process stage that applies an effect simulating light flaring a camera lens.\n     * <p>\n     * This stage has the following uniforms: <code>dirtTexture</code>, <code>starTexture</code>, <code>intensity</code>, <code>distortion</code>, <code>ghostDispersal</code>,\n     * <code>haloWidth</code>, <code>dirtAmount</code>, and <code>earthRadius</code>.\n     * <ul>\n     * <li><code>dirtTexture</code> is a texture sampled to simulate dirt on the lens.</li>\n     * <li><code>starTexture</code> is the texture sampled for the star pattern of the flare.</li>\n     * <li><code>intensity</code> is a scalar multiplied by the result of the lens flare. The default value is <code>2.0</code>.</li>\n     * <li><code>distortion</code> is a scalar value that affects the chromatic effect distortion. The default value is <code>10.0</code>.</li>\n     * <li><code>ghostDispersal</code> is a scalar indicating how far the halo effect is from the center of the texture. The default value is <code>0.4</code>.</li>\n     * <li><code>haloWidth</code> is a scalar representing the width of the halo  from the ghost dispersal. The default value is <code>0.4</code>.</li>\n     * <li><code>dirtAmount</code> is a scalar representing the amount of dirt on the lens. The default value is <code>0.4</code>.</li>\n     * <li><code>earthRadius</code> is the maximum radius of the earth. The default value is <code>Ellipsoid.WGS84.maximumRadius</code>.</li>\n     * </ul>\n     * </p>\n     * @return {PostProcessStage} A post-process stage for applying a lens flare effect.\n     */\n    PostProcessStageLibrary.createLensFlareStage = function() {\n        return new PostProcessStage({\n            name : 'czm_lens_flare',\n            fragmentShader : LensFlare,\n            uniforms : {\n                dirtTexture : require('/home/remy/Calypso/Software/TerriaMap/node_modules/terriajs-cesium/Source/Assets/Textures/LensFlare/DirtMask.jpg'),\n                starTexture : require('/home/remy/Calypso/Software/TerriaMap/node_modules/terriajs-cesium/Source/Assets/Textures/LensFlare/StarBurst.jpg'),\n                intensity : 2.0,\n                distortion : 10.0,\n                ghostDispersal : 0.4,\n                haloWidth : 0.4,\n                dirtAmount : 0.4,\n                earthRadius : Ellipsoid.WGS84.maximumRadius\n            }\n        });\n    };\nexport default PostProcessStageLibrary;\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D colorTexture;\\n\\\nuniform sampler2D blurTexture;\\n\\\nuniform sampler2D depthTexture;\\n\\\nuniform float focalDistance;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nvec4 toEye(vec2 uv, float depth)\\n\\\n{\\n\\\n   vec2 xy = vec2((uv.x * 2.0 - 1.0), ((1.0 - uv.y) * 2.0 - 1.0));\\n\\\n   vec4 posInCamera = czm_inverseProjection * vec4(xy, depth, 1.0);\\n\\\n   posInCamera = posInCamera / posInCamera.w;\\n\\\n   return posInCamera;\\n\\\n}\\n\\\n\\n\\\nfloat computeDepthBlur(float depth)\\n\\\n{\\n\\\n    float f;\\n\\\n    if (depth < focalDistance)\\n\\\n    {\\n\\\n        f = (focalDistance - depth) / (focalDistance - czm_currentFrustum.x);\\n\\\n    }\\n\\\n    else\\n\\\n    {\\n\\\n        f = (depth - focalDistance) / (czm_currentFrustum.y - focalDistance);\\n\\\n        f = pow(f, 0.1);\\n\\\n    }\\n\\\n    f *= f;\\n\\\n    f = clamp(f, 0.0, 1.0);\\n\\\n    return pow(f, 0.5);\\n\\\n}\\n\\\n\\n\\\nvoid main(void)\\n\\\n{\\n\\\n    float depth = czm_readDepth(depthTexture, v_textureCoordinates);\\n\\\n    vec4 posInCamera = toEye(v_textureCoordinates, depth);\\n\\\n    float d = computeDepthBlur(-posInCamera.z);\\n\\\n    gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), texture2D(blurTexture, v_textureCoordinates), d);\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D depthTexture;\\n\\\nuniform float length;\\n\\\nuniform vec4 color;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nvoid main(void)\\n\\\n{\\n\\\n    float directions[3];\\n\\\n    directions[0] = -1.0;\\n\\\n    directions[1] = 0.0;\\n\\\n    directions[2] = 1.0;\\n\\\n\\n\\\n    float scalars[3];\\n\\\n    scalars[0] = 3.0;\\n\\\n    scalars[1] = 10.0;\\n\\\n    scalars[2] = 3.0;\\n\\\n\\n\\\n    float padx = czm_pixelRatio / czm_viewport.z;\\n\\\n    float pady = czm_pixelRatio / czm_viewport.w;\\n\\\n\\n\\\n#ifdef CZM_SELECTED_FEATURE\\n\\\n    bool selected = false;\\n\\\n    for (int i = 0; i < 3; ++i)\\n\\\n    {\\n\\\n        float dir = directions[i];\\n\\\n        selected = selected || czm_selected(vec2(-padx, dir * pady));\\n\\\n        selected = selected || czm_selected(vec2(padx, dir * pady));\\n\\\n        selected = selected || czm_selected(vec2(dir * padx, -pady));\\n\\\n        selected = selected || czm_selected(vec2(dir * padx, pady));\\n\\\n        if (selected)\\n\\\n        {\\n\\\n            break;\\n\\\n        }\\n\\\n    }\\n\\\n    if (!selected)\\n\\\n    {\\n\\\n        gl_FragColor = vec4(color.rgb, 0.0);\\n\\\n        return;\\n\\\n    }\\n\\\n#endif\\n\\\n\\n\\\n    float horizEdge = 0.0;\\n\\\n    float vertEdge = 0.0;\\n\\\n\\n\\\n    for (int i = 0; i < 3; ++i)\\n\\\n    {\\n\\\n        float dir = directions[i];\\n\\\n        float scale = scalars[i];\\n\\\n\\n\\\n        horizEdge -= texture2D(depthTexture, v_textureCoordinates + vec2(-padx, dir * pady)).x * scale;\\n\\\n        horizEdge += texture2D(depthTexture, v_textureCoordinates + vec2(padx, dir * pady)).x * scale;\\n\\\n\\n\\\n        vertEdge -= texture2D(depthTexture, v_textureCoordinates + vec2(dir * padx, -pady)).x * scale;\\n\\\n        vertEdge += texture2D(depthTexture, v_textureCoordinates + vec2(dir * padx, pady)).x * scale;\\n\\\n    }\\n\\\n\\n\\\n    float len = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\\n\\\n    gl_FragColor = vec4(color.rgb, len > length ? color.a : 0.0);\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D colorTexture;\\n\\\nuniform sampler2D silhouetteTexture;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nvoid main(void)\\n\\\n{\\n\\\n    vec4 silhouetteColor = texture2D(silhouetteTexture, v_textureCoordinates);\\n\\\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\\n\\\n    gl_FragColor = mix(color, silhouetteColor, silhouetteColor.a);\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D colorTexture;\\n\\\nuniform float contrast;\\n\\\nuniform float brightness;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nvoid main(void)\\n\\\n{\\n\\\n    vec3 sceneColor = texture2D(colorTexture, v_textureCoordinates).xyz;\\n\\\n    sceneColor = czm_RGBToHSB(sceneColor);\\n\\\n    sceneColor.z += brightness;\\n\\\n    sceneColor = czm_HSBToRGB(sceneColor);\\n\\\n\\n\\\n    float factor = (259.0 * (contrast + 255.0)) / (255.0 * (259.0 - contrast));\\n\\\n    sceneColor = factor * (sceneColor - vec3(0.5)) + vec3(0.5);\\n\\\n    gl_FragColor = vec4(sceneColor, 1.0);\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D colorTexture;\\n\\\nuniform sampler2D bloomTexture;\\n\\\nuniform bool glowOnly;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nvoid main(void)\\n\\\n{\\n\\\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\\n\\\n\\n\\\n#ifdef CZM_SELECTED_FEATURE\\n\\\n    if (czm_selected()) {\\n\\\n        gl_FragColor = color;\\n\\\n        return;\\n\\\n    }\\n\\\n#endif\\n\\\n\\n\\\n    vec4 bloom = texture2D(bloomTexture, v_textureCoordinates);\\n\\\n    gl_FragColor = glowOnly ? bloom : bloom + color;\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D randomTexture;\\n\\\nuniform sampler2D depthTexture;\\n\\\nuniform float intensity;\\n\\\nuniform float bias;\\n\\\nuniform float lengthCap;\\n\\\nuniform float stepSize;\\n\\\nuniform float frustumLength;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nvec4 clipToEye(vec2 uv, float depth)\\n\\\n{\\n\\\n    vec2 xy = vec2((uv.x * 2.0 - 1.0), ((1.0 - uv.y) * 2.0 - 1.0));\\n\\\n    vec4 posEC = czm_inverseProjection * vec4(xy, depth, 1.0);\\n\\\n    posEC = posEC / posEC.w;\\n\\\n    return posEC;\\n\\\n}\\n\\\n\\n\\\n//Reconstruct Normal Without Edge Removation\\n\\\nvec3 getNormalXEdge(vec3 posInCamera, float depthU, float depthD, float depthL, float depthR, vec2 pixelSize)\\n\\\n{\\n\\\n    vec4 posInCameraUp = clipToEye(v_textureCoordinates - vec2(0.0, pixelSize.y), depthU);\\n\\\n    vec4 posInCameraDown = clipToEye(v_textureCoordinates + vec2(0.0, pixelSize.y), depthD);\\n\\\n    vec4 posInCameraLeft = clipToEye(v_textureCoordinates - vec2(pixelSize.x, 0.0), depthL);\\n\\\n    vec4 posInCameraRight = clipToEye(v_textureCoordinates + vec2(pixelSize.x, 0.0), depthR);\\n\\\n\\n\\\n    vec3 up = posInCamera.xyz - posInCameraUp.xyz;\\n\\\n    vec3 down = posInCameraDown.xyz - posInCamera.xyz;\\n\\\n    vec3 left = posInCamera.xyz - posInCameraLeft.xyz;\\n\\\n    vec3 right = posInCameraRight.xyz - posInCamera.xyz;\\n\\\n\\n\\\n    vec3 DX = length(left) < length(right) ? left : right;\\n\\\n    vec3 DY = length(up) < length(down) ? up : down;\\n\\\n\\n\\\n    return normalize(cross(DY, DX));\\n\\\n}\\n\\\n\\n\\\nvoid main(void)\\n\\\n{\\n\\\n    float depth = czm_readDepth(depthTexture, v_textureCoordinates);\\n\\\n    vec4 posInCamera = clipToEye(v_textureCoordinates, depth);\\n\\\n\\n\\\n    if (posInCamera.z > frustumLength)\\n\\\n    {\\n\\\n        gl_FragColor = vec4(1.0);\\n\\\n        return;\\n\\\n    }\\n\\\n\\n\\\n    vec2 pixelSize = czm_pixelRatio / czm_viewport.zw;\\n\\\n    float depthU = czm_readDepth(depthTexture, v_textureCoordinates - vec2(0.0, pixelSize.y));\\n\\\n    float depthD = czm_readDepth(depthTexture, v_textureCoordinates + vec2(0.0, pixelSize.y));\\n\\\n    float depthL = czm_readDepth(depthTexture, v_textureCoordinates - vec2(pixelSize.x, 0.0));\\n\\\n    float depthR = czm_readDepth(depthTexture, v_textureCoordinates + vec2(pixelSize.x, 0.0));\\n\\\n    vec3 normalInCamera = getNormalXEdge(posInCamera.xyz, depthU, depthD, depthL, depthR, pixelSize);\\n\\\n\\n\\\n    float ao = 0.0;\\n\\\n    vec2 sampleDirection = vec2(1.0, 0.0);\\n\\\n    float gapAngle = 90.0 * czm_radiansPerDegree;\\n\\\n\\n\\\n    // RandomNoise\\n\\\n    float randomVal = texture2D(randomTexture, v_textureCoordinates).x;\\n\\\n\\n\\\n    //Loop for each direction\\n\\\n    for (int i = 0; i < 4; i++)\\n\\\n    {\\n\\\n        float newGapAngle = gapAngle * (float(i) + randomVal);\\n\\\n        float cosVal = cos(newGapAngle);\\n\\\n        float sinVal = sin(newGapAngle);\\n\\\n\\n\\\n        //Rotate Sampling Direction\\n\\\n        vec2 rotatedSampleDirection = vec2(cosVal * sampleDirection.x - sinVal * sampleDirection.y, sinVal * sampleDirection.x + cosVal * sampleDirection.y);\\n\\\n        float localAO = 0.0;\\n\\\n        float localStepSize = stepSize;\\n\\\n\\n\\\n        //Loop for each step\\n\\\n        for (int j = 0; j < 6; j++)\\n\\\n        {\\n\\\n            vec2 newCoords = v_textureCoordinates + rotatedSampleDirection * localStepSize * pixelSize;\\n\\\n\\n\\\n            //Exception Handling\\n\\\n            if(newCoords.x > 1.0 || newCoords.y > 1.0 || newCoords.x < 0.0 || newCoords.y < 0.0)\\n\\\n            {\\n\\\n                break;\\n\\\n            }\\n\\\n\\n\\\n            float stepDepthInfo = czm_readDepth(depthTexture, newCoords);\\n\\\n            vec4 stepPosInCamera = clipToEye(newCoords, stepDepthInfo);\\n\\\n            vec3 diffVec = stepPosInCamera.xyz - posInCamera.xyz;\\n\\\n            float len = length(diffVec);\\n\\\n\\n\\\n            if (len > lengthCap)\\n\\\n            {\\n\\\n                break;\\n\\\n            }\\n\\\n\\n\\\n            float dotVal = clamp(dot(normalInCamera, normalize(diffVec)), 0.0, 1.0 );\\n\\\n            float weight = len / lengthCap;\\n\\\n            weight = 1.0 - weight * weight;\\n\\\n\\n\\\n            if (dotVal < bias)\\n\\\n            {\\n\\\n                dotVal = 0.0;\\n\\\n            }\\n\\\n\\n\\\n            localAO = max(localAO, dotVal * weight);\\n\\\n            localStepSize += stepSize;\\n\\\n        }\\n\\\n        ao += localAO;\\n\\\n    }\\n\\\n\\n\\\n    ao /= 4.0;\\n\\\n    ao = 1.0 - clamp(ao, 0.0, 1.0);\\n\\\n    ao = pow(ao, intensity);\\n\\\n    gl_FragColor = vec4(vec3(ao), 1.0);\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D colorTexture;\\n\\\nuniform sampler2D ambientOcclusionTexture;\\n\\\nuniform bool ambientOcclusionOnly;\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nvoid main(void)\\n\\\n{\\n\\\n    vec3 color = texture2D(colorTexture, v_textureCoordinates).rgb;\\n\\\n    vec3 ao = texture2D(ambientOcclusionTexture, v_textureCoordinates).rgb;\\n\\\n    gl_FragColor.rgb = ambientOcclusionOnly ? ao : ao * color;\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D colorTexture;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\n#ifdef AUTO_EXPOSURE\\n\\\nuniform sampler2D autoExposure;\\n\\\n#endif\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\\n\\\n    vec3 color = fragmentColor.rgb;\\n\\\n\\n\\\n#ifdef AUTO_EXPOSURE\\n\\\n    color /= texture2D(autoExposure, vec2(0.5)).r;\\n\\\n#endif\\n\\\n    color = czm_acesTonemapping(color);\\n\\\n    color = czm_inverseGamma(color);\\n\\\n\\n\\\n    gl_FragColor = vec4(color, fragmentColor.a);\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D colorTexture;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\n#ifdef AUTO_EXPOSURE\\n\\\nuniform sampler2D autoExposure;\\n\\\n#endif\\n\\\n\\n\\\n// See slides 142 and 143:\\n\\\n//     http://www.gdcvault.com/play/1012459/Uncharted_2__HDR_Lighting\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\\n\\\n    vec3 color = fragmentColor.rgb;\\n\\\n\\n\\\n#ifdef AUTO_EXPOSURE\\n\\\n    float exposure = texture2D(autoExposure, vec2(0.5)).r;\\n\\\n    color /= exposure;\\n\\\n#endif\\n\\\n\\n\\\n\tconst float A = 0.22; // shoulder strength\\n\\\n\tconst float B = 0.30; // linear strength\\n\\\n\tconst float C = 0.10; // linear angle\\n\\\n\tconst float D = 0.20; // toe strength\\n\\\n\tconst float E = 0.01; // toe numerator\\n\\\n\tconst float F = 0.30; // toe denominator\\n\\\n\\n\\\n\tconst float white = 11.2; // linear white point value\\n\\\n\\n\\\n\tvec3 c = ((color * (A * color + C * B) + D * E) / (color * ( A * color + B) + D * F)) - E / F;\\n\\\n\tfloat w = ((white * (A * white + C * B) + D * E) / (white * ( A * white + B) + D * F)) - E / F;\\n\\\n\\n\\\n\tc = czm_inverseGamma(c / w);\\n\\\n\tgl_FragColor = vec4(c, fragmentColor.a);\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D colorTexture;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\n#ifdef AUTO_EXPOSURE\\n\\\nuniform sampler2D autoExposure;\\n\\\n#endif\\n\\\n\\n\\\n// See equation 3:\\n\\\n//    http://www.cs.utah.edu/~reinhard/cdrom/tonemap.pdf\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\\n\\\n    vec3 color = fragmentColor.rgb;\\n\\\n#ifdef AUTO_EXPOSURE\\n\\\n    float exposure = texture2D(autoExposure, vec2(0.5)).r;\\n\\\n    color /= exposure;\\n\\\n#endif\\n\\\n    color = color / (1.0 + color);\\n\\\n    color = czm_inverseGamma(color);\\n\\\n    gl_FragColor = vec4(color, fragmentColor.a);\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D colorTexture;\\n\\\nuniform vec3 white;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\n#ifdef AUTO_EXPOSURE\\n\\\nuniform sampler2D autoExposure;\\n\\\n#endif\\n\\\n\\n\\\n// See equation 4:\\n\\\n//    http://www.cs.utah.edu/~reinhard/cdrom/tonemap.pdf\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\\n\\\n    vec3 color = fragmentColor.rgb;\\n\\\n#ifdef AUTO_EXPOSURE\\n\\\n    float exposure = texture2D(autoExposure, vec2(0.5)).r;\\n\\\n    color /= exposure;\\n\\\n#endif\\n\\\n    color = (color * (1.0 + color / white)) / (1.0 + color);\\n\\\n    color = czm_inverseGamma(color);\\n\\\n    gl_FragColor = vec4(color, fragmentColor.a);\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D colorTexture;\\n\\\nuniform float gradations;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nvoid main(void)\\n\\\n{\\n\\\n    vec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\\n\\\n#ifdef CZM_SELECTED_FEATURE\\n\\\n    if (czm_selected()) {\\n\\\n        gl_FragColor = vec4(rgb, 1.0);\\n\\\n        return;\\n\\\n    }\\n\\\n#endif\\n\\\n    float luminance = czm_luminance(rgb);\\n\\\n    float darkness = luminance * gradations;\\n\\\n    darkness = (darkness - fract(darkness)) / gradations;\\n\\\n    gl_FragColor = vec4(vec3(darkness), 1.0);\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D colorTexture;\\n\\\nuniform float brightness;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nvoid main(void)\\n\\\n{\\n\\\n    vec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\\n\\\n    vec3 target = vec3(0.0);\\n\\\n    gl_FragColor = vec4(mix(target, rgb, brightness), 1.0);\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D colorTexture;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nfloat rand(vec2 co)\\n\\\n{\\n\\\n    return fract(sin(dot(co.xy ,vec2(12.9898, 78.233))) * 43758.5453);\\n\\\n}\\n\\\n\\n\\\nvoid main(void)\\n\\\n{\\n\\\n    float noiseValue = rand(v_textureCoordinates + sin(czm_frameNumber)) * 0.1;\\n\\\n    vec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\\n\\\n    vec3 green = vec3(0.0, 1.0, 0.0);\\n\\\n    gl_FragColor = vec4((noiseValue + rgb) * green, 1.0);\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D depthTexture;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nvoid main(void)\\n\\\n{\\n\\\n    float depth = czm_readDepth(depthTexture, v_textureCoordinates);\\n\\\n    gl_FragColor = vec4(vec3(depth), 1.0);\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D colorTexture;\\n\\\nuniform sampler2D dirtTexture;\\n\\\nuniform sampler2D starTexture;\\n\\\nuniform vec2 dirtTextureDimensions;\\n\\\nuniform float distortion;\\n\\\nuniform float ghostDispersal;\\n\\\nuniform float haloWidth;\\n\\\nuniform float dirtAmount;\\n\\\nuniform float earthRadius;\\n\\\nuniform float intensity;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\n// whether it is in space or not\\n\\\n// 6500000.0 is empirical value\\n\\\n#define DISTANCE_TO_SPACE 6500000.0\\n\\\n\\n\\\n// return ndc from world coordinate biased earthRadius\\n\\\nvec4 getNDCFromWC(vec3 WC, float earthRadius)\\n\\\n{\\n\\\n    vec4 positionEC = czm_view * vec4(WC, 1.0);\\n\\\n    positionEC = vec4(positionEC.x + earthRadius, positionEC.y, positionEC.z, 1.0);\\n\\\n    vec4 positionWC = czm_eyeToWindowCoordinates(positionEC);\\n\\\n    return czm_viewportOrthographic * vec4(positionWC.xy, -positionWC.z, 1.0);\\n\\\n}\\n\\\n\\n\\\n// Check if current pixel is included Earth\\n\\\n// if then mask it gradually\\n\\\nfloat isInEarth(vec2 texcoord, vec2 sceneSize)\\n\\\n{\\n\\\n    vec2 NDC = texcoord * 2.0 - 1.0;\\n\\\n    vec4 earthPosSC = getNDCFromWC(vec3(0.0), 0.0);\\n\\\n    vec4 earthPosSCEdge = getNDCFromWC(vec3(0.0), earthRadius * 1.5);\\n\\\n    NDC.xy -= earthPosSC.xy;\\n\\\n\\n\\\n    float X = abs(NDC.x) * sceneSize.x;\\n\\\n    float Y = abs(NDC.y) * sceneSize.y;\\n\\\n\\n\\\n    return clamp(0.0, 1.0, max(sqrt(X * X + Y * Y) / max(abs(earthPosSCEdge.x * sceneSize.x), 1.0) - 0.8 , 0.0));\\n\\\n}\\n\\\n\\n\\\n// For Chromatic effect\\n\\\nvec4 textureDistorted(sampler2D tex, vec2 texcoord, vec2 direction, vec3 distortion, bool isSpace)\\n\\\n{\\n\\\n    vec2 sceneSize = czm_viewport.zw;\\n\\\n    vec3 color;\\n\\\n    if(isSpace)\\n\\\n    {\\n\\\n        color.r = isInEarth(texcoord + direction * distortion.r, sceneSize) * texture2D(tex, texcoord + direction * distortion.r).r;\\n\\\n        color.g = isInEarth(texcoord + direction * distortion.g, sceneSize) * texture2D(tex, texcoord + direction * distortion.g).g;\\n\\\n        color.b = isInEarth(texcoord + direction * distortion.b, sceneSize) * texture2D(tex, texcoord + direction * distortion.b).b;\\n\\\n    }\\n\\\n    else\\n\\\n    {\\n\\\n        color.r = texture2D(tex, texcoord + direction * distortion.r).r;\\n\\\n        color.g = texture2D(tex, texcoord + direction * distortion.g).g;\\n\\\n        color.b = texture2D(tex, texcoord + direction * distortion.b).b;\\n\\\n    }\\n\\\n    return vec4(clamp(color, 0.0, 1.0), 0.0);\\n\\\n}\\n\\\n\\n\\\nvoid main(void)\\n\\\n{\\n\\\n    vec4 originalColor = texture2D(colorTexture, v_textureCoordinates);\\n\\\n    vec3 rgb = originalColor.rgb;\\n\\\n    bool isSpace = length(czm_viewerPositionWC.xyz) > DISTANCE_TO_SPACE;\\n\\\n\\n\\\n    // Sun position\\n\\\n    vec4 sunPos = czm_morphTime == 1.0 ? vec4(czm_sunPositionWC, 1.0) : vec4(czm_sunPositionColumbusView.zxy, 1.0);\\n\\\n    vec4 sunPositionEC = czm_view * sunPos;\\n\\\n    vec4 sunPositionWC = czm_eyeToWindowCoordinates(sunPositionEC);\\n\\\n    sunPos = czm_viewportOrthographic * vec4(sunPositionWC.xy, -sunPositionWC.z, 1.0);\\n\\\n\\n\\\n    // If sun is not in the screen space, use original color.\\n\\\n    if(!isSpace || !((sunPos.x >= -1.1 && sunPos.x <= 1.1) && (sunPos.y >= -1.1 && sunPos.y <= 1.1)))\\n\\\n    {\\n\\\n        // Lens flare is disabled when not in space until #5932 is fixed.\\n\\\n        //    https://github.com/CesiumGS/cesium/issues/5932\\n\\\n        gl_FragColor = originalColor;\\n\\\n        return;\\n\\\n    }\\n\\\n\\n\\\n    vec2 texcoord = vec2(1.0) - v_textureCoordinates;\\n\\\n    vec2 pixelSize = czm_pixelRatio / czm_viewport.zw;\\n\\\n    vec2 invPixelSize = 1.0 / pixelSize;\\n\\\n    vec3 distortionVec = pixelSize.x * vec3(-distortion, 0.0, distortion);\\n\\\n\\n\\\n    // ghost vector to image centre:\\n\\\n    vec2 ghostVec = (vec2(0.5) - texcoord) * ghostDispersal;\\n\\\n    vec3 direction = normalize(vec3(ghostVec, 0.0));\\n\\\n\\n\\\n    // sample ghosts:\\n\\\n    vec4 result = vec4(0.0);\\n\\\n    vec4 ghost = vec4(0.0);\\n\\\n    for (int i = 0; i < 4; ++i)\\n\\\n    {\\n\\\n        vec2 offset = fract(texcoord + ghostVec * float(i));\\n\\\n        // Only bright spots from the centre of the source image\\n\\\n        ghost += textureDistorted(colorTexture, offset, direction.xy, distortionVec, isSpace);\\n\\\n    }\\n\\\n    result += ghost;\\n\\\n\\n\\\n    // sample halo\\n\\\n    vec2 haloVec = normalize(ghostVec) * haloWidth;\\n\\\n    float weightForHalo = length(vec2(0.5) - fract(texcoord + haloVec)) / length(vec2(0.5));\\n\\\n    weightForHalo = pow(1.0 - weightForHalo, 5.0);\\n\\\n\\n\\\n    result += textureDistorted(colorTexture, texcoord + haloVec, direction.xy, distortionVec, isSpace) * weightForHalo * 1.5;\\n\\\n\\n\\\n    // dirt on lens\\n\\\n    vec2 dirtTexCoords = (v_textureCoordinates * invPixelSize) / dirtTextureDimensions;\\n\\\n    if (dirtTexCoords.x > 1.0)\\n\\\n    {\\n\\\n        dirtTexCoords.x = mod(floor(dirtTexCoords.x), 2.0) == 1.0 ? 1.0 - fract(dirtTexCoords.x) :  fract(dirtTexCoords.x);\\n\\\n    }\\n\\\n    if (dirtTexCoords.y > 1.0)\\n\\\n    {\\n\\\n        dirtTexCoords.y = mod(floor(dirtTexCoords.y), 2.0) == 1.0 ? 1.0 - fract(dirtTexCoords.y) :  fract(dirtTexCoords.y);\\n\\\n    }\\n\\\n    result += dirtAmount * texture2D(dirtTexture, dirtTexCoords);\\n\\\n\\n\\\n    // Rotating starburst texture's coordinate\\n\\\n    // dot(czm_view[0].xyz, vec3(0.0, 0.0, 1.0)) + dot(czm_view[1].xyz, vec3(0.0, 1.0, 0.0))\\n\\\n    float camrot = czm_view[0].z + czm_view[1].y;\\n\\\n    float cosValue = cos(camrot);\\n\\\n    float sinValue = sin(camrot);\\n\\\n    mat3 rotation = mat3(\\n\\\n        cosValue, -sinValue, 0.0,\\n\\\n        sinValue, cosValue, 0.0,\\n\\\n        0.0, 0.0, 1.0\\n\\\n    );\\n\\\n\\n\\\n    vec3 st1 = vec3(v_textureCoordinates * 2.0 - vec2(1.0), 1.0);\\n\\\n    vec3 st2 = vec3((rotation * st1).xy, 1.0);\\n\\\n    vec3 st3 = st2 * 0.5 + vec3(0.5);\\n\\\n    vec2 lensStarTexcoord = st3.xy;\\n\\\n    float weightForLensFlare = length(vec3(sunPos.xy, 0.0));\\n\\\n    float oneMinusWeightForLensFlare = max(1.0 - weightForLensFlare, 0.0);\\n\\\n\\n\\\n    if (!isSpace)\\n\\\n    {\\n\\\n        result *= oneMinusWeightForLensFlare * intensity * 0.2;\\n\\\n    }\\n\\\n    else\\n\\\n    {\\n\\\n        result *= oneMinusWeightForLensFlare * intensity;\\n\\\n        result *= texture2D(starTexture, lensStarTexcoord) * pow(weightForLensFlare, 1.0) * max((1.0 - length(vec3(st1.xy, 0.0))), 0.0) * 2.0;\\n\\\n    }\\n\\\n\\n\\\n    result += texture2D(colorTexture, v_textureCoordinates);\\n\\\n\\n\\\n    gl_FragColor = result;\\n\\\n}\\n\\\n\";\n","import Color from '../Core/Color.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport CesiumMath from '../Core/Math.js';\nimport ClearCommand from '../Renderer/ClearCommand.js';\nimport Framebuffer from '../Renderer/Framebuffer.js';\nimport Texture from '../Renderer/Texture.js';\n\n    /**\n     * Creates a minimal amount of textures and framebuffers.\n     *\n     * @alias PostProcessStageTextureCache\n     * @constructor\n     *\n     * @param {PostProcessStageCollection} postProcessStageCollection The post process collection.\n     *\n     * @private\n     */\n    function PostProcessStageTextureCache(postProcessStageCollection) {\n        this._collection = postProcessStageCollection;\n\n        this._framebuffers = [];\n        this._stageNameToFramebuffer = {};\n\n        this._width = undefined;\n        this._height = undefined;\n        this._updateDependencies = false;\n    }\n\n    function getLastStageName(stage) {\n        while (defined(stage.length)) {\n            stage = stage.get(stage.length - 1);\n        }\n        return stage.name;\n    }\n\n    function getStageDependencies(collection, context, dependencies, stage, previousName) {\n        if (!stage.enabled || !stage._isSupported(context)) {\n            return previousName;\n        }\n\n        var stageDependencies = dependencies[stage.name] = {};\n        if (defined(previousName)) {\n            var previous = collection.getStageByName(previousName);\n            stageDependencies[getLastStageName(previous)] = true;\n        }\n        var uniforms = stage.uniforms;\n        if (defined(uniforms)) {\n            var uniformNames = Object.getOwnPropertyNames(uniforms);\n            var uniformNamesLength = uniformNames.length;\n            for (var i = 0; i < uniformNamesLength; ++i) {\n                var value = uniforms[uniformNames[i]];\n                if (typeof value === 'string') {\n                    var dependent = collection.getStageByName(value);\n                    if (defined(dependent)) {\n                        stageDependencies[getLastStageName(dependent)] = true;\n                    }\n                }\n            }\n        }\n\n        return stage.name;\n    }\n\n    function getCompositeDependencies(collection, context, dependencies, composite, previousName) {\n        if ((defined(composite.enabled) && !composite.enabled) || (defined(composite._isSupported) && !composite._isSupported(context))) {\n            return previousName;\n        }\n\n        var originalDependency = previousName;\n\n        var inSeries = !defined(composite.inputPreviousStageTexture) || composite.inputPreviousStageTexture;\n        var currentName = previousName;\n        var length = composite.length;\n        for (var i = 0; i < length; ++i) {\n            var stage = composite.get(i);\n            if (defined(stage.length)) {\n                currentName = getCompositeDependencies(collection, context, dependencies, stage, previousName);\n            } else {\n                currentName = getStageDependencies(collection, context, dependencies, stage, previousName);\n            }\n            // Stages in a series only depend on the previous stage\n            if (inSeries) {\n                previousName = currentName;\n            }\n        }\n\n        // Stages not in a series depend on every stage executed before it since it could reference it as a uniform.\n        // This prevents looking at the dependencies of each stage in the composite, but might create more framebuffers than necessary.\n        // In practice, there are only 2-3 stages in these composites.\n        var j;\n        var name;\n        if (!inSeries) {\n            for (j = 1; j < length; ++j) {\n                name = getLastStageName(composite.get(j));\n                var currentDependencies = dependencies[name];\n                for (var k = 0; k < j; ++k) {\n                    currentDependencies[getLastStageName(composite.get(k))] = true;\n                }\n            }\n        } else {\n            for (j = 1; j < length; ++j) {\n                name = getLastStageName(composite.get(j));\n                if (!defined(dependencies[name])) {\n                    dependencies[name] = {};\n                }\n                dependencies[name][originalDependency] = true;\n            }\n        }\n\n        return currentName;\n    }\n\n    function getDependencies(collection, context) {\n        var dependencies = {};\n\n        if (defined(collection.ambientOcclusion)) {\n            var ao = collection.ambientOcclusion;\n            var bloom = collection.bloom;\n            var tonemapping = collection._tonemapping;\n            var fxaa = collection.fxaa;\n\n            var previousName = getCompositeDependencies(collection, context, dependencies, ao, undefined);\n            previousName = getCompositeDependencies(collection, context, dependencies, bloom, previousName);\n            previousName = getStageDependencies(collection, context, dependencies, tonemapping, previousName);\n            previousName = getCompositeDependencies(collection, context, dependencies, collection, previousName);\n            getStageDependencies(collection, context, dependencies, fxaa, previousName);\n        } else {\n            getCompositeDependencies(collection, context, dependencies, collection, undefined);\n        }\n\n        return dependencies;\n    }\n\n    function getFramebuffer(cache, stageName, dependencies) {\n        var collection = cache._collection;\n        var stage = collection.getStageByName(stageName);\n\n        var textureScale = stage._textureScale;\n        var forcePowerOfTwo = stage._forcePowerOfTwo;\n        var pixelFormat = stage._pixelFormat;\n        var pixelDatatype = stage._pixelDatatype;\n        var clearColor = stage._clearColor;\n\n        var i;\n        var framebuffer;\n        var framebuffers = cache._framebuffers;\n        var length = framebuffers.length;\n        for (i = 0; i < length; ++i) {\n            framebuffer = framebuffers[i];\n\n            if (textureScale !== framebuffer.textureScale || forcePowerOfTwo !== framebuffer.forcePowerOfTwo ||\n                pixelFormat !== framebuffer.pixelFormat || pixelDatatype !== framebuffer.pixelDatatype ||\n                !Color.equals(clearColor, framebuffer.clearColor)) {\n                continue;\n            }\n\n            var stageNames = framebuffer.stages;\n            var stagesLength = stageNames.length;\n            var foundConflict = false;\n            for (var j = 0; j < stagesLength; ++j) {\n                if (dependencies[stageNames[j]]) {\n                    foundConflict = true;\n                    break;\n                }\n            }\n\n            if (!foundConflict) {\n                break;\n            }\n        }\n\n        if (defined(framebuffer) && i < length) {\n            framebuffer.stages.push(stageName);\n            return framebuffer;\n        }\n\n        framebuffer = {\n            textureScale : textureScale,\n            forcePowerOfTwo : forcePowerOfTwo,\n            pixelFormat : pixelFormat,\n            pixelDatatype : pixelDatatype,\n            clearColor : clearColor,\n            stages : [stageName],\n            buffer : undefined,\n            clear : undefined\n        };\n\n        framebuffers.push(framebuffer);\n        return framebuffer;\n    }\n\n    function createFramebuffers(cache, context) {\n        var dependencies = getDependencies(cache._collection, context);\n        for (var stageName in dependencies) {\n            if (dependencies.hasOwnProperty(stageName)) {\n                cache._stageNameToFramebuffer[stageName] = getFramebuffer(cache, stageName, dependencies[stageName]);\n            }\n        }\n    }\n\n    function releaseResources(cache) {\n        var framebuffers = cache._framebuffers;\n        var length = framebuffers.length;\n        for (var i = 0; i < length; ++i) {\n            var framebuffer = framebuffers[i];\n            framebuffer.buffer = framebuffer.buffer && framebuffer.buffer.destroy();\n            framebuffer.buffer = undefined;\n        }\n    }\n\n    function updateFramebuffers(cache, context) {\n        var width = cache._width;\n        var height = cache._height;\n\n        var framebuffers = cache._framebuffers;\n        var length = framebuffers.length;\n        for (var i = 0; i < length; ++i) {\n            var framebuffer = framebuffers[i];\n\n            var scale = framebuffer.textureScale;\n            var textureWidth = Math.ceil(width * scale);\n            var textureHeight = Math.ceil(height * scale);\n\n            var size = Math.min(textureWidth, textureHeight);\n            if (framebuffer.forcePowerOfTwo) {\n                if (!CesiumMath.isPowerOfTwo(size)) {\n                    size = CesiumMath.nextPowerOfTwo(size);\n                }\n                textureWidth = size;\n                textureHeight = size;\n            }\n\n            framebuffer.buffer = new Framebuffer({\n                context : context,\n                colorTextures : [new Texture({\n                    context : context,\n                    width : textureWidth,\n                    height : textureHeight,\n                    pixelFormat : framebuffer.pixelFormat,\n                    pixelDatatype : framebuffer.pixelDatatype\n                })]\n            });\n            framebuffer.clear = new ClearCommand({\n                color : framebuffer.clearColor,\n                framebuffer : framebuffer.buffer\n            });\n        }\n    }\n\n    PostProcessStageTextureCache.prototype.updateDependencies = function() {\n        this._updateDependencies = true;\n    };\n\n    /**\n     * Called before the stages in the collection are executed. Creates the minimum amount of framebuffers for a post-process collection.\n     *\n     * @param {Context} context The context.\n     */\n    PostProcessStageTextureCache.prototype.update = function(context) {\n        var collection = this._collection;\n        var updateDependencies = this._updateDependencies;\n        var aoEnabled = defined(collection.ambientOcclusion) && collection.ambientOcclusion.enabled && collection.ambientOcclusion._isSupported(context);\n        var bloomEnabled = defined(collection.bloom) && collection.bloom.enabled && collection.bloom._isSupported(context);\n        var tonemappingEnabled = defined(collection._tonemapping) && collection._tonemapping.enabled && collection._tonemapping._isSupported(context);\n        var fxaaEnabled = defined(collection.fxaa) && collection.fxaa.enabled && collection.fxaa._isSupported(context);\n        var needsCheckDimensionsUpdate = !defined(collection._activeStages) || collection._activeStages.length > 0 || aoEnabled || bloomEnabled || tonemappingEnabled || fxaaEnabled;\n        if (updateDependencies || (!needsCheckDimensionsUpdate && this._framebuffers.length > 0)) {\n            releaseResources(this);\n            this._framebuffers.length = 0;\n            this._stageNameToFramebuffer = {};\n            this._width = undefined;\n            this._height = undefined;\n        }\n\n        if (!updateDependencies && !needsCheckDimensionsUpdate) {\n            return;\n        }\n\n        if (this._framebuffers.length === 0) {\n            createFramebuffers(this, context);\n        }\n\n        var width = context.drawingBufferWidth;\n        var height = context.drawingBufferHeight;\n        var dimensionsChanged = this._width !== width || this._height !== height;\n        if (!updateDependencies && !dimensionsChanged) {\n            return;\n        }\n\n        this._width = width;\n        this._height = height;\n        this._updateDependencies = false;\n        releaseResources(this);\n        updateFramebuffers(this, context);\n    };\n\n    /**\n     * Clears all of the framebuffers.\n     *\n     * @param {Context} context The context.\n     */\n    PostProcessStageTextureCache.prototype.clear = function(context) {\n        var framebuffers = this._framebuffers;\n        for (var i = 0; i < framebuffers.length; ++i) {\n            framebuffers[i].clear.execute(context);\n        }\n    };\n\n    /**\n     * Gets the stage with the given name.\n     * @param {String} name The name of the stage.\n     * @return {PostProcessStage|PostProcessStageComposite}\n     */\n    PostProcessStageTextureCache.prototype.getStageByName = function(name) {\n        return this._collection.getStageByName(name);\n    };\n\n    /**\n     * Gets the output texture for a stage with the given name.\n     * @param {String} name The name of the stage.\n     * @return {Texture|undefined} The output texture of the stage with the given name.\n     */\n    PostProcessStageTextureCache.prototype.getOutputTexture = function(name) {\n        return this._collection.getOutputTexture(name);\n    };\n\n    /**\n     * Gets the framebuffer for a stage with the given name.\n     *\n     * @param {String} name The name of the stage.\n     * @return {Framebuffer|undefined} The framebuffer for the stage with the given name.\n     */\n    PostProcessStageTextureCache.prototype.getFramebuffer = function(name) {\n        var framebuffer = this._stageNameToFramebuffer[name];\n        if (!defined(framebuffer)) {\n            return undefined;\n        }\n        return framebuffer.buffer;\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <p>\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     * </p>\n     *\n     * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n     *\n     * @see PostProcessStageTextureCache#destroy\n     */\n    PostProcessStageTextureCache.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n     * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n     * <p>\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     * </p>\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     * @see PostProcessStageTextureCache#isDestroyed\n     */\n    PostProcessStageTextureCache.prototype.destroy = function() {\n        releaseResources(this);\n        return destroyObject(this);\n    };\nexport default PostProcessStageTextureCache;\n","\n    /**\n     * A tonemapping algorithm when rendering with high dynamic range.\n     *\n     * @exports Tonemapper\n     * @private\n     */\n    var Tonemapper = {\n        /**\n         * Use the Reinhard tonemapping operator.\n         *\n         * @type {Number}\n         * @constant\n         */\n        REINHARD : 0,\n\n        /**\n         * Use the modified Reinhard tonemapping operator.\n         *\n         * @type {Number}\n         * @constant\n         */\n        MODIFIED_REINHARD : 1,\n\n        /**\n         * Use the Filmic tonemapping operator.\n         *\n         * @type {Number}\n         * @constant\n         */\n        FILMIC : 2,\n\n        /**\n         * Use the ACES tonemapping operator.\n         *\n         * @type {Number}\n         * @constant\n         */\n        ACES : 3,\n\n        /**\n         * @private\n         */\n        validate : function(tonemapper) {\n            return tonemapper === Tonemapper.REINHARD ||\n                   tonemapper === Tonemapper.MODIFIED_REINHARD ||\n                   tonemapper === Tonemapper.FILMIC ||\n                   tonemapper === Tonemapper.ACES;\n        }\n    };\nexport default Object.freeze(Tonemapper);\n","import arraySlice from '../Core/arraySlice.js';\nimport Check from '../Core/Check.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport PixelFormat from '../Core/PixelFormat.js';\nimport PixelDatatype from '../Renderer/PixelDatatype.js';\nimport Sampler from '../Renderer/Sampler.js';\nimport Texture from '../Renderer/Texture.js';\nimport TextureMagnificationFilter from '../Renderer/TextureMagnificationFilter.js';\nimport TextureMinificationFilter from '../Renderer/TextureMinificationFilter.js';\nimport TextureWrap from '../Renderer/TextureWrap.js';\nimport PassThrough from '../Shaders/PostProcessStages/PassThrough.js';\nimport PostProcessStageLibrary from './PostProcessStageLibrary.js';\nimport PostProcessStageTextureCache from './PostProcessStageTextureCache.js';\nimport Tonemapper from './Tonemapper.js';\n\n    var stackScratch = [];\n\n    /**\n     * A collection of {@link PostProcessStage}s and/or {@link PostProcessStageComposite}s.\n     * <p>\n     * The input texture for each post-process stage is the texture rendered to by the scene or the texture rendered\n     * to by the previous stage in the collection.\n     * </p>\n     * <p>\n     * If the ambient occlusion or bloom stages are enabled, they will execute before all other stages.\n     * </p>\n     * <p>\n     * If the FXAA stage is enabled, it will execute after all other stages.\n     * </p>\n     *\n     * @alias PostProcessStageCollection\n     * @constructor\n     */\n    function PostProcessStageCollection() {\n        var fxaa = PostProcessStageLibrary.createFXAAStage();\n        var ao = PostProcessStageLibrary.createAmbientOcclusionStage();\n        var bloom = PostProcessStageLibrary.createBloomStage();\n\n        // Auto-exposure is currently disabled because most shaders output a value in [0.0, 1.0].\n        // Some shaders, such as the atmosphere and ground atmosphere, output values slightly over 1.0.\n        this._autoExposureEnabled = false;\n        this._autoExposure = PostProcessStageLibrary.createAutoExposureStage();\n        this._tonemapping = undefined;\n        this._tonemapper = undefined;\n\n        // set tonemapper and tonemapping\n        this.tonemapper = Tonemapper.ACES;\n\n        var tonemapping = this._tonemapping;\n\n        fxaa.enabled = false;\n        ao.enabled = false;\n        bloom.enabled = false;\n        tonemapping.enabled = false; // will be enabled if necessary in update\n\n        var textureCache = new PostProcessStageTextureCache(this);\n\n        var stageNames = {};\n        var stack = stackScratch;\n        stack.push(fxaa, ao, bloom, tonemapping);\n        while (stack.length > 0) {\n            var stage = stack.pop();\n            stageNames[stage.name] = stage;\n            stage._textureCache = textureCache;\n\n            var length = stage.length;\n            if (defined(length)) {\n                for (var i = 0; i < length; ++i) {\n                    stack.push(stage.get(i));\n                }\n            }\n        }\n\n        this._stages = [];\n        this._activeStages = [];\n        this._previousActiveStages = [];\n\n        this._randomTexture = undefined; // For AO\n\n        var that = this;\n        ao.uniforms.randomTexture = function() {\n            return that._randomTexture;\n        };\n\n        this._ao = ao;\n        this._bloom = bloom;\n        this._fxaa = fxaa;\n\n        this._lastLength = undefined;\n        this._aoEnabled = undefined;\n        this._bloomEnabled = undefined;\n        this._tonemappingEnabled = undefined;\n        this._fxaaEnabled = undefined;\n\n        this._stagesRemoved = false;\n        this._textureCacheDirty = false;\n\n        this._stageNames = stageNames;\n        this._textureCache = textureCache;\n    }\n\n    Object.defineProperties(PostProcessStageCollection.prototype, {\n        /**\n         * Determines if all of the post-process stages in the collection are ready to be executed.\n         *\n         * @memberof PostProcessStageCollection.prototype\n         * @type {Boolean}\n         * @readonly\n         */\n        ready : {\n            get : function() {\n                var readyAndEnabled = false;\n                var stages = this._stages;\n                var length = stages.length;\n                for (var i = length - 1; i >= 0; --i) {\n                    var stage = stages[i];\n                    readyAndEnabled = readyAndEnabled || (stage.ready && stage.enabled);\n                }\n\n                var fxaa = this._fxaa;\n                var ao = this._ao;\n                var bloom = this._bloom;\n                var tonemapping = this._tonemapping;\n\n                readyAndEnabled = readyAndEnabled || (fxaa.ready && fxaa.enabled);\n                readyAndEnabled = readyAndEnabled || (ao.ready && ao.enabled);\n                readyAndEnabled = readyAndEnabled || (bloom.ready && bloom.enabled);\n                readyAndEnabled = readyAndEnabled || (tonemapping.ready && tonemapping.enabled);\n\n                return readyAndEnabled;\n            }\n        },\n        /**\n         * A post-process stage for Fast Approximate Anti-aliasing.\n         * <p>\n         * When enabled, this stage will execute after all others.\n         * </p>\n         *\n         * @memberof PostProcessStageCollection.prototype\n         * @type {PostProcessStage}\n         * @readonly\n         */\n        fxaa : {\n            get : function() {\n                return this._fxaa;\n            }\n        },\n        /**\n         * A post-process stage that applies Horizon-based Ambient Occlusion (HBAO) to the input texture.\n         * <p>\n         * Ambient occlusion simulates shadows from ambient light. These shadows would always be present when the\n         * surface receives light and regardless of the light's position.\n         * </p>\n         * <p>\n         * The uniforms have the following properties: <code>intensity</code>, <code>bias</code>, <code>lengthCap</code>,\n         * <code>stepSize</code>, <code>frustumLength</code>, <code>ambientOcclusionOnly</code>,\n         * <code>delta</code>, <code>sigma</code>, and <code>blurStepSize</code>.\n         * </p>\n         * <ul>\n         * <li><code>intensity</code> is a scalar value used to lighten or darken the shadows exponentially. Higher values make the shadows darker. The default value is <code>3.0</code>.</li>\n         *\n         * <li><code>bias</code> is a scalar value representing an angle in radians. If the dot product between the normal of the sample and the vector to the camera is less than this value,\n         * sampling stops in the current direction. This is used to remove shadows from near planar edges. The default value is <code>0.1</code>.</li>\n         *\n         * <li><code>lengthCap</code> is a scalar value representing a length in meters. If the distance from the current sample to first sample is greater than this value,\n         * sampling stops in the current direction. The default value is <code>0.26</code>.</li>\n         *\n         * <li><code>stepSize</code> is a scalar value indicating the distance to the next texel sample in the current direction. The default value is <code>1.95</code>.</li>\n         *\n         * <li><code>frustumLength</code> is a scalar value in meters. If the current fragment has a distance from the camera greater than this value, ambient occlusion is not computed for the fragment.\n         * The default value is <code>1000.0</code>.</li>\n         *\n         * <li><code>ambientOcclusionOnly</code> is a boolean value. When <code>true</code>, only the shadows generated are written to the output. When <code>false</code>, the input texture is modulated\n         * with the ambient occlusion. This is a useful debug option for seeing the effects of changing the uniform values. The default value is <code>false</code>.</li>\n         * </ul>\n         * <p>\n         * <code>delta</code>, <code>sigma</code>, and <code>blurStepSize</code> are the same properties as {@link PostProcessStageLibrary#createBlurStage}.\n         * The blur is applied to the shadows generated from the image to make them smoother.\n         * </p>\n         * <p>\n         * When enabled, this stage will execute before all others.\n         * </p>\n         *\n         * @memberof PostProcessStageCollection.prototype\n         * @type {PostProcessStageComposite}\n         * @readonly\n         */\n        ambientOcclusion : {\n            get : function() {\n                return this._ao;\n            }\n        },\n        /**\n         * A post-process stage for a bloom effect.\n         * <p>\n         * A bloom effect adds glow effect, makes bright areas brighter, and dark areas darker.\n         * </p>\n         * <p>\n         * This stage has the following uniforms: <code>contrast</code>, <code>brightness</code>, <code>glowOnly</code>,\n         * <code>delta</code>, <code>sigma</code>, and <code>stepSize</code>.\n         * </p>\n         * <ul>\n         * <li><code>contrast</code> is a scalar value in the range [-255.0, 255.0] and affects the contract of the effect. The default value is <code>128.0</code>.</li>\n         *\n         * <li><code>brightness</code> is a scalar value. The input texture RGB value is converted to hue, saturation, and brightness (HSB) then this value is\n         * added to the brightness. The default value is <code>-0.3</code>.</li>\n         *\n         * <li><code>glowOnly</code> is a boolean value. When <code>true</code>, only the glow effect will be shown. When <code>false</code>, the glow will be added to the input texture.\n         * The default value is <code>false</code>. This is a debug option for viewing the effects when changing the other uniform values.</li>\n         * </ul>\n         * <p>\n         * <code>delta</code>, <code>sigma</code>, and <code>stepSize</code> are the same properties as {@link PostProcessStageLibrary#createBlurStage}.\n         * The blur is applied to the shadows generated from the image to make them smoother.\n         * </p>\n         * <p>\n         * When enabled, this stage will execute before all others.\n         * </p>\n         *\n         * @memberOf PostProcessStageCollection.prototype\n         * @type {PostProcessStageComposite}\n         * @readonly\n         */\n        bloom : {\n            get : function() {\n                return this._bloom;\n            }\n        },\n        /**\n         * The number of post-process stages in this collection.\n         *\n         * @memberof PostProcessStageCollection.prototype\n         * @type {Number}\n         * @readonly\n         */\n        length : {\n            get : function() {\n                removeStages(this);\n                return this._stages.length;\n            }\n        },\n        /**\n         * A reference to the last texture written to when executing the post-process stages in this collection.\n         *\n         * @memberof PostProcessStageCollection.prototype\n         * @type {Texture}\n         * @readonly\n         * @private\n         */\n        outputTexture : {\n            get : function() {\n                var fxaa = this._fxaa;\n                if (fxaa.enabled && fxaa.ready) {\n                    return this.getOutputTexture(fxaa.name);\n                }\n\n                var stages = this._stages;\n                var length = stages.length;\n                for (var i = length - 1; i >= 0; --i) {\n                    var stage = stages[i];\n                    if (defined(stage) && stage.ready && stage.enabled) {\n                        return this.getOutputTexture(stage.name);\n                    }\n                }\n\n                var tonemapping = this._tonemapping;\n                if (tonemapping.enabled && tonemapping.ready) {\n                    return this.getOutputTexture(tonemapping.name);\n                }\n\n                var bloom = this._bloom;\n                if (bloom.enabled && bloom.ready) {\n                    return this.getOutputTexture(bloom.name);\n                }\n\n                var ao = this._ao;\n                if (ao.enabled && ao.ready) {\n                    return this.getOutputTexture(ao.name);\n                }\n\n                return undefined;\n            }\n        },\n        /**\n         * Whether the collection has a stage that has selected features.\n         *\n         * @memberof PostProcessStageCollection.prototype\n         * @type {Boolean}\n         * @readonly\n         * @private\n         */\n        hasSelected : {\n            get : function() {\n                var stages = arraySlice(this._stages);\n                while (stages.length > 0) {\n                    var stage = stages.pop();\n                    if (!defined(stage)) {\n                        continue;\n                    }\n                    if (defined(stage.selected)) {\n                        return true;\n                    }\n                    var length = stage.length;\n                    if (defined(length)) {\n                        for (var i = 0; i < length; ++i) {\n                            stages.push(stage.get(i));\n                        }\n                    }\n                }\n                return false;\n            }\n        },\n        /**\n         * Gets and sets the tonemapping algorithm used when rendering with high dynamic range.\n         *\n         * @memberof PostProcessStageCollection.prototype\n         * @type {Tonemapper}\n         * @private\n         */\n        tonemapper : {\n            get : function() {\n                return this._tonemapper;\n            },\n            set : function(value) {\n                if (this._tonemapper === value) {\n                    return;\n                }\n                \n\n                if (defined(this._tonemapping)) {\n                    delete this._stageNames[this._tonemapping.name];\n                    this._tonemapping.destroy();\n                }\n\n                var useAutoExposure = this._autoExposureEnabled;\n                var tonemapper;\n\n                switch(value) {\n                    case Tonemapper.REINHARD:\n                        tonemapper = PostProcessStageLibrary.createReinhardTonemappingStage(useAutoExposure);\n                        break;\n                    case Tonemapper.MODIFIED_REINHARD:\n                        tonemapper = PostProcessStageLibrary.createModifiedReinhardTonemappingStage(useAutoExposure);\n                        break;\n                    case Tonemapper.FILMIC:\n                        tonemapper = PostProcessStageLibrary.createFilmicTonemappingStage(useAutoExposure);\n                        break;\n                    default:\n                        tonemapper = PostProcessStageLibrary.createAcesTonemappingStage(useAutoExposure);\n                        break;\n                }\n\n                if (useAutoExposure) {\n                    var autoexposure = this._autoExposure;\n                    tonemapper.uniforms.autoExposure = function() {\n                        return autoexposure.outputTexture;\n                    };\n                }\n\n                this._tonemapper = value;\n                this._tonemapping = tonemapper;\n\n                if (defined(this._stageNames)) {\n                    this._stageNames[tonemapper.name] = tonemapper;\n                    tonemapper._textureCache = this._textureCache;\n                }\n\n                this._textureCacheDirty = true;\n            }\n        }\n    });\n\n    function removeStages(collection) {\n        if (!collection._stagesRemoved) {\n            return;\n        }\n\n        collection._stagesRemoved = false;\n\n        var newStages = [];\n        var stages = collection._stages;\n        var length = stages.length;\n        for (var i = 0, j = 0; i < length; ++i) {\n            var stage = stages[i];\n            if (stage) {\n                stage._index = j++;\n                newStages.push(stage);\n            }\n        }\n\n        collection._stages = newStages;\n    }\n\n    /**\n     * Adds the post-process stage to the collection.\n     *\n     * @param {PostProcessStage|PostProcessStageComposite} stage The post-process stage to add to the collection.\n     * @return {PostProcessStage|PostProcessStageComposite} The post-process stage that was added to the collection.\n     *\n     * @exception {DeveloperError} The post-process stage has already been added to the collection or does not have a unique name.\n     */\n    PostProcessStageCollection.prototype.add = function(stage) {\n        \n\n        var stageNames = this._stageNames;\n\n        var stack = stackScratch;\n        stack.push(stage);\n        while (stack.length > 0) {\n            var currentStage = stack.pop();\n            \n            stageNames[currentStage.name] = currentStage;\n            currentStage._textureCache = this._textureCache;\n\n            var length = currentStage.length;\n            if (defined(length)) {\n                for (var i = 0; i < length; ++i) {\n                    stack.push(currentStage.get(i));\n                }\n            }\n        }\n\n        var stages = this._stages;\n        stage._index = stages.length;\n        stages.push(stage);\n        this._textureCacheDirty = true;\n        return stage;\n    };\n\n    /**\n     * Removes a post-process stage from the collection and destroys it.\n     *\n     * @param {PostProcessStage|PostProcessStageComposite} stage The post-process stage to remove from the collection.\n     * @return {Boolean} Whether the post-process stage was removed.\n     */\n    PostProcessStageCollection.prototype.remove = function(stage) {\n        if (!this.contains(stage)) {\n            return false;\n        }\n\n        var stageNames = this._stageNames;\n\n        var stack = stackScratch;\n        stack.push(stage);\n        while (stack.length > 0) {\n            var currentStage = stack.pop();\n            delete stageNames[currentStage.name];\n\n            var length = currentStage.length;\n            if (defined(length)) {\n                for (var i = 0; i < length; ++i) {\n                    stack.push(currentStage.get(i));\n                }\n            }\n        }\n\n        this._stages[stage._index] = undefined;\n        this._stagesRemoved = true;\n        this._textureCacheDirty = true;\n        stage._index = undefined;\n        stage._textureCache = undefined;\n        stage.destroy();\n        return true;\n    };\n\n    /**\n     * Returns whether the collection contains a post-process stage.\n     *\n     * @param {PostProcessStage|PostProcessStageComposite} stage The post-process stage.\n     * @return {Boolean} Whether the collection contains the post-process stage.\n     */\n    PostProcessStageCollection.prototype.contains = function(stage) {\n        return defined(stage) && defined(stage._index) && stage._textureCache === this._textureCache;\n    };\n\n    /**\n     * Gets the post-process stage at <code>index</code>.\n     *\n     * @param {Number} index The index of the post-process stage.\n     * @return {PostProcessStage|PostProcessStageComposite} The post-process stage at index.\n     */\n    PostProcessStageCollection.prototype.get = function(index) {\n        removeStages(this);\n        var stages = this._stages;\n        \n        return stages[index];\n    };\n\n    /**\n     * Removes all post-process stages from the collection and destroys them.\n     */\n    PostProcessStageCollection.prototype.removeAll = function() {\n        var stages = this._stages;\n        var length = stages.length;\n        for (var i = 0; i < length; ++i) {\n            this.remove(stages[i]);\n        }\n        stages.length = 0;\n    };\n\n    /**\n     * Gets a post-process stage in the collection by its name.\n     *\n     * @param {String} name The name of the post-process stage.\n     * @return {PostProcessStage|PostProcessStageComposite} The post-process stage.\n     *\n     * @private\n     */\n    PostProcessStageCollection.prototype.getStageByName = function(name) {\n        return this._stageNames[name];\n    };\n\n    /**\n     * Called before the post-process stages in the collection are executed. Calls update for each stage and creates WebGL resources.\n     *\n     * @param {Context} context The context.\n     * @param {Boolean} useLogDepth Whether the scene uses a logarithmic depth buffer.\n     *\n     * @private\n     */\n    PostProcessStageCollection.prototype.update = function(context, useLogDepth, useHdr) {\n        removeStages(this);\n\n        var previousActiveStages = this._activeStages;\n        var activeStages = this._activeStages = this._previousActiveStages;\n        this._previousActiveStages = previousActiveStages;\n\n        var stages = this._stages;\n        var length = activeStages.length = stages.length;\n\n        var i;\n        var stage;\n        var count = 0;\n        for (i = 0; i < length; ++i) {\n            stage = stages[i];\n            if (stage.ready && stage.enabled && stage._isSupported(context)) {\n                activeStages[count++] = stage;\n            }\n        }\n        activeStages.length = count;\n\n        var activeStagesChanged = count !== previousActiveStages.length;\n        if (!activeStagesChanged) {\n            for (i = 0; i < count; ++i) {\n                if (activeStages[i] !== previousActiveStages[i]) {\n                    activeStagesChanged = true;\n                    break;\n                }\n            }\n        }\n\n        var ao = this._ao;\n        var bloom = this._bloom;\n        var autoexposure = this._autoExposure;\n        var tonemapping = this._tonemapping;\n        var fxaa = this._fxaa;\n\n        tonemapping.enabled = useHdr;\n\n        var aoEnabled = ao.enabled && ao._isSupported(context);\n        var bloomEnabled = bloom.enabled && bloom._isSupported(context);\n        var tonemappingEnabled = tonemapping.enabled && tonemapping._isSupported(context);\n        var fxaaEnabled = fxaa.enabled && fxaa._isSupported(context);\n\n        if (activeStagesChanged || this._textureCacheDirty || count !== this._lastLength || aoEnabled !== this._aoEnabled ||\n            bloomEnabled !== this._bloomEnabled || tonemappingEnabled !== this._tonemappingEnabled || fxaaEnabled !== this._fxaaEnabled) {\n            // The number of stages to execute has changed.\n            // Update dependencies and recreate framebuffers.\n            this._textureCache.updateDependencies();\n\n            this._lastLength = count;\n            this._aoEnabled = aoEnabled;\n            this._bloomEnabled = bloomEnabled;\n            this._tonemappingEnabled = tonemappingEnabled;\n            this._fxaaEnabled = fxaaEnabled;\n            this._textureCacheDirty = false;\n        }\n\n        if (defined(this._randomTexture) && !aoEnabled) {\n            this._randomTexture.destroy();\n            this._randomTexture = undefined;\n        }\n\n        if (!defined(this._randomTexture) && aoEnabled) {\n            length = 256 * 256 * 3;\n            var random = new Uint8Array(length);\n            for (i = 0; i < length; i += 3) {\n                random[i] = Math.floor(Math.random() * 255.0);\n            }\n\n            this._randomTexture = new Texture({\n                context : context,\n                pixelFormat : PixelFormat.RGB,\n                pixelDatatype : PixelDatatype.UNSIGNED_BYTE,\n                source : {\n                    arrayBufferView : random,\n                    width : 256,\n                    height : 256\n                },\n                sampler : new Sampler({\n                    wrapS : TextureWrap.REPEAT,\n                    wrapT : TextureWrap.REPEAT,\n                    minificationFilter : TextureMinificationFilter.NEAREST,\n                    magnificationFilter : TextureMagnificationFilter.NEAREST\n                })\n            });\n        }\n\n        this._textureCache.update(context);\n\n        fxaa.update(context, useLogDepth);\n        ao.update(context, useLogDepth);\n        bloom.update(context, useLogDepth);\n        tonemapping.update(context, useLogDepth);\n\n        if (this._autoExposureEnabled) {\n            autoexposure.update(context, useLogDepth);\n        }\n\n        length = stages.length;\n        for (i = 0; i < length; ++i) {\n            stages[i].update(context, useLogDepth);\n        }\n    };\n\n    /**\n     * Clears all of the framebuffers used by the stages.\n     *\n     * @param {Context} context The context.\n     *\n     * @private\n     */\n    PostProcessStageCollection.prototype.clear = function(context) {\n        this._textureCache.clear(context);\n\n        if (this._autoExposureEnabled) {\n            this._autoExposure.clear(context);\n        }\n    };\n\n    function getOutputTexture(stage) {\n        while (defined(stage.length)) {\n            stage = stage.get(stage.length - 1);\n        }\n        return stage.outputTexture;\n    }\n\n    /**\n     * Gets the output texture of a stage with the given name.\n     *\n     * @param {String} stageName The name of the stage.\n     * @return {Texture|undefined} The texture rendered to by the stage with the given name.\n     *\n     * @private\n     */\n    PostProcessStageCollection.prototype.getOutputTexture = function(stageName) {\n        var stage = this.getStageByName(stageName);\n        if (!defined(stage)) {\n            return undefined;\n        }\n        return getOutputTexture(stage);\n    };\n\n    function execute(stage, context, colorTexture, depthTexture, idTexture) {\n        if (defined(stage.execute)) {\n            stage.execute(context, colorTexture, depthTexture, idTexture);\n            return;\n        }\n\n        var length = stage.length;\n        var i;\n\n        if (stage.inputPreviousStageTexture) {\n            execute(stage.get(0), context, colorTexture, depthTexture, idTexture);\n            for (i = 1; i < length; ++i) {\n                execute(stage.get(i), context, getOutputTexture(stage.get(i - 1)), depthTexture, idTexture);\n            }\n        } else {\n            for (i = 0; i < length; ++i) {\n                execute(stage.get(i), context, colorTexture, depthTexture, idTexture);\n            }\n        }\n    }\n\n    /**\n     * Executes all ready and enabled stages in the collection.\n     *\n     * @param {Context} context The context.\n     * @param {Texture} colorTexture The color texture rendered to by the scene.\n     * @param {Texture} depthTexture The depth texture written to by the scene.\n     * @param {Texture} idTexture The id texture written to by the scene.\n     *\n     * @private\n     */\n    PostProcessStageCollection.prototype.execute = function(context, colorTexture, depthTexture, idTexture) {\n        var activeStages = this._activeStages;\n        var length = activeStages.length;\n\n        var fxaa = this._fxaa;\n        var ao = this._ao;\n        var bloom = this._bloom;\n        var autoexposure = this._autoExposure;\n        var tonemapping = this._tonemapping;\n\n        var aoEnabled = ao.enabled && ao._isSupported(context);\n        var bloomEnabled = bloom.enabled && bloom._isSupported(context);\n        var autoExposureEnabled = this._autoExposureEnabled;\n        var tonemappingEnabled = tonemapping.enabled && tonemapping._isSupported(context);\n        var fxaaEnabled = fxaa.enabled && fxaa._isSupported(context);\n\n        if (!fxaaEnabled && !aoEnabled && !bloomEnabled && !tonemappingEnabled && length === 0) {\n            return;\n        }\n\n        var initialTexture = colorTexture;\n        if (aoEnabled && ao.ready) {\n            execute(ao, context, initialTexture, depthTexture, idTexture);\n            initialTexture = getOutputTexture(ao);\n        }\n        if (bloomEnabled && bloom.ready) {\n            execute(bloom, context, initialTexture, depthTexture, idTexture);\n            initialTexture = getOutputTexture(bloom);\n        }\n        if (autoExposureEnabled && autoexposure.ready) {\n            execute(autoexposure, context, initialTexture, depthTexture, idTexture);\n        }\n        if (tonemappingEnabled && tonemapping.ready) {\n            execute(tonemapping, context, initialTexture, depthTexture, idTexture);\n            initialTexture = getOutputTexture(tonemapping);\n        }\n\n        var lastTexture = initialTexture;\n\n        if (length > 0) {\n            execute(activeStages[0], context, initialTexture, depthTexture, idTexture);\n            for (var i = 1; i < length; ++i) {\n                execute(activeStages[i], context, getOutputTexture(activeStages[i - 1]), depthTexture, idTexture);\n            }\n            lastTexture = getOutputTexture(activeStages[length - 1]);\n        }\n\n        if (fxaaEnabled && fxaa.ready) {\n            execute(fxaa, context, lastTexture, depthTexture, idTexture);\n        }\n    };\n\n    /**\n     * Copies the output of all executed stages to the color texture of a framebuffer.\n     *\n     * @param {Context} context The context.\n     * @param {Framebuffer} framebuffer The framebuffer to copy to.\n     *\n     * @private\n     */\n    PostProcessStageCollection.prototype.copy = function(context, framebuffer) {\n        if (!defined(this._copyColorCommand)) {\n            var that = this;\n            this._copyColorCommand = context.createViewportQuadCommand(PassThrough, {\n                uniformMap : {\n                    colorTexture : function() {\n                        return that.outputTexture;\n                    }\n                },\n                owner : this\n            });\n        }\n\n        this._copyColorCommand.framebuffer = framebuffer;\n        this._copyColorCommand.execute(context);\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <p>\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     * </p>\n     *\n     * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n     *\n     * @see PostProcessStageCollection#destroy\n     */\n    PostProcessStageCollection.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n     * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n     * <p>\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     * </p>\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     * @see PostProcessStageCollection#isDestroyed\n     */\n    PostProcessStageCollection.prototype.destroy = function() {\n        this._fxaa.destroy();\n        this._ao.destroy();\n        this._bloom.destroy();\n        this._autoExposure.destroy();\n        this._tonemapping.destroy();\n        this.removeAll();\n        this._textureCache = this._textureCache && this._textureCache.destroy();\n        return destroyObject(this);\n    };\nexport default PostProcessStageCollection;\n","import Cartesian3 from '../Core/Cartesian3.js';\nimport Cartographic from '../Core/Cartographic.js';\nimport Check from '../Core/Check.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport EasingFunction from '../Core/EasingFunction.js';\nimport CesiumMath from '../Core/Math.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport OrthographicFrustum from '../Core/OrthographicFrustum.js';\nimport OrthographicOffCenterFrustum from '../Core/OrthographicOffCenterFrustum.js';\nimport PerspectiveFrustum from '../Core/PerspectiveFrustum.js';\nimport Ray from '../Core/Ray.js';\nimport ScreenSpaceEventHandler from '../Core/ScreenSpaceEventHandler.js';\nimport ScreenSpaceEventType from '../Core/ScreenSpaceEventType.js';\nimport Transforms from '../Core/Transforms.js';\nimport Camera from './Camera.js';\nimport SceneMode from './SceneMode.js';\n\n    /**\n     * @private\n     */\n    function SceneTransitioner(scene) {\n        \n\n        this._scene = scene;\n        this._currentTweens = [];\n        this._morphHandler = undefined;\n        this._morphCancelled = false;\n        this._completeMorph = undefined;\n        this._morphToOrthographic = false;\n    }\n\n    SceneTransitioner.prototype.completeMorph = function() {\n        if (defined(this._completeMorph)) {\n            this._completeMorph();\n        }\n    };\n\n    SceneTransitioner.prototype.morphTo2D = function(duration, ellipsoid) {\n        if (defined(this._completeMorph)) {\n            this._completeMorph();\n        }\n\n        var scene = this._scene;\n        this._previousMode = scene.mode;\n        this._morphToOrthographic = scene.camera.frustum instanceof OrthographicFrustum;\n\n        if (this._previousMode === SceneMode.SCENE2D || this._previousMode === SceneMode.MORPHING) {\n            return;\n        }\n        this._scene.morphStart.raiseEvent(this, this._previousMode, SceneMode.SCENE2D, true);\n\n        scene._mode = SceneMode.MORPHING;\n        scene.camera._setTransform(Matrix4.IDENTITY);\n\n        if (this._previousMode === SceneMode.COLUMBUS_VIEW) {\n            morphFromColumbusViewTo2D(this, duration);\n        } else {\n            morphFrom3DTo2D(this, duration, ellipsoid);\n        }\n\n        if (duration === 0.0 && defined(this._completeMorph)) {\n            this._completeMorph();\n        }\n    };\n\n    var scratchToCVPosition = new Cartesian3();\n    var scratchToCVDirection = new Cartesian3();\n    var scratchToCVUp = new Cartesian3();\n    var scratchToCVPosition2D = new Cartesian3();\n    var scratchToCVDirection2D = new Cartesian3();\n    var scratchToCVUp2D = new Cartesian3();\n    var scratchToCVSurfacePosition = new Cartesian3();\n    var scratchToCVCartographic = new Cartographic();\n    var scratchToCVToENU = new Matrix4();\n    var scratchToCVFrustumPerspective = new PerspectiveFrustum();\n    var scratchToCVFrustumOrthographic = new OrthographicFrustum();\n    var scratchToCVCamera = {\n        position : undefined,\n        direction : undefined,\n        up : undefined,\n        position2D : undefined,\n        direction2D : undefined,\n        up2D : undefined,\n        frustum : undefined\n    };\n\n    SceneTransitioner.prototype.morphToColumbusView = function(duration, ellipsoid) {\n        if (defined(this._completeMorph)) {\n            this._completeMorph();\n        }\n\n        var scene = this._scene;\n        this._previousMode = scene.mode;\n\n        if (this._previousMode === SceneMode.COLUMBUS_VIEW || this._previousMode === SceneMode.MORPHING) {\n            return;\n        }\n        this._scene.morphStart.raiseEvent(this, this._previousMode, SceneMode.COLUMBUS_VIEW, true);\n\n        scene.camera._setTransform(Matrix4.IDENTITY);\n\n        var position = scratchToCVPosition;\n        var direction = scratchToCVDirection;\n        var up = scratchToCVUp;\n\n        if (duration > 0.0) {\n            position.x = 0.0;\n            position.y = -1.0;\n            position.z = 1.0;\n            position = Cartesian3.multiplyByScalar(Cartesian3.normalize(position, position), 5.0 * ellipsoid.maximumRadius, position);\n\n            Cartesian3.negate(Cartesian3.normalize(position, direction), direction);\n            Cartesian3.cross(Cartesian3.UNIT_X, direction, up);\n        } else {\n            var camera = scene.camera;\n            if (this._previousMode === SceneMode.SCENE2D) {\n                Cartesian3.clone(camera.position, position);\n                position.z = camera.frustum.right - camera.frustum.left;\n                Cartesian3.negate(Cartesian3.UNIT_Z, direction);\n                Cartesian3.clone(Cartesian3.UNIT_Y, up);\n            } else {\n                Cartesian3.clone(camera.positionWC, position);\n                Cartesian3.clone(camera.directionWC, direction);\n                Cartesian3.clone(camera.upWC, up);\n\n                var surfacePoint = ellipsoid.scaleToGeodeticSurface(position, scratchToCVSurfacePosition);\n                var toENU = Transforms.eastNorthUpToFixedFrame(surfacePoint, ellipsoid, scratchToCVToENU);\n                Matrix4.inverseTransformation(toENU, toENU);\n\n                scene.mapProjection.project(ellipsoid.cartesianToCartographic(position, scratchToCVCartographic), position);\n                Matrix4.multiplyByPointAsVector(toENU, direction, direction);\n                Matrix4.multiplyByPointAsVector(toENU, up, up);\n            }\n        }\n\n        var frustum;\n        if (this._morphToOrthographic) {\n            frustum = scratchToCVFrustumOrthographic;\n            frustum.width = scene.camera.frustum.right - scene.camera.frustum.left;\n            frustum.aspectRatio = scene.drawingBufferWidth / scene.drawingBufferHeight;\n        } else {\n            frustum = scratchToCVFrustumPerspective;\n            frustum.aspectRatio = scene.drawingBufferWidth / scene.drawingBufferHeight;\n            frustum.fov = CesiumMath.toRadians(60.0);\n        }\n\n        var cameraCV = scratchToCVCamera;\n        cameraCV.position = position;\n        cameraCV.direction = direction;\n        cameraCV.up = up;\n        cameraCV.frustum = frustum;\n\n        var complete = completeColumbusViewCallback(cameraCV);\n        createMorphHandler(this, complete);\n\n        if (this._previousMode === SceneMode.SCENE2D) {\n            morphFrom2DToColumbusView(this, duration, cameraCV, complete);\n        } else {\n            cameraCV.position2D = Matrix4.multiplyByPoint(Camera.TRANSFORM_2D, position, scratchToCVPosition2D);\n            cameraCV.direction2D = Matrix4.multiplyByPointAsVector(Camera.TRANSFORM_2D, direction, scratchToCVDirection2D);\n            cameraCV.up2D = Matrix4.multiplyByPointAsVector(Camera.TRANSFORM_2D, up, scratchToCVUp2D);\n\n            scene._mode = SceneMode.MORPHING;\n            morphFrom3DToColumbusView(this, duration, cameraCV, complete);\n        }\n\n        if (duration === 0.0 && defined(this._completeMorph)) {\n            this._completeMorph();\n        }\n    };\n\n    var scratchCVTo3DCamera = {\n        position : new Cartesian3(),\n        direction : new Cartesian3(),\n        up : new Cartesian3(),\n        frustum : undefined\n    };\n    var scratch2DTo3DFrustumPersp = new PerspectiveFrustum();\n\n    SceneTransitioner.prototype.morphTo3D = function(duration, ellipsoid) {\n        if (defined(this._completeMorph)) {\n            this._completeMorph();\n        }\n\n        var scene = this._scene;\n        this._previousMode = scene.mode;\n\n        if (this._previousMode === SceneMode.SCENE3D || this._previousMode === SceneMode.MORPHING) {\n            return;\n        }\n        this._scene.morphStart.raiseEvent(this, this._previousMode, SceneMode.SCENE3D, true);\n\n        scene._mode = SceneMode.MORPHING;\n        scene.camera._setTransform(Matrix4.IDENTITY);\n\n        if (this._previousMode === SceneMode.SCENE2D) {\n            morphFrom2DTo3D(this, duration, ellipsoid);\n        } else {\n            var camera3D;\n            if (duration > 0.0) {\n                camera3D = scratchCVTo3DCamera;\n                Cartesian3.fromDegrees(0.0, 0.0, 5.0 * ellipsoid.maximumRadius, ellipsoid, camera3D.position);\n                Cartesian3.negate(camera3D.position, camera3D.direction);\n                Cartesian3.normalize(camera3D.direction, camera3D.direction);\n                Cartesian3.clone(Cartesian3.UNIT_Z, camera3D.up);\n            } else {\n                camera3D = getColumbusViewTo3DCamera(this, ellipsoid);\n            }\n\n            var frustum;\n            var camera = scene.camera;\n            if (camera.frustum instanceof OrthographicFrustum) {\n                frustum = camera.frustum.clone();\n            } else {\n                frustum = scratch2DTo3DFrustumPersp;\n                frustum.aspectRatio = scene.drawingBufferWidth / scene.drawingBufferHeight;\n                frustum.fov = CesiumMath.toRadians(60.0);\n            }\n            camera3D.frustum = frustum;\n\n            var complete = complete3DCallback(camera3D);\n            createMorphHandler(this, complete);\n\n            morphFromColumbusViewTo3D(this, duration, camera3D, complete);\n        }\n\n        if (duration === 0.0 && defined(this._completeMorph)) {\n            this._completeMorph();\n        }\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <br /><br />\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     *\n     * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n     */\n    SceneTransitioner.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     * @example\n     * transitioner = transitioner && transitioner.destroy();\n     */\n    SceneTransitioner.prototype.destroy = function() {\n        destroyMorphHandler(this);\n        return destroyObject(this);\n    };\n\n    function createMorphHandler(transitioner, completeMorphFunction) {\n        if (transitioner._scene.completeMorphOnUserInput) {\n            transitioner._morphHandler = new ScreenSpaceEventHandler(transitioner._scene.canvas);\n\n            var completeMorph = function() {\n                transitioner._morphCancelled = true;\n                transitioner._scene.camera.cancelFlight();\n                completeMorphFunction(transitioner);\n            };\n            transitioner._completeMorph = completeMorph;\n            transitioner._morphHandler.setInputAction(completeMorph, ScreenSpaceEventType.LEFT_DOWN);\n            transitioner._morphHandler.setInputAction(completeMorph, ScreenSpaceEventType.MIDDLE_DOWN);\n            transitioner._morphHandler.setInputAction(completeMorph, ScreenSpaceEventType.RIGHT_DOWN);\n            transitioner._morphHandler.setInputAction(completeMorph, ScreenSpaceEventType.WHEEL);\n        }\n    }\n\n    function destroyMorphHandler(transitioner) {\n        var tweens = transitioner._currentTweens;\n        for ( var i = 0; i < tweens.length; ++i) {\n            tweens[i].cancelTween();\n        }\n        transitioner._currentTweens.length = 0;\n        transitioner._morphHandler = transitioner._morphHandler && transitioner._morphHandler.destroy();\n    }\n\n    var scratchCVTo3DCartographic = new Cartographic();\n    var scratchCVTo3DSurfacePoint = new Cartesian3();\n    var scratchCVTo3DFromENU = new Matrix4();\n\n    function getColumbusViewTo3DCamera(transitioner, ellipsoid) {\n        var scene = transitioner._scene;\n        var camera = scene.camera;\n\n        var camera3D = scratchCVTo3DCamera;\n        var position = camera3D.position;\n        var direction = camera3D.direction;\n        var up = camera3D.up;\n\n        var positionCarto = scene.mapProjection.unproject(camera.position, scratchCVTo3DCartographic);\n        ellipsoid.cartographicToCartesian(positionCarto, position);\n        var surfacePoint = ellipsoid.scaleToGeodeticSurface(position, scratchCVTo3DSurfacePoint);\n\n        var fromENU = Transforms.eastNorthUpToFixedFrame(surfacePoint, ellipsoid, scratchCVTo3DFromENU);\n\n        Matrix4.multiplyByPointAsVector(fromENU, camera.direction, direction);\n        Matrix4.multiplyByPointAsVector(fromENU, camera.up, up);\n\n        return camera3D;\n    }\n\n    var scratchCVTo3DStartPos = new Cartesian3();\n    var scratchCVTo3DStartDir = new Cartesian3();\n    var scratchCVTo3DStartUp = new Cartesian3();\n    var scratchCVTo3DEndPos = new Cartesian3();\n    var scratchCVTo3DEndDir = new Cartesian3();\n    var scratchCVTo3DEndUp = new Cartesian3();\n\n    function morphFromColumbusViewTo3D(transitioner, duration, endCamera, complete) {\n        duration *= 0.5;\n\n        var scene = transitioner._scene;\n        var camera = scene.camera;\n\n        var startPos = Cartesian3.clone(camera.position, scratchCVTo3DStartPos);\n        var startDir = Cartesian3.clone(camera.direction, scratchCVTo3DStartDir);\n        var startUp = Cartesian3.clone(camera.up, scratchCVTo3DStartUp);\n\n        var endPos = Matrix4.multiplyByPoint(Camera.TRANSFORM_2D_INVERSE, endCamera.position, scratchCVTo3DEndPos);\n        var endDir = Matrix4.multiplyByPointAsVector(Camera.TRANSFORM_2D_INVERSE, endCamera.direction, scratchCVTo3DEndDir);\n        var endUp = Matrix4.multiplyByPointAsVector(Camera.TRANSFORM_2D_INVERSE, endCamera.up, scratchCVTo3DEndUp);\n\n        function update(value) {\n            columbusViewMorph(startPos, endPos, value.time, camera.position);\n            columbusViewMorph(startDir, endDir, value.time, camera.direction);\n            columbusViewMorph(startUp, endUp, value.time, camera.up);\n            Cartesian3.cross(camera.direction, camera.up, camera.right);\n            Cartesian3.normalize(camera.right, camera.right);\n        }\n\n        var tween = scene.tweens.add({\n            duration : duration,\n            easingFunction : EasingFunction.QUARTIC_OUT,\n            startObject : {\n                time : 0.0\n            },\n            stopObject : {\n                time : 1.0\n            },\n            update : update,\n            complete : function() {\n                addMorphTimeAnimations(transitioner, scene, 0.0, 1.0, duration, complete);\n            }\n        });\n        transitioner._currentTweens.push(tween);\n    }\n\n    var scratch2DTo3DFrustumOrtho = new OrthographicFrustum();\n    var scratch3DToCVStartPos = new Cartesian3();\n    var scratch3DToCVStartDir = new Cartesian3();\n    var scratch3DToCVStartUp = new Cartesian3();\n    var scratch3DToCVEndPos = new Cartesian3();\n    var scratch3DToCVEndDir = new Cartesian3();\n    var scratch3DToCVEndUp = new Cartesian3();\n\n    function morphFrom2DTo3D(transitioner, duration, ellipsoid) {\n        duration /= 3.0;\n\n        var scene = transitioner._scene;\n        var camera = scene.camera;\n\n        var camera3D;\n        if (duration > 0.0) {\n            camera3D = scratchCVTo3DCamera;\n            Cartesian3.fromDegrees(0.0, 0.0, 5.0 * ellipsoid.maximumRadius, ellipsoid, camera3D.position);\n            Cartesian3.negate(camera3D.position, camera3D.direction);\n            Cartesian3.normalize(camera3D.direction, camera3D.direction);\n            Cartesian3.clone(Cartesian3.UNIT_Z, camera3D.up);\n        } else {\n            camera.position.z = camera.frustum.right - camera.frustum.left;\n\n            camera3D = getColumbusViewTo3DCamera(transitioner, ellipsoid);\n        }\n\n        var frustum;\n        if (transitioner._morphToOrthographic) {\n            frustum = scratch2DTo3DFrustumOrtho;\n            frustum.aspectRatio = scene.drawingBufferWidth / scene.drawingBufferHeight;\n            frustum.width = camera.frustum.right - camera.frustum.left;\n        } else {\n            frustum = scratch2DTo3DFrustumPersp;\n            frustum.aspectRatio = scene.drawingBufferWidth / scene.drawingBufferHeight;\n            frustum.fov = CesiumMath.toRadians(60.0);\n        }\n\n        camera3D.frustum = frustum;\n\n        var complete = complete3DCallback(camera3D);\n        createMorphHandler(transitioner, complete);\n\n        var morph;\n        if (transitioner._morphToOrthographic) {\n            morph = function() {\n                morphFromColumbusViewTo3D(transitioner, duration, camera3D, complete);\n            };\n        } else {\n            morph = function() {\n                morphOrthographicToPerspective(transitioner, duration, camera3D, function() {\n                    morphFromColumbusViewTo3D(transitioner, duration, camera3D, complete);\n                });\n            };\n        }\n\n        if (duration > 0.0) {\n            scene._mode = SceneMode.SCENE2D;\n            camera.flyTo({\n                duration : duration,\n                destination : Cartesian3.fromDegrees(0.0, 0.0, 5.0 * ellipsoid.maximumRadius, ellipsoid, scratch3DToCVEndPos),\n                complete : function() {\n                    scene._mode = SceneMode.MORPHING;\n                    morph();\n                }\n            });\n        } else {\n            morph();\n        }\n    }\n\n    function columbusViewMorph(startPosition, endPosition, time, result) {\n        // Just linear for now.\n        return Cartesian3.lerp(startPosition, endPosition, time, result);\n    }\n\n    function morphPerspectiveToOrthographic(transitioner, duration, endCamera, updateHeight, complete) {\n        var scene = transitioner._scene;\n        var camera = scene.camera;\n\n        if (camera.frustum instanceof OrthographicFrustum) {\n            return;\n        }\n\n        var startFOV = camera.frustum.fov;\n        var endFOV = CesiumMath.RADIANS_PER_DEGREE * 0.5;\n        var d = endCamera.position.z * Math.tan(startFOV * 0.5);\n        camera.frustum.far = d / Math.tan(endFOV * 0.5) + 10000000.0;\n\n        function update(value) {\n            camera.frustum.fov = CesiumMath.lerp(startFOV, endFOV, value.time);\n            var height = d / Math.tan(camera.frustum.fov * 0.5);\n            updateHeight(camera, height);\n        }\n        var tween = scene.tweens.add({\n            duration : duration,\n            easingFunction : EasingFunction.QUARTIC_OUT,\n            startObject : {\n                time : 0.0\n            },\n            stopObject : {\n                time : 1.0\n            },\n            update : update,\n            complete : function() {\n                camera.frustum = endCamera.frustum.clone();\n                complete(transitioner);\n            }\n        });\n        transitioner._currentTweens.push(tween);\n    }\n\n    var scratchCVTo2DStartPos = new Cartesian3();\n    var scratchCVTo2DStartDir = new Cartesian3();\n    var scratchCVTo2DStartUp = new Cartesian3();\n    var scratchCVTo2DEndPos = new Cartesian3();\n    var scratchCVTo2DEndDir = new Cartesian3();\n    var scratchCVTo2DEndUp = new Cartesian3();\n    var scratchCVTo2DFrustum = new OrthographicOffCenterFrustum();\n    var scratchCVTo2DRay = new Ray();\n    var scratchCVTo2DPickPos = new Cartesian3();\n    var scratchCVTo2DCamera = {\n        position : undefined,\n        direction : undefined,\n        up : undefined,\n        frustum : undefined\n    };\n\n    function morphFromColumbusViewTo2D(transitioner, duration) {\n        duration *= 0.5;\n\n        var scene = transitioner._scene;\n        var camera = scene.camera;\n\n        var startPos = Cartesian3.clone(camera.position, scratchCVTo2DStartPos);\n        var startDir = Cartesian3.clone(camera.direction, scratchCVTo2DStartDir);\n        var startUp = Cartesian3.clone(camera.up, scratchCVTo2DStartUp);\n\n        var endDir = Cartesian3.negate(Cartesian3.UNIT_Z, scratchCVTo2DEndDir);\n        var endUp = Cartesian3.clone(Cartesian3.UNIT_Y, scratchCVTo2DEndUp);\n\n        var endPos = scratchCVTo2DEndPos;\n\n        if (duration > 0.0) {\n            Cartesian3.clone(Cartesian3.ZERO, scratchCVTo2DEndPos);\n            endPos.z = 5.0 * scene.mapProjection.ellipsoid.maximumRadius;\n        } else {\n            Cartesian3.clone(startPos, scratchCVTo2DEndPos);\n\n            var ray = scratchCVTo2DRay;\n            Matrix4.multiplyByPoint(Camera.TRANSFORM_2D, startPos, ray.origin);\n            Matrix4.multiplyByPointAsVector(Camera.TRANSFORM_2D, startDir, ray.direction);\n\n            var globe = scene.globe;\n            if (defined(globe)) {\n                var pickPos = globe.pickWorldCoordinates(ray, scene, scratchCVTo2DPickPos);\n                if (defined(pickPos)) {\n                    Matrix4.multiplyByPoint(Camera.TRANSFORM_2D_INVERSE, pickPos, endPos);\n                    endPos.z += Cartesian3.distance(startPos, endPos);\n                }\n            }\n        }\n\n        var frustum = scratchCVTo2DFrustum;\n        frustum.right = endPos.z * 0.5;\n        frustum.left = -frustum.right;\n        frustum.top = frustum.right * (scene.drawingBufferHeight / scene.drawingBufferWidth);\n        frustum.bottom = -frustum.top;\n\n        var camera2D = scratchCVTo2DCamera;\n        camera2D.position = endPos;\n        camera2D.direction = endDir;\n        camera2D.up = endUp;\n        camera2D.frustum = frustum;\n\n        var complete = complete2DCallback(camera2D);\n        createMorphHandler(transitioner, complete);\n\n        function updateCV(value) {\n            columbusViewMorph(startPos, endPos, value.time, camera.position);\n            columbusViewMorph(startDir, endDir, value.time, camera.direction);\n            columbusViewMorph(startUp, endUp, value.time, camera.up);\n            Cartesian3.cross(camera.direction, camera.up, camera.right);\n            Cartesian3.normalize(camera.right, camera.right);\n            camera._adjustOrthographicFrustum(true);\n        }\n\n        function updateHeight(camera, height) {\n            camera.position.z = height;\n        }\n\n        var tween = scene.tweens.add({\n            duration : duration,\n            easingFunction : EasingFunction.QUARTIC_OUT,\n            startObject : {\n                time : 0.0\n            },\n            stopObject : {\n                time : 1.0\n            },\n            update : updateCV,\n            complete : function() {\n                morphPerspectiveToOrthographic(transitioner, duration, camera2D, updateHeight, complete);\n            }\n        });\n        transitioner._currentTweens.push(tween);\n    }\n\n    var scratch3DTo2DCartographic = new Cartographic();\n    var scratch3DTo2DCamera = {\n        position : new Cartesian3(),\n        direction : new Cartesian3(),\n        up : new Cartesian3(),\n        position2D : new Cartesian3(),\n        direction2D : new Cartesian3(),\n        up2D : new Cartesian3(),\n        frustum : new OrthographicOffCenterFrustum()\n    };\n    var scratch3DTo2DEndCamera = {\n        position : new Cartesian3(),\n        direction : new Cartesian3(),\n        up : new Cartesian3(),\n        frustum : undefined\n    };\n    var scratch3DTo2DPickPosition = new Cartesian3();\n    var scratch3DTo2DRay = new Ray();\n    var scratch3DTo2DToENU = new Matrix4();\n    var scratch3DTo2DSurfacePoint = new Cartesian3();\n\n    function morphFrom3DTo2D(transitioner, duration, ellipsoid) {\n        duration *= 0.5;\n\n        var scene = transitioner._scene;\n        var camera = scene.camera;\n        var camera2D = scratch3DTo2DCamera;\n\n        if (duration > 0.0) {\n            Cartesian3.clone(Cartesian3.ZERO, camera2D.position);\n            camera2D.position.z = 5.0 * ellipsoid.maximumRadius;\n            Cartesian3.negate(Cartesian3.UNIT_Z, camera2D.direction);\n            Cartesian3.clone(Cartesian3.UNIT_Y, camera2D.up);\n        } else {\n            ellipsoid.cartesianToCartographic(camera.positionWC, scratch3DTo2DCartographic);\n            scene.mapProjection.project(scratch3DTo2DCartographic, camera2D.position);\n\n            Cartesian3.negate(Cartesian3.UNIT_Z, camera2D.direction);\n            Cartesian3.clone(Cartesian3.UNIT_Y, camera2D.up);\n\n            var ray = scratch3DTo2DRay;\n            Cartesian3.clone(camera2D.position2D, ray.origin);\n            var rayDirection = Cartesian3.clone(camera.directionWC, ray.direction);\n            var surfacePoint = ellipsoid.scaleToGeodeticSurface(camera.positionWC, scratch3DTo2DSurfacePoint);\n            var toENU = Transforms.eastNorthUpToFixedFrame(surfacePoint, ellipsoid, scratch3DTo2DToENU);\n            Matrix4.inverseTransformation(toENU, toENU);\n            Matrix4.multiplyByPointAsVector(toENU, rayDirection, rayDirection);\n            Matrix4.multiplyByPointAsVector(Camera.TRANSFORM_2D, rayDirection, rayDirection);\n\n            var globe = scene.globe;\n            if (defined(globe)) {\n                var pickedPos = globe.pickWorldCoordinates(ray, scene, scratch3DTo2DPickPosition);\n                if (defined(pickedPos)) {\n                    var height = Cartesian3.distance(camera2D.position2D, pickedPos);\n                    pickedPos.x += height;\n                    Cartesian3.clone(pickedPos, camera2D.position2D);\n                }\n            }\n        }\n\n        function updateHeight(camera, height) {\n            camera.position.x = height;\n        }\n\n        Matrix4.multiplyByPoint(Camera.TRANSFORM_2D, camera2D.position, camera2D.position2D);\n        Matrix4.multiplyByPointAsVector(Camera.TRANSFORM_2D, camera2D.direction, camera2D.direction2D);\n        Matrix4.multiplyByPointAsVector(Camera.TRANSFORM_2D, camera2D.up, camera2D.up2D);\n\n        var frustum = camera2D.frustum;\n        frustum.right = camera2D.position.z * 0.5;\n        frustum.left = -frustum.right;\n        frustum.top = frustum.right * (scene.drawingBufferHeight / scene.drawingBufferWidth);\n        frustum.bottom = -frustum.top;\n\n        var endCamera = scratch3DTo2DEndCamera;\n        Matrix4.multiplyByPoint(Camera.TRANSFORM_2D_INVERSE, camera2D.position2D, endCamera.position);\n        Cartesian3.clone(camera2D.direction, endCamera.direction);\n        Cartesian3.clone(camera2D.up, endCamera.up);\n        endCamera.frustum = frustum;\n\n        var complete = complete2DCallback(endCamera);\n        createMorphHandler(transitioner, complete);\n\n        function completeCallback() {\n            morphPerspectiveToOrthographic(transitioner, duration, camera2D, updateHeight, complete);\n        }\n        morphFrom3DToColumbusView(transitioner, duration, camera2D, completeCallback);\n    }\n\n    function morphOrthographicToPerspective(transitioner, duration, cameraCV, complete) {\n        var scene = transitioner._scene;\n        var camera = scene.camera;\n\n        var height = camera.frustum.right - camera.frustum.left;\n        camera.frustum = cameraCV.frustum.clone();\n\n        var endFOV = camera.frustum.fov;\n        var startFOV = CesiumMath.RADIANS_PER_DEGREE * 0.5;\n        var d = height * Math.tan(endFOV * 0.5);\n        camera.frustum.far = d / Math.tan(startFOV * 0.5) + 10000000.0;\n        camera.frustum.fov = startFOV;\n\n        function update(value) {\n            camera.frustum.fov = CesiumMath.lerp(startFOV, endFOV, value.time);\n            camera.position.z = d / Math.tan(camera.frustum.fov * 0.5);\n        }\n        var tween = scene.tweens.add({\n            duration : duration,\n            easingFunction : EasingFunction.QUARTIC_OUT,\n            startObject : {\n                time : 0.0\n            },\n            stopObject : {\n                time : 1.0\n            },\n            update : update,\n            complete : function() {\n                complete(transitioner);\n            }\n        });\n        transitioner._currentTweens.push(tween);\n    }\n\n    function morphFrom2DToColumbusView(transitioner, duration, cameraCV, complete) {\n        duration *= 0.5;\n\n        var scene = transitioner._scene;\n        var camera = scene.camera;\n\n        var endPos = Cartesian3.clone(cameraCV.position, scratch3DToCVEndPos);\n        var endDir = Cartesian3.clone(cameraCV.direction, scratch3DToCVEndDir);\n        var endUp = Cartesian3.clone(cameraCV.up, scratch3DToCVEndUp);\n\n        scene._mode = SceneMode.MORPHING;\n\n        function morph() {\n            camera.frustum = cameraCV.frustum.clone();\n\n            var startPos = Cartesian3.clone(camera.position, scratch3DToCVStartPos);\n            var startDir = Cartesian3.clone(camera.direction, scratch3DToCVStartDir);\n            var startUp = Cartesian3.clone(camera.up, scratch3DToCVStartUp);\n            startPos.z = endPos.z;\n\n            function update(value) {\n                columbusViewMorph(startPos, endPos, value.time, camera.position);\n                columbusViewMorph(startDir, endDir, value.time, camera.direction);\n                columbusViewMorph(startUp, endUp, value.time, camera.up);\n                Cartesian3.cross(camera.direction, camera.up, camera.right);\n                Cartesian3.normalize(camera.right, camera.right);\n            }\n            var tween = scene.tweens.add({\n                duration : duration,\n                easingFunction : EasingFunction.QUARTIC_OUT,\n                startObject : {\n                    time : 0.0\n                },\n                stopObject : {\n                    time : 1.0\n                },\n                update : update,\n                complete : function() {\n                    complete(transitioner);\n                }\n            });\n            transitioner._currentTweens.push(tween);\n        }\n\n        if (transitioner._morphToOrthographic) {\n            morph();\n        } else {\n            morphOrthographicToPerspective(transitioner, 0.0, cameraCV, morph);\n        }\n    }\n\n    function morphFrom3DToColumbusView(transitioner, duration, endCamera, complete) {\n        var scene = transitioner._scene;\n        var camera = scene.camera;\n\n        var startPos = Cartesian3.clone(camera.position, scratch3DToCVStartPos);\n        var startDir = Cartesian3.clone(camera.direction, scratch3DToCVStartDir);\n        var startUp = Cartesian3.clone(camera.up, scratch3DToCVStartUp);\n\n        var endPos = Cartesian3.clone(endCamera.position2D, scratch3DToCVEndPos);\n        var endDir = Cartesian3.clone(endCamera.direction2D, scratch3DToCVEndDir);\n        var endUp = Cartesian3.clone(endCamera.up2D, scratch3DToCVEndUp);\n\n        function update(value) {\n            columbusViewMorph(startPos, endPos, value.time, camera.position);\n            columbusViewMorph(startDir, endDir, value.time, camera.direction);\n            columbusViewMorph(startUp, endUp, value.time, camera.up);\n            Cartesian3.cross(camera.direction, camera.up, camera.right);\n            Cartesian3.normalize(camera.right, camera.right);\n            camera._adjustOrthographicFrustum(true);\n        }\n        var tween = scene.tweens.add({\n            duration : duration,\n            easingFunction : EasingFunction.QUARTIC_OUT,\n            startObject : {\n                time : 0.0\n            },\n            stopObject : {\n                time : 1.0\n            },\n            update : update,\n            complete : function() {\n                addMorphTimeAnimations(transitioner, scene, 1.0, 0.0, duration, complete);\n            }\n        });\n        transitioner._currentTweens.push(tween);\n    }\n\n    function addMorphTimeAnimations(transitioner, scene, start, stop, duration, complete) {\n        // Later, this will be linear and each object will adjust, if desired, in its vertex shader.\n        var options = {\n            object : scene,\n            property : 'morphTime',\n            startValue : start,\n            stopValue : stop,\n            duration : duration,\n            easingFunction : EasingFunction.QUARTIC_OUT\n        };\n\n        if (defined(complete)) {\n            options.complete = function() {\n                complete(transitioner);\n            };\n        }\n\n        var tween = scene.tweens.addProperty(options);\n        transitioner._currentTweens.push(tween);\n    }\n\n    function complete3DCallback(camera3D) {\n        return function(transitioner) {\n            var scene = transitioner._scene;\n            scene._mode = SceneMode.SCENE3D;\n            scene.morphTime = SceneMode.getMorphTime(SceneMode.SCENE3D);\n\n            destroyMorphHandler(transitioner);\n\n            var camera = scene.camera;\n            if (transitioner._previousMode !== SceneMode.MORPHING || transitioner._morphCancelled) {\n                transitioner._morphCancelled = false;\n\n                Cartesian3.clone(camera3D.position, camera.position);\n                Cartesian3.clone(camera3D.direction, camera.direction);\n                Cartesian3.clone(camera3D.up, camera.up);\n                Cartesian3.cross(camera.direction, camera.up, camera.right);\n                Cartesian3.normalize(camera.right, camera.right);\n\n                camera.frustum = camera3D.frustum.clone();\n            }\n\n            var frustum = camera.frustum;\n            if (scene.frameState.useLogDepth) {\n                frustum.near = 0.1;\n                frustum.far = 10000000000.0;\n            }\n\n            var wasMorphing = defined(transitioner._completeMorph);\n            transitioner._completeMorph = undefined;\n            scene.camera.update(scene.mode);\n            transitioner._scene.morphComplete.raiseEvent(transitioner, transitioner._previousMode, SceneMode.SCENE3D, wasMorphing);\n        };\n    }\n\n    function complete2DCallback(camera2D) {\n        return function(transitioner) {\n            var scene = transitioner._scene;\n\n            scene._mode = SceneMode.SCENE2D;\n            scene.morphTime = SceneMode.getMorphTime(SceneMode.SCENE2D);\n\n            destroyMorphHandler(transitioner);\n\n            var camera = scene.camera;\n            Cartesian3.clone(camera2D.position, camera.position);\n            camera.position.z = scene.mapProjection.ellipsoid.maximumRadius * 2.0;\n            Cartesian3.clone(camera2D.direction, camera.direction);\n            Cartesian3.clone(camera2D.up, camera.up);\n            Cartesian3.cross(camera.direction, camera.up, camera.right);\n            Cartesian3.normalize(camera.right, camera.right);\n            camera.frustum = camera2D.frustum.clone();\n\n            var wasMorphing = defined(transitioner._completeMorph);\n            transitioner._completeMorph = undefined;\n            scene.camera.update(scene.mode);\n            transitioner._scene.morphComplete.raiseEvent(transitioner, transitioner._previousMode, SceneMode.SCENE2D, wasMorphing);\n        };\n    }\n\n    function completeColumbusViewCallback(cameraCV) {\n        return function(transitioner) {\n            var scene = transitioner._scene;\n            scene._mode = SceneMode.COLUMBUS_VIEW;\n            scene.morphTime = SceneMode.getMorphTime(SceneMode.COLUMBUS_VIEW);\n\n            destroyMorphHandler(transitioner);\n\n            var camera = scene.camera;\n            if (transitioner._previousModeMode !== SceneMode.MORPHING || transitioner._morphCancelled) {\n                transitioner._morphCancelled = false;\n\n                Cartesian3.clone(cameraCV.position, camera.position);\n                Cartesian3.clone(cameraCV.direction, camera.direction);\n                Cartesian3.clone(cameraCV.up, camera.up);\n                Cartesian3.cross(camera.direction, camera.up, camera.right);\n                Cartesian3.normalize(camera.right, camera.right);\n            }\n\n            var frustum = camera.frustum;\n            if (scene.frameState.useLogDepth) {\n                frustum.near = 0.1;\n                frustum.far = 10000000000.0;\n            }\n\n            var wasMorphing = defined(transitioner._completeMorph);\n            transitioner._completeMorph = undefined;\n            scene.camera.update(scene.mode);\n            transitioner._scene.morphComplete.raiseEvent(transitioner, transitioner._previousMode, SceneMode.COLUMBUS_VIEW, wasMorphing);\n        };\n    }\nexport default SceneTransitioner;\n","\n    /**\n     * Enumerates the available input for interacting with the camera.\n     *\n     * @exports CameraEventType\n     */\n    var CameraEventType = {\n        /**\n         * A left mouse button press followed by moving the mouse and releasing the button.\n         *\n         * @type {Number}\n         * @constant\n         */\n        LEFT_DRAG : 0,\n\n        /**\n         *  A right mouse button press followed by moving the mouse and releasing the button.\n         *\n         * @type {Number}\n         * @constant\n         */\n        RIGHT_DRAG : 1,\n\n        /**\n         *  A middle mouse button press followed by moving the mouse and releasing the button.\n         *\n         * @type {Number}\n         * @constant\n         */\n        MIDDLE_DRAG : 2,\n\n        /**\n         * Scrolling the middle mouse button.\n         *\n         * @type {Number}\n         * @constant\n         */\n        WHEEL : 3,\n\n        /**\n         * A two-finger touch on a touch surface.\n         *\n         * @type {Number}\n         * @constant\n         */\n        PINCH : 4\n    };\nexport default Object.freeze(CameraEventType);\n","import Cartesian2 from '../Core/Cartesian2.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport KeyboardEventModifier from '../Core/KeyboardEventModifier.js';\nimport CesiumMath from '../Core/Math.js';\nimport ScreenSpaceEventHandler from '../Core/ScreenSpaceEventHandler.js';\nimport ScreenSpaceEventType from '../Core/ScreenSpaceEventType.js';\nimport CameraEventType from './CameraEventType.js';\n\n    function getKey(type, modifier) {\n        var key = type;\n        if (defined(modifier)) {\n            key += '+' + modifier;\n        }\n        return key;\n    }\n\n    function clonePinchMovement(pinchMovement, result) {\n        Cartesian2.clone(pinchMovement.distance.startPosition, result.distance.startPosition);\n        Cartesian2.clone(pinchMovement.distance.endPosition, result.distance.endPosition);\n\n        Cartesian2.clone(pinchMovement.angleAndHeight.startPosition, result.angleAndHeight.startPosition);\n        Cartesian2.clone(pinchMovement.angleAndHeight.endPosition, result.angleAndHeight.endPosition);\n    }\n\n    function listenToPinch(aggregator, modifier, canvas) {\n        var key = getKey(CameraEventType.PINCH, modifier);\n\n        var update = aggregator._update;\n        var isDown = aggregator._isDown;\n        var eventStartPosition = aggregator._eventStartPosition;\n        var pressTime = aggregator._pressTime;\n        var releaseTime = aggregator._releaseTime;\n\n        update[key] = true;\n        isDown[key] = false;\n        eventStartPosition[key] = new Cartesian2();\n\n        var movement = aggregator._movement[key];\n        if (!defined(movement)) {\n            movement = aggregator._movement[key] = {};\n        }\n\n        movement.distance = {\n            startPosition : new Cartesian2(),\n            endPosition : new Cartesian2()\n        };\n        movement.angleAndHeight = {\n            startPosition : new Cartesian2(),\n            endPosition : new Cartesian2()\n        };\n        movement.prevAngle = 0.0;\n\n        aggregator._eventHandler.setInputAction(function(event) {\n            aggregator._buttonsDown++;\n            isDown[key] = true;\n            pressTime[key] = new Date();\n            // Compute center position and store as start point.\n            Cartesian2.lerp(event.position1, event.position2, 0.5, eventStartPosition[key]);\n        }, ScreenSpaceEventType.PINCH_START, modifier);\n\n        aggregator._eventHandler.setInputAction(function() {\n            aggregator._buttonsDown = Math.max(aggregator._buttonsDown - 1, 0);\n            isDown[key] = false;\n            releaseTime[key] = new Date();\n        }, ScreenSpaceEventType.PINCH_END, modifier);\n\n        aggregator._eventHandler.setInputAction(function(mouseMovement) {\n            if (isDown[key]) {\n                // Aggregate several input events into a single animation frame.\n                if (!update[key]) {\n                    Cartesian2.clone(mouseMovement.distance.endPosition, movement.distance.endPosition);\n                    Cartesian2.clone(mouseMovement.angleAndHeight.endPosition, movement.angleAndHeight.endPosition);\n                } else {\n                    clonePinchMovement(mouseMovement, movement);\n                    update[key] = false;\n                    movement.prevAngle = movement.angleAndHeight.startPosition.x;\n                }\n                // Make sure our aggregation of angles does not \"flip\" over 360 degrees.\n                var angle = movement.angleAndHeight.endPosition.x;\n                var prevAngle = movement.prevAngle;\n                var TwoPI = Math.PI * 2;\n                while (angle >= (prevAngle + Math.PI)) {\n                    angle -= TwoPI;\n                }\n                while (angle < (prevAngle - Math.PI)) {\n                    angle += TwoPI;\n                }\n                movement.angleAndHeight.endPosition.x = -angle * canvas.clientWidth / 12;\n                movement.angleAndHeight.startPosition.x = -prevAngle * canvas.clientWidth / 12;\n            }\n        }, ScreenSpaceEventType.PINCH_MOVE, modifier);\n    }\n\n    function listenToWheel(aggregator, modifier) {\n        var key = getKey(CameraEventType.WHEEL, modifier);\n\n        var update = aggregator._update;\n        update[key] = true;\n\n        var movement = aggregator._movement[key];\n        if (!defined(movement)) {\n            movement = aggregator._movement[key] = {};\n        }\n\n        movement.startPosition = new Cartesian2();\n        movement.endPosition = new Cartesian2();\n\n        aggregator._eventHandler.setInputAction(function(delta) {\n            // TODO: magic numbers\n            var arcLength = 15.0 * CesiumMath.toRadians(delta);\n            if (!update[key]) {\n                movement.endPosition.y = movement.endPosition.y + arcLength;\n            } else {\n                Cartesian2.clone(Cartesian2.ZERO, movement.startPosition);\n                movement.endPosition.x = 0.0;\n                movement.endPosition.y = arcLength;\n                update[key] = false;\n            }\n        }, ScreenSpaceEventType.WHEEL, modifier);\n    }\n\n    function listenMouseButtonDownUp(aggregator, modifier, type) {\n        var key = getKey(type, modifier);\n\n        var isDown = aggregator._isDown;\n        var eventStartPosition = aggregator._eventStartPosition;\n        var pressTime = aggregator._pressTime;\n        var releaseTime = aggregator._releaseTime;\n\n        isDown[key] = false;\n        eventStartPosition[key] = new Cartesian2();\n\n        var lastMovement = aggregator._lastMovement[key];\n        if (!defined(lastMovement)) {\n            lastMovement = aggregator._lastMovement[key] = {\n                startPosition : new Cartesian2(),\n                endPosition : new Cartesian2(),\n                valid : false\n            };\n        }\n\n        var down;\n        var up;\n        if (type === CameraEventType.LEFT_DRAG) {\n            down = ScreenSpaceEventType.LEFT_DOWN;\n            up = ScreenSpaceEventType.LEFT_UP;\n        } else if (type === CameraEventType.RIGHT_DRAG) {\n            down = ScreenSpaceEventType.RIGHT_DOWN;\n            up = ScreenSpaceEventType.RIGHT_UP;\n        } else if (type === CameraEventType.MIDDLE_DRAG) {\n            down = ScreenSpaceEventType.MIDDLE_DOWN;\n            up = ScreenSpaceEventType.MIDDLE_UP;\n        }\n\n        aggregator._eventHandler.setInputAction(function(event) {\n            aggregator._buttonsDown++;\n            lastMovement.valid = false;\n            isDown[key] = true;\n            pressTime[key] = new Date();\n            Cartesian2.clone(event.position, eventStartPosition[key]);\n        }, down, modifier);\n\n        aggregator._eventHandler.setInputAction(function() {\n            aggregator._buttonsDown = Math.max(aggregator._buttonsDown - 1, 0);\n            isDown[key] = false;\n            releaseTime[key] = new Date();\n        }, up, modifier);\n    }\n\n    function cloneMouseMovement(mouseMovement, result) {\n        Cartesian2.clone(mouseMovement.startPosition, result.startPosition);\n        Cartesian2.clone(mouseMovement.endPosition, result.endPosition);\n    }\n\n    function listenMouseMove(aggregator, modifier) {\n        var update = aggregator._update;\n        var movement = aggregator._movement;\n        var lastMovement = aggregator._lastMovement;\n        var isDown = aggregator._isDown;\n\n        for ( var typeName in CameraEventType) {\n            if (CameraEventType.hasOwnProperty(typeName)) {\n                var type = CameraEventType[typeName];\n                if (defined(type)) {\n                    var key = getKey(type, modifier);\n                    update[key] = true;\n\n                    if (!defined(aggregator._lastMovement[key])) {\n                        aggregator._lastMovement[key] = {\n                            startPosition : new Cartesian2(),\n                            endPosition : new Cartesian2(),\n                            valid : false\n                        };\n                    }\n\n                    if (!defined(aggregator._movement[key])) {\n                        aggregator._movement[key] = {\n                            startPosition : new Cartesian2(),\n                            endPosition : new Cartesian2()\n                        };\n                    }\n                }\n            }\n        }\n\n        aggregator._eventHandler.setInputAction(function(mouseMovement) {\n            for ( var typeName in CameraEventType) {\n                if (CameraEventType.hasOwnProperty(typeName)) {\n                    var type = CameraEventType[typeName];\n                    if (defined(type)) {\n                        var key = getKey(type, modifier);\n                        if (isDown[key]) {\n                            if (!update[key]) {\n                                Cartesian2.clone(mouseMovement.endPosition, movement[key].endPosition);\n                            } else {\n                                cloneMouseMovement(movement[key], lastMovement[key]);\n                                lastMovement[key].valid = true;\n                                cloneMouseMovement(mouseMovement, movement[key]);\n                                update[key] = false;\n                            }\n                        }\n                    }\n                }\n            }\n\n            Cartesian2.clone(mouseMovement.endPosition, aggregator._currentMousePosition);\n        }, ScreenSpaceEventType.MOUSE_MOVE, modifier);\n    }\n\n    /**\n     * Aggregates input events. For example, suppose the following inputs are received between frames:\n     * left mouse button down, mouse move, mouse move, left mouse button up. These events will be aggregated into\n     * one event with a start and end position of the mouse.\n     *\n     * @alias CameraEventAggregator\n     * @constructor\n     *\n     * @param {Canvas} [canvas=document] The element to handle events for.\n     *\n     * @see ScreenSpaceEventHandler\n     */\n    function CameraEventAggregator(canvas) {\n        \n\n        this._eventHandler = new ScreenSpaceEventHandler(canvas);\n\n        this._update = {};\n        this._movement = {};\n        this._lastMovement = {};\n        this._isDown = {};\n        this._eventStartPosition = {};\n        this._pressTime = {};\n        this._releaseTime = {};\n\n        this._buttonsDown = 0;\n\n        this._currentMousePosition = new Cartesian2();\n\n        listenToWheel(this, undefined);\n        listenToPinch(this, undefined, canvas);\n        listenMouseButtonDownUp(this, undefined, CameraEventType.LEFT_DRAG);\n        listenMouseButtonDownUp(this, undefined, CameraEventType.RIGHT_DRAG);\n        listenMouseButtonDownUp(this, undefined, CameraEventType.MIDDLE_DRAG);\n        listenMouseMove(this, undefined);\n\n        for ( var modifierName in KeyboardEventModifier) {\n            if (KeyboardEventModifier.hasOwnProperty(modifierName)) {\n                var modifier = KeyboardEventModifier[modifierName];\n                if (defined(modifier)) {\n                    listenToWheel(this, modifier);\n                    listenToPinch(this, modifier, canvas);\n                    listenMouseButtonDownUp(this, modifier, CameraEventType.LEFT_DRAG);\n                    listenMouseButtonDownUp(this, modifier, CameraEventType.RIGHT_DRAG);\n                    listenMouseButtonDownUp(this, modifier, CameraEventType.MIDDLE_DRAG);\n                    listenMouseMove(this, modifier);\n                }\n            }\n        }\n    }\n\n    Object.defineProperties(CameraEventAggregator.prototype, {\n        /**\n         * Gets the current mouse position.\n         * @memberof CameraEventAggregator.prototype\n         * @type {Cartesian2}\n         */\n        currentMousePosition : {\n            get : function() {\n                return this._currentMousePosition;\n            }\n        },\n\n        /**\n         * Gets whether any mouse button is down, a touch has started, or the wheel has been moved.\n         * @memberof CameraEventAggregator.prototype\n         * @type {Boolean}\n         */\n        anyButtonDown : {\n            get : function() {\n                var wheelMoved = !this._update[getKey(CameraEventType.WHEEL)] ||\n                                 !this._update[getKey(CameraEventType.WHEEL, KeyboardEventModifier.SHIFT)] ||\n                                 !this._update[getKey(CameraEventType.WHEEL, KeyboardEventModifier.CTRL)] ||\n                                 !this._update[getKey(CameraEventType.WHEEL, KeyboardEventModifier.ALT)];\n                return this._buttonsDown > 0 || wheelMoved;\n            }\n        }\n    });\n\n    /**\n     * Gets if a mouse button down or touch has started and has been moved.\n     *\n     * @param {CameraEventType} type The camera event type.\n     * @param {KeyboardEventModifier} [modifier] The keyboard modifier.\n     * @returns {Boolean} Returns <code>true</code> if a mouse button down or touch has started and has been moved; otherwise, <code>false</code>\n     */\n    CameraEventAggregator.prototype.isMoving = function(type, modifier) {\n        \n\n        var key = getKey(type, modifier);\n        return !this._update[key];\n    };\n\n    /**\n     * Gets the aggregated start and end position of the current event.\n     *\n     * @param {CameraEventType} type The camera event type.\n     * @param {KeyboardEventModifier} [modifier] The keyboard modifier.\n     * @returns {Object} An object with two {@link Cartesian2} properties: <code>startPosition</code> and <code>endPosition</code>.\n     */\n    CameraEventAggregator.prototype.getMovement = function(type, modifier) {\n        \n\n        var key = getKey(type, modifier);\n        var movement = this._movement[key];\n        return movement;\n    };\n\n    /**\n     * Gets the start and end position of the last move event (not the aggregated event).\n     *\n     * @param {CameraEventType} type The camera event type.\n     * @param {KeyboardEventModifier} [modifier] The keyboard modifier.\n     * @returns {Object|undefined} An object with two {@link Cartesian2} properties: <code>startPosition</code> and <code>endPosition</code> or <code>undefined</code>.\n     */\n    CameraEventAggregator.prototype.getLastMovement = function(type, modifier) {\n        \n\n        var key = getKey(type, modifier);\n        var lastMovement = this._lastMovement[key];\n        if (lastMovement.valid) {\n            return lastMovement;\n        }\n\n        return undefined;\n    };\n\n    /**\n     * Gets whether the mouse button is down or a touch has started.\n     *\n     * @param {CameraEventType} type The camera event type.\n     * @param {KeyboardEventModifier} [modifier] The keyboard modifier.\n     * @returns {Boolean} Whether the mouse button is down or a touch has started.\n     */\n    CameraEventAggregator.prototype.isButtonDown = function(type, modifier) {\n        \n\n        var key = getKey(type, modifier);\n        return this._isDown[key];\n    };\n\n    /**\n     * Gets the mouse position that started the aggregation.\n     *\n     * @param {CameraEventType} type The camera event type.\n     * @param {KeyboardEventModifier} [modifier] The keyboard modifier.\n     * @returns {Cartesian2} The mouse position.\n     */\n    CameraEventAggregator.prototype.getStartMousePosition = function(type, modifier) {\n        \n\n        if (type === CameraEventType.WHEEL) {\n            return this._currentMousePosition;\n        }\n\n        var key = getKey(type, modifier);\n        return this._eventStartPosition[key];\n    };\n\n    /**\n     * Gets the time the button was pressed or the touch was started.\n     *\n     * @param {CameraEventType} type The camera event type.\n     * @param {KeyboardEventModifier} [modifier] The keyboard modifier.\n     * @returns {Date} The time the button was pressed or the touch was started.\n     */\n    CameraEventAggregator.prototype.getButtonPressTime = function(type, modifier) {\n        \n\n        var key = getKey(type, modifier);\n        return this._pressTime[key];\n    };\n\n    /**\n     * Gets the time the button was released or the touch was ended.\n     *\n     * @param {CameraEventType} type The camera event type.\n     * @param {KeyboardEventModifier} [modifier] The keyboard modifier.\n     * @returns {Date} The time the button was released or the touch was ended.\n     */\n    CameraEventAggregator.prototype.getButtonReleaseTime = function(type, modifier) {\n        \n\n        var key = getKey(type, modifier);\n        return this._releaseTime[key];\n    };\n\n    /**\n     * Signals that all of the events have been handled and the aggregator should be reset to handle new events.\n     */\n    CameraEventAggregator.prototype.reset = function() {\n        for ( var name in this._update) {\n            if (this._update.hasOwnProperty(name)) {\n                this._update[name] = true;\n            }\n        }\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <br /><br />\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     *\n     * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n     *\n     * @see CameraEventAggregator#destroy\n     */\n    CameraEventAggregator.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Removes mouse listeners held by this object.\n     * <br /><br />\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     *\n     * @example\n     * handler = handler && handler.destroy();\n     *\n     * @see CameraEventAggregator#isDestroyed\n     */\n    CameraEventAggregator.prototype.destroy = function() {\n        this._eventHandler = this._eventHandler && this._eventHandler.destroy();\n        return destroyObject(this);\n    };\nexport default CameraEventAggregator;\n","import Cartesian2 from '../Core/Cartesian2.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Cartesian4 from '../Core/Cartesian4.js';\nimport Cartographic from '../Core/Cartographic.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport Ellipsoid from '../Core/Ellipsoid.js';\nimport HeadingPitchRoll from '../Core/HeadingPitchRoll.js';\nimport IntersectionTests from '../Core/IntersectionTests.js';\nimport KeyboardEventModifier from '../Core/KeyboardEventModifier.js';\nimport CesiumMath from '../Core/Math.js';\nimport Matrix3 from '../Core/Matrix3.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport OrthographicFrustum from '../Core/OrthographicFrustum.js';\nimport Plane from '../Core/Plane.js';\nimport Quaternion from '../Core/Quaternion.js';\nimport Ray from '../Core/Ray.js';\nimport Transforms from '../Core/Transforms.js';\nimport CameraEventAggregator from './CameraEventAggregator.js';\nimport CameraEventType from './CameraEventType.js';\nimport MapMode2D from './MapMode2D.js';\nimport SceneMode from './SceneMode.js';\nimport SceneTransforms from './SceneTransforms.js';\nimport TweenCollection from './TweenCollection.js';\n\n    /**\n     * Modifies the camera position and orientation based on mouse input to a canvas.\n     * @alias ScreenSpaceCameraController\n     * @constructor\n     *\n     * @param {Scene} scene The scene.\n     */\n    function ScreenSpaceCameraController(scene) {\n        \n\n        /**\n         * If true, inputs are allowed conditionally with the flags enableTranslate, enableZoom,\n         * enableRotate, enableTilt, and enableLook.  If false, all inputs are disabled.\n         *\n         * NOTE: This setting is for temporary use cases, such as camera flights and\n         * drag-selection of regions (see Picking demo).  It is typically set to false at the\n         * start of such events, and set true on completion.  To keep inputs disabled\n         * past the end of camera flights, you must use the other booleans (enableTranslate,\n         * enableZoom, enableRotate, enableTilt, and enableLook).\n         * @type {Boolean}\n         * @default true\n         */\n        this.enableInputs = true;\n        /**\n         * If true, allows the user to pan around the map.  If false, the camera stays locked at the current position.\n         * This flag only applies in 2D and Columbus view modes.\n         * @type {Boolean}\n         * @default true\n         */\n        this.enableTranslate = true;\n        /**\n         * If true, allows the user to zoom in and out.  If false, the camera is locked to the current distance from the ellipsoid.\n         * @type {Boolean}\n         * @default true\n         */\n        this.enableZoom = true;\n        /**\n         * If true, allows the user to rotate the world which translates the user's position.\n         * This flag only applies in 2D and 3D.\n         * @type {Boolean}\n         * @default true\n         */\n        this.enableRotate = true;\n        /**\n         * If true, allows the user to tilt the camera.  If false, the camera is locked to the current heading.\n         * This flag only applies in 3D and Columbus view.\n         * @type {Boolean}\n         * @default true\n         */\n        this.enableTilt = true;\n        /**\n         * If true, allows the user to use free-look. If false, the camera view direction can only be changed through translating\n         * or rotating. This flag only applies in 3D and Columbus view modes.\n         * @type {Boolean}\n         * @default true\n         */\n        this.enableLook = true;\n        /**\n         * A parameter in the range <code>[0, 1)</code> used to determine how long\n         * the camera will continue to spin because of inertia.\n         * With value of zero, the camera will have no inertia.\n         * @type {Number}\n         * @default 0.9\n         */\n        this.inertiaSpin = 0.9;\n        /**\n         * A parameter in the range <code>[0, 1)</code> used to determine how long\n         * the camera will continue to translate because of inertia.\n         * With value of zero, the camera will have no inertia.\n         * @type {Number}\n         * @default 0.9\n         */\n        this.inertiaTranslate = 0.9;\n        /**\n         * A parameter in the range <code>[0, 1)</code> used to determine how long\n         * the camera will continue to zoom because of inertia.\n         * With value of zero, the camera will have no inertia.\n         * @type {Number}\n         * @default 0.8\n         */\n        this.inertiaZoom = 0.8;\n        /**\n         * A parameter in the range <code>[0, 1)</code> used to limit the range\n         * of various user inputs to a percentage of the window width/height per animation frame.\n         * This helps keep the camera under control in low-frame-rate situations.\n         * @type {Number}\n         * @default 0.1\n         */\n        this.maximumMovementRatio = 0.1;\n        /**\n         * Sets the duration, in seconds, of the bounce back animations in 2D and Columbus view.\n         * @type {Number}\n         * @default 3.0\n         */\n        this.bounceAnimationTime = 3.0;\n        /**\n         * The minimum magnitude, in meters, of the camera position when zooming. Defaults to 1.0.\n         * @type {Number}\n         * @default 1.0\n         */\n        this.minimumZoomDistance = 1.0;\n        /**\n         * The maximum magnitude, in meters, of the camera position when zooming. Defaults to positive infinity.\n         * @type {Number}\n         * @default {@link Number.POSITIVE_INFINITY}\n         */\n        this.maximumZoomDistance = Number.POSITIVE_INFINITY;\n        /**\n         * The input that allows the user to pan around the map. This only applies in 2D and Columbus view modes.\n         * <p>\n         * The type came be a {@link CameraEventType}, <code>undefined</code>, an object with <code>eventType</code>\n         * and <code>modifier</code> properties with types <code>CameraEventType</code> and {@link KeyboardEventModifier},\n         * or an array of any of the preceding.\n         * </p>\n         * @type {CameraEventType|Array|undefined}\n         * @default {@link CameraEventType.LEFT_DRAG}\n         */\n        this.translateEventTypes = CameraEventType.LEFT_DRAG;\n        /**\n         * The input that allows the user to zoom in/out.\n         * <p>\n         * The type came be a {@link CameraEventType}, <code>undefined</code>, an object with <code>eventType</code>\n         * and <code>modifier</code> properties with types <code>CameraEventType</code> and {@link KeyboardEventModifier},\n         * or an array of any of the preceding.\n         * </p>\n         * @type {CameraEventType|Array|undefined}\n         * @default [{@link CameraEventType.RIGHT_DRAG}, {@link CameraEventType.WHEEL}, {@link CameraEventType.PINCH}]\n         */\n        this.zoomEventTypes = [CameraEventType.RIGHT_DRAG, CameraEventType.WHEEL, CameraEventType.PINCH];\n        /**\n         * The input that allows the user to rotate around the globe or another object. This only applies in 3D and Columbus view modes.\n         * <p>\n         * The type came be a {@link CameraEventType}, <code>undefined</code>, an object with <code>eventType</code>\n         * and <code>modifier</code> properties with types <code>CameraEventType</code> and {@link KeyboardEventModifier},\n         * or an array of any of the preceding.\n         * </p>\n         * @type {CameraEventType|Array|undefined}\n         * @default {@link CameraEventType.LEFT_DRAG}\n         */\n        this.rotateEventTypes = CameraEventType.LEFT_DRAG;\n        /**\n         * The input that allows the user to tilt in 3D and Columbus view or twist in 2D.\n         * <p>\n         * The type came be a {@link CameraEventType}, <code>undefined</code>, an object with <code>eventType</code>\n         * and <code>modifier</code> properties with types <code>CameraEventType</code> and {@link KeyboardEventModifier},\n         * or an array of any of the preceding.\n         * </p>\n         * @type {CameraEventType|Array|undefined}\n         * @default [{@link CameraEventType.MIDDLE_DRAG}, {@link CameraEventType.PINCH}, {\n         *     eventType : {@link CameraEventType.LEFT_DRAG},\n         *     modifier : {@link KeyboardEventModifier.CTRL}\n         * }, {\n         *     eventType : {@link CameraEventType.RIGHT_DRAG},\n         *     modifier : {@link KeyboardEventModifier.CTRL}\n         * }]\n         */\n        this.tiltEventTypes = [CameraEventType.MIDDLE_DRAG, CameraEventType.PINCH, {\n            eventType : CameraEventType.LEFT_DRAG,\n            modifier : KeyboardEventModifier.CTRL\n        }, {\n            eventType : CameraEventType.RIGHT_DRAG,\n            modifier : KeyboardEventModifier.CTRL\n        }];\n        /**\n         * The input that allows the user to change the direction the camera is viewing. This only applies in 3D and Columbus view modes.\n         * <p>\n         * The type came be a {@link CameraEventType}, <code>undefined</code>, an object with <code>eventType</code>\n         * and <code>modifier</code> properties with types <code>CameraEventType</code> and {@link KeyboardEventModifier},\n         * or an array of any of the preceding.\n         * </p>\n         * @type {CameraEventType|Array|undefined}\n         * @default { eventType : {@link CameraEventType.LEFT_DRAG}, modifier : {@link KeyboardEventModifier.SHIFT} }\n         */\n        this.lookEventTypes = {\n            eventType : CameraEventType.LEFT_DRAG,\n            modifier : KeyboardEventModifier.SHIFT\n        };\n        /**\n         * The minimum height the camera must be before picking the terrain instead of the ellipsoid.\n         * @type {Number}\n         * @default 150000.0\n         */\n        this.minimumPickingTerrainHeight = 150000.0;\n        this._minimumPickingTerrainHeight = this.minimumPickingTerrainHeight;\n        /**\n         * The minimum height the camera must be before testing for collision with terrain.\n         * @type {Number}\n         * @default 15000.0\n         */\n        this.minimumCollisionTerrainHeight = 15000.0;\n        this._minimumCollisionTerrainHeight = this.minimumCollisionTerrainHeight;\n        /**\n         * The minimum height the camera must be before switching from rotating a track ball to\n         * free look when clicks originate on the sky on in space.\n         * @type {Number}\n         * @default 7500000.0\n         */\n        this.minimumTrackBallHeight = 7500000.0;\n        this._minimumTrackBallHeight = this.minimumTrackBallHeight;\n        /**\n         * Enables or disables camera collision detection with terrain.\n         * @type {Boolean}\n         * @default true\n         */\n        this.enableCollisionDetection = true;\n\n        this._scene = scene;\n        this._globe = undefined;\n        this._ellipsoid = undefined;\n\n        this._aggregator = new CameraEventAggregator(scene.canvas);\n\n        this._lastInertiaSpinMovement = undefined;\n        this._lastInertiaZoomMovement = undefined;\n        this._lastInertiaTranslateMovement = undefined;\n        this._lastInertiaTiltMovement = undefined;\n\n        this._tweens = new TweenCollection();\n        this._tween = undefined;\n\n        this._horizontalRotationAxis = undefined;\n\n        this._tiltCenterMousePosition = new Cartesian2(-1.0, -1.0);\n        this._tiltCenter = new Cartesian3();\n        this._rotateMousePosition = new Cartesian2(-1.0, -1.0);\n        this._rotateStartPosition = new Cartesian3();\n        this._strafeStartPosition = new Cartesian3();\n        this._zoomMouseStart = new Cartesian2(-1.0, -1.0);\n        this._zoomWorldPosition = new Cartesian3();\n        this._useZoomWorldPosition = false;\n        this._tiltCVOffMap = false;\n        this._looking = false;\n        this._rotating = false;\n        this._strafing = false;\n        this._zoomingOnVector = false;\n        this._rotatingZoom = false;\n        this._adjustedHeightForTerrain = false;\n\n        var projection = scene.mapProjection;\n        this._maxCoord = projection.project(new Cartographic(Math.PI, CesiumMath.PI_OVER_TWO));\n\n        // Constants, Make any of these public?\n        this._zoomFactor = 5.0;\n        this._rotateFactor = undefined;\n        this._rotateRateRangeAdjustment = undefined;\n        this._maximumRotateRate = 1.77;\n        this._minimumRotateRate = 1.0 / 5000.0;\n        this._minimumZoomRate = 20.0;\n        this._maximumZoomRate = 5906376272000.0;  // distance from the Sun to Pluto in meters.\n    }\n\n    function decay(time, coefficient) {\n        if (time < 0) {\n            return 0.0;\n        }\n\n        var tau = (1.0 - coefficient) * 25.0;\n        return Math.exp(-tau * time);\n    }\n\n    function sameMousePosition(movement) {\n        return Cartesian2.equalsEpsilon(movement.startPosition, movement.endPosition, CesiumMath.EPSILON14);\n    }\n\n    // If the time between mouse down and mouse up is not between\n    // these thresholds, the camera will not move with inertia.\n    // This value is probably dependent on the browser and/or the\n    // hardware. Should be investigated further.\n    var inertiaMaxClickTimeThreshold = 0.4;\n\n    function maintainInertia(aggregator, type, modifier, decayCoef, action, object, lastMovementName) {\n        var movementState = object[lastMovementName];\n        if (!defined(movementState)) {\n            movementState = object[lastMovementName] = {\n                startPosition : new Cartesian2(),\n                endPosition : new Cartesian2(),\n                motion : new Cartesian2(),\n                active : false\n            };\n        }\n\n        var ts = aggregator.getButtonPressTime(type, modifier);\n        var tr = aggregator.getButtonReleaseTime(type, modifier);\n\n        var threshold = ts && tr && ((tr.getTime() - ts.getTime()) / 1000.0);\n        var now = new Date();\n        var fromNow = tr && ((now.getTime() - tr.getTime()) / 1000.0);\n\n        if (ts && tr && threshold < inertiaMaxClickTimeThreshold) {\n            var d = decay(fromNow, decayCoef);\n\n            if (!movementState.active) {\n                var lastMovement = aggregator.getLastMovement(type, modifier);\n                if (!defined(lastMovement) || sameMousePosition(lastMovement)) {\n                    return;\n                }\n\n                movementState.motion.x = (lastMovement.endPosition.x - lastMovement.startPosition.x) * 0.5;\n                movementState.motion.y = (lastMovement.endPosition.y - lastMovement.startPosition.y) * 0.5;\n\n                movementState.startPosition = Cartesian2.clone(lastMovement.startPosition, movementState.startPosition);\n\n                movementState.endPosition = Cartesian2.multiplyByScalar(movementState.motion, d, movementState.endPosition);\n                movementState.endPosition = Cartesian2.add(movementState.startPosition, movementState.endPosition, movementState.endPosition);\n\n                movementState.active = true;\n            } else {\n                movementState.startPosition = Cartesian2.clone(movementState.endPosition, movementState.startPosition);\n\n                movementState.endPosition = Cartesian2.multiplyByScalar(movementState.motion, d, movementState.endPosition);\n                movementState.endPosition = Cartesian2.add(movementState.startPosition, movementState.endPosition, movementState.endPosition);\n\n                movementState.motion = Cartesian2.clone(Cartesian2.ZERO, movementState.motion);\n            }\n\n            // If value from the decreasing exponential function is close to zero,\n            // the end coordinates may be NaN.\n            if (isNaN(movementState.endPosition.x) || isNaN(movementState.endPosition.y) || Cartesian2.distance(movementState.startPosition, movementState.endPosition) < 0.5) {\n                movementState.active = false;\n                return;\n            }\n\n            if (!aggregator.isButtonDown(type, modifier)) {\n                var startPosition = aggregator.getStartMousePosition(type, modifier);\n                action(object, startPosition, movementState);\n            }\n        } else {\n            movementState.active = false;\n        }\n    }\n\n    var scratchEventTypeArray = [];\n\n    function reactToInput(controller, enabled, eventTypes, action, inertiaConstant, inertiaStateName) {\n        if (!defined(eventTypes)) {\n            return;\n        }\n\n        var aggregator = controller._aggregator;\n\n        if (!Array.isArray(eventTypes)) {\n            scratchEventTypeArray[0] = eventTypes;\n            eventTypes = scratchEventTypeArray;\n        }\n\n        var length = eventTypes.length;\n        for (var i = 0; i < length; ++i) {\n            var eventType = eventTypes[i];\n            var type = defined(eventType.eventType) ? eventType.eventType : eventType;\n            var modifier = eventType.modifier;\n\n            var movement = aggregator.isMoving(type, modifier) && aggregator.getMovement(type, modifier);\n            var startPosition = aggregator.getStartMousePosition(type, modifier);\n\n            if (controller.enableInputs && enabled) {\n                if (movement) {\n                    action(controller, startPosition, movement);\n                } else if (inertiaConstant < 1.0) {\n                    maintainInertia(aggregator, type, modifier, inertiaConstant, action, controller, inertiaStateName);\n                }\n            }\n        }\n    }\n\n    var scratchZoomPickRay = new Ray();\n    var scratchPickCartesian = new Cartesian3();\n    var scratchZoomOffset = new Cartesian2();\n    var scratchZoomDirection = new Cartesian3();\n    var scratchCenterPixel = new Cartesian2();\n    var scratchCenterPosition = new Cartesian3();\n    var scratchPositionNormal = new Cartesian3();\n    var scratchPickNormal = new Cartesian3();\n    var scratchZoomAxis = new Cartesian3();\n    var scratchCameraPositionNormal = new Cartesian3();\n\n    // Scratch variables used in zooming algorithm\n    var scratchTargetNormal = new Cartesian3();\n    var scratchCameraPosition = new Cartesian3();\n    var scratchCameraUpNormal = new Cartesian3();\n    var scratchCameraRightNormal = new Cartesian3();\n    var scratchForwardNormal = new Cartesian3();\n    var scratchPositionToTarget = new Cartesian3();\n    var scratchPositionToTargetNormal = new Cartesian3();\n    var scratchPan = new Cartesian3();\n    var scratchCenterMovement = new Cartesian3();\n    var scratchCenter = new Cartesian3();\n    var scratchCartesian = new Cartesian3();\n    var scratchCartesianTwo = new Cartesian3();\n    var scratchCartesianThree = new Cartesian3();\n    var scratchZoomViewOptions = {\n      orientation: new HeadingPitchRoll()\n    };\n\n    function handleZoom(object, startPosition, movement, zoomFactor, distanceMeasure, unitPositionDotDirection) {\n        var percentage = 1.0;\n        if (defined(unitPositionDotDirection)) {\n            percentage = CesiumMath.clamp(Math.abs(unitPositionDotDirection), 0.25, 1.0);\n        }\n\n        // distanceMeasure should be the height above the ellipsoid.\n        // The zoomRate slows as it approaches the surface and stops minimumZoomDistance above it.\n        var minHeight = object.minimumZoomDistance * percentage;\n        var maxHeight = object.maximumZoomDistance;\n\n        var minDistance = distanceMeasure - minHeight;\n        var zoomRate = zoomFactor * minDistance;\n        zoomRate = CesiumMath.clamp(zoomRate, object._minimumZoomRate, object._maximumZoomRate);\n\n        var diff = movement.endPosition.y - movement.startPosition.y;\n        var rangeWindowRatio = diff / object._scene.canvas.clientHeight;\n        rangeWindowRatio = Math.min(rangeWindowRatio, object.maximumMovementRatio);\n        var distance = zoomRate * rangeWindowRatio;\n\n        if (distance > 0.0 && Math.abs(distanceMeasure - minHeight) < 1.0) {\n            return;\n        }\n\n        if (distance < 0.0 && Math.abs(distanceMeasure - maxHeight) < 1.0) {\n            return;\n        }\n\n        if (distanceMeasure - distance < minHeight) {\n            distance = distanceMeasure - minHeight - 1.0;\n        } else if (distanceMeasure - distance > maxHeight) {\n            distance = distanceMeasure - maxHeight;\n        }\n\n        var scene = object._scene;\n        var camera = scene.camera;\n        var mode = scene.mode;\n\n        var orientation = scratchZoomViewOptions.orientation;\n        orientation.heading = camera.heading;\n        orientation.pitch = camera.pitch;\n        orientation.roll = camera.roll;\n\n        if (camera.frustum instanceof OrthographicFrustum) {\n            if (Math.abs(distance) > 0.0) {\n                camera.zoomIn(distance);\n                camera._adjustOrthographicFrustum();\n            }\n            return;\n        }\n\n        var sameStartPosition = Cartesian2.equals(startPosition, object._zoomMouseStart);\n        var zoomingOnVector = object._zoomingOnVector;\n        var rotatingZoom = object._rotatingZoom;\n        var pickedPosition;\n\n        if (!sameStartPosition) {\n            object._zoomMouseStart = Cartesian2.clone(startPosition, object._zoomMouseStart);\n\n            if (defined(object._globe)) {\n                if (mode === SceneMode.SCENE2D) {\n                    pickedPosition = camera.getPickRay(startPosition, scratchZoomPickRay).origin;\n                    pickedPosition = Cartesian3.fromElements(pickedPosition.y, pickedPosition.z, pickedPosition.x);\n                } else {\n                    pickedPosition = pickGlobe(object, startPosition, scratchPickCartesian);\n                }\n            }\n            if (defined(pickedPosition)) {\n                object._useZoomWorldPosition = true;\n                object._zoomWorldPosition = Cartesian3.clone(pickedPosition, object._zoomWorldPosition);\n            } else {\n                object._useZoomWorldPosition = false;\n            }\n\n            zoomingOnVector = object._zoomingOnVector = false;\n            rotatingZoom = object._rotatingZoom = false;\n        }\n\n        if (!object._useZoomWorldPosition) {\n            camera.zoomIn(distance);\n            return;\n        }\n\n        var zoomOnVector = mode === SceneMode.COLUMBUS_VIEW;\n\n        if (camera.positionCartographic.height < 2000000) {\n            rotatingZoom = true;\n        }\n\n        if (!sameStartPosition || rotatingZoom) {\n            if (mode === SceneMode.SCENE2D) {\n                var worldPosition = object._zoomWorldPosition;\n                var endPosition = camera.position;\n\n                if (!Cartesian3.equals(worldPosition, endPosition) && camera.positionCartographic.height < object._maxCoord.x * 2.0) {\n                    var savedX = camera.position.x;\n\n                    var direction = Cartesian3.subtract(worldPosition, endPosition, scratchZoomDirection);\n                    Cartesian3.normalize(direction, direction);\n\n                    var d = Cartesian3.distance(worldPosition, endPosition) * distance / (camera.getMagnitude() * 0.5);\n                    camera.move(direction, d * 0.5);\n\n                    if ((camera.position.x < 0.0 && savedX > 0.0) || (camera.position.x > 0.0 && savedX < 0.0)) {\n                        pickedPosition = camera.getPickRay(startPosition, scratchZoomPickRay).origin;\n                        pickedPosition = Cartesian3.fromElements(pickedPosition.y, pickedPosition.z, pickedPosition.x);\n                        object._zoomWorldPosition = Cartesian3.clone(pickedPosition, object._zoomWorldPosition);\n                    }\n                }\n            } else if (mode === SceneMode.SCENE3D) {\n                var cameraPositionNormal = Cartesian3.normalize(camera.position, scratchCameraPositionNormal);\n                if (camera.positionCartographic.height < 3000.0 && Math.abs(Cartesian3.dot(camera.direction, cameraPositionNormal)) < 0.6) {\n                    zoomOnVector = true;\n                } else {\n                    var canvas = scene.canvas;\n\n                    var centerPixel = scratchCenterPixel;\n                    centerPixel.x = canvas.clientWidth / 2;\n                    centerPixel.y = canvas.clientHeight / 2;\n                    var centerPosition = pickGlobe(object, centerPixel, scratchCenterPosition);\n                    // If centerPosition is not defined, it means the globe does not cover the center position of screen\n\n                    if (defined(centerPosition) && camera.positionCartographic.height < 1000000) {\n\n                        var cameraPosition = scratchCameraPosition;\n                        Cartesian3.clone(camera.position, cameraPosition);\n                        var target = object._zoomWorldPosition;\n\n                        var targetNormal = scratchTargetNormal;\n\n                        targetNormal = Cartesian3.normalize(target, targetNormal);\n\n                        if (Cartesian3.dot(targetNormal, cameraPositionNormal) < 0.0) {\n                            return;\n                        }\n\n                        var center = scratchCenter;\n                        var forward = scratchForwardNormal;\n                        Cartesian3.clone(camera.direction, forward);\n                        Cartesian3.add(cameraPosition, Cartesian3.multiplyByScalar(forward, 1000, scratchCartesian), center);\n\n                        var positionToTarget = scratchPositionToTarget;\n                        var positionToTargetNormal = scratchPositionToTargetNormal;\n                        Cartesian3.subtract(target, cameraPosition, positionToTarget);\n\n                        Cartesian3.normalize(positionToTarget, positionToTargetNormal);\n\n                        var alphaDot = Cartesian3.dot(cameraPositionNormal, positionToTargetNormal);\n                        if (alphaDot >= 0.0) {\n                            // We zoomed past the target, and this zoom is not valid anymore.\n                            // This line causes the next zoom movement to pick a new starting point.\n                            object._zoomMouseStart.x = -1;\n                            return;\n                        }\n                        var alpha = Math.acos(-alphaDot);\n                        var cameraDistance = Cartesian3.magnitude( cameraPosition );\n                        var targetDistance = Cartesian3.magnitude( target );\n                        var remainingDistance = cameraDistance - distance;\n                        var positionToTargetDistance = Cartesian3.magnitude(positionToTarget);\n\n                        var gamma = Math.asin( CesiumMath.clamp( positionToTargetDistance / targetDistance * Math.sin(alpha), -1.0, 1.0 ) );\n                        var delta = Math.asin( CesiumMath.clamp( remainingDistance / targetDistance * Math.sin(alpha), -1.0, 1.0 ) );\n                        var beta = gamma - delta + alpha;\n\n                        var up = scratchCameraUpNormal;\n                        Cartesian3.normalize(cameraPosition, up);\n                        var right = scratchCameraRightNormal;\n                        right = Cartesian3.cross(positionToTargetNormal, up, right);\n                        right = Cartesian3.normalize(right, right );\n\n                        Cartesian3.normalize( Cartesian3.cross(up, right, scratchCartesian), forward );\n\n                        // Calculate new position to move to\n                        Cartesian3.multiplyByScalar(Cartesian3.normalize(center, scratchCartesian), (Cartesian3.magnitude(center) - distance), center);\n                        Cartesian3.normalize(cameraPosition, cameraPosition);\n                        Cartesian3.multiplyByScalar(cameraPosition, remainingDistance, cameraPosition);\n\n                        // Pan\n                        var pMid = scratchPan;\n                        Cartesian3.multiplyByScalar(Cartesian3.add(\n                            Cartesian3.multiplyByScalar(up, Math.cos(beta) - 1, scratchCartesianTwo),\n                            Cartesian3.multiplyByScalar(forward, Math.sin(beta), scratchCartesianThree),\n                            scratchCartesian\n                        ), remainingDistance, pMid);\n                        Cartesian3.add(cameraPosition, pMid, cameraPosition);\n\n                        Cartesian3.normalize(center, up);\n                        Cartesian3.normalize( Cartesian3.cross(up, right, scratchCartesian), forward );\n\n                        var cMid = scratchCenterMovement;\n                        Cartesian3.multiplyByScalar(Cartesian3.add(\n                            Cartesian3.multiplyByScalar(up, Math.cos(beta) - 1, scratchCartesianTwo),\n                            Cartesian3.multiplyByScalar(forward, Math.sin(beta), scratchCartesianThree),\n                            scratchCartesian\n                        ), Cartesian3.magnitude(center), cMid);\n                        Cartesian3.add(center, cMid, center);\n\n                        // Update camera\n\n                        // Set new position\n                        Cartesian3.clone(cameraPosition, camera.position);\n\n                        // Set new direction\n                        Cartesian3.normalize(Cartesian3.subtract(center, cameraPosition, scratchCartesian), camera.direction);\n                        Cartesian3.clone(camera.direction, camera.direction);\n\n                        // Set new right & up vectors\n                        Cartesian3.cross(camera.direction, camera.up, camera.right);\n                        Cartesian3.cross(camera.right, camera.direction, camera.up);\n\n                        camera.setView(scratchZoomViewOptions);\n                        return;\n                    }\n\n                    if (defined(centerPosition)) {\n                        var positionNormal = Cartesian3.normalize(centerPosition, scratchPositionNormal);\n                        var pickedNormal = Cartesian3.normalize(object._zoomWorldPosition, scratchPickNormal);\n                        var dotProduct = Cartesian3.dot(pickedNormal, positionNormal);\n\n                        if (dotProduct > 0.0 && dotProduct < 1.0) {\n                            var angle = CesiumMath.acosClamped(dotProduct);\n                            var axis = Cartesian3.cross(pickedNormal, positionNormal, scratchZoomAxis);\n\n                            var denom = Math.abs(angle) > CesiumMath.toRadians(20.0) ? camera.positionCartographic.height * 0.75 : camera.positionCartographic.height - distance;\n                            var scalar = distance / denom;\n                            camera.rotate(axis, angle * scalar);\n                        }\n                    } else {\n                        zoomOnVector = true;\n                    }\n                }\n            }\n\n            object._rotatingZoom = !zoomOnVector;\n        }\n\n        if ((!sameStartPosition && zoomOnVector) || zoomingOnVector) {\n            var ray;\n            var zoomMouseStart = SceneTransforms.wgs84ToWindowCoordinates(scene, object._zoomWorldPosition, scratchZoomOffset);\n            if (mode !== SceneMode.COLUMBUS_VIEW && Cartesian2.equals(startPosition, object._zoomMouseStart) && defined(zoomMouseStart)) {\n                ray = camera.getPickRay(zoomMouseStart, scratchZoomPickRay);\n            } else {\n                ray = camera.getPickRay(startPosition, scratchZoomPickRay);\n            }\n\n            var rayDirection = ray.direction;\n            if (mode === SceneMode.COLUMBUS_VIEW || mode === SceneMode.SCENE2D) {\n                Cartesian3.fromElements(rayDirection.y, rayDirection.z, rayDirection.x, rayDirection);\n            }\n\n            camera.move(rayDirection, distance);\n\n            object._zoomingOnVector = true;\n        } else {\n            camera.zoomIn(distance);\n        }\n\n        camera.setView(scratchZoomViewOptions);\n    }\n\n    var translate2DStart = new Ray();\n    var translate2DEnd = new Ray();\n    var scratchTranslateP0 = new Cartesian3();\n\n    function translate2D(controller, startPosition, movement) {\n        var scene = controller._scene;\n        var camera = scene.camera;\n        var start = camera.getPickRay(movement.startPosition, translate2DStart).origin;\n        var end = camera.getPickRay(movement.endPosition, translate2DEnd).origin;\n\n        start = Cartesian3.fromElements(start.y, start.z, start.x, start);\n        end = Cartesian3.fromElements(end.y, end.z, end.x, end);\n\n        var direction = Cartesian3.subtract(start, end, scratchTranslateP0);\n        var distance = Cartesian3.magnitude(direction);\n\n        if (distance > 0.0) {\n            Cartesian3.normalize(direction, direction);\n            camera.move(direction, distance);\n        }\n    }\n\n    function zoom2D(controller, startPosition, movement) {\n        if (defined(movement.distance)) {\n            movement = movement.distance;\n        }\n\n        var scene = controller._scene;\n        var camera = scene.camera;\n\n        handleZoom(controller, startPosition, movement, controller._zoomFactor, camera.getMagnitude());\n    }\n\n    var twist2DStart = new Cartesian2();\n    var twist2DEnd = new Cartesian2();\n\n    function twist2D(controller, startPosition, movement) {\n        if (defined(movement.angleAndHeight)) {\n            singleAxisTwist2D(controller, startPosition, movement.angleAndHeight);\n            return;\n        }\n\n        var scene = controller._scene;\n        var camera = scene.camera;\n        var canvas = scene.canvas;\n        var width = canvas.clientWidth;\n        var height = canvas.clientHeight;\n\n        var start = twist2DStart;\n        start.x = (2.0 / width) * movement.startPosition.x - 1.0;\n        start.y = (2.0 / height) * (height - movement.startPosition.y) - 1.0;\n        start = Cartesian2.normalize(start, start);\n\n        var end = twist2DEnd;\n        end.x = (2.0 / width) * movement.endPosition.x - 1.0;\n        end.y = (2.0 / height) * (height - movement.endPosition.y) - 1.0;\n        end = Cartesian2.normalize(end, end);\n\n        var startTheta = CesiumMath.acosClamped(start.x);\n        if (start.y < 0) {\n            startTheta = CesiumMath.TWO_PI - startTheta;\n        }\n        var endTheta = CesiumMath.acosClamped(end.x);\n        if (end.y < 0) {\n            endTheta = CesiumMath.TWO_PI - endTheta;\n        }\n        var theta = endTheta - startTheta;\n\n        camera.twistRight(theta);\n    }\n\n    function singleAxisTwist2D(controller, startPosition, movement) {\n        var rotateRate = controller._rotateFactor * controller._rotateRateRangeAdjustment;\n\n        if (rotateRate > controller._maximumRotateRate) {\n            rotateRate = controller._maximumRotateRate;\n        }\n\n        if (rotateRate < controller._minimumRotateRate) {\n            rotateRate = controller._minimumRotateRate;\n        }\n\n        var scene = controller._scene;\n        var camera = scene.camera;\n        var canvas = scene.canvas;\n\n        var phiWindowRatio = (movement.endPosition.x - movement.startPosition.x) / canvas.clientWidth;\n        phiWindowRatio = Math.min(phiWindowRatio, controller.maximumMovementRatio);\n\n        var deltaPhi = rotateRate * phiWindowRatio * Math.PI * 4.0;\n\n        camera.twistRight(deltaPhi);\n    }\n\n    function update2D(controller) {\n        var rotatable2D = controller._scene.mapMode2D === MapMode2D.ROTATE;\n        if (!Matrix4.equals(Matrix4.IDENTITY, controller._scene.camera.transform)) {\n            reactToInput(controller, controller.enableZoom, controller.zoomEventTypes, zoom2D, controller.inertiaZoom, '_lastInertiaZoomMovement');\n            if (rotatable2D) {\n                reactToInput(controller, controller.enableRotate, controller.translateEventTypes, twist2D, controller.inertiaSpin, '_lastInertiaSpinMovement');\n            }\n        } else {\n            reactToInput(controller, controller.enableTranslate, controller.translateEventTypes, translate2D, controller.inertiaTranslate, '_lastInertiaTranslateMovement');\n            reactToInput(controller, controller.enableZoom, controller.zoomEventTypes, zoom2D, controller.inertiaZoom, '_lastInertiaZoomMovement');\n            if (rotatable2D) {\n                reactToInput(controller, controller.enableRotate, controller.tiltEventTypes, twist2D, controller.inertiaSpin, '_lastInertiaTiltMovement');\n            }\n        }\n    }\n\n    var pickGlobeScratchRay = new Ray();\n    var scratchDepthIntersection = new Cartesian3();\n    var scratchRayIntersection = new Cartesian3();\n\n    function pickGlobe(controller, mousePosition, result) {\n        var scene = controller._scene;\n        var globe = controller._globe;\n        var camera = scene.camera;\n\n        if (!defined(globe)) {\n            return undefined;\n        }\n\n        var depthIntersection;\n        if (scene.pickPositionSupported) {\n            depthIntersection = scene.pickPositionWorldCoordinates(mousePosition, scratchDepthIntersection);\n        }\n\n        var ray = camera.getPickRay(mousePosition, pickGlobeScratchRay);\n        var rayIntersection = globe.pickWorldCoordinates(ray, scene, scratchRayIntersection);\n\n        var pickDistance = defined(depthIntersection) ? Cartesian3.distance(depthIntersection, camera.positionWC) : Number.POSITIVE_INFINITY;\n        var rayDistance = defined(rayIntersection) ? Cartesian3.distance(rayIntersection, camera.positionWC) : Number.POSITIVE_INFINITY;\n\n        if (pickDistance < rayDistance) {\n            return Cartesian3.clone(depthIntersection, result);\n        }\n\n        return Cartesian3.clone(rayIntersection, result);\n    }\n\n    var translateCVStartRay = new Ray();\n    var translateCVEndRay = new Ray();\n    var translateCVStartPos = new Cartesian3();\n    var translateCVEndPos = new Cartesian3();\n    var translatCVDifference = new Cartesian3();\n    var translateCVOrigin = new Cartesian3();\n    var translateCVPlane = new Plane(Cartesian3.UNIT_X, 0.0);\n    var translateCVStartMouse = new Cartesian2();\n    var translateCVEndMouse = new Cartesian2();\n\n    function translateCV(controller, startPosition, movement) {\n        if (!Cartesian3.equals(startPosition, controller._translateMousePosition)) {\n            controller._looking = false;\n        }\n\n        if (!Cartesian3.equals(startPosition, controller._strafeMousePosition)) {\n            controller._strafing = false;\n        }\n\n        if (controller._looking) {\n            look3D(controller, startPosition, movement);\n            return;\n        }\n\n        if (controller._strafing) {\n            strafe(controller, startPosition, movement);\n            return;\n        }\n\n        var scene = controller._scene;\n        var camera = scene.camera;\n        var startMouse = Cartesian2.clone(movement.startPosition, translateCVStartMouse);\n        var endMouse = Cartesian2.clone(movement.endPosition, translateCVEndMouse);\n        var startRay = camera.getPickRay(startMouse, translateCVStartRay);\n\n        var origin = Cartesian3.clone(Cartesian3.ZERO, translateCVOrigin);\n        var normal = Cartesian3.UNIT_X;\n\n        var globePos;\n        if (camera.position.z < controller._minimumPickingTerrainHeight) {\n            globePos = pickGlobe(controller, startMouse, translateCVStartPos);\n            if (defined(globePos)) {\n                origin.x = globePos.x;\n            }\n        }\n\n        if (origin.x > camera.position.z && defined(globePos)) {\n            Cartesian3.clone(globePos, controller._strafeStartPosition);\n            controller._strafing = true;\n            strafe(controller, startPosition, movement);\n            controller._strafeMousePosition = Cartesian2.clone(startPosition, controller._strafeMousePosition);\n            return;\n        }\n\n        var plane = Plane.fromPointNormal(origin, normal, translateCVPlane);\n\n        startRay = camera.getPickRay(startMouse, translateCVStartRay);\n        var startPlanePos = IntersectionTests.rayPlane(startRay, plane, translateCVStartPos);\n\n        var endRay = camera.getPickRay(endMouse, translateCVEndRay);\n        var endPlanePos = IntersectionTests.rayPlane(endRay, plane, translateCVEndPos);\n\n        if (!defined(startPlanePos) || !defined(endPlanePos)) {\n            controller._looking = true;\n            look3D(controller, startPosition, movement);\n            Cartesian2.clone(startPosition, controller._translateMousePosition);\n            return;\n        }\n\n        var diff = Cartesian3.subtract(startPlanePos, endPlanePos, translatCVDifference);\n        var temp = diff.x;\n        diff.x = diff.y;\n        diff.y = diff.z;\n        diff.z = temp;\n        var mag = Cartesian3.magnitude(diff);\n        if (mag > CesiumMath.EPSILON6) {\n            Cartesian3.normalize(diff, diff);\n            camera.move(diff, mag);\n        }\n    }\n\n    var rotateCVWindowPos = new Cartesian2();\n    var rotateCVWindowRay = new Ray();\n    var rotateCVCenter = new Cartesian3();\n    var rotateCVVerticalCenter = new Cartesian3();\n    var rotateCVTransform = new Matrix4();\n    var rotateCVVerticalTransform = new Matrix4();\n    var rotateCVOrigin = new Cartesian3();\n    var rotateCVPlane = new Plane(Cartesian3.UNIT_X, 0.0);\n    var rotateCVCartesian3 = new Cartesian3();\n    var rotateCVCart = new Cartographic();\n    var rotateCVOldTransform = new Matrix4();\n    var rotateCVQuaternion = new Quaternion();\n    var rotateCVMatrix = new Matrix3();\n    var tilt3DCartesian3 = new Cartesian3();\n\n    function rotateCV(controller, startPosition, movement) {\n        if (defined(movement.angleAndHeight)) {\n            movement = movement.angleAndHeight;\n        }\n\n        if (!Cartesian2.equals(startPosition, controller._tiltCenterMousePosition)) {\n            controller._tiltCVOffMap = false;\n            controller._looking = false;\n        }\n\n        if (controller._looking) {\n            look3D(controller, startPosition, movement);\n            return;\n        }\n\n        var scene = controller._scene;\n        var camera = scene.camera;\n\n        if (controller._tiltCVOffMap || !controller.onMap() || camera.position.z > controller._minimumPickingTerrainHeight) {\n            controller._tiltCVOffMap = true;\n            rotateCVOnPlane(controller, startPosition, movement);\n        } else {\n            rotateCVOnTerrain(controller, startPosition, movement);\n        }\n    }\n\n    function rotateCVOnPlane(controller, startPosition, movement) {\n        var scene = controller._scene;\n        var camera = scene.camera;\n        var canvas = scene.canvas;\n\n        var windowPosition = rotateCVWindowPos;\n        windowPosition.x = canvas.clientWidth / 2;\n        windowPosition.y = canvas.clientHeight / 2;\n        var ray = camera.getPickRay(windowPosition, rotateCVWindowRay);\n        var normal = Cartesian3.UNIT_X;\n\n        var position = ray.origin;\n        var direction = ray.direction;\n        var scalar;\n        var normalDotDirection = Cartesian3.dot(normal, direction);\n        if (Math.abs(normalDotDirection) > CesiumMath.EPSILON6) {\n            scalar = -Cartesian3.dot(normal, position) / normalDotDirection;\n        }\n\n        if (!defined(scalar) || scalar <= 0.0) {\n            controller._looking = true;\n            look3D(controller, startPosition, movement);\n            Cartesian2.clone(startPosition, controller._tiltCenterMousePosition);\n            return;\n        }\n\n        var center = Cartesian3.multiplyByScalar(direction, scalar, rotateCVCenter);\n        Cartesian3.add(position, center, center);\n\n        var projection = scene.mapProjection;\n        var ellipsoid = projection.ellipsoid;\n\n        Cartesian3.fromElements(center.y, center.z, center.x, center);\n        var cart = projection.unproject(center, rotateCVCart);\n        ellipsoid.cartographicToCartesian(cart, center);\n\n        var transform = Transforms.eastNorthUpToFixedFrame(center, ellipsoid, rotateCVTransform);\n\n        var oldGlobe = controller._globe;\n        var oldEllipsoid = controller._ellipsoid;\n        controller._globe = undefined;\n        controller._ellipsoid = Ellipsoid.UNIT_SPHERE;\n        controller._rotateFactor = 1.0;\n        controller._rotateRateRangeAdjustment = 1.0;\n\n        var oldTransform = Matrix4.clone(camera.transform, rotateCVOldTransform);\n        camera._setTransform(transform);\n\n        rotate3D(controller, startPosition, movement, Cartesian3.UNIT_Z);\n\n        camera._setTransform(oldTransform);\n        controller._globe = oldGlobe;\n        controller._ellipsoid = oldEllipsoid;\n\n        var radius = oldEllipsoid.maximumRadius;\n        controller._rotateFactor = 1.0 / radius;\n        controller._rotateRateRangeAdjustment = radius;\n    }\n\n    function rotateCVOnTerrain(controller, startPosition, movement) {\n        var scene = controller._scene;\n        var camera = scene.camera;\n\n        var center;\n        var ray;\n        var normal = Cartesian3.UNIT_X;\n\n        if (Cartesian2.equals(startPosition, controller._tiltCenterMousePosition)) {\n            center = Cartesian3.clone(controller._tiltCenter, rotateCVCenter);\n        } else {\n            if (camera.position.z < controller._minimumPickingTerrainHeight) {\n                center = pickGlobe(controller, startPosition, rotateCVCenter);\n            }\n\n            if (!defined(center)) {\n                ray = camera.getPickRay(startPosition, rotateCVWindowRay);\n                var position = ray.origin;\n                var direction = ray.direction;\n\n                var scalar;\n                var normalDotDirection = Cartesian3.dot(normal, direction);\n                if (Math.abs(normalDotDirection) > CesiumMath.EPSILON6) {\n                    scalar = -Cartesian3.dot(normal, position) / normalDotDirection;\n                }\n\n                if (!defined(scalar) || scalar <= 0.0) {\n                    controller._looking = true;\n                    look3D(controller, startPosition, movement);\n                    Cartesian2.clone(startPosition, controller._tiltCenterMousePosition);\n                    return;\n                }\n\n                center = Cartesian3.multiplyByScalar(direction, scalar, rotateCVCenter);\n                Cartesian3.add(position, center, center);\n            }\n\n            Cartesian2.clone(startPosition, controller._tiltCenterMousePosition);\n            Cartesian3.clone(center, controller._tiltCenter);\n        }\n\n        var canvas = scene.canvas;\n\n        var windowPosition = rotateCVWindowPos;\n        windowPosition.x = canvas.clientWidth / 2;\n        windowPosition.y = controller._tiltCenterMousePosition.y;\n        ray = camera.getPickRay(windowPosition, rotateCVWindowRay);\n\n        var origin = Cartesian3.clone(Cartesian3.ZERO, rotateCVOrigin);\n        origin.x = center.x;\n\n        var plane = Plane.fromPointNormal(origin, normal, rotateCVPlane);\n        var verticalCenter = IntersectionTests.rayPlane(ray, plane, rotateCVVerticalCenter);\n\n        var projection = camera._projection;\n        var ellipsoid = projection.ellipsoid;\n\n        Cartesian3.fromElements(center.y, center.z, center.x, center);\n        var cart = projection.unproject(center, rotateCVCart);\n        ellipsoid.cartographicToCartesian(cart, center);\n\n        var transform = Transforms.eastNorthUpToFixedFrame(center, ellipsoid, rotateCVTransform);\n\n        var verticalTransform;\n        if (defined(verticalCenter)) {\n            Cartesian3.fromElements(verticalCenter.y, verticalCenter.z, verticalCenter.x, verticalCenter);\n            cart = projection.unproject(verticalCenter, rotateCVCart);\n            ellipsoid.cartographicToCartesian(cart, verticalCenter);\n\n            verticalTransform = Transforms.eastNorthUpToFixedFrame(verticalCenter, ellipsoid, rotateCVVerticalTransform);\n        } else {\n            verticalTransform = transform;\n        }\n\n        var oldGlobe = controller._globe;\n        var oldEllipsoid = controller._ellipsoid;\n        controller._globe = undefined;\n        controller._ellipsoid = Ellipsoid.UNIT_SPHERE;\n        controller._rotateFactor = 1.0;\n        controller._rotateRateRangeAdjustment = 1.0;\n\n        var constrainedAxis = Cartesian3.UNIT_Z;\n\n        var oldTransform = Matrix4.clone(camera.transform, rotateCVOldTransform);\n        camera._setTransform(transform);\n\n        var tangent = Cartesian3.cross(Cartesian3.UNIT_Z, Cartesian3.normalize(camera.position, rotateCVCartesian3), rotateCVCartesian3);\n        var dot = Cartesian3.dot(camera.right, tangent);\n\n        rotate3D(controller, startPosition, movement, constrainedAxis, false, true);\n\n        camera._setTransform(verticalTransform);\n        if (dot < 0.0) {\n            if (movement.startPosition.y > movement.endPosition.y) {\n                constrainedAxis = undefined;\n            }\n\n            var oldConstrainedAxis = camera.constrainedAxis;\n            camera.constrainedAxis = undefined;\n\n            rotate3D(controller, startPosition, movement, constrainedAxis, true, false);\n\n            camera.constrainedAxis = oldConstrainedAxis;\n        } else {\n            rotate3D(controller, startPosition, movement, constrainedAxis, true, false);\n        }\n\n        if (defined(camera.constrainedAxis)) {\n            var right = Cartesian3.cross(camera.direction, camera.constrainedAxis, tilt3DCartesian3);\n            if (!Cartesian3.equalsEpsilon(right, Cartesian3.ZERO, CesiumMath.EPSILON6)) {\n                if (Cartesian3.dot(right, camera.right) < 0.0) {\n                    Cartesian3.negate(right, right);\n                }\n\n                Cartesian3.cross(right, camera.direction, camera.up);\n                Cartesian3.cross(camera.direction, camera.up, camera.right);\n\n                Cartesian3.normalize(camera.up, camera.up);\n                Cartesian3.normalize(camera.right, camera.right);\n            }\n        }\n\n        camera._setTransform(oldTransform);\n        controller._globe = oldGlobe;\n        controller._ellipsoid = oldEllipsoid;\n\n        var radius = oldEllipsoid.maximumRadius;\n        controller._rotateFactor = 1.0 / radius;\n        controller._rotateRateRangeAdjustment = radius;\n\n        var originalPosition = Cartesian3.clone(camera.positionWC, rotateCVCartesian3);\n\n        if (controller.enableCollisionDetection) {\n            adjustHeightForTerrain(controller);\n        }\n\n        if (!Cartesian3.equals(camera.positionWC, originalPosition)) {\n            camera._setTransform(verticalTransform);\n            camera.worldToCameraCoordinatesPoint(originalPosition, originalPosition);\n\n            var magSqrd = Cartesian3.magnitudeSquared(originalPosition);\n            if (Cartesian3.magnitudeSquared(camera.position) > magSqrd) {\n                Cartesian3.normalize(camera.position, camera.position);\n                Cartesian3.multiplyByScalar(camera.position, Math.sqrt(magSqrd), camera.position);\n            }\n\n            var angle = Cartesian3.angleBetween(originalPosition, camera.position);\n            var axis = Cartesian3.cross(originalPosition, camera.position, originalPosition);\n            Cartesian3.normalize(axis, axis);\n\n            var quaternion = Quaternion.fromAxisAngle(axis, angle, rotateCVQuaternion);\n            var rotation = Matrix3.fromQuaternion(quaternion, rotateCVMatrix);\n            Matrix3.multiplyByVector(rotation, camera.direction, camera.direction);\n            Matrix3.multiplyByVector(rotation, camera.up, camera.up);\n            Cartesian3.cross(camera.direction, camera.up, camera.right);\n            Cartesian3.cross(camera.right, camera.direction, camera.up);\n\n            camera._setTransform(oldTransform);\n        }\n    }\n\n    var zoomCVWindowPos = new Cartesian2();\n    var zoomCVWindowRay = new Ray();\n    var zoomCVIntersection = new Cartesian3();\n\n    function zoomCV(controller, startPosition, movement) {\n        if (defined(movement.distance)) {\n            movement = movement.distance;\n        }\n\n        var scene = controller._scene;\n        var camera = scene.camera;\n        var canvas = scene.canvas;\n\n        var windowPosition = zoomCVWindowPos;\n        windowPosition.x = canvas.clientWidth / 2;\n        windowPosition.y = canvas.clientHeight / 2;\n        var ray = camera.getPickRay(windowPosition, zoomCVWindowRay);\n\n        var intersection;\n        if (camera.position.z < controller._minimumPickingTerrainHeight) {\n            intersection = pickGlobe(controller, windowPosition, zoomCVIntersection);\n        }\n\n        var distance;\n        if (defined(intersection)) {\n            distance = Cartesian3.distance(ray.origin, intersection);\n        } else {\n            var normal = Cartesian3.UNIT_X;\n            var position = ray.origin;\n            var direction = ray.direction;\n            distance = -Cartesian3.dot(normal, position) / Cartesian3.dot(normal, direction);\n        }\n\n        handleZoom(controller, startPosition, movement, controller._zoomFactor, distance);\n    }\n\n    function updateCV(controller) {\n        var scene = controller._scene;\n        var camera = scene.camera;\n\n        if (!Matrix4.equals(Matrix4.IDENTITY, camera.transform)) {\n            reactToInput(controller, controller.enableRotate, controller.rotateEventTypes, rotate3D, controller.inertiaSpin, '_lastInertiaSpinMovement');\n            reactToInput(controller, controller.enableZoom, controller.zoomEventTypes, zoom3D, controller.inertiaZoom, '_lastInertiaZoomMovement');\n        } else {\n            var tweens = controller._tweens;\n\n            if (controller._aggregator.anyButtonDown) {\n                tweens.removeAll();\n            }\n\n            reactToInput(controller, controller.enableTilt, controller.tiltEventTypes, rotateCV, controller.inertiaSpin, '_lastInertiaTiltMovement');\n            reactToInput(controller, controller.enableTranslate, controller.translateEventTypes, translateCV, controller.inertiaTranslate, '_lastInertiaTranslateMovement');\n            reactToInput(controller, controller.enableZoom, controller.zoomEventTypes, zoomCV, controller.inertiaZoom, '_lastInertiaZoomMovement');\n            reactToInput(controller, controller.enableLook, controller.lookEventTypes, look3D);\n\n            if (!controller._aggregator.anyButtonDown &&\n                    (!defined(controller._lastInertiaZoomMovement) || !controller._lastInertiaZoomMovement.active) &&\n                    (!defined(controller._lastInertiaTranslateMovement) || !controller._lastInertiaTranslateMovement.active) &&\n                    !tweens.contains(controller._tween)) {\n                var tween = camera.createCorrectPositionTween(controller.bounceAnimationTime);\n                if (defined(tween)) {\n                    controller._tween = tweens.add(tween);\n                }\n            }\n\n            tweens.update();\n        }\n    }\n\n    var scratchStrafeRay = new Ray();\n    var scratchStrafePlane = new Plane(Cartesian3.UNIT_X, 0.0);\n    var scratchStrafeIntersection = new Cartesian3();\n    var scratchStrafeDirection = new Cartesian3();\n    var scratchMousePos = new Cartesian3();\n\n    function strafe(controller, startPosition, movement) {\n        var scene = controller._scene;\n        var camera = scene.camera;\n\n        var mouseStartPosition = pickGlobe(controller, movement.startPosition, scratchMousePos);\n        if (!defined(mouseStartPosition)) {\n            return;\n        }\n\n        var mousePosition = movement.endPosition;\n        var ray = camera.getPickRay(mousePosition, scratchStrafeRay);\n\n        var direction = Cartesian3.clone(camera.direction, scratchStrafeDirection);\n        if (scene.mode === SceneMode.COLUMBUS_VIEW) {\n            Cartesian3.fromElements(direction.z, direction.x, direction.y, direction);\n        }\n\n        var plane = Plane.fromPointNormal(mouseStartPosition, direction, scratchStrafePlane);\n        var intersection = IntersectionTests.rayPlane(ray, plane, scratchStrafeIntersection);\n        if (!defined(intersection)) {\n            return;\n        }\n\n        direction = Cartesian3.subtract(mouseStartPosition, intersection, direction);\n        if (scene.mode === SceneMode.COLUMBUS_VIEW) {\n            Cartesian3.fromElements(direction.y, direction.z, direction.x, direction);\n        }\n\n        Cartesian3.add(camera.position, direction, camera.position);\n    }\n\n    var spin3DPick = new Cartesian3();\n    var scratchCartographic = new Cartographic();\n    var scratchRadii = new Cartesian3();\n    var scratchEllipsoid = new Ellipsoid();\n    var scratchLookUp = new Cartesian3();\n\n    function spin3D(controller, startPosition, movement) {\n        var scene = controller._scene;\n        var camera = scene.camera;\n\n        if (!Matrix4.equals(camera.transform, Matrix4.IDENTITY)) {\n            rotate3D(controller, startPosition, movement);\n            return;\n        }\n\n        var magnitude;\n        var radii;\n        var ellipsoid;\n\n        var up = controller._ellipsoid.geodeticSurfaceNormal(camera.position, scratchLookUp);\n\n        var height = controller._ellipsoid.cartesianToCartographic(camera.positionWC, scratchCartographic).height;\n        var globe = controller._globe;\n\n        var mousePos;\n        var tangentPick = false;\n        if (defined(globe) && height < controller._minimumPickingTerrainHeight) {\n            mousePos = pickGlobe(controller, movement.startPosition, scratchMousePos);\n            if (defined(mousePos)) {\n                var ray = camera.getPickRay(movement.startPosition, pickGlobeScratchRay);\n                var normal = controller._ellipsoid.geodeticSurfaceNormal(mousePos);\n                tangentPick = Math.abs(Cartesian3.dot(ray.direction, normal)) < 0.05;\n\n                if (tangentPick && !controller._looking) {\n                    controller._rotating = false;\n                    controller._strafing = true;\n                }\n            }\n        }\n\n        if (Cartesian2.equals(startPosition, controller._rotateMousePosition)) {\n            if (controller._looking) {\n                look3D(controller, startPosition, movement, up);\n            } else if (controller._rotating) {\n                rotate3D(controller, startPosition, movement);\n            } else if (controller._strafing) {\n                Cartesian3.clone(mousePos, controller._strafeStartPosition);\n                strafe(controller, startPosition, movement);\n            } else {\n                magnitude = Cartesian3.magnitude(controller._rotateStartPosition);\n                radii = scratchRadii;\n                radii.x = radii.y = radii.z = magnitude;\n                ellipsoid = Ellipsoid.fromCartesian3(radii, scratchEllipsoid);\n                pan3D(controller, startPosition, movement, ellipsoid);\n            }\n            return;\n        }\n        controller._looking = false;\n        controller._rotating = false;\n        controller._strafing = false;\n\n        if (defined(globe) && height < controller._minimumPickingTerrainHeight) {\n            if (defined(mousePos)) {\n                if (Cartesian3.magnitude(camera.position) < Cartesian3.magnitude(mousePos)) {\n                    Cartesian3.clone(mousePos, controller._strafeStartPosition);\n\n                    controller._strafing = true;\n                    strafe(controller, startPosition, movement);\n                } else {\n                    magnitude = Cartesian3.magnitude(mousePos);\n                    radii = scratchRadii;\n                    radii.x = radii.y = radii.z = magnitude;\n                    ellipsoid = Ellipsoid.fromCartesian3(radii, scratchEllipsoid);\n                    pan3D(controller, startPosition, movement, ellipsoid);\n\n                    Cartesian3.clone(mousePos, controller._rotateStartPosition);\n                }\n            } else {\n                controller._looking = true;\n                look3D(controller, startPosition, movement, up);\n            }\n        } else if (defined(camera.pickEllipsoid(movement.startPosition, controller._ellipsoid, spin3DPick))) {\n            pan3D(controller, startPosition, movement, controller._ellipsoid);\n            Cartesian3.clone(spin3DPick, controller._rotateStartPosition);\n        } else if (height > controller._minimumTrackBallHeight) {\n            controller._rotating = true;\n            rotate3D(controller, startPosition, movement);\n        } else {\n            controller._looking = true;\n            look3D(controller, startPosition, movement, up);\n        }\n\n        Cartesian2.clone(startPosition, controller._rotateMousePosition);\n    }\n\n    function rotate3D(controller, startPosition, movement, constrainedAxis, rotateOnlyVertical, rotateOnlyHorizontal) {\n        rotateOnlyVertical = defaultValue(rotateOnlyVertical, false);\n        rotateOnlyHorizontal = defaultValue(rotateOnlyHorizontal, false);\n\n        var scene = controller._scene;\n        var camera = scene.camera;\n        var canvas = scene.canvas;\n\n        var oldAxis = camera.constrainedAxis;\n        if (defined(constrainedAxis)) {\n            camera.constrainedAxis = constrainedAxis;\n        }\n\n        var rho = Cartesian3.magnitude(camera.position);\n        var rotateRate = controller._rotateFactor * (rho - controller._rotateRateRangeAdjustment);\n\n        if (rotateRate > controller._maximumRotateRate) {\n            rotateRate = controller._maximumRotateRate;\n        }\n\n        if (rotateRate < controller._minimumRotateRate) {\n            rotateRate = controller._minimumRotateRate;\n        }\n\n        var phiWindowRatio = (movement.startPosition.x - movement.endPosition.x) / canvas.clientWidth;\n        var thetaWindowRatio = (movement.startPosition.y - movement.endPosition.y) / canvas.clientHeight;\n        phiWindowRatio = Math.min(phiWindowRatio, controller.maximumMovementRatio);\n        thetaWindowRatio = Math.min(thetaWindowRatio, controller.maximumMovementRatio);\n\n        var deltaPhi = rotateRate * phiWindowRatio * Math.PI * 2.0;\n        var deltaTheta = rotateRate * thetaWindowRatio * Math.PI;\n\n        if (!rotateOnlyVertical) {\n            camera.rotateRight(deltaPhi);\n        }\n\n        if (!rotateOnlyHorizontal) {\n            camera.rotateUp(deltaTheta);\n        }\n\n        camera.constrainedAxis = oldAxis;\n    }\n\n    var pan3DP0 = Cartesian4.clone(Cartesian4.UNIT_W);\n    var pan3DP1 = Cartesian4.clone(Cartesian4.UNIT_W);\n    var pan3DTemp0 = new Cartesian3();\n    var pan3DTemp1 = new Cartesian3();\n    var pan3DTemp2 = new Cartesian3();\n    var pan3DTemp3 = new Cartesian3();\n    var pan3DStartMousePosition = new Cartesian2();\n    var pan3DEndMousePosition = new Cartesian2();\n\n    function pan3D(controller, startPosition, movement, ellipsoid) {\n        var scene = controller._scene;\n        var camera = scene.camera;\n\n        var startMousePosition = Cartesian2.clone(movement.startPosition, pan3DStartMousePosition);\n        var endMousePosition = Cartesian2.clone(movement.endPosition, pan3DEndMousePosition);\n\n        var p0 = camera.pickEllipsoid(startMousePosition, ellipsoid, pan3DP0);\n        var p1 = camera.pickEllipsoid(endMousePosition, ellipsoid, pan3DP1);\n\n        if (!defined(p0) || !defined(p1)) {\n            controller._rotating = true;\n            rotate3D(controller, startPosition, movement);\n            return;\n        }\n\n        p0 = camera.worldToCameraCoordinates(p0, p0);\n        p1 = camera.worldToCameraCoordinates(p1, p1);\n\n        if (!defined(camera.constrainedAxis)) {\n            Cartesian3.normalize(p0, p0);\n            Cartesian3.normalize(p1, p1);\n            var dot = Cartesian3.dot(p0, p1);\n            var axis = Cartesian3.cross(p0, p1, pan3DTemp0);\n\n            if (dot < 1.0 && !Cartesian3.equalsEpsilon(axis, Cartesian3.ZERO, CesiumMath.EPSILON14)) { // dot is in [0, 1]\n                var angle = Math.acos(dot);\n                camera.rotate(axis, angle);\n            }\n        } else {\n            var basis0 = camera.constrainedAxis;\n            var basis1 = Cartesian3.mostOrthogonalAxis(basis0, pan3DTemp0);\n            Cartesian3.cross(basis1, basis0, basis1);\n            Cartesian3.normalize(basis1, basis1);\n            var basis2 = Cartesian3.cross(basis0, basis1, pan3DTemp1);\n\n            var startRho = Cartesian3.magnitude(p0);\n            var startDot = Cartesian3.dot(basis0, p0);\n            var startTheta = Math.acos(startDot / startRho);\n            var startRej = Cartesian3.multiplyByScalar(basis0, startDot, pan3DTemp2);\n            Cartesian3.subtract(p0, startRej, startRej);\n            Cartesian3.normalize(startRej, startRej);\n\n            var endRho = Cartesian3.magnitude(p1);\n            var endDot = Cartesian3.dot(basis0, p1);\n            var endTheta = Math.acos(endDot / endRho);\n            var endRej = Cartesian3.multiplyByScalar(basis0, endDot, pan3DTemp3);\n            Cartesian3.subtract(p1, endRej, endRej);\n            Cartesian3.normalize(endRej, endRej);\n\n            var startPhi = Math.acos(Cartesian3.dot(startRej, basis1));\n            if (Cartesian3.dot(startRej, basis2) < 0) {\n                startPhi = CesiumMath.TWO_PI - startPhi;\n            }\n\n            var endPhi = Math.acos(Cartesian3.dot(endRej, basis1));\n            if (Cartesian3.dot(endRej, basis2) < 0) {\n                endPhi = CesiumMath.TWO_PI - endPhi;\n            }\n\n            var deltaPhi = startPhi - endPhi;\n\n            var east;\n            if (Cartesian3.equalsEpsilon(basis0, camera.position, CesiumMath.EPSILON2)) {\n                east = camera.right;\n            } else {\n                east = Cartesian3.cross(basis0, camera.position, pan3DTemp0);\n            }\n\n            var planeNormal = Cartesian3.cross(basis0, east, pan3DTemp0);\n            var side0 = Cartesian3.dot(planeNormal, Cartesian3.subtract(p0, basis0, pan3DTemp1));\n            var side1 = Cartesian3.dot(planeNormal, Cartesian3.subtract(p1, basis0, pan3DTemp1));\n\n            var deltaTheta;\n            if (side0 > 0 && side1 > 0) {\n                deltaTheta = endTheta - startTheta;\n            } else if (side0 > 0 && side1 <= 0) {\n                if (Cartesian3.dot(camera.position, basis0) > 0) {\n                    deltaTheta = -startTheta - endTheta;\n                } else {\n                    deltaTheta = startTheta + endTheta;\n                }\n            } else {\n                deltaTheta = startTheta - endTheta;\n            }\n\n            camera.rotateRight(deltaPhi);\n            camera.rotateUp(deltaTheta);\n        }\n    }\n\n    var zoom3DUnitPosition = new Cartesian3();\n    var zoom3DCartographic = new Cartographic();\n\n    function zoom3D(controller, startPosition, movement) {\n        if (defined(movement.distance)) {\n            movement = movement.distance;\n        }\n\n        var ellipsoid = controller._ellipsoid;\n        var scene = controller._scene;\n        var camera = scene.camera;\n        var canvas = scene.canvas;\n\n        var windowPosition = zoomCVWindowPos;\n        windowPosition.x = canvas.clientWidth / 2;\n        windowPosition.y = canvas.clientHeight / 2;\n        var ray = camera.getPickRay(windowPosition, zoomCVWindowRay);\n\n        var intersection;\n        var height = ellipsoid.cartesianToCartographic(camera.position, zoom3DCartographic).height;\n        if (height < controller._minimumPickingTerrainHeight) {\n            intersection = pickGlobe(controller, windowPosition, zoomCVIntersection);\n        }\n\n        var distance;\n        if (defined(intersection)) {\n            distance = Cartesian3.distance(ray.origin, intersection);\n        } else {\n            distance = height;\n        }\n\n        var unitPosition = Cartesian3.normalize(camera.position, zoom3DUnitPosition);\n        handleZoom(controller, startPosition, movement, controller._zoomFactor, distance, Cartesian3.dot(unitPosition, camera.direction));\n    }\n\n    var tilt3DWindowPos = new Cartesian2();\n    var tilt3DRay = new Ray();\n    var tilt3DCenter = new Cartesian3();\n    var tilt3DVerticalCenter = new Cartesian3();\n    var tilt3DTransform = new Matrix4();\n    var tilt3DVerticalTransform = new Matrix4();\n    var tilt3DOldTransform = new Matrix4();\n    var tilt3DQuaternion = new Quaternion();\n    var tilt3DMatrix = new Matrix3();\n    var tilt3DCart = new Cartographic();\n    var tilt3DLookUp = new Cartesian3();\n\n    function tilt3D(controller, startPosition, movement) {\n        var scene = controller._scene;\n        var camera = scene.camera;\n\n        if (!Matrix4.equals(camera.transform, Matrix4.IDENTITY)) {\n            return;\n        }\n\n        if (defined(movement.angleAndHeight)) {\n            movement = movement.angleAndHeight;\n        }\n\n        if (!Cartesian2.equals(startPosition, controller._tiltCenterMousePosition)) {\n            controller._tiltOnEllipsoid = false;\n            controller._looking = false;\n        }\n\n        if (controller._looking) {\n            var up = controller._ellipsoid.geodeticSurfaceNormal(camera.position, tilt3DLookUp);\n            look3D(controller, startPosition, movement, up);\n            return;\n        }\n\n        var ellipsoid = controller._ellipsoid;\n        var cartographic = ellipsoid.cartesianToCartographic(camera.position, tilt3DCart);\n\n        if (controller._tiltOnEllipsoid || cartographic.height > controller._minimumCollisionTerrainHeight) {\n            controller._tiltOnEllipsoid = true;\n            tilt3DOnEllipsoid(controller, startPosition, movement);\n        } else {\n            tilt3DOnTerrain(controller, startPosition, movement);\n        }\n    }\n\n    var tilt3DOnEllipsoidCartographic = new Cartographic();\n\n    function tilt3DOnEllipsoid(controller, startPosition, movement) {\n        var ellipsoid = controller._ellipsoid;\n        var scene = controller._scene;\n        var camera = scene.camera;\n        var minHeight = controller.minimumZoomDistance * 0.25;\n        var height = ellipsoid.cartesianToCartographic(camera.positionWC, tilt3DOnEllipsoidCartographic).height;\n        if (height - minHeight - 1.0 < CesiumMath.EPSILON3 &&\n                movement.endPosition.y - movement.startPosition.y < 0) {\n            return;\n        }\n\n        var canvas = scene.canvas;\n\n        var windowPosition = tilt3DWindowPos;\n        windowPosition.x = canvas.clientWidth / 2;\n        windowPosition.y = canvas.clientHeight / 2;\n        var ray = camera.getPickRay(windowPosition, tilt3DRay);\n\n        var center;\n        var intersection = IntersectionTests.rayEllipsoid(ray, ellipsoid);\n        if (defined(intersection)) {\n            center = Ray.getPoint(ray, intersection.start, tilt3DCenter);\n        } else if (height > controller._minimumTrackBallHeight) {\n            var grazingAltitudeLocation = IntersectionTests.grazingAltitudeLocation(ray, ellipsoid);\n            if (!defined(grazingAltitudeLocation)) {\n                return;\n            }\n            var grazingAltitudeCart = ellipsoid.cartesianToCartographic(grazingAltitudeLocation, tilt3DCart);\n            grazingAltitudeCart.height = 0.0;\n            center = ellipsoid.cartographicToCartesian(grazingAltitudeCart, tilt3DCenter);\n        } else {\n            controller._looking = true;\n            var up = controller._ellipsoid.geodeticSurfaceNormal(camera.position, tilt3DLookUp);\n            look3D(controller, startPosition, movement, up);\n            Cartesian2.clone(startPosition, controller._tiltCenterMousePosition);\n            return;\n        }\n\n        var transform = Transforms.eastNorthUpToFixedFrame(center, ellipsoid, tilt3DTransform);\n\n        var oldGlobe = controller._globe;\n        var oldEllipsoid = controller._ellipsoid;\n        controller._globe = undefined;\n        controller._ellipsoid = Ellipsoid.UNIT_SPHERE;\n        controller._rotateFactor = 1.0;\n        controller._rotateRateRangeAdjustment = 1.0;\n\n        var oldTransform = Matrix4.clone(camera.transform, tilt3DOldTransform);\n        camera._setTransform(transform);\n\n        rotate3D(controller, startPosition, movement, Cartesian3.UNIT_Z);\n\n        camera._setTransform(oldTransform);\n        controller._globe = oldGlobe;\n        controller._ellipsoid = oldEllipsoid;\n\n        var radius = oldEllipsoid.maximumRadius;\n        controller._rotateFactor = 1.0 / radius;\n        controller._rotateRateRangeAdjustment = radius;\n    }\n\n    function tilt3DOnTerrain(controller, startPosition, movement) {\n        var ellipsoid = controller._ellipsoid;\n        var scene = controller._scene;\n        var camera = scene.camera;\n\n        var center;\n        var ray;\n        var intersection;\n\n        if (Cartesian2.equals(startPosition, controller._tiltCenterMousePosition)) {\n            center = Cartesian3.clone(controller._tiltCenter, tilt3DCenter);\n        } else {\n            center = pickGlobe(controller, startPosition, tilt3DCenter);\n\n            if (!defined(center)) {\n                ray = camera.getPickRay(startPosition, tilt3DRay);\n                intersection = IntersectionTests.rayEllipsoid(ray, ellipsoid);\n                if (!defined(intersection)) {\n                    var cartographic = ellipsoid.cartesianToCartographic(camera.position, tilt3DCart);\n                    if (cartographic.height <= controller._minimumTrackBallHeight) {\n                        controller._looking = true;\n                        var up = controller._ellipsoid.geodeticSurfaceNormal(camera.position, tilt3DLookUp);\n                        look3D(controller, startPosition, movement, up);\n                        Cartesian2.clone(startPosition, controller._tiltCenterMousePosition);\n                    }\n                    return;\n                }\n                center = Ray.getPoint(ray, intersection.start, tilt3DCenter);\n            }\n\n            Cartesian2.clone(startPosition, controller._tiltCenterMousePosition);\n            Cartesian3.clone(center, controller._tiltCenter);\n        }\n\n        var canvas = scene.canvas;\n\n        var windowPosition = tilt3DWindowPos;\n        windowPosition.x = canvas.clientWidth / 2;\n        windowPosition.y = controller._tiltCenterMousePosition.y;\n        ray = camera.getPickRay(windowPosition, tilt3DRay);\n\n        var mag = Cartesian3.magnitude(center);\n        var radii = Cartesian3.fromElements(mag, mag, mag, scratchRadii);\n        var newEllipsoid = Ellipsoid.fromCartesian3(radii, scratchEllipsoid);\n\n        intersection = IntersectionTests.rayEllipsoid(ray, newEllipsoid);\n        if (!defined(intersection)) {\n            return;\n        }\n\n        var t = Cartesian3.magnitude(ray.origin) > mag ? intersection.start : intersection.stop;\n        var verticalCenter = Ray.getPoint(ray, t, tilt3DVerticalCenter);\n\n        var transform = Transforms.eastNorthUpToFixedFrame(center, ellipsoid, tilt3DTransform);\n        var verticalTransform = Transforms.eastNorthUpToFixedFrame(verticalCenter, newEllipsoid, tilt3DVerticalTransform);\n\n        var oldGlobe = controller._globe;\n        var oldEllipsoid = controller._ellipsoid;\n        controller._globe = undefined;\n        controller._ellipsoid = Ellipsoid.UNIT_SPHERE;\n        controller._rotateFactor = 1.0;\n        controller._rotateRateRangeAdjustment = 1.0;\n\n        var constrainedAxis = Cartesian3.UNIT_Z;\n\n        var oldTransform = Matrix4.clone(camera.transform, tilt3DOldTransform);\n        camera._setTransform(transform);\n\n        var tangent = Cartesian3.cross(verticalCenter, camera.positionWC, tilt3DCartesian3);\n        var dot = Cartesian3.dot(camera.rightWC, tangent);\n\n        rotate3D(controller, startPosition, movement, constrainedAxis, false, true);\n\n        camera._setTransform(verticalTransform);\n\n        if (dot < 0.0) {\n            if (movement.startPosition.y > movement.endPosition.y) {\n                constrainedAxis = undefined;\n            }\n\n            var oldConstrainedAxis = camera.constrainedAxis;\n            camera.constrainedAxis = undefined;\n\n            rotate3D(controller, startPosition, movement, constrainedAxis, true, false);\n\n            camera.constrainedAxis = oldConstrainedAxis;\n        } else {\n            rotate3D(controller, startPosition, movement, constrainedAxis, true, false);\n        }\n\n        if (defined(camera.constrainedAxis)) {\n            var right = Cartesian3.cross(camera.direction, camera.constrainedAxis, tilt3DCartesian3);\n            if (!Cartesian3.equalsEpsilon(right, Cartesian3.ZERO, CesiumMath.EPSILON6)) {\n                if (Cartesian3.dot(right, camera.right) < 0.0) {\n                    Cartesian3.negate(right, right);\n                }\n\n                Cartesian3.cross(right, camera.direction, camera.up);\n                Cartesian3.cross(camera.direction, camera.up, camera.right);\n\n                Cartesian3.normalize(camera.up, camera.up);\n                Cartesian3.normalize(camera.right, camera.right);\n            }\n        }\n\n        camera._setTransform(oldTransform);\n        controller._globe = oldGlobe;\n        controller._ellipsoid = oldEllipsoid;\n\n        var radius = oldEllipsoid.maximumRadius;\n        controller._rotateFactor = 1.0 / radius;\n        controller._rotateRateRangeAdjustment = radius;\n\n        var originalPosition = Cartesian3.clone(camera.positionWC, tilt3DCartesian3);\n\n        if (controller.enableCollisionDetection) {\n            adjustHeightForTerrain(controller);\n        }\n\n        if (!Cartesian3.equals(camera.positionWC, originalPosition)) {\n            camera._setTransform(verticalTransform);\n            camera.worldToCameraCoordinatesPoint(originalPosition, originalPosition);\n\n            var magSqrd = Cartesian3.magnitudeSquared(originalPosition);\n            if (Cartesian3.magnitudeSquared(camera.position) > magSqrd) {\n                Cartesian3.normalize(camera.position, camera.position);\n                Cartesian3.multiplyByScalar(camera.position, Math.sqrt(magSqrd), camera.position);\n            }\n\n            var angle = Cartesian3.angleBetween(originalPosition, camera.position);\n            var axis = Cartesian3.cross(originalPosition, camera.position, originalPosition);\n            Cartesian3.normalize(axis, axis);\n\n            var quaternion = Quaternion.fromAxisAngle(axis, angle, tilt3DQuaternion);\n            var rotation = Matrix3.fromQuaternion(quaternion, tilt3DMatrix);\n            Matrix3.multiplyByVector(rotation, camera.direction, camera.direction);\n            Matrix3.multiplyByVector(rotation, camera.up, camera.up);\n            Cartesian3.cross(camera.direction, camera.up, camera.right);\n            Cartesian3.cross(camera.right, camera.direction, camera.up);\n\n            camera._setTransform(oldTransform);\n        }\n    }\n\n    var look3DStartPos = new Cartesian2();\n    var look3DEndPos = new Cartesian2();\n    var look3DStartRay = new Ray();\n    var look3DEndRay = new Ray();\n    var look3DNegativeRot = new Cartesian3();\n    var look3DTan = new Cartesian3();\n\n    function look3D(controller, startPosition, movement, rotationAxis) {\n        var scene = controller._scene;\n        var camera = scene.camera;\n\n        var startPos = look3DStartPos;\n        startPos.x = movement.startPosition.x;\n        startPos.y = 0.0;\n        var endPos = look3DEndPos;\n        endPos.x = movement.endPosition.x;\n        endPos.y = 0.0;\n\n        var startRay = camera.getPickRay(startPos, look3DStartRay);\n        var endRay = camera.getPickRay(endPos, look3DEndRay);\n        var angle = 0.0;\n        var start;\n        var end;\n\n        if (camera.frustum instanceof OrthographicFrustum) {\n            start = startRay.origin;\n            end = endRay.origin;\n\n            Cartesian3.add(camera.direction, start, start);\n            Cartesian3.add(camera.direction, end, end);\n\n            Cartesian3.subtract(start, camera.position, start);\n            Cartesian3.subtract(end, camera.position, end);\n\n            Cartesian3.normalize(start, start);\n            Cartesian3.normalize(end, end);\n        } else {\n            start = startRay.direction;\n            end = endRay.direction;\n        }\n\n        var dot = Cartesian3.dot(start, end);\n        if (dot < 1.0) { // dot is in [0, 1]\n            angle = Math.acos(dot);\n        }\n\n        angle = (movement.startPosition.x > movement.endPosition.x) ? -angle : angle;\n\n        var horizontalRotationAxis = controller._horizontalRotationAxis;\n        if (defined(rotationAxis)) {\n            camera.look(rotationAxis, -angle);\n        } else if (defined(horizontalRotationAxis)) {\n            camera.look(horizontalRotationAxis, -angle);\n        } else {\n            camera.lookLeft(angle);\n        }\n\n        startPos.x = 0.0;\n        startPos.y = movement.startPosition.y;\n        endPos.x = 0.0;\n        endPos.y = movement.endPosition.y;\n\n        startRay = camera.getPickRay(startPos, look3DStartRay);\n        endRay = camera.getPickRay(endPos, look3DEndRay);\n        angle = 0.0;\n\n        if (camera.frustum instanceof OrthographicFrustum) {\n            start = startRay.origin;\n            end = endRay.origin;\n\n            Cartesian3.add(camera.direction, start, start);\n            Cartesian3.add(camera.direction, end, end);\n\n            Cartesian3.subtract(start, camera.position, start);\n            Cartesian3.subtract(end, camera.position, end);\n\n            Cartesian3.normalize(start, start);\n            Cartesian3.normalize(end, end);\n        } else {\n            start = startRay.direction;\n            end = endRay.direction;\n        }\n\n        dot = Cartesian3.dot(start, end);\n        if (dot < 1.0) { // dot is in [0, 1]\n            angle = Math.acos(dot);\n        }\n        angle = (movement.startPosition.y > movement.endPosition.y) ? -angle : angle;\n\n        rotationAxis = defaultValue(rotationAxis, horizontalRotationAxis);\n        if (defined(rotationAxis)) {\n            var direction = camera.direction;\n            var negativeRotationAxis = Cartesian3.negate(rotationAxis, look3DNegativeRot);\n            var northParallel = Cartesian3.equalsEpsilon(direction, rotationAxis, CesiumMath.EPSILON2);\n            var southParallel = Cartesian3.equalsEpsilon(direction, negativeRotationAxis, CesiumMath.EPSILON2);\n            if ((!northParallel && !southParallel)) {\n                dot = Cartesian3.dot(direction, rotationAxis);\n                var angleToAxis = CesiumMath.acosClamped(dot);\n                if (angle > 0 && angle > angleToAxis) {\n                    angle = angleToAxis - CesiumMath.EPSILON4;\n                }\n\n                dot = Cartesian3.dot(direction, negativeRotationAxis);\n                angleToAxis = CesiumMath.acosClamped(dot);\n                if (angle < 0 && -angle > angleToAxis) {\n                    angle = -angleToAxis + CesiumMath.EPSILON4;\n                }\n\n                var tangent = Cartesian3.cross(rotationAxis, direction, look3DTan);\n                camera.look(tangent, angle);\n            } else if ((northParallel && angle < 0) || (southParallel && angle > 0)) {\n                camera.look(camera.right, -angle);\n            }\n        } else {\n            camera.lookUp(angle);\n        }\n    }\n\n    function update3D(controller) {\n        reactToInput(controller, controller.enableRotate, controller.rotateEventTypes, spin3D, controller.inertiaSpin, '_lastInertiaSpinMovement');\n        reactToInput(controller, controller.enableZoom, controller.zoomEventTypes, zoom3D, controller.inertiaZoom, '_lastInertiaZoomMovement');\n        reactToInput(controller, controller.enableTilt, controller.tiltEventTypes, tilt3D, controller.inertiaSpin, '_lastInertiaTiltMovement');\n        reactToInput(controller, controller.enableLook, controller.lookEventTypes, look3D);\n    }\n\n    var scratchAdjustHeightTransform = new Matrix4();\n    var scratchAdjustHeightCartographic = new Cartographic();\n\n    function adjustHeightForTerrain(controller) {\n        controller._adjustedHeightForTerrain = true;\n\n        var scene = controller._scene;\n        var mode = scene.mode;\n        var globe = scene.globe;\n\n        if (!defined(globe) || mode === SceneMode.SCENE2D || mode === SceneMode.MORPHING) {\n            return;\n        }\n\n        var camera = scene.camera;\n        var ellipsoid = globe.ellipsoid;\n        var projection = scene.mapProjection;\n\n        var transform;\n        var mag;\n        if (!Matrix4.equals(camera.transform, Matrix4.IDENTITY)) {\n            transform = Matrix4.clone(camera.transform, scratchAdjustHeightTransform);\n            mag = Cartesian3.magnitude(camera.position);\n            camera._setTransform(Matrix4.IDENTITY);\n        }\n\n        var cartographic = scratchAdjustHeightCartographic;\n        if (mode === SceneMode.SCENE3D) {\n            ellipsoid.cartesianToCartographic(camera.position, cartographic);\n        } else {\n            projection.unproject(camera.position, cartographic);\n        }\n\n        var heightUpdated = false;\n        if (cartographic.height < controller._minimumCollisionTerrainHeight) {\n            var height = globe.getHeight(cartographic);\n            if (defined(height)) {\n                height += controller.minimumZoomDistance;\n                if (cartographic.height < height) {\n                    cartographic.height = height;\n                    if (mode === SceneMode.SCENE3D) {\n                        ellipsoid.cartographicToCartesian(cartographic, camera.position);\n                    } else {\n                        projection.project(cartographic, camera.position);\n                    }\n                    heightUpdated = true;\n                }\n            }\n        }\n\n        if (defined(transform)) {\n            camera._setTransform(transform);\n            if (heightUpdated) {\n                Cartesian3.normalize(camera.position, camera.position);\n                Cartesian3.negate(camera.position, camera.direction);\n                Cartesian3.multiplyByScalar(camera.position, Math.max(mag, controller.minimumZoomDistance), camera.position);\n                Cartesian3.normalize(camera.direction, camera.direction);\n                Cartesian3.cross(camera.direction, camera.up, camera.right);\n                Cartesian3.cross(camera.right, camera.direction, camera.up);\n            }\n        }\n    }\n\n    /**\n     * @private\n     */\n    ScreenSpaceCameraController.prototype.onMap = function() {\n        var scene = this._scene;\n        var mode = scene.mode;\n        var camera = scene.camera;\n\n        if (mode === SceneMode.COLUMBUS_VIEW) {\n            return Math.abs(camera.position.x) - this._maxCoord.x < 0 && Math.abs(camera.position.y) - this._maxCoord.y < 0;\n        }\n\n        return true;\n    };\n\n    var scratchPreviousPosition = new Cartesian3();\n    var scratchPreviousDirection = new Cartesian3();\n\n    /**\n     * @private\n     */\n    ScreenSpaceCameraController.prototype.update = function() {\n        var camera = this._scene.camera;\n        if (!Matrix4.equals(camera.transform, Matrix4.IDENTITY)) {\n            this._globe = undefined;\n            this._ellipsoid = Ellipsoid.UNIT_SPHERE;\n        } else {\n            this._globe = this._scene.globe;\n            this._ellipsoid = defined(this._globe) ? this._globe.ellipsoid : this._scene.mapProjection.ellipsoid;\n        }\n\n        this._minimumCollisionTerrainHeight = this.minimumCollisionTerrainHeight * this._scene.terrainExaggeration;\n        this._minimumPickingTerrainHeight = this.minimumPickingTerrainHeight * this._scene.terrainExaggeration;\n        this._minimumTrackBallHeight = this.minimumTrackBallHeight * this._scene.terrainExaggeration;\n\n        var radius = this._ellipsoid.maximumRadius;\n        this._rotateFactor = 1.0 / radius;\n        this._rotateRateRangeAdjustment = radius;\n\n        this._adjustedHeightForTerrain = false;\n        var previousPosition = Cartesian3.clone(camera.positionWC, scratchPreviousPosition);\n        var previousDirection = Cartesian3.clone(camera.directionWC, scratchPreviousDirection);\n\n        var scene = this._scene;\n        var mode = scene.mode;\n        if (mode === SceneMode.SCENE2D) {\n            update2D(this);\n        } else if (mode === SceneMode.COLUMBUS_VIEW) {\n            this._horizontalRotationAxis = Cartesian3.UNIT_Z;\n            updateCV(this);\n        } else if (mode === SceneMode.SCENE3D) {\n            this._horizontalRotationAxis = undefined;\n            update3D(this);\n        }\n\n        if (this.enableCollisionDetection && !this._adjustedHeightForTerrain) {\n            // Adjust the camera height if the camera moved at all (user input or intertia) and an action didn't already adjust the camera height\n            var cameraChanged = !Cartesian3.equals(previousPosition, camera.positionWC) || !Cartesian3.equals(previousDirection, camera.directionWC);\n            if (cameraChanged) {\n                adjustHeightForTerrain(this);\n            }\n        }\n\n        this._aggregator.reset();\n    };\n\n    /**\n     * @private\n     */\n    ScreenSpaceCameraController.prototype.adjustedHeightForTerrain = function() {\n        return this._adjustedHeightForTerrain;\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <br /><br />\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     *\n     * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n     *\n     * @see ScreenSpaceCameraController#destroy\n     */\n    ScreenSpaceCameraController.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Removes mouse listeners held by this object.\n     * <br /><br />\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     *\n     * @example\n     * controller = controller && controller.destroy();\n     *\n     * @see ScreenSpaceCameraController#isDestroyed\n     */\n    ScreenSpaceCameraController.prototype.destroy = function() {\n        this._tweens.removeAll();\n        this._aggregator = this._aggregator && this._aggregator.destroy();\n        return destroyObject(this);\n    };\nexport default ScreenSpaceCameraController;\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D colorTexture;\\n\\\nuniform sampler2D colorTexture2;\\n\\\n\\n\\\nuniform vec2 center;\\n\\\nuniform float radius;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    vec4 color0 = texture2D(colorTexture, v_textureCoordinates);\\n\\\n    vec4 color1 = texture2D(colorTexture2, v_textureCoordinates);\\n\\\n\\n\\\n    float x = length(gl_FragCoord.xy - center) / radius;\\n\\\n    float t = smoothstep(0.5, 0.8, x);\\n\\\n    gl_FragColor = mix(color0 + color1, color1, t);\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D colorTexture;\\n\\\n\\n\\\nuniform float avgLuminance;\\n\\\nuniform float threshold;\\n\\\nuniform float offset;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nfloat key(float avg)\\n\\\n{\\n\\\n    float guess = 1.5 - (1.5 / (avg * 0.1 + 1.0));\\n\\\n    return max(0.0, guess) + 0.1;\\n\\\n}\\n\\\n\\n\\\n// See section 9. \\\"The bright-pass filter\\\" of Realtime HDR Rendering\\n\\\n// http://www.cg.tuwien.ac.at/research/publications/2007/Luksch_2007_RHR/Luksch_2007_RHR-RealtimeHDR%20.pdf\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\\n\\\n    vec3 xyz = czm_RGBToXYZ(color.rgb);\\n\\\n    float luminance = xyz.r;\\n\\\n\\n\\\n    float scaledLum = key(avgLuminance) * luminance / avgLuminance;\\n\\\n    float brightLum = max(scaledLum - threshold, 0.0);\\n\\\n    float brightness = brightLum / (offset + brightLum);\\n\\\n\\n\\\n    xyz.r = brightness;\\n\\\n    gl_FragColor = vec4(czm_XYZToRGB(xyz), 1.0);\\n\\\n}\\n\\\n\";\n","import BoundingRectangle from '../Core/BoundingRectangle.js';\nimport Cartesian2 from '../Core/Cartesian2.js';\nimport Cartesian4 from '../Core/Cartesian4.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport CesiumMath from '../Core/Math.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport Transforms from '../Core/Transforms.js';\nimport AdditiveBlend from '../Shaders/PostProcessStages/AdditiveBlend.js';\nimport BrightPass from '../Shaders/PostProcessStages/BrightPass.js';\nimport GaussianBlur1D from '../Shaders/PostProcessStages/GaussianBlur1D.js';\nimport PassThrough from '../Shaders/PostProcessStages/PassThrough.js';\nimport PostProcessStage from './PostProcessStage.js';\nimport PostProcessStageComposite from './PostProcessStageComposite.js';\nimport PostProcessStageSampleMode from './PostProcessStageSampleMode.js';\nimport PostProcessStageTextureCache from './PostProcessStageTextureCache.js';\nimport SceneFramebuffer from './SceneFramebuffer.js';\n\n    function SunPostProcess() {\n        this._sceneFramebuffer = new SceneFramebuffer();\n\n        var scale = 0.125;\n        var stages = new Array(6);\n\n        stages[0] = new PostProcessStage({\n            fragmentShader : PassThrough,\n            textureScale : scale,\n            forcePowerOfTwo : true,\n            sampleMode : PostProcessStageSampleMode.LINEAR\n        });\n\n        var brightPass = stages[1] = new PostProcessStage({\n            fragmentShader : BrightPass,\n            uniforms : {\n                avgLuminance : 0.5, // A guess at the average luminance across the entire scene\n                threshold : 0.25,\n                offset : 0.1\n            },\n            textureScale : scale,\n            forcePowerOfTwo : true\n        });\n\n        var that = this;\n        this._delta = 1.0;\n        this._sigma = 2.0;\n        this._blurStep = new Cartesian2();\n\n        stages[2] = new PostProcessStage({\n            fragmentShader : GaussianBlur1D,\n            uniforms : {\n                step : function() {\n                    that._blurStep.x = that._blurStep.y = 1.0 / brightPass.outputTexture.width;\n                    return that._blurStep;\n                },\n                delta : function() {\n                    return that._delta;\n                },\n                sigma : function() {\n                    return that._sigma;\n                },\n                direction : 0.0\n            },\n            textureScale : scale,\n            forcePowerOfTwo : true\n        });\n\n        stages[3] = new PostProcessStage({\n            fragmentShader : GaussianBlur1D,\n            uniforms : {\n                step : function() {\n                    that._blurStep.x = that._blurStep.y = 1.0 / brightPass.outputTexture.width;\n                    return that._blurStep;\n                },\n                delta : function() {\n                    return that._delta;\n                },\n                sigma : function() {\n                    return that._sigma;\n                },\n                direction : 1.0\n            },\n            textureScale : scale,\n            forcePowerOfTwo : true\n        });\n\n        stages[4] = new PostProcessStage({\n            fragmentShader : PassThrough,\n            sampleMode : PostProcessStageSampleMode.LINEAR\n        });\n\n        this._uCenter = new Cartesian2();\n        this._uRadius = undefined;\n\n        stages[5] = new PostProcessStage({\n            fragmentShader : AdditiveBlend,\n            uniforms : {\n                center : function() {\n                    return that._uCenter;\n                },\n                radius : function() {\n                    return that._uRadius;\n                },\n                colorTexture2 : function() {\n                    return that._sceneFramebuffer.getFramebuffer().getColorTexture(0);\n                }\n            }\n        });\n\n        this._stages = new PostProcessStageComposite({\n            stages : stages\n        });\n\n        var textureCache = new PostProcessStageTextureCache(this);\n        var length = stages.length;\n        for (var i = 0; i < length; ++i) {\n            stages[i]._textureCache = textureCache;\n        }\n\n        this._textureCache = textureCache;\n        this.length = stages.length;\n    }\n\n    SunPostProcess.prototype.get = function(index) {\n        return this._stages.get(index);\n    };\n\n    SunPostProcess.prototype.getStageByName = function(name) {\n        var length = this._stages.length;\n        for (var i = 0; i < length; ++i) {\n            var stage = this._stages.get(i);\n            if (stage.name === name) {\n                return stage;\n            }\n        }\n        return undefined;\n    };\n\n    var sunPositionECScratch = new Cartesian4();\n    var sunPositionWCScratch = new Cartesian2();\n    var sizeScratch = new Cartesian2();\n    var postProcessMatrix4Scratch= new Matrix4();\n\n    function updateSunPosition(postProcess, context, viewport) {\n        var us = context.uniformState;\n        var sunPosition = us.sunPositionWC;\n        var viewMatrix = us.view;\n        var viewProjectionMatrix = us.viewProjection;\n        var projectionMatrix = us.projection;\n\n        // create up sampled render state\n        var viewportTransformation = Matrix4.computeViewportTransformation(viewport, 0.0, 1.0, postProcessMatrix4Scratch);\n        var sunPositionEC = Matrix4.multiplyByPoint(viewMatrix, sunPosition, sunPositionECScratch);\n        var sunPositionWC = Transforms.pointToGLWindowCoordinates(viewProjectionMatrix, viewportTransformation, sunPosition, sunPositionWCScratch);\n\n        sunPositionEC.x += CesiumMath.SOLAR_RADIUS;\n        var limbWC = Transforms.pointToGLWindowCoordinates(projectionMatrix, viewportTransformation, sunPositionEC, sunPositionEC);\n        var sunSize = Cartesian2.magnitude(Cartesian2.subtract(limbWC, sunPositionWC, limbWC)) * 30.0 * 2.0;\n\n        var size = sizeScratch;\n        size.x = sunSize;\n        size.y = sunSize;\n\n        postProcess._uCenter = Cartesian2.clone(sunPositionWC, postProcess._uCenter);\n        postProcess._uRadius = Math.max(size.x, size.y) * 0.15;\n\n        var width = context.drawingBufferWidth;\n        var height = context.drawingBufferHeight;\n\n        var stages = postProcess._stages;\n        var firstStage = stages.get(0);\n\n        var downSampleWidth = firstStage.outputTexture.width;\n        var downSampleHeight = firstStage.outputTexture.height;\n\n        var downSampleViewport = new BoundingRectangle();\n        downSampleViewport.width = downSampleWidth;\n        downSampleViewport.height = downSampleHeight;\n\n        // create down sampled render state\n        viewportTransformation = Matrix4.computeViewportTransformation(downSampleViewport, 0.0, 1.0, postProcessMatrix4Scratch);\n        sunPositionWC = Transforms.pointToGLWindowCoordinates(viewProjectionMatrix, viewportTransformation, sunPosition, sunPositionWCScratch);\n\n        size.x *= downSampleWidth / width;\n        size.y *= downSampleHeight / height;\n\n        var scissorRectangle = firstStage.scissorRectangle;\n        scissorRectangle.x = Math.max(sunPositionWC.x - size.x * 0.5, 0.0);\n        scissorRectangle.y = Math.max(sunPositionWC.y - size.y * 0.5, 0.0);\n        scissorRectangle.width = Math.min(size.x, width);\n        scissorRectangle.height = Math.min(size.y, height);\n\n        for (var i = 1; i < 4; ++i) {\n            BoundingRectangle.clone(scissorRectangle, stages.get(i).scissorRectangle);\n        }\n    }\n\n    SunPostProcess.prototype.clear = function(context, passState, clearColor) {\n        this._sceneFramebuffer.clear(context, passState, clearColor);\n        this._textureCache.clear(context);\n    };\n\n    SunPostProcess.prototype.update = function(passState) {\n        var context = passState.context;\n        var viewport = passState.viewport;\n\n        var sceneFramebuffer = this._sceneFramebuffer;\n        sceneFramebuffer.update(context, viewport);\n        var framebuffer = sceneFramebuffer.getFramebuffer();\n\n        this._textureCache.update(context);\n        this._stages.update(context, false);\n\n        updateSunPosition(this, context, viewport);\n\n        return framebuffer;\n    };\n\n    SunPostProcess.prototype.execute = function(context) {\n        var colorTexture = this._sceneFramebuffer.getFramebuffer().getColorTexture(0);\n        var stages = this._stages;\n        var length = stages.length;\n        stages.get(0).execute(context, colorTexture);\n        for (var i = 1; i < length; ++i) {\n            stages.get(i).execute(context, stages.get(i - 1).outputTexture);\n        }\n    };\n\n    SunPostProcess.prototype.copy = function(context, framebuffer) {\n        if (!defined(this._copyColorCommand)) {\n            var that = this;\n            this._copyColorCommand = context.createViewportQuadCommand(PassThrough, {\n                uniformMap : {\n                    colorTexture : function() {\n                        return that._stages.get(that._stages.length - 1).outputTexture;\n                    }\n                },\n                owner : this\n            });\n        }\n\n        this._copyColorCommand.framebuffer = framebuffer;\n        this._copyColorCommand.execute(context);\n    };\n\n    SunPostProcess.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    SunPostProcess.prototype.destroy = function() {\n        this._textureCache.destroy();\n        this._stages.destroy();\n        return destroyObject(this);\n    };\nexport default SunPostProcess;\n","import BoundingRectangle from '../Core/BoundingRectangle.js';\nimport BoundingSphere from '../Core/BoundingSphere.js';\nimport BoxGeometry from '../Core/BoxGeometry.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Cartesian4 from '../Core/Cartesian4.js';\nimport Cartographic from '../Core/Cartographic.js';\nimport clone from '../Core/clone.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport createGuid from '../Core/createGuid.js';\nimport CullingVolume from '../Core/CullingVolume.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport deprecationWarning from '../Core/deprecationWarning.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport EllipsoidGeometry from '../Core/EllipsoidGeometry.js';\nimport Event from '../Core/Event.js';\nimport GeographicProjection from '../Core/GeographicProjection.js';\nimport GeometryInstance from '../Core/GeometryInstance.js';\nimport GeometryPipeline from '../Core/GeometryPipeline.js';\nimport Intersect from '../Core/Intersect.js';\nimport JulianDate from '../Core/JulianDate.js';\nimport CesiumMath from '../Core/Math.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport mergeSort from '../Core/mergeSort.js';\nimport Occluder from '../Core/Occluder.js';\nimport OrthographicFrustum from '../Core/OrthographicFrustum.js';\nimport OrthographicOffCenterFrustum from '../Core/OrthographicOffCenterFrustum.js';\nimport PerspectiveFrustum from '../Core/PerspectiveFrustum.js';\nimport PerspectiveOffCenterFrustum from '../Core/PerspectiveOffCenterFrustum.js';\nimport RequestScheduler from '../Core/RequestScheduler.js';\nimport TaskProcessor from '../Core/TaskProcessor.js';\nimport Transforms from '../Core/Transforms.js';\nimport ClearCommand from '../Renderer/ClearCommand.js';\nimport ComputeEngine from '../Renderer/ComputeEngine.js';\nimport Context from '../Renderer/Context.js';\nimport ContextLimits from '../Renderer/ContextLimits.js';\nimport DrawCommand from '../Renderer/DrawCommand.js';\nimport Pass from '../Renderer/Pass.js';\nimport RenderState from '../Renderer/RenderState.js';\nimport ShaderProgram from '../Renderer/ShaderProgram.js';\nimport ShaderSource from '../Renderer/ShaderSource.js';\nimport BrdfLutGenerator from './BrdfLutGenerator.js';\nimport Camera from './Camera.js';\nimport Cesium3DTilePass from './Cesium3DTilePass.js';\nimport Cesium3DTilePassState from './Cesium3DTilePassState.js';\nimport CreditDisplay from './CreditDisplay.js';\nimport DebugCameraPrimitive from './DebugCameraPrimitive.js';\nimport DepthPlane from './DepthPlane.js';\nimport DerivedCommand from './DerivedCommand.js';\nimport DeviceOrientationCameraController from './DeviceOrientationCameraController.js';\nimport Fog from './Fog.js';\nimport FrameState from './FrameState.js';\nimport GlobeDepth from './GlobeDepth.js';\nimport InvertClassification from './InvertClassification.js';\nimport JobScheduler from './JobScheduler.js';\nimport MapMode2D from './MapMode2D.js';\nimport OctahedralProjectedCubeMap from './OctahedralProjectedCubeMap.js';\nimport PerformanceDisplay from './PerformanceDisplay.js';\nimport PerInstanceColorAppearance from './PerInstanceColorAppearance.js';\nimport Picking from './Picking.js';\nimport PostProcessStageCollection from './PostProcessStageCollection.js';\nimport Primitive from './Primitive.js';\nimport PrimitiveCollection from './PrimitiveCollection.js';\nimport SceneMode from './SceneMode.js';\nimport SceneTransforms from './SceneTransforms.js';\nimport SceneTransitioner from './SceneTransitioner.js';\nimport ScreenSpaceCameraController from './ScreenSpaceCameraController.js';\nimport ShadowMap from './ShadowMap.js';\nimport StencilConstants from './StencilConstants.js';\nimport SunLight from './SunLight.js';\nimport SunPostProcess from './SunPostProcess.js';\nimport TweenCollection from './TweenCollection.js';\nimport View from './View.js';\n\n    var requestRenderAfterFrame = function (scene) {\n        return function () {\n            scene.frameState.afterRender.push(function() {\n                scene.requestRender();\n            });\n        };\n    };\n\n    /**\n     * The container for all 3D graphical objects and state in a Cesium virtual scene.  Generally,\n     * a scene is not created directly; instead, it is implicitly created by {@link CesiumWidget}.\n     * <p>\n     * <em><code>contextOptions</code> parameter details:</em>\n     * </p>\n     * <p>\n     * The default values are:\n     * <code>\n     * {\n     *   webgl : {\n     *     alpha : false,\n     *     depth : true,\n     *     stencil : false,\n     *     antialias : true,\n     *     powerPreference: 'high-performance',\n     *     premultipliedAlpha : true,\n     *     preserveDrawingBuffer : false,\n     *     failIfMajorPerformanceCaveat : false\n     *   },\n     *   allowTextureFilterAnisotropic : true\n     * }\n     * </code>\n     * </p>\n     * <p>\n     * The <code>webgl</code> property corresponds to the {@link http://www.khronos.org/registry/webgl/specs/latest/#5.2|WebGLContextAttributes}\n     * object used to create the WebGL context.\n     * </p>\n     * <p>\n     * <code>webgl.alpha</code> defaults to false, which can improve performance compared to the standard WebGL default\n     * of true.  If an application needs to composite Cesium above other HTML elements using alpha-blending, set\n     * <code>webgl.alpha</code> to true.\n     * </p>\n     * <p>\n     * The other <code>webgl</code> properties match the WebGL defaults for {@link http://www.khronos.org/registry/webgl/specs/latest/#5.2|WebGLContextAttributes}.\n     * </p>\n     * <p>\n     * <code>allowTextureFilterAnisotropic</code> defaults to true, which enables anisotropic texture filtering when the\n     * WebGL extension is supported.  Setting this to false will improve performance, but hurt visual quality, especially for horizon views.\n     * </p>\n     *\n     * @alias Scene\n     * @constructor\n     *\n     * @param {Object} [options] Object with the following properties:\n     * @param {Canvas} options.canvas The HTML canvas element to create the scene for.\n     * @param {Object} [options.contextOptions] Context and WebGL creation properties.  See details above.\n     * @param {Element} [options.creditContainer] The HTML element in which the credits will be displayed.\n     * @param {Element} [options.creditViewport] The HTML element in which to display the credit popup.  If not specified, the viewport will be a added as a sibling of the canvas.\n     * @param {MapProjection} [options.mapProjection=new GeographicProjection()] The map projection to use in 2D and Columbus View modes.\n     * @param {Boolean} [options.orderIndependentTranslucency=true] If true and the configuration supports it, use order independent translucency.\n     * @param {Boolean} [options.scene3DOnly=false] If true, optimizes memory use and performance for 3D mode but disables the ability to use 2D or Columbus View.\n     * @param {Number} [options.terrainExaggeration=1.0] A scalar used to exaggerate the terrain. Note that terrain exaggeration will not modify any other primitive as they are positioned relative to the ellipsoid.\n     * @param {Boolean} [options.shadows=false] Determines if shadows are cast by light sources.\n     * @param {MapMode2D} [options.mapMode2D=MapMode2D.INFINITE_SCROLL] Determines if the 2D map is rotatable or can be scrolled infinitely in the horizontal direction.\n     * @param {Boolean} [options.requestRenderMode=false] If true, rendering a frame will only occur when needed as determined by changes within the scene. Enabling improves performance of the application, but requires using {@link Scene#requestRender} to render a new frame explicitly in this mode. This will be necessary in many cases after making changes to the scene in other parts of the API. See {@link https://cesium.com/blog/2018/01/24/cesium-scene-rendering-performance/|Improving Performance with Explicit Rendering}.\n     * @param {Number} [options.maximumRenderTimeChange=0.0] If requestRenderMode is true, this value defines the maximum change in simulation time allowed before a render is requested. See {@link https://cesium.com/blog/2018/01/24/cesium-scene-rendering-performance/|Improving Performance with Explicit Rendering}.\n     *\n     * @see CesiumWidget\n     * @see {@link http://www.khronos.org/registry/webgl/specs/latest/#5.2|WebGLContextAttributes}\n     *\n     * @exception {DeveloperError} options and options.canvas are required.\n     *\n     * @example\n     * // Create scene without anisotropic texture filtering\n     * var scene = new Cesium.Scene({\n     *   canvas : canvas,\n     *   contextOptions : {\n     *     allowTextureFilterAnisotropic : false\n     *   }\n     * });\n     */\n    function Scene(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n        var canvas = options.canvas;\n        var creditContainer = options.creditContainer;\n        var creditViewport = options.creditViewport;\n\n        var contextOptions = clone(options.contextOptions);\n        if (!defined(contextOptions)) {\n            contextOptions = {};\n        }\n        if (!defined(contextOptions.webgl)) {\n            contextOptions.webgl = {};\n        }\n        contextOptions.webgl.powerPreference = defaultValue(contextOptions.webgl.powerPreference, 'high-performance');\n\n        \n        var hasCreditContainer = defined(creditContainer);\n        var context = new Context(canvas, contextOptions);\n        if (!hasCreditContainer) {\n            creditContainer = document.createElement('div');\n            creditContainer.style.position = 'absolute';\n            creditContainer.style.bottom = '0';\n            creditContainer.style['text-shadow'] = '0 0 2px #000000';\n            creditContainer.style.color = '#ffffff';\n            creditContainer.style['font-size'] = '10px';\n            creditContainer.style['padding-right'] = '5px';\n            canvas.parentNode.appendChild(creditContainer);\n        }\n        if (!defined(creditViewport)) {\n            creditViewport = canvas.parentNode;\n        }\n\n        this._id = createGuid();\n        this._jobScheduler = new JobScheduler();\n        this._frameState = new FrameState(context, new CreditDisplay(creditContainer, '  ', creditViewport), this._jobScheduler);\n        this._frameState.scene3DOnly = defaultValue(options.scene3DOnly, false);\n        this._removeCreditContainer = !hasCreditContainer;\n        this._creditContainer = creditContainer;\n\n        this._canvas = canvas;\n        this._context = context;\n        this._computeEngine = new ComputeEngine(context);\n        this._globe = undefined;\n        this._primitives = new PrimitiveCollection();\n        this._groundPrimitives = new PrimitiveCollection();\n\n        this._logDepthBuffer = context.fragmentDepth;\n        this._logDepthBufferDirty = true;\n\n        this._tweens = new TweenCollection();\n\n        this._shaderFrameCount = 0;\n\n        this._sunPostProcess = undefined;\n\n        this._computeCommandList = [];\n        this._overlayCommandList = [];\n\n        this._useOIT = defaultValue(options.orderIndependentTranslucency, true);\n        this._executeOITFunction = undefined;\n\n        this._depthPlane = new DepthPlane();\n\n        this._clearColorCommand = new ClearCommand({\n            color : new Color(),\n            stencil : 0,\n            owner : this\n        });\n        this._depthClearCommand = new ClearCommand({\n            depth : 1.0,\n            owner : this\n        });\n        this._stencilClearCommand = new ClearCommand({\n            stencil : 0\n        });\n        this._classificationStencilClearCommand = new ClearCommand({\n            stencil : 0,\n            renderState : RenderState.fromCache({\n                stencilMask : StencilConstants.CLASSIFICATION_MASK\n            })\n        });\n\n        this._depthOnlyRenderStateCache = {};\n\n        this._transitioner = new SceneTransitioner(this);\n\n        this._preUpdate = new Event();\n        this._postUpdate = new Event();\n\n        this._renderError = new Event();\n        this._preRender = new Event();\n        this._postRender = new Event();\n\n        this._minimumDisableDepthTestDistance = 0.0;\n\n        /**\n         * Exceptions occurring in <code>render</code> are always caught in order to raise the\n         * <code>renderError</code> event.  If this property is true, the error is rethrown\n         * after the event is raised.  If this property is false, the <code>render</code> function\n         * returns normally after raising the event.\n         *\n         * @type {Boolean}\n         * @default false\n         */\n        this.rethrowRenderErrors = false;\n\n        /**\n         * Determines whether or not to instantly complete the\n         * scene transition animation on user input.\n         *\n         * @type {Boolean}\n         * @default true\n         */\n        this.completeMorphOnUserInput = true;\n\n        /**\n         * The event fired at the beginning of a scene transition.\n         * @type {Event}\n         * @default Event()\n         */\n        this.morphStart = new Event();\n\n        /**\n         * The event fired at the completion of a scene transition.\n         * @type {Event}\n         * @default Event()\n         */\n        this.morphComplete = new Event();\n\n        /**\n         * The {@link SkyBox} used to draw the stars.\n         *\n         * @type {SkyBox}\n         * @default undefined\n         *\n         * @see Scene#backgroundColor\n         */\n        this.skyBox = undefined;\n\n        /**\n         * The sky atmosphere drawn around the globe.\n         *\n         * @type {SkyAtmosphere}\n         * @default undefined\n         */\n        this.skyAtmosphere = undefined;\n\n        /**\n         * The {@link Sun}.\n         *\n         * @type {Sun}\n         * @default undefined\n         */\n        this.sun = undefined;\n\n        /**\n         * Uses a bloom filter on the sun when enabled.\n         *\n         * @type {Boolean}\n         * @default true\n         */\n        this.sunBloom = true;\n        this._sunBloom = undefined;\n\n        /**\n         * The {@link Moon}\n         *\n         * @type Moon\n         * @default undefined\n         */\n        this.moon = undefined;\n\n        /**\n         * The background color, which is only visible if there is no sky box, i.e., {@link Scene#skyBox} is undefined.\n         *\n         * @type {Color}\n         * @default {@link Color.BLACK}\n         *\n         * @see Scene#skyBox\n         */\n        this.backgroundColor = Color.clone(Color.BLACK);\n\n        this._mode = SceneMode.SCENE3D;\n\n        this._mapProjection = defined(options.mapProjection) ? options.mapProjection : new GeographicProjection();\n\n        /**\n         * The current morph transition time between 2D/Columbus View and 3D,\n         * with 0.0 being 2D or Columbus View and 1.0 being 3D.\n         *\n         * @type {Number}\n         * @default 1.0\n         */\n        this.morphTime = 1.0;\n\n        /**\n         * The far-to-near ratio of the multi-frustum when using a normal depth buffer.\n         * <p>\n         * This value is used to create the near and far values for each frustum of the multi-frustum. It is only used\n         * when {@link Scene#logarithmicDepthBuffer} is <code>false</code>. When <code>logarithmicDepthBuffer</code> is\n         * <code>true</code>, use {@link Scene#logarithmicDepthFarToNearRatio}.\n         * </p>\n         *\n         * @type {Number}\n         * @default 1000.0\n         */\n        this.farToNearRatio = 1000.0;\n\n        /**\n         * The far-to-near ratio of the multi-frustum when using a logarithmic depth buffer.\n         * <p>\n         * This value is used to create the near and far values for each frustum of the multi-frustum. It is only used\n         * when {@link Scene#logarithmicDepthBuffer} is <code>true</code>. When <code>logarithmicDepthBuffer</code> is\n         * <code>false</code>, use {@link Scene#farToNearRatio}.\n         * </p>\n         *\n         * @type {Number}\n         * @default 1e9\n         */\n        this.logarithmicDepthFarToNearRatio = 1e9;\n\n        /**\n         * Determines the uniform depth size in meters of each frustum of the multifrustum in 2D. If a primitive or model close\n         * to the surface shows z-fighting, decreasing this will eliminate the artifact, but decrease performance. On the\n         * other hand, increasing this will increase performance but may cause z-fighting among primitives close to the surface.\n         *\n         * @type {Number}\n         * @default 1.75e6\n         */\n        this.nearToFarDistance2D = 1.75e6;\n\n        /**\n         * This property is for debugging only; it is not for production use.\n         * <p>\n         * A function that determines what commands are executed.  As shown in the examples below,\n         * the function receives the command's <code>owner</code> as an argument, and returns a boolean indicating if the\n         * command should be executed.\n         * </p>\n         * <p>\n         * The default is <code>undefined</code>, indicating that all commands are executed.\n         * </p>\n         *\n         * @type Function\n         *\n         * @default undefined\n         *\n         * @example\n         * // Do not execute any commands.\n         * scene.debugCommandFilter = function(command) {\n         *     return false;\n         * };\n         *\n         * // Execute only the billboard's commands.  That is, only draw the billboard.\n         * var billboards = new Cesium.BillboardCollection();\n         * scene.debugCommandFilter = function(command) {\n         *     return command.owner === billboards;\n         * };\n         */\n        this.debugCommandFilter = undefined;\n\n        /**\n         * This property is for debugging only; it is not for production use.\n         * <p>\n         * When <code>true</code>, commands are randomly shaded.  This is useful\n         * for performance analysis to see what parts of a scene or model are\n         * command-dense and could benefit from batching.\n         * </p>\n         *\n         * @type Boolean\n         *\n         * @default false\n         */\n        this.debugShowCommands = false;\n\n        /**\n         * This property is for debugging only; it is not for production use.\n         * <p>\n         * When <code>true</code>, commands are shaded based on the frustums they\n         * overlap.  Commands in the closest frustum are tinted red, commands in\n         * the next closest are green, and commands in the farthest frustum are\n         * blue.  If a command overlaps more than one frustum, the color components\n         * are combined, e.g., a command overlapping the first two frustums is tinted\n         * yellow.\n         * </p>\n         *\n         * @type Boolean\n         *\n         * @default false\n         */\n        this.debugShowFrustums = false;\n\n        /**\n         * This property is for debugging only; it is not for production use.\n         * <p>\n         * Displays frames per second and time between frames.\n         * </p>\n         *\n         * @type Boolean\n         *\n         * @default false\n         */\n        this.debugShowFramesPerSecond = false;\n\n        /**\n         * This property is for debugging only; it is not for production use.\n         * <p>\n         * Displays depth information for the indicated frustum.\n         * </p>\n         *\n         * @type Boolean\n         *\n         * @default false\n         */\n        this.debugShowGlobeDepth = false;\n\n        /**\n         * This property is for debugging only; it is not for production use.\n         * <p>\n         * Indicates which frustum will have depth information displayed.\n         * </p>\n         *\n         * @type Number\n         *\n         * @default 1\n         */\n        this.debugShowDepthFrustum = 1;\n\n        /**\n         * This property is for debugging only; it is not for production use.\n         * <p>\n         * When <code>true</code>, draws outlines to show the boundaries of the camera frustums\n         * </p>\n         *\n         * @type Boolean\n         *\n         * @default false\n         */\n        this.debugShowFrustumPlanes = false;\n        this._debugShowFrustumPlanes = false;\n        this._debugFrustumPlanes = undefined;\n\n        /**\n         * When <code>true</code>, enables picking using the depth buffer.\n         *\n         * @type Boolean\n         * @default true\n         */\n        this.useDepthPicking = true;\n\n        /**\n         * When <code>true</code>, enables picking translucent geometry using the depth buffer. Note that {@link Scene#useDepthPicking} must also be true for enabling this to work.\n         *\n         * <p>\n         * Render must be called between picks.\n         * <br>There is a decrease in performance when enabled. There are extra draw calls to write depth for\n         * translucent geometry.\n         * </p>\n         *\n         * @example\n         * // picking the position of a translucent primitive\n         * viewer.screenSpaceEventHandler.setInputAction(function onLeftClick(movement) {\n         *      var pickedFeature = viewer.scene.pick(movement.position);\n         *      if (!Cesium.defined(pickedFeature)) {\n         *          // nothing picked\n         *          return;\n         *      }\n         *      viewer.scene.render();\n         *      var worldPosition = viewer.scene.pickPosition(movement.position);\n         * }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\n         *\n         * @type {Boolean}\n         * @default false\n         */\n        this.pickTranslucentDepth = false;\n\n        /**\n         * The time in milliseconds to wait before checking if the camera has not moved and fire the cameraMoveEnd event.\n         * @type {Number}\n         * @default 500.0\n         * @private\n         */\n        this.cameraEventWaitTime = 500.0;\n\n        /**\n         * Blends the atmosphere to geometry far from the camera for horizon views. Allows for additional\n         * performance improvements by rendering less geometry and dispatching less terrain requests.\n         * @type {Fog}\n         */\n        this.fog = new Fog();\n\n        this._shadowMapCamera = new Camera(this);\n\n        /**\n         * The shadow map for the scene's light source. When enabled, models, primitives, and the globe may cast and receive shadows.\n         * @type {ShadowMap}\n         */\n        this.shadowMap = new ShadowMap({\n            context : context,\n            lightCamera : this._shadowMapCamera,\n            enabled : defaultValue(options.shadows, false)\n        });\n\n        /**\n         * When <code>false</code>, 3D Tiles will render normally. When <code>true</code>, classified 3D Tile geometry will render normally and\n         * unclassified 3D Tile geometry will render with the color multiplied by {@link Scene#invertClassificationColor}.\n         * @type {Boolean}\n         * @default false\n         */\n        this.invertClassification = false;\n\n        /**\n         * The highlight color of unclassified 3D Tile geometry when {@link Scene#invertClassification} is <code>true</code>.\n         * <p>When the color's alpha is less than 1.0, the unclassified portions of the 3D Tiles will not blend correctly with the classified positions of the 3D Tiles.</p>\n         * <p>Also, when the color's alpha is less than 1.0, the WEBGL_depth_texture and EXT_frag_depth WebGL extensions must be supported.</p>\n         * @type {Color}\n         * @default Color.WHITE\n         */\n        this.invertClassificationColor = Color.clone(Color.WHITE);\n\n        this._actualInvertClassificationColor = Color.clone(this._invertClassificationColor);\n        this._invertClassification = new InvertClassification();\n\n        /**\n         * The focal length for use when with cardboard or WebVR.\n         * @type {Number}\n         */\n        this.focalLength = undefined;\n\n        /**\n         * The eye separation distance in meters for use with cardboard or WebVR.\n         * @type {Number}\n         */\n        this.eyeSeparation = undefined;\n\n        /**\n         * Post processing effects applied to the final render.\n         * @type {PostProcessStageCollection}\n         */\n        this.postProcessStages = new PostProcessStageCollection();\n\n        this._brdfLutGenerator = new BrdfLutGenerator();\n\n        this._terrainExaggeration = defaultValue(options.terrainExaggeration, 1.0);\n\n        this._performanceDisplay = undefined;\n        this._debugVolume = undefined;\n\n        this._screenSpaceCameraController = new ScreenSpaceCameraController(this);\n        this._cameraUnderground = false;\n        this._mapMode2D = defaultValue(options.mapMode2D, MapMode2D.INFINITE_SCROLL);\n\n        // Keeps track of the state of a frame. FrameState is the state across\n        // the primitives of the scene. This state is for internally keeping track\n        // of celestial and environment effects that need to be updated/rendered in\n        // a certain order as well as updating/tracking framebuffer usage.\n        this._environmentState = {\n            skyBoxCommand : undefined,\n            skyAtmosphereCommand : undefined,\n            sunDrawCommand : undefined,\n            sunComputeCommand : undefined,\n            moonCommand : undefined,\n\n            isSunVisible : false,\n            isMoonVisible : false,\n            isReadyForAtmosphere : false,\n            isSkyAtmosphereVisible : false,\n\n            clearGlobeDepth : false,\n            useDepthPlane : false,\n            renderTranslucentDepthForPick : false,\n\n            originalFramebuffer : undefined,\n            useGlobeDepthFramebuffer : false,\n            separatePrimitiveFramebuffer : false,\n            useOIT : false,\n            useInvertClassification : false,\n            usePostProcess : false,\n            usePostProcessSelected : false,\n            useWebVR : false\n        };\n\n        this._useWebVR = false;\n        this._cameraVR = undefined;\n        this._aspectRatioVR = undefined;\n\n        /**\n         * When <code>true</code>, rendering a frame will only occur when needed as determined by changes within the scene.\n         * Enabling improves performance of the application, but requires using {@link Scene#requestRender}\n         * to render a new frame explicitly in this mode. This will be necessary in many cases after making changes\n         * to the scene in other parts of the API.\n         *\n         * @see {@link https://cesium.com/blog/2018/01/24/cesium-scene-rendering-performance/|Improving Performance with Explicit Rendering}\n         * @see Scene#maximumRenderTimeChange\n         * @see Scene#requestRender\n         *\n         * @type {Boolean}\n         * @default false\n         */\n        this.requestRenderMode = defaultValue(options.requestRenderMode, false);\n        this._renderRequested = true;\n\n        /**\n         * If {@link Scene#requestRenderMode} is <code>true</code>, this value defines the maximum change in\n         * simulation time allowed before a render is requested. Lower values increase the number of frames rendered\n         * and higher values decrease the number of frames rendered. If <code>undefined</code>, changes to\n         * the simulation time will never request a render.\n         * This value impacts the rate of rendering for changes in the scene like lighting, entity property updates,\n         * and animations.\n         *\n         * @see {@link https://cesium.com/blog/2018/01/24/cesium-scene-rendering-performance/|Improving Performance with Explicit Rendering}\n         * @see Scene#requestRenderMode\n         *\n         * @type {Number}\n         * @default 0.5\n         */\n        this.maximumRenderTimeChange = defaultValue(options.maximumRenderTimeChange, 0.0);\n        this._lastRenderTime = undefined;\n        this._frameRateMonitor = undefined;\n\n        this._removeRequestListenerCallback = RequestScheduler.requestCompletedEvent.addEventListener(requestRenderAfterFrame(this));\n        this._removeTaskProcessorListenerCallback = TaskProcessor.taskCompletedEvent.addEventListener(requestRenderAfterFrame(this));\n        this._removeGlobeCallbacks = [];\n\n        var viewport = new BoundingRectangle(0, 0, context.drawingBufferWidth, context.drawingBufferHeight);\n        var camera = new Camera(this);\n\n        if (this._logDepthBuffer) {\n            camera.frustum.near = 0.1;\n            camera.frustum.far = 10000000000.0;\n        }\n\n        /**\n         * The camera view for the scene camera flight destination. Used for preloading flight destination tiles.\n         * @type {Camera}\n         * @private\n         */\n        this.preloadFlightCamera = new Camera(this);\n\n        /**\n         * The culling volume for the scene camera flight destination. Used for preloading flight destination tiles.\n         * @type {CullingVolume}\n         * @private\n         */\n        this.preloadFlightCullingVolume = undefined;\n\n        this._picking = new Picking(this);\n        this._defaultView = new View(this, camera, viewport);\n        this._view = this._defaultView;\n\n        this._hdr = undefined;\n        this._hdrDirty = undefined;\n        this.highDynamicRange = false;\n        this.gamma = 2.2;\n\n        /**\n         * The spherical harmonic coefficients for image-based lighting of PBR models.\n         * @type {Cartesian3[]}\n         */\n        this.sphericalHarmonicCoefficients = undefined;\n\n        /**\n         * The url to the KTX file containing the specular environment map and convoluted mipmaps for image-based lighting of PBR models.\n         * @type {String}\n         */\n        this.specularEnvironmentMaps = undefined;\n        this._specularEnvironmentMapAtlas = undefined;\n\n        /**\n         * The light source for shading. Defaults to a directional light from the Sun.\n         * @type {Light}\n         */\n        this.light = new SunLight();\n\n        // Give frameState, camera, and screen space camera controller initial state before rendering\n        updateFrameNumber(this, 0.0, JulianDate.now());\n        this.updateFrameState();\n        this.initializeFrame();\n    }\n\n    function updateGlobeListeners(scene, globe) {\n        for (var i = 0; i < scene._removeGlobeCallbacks.length; ++i) {\n            scene._removeGlobeCallbacks[i]();\n        }\n        scene._removeGlobeCallbacks.length = 0;\n\n        var removeGlobeCallbacks = [];\n        if (defined(globe)) {\n            removeGlobeCallbacks.push(globe.imageryLayersUpdatedEvent.addEventListener(requestRenderAfterFrame(scene)));\n            removeGlobeCallbacks.push(globe.terrainProviderChanged.addEventListener(requestRenderAfterFrame(scene)));\n        }\n        scene._removeGlobeCallbacks = removeGlobeCallbacks;\n    }\n\n    var scratchSunColor = new Cartesian4();\n\n    Object.defineProperties(Scene.prototype, {\n        /**\n         * Gets the canvas element to which this scene is bound.\n         * @memberof Scene.prototype\n         *\n         * @type {Canvas}\n         * @readonly\n         */\n        canvas : {\n            get : function() {\n                return this._canvas;\n            }\n        },\n\n        /**\n         * The drawingBufferHeight of the underlying GL context.\n         * @memberof Scene.prototype\n         *\n         * @type {Number}\n         * @readonly\n         *\n         * @see {@link https://www.khronos.org/registry/webgl/specs/1.0/#DOM-WebGLRenderingContext-drawingBufferHeight|drawingBufferHeight}\n         */\n        drawingBufferHeight : {\n            get : function() {\n                return this._context.drawingBufferHeight;\n            }\n        },\n\n        /**\n         * The drawingBufferHeight of the underlying GL context.\n         * @memberof Scene.prototype\n         *\n         * @type {Number}\n         * @readonly\n         *\n         * @see {@link https://www.khronos.org/registry/webgl/specs/1.0/#DOM-WebGLRenderingContext-drawingBufferHeight|drawingBufferHeight}\n         */\n        drawingBufferWidth : {\n            get : function() {\n                return this._context.drawingBufferWidth;\n            }\n        },\n\n        /**\n         * The maximum aliased line width, in pixels, supported by this WebGL implementation.  It will be at least one.\n         * @memberof Scene.prototype\n         *\n         * @type {Number}\n         * @readonly\n         *\n         * @see {@link https://www.khronos.org/opengles/sdk/docs/man/xhtml/glGet.xml|glGet} with <code>ALIASED_LINE_WIDTH_RANGE</code>.\n         */\n        maximumAliasedLineWidth : {\n            get : function() {\n                return ContextLimits.maximumAliasedLineWidth;\n            }\n        },\n\n        /**\n         * The maximum length in pixels of one edge of a cube map, supported by this WebGL implementation.  It will be at least 16.\n         * @memberof Scene.prototype\n         *\n         * @type {Number}\n         * @readonly\n         *\n         * @see {@link https://www.khronos.org/opengles/sdk/docs/man/xhtml/glGet.xml|glGet} with <code>GL_MAX_CUBE_MAP_TEXTURE_SIZE</code>.\n         */\n        maximumCubeMapSize : {\n            get : function() {\n                return ContextLimits.maximumCubeMapSize;\n            }\n        },\n\n        /**\n         * Returns <code>true</code> if the {@link Scene#pickPosition} function is supported.\n         * @memberof Scene.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         *\n         * @see Scene#pickPosition\n         */\n        pickPositionSupported : {\n            get : function() {\n                return this._context.depthTexture;\n            }\n        },\n\n        /**\n         * Returns <code>true</code> if the {@link Scene#sampleHeight} and {@link Scene#sampleHeightMostDetailed} functions are supported.\n         * @memberof Scene.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         *\n         * @see Scene#sampleHeight\n         * @see Scene#sampleHeightMostDetailed\n         */\n        sampleHeightSupported : {\n            get : function() {\n                return this._context.depthTexture;\n            }\n        },\n\n        /**\n         * Returns <code>true</code> if the {@link Scene#clampToHeight} and {@link Scene#clampToHeightMostDetailed} functions are supported.\n         * @memberof Scene.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         *\n         * @see Scene#clampToHeight\n         * @see Scene#clampToHeightMostDetailed\n         */\n        clampToHeightSupported : {\n            get : function() {\n                return this._context.depthTexture;\n            }\n        },\n\n        /**\n         * Returns <code>true</code> if the {@link Scene#invertClassification} is supported.\n         * @memberof Scene.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         *\n         * @see Scene#invertClassification\n         */\n        invertClassificationSupported : {\n            get : function() {\n                return this._context.depthTexture;\n            }\n        },\n\n        /**\n         * Returns <code>true</code> if specular environment maps are supported.\n         * @memberof Scene.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         *\n         * @see Scene#specularEnvironmentMaps\n         */\n        specularEnvironmentMapsSupported : {\n            get : function() {\n                return OctahedralProjectedCubeMap.isSupported(this._context);\n            }\n        },\n\n        /**\n         * Gets or sets the depth-test ellipsoid.\n         * @memberof Scene.prototype\n         *\n         * @type {Globe}\n         */\n        globe : {\n            get: function() {\n                return this._globe;\n            },\n\n            set: function(globe) {\n                this._globe = this._globe && this._globe.destroy();\n                this._globe = globe;\n\n                updateGlobeListeners(this, globe);\n            }\n        },\n\n        /**\n         * Gets the collection of primitives.\n         * @memberof Scene.prototype\n         *\n         * @type {PrimitiveCollection}\n         * @readonly\n         */\n        primitives : {\n            get : function() {\n                return this._primitives;\n            }\n        },\n\n        /**\n         * Gets the collection of ground primitives.\n         * @memberof Scene.prototype\n         *\n         * @type {PrimitiveCollection}\n         * @readonly\n         */\n        groundPrimitives : {\n            get : function() {\n                return this._groundPrimitives;\n            }\n        },\n\n        /**\n         * Gets or sets the camera.\n         * @memberof Scene.prototype\n         *\n         * @type {Camera}\n         * @readonly\n         */\n        camera : {\n            get : function() {\n                return this._view.camera;\n            },\n            set : function(camera) {\n                // For internal use only. Documentation is still @readonly.\n                this._view.camera = camera;\n            }\n        },\n\n        /**\n         * Gets or sets the view.\n         * @memberof Scene.prototype\n         *\n         * @type {View}\n         * @readonly\n         *\n         * @private\n         */\n        view : {\n            get : function() {\n                return this._view;\n            },\n            set : function(view) {\n                // For internal use only. Documentation is still @readonly.\n                this._view = view;\n            }\n        },\n\n        /**\n         * Gets the default view.\n         * @memberof Scene.prototype\n         *\n         * @type {View}\n         * @readonly\n         *\n         * @private\n         */\n        defaultView : {\n            get : function() {\n                return this._defaultView;\n            }\n        },\n\n        /**\n         * Gets picking functions and state\n         * @memberof Scene.prototype\n         *\n         * @type {Picking}\n         * @readonly\n         *\n         * @private\n         */\n        picking : {\n            get : function() {\n                return this._picking;\n            }\n        },\n\n        /**\n         * Gets the controller for camera input handling.\n         * @memberof Scene.prototype\n         *\n         * @type {ScreenSpaceCameraController}\n         * @readonly\n         */\n        screenSpaceCameraController : {\n            get : function() {\n                return this._screenSpaceCameraController;\n            }\n        },\n\n        /**\n         * Get the map projection to use in 2D and Columbus View modes.\n         * @memberof Scene.prototype\n         *\n         * @type {MapProjection}\n         * @readonly\n         *\n         * @default new GeographicProjection()\n         */\n        mapProjection : {\n            get: function() {\n                return this._mapProjection;\n            }\n        },\n\n        /**\n         * Gets the job scheduler\n         * @memberof Scene.prototype\n         * @type {JobScheduler}\n         * @readonly\n         *\n         * @private\n         */\n        jobScheduler : {\n            get: function() {\n                return this._jobScheduler;\n            }\n        },\n\n        /**\n         * Gets state information about the current scene. If called outside of a primitive's <code>update</code>\n         * function, the previous frame's state is returned.\n         * @memberof Scene.prototype\n         *\n         * @type {FrameState}\n         * @readonly\n         *\n         * @private\n         */\n        frameState : {\n            get: function() {\n                return this._frameState;\n            }\n        },\n\n        /**\n         * Gets the environment state.\n         * @memberof Scene.prototype\n         *\n         * @type {EnvironmentState}\n         * @readonly\n         *\n         * @private\n         */\n        environmentState : {\n            get: function() {\n                return this._environmentState;\n            }\n        },\n\n        /**\n         * Gets the collection of tweens taking place in the scene.\n         * @memberof Scene.prototype\n         *\n         * @type {TweenCollection}\n         * @readonly\n         *\n         * @private\n         */\n        tweens : {\n            get : function() {\n                return this._tweens;\n            }\n        },\n\n        /**\n         * Gets the collection of image layers that will be rendered on the globe.\n         * @memberof Scene.prototype\n         *\n         * @type {ImageryLayerCollection}\n         * @readonly\n         */\n        imageryLayers : {\n            get : function() {\n                if (!defined(this.globe)) {\n                    return undefined;\n                }\n\n                return this.globe.imageryLayers;\n            }\n        },\n\n        /**\n         * The terrain provider providing surface geometry for the globe.\n         * @memberof Scene.prototype\n         *\n         * @type {TerrainProvider}\n         */\n        terrainProvider : {\n            get : function() {\n                if (!defined(this.globe)) {\n                    return undefined;\n                }\n\n                return this.globe.terrainProvider;\n            },\n            set : function(terrainProvider) {\n                if (defined(this.globe)) {\n                    this.globe.terrainProvider = terrainProvider;\n                }\n            }\n        },\n\n        /**\n         * Gets an event that's raised when the terrain provider is changed\n         * @memberof Scene.prototype\n         *\n         * @type {Event}\n         * @readonly\n         */\n        terrainProviderChanged : {\n            get : function() {\n                if (!defined(this.globe)) {\n                    return undefined;\n                }\n\n                return this.globe.terrainProviderChanged;\n            }\n        },\n\n        /**\n         * Gets the event that will be raised before the scene is updated or rendered.  Subscribers to the event\n         * receive the Scene instance as the first parameter and the current time as the second parameter.\n         * @memberof Scene.prototype\n         *\n         * @see {@link https://cesium.com/blog/2018/01/24/cesium-scene-rendering-performance/|Improving Performance with Explicit Rendering}\n         * @see Scene#postUpdate\n         * @see Scene#preRender\n         * @see Scene#postRender\n         *\n         * @type {Event}\n         * @readonly\n         */\n        preUpdate : {\n            get : function() {\n                return this._preUpdate;\n            }\n        },\n\n        /**\n         * Gets the event that will be raised immediately after the scene is updated and before the scene is rendered.\n         * Subscribers to the event receive the Scene instance as the first parameter and the current time as the second\n         * parameter.\n         * @memberof Scene.prototype\n         *\n         * @see {@link https://cesium.com/blog/2018/01/24/cesium-scene-rendering-performance/|Improving Performance with Explicit Rendering}\n         * @see Scene#preUpdate\n         * @see Scene#preRender\n         * @see Scene#postRender\n         *\n         * @type {Event}\n         * @readonly\n         */\n        postUpdate : {\n            get : function() {\n                return this._postUpdate;\n            }\n        },\n\n        /**\n         * Gets the event that will be raised when an error is thrown inside the <code>render</code> function.\n         * The Scene instance and the thrown error are the only two parameters passed to the event handler.\n         * By default, errors are not rethrown after this event is raised, but that can be changed by setting\n         * the <code>rethrowRenderErrors</code> property.\n         * @memberof Scene.prototype\n         *\n         * @type {Event}\n         * @readonly\n         */\n        renderError : {\n            get : function() {\n                return this._renderError;\n            }\n        },\n\n        /**\n         * Gets the event that will be raised after the scene is updated and immediately before the scene is rendered.\n         * Subscribers to the event receive the Scene instance as the first parameter and the current time as the second\n         * parameter.\n         * @memberof Scene.prototype\n         *\n         * @see {@link https://cesium.com/blog/2018/01/24/cesium-scene-rendering-performance/|Improving Performance with Explicit Rendering}\n         * @see Scene#preUpdate\n         * @see Scene#postUpdate\n         * @see Scene#postRender\n         *\n         * @type {Event}\n         * @readonly\n         */\n        preRender : {\n            get : function() {\n                return this._preRender;\n            }\n        },\n\n        /**\n         * Gets the event that will be raised immediately after the scene is rendered.  Subscribers to the event\n         * receive the Scene instance as the first parameter and the current time as the second parameter.\n         * @memberof Scene.prototype\n         *\n         * @see {@link https://cesium.com/blog/2018/01/24/cesium-scene-rendering-performance/|Improving Performance with Explicit Rendering}\n         * @see Scene#preUpdate\n         * @see Scene#postUpdate\n         * @see Scene#postRender\n         *\n         * @type {Event}\n         * @readonly\n         */\n        postRender : {\n            get : function() {\n                return this._postRender;\n            }\n        },\n\n        /**\n         * Gets the simulation time when the scene was last rendered. Returns undefined if the scene has not yet been\n         * rendered.\n         * @memberof Scene.prototype\n         *\n         * @type {JulianDate}\n         * @readonly\n         */\n        lastRenderTime : {\n            get : function() {\n                return this._lastRenderTime;\n            }\n        },\n\n        /**\n         * @memberof Scene.prototype\n         * @private\n         * @readonly\n         */\n        context : {\n            get : function() {\n                return this._context;\n            }\n        },\n\n        /**\n         * This property is for debugging only; it is not for production use.\n         * <p>\n         * When {@link Scene.debugShowFrustums} is <code>true</code>, this contains\n         * properties with statistics about the number of command execute per frustum.\n         * <code>totalCommands</code> is the total number of commands executed, ignoring\n         * overlap. <code>commandsInFrustums</code> is an array with the number of times\n         * commands are executed redundantly, e.g., how many commands overlap two or\n         * three frustums.\n         * </p>\n         *\n         * @memberof Scene.prototype\n         *\n         * @type {Object}\n         * @readonly\n         *\n         * @default undefined\n         */\n        debugFrustumStatistics : {\n            get : function() {\n                return this._view.debugFrustumStatistics;\n            }\n        },\n\n        /**\n         * Gets whether or not the scene is optimized for 3D only viewing.\n         * @memberof Scene.prototype\n         * @type {Boolean}\n         * @readonly\n         */\n        scene3DOnly : {\n            get : function() {\n                return this._frameState.scene3DOnly;\n            }\n        },\n\n        /**\n         * Gets whether or not the scene has order independent translucency enabled.\n         * Note that this only reflects the original construction option, and there are\n         * other factors that could prevent OIT from functioning on a given system configuration.\n         * @memberof Scene.prototype\n         * @type {Boolean}\n         * @readonly\n         */\n        orderIndependentTranslucency : {\n            get : function() {\n                return this._useOIT;\n            }\n        },\n\n        /**\n         * Gets the unique identifier for this scene.\n         * @memberof Scene.prototype\n         * @type {String}\n         * @readonly\n         */\n        id : {\n            get : function() {\n                return this._id;\n            }\n        },\n\n        /**\n         * Gets or sets the current mode of the scene.\n         * @memberof Scene.prototype\n         * @type {SceneMode}\n         * @default {@link SceneMode.SCENE3D}\n         */\n        mode : {\n            get : function() {\n                return this._mode;\n            },\n            set : function(value) {\n                \n                if (value === SceneMode.SCENE2D) {\n                    this.morphTo2D(0);\n                } else if (value === SceneMode.SCENE3D) {\n                    this.morphTo3D(0);\n                } else if (value === SceneMode.COLUMBUS_VIEW) {\n                    this.morphToColumbusView(0);\n                    \n                }\n                this._mode = value;\n            }\n        },\n\n        /**\n         * Gets the number of frustums used in the last frame.\n         * @memberof Scene.prototype\n         * @type {FrustumCommands[]}\n         *\n         * @private\n         */\n        frustumCommandsList : {\n            get : function() {\n                return this._view.frustumCommandsList;\n            }\n        },\n\n        /**\n         * Gets the number of frustums used in the last frame.\n         * @memberof Scene.prototype\n         * @type {Number}\n         *\n         * @private\n         */\n        numberOfFrustums : {\n            get : function() {\n                return this._view.frustumCommandsList.length;\n            }\n        },\n\n        /**\n         * Gets the scalar used to exaggerate the terrain.\n         * @memberof Scene.prototype\n         * @type {Number}\n         */\n        terrainExaggeration : {\n            get : function() {\n                return this._terrainExaggeration;\n            }\n        },\n\n        /**\n         * When <code>true</code>, splits the scene into two viewports with steroscopic views for the left and right eyes.\n         * Used for cardboard and WebVR.\n         * @memberof Scene.prototype\n         * @type {Boolean}\n         * @default false\n         */\n        useWebVR : {\n            get : function() {\n                return this._useWebVR;\n            },\n            set : function(value) {\n                \n                this._useWebVR = value;\n                if (this._useWebVR) {\n                    this._frameState.creditDisplay.container.style.visibility = 'hidden';\n                    this._cameraVR = new Camera(this);\n                    if (!defined(this._deviceOrientationCameraController)) {\n                        this._deviceOrientationCameraController = new DeviceOrientationCameraController(this);\n                    }\n\n                    this._aspectRatioVR = this.camera.frustum.aspectRatio;\n                } else {\n                    this._frameState.creditDisplay.container.style.visibility = 'visible';\n                    this._cameraVR = undefined;\n                    this._deviceOrientationCameraController = this._deviceOrientationCameraController && !this._deviceOrientationCameraController.isDestroyed() && this._deviceOrientationCameraController.destroy();\n\n                    this.camera.frustum.aspectRatio = this._aspectRatioVR;\n                    this.camera.frustum.xOffset = 0.0;\n                }\n            }\n        },\n\n        /**\n         * Determines if the 2D map is rotatable or can be scrolled infinitely in the horizontal direction.\n         * @memberof Scene.prototype\n         * @type {MapMode2D}\n         */\n        mapMode2D : {\n            get : function() {\n                return this._mapMode2D;\n            }\n        },\n\n        /**\n         * Gets or sets the position of the Imagery splitter within the viewport.  Valid values are between 0.0 and 1.0.\n         * @memberof Scene.prototype\n         *\n         * @type {Number}\n         */\n        imagerySplitPosition : {\n            get: function() {\n                return this._frameState.imagerySplitPosition;\n            },\n            set: function(value) {\n                this._frameState.imagerySplitPosition = value;\n            }\n        },\n\n        /**\n         * The distance from the camera at which to disable the depth test of billboards, labels and points\n         * to, for example, prevent clipping against terrain. When set to zero, the depth test should always\n         * be applied. When less than zero, the depth test should never be applied. Setting the disableDepthTestDistance\n         * property of a billboard, label or point will override this value.\n         * @memberof Scene.prototype\n         * @type {Number}\n         * @default 0.0\n         */\n        minimumDisableDepthTestDistance : {\n            get : function() {\n                return this._minimumDisableDepthTestDistance;\n            },\n            set : function(value) {\n                \n                this._minimumDisableDepthTestDistance = value;\n            }\n        },\n\n        /**\n         * Whether or not to use a logarithmic depth buffer. Enabling this option will allow for less frustums in the multi-frustum,\n         * increasing performance. This property relies on fragmentDepth being supported.\n         * @memberof Scene.prototype\n         * @type {Boolean}\n         */\n        logarithmicDepthBuffer : {\n            get : function() {\n                return this._logDepthBuffer;\n            },\n            set : function(value) {\n                value = this._context.fragmentDepth && value;\n                if (this._logDepthBuffer !== value) {\n                    this._logDepthBuffer = value;\n                    this._logDepthBufferDirty = true;\n                    this._defaultView.updateFrustums = true;\n                }\n            }\n        },\n\n        /**\n         * The value used for gamma correction. This is only used when rendering with high dynamic range.\n         * @memberof Scene.prototype\n         * @type {Number}\n         * @default 2.2\n         */\n        gamma : {\n            get : function() {\n                return this._context.uniformState.gamma;\n            },\n            set : function(value) {\n                this._context.uniformState.gamma = value;\n            }\n        },\n\n        /**\n         * Whether or not to use high dynamic range rendering.\n         * @memberof Scene.prototype\n         * @type {Boolean}\n         * @default true\n         */\n        highDynamicRange : {\n            get : function() {\n                return this._hdr;\n            },\n            set : function(value) {\n                var context = this._context;\n                var hdr = value && context.depthTexture && (context.colorBufferFloat || context.colorBufferHalfFloat);\n                this._hdrDirty = hdr !== this._hdr;\n                this._hdr = hdr;\n            }\n        },\n\n        /**\n         * Whether or not high dynamic range rendering is supported.\n         * @memberof Scene.prototype\n         * @type {Boolean}\n         * @default true\n         */\n        highDynamicRangeSupported : {\n            get : function() {\n                var context = this._context;\n                return context.depthTexture && (context.colorBufferFloat || context.colorBufferHalfFloat);\n            }\n        },\n\n        /**\n         * Gets or sets the color of the light emitted by the sun.\n         *\n         * @memberof Scene.prototype\n         * @type {Cartesian3}\n         * @default Cartesian3(1.8, 1.85, 2.0)\n         */\n        sunColor: {\n            get: function() {\n                deprecationWarning('sun-color-removed', 'scene.sunColor will be removed in Cesium 1.69. Use scene.light.color and scene.light.intensity instead.');\n                return this.light.color;\n            },\n            set: function(value) {\n                deprecationWarning('sun-color-removed', 'scene.sunColor will be removed in Cesium 1.69. Use scene.light.color and scene.light.intensity instead.');\n                var maximumComponent = Cartesian3.maximumComponent(value);\n                var sunColor = Cartesian4.fromElements(value.x, value.y, value.z, 1.0, scratchSunColor);\n                var intensity = 1.0;\n                if (maximumComponent > 1.0) {\n                    Cartesian3.divideByScalar(sunColor, maximumComponent, sunColor); // Don't divide alpha channel\n                    intensity = maximumComponent;\n                }\n                this.light.color = Color.fromCartesian4(sunColor, this.light.color);\n                this.light.intensity = intensity;\n            }\n        },\n\n        /**\n         * Ratio between a pixel and a density-independent pixel. Provides a standard unit of\n         * measure for real pixel measurements appropriate to a particular device.\n         *\n         * @memberof Scene.prototype\n         * @type {Number}\n         * @default 1.0\n         * @private\n         */\n        pixelRatio: {\n            get: function() {\n                return this._frameState.pixelRatio;\n            },\n            set: function(value) {\n                this._frameState.pixelRatio = value;\n            }\n        },\n\n        /**\n         * @private\n         */\n        opaqueFrustumNearOffset : {\n            get : function() {\n                return this._frameState.useLogDepth ? 0.9 : 0.9999;\n            }\n        }\n    });\n\n    /**\n     * Determines if a compressed texture format is supported.\n     * @param {String} format The texture format. May be the name of the format or the WebGL extension name, e.g. s3tc or WEBGL_compressed_texture_s3tc.\n     * @return {boolean} Whether or not the format is supported.\n     */\n    Scene.prototype.getCompressedTextureFormatSupported = function(format) {\n        var context = this.context;\n        return ((format === 'WEBGL_compressed_texture_s3tc' || format === 's3tc') && context.s3tc) ||\n               ((format === 'WEBGL_compressed_texture_pvrtc' || format === 'pvrtc') && context.pvrtc) ||\n               ((format === 'WEBGL_compressed_texture_etc1' || format === 'etc1') && context.etc1);\n    };\n\n    function updateDerivedCommands(scene, command, shadowsDirty) {\n        var frameState = scene._frameState;\n        var context = scene._context;\n        var oit = scene._view.oit;\n        var lightShadowMaps = frameState.shadowState.lightShadowMaps;\n        var lightShadowsEnabled = frameState.shadowState.lightShadowsEnabled;\n\n        var derivedCommands = command.derivedCommands;\n\n        if (defined(command.pickId)) {\n            derivedCommands.picking = DerivedCommand.createPickDerivedCommand(scene, command, context, derivedCommands.picking);\n        }\n\n        if (!command.pickOnly) {\n            derivedCommands.depth = DerivedCommand.createDepthOnlyDerivedCommand(scene, command, context, derivedCommands.depth);\n        }\n\n        derivedCommands.originalCommand = command;\n\n        if (scene._hdr) {\n            derivedCommands.hdr = DerivedCommand.createHdrCommand(command, context, derivedCommands.hdr);\n            command = derivedCommands.hdr.command;\n            derivedCommands = command.derivedCommands;\n        }\n\n        if (lightShadowsEnabled && command.receiveShadows) {\n            derivedCommands.shadows = ShadowMap.createReceiveDerivedCommand(lightShadowMaps, command, shadowsDirty, context, derivedCommands.shadows);\n        }\n\n        if (command.pass === Pass.TRANSLUCENT && defined(oit) && oit.isSupported()) {\n            if (lightShadowsEnabled && command.receiveShadows) {\n                derivedCommands.oit = defined(derivedCommands.oit) ? derivedCommands.oit : {};\n                derivedCommands.oit.shadows = oit.createDerivedCommands(derivedCommands.shadows.receiveCommand, context, derivedCommands.oit.shadows);\n            } else {\n                derivedCommands.oit = oit.createDerivedCommands(command, context, derivedCommands.oit);\n            }\n        }\n    }\n\n    /**\n     * @private\n     */\n    Scene.prototype.updateDerivedCommands = function(command) {\n        if (!defined(command.derivedCommands)) {\n            // Is not a DrawCommand\n            return;\n        }\n\n        var frameState = this._frameState;\n        var context = this._context;\n\n        // Update derived commands when any shadow maps become dirty\n        var shadowsDirty = false;\n        var lastDirtyTime = frameState.shadowState.lastDirtyTime;\n        if (command.lastDirtyTime !== lastDirtyTime) {\n            command.lastDirtyTime = lastDirtyTime;\n            command.dirty = true;\n            shadowsDirty = true;\n        }\n\n        var useLogDepth = frameState.useLogDepth;\n        var useHdr = this._hdr;\n        var derivedCommands = command.derivedCommands;\n        var hasLogDepthDerivedCommands = defined(derivedCommands.logDepth);\n        var hasHdrCommands = defined(derivedCommands.hdr);\n        var hasDerivedCommands = defined(derivedCommands.originalCommand);\n        var needsLogDepthDerivedCommands = useLogDepth && !hasLogDepthDerivedCommands;\n        var needsHdrCommands = useHdr && !hasHdrCommands;\n        var needsDerivedCommands = (!useLogDepth || !useHdr) && !hasDerivedCommands;\n        command.dirty = command.dirty || needsLogDepthDerivedCommands || needsHdrCommands || needsDerivedCommands;\n\n        if (command.dirty) {\n            command.dirty = false;\n\n            var shadowMaps = frameState.shadowState.shadowMaps;\n            var shadowsEnabled = frameState.shadowState.shadowsEnabled;\n            if (shadowsEnabled && command.castShadows) {\n                derivedCommands.shadows = ShadowMap.createCastDerivedCommand(shadowMaps, command, shadowsDirty, context, derivedCommands.shadows);\n            }\n\n            if (hasLogDepthDerivedCommands || needsLogDepthDerivedCommands) {\n                derivedCommands.logDepth = DerivedCommand.createLogDepthCommand(command, context, derivedCommands.logDepth);\n                updateDerivedCommands(this, derivedCommands.logDepth.command, shadowsDirty);\n            }\n            if (hasDerivedCommands || needsDerivedCommands) {\n                updateDerivedCommands(this, command, shadowsDirty);\n            }\n        }\n    };\n\n    var renderTilesetPassState = new Cesium3DTilePassState({\n        pass : Cesium3DTilePass.RENDER\n    });\n\n    var preloadTilesetPassState = new Cesium3DTilePassState({\n        pass : Cesium3DTilePass.PRELOAD\n    });\n\n    var preloadFlightTilesetPassState = new Cesium3DTilePassState({\n        pass : Cesium3DTilePass.PRELOAD_FLIGHT\n    });\n\n    var requestRenderModeDeferCheckPassState = new Cesium3DTilePassState({\n        pass : Cesium3DTilePass.REQUEST_RENDER_MODE_DEFER_CHECK\n    });\n\n    var scratchOccluderBoundingSphere = new BoundingSphere();\n    var scratchOccluder;\n\n    function getOccluder(scene) {\n        // TODO: The occluder is the top-level globe. When we add\n        //       support for multiple central bodies, this should be the closest one.\n        var globe = scene.globe;\n        if (scene._mode === SceneMode.SCENE3D && defined(globe) && globe.show && !scene._cameraUnderground) {\n            var ellipsoid = globe.ellipsoid;\n            var minimumTerrainHeight = scene.frameState.minimumTerrainHeight;\n            scratchOccluderBoundingSphere.radius = ellipsoid.minimumRadius + minimumTerrainHeight;\n            scratchOccluder = Occluder.fromBoundingSphere(scratchOccluderBoundingSphere, scene.camera.positionWC, scratchOccluder);\n            return scratchOccluder;\n        }\n\n        return undefined;\n    }\n\n    /**\n     * @private\n     */\n    Scene.prototype.clearPasses = function(passes) {\n        passes.render = false;\n        passes.pick = false;\n        passes.depth = false;\n        passes.postProcess = false;\n        passes.offscreen = false;\n    };\n\n    function updateFrameNumber(scene, frameNumber, time) {\n        var frameState = scene._frameState;\n        frameState.frameNumber = frameNumber;\n        frameState.time = JulianDate.clone(time, frameState.time);\n    }\n\n    /**\n     * @private\n     */\n    Scene.prototype.updateFrameState = function() {\n        var camera = this.camera;\n\n        var frameState = this._frameState;\n        frameState.commandList.length = 0;\n        frameState.shadowMaps.length = 0;\n        frameState.brdfLutGenerator = this._brdfLutGenerator;\n        frameState.environmentMap = this.skyBox && this.skyBox._cubeMap;\n        frameState.mode = this._mode;\n        frameState.morphTime = this.morphTime;\n        frameState.mapProjection = this.mapProjection;\n        frameState.camera = camera;\n        frameState.cullingVolume = camera.frustum.computeCullingVolume(camera.positionWC, camera.directionWC, camera.upWC);\n        frameState.occluder = getOccluder(this);\n        frameState.terrainExaggeration = this._terrainExaggeration;\n        frameState.minimumTerrainHeight = 0.0;\n        frameState.minimumDisableDepthTestDistance = this._minimumDisableDepthTestDistance;\n        frameState.invertClassification = this.invertClassification;\n        frameState.useLogDepth = this._logDepthBuffer && !(this.camera.frustum instanceof OrthographicFrustum || this.camera.frustum instanceof OrthographicOffCenterFrustum);\n        frameState.light = this.light;\n        frameState.cameraUnderground = this._cameraUnderground;\n\n        if (defined(this._specularEnvironmentMapAtlas) && this._specularEnvironmentMapAtlas.ready) {\n            frameState.specularEnvironmentMaps = this._specularEnvironmentMapAtlas.texture;\n            frameState.specularEnvironmentMapsMaximumLOD = this._specularEnvironmentMapAtlas.maximumMipmapLevel;\n        } else {\n            frameState.specularEnvironmentMaps = undefined;\n            frameState.specularEnvironmentMapsMaximumLOD = undefined;\n        }\n\n        frameState.sphericalHarmonicCoefficients = this.sphericalHarmonicCoefficients;\n\n        this._actualInvertClassificationColor = Color.clone(this.invertClassificationColor, this._actualInvertClassificationColor);\n        if (!InvertClassification.isTranslucencySupported(this._context)) {\n            this._actualInvertClassificationColor.alpha = 1.0;\n        }\n\n        frameState.invertClassificationColor = this._actualInvertClassificationColor;\n\n        if (defined(this.globe)) {\n            frameState.maximumScreenSpaceError = this.globe.maximumScreenSpaceError;\n        } else {\n            frameState.maximumScreenSpaceError = 2;\n        }\n\n        this.clearPasses(frameState.passes);\n\n        frameState.tilesetPassState = undefined;\n    };\n\n    /**\n     * @private\n     */\n    Scene.prototype.isVisible = function(command, cullingVolume, occluder) {\n        return ((defined(command)) &&\n                ((!defined(command.boundingVolume)) ||\n                 !command.cull ||\n                 ((cullingVolume.computeVisibility(command.boundingVolume) !== Intersect.OUTSIDE) &&\n                  (!defined(occluder) || !command.occlude || !command.boundingVolume.isOccluded(occluder)))));\n    };\n\n    function getAttributeLocations(shaderProgram) {\n        var attributeLocations = {};\n        var attributes = shaderProgram.vertexAttributes;\n        for (var a in attributes) {\n            if (attributes.hasOwnProperty(a)) {\n                attributeLocations[a] = attributes[a].index;\n            }\n        }\n\n        return attributeLocations;\n    }\n\n    function createDebugFragmentShaderProgram(command, scene, shaderProgram) {\n        var context = scene.context;\n        var sp = defaultValue(shaderProgram, command.shaderProgram);\n        var fs = sp.fragmentShaderSource.clone();\n\n        var targets = [];\n        fs.sources = fs.sources.map(function(source) {\n            source = ShaderSource.replaceMain(source, 'czm_Debug_main');\n            var re = /gl_FragData\\[(\\d+)\\]/g;\n            var match;\n            while ((match = re.exec(source)) !== null) {\n                if (targets.indexOf(match[1]) === -1) {\n                    targets.push(match[1]);\n                }\n            }\n            return source;\n        });\n        var length = targets.length;\n\n        var newMain =\n            'void main() \\n' +\n            '{ \\n' +\n            '    czm_Debug_main(); \\n';\n\n        var i;\n        if (scene.debugShowCommands) {\n            if (!defined(command._debugColor)) {\n                command._debugColor = Color.fromRandom();\n            }\n            var c = command._debugColor;\n            if (length > 0) {\n                for (i = 0; i < length; ++i) {\n                    newMain += '    gl_FragData[' + targets[i] + '].rgb *= vec3(' + c.red + ', ' + c.green + ', ' + c.blue + '); \\n';\n                }\n            } else {\n                newMain += '    ' + 'gl_FragColor' + '.rgb *= vec3(' + c.red + ', ' + c.green + ', ' + c.blue + '); \\n';\n            }\n        }\n\n        if (scene.debugShowFrustums) {\n            // Support up to three frustums.  If a command overlaps all\n            // three, it's code is not changed.\n            var r = (command.debugOverlappingFrustums & (1 << 0)) ? '1.0' : '0.0';\n            var g = (command.debugOverlappingFrustums & (1 << 1)) ? '1.0' : '0.0';\n            var b = (command.debugOverlappingFrustums & (1 << 2)) ? '1.0' : '0.0';\n            if (length > 0) {\n                for (i = 0; i < length; ++i) {\n                    newMain += '    gl_FragData[' + targets[i] + '].rgb *= vec3(' + r + ', ' + g + ', ' + b + '); \\n';\n                }\n            } else {\n                newMain += '    ' + 'gl_FragColor' + '.rgb *= vec3(' + r + ', ' + g + ', ' + b + '); \\n';\n            }\n        }\n\n        newMain += '}';\n\n        fs.sources.push(newMain);\n\n        var attributeLocations = getAttributeLocations(sp);\n\n        return ShaderProgram.fromCache({\n            context : context,\n            vertexShaderSource : sp.vertexShaderSource,\n            fragmentShaderSource : fs,\n            attributeLocations : attributeLocations\n        });\n    }\n\n    function executeDebugCommand(command, scene, passState) {\n        var debugCommand = DrawCommand.shallowClone(command);\n        debugCommand.shaderProgram = createDebugFragmentShaderProgram(command, scene);\n        debugCommand.execute(scene.context, passState);\n        debugCommand.shaderProgram.destroy();\n    }\n\n    var transformFrom2D = new Matrix4(0.0, 0.0, 1.0, 0.0,\n                                      1.0, 0.0, 0.0, 0.0,\n                                      0.0, 1.0, 0.0, 0.0,\n                                      0.0, 0.0, 0.0, 1.0);\n    transformFrom2D = Matrix4.inverseTransformation(transformFrom2D, transformFrom2D);\n\n    function debugShowBoundingVolume(command, scene, passState, debugFramebuffer) {\n        // Debug code to draw bounding volume for command.  Not optimized!\n        // Assumes bounding volume is a bounding sphere or box\n        var frameState = scene._frameState;\n        var context = frameState.context;\n        var boundingVolume = command.boundingVolume;\n\n        if (defined(scene._debugVolume)) {\n            scene._debugVolume.destroy();\n        }\n\n        var geometry;\n\n        var center = Cartesian3.clone(boundingVolume.center);\n        if (frameState.mode !== SceneMode.SCENE3D) {\n            center = Matrix4.multiplyByPoint(transformFrom2D, center, center);\n            var projection = frameState.mapProjection;\n            var centerCartographic = projection.unproject(center);\n            center = projection.ellipsoid.cartographicToCartesian(centerCartographic);\n        }\n\n        if (defined(boundingVolume.radius)) {\n            var radius = boundingVolume.radius;\n\n            geometry = GeometryPipeline.toWireframe(EllipsoidGeometry.createGeometry(new EllipsoidGeometry({\n                radii : new Cartesian3(radius, radius, radius),\n                vertexFormat : PerInstanceColorAppearance.FLAT_VERTEX_FORMAT\n            })));\n\n            scene._debugVolume = new Primitive({\n                geometryInstances : new GeometryInstance({\n                    geometry : geometry,\n                    modelMatrix : Matrix4.fromTranslation(center),\n                    attributes : {\n                        color : new ColorGeometryInstanceAttribute(1.0, 0.0, 0.0, 1.0)\n                    }\n                }),\n                appearance : new PerInstanceColorAppearance({\n                    flat : true,\n                    translucent : false\n                }),\n                asynchronous : false\n            });\n        } else {\n            var halfAxes = boundingVolume.halfAxes;\n\n            geometry = GeometryPipeline.toWireframe(BoxGeometry.createGeometry(BoxGeometry.fromDimensions({\n                dimensions : new Cartesian3(2.0, 2.0, 2.0),\n                vertexFormat : PerInstanceColorAppearance.FLAT_VERTEX_FORMAT\n            })));\n\n            scene._debugVolume = new Primitive({\n                geometryInstances : new GeometryInstance({\n                    geometry : geometry,\n                    modelMatrix : Matrix4.fromRotationTranslation(halfAxes, center, new Matrix4()),\n                    attributes : {\n                        color : new ColorGeometryInstanceAttribute(1.0, 0.0, 0.0, 1.0)\n                    }\n                }),\n                appearance : new PerInstanceColorAppearance({\n                    flat : true,\n                    translucent : false\n                }),\n                asynchronous : false\n            });\n        }\n\n        var savedCommandList = frameState.commandList;\n        var commandList = frameState.commandList = [];\n        scene._debugVolume.update(frameState);\n\n        command = commandList[0];\n\n        if (frameState.useLogDepth) {\n            var logDepth = DerivedCommand.createLogDepthCommand(command, context);\n            command = logDepth.command;\n        }\n\n        var framebuffer;\n        if (defined(debugFramebuffer)) {\n            framebuffer = passState.framebuffer;\n            passState.framebuffer = debugFramebuffer;\n        }\n\n        command.execute(context, passState);\n\n        if (defined(framebuffer)) {\n            passState.framebuffer = framebuffer;\n        }\n\n        frameState.commandList = savedCommandList;\n    }\n\n    function executeCommand(command, scene, context, passState, debugFramebuffer) {\n        var frameState = scene._frameState;\n\n        if ((defined(scene.debugCommandFilter)) && !scene.debugCommandFilter(command)) {\n            return;\n        }\n\n        if (command instanceof ClearCommand) {\n            command.execute(context, passState);\n            return;\n        }\n\n        if (command.debugShowBoundingVolume && (defined(command.boundingVolume))) {\n            debugShowBoundingVolume(command, scene, passState, debugFramebuffer);\n        }\n\n        if (frameState.useLogDepth && defined(command.derivedCommands.logDepth)) {\n            command = command.derivedCommands.logDepth.command;\n        }\n\n        var passes = frameState.passes;\n        if (!passes.pick && scene._hdr && defined(command.derivedCommands) && defined(command.derivedCommands.hdr)) {\n            command = command.derivedCommands.hdr.command;\n        }\n\n        if (passes.pick || passes.depth) {\n            if (passes.pick && !passes.depth && defined(command.derivedCommands.picking)) {\n                command = command.derivedCommands.picking.pickCommand;\n                command.execute(context, passState);\n                return;\n            } else if (defined(command.derivedCommands.depth)) {\n                command = command.derivedCommands.depth.depthOnlyCommand;\n                command.execute(context, passState);\n                return;\n            }\n        }\n\n        if (scene.debugShowCommands || scene.debugShowFrustums) {\n            executeDebugCommand(command, scene, passState);\n            return;\n        }\n\n        if (frameState.shadowState.lightShadowsEnabled && command.receiveShadows && defined(command.derivedCommands.shadows)) {\n            // If the command receives shadows, execute the derived shadows command.\n            // Some commands, such as OIT derived commands, do not have derived shadow commands themselves\n            // and instead shadowing is built-in. In this case execute the command regularly below.\n            command.derivedCommands.shadows.receiveCommand.execute(context, passState);\n        } else {\n            command.execute(context, passState);\n        }\n    }\n\n    function executeIdCommand(command, scene, context, passState) {\n        var frameState = scene._frameState;\n        var derivedCommands = command.derivedCommands;\n        if (!defined(derivedCommands)) {\n            return;\n        }\n\n        if (frameState.useLogDepth && defined(derivedCommands.logDepth)) {\n            command = derivedCommands.logDepth.command;\n        }\n\n        derivedCommands = command.derivedCommands;\n        if (defined(derivedCommands.picking)) {\n            command = derivedCommands.picking.pickCommand;\n            command.execute(context, passState);\n        } else if (defined(derivedCommands.depth)) {\n            command = derivedCommands.depth.depthOnlyCommand;\n            command.execute(context, passState);\n        }\n    }\n\n    function backToFront(a, b, position) {\n        return b.boundingVolume.distanceSquaredTo(position) - a.boundingVolume.distanceSquaredTo(position);\n    }\n\n    function frontToBack(a, b, position) {\n        // When distances are equal equal favor sorting b before a. This gives render priority to commands later in the list.\n        return a.boundingVolume.distanceSquaredTo(position) - b.boundingVolume.distanceSquaredTo(position) + CesiumMath.EPSILON12;\n    }\n\n    function executeTranslucentCommandsBackToFront(scene, executeFunction, passState, commands, invertClassification) {\n        var context = scene.context;\n\n        mergeSort(commands, backToFront, scene.camera.positionWC);\n\n        if (defined(invertClassification)) {\n            executeFunction(invertClassification.unclassifiedCommand, scene, context, passState);\n        }\n\n        var length = commands.length;\n        for (var i = 0; i < length; ++i) {\n            executeFunction(commands[i], scene, context, passState);\n        }\n    }\n\n    function executeTranslucentCommandsFrontToBack(scene, executeFunction, passState, commands, invertClassification) {\n        var context = scene.context;\n\n        mergeSort(commands, frontToBack, scene.camera.positionWC);\n\n        if (defined(invertClassification)) {\n            executeFunction(invertClassification.unclassifiedCommand, scene, context, passState);\n        }\n\n        var length = commands.length;\n        for (var i = 0; i < length; ++i) {\n            executeFunction(commands[i], scene, context, passState);\n        }\n    }\n\n    function getDebugGlobeDepth(scene, index) {\n        var globeDepths = scene._view.debugGlobeDepths;\n        var globeDepth = globeDepths[index];\n        if (!defined(globeDepth) && scene.context.depthTexture) {\n            globeDepth = new GlobeDepth();\n            globeDepths[index] = globeDepth;\n        }\n        return globeDepth;\n    }\n\n    var scratchPerspectiveFrustum = new PerspectiveFrustum();\n    var scratchPerspectiveOffCenterFrustum = new PerspectiveOffCenterFrustum();\n    var scratchOrthographicFrustum = new OrthographicFrustum();\n    var scratchOrthographicOffCenterFrustum = new OrthographicOffCenterFrustum();\n\n    function executeCommands(scene, passState) {\n        var camera = scene.camera;\n        var context = scene.context;\n        var us = context.uniformState;\n\n        us.updateCamera(camera);\n\n        // Create a working frustum from the original camera frustum.\n        var frustum;\n        if (defined(camera.frustum.fov)) {\n            frustum = camera.frustum.clone(scratchPerspectiveFrustum);\n        } else if (defined(camera.frustum.infiniteProjectionMatrix)){\n            frustum = camera.frustum.clone(scratchPerspectiveOffCenterFrustum);\n        } else if (defined(camera.frustum.width)) {\n            frustum = camera.frustum.clone(scratchOrthographicFrustum);\n        } else {\n            frustum = camera.frustum.clone(scratchOrthographicOffCenterFrustum);\n        }\n\n        // Ideally, we would render the sky box and atmosphere last for\n        // early-z, but we would have to draw it in each frustum\n        frustum.near = camera.frustum.near;\n        frustum.far = camera.frustum.far;\n        us.updateFrustum(frustum);\n        us.updatePass(Pass.ENVIRONMENT);\n\n        var passes = scene._frameState.passes;\n        var picking = passes.pick;\n        var environmentState = scene._environmentState;\n        var view = scene._view;\n        var renderTranslucentDepthForPick = environmentState.renderTranslucentDepthForPick;\n        var useWebVR = environmentState.useWebVR;\n\n        // Do not render environment primitives during a pick pass since they do not generate picking commands.\n        if (!picking) {\n            var skyBoxCommand = environmentState.skyBoxCommand;\n            if (defined(skyBoxCommand)) {\n                executeCommand(skyBoxCommand, scene, context, passState);\n            }\n\n            if (environmentState.isSkyAtmosphereVisible) {\n                executeCommand(environmentState.skyAtmosphereCommand, scene, context, passState);\n            }\n\n            if (environmentState.isSunVisible) {\n                environmentState.sunDrawCommand.execute(context, passState);\n                if (scene.sunBloom && !useWebVR) {\n                    var framebuffer;\n                    if (environmentState.useGlobeDepthFramebuffer) {\n                        framebuffer = view.globeDepth.framebuffer;\n                    } else if (environmentState.usePostProcess) {\n                        framebuffer = view.sceneFramebuffer.getFramebuffer();\n                    } else {\n                        framebuffer = environmentState.originalFramebuffer;\n                    }\n                    scene._sunPostProcess.execute(context);\n                    scene._sunPostProcess.copy(context, framebuffer);\n                    passState.framebuffer = framebuffer;\n                }\n            }\n\n            // Moon can be seen through the atmosphere, since the sun is rendered after the atmosphere.\n            if (environmentState.isMoonVisible) {\n                environmentState.moonCommand.execute(context, passState);\n            }\n        }\n\n        // Determine how translucent surfaces will be handled.\n        var executeTranslucentCommands;\n        if (environmentState.useOIT) {\n            if (!defined(scene._executeOITFunction)) {\n                scene._executeOITFunction = function(scene, executeFunction, passState, commands, invertClassification) {\n                    view.oit.executeCommands(scene, executeFunction, passState, commands, invertClassification);\n                };\n            }\n            executeTranslucentCommands = scene._executeOITFunction;\n        } else if (passes.render) {\n            executeTranslucentCommands = executeTranslucentCommandsBackToFront;\n        } else {\n            executeTranslucentCommands = executeTranslucentCommandsFrontToBack;\n        }\n\n        var frustumCommandsList = view.frustumCommandsList;\n        var numFrustums = frustumCommandsList.length;\n\n        var clearGlobeDepth = environmentState.clearGlobeDepth;\n        var useDepthPlane = environmentState.useDepthPlane;\n        var separatePrimitiveFramebuffer = environmentState.separatePrimitiveFramebuffer = false;\n        var clearDepth = scene._depthClearCommand;\n        var clearStencil = scene._stencilClearCommand;\n        var clearClassificationStencil = scene._classificationStencilClearCommand;\n        var depthPlane = scene._depthPlane;\n        var usePostProcessSelected = environmentState.usePostProcessSelected;\n\n        var height2D = camera.position.z;\n\n        // Execute commands in each frustum in back to front order\n        var j;\n        for (var i = 0; i < numFrustums; ++i) {\n            var index = numFrustums - i - 1;\n            var frustumCommands = frustumCommandsList[index];\n\n            if (scene.mode === SceneMode.SCENE2D) {\n                // To avoid z-fighting in 2D, move the camera to just before the frustum\n                // and scale the frustum depth to be in [1.0, nearToFarDistance2D].\n                camera.position.z = height2D - frustumCommands.near + 1.0;\n                frustum.far = Math.max(1.0, frustumCommands.far - frustumCommands.near);\n                frustum.near = 1.0;\n                us.update(scene.frameState);\n                us.updateFrustum(frustum);\n            } else {\n                // Avoid tearing artifacts between adjacent frustums in the opaque passes\n                frustum.near = index !== 0 ? frustumCommands.near * scene.opaqueFrustumNearOffset : frustumCommands.near;\n                frustum.far = frustumCommands.far;\n                us.updateFrustum(frustum);\n            }\n\n            var globeDepth = scene.debugShowGlobeDepth ? getDebugGlobeDepth(scene, index) : view.globeDepth;\n\n            if (separatePrimitiveFramebuffer) {\n                // Render to globe framebuffer in GLOBE pass\n                passState.framebuffer = globeDepth.framebuffer;\n            }\n\n            var fb;\n            if (scene.debugShowGlobeDepth && defined(globeDepth) && environmentState.useGlobeDepthFramebuffer) {\n                globeDepth.update(context, passState, view.viewport, scene._hdr, clearGlobeDepth);\n                globeDepth.clear(context, passState, scene._clearColorCommand.color);\n                fb = passState.framebuffer;\n                passState.framebuffer = globeDepth.framebuffer;\n            }\n\n            clearDepth.execute(context, passState);\n\n            if (context.stencilBuffer) {\n                clearStencil.execute(context, passState);\n            }\n\n            us.updatePass(Pass.GLOBE);\n            var commands = frustumCommands.commands[Pass.GLOBE];\n            var length = frustumCommands.indices[Pass.GLOBE];\n            for (j = 0; j < length; ++j) {\n                executeCommand(commands[j], scene, context, passState);\n            }\n\n            if (defined(globeDepth) && environmentState.useGlobeDepthFramebuffer) {\n                globeDepth.executeCopyDepth(context, passState);\n            }\n\n            if (scene.debugShowGlobeDepth && defined(globeDepth) && environmentState.useGlobeDepthFramebuffer) {\n                passState.framebuffer = fb;\n            }\n\n            // Draw terrain classification\n            us.updatePass(Pass.TERRAIN_CLASSIFICATION);\n            commands = frustumCommands.commands[Pass.TERRAIN_CLASSIFICATION];\n            length = frustumCommands.indices[Pass.TERRAIN_CLASSIFICATION];\n            for (j = 0; j < length; ++j) {\n                executeCommand(commands[j], scene, context, passState);\n            }\n\n            if (clearGlobeDepth) {\n                clearDepth.execute(context, passState);\n                if (useDepthPlane) {\n                    depthPlane.execute(context, passState);\n                }\n            }\n\n            if (separatePrimitiveFramebuffer) {\n                // Render to primitive framebuffer in all other passes\n                passState.framebuffer = globeDepth.primitiveFramebuffer;\n            }\n\n            if (!environmentState.useInvertClassification || picking) {\n                // Common/fastest path. Draw 3D Tiles and classification normally.\n\n                // Draw 3D Tiles\n                us.updatePass(Pass.CESIUM_3D_TILE);\n                commands = frustumCommands.commands[Pass.CESIUM_3D_TILE];\n                length = frustumCommands.indices[Pass.CESIUM_3D_TILE];\n                for (j = 0; j < length; ++j) {\n                    executeCommand(commands[j], scene, context, passState);\n                }\n\n                if (length > 0) {\n                    if (defined(globeDepth) && environmentState.useGlobeDepthFramebuffer) {\n                        globeDepth.executeUpdateDepth(context, passState, clearGlobeDepth);\n                    }\n\n                    // Draw classifications. Modifies 3D Tiles color.\n                    us.updatePass(Pass.CESIUM_3D_TILE_CLASSIFICATION);\n                    commands = frustumCommands.commands[Pass.CESIUM_3D_TILE_CLASSIFICATION];\n                    length = frustumCommands.indices[Pass.CESIUM_3D_TILE_CLASSIFICATION];\n                    for (j = 0; j < length; ++j) {\n                        executeCommand(commands[j], scene, context, passState);\n                    }\n                }\n            } else {\n                // When the invert classification color is opaque:\n                //    Main FBO (FBO1):                   Main_Color   + Main_DepthStencil\n                //    Invert classification FBO (FBO2) : Invert_Color + Main_DepthStencil\n                //\n                //    1. Clear FBO2 color to vec4(0.0) for each frustum\n                //    2. Draw 3D Tiles to FBO2\n                //    3. Draw classification to FBO2\n                //    4. Fullscreen pass to FBO1, draw Invert_Color when:\n                //           * Main_DepthStencil has the stencil bit set > 0 (classified)\n                //    5. Fullscreen pass to FBO1, draw Invert_Color * czm_invertClassificationColor when:\n                //           * Main_DepthStencil has stencil bit set to 0 (unclassified) and\n                //           * Invert_Color !== vec4(0.0)\n                //\n                // When the invert classification color is translucent:\n                //    Main FBO (FBO1):                  Main_Color         + Main_DepthStencil\n                //    Invert classification FBO (FBO2): Invert_Color       + Invert_DepthStencil\n                //    IsClassified FBO (FBO3):          IsClassified_Color + Invert_DepthStencil\n                //\n                //    1. Clear FBO2 and FBO3 color to vec4(0.0), stencil to 0, and depth to 1.0\n                //    2. Draw 3D Tiles to FBO2\n                //    3. Draw classification to FBO2\n                //    4. Fullscreen pass to FBO3, draw any color when\n                //           * Invert_DepthStencil has the stencil bit set > 0 (classified)\n                //    5. Fullscreen pass to FBO1, draw Invert_Color when:\n                //           * Invert_Color !== vec4(0.0) and\n                //           * IsClassified_Color !== vec4(0.0)\n                //    6. Fullscreen pass to FBO1, draw Invert_Color * czm_invertClassificationColor when:\n                //           * Invert_Color !== vec4(0.0) and\n                //           * IsClassified_Color === vec4(0.0)\n                //\n                // NOTE: Step six when translucent invert color occurs after the TRANSLUCENT pass\n                //\n                scene._invertClassification.clear(context, passState);\n\n                var opaqueClassificationFramebuffer = passState.framebuffer;\n                passState.framebuffer = scene._invertClassification._fbo;\n\n                // Draw normally\n                us.updatePass(Pass.CESIUM_3D_TILE);\n                commands = frustumCommands.commands[Pass.CESIUM_3D_TILE];\n                length = frustumCommands.indices[Pass.CESIUM_3D_TILE];\n                for (j = 0; j < length; ++j) {\n                    executeCommand(commands[j], scene, context, passState);\n                }\n\n                if (defined(globeDepth) && environmentState.useGlobeDepthFramebuffer) {\n                    globeDepth.executeUpdateDepth(context, passState, clearGlobeDepth);\n                }\n\n                // Set stencil\n                us.updatePass(Pass.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW);\n                commands = frustumCommands.commands[Pass.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW];\n                length = frustumCommands.indices[Pass.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW];\n                for (j = 0; j < length; ++j) {\n                    executeCommand(commands[j], scene, context, passState);\n                }\n\n                passState.framebuffer = opaqueClassificationFramebuffer;\n\n                // Fullscreen pass to copy classified fragments\n                scene._invertClassification.executeClassified(context, passState);\n                if (scene.frameState.invertClassificationColor.alpha === 1.0) {\n                    // Fullscreen pass to copy unclassified fragments when alpha == 1.0\n                    scene._invertClassification.executeUnclassified(context, passState);\n                }\n\n                // Clear stencil set by the classification for the next classification pass\n                if (length > 0 && context.stencilBuffer) {\n                    clearClassificationStencil.execute(context, passState);\n                }\n\n                // Draw style over classification.\n                us.updatePass(Pass.CESIUM_3D_TILE_CLASSIFICATION);\n                commands = frustumCommands.commands[Pass.CESIUM_3D_TILE_CLASSIFICATION];\n                length = frustumCommands.indices[Pass.CESIUM_3D_TILE_CLASSIFICATION];\n                for (j = 0; j < length; ++j) {\n                    executeCommand(commands[j], scene, context, passState);\n                }\n            }\n\n            if (length > 0 && context.stencilBuffer) {\n                clearStencil.execute(context, passState);\n            }\n\n            us.updatePass(Pass.OPAQUE);\n            commands = frustumCommands.commands[Pass.OPAQUE];\n            length = frustumCommands.indices[Pass.OPAQUE];\n            for (j = 0; j < length; ++j) {\n                executeCommand(commands[j], scene, context, passState);\n            }\n\n            if (index !== 0 && scene.mode !== SceneMode.SCENE2D) {\n                // Do not overlap frustums in the translucent pass to avoid blending artifacts\n                frustum.near = frustumCommands.near;\n                us.updateFrustum(frustum);\n            }\n\n            var invertClassification;\n            if (!picking && environmentState.useInvertClassification && scene.frameState.invertClassificationColor.alpha < 1.0) {\n                // Fullscreen pass to copy unclassified fragments when alpha < 1.0.\n                // Not executed when undefined.\n                invertClassification = scene._invertClassification;\n            }\n\n            us.updatePass(Pass.TRANSLUCENT);\n            commands = frustumCommands.commands[Pass.TRANSLUCENT];\n            commands.length = frustumCommands.indices[Pass.TRANSLUCENT];\n            executeTranslucentCommands(scene, executeCommand, passState, commands, invertClassification);\n\n            if (context.depthTexture && scene.useDepthPicking && (environmentState.useGlobeDepthFramebuffer || renderTranslucentDepthForPick)) {\n                // PERFORMANCE_IDEA: Use MRT to avoid the extra copy.\n                var depthStencilTexture = renderTranslucentDepthForPick ? passState.framebuffer.depthStencilTexture : globeDepth.framebuffer.depthStencilTexture;\n                var pickDepth = scene._picking.getPickDepth(scene, index);\n                pickDepth.update(context, depthStencilTexture);\n                pickDepth.executeCopyDepth(context, passState);\n            }\n\n            if (separatePrimitiveFramebuffer) {\n                // Reset framebuffer\n                passState.framebuffer = globeDepth.framebuffer;\n            }\n\n            if (picking || !usePostProcessSelected) {\n                continue;\n            }\n\n            var originalFramebuffer = passState.framebuffer;\n            passState.framebuffer = view.sceneFramebuffer.getIdFramebuffer();\n\n            // reset frustum\n            frustum.near = index !== 0 ? frustumCommands.near * scene.opaqueFrustumNearOffset : frustumCommands.near;\n            frustum.far = frustumCommands.far;\n            us.updateFrustum(frustum);\n\n            us.updatePass(Pass.GLOBE);\n            commands = frustumCommands.commands[Pass.GLOBE];\n            length = frustumCommands.indices[Pass.GLOBE];\n            for (j = 0; j < length; ++j) {\n                executeIdCommand(commands[j], scene, context, passState);\n            }\n\n            if (clearGlobeDepth) {\n                clearDepth.framebuffer = passState.framebuffer;\n                clearDepth.execute(context, passState);\n                clearDepth.framebuffer = undefined;\n            }\n\n            if (clearGlobeDepth && useDepthPlane) {\n                depthPlane.execute(context, passState);\n            }\n\n            us.updatePass(Pass.CESIUM_3D_TILE);\n            commands = frustumCommands.commands[Pass.CESIUM_3D_TILE];\n            length = frustumCommands.indices[Pass.CESIUM_3D_TILE];\n            for (j = 0; j < length; ++j) {\n                executeIdCommand(commands[j], scene, context, passState);\n            }\n\n            us.updatePass(Pass.OPAQUE);\n            commands = frustumCommands.commands[Pass.OPAQUE];\n            length = frustumCommands.indices[Pass.OPAQUE];\n            for (j = 0; j < length; ++j) {\n                executeIdCommand(commands[j], scene, context, passState);\n            }\n\n            us.updatePass(Pass.TRANSLUCENT);\n            commands = frustumCommands.commands[Pass.TRANSLUCENT];\n            length = frustumCommands.indices[Pass.TRANSLUCENT];\n            for (j = 0; j < length; ++j) {\n                executeIdCommand(commands[j], scene, context, passState);\n            }\n\n            passState.framebuffer = originalFramebuffer;\n        }\n    }\n\n    function executeComputeCommands(scene) {\n        var us = scene.context.uniformState;\n        us.updatePass(Pass.COMPUTE);\n\n        var sunComputeCommand = scene._environmentState.sunComputeCommand;\n        if (defined(sunComputeCommand)) {\n            sunComputeCommand.execute(scene._computeEngine);\n        }\n\n        var commandList = scene._computeCommandList;\n        var length = commandList.length;\n        for (var i = 0; i < length; ++i) {\n            commandList[i].execute(scene._computeEngine);\n        }\n    }\n\n    function executeOverlayCommands(scene, passState) {\n        var us = scene.context.uniformState;\n        us.updatePass(Pass.OVERLAY);\n\n        var context = scene.context;\n        var commandList = scene._overlayCommandList;\n        var length = commandList.length;\n        for (var i = 0; i < length; ++i) {\n            commandList[i].execute(context, passState);\n        }\n    }\n\n    function insertShadowCastCommands(scene, commandList, shadowMap) {\n        var shadowVolume = shadowMap.shadowMapCullingVolume;\n        var isPointLight = shadowMap.isPointLight;\n        var passes = shadowMap.passes;\n        var numberOfPasses = passes.length;\n\n        var length = commandList.length;\n        for (var i = 0; i < length; ++i) {\n            var command = commandList[i];\n            scene.updateDerivedCommands(command);\n\n            if (command.castShadows && (command.pass === Pass.GLOBE || command.pass === Pass.CESIUM_3D_TILE || command.pass === Pass.OPAQUE || command.pass === Pass.TRANSLUCENT)) {\n                if (scene.isVisible(command, shadowVolume)) {\n                    if (isPointLight) {\n                        for (var k = 0; k < numberOfPasses; ++k) {\n                            passes[k].commandList.push(command);\n                        }\n                    } else if (numberOfPasses === 1) {\n                        passes[0].commandList.push(command);\n                    } else {\n                        var wasVisible = false;\n                        // Loop over cascades from largest to smallest\n                        for (var j = numberOfPasses - 1; j >= 0; --j) {\n                            var cascadeVolume = passes[j].cullingVolume;\n                            if (scene.isVisible(command, cascadeVolume)) {\n                                passes[j].commandList.push(command);\n                                wasVisible = true;\n                            } else if (wasVisible) {\n                                // If it was visible in the previous cascade but now isn't\n                                // then there is no need to check any more cascades\n                                break;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    function executeShadowMapCastCommands(scene) {\n        var frameState = scene.frameState;\n        var shadowMaps = frameState.shadowState.shadowMaps;\n        var shadowMapLength = shadowMaps.length;\n\n        if (!frameState.shadowState.shadowsEnabled) {\n            return;\n        }\n\n        var context = scene.context;\n        var uniformState = context.uniformState;\n\n        for (var i = 0; i < shadowMapLength; ++i) {\n            var shadowMap = shadowMaps[i];\n            if (shadowMap.outOfView) {\n                continue;\n            }\n\n            // Reset the command lists\n            var j;\n            var passes = shadowMap.passes;\n            var numberOfPasses = passes.length;\n            for (j = 0; j < numberOfPasses; ++j) {\n                passes[j].commandList.length = 0;\n            }\n\n            // Insert the primitive/model commands into the command lists\n            var sceneCommands = scene.frameState.commandList;\n            insertShadowCastCommands(scene, sceneCommands, shadowMap);\n\n            for (j = 0; j < numberOfPasses; ++j) {\n                var pass = shadowMap.passes[j];\n                uniformState.updateCamera(pass.camera);\n                shadowMap.updatePass(context, j);\n                var numberOfCommands = pass.commandList.length;\n                for (var k = 0; k < numberOfCommands; ++k) {\n                    var command = pass.commandList[k];\n                    // Set the correct pass before rendering into the shadow map because some shaders\n                    // conditionally render based on whether the pass is translucent or opaque.\n                    uniformState.updatePass(command.pass);\n                    executeCommand(command.derivedCommands.shadows.castCommands[i], scene, context, pass.passState);\n                }\n            }\n        }\n    }\n\n    var scratchEyeTranslation = new Cartesian3();\n\n    /**\n     * @private\n     */\n    Scene.prototype.updateAndExecuteCommands = function(passState, backgroundColor) {\n        var frameState = this._frameState;\n        var mode = frameState.mode;\n        var useWebVR = this._environmentState.useWebVR;\n\n        if (useWebVR) {\n            executeWebVRCommands(this, passState, backgroundColor);\n        } else if (mode !== SceneMode.SCENE2D || this._mapMode2D === MapMode2D.ROTATE) {\n            executeCommandsInViewport(true, this, passState, backgroundColor);\n        } else {\n            updateAndClearFramebuffers(this, passState, backgroundColor);\n            execute2DViewportCommands(this, passState);\n        }\n    };\n\n    function executeWebVRCommands(scene, passState, backgroundColor) {\n        var view = scene._view;\n        var camera = view.camera;\n        var environmentState = scene._environmentState;\n        var renderTranslucentDepthForPick = environmentState.renderTranslucentDepthForPick;\n\n        updateAndClearFramebuffers(scene, passState, backgroundColor);\n\n        if (!renderTranslucentDepthForPick) {\n            updateAndRenderPrimitives(scene);\n        }\n\n        view.createPotentiallyVisibleSet(scene);\n\n        if (!renderTranslucentDepthForPick) {\n            executeComputeCommands(scene);\n            executeShadowMapCastCommands(scene);\n        }\n\n        // Based on Calculating Stereo pairs by Paul Bourke\n        // http://paulbourke.net/stereographics/stereorender/\n        var viewport = passState.viewport;\n        viewport.x = 0;\n        viewport.y = 0;\n        viewport.width = viewport.width * 0.5;\n\n        var savedCamera = Camera.clone(camera, scene._cameraVR);\n        savedCamera.frustum = camera.frustum;\n\n        var near = camera.frustum.near;\n        var fo = near * defaultValue(scene.focalLength, 5.0);\n        var eyeSeparation = defaultValue(scene.eyeSeparation, fo / 30.0);\n        var eyeTranslation = Cartesian3.multiplyByScalar(savedCamera.right, eyeSeparation * 0.5, scratchEyeTranslation);\n\n        camera.frustum.aspectRatio = viewport.width / viewport.height;\n\n        var offset = 0.5 * eyeSeparation * near / fo;\n\n        Cartesian3.add(savedCamera.position, eyeTranslation, camera.position);\n        camera.frustum.xOffset = offset;\n\n        executeCommands(scene, passState);\n\n        viewport.x = viewport.width;\n\n        Cartesian3.subtract(savedCamera.position, eyeTranslation, camera.position);\n        camera.frustum.xOffset = -offset;\n\n        executeCommands(scene, passState);\n\n        Camera.clone(savedCamera, camera);\n    }\n\n    var scratch2DViewportCartographic = new Cartographic(Math.PI, CesiumMath.PI_OVER_TWO);\n    var scratch2DViewportMaxCoord = new Cartesian3();\n    var scratch2DViewportSavedPosition = new Cartesian3();\n    var scratch2DViewportTransform = new Matrix4();\n    var scratch2DViewportCameraTransform = new Matrix4();\n    var scratch2DViewportEyePoint = new Cartesian3();\n    var scratch2DViewportWindowCoords = new Cartesian3();\n    var scratch2DViewport = new BoundingRectangle();\n\n    function execute2DViewportCommands(scene, passState) {\n        var context = scene.context;\n        var frameState = scene.frameState;\n        var camera = scene.camera;\n\n        var originalViewport = passState.viewport;\n        var viewport = BoundingRectangle.clone(originalViewport, scratch2DViewport);\n        passState.viewport = viewport;\n\n        var maxCartographic = scratch2DViewportCartographic;\n        var maxCoord = scratch2DViewportMaxCoord;\n\n        var projection = scene.mapProjection;\n        projection.project(maxCartographic, maxCoord);\n\n        var position = Cartesian3.clone(camera.position, scratch2DViewportSavedPosition);\n        var transform = Matrix4.clone(camera.transform, scratch2DViewportCameraTransform);\n        var frustum = camera.frustum.clone();\n\n        camera._setTransform(Matrix4.IDENTITY);\n\n        var viewportTransformation = Matrix4.computeViewportTransformation(viewport, 0.0, 1.0, scratch2DViewportTransform);\n        var projectionMatrix = camera.frustum.projectionMatrix;\n\n        var x = camera.positionWC.y;\n        var eyePoint = Cartesian3.fromElements(CesiumMath.sign(x) * maxCoord.x - x, 0.0, -camera.positionWC.x, scratch2DViewportEyePoint);\n        var windowCoordinates = Transforms.pointToGLWindowCoordinates(projectionMatrix, viewportTransformation, eyePoint, scratch2DViewportWindowCoords);\n\n        windowCoordinates.x = Math.floor(windowCoordinates.x);\n\n        var viewportX = viewport.x;\n        var viewportWidth = viewport.width;\n\n        if (x === 0.0 || windowCoordinates.x <= viewportX  || windowCoordinates.x >= viewportX + viewportWidth) {\n            executeCommandsInViewport(true, scene, passState);\n        } else if (Math.abs(viewportX + viewportWidth * 0.5 - windowCoordinates.x) < 1.0) {\n            viewport.width = windowCoordinates.x - viewport.x;\n\n            camera.position.x *= CesiumMath.sign(camera.position.x);\n\n            camera.frustum.right = 0.0;\n\n            frameState.cullingVolume = camera.frustum.computeCullingVolume(camera.positionWC, camera.directionWC, camera.upWC);\n            context.uniformState.update(frameState);\n\n            executeCommandsInViewport(true, scene, passState);\n\n            viewport.x = windowCoordinates.x;\n\n            camera.position.x = -camera.position.x;\n\n            camera.frustum.right = -camera.frustum.left;\n            camera.frustum.left = 0.0;\n\n            frameState.cullingVolume = camera.frustum.computeCullingVolume(camera.positionWC, camera.directionWC, camera.upWC);\n            context.uniformState.update(frameState);\n\n            executeCommandsInViewport(false, scene, passState);\n        } else if (windowCoordinates.x > viewportX + viewportWidth * 0.5) {\n            viewport.width = windowCoordinates.x - viewportX;\n\n            var right = camera.frustum.right;\n            camera.frustum.right = maxCoord.x - x;\n\n            frameState.cullingVolume = camera.frustum.computeCullingVolume(camera.positionWC, camera.directionWC, camera.upWC);\n            context.uniformState.update(frameState);\n\n            executeCommandsInViewport(true, scene, passState);\n\n            viewport.x = windowCoordinates.x;\n            viewport.width = viewportX + viewportWidth - windowCoordinates.x;\n\n            camera.position.x = -camera.position.x;\n\n            camera.frustum.left = -camera.frustum.right;\n            camera.frustum.right = right - camera.frustum.right * 2.0;\n\n            frameState.cullingVolume = camera.frustum.computeCullingVolume(camera.positionWC, camera.directionWC, camera.upWC);\n            context.uniformState.update(frameState);\n\n            executeCommandsInViewport(false, scene, passState);\n        } else {\n            viewport.x = windowCoordinates.x;\n            viewport.width = viewportX + viewportWidth - windowCoordinates.x;\n\n            var left = camera.frustum.left;\n            camera.frustum.left = -maxCoord.x - x;\n\n            frameState.cullingVolume = camera.frustum.computeCullingVolume(camera.positionWC, camera.directionWC, camera.upWC);\n            context.uniformState.update(frameState);\n\n            executeCommandsInViewport(true, scene, passState);\n\n            viewport.x = viewportX;\n            viewport.width = windowCoordinates.x - viewportX;\n\n            camera.position.x = -camera.position.x;\n\n            camera.frustum.right = -camera.frustum.left;\n            camera.frustum.left = left - camera.frustum.left * 2.0;\n\n            frameState.cullingVolume = camera.frustum.computeCullingVolume(camera.positionWC, camera.directionWC, camera.upWC);\n            context.uniformState.update(frameState);\n\n            executeCommandsInViewport(false, scene, passState);\n        }\n\n        camera._setTransform(transform);\n        Cartesian3.clone(position, camera.position);\n        camera.frustum = frustum.clone();\n        passState.viewport = originalViewport;\n    }\n\n    function executeCommandsInViewport(firstViewport, scene, passState, backgroundColor) {\n        var environmentState = scene._environmentState;\n        var view = scene._view;\n        var renderTranslucentDepthForPick = environmentState.renderTranslucentDepthForPick;\n\n        if (!firstViewport && !renderTranslucentDepthForPick) {\n            scene.frameState.commandList.length = 0;\n        }\n\n        if (!renderTranslucentDepthForPick) {\n            updateAndRenderPrimitives(scene);\n        }\n\n        view.createPotentiallyVisibleSet(scene);\n\n        if (firstViewport) {\n            if (defined(backgroundColor)) {\n                updateAndClearFramebuffers(scene, passState, backgroundColor);\n            }\n            if (!renderTranslucentDepthForPick) {\n                executeComputeCommands(scene);\n                executeShadowMapCastCommands(scene);\n            }\n        }\n\n        executeCommands(scene, passState);\n    }\n\n    var scratchCullingVolume = new CullingVolume();\n\n    /**\n     * @private\n     */\n    Scene.prototype.updateEnvironment = function() {\n        var frameState = this._frameState;\n        var view = this._view;\n\n        // Update celestial and terrestrial environment effects.\n        var environmentState = this._environmentState;\n        var renderPass = frameState.passes.render;\n        var offscreenPass = frameState.passes.offscreen;\n        var skyAtmosphere = this.skyAtmosphere;\n        var globe = this.globe;\n\n        if (!renderPass || (this._mode !== SceneMode.SCENE2D && view.camera.frustum instanceof OrthographicFrustum) || this._cameraUnderground) {\n            environmentState.skyAtmosphereCommand = undefined;\n            environmentState.skyBoxCommand = undefined;\n            environmentState.sunDrawCommand = undefined;\n            environmentState.sunComputeCommand = undefined;\n            environmentState.moonCommand = undefined;\n        } else {\n            if (defined(skyAtmosphere)) {\n                if (defined(globe)) {\n                    skyAtmosphere.setDynamicAtmosphereColor(globe.enableLighting && globe.dynamicAtmosphereLighting, globe.dynamicAtmosphereLightingFromSun);\n                    environmentState.isReadyForAtmosphere = environmentState.isReadyForAtmosphere || globe._surface._tilesToRender.length > 0;\n                }\n                environmentState.skyAtmosphereCommand = skyAtmosphere.update(frameState);\n                if (defined(environmentState.skyAtmosphereCommand)) {\n                    this.updateDerivedCommands(environmentState.skyAtmosphereCommand);\n                }\n            } else {\n                environmentState.skyAtmosphereCommand = undefined;\n            }\n\n            environmentState.skyBoxCommand = defined(this.skyBox) ? this.skyBox.update(frameState, this._hdr) : undefined;\n            var sunCommands = defined(this.sun) ? this.sun.update(frameState, view.passState, this._hdr) : undefined;\n            environmentState.sunDrawCommand = defined(sunCommands) ? sunCommands.drawCommand : undefined;\n            environmentState.sunComputeCommand = defined(sunCommands) ? sunCommands.computeCommand : undefined;\n            environmentState.moonCommand = defined(this.moon) ? this.moon.update(frameState) : undefined;\n        }\n\n        var clearGlobeDepth = environmentState.clearGlobeDepth = defined(globe) && (!globe.depthTestAgainstTerrain || this.mode === SceneMode.SCENE2D);\n        var useDepthPlane = environmentState.useDepthPlane = clearGlobeDepth && this.mode === SceneMode.SCENE3D && !this._cameraUnderground;\n        if (useDepthPlane) {\n            // Update the depth plane that is rendered in 3D when the primitives are\n            // not depth tested against terrain so primitives on the backface\n            // of the globe are not picked.\n            this._depthPlane.update(frameState);\n        }\n\n        environmentState.renderTranslucentDepthForPick = false;\n        environmentState.useWebVR = this._useWebVR && this.mode !== SceneMode.SCENE2D  && !offscreenPass;\n\n        var occluder = (frameState.mode === SceneMode.SCENE3D) ? frameState.occluder: undefined;\n        var cullingVolume = frameState.cullingVolume;\n\n        // get user culling volume minus the far plane.\n        var planes = scratchCullingVolume.planes;\n        for (var k = 0; k < 5; ++k) {\n            planes[k] = cullingVolume.planes[k];\n        }\n        cullingVolume = scratchCullingVolume;\n\n        // Determine visibility of celestial and terrestrial environment effects.\n        environmentState.isSkyAtmosphereVisible = defined(environmentState.skyAtmosphereCommand) && environmentState.isReadyForAtmosphere;\n        environmentState.isSunVisible = this.isVisible(environmentState.sunDrawCommand, cullingVolume, occluder);\n        environmentState.isMoonVisible = this.isVisible(environmentState.moonCommand, cullingVolume, occluder);\n\n        var envMaps = this.specularEnvironmentMaps;\n        var envMapAtlas = this._specularEnvironmentMapAtlas;\n        if (defined(envMaps) && (!defined(envMapAtlas) || envMapAtlas.url !== envMaps)) {\n            envMapAtlas = envMapAtlas && envMapAtlas.destroy();\n            this._specularEnvironmentMapAtlas = new OctahedralProjectedCubeMap(envMaps);\n        } else if (!defined(envMaps) && defined(envMapAtlas)) {\n            envMapAtlas.destroy();\n            this._specularEnvironmentMapAtlas = undefined;\n        }\n\n        if (defined(this._specularEnvironmentMapAtlas)) {\n            this._specularEnvironmentMapAtlas.update(frameState);\n        }\n    };\n\n    function updateDebugFrustumPlanes(scene) {\n        var frameState = scene._frameState;\n        if (scene.debugShowFrustumPlanes !== scene._debugShowFrustumPlanes) {\n            if (scene.debugShowFrustumPlanes) {\n                scene._debugFrustumPlanes = new DebugCameraPrimitive({\n                    camera: scene.camera,\n                    updateOnChange: false\n                });\n            } else {\n                scene._debugFrustumPlanes = scene._debugFrustumPlanes && scene._debugFrustumPlanes.destroy();\n            }\n            scene._debugShowFrustumPlanes = scene.debugShowFrustumPlanes;\n        }\n\n        if (defined(scene._debugFrustumPlanes)) {\n            scene._debugFrustumPlanes.update(frameState);\n        }\n    }\n\n    function updateShadowMaps(scene) {\n        var frameState = scene._frameState;\n        var shadowMaps = frameState.shadowMaps;\n        var length = shadowMaps.length;\n\n        var shadowsEnabled = (length > 0) && !frameState.passes.pick && (scene.mode === SceneMode.SCENE3D);\n        if (shadowsEnabled !== frameState.shadowState.shadowsEnabled) {\n            // Update derived commands when shadowsEnabled changes\n            ++frameState.shadowState.lastDirtyTime;\n            frameState.shadowState.shadowsEnabled = shadowsEnabled;\n        }\n\n        frameState.shadowState.lightShadowsEnabled = false;\n\n        if (!shadowsEnabled) {\n            return;\n        }\n\n        // Check if the shadow maps are different than the shadow maps last frame.\n        // If so, the derived commands need to be updated.\n        for (var j = 0; j < length; ++j) {\n            if (shadowMaps[j] !== frameState.shadowState.shadowMaps[j]) {\n                ++frameState.shadowState.lastDirtyTime;\n                break;\n            }\n        }\n\n        frameState.shadowState.shadowMaps.length = 0;\n        frameState.shadowState.lightShadowMaps.length = 0;\n\n        for (var i = 0; i < length; ++i) {\n            var shadowMap = shadowMaps[i];\n            shadowMap.update(frameState);\n\n            frameState.shadowState.shadowMaps.push(shadowMap);\n\n            if (shadowMap.fromLightSource) {\n                frameState.shadowState.lightShadowMaps.push(shadowMap);\n                frameState.shadowState.lightShadowsEnabled = true;\n            }\n\n            if (shadowMap.dirty) {\n                ++frameState.shadowState.lastDirtyTime;\n                shadowMap.dirty = false;\n            }\n        }\n    }\n\n    function updateAndRenderPrimitives(scene) {\n        var frameState = scene._frameState;\n\n        scene._groundPrimitives.update(frameState);\n        scene._primitives.update(frameState);\n\n        updateDebugFrustumPlanes(scene);\n        updateShadowMaps(scene);\n\n        if (scene._globe) {\n            scene._globe.render(frameState);\n        }\n    }\n\n    function updateAndClearFramebuffers(scene, passState, clearColor) {\n        var context = scene._context;\n        var frameState = scene._frameState;\n        var environmentState = scene._environmentState;\n        var view = scene._view;\n\n        var passes = scene._frameState.passes;\n        var picking = passes.pick;\n        var useWebVR = environmentState.useWebVR;\n\n        // Preserve the reference to the original framebuffer.\n        environmentState.originalFramebuffer = passState.framebuffer;\n\n        // Manage sun bloom post-processing effect.\n        if (defined(scene.sun) && scene.sunBloom !== scene._sunBloom) {\n            if (scene.sunBloom && !useWebVR) {\n                scene._sunPostProcess = new SunPostProcess();\n            } else if(defined(scene._sunPostProcess)){\n                scene._sunPostProcess = scene._sunPostProcess.destroy();\n            }\n\n            scene._sunBloom = scene.sunBloom;\n        } else if (!defined(scene.sun) && defined(scene._sunPostProcess)) {\n            scene._sunPostProcess = scene._sunPostProcess.destroy();\n            scene._sunBloom = false;\n        }\n\n        // Clear the pass state framebuffer.\n        var clear = scene._clearColorCommand;\n        Color.clone(clearColor, clear.color);\n        clear.execute(context, passState);\n\n        // Update globe depth rendering based on the current context and clear the globe depth framebuffer.\n        // Globe depth is copied for the pick pass to support picking batched geometries in GroundPrimitives.\n        var useGlobeDepthFramebuffer = environmentState.useGlobeDepthFramebuffer = defined(view.globeDepth);\n        if (useGlobeDepthFramebuffer) {\n            view.globeDepth.update(context, passState, view.viewport, scene._hdr, environmentState.clearGlobeDepth);\n            view.globeDepth.clear(context, passState, clearColor);\n        }\n\n        // If supported, configure OIT to use the globe depth framebuffer and clear the OIT framebuffer.\n        var oit = view.oit;\n        var useOIT = environmentState.useOIT = !picking && defined(oit) && oit.isSupported();\n        if (useOIT) {\n            oit.update(context, passState, view.globeDepth.framebuffer, scene._hdr);\n            oit.clear(context, passState, clearColor);\n            environmentState.useOIT = oit.isSupported();\n        }\n\n        var postProcess = scene.postProcessStages;\n        var usePostProcess = environmentState.usePostProcess = !picking && (scene._hdr || postProcess.length > 0 || postProcess.ambientOcclusion.enabled || postProcess.fxaa.enabled || postProcess.bloom.enabled);\n        environmentState.usePostProcessSelected = false;\n        if (usePostProcess) {\n            view.sceneFramebuffer.update(context, view.viewport, scene._hdr);\n            view.sceneFramebuffer.clear(context, passState, clearColor);\n\n            postProcess.update(context, frameState.useLogDepth, scene._hdr);\n            postProcess.clear(context);\n\n            usePostProcess = environmentState.usePostProcess = postProcess.ready;\n            environmentState.usePostProcessSelected = usePostProcess && postProcess.hasSelected;\n        }\n\n        if (environmentState.isSunVisible && scene.sunBloom && !useWebVR) {\n            passState.framebuffer = scene._sunPostProcess.update(passState);\n            scene._sunPostProcess.clear(context, passState, clearColor);\n        } else if (useGlobeDepthFramebuffer) {\n            passState.framebuffer = view.globeDepth.framebuffer;\n        } else if (usePostProcess) {\n            passState.framebuffer = view.sceneFramebuffer.getFramebuffer();\n        }\n\n        if (defined(passState.framebuffer)) {\n            clear.execute(context, passState);\n        }\n\n        var useInvertClassification = environmentState.useInvertClassification = !picking && defined(passState.framebuffer) && scene.invertClassification;\n        if (useInvertClassification) {\n            var depthFramebuffer;\n            if (scene.frameState.invertClassificationColor.alpha === 1.0) {\n                if (environmentState.useGlobeDepthFramebuffer) {\n                    depthFramebuffer = view.globeDepth.framebuffer;\n                }\n            }\n\n            if (defined(depthFramebuffer) || context.depthTexture) {\n                scene._invertClassification.previousFramebuffer = depthFramebuffer;\n                scene._invertClassification.update(context);\n                scene._invertClassification.clear(context, passState);\n\n                if (scene.frameState.invertClassificationColor.alpha < 1.0 && useOIT) {\n                    var command = scene._invertClassification.unclassifiedCommand;\n                    var derivedCommands = command.derivedCommands;\n                    derivedCommands.oit = oit.createDerivedCommands(command, context, derivedCommands.oit);\n                }\n            } else {\n                environmentState.useInvertClassification = false;\n            }\n        }\n    }\n\n    /**\n     * @private\n     */\n    Scene.prototype.resolveFramebuffers = function(passState) {\n        var context = this._context;\n        var frameState = this._frameState;\n        var environmentState = this._environmentState;\n        var view = this._view;\n        var globeDepth = view.globeDepth;\n\n        var useOIT = environmentState.useOIT;\n        var useGlobeDepthFramebuffer = environmentState.useGlobeDepthFramebuffer;\n        var usePostProcess = environmentState.usePostProcess;\n\n        var defaultFramebuffer = environmentState.originalFramebuffer;\n        var globeFramebuffer = useGlobeDepthFramebuffer ? globeDepth.framebuffer : undefined;\n        var sceneFramebuffer = view.sceneFramebuffer.getFramebuffer();\n        var idFramebuffer = view.sceneFramebuffer.getIdFramebuffer();\n\n        if (environmentState.separatePrimitiveFramebuffer) {\n            // Merge primitive framebuffer into globe framebuffer\n            globeDepth.executeMergeColor(context, passState);\n        }\n\n        if (useOIT) {\n            passState.framebuffer = usePostProcess ? sceneFramebuffer : defaultFramebuffer;\n            view.oit.execute(context, passState);\n        }\n\n        if (usePostProcess) {\n            var inputFramebuffer = sceneFramebuffer;\n            if (useGlobeDepthFramebuffer && !useOIT) {\n                inputFramebuffer = globeFramebuffer;\n            }\n\n            var postProcess = this.postProcessStages;\n            var colorTexture = inputFramebuffer.getColorTexture(0);\n            var idTexture = idFramebuffer.getColorTexture(0);\n            var depthTexture = defaultValue(globeFramebuffer, sceneFramebuffer).depthStencilTexture;\n            postProcess.execute(context, colorTexture, depthTexture, idTexture);\n            postProcess.copy(context, defaultFramebuffer);\n        }\n\n        if (!useOIT && !usePostProcess && useGlobeDepthFramebuffer) {\n            passState.framebuffer = defaultFramebuffer;\n            globeDepth.executeCopyColor(context, passState);\n        }\n\n        var useLogDepth = frameState.useLogDepth;\n\n        if (this.debugShowGlobeDepth && useGlobeDepthFramebuffer) {\n            var gd = getDebugGlobeDepth(this, this.debugShowDepthFrustum - 1);\n            gd.executeDebugGlobeDepth(context, passState, useLogDepth);\n        }\n\n        if (this.debugShowPickDepth && useGlobeDepthFramebuffer) {\n            var pd = this._picking.getPickDepth(this, this.debugShowDepthFrustum - 1);\n            pd.executeDebugPickDepth(context, passState, useLogDepth);\n        }\n    };\n\n    function callAfterRenderFunctions(scene) {\n        // Functions are queued up during primitive update and executed here in case\n        // the function modifies scene state that should remain constant over the frame.\n        var functions = scene._frameState.afterRender;\n        for (var i = 0, length = functions.length; i < length; ++i) {\n            functions[i]();\n            scene.requestRender();\n        }\n\n        functions.length = 0;\n    }\n\n    function isCameraUnderground(scene) {\n        var camera = scene.camera;\n        var mode = scene._mode;\n        var globe = scene.globe;\n        var cameraController = scene._screenSpaceCameraController;\n        var cartographic = camera.positionCartographic;\n\n        if (!cameraController.onMap() && (cartographic.height < 0.0)) {\n            // The camera can go off the map while in Columbus View.\n            // Make a best guess as to whether it's underground by checking if its height is less than zero.\n            return true;\n        }\n\n        if (!defined(globe) || !globe.show || mode === SceneMode.SCENE2D || mode === SceneMode.MORPHING) {\n            return false;\n        }\n\n        if (cameraController.adjustedHeightForTerrain()) {\n            // The camera controller already adjusted the camera, no need to call globe.getHeight again\n            return false;\n        }\n\n        var globeHeight = globe.getHeight(cartographic);\n        if (defined(globeHeight) && (cartographic.height < globeHeight)) {\n            return true;\n        }\n\n        return false;\n    }\n\n    /**\n     * @private\n     */\n    Scene.prototype.initializeFrame = function() {\n        // Destroy released shaders and textures once every 120 frames to avoid thrashing the cache\n        if (this._shaderFrameCount++ === 120) {\n            this._shaderFrameCount = 0;\n            this._context.shaderCache.destroyReleasedShaderPrograms();\n            this._context.textureCache.destroyReleasedTextures();\n        }\n\n        this._tweens.update();\n\n        this._screenSpaceCameraController.update();\n        if (defined(this._deviceOrientationCameraController)) {\n            this._deviceOrientationCameraController.update();\n        }\n\n        this.camera.update(this._mode);\n        this.camera._updateCameraChanged();\n\n        this._cameraUnderground = isCameraUnderground(this);\n    };\n\n    function updateDebugShowFramesPerSecond(scene, renderedThisFrame) {\n        if (scene.debugShowFramesPerSecond) {\n            if (!defined(scene._performanceDisplay)) {\n                var performanceContainer = document.createElement('div');\n                performanceContainer.className = 'cesium-performanceDisplay-defaultContainer';\n                var container = scene._canvas.parentNode;\n                container.appendChild(performanceContainer);\n                var performanceDisplay = new PerformanceDisplay({container: performanceContainer});\n                scene._performanceDisplay = performanceDisplay;\n                scene._performanceContainer = performanceContainer;\n            }\n\n            scene._performanceDisplay.throttled = scene.requestRenderMode;\n            scene._performanceDisplay.update(renderedThisFrame);\n        } else if (defined(scene._performanceDisplay)) {\n            scene._performanceDisplay = scene._performanceDisplay && scene._performanceDisplay.destroy();\n            scene._performanceContainer.parentNode.removeChild(scene._performanceContainer);\n        }\n    }\n\n    function prePassesUpdate(scene) {\n        scene._jobScheduler.resetBudgets();\n\n        var frameState = scene._frameState;\n        var primitives = scene.primitives;\n        primitives.prePassesUpdate(frameState);\n\n        if (defined(scene.globe)) {\n            scene.globe.update(frameState);\n        }\n\n        scene._picking.update();\n        frameState.creditDisplay.update();\n    }\n\n    function postPassesUpdate(scene) {\n        var frameState = scene._frameState;\n        var primitives = scene.primitives;\n        primitives.postPassesUpdate(frameState);\n\n        RequestScheduler.update();\n    }\n\n    var scratchBackgroundColor = new Color();\n\n    function render(scene) {\n        var frameState = scene._frameState;\n\n        var context = scene.context;\n        var us = context.uniformState;\n\n        var view = scene._defaultView;\n        scene._view = view;\n\n        scene.updateFrameState();\n        frameState.passes.render = true;\n        frameState.passes.postProcess = scene.postProcessStages.hasSelected;\n        frameState.tilesetPassState = renderTilesetPassState;\n\n        var backgroundColor = defaultValue(scene.backgroundColor, Color.BLACK);\n        if (scene._hdr) {\n            backgroundColor = Color.clone(backgroundColor, scratchBackgroundColor);\n            backgroundColor.red = Math.pow(backgroundColor.red, scene.gamma);\n            backgroundColor.green = Math.pow(backgroundColor.green, scene.gamma);\n            backgroundColor.blue = Math.pow(backgroundColor.blue, scene.gamma);\n        }\n        frameState.backgroundColor = backgroundColor;\n\n        scene.fog.update(frameState);\n\n        us.update(frameState);\n\n        var shadowMap = scene.shadowMap;\n        if (defined(shadowMap) && shadowMap.enabled) {\n            if (!defined(scene.light) || scene.light instanceof SunLight) {\n                // Negate the sun direction so that it is from the Sun, not to the Sun\n                Cartesian3.negate(us.sunDirectionWC, scene._shadowMapCamera.direction);\n            } else {\n                Cartesian3.clone(scene.light.direction, scene._shadowMapCamera.direction);\n            }\n            frameState.shadowMaps.push(shadowMap);\n        }\n\n        scene._computeCommandList.length = 0;\n        scene._overlayCommandList.length = 0;\n\n        var viewport = view.viewport;\n        viewport.x = 0;\n        viewport.y = 0;\n        viewport.width = context.drawingBufferWidth;\n        viewport.height = context.drawingBufferHeight;\n\n        var passState = view.passState;\n        passState.framebuffer = undefined;\n        passState.blendingEnabled = undefined;\n        passState.scissorTest = undefined;\n        passState.viewport = BoundingRectangle.clone(viewport, passState.viewport);\n\n        if (defined(scene.globe)) {\n            scene.globe.beginFrame(frameState);\n        }\n\n        scene.updateEnvironment();\n        scene.updateAndExecuteCommands(passState, backgroundColor);\n        scene.resolveFramebuffers(passState);\n\n        passState.framebuffer = undefined;\n        executeOverlayCommands(scene, passState);\n\n        if (defined(scene.globe)) {\n            scene.globe.endFrame(frameState);\n\n            if (!scene.globe.tilesLoaded) {\n                scene._renderRequested = true;\n            }\n        }\n\n        context.endFrame();\n    }\n\n    function tryAndCatchError(scene, functionToExecute) {\n        try {\n            functionToExecute(scene);\n        } catch (error) {\n            scene._renderError.raiseEvent(scene, error);\n\n            if (scene.rethrowRenderErrors) {\n                throw error;\n            }\n        }\n    }\n\n    function updateMostDetailedRayPicks(scene) {\n        return scene._picking.updateMostDetailedRayPicks(scene);\n    }\n\n    /**\n     * Update and render the scene.\n     * @param {JulianDate} [time] The simulation time at which to render.\n     *\n     * @private\n     */\n    Scene.prototype.render = function(time) {\n        /**\n         *\n         * Pre passes update. Execute any pass invariant code that should run before the passes here.\n         *\n         */\n        this._preUpdate.raiseEvent(this, time);\n\n        var frameState = this._frameState;\n        frameState.newFrame = false;\n\n        if (!defined(time)) {\n            time = JulianDate.now();\n        }\n\n        // Determine if shouldRender\n        var cameraChanged = this._view.checkForCameraUpdates(this);\n        var shouldRender = !this.requestRenderMode || this._renderRequested || cameraChanged || this._logDepthBufferDirty || this._hdrDirty || (this.mode === SceneMode.MORPHING);\n        if (!shouldRender && defined(this.maximumRenderTimeChange) && defined(this._lastRenderTime)) {\n            var difference = Math.abs(JulianDate.secondsDifference(this._lastRenderTime, time));\n            shouldRender = shouldRender || difference > this.maximumRenderTimeChange;\n        }\n\n        if (shouldRender) {\n            this._lastRenderTime = JulianDate.clone(time, this._lastRenderTime);\n            this._renderRequested = false;\n            this._logDepthBufferDirty = false;\n            this._hdrDirty = false;\n\n            var frameNumber = CesiumMath.incrementWrap(frameState.frameNumber, 15000000.0, 1.0);\n            updateFrameNumber(this, frameNumber, time);\n            frameState.newFrame = true;\n        }\n\n        tryAndCatchError(this, prePassesUpdate);\n\n        /**\n         *\n         * Passes update. Add any passes here\n         *\n         */\n        if (this.primitives.show) {\n            tryAndCatchError(this, updateMostDetailedRayPicks);\n            tryAndCatchError(this, updatePreloadPass);\n            tryAndCatchError(this, updatePreloadFlightPass);\n            if (!shouldRender) {\n                tryAndCatchError(this, updateRequestRenderModeDeferCheckPass);\n            }\n        }\n\n        this._postUpdate.raiseEvent(this, time);\n\n        if (shouldRender) {\n            this._preRender.raiseEvent(this, time);\n            frameState.creditDisplay.beginFrame();\n            tryAndCatchError(this, render);\n        }\n\n        /**\n         *\n         * Post passes update. Execute any pass invariant code that should run after the passes here.\n         *\n         */\n        updateDebugShowFramesPerSecond(this, shouldRender);\n        tryAndCatchError(this, postPassesUpdate);\n\n        // Often used to trigger events (so don't want in trycatch) that the user might be subscribed to. Things like the tile load events, ready promises, etc.\n        // We don't want those events to resolve during the render loop because the events might add new primitives\n        callAfterRenderFunctions(this);\n\n        if (shouldRender) {\n            this._postRender.raiseEvent(this, time);\n            frameState.creditDisplay.endFrame();\n        }\n    };\n\n    /**\n     * Update and render the scene. Always forces a new render frame regardless of whether a render was\n     * previously requested.\n     * @param {JulianDate} [time] The simulation time at which to render.\n     *\n     * @private\n     */\n    Scene.prototype.forceRender = function(time) {\n        this._renderRequested = true;\n        this.render(time);\n    };\n\n    /**\n     * Requests a new rendered frame when {@link Scene#requestRenderMode} is set to <code>true</code>.\n     * The render rate will not exceed the {@link CesiumWidget#targetFrameRate}.\n     *\n     * @see Scene#requestRenderMode\n     */\n    Scene.prototype.requestRender = function() {\n        this._renderRequested = true;\n    };\n\n    /**\n     * @private\n     */\n    Scene.prototype.clampLineWidth = function(width) {\n        return Math.max(ContextLimits.minimumAliasedLineWidth, Math.min(width, ContextLimits.maximumAliasedLineWidth));\n    };\n\n    /**\n     * Returns an object with a `primitive` property that contains the first (top) primitive in the scene\n     * at a particular window coordinate or undefined if nothing is at the location. Other properties may\n     * potentially be set depending on the type of primitive and may be used to further identify the picked object.\n     * <p>\n     * When a feature of a 3D Tiles tileset is picked, <code>pick</code> returns a {@link Cesium3DTileFeature} object.\n     * </p>\n     *\n     * @example\n     * // On mouse over, color the feature yellow.\n     * handler.setInputAction(function(movement) {\n     *     var feature = scene.pick(movement.endPosition);\n     *     if (feature instanceof Cesium.Cesium3DTileFeature) {\n     *         feature.color = Cesium.Color.YELLOW;\n     *     }\n     * }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\n     *\n     * @param {Cartesian2} windowPosition Window coordinates to perform picking on.\n     * @param {Number} [width=3] Width of the pick rectangle.\n     * @param {Number} [height=3] Height of the pick rectangle.\n     * @returns {Object} Object containing the picked primitive.\n     */\n    Scene.prototype.pick = function(windowPosition, width, height) {\n        return this._picking.pick(this, windowPosition, width, height);\n    };\n\n    /**\n     * Returns the cartesian position reconstructed from the depth buffer and window position.\n     * The returned position is in world coordinates. Used internally by camera functions to\n     * prevent conversion to projected 2D coordinates and then back.\n     * <p>\n     * Set {@link Scene#pickTranslucentDepth} to <code>true</code> to include the depth of\n     * translucent primitives; otherwise, this essentially picks through translucent primitives.\n     * </p>\n     *\n     * @private\n     *\n     * @param {Cartesian2} windowPosition Window coordinates to perform picking on.\n     * @param {Cartesian3} [result] The object on which to restore the result.\n     * @returns {Cartesian3} The cartesian position in world coordinates.\n     *\n     * @exception {DeveloperError} Picking from the depth buffer is not supported. Check pickPositionSupported.\n     */\n    Scene.prototype.pickPositionWorldCoordinates = function(windowPosition, result) {\n        return this._picking.pickPositionWorldCoordinates(this, windowPosition, result);\n    };\n\n    /**\n     * Returns the cartesian position reconstructed from the depth buffer and window position.\n     * <p>\n     * The position reconstructed from the depth buffer in 2D may be slightly different from those\n     * reconstructed in 3D and Columbus view. This is caused by the difference in the distribution\n     * of depth values of perspective and orthographic projection.\n     * </p>\n     * <p>\n     * Set {@link Scene#pickTranslucentDepth} to <code>true</code> to include the depth of\n     * translucent primitives; otherwise, this essentially picks through translucent primitives.\n     * </p>\n     *\n     * @param {Cartesian2} windowPosition Window coordinates to perform picking on.\n     * @param {Cartesian3} [result] The object on which to restore the result.\n     * @returns {Cartesian3} The cartesian position.\n     *\n     * @exception {DeveloperError} Picking from the depth buffer is not supported. Check pickPositionSupported.\n     */\n    Scene.prototype.pickPosition = function(windowPosition, result) {\n        return this._picking.pickPosition(this, windowPosition, result);\n    };\n\n    /**\n     * Returns a list of objects, each containing a `primitive` property, for all primitives at\n     * a particular window coordinate position. Other properties may also be set depending on the\n     * type of primitive and may be used to further identify the picked object. The primitives in\n     * the list are ordered by their visual order in the scene (front to back).\n     *\n     * @param {Cartesian2} windowPosition Window coordinates to perform picking on.\n     * @param {Number} [limit] If supplied, stop drilling after collecting this many picks.\n     * @param {Number} [width=3] Width of the pick rectangle.\n     * @param {Number} [height=3] Height of the pick rectangle.\n     * @returns {Object[]} Array of objects, each containing 1 picked primitives.\n     *\n     * @exception {DeveloperError} windowPosition is undefined.\n     *\n     * @example\n     * var pickedObjects = scene.drillPick(new Cesium.Cartesian2(100.0, 200.0));\n     *\n     * @see Scene#pick\n     */\n    Scene.prototype.drillPick = function(windowPosition, limit, width, height) {\n        return this._picking.drillPick(this, windowPosition, limit, width, height);\n    };\n\n    function updatePreloadPass(scene) {\n        var frameState = scene._frameState;\n        preloadTilesetPassState.camera = frameState.camera;\n        preloadTilesetPassState.cullingVolume = frameState.cullingVolume;\n\n        var primitives = scene.primitives;\n        primitives.updateForPass(frameState, preloadTilesetPassState);\n    }\n\n    function updatePreloadFlightPass(scene) {\n        var frameState = scene._frameState;\n        var camera = frameState.camera;\n        if (!camera.canPreloadFlight()) {\n            return;\n        }\n\n        preloadFlightTilesetPassState.camera = scene.preloadFlightCamera;\n        preloadFlightTilesetPassState.cullingVolume = scene.preloadFlightCullingVolume;\n\n        var primitives = scene.primitives;\n        primitives.updateForPass(frameState, preloadFlightTilesetPassState);\n    }\n\n    function updateRequestRenderModeDeferCheckPass(scene) {\n        // Check if any ignored requests are ready to go (to wake rendering up again)\n        scene.primitives.updateForPass(scene._frameState, requestRenderModeDeferCheckPassState);\n    }\n\n    /**\n     * Returns an object containing the first object intersected by the ray and the position of intersection,\n     * or <code>undefined</code> if there were no intersections. The intersected object has a <code>primitive</code>\n     * property that contains the intersected primitive. Other properties may be set depending on the type of primitive\n     * and may be used to further identify the picked object. The ray must be given in world coordinates.\n     * <p>\n     * This function only picks globe tiles and 3D Tiles that are rendered in the current view. Picks all other\n     * primitives regardless of their visibility.\n     * </p>\n     *\n     * @private\n     *\n     * @param {Ray} ray The ray.\n     * @param {Object[]} [objectsToExclude] A list of primitives, entities, or 3D Tiles features to exclude from the ray intersection.\n     * @param {Number} [width=0.1] Width of the intersection volume in meters.\n     * @returns {Object} An object containing the object and position of the first intersection.\n     *\n     * @exception {DeveloperError} Ray intersections are only supported in 3D mode.\n     */\n    Scene.prototype.pickFromRay = function(ray, objectsToExclude, width) {\n        return this._picking.pickFromRay(this, ray, objectsToExclude, width);\n    };\n\n    /**\n     * Returns a list of objects, each containing the object intersected by the ray and the position of intersection.\n     * The intersected object has a <code>primitive</code> property that contains the intersected primitive. Other\n     * properties may also be set depending on the type of primitive and may be used to further identify the picked object.\n     * The primitives in the list are ordered by first intersection to last intersection. The ray must be given in\n     * world coordinates.\n     * <p>\n     * This function only picks globe tiles and 3D Tiles that are rendered in the current view. Picks all other\n     * primitives regardless of their visibility.\n     * </p>\n     *\n     * @private\n     *\n     * @param {Ray} ray The ray.\n     * @param {Number} [limit=Number.MAX_VALUE] If supplied, stop finding intersections after this many intersections.\n     * @param {Object[]} [objectsToExclude] A list of primitives, entities, or 3D Tiles features to exclude from the ray intersection.\n     * @param {Number} [width=0.1] Width of the intersection volume in meters.\n     * @returns {Object[]} List of objects containing the object and position of each intersection.\n     *\n     * @exception {DeveloperError} Ray intersections are only supported in 3D mode.\n     */\n    Scene.prototype.drillPickFromRay = function(ray, limit, objectsToExclude, width) {\n        return this._picking.drillPickFromRay(this, ray, limit, objectsToExclude, width);\n    };\n\n    /**\n     * Initiates an asynchronous {@link Scene#pickFromRay} request using the maximum level of detail for 3D Tilesets\n     * regardless of visibility.\n     *\n     * @private\n     *\n     * @param {Ray} ray The ray.\n     * @param {Object[]} [objectsToExclude] A list of primitives, entities, or 3D Tiles features to exclude from the ray intersection.\n     * @param {Number} [width=0.1] Width of the intersection volume in meters.\n     * @returns {Promise.<Object>} A promise that resolves to an object containing the object and position of the first intersection.\n     *\n     * @exception {DeveloperError} Ray intersections are only supported in 3D mode.\n     */\n    Scene.prototype.pickFromRayMostDetailed = function(ray, objectsToExclude, width) {\n        return this._picking.pickFromRayMostDetailed(this, ray, objectsToExclude, width);\n    };\n\n    /**\n     * Initiates an asynchronous {@link Scene#drillPickFromRay} request using the maximum level of detail for 3D Tilesets\n     * regardless of visibility.\n     *\n     * @private\n     *\n     * @param {Ray} ray The ray.\n     * @param {Number} [limit=Number.MAX_VALUE] If supplied, stop finding intersections after this many intersections.\n     * @param {Object[]} [objectsToExclude] A list of primitives, entities, or 3D Tiles features to exclude from the ray intersection.\n     * @param {Number} [width=0.1] Width of the intersection volume in meters.\n     * @returns {Promise.<Object[]>} A promise that resolves to a list of objects containing the object and position of each intersection.\n     *\n     * @exception {DeveloperError} Ray intersections are only supported in 3D mode.\n     */\n    Scene.prototype.drillPickFromRayMostDetailed = function(ray, limit, objectsToExclude, width) {\n        return this._picking.drillPickFromRayMostDetailed(this, ray, limit, objectsToExclude, width);\n    };\n\n    /**\n     * Returns the height of scene geometry at the given cartographic position or <code>undefined</code> if there was no\n     * scene geometry to sample height from. The height of the input position is ignored. May be used to clamp objects to\n     * the globe, 3D Tiles, or primitives in the scene.\n     * <p>\n     * This function only samples height from globe tiles and 3D Tiles that are rendered in the current view. Samples height\n     * from all other primitives regardless of their visibility.\n     * </p>\n     *\n     * @param {Cartographic} position The cartographic position to sample height from.\n     * @param {Object[]} [objectsToExclude] A list of primitives, entities, or 3D Tiles features to not sample height from.\n     * @param {Number} [width=0.1] Width of the intersection volume in meters.\n     * @returns {Number} The height. This may be <code>undefined</code> if there was no scene geometry to sample height from.\n     *\n     * @example\n     * var position = new Cesium.Cartographic(-1.31968, 0.698874);\n     * var height = viewer.scene.sampleHeight(position);\n     * console.log(height);\n     *\n     * @see Scene#clampToHeight\n     * @see Scene#clampToHeightMostDetailed\n     * @see Scene#sampleHeightMostDetailed\n     *\n     * @exception {DeveloperError} sampleHeight is only supported in 3D mode.\n     * @exception {DeveloperError} sampleHeight requires depth texture support. Check sampleHeightSupported.\n     */\n    Scene.prototype.sampleHeight = function(position, objectsToExclude, width) {\n        return this._picking.sampleHeight(this, position, objectsToExclude, width);\n    };\n\n    /**\n     * Clamps the given cartesian position to the scene geometry along the geodetic surface normal. Returns the\n     * clamped position or <code>undefined</code> if there was no scene geometry to clamp to. May be used to clamp\n     * objects to the globe, 3D Tiles, or primitives in the scene.\n     * <p>\n     * This function only clamps to globe tiles and 3D Tiles that are rendered in the current view. Clamps to\n     * all other primitives regardless of their visibility.\n     * </p>\n     *\n     * @param {Cartesian3} cartesian The cartesian position.\n     * @param {Object[]} [objectsToExclude] A list of primitives, entities, or 3D Tiles features to not clamp to.\n     * @param {Number} [width=0.1] Width of the intersection volume in meters.\n     * @param {Cartesian3} [result] An optional object to return the clamped position.\n     * @returns {Cartesian3} The modified result parameter or a new Cartesian3 instance if one was not provided. This may be <code>undefined</code> if there was no scene geometry to clamp to.\n     *\n     * @example\n     * // Clamp an entity to the underlying scene geometry\n     * var position = entity.position.getValue(Cesium.JulianDate.now());\n     * entity.position = viewer.scene.clampToHeight(position);\n     *\n     * @see Scene#sampleHeight\n     * @see Scene#sampleHeightMostDetailed\n     * @see Scene#clampToHeightMostDetailed\n     *\n     * @exception {DeveloperError} clampToHeight is only supported in 3D mode.\n     * @exception {DeveloperError} clampToHeight requires depth texture support. Check clampToHeightSupported.\n     */\n    Scene.prototype.clampToHeight = function(cartesian, objectsToExclude, width, result) {\n        return this._picking.clampToHeight(this, cartesian, objectsToExclude, width, result);\n    };\n\n    /**\n     * Initiates an asynchronous {@link Scene#sampleHeight} query for an array of {@link Cartographic} positions\n     * using the maximum level of detail for 3D Tilesets in the scene. The height of the input positions is ignored.\n     * Returns a promise that is resolved when the query completes. Each point height is modified in place.\n     * If a height cannot be determined because no geometry can be sampled at that location, or another error occurs,\n     * the height is set to undefined.\n     *\n     * @param {Cartographic[]} positions The cartographic positions to update with sampled heights.\n     * @param {Object[]} [objectsToExclude] A list of primitives, entities, or 3D Tiles features to not sample height from.\n     * @param {Number} [width=0.1] Width of the intersection volume in meters.\n     * @returns {Promise.<Number[]>} A promise that resolves to the provided list of positions when the query has completed.\n     *\n     * @example\n     * var positions = [\n     *     new Cesium.Cartographic(-1.31968, 0.69887),\n     *     new Cesium.Cartographic(-1.10489, 0.83923)\n     * ];\n     * var promise = viewer.scene.sampleHeightMostDetailed(positions);\n     * promise.then(function(updatedPosition) {\n     *     // positions[0].height and positions[1].height have been updated.\n     *     // updatedPositions is just a reference to positions.\n     * }\n     *\n     * @see Scene#sampleHeight\n     *\n     * @exception {DeveloperError} sampleHeightMostDetailed is only supported in 3D mode.\n     * @exception {DeveloperError} sampleHeightMostDetailed requires depth texture support. Check sampleHeightSupported.\n     */\n    Scene.prototype.sampleHeightMostDetailed = function(positions, objectsToExclude, width) {\n        return this._picking.sampleHeightMostDetailed(this, positions, objectsToExclude, width);\n    };\n\n    /**\n     * Initiates an asynchronous {@link Scene#clampToHeight} query for an array of {@link Cartesian3} positions\n     * using the maximum level of detail for 3D Tilesets in the scene. Returns a promise that is resolved when\n     * the query completes. Each position is modified in place. If a position cannot be clamped because no geometry\n     * can be sampled at that location, or another error occurs, the element in the array is set to undefined.\n     *\n     * @param {Cartesian3[]} cartesians The cartesian positions to update with clamped positions.\n     * @param {Object[]} [objectsToExclude] A list of primitives, entities, or 3D Tiles features to not clamp to.\n     * @param {Number} [width=0.1] Width of the intersection volume in meters.\n     * @returns {Promise.<Cartesian3[]>} A promise that resolves to the provided list of positions when the query has completed.\n     *\n     * @example\n     * var cartesians = [\n     *     entities[0].position.getValue(Cesium.JulianDate.now()),\n     *     entities[1].position.getValue(Cesium.JulianDate.now())\n     * ];\n     * var promise = viewer.scene.clampToHeightMostDetailed(cartesians);\n     * promise.then(function(updatedCartesians) {\n     *     entities[0].position = updatedCartesians[0];\n     *     entities[1].position = updatedCartesians[1];\n     * }\n     *\n     * @see Scene#clampToHeight\n     *\n     * @exception {DeveloperError} clampToHeightMostDetailed is only supported in 3D mode.\n     * @exception {DeveloperError} clampToHeightMostDetailed requires depth texture support. Check clampToHeightSupported.\n     */\n    Scene.prototype.clampToHeightMostDetailed = function(cartesians, objectsToExclude, width) {\n        return this._picking.clampToHeightMostDetailed(this, cartesians, objectsToExclude, width);\n    };\n\n    /**\n     * Transforms a position in cartesian coordinates to canvas coordinates.  This is commonly used to place an\n     * HTML element at the same screen position as an object in the scene.\n     *\n     * @param {Cartesian3} position The position in cartesian coordinates.\n     * @param {Cartesian2} [result] An optional object to return the input position transformed to canvas coordinates.\n     * @returns {Cartesian2} The modified result parameter or a new Cartesian2 instance if one was not provided.  This may be <code>undefined</code> if the input position is near the center of the ellipsoid.\n     *\n     * @example\n     * // Output the canvas position of longitude/latitude (0, 0) every time the mouse moves.\n     * var scene = widget.scene;\n     * var ellipsoid = scene.globe.ellipsoid;\n     * var position = Cesium.Cartesian3.fromDegrees(0.0, 0.0);\n     * var handler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\n     * handler.setInputAction(function(movement) {\n     *     console.log(scene.cartesianToCanvasCoordinates(position));\n     * }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\n     */\n    Scene.prototype.cartesianToCanvasCoordinates = function(position, result) {\n        return SceneTransforms.wgs84ToWindowCoordinates(this, position, result);\n    };\n\n    /**\n     * Instantly completes an active transition.\n     */\n    Scene.prototype.completeMorph = function(){\n        this._transitioner.completeMorph();\n    };\n\n    /**\n     * Asynchronously transitions the scene to 2D.\n     * @param {Number} [duration=2.0] The amount of time, in seconds, for transition animations to complete.\n     */\n    Scene.prototype.morphTo2D = function(duration) {\n        var ellipsoid;\n        var globe = this.globe;\n        if (defined(globe)) {\n            ellipsoid = globe.ellipsoid;\n        } else {\n            ellipsoid = this.mapProjection.ellipsoid;\n        }\n        duration = defaultValue(duration, 2.0);\n        this._transitioner.morphTo2D(duration, ellipsoid);\n    };\n\n    /**\n     * Asynchronously transitions the scene to Columbus View.\n     * @param {Number} [duration=2.0] The amount of time, in seconds, for transition animations to complete.\n     */\n    Scene.prototype.morphToColumbusView = function(duration) {\n        var ellipsoid;\n        var globe = this.globe;\n        if (defined(globe)) {\n            ellipsoid = globe.ellipsoid;\n        } else {\n            ellipsoid = this.mapProjection.ellipsoid;\n        }\n        duration = defaultValue(duration, 2.0);\n        this._transitioner.morphToColumbusView(duration, ellipsoid);\n    };\n\n    /**\n     * Asynchronously transitions the scene to 3D.\n     * @param {Number} [duration=2.0] The amount of time, in seconds, for transition animations to complete.\n     */\n    Scene.prototype.morphTo3D = function(duration) {\n        var ellipsoid;\n        var globe = this.globe;\n        if (defined(globe)) {\n            ellipsoid = globe.ellipsoid;\n        } else {\n            ellipsoid = this.mapProjection.ellipsoid;\n        }\n        duration = defaultValue(duration, 2.0);\n        this._transitioner.morphTo3D(duration, ellipsoid);\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <br /><br />\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     *\n     * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n     *\n     * @see Scene#destroy\n     */\n    Scene.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n     * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n     * <br /><br />\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     *\n     * @example\n     * scene = scene && scene.destroy();\n     *\n     * @see Scene#isDestroyed\n     */\n    Scene.prototype.destroy = function() {\n        this._tweens.removeAll();\n        this._computeEngine = this._computeEngine && this._computeEngine.destroy();\n        this._screenSpaceCameraController = this._screenSpaceCameraController && this._screenSpaceCameraController.destroy();\n        this._deviceOrientationCameraController = this._deviceOrientationCameraController && !this._deviceOrientationCameraController.isDestroyed() && this._deviceOrientationCameraController.destroy();\n        this._primitives = this._primitives && this._primitives.destroy();\n        this._groundPrimitives = this._groundPrimitives && this._groundPrimitives.destroy();\n        this._globe = this._globe && this._globe.destroy();\n        this.skyBox = this.skyBox && this.skyBox.destroy();\n        this.skyAtmosphere = this.skyAtmosphere && this.skyAtmosphere.destroy();\n        this._debugSphere = this._debugSphere && this._debugSphere.destroy();\n        this.sun = this.sun && this.sun.destroy();\n        this._sunPostProcess = this._sunPostProcess && this._sunPostProcess.destroy();\n        this._depthPlane = this._depthPlane && this._depthPlane.destroy();\n        this._transitioner = this._transitioner && this._transitioner.destroy();\n        this._debugFrustumPlanes = this._debugFrustumPlanes && this._debugFrustumPlanes.destroy();\n        this._brdfLutGenerator = this._brdfLutGenerator && this._brdfLutGenerator.destroy();\n        this._picking = this._picking && this._picking.destroy();\n\n        this._defaultView = this._defaultView && this._defaultView.destroy();\n        this._view = undefined;\n\n        if (this._removeCreditContainer) {\n            this._canvas.parentNode.removeChild(this._creditContainer);\n        }\n\n        this.postProcessStages = this.postProcessStages && this.postProcessStages.destroy();\n\n        this._context = this._context && this._context.destroy();\n        this._frameState.creditDisplay = this._frameState.creditDisplay && this._frameState.creditDisplay.destroy();\n\n        if (defined(this._performanceDisplay)){\n            this._performanceDisplay = this._performanceDisplay && this._performanceDisplay.destroy();\n            this._performanceContainer.parentNode.removeChild(this._performanceContainer);\n        }\n\n        this._removeRequestListenerCallback();\n        this._removeTaskProcessorListenerCallback();\n        for (var i = 0; i < this._removeGlobeCallbacks.length; ++i) {\n            this._removeGlobeCallbacks[i]();\n        }\n        this._removeGlobeCallbacks.length = 0;\n\n        return destroyObject(this);\n    };\nexport default Scene;\n","/**\n * @license\n * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * * Redistributions of source code must retain the above copyright notice,\n *   this list of conditions and the following disclaimer.\n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * * Neither the name of the project nor the names of its contributors may be\n *   used to endorse or promote products derived from this software without\n *   specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * Modifications made by Analytical Graphics, Inc.\n */\n//This file is automatically rebuilt by the Cesium build process.\nexport default \"/**\\n\\\n * @license\\n\\\n * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)\\n\\\n * All rights reserved.\\n\\\n *\\n\\\n * Redistribution and use in source and binary forms, with or without\\n\\\n * modification, are permitted provided that the following conditions\\n\\\n * are met:\\n\\\n *\\n\\\n * * Redistributions of source code must retain the above copyright notice,\\n\\\n *   this list of conditions and the following disclaimer.\\n\\\n * * Redistributions in binary form must reproduce the above copyright notice,\\n\\\n *   this list of conditions and the following disclaimer in the documentation\\n\\\n *   and/or other materials provided with the distribution.\\n\\\n * * Neither the name of the project nor the names of its contributors may be\\n\\\n *   used to endorse or promote products derived from this software without\\n\\\n *   specific prior written permission.\\n\\\n *\\n\\\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \\\"AS IS\\\"\\n\\\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\\n\\\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\\n\\\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\\n\\\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\\n\\\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\\n\\\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\\n\\\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\\n\\\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\\n\\\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\\n\\\n *\\n\\\n * Modifications made by Analytical Graphics, Inc.\\n\\\n */\\n\\\n\\n\\\n // Code:  http://sponeil.net/\\n\\\n // GPU Gems 2 Article:  https://developer.nvidia.com/gpugems/GPUGems2/gpugems2_chapter16.html\\n\\\n\\n\\\n#ifdef COLOR_CORRECT\\n\\\nuniform vec3 u_hsbShift; // Hue, saturation, brightness\\n\\\n#endif\\n\\\n\\n\\\nuniform vec4 u_cameraAndRadiiAndDynamicAtmosphereColor; // Camera height, outer radius, inner radius, dynamic atmosphere color flag\\n\\\n\\n\\\n#ifdef SPLIT_ATMOSPHERE\\n\\\nuniform float u_splitDirection;\\n\\\n#endif\\n\\\n\\n\\\nconst float g = -0.95;\\n\\\nconst float g2 = g * g;\\n\\\n\\n\\\nvarying vec3 v_rayleighColor;\\n\\\nvarying vec3 v_mieColor;\\n\\\nvarying vec3 v_toCamera;\\n\\\nvarying vec3 v_positionEC;\\n\\\n\\n\\\nvoid main (void)\\n\\\n{\\n\\\n#ifdef SPLIT_ATMOSPHERE\\n\\\n    float splitPosition = czm_imagerySplitPosition;\\n\\\n    if (u_splitDirection < 0.0 && gl_FragCoord.x > splitPosition) {\\n\\\n        discard;\\n\\\n    } else if (u_splitDirection > 0.0 && gl_FragCoord.x < splitPosition) {\\n\\\n        discard;\\n\\\n    }\\n\\\n#endif\\n\\\n\\n\\\n     float lightEnum = u_cameraAndRadiiAndDynamicAtmosphereColor.w;\\n\\\n    vec3 lightDirection =\\n\\\n        czm_viewerPositionWC * float(lightEnum == 0.0) +\\n\\\n        czm_lightDirectionWC * float(lightEnum == 1.0) +\\n\\\n        czm_sunDirectionWC * float(lightEnum == 2.0);\\n\\\n    lightDirection = normalize(lightDirection);\\n\\\n\\n\\\n    // Extra normalize added for Android\\n\\\n    float cosAngle = dot(lightDirection, normalize(v_toCamera)) / length(v_toCamera);\\n\\\n    float rayleighPhase = 0.75 * (1.0 + cosAngle * cosAngle);\\n\\\n    float miePhase = 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + cosAngle * cosAngle) / pow(1.0 + g2 - 2.0 * g * cosAngle, 1.5);\\n\\\n\\n\\\n    vec3 rgb = rayleighPhase * v_rayleighColor + miePhase * v_mieColor;\\n\\\n\\n\\\n#ifndef HDR\\n\\\n    const float exposure = 2.0;\\n\\\n    rgb = vec3(1.0) - exp(-exposure * rgb);\\n\\\n#endif\\n\\\n\\n\\\n#ifdef COLOR_CORRECT\\n\\\n    // Convert rgb color to hsb\\n\\\n    vec3 hsb = czm_RGBToHSB(rgb);\\n\\\n    // Perform hsb shift\\n\\\n    hsb.x += u_hsbShift.x; // hue\\n\\\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\\n\\\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\\n\\\n    // Convert shifted hsb back to rgb\\n\\\n    rgb = czm_HSBToRGB(hsb);\\n\\\n#endif\\n\\\n\\n\\\n    // Alter alpha based on how close the viewer is to the ground (1.0 = on ground, 0.0 = at edge of atmosphere)\\n\\\n    float atmosphereAlpha = clamp((u_cameraAndRadiiAndDynamicAtmosphereColor.y - u_cameraAndRadiiAndDynamicAtmosphereColor.x) / (u_cameraAndRadiiAndDynamicAtmosphereColor.y - u_cameraAndRadiiAndDynamicAtmosphereColor.z), 0.0, 1.0);\\n\\\n\\n\\\n    // Alter alpha based on time of day (0.0 = night , 1.0 = day)\\n\\\n    float nightAlpha = (lightEnum != 0.0) ? clamp(dot(normalize(czm_viewerPositionWC), lightDirection), 0.0, 1.0) : 1.0;\\n\\\n    atmosphereAlpha *= pow(nightAlpha, 0.5);\\n\\\n\\n\\\n    gl_FragColor = vec4(rgb, mix(rgb.b, 1.0, atmosphereAlpha) * smoothstep(0.0, 1.0, czm_morphTime));\\n\\\n}\\n\\\n\";\n","/**\n * @license\n * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * * Redistributions of source code must retain the above copyright notice,\n *   this list of conditions and the following disclaimer.\n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * * Neither the name of the project nor the names of its contributors may be\n *   used to endorse or promote products derived from this software without\n *   specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * Modifications made by Analytical Graphics, Inc.\n */\n//This file is automatically rebuilt by the Cesium build process.\nexport default \"/**\\n\\\n * @license\\n\\\n * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)\\n\\\n * All rights reserved.\\n\\\n *\\n\\\n * Redistribution and use in source and binary forms, with or without\\n\\\n * modification, are permitted provided that the following conditions\\n\\\n * are met:\\n\\\n *\\n\\\n * * Redistributions of source code must retain the above copyright notice,\\n\\\n *   this list of conditions and the following disclaimer.\\n\\\n * * Redistributions in binary form must reproduce the above copyright notice,\\n\\\n *   this list of conditions and the following disclaimer in the documentation\\n\\\n *   and/or other materials provided with the distribution.\\n\\\n * * Neither the name of the project nor the names of its contributors may be\\n\\\n *   used to endorse or promote products derived from this software without\\n\\\n *   specific prior written permission.\\n\\\n *\\n\\\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \\\"AS IS\\\"\\n\\\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\\n\\\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\\n\\\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\\n\\\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\\n\\\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\\n\\\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\\n\\\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\\n\\\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\\n\\\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\\n\\\n *\\n\\\n * Modifications made by Analytical Graphics, Inc.\\n\\\n */\\n\\\n\\n\\\n // Code:  http://sponeil.net/\\n\\\n // GPU Gems 2 Article:  https://developer.nvidia.com/gpugems/GPUGems2/gpugems2_chapter16.html\\n\\\n\\n\\\nattribute vec4 position;\\n\\\n\\n\\\nuniform vec4 u_cameraAndRadiiAndDynamicAtmosphereColor; // Camera height, outer radius, inner radius, dynamic atmosphere color flag\\n\\\n\\n\\\nconst float Kr = 0.0025;\\n\\\nconst float Kr4PI = Kr * 4.0 * czm_pi;\\n\\\nconst float Km = 0.0015;\\n\\\nconst float Km4PI = Km * 4.0 * czm_pi;\\n\\\nconst float ESun = 15.0;\\n\\\nconst float KmESun = Km * ESun;\\n\\\nconst float KrESun = Kr * ESun;\\n\\\nconst vec3 InvWavelength = vec3(\\n\\\n    5.60204474633241,  // Red = 1.0 / Math.pow(0.650, 4.0)\\n\\\n    9.473284437923038, // Green = 1.0 / Math.pow(0.570, 4.0)\\n\\\n    19.643802610477206); // Blue = 1.0 / Math.pow(0.475, 4.0)\\n\\\nconst float rayleighScaleDepth = 0.25;\\n\\\n\\n\\\nconst int nSamples = 2;\\n\\\nconst float fSamples = 2.0;\\n\\\n\\n\\\nvarying vec3 v_rayleighColor;\\n\\\nvarying vec3 v_mieColor;\\n\\\nvarying vec3 v_toCamera;\\n\\\n\\n\\\nfloat scale(float cosAngle)\\n\\\n{\\n\\\n    float x = 1.0 - cosAngle;\\n\\\n    return rayleighScaleDepth  * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\\n\\\n}\\n\\\n\\n\\\nvoid main(void)\\n\\\n{\\n\\\n    // Unpack attributes\\n\\\n    float cameraHeight = u_cameraAndRadiiAndDynamicAtmosphereColor.x;\\n\\\n    float outerRadius = u_cameraAndRadiiAndDynamicAtmosphereColor.y;\\n\\\n    float innerRadius = u_cameraAndRadiiAndDynamicAtmosphereColor.z;\\n\\\n\\n\\\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\\n\\\n    vec3 positionV3 = position.xyz;\\n\\\n    vec3 ray = positionV3 - czm_viewerPositionWC;\\n\\\n    float far = length(ray);\\n\\\n    ray /= far;\\n\\\n    float atmosphereScale = 1.0 / (outerRadius - innerRadius);\\n\\\n\\n\\\n#ifdef SKY_FROM_SPACE\\n\\\n    // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\\n\\\n    float B = 2.0 * dot(czm_viewerPositionWC, ray);\\n\\\n    float C = cameraHeight * cameraHeight - outerRadius * outerRadius;\\n\\\n    float det = max(0.0, B*B - 4.0 * C);\\n\\\n    float near = 0.5 * (-B - sqrt(det));\\n\\\n\\n\\\n    // Calculate the ray's starting position, then calculate its scattering offset\\n\\\n    vec3 start = czm_viewerPositionWC + ray * near;\\n\\\n    far -= near;\\n\\\n    float startAngle = dot(ray, start) / outerRadius;\\n\\\n    float startDepth = exp(-1.0 / rayleighScaleDepth );\\n\\\n    float startOffset = startDepth*scale(startAngle);\\n\\\n#else // SKY_FROM_ATMOSPHERE\\n\\\n    // Calculate the ray's starting position, then calculate its scattering offset\\n\\\n    vec3 start = czm_viewerPositionWC;\\n\\\n    float height = length(start);\\n\\\n    float depth = exp((atmosphereScale / rayleighScaleDepth ) * (innerRadius - cameraHeight));\\n\\\n    float startAngle = dot(ray, start) / height;\\n\\\n    float startOffset = depth*scale(startAngle);\\n\\\n#endif\\n\\\n\\n\\\n    float lightEnum = u_cameraAndRadiiAndDynamicAtmosphereColor.w;\\n\\\n    vec3 lightDirection =\\n\\\n        czm_viewerPositionWC * float(lightEnum == 0.0) +\\n\\\n        czm_lightDirectionWC * float(lightEnum == 1.0) +\\n\\\n        czm_sunDirectionWC * float(lightEnum == 2.0);\\n\\\n    lightDirection = normalize(lightDirection);\\n\\\n\\n\\\n    // Initialize the scattering loop variables\\n\\\n    float sampleLength = far / fSamples;\\n\\\n    float scaledLength = sampleLength * atmosphereScale;\\n\\\n    vec3 sampleRay = ray * sampleLength;\\n\\\n    vec3 samplePoint = start + sampleRay * 0.5;\\n\\\n\\n\\\n    // Now loop through the sample rays\\n\\\n    vec3 frontColor = vec3(0.0, 0.0, 0.0);\\n\\\n\\n\\\n    for(int i=0; i<nSamples; i++)\\n\\\n    {\\n\\\n        float height = length(samplePoint);\\n\\\n        float depth = exp((atmosphereScale / rayleighScaleDepth ) * (innerRadius - height));\\n\\\n        float fLightAngle = dot(lightDirection, samplePoint) / height;\\n\\\n        float fCameraAngle = dot(ray, samplePoint) / height;\\n\\\n        float fScatter = (startOffset + depth*(scale(fLightAngle) - scale(fCameraAngle)));\\n\\\n        vec3 attenuate = exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\\n\\\n        frontColor += attenuate * (depth * scaledLength);\\n\\\n        samplePoint += sampleRay;\\n\\\n    }\\n\\\n\\n\\\n    // Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\\n\\\n    v_mieColor = frontColor * KmESun;\\n\\\n    v_rayleighColor = frontColor * (InvWavelength * KrESun);\\n\\\n    v_toCamera = czm_viewerPositionWC - positionV3;\\n\\\n    gl_Position = czm_modelViewProjection * position;\\n\\\n}\\n\\\n\";\n","import Cartesian3 from '../Core/Cartesian3.js';\nimport Cartesian4 from '../Core/Cartesian4.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport Ellipsoid from '../Core/Ellipsoid.js';\nimport EllipsoidGeometry from '../Core/EllipsoidGeometry.js';\nimport GeometryPipeline from '../Core/GeometryPipeline.js';\nimport CesiumMath from '../Core/Math.js';\nimport VertexFormat from '../Core/VertexFormat.js';\nimport BufferUsage from '../Renderer/BufferUsage.js';\nimport DrawCommand from '../Renderer/DrawCommand.js';\nimport RenderState from '../Renderer/RenderState.js';\nimport ImagerySplitDirection from './ImagerySplitDirection.js';\nimport ShaderProgram from '../Renderer/ShaderProgram.js';\nimport ShaderSource from '../Renderer/ShaderSource.js';\nimport VertexArray from '../Renderer/VertexArray.js';\nimport SkyAtmosphereFS from '../Shaders/SkyAtmosphereFS.js';\nimport SkyAtmosphereVS from '../Shaders/SkyAtmosphereVS.js';\nimport BlendingState from './BlendingState.js';\nimport CullFace from './CullFace.js';\nimport SceneMode from './SceneMode.js';\n\n    /**\n     * An atmosphere drawn around the limb of the provided ellipsoid.  Based on\n     * {@link https://developer.nvidia.com/gpugems/GPUGems2/gpugems2_chapter16.html|Accurate Atmospheric Scattering}\n     * in GPU Gems 2.\n     * <p>\n     * This is only supported in 3D. Atmosphere is faded out when morphing to 2D or Columbus view.\n     * </p>\n     *\n     * @alias SkyAtmosphere\n     * @constructor\n     *\n     * @param {Ellipsoid} [ellipsoid=Ellipsoid.WGS84] The ellipsoid that the atmosphere is drawn around.\n     *\n     * @example\n     * scene.skyAtmosphere = new Cesium.SkyAtmosphere();\n     *\n     * @demo {@link https://sandcastle.cesium.com/index.html?src=Sky%20Atmosphere.html|Sky atmosphere demo in Sandcastle}\n     *\n     * @see Scene.skyAtmosphere\n     */\n    function SkyAtmosphere(ellipsoid) {\n        ellipsoid = defaultValue(ellipsoid, Ellipsoid.WGS84);\n\n        /**\n         * Determines if the atmosphere is shown.\n         *\n         * @type {Boolean}\n         * @default true\n         */\n        this.show = true;\n\n        this._ellipsoid = ellipsoid;\n        this._command = new DrawCommand({\n            owner : this\n        });\n        this._spSkyFromSpace = undefined;\n        this._spSkyFromAtmosphere = undefined;\n\n        this._spSkyFromSpaceColorCorrect = undefined;\n        this._spSkyFromAtmosphereColorCorrect = undefined;\n\n        /**\n         * The hue shift to apply to the atmosphere. Defaults to 0.0 (no shift).\n         * A hue shift of 1.0 indicates a complete rotation of the hues available.\n         * @type {Number}\n         * @default 0.0\n         */\n        this.hueShift = 0.0;\n\n        /**\n         * The saturation shift to apply to the atmosphere. Defaults to 0.0 (no shift).\n         * A saturation shift of -1.0 is monochrome.\n         * @type {Number}\n         * @default 0.0\n         */\n        this.saturationShift = 0.0;\n\n        /**\n         * The brightness shift to apply to the atmosphere. Defaults to 0.0 (no shift).\n         * A brightness shift of -1.0 is complete darkness, which will let space show through.\n         * @type {Number}\n         * @default 0.0\n         */\n        this.brightnessShift = 0.0;\n\n        /**\n         * The {@link ImagerySplitDirection} to apply, showing the terrain only on\n         * the left or right of the splitter control.\n         *\n         * @type {ImagerySplitDirection}\n         * @default {@link ImagerySplitDirection.NONE}\n         */\n        this.splitDirection = ImagerySplitDirection.NONE;\n        this._splitDirection = undefined;\n\n        this._hueSaturationBrightness = new Cartesian3();\n\n        // camera height, outer radius, inner radius, dynamic atmosphere color flag\n        var cameraAndRadiiAndDynamicAtmosphereColor = new Cartesian4();\n\n        // Toggles whether the sun position is used. 0 treats the sun as always directly overhead.\n        cameraAndRadiiAndDynamicAtmosphereColor.w = 0;\n        cameraAndRadiiAndDynamicAtmosphereColor.y = Cartesian3.maximumComponent(Cartesian3.multiplyByScalar(ellipsoid.radii, 1.025, new Cartesian3()));\n        cameraAndRadiiAndDynamicAtmosphereColor.z = ellipsoid.maximumRadius;\n\n        this._cameraAndRadiiAndDynamicAtmosphereColor = cameraAndRadiiAndDynamicAtmosphereColor;\n\n        var that = this;\n\n        this._command.uniformMap = {\n            u_cameraAndRadiiAndDynamicAtmosphereColor : function() {\n                return that._cameraAndRadiiAndDynamicAtmosphereColor;\n            },\n            u_hsbShift : function() {\n                that._hueSaturationBrightness.x = that.hueShift;\n                that._hueSaturationBrightness.y = that.saturationShift;\n                that._hueSaturationBrightness.z = that.brightnessShift;\n                return that._hueSaturationBrightness;\n            },\n            u_splitDirection : function() {\n                return that.splitDirection;\n            }\n        };\n    }\n\n    Object.defineProperties(SkyAtmosphere.prototype, {\n        /**\n         * Gets the ellipsoid the atmosphere is drawn around.\n         * @memberof SkyAtmosphere.prototype\n         *\n         * @type {Ellipsoid}\n         * @readonly\n         */\n        ellipsoid : {\n            get : function() {\n                return this._ellipsoid;\n            }\n        }\n    });\n\n    /**\n     * @private\n     */\n    SkyAtmosphere.prototype.setDynamicAtmosphereColor = function(enableLighting, useSunDirection) {\n        this._cameraAndRadiiAndDynamicAtmosphereColor.w = enableLighting ? (useSunDirection ? 2.0 : 1.0) : 0.0;\n    };\n\n    /**\n     * @private\n     */\n    SkyAtmosphere.prototype.update = function(frameState) {\n        if (!this.show) {\n            return undefined;\n        }\n\n        var mode = frameState.mode;\n        if ((mode !== SceneMode.SCENE3D) &&\n            (mode !== SceneMode.MORPHING)) {\n            return undefined;\n        }\n\n        // The atmosphere is only rendered during the render pass; it is not pickable, it doesn't cast shadows, etc.\n        if (!frameState.passes.render) {\n            return undefined;\n        }\n\n        var command = this._command;\n\n        var context = frameState.context;\n\n        if (!defined(command.vertexArray)) {\n            var geometry = EllipsoidGeometry.createGeometry(new EllipsoidGeometry({\n                radii : Cartesian3.multiplyByScalar(this._ellipsoid.radii, 1.025, new Cartesian3()),\n                slicePartitions : 256,\n                stackPartitions : 256,\n                vertexFormat : VertexFormat.POSITION_ONLY\n            }));\n            command.vertexArray = VertexArray.fromGeometry({\n                context : context,\n                geometry : geometry,\n                attributeLocations : GeometryPipeline.createAttributeLocations(geometry),\n                bufferUsage : BufferUsage.STATIC_DRAW\n            });\n            command.renderState = RenderState.fromCache({\n                cull : {\n                    enabled : true,\n                    face : CullFace.FRONT\n                },\n                blending : BlendingState.ALPHA_BLEND,\n                depthMask : false\n            });\n        }\n\n        if (this.splitDirection !== this._splitDirection) {\n            this._spSkyFromSpace = this._spSkyFromSpace && this._spSkyFromSpace.destroy();\n            this._spSkyFromAtmosphere = this._spSkyFromAtmosphere && this._spSkyFromAtmosphere.destroy();\n            this._spSkyFromSpaceColorCorrect = this._spSkyFromSpaceColorCorrect && this._spSkyFromSpaceColorCorrect.destroy();\n            this._spSkyFromAtmosphereColorCorrect = this._spSkyFromAtmosphereColorCorrect && this._spSkyFromAtmosphereColorCorrect.destroy();\n\n            var vs = new ShaderSource({\n                defines : ['SKY_FROM_SPACE'],\n                sources : [SkyAtmosphereVS]\n            });\n\n            var fs = SkyAtmosphereFS;\n            if (this.splitDirection !== ImagerySplitDirection.NONE) {\n                fs = new ShaderSource({\n                    defines : ['SPLIT_ATMOSPHERE'],\n                    sources : [SkyAtmosphereFS]\n                });\n            }\n\n            this._spSkyFromSpace = ShaderProgram.fromCache({\n                context : context,\n                vertexShaderSource : vs,\n                fragmentShaderSource : fs\n            });\n\n            vs = new ShaderSource({\n                defines : ['SKY_FROM_ATMOSPHERE'],\n                sources : [SkyAtmosphereVS]\n            });\n            this._spSkyFromAtmosphere = ShaderProgram.fromCache({\n                context : context,\n                vertexShaderSource : vs,\n                fragmentShaderSource : fs\n            });\n\n            this._splitDirection = this.splitDirection;\n        }\n\n        // Compile the color correcting versions of the shader on demand\n        var useColorCorrect = colorCorrect(this);\n        if (useColorCorrect && (!defined(this._spSkyFromSpaceColorCorrect) || !defined(this._spSkyFromAtmosphereColorCorrect))) {\n            var contextColorCorrect = frameState.context;\n\n            var vsColorCorrect = new ShaderSource({\n                defines : ['SKY_FROM_SPACE'],\n                sources : [SkyAtmosphereVS]\n            });\n            var fsColorCorrect = new ShaderSource({\n                defines : ImagerySplitDirection.NONE ? ['COLOR_CORRECT'] : ['COLOR_CORRECT', 'SPLIT_ATMOSPHERE'],\n                sources : [SkyAtmosphereFS]\n            });\n\n            this._spSkyFromSpaceColorCorrect = ShaderProgram.fromCache({\n                context : contextColorCorrect,\n                vertexShaderSource : vsColorCorrect,\n                fragmentShaderSource : fsColorCorrect\n            });\n            vsColorCorrect = new ShaderSource({\n                defines : ['SKY_FROM_ATMOSPHERE'],\n                sources : [SkyAtmosphereVS]\n            });\n            this._spSkyFromAtmosphereColorCorrect = ShaderProgram.fromCache({\n                context : contextColorCorrect,\n                vertexShaderSource : vsColorCorrect,\n                fragmentShaderSource : fsColorCorrect\n            });\n        }\n\n        var cameraPosition = frameState.camera.positionWC;\n\n        var cameraHeight = Cartesian3.magnitude(cameraPosition);\n        this._cameraAndRadiiAndDynamicAtmosphereColor.x = cameraHeight;\n\n        if (cameraHeight > this._cameraAndRadiiAndDynamicAtmosphereColor.y) {\n            // Camera in space\n            command.shaderProgram = useColorCorrect ? this._spSkyFromSpaceColorCorrect : this._spSkyFromSpace;\n        } else {\n            // Camera in atmosphere\n            command.shaderProgram = useColorCorrect ? this._spSkyFromAtmosphereColorCorrect : this._spSkyFromAtmosphere;\n        }\n\n        return command;\n    };\n\n    function colorCorrect(skyAtmosphere) {\n        return !(CesiumMath.equalsEpsilon(skyAtmosphere.hueShift, 0.0, CesiumMath.EPSILON7) &&\n                 CesiumMath.equalsEpsilon(skyAtmosphere.saturationShift, 0.0, CesiumMath.EPSILON7) &&\n                 CesiumMath.equalsEpsilon(skyAtmosphere.brightnessShift, 0.0, CesiumMath.EPSILON7));\n    }\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <br /><br />\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     *\n     * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n     *\n     * @see SkyAtmosphere#destroy\n     */\n    SkyAtmosphere.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n     * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n     * <br /><br />\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     *\n     * @example\n     * skyAtmosphere = skyAtmosphere && skyAtmosphere.destroy();\n     *\n     * @see SkyAtmosphere#isDestroyed\n     */\n    SkyAtmosphere.prototype.destroy = function() {\n        var command = this._command;\n        command.vertexArray = command.vertexArray && command.vertexArray.destroy();\n        this._spSkyFromSpace = this._spSkyFromSpace && this._spSkyFromSpace.destroy();\n        this._spSkyFromAtmosphere = this._spSkyFromAtmosphere && this._spSkyFromAtmosphere.destroy();\n        this._spSkyFromSpaceColorCorrect = this._spSkyFromSpaceColorCorrect && this._spSkyFromSpaceColorCorrect.destroy();\n        this._spSkyFromAtmosphereColorCorrect = this._spSkyFromAtmosphereColorCorrect && this._spSkyFromAtmosphereColorCorrect.destroy();\n        return destroyObject(this);\n    };\nexport default SkyAtmosphere;\n","import Check from '../Core/Check.js';\nimport defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport Resource from '../Core/Resource.js';\nimport when from '../ThirdParty/when.js';\nimport CubeMap from './CubeMap.js';\n\n    /**\n     * Asynchronously loads six images and creates a cube map.  Returns a promise that\n     * will resolve to a {@link CubeMap} once loaded, or reject if any image fails to load.\n     *\n     * @exports loadCubeMap\n     *\n     * @param {Context} context The context to use to create the cube map.\n     * @param {Object} urls The source URL of each image.  See the example below.\n     * @returns {Promise.<CubeMap>} a promise that will resolve to the requested {@link CubeMap} when loaded.\n     *\n     * @exception {DeveloperError} context is required.\n     * @exception {DeveloperError} urls is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.\n     *\n     *\n     * @example\n     * Cesium.loadCubeMap(context, {\n     *     positiveX : 'skybox_px.png',\n     *     negativeX : 'skybox_nx.png',\n     *     positiveY : 'skybox_py.png',\n     *     negativeY : 'skybox_ny.png',\n     *     positiveZ : 'skybox_pz.png',\n     *     negativeZ : 'skybox_nz.png'\n     * }).then(function(cubeMap) {\n     *     // use the cubemap\n     * }).otherwise(function(error) {\n     *     // an error occurred\n     * });\n     *\n     * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n     * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n     *\n     * @private\n     */\n    function loadCubeMap(context, urls) {\n        \n\n        // PERFORMANCE_IDEA: Given the size of some cube maps, we should consider tiling them, which\n        // would prevent hiccups when uploading, for example, six 4096x4096 textures to the GPU.\n        //\n        // Also, it is perhaps acceptable to use the context here in the callbacks, but\n        // ideally, we would do it in the primitive's update function.\n        var flipOptions = {\n            flipY : true,\n            preferImageBitmap: true\n        };\n\n        var facePromises = [\n            Resource.createIfNeeded(urls.positiveX).fetchImage(flipOptions),\n            Resource.createIfNeeded(urls.negativeX).fetchImage(flipOptions),\n            Resource.createIfNeeded(urls.positiveY).fetchImage(flipOptions),\n            Resource.createIfNeeded(urls.negativeY).fetchImage(flipOptions),\n            Resource.createIfNeeded(urls.positiveZ).fetchImage(flipOptions),\n            Resource.createIfNeeded(urls.negativeZ).fetchImage(flipOptions)\n        ];\n\n        return when.all(facePromises, function(images) {\n            return new CubeMap({\n                context : context,\n                source : {\n                    positiveX : images[0],\n                    negativeX : images[1],\n                    positiveY : images[2],\n                    negativeY : images[3],\n                    positiveZ : images[4],\n                    negativeZ : images[5]\n                }\n            });\n        });\n    }\nexport default loadCubeMap;\n","import BoxGeometry from '../Core/BoxGeometry.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport GeometryPipeline from '../Core/GeometryPipeline.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport VertexFormat from '../Core/VertexFormat.js';\nimport BufferUsage from '../Renderer/BufferUsage.js';\nimport CubeMap from '../Renderer/CubeMap.js';\nimport DrawCommand from '../Renderer/DrawCommand.js';\nimport loadCubeMap from '../Renderer/loadCubeMap.js';\nimport RenderState from '../Renderer/RenderState.js';\nimport ShaderProgram from '../Renderer/ShaderProgram.js';\nimport ShaderSource from '../Renderer/ShaderSource.js';\nimport VertexArray from '../Renderer/VertexArray.js';\nimport SkyBoxFS from '../Shaders/SkyBoxFS.js';\nimport SkyBoxVS from '../Shaders/SkyBoxVS.js';\nimport BlendingState from './BlendingState.js';\nimport SceneMode from './SceneMode.js';\n\n    /**\n     * A sky box around the scene to draw stars.  The sky box is defined using the True Equator Mean Equinox (TEME) axes.\n     * <p>\n     * This is only supported in 3D.  The sky box is faded out when morphing to 2D or Columbus view.  The size of\n     * the sky box must not exceed {@link Scene#maximumCubeMapSize}.\n     * </p>\n     *\n     * @alias SkyBox\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Object} [options.sources] The source URL or <code>Image</code> object for each of the six cube map faces.  See the example below.\n     * @param {Boolean} [options.show=true] Determines if this primitive will be shown.\n     *\n     *\n     * @example\n     * scene.skyBox = new Cesium.SkyBox({\n     *   sources : {\n     *     positiveX : 'skybox_px.png',\n     *     negativeX : 'skybox_nx.png',\n     *     positiveY : 'skybox_py.png',\n     *     negativeY : 'skybox_ny.png',\n     *     positiveZ : 'skybox_pz.png',\n     *     negativeZ : 'skybox_nz.png'\n     *   }\n     * });\n     *\n     * @see Scene#skyBox\n     * @see Transforms.computeTemeToPseudoFixedMatrix\n     */\n    function SkyBox(options) {\n        /**\n         * The sources used to create the cube map faces: an object\n         * with <code>positiveX</code>, <code>negativeX</code>, <code>positiveY</code>,\n         * <code>negativeY</code>, <code>positiveZ</code>, and <code>negativeZ</code> properties.\n         * These can be either URLs or <code>Image</code> objects.\n         *\n         * @type Object\n         * @default undefined\n         */\n        this.sources = options.sources;\n        this._sources = undefined;\n\n        /**\n         * Determines if the sky box will be shown.\n         *\n         * @type {Boolean}\n         * @default true\n         */\n        this.show = defaultValue(options.show, true);\n\n        this._command = new DrawCommand({\n            modelMatrix : Matrix4.clone(Matrix4.IDENTITY),\n            owner : this\n        });\n        this._cubeMap = undefined;\n\n        this._attributeLocations = undefined;\n        this._useHdr = undefined;\n    }\n\n    /**\n     * Called when {@link Viewer} or {@link CesiumWidget} render the scene to\n     * get the draw commands needed to render this primitive.\n     * <p>\n     * Do not call this function directly.  This is documented just to\n     * list the exceptions that may be propagated when the scene is rendered:\n     * </p>\n     *\n     * @exception {DeveloperError} this.sources is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.\n     * @exception {DeveloperError} this.sources properties must all be the same type.\n     */\n    SkyBox.prototype.update = function(frameState, useHdr) {\n        var that = this;\n\n        if (!this.show) {\n            return undefined;\n        }\n\n        if ((frameState.mode !== SceneMode.SCENE3D) &&\n            (frameState.mode !== SceneMode.MORPHING)) {\n            return undefined;\n        }\n\n        // The sky box is only rendered during the render pass; it is not pickable, it doesn't cast shadows, etc.\n        if (!frameState.passes.render) {\n            return undefined;\n        }\n\n        var context = frameState.context;\n\n        if (this._sources !== this.sources) {\n            this._sources = this.sources;\n            var sources = this.sources;\n\n            \n\n            if (typeof sources.positiveX === 'string') {\n                // Given urls for cube-map images.  Load them.\n                loadCubeMap(context, this._sources).then(function(cubeMap) {\n                    that._cubeMap = that._cubeMap && that._cubeMap.destroy();\n                    that._cubeMap = cubeMap;\n                });\n            } else {\n                this._cubeMap = this._cubeMap && this._cubeMap.destroy();\n                this._cubeMap = new CubeMap({\n                    context : context,\n                    source : sources\n                });\n            }\n        }\n\n        var command = this._command;\n\n        if (!defined(command.vertexArray)) {\n            command.uniformMap = {\n                u_cubeMap: function() {\n                    return that._cubeMap;\n                }\n            };\n\n            var geometry = BoxGeometry.createGeometry(BoxGeometry.fromDimensions({\n                dimensions : new Cartesian3(2.0, 2.0, 2.0),\n                vertexFormat : VertexFormat.POSITION_ONLY\n            }));\n            var attributeLocations = this._attributeLocations = GeometryPipeline.createAttributeLocations(geometry);\n\n            command.vertexArray = VertexArray.fromGeometry({\n                context : context,\n                geometry : geometry,\n                attributeLocations : attributeLocations,\n                bufferUsage : BufferUsage.STATIC_DRAW\n            });\n\n            command.renderState = RenderState.fromCache({\n                blending : BlendingState.ALPHA_BLEND\n            });\n        }\n\n        if (!defined(command.shaderProgram) || this._useHdr !== useHdr) {\n            var fs = new ShaderSource({\n                defines : [useHdr ? 'HDR' : ''],\n                sources : [SkyBoxFS]\n            });\n            command.shaderProgram = ShaderProgram.fromCache({\n                context : context,\n                vertexShaderSource : SkyBoxVS,\n                fragmentShaderSource : fs,\n                attributeLocations : this._attributeLocations\n            });\n            this._useHdr = useHdr;\n        }\n\n        if (!defined(this._cubeMap)) {\n            return undefined;\n        }\n\n        return command;\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <br /><br />\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     *\n     * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n     *\n     * @see SkyBox#destroy\n     */\n    SkyBox.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n     * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n     * <br /><br />\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     *\n     * @example\n     * skyBox = skyBox && skyBox.destroy();\n     *\n     * @see SkyBox#isDestroyed\n     */\n    SkyBox.prototype.destroy = function() {\n        var command = this._command;\n        command.vertexArray = command.vertexArray && command.vertexArray.destroy();\n        command.shaderProgram = command.shaderProgram && command.shaderProgram.destroy();\n        this._cubeMap = this._cubeMap && this._cubeMap.destroy();\n        return destroyObject(this);\n    };\nexport default SkyBox;\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform samplerCube u_cubeMap;\\n\\\n\\n\\\nvarying vec3 v_texCoord;\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    vec4 color = textureCube(u_cubeMap, normalize(v_texCoord));\\n\\\n    gl_FragColor = vec4(czm_gammaCorrect(color).rgb, czm_morphTime);\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"attribute vec3 position;\\n\\\n\\n\\\nvarying vec3 v_texCoord;\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    vec3 p = czm_viewRotation * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\\n\\\n    gl_Position = czm_projection * vec4(p, 1.0);\\n\\\n    v_texCoord = position.xyz;\\n\\\n}\\n\\\n\";\n","import BoundingSphere from '../Core/BoundingSphere.js';\nimport Cartesian2 from '../Core/Cartesian2.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Cartesian4 from '../Core/Cartesian4.js';\nimport ComponentDatatype from '../Core/ComponentDatatype.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport IndexDatatype from '../Core/IndexDatatype.js';\nimport CesiumMath from '../Core/Math.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport PixelFormat from '../Core/PixelFormat.js';\nimport PrimitiveType from '../Core/PrimitiveType.js';\nimport Buffer from '../Renderer/Buffer.js';\nimport BufferUsage from '../Renderer/BufferUsage.js';\nimport ComputeCommand from '../Renderer/ComputeCommand.js';\nimport DrawCommand from '../Renderer/DrawCommand.js';\nimport PixelDatatype from '../Renderer/PixelDatatype.js';\nimport RenderState from '../Renderer/RenderState.js';\nimport ShaderProgram from '../Renderer/ShaderProgram.js';\nimport Texture from '../Renderer/Texture.js';\nimport VertexArray from '../Renderer/VertexArray.js';\nimport SunFS from '../Shaders/SunFS.js';\nimport SunTextureFS from '../Shaders/SunTextureFS.js';\nimport SunVS from '../Shaders/SunVS.js';\nimport BlendingState from './BlendingState.js';\nimport SceneMode from './SceneMode.js';\nimport SceneTransforms from './SceneTransforms.js';\n\n    /**\n     * Draws a sun billboard.\n     * <p>This is only supported in 3D and Columbus view.</p>\n     *\n     * @alias Sun\n     * @constructor\n     *\n     *\n     * @example\n     * scene.sun = new Cesium.Sun();\n     *\n     * @see Scene#sun\n     */\n    function Sun() {\n        /**\n         * Determines if the sun will be shown.\n         *\n         * @type {Boolean}\n         * @default true\n         */\n        this.show = true;\n\n        this._drawCommand = new DrawCommand({\n            primitiveType : PrimitiveType.TRIANGLES,\n            boundingVolume : new BoundingSphere(),\n            owner : this\n        });\n        this._commands = {\n            drawCommand : this._drawCommand,\n            computeCommand : undefined\n        };\n        this._boundingVolume = new BoundingSphere();\n        this._boundingVolume2D = new BoundingSphere();\n\n        this._texture = undefined;\n        this._drawingBufferWidth = undefined;\n        this._drawingBufferHeight = undefined;\n        this._radiusTS = undefined;\n        this._size = undefined;\n\n        this.glowFactor = 1.0;\n        this._glowFactorDirty = false;\n\n        this._useHdr = undefined;\n\n        var that = this;\n        this._uniformMap = {\n            u_texture : function() {\n                return that._texture;\n            },\n            u_size : function() {\n                return that._size;\n            }\n        };\n    }\n\n    Object.defineProperties(Sun.prototype, {\n        /**\n         * Gets or sets a number that controls how \"bright\" the Sun's lens flare appears\n         * to be.  Zero shows just the Sun's disc without any flare.\n         * Use larger values for a more pronounced flare around the Sun.\n         *\n         * @memberof Sun.prototype\n         * @type {Number}\n         * @default 1.0\n         */\n        glowFactor : {\n            get : function () { return this._glowFactor; },\n            set : function (glowFactor) {\n                glowFactor = Math.max(glowFactor, 0.0);\n                this._glowFactor = glowFactor;\n                this._glowFactorDirty = true;\n            }\n        }\n    });\n\n    var scratchPositionWC = new Cartesian2();\n    var scratchLimbWC = new Cartesian2();\n    var scratchPositionEC = new Cartesian4();\n    var scratchCartesian4 = new Cartesian4();\n\n    /**\n     * @private\n     */\n    Sun.prototype.update = function(frameState, passState, useHdr) {\n        if (!this.show) {\n            return undefined;\n        }\n\n        var mode = frameState.mode;\n        if (mode === SceneMode.SCENE2D || mode === SceneMode.MORPHING) {\n            return undefined;\n        }\n\n        if (!frameState.passes.render) {\n            return undefined;\n        }\n\n        var context = frameState.context;\n        var drawingBufferWidth = passState.viewport.width;\n        var drawingBufferHeight = passState.viewport.height;\n\n        if (!defined(this._texture) ||\n                drawingBufferWidth !== this._drawingBufferWidth ||\n                drawingBufferHeight !== this._drawingBufferHeight ||\n                this._glowFactorDirty ||\n                useHdr !== this._useHdr) {\n            this._texture = this._texture && this._texture.destroy();\n            this._drawingBufferWidth = drawingBufferWidth;\n            this._drawingBufferHeight = drawingBufferHeight;\n            this._glowFactorDirty = false;\n            this._useHdr = useHdr;\n\n            var size = Math.max(drawingBufferWidth, drawingBufferHeight);\n            size = Math.pow(2.0, Math.ceil(Math.log(size) / Math.log(2.0)) - 2.0);\n\n            // The size computed above can be less than 1.0 if size < 4.0. This will probably\n            // never happen in practice, but does in the tests. Clamp to 1.0 to prevent WebGL\n            // errors in the tests.\n            size = Math.max(1.0, size);\n\n            var pixelDatatype = useHdr ? (context.halfFloatingPointTexture ? PixelDatatype.HALF_FLOAT : PixelDatatype.FLOAT) : PixelDatatype.UNSIGNED_BYTE;\n            this._texture = new Texture({\n                context : context,\n                width : size,\n                height : size,\n                pixelFormat : PixelFormat.RGBA,\n                pixelDatatype : pixelDatatype\n            });\n\n            this._glowLengthTS = this._glowFactor * 5.0;\n            this._radiusTS = (1.0 / (1.0 + 2.0 * this._glowLengthTS)) * 0.5;\n\n            var that = this;\n            var uniformMap = {\n                u_radiusTS : function() {\n                    return that._radiusTS;\n                }\n            };\n\n            this._commands.computeCommand = new ComputeCommand({\n                fragmentShaderSource : SunTextureFS,\n                outputTexture  : this._texture,\n                uniformMap : uniformMap,\n                persists : false,\n                owner : this,\n                postExecute : function() {\n                    that._commands.computeCommand = undefined;\n                }\n            });\n        }\n\n        var drawCommand = this._drawCommand;\n\n        if (!defined(drawCommand.vertexArray)) {\n            var attributeLocations = {\n                direction : 0\n            };\n\n            var directions = new Uint8Array(4 * 2);\n            directions[0] = 0;\n            directions[1] = 0;\n\n            directions[2] = 255;\n            directions[3] = 0.0;\n\n            directions[4] = 255;\n            directions[5] = 255;\n\n            directions[6] = 0.0;\n            directions[7] = 255;\n\n            var vertexBuffer = Buffer.createVertexBuffer({\n                context : context,\n                typedArray : directions,\n                usage : BufferUsage.STATIC_DRAW\n            });\n            var attributes = [{\n                index : attributeLocations.direction,\n                vertexBuffer : vertexBuffer,\n                componentsPerAttribute : 2,\n                normalize : true,\n                componentDatatype : ComponentDatatype.UNSIGNED_BYTE\n            }];\n            // Workaround Internet Explorer 11.0.8 lack of TRIANGLE_FAN\n            var indexBuffer = Buffer.createIndexBuffer({\n                context : context,\n                typedArray : new Uint16Array([0, 1, 2, 0, 2, 3]),\n                usage : BufferUsage.STATIC_DRAW,\n                indexDatatype : IndexDatatype.UNSIGNED_SHORT\n            });\n            drawCommand.vertexArray = new VertexArray({\n                context : context,\n                attributes : attributes,\n                indexBuffer : indexBuffer\n            });\n\n            drawCommand.shaderProgram = ShaderProgram.fromCache({\n                context : context,\n                vertexShaderSource : SunVS,\n                fragmentShaderSource : SunFS,\n                attributeLocations : attributeLocations\n            });\n\n            drawCommand.renderState = RenderState.fromCache({\n                blending : BlendingState.ALPHA_BLEND\n            });\n            drawCommand.uniformMap = this._uniformMap;\n        }\n\n        var sunPosition = context.uniformState.sunPositionWC;\n        var sunPositionCV = context.uniformState.sunPositionColumbusView;\n\n        var boundingVolume = this._boundingVolume;\n        var boundingVolume2D = this._boundingVolume2D;\n\n        Cartesian3.clone(sunPosition, boundingVolume.center);\n        boundingVolume2D.center.x = sunPositionCV.z;\n        boundingVolume2D.center.y = sunPositionCV.x;\n        boundingVolume2D.center.z = sunPositionCV.y;\n\n        boundingVolume.radius = CesiumMath.SOLAR_RADIUS + CesiumMath.SOLAR_RADIUS * this._glowLengthTS;\n        boundingVolume2D.radius = boundingVolume.radius;\n\n        if (mode === SceneMode.SCENE3D) {\n            BoundingSphere.clone(boundingVolume, drawCommand.boundingVolume);\n        } else if (mode === SceneMode.COLUMBUS_VIEW) {\n            BoundingSphere.clone(boundingVolume2D, drawCommand.boundingVolume);\n        }\n\n        var position = SceneTransforms.computeActualWgs84Position(frameState, sunPosition, scratchCartesian4);\n\n        var dist = Cartesian3.magnitude(Cartesian3.subtract(position, frameState.camera.position, scratchCartesian4));\n        var projMatrix = context.uniformState.projection;\n\n        var positionEC = scratchPositionEC;\n        positionEC.x = 0;\n        positionEC.y = 0;\n        positionEC.z = -dist;\n        positionEC.w = 1;\n\n        var positionCC = Matrix4.multiplyByVector(projMatrix, positionEC, scratchCartesian4);\n        var positionWC = SceneTransforms.clipToGLWindowCoordinates(passState.viewport, positionCC, scratchPositionWC);\n\n        positionEC.x = CesiumMath.SOLAR_RADIUS;\n        var limbCC = Matrix4.multiplyByVector(projMatrix, positionEC, scratchCartesian4);\n        var limbWC = SceneTransforms.clipToGLWindowCoordinates(passState.viewport, limbCC, scratchLimbWC);\n\n        this._size = Cartesian2.magnitude(Cartesian2.subtract(limbWC, positionWC, scratchCartesian4));\n        this._size = 2.0 * this._size * (1.0 + 2.0 * this._glowLengthTS);\n        this._size = Math.ceil(this._size);\n\n        return this._commands;\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <br /><br />\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     *\n     * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n     *\n     * @see Sun#destroy\n     */\n    Sun.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n     * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n     * <br /><br />\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     *\n     * @example\n     * sun = sun && sun.destroy();\n     *\n     *  @see Sun#isDestroyed\n     */\n    Sun.prototype.destroy = function() {\n        var command = this._drawCommand;\n        command.vertexArray = command.vertexArray && command.vertexArray.destroy();\n        command.shaderProgram = command.shaderProgram && command.shaderProgram.destroy();\n\n        this._texture = this._texture && this._texture.destroy();\n\n        return destroyObject(this);\n    };\nexport default Sun;\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform float u_radiusTS;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nvec2 rotate(vec2 p, vec2 direction)\\n\\\n{\\n\\\n    return vec2(p.x * direction.x - p.y * direction.y, p.x * direction.y + p.y * direction.x);\\n\\\n}\\n\\\n\\n\\\nvec4 addBurst(vec2 position, vec2 direction, float lengthScalar)\\n\\\n{\\n\\\n    vec2 rotatedPosition = rotate(position, direction) * vec2(25.0, 0.75);\\n\\\n    float radius = length(rotatedPosition) * lengthScalar;\\n\\\n    float burst = 1.0 - smoothstep(0.0, 0.55, radius);\\n\\\n    return vec4(burst);\\n\\\n}\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    float lengthScalar = 2.0 / sqrt(2.0);\\n\\\n    vec2 position = v_textureCoordinates - vec2(0.5);\\n\\\n    float radius = length(position) * lengthScalar;\\n\\\n    float surface = step(radius, u_radiusTS);\\n\\\n    vec4 color = vec4(vec2(1.0), surface + 0.2, surface);\\n\\\n\\n\\\n    float glow = 1.0 - smoothstep(0.0, 0.55, radius);\\n\\\n    color.ba += mix(vec2(0.0), vec2(1.0), glow) * 0.75;\\n\\\n\\n\\\n    vec4 burst = vec4(0.0);\\n\\\n\\n\\\n    // The following loop has been manually unrolled for speed, to\\n\\\n    // avoid sin() and cos().\\n\\\n    //\\n\\\n    //for (float i = 0.4; i < 3.2; i += 1.047) {\\n\\\n    //    vec2 direction = vec2(sin(i), cos(i));\\n\\\n    //    burst += 0.4 * addBurst(position, direction, lengthScalar);\\n\\\n    //\\n\\\n    //    direction = vec2(sin(i - 0.08), cos(i - 0.08));\\n\\\n    //    burst += 0.3 * addBurst(position, direction, lengthScalar);\\n\\\n    //}\\n\\\n\\n\\\n    burst += 0.4 * addBurst(position, vec2(0.38942,  0.92106), lengthScalar);  // angle == 0.4\\n\\\n    burst += 0.4 * addBurst(position, vec2(0.99235,  0.12348), lengthScalar);  // angle == 0.4 + 1.047\\n\\\n    burst += 0.4 * addBurst(position, vec2(0.60327, -0.79754), lengthScalar);  // angle == 0.4 + 1.047 * 2.0\\n\\\n\\n\\\n    burst += 0.3 * addBurst(position, vec2(0.31457,  0.94924), lengthScalar);  // angle == 0.4 - 0.08\\n\\\n    burst += 0.3 * addBurst(position, vec2(0.97931,  0.20239), lengthScalar);  // angle == 0.4 + 1.047 - 0.08\\n\\\n    burst += 0.3 * addBurst(position, vec2(0.66507, -0.74678), lengthScalar);  // angle == 0.4 + 1.047 * 2.0 - 0.08\\n\\\n\\n\\\n    // End of manual loop unrolling.\\n\\\n\\n\\\n    color += clamp(burst, vec4(0.0), vec4(1.0)) * 0.15;\\n\\\n\\n\\\n    gl_FragColor = clamp(color, vec4(0.0), vec4(1.0));\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"attribute vec2 direction;\\n\\\n\\n\\\nuniform float u_size;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nvoid main() \\n\\\n{\\n\\\n    vec4 position;\\n\\\n    if (czm_morphTime == 1.0)\\n\\\n    {\\n\\\n        position = vec4(czm_sunPositionWC, 1.0);\\n\\\n    }\\n\\\n    else\\n\\\n    {\\n\\\n        position = vec4(czm_sunPositionColumbusView.zxy, 1.0);\\n\\\n    }\\n\\\n    \\n\\\n    vec4 positionEC = czm_view * position;\\n\\\n    vec4 positionWC = czm_eyeToWindowCoordinates(positionEC);\\n\\\n    \\n\\\n    vec2 halfSize = vec2(u_size * 0.5);\\n\\\n    halfSize *= ((direction * 2.0) - 1.0);\\n\\\n    \\n\\\n    gl_Position = czm_viewportOrthographic * vec4(positionWC.xy + halfSize, -positionWC.z, 1.0);\\n\\\n    \\n\\\n    v_textureCoordinates = direction;\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"uniform sampler2D u_texture;\\n\\\n\\n\\\nvarying vec2 v_textureCoordinates;\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    vec4 color = texture2D(u_texture, v_textureCoordinates);\\n\\\n    gl_FragColor = czm_gammaCorrect(color);\\n\\\n}\\n\\\n\";\n","import buildModuleUrl from '../../Core/buildModuleUrl.js';\nimport Cartesian3 from '../../Core/Cartesian3.js';\nimport Clock from '../../Core/Clock.js';\nimport defaultValue from '../../Core/defaultValue.js';\nimport defined from '../../Core/defined.js';\nimport destroyObject from '../../Core/destroyObject.js';\nimport DeveloperError from '../../Core/DeveloperError.js';\nimport Ellipsoid from '../../Core/Ellipsoid.js';\nimport FeatureDetection from '../../Core/FeatureDetection.js';\nimport formatError from '../../Core/formatError.js';\nimport requestAnimationFrame from '../../Core/requestAnimationFrame.js';\nimport ScreenSpaceEventHandler from '../../Core/ScreenSpaceEventHandler.js';\nimport createWorldImagery from '../../Scene/createWorldImagery.js';\nimport Globe from '../../Scene/Globe.js';\nimport Moon from '../../Scene/Moon.js';\nimport Scene from '../../Scene/Scene.js';\nimport SceneMode from '../../Scene/SceneMode.js';\nimport ShadowMode from '../../Scene/ShadowMode.js';\nimport SkyAtmosphere from '../../Scene/SkyAtmosphere.js';\nimport SkyBox from '../../Scene/SkyBox.js';\nimport Sun from '../../Scene/Sun.js';\nimport getElement from '../getElement.js';\n\n    function getDefaultSkyBoxUrl(suffix) {\n        return require('/home/remy/Calypso/Software/TerriaMap/node_modules/terriajs-cesium/Source/Assets/Textures/SkyBox/tycho2t3_80_' + suffix + '.jpg');\n    }\n\n    function startRenderLoop(widget) {\n        widget._renderLoopRunning = true;\n\n        var lastFrameTime = 0;\n        function render(frameTime) {\n            if (widget.isDestroyed()) {\n                return;\n            }\n\n            if (widget._useDefaultRenderLoop) {\n                try {\n                    var targetFrameRate = widget._targetFrameRate;\n                    if (!defined(targetFrameRate)) {\n                        widget.resize();\n                        widget.render();\n                        requestAnimationFrame(render);\n                    } else {\n                        var interval = 1000.0 / targetFrameRate;\n                        var delta = frameTime - lastFrameTime;\n\n                        if (delta > interval) {\n                            widget.resize();\n                            widget.render();\n                            lastFrameTime = frameTime - (delta % interval);\n                        }\n                        requestAnimationFrame(render);\n                    }\n                } catch (error) {\n                    widget._useDefaultRenderLoop = false;\n                    widget._renderLoopRunning = false;\n                    if (widget._showRenderLoopErrors) {\n                        var title = 'An error occurred while rendering.  Rendering has stopped.';\n                        widget.showErrorPanel(title, undefined, error);\n                    }\n                }\n            } else {\n                widget._renderLoopRunning = false;\n            }\n        }\n\n        requestAnimationFrame(render);\n    }\n\n    function configurePixelRatio(widget) {\n        var pixelRatio = widget._useBrowserRecommendedResolution ? 1.0 : window.devicePixelRatio;\n        pixelRatio *= widget._resolutionScale;\n        if (defined(widget._scene)) {\n            widget._scene.pixelRatio = pixelRatio;\n        }\n\n        return pixelRatio;\n    }\n\n    function configureCanvasSize(widget) {\n        var canvas = widget._canvas;\n        var width = canvas.clientWidth;\n        var height = canvas.clientHeight;\n        var pixelRatio = configurePixelRatio(widget);\n\n        widget._canvasClientWidth = width;\n        widget._canvasClientHeight = height;\n\n        width *= pixelRatio;\n        height *= pixelRatio;\n\n        canvas.width = width;\n        canvas.height = height;\n\n        widget._canRender = width !== 0 && height !== 0;\n        widget._lastDevicePixelRatio = window.devicePixelRatio;\n    }\n\n    function configureCameraFrustum(widget) {\n        var canvas = widget._canvas;\n        var width = canvas.width;\n        var height = canvas.height;\n        if (width !== 0 && height !== 0) {\n            var frustum = widget._scene.camera.frustum;\n            if (defined(frustum.aspectRatio)) {\n                frustum.aspectRatio = width / height;\n            } else {\n                frustum.top = frustum.right * (height / width);\n                frustum.bottom = -frustum.top;\n            }\n        }\n    }\n\n    /**\n     * A widget containing a Cesium scene.\n     *\n     * @alias CesiumWidget\n     * @constructor\n     *\n     * @param {Element|String} container The DOM element or ID that will contain the widget.\n     * @param {Object} [options] Object with the following properties:\n     * @param {Clock} [options.clock=new Clock()] The clock to use to control current time.\n     * @param {ImageryProvider} [options.imageryProvider=createWorldImagery()] The imagery provider to serve as the base layer. If set to <code>false</code>, no imagery provider will be added.\n     * @param {TerrainProvider} [options.terrainProvider=new EllipsoidTerrainProvider] The terrain provider.\n     * @param {SkyBox} [options.skyBox] The skybox used to render the stars.  When <code>undefined</code>, the default stars are used. If set to <code>false</code>, no skyBox, Sun, or Moon will be added.\n     * @param {SkyAtmosphere} [options.skyAtmosphere] Blue sky, and the glow around the Earth's limb.  Set to <code>false</code> to turn it off.\n     * @param {SceneMode} [options.sceneMode=SceneMode.SCENE3D] The initial scene mode.\n     * @param {Boolean} [options.scene3DOnly=false] When <code>true</code>, each geometry instance will only be rendered in 3D to save GPU memory.\n     * @param {Boolean} [options.orderIndependentTranslucency=true] If true and the configuration supports it, use order independent translucency.\n     * @param {MapProjection} [options.mapProjection=new GeographicProjection()] The map projection to use in 2D and Columbus View modes.\n     * @param {Globe} [options.globe=new Globe(mapProjection.ellipsoid)] The globe to use in the scene.  If set to <code>false</code>, no globe will be added.\n     * @param {Boolean} [options.useDefaultRenderLoop=true] True if this widget should control the render loop, false otherwise.\n     * @param {Boolean} [options.useBrowserRecommendedResolution=true] If true, render at the browser's recommended resolution and ignore <code>window.devicePixelRatio</code>.\n     * @param {Number} [options.targetFrameRate] The target frame rate when using the default render loop.\n     * @param {Boolean} [options.showRenderLoopErrors=true] If true, this widget will automatically display an HTML panel to the user containing the error, if a render loop error occurs.\n     * @param {Object} [options.contextOptions] Context and WebGL creation properties corresponding to <code>options</code> passed to {@link Scene}.\n     * @param {Element|String} [options.creditContainer] The DOM element or ID that will contain the {@link CreditDisplay}.  If not specified, the credits are added\n     *        to the bottom of the widget itself.\n     * @param {Element|String} [options.creditViewport] The DOM element or ID that will contain the credit pop up created by the {@link CreditDisplay}.  If not specified, it will appear over the widget itself.\n     * @param {Number} [options.terrainExaggeration=1.0] A scalar used to exaggerate the terrain. Note that terrain exaggeration will not modify any other primitive as they are positioned relative to the ellipsoid.\n     * @param {Boolean} [options.shadows=false] Determines if shadows are cast by light sources.\n     * @param {ShadowMode} [options.terrainShadows=ShadowMode.RECEIVE_ONLY] Determines if the terrain casts or receives shadows from light sources.\n     * @param {MapMode2D} [options.mapMode2D=MapMode2D.INFINITE_SCROLL] Determines if the 2D map is rotatable or can be scrolled infinitely in the horizontal direction.\n     * @param {Boolean} [options.requestRenderMode=false] If true, rendering a frame will only occur when needed as determined by changes within the scene. Enabling improves performance of the application, but requires using {@link Scene#requestRender} to render a new frame explicitly in this mode. This will be necessary in many cases after making changes to the scene in other parts of the API. See {@link https://cesium.com/blog/2018/01/24/cesium-scene-rendering-performance/|Improving Performance with Explicit Rendering}.\n     * @param {Number} [options.maximumRenderTimeChange=0.0] If requestRenderMode is true, this value defines the maximum change in simulation time allowed before a render is requested. See {@link https://cesium.com/blog/2018/01/24/cesium-scene-rendering-performance/|Improving Performance with Explicit Rendering}.\n     *\n     * @exception {DeveloperError} Element with id \"container\" does not exist in the document.\n     *\n     * @demo {@link https://sandcastle.cesium.com/index.html?src=Cesium%20Widget.html|Cesium Sandcastle Cesium Widget Demo}\n     *\n     * @example\n     * // For each example, include a link to CesiumWidget.css stylesheet in HTML head,\n     * // and in the body, include: <div id=\"cesiumContainer\"></div>\n     *\n     * //Widget with no terrain and default Bing Maps imagery provider.\n     * var widget = new Cesium.CesiumWidget('cesiumContainer');\n     *\n     * //Widget with ion imagery and Cesium World Terrain.\n     * var widget = new Cesium.CesiumWidget('cesiumContainer', {\n     *     imageryProvider : Cesium.createWorldImagery(),\n     *     terrainProvider : Cesium.createWorldTerrain(),\n     *     skyBox : new Cesium.SkyBox({\n     *         sources : {\n     *           positiveX : 'stars/TychoSkymapII.t3_08192x04096_80_px.jpg',\n     *           negativeX : 'stars/TychoSkymapII.t3_08192x04096_80_mx.jpg',\n     *           positiveY : 'stars/TychoSkymapII.t3_08192x04096_80_py.jpg',\n     *           negativeY : 'stars/TychoSkymapII.t3_08192x04096_80_my.jpg',\n     *           positiveZ : 'stars/TychoSkymapII.t3_08192x04096_80_pz.jpg',\n     *           negativeZ : 'stars/TychoSkymapII.t3_08192x04096_80_mz.jpg'\n     *         }\n     *     }),\n     *     // Show Columbus View map with Web Mercator projection\n     *     sceneMode : Cesium.SceneMode.COLUMBUS_VIEW,\n     *     mapProjection : new Cesium.WebMercatorProjection()\n     * });\n     */\n    function CesiumWidget(container, options) {\n        \n\n        container = getElement(container);\n\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        //Configure the widget DOM elements\n        var element = document.createElement('div');\n        element.className = 'cesium-widget';\n        container.appendChild(element);\n\n        var canvas = document.createElement('canvas');\n        var supportsImageRenderingPixelated = FeatureDetection.supportsImageRenderingPixelated();\n        this._supportsImageRenderingPixelated = supportsImageRenderingPixelated;\n        if (supportsImageRenderingPixelated) {\n            canvas.style.imageRendering = FeatureDetection.imageRenderingValue();\n        }\n\n        canvas.oncontextmenu = function() {\n            return false;\n        };\n        canvas.onselectstart = function() {\n            return false;\n        };\n\n        // Interacting with a canvas does not automatically blur the previously focused element.\n        // This leads to unexpected interaction if the last element was an input field.\n        // For example, clicking the mouse wheel could lead to the value in  the field changing\n        // unexpectedly. The solution is to blur whatever has focus as soon as canvas interaction begins.\n        function blurActiveElement() {\n            if (canvas !== canvas.ownerDocument.activeElement) {\n                canvas.ownerDocument.activeElement.blur();\n            }\n        }\n        canvas.addEventListener('mousedown', blurActiveElement);\n        canvas.addEventListener('pointerdown', blurActiveElement);\n\n        element.appendChild(canvas);\n\n        var innerCreditContainer = document.createElement('div');\n        innerCreditContainer.className = 'cesium-widget-credits';\n\n        var creditContainer = defined(options.creditContainer) ? getElement(options.creditContainer) : element;\n        creditContainer.appendChild(innerCreditContainer);\n\n        var creditViewport = defined(options.creditViewport) ? getElement(options.creditViewport) : element;\n\n        var showRenderLoopErrors = defaultValue(options.showRenderLoopErrors, true);\n\n        var useBrowserRecommendedResolution = defaultValue(options.useBrowserRecommendedResolution, true);\n\n        this._element = element;\n        this._container = container;\n        this._canvas = canvas;\n        this._canvasClientWidth = 0;\n        this._canvasClientHeight = 0;\n        this._lastDevicePixelRatio = 0;\n        this._creditViewport = creditViewport;\n        this._creditContainer = creditContainer;\n        this._innerCreditContainer = innerCreditContainer;\n        this._canRender = false;\n        this._renderLoopRunning = false;\n        this._showRenderLoopErrors = showRenderLoopErrors;\n        this._resolutionScale = 1.0;\n        this._useBrowserRecommendedResolution = useBrowserRecommendedResolution;\n        this._forceResize = false;\n        this._clock = defined(options.clock) ? options.clock : new Clock();\n\n        configureCanvasSize(this);\n\n        try {\n            var scene = new Scene({\n                canvas : canvas,\n                contextOptions : options.contextOptions,\n                creditContainer : innerCreditContainer,\n                creditViewport: creditViewport,\n                mapProjection : options.mapProjection,\n                orderIndependentTranslucency : options.orderIndependentTranslucency,\n                scene3DOnly : defaultValue(options.scene3DOnly, false),\n                terrainExaggeration : options.terrainExaggeration,\n                shadows : options.shadows,\n                mapMode2D : options.mapMode2D,\n                requestRenderMode : options.requestRenderMode,\n                maximumRenderTimeChange : options.maximumRenderTimeChange\n            });\n            this._scene = scene;\n\n            scene.camera.constrainedAxis = Cartesian3.UNIT_Z;\n\n            configurePixelRatio(this);\n            configureCameraFrustum(this);\n\n            var ellipsoid = defaultValue(scene.mapProjection.ellipsoid, Ellipsoid.WGS84);\n\n            var globe = options.globe;\n            if (!defined(globe)) {\n                globe = new Globe(ellipsoid);\n            }\n            if (globe !== false) {\n                scene.globe = globe;\n                scene.globe.shadows = defaultValue(options.terrainShadows, ShadowMode.RECEIVE_ONLY);\n            }\n\n            var skyBox = options.skyBox;\n            if (!defined(skyBox)) {\n                skyBox = new SkyBox({\n                    sources : {\n                        positiveX : getDefaultSkyBoxUrl('px'),\n                        negativeX : getDefaultSkyBoxUrl('mx'),\n                        positiveY : getDefaultSkyBoxUrl('py'),\n                        negativeY : getDefaultSkyBoxUrl('my'),\n                        positiveZ : getDefaultSkyBoxUrl('pz'),\n                        negativeZ : getDefaultSkyBoxUrl('mz')\n                    }\n                });\n            }\n            if (skyBox !== false) {\n                scene.skyBox = skyBox;\n                scene.sun = new Sun();\n                scene.moon = new Moon();\n            }\n\n            // Blue sky, and the glow around the Earth's limb.\n            var skyAtmosphere = options.skyAtmosphere;\n            if (!defined(skyAtmosphere)) {\n                skyAtmosphere = new SkyAtmosphere(ellipsoid);\n            }\n            if (skyAtmosphere !== false) {\n                scene.skyAtmosphere = skyAtmosphere;\n            }\n\n            //Set the base imagery layer\n            var imageryProvider = (options.globe === false) ? false : options.imageryProvider;\n            if (!defined(imageryProvider)) {\n                imageryProvider = createWorldImagery();\n            }\n\n            if (imageryProvider !== false) {\n                scene.imageryLayers.addImageryProvider(imageryProvider);\n            }\n\n            //Set the terrain provider if one is provided.\n            if (defined(options.terrainProvider) && options.globe !== false) {\n                scene.terrainProvider = options.terrainProvider;\n            }\n\n            this._screenSpaceEventHandler = new ScreenSpaceEventHandler(canvas);\n\n            if (defined(options.sceneMode)) {\n                if (options.sceneMode === SceneMode.SCENE2D) {\n                    this._scene.morphTo2D(0);\n                }\n                if (options.sceneMode === SceneMode.COLUMBUS_VIEW) {\n                    this._scene.morphToColumbusView(0);\n                }\n            }\n\n            this._useDefaultRenderLoop = undefined;\n            this.useDefaultRenderLoop = defaultValue(options.useDefaultRenderLoop, true);\n\n            this._targetFrameRate = undefined;\n            this.targetFrameRate = options.targetFrameRate;\n\n            var that = this;\n            scene.renderError.addEventListener(function(scene, error) {\n                that._useDefaultRenderLoop = false;\n                that._renderLoopRunning = false;\n                if (that._showRenderLoopErrors) {\n                    var title = 'An error occurred while rendering.  Rendering has stopped.';\n                    that.showErrorPanel(title, undefined, error);\n                }\n            });\n        } catch (error) {\n            if (showRenderLoopErrors) {\n                var title = 'Error constructing CesiumWidget.';\n                var message = 'Visit <a href=\"http://get.webgl.org\">http://get.webgl.org</a> to verify that your web browser and hardware support WebGL.  Consider trying a different web browser or updating your video drivers.  Detailed error information is below:';\n                this.showErrorPanel(title, message, error);\n            }\n            throw error;\n        }\n    }\n\n    Object.defineProperties(CesiumWidget.prototype, {\n        /**\n         * Gets the parent container.\n         * @memberof CesiumWidget.prototype\n         *\n         * @type {Element}\n         */\n        container : {\n            get : function() {\n                return this._container;\n            }\n        },\n\n        /**\n         * Gets the canvas.\n         * @memberof CesiumWidget.prototype\n         *\n         * @type {Canvas}\n         */\n        canvas : {\n            get : function() {\n                return this._canvas;\n            }\n        },\n\n        /**\n         * Gets the credit container.\n         * @memberof CesiumWidget.prototype\n         *\n         * @type {Element}\n         */\n        creditContainer: {\n            get : function() {\n                return this._creditContainer;\n            }\n        },\n\n        /**\n         * Gets the credit viewport\n         * @memberof CesiumWidget.prototype\n         *\n         * @type {Element}\n         */\n        creditViewport: {\n            get: function() {\n                return this._creditViewport;\n            }\n        },\n\n        /**\n         * Gets the scene.\n         * @memberof CesiumWidget.prototype\n         *\n         * @type {Scene}\n         */\n        scene : {\n            get : function() {\n                return this._scene;\n            }\n        },\n\n        /**\n         * Gets the collection of image layers that will be rendered on the globe.\n         * @memberof CesiumWidget.prototype\n         *\n         * @type {ImageryLayerCollection}\n         * @readonly\n         */\n        imageryLayers : {\n            get : function() {\n                return this._scene.imageryLayers;\n            }\n        },\n\n        /**\n         * The terrain provider providing surface geometry for the globe.\n         * @memberof CesiumWidget.prototype\n         *\n         * @type {TerrainProvider}\n         */\n        terrainProvider : {\n            get : function() {\n                return this._scene.terrainProvider;\n            },\n            set : function(terrainProvider) {\n                this._scene.terrainProvider = terrainProvider;\n            }\n        },\n\n        /**\n         * Gets the camera.\n         * @memberof CesiumWidget.prototype\n         *\n         * @type {Camera}\n         * @readonly\n         */\n        camera : {\n            get : function() {\n                return this._scene.camera;\n            }\n        },\n\n        /**\n         * Gets the clock.\n         * @memberof CesiumWidget.prototype\n         *\n         * @type {Clock}\n         */\n        clock : {\n            get : function() {\n                return this._clock;\n            }\n        },\n\n        /**\n         * Gets the screen space event handler.\n         * @memberof CesiumWidget.prototype\n         *\n         * @type {ScreenSpaceEventHandler}\n         */\n        screenSpaceEventHandler : {\n            get : function() {\n                return this._screenSpaceEventHandler;\n            }\n        },\n\n        /**\n         * Gets or sets the target frame rate of the widget when <code>useDefaultRenderLoop</code>\n         * is true. If undefined, the browser's {@link requestAnimationFrame} implementation\n         * determines the frame rate.  If defined, this value must be greater than 0.  A value higher\n         * than the underlying requestAnimationFrame implementation will have no effect.\n         * @memberof CesiumWidget.prototype\n         *\n         * @type {Number}\n         */\n        targetFrameRate : {\n            get : function() {\n                return this._targetFrameRate;\n            },\n            set : function(value) {\n                \n                this._targetFrameRate = value;\n            }\n        },\n\n        /**\n         * Gets or sets whether or not this widget should control the render loop.\n         * If set to true the widget will use {@link requestAnimationFrame} to\n         * perform rendering and resizing of the widget, as well as drive the\n         * simulation clock. If set to false, you must manually call the\n         * <code>resize</code>, <code>render</code> methods as part of a custom\n         * render loop.  If an error occurs during rendering, {@link Scene}'s\n         * <code>renderError</code> event will be raised and this property\n         * will be set to false.  It must be set back to true to continue rendering\n         * after the error.\n         * @memberof CesiumWidget.prototype\n         *\n         * @type {Boolean}\n         */\n        useDefaultRenderLoop : {\n            get : function() {\n                return this._useDefaultRenderLoop;\n            },\n            set : function(value) {\n                if (this._useDefaultRenderLoop !== value) {\n                    this._useDefaultRenderLoop = value;\n                    if (value && !this._renderLoopRunning) {\n                        startRenderLoop(this);\n                    }\n                }\n            }\n        },\n\n        /**\n         * Gets or sets a scaling factor for rendering resolution.  Values less than 1.0 can improve\n         * performance on less powerful devices while values greater than 1.0 will render at a higher\n         * resolution and then scale down, resulting in improved visual fidelity.\n         * For example, if the widget is laid out at a size of 640x480, setting this value to 0.5\n         * will cause the scene to be rendered at 320x240 and then scaled up while setting\n         * it to 2.0 will cause the scene to be rendered at 1280x960 and then scaled down.\n         * @memberof CesiumWidget.prototype\n         *\n         * @type {Number}\n         * @default 1.0\n         */\n        resolutionScale : {\n            get : function() {\n                return this._resolutionScale;\n            },\n            set : function(value) {\n                \n                if (this._resolutionScale !== value) {\n                    this._resolutionScale = value;\n                    this._forceResize = true;\n                }\n            }\n        },\n\n        /**\n        * Boolean flag indicating if the browser's recommended resolution is used.\n        * If true, the browser's device pixel ratio is ignored and 1.0 is used instead,\n        * effectively rendering based on CSS pixels instead of device pixels. This can improve\n        * performance on less powerful devices that have high pixel density. When false, rendering\n        * will be in device pixels. {@link CesiumWidget#resolutionScale} will still take effect whether\n        * this flag is true or false.\n        * @memberof CesiumWidget.prototype\n        *\n        * @type {Boolean}\n        * @default false\n        */\n        useBrowserRecommendedResolution : {\n            get : function() {\n                return this._useBrowserRecommendedResolution;\n            },\n            set : function(value) {\n                if (this._useBrowserRecommendedResolution !== value) {\n                    this._useBrowserRecommendedResolution = value;\n                    this._forceResize = true;\n                }\n            }\n        }\n    });\n\n    /**\n     * Show an error panel to the user containing a title and a longer error message,\n     * which can be dismissed using an OK button.  This panel is displayed automatically\n     * when a render loop error occurs, if showRenderLoopErrors was not false when the\n     * widget was constructed.\n     *\n     * @param {String} title The title to be displayed on the error panel.  This string is interpreted as text.\n     * @param {String} message A helpful, user-facing message to display prior to the detailed error information.  This string is interpreted as HTML.\n     * @param {String} [error] The error to be displayed on the error panel.  This string is formatted using {@link formatError} and then displayed as text.\n     */\n    CesiumWidget.prototype.showErrorPanel = function(title, message, error) {\n        var element = this._element;\n        var overlay = document.createElement('div');\n        overlay.className = 'cesium-widget-errorPanel';\n\n        var content = document.createElement('div');\n        content.className = 'cesium-widget-errorPanel-content';\n        overlay.appendChild(content);\n\n        var errorHeader = document.createElement('div');\n        errorHeader.className = 'cesium-widget-errorPanel-header';\n        errorHeader.appendChild(document.createTextNode(title));\n        content.appendChild(errorHeader);\n\n        var errorPanelScroller = document.createElement('div');\n        errorPanelScroller.className = 'cesium-widget-errorPanel-scroll';\n        content.appendChild(errorPanelScroller);\n        function resizeCallback() {\n            errorPanelScroller.style.maxHeight = Math.max(Math.round(element.clientHeight * 0.9 - 100), 30) + 'px';\n        }\n        resizeCallback();\n        if (defined(window.addEventListener)) {\n            window.addEventListener('resize', resizeCallback, false);\n        }\n\n        if (defined(message)) {\n            var errorMessage = document.createElement('div');\n            errorMessage.className = 'cesium-widget-errorPanel-message';\n            errorMessage.innerHTML = '<p>' + message + '</p>';\n            errorPanelScroller.appendChild(errorMessage);\n        }\n\n        var errorDetails = '(no error details available)';\n        if (defined(error)) {\n            errorDetails = formatError(error);\n        }\n\n        var errorMessageDetails = document.createElement('div');\n        errorMessageDetails.className = 'cesium-widget-errorPanel-message';\n        errorMessageDetails.appendChild(document.createTextNode(errorDetails));\n        errorPanelScroller.appendChild(errorMessageDetails);\n\n        var buttonPanel = document.createElement('div');\n        buttonPanel.className = 'cesium-widget-errorPanel-buttonPanel';\n        content.appendChild(buttonPanel);\n\n        var okButton = document.createElement('button');\n        okButton.setAttribute('type', 'button');\n        okButton.className = 'cesium-button';\n        okButton.appendChild(document.createTextNode('OK'));\n        okButton.onclick = function() {\n            if (defined(resizeCallback) && defined(window.removeEventListener)) {\n                window.removeEventListener('resize', resizeCallback, false);\n            }\n            element.removeChild(overlay);\n        };\n\n        buttonPanel.appendChild(okButton);\n\n        element.appendChild(overlay);\n\n        //IE8 does not have a console object unless the dev tools are open.\n        if (typeof console !== 'undefined') {\n            console.error(title + '\\n' + message + '\\n' + errorDetails);\n        }\n    };\n\n    /**\n     * @returns {Boolean} true if the object has been destroyed, false otherwise.\n     */\n    CesiumWidget.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the widget.  Should be called if permanently\n     * removing the widget from layout.\n     */\n    CesiumWidget.prototype.destroy = function() {\n        this._scene = this._scene && this._scene.destroy();\n        this._container.removeChild(this._element);\n        this._creditContainer.removeChild(this._innerCreditContainer);\n        destroyObject(this);\n    };\n\n    /**\n     * Updates the canvas size, camera aspect ratio, and viewport size.\n     * This function is called automatically as needed unless\n     * <code>useDefaultRenderLoop</code> is set to false.\n     */\n    CesiumWidget.prototype.resize = function() {\n        var canvas = this._canvas;\n        if (!this._forceResize && this._canvasClientWidth === canvas.clientWidth && this._canvasClientHeight === canvas.clientHeight && this._lastDevicePixelRatio === window.devicePixelRatio) {\n            return;\n        }\n        this._forceResize = false;\n\n        configureCanvasSize(this);\n        configureCameraFrustum(this);\n\n        this._scene.requestRender();\n    };\n\n    /**\n     * This forces the widget to re-think its layout, including\n     * widget sizes and credit placement.\n     */\n    CesiumWidget.prototype.forceResize = function() {\n        this._lastWidth = 0;\n        this.resize();\n    };\n\n    /**\n     * Renders the scene.  This function is called automatically\n     * unless <code>useDefaultRenderLoop</code> is set to false;\n     */\n    CesiumWidget.prototype.render = function() {\n        if (this._canRender) {\n            this._scene.initializeFrame();\n            var currentTime = this._clock.tick();\n            this._scene.render(currentTime);\n        } else {\n            this._clock.tick();\n        }\n    };\nexport default CesiumWidget;\n","import Check from '../Core/Check.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport PrimitiveCollection from './PrimitiveCollection.js';\n\n    /**\n     * A primitive collection for helping maintain the order or ground primitives based on a z-index\n     *\n     * @private\n     */\n    function OrderedGroundPrimitiveCollection() {\n        this._length = 0;\n        this._collections = {};\n        this._collectionsArray = [];\n\n        this.show = true;\n    }\n\n    Object.defineProperties(OrderedGroundPrimitiveCollection.prototype, {\n        /**\n         * Gets the number of primitives in the collection.\n         *\n         * @memberof OrderedGroundPrimitiveCollection.prototype\n         *\n         * @type {Number}\n         * @readonly\n         */\n        length : {\n            get : function() {\n                return this._length;\n            }\n        }\n    });\n\n    /**\n     * Adds a primitive to the collection.\n     *\n     * @param {GroundPrimitive} primitive The primitive to add.\n     * @param {Number} [zIndex = 0] The index of the primitive\n     * @returns {GroundPrimitive} The primitive added to the collection.\n     */\n    OrderedGroundPrimitiveCollection.prototype.add = function(primitive, zIndex) {\n        \n\n        zIndex = defaultValue(zIndex, 0);\n        var collection = this._collections[zIndex];\n        if (!defined(collection)) {\n            collection = new PrimitiveCollection({ destroyPrimitives: false });\n            collection._zIndex = zIndex;\n            this._collections[zIndex] = collection;\n            var array = this._collectionsArray;\n            var i = 0;\n            while (i < array.length && array[i]._zIndex < zIndex) {\n                i++;\n            }\n            array.splice(i, 0, collection);\n        }\n\n        collection.add(primitive);\n        this._length++;\n        primitive._zIndex = zIndex;\n\n        return primitive;\n    };\n\n    /**\n     * Adjusts the z-index\n     * @param {GroundPrimitive} primitive\n     * @param {Number} zIndex\n     */\n    OrderedGroundPrimitiveCollection.prototype.set = function(primitive, zIndex) {\n        \n\n        if (zIndex === primitive._zIndex) {\n            return primitive;\n        }\n\n        this.remove(primitive, true);\n        this.add(primitive, zIndex);\n\n        return primitive;\n    };\n\n    /**\n     * Removes a primitive from the collection.\n     *\n     * @param {Object} primitive The primitive to remove.\n     * @param {Boolean} [doNotDestroy = false]\n     * @returns {Boolean} <code>true</code> if the primitive was removed; <code>false</code> if the primitive is <code>undefined</code> or was not found in the collection.\n     */\n    OrderedGroundPrimitiveCollection.prototype.remove = function(primitive, doNotDestroy) {\n        if (this.contains(primitive)) {\n            var index = primitive._zIndex;\n            var collection = this._collections[index];\n            var result;\n            if (doNotDestroy) {\n                result = collection.remove(primitive);\n            } else {\n                result = collection.removeAndDestroy(primitive);\n            }\n\n            if (result) {\n                this._length--;\n            }\n\n            if (collection.length === 0) {\n                this._collectionsArray.splice(this._collectionsArray.indexOf(collection), 1);\n                this._collections[index] = undefined;\n                collection.destroy();\n            }\n\n            return result;\n        }\n\n        return false;\n    };\n\n    /**\n     * Removes all primitives in the collection.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     * @see OrderedGroundPrimitiveCollection#destroyPrimitives\n     */\n    OrderedGroundPrimitiveCollection.prototype.removeAll = function() {\n        var collections = this._collectionsArray;\n        for (var i = 0; i < collections.length; i++) {\n            var collection = collections[i];\n            collection.destroyPrimitives = true;\n            collection.destroy();\n        }\n\n        this._collections = {};\n        this._collectionsArray = [];\n        this._length = 0;\n    };\n\n    /**\n     * Determines if this collection contains a primitive.\n     *\n     * @param {Object} primitive The primitive to check for.\n     * @returns {Boolean} <code>true</code> if the primitive is in the collection; <code>false</code> if the primitive is <code>undefined</code> or was not found in the collection.\n     */\n    OrderedGroundPrimitiveCollection.prototype.contains = function(primitive) {\n        if (!defined(primitive)) {\n            return false;\n        }\n        var collection = this._collections[primitive._zIndex];\n        return defined(collection) && collection.contains(primitive);\n    };\n\n    /**\n     * @private\n     */\n    OrderedGroundPrimitiveCollection.prototype.update = function(frameState) {\n        if (!this.show) {\n            return;\n        }\n\n        var collections = this._collectionsArray;\n        for (var i = 0 ; i < collections.length; i++) {\n            collections[i].update(frameState);\n        }\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <br /><br />\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     *\n     * @returns {Boolean} True if this object was destroyed; otherwise, false.\n     *\n     * @see OrderedGroundPrimitiveCollection#destroy\n     */\n    OrderedGroundPrimitiveCollection.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the WebGL resources held by each primitive in this collection.  Explicitly destroying this\n     * collection allows for deterministic release of WebGL resources, instead of relying on the garbage\n     * collector to destroy this collection.\n     * <br /><br />\n     * Since destroying a collection destroys all the contained primitives, only destroy a collection\n     * when you are sure no other code is still using any of the contained primitives.\n     * <br /><br />\n     * Once this collection is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     *\n     * @example\n     * primitives = primitives && primitives.destroy();\n     *\n     * @see OrderedGroundPrimitiveCollection#isDestroyed\n     */\n    OrderedGroundPrimitiveCollection.prototype.destroy = function() {\n        this.removeAll();\n        return destroyObject(this);\n    };\nexport default OrderedGroundPrimitiveCollection;\n","import AssociativeArray from '../Core/AssociativeArray.js';\nimport BoundingRectangle from '../Core/BoundingRectangle.js';\nimport Cartesian2 from '../Core/Cartesian2.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Color from '../Core/Color.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport DistanceDisplayCondition from '../Core/DistanceDisplayCondition.js';\nimport NearFarScalar from '../Core/NearFarScalar.js';\nimport HeightReference from '../Scene/HeightReference.js';\nimport HorizontalOrigin from '../Scene/HorizontalOrigin.js';\nimport VerticalOrigin from '../Scene/VerticalOrigin.js';\nimport BoundingSphereState from './BoundingSphereState.js';\nimport Property from './Property.js';\n\n    var defaultColor = Color.WHITE;\n    var defaultEyeOffset = Cartesian3.ZERO;\n    var defaultHeightReference = HeightReference.NONE;\n    var defaultPixelOffset = Cartesian2.ZERO;\n    var defaultScale = 1.0;\n    var defaultRotation = 0.0;\n    var defaultAlignedAxis = Cartesian3.ZERO;\n    var defaultHorizontalOrigin = HorizontalOrigin.CENTER;\n    var defaultVerticalOrigin = VerticalOrigin.CENTER;\n    var defaultSizeInMeters = false;\n\n    var positionScratch = new Cartesian3();\n    var colorScratch = new Color();\n    var eyeOffsetScratch = new Cartesian3();\n    var pixelOffsetScratch = new Cartesian2();\n    var scaleByDistanceScratch = new NearFarScalar();\n    var translucencyByDistanceScratch = new NearFarScalar();\n    var pixelOffsetScaleByDistanceScratch = new NearFarScalar();\n    var boundingRectangleScratch = new BoundingRectangle();\n    var distanceDisplayConditionScratch = new DistanceDisplayCondition();\n\n    function EntityData(entity) {\n        this.entity = entity;\n        this.billboard = undefined;\n        this.textureValue = undefined;\n    }\n\n    /**\n     * A {@link Visualizer} which maps {@link Entity#billboard} to a {@link Billboard}.\n     * @alias BillboardVisualizer\n     * @constructor\n     *\n     * @param {EntityCluster} entityCluster The entity cluster to manage the collection of billboards and optionally cluster with other entities.\n     * @param {EntityCollection} entityCollection The entityCollection to visualize.\n     */\n    function BillboardVisualizer(entityCluster, entityCollection) {\n        \n\n        entityCollection.collectionChanged.addEventListener(BillboardVisualizer.prototype._onCollectionChanged, this);\n\n        this._cluster = entityCluster;\n        this._entityCollection = entityCollection;\n        this._items = new AssociativeArray();\n        this._onCollectionChanged(entityCollection, entityCollection.values, [], []);\n    }\n\n    /**\n     * Updates the primitives created by this visualizer to match their\n     * Entity counterpart at the given time.\n     *\n     * @param {JulianDate} time The time to update to.\n     * @returns {Boolean} This function always returns true.\n     */\n    BillboardVisualizer.prototype.update = function(time) {\n        \n\n        var items = this._items.values;\n        var cluster = this._cluster;\n\n        for (var i = 0, len = items.length; i < len; i++) {\n            var item = items[i];\n            var entity = item.entity;\n            var billboardGraphics = entity._billboard;\n            var textureValue;\n            var billboard = item.billboard;\n            var show = entity.isShowing && entity.isAvailable(time) && Property.getValueOrDefault(billboardGraphics._show, time, true);\n            var position;\n            if (show) {\n                position = Property.getValueOrUndefined(entity._position, time, positionScratch);\n                textureValue = Property.getValueOrUndefined(billboardGraphics._image, time);\n                show = defined(position) && defined(textureValue);\n            }\n\n            if (!show) {\n                //don't bother creating or updating anything else\n                returnPrimitive(item, entity, cluster);\n                continue;\n            }\n\n            if (!Property.isConstant(entity._position)) {\n                cluster._clusterDirty = true;\n            }\n\n            if (!defined(billboard)) {\n                billboard = cluster.getBillboard(entity);\n                billboard.id = entity;\n                billboard.image = undefined;\n                item.billboard = billboard;\n            }\n\n            billboard.show = show;\n            if (!defined(billboard.image) || item.textureValue !== textureValue) {\n                billboard.image = textureValue;\n                item.textureValue = textureValue;\n            }\n            billboard.position = position;\n            billboard.color = Property.getValueOrDefault(billboardGraphics._color, time, defaultColor, colorScratch);\n            billboard.eyeOffset = Property.getValueOrDefault(billboardGraphics._eyeOffset, time, defaultEyeOffset, eyeOffsetScratch);\n            billboard.heightReference = Property.getValueOrDefault(billboardGraphics._heightReference, time, defaultHeightReference);\n            billboard.pixelOffset = Property.getValueOrDefault(billboardGraphics._pixelOffset, time, defaultPixelOffset, pixelOffsetScratch);\n            billboard.scale = Property.getValueOrDefault(billboardGraphics._scale, time, defaultScale);\n            billboard.rotation = Property.getValueOrDefault(billboardGraphics._rotation, time, defaultRotation);\n            billboard.alignedAxis = Property.getValueOrDefault(billboardGraphics._alignedAxis, time, defaultAlignedAxis);\n            billboard.horizontalOrigin = Property.getValueOrDefault(billboardGraphics._horizontalOrigin, time, defaultHorizontalOrigin);\n            billboard.verticalOrigin = Property.getValueOrDefault(billboardGraphics._verticalOrigin, time, defaultVerticalOrigin);\n            billboard.width = Property.getValueOrUndefined(billboardGraphics._width, time);\n            billboard.height = Property.getValueOrUndefined(billboardGraphics._height, time);\n            billboard.scaleByDistance = Property.getValueOrUndefined(billboardGraphics._scaleByDistance, time, scaleByDistanceScratch);\n            billboard.translucencyByDistance = Property.getValueOrUndefined(billboardGraphics._translucencyByDistance, time, translucencyByDistanceScratch);\n            billboard.pixelOffsetScaleByDistance = Property.getValueOrUndefined(billboardGraphics._pixelOffsetScaleByDistance, time, pixelOffsetScaleByDistanceScratch);\n            billboard.sizeInMeters = Property.getValueOrDefault(billboardGraphics._sizeInMeters, time, defaultSizeInMeters);\n            billboard.distanceDisplayCondition = Property.getValueOrUndefined(billboardGraphics._distanceDisplayCondition, time, distanceDisplayConditionScratch);\n            billboard.disableDepthTestDistance = Property.getValueOrUndefined(billboardGraphics._disableDepthTestDistance, time);\n\n            var subRegion = Property.getValueOrUndefined(billboardGraphics._imageSubRegion, time, boundingRectangleScratch);\n            if (defined(subRegion)) {\n                billboard.setImageSubRegion(billboard._imageId, subRegion);\n            }\n        }\n        return true;\n    };\n\n    /**\n     * Computes a bounding sphere which encloses the visualization produced for the specified entity.\n     * The bounding sphere is in the fixed frame of the scene's globe.\n     *\n     * @param {Entity} entity The entity whose bounding sphere to compute.\n     * @param {BoundingSphere} result The bounding sphere onto which to store the result.\n     * @returns {BoundingSphereState} BoundingSphereState.DONE if the result contains the bounding sphere,\n     *                       BoundingSphereState.PENDING if the result is still being computed, or\n     *                       BoundingSphereState.FAILED if the entity has no visualization in the current scene.\n     * @private\n     */\n    BillboardVisualizer.prototype.getBoundingSphere = function(entity, result) {\n        \n\n        var item = this._items.get(entity.id);\n        if (!defined(item) || !defined(item.billboard)) {\n            return BoundingSphereState.FAILED;\n        }\n\n        var billboard = item.billboard;\n        if (billboard.heightReference === HeightReference.NONE) {\n            result.center = Cartesian3.clone(billboard.position, result.center);\n        } else {\n            if (!defined(billboard._clampedPosition)) {\n                return BoundingSphereState.PENDING;\n            }\n            result.center = Cartesian3.clone(billboard._clampedPosition, result.center);\n        }\n        result.radius = 0;\n        return BoundingSphereState.DONE;\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     *\n     * @returns {Boolean} True if this object was destroyed; otherwise, false.\n     */\n    BillboardVisualizer.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Removes and destroys all primitives created by this instance.\n     */\n    BillboardVisualizer.prototype.destroy = function() {\n        this._entityCollection.collectionChanged.removeEventListener(BillboardVisualizer.prototype._onCollectionChanged, this);\n        var entities = this._entityCollection.values;\n        for (var i = 0; i < entities.length; i++) {\n            this._cluster.removeBillboard(entities[i]);\n        }\n        return destroyObject(this);\n    };\n\n    BillboardVisualizer.prototype._onCollectionChanged = function(entityCollection, added, removed, changed) {\n        var i;\n        var entity;\n        var items = this._items;\n        var cluster = this._cluster;\n\n        for (i = added.length - 1; i > -1; i--) {\n            entity = added[i];\n            if (defined(entity._billboard) && defined(entity._position)) {\n                items.set(entity.id, new EntityData(entity));\n            }\n        }\n\n        for (i = changed.length - 1; i > -1; i--) {\n            entity = changed[i];\n            if (defined(entity._billboard) && defined(entity._position)) {\n                if (!items.contains(entity.id)) {\n                    items.set(entity.id, new EntityData(entity));\n                }\n            } else {\n                returnPrimitive(items.get(entity.id), entity, cluster);\n                items.remove(entity.id);\n            }\n        }\n\n        for (i = removed.length - 1; i > -1; i--) {\n            entity = removed[i];\n            returnPrimitive(items.get(entity.id), entity, cluster);\n            items.remove(entity.id);\n        }\n    };\n\n    function returnPrimitive(item, entity, cluster) {\n        if (defined(item)) {\n            item.billboard = undefined;\n            cluster.removeBillboard(entity);\n        }\n    }\nexport default BillboardVisualizer;\n","import defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport VertexFormat from '../Core/VertexFormat.js';\nimport AllMaterialAppearanceFS from '../Shaders/Appearances/AllMaterialAppearanceFS.js';\nimport AllMaterialAppearanceVS from '../Shaders/Appearances/AllMaterialAppearanceVS.js';\nimport BasicMaterialAppearanceFS from '../Shaders/Appearances/BasicMaterialAppearanceFS.js';\nimport BasicMaterialAppearanceVS from '../Shaders/Appearances/BasicMaterialAppearanceVS.js';\nimport TexturedMaterialAppearanceFS from '../Shaders/Appearances/TexturedMaterialAppearanceFS.js';\nimport TexturedMaterialAppearanceVS from '../Shaders/Appearances/TexturedMaterialAppearanceVS.js';\nimport Appearance from './Appearance.js';\nimport Material from './Material.js';\n\n    /**\n     * An appearance for arbitrary geometry (as opposed to {@link EllipsoidSurfaceAppearance}, for example)\n     * that supports shading with materials.\n     *\n     * @alias MaterialAppearance\n     * @constructor\n     *\n     * @param {Object} [options] Object with the following properties:\n     * @param {Boolean} [options.flat=false] When <code>true</code>, flat shading is used in the fragment shader, which means lighting is not taking into account.\n     * @param {Boolean} [options.faceForward=!options.closed] When <code>true</code>, the fragment shader flips the surface normal as needed to ensure that the normal faces the viewer to avoid dark spots.  This is useful when both sides of a geometry should be shaded like {@link WallGeometry}.\n     * @param {Boolean} [options.translucent=true] When <code>true</code>, the geometry is expected to appear translucent so {@link MaterialAppearance#renderState} has alpha blending enabled.\n     * @param {Boolean} [options.closed=false] When <code>true</code>, the geometry is expected to be closed so {@link MaterialAppearance#renderState} has backface culling enabled.\n     * @param {MaterialAppearance.MaterialSupport} [options.materialSupport=MaterialAppearance.MaterialSupport.TEXTURED] The type of materials that will be supported.\n     * @param {Material} [options.material=Material.ColorType] The material used to determine the fragment color.\n     * @param {String} [options.vertexShaderSource] Optional GLSL vertex shader source to override the default vertex shader.\n     * @param {String} [options.fragmentShaderSource] Optional GLSL fragment shader source to override the default fragment shader.\n     * @param {RenderState} [options.renderState] Optional render state to override the default render state.\n     *\n     * @see {@link https://github.com/CesiumGS/cesium/wiki/Fabric|Fabric}\n     * @demo {@link https://sandcastle.cesium.com/index.html?src=Materials.html|Cesium Sandcastle Material Appearance Demo}\n     *\n     * @example\n     * var primitive = new Cesium.Primitive({\n     *   geometryInstances : new Cesium.GeometryInstance({\n     *     geometry : new Cesium.WallGeometry({\n            materialSupport :  Cesium.MaterialAppearance.MaterialSupport.BASIC.vertexFormat,\n     *       // ...\n     *     })\n     *   }),\n     *   appearance : new Cesium.MaterialAppearance({\n     *     material : Cesium.Material.fromType('Color'),\n     *     faceForward : true\n     *   })\n     *\n     * });\n     */\n    function MaterialAppearance(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        var translucent = defaultValue(options.translucent, true);\n        var closed = defaultValue(options.closed, false);\n        var materialSupport = defaultValue(options.materialSupport, MaterialAppearance.MaterialSupport.TEXTURED);\n\n        /**\n         * The material used to determine the fragment color.  Unlike other {@link MaterialAppearance}\n         * properties, this is not read-only, so an appearance's material can change on the fly.\n         *\n         * @type Material\n         *\n         * @default {@link Material.ColorType}\n         *\n         * @see {@link https://github.com/CesiumGS/cesium/wiki/Fabric|Fabric}\n         */\n        this.material = (defined(options.material)) ? options.material : Material.fromType(Material.ColorType);\n\n        /**\n         * When <code>true</code>, the geometry is expected to appear translucent.\n         *\n         * @type {Boolean}\n         *\n         * @default true\n         */\n        this.translucent = translucent;\n\n        this._vertexShaderSource = defaultValue(options.vertexShaderSource, materialSupport.vertexShaderSource);\n        this._fragmentShaderSource = defaultValue(options.fragmentShaderSource, materialSupport.fragmentShaderSource);\n        this._renderState = Appearance.getDefaultRenderState(translucent, closed, options.renderState);\n        this._closed = closed;\n\n        // Non-derived members\n\n        this._materialSupport = materialSupport;\n        this._vertexFormat = materialSupport.vertexFormat;\n        this._flat = defaultValue(options.flat, false);\n        this._faceForward = defaultValue(options.faceForward, !closed);\n    }\n\n    Object.defineProperties(MaterialAppearance.prototype, {\n        /**\n         * The GLSL source code for the vertex shader.\n         *\n         * @memberof MaterialAppearance.prototype\n         *\n         * @type {String}\n         * @readonly\n         */\n        vertexShaderSource : {\n            get : function() {\n                return this._vertexShaderSource;\n            }\n        },\n\n        /**\n         * The GLSL source code for the fragment shader.  The full fragment shader\n         * source is built procedurally taking into account {@link MaterialAppearance#material},\n         * {@link MaterialAppearance#flat}, and {@link MaterialAppearance#faceForward}.\n         * Use {@link MaterialAppearance#getFragmentShaderSource} to get the full source.\n         *\n         * @memberof MaterialAppearance.prototype\n         *\n         * @type {String}\n         * @readonly\n         */\n        fragmentShaderSource : {\n            get : function() {\n                return this._fragmentShaderSource;\n            }\n        },\n\n        /**\n         * The WebGL fixed-function state to use when rendering the geometry.\n         * <p>\n         * The render state can be explicitly defined when constructing a {@link MaterialAppearance}\n         * instance, or it is set implicitly via {@link MaterialAppearance#translucent}\n         * and {@link MaterialAppearance#closed}.\n         * </p>\n         *\n         * @memberof MaterialAppearance.prototype\n         *\n         * @type {Object}\n         * @readonly\n         */\n        renderState : {\n            get : function() {\n                return this._renderState;\n            }\n        },\n\n        /**\n         * When <code>true</code>, the geometry is expected to be closed so\n         * {@link MaterialAppearance#renderState} has backface culling enabled.\n         * If the viewer enters the geometry, it will not be visible.\n         *\n         * @memberof MaterialAppearance.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         *\n         * @default false\n         */\n        closed : {\n            get : function() {\n                return this._closed;\n            }\n        },\n\n        /**\n         * The type of materials supported by this instance.  This impacts the required\n         * {@link VertexFormat} and the complexity of the vertex and fragment shaders.\n         *\n         * @memberof MaterialAppearance.prototype\n         *\n         * @type {MaterialAppearance.MaterialSupport}\n         * @readonly\n         *\n         * @default {@link MaterialAppearance.MaterialSupport.TEXTURED}\n         */\n        materialSupport : {\n            get : function() {\n                return this._materialSupport;\n            }\n        },\n\n        /**\n         * The {@link VertexFormat} that this appearance instance is compatible with.\n         * A geometry can have more vertex attributes and still be compatible - at a\n         * potential performance cost - but it can't have less.\n         *\n         * @memberof MaterialAppearance.prototype\n         *\n         * @type VertexFormat\n         * @readonly\n         *\n         * @default {@link MaterialAppearance.MaterialSupport.TEXTURED.vertexFormat}\n         */\n        vertexFormat : {\n            get : function() {\n                return this._vertexFormat;\n            }\n        },\n\n        /**\n         * When <code>true</code>, flat shading is used in the fragment shader,\n         * which means lighting is not taking into account.\n         *\n         * @memberof MaterialAppearance.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         *\n         * @default false\n         */\n        flat : {\n            get : function() {\n                return this._flat;\n            }\n        },\n\n        /**\n         * When <code>true</code>, the fragment shader flips the surface normal\n         * as needed to ensure that the normal faces the viewer to avoid\n         * dark spots.  This is useful when both sides of a geometry should be\n         * shaded like {@link WallGeometry}.\n         *\n         * @memberof MaterialAppearance.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         *\n         * @default true\n         */\n        faceForward : {\n            get : function() {\n                return this._faceForward;\n            }\n        }\n    });\n\n    /**\n     * Procedurally creates the full GLSL fragment shader source.  For {@link MaterialAppearance},\n     * this is derived from {@link MaterialAppearance#fragmentShaderSource}, {@link MaterialAppearance#material},\n     * {@link MaterialAppearance#flat}, and {@link MaterialAppearance#faceForward}.\n     *\n     * @function\n     *\n     * @returns {String} The full GLSL fragment shader source.\n     */\n    MaterialAppearance.prototype.getFragmentShaderSource = Appearance.prototype.getFragmentShaderSource;\n\n    /**\n     * Determines if the geometry is translucent based on {@link MaterialAppearance#translucent} and {@link Material#isTranslucent}.\n     *\n     * @function\n     *\n     * @returns {Boolean} <code>true</code> if the appearance is translucent.\n     */\n    MaterialAppearance.prototype.isTranslucent = Appearance.prototype.isTranslucent;\n\n    /**\n     * Creates a render state.  This is not the final render state instance; instead,\n     * it can contain a subset of render state properties identical to the render state\n     * created in the context.\n     *\n     * @function\n     *\n     * @returns {Object} The render state.\n     */\n    MaterialAppearance.prototype.getRenderState = Appearance.prototype.getRenderState;\n\n    /**\n     * Determines the type of {@link Material} that is supported by a\n     * {@link MaterialAppearance} instance.  This is a trade-off between\n     * flexibility (a wide array of materials) and memory/performance\n     * (required vertex format and GLSL shader complexity.\n     * @exports MaterialAppearance.MaterialSupport\n     */\n    MaterialAppearance.MaterialSupport = {\n        /**\n         * Only basic materials, which require just <code>position</code> and\n         * <code>normal</code> vertex attributes, are supported.\n         *\n         * @constant\n         */\n        BASIC : Object.freeze({\n            vertexFormat : VertexFormat.POSITION_AND_NORMAL,\n            vertexShaderSource : BasicMaterialAppearanceVS,\n            fragmentShaderSource : BasicMaterialAppearanceFS\n        }),\n        /**\n         * Materials with textures, which require <code>position</code>,\n         * <code>normal</code>, and <code>st</code> vertex attributes,\n         * are supported.  The vast majority of materials fall into this category.\n         *\n         * @constant\n         */\n        TEXTURED : Object.freeze({\n            vertexFormat : VertexFormat.POSITION_NORMAL_AND_ST,\n            vertexShaderSource : TexturedMaterialAppearanceVS,\n            fragmentShaderSource : TexturedMaterialAppearanceFS\n        }),\n        /**\n         * All materials, including those that work in tangent space, are supported.\n         * This requires <code>position</code>, <code>normal</code>, <code>st</code>,\n         * <code>tangent</code>, and <code>bitangent</code> vertex attributes.\n         *\n         * @constant\n         */\n        ALL : Object.freeze({\n            vertexFormat : VertexFormat.ALL,\n            vertexShaderSource : AllMaterialAppearanceVS,\n            fragmentShaderSource : AllMaterialAppearanceFS\n        })\n    };\nexport default MaterialAppearance;\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"attribute vec3 position3DHigh;\\n\\\nattribute vec3 position3DLow;\\n\\\nattribute vec3 normal;\\n\\\nattribute float batchId;\\n\\\n\\n\\\nvarying vec3 v_positionEC;\\n\\\nvarying vec3 v_normalEC;\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    vec4 p = czm_computePosition();\\n\\\n\\n\\\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\\n\\\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\\n\\\n\\n\\\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"varying vec3 v_positionEC;\\n\\\nvarying vec3 v_normalEC;\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    vec3 positionToEyeEC = -v_positionEC;\\n\\\n\\n\\\n    vec3 normalEC = normalize(v_normalEC);\\n\\\n#ifdef FACE_FORWARD\\n\\\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\\n\\\n#endif\\n\\\n\\n\\\n    czm_materialInput materialInput;\\n\\\n    materialInput.normalEC = normalEC;\\n\\\n    materialInput.positionToEyeEC = positionToEyeEC;\\n\\\n    czm_material material = czm_getMaterial(materialInput);\\n\\\n\\n\\\n#ifdef FLAT\\n\\\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\\n\\\n#else\\n\\\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\\n\\\n#endif\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"attribute vec3 position3DHigh;\\n\\\nattribute vec3 position3DLow;\\n\\\nattribute vec3 normal;\\n\\\nattribute vec2 st;\\n\\\nattribute float batchId;\\n\\\n\\n\\\nvarying vec3 v_positionEC;\\n\\\nvarying vec3 v_normalEC;\\n\\\nvarying vec2 v_st;\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    vec4 p = czm_computePosition();\\n\\\n\\n\\\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\\n\\\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\\n\\\n    v_st = st;\\n\\\n\\n\\\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"varying vec3 v_positionEC;\\n\\\nvarying vec3 v_normalEC;\\n\\\nvarying vec2 v_st;\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    vec3 positionToEyeEC = -v_positionEC;\\n\\\n\\n\\\n    vec3 normalEC = normalize(v_normalEC);\\n\\\n#ifdef FACE_FORWARD\\n\\\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\\n\\\n#endif\\n\\\n\\n\\\n    czm_materialInput materialInput;\\n\\\n    materialInput.normalEC = normalEC;\\n\\\n    materialInput.positionToEyeEC = positionToEyeEC;\\n\\\n    materialInput.st = v_st;\\n\\\n    czm_material material = czm_getMaterial(materialInput);\\n\\\n\\n\\\n#ifdef FLAT\\n\\\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\\n\\\n#else\\n\\\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\\n\\\n#endif\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"attribute vec3 position3DHigh;\\n\\\nattribute vec3 position3DLow;\\n\\\nattribute vec3 normal;\\n\\\nattribute vec3 tangent;\\n\\\nattribute vec3 bitangent;\\n\\\nattribute vec2 st;\\n\\\nattribute float batchId;\\n\\\n\\n\\\nvarying vec3 v_positionEC;\\n\\\nvarying vec3 v_normalEC;\\n\\\nvarying vec3 v_tangentEC;\\n\\\nvarying vec3 v_bitangentEC;\\n\\\nvarying vec2 v_st;\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    vec4 p = czm_computePosition();\\n\\\n\\n\\\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\\n\\\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\\n\\\n    v_tangentEC = czm_normal * tangent;                       // tangent in eye coordinates\\n\\\n    v_bitangentEC = czm_normal * bitangent;                   // bitangent in eye coordinates\\n\\\n    v_st = st;\\n\\\n\\n\\\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\\n\\\n}\\n\\\n\";\n","//This file is automatically rebuilt by the Cesium build process.\nexport default \"varying vec3 v_positionEC;\\n\\\nvarying vec3 v_normalEC;\\n\\\nvarying vec3 v_tangentEC;\\n\\\nvarying vec3 v_bitangentEC;\\n\\\nvarying vec2 v_st;\\n\\\n\\n\\\nvoid main()\\n\\\n{\\n\\\n    vec3 positionToEyeEC = -v_positionEC;\\n\\\n    mat3 tangentToEyeMatrix = czm_tangentToEyeSpaceMatrix(v_normalEC, v_tangentEC, v_bitangentEC);\\n\\\n\\n\\\n    vec3 normalEC = normalize(v_normalEC);\\n\\\n#ifdef FACE_FORWARD\\n\\\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\\n\\\n#endif\\n\\\n\\n\\\n    czm_materialInput materialInput;\\n\\\n    materialInput.normalEC = normalEC;\\n\\\n    materialInput.tangentToEyeMatrix = tangentToEyeMatrix;\\n\\\n    materialInput.positionToEyeEC = positionToEyeEC;\\n\\\n    materialInput.st = v_st;\\n\\\n    czm_material material = czm_getMaterial(materialInput);\\n\\\n\\n\\\n#ifdef FLAT\\n\\\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\\n\\\n#else\\n\\\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\\n\\\n#endif\\n\\\n}\\n\\\n\";\n","import ComponentDatatype from './ComponentDatatype.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport DeveloperError from './DeveloperError.js';\n\n    /**\n     * Value and type information for per-instance geometry attribute that determines if the geometry instance has a distance display condition.\n     *\n     * @alias DistanceDisplayConditionGeometryInstanceAttribute\n     * @constructor\n     *\n     * @param {Number} [near=0.0] The near distance.\n     * @param {Number} [far=Number.MAX_VALUE] The far distance.\n     *\n     * @exception {DeveloperError} far must be greater than near.\n     *\n     * @example\n     * var instance = new Cesium.GeometryInstance({\n     *   geometry : new Cesium.BoxGeometry({\n     *     vertexFormat : Cesium.VertexFormat.POSITION_AND_NORMAL,\n     *     minimum : new Cesium.Cartesian3(-250000.0, -250000.0, -250000.0),\n     *     maximum : new Cesium.Cartesian3(250000.0, 250000.0, 250000.0)\n     *   }),\n     *   modelMatrix : Cesium.Matrix4.multiplyByTranslation(Cesium.Transforms.eastNorthUpToFixedFrame(\n     *     Cesium.Cartesian3.fromDegrees(-75.59777, 40.03883)), new Cesium.Cartesian3(0.0, 0.0, 1000000.0), new Cesium.Matrix4()),\n     *   id : 'box',\n     *   attributes : {\n     *     distanceDisplayCondition : new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(100.0, 10000.0)\n     *   }\n     * });\n     *\n     * @see GeometryInstance\n     * @see GeometryInstanceAttribute\n     */\n    function DistanceDisplayConditionGeometryInstanceAttribute(near, far) {\n        near = defaultValue(near, 0.0);\n        far = defaultValue(far, Number.MAX_VALUE);\n\n        \n\n        /**\n         * The values for the attributes stored in a typed array.\n         *\n         * @type Float32Array\n         *\n         * @default [0.0, 0.0, Number.MAX_VALUE]\n         */\n        this.value = new Float32Array([near, far]);\n    }\n\n    Object.defineProperties(DistanceDisplayConditionGeometryInstanceAttribute.prototype, {\n        /**\n         * The datatype of each component in the attribute, e.g., individual elements in\n         * {@link DistanceDisplayConditionGeometryInstanceAttribute#value}.\n         *\n         * @memberof DistanceDisplayConditionGeometryInstanceAttribute.prototype\n         *\n         * @type {ComponentDatatype}\n         * @readonly\n         *\n         * @default {@link ComponentDatatype.FLOAT}\n         */\n        componentDatatype : {\n            get : function() {\n                return ComponentDatatype.FLOAT;\n            }\n        },\n\n        /**\n         * The number of components in the attributes, i.e., {@link DistanceDisplayConditionGeometryInstanceAttribute#value}.\n         *\n         * @memberof DistanceDisplayConditionGeometryInstanceAttribute.prototype\n         *\n         * @type {Number}\n         * @readonly\n         *\n         * @default 3\n         */\n        componentsPerAttribute : {\n            get : function() {\n                return 2;\n            }\n        },\n\n        /**\n         * When <code>true</code> and <code>componentDatatype</code> is an integer format,\n         * indicate that the components should be mapped to the range [0, 1] (unsigned)\n         * or [-1, 1] (signed) when they are accessed as floating-point for rendering.\n         *\n         * @memberof DistanceDisplayConditionGeometryInstanceAttribute.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         *\n         * @default false\n         */\n        normalize : {\n            get : function() {\n                return false;\n            }\n        }\n    });\n\n    /**\n     * Creates a new {@link DistanceDisplayConditionGeometryInstanceAttribute} instance given the provided an enabled flag and {@link DistanceDisplayCondition}.\n     *\n     * @param {DistanceDisplayCondition} distanceDisplayCondition The distance display condition.\n     * @returns {DistanceDisplayConditionGeometryInstanceAttribute} The new {@link DistanceDisplayConditionGeometryInstanceAttribute} instance.\n     *\n     * @exception {DeveloperError} distanceDisplayCondition.far must be greater than distanceDisplayCondition.near\n     *\n     * @example\n     * var distanceDisplayCondition = new Cesium.DistanceDisplayCondition(100.0, 10000.0);\n     * var instance = new Cesium.GeometryInstance({\n     *   geometry : geometry,\n     *   attributes : {\n     *     distanceDisplayCondition : Cesium.DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(distanceDisplayCondition)\n     *   }\n     * });\n     */\n    DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition = function(distanceDisplayCondition) {\n        \n\n        return new DistanceDisplayConditionGeometryInstanceAttribute(distanceDisplayCondition.near, distanceDisplayCondition.far);\n    };\n\n    /**\n     * Converts a distance display condition to a typed array that can be used to assign a distance display condition attribute.\n     *\n     * @param {DistanceDisplayCondition} distanceDisplayCondition The distance display condition value.\n     * @param {Float32Array} [result] The array to store the result in, if undefined a new instance will be created.\n     * @returns {Float32Array} The modified result parameter or a new instance if result was undefined.\n     *\n     * @example\n     * var attributes = primitive.getGeometryInstanceAttributes('an id');\n     * attributes.distanceDisplayCondition = Cesium.DistanceDisplayConditionGeometryInstanceAttribute.toValue(distanceDisplayCondition, attributes.distanceDisplayCondition);\n     */\n    DistanceDisplayConditionGeometryInstanceAttribute.toValue = function(distanceDisplayCondition, result) {\n        \n\n        if (!defined(result)) {\n            return new Float32Array([distanceDisplayCondition.near, distanceDisplayCondition.far]);\n        }\n        result[0] = distanceDisplayCondition.near;\n        result[1] = distanceDisplayCondition.far;\n        return result;\n    };\nexport default DistanceDisplayConditionGeometryInstanceAttribute;\n","import Color from '../Core/Color.js';\nimport defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport Material from '../Scene/Material.js';\n\n    /**\n     * The interface for all {@link Property} objects that represent {@link Material} uniforms.\n     * This type defines an interface and cannot be instantiated directly.\n     *\n     * @alias MaterialProperty\n     * @constructor\n     * @abstract\n     *\n     * @see ColorMaterialProperty\n     * @see CompositeMaterialProperty\n     * @see GridMaterialProperty\n     * @see ImageMaterialProperty\n     * @see PolylineGlowMaterialProperty\n     * @see PolylineOutlineMaterialProperty\n     * @see StripeMaterialProperty\n     */\n    function MaterialProperty() {\n        DeveloperError.throwInstantiationError();\n    }\n\n    Object.defineProperties(MaterialProperty.prototype, {\n        /**\n         * Gets a value indicating if this property is constant.  A property is considered\n         * constant if getValue always returns the same result for the current definition.\n         * @memberof MaterialProperty.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        isConstant : {\n            get : DeveloperError.throwInstantiationError\n        },\n        /**\n         * Gets the event that is raised whenever the definition of this property changes.\n         * The definition is considered to have changed if a call to getValue would return\n         * a different result for the same time.\n         * @memberof MaterialProperty.prototype\n         *\n         * @type {Event}\n         * @readonly\n         */\n        definitionChanged : {\n            get : DeveloperError.throwInstantiationError\n        }\n    });\n\n    /**\n     * Gets the {@link Material} type at the provided time.\n     * @function\n     *\n     * @param {JulianDate} time The time for which to retrieve the type.\n     * @returns {String} The type of material.\n     */\n    MaterialProperty.prototype.getType = DeveloperError.throwInstantiationError;\n\n    /**\n     * Gets the value of the property at the provided time.\n     * @function\n     *\n     * @param {JulianDate} time The time for which to retrieve the value.\n     * @param {Object} [result] The object to store the value into, if omitted, a new instance is created and returned.\n     * @returns {Object} The modified result parameter or a new instance if the result parameter was not supplied.\n     */\n    MaterialProperty.prototype.getValue = DeveloperError.throwInstantiationError;\n\n    /**\n     * Compares this property to the provided property and returns\n     * <code>true</code> if they are equal, <code>false</code> otherwise.\n     * @function\n     *\n     * @param {Property} [other] The other property.\n     * @returns {Boolean} <code>true</code> if left and right are equal, <code>false</code> otherwise.\n     */\n    MaterialProperty.prototype.equals = DeveloperError.throwInstantiationError;\n\n    /**\n     * @private\n     */\n    MaterialProperty.getValue = function(time, materialProperty, material) {\n        var type;\n\n        if (defined(materialProperty)) {\n            type = materialProperty.getType(time);\n            if (defined(type)) {\n                if (!defined(material) || (material.type !== type)) {\n                    material = Material.fromType(type);\n                }\n                materialProperty.getValue(time, material.uniforms);\n                return material;\n            }\n        }\n\n        if (!defined(material) || (material.type !== Material.ColorType)) {\n            material = Material.fromType(Material.ColorType);\n        }\n        Color.clone(Color.WHITE, material.uniforms.color);\n\n        return material;\n    };\nexport default MaterialProperty;\n","import BoundingSphere from '../Core/BoundingSphere.js';\nimport Check from '../Core/Check.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport GroundPrimitive from '../Scene/GroundPrimitive.js';\nimport MaterialAppearance from '../Scene/MaterialAppearance.js';\nimport PerInstanceColorAppearance from '../Scene/PerInstanceColorAppearance.js';\nimport Primitive from '../Scene/Primitive.js';\nimport BoundingSphereState from './BoundingSphereState.js';\nimport ColorMaterialProperty from './ColorMaterialProperty.js';\nimport MaterialProperty from './MaterialProperty.js';\nimport Property from './Property.js';\n\n    /**\n     * Defines the interface for a dynamic geometry updater.  A DynamicGeometryUpdater\n     * is responsible for handling visualization of a specific type of geometry\n     * that needs to be recomputed based on simulation time.\n     * This object is never used directly by client code, but is instead created by\n     * {@link GeometryUpdater} implementations which contain dynamic geometry.\n     *\n     * This type defines an interface and cannot be instantiated directly.\n     *\n     * @alias DynamicGeometryUpdater\n     * @constructor\n     * @private\n     * @abstract\n     */\n    function DynamicGeometryUpdater(geometryUpdater, primitives, orderedGroundPrimitives) {\n        \n\n        this._primitives = primitives;\n        this._orderedGroundPrimitives = orderedGroundPrimitives;\n        this._primitive = undefined;\n        this._outlinePrimitive = undefined;\n        this._geometryUpdater = geometryUpdater;\n        this._options = geometryUpdater._options;\n        this._entity = geometryUpdater._entity;\n        this._material = undefined;\n    }\n\n    DynamicGeometryUpdater.prototype._isHidden = function(entity, geometry, time) {\n        return !entity.isShowing || !entity.isAvailable(time) || !Property.getValueOrDefault(geometry.show, time, true);\n    };\n\n    DynamicGeometryUpdater.prototype._setOptions = DeveloperError.throwInstantiationError;\n\n    /**\n     * Updates the geometry to the specified time.\n     * @memberof DynamicGeometryUpdater\n     * @function\n     *\n     * @param {JulianDate} time The current time.\n     */\n    DynamicGeometryUpdater.prototype.update = function(time) {\n        \n\n        var geometryUpdater = this._geometryUpdater;\n        var onTerrain = geometryUpdater._onTerrain;\n\n        var primitives = this._primitives;\n        var orderedGroundPrimitives = this._orderedGroundPrimitives;\n        if (onTerrain) {\n            orderedGroundPrimitives.remove(this._primitive);\n        } else {\n            primitives.removeAndDestroy(this._primitive);\n            primitives.removeAndDestroy(this._outlinePrimitive);\n            this._outlinePrimitive = undefined;\n        }\n        this._primitive = undefined;\n\n        var entity = this._entity;\n        var geometry = entity[this._geometryUpdater._geometryPropertyName];\n        this._setOptions(entity, geometry, time);\n        if (this._isHidden(entity, geometry, time)) {\n            return;\n        }\n\n        var shadows = this._geometryUpdater.shadowsProperty.getValue(time);\n        var options = this._options;\n        if (!defined(geometry.fill) || geometry.fill.getValue(time)) {\n            var fillMaterialProperty = geometryUpdater.fillMaterialProperty;\n            var isColorAppearance = fillMaterialProperty instanceof ColorMaterialProperty;\n            var appearance;\n            var closed = geometryUpdater._getIsClosed(options);\n            if (isColorAppearance) {\n                appearance = new PerInstanceColorAppearance({\n                    closed: closed,\n                    flat : onTerrain && !geometryUpdater._supportsMaterialsforEntitiesOnTerrain\n                });\n            } else {\n                var material = MaterialProperty.getValue(time, fillMaterialProperty, this._material);\n                this._material = material;\n                appearance = new MaterialAppearance({\n                    material : material,\n                    translucent : material.isTranslucent(),\n                    closed : closed\n                });\n            }\n\n            if (onTerrain) {\n                options.vertexFormat = PerInstanceColorAppearance.VERTEX_FORMAT;\n                this._primitive = orderedGroundPrimitives.add(new GroundPrimitive({\n                    geometryInstances : this._geometryUpdater.createFillGeometryInstance(time),\n                    appearance : appearance,\n                    asynchronous : false,\n                    shadows : shadows,\n                    classificationType : this._geometryUpdater.classificationTypeProperty.getValue(time)\n                }), Property.getValueOrUndefined(this._geometryUpdater.zIndex, time));\n            } else {\n                options.vertexFormat = appearance.vertexFormat;\n\n                var fillInstance = this._geometryUpdater.createFillGeometryInstance(time);\n\n                if (isColorAppearance) {\n                    appearance.translucent = fillInstance.attributes.color.value[3] !== 255;\n                }\n\n                this._primitive = primitives.add(new Primitive({\n                    geometryInstances : fillInstance,\n                    appearance : appearance,\n                    asynchronous : false,\n                    shadows : shadows\n                }));\n            }\n        }\n\n        if (!onTerrain && defined(geometry.outline) && geometry.outline.getValue(time)) {\n            var outlineInstance = this._geometryUpdater.createOutlineGeometryInstance(time);\n            var outlineWidth = Property.getValueOrDefault(geometry.outlineWidth, time, 1.0);\n\n            this._outlinePrimitive = primitives.add(new Primitive({\n                geometryInstances : outlineInstance,\n                appearance : new PerInstanceColorAppearance({\n                    flat : true,\n                    translucent : outlineInstance.attributes.color.value[3] !== 255,\n                    renderState : {\n                        lineWidth : geometryUpdater._scene.clampLineWidth(outlineWidth)\n                    }\n                }),\n                asynchronous : false,\n                shadows : shadows\n            }));\n        }\n    };\n\n    /**\n     * Computes a bounding sphere which encloses the visualization produced for the specified entity.\n     * The bounding sphere is in the fixed frame of the scene's globe.\n     * @function\n     *\n     * @param {BoundingSphere} result The bounding sphere onto which to store the result.\n     * @returns {BoundingSphereState} BoundingSphereState.DONE if the result contains the bounding sphere,\n     *                       BoundingSphereState.PENDING if the result is still being computed, or\n     *                       BoundingSphereState.FAILED if the entity has no visualization in the current scene.\n     * @private\n     */\n    DynamicGeometryUpdater.prototype.getBoundingSphere = function(result) {\n        \n        var entity = this._entity;\n        var primitive = this._primitive;\n        var outlinePrimitive = this._outlinePrimitive;\n\n        var attributes;\n\n        //Outline and Fill geometries have the same bounding sphere, so just use whichever one is defined and ready\n        if (defined(primitive) && primitive.show && primitive.ready) {\n            attributes = primitive.getGeometryInstanceAttributes(entity);\n            if (defined(attributes) && defined(attributes.boundingSphere)) {\n                BoundingSphere.clone(attributes.boundingSphere, result);\n                return BoundingSphereState.DONE;\n            }\n        }\n\n        if (defined(outlinePrimitive) && outlinePrimitive.show && outlinePrimitive.ready) {\n            attributes = outlinePrimitive.getGeometryInstanceAttributes(entity);\n            if (defined(attributes) && defined(attributes.boundingSphere)) {\n                BoundingSphere.clone(attributes.boundingSphere, result);\n                return BoundingSphereState.DONE;\n            }\n        }\n\n        if ((defined(primitive) && !primitive.ready) || (defined(outlinePrimitive) && !outlinePrimitive.ready)) {\n            return BoundingSphereState.PENDING;\n        }\n\n        return BoundingSphereState.FAILED;\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * @memberof DynamicGeometryUpdater\n     * @function\n     *\n     * @returns {Boolean} True if this object was destroyed; otherwise, false.\n     */\n    DynamicGeometryUpdater.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys and resources used by the object.  Once an object is destroyed, it should not be used.\n     * @memberof DynamicGeometryUpdater\n     * @function\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     */\n    DynamicGeometryUpdater.prototype.destroy = function() {\n        var primitives = this._primitives;\n        var orderedGroundPrimitives = this._orderedGroundPrimitives;\n        if (this._geometryUpdater._onTerrain) {\n            orderedGroundPrimitives.remove(this._primitive);\n        } else {\n            primitives.removeAndDestroy(this._primitive);\n        }\n        primitives.removeAndDestroy(this._outlinePrimitive);\n        destroyObject(this);\n    };\nexport default DynamicGeometryUpdater;\n","import Check from '../Core/Check.js';\nimport Color from '../Core/Color.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport DistanceDisplayCondition from '../Core/DistanceDisplayCondition.js';\nimport Event from '../Core/Event.js';\nimport Iso8601 from '../Core/Iso8601.js';\nimport oneTimeWarning from '../Core/oneTimeWarning.js';\nimport ClassificationType from '../Scene/ClassificationType.js';\nimport ShadowMode from '../Scene/ShadowMode.js';\nimport ColorMaterialProperty from './ColorMaterialProperty.js';\nimport ConstantProperty from './ConstantProperty.js';\nimport Entity from './Entity.js';\nimport Property from './Property.js';\n\n    var defaultMaterial = new ColorMaterialProperty(Color.WHITE);\n    var defaultShow = new ConstantProperty(true);\n    var defaultFill = new ConstantProperty(true);\n    var defaultOutline = new ConstantProperty(false);\n    var defaultOutlineColor = new ConstantProperty(Color.BLACK);\n    var defaultShadows = new ConstantProperty(ShadowMode.DISABLED);\n    var defaultDistanceDisplayCondition = new ConstantProperty(new DistanceDisplayCondition());\n    var defaultClassificationType = new ConstantProperty(ClassificationType.BOTH);\n\n    /**\n     * An abstract class for updating geometry entities.\n     * @alias GeometryUpdater\n     * @constructor\n     *\n     * @param {Object} options An object with the following properties:\n     * @param {Entity} options.entity The entity containing the geometry to be visualized.\n     * @param {Scene} options.scene The scene where visualization is taking place.\n     * @param {Object} options.geometryOptions Options for the geometry\n     * @param {String} options.geometryPropertyName The geometry property name\n     * @param {String[]} options.observedPropertyNames The entity properties this geometry cares about\n     */\n    function GeometryUpdater(options) {\n        \n\n        var entity = options.entity;\n        var geometryPropertyName = options.geometryPropertyName;\n\n        this._entity = entity;\n        this._scene = options.scene;\n        this._fillEnabled = false;\n        this._isClosed = false;\n        this._onTerrain = false;\n        this._dynamic = false;\n        this._outlineEnabled = false;\n        this._geometryChanged = new Event();\n        this._showProperty = undefined;\n        this._materialProperty = undefined;\n        this._showOutlineProperty = undefined;\n        this._outlineColorProperty = undefined;\n        this._outlineWidth = 1.0;\n        this._shadowsProperty = undefined;\n        this._distanceDisplayConditionProperty = undefined;\n        this._classificationTypeProperty = undefined;\n        this._options = options.geometryOptions;\n        this._geometryPropertyName = geometryPropertyName;\n        this._id = geometryPropertyName + '-' + entity.id;\n        this._observedPropertyNames = options.observedPropertyNames;\n        this._supportsMaterialsforEntitiesOnTerrain = Entity.supportsMaterialsforEntitiesOnTerrain(options.scene);\n    }\n\n    Object.defineProperties(GeometryUpdater.prototype, {\n        /**\n         * Gets the unique ID associated with this updater\n         * @memberof GeometryUpdater.prototype\n         * @type {String}\n         * @readonly\n         */\n        id : {\n            get : function() {\n                return this._id;\n            }\n        },\n        /**\n         * Gets the entity associated with this geometry.\n         * @memberof GeometryUpdater.prototype\n         *\n         * @type {Entity}\n         * @readonly\n         */\n        entity : {\n            get : function() {\n                return this._entity;\n            }\n        },\n        /**\n         * Gets a value indicating if the geometry has a fill component.\n         * @memberof GeometryUpdater.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        fillEnabled : {\n            get : function() {\n                return this._fillEnabled;\n            }\n        },\n        /**\n         * Gets a value indicating if fill visibility varies with simulation time.\n         * @memberof GeometryUpdater.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        hasConstantFill : {\n            get : function() {\n                return !this._fillEnabled ||\n                       (!defined(this._entity.availability) &&\n                        Property.isConstant(this._showProperty) &&\n                        Property.isConstant(this._fillProperty));\n            }\n        },\n        /**\n         * Gets the material property used to fill the geometry.\n         * @memberof GeometryUpdater.prototype\n         *\n         * @type {MaterialProperty}\n         * @readonly\n         */\n        fillMaterialProperty : {\n            get : function() {\n                return this._materialProperty;\n            }\n        },\n        /**\n         * Gets a value indicating if the geometry has an outline component.\n         * @memberof GeometryUpdater.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        outlineEnabled : {\n            get : function() {\n                return this._outlineEnabled;\n            }\n        },\n        /**\n         * Gets a value indicating if the geometry has an outline component.\n         * @memberof GeometryUpdater.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        hasConstantOutline : {\n            get : function() {\n                return !this._outlineEnabled ||\n                       (!defined(this._entity.availability) &&\n                        Property.isConstant(this._showProperty) &&\n                        Property.isConstant(this._showOutlineProperty));\n            }\n        },\n        /**\n         * Gets the {@link Color} property for the geometry outline.\n         * @memberof GeometryUpdater.prototype\n         *\n         * @type {Property}\n         * @readonly\n         */\n        outlineColorProperty : {\n            get : function() {\n                return this._outlineColorProperty;\n            }\n        },\n        /**\n         * Gets the constant with of the geometry outline, in pixels.\n         * This value is only valid if isDynamic is false.\n         * @memberof GeometryUpdater.prototype\n         *\n         * @type {Number}\n         * @readonly\n         */\n        outlineWidth : {\n            get : function() {\n                return this._outlineWidth;\n            }\n        },\n        /**\n         * Gets the property specifying whether the geometry\n         * casts or receives shadows from light sources.\n         * @memberof GeometryUpdater.prototype\n         *\n         * @type {Property}\n         * @readonly\n         */\n        shadowsProperty : {\n            get : function() {\n                return this._shadowsProperty;\n            }\n        },\n        /**\n         * Gets or sets the {@link DistanceDisplayCondition} Property specifying at what distance from the camera that this geometry will be displayed.\n         * @memberof GeometryUpdater.prototype\n         *\n         * @type {Property}\n         * @readonly\n         */\n        distanceDisplayConditionProperty : {\n            get : function() {\n                return this._distanceDisplayConditionProperty;\n            }\n        },\n        /**\n         * Gets or sets the {@link ClassificationType} Property specifying if this geometry will classify terrain, 3D Tiles, or both when on the ground.\n         * @memberof GeometryUpdater.prototype\n         *\n         * @type {Property}\n         * @readonly\n         */\n        classificationTypeProperty : {\n            get : function() {\n                return this._classificationTypeProperty;\n            }\n        },\n        /**\n         * Gets a value indicating if the geometry is time-varying.\n         * If true, all visualization is delegated to a DynamicGeometryUpdater\n         * returned by GeometryUpdater#createDynamicUpdater.\n         * @memberof GeometryUpdater.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        isDynamic : {\n            get : function() {\n                return this._dynamic;\n            }\n        },\n        /**\n         * Gets a value indicating if the geometry is closed.\n         * This property is only valid for static geometry.\n         * @memberof GeometryUpdater.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        isClosed : {\n            get : function() {\n                return this._isClosed;\n            }\n        },\n        /**\n         * Gets a value indicating if the geometry should be drawn on terrain.\n         * @memberof EllipseGeometryUpdater.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        onTerrain : {\n            get : function() {\n                return this._onTerrain;\n            }\n        },\n        /**\n         * Gets an event that is raised whenever the public properties\n         * of this updater change.\n         * @memberof GeometryUpdater.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        geometryChanged : {\n            get : function() {\n                return this._geometryChanged;\n            }\n        }\n    });\n\n    /**\n     * Checks if the geometry is outlined at the provided time.\n     *\n     * @param {JulianDate} time The time for which to retrieve visibility.\n     * @returns {Boolean} true if geometry is outlined at the provided time, false otherwise.\n     */\n    GeometryUpdater.prototype.isOutlineVisible = function(time) {\n        var entity = this._entity;\n        var visible = this._outlineEnabled && entity.isAvailable(time) && this._showProperty.getValue(time) && this._showOutlineProperty.getValue(time);\n        return defaultValue(visible, false);\n    };\n\n    /**\n     * Checks if the geometry is filled at the provided time.\n     *\n     * @param {JulianDate} time The time for which to retrieve visibility.\n     * @returns {Boolean} true if geometry is filled at the provided time, false otherwise.\n     */\n    GeometryUpdater.prototype.isFilled = function(time) {\n        var entity = this._entity;\n        var visible = this._fillEnabled && entity.isAvailable(time) && this._showProperty.getValue(time) && this._fillProperty.getValue(time);\n        return defaultValue(visible, false);\n    };\n\n    /**\n     * Creates the geometry instance which represents the fill of the geometry.\n     *\n     * @function\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the filled portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent a filled geometry.\n     */\n    GeometryUpdater.prototype.createFillGeometryInstance = DeveloperError.throwInstantiationError;\n\n    /**\n     * Creates the geometry instance which represents the outline of the geometry.\n     *\n     * @function\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the outline portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent an outlined geometry.\n     */\n    GeometryUpdater.prototype.createOutlineGeometryInstance = DeveloperError.throwInstantiationError;\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     *\n     * @returns {Boolean} True if this object was destroyed; otherwise, false.\n     */\n    GeometryUpdater.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys and resources used by the object.  Once an object is destroyed, it should not be used.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     */\n    GeometryUpdater.prototype.destroy = function() {\n        destroyObject(this);\n    };\n    /**\n     * @param {Entity} entity\n     * @param {Object} geometry\n     * @private\n     */\n    GeometryUpdater.prototype._isHidden = function(entity, geometry) {\n        var show = geometry.show;\n        return defined(show) && show.isConstant && !show.getValue(Iso8601.MINIMUM_VALUE);\n    };\n\n    /**\n     * @param {Entity} entity\n     * @param {Object} geometry\n     * @private\n     */\n    GeometryUpdater.prototype._isOnTerrain = function(entity, geometry) {\n        return false;\n    };\n\n    /**\n     * @param {GeometryOptions} options\n     * @private\n     */\n    GeometryUpdater.prototype._getIsClosed = function(options) {\n        return true;\n    };\n\n    /**\n     * @param {Entity} entity\n     * @param {Object} geometry\n     * @private\n     */\n    GeometryUpdater.prototype._isDynamic = DeveloperError.throwInstantiationError;\n\n    /**\n     * @param {Entity} entity\n     * @param {Object} geometry\n     * @private\n     */\n    GeometryUpdater.prototype._setStaticOptions = DeveloperError.throwInstantiationError;\n\n    /**\n     * @param {Entity} entity\n     * @param {String} propertyName\n     * @param {*} newValue\n     * @param {*} oldValue\n     * @private\n     */\n    GeometryUpdater.prototype._onEntityPropertyChanged = function(entity, propertyName, newValue, oldValue) {\n        if (this._observedPropertyNames.indexOf(propertyName) === -1) {\n            return;\n        }\n\n        var geometry = this._entity[this._geometryPropertyName];\n\n        if (!defined(geometry)) {\n            if (this._fillEnabled || this._outlineEnabled) {\n                this._fillEnabled = false;\n                this._outlineEnabled = false;\n                this._geometryChanged.raiseEvent(this);\n            }\n            return;\n        }\n\n        var fillProperty = geometry.fill;\n        var fillEnabled = defined(fillProperty) && fillProperty.isConstant ? fillProperty.getValue(Iso8601.MINIMUM_VALUE) : true;\n\n        var outlineProperty = geometry.outline;\n        var outlineEnabled = defined(outlineProperty);\n        if (outlineEnabled && outlineProperty.isConstant) {\n            outlineEnabled = outlineProperty.getValue(Iso8601.MINIMUM_VALUE);\n        }\n\n        if (!fillEnabled && !outlineEnabled) {\n            if (this._fillEnabled || this._outlineEnabled) {\n                this._fillEnabled = false;\n                this._outlineEnabled = false;\n                this._geometryChanged.raiseEvent(this);\n            }\n            return;\n        }\n\n        var show = geometry.show;\n        if (this._isHidden(entity, geometry)) {\n            if (this._fillEnabled || this._outlineEnabled) {\n                this._fillEnabled = false;\n                this._outlineEnabled = false;\n                this._geometryChanged.raiseEvent(this);\n            }\n            return;\n        }\n\n        this._materialProperty = defaultValue(geometry.material, defaultMaterial);\n        this._fillProperty = defaultValue(fillProperty, defaultFill);\n        this._showProperty = defaultValue(show, defaultShow);\n        this._showOutlineProperty = defaultValue(geometry.outline, defaultOutline);\n        this._outlineColorProperty = outlineEnabled ? defaultValue(geometry.outlineColor, defaultOutlineColor) : undefined;\n        this._shadowsProperty = defaultValue(geometry.shadows, defaultShadows);\n        this._distanceDisplayConditionProperty = defaultValue(geometry.distanceDisplayCondition, defaultDistanceDisplayCondition);\n        this._classificationTypeProperty = defaultValue(geometry.classificationType, defaultClassificationType);\n\n        this._fillEnabled = fillEnabled;\n\n        var onTerrain = this._isOnTerrain(entity, geometry) &&\n            (this._supportsMaterialsforEntitiesOnTerrain || this._materialProperty instanceof ColorMaterialProperty);\n\n        if (outlineEnabled && onTerrain) {\n            oneTimeWarning(oneTimeWarning.geometryOutlines);\n            outlineEnabled = false;\n        }\n\n        this._onTerrain = onTerrain;\n        this._outlineEnabled = outlineEnabled;\n\n        if (this._isDynamic(entity, geometry)) {\n            if (!this._dynamic) {\n                this._dynamic = true;\n                this._geometryChanged.raiseEvent(this);\n            }\n        } else {\n            this._setStaticOptions(entity, geometry);\n            this._isClosed = this._getIsClosed(this._options);\n            var outlineWidth = geometry.outlineWidth;\n            this._outlineWidth = defined(outlineWidth) ? outlineWidth.getValue(Iso8601.MINIMUM_VALUE) : 1.0;\n            this._dynamic = false;\n            this._geometryChanged.raiseEvent(this);\n        }\n    };\n\n    /**\n     * Creates the dynamic updater to be used when GeometryUpdater#isDynamic is true.\n     *\n     * @param {PrimitiveCollection} primitives The primitive collection to use.\n     * @param {PrimitiveCollection} [groundPrimitives] The primitive collection to use for ground primitives.\n     *\n     * @returns {DynamicGeometryUpdater} The dynamic updater used to update the geometry each frame.\n     *\n     * @exception {DeveloperError} This instance does not represent dynamic geometry.\n     */\n    GeometryUpdater.prototype.createDynamicUpdater = function(primitives, groundPrimitives) {\n        \n\n        return new this.constructor.DynamicGeometryUpdater(this, primitives, groundPrimitives);\n    };\nexport default GeometryUpdater;\n","import Cartesian3 from '../Core/Cartesian3.js';\nimport Cartographic from '../Core/Cartographic.js';\nimport Check from '../Core/Check.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport Event from '../Core/Event.js';\nimport Iso8601 from '../Core/Iso8601.js';\nimport CesiumMath from '../Core/Math.js';\nimport HeightReference from '../Scene/HeightReference.js';\nimport SceneMode from '../Scene/SceneMode.js';\nimport Property from './Property.js';\n\n    var scratchPosition = new Cartesian3();\n    var scratchCarto = new Cartographic();\n\n    /**\n     * @private\n     */\n    function TerrainOffsetProperty(scene, positionProperty, heightReferenceProperty, extrudedHeightReferenceProperty) {\n        \n\n        this._scene = scene;\n        this._heightReference = heightReferenceProperty;\n        this._extrudedHeightReference = extrudedHeightReferenceProperty;\n        this._positionProperty = positionProperty;\n\n        this._position = new Cartesian3();\n        this._cartographicPosition = new Cartographic();\n        this._normal = new Cartesian3();\n\n        this._definitionChanged = new Event();\n        this._terrainHeight = 0;\n        this._removeCallbackFunc = undefined;\n        this._removeEventListener = undefined;\n        this._removeModeListener = undefined;\n\n        var that = this;\n        if (defined(scene.globe)) {\n            this._removeEventListener = scene.terrainProviderChanged.addEventListener(function() {\n                that._updateClamping();\n            });\n            this._removeModeListener = scene.morphComplete.addEventListener(function() {\n                that._updateClamping();\n            });\n        }\n\n        if (positionProperty.isConstant) {\n            var position = positionProperty.getValue(Iso8601.MINIMUM_VALUE, scratchPosition);\n            if (!defined(position) || Cartesian3.equals(position, Cartesian3.ZERO) || !defined(scene.globe)) {\n                return;\n            }\n            this._position = Cartesian3.clone(position, this._position);\n\n            this._updateClamping();\n\n            this._normal = scene.globe.ellipsoid.geodeticSurfaceNormal(position, this._normal);\n        }\n    }\n\n    Object.defineProperties(TerrainOffsetProperty.prototype, {\n        /**\n         * Gets a value indicating if this property is constant.\n         * @memberof TerrainOffsetProperty.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        isConstant : {\n            get : function() {\n                return false;\n            }\n        },\n        /**\n         * Gets the event that is raised whenever the definition of this property changes.\n         * @memberof TerrainOffsetProperty.prototype\n         *\n         * @type {Event}\n         * @readonly\n         */\n        definitionChanged : {\n            get : function() {\n                return this._definitionChanged;\n            }\n        }\n    });\n\n    /**\n     * @private\n     */\n    TerrainOffsetProperty.prototype._updateClamping = function() {\n        if (defined(this._removeCallbackFunc)) {\n            this._removeCallbackFunc();\n        }\n\n        var scene = this._scene;\n        var globe = scene.globe;\n        var position = this._position;\n\n        if (!defined(globe) || Cartesian3.equals(position, Cartesian3.ZERO)) {\n            this._terrainHeight = 0;\n            return;\n        }\n        var ellipsoid = globe.ellipsoid;\n        var surface = globe._surface;\n\n        var that = this;\n        var cartographicPosition = ellipsoid.cartesianToCartographic(position, this._cartographicPosition);\n        var height = globe.getHeight(cartographicPosition);\n        if (defined(height)) {\n            this._terrainHeight = height;\n        } else {\n            this._terrainHeight = 0;\n        }\n\n        function updateFunction(clampedPosition) {\n            if (scene.mode === SceneMode.SCENE3D) {\n                var carto = ellipsoid.cartesianToCartographic(clampedPosition, scratchCarto);\n                that._terrainHeight = carto.height;\n            } else {\n                that._terrainHeight = clampedPosition.x;\n            }\n            that.definitionChanged.raiseEvent();\n        }\n        this._removeCallbackFunc = surface.updateHeight(cartographicPosition, updateFunction);\n    };\n\n    /**\n     * Gets the height relative to the terrain based on the positions.\n     *\n     * @returns {Cartesian3} The offset\n     */\n    TerrainOffsetProperty.prototype.getValue = function(time, result) {\n        var heightReference = Property.getValueOrDefault(this._heightReference, time, HeightReference.NONE);\n        var extrudedHeightReference = Property.getValueOrDefault(this._extrudedHeightReference, time, HeightReference.NONE);\n\n        if (heightReference === HeightReference.NONE && extrudedHeightReference !== HeightReference.RELATIVE_TO_GROUND) {\n            this._position = Cartesian3.clone(Cartesian3.ZERO, this._position);\n            return Cartesian3.clone(Cartesian3.ZERO, result);\n        }\n\n        if (this._positionProperty.isConstant) {\n            return Cartesian3.multiplyByScalar(this._normal, this._terrainHeight, result);\n        }\n\n        var scene = this._scene;\n        var position = this._positionProperty.getValue(time, scratchPosition);\n        if (!defined(position) || Cartesian3.equals(position, Cartesian3.ZERO) || !defined(scene.globe)) {\n            return Cartesian3.clone(Cartesian3.ZERO, result);\n        }\n\n        if (Cartesian3.equalsEpsilon(this._position, position, CesiumMath.EPSILON10)) {\n            return Cartesian3.multiplyByScalar(this._normal, this._terrainHeight, result);\n        }\n\n        this._position = Cartesian3.clone(position, this._position);\n\n        this._updateClamping();\n\n        var normal = scene.globe.ellipsoid.geodeticSurfaceNormal(position, this._normal);\n        return Cartesian3.multiplyByScalar(normal, this._terrainHeight, result);\n    };\n\n    TerrainOffsetProperty.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    TerrainOffsetProperty.prototype.destroy = function() {\n        if (defined(this._removeEventListener)) {\n            this._removeEventListener();\n        }\n        if (defined(this._removeModeListener)) {\n            this._removeModeListener();\n        }\n        if (defined(this._removeCallbackFunc)) {\n            this._removeCallbackFunc();\n        }\n        return destroyObject(this);\n    };\n\n    /**\n     * A function which creates one or more providers.\n     * @callback TerrainOffsetProperty~PositionFunction\n     * @param {JulianDate} time The clock time at which to retrieve the position\n     * @param {Cartesian3} result The result position\n     * @returns {Cartesian3} The position at which to do the terrain height check\n     */\nexport default TerrainOffsetProperty;\n","import defined from '../Core/defined.js';\nimport CallbackProperty from './CallbackProperty.js';\nimport GeometryUpdater from './GeometryUpdater.js';\nimport TerrainOffsetProperty from './TerrainOffsetProperty.js';\n\n    function heightReferenceOnEntityPropertyChanged(entity, propertyName, newValue, oldValue) {\n        GeometryUpdater.prototype._onEntityPropertyChanged.call(this, entity, propertyName, newValue, oldValue);\n        if (this._observedPropertyNames.indexOf(propertyName) === -1) {\n            return;\n        }\n\n        var geometry = this._entity[this._geometryPropertyName];\n        if (!defined(geometry)) {\n            return;\n        }\n\n        if (defined(this._terrainOffsetProperty)) {\n            this._terrainOffsetProperty.destroy();\n            this._terrainOffsetProperty = undefined;\n        }\n\n        var heightReferenceProperty = geometry.heightReference;\n\n        if (defined(heightReferenceProperty)) {\n            var centerPosition = new CallbackProperty(this._computeCenter.bind(this), !this._dynamic);\n            this._terrainOffsetProperty = new TerrainOffsetProperty(this._scene, centerPosition, heightReferenceProperty);\n        }\n    }\nexport default heightReferenceOnEntityPropertyChanged;\n","import BoxGeometry from '../Core/BoxGeometry.js';\nimport BoxOutlineGeometry from '../Core/BoxOutlineGeometry.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Check from '../Core/Check.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport DistanceDisplayConditionGeometryInstanceAttribute from '../Core/DistanceDisplayConditionGeometryInstanceAttribute.js';\nimport GeometryInstance from '../Core/GeometryInstance.js';\nimport GeometryOffsetAttribute from '../Core/GeometryOffsetAttribute.js';\nimport Iso8601 from '../Core/Iso8601.js';\nimport OffsetGeometryInstanceAttribute from '../Core/OffsetGeometryInstanceAttribute.js';\nimport ShowGeometryInstanceAttribute from '../Core/ShowGeometryInstanceAttribute.js';\nimport HeightReference from '../Scene/HeightReference.js';\nimport MaterialAppearance from '../Scene/MaterialAppearance.js';\nimport PerInstanceColorAppearance from '../Scene/PerInstanceColorAppearance.js';\nimport ColorMaterialProperty from './ColorMaterialProperty.js';\nimport DynamicGeometryUpdater from './DynamicGeometryUpdater.js';\nimport GeometryUpdater from './GeometryUpdater.js';\nimport heightReferenceOnEntityPropertyChanged from './heightReferenceOnEntityPropertyChanged.js';\nimport Property from './Property.js';\n\n    var defaultOffset = Cartesian3.ZERO;\n\n    var offsetScratch = new Cartesian3();\n    var positionScratch = new Cartesian3();\n    var scratchColor = new Color();\n\n    function BoxGeometryOptions(entity) {\n        this.id = entity;\n        this.vertexFormat = undefined;\n        this.dimensions = undefined;\n        this.offsetAttribute = undefined;\n    }\n\n    /**\n     * A {@link GeometryUpdater} for boxes.\n     * Clients do not normally create this class directly, but instead rely on {@link DataSourceDisplay}.\n     * @alias BoxGeometryUpdater\n     * @constructor\n     *\n     * @param {Entity} entity The entity containing the geometry to be visualized.\n     * @param {Scene} scene The scene where visualization is taking place.\n     */\n    function BoxGeometryUpdater(entity, scene) {\n        GeometryUpdater.call(this, {\n            entity : entity,\n            scene : scene,\n            geometryOptions : new BoxGeometryOptions(entity),\n            geometryPropertyName : 'box',\n            observedPropertyNames : ['availability', 'position', 'orientation', 'box']\n        });\n\n        this._onEntityPropertyChanged(entity, 'box', entity.box, undefined);\n    }\n\n    if (defined(Object.create)) {\n        BoxGeometryUpdater.prototype = Object.create(GeometryUpdater.prototype);\n        BoxGeometryUpdater.prototype.constructor = BoxGeometryUpdater;\n    }\n\n    Object.defineProperties(BoxGeometryUpdater.prototype, {\n        /**\n         * Gets the terrain offset property\n         * @type {TerrainOffsetProperty}\n         * @memberof BoxGeometryUpdater.prototype\n         * @readonly\n         */\n        terrainOffsetProperty: {\n            get: function() {\n                return this._terrainOffsetProperty;\n            }\n        }\n    });\n\n    /**\n     * Creates the geometry instance which represents the fill of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the filled portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent a filled geometry.\n     */\n    BoxGeometryUpdater.prototype.createFillGeometryInstance = function(time) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n\n        var show = new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._fillProperty.getValue(time));\n        var distanceDisplayCondition = this._distanceDisplayConditionProperty.getValue(time);\n        var distanceDisplayConditionAttribute = DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(distanceDisplayCondition);\n\n        var attributes = {\n            show : show,\n            distanceDisplayCondition : distanceDisplayConditionAttribute,\n            color : undefined,\n            offset: undefined\n        };\n        if (this._materialProperty instanceof ColorMaterialProperty) {\n            var currentColor;\n            if (defined(this._materialProperty.color) && (this._materialProperty.color.isConstant || isAvailable)) {\n                currentColor = this._materialProperty.color.getValue(time, scratchColor);\n            }\n            if (!defined(currentColor)) {\n                currentColor = Color.WHITE;\n            }\n            attributes.color = ColorGeometryInstanceAttribute.fromColor(currentColor);\n        }\n        if (defined(this._options.offsetAttribute)) {\n            attributes.offset = OffsetGeometryInstanceAttribute.fromCartesian3(Property.getValueOrDefault(this._terrainOffsetProperty, time, defaultOffset, offsetScratch));\n        }\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : BoxGeometry.fromDimensions(this._options),\n            modelMatrix : entity.computeModelMatrixForHeightReference(time, entity.box.heightReference, this._options.dimensions.z * 0.5, this._scene.mapProjection.ellipsoid),\n            attributes : attributes\n        });\n    };\n\n    /**\n     * Creates the geometry instance which represents the outline of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the outline portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent an outlined geometry.\n     */\n    BoxGeometryUpdater.prototype.createOutlineGeometryInstance = function(time) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n        var outlineColor = Property.getValueOrDefault(this._outlineColorProperty, time, Color.BLACK, scratchColor);\n        var distanceDisplayCondition = this._distanceDisplayConditionProperty.getValue(time);\n\n        var attributes = {\n            show : new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._showOutlineProperty.getValue(time)),\n            color : ColorGeometryInstanceAttribute.fromColor(outlineColor),\n            distanceDisplayCondition : DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(distanceDisplayCondition),\n            offset : undefined\n        };\n        if (defined(this._options.offsetAttribute)) {\n            attributes.offset = OffsetGeometryInstanceAttribute.fromCartesian3(Property.getValueOrDefault(this._terrainOffsetProperty, time, defaultOffset, offsetScratch));\n        }\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : BoxOutlineGeometry.fromDimensions(this._options),\n            modelMatrix : entity.computeModelMatrixForHeightReference(time, entity.box.heightReference, this._options.dimensions.z * 0.5, this._scene.mapProjection.ellipsoid),\n            attributes : attributes\n        });\n    };\n\n    BoxGeometryUpdater.prototype._computeCenter = function(time, result) {\n        return Property.getValueOrUndefined(this._entity.position, time, result);\n    };\n\n    BoxGeometryUpdater.prototype._isHidden = function(entity, box) {\n        return !defined(box.dimensions) || !defined(entity.position) || GeometryUpdater.prototype._isHidden.call(this, entity, box);\n    };\n\n    BoxGeometryUpdater.prototype._isDynamic = function(entity, box) {\n        return !entity.position.isConstant ||  !Property.isConstant(entity.orientation) ||  !box.dimensions.isConstant ||  !Property.isConstant(box.outlineWidth);\n    };\n\n    BoxGeometryUpdater.prototype._setStaticOptions = function(entity, box) {\n        var heightReference = Property.getValueOrDefault(box.heightReference, Iso8601.MINIMUM_VALUE, HeightReference.NONE);\n\n        var options = this._options;\n        options.vertexFormat = this._materialProperty instanceof ColorMaterialProperty ? PerInstanceColorAppearance.VERTEX_FORMAT : MaterialAppearance.MaterialSupport.TEXTURED.vertexFormat;\n        options.dimensions = box.dimensions.getValue(Iso8601.MINIMUM_VALUE, options.dimensions);\n        options.offsetAttribute = heightReference !== HeightReference.NONE ? GeometryOffsetAttribute.ALL : undefined;\n    };\n\n    BoxGeometryUpdater.prototype._onEntityPropertyChanged = heightReferenceOnEntityPropertyChanged;\n\n    BoxGeometryUpdater.DynamicGeometryUpdater = DynamicBoxGeometryUpdater;\n\n    /**\n     * @private\n     */\n    function DynamicBoxGeometryUpdater(geometryUpdater, primitives, groundPrimitives) {\n        DynamicGeometryUpdater.call(this, geometryUpdater, primitives, groundPrimitives);\n    }\n\n    if (defined(Object.create)) {\n        DynamicBoxGeometryUpdater.prototype = Object.create(DynamicGeometryUpdater.prototype);\n        DynamicBoxGeometryUpdater.prototype.constructor = DynamicBoxGeometryUpdater;\n    }\n\n    DynamicBoxGeometryUpdater.prototype._isHidden = function(entity, box, time) {\n        var position = Property.getValueOrUndefined(entity.position, time, positionScratch);\n        var dimensions = this._options.dimensions;\n        return !defined(position) || !defined(dimensions) || DynamicGeometryUpdater.prototype._isHidden.call(this, entity, box, time);\n    };\n\n    DynamicBoxGeometryUpdater.prototype._setOptions = function(entity, box, time) {\n        var heightReference = Property.getValueOrDefault(box.heightReference, time, HeightReference.NONE);\n        var options = this._options;\n        options.dimensions = Property.getValueOrUndefined(box.dimensions, time, options.dimensions);\n        options.offsetAttribute = heightReference !== HeightReference.NONE ? GeometryOffsetAttribute.ALL : undefined;\n    };\nexport default BoxGeometryUpdater;\n","import Cartesian2 from './Cartesian2.js';\nimport Cartesian3 from './Cartesian3.js';\nimport Cartesian4 from './Cartesian4.js';\nimport Cartographic from './Cartographic.js';\nimport CornerType from './CornerType.js';\nimport EllipsoidTangentPlane from './EllipsoidTangentPlane.js';\nimport CesiumMath from './Math.js';\nimport Matrix3 from './Matrix3.js';\nimport Matrix4 from './Matrix4.js';\nimport PolylinePipeline from './PolylinePipeline.js';\nimport Quaternion from './Quaternion.js';\nimport Transforms from './Transforms.js';\n\n    var scratch2Array = [new Cartesian3(), new Cartesian3()];\n    var scratchCartesian1 = new Cartesian3();\n    var scratchCartesian2 = new Cartesian3();\n    var scratchCartesian3 = new Cartesian3();\n    var scratchCartesian4 = new Cartesian3();\n    var scratchCartesian5 = new Cartesian3();\n    var scratchCartesian6 = new Cartesian3();\n    var scratchCartesian7 = new Cartesian3();\n    var scratchCartesian8 = new Cartesian3();\n    var scratchCartesian9 = new Cartesian3();\n\n    var scratch1 = new Cartesian3();\n    var scratch2 = new Cartesian3();\n\n    /**\n     * @private\n     */\n    var PolylineVolumeGeometryLibrary = {};\n\n    var cartographic = new Cartographic();\n    function scaleToSurface(positions, ellipsoid) {\n        var heights = new Array(positions.length);\n        for (var i = 0; i < positions.length; i++) {\n            var pos = positions[i];\n            cartographic = ellipsoid.cartesianToCartographic(pos, cartographic);\n            heights[i] = cartographic.height;\n            positions[i] = ellipsoid.scaleToGeodeticSurface(pos, pos);\n        }\n        return heights;\n    }\n\n    function subdivideHeights(points, h0, h1, granularity) {\n        var p0 = points[0];\n        var p1 = points[1];\n        var angleBetween = Cartesian3.angleBetween(p0, p1);\n        var numPoints = Math.ceil(angleBetween / granularity);\n        var heights = new Array(numPoints);\n        var i;\n        if (h0 === h1) {\n            for (i = 0; i < numPoints; i++) {\n                heights[i] = h0;\n            }\n            heights.push(h1);\n            return heights;\n        }\n\n        var dHeight = h1 - h0;\n        var heightPerVertex = dHeight / (numPoints);\n\n        for (i = 1; i < numPoints; i++) {\n            var h = h0 + i * heightPerVertex;\n            heights[i] = h;\n        }\n\n        heights[0] = h0;\n        heights.push(h1);\n        return heights;\n    }\n\n    var nextScratch = new Cartesian3();\n    var prevScratch = new Cartesian3();\n\n    function computeRotationAngle(start, end, position, ellipsoid) {\n        var tangentPlane = new EllipsoidTangentPlane(position, ellipsoid);\n        var next = tangentPlane.projectPointOntoPlane(Cartesian3.add(position, start, nextScratch), nextScratch);\n        var prev = tangentPlane.projectPointOntoPlane(Cartesian3.add(position, end, prevScratch), prevScratch);\n        var angle = Cartesian2.angleBetween(next, prev);\n\n        return (prev.x * next.y - prev.y * next.x >= 0.0) ? -angle : angle;\n    }\n\n    var negativeX = new Cartesian3(-1, 0, 0);\n    var transform = new Matrix4();\n    var translation = new Matrix4();\n    var rotationZ = new Matrix3();\n    var scaleMatrix = Matrix3.IDENTITY.clone();\n    var westScratch = new Cartesian3();\n    var finalPosScratch = new Cartesian4();\n    var heightCartesian = new Cartesian3();\n    function addPosition(center, left, shape, finalPositions, ellipsoid, height, xScalar, repeat) {\n        var west = westScratch;\n        var finalPosition = finalPosScratch;\n        transform = Transforms.eastNorthUpToFixedFrame(center, ellipsoid, transform);\n\n        west = Matrix4.multiplyByPointAsVector(transform, negativeX, west);\n        west = Cartesian3.normalize(west, west);\n        var angle = computeRotationAngle(west, left, center, ellipsoid);\n        rotationZ = Matrix3.fromRotationZ(angle, rotationZ);\n\n        heightCartesian.z = height;\n        transform = Matrix4.multiplyTransformation(transform, Matrix4.fromRotationTranslation(rotationZ, heightCartesian, translation), transform);\n        var scale = scaleMatrix;\n        scale[0] = xScalar;\n\n        for (var j = 0; j < repeat; j++) {\n            for (var i = 0; i < shape.length; i += 3) {\n                finalPosition = Cartesian3.fromArray(shape, i, finalPosition);\n                finalPosition = Matrix3.multiplyByVector(scale, finalPosition, finalPosition);\n                finalPosition = Matrix4.multiplyByPoint(transform, finalPosition, finalPosition);\n                finalPositions.push(finalPosition.x, finalPosition.y, finalPosition.z);\n            }\n        }\n\n        return finalPositions;\n    }\n\n    var centerScratch = new Cartesian3();\n    function addPositions(centers, left, shape, finalPositions, ellipsoid, heights, xScalar) {\n        for (var i = 0; i < centers.length; i += 3) {\n            var center = Cartesian3.fromArray(centers, i, centerScratch);\n            finalPositions = addPosition(center, left, shape, finalPositions, ellipsoid, heights[i / 3], xScalar, 1);\n        }\n        return finalPositions;\n    }\n\n    function convertShapeTo3DDuplicate(shape2D, boundingRectangle) { //orientate 2D shape to XZ plane center at (0, 0, 0), duplicate points\n        var length = shape2D.length;\n        var shape = new Array(length * 6);\n        var index = 0;\n        var xOffset = boundingRectangle.x + boundingRectangle.width / 2;\n        var yOffset = boundingRectangle.y + boundingRectangle.height / 2;\n\n        var point = shape2D[0];\n        shape[index++] = point.x - xOffset;\n        shape[index++] = 0.0;\n        shape[index++] = point.y - yOffset;\n        for (var i = 1; i < length; i++) {\n            point = shape2D[i];\n            var x = point.x - xOffset;\n            var z = point.y - yOffset;\n            shape[index++] = x;\n            shape[index++] = 0.0;\n            shape[index++] = z;\n\n            shape[index++] = x;\n            shape[index++] = 0.0;\n            shape[index++] = z;\n        }\n        point = shape2D[0];\n        shape[index++] = point.x - xOffset;\n        shape[index++] = 0.0;\n        shape[index++] = point.y - yOffset;\n\n        return shape;\n    }\n\n    function convertShapeTo3D(shape2D, boundingRectangle) { //orientate 2D shape to XZ plane center at (0, 0, 0)\n        var length = shape2D.length;\n        var shape = new Array(length * 3);\n        var index = 0;\n        var xOffset = boundingRectangle.x + boundingRectangle.width / 2;\n        var yOffset = boundingRectangle.y + boundingRectangle.height / 2;\n\n        for (var i = 0; i < length; i++) {\n            shape[index++] = shape2D[i].x - xOffset;\n            shape[index++] = 0;\n            shape[index++] = shape2D[i].y - yOffset;\n        }\n\n        return shape;\n    }\n\n    var quaterion = new Quaternion();\n    var startPointScratch = new Cartesian3();\n    var rotMatrix = new Matrix3();\n    function computeRoundCorner(pivot, startPoint, endPoint, cornerType, leftIsOutside, ellipsoid, finalPositions, shape, height, duplicatePoints) {\n        var angle = Cartesian3.angleBetween(Cartesian3.subtract(startPoint, pivot, scratch1), Cartesian3.subtract(endPoint, pivot, scratch2));\n        var granularity = (cornerType === CornerType.BEVELED) ? 0 : Math.ceil(angle / CesiumMath.toRadians(5));\n\n        var m;\n        if (leftIsOutside) {\n            m = Matrix3.fromQuaternion(Quaternion.fromAxisAngle(Cartesian3.negate(pivot, scratch1), angle / (granularity + 1), quaterion), rotMatrix);\n        } else {\n            m = Matrix3.fromQuaternion(Quaternion.fromAxisAngle(pivot, angle / (granularity + 1), quaterion), rotMatrix);\n        }\n\n        var left;\n        var surfacePoint;\n        startPoint = Cartesian3.clone(startPoint, startPointScratch);\n        if (granularity > 0) {\n            var repeat = duplicatePoints ? 2 : 1;\n            for (var i = 0; i < granularity; i++) {\n                startPoint = Matrix3.multiplyByVector(m, startPoint, startPoint);\n                left = Cartesian3.subtract(startPoint, pivot, scratch1);\n                left = Cartesian3.normalize(left, left);\n                if (!leftIsOutside) {\n                    left = Cartesian3.negate(left, left);\n                }\n                surfacePoint = ellipsoid.scaleToGeodeticSurface(startPoint, scratch2);\n                finalPositions = addPosition(surfacePoint, left, shape, finalPositions, ellipsoid, height, 1, repeat);\n            }\n        } else {\n            left = Cartesian3.subtract(startPoint, pivot, scratch1);\n            left = Cartesian3.normalize(left, left);\n            if (!leftIsOutside) {\n                left = Cartesian3.negate(left, left);\n            }\n            surfacePoint = ellipsoid.scaleToGeodeticSurface(startPoint, scratch2);\n            finalPositions = addPosition(surfacePoint, left, shape, finalPositions, ellipsoid, height, 1, 1);\n\n            endPoint = Cartesian3.clone(endPoint, startPointScratch);\n            left = Cartesian3.subtract(endPoint, pivot, scratch1);\n            left = Cartesian3.normalize(left, left);\n            if (!leftIsOutside) {\n                left = Cartesian3.negate(left, left);\n            }\n            surfacePoint = ellipsoid.scaleToGeodeticSurface(endPoint, scratch2);\n            finalPositions = addPosition(surfacePoint, left, shape, finalPositions, ellipsoid, height, 1, 1);\n        }\n\n        return finalPositions;\n    }\n\n    PolylineVolumeGeometryLibrary.removeDuplicatesFromShape = function(shapePositions) {\n        var length = shapePositions.length;\n        var cleanedPositions = [];\n        for (var i0 = length - 1, i1 = 0; i1 < length; i0 = i1++) {\n            var v0 = shapePositions[i0];\n            var v1 = shapePositions[i1];\n\n            if (!Cartesian2.equals(v0, v1)) {\n                cleanedPositions.push(v1); // Shallow copy!\n            }\n        }\n\n        return cleanedPositions;\n    };\n\n    PolylineVolumeGeometryLibrary.angleIsGreaterThanPi = function(forward, backward, position, ellipsoid) {\n        var tangentPlane = new EllipsoidTangentPlane(position, ellipsoid);\n        var next = tangentPlane.projectPointOntoPlane(Cartesian3.add(position, forward, nextScratch), nextScratch);\n        var prev = tangentPlane.projectPointOntoPlane(Cartesian3.add(position, backward, prevScratch), prevScratch);\n\n        return ((prev.x * next.y) - (prev.y * next.x)) >= 0.0;\n    };\n\n    var scratchForwardProjection = new Cartesian3();\n    var scratchBackwardProjection = new Cartesian3();\n\n    PolylineVolumeGeometryLibrary.computePositions = function(positions, shape2D, boundingRectangle, geometry, duplicatePoints) {\n        var ellipsoid = geometry._ellipsoid;\n        var heights = scaleToSurface(positions, ellipsoid);\n        var granularity = geometry._granularity;\n        var cornerType = geometry._cornerType;\n        var shapeForSides = duplicatePoints ? convertShapeTo3DDuplicate(shape2D, boundingRectangle) : convertShapeTo3D(shape2D, boundingRectangle);\n        var shapeForEnds = duplicatePoints ? convertShapeTo3D(shape2D, boundingRectangle) : undefined;\n        var heightOffset = boundingRectangle.height / 2;\n        var width = boundingRectangle.width / 2;\n        var length = positions.length;\n        var finalPositions = [];\n        var ends = duplicatePoints ? [] : undefined;\n\n        var forward = scratchCartesian1;\n        var backward = scratchCartesian2;\n        var cornerDirection = scratchCartesian3;\n        var surfaceNormal = scratchCartesian4;\n        var pivot = scratchCartesian5;\n        var start = scratchCartesian6;\n        var end = scratchCartesian7;\n        var left = scratchCartesian8;\n        var previousPosition = scratchCartesian9;\n\n        var position = positions[0];\n        var nextPosition = positions[1];\n        surfaceNormal = ellipsoid.geodeticSurfaceNormal(position, surfaceNormal);\n        forward = Cartesian3.subtract(nextPosition, position, forward);\n        forward = Cartesian3.normalize(forward, forward);\n        left = Cartesian3.cross(surfaceNormal, forward, left);\n        left = Cartesian3.normalize(left, left);\n        var h0 = heights[0];\n        var h1 = heights[1];\n        if (duplicatePoints) {\n            ends = addPosition(position, left, shapeForEnds, ends, ellipsoid, h0 + heightOffset, 1, 1);\n        }\n        previousPosition = Cartesian3.clone(position, previousPosition);\n        position = nextPosition;\n        backward = Cartesian3.negate(forward, backward);\n        var subdividedHeights;\n        var subdividedPositions;\n        for (var i = 1; i < length - 1; i++) {\n            var repeat = duplicatePoints ? 2 : 1;\n            nextPosition = positions[i + 1];\n            forward = Cartesian3.subtract(nextPosition, position, forward);\n            forward = Cartesian3.normalize(forward, forward);\n            cornerDirection = Cartesian3.add(forward, backward, cornerDirection);\n            cornerDirection = Cartesian3.normalize(cornerDirection, cornerDirection);\n            surfaceNormal = ellipsoid.geodeticSurfaceNormal(position, surfaceNormal);\n\n            var forwardProjection = Cartesian3.multiplyByScalar(surfaceNormal, Cartesian3.dot(forward, surfaceNormal), scratchForwardProjection);\n            Cartesian3.subtract(forward, forwardProjection, forwardProjection);\n            Cartesian3.normalize(forwardProjection, forwardProjection);\n\n            var backwardProjection = Cartesian3.multiplyByScalar(surfaceNormal, Cartesian3.dot(backward, surfaceNormal), scratchBackwardProjection);\n            Cartesian3.subtract(backward, backwardProjection, backwardProjection);\n            Cartesian3.normalize(backwardProjection, backwardProjection);\n\n            var doCorner = !CesiumMath.equalsEpsilon(Math.abs(Cartesian3.dot(forwardProjection, backwardProjection)), 1.0, CesiumMath.EPSILON7);\n\n            if (doCorner) {\n                cornerDirection = Cartesian3.cross(cornerDirection, surfaceNormal, cornerDirection);\n                cornerDirection = Cartesian3.cross(surfaceNormal, cornerDirection, cornerDirection);\n                cornerDirection = Cartesian3.normalize(cornerDirection, cornerDirection);\n                var scalar = 1 / Math.max(0.25, (Cartesian3.magnitude(Cartesian3.cross(cornerDirection, backward, scratch1))));\n                var leftIsOutside = PolylineVolumeGeometryLibrary.angleIsGreaterThanPi(forward, backward, position, ellipsoid);\n                if (leftIsOutside) {\n                    pivot = Cartesian3.add(position, Cartesian3.multiplyByScalar(cornerDirection, scalar * width, cornerDirection), pivot);\n                    start = Cartesian3.add(pivot, Cartesian3.multiplyByScalar(left, width, start), start);\n                    scratch2Array[0] = Cartesian3.clone(previousPosition, scratch2Array[0]);\n                    scratch2Array[1] = Cartesian3.clone(start, scratch2Array[1]);\n                    subdividedHeights = subdivideHeights(scratch2Array, h0 + heightOffset, h1 + heightOffset, granularity);\n                    subdividedPositions = PolylinePipeline.generateArc({\n                        positions: scratch2Array,\n                        granularity: granularity,\n                        ellipsoid: ellipsoid\n                    });\n                    finalPositions = addPositions(subdividedPositions, left, shapeForSides, finalPositions, ellipsoid, subdividedHeights, 1);\n                    left = Cartesian3.cross(surfaceNormal, forward, left);\n                    left = Cartesian3.normalize(left, left);\n                    end = Cartesian3.add(pivot, Cartesian3.multiplyByScalar(left, width, end), end);\n                    if (cornerType === CornerType.ROUNDED || cornerType === CornerType.BEVELED) {\n                        computeRoundCorner(pivot, start, end, cornerType, leftIsOutside, ellipsoid, finalPositions, shapeForSides, h1 + heightOffset, duplicatePoints);\n                    } else {\n                        cornerDirection = Cartesian3.negate(cornerDirection, cornerDirection);\n                        finalPositions = addPosition(position, cornerDirection, shapeForSides, finalPositions, ellipsoid, h1 + heightOffset, scalar, repeat);\n                    }\n                    previousPosition = Cartesian3.clone(end, previousPosition);\n                } else {\n                    pivot = Cartesian3.add(position, Cartesian3.multiplyByScalar(cornerDirection, scalar * width, cornerDirection), pivot);\n                    start = Cartesian3.add(pivot, Cartesian3.multiplyByScalar(left, -width, start), start);\n                    scratch2Array[0] = Cartesian3.clone(previousPosition, scratch2Array[0]);\n                    scratch2Array[1] = Cartesian3.clone(start, scratch2Array[1]);\n                    subdividedHeights = subdivideHeights(scratch2Array, h0 + heightOffset, h1 + heightOffset, granularity);\n                    subdividedPositions = PolylinePipeline.generateArc({\n                        positions: scratch2Array,\n                        granularity: granularity,\n                        ellipsoid: ellipsoid\n                    });\n                    finalPositions = addPositions(subdividedPositions, left, shapeForSides, finalPositions, ellipsoid, subdividedHeights, 1);\n                    left = Cartesian3.cross(surfaceNormal, forward, left);\n                    left = Cartesian3.normalize(left, left);\n                    end = Cartesian3.add(pivot, Cartesian3.multiplyByScalar(left, -width, end), end);\n                    if (cornerType === CornerType.ROUNDED || cornerType === CornerType.BEVELED) {\n                        computeRoundCorner(pivot, start, end, cornerType, leftIsOutside, ellipsoid, finalPositions, shapeForSides, h1 + heightOffset, duplicatePoints);\n                    } else {\n                        finalPositions = addPosition(position, cornerDirection, shapeForSides, finalPositions, ellipsoid, h1 + heightOffset, scalar, repeat);\n                    }\n                    previousPosition = Cartesian3.clone(end, previousPosition);\n                }\n                backward = Cartesian3.negate(forward, backward);\n            } else {\n                finalPositions = addPosition(previousPosition, left, shapeForSides, finalPositions, ellipsoid, h0 + heightOffset, 1, 1);\n                previousPosition = position;\n            }\n            h0 = h1;\n            h1 = heights[i + 1];\n            position = nextPosition;\n        }\n\n        scratch2Array[0] = Cartesian3.clone(previousPosition, scratch2Array[0]);\n        scratch2Array[1] = Cartesian3.clone(position, scratch2Array[1]);\n        subdividedHeights = subdivideHeights(scratch2Array, h0 + heightOffset, h1 + heightOffset, granularity);\n        subdividedPositions = PolylinePipeline.generateArc({\n            positions: scratch2Array,\n            granularity: granularity,\n            ellipsoid: ellipsoid\n        });\n        finalPositions = addPositions(subdividedPositions, left, shapeForSides, finalPositions, ellipsoid, subdividedHeights, 1);\n        if (duplicatePoints) {\n            ends = addPosition(position, left, shapeForEnds, ends, ellipsoid, h1 + heightOffset, 1, 1);\n        }\n\n        length = finalPositions.length;\n        var posLength = duplicatePoints ? length + ends.length : length;\n        var combinedPositions = new Float64Array(posLength);\n        combinedPositions.set(finalPositions);\n        if (duplicatePoints) {\n            combinedPositions.set(ends, length);\n        }\n\n        return combinedPositions;\n    };\nexport default PolylineVolumeGeometryLibrary;\n","import Cartesian3 from './Cartesian3.js';\nimport CornerType from './CornerType.js';\nimport defined from './defined.js';\nimport CesiumMath from './Math.js';\nimport Matrix3 from './Matrix3.js';\nimport PolylinePipeline from './PolylinePipeline.js';\nimport PolylineVolumeGeometryLibrary from './PolylineVolumeGeometryLibrary.js';\nimport Quaternion from './Quaternion.js';\n\n    /**\n     * @private\n     */\n    var CorridorGeometryLibrary = {};\n\n    var scratch1 = new Cartesian3();\n    var scratch2 = new Cartesian3();\n    var scratch3 = new Cartesian3();\n    var scratch4 = new Cartesian3();\n\n    var scaleArray2 = [new Cartesian3(), new Cartesian3()];\n\n    var cartesian1 = new Cartesian3();\n    var cartesian2 = new Cartesian3();\n    var cartesian3 = new Cartesian3();\n    var cartesian4 = new Cartesian3();\n    var cartesian5 = new Cartesian3();\n    var cartesian6 = new Cartesian3();\n    var cartesian7 = new Cartesian3();\n    var cartesian8 = new Cartesian3();\n    var cartesian9 = new Cartesian3();\n    var cartesian10 = new Cartesian3();\n\n    var quaterion = new Quaternion();\n    var rotMatrix = new Matrix3();\n    function computeRoundCorner(cornerPoint, startPoint, endPoint, cornerType, leftIsOutside) {\n        var angle = Cartesian3.angleBetween(Cartesian3.subtract(startPoint, cornerPoint, scratch1), Cartesian3.subtract(endPoint, cornerPoint, scratch2));\n        var granularity = (cornerType === CornerType.BEVELED) ? 1 : Math.ceil(angle / CesiumMath.toRadians(5)) + 1;\n\n        var size = granularity * 3;\n        var array = new Array(size);\n\n        array[size - 3] = endPoint.x;\n        array[size - 2] = endPoint.y;\n        array[size - 1] = endPoint.z;\n\n        var m;\n        if (leftIsOutside) {\n            m = Matrix3.fromQuaternion(Quaternion.fromAxisAngle(Cartesian3.negate(cornerPoint, scratch1), angle / granularity, quaterion), rotMatrix);\n        } else {\n            m = Matrix3.fromQuaternion(Quaternion.fromAxisAngle(cornerPoint, angle / granularity, quaterion), rotMatrix);\n        }\n\n        var index = 0;\n        startPoint = Cartesian3.clone(startPoint, scratch1);\n        for (var i = 0; i < granularity; i++) {\n            startPoint = Matrix3.multiplyByVector(m, startPoint, startPoint);\n            array[index++] = startPoint.x;\n            array[index++] = startPoint.y;\n            array[index++] = startPoint.z;\n        }\n\n        return array;\n    }\n\n    function addEndCaps(calculatedPositions) {\n        var cornerPoint = cartesian1;\n        var startPoint = cartesian2;\n        var endPoint = cartesian3;\n\n        var leftEdge = calculatedPositions[1];\n        startPoint = Cartesian3.fromArray(calculatedPositions[1], leftEdge.length - 3, startPoint);\n        endPoint = Cartesian3.fromArray(calculatedPositions[0], 0, endPoint);\n        cornerPoint = Cartesian3.midpoint(startPoint, endPoint, cornerPoint);\n        var firstEndCap = computeRoundCorner(cornerPoint, startPoint, endPoint, CornerType.ROUNDED, false);\n\n        var length = calculatedPositions.length - 1;\n        var rightEdge = calculatedPositions[length - 1];\n        leftEdge = calculatedPositions[length];\n        startPoint = Cartesian3.fromArray(rightEdge, rightEdge.length - 3, startPoint);\n        endPoint = Cartesian3.fromArray(leftEdge, 0, endPoint);\n        cornerPoint = Cartesian3.midpoint(startPoint, endPoint, cornerPoint);\n        var lastEndCap = computeRoundCorner(cornerPoint, startPoint, endPoint, CornerType.ROUNDED, false);\n\n        return [firstEndCap, lastEndCap];\n    }\n\n    function computeMiteredCorner(position, leftCornerDirection, lastPoint, leftIsOutside) {\n        var cornerPoint = scratch1;\n        if (leftIsOutside) {\n            cornerPoint = Cartesian3.add(position, leftCornerDirection, cornerPoint);\n        } else {\n            leftCornerDirection = Cartesian3.negate(leftCornerDirection, leftCornerDirection);\n            cornerPoint = Cartesian3.add(position, leftCornerDirection, cornerPoint);\n        }\n        return [cornerPoint.x, cornerPoint.y, cornerPoint.z, lastPoint.x, lastPoint.y, lastPoint.z];\n    }\n\n    function addShiftedPositions(positions, left, scalar, calculatedPositions) {\n        var rightPositions = new Array(positions.length);\n        var leftPositions = new Array(positions.length);\n        var scaledLeft = Cartesian3.multiplyByScalar(left, scalar, scratch1);\n        var scaledRight = Cartesian3.negate(scaledLeft, scratch2);\n        var rightIndex = 0;\n        var leftIndex = positions.length - 1;\n\n        for (var i = 0; i < positions.length; i += 3) {\n            var pos = Cartesian3.fromArray(positions, i, scratch3);\n            var rightPos = Cartesian3.add(pos, scaledRight, scratch4);\n            rightPositions[rightIndex++] = rightPos.x;\n            rightPositions[rightIndex++] = rightPos.y;\n            rightPositions[rightIndex++] = rightPos.z;\n\n            var leftPos = Cartesian3.add(pos, scaledLeft, scratch4);\n            leftPositions[leftIndex--] = leftPos.z;\n            leftPositions[leftIndex--] = leftPos.y;\n            leftPositions[leftIndex--] = leftPos.x;\n        }\n        calculatedPositions.push(rightPositions, leftPositions);\n\n        return calculatedPositions;\n    }\n\n    /**\n     * @private\n     */\n    CorridorGeometryLibrary.addAttribute = function(attribute, value, front, back) {\n        var x = value.x;\n        var y = value.y;\n        var z = value.z;\n        if (defined(front)) {\n            attribute[front] = x;\n            attribute[front + 1] = y;\n            attribute[front + 2] = z;\n        }\n        if (defined(back)) {\n            attribute[back] = z;\n            attribute[back - 1] = y;\n            attribute[back - 2] = x;\n        }\n    };\n\n    var scratchForwardProjection = new Cartesian3();\n    var scratchBackwardProjection = new Cartesian3();\n\n    /**\n     * @private\n     */\n    CorridorGeometryLibrary.computePositions = function(params) {\n        var granularity = params.granularity;\n        var positions = params.positions;\n        var ellipsoid = params.ellipsoid;\n        var width = params.width / 2;\n        var cornerType = params.cornerType;\n        var saveAttributes = params.saveAttributes;\n        var normal = cartesian1;\n        var forward = cartesian2;\n        var backward = cartesian3;\n        var left = cartesian4;\n        var cornerDirection = cartesian5;\n        var startPoint = cartesian6;\n        var previousPos = cartesian7;\n        var rightPos = cartesian8;\n        var leftPos = cartesian9;\n        var center = cartesian10;\n        var calculatedPositions = [];\n        var calculatedLefts = (saveAttributes) ? [] : undefined;\n        var calculatedNormals = (saveAttributes) ? [] : undefined;\n        var position = positions[0]; //add first point\n        var nextPosition = positions[1];\n\n        forward = Cartesian3.normalize(Cartesian3.subtract(nextPosition, position, forward), forward);\n        normal = ellipsoid.geodeticSurfaceNormal(position, normal);\n        left = Cartesian3.normalize(Cartesian3.cross(normal, forward, left), left);\n        if (saveAttributes) {\n            calculatedLefts.push(left.x, left.y, left.z);\n            calculatedNormals.push(normal.x, normal.y, normal.z);\n        }\n        previousPos = Cartesian3.clone(position, previousPos);\n        position = nextPosition;\n        backward = Cartesian3.negate(forward, backward);\n\n        var subdividedPositions;\n        var corners = [];\n        var i;\n        var length = positions.length;\n        for (i = 1; i < length - 1; i++) { // add middle points and corners\n            normal = ellipsoid.geodeticSurfaceNormal(position, normal);\n            nextPosition = positions[i + 1];\n            forward = Cartesian3.normalize(Cartesian3.subtract(nextPosition, position, forward), forward);\n            cornerDirection = Cartesian3.normalize(Cartesian3.add(forward, backward, cornerDirection), cornerDirection);\n\n            var forwardProjection = Cartesian3.multiplyByScalar(normal, Cartesian3.dot(forward, normal), scratchForwardProjection);\n            Cartesian3.subtract(forward, forwardProjection, forwardProjection);\n            Cartesian3.normalize(forwardProjection, forwardProjection);\n\n            var backwardProjection = Cartesian3.multiplyByScalar(normal, Cartesian3.dot(backward, normal), scratchBackwardProjection);\n            Cartesian3.subtract(backward, backwardProjection, backwardProjection);\n            Cartesian3.normalize(backwardProjection, backwardProjection);\n\n            var doCorner = !CesiumMath.equalsEpsilon(Math.abs(Cartesian3.dot(forwardProjection, backwardProjection)), 1.0, CesiumMath.EPSILON7);\n\n            if (doCorner) {\n                cornerDirection = Cartesian3.cross(cornerDirection, normal, cornerDirection);\n                cornerDirection = Cartesian3.cross(normal, cornerDirection, cornerDirection);\n                cornerDirection = Cartesian3.normalize(cornerDirection, cornerDirection);\n                var scalar = width / Math.max(0.25, Cartesian3.magnitude(Cartesian3.cross(cornerDirection, backward, scratch1)));\n                var leftIsOutside = PolylineVolumeGeometryLibrary.angleIsGreaterThanPi(forward, backward, position, ellipsoid);\n                cornerDirection = Cartesian3.multiplyByScalar(cornerDirection, scalar, cornerDirection);\n                if (leftIsOutside) {\n                    rightPos = Cartesian3.add(position, cornerDirection, rightPos);\n                    center = Cartesian3.add(rightPos, Cartesian3.multiplyByScalar(left, width, center), center);\n                    leftPos = Cartesian3.add(rightPos, Cartesian3.multiplyByScalar(left, width * 2, leftPos), leftPos);\n                    scaleArray2[0] = Cartesian3.clone(previousPos, scaleArray2[0]);\n                    scaleArray2[1] = Cartesian3.clone(center, scaleArray2[1]);\n                    subdividedPositions = PolylinePipeline.generateArc({\n                        positions: scaleArray2,\n                        granularity: granularity,\n                        ellipsoid: ellipsoid\n                    });\n                    calculatedPositions = addShiftedPositions(subdividedPositions, left, width, calculatedPositions);\n                    if (saveAttributes) {\n                        calculatedLefts.push(left.x, left.y, left.z);\n                        calculatedNormals.push(normal.x, normal.y, normal.z);\n                    }\n                    startPoint = Cartesian3.clone(leftPos, startPoint);\n                    left = Cartesian3.normalize(Cartesian3.cross(normal, forward, left), left);\n                    leftPos = Cartesian3.add(rightPos, Cartesian3.multiplyByScalar(left, width * 2, leftPos), leftPos);\n                    previousPos = Cartesian3.add(rightPos, Cartesian3.multiplyByScalar(left, width, previousPos), previousPos);\n                    if (cornerType === CornerType.ROUNDED || cornerType === CornerType.BEVELED) {\n                        corners.push({\n                            leftPositions : computeRoundCorner(rightPos, startPoint, leftPos, cornerType, leftIsOutside)\n                        });\n                    } else {\n                        corners.push({\n                            leftPositions : computeMiteredCorner(position, Cartesian3.negate(cornerDirection, cornerDirection), leftPos, leftIsOutside)\n                        });\n                    }\n                } else {\n                    leftPos = Cartesian3.add(position, cornerDirection, leftPos);\n                    center = Cartesian3.add(leftPos, Cartesian3.negate(Cartesian3.multiplyByScalar(left, width, center), center), center);\n                    rightPos = Cartesian3.add(leftPos, Cartesian3.negate(Cartesian3.multiplyByScalar(left, width * 2, rightPos), rightPos), rightPos);\n                    scaleArray2[0] = Cartesian3.clone(previousPos, scaleArray2[0]);\n                    scaleArray2[1] = Cartesian3.clone(center, scaleArray2[1]);\n                    subdividedPositions = PolylinePipeline.generateArc({\n                        positions: scaleArray2,\n                        granularity: granularity,\n                        ellipsoid: ellipsoid\n                    });\n                    calculatedPositions = addShiftedPositions(subdividedPositions, left, width, calculatedPositions);\n                    if (saveAttributes) {\n                        calculatedLefts.push(left.x, left.y, left.z);\n                        calculatedNormals.push(normal.x, normal.y, normal.z);\n                    }\n                    startPoint = Cartesian3.clone(rightPos, startPoint);\n                    left = Cartesian3.normalize(Cartesian3.cross(normal, forward, left), left);\n                    rightPos = Cartesian3.add(leftPos, Cartesian3.negate(Cartesian3.multiplyByScalar(left, width * 2, rightPos), rightPos), rightPos);\n                    previousPos = Cartesian3.add(leftPos, Cartesian3.negate(Cartesian3.multiplyByScalar(left, width, previousPos), previousPos), previousPos);\n                    if (cornerType === CornerType.ROUNDED || cornerType === CornerType.BEVELED) {\n                        corners.push({\n                            rightPositions : computeRoundCorner(leftPos, startPoint, rightPos, cornerType, leftIsOutside)\n                        });\n                    } else {\n                        corners.push({\n                            rightPositions : computeMiteredCorner(position, cornerDirection, rightPos, leftIsOutside)\n                        });\n                    }\n                }\n                backward = Cartesian3.negate(forward, backward);\n            }\n            position = nextPosition;\n        }\n\n        normal = ellipsoid.geodeticSurfaceNormal(position, normal);\n        scaleArray2[0] = Cartesian3.clone(previousPos, scaleArray2[0]);\n        scaleArray2[1] = Cartesian3.clone(position, scaleArray2[1]);\n        subdividedPositions = PolylinePipeline.generateArc({\n            positions: scaleArray2,\n            granularity: granularity,\n            ellipsoid: ellipsoid\n        });\n        calculatedPositions = addShiftedPositions(subdividedPositions, left, width, calculatedPositions);\n        if (saveAttributes) {\n            calculatedLefts.push(left.x, left.y, left.z);\n            calculatedNormals.push(normal.x, normal.y, normal.z);\n        }\n\n        var endPositions;\n        if (cornerType === CornerType.ROUNDED) {\n            endPositions = addEndCaps(calculatedPositions);\n        }\n\n        return {\n            positions : calculatedPositions,\n            corners : corners,\n            lefts : calculatedLefts,\n            normals : calculatedNormals,\n            endPositions : endPositions\n        };\n    };\nexport default CorridorGeometryLibrary;\n","import arrayFill from './arrayFill.js';\nimport arrayRemoveDuplicates from './arrayRemoveDuplicates.js';\nimport BoundingSphere from './BoundingSphere.js';\nimport Cartesian3 from './Cartesian3.js';\nimport Cartographic from './Cartographic.js';\nimport Check from './Check.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport CornerType from './CornerType.js';\nimport CorridorGeometryLibrary from './CorridorGeometryLibrary.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport Ellipsoid from './Ellipsoid.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport GeometryOffsetAttribute from './GeometryOffsetAttribute.js';\nimport IndexDatatype from './IndexDatatype.js';\nimport CesiumMath from './Math.js';\nimport PolygonPipeline from './PolygonPipeline.js';\nimport PrimitiveType from './PrimitiveType.js';\nimport Rectangle from './Rectangle.js';\nimport VertexFormat from './VertexFormat.js';\n\n    var cartesian1 = new Cartesian3();\n    var cartesian2 = new Cartesian3();\n    var cartesian3 = new Cartesian3();\n    var cartesian4 = new Cartesian3();\n    var cartesian5 = new Cartesian3();\n    var cartesian6 = new Cartesian3();\n\n    var scratch1 = new Cartesian3();\n    var scratch2 = new Cartesian3();\n\n    function scaleToSurface(positions, ellipsoid) {\n        for (var i = 0; i < positions.length; i++) {\n            positions[i] = ellipsoid.scaleToGeodeticSurface(positions[i], positions[i]);\n        }\n        return positions;\n    }\n\n    function addNormals(attr, normal, left, front, back, vertexFormat) {\n        var normals = attr.normals;\n        var tangents = attr.tangents;\n        var bitangents = attr.bitangents;\n        var forward = Cartesian3.normalize(Cartesian3.cross(left, normal, scratch1), scratch1);\n        if (vertexFormat.normal) {\n            CorridorGeometryLibrary.addAttribute(normals, normal, front, back);\n        }\n        if (vertexFormat.tangent) {\n            CorridorGeometryLibrary.addAttribute(tangents, forward, front, back);\n        }\n        if (vertexFormat.bitangent) {\n            CorridorGeometryLibrary.addAttribute(bitangents, left, front, back);\n        }\n    }\n\n    function combine(computedPositions, vertexFormat, ellipsoid) {\n        var positions = computedPositions.positions;\n        var corners = computedPositions.corners;\n        var endPositions = computedPositions.endPositions;\n        var computedLefts = computedPositions.lefts;\n        var computedNormals = computedPositions.normals;\n        var attributes = new GeometryAttributes();\n        var corner;\n        var leftCount = 0;\n        var rightCount = 0;\n        var i;\n        var indicesLength = 0;\n        var length;\n        for (i = 0; i < positions.length; i += 2) {\n            length = positions[i].length - 3;\n            leftCount += length; //subtracting 3 to account for duplicate points at corners\n            indicesLength += length*2;\n            rightCount += positions[i + 1].length - 3;\n        }\n        leftCount += 3; //add back count for end positions\n        rightCount += 3;\n        for (i = 0; i < corners.length; i++) {\n            corner = corners[i];\n            var leftSide = corners[i].leftPositions;\n            if (defined(leftSide)) {\n                length = leftSide.length;\n                leftCount += length;\n                indicesLength += length;\n            } else {\n                length = corners[i].rightPositions.length;\n                rightCount += length;\n                indicesLength += length;\n            }\n        }\n\n        var addEndPositions = defined(endPositions);\n        var endPositionLength;\n        if (addEndPositions) {\n            endPositionLength = endPositions[0].length - 3;\n            leftCount += endPositionLength;\n            rightCount += endPositionLength;\n            endPositionLength /= 3;\n            indicesLength += endPositionLength * 6;\n        }\n        var size = leftCount + rightCount;\n        var finalPositions = new Float64Array(size);\n        var normals = (vertexFormat.normal) ? new Float32Array(size) : undefined;\n        var tangents = (vertexFormat.tangent) ? new Float32Array(size) : undefined;\n        var bitangents = (vertexFormat.bitangent) ? new Float32Array(size) : undefined;\n        var attr = {\n            normals : normals,\n            tangents : tangents,\n            bitangents : bitangents\n        };\n        var front = 0;\n        var back = size - 1;\n        var UL, LL, UR, LR;\n        var normal = cartesian1;\n        var left = cartesian2;\n        var rightPos, leftPos;\n        var halfLength = endPositionLength / 2;\n\n        var indices = IndexDatatype.createTypedArray(size / 3, indicesLength);\n        var index = 0;\n        if (addEndPositions) { // add rounded end\n            leftPos = cartesian3;\n            rightPos = cartesian4;\n            var firstEndPositions = endPositions[0];\n            normal = Cartesian3.fromArray(computedNormals, 0, normal);\n            left = Cartesian3.fromArray(computedLefts, 0, left);\n            for (i = 0; i < halfLength; i++) {\n                leftPos = Cartesian3.fromArray(firstEndPositions, (halfLength - 1 - i) * 3, leftPos);\n                rightPos = Cartesian3.fromArray(firstEndPositions, (halfLength + i) * 3, rightPos);\n                CorridorGeometryLibrary.addAttribute(finalPositions, rightPos, front);\n                CorridorGeometryLibrary.addAttribute(finalPositions, leftPos, undefined, back);\n                addNormals(attr, normal, left, front, back, vertexFormat);\n\n                LL = front / 3;\n                LR = LL + 1;\n                UL = (back - 2) / 3;\n                UR = UL - 1;\n                indices[index++] = UL;\n                indices[index++] = LL;\n                indices[index++] = UR;\n                indices[index++] = UR;\n                indices[index++] = LL;\n                indices[index++] = LR;\n\n                front += 3;\n                back -= 3;\n            }\n        }\n\n        var posIndex = 0;\n        var compIndex = 0;\n        var rightEdge = positions[posIndex++]; //add first two edges\n        var leftEdge = positions[posIndex++];\n        finalPositions.set(rightEdge, front);\n        finalPositions.set(leftEdge, back - leftEdge.length + 1);\n\n        left = Cartesian3.fromArray(computedLefts, compIndex, left);\n        var rightNormal;\n        var leftNormal;\n        length = leftEdge.length - 3;\n        for (i = 0; i < length; i += 3) {\n            rightNormal = ellipsoid.geodeticSurfaceNormal(Cartesian3.fromArray(rightEdge, i, scratch1), scratch1);\n            leftNormal = ellipsoid.geodeticSurfaceNormal(Cartesian3.fromArray(leftEdge, length - i, scratch2), scratch2);\n            normal = Cartesian3.normalize(Cartesian3.add(rightNormal, leftNormal, normal), normal);\n            addNormals(attr, normal, left, front, back, vertexFormat);\n\n            LL = front / 3;\n            LR = LL + 1;\n            UL = (back - 2) / 3;\n            UR = UL - 1;\n            indices[index++] = UL;\n            indices[index++] = LL;\n            indices[index++] = UR;\n            indices[index++] = UR;\n            indices[index++] = LL;\n            indices[index++] = LR;\n\n            front += 3;\n            back -= 3;\n        }\n\n        rightNormal = ellipsoid.geodeticSurfaceNormal(Cartesian3.fromArray(rightEdge, length, scratch1), scratch1);\n        leftNormal = ellipsoid.geodeticSurfaceNormal(Cartesian3.fromArray(leftEdge, length, scratch2), scratch2);\n        normal = Cartesian3.normalize(Cartesian3.add(rightNormal, leftNormal, normal), normal);\n        compIndex += 3;\n        for (i = 0; i < corners.length; i++) {\n            var j;\n            corner = corners[i];\n            var l = corner.leftPositions;\n            var r = corner.rightPositions;\n            var pivot;\n            var start;\n            var outsidePoint = cartesian6;\n            var previousPoint = cartesian3;\n            var nextPoint = cartesian4;\n            normal = Cartesian3.fromArray(computedNormals, compIndex, normal);\n            if (defined(l)) {\n                addNormals(attr, normal, left, undefined, back, vertexFormat);\n                back -= 3;\n                pivot = LR;\n                start = UR;\n                for (j = 0; j < l.length / 3; j++) {\n                    outsidePoint = Cartesian3.fromArray(l, j * 3, outsidePoint);\n                    indices[index++] = pivot;\n                    indices[index++] = start - j - 1;\n                    indices[index++] = start - j;\n                    CorridorGeometryLibrary.addAttribute(finalPositions, outsidePoint, undefined, back);\n                    previousPoint = Cartesian3.fromArray(finalPositions, (start - j - 1) * 3, previousPoint);\n                    nextPoint = Cartesian3.fromArray(finalPositions, pivot * 3, nextPoint);\n                    left = Cartesian3.normalize(Cartesian3.subtract(previousPoint, nextPoint, left), left);\n                    addNormals(attr, normal, left, undefined, back, vertexFormat);\n                    back -= 3;\n                }\n                outsidePoint = Cartesian3.fromArray(finalPositions, pivot * 3, outsidePoint);\n                previousPoint = Cartesian3.subtract(Cartesian3.fromArray(finalPositions, (start) * 3, previousPoint), outsidePoint, previousPoint);\n                nextPoint = Cartesian3.subtract(Cartesian3.fromArray(finalPositions, (start - j) * 3, nextPoint), outsidePoint, nextPoint);\n                left = Cartesian3.normalize(Cartesian3.add(previousPoint, nextPoint, left), left);\n                addNormals(attr, normal, left, front, undefined, vertexFormat);\n                front += 3;\n            } else {\n                addNormals(attr, normal, left, front, undefined, vertexFormat);\n                front += 3;\n                pivot = UR;\n                start = LR;\n                for (j = 0; j < r.length / 3; j++) {\n                    outsidePoint = Cartesian3.fromArray(r, j * 3, outsidePoint);\n                    indices[index++] = pivot;\n                    indices[index++] = start + j;\n                    indices[index++] = start + j + 1;\n                    CorridorGeometryLibrary.addAttribute(finalPositions, outsidePoint, front);\n                    previousPoint = Cartesian3.fromArray(finalPositions, pivot * 3, previousPoint);\n                    nextPoint = Cartesian3.fromArray(finalPositions, (start + j) * 3, nextPoint);\n                    left = Cartesian3.normalize(Cartesian3.subtract(previousPoint, nextPoint, left), left);\n                    addNormals(attr, normal, left, front, undefined, vertexFormat);\n                    front += 3;\n                }\n                outsidePoint = Cartesian3.fromArray(finalPositions, pivot * 3, outsidePoint);\n                previousPoint = Cartesian3.subtract(Cartesian3.fromArray(finalPositions, (start + j) * 3, previousPoint), outsidePoint, previousPoint);\n                nextPoint = Cartesian3.subtract(Cartesian3.fromArray(finalPositions, start * 3, nextPoint), outsidePoint, nextPoint);\n                left = Cartesian3.normalize(Cartesian3.negate(Cartesian3.add(nextPoint, previousPoint, left), left), left);\n                addNormals(attr, normal, left, undefined, back, vertexFormat);\n                back -= 3;\n            }\n            rightEdge = positions[posIndex++];\n            leftEdge = positions[posIndex++];\n            rightEdge.splice(0, 3); //remove duplicate points added by corner\n            leftEdge.splice(leftEdge.length - 3, 3);\n            finalPositions.set(rightEdge, front);\n            finalPositions.set(leftEdge, back - leftEdge.length + 1);\n            length = leftEdge.length - 3;\n\n            compIndex += 3;\n            left = Cartesian3.fromArray(computedLefts, compIndex, left);\n            for (j = 0; j < leftEdge.length; j += 3) {\n                rightNormal = ellipsoid.geodeticSurfaceNormal(Cartesian3.fromArray(rightEdge, j, scratch1), scratch1);\n                leftNormal = ellipsoid.geodeticSurfaceNormal(Cartesian3.fromArray(leftEdge, length - j, scratch2), scratch2);\n                normal = Cartesian3.normalize(Cartesian3.add(rightNormal, leftNormal, normal), normal);\n                addNormals(attr, normal, left, front, back, vertexFormat);\n\n                LR = front / 3;\n                LL = LR - 1;\n                UR = (back - 2) / 3;\n                UL = UR + 1;\n                indices[index++] = UL;\n                indices[index++] = LL;\n                indices[index++] = UR;\n                indices[index++] = UR;\n                indices[index++] = LL;\n                indices[index++] = LR;\n\n                front += 3;\n                back -= 3;\n            }\n            front -= 3;\n            back += 3;\n        }\n        normal = Cartesian3.fromArray(computedNormals, computedNormals.length - 3, normal);\n        addNormals(attr, normal, left, front, back, vertexFormat);\n\n        if (addEndPositions) { // add rounded end\n            front += 3;\n            back -= 3;\n            leftPos = cartesian3;\n            rightPos = cartesian4;\n            var lastEndPositions = endPositions[1];\n            for (i = 0; i < halfLength; i++) {\n                leftPos = Cartesian3.fromArray(lastEndPositions, (endPositionLength - i - 1) * 3, leftPos);\n                rightPos = Cartesian3.fromArray(lastEndPositions, i * 3, rightPos);\n                CorridorGeometryLibrary.addAttribute(finalPositions, leftPos, undefined, back);\n                CorridorGeometryLibrary.addAttribute(finalPositions, rightPos, front);\n                addNormals(attr, normal, left, front, back, vertexFormat);\n\n                LR = front / 3;\n                LL = LR - 1;\n                UR = (back - 2) / 3;\n                UL = UR + 1;\n                indices[index++] = UL;\n                indices[index++] = LL;\n                indices[index++] = UR;\n                indices[index++] = UR;\n                indices[index++] = LL;\n                indices[index++] = LR;\n\n                front += 3;\n                back -= 3;\n            }\n        }\n\n        attributes.position = new GeometryAttribute({\n            componentDatatype : ComponentDatatype.DOUBLE,\n            componentsPerAttribute : 3,\n            values : finalPositions\n        });\n\n        if (vertexFormat.st) {\n            var st = new Float32Array(size / 3 * 2);\n            var rightSt;\n            var leftSt;\n            var stIndex = 0;\n            if (addEndPositions) {\n                leftCount /= 3;\n                rightCount /= 3;\n                var theta = Math.PI / (endPositionLength + 1);\n                leftSt = 1 / (leftCount - endPositionLength + 1);\n                rightSt = 1 / (rightCount - endPositionLength + 1);\n                var a;\n                var halfEndPos = endPositionLength / 2;\n                for (i = halfEndPos + 1; i < endPositionLength + 1; i++) { // lower left rounded end\n                    a = CesiumMath.PI_OVER_TWO + theta * i;\n                    st[stIndex++] = rightSt * (1 + Math.cos(a));\n                    st[stIndex++] = 0.5 * (1 + Math.sin(a));\n                }\n                for (i = 1; i < rightCount - endPositionLength + 1; i++) { // bottom edge\n                    st[stIndex++] = i * rightSt;\n                    st[stIndex++] = 0;\n                }\n                for (i = endPositionLength; i > halfEndPos; i--) { // lower right rounded end\n                    a = CesiumMath.PI_OVER_TWO - i * theta;\n                    st[stIndex++] = 1 - rightSt * (1 + Math.cos(a));\n                    st[stIndex++] = 0.5 * (1 + Math.sin(a));\n                }\n                for (i = halfEndPos; i > 0; i--) { // upper right rounded end\n                    a = CesiumMath.PI_OVER_TWO - theta * i;\n                    st[stIndex++] = 1 - leftSt * (1 + Math.cos(a));\n                    st[stIndex++] = 0.5 * (1 + Math.sin(a));\n                }\n                for (i = leftCount - endPositionLength; i > 0; i--) { // top edge\n                    st[stIndex++] = i * leftSt;\n                    st[stIndex++] = 1;\n                }\n                for (i = 1; i < halfEndPos + 1; i++) { // upper left rounded end\n                    a = CesiumMath.PI_OVER_TWO + theta * i;\n                    st[stIndex++] = leftSt * (1 + Math.cos(a));\n                    st[stIndex++] = 0.5 * (1 + Math.sin(a));\n                }\n            } else {\n                leftCount /= 3;\n                rightCount /= 3;\n                leftSt = 1 / (leftCount - 1);\n                rightSt = 1 / (rightCount - 1);\n                for (i = 0; i < rightCount; i++) { // bottom edge\n                    st[stIndex++] = i * rightSt;\n                    st[stIndex++] = 0;\n                }\n                for (i = leftCount; i > 0; i--) { // top edge\n                    st[stIndex++] = (i - 1) * leftSt;\n                    st[stIndex++] = 1;\n                }\n            }\n\n            attributes.st = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 2,\n                values : st\n            });\n        }\n\n        if (vertexFormat.normal) {\n            attributes.normal = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : attr.normals\n            });\n        }\n\n        if (vertexFormat.tangent) {\n            attributes.tangent = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : attr.tangents\n            });\n        }\n\n        if (vertexFormat.bitangent) {\n            attributes.bitangent = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : attr.bitangents\n            });\n        }\n\n        return {\n            attributes : attributes,\n            indices : indices\n        };\n    }\n\n    function extrudedAttributes(attributes, vertexFormat) {\n        if (!vertexFormat.normal && !vertexFormat.tangent && !vertexFormat.bitangent && !vertexFormat.st) {\n            return attributes;\n        }\n        var positions = attributes.position.values;\n        var topNormals;\n        var topBitangents;\n        if (vertexFormat.normal || vertexFormat.bitangent) {\n            topNormals = attributes.normal.values;\n            topBitangents = attributes.bitangent.values;\n        }\n        var size = attributes.position.values.length / 18;\n        var threeSize = size * 3;\n        var twoSize = size * 2;\n        var sixSize = threeSize * 2;\n        var i;\n        if (vertexFormat.normal || vertexFormat.bitangent || vertexFormat.tangent) {\n            var normals = (vertexFormat.normal) ? new Float32Array(threeSize * 6) : undefined;\n            var tangents = (vertexFormat.tangent) ? new Float32Array(threeSize * 6) : undefined;\n            var bitangents = (vertexFormat.bitangent) ? new Float32Array(threeSize * 6) : undefined;\n            var topPosition = cartesian1;\n            var bottomPosition = cartesian2;\n            var previousPosition = cartesian3;\n            var normal = cartesian4;\n            var tangent = cartesian5;\n            var bitangent = cartesian6;\n            var attrIndex = sixSize;\n            for (i = 0; i < threeSize; i += 3) {\n                var attrIndexOffset = attrIndex + sixSize;\n                topPosition      = Cartesian3.fromArray(positions, i, topPosition);\n                bottomPosition   = Cartesian3.fromArray(positions, i + threeSize, bottomPosition);\n                previousPosition = Cartesian3.fromArray(positions, (i + 3) % threeSize, previousPosition);\n                bottomPosition   = Cartesian3.subtract(bottomPosition,   topPosition, bottomPosition);\n                previousPosition = Cartesian3.subtract(previousPosition, topPosition, previousPosition);\n                normal = Cartesian3.normalize(Cartesian3.cross(bottomPosition, previousPosition, normal), normal);\n                if (vertexFormat.normal) {\n                    CorridorGeometryLibrary.addAttribute(normals, normal, attrIndexOffset);\n                    CorridorGeometryLibrary.addAttribute(normals, normal, attrIndexOffset + 3);\n                    CorridorGeometryLibrary.addAttribute(normals, normal, attrIndex);\n                    CorridorGeometryLibrary.addAttribute(normals, normal, attrIndex + 3);\n                }\n                if (vertexFormat.tangent || vertexFormat.bitangent) {\n                    bitangent = Cartesian3.fromArray(topNormals, i, bitangent);\n                    if (vertexFormat.bitangent) {\n                        CorridorGeometryLibrary.addAttribute(bitangents, bitangent, attrIndexOffset);\n                        CorridorGeometryLibrary.addAttribute(bitangents, bitangent, attrIndexOffset + 3);\n                        CorridorGeometryLibrary.addAttribute(bitangents, bitangent, attrIndex);\n                        CorridorGeometryLibrary.addAttribute(bitangents, bitangent, attrIndex + 3);\n                    }\n\n                    if (vertexFormat.tangent) {\n                        tangent = Cartesian3.normalize(Cartesian3.cross(bitangent, normal, tangent), tangent);\n                        CorridorGeometryLibrary.addAttribute(tangents, tangent, attrIndexOffset);\n                        CorridorGeometryLibrary.addAttribute(tangents, tangent, attrIndexOffset + 3);\n                        CorridorGeometryLibrary.addAttribute(tangents, tangent, attrIndex);\n                        CorridorGeometryLibrary.addAttribute(tangents, tangent, attrIndex + 3);\n                    }\n                }\n                attrIndex += 6;\n            }\n\n            if (vertexFormat.normal) {\n                normals.set(topNormals); //top\n                for (i = 0; i < threeSize; i += 3) { //bottom normals\n                    normals[i + threeSize] = -topNormals[i];\n                    normals[i + threeSize + 1] = -topNormals[i + 1];\n                    normals[i + threeSize + 2] = -topNormals[i + 2];\n                }\n                attributes.normal.values = normals;\n            } else {\n                attributes.normal = undefined;\n            }\n\n            if (vertexFormat.bitangent) {\n                bitangents.set(topBitangents); //top\n                bitangents.set(topBitangents, threeSize); //bottom\n                attributes.bitangent.values = bitangents;\n            } else {\n                attributes.bitangent = undefined;\n            }\n\n            if (vertexFormat.tangent) {\n                var topTangents = attributes.tangent.values;\n                tangents.set(topTangents); //top\n                tangents.set(topTangents, threeSize); //bottom\n                attributes.tangent.values = tangents;\n            }\n        }\n        if (vertexFormat.st) {\n            var topSt = attributes.st.values;\n            var st = new Float32Array(twoSize * 6);\n            st.set(topSt); //top\n            st.set(topSt, twoSize); //bottom\n            var index = twoSize * 2;\n\n            for ( var j = 0; j < 2; j++) {\n                st[index++] = topSt[0];\n                st[index++] = topSt[1];\n                for (i = 2; i < twoSize; i += 2) {\n                    var s = topSt[i];\n                    var t = topSt[i + 1];\n                    st[index++] = s;\n                    st[index++] = t;\n                    st[index++] = s;\n                    st[index++] = t;\n                }\n                st[index++] = topSt[0];\n                st[index++] = topSt[1];\n            }\n            attributes.st.values = st;\n        }\n\n        return attributes;\n    }\n\n    function addWallPositions(positions, index, wallPositions) {\n        wallPositions[index++] = positions[0];\n        wallPositions[index++] = positions[1];\n        wallPositions[index++] = positions[2];\n        for ( var i = 3; i < positions.length; i += 3) {\n            var x = positions[i];\n            var y = positions[i + 1];\n            var z = positions[i + 2];\n            wallPositions[index++] = x;\n            wallPositions[index++] = y;\n            wallPositions[index++] = z;\n            wallPositions[index++] = x;\n            wallPositions[index++] = y;\n            wallPositions[index++] = z;\n        }\n        wallPositions[index++] = positions[0];\n        wallPositions[index++] = positions[1];\n        wallPositions[index++] = positions[2];\n\n        return wallPositions;\n    }\n\n    function computePositionsExtruded(params, vertexFormat) {\n        var topVertexFormat = new VertexFormat({\n            position : vertexFormat.position,\n            normal : (vertexFormat.normal || vertexFormat.bitangent || params.shadowVolume),\n            tangent : vertexFormat.tangent,\n            bitangent : (vertexFormat.normal || vertexFormat.bitangent),\n            st : vertexFormat.st\n        });\n        var ellipsoid = params.ellipsoid;\n        var computedPositions = CorridorGeometryLibrary.computePositions(params);\n        var attr = combine(computedPositions, topVertexFormat, ellipsoid);\n        var height = params.height;\n        var extrudedHeight = params.extrudedHeight;\n        var attributes = attr.attributes;\n        var indices = attr.indices;\n        var positions = attributes.position.values;\n        var length = positions.length;\n        var newPositions = new Float64Array(length * 6);\n        var extrudedPositions = new Float64Array(length);\n        extrudedPositions.set(positions);\n        var wallPositions = new Float64Array(length * 4);\n\n        positions = PolygonPipeline.scaleToGeodeticHeight(positions, height, ellipsoid);\n        wallPositions = addWallPositions(positions, 0, wallPositions);\n        extrudedPositions = PolygonPipeline.scaleToGeodeticHeight(extrudedPositions, extrudedHeight, ellipsoid);\n        wallPositions = addWallPositions(extrudedPositions, length * 2, wallPositions);\n        newPositions.set(positions);\n        newPositions.set(extrudedPositions, length);\n        newPositions.set(wallPositions, length * 2);\n        attributes.position.values = newPositions;\n\n        attributes = extrudedAttributes(attributes, vertexFormat);\n        var i;\n        var size = length / 3;\n        if (params.shadowVolume) {\n            var topNormals = attributes.normal.values;\n            length = topNormals.length;\n\n            var extrudeNormals = new Float32Array(length * 6);\n            for (i = 0; i < length; i ++) {\n                topNormals[i] = -topNormals[i];\n            }\n            //only get normals for bottom layer that's going to be pushed down\n            extrudeNormals.set(topNormals, length); //bottom face\n            extrudeNormals = addWallPositions(topNormals, length*4, extrudeNormals); //bottom wall\n            attributes.extrudeDirection = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : extrudeNormals\n            });\n            if (!vertexFormat.normal) {\n                attributes.normal = undefined;\n            }\n        }\n        if (defined(params.offsetAttribute)) {\n            var applyOffset = new Uint8Array(size * 6);\n            if (params.offsetAttribute === GeometryOffsetAttribute.TOP) {\n                applyOffset = arrayFill(applyOffset, 1, 0, size); // top face\n                applyOffset = arrayFill(applyOffset, 1, size*2, size * 4); // top wall\n            } else {\n                var applyOffsetValue = params.offsetAttribute === GeometryOffsetAttribute.NONE ? 0 : 1;\n                applyOffset = arrayFill(applyOffset, applyOffsetValue);\n            }\n            attributes.applyOffset = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                componentsPerAttribute : 1,\n                values: applyOffset\n            });\n        }\n\n        var iLength = indices.length;\n        var twoSize = size + size;\n        var newIndices = IndexDatatype.createTypedArray(newPositions.length / 3, iLength * 2 + twoSize * 3);\n        newIndices.set(indices);\n        var index = iLength;\n        for (i = 0; i < iLength; i += 3) { // bottom indices\n            var v0 = indices[i];\n            var v1 = indices[i + 1];\n            var v2 = indices[i + 2];\n            newIndices[index++] = v2 + size;\n            newIndices[index++] = v1 + size;\n            newIndices[index++] = v0 + size;\n        }\n\n        var UL, LL, UR, LR;\n\n        for (i = 0; i < twoSize; i += 2) { //wall indices\n            UL = i + twoSize;\n            LL = UL + twoSize;\n            UR = UL + 1;\n            LR = LL + 1;\n            newIndices[index++] = UL;\n            newIndices[index++] = LL;\n            newIndices[index++] = UR;\n            newIndices[index++] = UR;\n            newIndices[index++] = LL;\n            newIndices[index++] = LR;\n        }\n\n        return {\n            attributes : attributes,\n            indices : newIndices\n        };\n    }\n\n    var scratchCartesian1 = new Cartesian3();\n    var scratchCartesian2 = new Cartesian3();\n    var scratchCartographic = new Cartographic();\n\n    function computeOffsetPoints(position1, position2, ellipsoid, halfWidth, min, max) {\n        // Compute direction of offset the point\n        var direction = Cartesian3.subtract(position2, position1, scratchCartesian1);\n        Cartesian3.normalize(direction, direction);\n        var normal = ellipsoid.geodeticSurfaceNormal(position1, scratchCartesian2);\n        var offsetDirection = Cartesian3.cross(direction, normal, scratchCartesian1);\n        Cartesian3.multiplyByScalar(offsetDirection, halfWidth, offsetDirection);\n\n        var minLat = min.latitude;\n        var minLon = min.longitude;\n        var maxLat = max.latitude;\n        var maxLon = max.longitude;\n\n        // Compute 2 offset points\n        Cartesian3.add(position1, offsetDirection, scratchCartesian2);\n        ellipsoid.cartesianToCartographic(scratchCartesian2, scratchCartographic);\n\n        var lat = scratchCartographic.latitude;\n        var lon = scratchCartographic.longitude;\n        minLat = Math.min(minLat, lat);\n        minLon = Math.min(minLon, lon);\n        maxLat = Math.max(maxLat, lat);\n        maxLon = Math.max(maxLon, lon);\n\n        Cartesian3.subtract(position1, offsetDirection, scratchCartesian2);\n        ellipsoid.cartesianToCartographic(scratchCartesian2, scratchCartographic);\n\n        lat = scratchCartographic.latitude;\n        lon = scratchCartographic.longitude;\n        minLat = Math.min(minLat, lat);\n        minLon = Math.min(minLon, lon);\n        maxLat = Math.max(maxLat, lat);\n        maxLon = Math.max(maxLon, lon);\n\n        min.latitude = minLat;\n        min.longitude = minLon;\n        max.latitude = maxLat;\n        max.longitude = maxLon;\n    }\n\n    var scratchCartesianOffset = new Cartesian3();\n    var scratchCartesianEnds = new Cartesian3();\n    var scratchCartographicMin = new Cartographic();\n    var scratchCartographicMax = new Cartographic();\n\n    function computeRectangle(positions, ellipsoid, width, cornerType, result) {\n        positions = scaleToSurface(positions, ellipsoid);\n        var cleanPositions = arrayRemoveDuplicates(positions, Cartesian3.equalsEpsilon);\n        var length = cleanPositions.length;\n        if (length < 2 || width <= 0) {\n            return new Rectangle();\n        }\n        var halfWidth = width * 0.5;\n\n        scratchCartographicMin.latitude = Number.POSITIVE_INFINITY;\n        scratchCartographicMin.longitude = Number.POSITIVE_INFINITY;\n        scratchCartographicMax.latitude = Number.NEGATIVE_INFINITY;\n        scratchCartographicMax.longitude = Number.NEGATIVE_INFINITY;\n\n        var lat, lon;\n        if (cornerType === CornerType.ROUNDED) {\n            // Compute start cap\n            var first = cleanPositions[0];\n            Cartesian3.subtract(first, cleanPositions[1], scratchCartesianOffset);\n            Cartesian3.normalize(scratchCartesianOffset, scratchCartesianOffset);\n            Cartesian3.multiplyByScalar(scratchCartesianOffset, halfWidth, scratchCartesianOffset);\n            Cartesian3.add(first, scratchCartesianOffset, scratchCartesianEnds);\n\n            ellipsoid.cartesianToCartographic(scratchCartesianEnds, scratchCartographic);\n            lat = scratchCartographic.latitude;\n            lon = scratchCartographic.longitude;\n            scratchCartographicMin.latitude = Math.min(scratchCartographicMin.latitude, lat);\n            scratchCartographicMin.longitude = Math.min(scratchCartographicMin.longitude, lon);\n            scratchCartographicMax.latitude = Math.max(scratchCartographicMax.latitude, lat);\n            scratchCartographicMax.longitude = Math.max(scratchCartographicMax.longitude, lon);\n        }\n\n        // Compute the rest\n        for (var i = 0; i < length-1; ++i) {\n            computeOffsetPoints(cleanPositions[i], cleanPositions[i+1], ellipsoid, halfWidth,\n                scratchCartographicMin, scratchCartographicMax);\n        }\n\n        // Compute ending point\n        var last = cleanPositions[length-1];\n        Cartesian3.subtract(last, cleanPositions[length-2], scratchCartesianOffset);\n        Cartesian3.normalize(scratchCartesianOffset, scratchCartesianOffset);\n        Cartesian3.multiplyByScalar(scratchCartesianOffset, halfWidth, scratchCartesianOffset);\n        Cartesian3.add(last, scratchCartesianOffset, scratchCartesianEnds);\n        computeOffsetPoints(last, scratchCartesianEnds, ellipsoid, halfWidth,\n            scratchCartographicMin, scratchCartographicMax);\n\n        if (cornerType === CornerType.ROUNDED) {\n            // Compute end cap\n            ellipsoid.cartesianToCartographic(scratchCartesianEnds, scratchCartographic);\n            lat = scratchCartographic.latitude;\n            lon = scratchCartographic.longitude;\n            scratchCartographicMin.latitude = Math.min(scratchCartographicMin.latitude, lat);\n            scratchCartographicMin.longitude = Math.min(scratchCartographicMin.longitude, lon);\n            scratchCartographicMax.latitude = Math.max(scratchCartographicMax.latitude, lat);\n            scratchCartographicMax.longitude = Math.max(scratchCartographicMax.longitude, lon);\n        }\n\n        var rectangle = defined(result) ? result : new Rectangle();\n        rectangle.north = scratchCartographicMax.latitude;\n        rectangle.south = scratchCartographicMin.latitude;\n        rectangle.east = scratchCartographicMax.longitude;\n        rectangle.west = scratchCartographicMin.longitude;\n\n        return rectangle;\n    }\n\n    /**\n     * A description of a corridor. Corridor geometry can be rendered with both {@link Primitive} and {@link GroundPrimitive}.\n     *\n     * @alias CorridorGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3[]} options.positions An array of positions that define the center of the corridor.\n     * @param {Number} options.width The distance between the edges of the corridor in meters.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid to be used as a reference.\n     * @param {Number} [options.granularity=CesiumMath.RADIANS_PER_DEGREE] The distance, in radians, between each latitude and longitude. Determines the number of positions in the buffer.\n     * @param {Number} [options.height=0] The distance in meters between the ellipsoid surface and the positions.\n     * @param {Number} [options.extrudedHeight] The distance in meters between the ellipsoid surface and the extruded face.\n     * @param {VertexFormat} [options.vertexFormat=VertexFormat.DEFAULT] The vertex attributes to be computed.\n     * @param {CornerType} [options.cornerType=CornerType.ROUNDED] Determines the style of the corners.\n     *\n     * @see CorridorGeometry.createGeometry\n     * @see Packable\n     *\n     * @demo {@link https://sandcastle.cesium.com/index.html?src=Corridor.html|Cesium Sandcastle Corridor Demo}\n     *\n     * @example\n     * var corridor = new Cesium.CorridorGeometry({\n     *   vertexFormat : Cesium.VertexFormat.POSITION_ONLY,\n     *   positions : Cesium.Cartesian3.fromDegreesArray([-72.0, 40.0, -70.0, 35.0]),\n     *   width : 100000\n     * });\n     */\n    function CorridorGeometry(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n        var positions = options.positions;\n        var width = options.width;\n\n        \n\n        var height = defaultValue(options.height, 0.0);\n        var extrudedHeight = defaultValue(options.extrudedHeight, height);\n\n        this._positions = positions;\n        this._ellipsoid = Ellipsoid.clone(defaultValue(options.ellipsoid, Ellipsoid.WGS84));\n        this._vertexFormat = VertexFormat.clone(defaultValue(options.vertexFormat, VertexFormat.DEFAULT));\n        this._width = width;\n        this._height = Math.max(height, extrudedHeight);\n        this._extrudedHeight = Math.min(height, extrudedHeight);\n        this._cornerType = defaultValue(options.cornerType, CornerType.ROUNDED);\n        this._granularity = defaultValue(options.granularity, CesiumMath.RADIANS_PER_DEGREE);\n        this._shadowVolume = defaultValue(options.shadowVolume, false);\n        this._workerName = 'createCorridorGeometry';\n        this._offsetAttribute = options.offsetAttribute;\n        this._rectangle = undefined;\n\n        /**\n         * The number of elements used to pack the object into an array.\n         * @type {Number}\n         */\n        this.packedLength = 1 + positions.length * Cartesian3.packedLength + Ellipsoid.packedLength + VertexFormat.packedLength + 7;\n    }\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {CorridorGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    CorridorGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var positions = value._positions;\n        var length = positions.length;\n        array[startingIndex++] = length;\n\n        for (var i = 0; i < length; ++i, startingIndex += Cartesian3.packedLength) {\n            Cartesian3.pack(positions[i], array, startingIndex);\n        }\n\n        Ellipsoid.pack(value._ellipsoid, array, startingIndex);\n        startingIndex += Ellipsoid.packedLength;\n\n        VertexFormat.pack(value._vertexFormat, array, startingIndex);\n        startingIndex += VertexFormat.packedLength;\n\n        array[startingIndex++] = value._width;\n        array[startingIndex++] = value._height;\n        array[startingIndex++] = value._extrudedHeight;\n        array[startingIndex++] = value._cornerType;\n        array[startingIndex++] = value._granularity;\n        array[startingIndex++] = value._shadowVolume ? 1.0 : 0.0;\n        array[startingIndex] = defaultValue(value._offsetAttribute, -1);\n\n        return array;\n    };\n\n    var scratchEllipsoid = Ellipsoid.clone(Ellipsoid.UNIT_SPHERE);\n    var scratchVertexFormat = new VertexFormat();\n    var scratchOptions = {\n        positions : undefined,\n        ellipsoid : scratchEllipsoid,\n        vertexFormat : scratchVertexFormat,\n        width : undefined,\n        height : undefined,\n        extrudedHeight : undefined,\n        cornerType : undefined,\n        granularity : undefined,\n        shadowVolume: undefined,\n        offsetAttribute: undefined\n    };\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {CorridorGeometry} [result] The object into which to store the result.\n     * @returns {CorridorGeometry} The modified result parameter or a new CorridorGeometry instance if one was not provided.\n     */\n    CorridorGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var length = array[startingIndex++];\n        var positions = new Array(length);\n\n        for (var i = 0; i < length; ++i, startingIndex += Cartesian3.packedLength) {\n            positions[i] = Cartesian3.unpack(array, startingIndex);\n        }\n\n        var ellipsoid = Ellipsoid.unpack(array, startingIndex, scratchEllipsoid);\n        startingIndex += Ellipsoid.packedLength;\n\n        var vertexFormat = VertexFormat.unpack(array, startingIndex, scratchVertexFormat);\n        startingIndex += VertexFormat.packedLength;\n\n        var width = array[startingIndex++];\n        var height = array[startingIndex++];\n        var extrudedHeight = array[startingIndex++];\n        var cornerType = array[startingIndex++];\n        var granularity = array[startingIndex++];\n        var shadowVolume = array[startingIndex++] === 1.0;\n        var offsetAttribute = array[startingIndex];\n\n        if (!defined(result)) {\n            scratchOptions.positions = positions;\n            scratchOptions.width = width;\n            scratchOptions.height = height;\n            scratchOptions.extrudedHeight = extrudedHeight;\n            scratchOptions.cornerType = cornerType;\n            scratchOptions.granularity = granularity;\n            scratchOptions.shadowVolume = shadowVolume;\n            scratchOptions.offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n\n            return new CorridorGeometry(scratchOptions);\n        }\n\n        result._positions = positions;\n        result._ellipsoid = Ellipsoid.clone(ellipsoid, result._ellipsoid);\n        result._vertexFormat = VertexFormat.clone(vertexFormat, result._vertexFormat);\n        result._width = width;\n        result._height = height;\n        result._extrudedHeight = extrudedHeight;\n        result._cornerType = cornerType;\n        result._granularity = granularity;\n        result._shadowVolume = shadowVolume;\n        result._offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n\n        return result;\n    };\n\n    /**\n     * Computes the bounding rectangle given the provided options\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3[]} options.positions An array of positions that define the center of the corridor.\n     * @param {Number} options.width The distance between the edges of the corridor in meters.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid to be used as a reference.\n     * @param {CornerType} [options.cornerType=CornerType.ROUNDED] Determines the style of the corners.\n     * @param {Rectangle} [result] An object in which to store the result.\n     *\n     * @returns {Rectangle} The result rectangle.\n     */\n    CorridorGeometry.computeRectangle = function(options, result) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n        var positions = options.positions;\n        var width = options.width;\n\n        \n\n        var ellipsoid = defaultValue(options.ellipsoid, Ellipsoid.WGS84);\n        var cornerType = defaultValue(options.cornerType, CornerType.ROUNDED);\n\n        return computeRectangle(positions, ellipsoid, width, cornerType, result);\n    };\n\n    /**\n     * Computes the geometric representation of a corridor, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {CorridorGeometry} corridorGeometry A description of the corridor.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    CorridorGeometry.createGeometry = function(corridorGeometry) {\n        var positions = corridorGeometry._positions;\n        var width = corridorGeometry._width;\n        var ellipsoid = corridorGeometry._ellipsoid;\n\n        positions = scaleToSurface(positions, ellipsoid);\n        var cleanPositions = arrayRemoveDuplicates(positions, Cartesian3.equalsEpsilon);\n\n        if ((cleanPositions.length < 2) || (width <= 0)) {\n            return;\n        }\n\n        var height = corridorGeometry._height;\n        var extrudedHeight = corridorGeometry._extrudedHeight;\n        var extrude = !CesiumMath.equalsEpsilon(height, extrudedHeight, 0, CesiumMath.EPSILON2);\n\n        var vertexFormat = corridorGeometry._vertexFormat;\n        var params = {\n            ellipsoid : ellipsoid,\n            positions : cleanPositions,\n            width : width,\n            cornerType : corridorGeometry._cornerType,\n            granularity : corridorGeometry._granularity,\n            saveAttributes: true\n        };\n        var attr;\n        if (extrude) {\n            params.height = height;\n            params.extrudedHeight = extrudedHeight;\n            params.shadowVolume = corridorGeometry._shadowVolume;\n            params.offsetAttribute = corridorGeometry._offsetAttribute;\n            attr = computePositionsExtruded(params, vertexFormat);\n        } else {\n            var computedPositions = CorridorGeometryLibrary.computePositions(params);\n            attr = combine(computedPositions, vertexFormat, ellipsoid);\n            attr.attributes.position.values = PolygonPipeline.scaleToGeodeticHeight(attr.attributes.position.values, height, ellipsoid);\n\n            if (defined(corridorGeometry._offsetAttribute)) {\n                var applyOffsetValue = corridorGeometry._offsetAttribute === GeometryOffsetAttribute.NONE ? 0 : 1;\n                var length = attr.attributes.position.values.length;\n                var applyOffset = new Uint8Array(length / 3);\n                arrayFill(applyOffset, applyOffsetValue);\n                attr.attributes.applyOffset = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                    componentsPerAttribute : 1,\n                    values: applyOffset\n                });\n            }\n        }\n        var attributes = attr.attributes;\n        var boundingSphere = BoundingSphere.fromVertices(attributes.position.values, undefined, 3);\n        if (!vertexFormat.position) {\n            attr.attributes.position.values = undefined;\n        }\n\n        return new Geometry({\n            attributes : attributes,\n            indices : attr.indices,\n            primitiveType : PrimitiveType.TRIANGLES,\n            boundingSphere : boundingSphere,\n            offsetAttribute : corridorGeometry._offsetAttribute\n        });\n    };\n\n    /**\n     * @private\n     */\n    CorridorGeometry.createShadowVolume = function(corridorGeometry, minHeightFunc, maxHeightFunc) {\n        var granularity = corridorGeometry._granularity;\n        var ellipsoid = corridorGeometry._ellipsoid;\n\n        var minHeight = minHeightFunc(granularity, ellipsoid);\n        var maxHeight = maxHeightFunc(granularity, ellipsoid);\n\n        return new CorridorGeometry({\n            positions : corridorGeometry._positions,\n            width : corridorGeometry._width,\n            cornerType : corridorGeometry._cornerType,\n            ellipsoid : ellipsoid,\n            granularity : granularity,\n            extrudedHeight : minHeight,\n            height : maxHeight,\n            vertexFormat : VertexFormat.POSITION_ONLY,\n            shadowVolume: true\n        });\n    };\n\n    Object.defineProperties(CorridorGeometry.prototype, {\n        /**\n         * @private\n         */\n        rectangle : {\n            get : function() {\n                if (!defined(this._rectangle)) {\n                    this._rectangle = computeRectangle(this._positions, this._ellipsoid, this._width, this._cornerType);\n                }\n                return this._rectangle;\n            }\n        },\n        /**\n         * For remapping texture coordinates when rendering CorridorGeometries as GroundPrimitives.\n         *\n         * Corridors don't support stRotation,\n         * so just return the corners of the original system.\n         * @private\n         */\n        textureCoordinateRotationPoints : {\n            get : function() {\n                return [0, 0, 0, 1, 1, 0];\n            }\n        }\n    });\nexport default CorridorGeometry;\n","import arrayFill from './arrayFill.js';\nimport arrayRemoveDuplicates from './arrayRemoveDuplicates.js';\nimport BoundingSphere from './BoundingSphere.js';\nimport Cartesian3 from './Cartesian3.js';\nimport Check from './Check.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport CornerType from './CornerType.js';\nimport CorridorGeometryLibrary from './CorridorGeometryLibrary.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport Ellipsoid from './Ellipsoid.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport GeometryOffsetAttribute from './GeometryOffsetAttribute.js';\nimport IndexDatatype from './IndexDatatype.js';\nimport CesiumMath from './Math.js';\nimport PolygonPipeline from './PolygonPipeline.js';\nimport PrimitiveType from './PrimitiveType.js';\n\n    var cartesian1 = new Cartesian3();\n    var cartesian2 = new Cartesian3();\n    var cartesian3 = new Cartesian3();\n\n    function scaleToSurface(positions, ellipsoid) {\n        for (var i = 0; i < positions.length; i++) {\n            positions[i] = ellipsoid.scaleToGeodeticSurface(positions[i], positions[i]);\n        }\n        return positions;\n    }\n\n    function combine(computedPositions, cornerType) {\n        var wallIndices = [];\n        var positions = computedPositions.positions;\n        var corners = computedPositions.corners;\n        var endPositions = computedPositions.endPositions;\n        var attributes = new GeometryAttributes();\n        var corner;\n        var leftCount = 0;\n        var rightCount = 0;\n        var i;\n        var indicesLength = 0;\n        var length;\n        for (i = 0; i < positions.length; i += 2) {\n            length = positions[i].length - 3;\n            leftCount += length; //subtracting 3 to account for duplicate points at corners\n            indicesLength += length / 3 * 4;\n            rightCount += positions[i + 1].length - 3;\n        }\n        leftCount += 3; //add back count for end positions\n        rightCount += 3;\n        for (i = 0; i < corners.length; i++) {\n            corner = corners[i];\n            var leftSide = corners[i].leftPositions;\n            if (defined(leftSide)) {\n                length = leftSide.length;\n                leftCount += length;\n                indicesLength += length / 3 * 2;\n            } else {\n                length = corners[i].rightPositions.length;\n                rightCount += length;\n                indicesLength += length / 3 * 2;\n            }\n        }\n\n        var addEndPositions = defined(endPositions);\n        var endPositionLength;\n        if (addEndPositions) {\n            endPositionLength = endPositions[0].length - 3;\n            leftCount += endPositionLength;\n            rightCount += endPositionLength;\n            endPositionLength /= 3;\n            indicesLength += endPositionLength * 4;\n        }\n        var size = leftCount + rightCount;\n        var finalPositions = new Float64Array(size);\n        var front = 0;\n        var back = size - 1;\n        var UL, LL, UR, LR;\n        var rightPos, leftPos;\n        var halfLength = endPositionLength / 2;\n\n        var indices = IndexDatatype.createTypedArray(size / 3, indicesLength + 4);\n        var index = 0;\n\n        indices[index++] = front / 3;\n        indices[index++] = (back - 2) / 3;\n        if (addEndPositions) { // add rounded end\n            wallIndices.push(front / 3);\n            leftPos = cartesian1;\n            rightPos = cartesian2;\n            var firstEndPositions = endPositions[0];\n            for (i = 0; i < halfLength; i++) {\n                leftPos = Cartesian3.fromArray(firstEndPositions, (halfLength - 1 - i) * 3, leftPos);\n                rightPos = Cartesian3.fromArray(firstEndPositions, (halfLength + i) * 3, rightPos);\n                CorridorGeometryLibrary.addAttribute(finalPositions, rightPos, front);\n                CorridorGeometryLibrary.addAttribute(finalPositions, leftPos, undefined, back);\n\n                LL = front / 3;\n                LR = LL + 1;\n                UL = (back - 2) / 3;\n                UR = UL - 1;\n                indices[index++] = UL;\n                indices[index++] = UR;\n                indices[index++] = LL;\n                indices[index++] = LR;\n\n                front += 3;\n                back -= 3;\n            }\n        }\n\n        var posIndex = 0;\n        var rightEdge = positions[posIndex++]; //add first two edges\n        var leftEdge = positions[posIndex++];\n        finalPositions.set(rightEdge, front);\n        finalPositions.set(leftEdge, back - leftEdge.length + 1);\n\n        length = leftEdge.length - 3;\n        wallIndices.push(front / 3, (back - 2) / 3);\n        for (i = 0; i < length; i += 3) {\n            LL = front / 3;\n            LR = LL + 1;\n            UL = (back - 2) / 3;\n            UR = UL - 1;\n            indices[index++] = UL;\n            indices[index++] = UR;\n            indices[index++] = LL;\n            indices[index++] = LR;\n\n            front += 3;\n            back -= 3;\n        }\n\n        for (i = 0; i < corners.length; i++) {\n            var j;\n            corner = corners[i];\n            var l = corner.leftPositions;\n            var r = corner.rightPositions;\n            var start;\n            var outsidePoint = cartesian3;\n            if (defined(l)) {\n                back -= 3;\n                start = UR;\n                wallIndices.push(LR);\n                for (j = 0; j < l.length / 3; j++) {\n                    outsidePoint = Cartesian3.fromArray(l, j * 3, outsidePoint);\n                    indices[index++] = start - j - 1;\n                    indices[index++] = start - j;\n                    CorridorGeometryLibrary.addAttribute(finalPositions, outsidePoint, undefined, back);\n                    back -= 3;\n                }\n                wallIndices.push(start - Math.floor(l.length / 6));\n                if (cornerType === CornerType.BEVELED) {\n                    wallIndices.push((back - 2) / 3 + 1);\n                }\n                front += 3;\n            } else {\n                front += 3;\n                start = LR;\n                wallIndices.push(UR);\n                for (j = 0; j < r.length / 3; j++) {\n                    outsidePoint = Cartesian3.fromArray(r, j * 3, outsidePoint);\n                    indices[index++] = start + j;\n                    indices[index++] = start + j + 1;\n                    CorridorGeometryLibrary.addAttribute(finalPositions, outsidePoint, front);\n                    front += 3;\n                }\n                wallIndices.push(start + Math.floor(r.length / 6));\n                if (cornerType === CornerType.BEVELED) {\n                    wallIndices.push(front / 3 - 1);\n                }\n                back -= 3;\n            }\n            rightEdge = positions[posIndex++];\n            leftEdge = positions[posIndex++];\n            rightEdge.splice(0, 3); //remove duplicate points added by corner\n            leftEdge.splice(leftEdge.length - 3, 3);\n            finalPositions.set(rightEdge, front);\n            finalPositions.set(leftEdge, back - leftEdge.length + 1);\n            length = leftEdge.length - 3;\n\n            for (j = 0; j < leftEdge.length; j += 3) {\n                LR = front / 3;\n                LL = LR - 1;\n                UR = (back - 2) / 3;\n                UL = UR + 1;\n                indices[index++] = UL;\n                indices[index++] = UR;\n                indices[index++] = LL;\n                indices[index++] = LR;\n                front += 3;\n                back -= 3;\n            }\n            front -= 3;\n            back += 3;\n            wallIndices.push(front / 3, (back - 2) / 3);\n        }\n\n        if (addEndPositions) { // add rounded end\n            front += 3;\n            back -= 3;\n            leftPos = cartesian1;\n            rightPos = cartesian2;\n            var lastEndPositions = endPositions[1];\n            for (i = 0; i < halfLength; i++) {\n                leftPos = Cartesian3.fromArray(lastEndPositions, (endPositionLength - i - 1) * 3, leftPos);\n                rightPos = Cartesian3.fromArray(lastEndPositions, i * 3, rightPos);\n                CorridorGeometryLibrary.addAttribute(finalPositions, leftPos, undefined, back);\n                CorridorGeometryLibrary.addAttribute(finalPositions, rightPos, front);\n\n                LR = front / 3;\n                LL = LR - 1;\n                UR = (back - 2) / 3;\n                UL = UR + 1;\n                indices[index++] = UL;\n                indices[index++] = UR;\n                indices[index++] = LL;\n                indices[index++] = LR;\n\n                front += 3;\n                back -= 3;\n            }\n\n            wallIndices.push(front / 3);\n        } else {\n            wallIndices.push(front / 3, (back - 2) / 3);\n        }\n        indices[index++] = front / 3;\n        indices[index++] = (back - 2) / 3;\n\n        attributes.position = new GeometryAttribute({\n            componentDatatype : ComponentDatatype.DOUBLE,\n            componentsPerAttribute : 3,\n            values : finalPositions\n        });\n\n        return {\n            attributes : attributes,\n            indices : indices,\n            wallIndices : wallIndices\n        };\n    }\n\n    function computePositionsExtruded(params) {\n        var ellipsoid = params.ellipsoid;\n        var computedPositions = CorridorGeometryLibrary.computePositions(params);\n        var attr = combine(computedPositions, params.cornerType);\n        var wallIndices = attr.wallIndices;\n        var height = params.height;\n        var extrudedHeight = params.extrudedHeight;\n        var attributes = attr.attributes;\n        var indices = attr.indices;\n        var positions = attributes.position.values;\n        var length = positions.length;\n        var extrudedPositions = new Float64Array(length);\n        extrudedPositions.set(positions);\n        var newPositions = new Float64Array(length * 2);\n\n        positions = PolygonPipeline.scaleToGeodeticHeight(positions, height, ellipsoid);\n        extrudedPositions = PolygonPipeline.scaleToGeodeticHeight(extrudedPositions, extrudedHeight, ellipsoid);\n        newPositions.set(positions);\n        newPositions.set(extrudedPositions, length);\n        attributes.position.values = newPositions;\n\n        length /= 3;\n        if (defined(params.offsetAttribute)) {\n            var applyOffset = new Uint8Array(length * 2);\n            if (params.offsetAttribute === GeometryOffsetAttribute.TOP) {\n                applyOffset = arrayFill(applyOffset, 1, 0, length);\n            } else {\n                var applyOffsetValue = params.offsetAttribute === GeometryOffsetAttribute.NONE ? 0 : 1;\n                applyOffset = arrayFill(applyOffset, applyOffsetValue);\n            }\n\n            attributes.applyOffset = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                componentsPerAttribute : 1,\n                values: applyOffset\n            });\n        }\n\n        var i;\n        var iLength = indices.length;\n        var newIndices = IndexDatatype.createTypedArray(newPositions.length / 3, (iLength + wallIndices.length) * 2);\n        newIndices.set(indices);\n        var index = iLength;\n        for (i = 0; i < iLength; i += 2) { // bottom indices\n            var v0 = indices[i];\n            var v1 = indices[i + 1];\n            newIndices[index++] = v0 + length;\n            newIndices[index++] = v1 + length;\n        }\n\n        var UL, LL;\n        for (i = 0; i < wallIndices.length; i++) { //wall indices\n            UL = wallIndices[i];\n            LL = UL + length;\n            newIndices[index++] = UL;\n            newIndices[index++] = LL;\n        }\n\n        return {\n            attributes : attributes,\n            indices : newIndices\n        };\n    }\n\n    /**\n     * A description of a corridor outline.\n     *\n     * @alias CorridorOutlineGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3[]} options.positions An array of positions that define the center of the corridor outline.\n     * @param {Number} options.width The distance between the edges of the corridor outline.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid to be used as a reference.\n     * @param {Number} [options.granularity=CesiumMath.RADIANS_PER_DEGREE] The distance, in radians, between each latitude and longitude. Determines the number of positions in the buffer.\n     * @param {Number} [options.height=0] The distance in meters between the positions and the ellipsoid surface.\n     * @param {Number} [options.extrudedHeight] The distance in meters between the extruded face and the ellipsoid surface.\n     * @param {CornerType} [options.cornerType=CornerType.ROUNDED] Determines the style of the corners.\n     *\n     * @see CorridorOutlineGeometry.createGeometry\n     *\n     * @example\n     * var corridor = new Cesium.CorridorOutlineGeometry({\n     *   positions : Cesium.Cartesian3.fromDegreesArray([-72.0, 40.0, -70.0, 35.0]),\n     *   width : 100000\n     * });\n     */\n    function CorridorOutlineGeometry(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n        var positions = options.positions;\n        var width = options.width;\n\n        \n\n        var height = defaultValue(options.height, 0.0);\n        var extrudedHeight = defaultValue(options.extrudedHeight, height);\n\n        this._positions = positions;\n        this._ellipsoid = Ellipsoid.clone(defaultValue(options.ellipsoid, Ellipsoid.WGS84));\n        this._width = width;\n        this._height = Math.max(height, extrudedHeight);\n        this._extrudedHeight = Math.min(height, extrudedHeight);\n        this._cornerType = defaultValue(options.cornerType, CornerType.ROUNDED);\n        this._granularity = defaultValue(options.granularity, CesiumMath.RADIANS_PER_DEGREE);\n        this._offsetAttribute = options.offsetAttribute;\n        this._workerName = 'createCorridorOutlineGeometry';\n\n        /**\n         * The number of elements used to pack the object into an array.\n         * @type {Number}\n         */\n        this.packedLength = 1 + positions.length * Cartesian3.packedLength + Ellipsoid.packedLength + 6;\n    }\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {CorridorOutlineGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    CorridorOutlineGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var positions = value._positions;\n        var length = positions.length;\n        array[startingIndex++] = length;\n\n        for (var i = 0; i < length; ++i, startingIndex += Cartesian3.packedLength) {\n            Cartesian3.pack(positions[i], array, startingIndex);\n        }\n\n        Ellipsoid.pack(value._ellipsoid, array, startingIndex);\n        startingIndex += Ellipsoid.packedLength;\n\n        array[startingIndex++] = value._width;\n        array[startingIndex++] = value._height;\n        array[startingIndex++] = value._extrudedHeight;\n        array[startingIndex++] = value._cornerType;\n        array[startingIndex++] = value._granularity;\n        array[startingIndex] = defaultValue(value._offsetAttribute, -1);\n\n        return array;\n    };\n\n    var scratchEllipsoid = Ellipsoid.clone(Ellipsoid.UNIT_SPHERE);\n    var scratchOptions = {\n        positions : undefined,\n        ellipsoid : scratchEllipsoid,\n        width : undefined,\n        height : undefined,\n        extrudedHeight : undefined,\n        cornerType : undefined,\n        granularity : undefined,\n        offsetAttribute: undefined\n    };\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {CorridorOutlineGeometry} [result] The object into which to store the result.\n     * @returns {CorridorOutlineGeometry} The modified result parameter or a new CorridorOutlineGeometry instance if one was not provided.\n     */\n    CorridorOutlineGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var length = array[startingIndex++];\n        var positions = new Array(length);\n\n        for (var i = 0; i < length; ++i, startingIndex += Cartesian3.packedLength) {\n            positions[i] = Cartesian3.unpack(array, startingIndex);\n        }\n\n        var ellipsoid = Ellipsoid.unpack(array, startingIndex, scratchEllipsoid);\n        startingIndex += Ellipsoid.packedLength;\n\n        var width = array[startingIndex++];\n        var height = array[startingIndex++];\n        var extrudedHeight = array[startingIndex++];\n        var cornerType = array[startingIndex++];\n        var granularity = array[startingIndex++];\n        var offsetAttribute = array[startingIndex];\n\n        if (!defined(result)) {\n            scratchOptions.positions = positions;\n            scratchOptions.width = width;\n            scratchOptions.height = height;\n            scratchOptions.extrudedHeight = extrudedHeight;\n            scratchOptions.cornerType = cornerType;\n            scratchOptions.granularity = granularity;\n            scratchOptions.offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n            return new CorridorOutlineGeometry(scratchOptions);\n        }\n\n        result._positions = positions;\n        result._ellipsoid = Ellipsoid.clone(ellipsoid, result._ellipsoid);\n        result._width = width;\n        result._height = height;\n        result._extrudedHeight = extrudedHeight;\n        result._cornerType = cornerType;\n        result._granularity = granularity;\n        result._offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n\n        return result;\n    };\n\n    /**\n     * Computes the geometric representation of a corridor, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {CorridorOutlineGeometry} corridorOutlineGeometry A description of the corridor.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    CorridorOutlineGeometry.createGeometry = function(corridorOutlineGeometry) {\n        var positions = corridorOutlineGeometry._positions;\n        var width = corridorOutlineGeometry._width;\n        var ellipsoid = corridorOutlineGeometry._ellipsoid;\n\n        positions = scaleToSurface(positions, ellipsoid);\n        var cleanPositions = arrayRemoveDuplicates(positions, Cartesian3.equalsEpsilon);\n\n        if ((cleanPositions.length < 2) || (width <= 0)) {\n            return;\n        }\n\n        var height = corridorOutlineGeometry._height;\n        var extrudedHeight = corridorOutlineGeometry._extrudedHeight;\n        var extrude = !CesiumMath.equalsEpsilon(height, extrudedHeight, 0, CesiumMath.EPSILON2);\n\n        var params = {\n            ellipsoid : ellipsoid,\n            positions : cleanPositions,\n            width : width,\n            cornerType : corridorOutlineGeometry._cornerType,\n            granularity : corridorOutlineGeometry._granularity,\n            saveAttributes : false\n        };\n        var attr;\n        if (extrude) {\n            params.height = height;\n            params.extrudedHeight = extrudedHeight;\n            params.offsetAttribute = corridorOutlineGeometry._offsetAttribute;\n            attr = computePositionsExtruded(params);\n        } else {\n            var computedPositions = CorridorGeometryLibrary.computePositions(params);\n            attr = combine(computedPositions, params.cornerType);\n            attr.attributes.position.values = PolygonPipeline.scaleToGeodeticHeight(attr.attributes.position.values, height, ellipsoid);\n\n            if (defined(corridorOutlineGeometry._offsetAttribute)) {\n                var length = attr.attributes.position.values.length;\n                var applyOffset = new Uint8Array(length / 3);\n                var offsetValue = corridorOutlineGeometry._offsetAttribute === GeometryOffsetAttribute.NONE ? 0 : 1;\n                arrayFill(applyOffset, offsetValue);\n                attr.attributes.applyOffset = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                    componentsPerAttribute : 1,\n                    values: applyOffset\n                });\n            }\n        }\n        var attributes = attr.attributes;\n        var boundingSphere = BoundingSphere.fromVertices(attributes.position.values, undefined, 3);\n\n        return new Geometry({\n            attributes : attributes,\n            indices : attr.indices,\n            primitiveType : PrimitiveType.LINES,\n            boundingSphere : boundingSphere,\n            offsetAttribute : corridorOutlineGeometry._offsetAttribute\n        });\n    };\nexport default CorridorOutlineGeometry;\n","import Check from '../Core/Check.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport GeometryOffsetAttribute from '../Core/GeometryOffsetAttribute.js';\nimport oneTimeWarning from '../Core/oneTimeWarning.js';\nimport GroundPrimitive from '../Scene/GroundPrimitive.js';\nimport HeightReference from '../Scene/HeightReference.js';\nimport CallbackProperty from './CallbackProperty.js';\nimport ConstantProperty from './ConstantProperty.js';\nimport GeometryUpdater from './GeometryUpdater.js';\nimport TerrainOffsetProperty from './TerrainOffsetProperty.js';\n\n    var defaultZIndex = new ConstantProperty(0);\n\n    /**\n     * An abstract class for updating ground geometry entities.\n     * @constructor\n     * @alias GroundGeometryUpdater\n     * @param {Object} options An object with the following properties:\n     * @param {Entity} options.entity The entity containing the geometry to be visualized.\n     * @param {Scene} options.scene The scene where visualization is taking place.\n     * @param {Object} options.geometryOptions Options for the geometry\n     * @param {String} options.geometryPropertyName The geometry property name\n     * @param {String[]} options.observedPropertyNames The entity properties this geometry cares about\n     */\n    function GroundGeometryUpdater(options) {\n        GeometryUpdater.call(this, options);\n\n        this._zIndex = 0;\n        this._terrainOffsetProperty = undefined;\n    }\n\n    if (defined(Object.create)) {\n        GroundGeometryUpdater.prototype = Object.create(GeometryUpdater.prototype);\n        GroundGeometryUpdater.prototype.constructor = GroundGeometryUpdater;\n    }\n\n    Object.defineProperties(GroundGeometryUpdater.prototype, {\n        /**\n         * Gets the zindex\n         * @type {Number}\n         * @memberof GroundGeometryUpdater.prototype\n         * @readonly\n         */\n        zIndex: {\n            get: function() {\n                return this._zIndex;\n            }\n        },\n\n        /**\n         * Gets the terrain offset property\n         * @type {TerrainOffsetProperty}\n         * @memberof GroundGeometryUpdater.prototype\n         * @readonly\n         */\n        terrainOffsetProperty: {\n            get: function() {\n                return this._terrainOffsetProperty;\n            }\n        }\n    });\n\n    GroundGeometryUpdater.prototype._isOnTerrain = function(entity, geometry) {\n        return this._fillEnabled && !defined(geometry.height) && !defined(geometry.extrudedHeight) && GroundPrimitive.isSupported(this._scene);\n    };\n\n    GroundGeometryUpdater.prototype._getIsClosed = function(options) {\n        var height = options.height;\n        var extrudedHeight = options.extrudedHeight;\n        return height === 0 || (defined(extrudedHeight) && extrudedHeight !== height);\n    };\n\n    GroundGeometryUpdater.prototype._computeCenter = DeveloperError.throwInstantiationError;\n\n    GroundGeometryUpdater.prototype._onEntityPropertyChanged = function(entity, propertyName, newValue, oldValue) {\n        GeometryUpdater.prototype._onEntityPropertyChanged.call(this, entity, propertyName, newValue, oldValue);\n        if (this._observedPropertyNames.indexOf(propertyName) === -1) {\n            return;\n        }\n\n        var geometry = this._entity[this._geometryPropertyName];\n        if (!defined(geometry)) {\n            return;\n        }\n        if (defined(geometry.zIndex) && (defined(geometry.height) || defined(geometry.extrudedHeight))) {\n            oneTimeWarning(oneTimeWarning.geometryZIndex);\n        }\n\n        this._zIndex = defaultValue(geometry.zIndex, defaultZIndex);\n\n        if (defined(this._terrainOffsetProperty)) {\n            this._terrainOffsetProperty.destroy();\n            this._terrainOffsetProperty = undefined;\n        }\n\n        var heightReferenceProperty = geometry.heightReference;\n        var extrudedHeightReferenceProperty = geometry.extrudedHeightReference;\n\n        if (defined(heightReferenceProperty) || defined(extrudedHeightReferenceProperty)) {\n            var centerPosition = new CallbackProperty(this._computeCenter.bind(this), !this._dynamic);\n            this._terrainOffsetProperty = new TerrainOffsetProperty(this._scene, centerPosition, heightReferenceProperty, extrudedHeightReferenceProperty);\n        }\n    };\n\n    /**\n     * Destroys and resources used by the object.  Once an object is destroyed, it should not be used.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     */\n    GroundGeometryUpdater.prototype.destroy = function() {\n        if (defined(this._terrainOffsetProperty)) {\n            this._terrainOffsetProperty.destroy();\n            this._terrainOffsetProperty = undefined;\n        }\n\n        GeometryUpdater.prototype.destroy.call(this);\n    };\n\n    /**\n     * @private\n     */\n    GroundGeometryUpdater.getGeometryHeight = function(height, heightReference) {\n        \n        if (!defined(height)) {\n            if (heightReference !== HeightReference.NONE) {\n                oneTimeWarning(oneTimeWarning.geometryHeightReference);\n            }\n            return;\n        }\n\n        if (heightReference !== HeightReference.CLAMP_TO_GROUND) {\n            return height;\n        }\n        return 0.0;\n    };\n\n    /**\n     * @private\n     */\n    GroundGeometryUpdater.getGeometryExtrudedHeight = function(extrudedHeight, extrudedHeightReference) {\n        \n        if (!defined(extrudedHeight)) {\n            if (extrudedHeightReference !== HeightReference.NONE) {\n                oneTimeWarning(oneTimeWarning.geometryExtrudedHeightReference);\n            }\n            return;\n        }\n        if (extrudedHeightReference !== HeightReference.CLAMP_TO_GROUND) {\n            return extrudedHeight;\n        }\n\n        return GroundGeometryUpdater.CLAMP_TO_GROUND;\n    };\n\n    /**\n     * @private\n     */\n    GroundGeometryUpdater.CLAMP_TO_GROUND = 'clamp';\n\n    /**\n     * @private\n     */\n    GroundGeometryUpdater.computeGeometryOffsetAttribute = function(height, heightReference, extrudedHeight, extrudedHeightReference) {\n        if (!defined(height) || !defined(heightReference)) {\n            heightReference = HeightReference.NONE;\n        }\n        if (!defined(extrudedHeight) || !defined(extrudedHeightReference)) {\n            extrudedHeightReference = HeightReference.NONE;\n        }\n        var n = 0;\n        if (heightReference !== HeightReference.NONE) {\n            n++;\n        }\n        if (extrudedHeightReference === HeightReference.RELATIVE_TO_GROUND) {\n            n++;\n        }\n        if (n === 2) {\n            return GeometryOffsetAttribute.ALL;\n        }\n        if (n === 1) {\n            return GeometryOffsetAttribute.TOP;\n        }\n\n        return undefined;\n    };\nexport default GroundGeometryUpdater;\n","import ApproximateTerrainHeights from '../Core/ApproximateTerrainHeights.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Check from '../Core/Check.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport CorridorGeometry from '../Core/CorridorGeometry.js';\nimport CorridorOutlineGeometry from '../Core/CorridorOutlineGeometry.js';\nimport defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport DistanceDisplayConditionGeometryInstanceAttribute from '../Core/DistanceDisplayConditionGeometryInstanceAttribute.js';\nimport GeometryInstance from '../Core/GeometryInstance.js';\nimport Iso8601 from '../Core/Iso8601.js';\nimport OffsetGeometryInstanceAttribute from '../Core/OffsetGeometryInstanceAttribute.js';\nimport Rectangle from '../Core/Rectangle.js';\nimport ShowGeometryInstanceAttribute from '../Core/ShowGeometryInstanceAttribute.js';\nimport HeightReference from '../Scene/HeightReference.js';\nimport MaterialAppearance from '../Scene/MaterialAppearance.js';\nimport PerInstanceColorAppearance from '../Scene/PerInstanceColorAppearance.js';\nimport ColorMaterialProperty from './ColorMaterialProperty.js';\nimport DynamicGeometryUpdater from './DynamicGeometryUpdater.js';\nimport GeometryUpdater from './GeometryUpdater.js';\nimport GroundGeometryUpdater from './GroundGeometryUpdater.js';\nimport Property from './Property.js';\n\n    var scratchColor = new Color();\n    var defaultOffset = Cartesian3.ZERO;\n    var offsetScratch = new Cartesian3();\n    var scratchRectangle = new Rectangle();\n\n    function CorridorGeometryOptions(entity) {\n        this.id = entity;\n        this.vertexFormat = undefined;\n        this.positions = undefined;\n        this.width = undefined;\n        this.cornerType = undefined;\n        this.height = undefined;\n        this.extrudedHeight = undefined;\n        this.granularity = undefined;\n        this.offsetAttribute = undefined;\n    }\n\n    /**\n     * A {@link GeometryUpdater} for corridors.\n     * Clients do not normally create this class directly, but instead rely on {@link DataSourceDisplay}.\n     * @alias CorridorGeometryUpdater\n     * @constructor\n     *\n     * @param {Entity} entity The entity containing the geometry to be visualized.\n     * @param {Scene} scene The scene where visualization is taking place.\n     */\n    function CorridorGeometryUpdater(entity, scene) {\n        GroundGeometryUpdater.call(this, {\n            entity : entity,\n            scene : scene,\n            geometryOptions : new CorridorGeometryOptions(entity),\n            geometryPropertyName : 'corridor',\n            observedPropertyNames : ['availability', 'corridor']\n        });\n\n        this._onEntityPropertyChanged(entity, 'corridor', entity.corridor, undefined);\n    }\n\n    if (defined(Object.create)) {\n        CorridorGeometryUpdater.prototype = Object.create(GroundGeometryUpdater.prototype);\n        CorridorGeometryUpdater.prototype.constructor = CorridorGeometryUpdater;\n    }\n\n    /**\n     * Creates the geometry instance which represents the fill of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the filled portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent a filled geometry.\n     */\n    CorridorGeometryUpdater.prototype.createFillGeometryInstance = function(time) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n\n        var attributes = {\n            show : new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._fillProperty.getValue(time)),\n            distanceDisplayCondition : DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(time)),\n            offset : undefined,\n            color : undefined\n        };\n\n        if (this._materialProperty instanceof ColorMaterialProperty) {\n            var currentColor;\n            if (defined(this._materialProperty.color) && (this._materialProperty.color.isConstant || isAvailable)) {\n                currentColor = this._materialProperty.color.getValue(time, scratchColor);\n            }\n            if (!defined(currentColor)) {\n                currentColor = Color.WHITE;\n            }\n            attributes.color = ColorGeometryInstanceAttribute.fromColor(currentColor);\n        }\n\n        if (defined(this._options.offsetAttribute)) {\n            attributes.offset = OffsetGeometryInstanceAttribute.fromCartesian3(Property.getValueOrDefault(this._terrainOffsetProperty, time, defaultOffset, offsetScratch));\n        }\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : new CorridorGeometry(this._options),\n            attributes : attributes\n        });\n    };\n\n    /**\n     * Creates the geometry instance which represents the outline of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the outline portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent an outlined geometry.\n     */\n    CorridorGeometryUpdater.prototype.createOutlineGeometryInstance = function(time) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n        var outlineColor = Property.getValueOrDefault(this._outlineColorProperty, time, Color.BLACK, scratchColor);\n\n        var attributes = {\n            show : new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._showOutlineProperty.getValue(time)),\n            color : ColorGeometryInstanceAttribute.fromColor(outlineColor),\n            distanceDisplayCondition : DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(time)),\n            offset : undefined\n        };\n\n        if (defined(this._options.offsetAttribute)) {\n            attributes.offset = OffsetGeometryInstanceAttribute.fromCartesian3(Property.getValueOrDefault(this._terrainOffsetProperty, time, defaultOffset, offsetScratch));\n        }\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : new CorridorOutlineGeometry(this._options),\n            attributes : attributes\n        });\n    };\n\n    CorridorGeometryUpdater.prototype._computeCenter = function(time, result) {\n        var positions = Property.getValueOrUndefined(this._entity.corridor.positions, time);\n        if (!defined(positions) || positions.length === 0) {\n            return;\n        }\n        return Cartesian3.clone(positions[Math.floor(positions.length / 2.0)], result);\n    };\n\n    CorridorGeometryUpdater.prototype._isHidden = function(entity, corridor) {\n        return !defined(corridor.positions) || !defined(corridor.width) || GeometryUpdater.prototype._isHidden.call(this, entity, corridor);\n    };\n\n    CorridorGeometryUpdater.prototype._isDynamic = function(entity, corridor) {\n        return !corridor.positions.isConstant || //\n               !Property.isConstant(corridor.height) || //\n               !Property.isConstant(corridor.extrudedHeight) || //\n               !Property.isConstant(corridor.granularity) || //\n               !Property.isConstant(corridor.width) || //\n               !Property.isConstant(corridor.outlineWidth) || //\n               !Property.isConstant(corridor.cornerType) || //\n               !Property.isConstant(corridor.zIndex) || //\n               (this._onTerrain && !Property.isConstant(this._materialProperty) && !(this._materialProperty instanceof ColorMaterialProperty));\n    };\n\n    CorridorGeometryUpdater.prototype._setStaticOptions = function(entity, corridor) {\n        var heightValue = Property.getValueOrUndefined(corridor.height, Iso8601.MINIMUM_VALUE);\n        var heightReferenceValue = Property.getValueOrDefault(corridor.heightReference, Iso8601.MINIMUM_VALUE, HeightReference.NONE);\n        var extrudedHeightValue = Property.getValueOrUndefined(corridor.extrudedHeight, Iso8601.MINIMUM_VALUE);\n        var extrudedHeightReferenceValue = Property.getValueOrDefault(corridor.extrudedHeightReference, Iso8601.MINIMUM_VALUE, HeightReference.NONE);\n        if (defined(extrudedHeightValue) && !defined(heightValue)) {\n            heightValue = 0;\n        }\n\n        var options = this._options;\n        options.vertexFormat = (this._materialProperty instanceof ColorMaterialProperty) ? PerInstanceColorAppearance.VERTEX_FORMAT : MaterialAppearance.MaterialSupport.TEXTURED.vertexFormat;\n        options.positions = corridor.positions.getValue(Iso8601.MINIMUM_VALUE, options.positions);\n        options.width = corridor.width.getValue(Iso8601.MINIMUM_VALUE);\n        options.granularity = Property.getValueOrUndefined(corridor.granularity, Iso8601.MINIMUM_VALUE);\n        options.cornerType = Property.getValueOrUndefined(corridor.cornerType, Iso8601.MINIMUM_VALUE);\n        options.offsetAttribute = GroundGeometryUpdater.computeGeometryOffsetAttribute(heightValue, heightReferenceValue, extrudedHeightValue, extrudedHeightReferenceValue);\n        options.height = GroundGeometryUpdater.getGeometryHeight(heightValue, heightReferenceValue);\n\n        extrudedHeightValue = GroundGeometryUpdater.getGeometryExtrudedHeight(extrudedHeightValue, extrudedHeightReferenceValue);\n        if (extrudedHeightValue === GroundGeometryUpdater.CLAMP_TO_GROUND) {\n            extrudedHeightValue = ApproximateTerrainHeights.getMinimumMaximumHeights(CorridorGeometry.computeRectangle(options, scratchRectangle)).minimumTerrainHeight;\n        }\n\n        options.extrudedHeight = extrudedHeightValue;\n    };\n\n    CorridorGeometryUpdater.DynamicGeometryUpdater = DynamicCorridorGeometryUpdater;\n\n    /**\n     * @private\n     */\n    function DynamicCorridorGeometryUpdater(geometryUpdater, primitives, groundPrimitives) {\n        DynamicGeometryUpdater.call(this, geometryUpdater, primitives, groundPrimitives);\n    }\n\n    if (defined(Object.create)) {\n        DynamicCorridorGeometryUpdater.prototype = Object.create(DynamicGeometryUpdater.prototype);\n        DynamicCorridorGeometryUpdater.prototype.constructor = DynamicCorridorGeometryUpdater;\n    }\n\n    DynamicCorridorGeometryUpdater.prototype._isHidden = function(entity, corridor, time) {\n        var options = this._options;\n        return !defined(options.positions) || !defined(options.width) || DynamicGeometryUpdater.prototype._isHidden.call(this, entity, corridor, time);\n    };\n\n    DynamicCorridorGeometryUpdater.prototype._setOptions = function(entity, corridor, time) {\n        var options = this._options;\n        var heightValue = Property.getValueOrUndefined(corridor.height, time);\n        var heightReferenceValue = Property.getValueOrDefault(corridor.heightReference, time, HeightReference.NONE);\n        var extrudedHeightValue = Property.getValueOrUndefined(corridor.extrudedHeight, time);\n        var extrudedHeightReferenceValue = Property.getValueOrDefault(corridor.extrudedHeightReference, time, HeightReference.NONE);\n        if (defined(extrudedHeightValue) && !defined(heightValue)) {\n            heightValue = 0;\n        }\n\n        options.positions = Property.getValueOrUndefined(corridor.positions, time);\n        options.width = Property.getValueOrUndefined(corridor.width, time);\n        options.granularity = Property.getValueOrUndefined(corridor.granularity, time);\n        options.cornerType = Property.getValueOrUndefined(corridor.cornerType, time);\n        options.offsetAttribute = GroundGeometryUpdater.computeGeometryOffsetAttribute(heightValue, heightReferenceValue, extrudedHeightValue, extrudedHeightReferenceValue);\n        options.height = GroundGeometryUpdater.getGeometryHeight(heightValue, heightReferenceValue);\n\n        extrudedHeightValue = GroundGeometryUpdater.getGeometryExtrudedHeight(extrudedHeightValue, extrudedHeightReferenceValue);\n        if (extrudedHeightValue === GroundGeometryUpdater.CLAMP_TO_GROUND) {\n            extrudedHeightValue = ApproximateTerrainHeights.getMinimumMaximumHeights(CorridorGeometry.computeRectangle(options, scratchRectangle)).minimumTerrainHeight;\n        }\n\n        options.extrudedHeight = extrudedHeightValue;\n    };\nexport default CorridorGeometryUpdater;\n","import CesiumMath from './Math.js';\n\n    /**\n     * @private\n     */\n    var CylinderGeometryLibrary = {};\n\n    /**\n     * @private\n     */\n    CylinderGeometryLibrary.computePositions = function(length, topRadius, bottomRadius, slices, fill){\n        var topZ = length * 0.5;\n        var bottomZ = -topZ;\n\n        var twoSlice = slices + slices;\n        var size = (fill) ? 2 * twoSlice : twoSlice;\n        var positions = new Float64Array(size*3);\n        var i;\n        var index = 0;\n        var tbIndex = 0;\n        var bottomOffset = (fill) ? twoSlice*3 : 0;\n        var topOffset = (fill) ? (twoSlice + slices)*3 : slices*3;\n\n        for (i = 0; i < slices; i++) {\n            var angle = i / slices * CesiumMath.TWO_PI;\n            var x = Math.cos(angle);\n            var y = Math.sin(angle);\n            var bottomX = x * bottomRadius;\n            var bottomY = y * bottomRadius;\n            var topX = x * topRadius;\n            var topY = y * topRadius;\n\n            positions[tbIndex + bottomOffset] = bottomX;\n            positions[tbIndex + bottomOffset + 1] = bottomY;\n            positions[tbIndex + bottomOffset + 2] = bottomZ;\n\n            positions[tbIndex + topOffset] = topX;\n            positions[tbIndex + topOffset + 1] = topY;\n            positions[tbIndex + topOffset + 2] = topZ;\n            tbIndex += 3;\n            if (fill) {\n                positions[index++] = bottomX;\n                positions[index++] = bottomY;\n                positions[index++] = bottomZ;\n                positions[index++] = topX;\n                positions[index++] = topY;\n                positions[index++] = topZ;\n            }\n        }\n\n        return positions;\n    };\nexport default CylinderGeometryLibrary;\n","import arrayFill from './arrayFill.js';\nimport BoundingSphere from './BoundingSphere.js';\nimport Cartesian2 from './Cartesian2.js';\nimport Cartesian3 from './Cartesian3.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport CylinderGeometryLibrary from './CylinderGeometryLibrary.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport DeveloperError from './DeveloperError.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport GeometryOffsetAttribute from './GeometryOffsetAttribute.js';\nimport IndexDatatype from './IndexDatatype.js';\nimport CesiumMath from './Math.js';\nimport PrimitiveType from './PrimitiveType.js';\nimport VertexFormat from './VertexFormat.js';\n\n    var radiusScratch = new Cartesian2();\n    var normalScratch = new Cartesian3();\n    var bitangentScratch = new Cartesian3();\n    var tangentScratch = new Cartesian3();\n    var positionScratch = new Cartesian3();\n\n    /**\n     * A description of a cylinder.\n     *\n     * @alias CylinderGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Number} options.length The length of the cylinder.\n     * @param {Number} options.topRadius The radius of the top of the cylinder.\n     * @param {Number} options.bottomRadius The radius of the bottom of the cylinder.\n     * @param {Number} [options.slices=128] The number of edges around the perimeter of the cylinder.\n     * @param {VertexFormat} [options.vertexFormat=VertexFormat.DEFAULT] The vertex attributes to be computed.\n     *\n     * @exception {DeveloperError} options.slices must be greater than or equal to 3.\n     *\n     * @see CylinderGeometry.createGeometry\n     *\n     * @example\n     * // create cylinder geometry\n     * var cylinder = new Cesium.CylinderGeometry({\n     *     length: 200000,\n     *     topRadius: 80000,\n     *     bottomRadius: 200000,\n     * });\n     * var geometry = Cesium.CylinderGeometry.createGeometry(cylinder);\n     */\n    function CylinderGeometry(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        var length = options.length;\n        var topRadius = options.topRadius;\n        var bottomRadius = options.bottomRadius;\n        var vertexFormat = defaultValue(options.vertexFormat, VertexFormat.DEFAULT);\n        var slices = defaultValue(options.slices, 128);\n\n        \n\n        this._length = length;\n        this._topRadius = topRadius;\n        this._bottomRadius = bottomRadius;\n        this._vertexFormat = VertexFormat.clone(vertexFormat);\n        this._slices = slices;\n        this._offsetAttribute = options.offsetAttribute;\n        this._workerName = 'createCylinderGeometry';\n    }\n\n    /**\n     * The number of elements used to pack the object into an array.\n     * @type {Number}\n     */\n    CylinderGeometry.packedLength = VertexFormat.packedLength + 5;\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {CylinderGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    CylinderGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        VertexFormat.pack(value._vertexFormat, array, startingIndex);\n        startingIndex += VertexFormat.packedLength;\n\n        array[startingIndex++] = value._length;\n        array[startingIndex++] = value._topRadius;\n        array[startingIndex++] = value._bottomRadius;\n        array[startingIndex++] = value._slices;\n        array[startingIndex] = defaultValue(value._offsetAttribute, -1);\n\n        return array;\n    };\n\n    var scratchVertexFormat = new VertexFormat();\n    var scratchOptions = {\n        vertexFormat : scratchVertexFormat,\n        length : undefined,\n        topRadius : undefined,\n        bottomRadius : undefined,\n        slices : undefined,\n        offsetAttribute : undefined\n    };\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {CylinderGeometry} [result] The object into which to store the result.\n     * @returns {CylinderGeometry} The modified result parameter or a new CylinderGeometry instance if one was not provided.\n     */\n    CylinderGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var vertexFormat = VertexFormat.unpack(array, startingIndex, scratchVertexFormat);\n        startingIndex += VertexFormat.packedLength;\n\n        var length = array[startingIndex++];\n        var topRadius = array[startingIndex++];\n        var bottomRadius = array[startingIndex++];\n        var slices = array[startingIndex++];\n        var offsetAttribute = array[startingIndex];\n\n        if (!defined(result)) {\n            scratchOptions.length = length;\n            scratchOptions.topRadius = topRadius;\n            scratchOptions.bottomRadius = bottomRadius;\n            scratchOptions.slices = slices;\n            scratchOptions.offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n            return new CylinderGeometry(scratchOptions);\n        }\n\n        result._vertexFormat = VertexFormat.clone(vertexFormat, result._vertexFormat);\n        result._length = length;\n        result._topRadius = topRadius;\n        result._bottomRadius = bottomRadius;\n        result._slices = slices;\n        result._offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n\n        return result;\n    };\n\n    /**\n     * Computes the geometric representation of a cylinder, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {CylinderGeometry} cylinderGeometry A description of the cylinder.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    CylinderGeometry.createGeometry = function(cylinderGeometry) {\n        var length = cylinderGeometry._length;\n        var topRadius = cylinderGeometry._topRadius;\n        var bottomRadius = cylinderGeometry._bottomRadius;\n        var vertexFormat = cylinderGeometry._vertexFormat;\n        var slices = cylinderGeometry._slices;\n\n        if ((length <= 0) || (topRadius < 0) || (bottomRadius < 0) || ((topRadius === 0) && (bottomRadius === 0))) {\n            return;\n        }\n\n        var twoSlices = slices + slices;\n        var threeSlices = slices + twoSlices;\n        var numVertices = twoSlices + twoSlices;\n\n        var positions = CylinderGeometryLibrary.computePositions(length, topRadius, bottomRadius, slices, true);\n\n        var st = (vertexFormat.st) ? new Float32Array(numVertices * 2) : undefined;\n        var normals = (vertexFormat.normal) ? new Float32Array(numVertices * 3) : undefined;\n        var tangents = (vertexFormat.tangent) ? new Float32Array(numVertices * 3) : undefined;\n        var bitangents = (vertexFormat.bitangent) ? new Float32Array(numVertices * 3) : undefined;\n\n        var i;\n        var computeNormal = (vertexFormat.normal || vertexFormat.tangent || vertexFormat.bitangent);\n\n        if (computeNormal) {\n            var computeTangent = (vertexFormat.tangent || vertexFormat.bitangent);\n\n            var normalIndex = 0;\n            var tangentIndex = 0;\n            var bitangentIndex = 0;\n\n            var theta = Math.atan2(bottomRadius - topRadius, length);\n            var normal = normalScratch;\n            normal.z = Math.sin(theta);\n            var normalScale = Math.cos(theta);\n            var tangent = tangentScratch;\n            var bitangent = bitangentScratch;\n\n            for (i = 0; i < slices; i++) {\n                var angle = i / slices * CesiumMath.TWO_PI;\n                var x = normalScale * Math.cos(angle);\n                var y = normalScale * Math.sin(angle);\n                if (computeNormal) {\n                    normal.x = x;\n                    normal.y = y;\n\n                    if (computeTangent) {\n                        tangent = Cartesian3.normalize(Cartesian3.cross(Cartesian3.UNIT_Z, normal, tangent), tangent);\n                    }\n\n                    if (vertexFormat.normal) {\n                        normals[normalIndex++] = normal.x;\n                        normals[normalIndex++] = normal.y;\n                        normals[normalIndex++] = normal.z;\n                        normals[normalIndex++] = normal.x;\n                        normals[normalIndex++] = normal.y;\n                        normals[normalIndex++] = normal.z;\n                    }\n\n                    if (vertexFormat.tangent) {\n                        tangents[tangentIndex++] = tangent.x;\n                        tangents[tangentIndex++] = tangent.y;\n                        tangents[tangentIndex++] = tangent.z;\n                        tangents[tangentIndex++] = tangent.x;\n                        tangents[tangentIndex++] = tangent.y;\n                        tangents[tangentIndex++] = tangent.z;\n                    }\n\n                    if (vertexFormat.bitangent) {\n                        bitangent = Cartesian3.normalize(Cartesian3.cross(normal, tangent, bitangent), bitangent);\n                        bitangents[bitangentIndex++] = bitangent.x;\n                        bitangents[bitangentIndex++] = bitangent.y;\n                        bitangents[bitangentIndex++] = bitangent.z;\n                        bitangents[bitangentIndex++] = bitangent.x;\n                        bitangents[bitangentIndex++] = bitangent.y;\n                        bitangents[bitangentIndex++] = bitangent.z;\n                    }\n                }\n            }\n\n            for (i = 0; i < slices; i++) {\n                if (vertexFormat.normal) {\n                    normals[normalIndex++] = 0;\n                    normals[normalIndex++] = 0;\n                    normals[normalIndex++] = -1;\n                }\n                if (vertexFormat.tangent) {\n                    tangents[tangentIndex++] = 1;\n                    tangents[tangentIndex++] = 0;\n                    tangents[tangentIndex++] = 0;\n                }\n                if (vertexFormat.bitangent) {\n                    bitangents[bitangentIndex++] = 0;\n                    bitangents[bitangentIndex++] = -1;\n                    bitangents[bitangentIndex++] = 0;\n                }\n            }\n\n            for (i = 0; i < slices; i++) {\n                if (vertexFormat.normal) {\n                    normals[normalIndex++] = 0;\n                    normals[normalIndex++] = 0;\n                    normals[normalIndex++] = 1;\n                }\n                if (vertexFormat.tangent) {\n                    tangents[tangentIndex++] = 1;\n                    tangents[tangentIndex++] = 0;\n                    tangents[tangentIndex++] = 0;\n                }\n                if (vertexFormat.bitangent) {\n                    bitangents[bitangentIndex++] = 0;\n                    bitangents[bitangentIndex++] = 1;\n                    bitangents[bitangentIndex++] = 0;\n                }\n            }\n        }\n\n        var numIndices = 12 * slices - 12;\n        var indices = IndexDatatype.createTypedArray(numVertices, numIndices);\n        var index = 0;\n        var j = 0;\n        for (i = 0; i < slices - 1; i++) {\n            indices[index++] = j;\n            indices[index++] = j + 2;\n            indices[index++] = j + 3;\n\n            indices[index++] = j;\n            indices[index++] = j + 3;\n            indices[index++] = j + 1;\n\n            j += 2;\n        }\n\n        indices[index++] = twoSlices - 2;\n        indices[index++] = 0;\n        indices[index++] = 1;\n        indices[index++] = twoSlices - 2;\n        indices[index++] = 1;\n        indices[index++] = twoSlices - 1;\n\n        for (i = 1; i < slices - 1; i++) {\n            indices[index++] = twoSlices + i + 1;\n            indices[index++] = twoSlices + i;\n            indices[index++] = twoSlices;\n        }\n\n        for (i = 1; i < slices - 1; i++) {\n            indices[index++] = threeSlices;\n            indices[index++] = threeSlices + i;\n            indices[index++] = threeSlices + i + 1;\n        }\n\n        var textureCoordIndex = 0;\n        if (vertexFormat.st) {\n            var rad = Math.max(topRadius, bottomRadius);\n            for (i = 0; i < numVertices; i++) {\n                var position = Cartesian3.fromArray(positions, i * 3, positionScratch);\n                st[textureCoordIndex++] = (position.x + rad) / (2.0 * rad);\n                st[textureCoordIndex++] = (position.y + rad) / (2.0 * rad);\n            }\n        }\n\n        var attributes = new GeometryAttributes();\n        if (vertexFormat.position) {\n            attributes.position = new GeometryAttribute({\n                componentDatatype: ComponentDatatype.DOUBLE,\n                componentsPerAttribute: 3,\n                values: positions\n            });\n        }\n\n        if (vertexFormat.normal) {\n            attributes.normal = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : normals\n            });\n        }\n\n        if (vertexFormat.tangent) {\n            attributes.tangent = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : tangents\n            });\n        }\n\n        if (vertexFormat.bitangent) {\n            attributes.bitangent = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : bitangents\n            });\n        }\n\n        if (vertexFormat.st) {\n            attributes.st = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 2,\n                values : st\n            });\n        }\n\n        radiusScratch.x = length * 0.5;\n        radiusScratch.y = Math.max(bottomRadius, topRadius);\n\n        var boundingSphere = new BoundingSphere(Cartesian3.ZERO, Cartesian2.magnitude(radiusScratch));\n\n        if (defined(cylinderGeometry._offsetAttribute)) {\n            length = positions.length;\n            var applyOffset = new Uint8Array(length / 3);\n            var offsetValue = cylinderGeometry._offsetAttribute === GeometryOffsetAttribute.NONE ? 0 : 1;\n            arrayFill(applyOffset, offsetValue);\n            attributes.applyOffset = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                componentsPerAttribute : 1,\n                values: applyOffset\n            });\n        }\n\n        return new Geometry({\n            attributes : attributes,\n            indices : indices,\n            primitiveType : PrimitiveType.TRIANGLES,\n            boundingSphere : boundingSphere,\n            offsetAttribute : cylinderGeometry._offsetAttribute\n        });\n    };\n\n    var unitCylinderGeometry;\n\n    /**\n     * Returns the geometric representation of a unit cylinder, including its vertices, indices, and a bounding sphere.\n     * @returns {Geometry} The computed vertices and indices.\n     *\n     * @private\n     */\n    CylinderGeometry.getUnitCylinder = function() {\n        if (!defined(unitCylinderGeometry)) {\n            unitCylinderGeometry = CylinderGeometry.createGeometry(new CylinderGeometry({\n                topRadius : 1.0,\n                bottomRadius : 1.0,\n                length : 1.0,\n                vertexFormat : VertexFormat.POSITION_ONLY\n            }));\n        }\n        return unitCylinderGeometry;\n    };\nexport default CylinderGeometry;\n","import arrayFill from './arrayFill.js';\nimport BoundingSphere from './BoundingSphere.js';\nimport Cartesian2 from './Cartesian2.js';\nimport Cartesian3 from './Cartesian3.js';\nimport Check from './Check.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport CylinderGeometryLibrary from './CylinderGeometryLibrary.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport DeveloperError from './DeveloperError.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport GeometryOffsetAttribute from './GeometryOffsetAttribute.js';\nimport IndexDatatype from './IndexDatatype.js';\nimport PrimitiveType from './PrimitiveType.js';\n\n    var radiusScratch = new Cartesian2();\n\n    /**\n     * A description of the outline of a cylinder.\n     *\n     * @alias CylinderOutlineGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Number} options.length The length of the cylinder.\n     * @param {Number} options.topRadius The radius of the top of the cylinder.\n     * @param {Number} options.bottomRadius The radius of the bottom of the cylinder.\n     * @param {Number} [options.slices=128] The number of edges around the perimeter of the cylinder.\n     * @param {Number} [options.numberOfVerticalLines=16] Number of lines to draw between the top and bottom surfaces of the cylinder.\n     *\n     * @exception {DeveloperError} options.length must be greater than 0.\n     * @exception {DeveloperError} options.topRadius must be greater than 0.\n     * @exception {DeveloperError} options.bottomRadius must be greater than 0.\n     * @exception {DeveloperError} bottomRadius and topRadius cannot both equal 0.\n     * @exception {DeveloperError} options.slices must be greater than or equal to 3.\n     *\n     * @see CylinderOutlineGeometry.createGeometry\n     *\n     * @example\n     * // create cylinder geometry\n     * var cylinder = new Cesium.CylinderOutlineGeometry({\n     *     length: 200000,\n     *     topRadius: 80000,\n     *     bottomRadius: 200000,\n     * });\n     * var geometry = Cesium.CylinderOutlineGeometry.createGeometry(cylinder);\n     */\n    function CylinderOutlineGeometry(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        var length = options.length;\n        var topRadius = options.topRadius;\n        var bottomRadius = options.bottomRadius;\n        var slices = defaultValue(options.slices, 128);\n        var numberOfVerticalLines = Math.max(defaultValue(options.numberOfVerticalLines, 16), 0);\n\n        \n\n        this._length = length;\n        this._topRadius = topRadius;\n        this._bottomRadius = bottomRadius;\n        this._slices = slices;\n        this._numberOfVerticalLines = numberOfVerticalLines;\n        this._offsetAttribute = options.offsetAttribute;\n        this._workerName = 'createCylinderOutlineGeometry';\n    }\n\n    /**\n     * The number of elements used to pack the object into an array.\n     * @type {Number}\n     */\n    CylinderOutlineGeometry.packedLength = 6;\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {CylinderOutlineGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    CylinderOutlineGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        array[startingIndex++] = value._length;\n        array[startingIndex++] = value._topRadius;\n        array[startingIndex++] = value._bottomRadius;\n        array[startingIndex++] = value._slices;\n        array[startingIndex++] = value._numberOfVerticalLines;\n        array[startingIndex] = defaultValue(value._offsetAttribute, -1);\n\n        return array;\n    };\n\n    var scratchOptions = {\n        length : undefined,\n        topRadius : undefined,\n        bottomRadius : undefined,\n        slices : undefined,\n        numberOfVerticalLines : undefined,\n        offsetAttribute : undefined\n    };\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {CylinderOutlineGeometry} [result] The object into which to store the result.\n     * @returns {CylinderOutlineGeometry} The modified result parameter or a new CylinderOutlineGeometry instance if one was not provided.\n     */\n    CylinderOutlineGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var length = array[startingIndex++];\n        var topRadius = array[startingIndex++];\n        var bottomRadius = array[startingIndex++];\n        var slices = array[startingIndex++];\n        var numberOfVerticalLines = array[startingIndex++];\n        var offsetAttribute = array[startingIndex];\n\n        if (!defined(result)) {\n            scratchOptions.length = length;\n            scratchOptions.topRadius = topRadius;\n            scratchOptions.bottomRadius = bottomRadius;\n            scratchOptions.slices = slices;\n            scratchOptions.numberOfVerticalLines = numberOfVerticalLines;\n            scratchOptions.offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n            return new CylinderOutlineGeometry(scratchOptions);\n        }\n\n        result._length = length;\n        result._topRadius = topRadius;\n        result._bottomRadius = bottomRadius;\n        result._slices = slices;\n        result._numberOfVerticalLines = numberOfVerticalLines;\n        result._offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n\n        return result;\n    };\n\n    /**\n     * Computes the geometric representation of an outline of a cylinder, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {CylinderOutlineGeometry} cylinderGeometry A description of the cylinder outline.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    CylinderOutlineGeometry.createGeometry = function(cylinderGeometry) {\n        var length = cylinderGeometry._length;\n        var topRadius = cylinderGeometry._topRadius;\n        var bottomRadius = cylinderGeometry._bottomRadius;\n        var slices = cylinderGeometry._slices;\n        var numberOfVerticalLines = cylinderGeometry._numberOfVerticalLines;\n\n        if ((length <= 0) || (topRadius < 0) || (bottomRadius < 0) || ((topRadius === 0) && (bottomRadius === 0))) {\n            return;\n        }\n\n        var numVertices = slices * 2;\n\n        var positions = CylinderGeometryLibrary.computePositions(length, topRadius, bottomRadius, slices, false);\n        var numIndices = slices * 2;\n        var numSide;\n        if (numberOfVerticalLines > 0) {\n            var numSideLines = Math.min(numberOfVerticalLines, slices);\n            numSide = Math.round(slices / numSideLines);\n            numIndices += numSideLines;\n        }\n\n        var indices = IndexDatatype.createTypedArray(numVertices, numIndices * 2);\n        var index = 0;\n        var i;\n        for (i = 0; i < slices - 1; i++) {\n            indices[index++] = i;\n            indices[index++] = i + 1;\n            indices[index++] = i + slices;\n            indices[index++] = i + 1 + slices;\n        }\n\n        indices[index++] = slices - 1;\n        indices[index++] = 0;\n        indices[index++] = slices + slices - 1;\n        indices[index++] = slices;\n\n        if (numberOfVerticalLines > 0) {\n            for (i = 0; i < slices; i += numSide) {\n                indices[index++] = i;\n                indices[index++] = i + slices;\n            }\n        }\n\n        var attributes = new GeometryAttributes();\n        attributes.position = new GeometryAttribute({\n            componentDatatype : ComponentDatatype.DOUBLE,\n            componentsPerAttribute : 3,\n            values : positions\n        });\n\n        radiusScratch.x = length * 0.5;\n        radiusScratch.y = Math.max(bottomRadius, topRadius);\n\n        var boundingSphere = new BoundingSphere(Cartesian3.ZERO, Cartesian2.magnitude(radiusScratch));\n\n        if (defined(cylinderGeometry._offsetAttribute)) {\n            length = positions.length;\n            var applyOffset = new Uint8Array(length / 3);\n            var offsetValue = cylinderGeometry._offsetAttribute === GeometryOffsetAttribute.NONE ? 0 : 1;\n            arrayFill(applyOffset, offsetValue);\n            attributes.applyOffset = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                componentsPerAttribute : 1,\n                values: applyOffset\n            });\n        }\n\n        return new Geometry({\n            attributes : attributes,\n            indices : indices,\n            primitiveType : PrimitiveType.LINES,\n            boundingSphere : boundingSphere,\n            offsetAttribute : cylinderGeometry._offsetAttribute\n        });\n    };\nexport default CylinderOutlineGeometry;\n","import Cartesian3 from '../Core/Cartesian3.js';\nimport Check from '../Core/Check.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport CylinderGeometry from '../Core/CylinderGeometry.js';\nimport CylinderOutlineGeometry from '../Core/CylinderOutlineGeometry.js';\nimport defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport DistanceDisplayConditionGeometryInstanceAttribute from '../Core/DistanceDisplayConditionGeometryInstanceAttribute.js';\nimport GeometryInstance from '../Core/GeometryInstance.js';\nimport GeometryOffsetAttribute from '../Core/GeometryOffsetAttribute.js';\nimport Iso8601 from '../Core/Iso8601.js';\nimport OffsetGeometryInstanceAttribute from '../Core/OffsetGeometryInstanceAttribute.js';\nimport ShowGeometryInstanceAttribute from '../Core/ShowGeometryInstanceAttribute.js';\nimport HeightReference from '../Scene/HeightReference.js';\nimport MaterialAppearance from '../Scene/MaterialAppearance.js';\nimport PerInstanceColorAppearance from '../Scene/PerInstanceColorAppearance.js';\nimport ColorMaterialProperty from './ColorMaterialProperty.js';\nimport DynamicGeometryUpdater from './DynamicGeometryUpdater.js';\nimport GeometryUpdater from './GeometryUpdater.js';\nimport heightReferenceOnEntityPropertyChanged from './heightReferenceOnEntityPropertyChanged.js';\nimport Property from './Property.js';\n\n    var defaultOffset = Cartesian3.ZERO;\n\n    var offsetScratch = new Cartesian3();\n    var positionScratch = new Cartesian3();\n    var scratchColor = new Color();\n\n    function CylinderGeometryOptions(entity) {\n        this.id = entity;\n        this.vertexFormat = undefined;\n        this.length = undefined;\n        this.topRadius = undefined;\n        this.bottomRadius = undefined;\n        this.slices = undefined;\n        this.numberOfVerticalLines = undefined;\n        this.offsetAttribute = undefined;\n    }\n\n    /**\n     * A {@link GeometryUpdater} for cylinders.\n     * Clients do not normally create this class directly, but instead rely on {@link DataSourceDisplay}.\n     * @alias CylinderGeometryUpdater\n     * @constructor\n     *\n     * @param {Entity} entity The entity containing the geometry to be visualized.\n     * @param {Scene} scene The scene where visualization is taking place.\n     */\n    function CylinderGeometryUpdater(entity, scene) {\n        GeometryUpdater.call(this, {\n            entity: entity,\n            scene: scene,\n            geometryOptions: new CylinderGeometryOptions(entity),\n            geometryPropertyName: 'cylinder',\n            observedPropertyNames: ['availability', 'position', 'orientation', 'cylinder']\n        });\n\n        this._onEntityPropertyChanged(entity, 'cylinder', entity.cylinder, undefined);\n    }\n\n    if (defined(Object.create)) {\n        CylinderGeometryUpdater.prototype = Object.create(GeometryUpdater.prototype);\n        CylinderGeometryUpdater.prototype.constructor = CylinderGeometryUpdater;\n    }\n\n    Object.defineProperties(CylinderGeometryUpdater.prototype, {\n        /**\n         * Gets the terrain offset property\n         * @type {TerrainOffsetProperty}\n         * @memberof CylinderGeometryUpdater.prototype\n         * @readonly\n         */\n        terrainOffsetProperty: {\n            get: function() {\n                return this._terrainOffsetProperty;\n            }\n        }\n    });\n\n    /**\n     * Creates the geometry instance which represents the fill of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the filled portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent a filled geometry.\n     */\n    CylinderGeometryUpdater.prototype.createFillGeometryInstance = function(time) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n\n        var show = new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._fillProperty.getValue(time));\n        var distanceDisplayCondition = this._distanceDisplayConditionProperty.getValue(time);\n        var distanceDisplayConditionAttribute = DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(distanceDisplayCondition);\n\n        var attributes = {\n            show : show,\n            distanceDisplayCondition : distanceDisplayConditionAttribute,\n            color : undefined,\n            offset: undefined\n        };\n        if (this._materialProperty instanceof ColorMaterialProperty) {\n            var currentColor;\n            if (defined(this._materialProperty.color) && (this._materialProperty.color.isConstant || isAvailable)) {\n                currentColor = this._materialProperty.color.getValue(time, scratchColor);\n            }\n            if (!defined(currentColor)) {\n                currentColor = Color.WHITE;\n            }\n            attributes.color = ColorGeometryInstanceAttribute.fromColor(currentColor);\n        }\n\n        if (defined(this._options.offsetAttribute)) {\n            attributes.offset = OffsetGeometryInstanceAttribute.fromCartesian3(Property.getValueOrDefault(this._terrainOffsetProperty, time, defaultOffset, offsetScratch));\n        }\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : new CylinderGeometry(this._options),\n            modelMatrix : entity.computeModelMatrixForHeightReference(time, entity.cylinder.heightReference, this._options.length * 0.5, this._scene.mapProjection.ellipsoid),\n            attributes : attributes\n        });\n    };\n\n    /**\n     * Creates the geometry instance which represents the outline of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the outline portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent an outlined geometry.\n     */\n    CylinderGeometryUpdater.prototype.createOutlineGeometryInstance = function(time) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n        var outlineColor = Property.getValueOrDefault(this._outlineColorProperty, time, Color.BLACK, scratchColor);\n        var distanceDisplayCondition = this._distanceDisplayConditionProperty.getValue(time);\n\n        var attributes = {\n            show : new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._showOutlineProperty.getValue(time)),\n            color : ColorGeometryInstanceAttribute.fromColor(outlineColor),\n            distanceDisplayCondition : DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(distanceDisplayCondition),\n            offset : undefined\n        };\n        if (defined(this._options.offsetAttribute)) {\n            attributes.offset = OffsetGeometryInstanceAttribute.fromCartesian3(Property.getValueOrDefault(this._terrainOffsetProperty, time, defaultOffset, offsetScratch));\n        }\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : new CylinderOutlineGeometry(this._options),\n            modelMatrix : entity.computeModelMatrixForHeightReference(time, entity.cylinder.heightReference, this._options.length * 0.5, this._scene.mapProjection.ellipsoid),\n            attributes : attributes\n        });\n    };\n\n    CylinderGeometryUpdater.prototype._computeCenter = function(time, result) {\n        return Property.getValueOrUndefined(this._entity.position, time, result);\n    };\n\n    CylinderGeometryUpdater.prototype._isHidden = function(entity, cylinder) {\n        return !defined(entity.position) || !defined(cylinder.length) || !defined(cylinder.topRadius) || !defined(cylinder.bottomRadius) || GeometryUpdater.prototype._isHidden.call(this, entity, cylinder);\n    };\n\n    CylinderGeometryUpdater.prototype._isDynamic = function(entity, cylinder) {\n        return !entity.position.isConstant || //\n                !Property.isConstant(entity.orientation) || //\n                !cylinder.length.isConstant || //\n                !cylinder.topRadius.isConstant || //\n                !cylinder.bottomRadius.isConstant || //\n                !Property.isConstant(cylinder.slices) || //\n                !Property.isConstant(cylinder.outlineWidth) || //\n                !Property.isConstant(cylinder.numberOfVerticalLines);\n    };\n\n    CylinderGeometryUpdater.prototype._setStaticOptions = function(entity, cylinder) {\n        var heightReference = Property.getValueOrDefault(cylinder.heightReference, Iso8601.MINIMUM_VALUE, HeightReference.NONE);\n        var options = this._options;\n        options.vertexFormat = this._materialProperty instanceof ColorMaterialProperty ? PerInstanceColorAppearance.VERTEX_FORMAT : MaterialAppearance.MaterialSupport.TEXTURED.vertexFormat;\n        options.length = cylinder.length.getValue(Iso8601.MINIMUM_VALUE);\n        options.topRadius = cylinder.topRadius.getValue(Iso8601.MINIMUM_VALUE);\n        options.bottomRadius = cylinder.bottomRadius.getValue(Iso8601.MINIMUM_VALUE);\n        options.slices = Property.getValueOrUndefined(cylinder.slices, Iso8601.MINIMUM_VALUE);\n        options.numberOfVerticalLines = Property.getValueOrUndefined(cylinder.numberOfVerticalLines, Iso8601.MINIMUM_VALUE);\n        options.offsetAttribute = heightReference !== HeightReference.NONE ? GeometryOffsetAttribute.ALL : undefined;\n    };\n\n    CylinderGeometryUpdater.prototype._onEntityPropertyChanged = heightReferenceOnEntityPropertyChanged;\n\n    CylinderGeometryUpdater.DynamicGeometryUpdater = DynamicCylinderGeometryUpdater;\n\n    /**\n     * @private\n     */\n    function DynamicCylinderGeometryUpdater(geometryUpdater, primitives, groundPrimitives) {\n        DynamicGeometryUpdater.call(this, geometryUpdater, primitives, groundPrimitives);\n    }\n\n    if (defined(Object.create)) {\n        DynamicCylinderGeometryUpdater.prototype = Object.create(DynamicGeometryUpdater.prototype);\n        DynamicCylinderGeometryUpdater.prototype.constructor = DynamicCylinderGeometryUpdater;\n    }\n\n    DynamicCylinderGeometryUpdater.prototype._isHidden = function(entity, cylinder, time) {\n        var options = this._options;\n        var position = Property.getValueOrUndefined(entity.position, time, positionScratch);\n        return !defined(position) || !defined(options.length) || !defined(options.topRadius) || //\n               !defined(options.bottomRadius) || DynamicGeometryUpdater.prototype._isHidden.call(this, entity, cylinder, time);\n    };\n\n    DynamicCylinderGeometryUpdater.prototype._setOptions = function(entity, cylinder, time) {\n        var heightReference = Property.getValueOrDefault(cylinder.heightReference, time, HeightReference.NONE);\n        var options = this._options;\n        options.length = Property.getValueOrUndefined(cylinder.length, time);\n        options.topRadius = Property.getValueOrUndefined(cylinder.topRadius, time);\n        options.bottomRadius = Property.getValueOrUndefined(cylinder.bottomRadius, time);\n        options.slices = Property.getValueOrUndefined(cylinder.slices, time);\n        options.numberOfVerticalLines = Property.getValueOrUndefined(cylinder.numberOfVerticalLines, time);\n        options.offsetAttribute = heightReference !== HeightReference.NONE ? GeometryOffsetAttribute.ALL : undefined;\n    };\nexport default CylinderGeometryUpdater;\n","import AssociativeArray from '../Core/AssociativeArray.js';\nimport defined from '../Core/defined.js';\nimport BoundingSphereState from './BoundingSphereState.js';\n\n    /**\n     * @private\n     */\n    function DynamicGeometryBatch(primitives, orderedGroundPrimitives) {\n        this._primitives = primitives;\n        this._orderedGroundPrimitives = orderedGroundPrimitives;\n        this._dynamicUpdaters = new AssociativeArray();\n    }\n\n    DynamicGeometryBatch.prototype.add = function(time, updater) {\n        this._dynamicUpdaters.set(updater.id, updater.createDynamicUpdater(this._primitives, this._orderedGroundPrimitives));\n    };\n\n    DynamicGeometryBatch.prototype.remove = function(updater) {\n        var id = updater.id;\n        var dynamicUpdater = this._dynamicUpdaters.get(id);\n        if (defined(dynamicUpdater)) {\n            this._dynamicUpdaters.remove(id);\n            dynamicUpdater.destroy();\n        }\n    };\n\n    DynamicGeometryBatch.prototype.update = function(time) {\n        var geometries = this._dynamicUpdaters.values;\n        for (var i = 0, len = geometries.length; i < len; i++) {\n            geometries[i].update(time);\n        }\n        return true;\n    };\n\n    DynamicGeometryBatch.prototype.removeAllPrimitives = function() {\n        var geometries = this._dynamicUpdaters.values;\n        for (var i = 0, len = geometries.length; i < len; i++) {\n            geometries[i].destroy();\n        }\n        this._dynamicUpdaters.removeAll();\n    };\n\n    DynamicGeometryBatch.prototype.getBoundingSphere = function(updater, result) {\n        updater = this._dynamicUpdaters.get(updater.id);\n        if (defined(updater) && defined(updater.getBoundingSphere)) {\n            return updater.getBoundingSphere(result);\n        }\n        return BoundingSphereState.FAILED;\n    };\nexport default DynamicGeometryBatch;\n","import Cartesian3 from './Cartesian3.js';\nimport CesiumMath from './Math.js';\nimport Matrix3 from './Matrix3.js';\nimport Quaternion from './Quaternion.js';\n\n    var EllipseGeometryLibrary = {};\n\n    var rotAxis = new Cartesian3();\n    var tempVec = new Cartesian3();\n    var unitQuat = new Quaternion();\n    var rotMtx = new Matrix3();\n\n    function pointOnEllipsoid(theta, rotation, northVec, eastVec, aSqr, ab, bSqr, mag, unitPos, result) {\n        var azimuth = theta + rotation;\n\n        Cartesian3.multiplyByScalar(eastVec, Math.cos(azimuth), rotAxis);\n        Cartesian3.multiplyByScalar(northVec, Math.sin(azimuth), tempVec);\n        Cartesian3.add(rotAxis, tempVec, rotAxis);\n\n        var cosThetaSquared = Math.cos(theta);\n        cosThetaSquared = cosThetaSquared * cosThetaSquared;\n\n        var sinThetaSquared = Math.sin(theta);\n        sinThetaSquared = sinThetaSquared * sinThetaSquared;\n\n        var radius = ab / Math.sqrt(bSqr * cosThetaSquared + aSqr * sinThetaSquared);\n        var angle = radius / mag;\n\n        // Create the quaternion to rotate the position vector to the boundary of the ellipse.\n        Quaternion.fromAxisAngle(rotAxis, angle, unitQuat);\n        Matrix3.fromQuaternion(unitQuat, rotMtx);\n\n        Matrix3.multiplyByVector(rotMtx, unitPos, result);\n        Cartesian3.normalize(result, result);\n        Cartesian3.multiplyByScalar(result, mag, result);\n        return result;\n    }\n\n    var scratchCartesian1 = new Cartesian3();\n    var scratchCartesian2 = new Cartesian3();\n    var scratchCartesian3 = new Cartesian3();\n    var scratchNormal = new Cartesian3();\n    /**\n     * Returns the positions raised to the given heights\n     * @private\n     */\n    EllipseGeometryLibrary.raisePositionsToHeight = function(positions, options, extrude) {\n        var ellipsoid = options.ellipsoid;\n        var height = options.height;\n        var extrudedHeight = options.extrudedHeight;\n        var size = (extrude) ? positions.length / 3 * 2 : positions.length / 3;\n\n        var finalPositions = new Float64Array(size * 3);\n\n        var length = positions.length;\n        var bottomOffset = (extrude) ? length : 0;\n        for (var i = 0; i < length; i += 3) {\n            var i1 = i + 1;\n            var i2 = i + 2;\n\n            var position = Cartesian3.fromArray(positions, i, scratchCartesian1);\n            ellipsoid.scaleToGeodeticSurface(position, position);\n\n            var extrudedPosition = Cartesian3.clone(position, scratchCartesian2);\n            var normal = ellipsoid.geodeticSurfaceNormal(position, scratchNormal);\n            var scaledNormal = Cartesian3.multiplyByScalar(normal, height, scratchCartesian3);\n            Cartesian3.add(position, scaledNormal, position);\n\n            if (extrude) {\n                Cartesian3.multiplyByScalar(normal, extrudedHeight, scaledNormal);\n                Cartesian3.add(extrudedPosition, scaledNormal, extrudedPosition);\n\n                finalPositions[i + bottomOffset] = extrudedPosition.x;\n                finalPositions[i1 + bottomOffset] = extrudedPosition.y;\n                finalPositions[i2 + bottomOffset] = extrudedPosition.z;\n            }\n\n            finalPositions[i] = position.x;\n            finalPositions[i1] = position.y;\n            finalPositions[i2] = position.z;\n        }\n\n        return finalPositions;\n    };\n\n    var unitPosScratch = new Cartesian3();\n    var eastVecScratch = new Cartesian3();\n    var northVecScratch = new Cartesian3();\n    /**\n     * Returns an array of positions that make up the ellipse.\n     * @private\n     */\n    EllipseGeometryLibrary.computeEllipsePositions = function(options, addFillPositions, addEdgePositions) {\n        var semiMinorAxis = options.semiMinorAxis;\n        var semiMajorAxis = options.semiMajorAxis;\n        var rotation = options.rotation;\n        var center = options.center;\n\n        // Computing the arc-length of the ellipse is too expensive to be practical. Estimating it using the\n        // arc length of the sphere is too inaccurate and creates sharp edges when either the semi-major or\n        // semi-minor axis is much bigger than the other. Instead, scale the angle delta to make\n        // the distance along the ellipse boundary more closely match the granularity.\n        var granularity = options.granularity * 8.0;\n\n        var aSqr = semiMinorAxis * semiMinorAxis;\n        var bSqr = semiMajorAxis * semiMajorAxis;\n        var ab = semiMajorAxis * semiMinorAxis;\n\n        var mag = Cartesian3.magnitude(center);\n\n        var unitPos = Cartesian3.normalize(center, unitPosScratch);\n        var eastVec = Cartesian3.cross(Cartesian3.UNIT_Z, center, eastVecScratch);\n        eastVec = Cartesian3.normalize(eastVec, eastVec);\n        var northVec = Cartesian3.cross(unitPos, eastVec, northVecScratch);\n\n        // The number of points in the first quadrant\n        var numPts = 1 + Math.ceil(CesiumMath.PI_OVER_TWO / granularity);\n\n        var deltaTheta = CesiumMath.PI_OVER_TWO / (numPts - 1);\n        var theta = CesiumMath.PI_OVER_TWO - numPts * deltaTheta;\n        if (theta < 0.0) {\n            numPts -= Math.ceil(Math.abs(theta) / deltaTheta);\n        }\n\n        // If the number of points were three, the ellipse\n        // would be tessellated like below:\n        //\n        //         *---*\n        //       / | \\ | \\\n        //     *---*---*---*\n        //   / | \\ | \\ | \\ | \\\n        //  / .*---*---*---*. \\\n        // * ` | \\ | \\ | \\ | `*\n        //  \\`.*---*---*---*.`/\n        //   \\ | \\ | \\ | \\ | /\n        //     *---*---*---*\n        //       \\ | \\ | /\n        //         *---*\n        // The first and last column have one position and fan to connect to the adjacent column.\n        // Each other vertical column contains an even number of positions.\n        var size = 2 * (numPts * (numPts + 2));\n        var positions = (addFillPositions) ? new Array(size * 3) : undefined;\n        var positionIndex = 0;\n        var position = scratchCartesian1;\n        var reflectedPosition = scratchCartesian2;\n\n        var outerPositionsLength = (numPts * 4) * 3;\n        var outerRightIndex = outerPositionsLength - 1;\n        var outerLeftIndex = 0;\n        var outerPositions = (addEdgePositions) ? new Array(outerPositionsLength) : undefined;\n\n        var i;\n        var j;\n        var numInterior;\n        var t;\n        var interiorPosition;\n\n        // Compute points in the 'eastern' half of the ellipse\n        theta = CesiumMath.PI_OVER_TWO;\n        position = pointOnEllipsoid(theta, rotation, northVec, eastVec, aSqr, ab, bSqr, mag, unitPos, position);\n        if (addFillPositions) {\n            positions[positionIndex++] = position.x;\n            positions[positionIndex++] = position.y;\n            positions[positionIndex++] = position.z;\n        }\n        if (addEdgePositions) {\n            outerPositions[outerRightIndex--] = position.z;\n            outerPositions[outerRightIndex--] = position.y;\n            outerPositions[outerRightIndex--] = position.x;\n        }\n        theta = CesiumMath.PI_OVER_TWO -  deltaTheta;\n        for (i = 1; i < numPts + 1; ++i) {\n            position = pointOnEllipsoid(theta, rotation, northVec, eastVec, aSqr, ab, bSqr, mag, unitPos, position);\n            reflectedPosition = pointOnEllipsoid(Math.PI - theta, rotation, northVec, eastVec, aSqr, ab, bSqr, mag, unitPos, reflectedPosition);\n\n            if (addFillPositions) {\n                positions[positionIndex++] = position.x;\n                positions[positionIndex++] = position.y;\n                positions[positionIndex++] = position.z;\n\n                numInterior = 2 * i + 2;\n                for (j = 1; j < numInterior - 1; ++j) {\n                    t = j / (numInterior - 1);\n                    interiorPosition = Cartesian3.lerp(position, reflectedPosition, t, scratchCartesian3);\n                    positions[positionIndex++] = interiorPosition.x;\n                    positions[positionIndex++] = interiorPosition.y;\n                    positions[positionIndex++] = interiorPosition.z;\n                }\n\n                positions[positionIndex++] = reflectedPosition.x;\n                positions[positionIndex++] = reflectedPosition.y;\n                positions[positionIndex++] = reflectedPosition.z;\n            }\n\n            if (addEdgePositions) {\n                outerPositions[outerRightIndex--] = position.z;\n                outerPositions[outerRightIndex--] = position.y;\n                outerPositions[outerRightIndex--] = position.x;\n                outerPositions[outerLeftIndex++] = reflectedPosition.x;\n                outerPositions[outerLeftIndex++] = reflectedPosition.y;\n                outerPositions[outerLeftIndex++] = reflectedPosition.z;\n            }\n\n            theta = CesiumMath.PI_OVER_TWO - (i + 1) * deltaTheta;\n        }\n\n        // Compute points in the 'western' half of the ellipse\n        for (i = numPts; i > 1; --i) {\n            theta = CesiumMath.PI_OVER_TWO - (i - 1) * deltaTheta;\n\n            position = pointOnEllipsoid(-theta, rotation, northVec, eastVec, aSqr, ab, bSqr, mag, unitPos, position);\n            reflectedPosition = pointOnEllipsoid(theta + Math.PI, rotation, northVec, eastVec, aSqr, ab, bSqr, mag, unitPos, reflectedPosition);\n\n            if (addFillPositions) {\n                positions[positionIndex++] = position.x;\n                positions[positionIndex++] = position.y;\n                positions[positionIndex++] = position.z;\n\n                numInterior = 2 * (i - 1) + 2;\n                for (j = 1; j < numInterior - 1; ++j) {\n                    t = j / (numInterior - 1);\n                    interiorPosition = Cartesian3.lerp(position, reflectedPosition, t, scratchCartesian3);\n                    positions[positionIndex++] = interiorPosition.x;\n                    positions[positionIndex++] = interiorPosition.y;\n                    positions[positionIndex++] = interiorPosition.z;\n                }\n\n                positions[positionIndex++] = reflectedPosition.x;\n                positions[positionIndex++] = reflectedPosition.y;\n                positions[positionIndex++] = reflectedPosition.z;\n            }\n\n            if (addEdgePositions) {\n                outerPositions[outerRightIndex--] = position.z;\n                outerPositions[outerRightIndex--] = position.y;\n                outerPositions[outerRightIndex--] = position.x;\n                outerPositions[outerLeftIndex++] = reflectedPosition.x;\n                outerPositions[outerLeftIndex++] = reflectedPosition.y;\n                outerPositions[outerLeftIndex++] = reflectedPosition.z;\n            }\n        }\n\n        theta = CesiumMath.PI_OVER_TWO;\n        position = pointOnEllipsoid(-theta, rotation, northVec, eastVec, aSqr, ab, bSqr, mag, unitPos, position);\n\n        var r = {};\n        if (addFillPositions) {\n            positions[positionIndex++] = position.x;\n            positions[positionIndex++] = position.y;\n            positions[positionIndex++] = position.z;\n            r.positions = positions;\n            r.numPts = numPts;\n        }\n        if (addEdgePositions) {\n            outerPositions[outerRightIndex--] = position.z;\n            outerPositions[outerRightIndex--] = position.y;\n            outerPositions[outerRightIndex--] = position.x;\n            r.outerPositions = outerPositions;\n        }\n\n        return r;\n    };\nexport default EllipseGeometryLibrary;\n","import arrayFill from './arrayFill.js';\nimport BoundingSphere from './BoundingSphere.js';\nimport Cartesian2 from './Cartesian2.js';\nimport Cartesian3 from './Cartesian3.js';\nimport Cartographic from './Cartographic.js';\nimport Check from './Check.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport DeveloperError from './DeveloperError.js';\nimport EllipseGeometryLibrary from './EllipseGeometryLibrary.js';\nimport Ellipsoid from './Ellipsoid.js';\nimport GeographicProjection from './GeographicProjection.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport GeometryInstance from './GeometryInstance.js';\nimport GeometryOffsetAttribute from './GeometryOffsetAttribute.js';\nimport GeometryPipeline from './GeometryPipeline.js';\nimport IndexDatatype from './IndexDatatype.js';\nimport CesiumMath from './Math.js';\nimport Matrix3 from './Matrix3.js';\nimport PrimitiveType from './PrimitiveType.js';\nimport Quaternion from './Quaternion.js';\nimport Rectangle from './Rectangle.js';\nimport VertexFormat from './VertexFormat.js';\n\n    var scratchCartesian1 = new Cartesian3();\n    var scratchCartesian2 = new Cartesian3();\n    var scratchCartesian3 = new Cartesian3();\n    var scratchCartesian4 = new Cartesian3();\n    var texCoordScratch = new Cartesian2();\n    var textureMatrixScratch = new Matrix3();\n    var tangentMatrixScratch = new Matrix3();\n    var quaternionScratch = new Quaternion();\n\n    var scratchNormal = new Cartesian3();\n    var scratchTangent = new Cartesian3();\n    var scratchBitangent = new Cartesian3();\n\n    var scratchCartographic = new Cartographic();\n    var projectedCenterScratch = new Cartesian3();\n\n    var scratchMinTexCoord = new Cartesian2();\n    var scratchMaxTexCoord = new Cartesian2();\n\n    function computeTopBottomAttributes(positions, options, extrude) {\n        var vertexFormat = options.vertexFormat;\n        var center = options.center;\n        var semiMajorAxis = options.semiMajorAxis;\n        var semiMinorAxis = options.semiMinorAxis;\n        var ellipsoid = options.ellipsoid;\n        var stRotation = options.stRotation;\n        var size = (extrude) ? positions.length / 3 * 2 : positions.length / 3;\n        var shadowVolume = options.shadowVolume;\n\n        var textureCoordinates = (vertexFormat.st) ? new Float32Array(size * 2) : undefined;\n        var normals = (vertexFormat.normal) ? new Float32Array(size * 3) : undefined;\n        var tangents = (vertexFormat.tangent) ? new Float32Array(size * 3) : undefined;\n        var bitangents = (vertexFormat.bitangent) ? new Float32Array(size * 3) : undefined;\n\n        var extrudeNormals = (shadowVolume) ? new Float32Array(size * 3) : undefined;\n\n        var textureCoordIndex = 0;\n\n        // Raise positions to a height above the ellipsoid and compute the\n        // texture coordinates, normals, tangents, and bitangents.\n        var normal = scratchNormal;\n        var tangent = scratchTangent;\n        var bitangent = scratchBitangent;\n\n        var projection = new GeographicProjection(ellipsoid);\n        var projectedCenter = projection.project(ellipsoid.cartesianToCartographic(center, scratchCartographic), projectedCenterScratch);\n\n        var geodeticNormal = ellipsoid.scaleToGeodeticSurface(center, scratchCartesian1);\n        ellipsoid.geodeticSurfaceNormal(geodeticNormal, geodeticNormal);\n\n        var textureMatrix = textureMatrixScratch;\n        var tangentMatrix = tangentMatrixScratch;\n        if (stRotation !== 0) {\n            var rotation = Quaternion.fromAxisAngle(geodeticNormal, stRotation, quaternionScratch);\n            textureMatrix = Matrix3.fromQuaternion(rotation, textureMatrix);\n\n            rotation = Quaternion.fromAxisAngle(geodeticNormal, -stRotation, quaternionScratch);\n            tangentMatrix = Matrix3.fromQuaternion(rotation, tangentMatrix);\n        } else {\n            textureMatrix = Matrix3.clone(Matrix3.IDENTITY, textureMatrix);\n            tangentMatrix = Matrix3.clone(Matrix3.IDENTITY, tangentMatrix);\n        }\n\n        var minTexCoord = Cartesian2.fromElements(Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY, scratchMinTexCoord);\n        var maxTexCoord = Cartesian2.fromElements(Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY, scratchMaxTexCoord);\n\n        var length = positions.length;\n        var bottomOffset = (extrude) ? length : 0;\n        var stOffset = bottomOffset / 3 * 2;\n        for (var i = 0; i < length; i += 3) {\n            var i1 = i + 1;\n            var i2 = i + 2;\n            var position = Cartesian3.fromArray(positions, i, scratchCartesian1);\n\n            if (vertexFormat.st) {\n                var rotatedPoint = Matrix3.multiplyByVector(textureMatrix, position, scratchCartesian2);\n                var projectedPoint = projection.project(ellipsoid.cartesianToCartographic(rotatedPoint, scratchCartographic), scratchCartesian3);\n                Cartesian3.subtract(projectedPoint, projectedCenter, projectedPoint);\n\n                texCoordScratch.x = (projectedPoint.x + semiMajorAxis) / (2.0 * semiMajorAxis);\n                texCoordScratch.y = (projectedPoint.y + semiMinorAxis) / (2.0 * semiMinorAxis);\n\n                minTexCoord.x = Math.min(texCoordScratch.x, minTexCoord.x);\n                minTexCoord.y = Math.min(texCoordScratch.y, minTexCoord.y);\n                maxTexCoord.x = Math.max(texCoordScratch.x, maxTexCoord.x);\n                maxTexCoord.y = Math.max(texCoordScratch.y, maxTexCoord.y);\n\n                if (extrude) {\n                    textureCoordinates[textureCoordIndex + stOffset] = texCoordScratch.x;\n                    textureCoordinates[textureCoordIndex + 1 + stOffset] = texCoordScratch.y;\n                }\n\n                textureCoordinates[textureCoordIndex++] = texCoordScratch.x;\n                textureCoordinates[textureCoordIndex++] = texCoordScratch.y;\n            }\n\n            if (vertexFormat.normal || vertexFormat.tangent || vertexFormat.bitangent || shadowVolume) {\n                normal = ellipsoid.geodeticSurfaceNormal(position, normal);\n\n                if (shadowVolume) {\n                    extrudeNormals[i + bottomOffset] = -normal.x;\n                    extrudeNormals[i1 + bottomOffset] = -normal.y;\n                    extrudeNormals[i2 + bottomOffset] = -normal.z;\n                }\n\n                if (vertexFormat.normal || vertexFormat.tangent || vertexFormat.bitangent) {\n                    if (vertexFormat.tangent || vertexFormat.bitangent) {\n                        tangent = Cartesian3.normalize(Cartesian3.cross(Cartesian3.UNIT_Z, normal, tangent), tangent);\n                        Matrix3.multiplyByVector(tangentMatrix, tangent, tangent);\n                    }\n                    if (vertexFormat.normal) {\n                        normals[i] = normal.x;\n                        normals[i1] = normal.y;\n                        normals[i2] = normal.z;\n                        if (extrude) {\n                            normals[i + bottomOffset] = -normal.x;\n                            normals[i1 + bottomOffset] = -normal.y;\n                            normals[i2 + bottomOffset] = -normal.z;\n                        }\n                    }\n\n                    if (vertexFormat.tangent) {\n                        tangents[i] = tangent.x;\n                        tangents[i1] = tangent.y;\n                        tangents[i2] = tangent.z;\n                        if (extrude) {\n                            tangents[i + bottomOffset] = -tangent.x;\n                            tangents[i1 + bottomOffset] = -tangent.y;\n                            tangents[i2 + bottomOffset] = -tangent.z;\n                        }\n                    }\n\n                    if (vertexFormat.bitangent) {\n                        bitangent = Cartesian3.normalize(Cartesian3.cross(normal, tangent, bitangent), bitangent);\n                        bitangents[i ] = bitangent.x;\n                        bitangents[i1] = bitangent.y;\n                        bitangents[i2] = bitangent.z;\n                        if (extrude) {\n                            bitangents[i + bottomOffset] = bitangent.x;\n                            bitangents[i1 + bottomOffset] = bitangent.y;\n                            bitangents[i2 + bottomOffset] = bitangent.z;\n                        }\n                    }\n                }\n            }\n        }\n\n        if (vertexFormat.st) {\n            length = textureCoordinates.length;\n            for (var k = 0; k < length; k += 2) {\n                textureCoordinates[k] = (textureCoordinates[k] - minTexCoord.x) / (maxTexCoord.x - minTexCoord.x);\n                textureCoordinates[k + 1] = (textureCoordinates[k + 1] - minTexCoord.y) / (maxTexCoord.y - minTexCoord.y);\n            }\n        }\n\n        var attributes = new GeometryAttributes();\n\n        if (vertexFormat.position) {\n            var finalPositions = EllipseGeometryLibrary.raisePositionsToHeight(positions, options, extrude);\n            attributes.position = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.DOUBLE,\n                componentsPerAttribute : 3,\n                values : finalPositions\n            });\n        }\n\n        if (vertexFormat.st) {\n            attributes.st = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 2,\n                values : textureCoordinates\n            });\n        }\n\n        if (vertexFormat.normal) {\n            attributes.normal = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : normals\n            });\n        }\n\n        if (vertexFormat.tangent) {\n            attributes.tangent = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : tangents\n            });\n        }\n\n        if (vertexFormat.bitangent) {\n            attributes.bitangent = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : bitangents\n            });\n        }\n\n        if (shadowVolume) {\n            attributes.extrudeDirection = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : extrudeNormals\n            });\n        }\n\n        if (extrude && defined(options.offsetAttribute)) {\n            var offsetAttribute = new Uint8Array(size);\n            if (options.offsetAttribute === GeometryOffsetAttribute.TOP) {\n                offsetAttribute = arrayFill(offsetAttribute, 1, 0, size / 2);\n            } else {\n                var offsetValue = options.offsetAttribute === GeometryOffsetAttribute.NONE ? 0 : 1;\n                offsetAttribute = arrayFill(offsetAttribute, offsetValue);\n            }\n\n            attributes.applyOffset = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                componentsPerAttribute : 1,\n                values : offsetAttribute\n            });\n        }\n\n        return attributes;\n    }\n\n    function topIndices(numPts) {\n        // numTriangles in half = 3 + 8 + 12 + ... = -1 + 4 + (4 + 4) + (4 + 4 + 4) + ... = -1 + 4 * (1 + 2 + 3 + ...)\n        //              = -1 + 4 * ((n * ( n + 1)) / 2)\n        // total triangles = 2 * numTrangles in half\n        // indices = total triangles * 3;\n        // Substitute numPts for n above\n\n        var indices = new Array(12 * (numPts * ( numPts + 1)) - 6);\n        var indicesIndex = 0;\n        var prevIndex;\n        var numInterior;\n        var positionIndex;\n        var i;\n        var j;\n        // Indices triangles to the 'right' of the north vector\n\n        prevIndex = 0;\n        positionIndex = 1;\n        for (i = 0; i < 3; i++) {\n            indices[indicesIndex++] = positionIndex++;\n            indices[indicesIndex++] = prevIndex;\n            indices[indicesIndex++] = positionIndex;\n        }\n\n        for (i = 2; i < numPts + 1; ++i) {\n            positionIndex = i * (i + 1) - 1;\n            prevIndex = (i - 1) * i - 1;\n\n            indices[indicesIndex++] = positionIndex++;\n            indices[indicesIndex++] = prevIndex;\n            indices[indicesIndex++] = positionIndex;\n\n            numInterior = 2 * i;\n            for (j = 0; j < numInterior - 1; ++j) {\n\n                indices[indicesIndex++] = positionIndex;\n                indices[indicesIndex++] = prevIndex++;\n                indices[indicesIndex++] = prevIndex;\n\n                indices[indicesIndex++] = positionIndex++;\n                indices[indicesIndex++] = prevIndex;\n                indices[indicesIndex++] = positionIndex;\n            }\n\n            indices[indicesIndex++] = positionIndex++;\n            indices[indicesIndex++] = prevIndex;\n            indices[indicesIndex++] = positionIndex;\n        }\n\n        // Indices for center column of triangles\n        numInterior = numPts * 2;\n        ++positionIndex;\n        ++prevIndex;\n        for (i = 0; i < numInterior - 1; ++i) {\n            indices[indicesIndex++] = positionIndex;\n            indices[indicesIndex++] = prevIndex++;\n            indices[indicesIndex++] = prevIndex;\n\n            indices[indicesIndex++] = positionIndex++;\n            indices[indicesIndex++] = prevIndex;\n            indices[indicesIndex++] = positionIndex;\n        }\n\n        indices[indicesIndex++] = positionIndex;\n        indices[indicesIndex++] = prevIndex++;\n        indices[indicesIndex++] = prevIndex;\n\n        indices[indicesIndex++] = positionIndex++;\n        indices[indicesIndex++] = prevIndex++;\n        indices[indicesIndex++] = prevIndex;\n\n        // Reverse the process creating indices to the 'left' of the north vector\n        ++prevIndex;\n        for (i = numPts - 1; i > 1; --i) {\n            indices[indicesIndex++] = prevIndex++;\n            indices[indicesIndex++] = prevIndex;\n            indices[indicesIndex++] = positionIndex;\n\n            numInterior = 2 * i;\n            for (j = 0; j < numInterior - 1; ++j) {\n                indices[indicesIndex++] = positionIndex;\n                indices[indicesIndex++] = prevIndex++;\n                indices[indicesIndex++] = prevIndex;\n\n                indices[indicesIndex++] = positionIndex++;\n                indices[indicesIndex++] = prevIndex;\n                indices[indicesIndex++] = positionIndex;\n            }\n\n            indices[indicesIndex++] = prevIndex++;\n            indices[indicesIndex++] = prevIndex++;\n            indices[indicesIndex++] = positionIndex++;\n        }\n\n        for (i = 0; i < 3; i++) {\n            indices[indicesIndex++] = prevIndex++;\n            indices[indicesIndex++] = prevIndex;\n            indices[indicesIndex++] = positionIndex;\n        }\n        return indices;\n    }\n\n    var boundingSphereCenter = new Cartesian3();\n\n    function computeEllipse(options) {\n        var center = options.center;\n        boundingSphereCenter = Cartesian3.multiplyByScalar(options.ellipsoid.geodeticSurfaceNormal(center, boundingSphereCenter), options.height, boundingSphereCenter);\n        boundingSphereCenter = Cartesian3.add(center, boundingSphereCenter, boundingSphereCenter);\n        var boundingSphere = new BoundingSphere(boundingSphereCenter, options.semiMajorAxis);\n        var cep = EllipseGeometryLibrary.computeEllipsePositions(options, true, false);\n        var positions = cep.positions;\n        var numPts = cep.numPts;\n        var attributes = computeTopBottomAttributes(positions, options, false);\n        var indices = topIndices(numPts);\n        indices = IndexDatatype.createTypedArray(positions.length / 3, indices);\n        return {\n            boundingSphere : boundingSphere,\n            attributes : attributes,\n            indices : indices\n        };\n    }\n\n    function computeWallAttributes(positions, options) {\n        var vertexFormat = options.vertexFormat;\n        var center = options.center;\n        var semiMajorAxis = options.semiMajorAxis;\n        var semiMinorAxis = options.semiMinorAxis;\n        var ellipsoid = options.ellipsoid;\n        var height = options.height;\n        var extrudedHeight = options.extrudedHeight;\n        var stRotation = options.stRotation;\n        var size = positions.length / 3 * 2;\n\n        var finalPositions = new Float64Array(size * 3);\n        var textureCoordinates = (vertexFormat.st) ? new Float32Array(size * 2) : undefined;\n        var normals = (vertexFormat.normal) ? new Float32Array(size * 3) : undefined;\n        var tangents = (vertexFormat.tangent) ? new Float32Array(size * 3) : undefined;\n        var bitangents = (vertexFormat.bitangent) ? new Float32Array(size * 3) : undefined;\n\n        var shadowVolume = options.shadowVolume;\n        var extrudeNormals = (shadowVolume) ? new Float32Array(size * 3) : undefined;\n\n        var textureCoordIndex = 0;\n\n        // Raise positions to a height above the ellipsoid and compute the\n        // texture coordinates, normals, tangents, and bitangents.\n        var normal = scratchNormal;\n        var tangent = scratchTangent;\n        var bitangent = scratchBitangent;\n\n        var projection = new GeographicProjection(ellipsoid);\n        var projectedCenter = projection.project(ellipsoid.cartesianToCartographic(center, scratchCartographic), projectedCenterScratch);\n\n        var geodeticNormal = ellipsoid.scaleToGeodeticSurface(center, scratchCartesian1);\n        ellipsoid.geodeticSurfaceNormal(geodeticNormal, geodeticNormal);\n        var rotation = Quaternion.fromAxisAngle(geodeticNormal, stRotation, quaternionScratch);\n        var textureMatrix = Matrix3.fromQuaternion(rotation, textureMatrixScratch);\n\n        var minTexCoord = Cartesian2.fromElements(Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY, scratchMinTexCoord);\n        var maxTexCoord = Cartesian2.fromElements(Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY, scratchMaxTexCoord);\n\n        var length = positions.length;\n        var stOffset = length / 3 * 2;\n        for (var i = 0; i < length; i += 3) {\n            var i1 = i + 1;\n            var i2 = i + 2;\n            var position = Cartesian3.fromArray(positions, i, scratchCartesian1);\n            var extrudedPosition;\n\n            if (vertexFormat.st) {\n                var rotatedPoint = Matrix3.multiplyByVector(textureMatrix, position, scratchCartesian2);\n                var projectedPoint = projection.project(ellipsoid.cartesianToCartographic(rotatedPoint, scratchCartographic), scratchCartesian3);\n                Cartesian3.subtract(projectedPoint, projectedCenter, projectedPoint);\n\n                texCoordScratch.x = (projectedPoint.x + semiMajorAxis) / (2.0 * semiMajorAxis);\n                texCoordScratch.y = (projectedPoint.y + semiMinorAxis) / (2.0 * semiMinorAxis);\n\n                minTexCoord.x = Math.min(texCoordScratch.x, minTexCoord.x);\n                minTexCoord.y = Math.min(texCoordScratch.y, minTexCoord.y);\n                maxTexCoord.x = Math.max(texCoordScratch.x, maxTexCoord.x);\n                maxTexCoord.y = Math.max(texCoordScratch.y, maxTexCoord.y);\n\n                textureCoordinates[textureCoordIndex + stOffset] = texCoordScratch.x;\n                textureCoordinates[textureCoordIndex + 1 + stOffset] = texCoordScratch.y;\n\n                textureCoordinates[textureCoordIndex++] = texCoordScratch.x;\n                textureCoordinates[textureCoordIndex++] = texCoordScratch.y;\n            }\n\n            position = ellipsoid.scaleToGeodeticSurface(position, position);\n            extrudedPosition = Cartesian3.clone(position, scratchCartesian2);\n            normal = ellipsoid.geodeticSurfaceNormal(position, normal);\n\n            if (shadowVolume) {\n                extrudeNormals[i + length] = -normal.x;\n                extrudeNormals[i1 + length] = -normal.y;\n                extrudeNormals[i2 + length] = -normal.z;\n            }\n\n            var scaledNormal = Cartesian3.multiplyByScalar(normal, height, scratchCartesian4);\n            position = Cartesian3.add(position, scaledNormal, position);\n            scaledNormal = Cartesian3.multiplyByScalar(normal, extrudedHeight, scaledNormal);\n            extrudedPosition = Cartesian3.add(extrudedPosition, scaledNormal, extrudedPosition);\n\n            if (vertexFormat.position) {\n                finalPositions[i + length] = extrudedPosition.x;\n                finalPositions[i1 + length] = extrudedPosition.y;\n                finalPositions[i2 + length] = extrudedPosition.z;\n\n                finalPositions[i] = position.x;\n                finalPositions[i1] = position.y;\n                finalPositions[i2] = position.z;\n            }\n\n            if (vertexFormat.normal || vertexFormat.tangent || vertexFormat.bitangent) {\n\n                bitangent = Cartesian3.clone(normal, bitangent);\n                var next = Cartesian3.fromArray(positions, (i + 3) % length, scratchCartesian4);\n                Cartesian3.subtract(next, position, next);\n                var bottom = Cartesian3.subtract(extrudedPosition, position, scratchCartesian3);\n\n                normal = Cartesian3.normalize(Cartesian3.cross(bottom, next, normal), normal);\n\n                if (vertexFormat.normal) {\n                    normals[i] = normal.x;\n                    normals[i1] = normal.y;\n                    normals[i2] = normal.z;\n\n                    normals[i + length] = normal.x;\n                    normals[i1 + length] = normal.y;\n                    normals[i2 + length] = normal.z;\n                }\n\n                if (vertexFormat.tangent) {\n                    tangent = Cartesian3.normalize(Cartesian3.cross(bitangent, normal, tangent), tangent);\n                    tangents[i] = tangent.x;\n                    tangents[i1] = tangent.y;\n                    tangents[i2] = tangent.z;\n\n                    tangents[i + length] = tangent.x;\n                    tangents[i + 1 + length] = tangent.y;\n                    tangents[i + 2 + length] = tangent.z;\n                }\n\n                if (vertexFormat.bitangent) {\n                    bitangents[i ] = bitangent.x;\n                    bitangents[i1] = bitangent.y;\n                    bitangents[i2] = bitangent.z;\n\n                    bitangents[i + length] = bitangent.x;\n                    bitangents[i1 + length] = bitangent.y;\n                    bitangents[i2 + length] = bitangent.z;\n                }\n            }\n        }\n\n        if (vertexFormat.st) {\n            length = textureCoordinates.length;\n            for (var k = 0; k < length; k += 2) {\n                textureCoordinates[k] = (textureCoordinates[k] - minTexCoord.x) / (maxTexCoord.x - minTexCoord.x);\n                textureCoordinates[k + 1] = (textureCoordinates[k + 1] - minTexCoord.y) / (maxTexCoord.y - minTexCoord.y);\n            }\n        }\n\n        var attributes = new GeometryAttributes();\n\n        if (vertexFormat.position) {\n            attributes.position = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.DOUBLE,\n                componentsPerAttribute : 3,\n                values : finalPositions\n            });\n        }\n\n        if (vertexFormat.st) {\n            attributes.st = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 2,\n                values : textureCoordinates\n            });\n        }\n\n        if (vertexFormat.normal) {\n            attributes.normal = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : normals\n            });\n        }\n\n        if (vertexFormat.tangent) {\n            attributes.tangent = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : tangents\n            });\n        }\n\n        if (vertexFormat.bitangent) {\n            attributes.bitangent = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : bitangents\n            });\n        }\n\n        if (shadowVolume) {\n            attributes.extrudeDirection = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : extrudeNormals\n            });\n        }\n\n        if (defined(options.offsetAttribute)) {\n            var offsetAttribute = new Uint8Array(size);\n            if (options.offsetAttribute === GeometryOffsetAttribute.TOP) {\n                offsetAttribute = arrayFill(offsetAttribute, 1, 0, size / 2);\n            } else {\n                var offsetValue = options.offsetAttribute === GeometryOffsetAttribute.NONE ? 0 : 1;\n                offsetAttribute = arrayFill(offsetAttribute, offsetValue);\n            }\n            attributes.applyOffset = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                componentsPerAttribute : 1,\n                values : offsetAttribute\n            });\n        }\n\n        return attributes;\n    }\n\n    function computeWallIndices(positions) {\n        var length = positions.length / 3;\n        var indices = IndexDatatype.createTypedArray(length, length * 6);\n        var index = 0;\n        for (var i = 0; i < length; i++) {\n            var UL = i;\n            var LL = i + length;\n            var UR = (UL + 1) % length;\n            var LR = UR + length;\n            indices[index++] = UL;\n            indices[index++] = LL;\n            indices[index++] = UR;\n            indices[index++] = UR;\n            indices[index++] = LL;\n            indices[index++] = LR;\n        }\n\n        return indices;\n    }\n\n    var topBoundingSphere = new BoundingSphere();\n    var bottomBoundingSphere = new BoundingSphere();\n\n    function computeExtrudedEllipse(options) {\n        var center = options.center;\n        var ellipsoid = options.ellipsoid;\n        var semiMajorAxis = options.semiMajorAxis;\n        var scaledNormal = Cartesian3.multiplyByScalar(ellipsoid.geodeticSurfaceNormal(center, scratchCartesian1), options.height, scratchCartesian1);\n        topBoundingSphere.center = Cartesian3.add(center, scaledNormal, topBoundingSphere.center);\n        topBoundingSphere.radius = semiMajorAxis;\n\n        scaledNormal = Cartesian3.multiplyByScalar(ellipsoid.geodeticSurfaceNormal(center, scaledNormal), options.extrudedHeight, scaledNormal);\n        bottomBoundingSphere.center = Cartesian3.add(center, scaledNormal, bottomBoundingSphere.center);\n        bottomBoundingSphere.radius = semiMajorAxis;\n\n        var cep = EllipseGeometryLibrary.computeEllipsePositions(options, true, true);\n        var positions = cep.positions;\n        var numPts = cep.numPts;\n        var outerPositions = cep.outerPositions;\n        var boundingSphere = BoundingSphere.union(topBoundingSphere, bottomBoundingSphere);\n        var topBottomAttributes = computeTopBottomAttributes(positions, options, true);\n        var indices = topIndices(numPts);\n        var length = indices.length;\n        indices.length = length * 2;\n        var posLength = positions.length / 3;\n        for (var i = 0; i < length; i += 3) {\n            indices[i + length] = indices[i + 2] + posLength;\n            indices[i + 1 + length] = indices[i + 1] + posLength;\n            indices[i + 2 + length] = indices[i] + posLength;\n        }\n\n        var topBottomIndices = IndexDatatype.createTypedArray(posLength * 2 / 3, indices);\n\n        var topBottomGeo = new Geometry({\n            attributes : topBottomAttributes,\n            indices : topBottomIndices,\n            primitiveType : PrimitiveType.TRIANGLES\n        });\n\n        var wallAttributes = computeWallAttributes(outerPositions, options);\n        indices = computeWallIndices(outerPositions);\n        var wallIndices = IndexDatatype.createTypedArray(outerPositions.length * 2 / 3, indices);\n\n        var wallGeo = new Geometry({\n            attributes : wallAttributes,\n            indices : wallIndices,\n            primitiveType : PrimitiveType.TRIANGLES\n        });\n\n        var geo = GeometryPipeline.combineInstances([\n            new GeometryInstance({\n                geometry : topBottomGeo\n            }),\n            new GeometryInstance({\n                geometry : wallGeo\n            })\n        ]);\n\n        return {\n            boundingSphere : boundingSphere,\n            attributes : geo[0].attributes,\n            indices : geo[0].indices\n        };\n    }\n\n    function computeRectangle(center, semiMajorAxis, semiMinorAxis, rotation, granularity, ellipsoid, result) {\n        var cep = EllipseGeometryLibrary.computeEllipsePositions({\n            center : center,\n            semiMajorAxis : semiMajorAxis,\n            semiMinorAxis : semiMinorAxis,\n            rotation : rotation,\n            granularity : granularity\n        }, false, true);\n        var positionsFlat = cep.outerPositions;\n        var positionsCount = positionsFlat.length / 3;\n        var positions = new Array(positionsCount);\n        for (var i = 0; i < positionsCount; ++i) {\n            positions[i] = Cartesian3.fromArray(positionsFlat, i * 3);\n        }\n        var rectangle = Rectangle.fromCartesianArray(positions, ellipsoid, result);\n        // Rectangle width goes beyond 180 degrees when the ellipse crosses a pole.\n        // When this happens, make the rectangle into a \"circle\" around the pole\n        if (rectangle.width > CesiumMath.PI) {\n            rectangle.north = rectangle.north > 0.0 ? CesiumMath.PI_OVER_TWO - CesiumMath.EPSILON7 : rectangle.north;\n            rectangle.south = rectangle.south < 0.0 ? CesiumMath.EPSILON7 - CesiumMath.PI_OVER_TWO : rectangle.south;\n            rectangle.east = CesiumMath.PI;\n            rectangle.west = -CesiumMath.PI;\n        }\n        return rectangle;\n    }\n\n    /**\n     * A description of an ellipse on an ellipsoid. Ellipse geometry can be rendered with both {@link Primitive} and {@link GroundPrimitive}.\n     *\n     * @alias EllipseGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3} options.center The ellipse's center point in the fixed frame.\n     * @param {Number} options.semiMajorAxis The length of the ellipse's semi-major axis in meters.\n     * @param {Number} options.semiMinorAxis The length of the ellipse's semi-minor axis in meters.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid the ellipse will be on.\n     * @param {Number} [options.height=0.0] The distance in meters between the ellipse and the ellipsoid surface.\n     * @param {Number} [options.extrudedHeight] The distance in meters between the ellipse's extruded face and the ellipsoid surface.\n     * @param {Number} [options.rotation=0.0] The angle of rotation counter-clockwise from north.\n     * @param {Number} [options.stRotation=0.0] The rotation of the texture coordinates counter-clockwise from north.\n     * @param {Number} [options.granularity=CesiumMath.RADIANS_PER_DEGREE] The angular distance between points on the ellipse in radians.\n     * @param {VertexFormat} [options.vertexFormat=VertexFormat.DEFAULT] The vertex attributes to be computed.\n     *\n     * @exception {DeveloperError} semiMajorAxis and semiMinorAxis must be greater than zero.\n     * @exception {DeveloperError} semiMajorAxis must be greater than or equal to the semiMinorAxis.\n     * @exception {DeveloperError} granularity must be greater than zero.\n     *\n     *\n     * @example\n     * // Create an ellipse.\n     * var ellipse = new Cesium.EllipseGeometry({\n     *   center : Cesium.Cartesian3.fromDegrees(-75.59777, 40.03883),\n     *   semiMajorAxis : 500000.0,\n     *   semiMinorAxis : 300000.0,\n     *   rotation : Cesium.Math.toRadians(60.0)\n     * });\n     * var geometry = Cesium.EllipseGeometry.createGeometry(ellipse);\n     *\n     * @see EllipseGeometry.createGeometry\n     */\n    function EllipseGeometry(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        var center = options.center;\n        var ellipsoid = defaultValue(options.ellipsoid, Ellipsoid.WGS84);\n        var semiMajorAxis = options.semiMajorAxis;\n        var semiMinorAxis = options.semiMinorAxis;\n        var granularity = defaultValue(options.granularity, CesiumMath.RADIANS_PER_DEGREE);\n        var vertexFormat = defaultValue(options.vertexFormat, VertexFormat.DEFAULT);\n\n        \n\n        var height = defaultValue(options.height, 0.0);\n        var extrudedHeight = defaultValue(options.extrudedHeight, height);\n\n        this._center = Cartesian3.clone(center);\n        this._semiMajorAxis = semiMajorAxis;\n        this._semiMinorAxis = semiMinorAxis;\n        this._ellipsoid = Ellipsoid.clone(ellipsoid);\n        this._rotation = defaultValue(options.rotation, 0.0);\n        this._stRotation = defaultValue(options.stRotation, 0.0);\n        this._height = Math.max(extrudedHeight, height);\n        this._granularity = granularity;\n        this._vertexFormat = VertexFormat.clone(vertexFormat);\n        this._extrudedHeight = Math.min(extrudedHeight, height);\n        this._shadowVolume = defaultValue(options.shadowVolume, false);\n        this._workerName = 'createEllipseGeometry';\n        this._offsetAttribute = options.offsetAttribute;\n\n        this._rectangle = undefined;\n        this._textureCoordinateRotationPoints = undefined;\n    }\n\n    /**\n     * The number of elements used to pack the object into an array.\n     * @type {Number}\n     */\n    EllipseGeometry.packedLength = Cartesian3.packedLength + Ellipsoid.packedLength + VertexFormat.packedLength + 9;\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {EllipseGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    EllipseGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        Cartesian3.pack(value._center, array, startingIndex);\n        startingIndex += Cartesian3.packedLength;\n\n        Ellipsoid.pack(value._ellipsoid, array, startingIndex);\n        startingIndex += Ellipsoid.packedLength;\n\n        VertexFormat.pack(value._vertexFormat, array, startingIndex);\n        startingIndex += VertexFormat.packedLength;\n\n        array[startingIndex++] = value._semiMajorAxis;\n        array[startingIndex++] = value._semiMinorAxis;\n        array[startingIndex++] = value._rotation;\n        array[startingIndex++] = value._stRotation;\n        array[startingIndex++] = value._height;\n        array[startingIndex++] = value._granularity;\n        array[startingIndex++] = value._extrudedHeight;\n        array[startingIndex++] = value._shadowVolume ? 1.0 : 0.0;\n        array[startingIndex] = defaultValue(value._offsetAttribute, -1);\n\n        return array;\n    };\n\n    var scratchCenter = new Cartesian3();\n    var scratchEllipsoid = new Ellipsoid();\n    var scratchVertexFormat = new VertexFormat();\n    var scratchOptions = {\n        center : scratchCenter,\n        ellipsoid : scratchEllipsoid,\n        vertexFormat : scratchVertexFormat,\n        semiMajorAxis : undefined,\n        semiMinorAxis : undefined,\n        rotation : undefined,\n        stRotation : undefined,\n        height : undefined,\n        granularity : undefined,\n        extrudedHeight : undefined,\n        shadowVolume: undefined,\n        offsetAttribute: undefined\n    };\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {EllipseGeometry} [result] The object into which to store the result.\n     * @returns {EllipseGeometry} The modified result parameter or a new EllipseGeometry instance if one was not provided.\n     */\n    EllipseGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var center = Cartesian3.unpack(array, startingIndex, scratchCenter);\n        startingIndex += Cartesian3.packedLength;\n\n        var ellipsoid = Ellipsoid.unpack(array, startingIndex, scratchEllipsoid);\n        startingIndex += Ellipsoid.packedLength;\n\n        var vertexFormat = VertexFormat.unpack(array, startingIndex, scratchVertexFormat);\n        startingIndex += VertexFormat.packedLength;\n\n        var semiMajorAxis = array[startingIndex++];\n        var semiMinorAxis = array[startingIndex++];\n        var rotation = array[startingIndex++];\n        var stRotation = array[startingIndex++];\n        var height = array[startingIndex++];\n        var granularity = array[startingIndex++];\n        var extrudedHeight = array[startingIndex++];\n        var shadowVolume = array[startingIndex++] === 1.0;\n        var offsetAttribute = array[startingIndex];\n\n        if (!defined(result)) {\n            scratchOptions.height = height;\n            scratchOptions.extrudedHeight = extrudedHeight;\n            scratchOptions.granularity = granularity;\n            scratchOptions.stRotation = stRotation;\n            scratchOptions.rotation = rotation;\n            scratchOptions.semiMajorAxis = semiMajorAxis;\n            scratchOptions.semiMinorAxis = semiMinorAxis;\n            scratchOptions.shadowVolume = shadowVolume;\n            scratchOptions.offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n\n            return new EllipseGeometry(scratchOptions);\n        }\n\n        result._center = Cartesian3.clone(center, result._center);\n        result._ellipsoid = Ellipsoid.clone(ellipsoid, result._ellipsoid);\n        result._vertexFormat = VertexFormat.clone(vertexFormat, result._vertexFormat);\n        result._semiMajorAxis = semiMajorAxis;\n        result._semiMinorAxis = semiMinorAxis;\n        result._rotation = rotation;\n        result._stRotation = stRotation;\n        result._height = height;\n        result._granularity = granularity;\n        result._extrudedHeight = extrudedHeight;\n        result._shadowVolume = shadowVolume;\n        result._offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n\n        return result;\n    };\n\n    /**\n     * Computes the bounding rectangle based on the provided options\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3} options.center The ellipse's center point in the fixed frame.\n     * @param {Number} options.semiMajorAxis The length of the ellipse's semi-major axis in meters.\n     * @param {Number} options.semiMinorAxis The length of the ellipse's semi-minor axis in meters.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid the ellipse will be on.\n     * @param {Number} [options.rotation=0.0] The angle of rotation counter-clockwise from north.\n     * @param {Number} [options.granularity=CesiumMath.RADIANS_PER_DEGREE] The angular distance between points on the ellipse in radians.\n     * @param {Rectangle} [result] An object in which to store the result\n     *\n     * @returns {Rectangle} The result rectangle\n     */\n    EllipseGeometry.computeRectangle = function(options, result) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        var center = options.center;\n        var ellipsoid = defaultValue(options.ellipsoid, Ellipsoid.WGS84);\n        var semiMajorAxis = options.semiMajorAxis;\n        var semiMinorAxis = options.semiMinorAxis;\n        var granularity = defaultValue(options.granularity, CesiumMath.RADIANS_PER_DEGREE);\n        var rotation = defaultValue(options.rotation, 0.0);\n\n        \n\n        return computeRectangle(center, semiMajorAxis, semiMinorAxis, rotation, granularity, ellipsoid, result);\n    };\n\n    /**\n     * Computes the geometric representation of a ellipse on an ellipsoid, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {EllipseGeometry} ellipseGeometry A description of the ellipse.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    EllipseGeometry.createGeometry = function(ellipseGeometry) {\n        if ((ellipseGeometry._semiMajorAxis <= 0.0) || (ellipseGeometry._semiMinorAxis <= 0.0)) {\n            return;\n        }\n\n        var height = ellipseGeometry._height;\n        var extrudedHeight = ellipseGeometry._extrudedHeight;\n        var extrude = !CesiumMath.equalsEpsilon(height, extrudedHeight, 0, CesiumMath.EPSILON2);\n\n        ellipseGeometry._center = ellipseGeometry._ellipsoid.scaleToGeodeticSurface(ellipseGeometry._center, ellipseGeometry._center);\n        var options = {\n            center : ellipseGeometry._center,\n            semiMajorAxis : ellipseGeometry._semiMajorAxis,\n            semiMinorAxis : ellipseGeometry._semiMinorAxis,\n            ellipsoid : ellipseGeometry._ellipsoid,\n            rotation : ellipseGeometry._rotation,\n            height : height,\n            granularity : ellipseGeometry._granularity,\n            vertexFormat : ellipseGeometry._vertexFormat,\n            stRotation : ellipseGeometry._stRotation\n        };\n        var geometry;\n        if (extrude) {\n            options.extrudedHeight = extrudedHeight;\n            options.shadowVolume = ellipseGeometry._shadowVolume;\n            options.offsetAttribute = ellipseGeometry._offsetAttribute;\n            geometry = computeExtrudedEllipse(options);\n        } else {\n            geometry = computeEllipse(options);\n\n            if (defined(ellipseGeometry._offsetAttribute)) {\n                var length = geometry.attributes.position.values.length;\n                var applyOffset = new Uint8Array(length / 3);\n                var offsetValue = ellipseGeometry._offsetAttribute === GeometryOffsetAttribute.NONE ? 0 : 1;\n                arrayFill(applyOffset, offsetValue);\n                geometry.attributes.applyOffset = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                    componentsPerAttribute : 1,\n                    values: applyOffset\n                });\n            }\n        }\n\n        return new Geometry({\n            attributes : geometry.attributes,\n            indices : geometry.indices,\n            primitiveType : PrimitiveType.TRIANGLES,\n            boundingSphere : geometry.boundingSphere,\n            offsetAttribute : ellipseGeometry._offsetAttribute\n        });\n    };\n\n    /**\n     * @private\n     */\n    EllipseGeometry.createShadowVolume = function(ellipseGeometry, minHeightFunc, maxHeightFunc) {\n        var granularity = ellipseGeometry._granularity;\n        var ellipsoid = ellipseGeometry._ellipsoid;\n\n        var minHeight = minHeightFunc(granularity, ellipsoid);\n        var maxHeight = maxHeightFunc(granularity, ellipsoid);\n\n        return new EllipseGeometry({\n            center : ellipseGeometry._center,\n            semiMajorAxis : ellipseGeometry._semiMajorAxis,\n            semiMinorAxis : ellipseGeometry._semiMinorAxis,\n            ellipsoid : ellipsoid,\n            rotation : ellipseGeometry._rotation,\n            stRotation : ellipseGeometry._stRotation,\n            granularity : granularity,\n            extrudedHeight : minHeight,\n            height : maxHeight,\n            vertexFormat : VertexFormat.POSITION_ONLY,\n            shadowVolume: true\n        });\n    };\n\n    function textureCoordinateRotationPoints(ellipseGeometry) {\n        var stRotation = -ellipseGeometry._stRotation;\n        if (stRotation === 0.0) {\n            return [0, 0, 0, 1, 1, 0];\n        }\n\n        var cep = EllipseGeometryLibrary.computeEllipsePositions({\n            center : ellipseGeometry._center,\n            semiMajorAxis : ellipseGeometry._semiMajorAxis,\n            semiMinorAxis : ellipseGeometry._semiMinorAxis,\n            rotation : ellipseGeometry._rotation,\n            granularity : ellipseGeometry._granularity\n        }, false, true);\n        var positionsFlat = cep.outerPositions;\n        var positionsCount = positionsFlat.length / 3;\n        var positions = new Array(positionsCount);\n        for (var i = 0; i < positionsCount; ++i) {\n            positions[i] = Cartesian3.fromArray(positionsFlat, i * 3);\n        }\n\n        var ellipsoid = ellipseGeometry._ellipsoid;\n        var boundingRectangle = ellipseGeometry.rectangle;\n        return Geometry._textureCoordinateRotationPoints(positions, stRotation, ellipsoid, boundingRectangle);\n    }\n\n    Object.defineProperties(EllipseGeometry.prototype, {\n        /**\n         * @private\n         */\n        rectangle : {\n            get : function() {\n                if (!defined(this._rectangle)) {\n                    this._rectangle = computeRectangle(this._center, this._semiMajorAxis, this._semiMinorAxis, this._rotation, this._granularity, this._ellipsoid);\n                }\n                return this._rectangle;\n            }\n        },\n        /**\n         * For remapping texture coordinates when rendering EllipseGeometries as GroundPrimitives.\n         * @private\n         */\n        textureCoordinateRotationPoints : {\n            get : function() {\n                if (!defined(this._textureCoordinateRotationPoints)) {\n                    this._textureCoordinateRotationPoints = textureCoordinateRotationPoints(this);\n                }\n                return this._textureCoordinateRotationPoints;\n            }\n        }\n    });\nexport default EllipseGeometry;\n","import arrayFill from './arrayFill.js';\nimport BoundingSphere from './BoundingSphere.js';\nimport Cartesian3 from './Cartesian3.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport DeveloperError from './DeveloperError.js';\nimport EllipseGeometryLibrary from './EllipseGeometryLibrary.js';\nimport Ellipsoid from './Ellipsoid.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport GeometryOffsetAttribute from './GeometryOffsetAttribute.js';\nimport IndexDatatype from './IndexDatatype.js';\nimport CesiumMath from './Math.js';\nimport PrimitiveType from './PrimitiveType.js';\n\n    var scratchCartesian1 = new Cartesian3();\n    var boundingSphereCenter = new Cartesian3();\n\n    function computeEllipse(options) {\n        var center = options.center;\n        boundingSphereCenter = Cartesian3.multiplyByScalar(options.ellipsoid.geodeticSurfaceNormal(center, boundingSphereCenter), options.height, boundingSphereCenter);\n        boundingSphereCenter = Cartesian3.add(center, boundingSphereCenter, boundingSphereCenter);\n        var boundingSphere = new BoundingSphere(boundingSphereCenter, options.semiMajorAxis);\n        var positions = EllipseGeometryLibrary.computeEllipsePositions(options, false, true).outerPositions;\n\n        var attributes = new GeometryAttributes({\n            position: new GeometryAttribute({\n                componentDatatype : ComponentDatatype.DOUBLE,\n                componentsPerAttribute : 3,\n                values : EllipseGeometryLibrary.raisePositionsToHeight(positions, options, false)\n            })\n        });\n\n        var length = positions.length / 3;\n        var indices = IndexDatatype.createTypedArray(length, length * 2);\n        var index = 0;\n        for ( var i = 0; i < length; ++i) {\n            indices[index++] = i;\n            indices[index++] = (i + 1) % length;\n        }\n\n        return {\n            boundingSphere : boundingSphere,\n            attributes : attributes,\n            indices : indices\n        };\n    }\n\n    var topBoundingSphere = new BoundingSphere();\n    var bottomBoundingSphere = new BoundingSphere();\n    function computeExtrudedEllipse(options) {\n        var center = options.center;\n        var ellipsoid = options.ellipsoid;\n        var semiMajorAxis = options.semiMajorAxis;\n        var scaledNormal = Cartesian3.multiplyByScalar(ellipsoid.geodeticSurfaceNormal(center, scratchCartesian1), options.height, scratchCartesian1);\n        topBoundingSphere.center = Cartesian3.add(center, scaledNormal, topBoundingSphere.center);\n        topBoundingSphere.radius = semiMajorAxis;\n\n        scaledNormal = Cartesian3.multiplyByScalar(ellipsoid.geodeticSurfaceNormal(center, scaledNormal), options.extrudedHeight, scaledNormal);\n        bottomBoundingSphere.center = Cartesian3.add(center, scaledNormal, bottomBoundingSphere.center);\n        bottomBoundingSphere.radius = semiMajorAxis;\n\n        var positions = EllipseGeometryLibrary.computeEllipsePositions(options, false, true).outerPositions;\n        var attributes = new GeometryAttributes({\n            position: new GeometryAttribute({\n                componentDatatype : ComponentDatatype.DOUBLE,\n                componentsPerAttribute : 3,\n                values : EllipseGeometryLibrary.raisePositionsToHeight(positions, options, true)\n            })\n        });\n\n        positions = attributes.position.values;\n        var boundingSphere = BoundingSphere.union(topBoundingSphere, bottomBoundingSphere);\n        var length = positions.length/3;\n\n        if (defined(options.offsetAttribute)) {\n            var applyOffset = new Uint8Array(length);\n            if (options.offsetAttribute === GeometryOffsetAttribute.TOP) {\n                applyOffset = arrayFill(applyOffset, 1, 0, length / 2);\n            } else {\n                var offsetValue = options.offsetAttribute === GeometryOffsetAttribute.NONE ? 0 : 1;\n                applyOffset = arrayFill(applyOffset, offsetValue);\n            }\n\n            attributes.applyOffset = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                componentsPerAttribute : 1,\n                values: applyOffset\n            });\n        }\n\n        var numberOfVerticalLines = defaultValue(options.numberOfVerticalLines, 16);\n        numberOfVerticalLines = CesiumMath.clamp(numberOfVerticalLines, 0, length/2);\n\n        var indices = IndexDatatype.createTypedArray(length, length * 2 + numberOfVerticalLines * 2);\n\n        length /= 2;\n        var index = 0;\n        var i;\n        for (i = 0; i < length; ++i) {\n            indices[index++] = i;\n            indices[index++] = (i + 1) % length;\n            indices[index++] = i + length;\n            indices[index++] = ((i + 1) % length) + length;\n        }\n\n        var numSide;\n        if (numberOfVerticalLines > 0) {\n            var numSideLines = Math.min(numberOfVerticalLines, length);\n            numSide = Math.round(length / numSideLines);\n\n            var maxI = Math.min(numSide * numberOfVerticalLines, length);\n            for (i = 0; i < maxI; i += numSide) {\n                indices[index++] = i;\n                indices[index++] = i + length;\n            }\n        }\n\n        return {\n            boundingSphere : boundingSphere,\n            attributes : attributes,\n            indices : indices\n        };\n    }\n\n    /**\n     * A description of the outline of an ellipse on an ellipsoid.\n     *\n     * @alias EllipseOutlineGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3} options.center The ellipse's center point in the fixed frame.\n     * @param {Number} options.semiMajorAxis The length of the ellipse's semi-major axis in meters.\n     * @param {Number} options.semiMinorAxis The length of the ellipse's semi-minor axis in meters.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid the ellipse will be on.\n     * @param {Number} [options.height=0.0] The distance in meters between the ellipse and the ellipsoid surface.\n     * @param {Number} [options.extrudedHeight] The distance in meters between the ellipse's extruded face and the ellipsoid surface.\n     * @param {Number} [options.rotation=0.0] The angle from north (counter-clockwise) in radians.\n     * @param {Number} [options.granularity=0.02] The angular distance between points on the ellipse in radians.\n     * @param {Number} [options.numberOfVerticalLines=16] Number of lines to draw between the top and bottom surface of an extruded ellipse.\n     *\n     * @exception {DeveloperError} semiMajorAxis and semiMinorAxis must be greater than zero.\n     * @exception {DeveloperError} semiMajorAxis must be greater than or equal to the semiMinorAxis.\n     * @exception {DeveloperError} granularity must be greater than zero.\n     *\n     * @see EllipseOutlineGeometry.createGeometry\n     *\n     * @example\n     * var ellipse = new Cesium.EllipseOutlineGeometry({\n     *   center : Cesium.Cartesian3.fromDegrees(-75.59777, 40.03883),\n     *   semiMajorAxis : 500000.0,\n     *   semiMinorAxis : 300000.0,\n     *   rotation : Cesium.Math.toRadians(60.0)\n     * });\n     * var geometry = Cesium.EllipseOutlineGeometry.createGeometry(ellipse);\n     */\n    function EllipseOutlineGeometry(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        var center = options.center;\n        var ellipsoid = defaultValue(options.ellipsoid, Ellipsoid.WGS84);\n        var semiMajorAxis = options.semiMajorAxis;\n        var semiMinorAxis = options.semiMinorAxis;\n        var granularity = defaultValue(options.granularity, CesiumMath.RADIANS_PER_DEGREE);\n\n        \n\n        var height = defaultValue(options.height, 0.0);\n        var extrudedHeight = defaultValue(options.extrudedHeight, height);\n\n        this._center = Cartesian3.clone(center);\n        this._semiMajorAxis = semiMajorAxis;\n        this._semiMinorAxis = semiMinorAxis;\n        this._ellipsoid = Ellipsoid.clone(ellipsoid);\n        this._rotation = defaultValue(options.rotation, 0.0);\n        this._height = Math.max(extrudedHeight, height);\n        this._granularity = granularity;\n        this._extrudedHeight = Math.min(extrudedHeight, height);\n        this._numberOfVerticalLines = Math.max(defaultValue(options.numberOfVerticalLines, 16), 0);\n        this._offsetAttribute = options.offsetAttribute;\n        this._workerName = 'createEllipseOutlineGeometry';\n    }\n\n    /**\n     * The number of elements used to pack the object into an array.\n     * @type {Number}\n     */\n    EllipseOutlineGeometry.packedLength = Cartesian3.packedLength + Ellipsoid.packedLength + 8;\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {EllipseOutlineGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    EllipseOutlineGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        Cartesian3.pack(value._center, array, startingIndex);\n        startingIndex += Cartesian3.packedLength;\n\n        Ellipsoid.pack(value._ellipsoid, array, startingIndex);\n        startingIndex += Ellipsoid.packedLength;\n\n        array[startingIndex++] = value._semiMajorAxis;\n        array[startingIndex++] = value._semiMinorAxis;\n        array[startingIndex++] = value._rotation;\n        array[startingIndex++] = value._height;\n        array[startingIndex++] = value._granularity;\n        array[startingIndex++] = value._extrudedHeight;\n        array[startingIndex++]   = value._numberOfVerticalLines;\n        array[startingIndex] = defaultValue(value._offsetAttribute, -1);\n\n        return array;\n    };\n\n    var scratchCenter = new Cartesian3();\n    var scratchEllipsoid = new Ellipsoid();\n    var scratchOptions = {\n        center : scratchCenter,\n        ellipsoid : scratchEllipsoid,\n        semiMajorAxis : undefined,\n        semiMinorAxis : undefined,\n        rotation : undefined,\n        height : undefined,\n        granularity : undefined,\n        extrudedHeight : undefined,\n        numberOfVerticalLines : undefined,\n        offsetAttribute: undefined\n    };\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {EllipseOutlineGeometry} [result] The object into which to store the result.\n     * @returns {EllipseOutlineGeometry} The modified result parameter or a new EllipseOutlineGeometry instance if one was not provided.\n     */\n    EllipseOutlineGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var center = Cartesian3.unpack(array, startingIndex, scratchCenter);\n        startingIndex += Cartesian3.packedLength;\n\n        var ellipsoid = Ellipsoid.unpack(array, startingIndex, scratchEllipsoid);\n        startingIndex += Ellipsoid.packedLength;\n\n        var semiMajorAxis = array[startingIndex++];\n        var semiMinorAxis = array[startingIndex++];\n        var rotation = array[startingIndex++];\n        var height = array[startingIndex++];\n        var granularity = array[startingIndex++];\n        var extrudedHeight = array[startingIndex++];\n        var numberOfVerticalLines = array[startingIndex++];\n        var offsetAttribute = array[startingIndex];\n\n        if (!defined(result)) {\n            scratchOptions.height = height;\n            scratchOptions.extrudedHeight = extrudedHeight;\n            scratchOptions.granularity = granularity;\n            scratchOptions.rotation = rotation;\n            scratchOptions.semiMajorAxis = semiMajorAxis;\n            scratchOptions.semiMinorAxis = semiMinorAxis;\n            scratchOptions.numberOfVerticalLines = numberOfVerticalLines;\n            scratchOptions.offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n\n            return new EllipseOutlineGeometry(scratchOptions);\n        }\n\n        result._center = Cartesian3.clone(center, result._center);\n        result._ellipsoid = Ellipsoid.clone(ellipsoid, result._ellipsoid);\n        result._semiMajorAxis = semiMajorAxis;\n        result._semiMinorAxis = semiMinorAxis;\n        result._rotation = rotation;\n        result._height = height;\n        result._granularity = granularity;\n        result._extrudedHeight = extrudedHeight;\n        result._numberOfVerticalLines = numberOfVerticalLines;\n        result._offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n\n        return result;\n    };\n\n    /**\n     * Computes the geometric representation of an outline of an ellipse on an ellipsoid, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {EllipseOutlineGeometry} ellipseGeometry A description of the ellipse.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    EllipseOutlineGeometry.createGeometry = function(ellipseGeometry) {\n        if ((ellipseGeometry._semiMajorAxis <= 0.0) || (ellipseGeometry._semiMinorAxis <= 0.0)) {\n            return;\n        }\n\n        var height = ellipseGeometry._height;\n        var extrudedHeight = ellipseGeometry._extrudedHeight;\n        var extrude = !CesiumMath.equalsEpsilon(height, extrudedHeight, 0, CesiumMath.EPSILON2);\n\n        ellipseGeometry._center = ellipseGeometry._ellipsoid.scaleToGeodeticSurface(ellipseGeometry._center, ellipseGeometry._center);\n        var options = {\n            center : ellipseGeometry._center,\n            semiMajorAxis : ellipseGeometry._semiMajorAxis,\n            semiMinorAxis : ellipseGeometry._semiMinorAxis,\n            ellipsoid : ellipseGeometry._ellipsoid,\n            rotation : ellipseGeometry._rotation,\n            height : height,\n            granularity : ellipseGeometry._granularity,\n            numberOfVerticalLines : ellipseGeometry._numberOfVerticalLines\n        };\n        var geometry;\n        if (extrude) {\n            options.extrudedHeight = extrudedHeight;\n            options.offsetAttribute = ellipseGeometry._offsetAttribute;\n            geometry = computeExtrudedEllipse(options);\n        } else {\n            geometry = computeEllipse(options);\n\n            if (defined(ellipseGeometry._offsetAttribute)) {\n                var length = geometry.attributes.position.values.length;\n                var applyOffset = new Uint8Array(length / 3);\n                var offsetValue = ellipseGeometry._offsetAttribute === GeometryOffsetAttribute.NONE ? 0 : 1;\n                arrayFill(applyOffset, offsetValue);\n                geometry.attributes.applyOffset = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                    componentsPerAttribute : 1,\n                    values: applyOffset\n                });\n            }\n        }\n\n        return new Geometry({\n            attributes : geometry.attributes,\n            indices : geometry.indices,\n            primitiveType : PrimitiveType.LINES,\n            boundingSphere : geometry.boundingSphere,\n            offsetAttribute : ellipseGeometry._offsetAttribute\n        });\n    };\nexport default EllipseOutlineGeometry;\n","import ApproximateTerrainHeights from '../Core/ApproximateTerrainHeights.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Check from '../Core/Check.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport DistanceDisplayConditionGeometryInstanceAttribute from '../Core/DistanceDisplayConditionGeometryInstanceAttribute.js';\nimport EllipseGeometry from '../Core/EllipseGeometry.js';\nimport EllipseOutlineGeometry from '../Core/EllipseOutlineGeometry.js';\nimport GeometryInstance from '../Core/GeometryInstance.js';\nimport Iso8601 from '../Core/Iso8601.js';\nimport OffsetGeometryInstanceAttribute from '../Core/OffsetGeometryInstanceAttribute.js';\nimport Rectangle from '../Core/Rectangle.js';\nimport ShowGeometryInstanceAttribute from '../Core/ShowGeometryInstanceAttribute.js';\nimport HeightReference from '../Scene/HeightReference.js';\nimport MaterialAppearance from '../Scene/MaterialAppearance.js';\nimport PerInstanceColorAppearance from '../Scene/PerInstanceColorAppearance.js';\nimport ColorMaterialProperty from './ColorMaterialProperty.js';\nimport DynamicGeometryUpdater from './DynamicGeometryUpdater.js';\nimport GeometryUpdater from './GeometryUpdater.js';\nimport GroundGeometryUpdater from './GroundGeometryUpdater.js';\nimport Property from './Property.js';\n\n    var scratchColor = new Color();\n    var defaultOffset = Cartesian3.ZERO;\n    var offsetScratch = new Cartesian3();\n    var scratchRectangle = new Rectangle();\n\n    function EllipseGeometryOptions(entity) {\n        this.id = entity;\n        this.vertexFormat = undefined;\n        this.center = undefined;\n        this.semiMajorAxis = undefined;\n        this.semiMinorAxis = undefined;\n        this.rotation = undefined;\n        this.height = undefined;\n        this.extrudedHeight = undefined;\n        this.granularity = undefined;\n        this.stRotation = undefined;\n        this.numberOfVerticalLines = undefined;\n        this.offsetAttribute = undefined;\n    }\n\n    /**\n     * A {@link GeometryUpdater} for ellipses.\n     * Clients do not normally create this class directly, but instead rely on {@link DataSourceDisplay}.\n     * @alias EllipseGeometryUpdater\n     * @constructor\n     *\n     * @param {Entity} entity The entity containing the geometry to be visualized.\n     * @param {Scene} scene The scene where visualization is taking place.\n     */\n    function EllipseGeometryUpdater(entity, scene) {\n        GroundGeometryUpdater.call(this, {\n            entity : entity,\n            scene : scene,\n            geometryOptions : new EllipseGeometryOptions(entity),\n            geometryPropertyName : 'ellipse',\n            observedPropertyNames : ['availability', 'position', 'ellipse']\n        });\n\n        this._onEntityPropertyChanged(entity, 'ellipse', entity.ellipse, undefined);\n    }\n\n    if (defined(Object.create)) {\n        EllipseGeometryUpdater.prototype = Object.create(GroundGeometryUpdater.prototype);\n        EllipseGeometryUpdater.prototype.constructor = EllipseGeometryUpdater;\n    }\n\n    /**\n     * Creates the geometry instance which represents the fill of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the filled portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent a filled geometry.\n     */\n    EllipseGeometryUpdater.prototype.createFillGeometryInstance = function(time) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n\n        var attributes = {\n            show : new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._fillProperty.getValue(time)),\n            distanceDisplayCondition : DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(time)),\n            offset : undefined,\n            color : undefined\n        };\n\n        if (this._materialProperty instanceof ColorMaterialProperty) {\n            var currentColor;\n            if (defined(this._materialProperty.color) && (this._materialProperty.color.isConstant || isAvailable)) {\n                currentColor = this._materialProperty.color.getValue(time, scratchColor);\n            }\n            if (!defined(currentColor)) {\n                currentColor = Color.WHITE;\n            }\n            attributes.color = ColorGeometryInstanceAttribute.fromColor(currentColor);\n        }\n\n        if (defined(this._options.offsetAttribute)) {\n            attributes.offset = OffsetGeometryInstanceAttribute.fromCartesian3(Property.getValueOrDefault(this._terrainOffsetProperty, time, defaultOffset, offsetScratch));\n        }\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : new EllipseGeometry(this._options),\n            attributes : attributes\n        });\n    };\n\n    /**\n     * Creates the geometry instance which represents the outline of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the outline portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent an outlined geometry.\n     */\n    EllipseGeometryUpdater.prototype.createOutlineGeometryInstance = function(time) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n        var outlineColor = Property.getValueOrDefault(this._outlineColorProperty, time, Color.BLACK, scratchColor);\n        var distanceDisplayCondition = this._distanceDisplayConditionProperty.getValue(time);\n\n        var attributes = {\n            show : new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._showOutlineProperty.getValue(time)),\n            color : ColorGeometryInstanceAttribute.fromColor(outlineColor),\n            distanceDisplayCondition : DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(distanceDisplayCondition),\n            offset : undefined\n        };\n\n        if (defined(this._options.offsetAttribute)) {\n            attributes.offset = OffsetGeometryInstanceAttribute.fromCartesian3(Property.getValueOrDefault(this._terrainOffsetProperty, time, defaultOffset, offsetScratch));\n        }\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : new EllipseOutlineGeometry(this._options),\n            attributes : attributes\n        });\n    };\n\n    EllipseGeometryUpdater.prototype._computeCenter = function(time, result) {\n        return Property.getValueOrUndefined(this._entity.position, time, result);\n    };\n\n    EllipseGeometryUpdater.prototype._isHidden = function(entity, ellipse) {\n        var position = entity.position;\n\n        return !defined(position) || !defined(ellipse.semiMajorAxis) || !defined(ellipse.semiMinorAxis) || GeometryUpdater.prototype._isHidden.call(this, entity, ellipse);\n    };\n\n    EllipseGeometryUpdater.prototype._isDynamic = function(entity, ellipse) {\n        return !entity.position.isConstant || //\n               !ellipse.semiMajorAxis.isConstant || //\n               !ellipse.semiMinorAxis.isConstant || //\n               !Property.isConstant(ellipse.rotation) || //\n               !Property.isConstant(ellipse.height) || //\n               !Property.isConstant(ellipse.extrudedHeight) || //\n               !Property.isConstant(ellipse.granularity) || //\n               !Property.isConstant(ellipse.stRotation) || //\n               !Property.isConstant(ellipse.outlineWidth) || //\n               !Property.isConstant(ellipse.numberOfVerticalLines) || //\n               !Property.isConstant(ellipse.zIndex) || //\n               (this._onTerrain && !Property.isConstant(this._materialProperty) && !(this._materialProperty instanceof ColorMaterialProperty));\n    };\n\n    EllipseGeometryUpdater.prototype._setStaticOptions = function(entity, ellipse) {\n        var heightValue = Property.getValueOrUndefined(ellipse.height, Iso8601.MINIMUM_VALUE);\n        var heightReferenceValue = Property.getValueOrDefault(ellipse.heightReference, Iso8601.MINIMUM_VALUE, HeightReference.NONE);\n        var extrudedHeightValue = Property.getValueOrUndefined(ellipse.extrudedHeight, Iso8601.MINIMUM_VALUE);\n        var extrudedHeightReferenceValue = Property.getValueOrDefault(ellipse.extrudedHeightReference, Iso8601.MINIMUM_VALUE, HeightReference.NONE);\n        if (defined(extrudedHeightValue) && !defined(heightValue)) {\n            heightValue = 0;\n        }\n\n        var options = this._options;\n        options.vertexFormat = (this._materialProperty instanceof ColorMaterialProperty) ? PerInstanceColorAppearance.VERTEX_FORMAT : MaterialAppearance.MaterialSupport.TEXTURED.vertexFormat;\n        options.center = entity.position.getValue(Iso8601.MINIMUM_VALUE, options.center);\n        options.semiMajorAxis = ellipse.semiMajorAxis.getValue(Iso8601.MINIMUM_VALUE, options.semiMajorAxis);\n        options.semiMinorAxis = ellipse.semiMinorAxis.getValue(Iso8601.MINIMUM_VALUE, options.semiMinorAxis);\n        options.rotation = Property.getValueOrUndefined(ellipse.rotation, Iso8601.MINIMUM_VALUE);\n        options.granularity = Property.getValueOrUndefined(ellipse.granularity, Iso8601.MINIMUM_VALUE);\n        options.stRotation = Property.getValueOrUndefined(ellipse.stRotation, Iso8601.MINIMUM_VALUE);\n        options.numberOfVerticalLines = Property.getValueOrUndefined(ellipse.numberOfVerticalLines, Iso8601.MINIMUM_VALUE);\n        options.offsetAttribute = GroundGeometryUpdater.computeGeometryOffsetAttribute(heightValue, heightReferenceValue, extrudedHeightValue, extrudedHeightReferenceValue);\n        options.height = GroundGeometryUpdater.getGeometryHeight(heightValue, heightReferenceValue);\n\n        extrudedHeightValue = GroundGeometryUpdater.getGeometryExtrudedHeight(extrudedHeightValue, extrudedHeightReferenceValue);\n        if (extrudedHeightValue === GroundGeometryUpdater.CLAMP_TO_GROUND) {\n            extrudedHeightValue = ApproximateTerrainHeights.getMinimumMaximumHeights(EllipseGeometry.computeRectangle(options, scratchRectangle)).minimumTerrainHeight;\n        }\n\n        options.extrudedHeight = extrudedHeightValue;\n    };\n\n    EllipseGeometryUpdater.DynamicGeometryUpdater = DynamicEllipseGeometryUpdater;\n\n    /**\n     * @private\n     */\n    function DynamicEllipseGeometryUpdater(geometryUpdater, primitives, groundPrimitives) {\n        DynamicGeometryUpdater.call(this, geometryUpdater, primitives, groundPrimitives);\n    }\n\n    if (defined(Object.create)) {\n        DynamicEllipseGeometryUpdater.prototype = Object.create(DynamicGeometryUpdater.prototype);\n        DynamicEllipseGeometryUpdater.prototype.constructor = DynamicEllipseGeometryUpdater;\n    }\n\n    DynamicEllipseGeometryUpdater.prototype._isHidden = function(entity, ellipse, time) {\n        var options = this._options;\n        return !defined(options.center) || !defined(options.semiMajorAxis) || !defined(options.semiMinorAxis) || DynamicGeometryUpdater.prototype._isHidden.call(this, entity, ellipse, time);\n    };\n\n    DynamicEllipseGeometryUpdater.prototype._setOptions = function(entity, ellipse, time) {\n        var options = this._options;\n        var heightValue = Property.getValueOrUndefined(ellipse.height, time);\n        var heightReferenceValue = Property.getValueOrDefault(ellipse.heightReference, time, HeightReference.NONE);\n        var extrudedHeightValue = Property.getValueOrUndefined(ellipse.extrudedHeight, time);\n        var extrudedHeightReferenceValue = Property.getValueOrDefault(ellipse.extrudedHeightReference, time, HeightReference.NONE);\n        if (defined(extrudedHeightValue) && !defined(heightValue)) {\n            heightValue = 0;\n        }\n\n        options.center = Property.getValueOrUndefined(entity.position, time, options.center);\n        options.semiMajorAxis = Property.getValueOrUndefined(ellipse.semiMajorAxis, time);\n        options.semiMinorAxis = Property.getValueOrUndefined(ellipse.semiMinorAxis, time);\n        options.rotation = Property.getValueOrUndefined(ellipse.rotation, time);\n        options.granularity = Property.getValueOrUndefined(ellipse.granularity, time);\n        options.stRotation = Property.getValueOrUndefined(ellipse.stRotation, time);\n        options.numberOfVerticalLines = Property.getValueOrUndefined(ellipse.numberOfVerticalLines, time);\n        options.offsetAttribute = GroundGeometryUpdater.computeGeometryOffsetAttribute(heightValue, heightReferenceValue, extrudedHeightValue, extrudedHeightReferenceValue);\n        options.height = GroundGeometryUpdater.getGeometryHeight(heightValue, heightReferenceValue);\n\n        extrudedHeightValue = GroundGeometryUpdater.getGeometryExtrudedHeight(extrudedHeightValue, extrudedHeightReferenceValue);\n        if (extrudedHeightValue === GroundGeometryUpdater.CLAMP_TO_GROUND) {\n            extrudedHeightValue = ApproximateTerrainHeights.getMinimumMaximumHeights(EllipseGeometry.computeRectangle(options, scratchRectangle)).minimumTerrainHeight;\n        }\n\n        options.extrudedHeight = extrudedHeightValue;\n    };\nexport default EllipseGeometryUpdater;\n","import Cartesian3 from '../Core/Cartesian3.js';\nimport Check from '../Core/Check.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport DistanceDisplayCondition from '../Core/DistanceDisplayCondition.js';\nimport DistanceDisplayConditionGeometryInstanceAttribute from '../Core/DistanceDisplayConditionGeometryInstanceAttribute.js';\nimport EllipsoidGeometry from '../Core/EllipsoidGeometry.js';\nimport EllipsoidOutlineGeometry from '../Core/EllipsoidOutlineGeometry.js';\nimport GeometryInstance from '../Core/GeometryInstance.js';\nimport GeometryOffsetAttribute from '../Core/GeometryOffsetAttribute.js';\nimport Iso8601 from '../Core/Iso8601.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport OffsetGeometryInstanceAttribute from '../Core/OffsetGeometryInstanceAttribute.js';\nimport ShowGeometryInstanceAttribute from '../Core/ShowGeometryInstanceAttribute.js';\nimport HeightReference from '../Scene/HeightReference.js';\nimport MaterialAppearance from '../Scene/MaterialAppearance.js';\nimport PerInstanceColorAppearance from '../Scene/PerInstanceColorAppearance.js';\nimport Primitive from '../Scene/Primitive.js';\nimport SceneMode from '../Scene/SceneMode.js';\nimport ColorMaterialProperty from './ColorMaterialProperty.js';\nimport DynamicGeometryUpdater from './DynamicGeometryUpdater.js';\nimport GeometryUpdater from './GeometryUpdater.js';\nimport heightReferenceOnEntityPropertyChanged from './heightReferenceOnEntityPropertyChanged.js';\nimport MaterialProperty from './MaterialProperty.js';\nimport Property from './Property.js';\n\n    var defaultMaterial = new ColorMaterialProperty(Color.WHITE);\n    var defaultOffset = Cartesian3.ZERO;\n\n    var offsetScratch = new Cartesian3();\n    var radiiScratch = new Cartesian3();\n    var innerRadiiScratch = new Cartesian3();\n    var scratchColor = new Color();\n    var unitSphere = new Cartesian3(1, 1, 1);\n\n    function EllipsoidGeometryOptions(entity) {\n        this.id = entity;\n        this.vertexFormat = undefined;\n        this.radii = undefined;\n        this.innerRadii = undefined;\n        this.minimumClock = undefined;\n        this.maximumClock = undefined;\n        this.minimumCone = undefined;\n        this.maximumCone = undefined;\n        this.stackPartitions = undefined;\n        this.slicePartitions = undefined;\n        this.subdivisions = undefined;\n        this.offsetAttribute = undefined;\n    }\n\n    /**\n     * A {@link GeometryUpdater} for ellipsoids.\n     * Clients do not normally create this class directly, but instead rely on {@link DataSourceDisplay}.\n     * @alias EllipsoidGeometryUpdater\n     * @constructor\n     *\n     * @param {Entity} entity The entity containing the geometry to be visualized.\n     * @param {Scene} scene The scene where visualization is taking place.\n     */\n    function EllipsoidGeometryUpdater(entity, scene) {\n        GeometryUpdater.call(this, {\n            entity : entity,\n            scene : scene,\n            geometryOptions : new EllipsoidGeometryOptions(entity),\n            geometryPropertyName : 'ellipsoid',\n            observedPropertyNames : ['availability', 'position', 'orientation', 'ellipsoid']\n        });\n\n        this._onEntityPropertyChanged(entity, 'ellipsoid', entity.ellipsoid, undefined);\n    }\n\n    if (defined(Object.create)) {\n        EllipsoidGeometryUpdater.prototype = Object.create(GeometryUpdater.prototype);\n        EllipsoidGeometryUpdater.prototype.constructor = EllipsoidGeometryUpdater;\n    }\n\n    Object.defineProperties(EllipsoidGeometryUpdater.prototype, {\n        /**\n         * Gets the terrain offset property\n         * @type {TerrainOffsetProperty}\n         * @memberof EllipsoidGeometryUpdater.prototype\n         * @readonly\n         */\n        terrainOffsetProperty : {\n            get : function() {\n                return this._terrainOffsetProperty;\n            }\n        }\n    });\n\n    /**\n     * Creates the geometry instance which represents the fill of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @param {Boolean} [skipModelMatrix=false] Whether to compute a model matrix for the geometry instance\n     * @param {Matrix4} [modelMatrixResult] Used to store the result of the model matrix calculation\n     * @returns {GeometryInstance} The geometry instance representing the filled portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent a filled geometry.\n     */\n    EllipsoidGeometryUpdater.prototype.createFillGeometryInstance = function(time, skipModelMatrix, modelMatrixResult) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n\n        var color;\n        var show = new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._fillProperty.getValue(time));\n        var distanceDisplayCondition = this._distanceDisplayConditionProperty.getValue(time);\n        var distanceDisplayConditionAttribute = DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(distanceDisplayCondition);\n\n        var attributes = {\n            show : show,\n            distanceDisplayCondition : distanceDisplayConditionAttribute,\n            color : undefined,\n            offset : undefined\n        };\n\n        if (this._materialProperty instanceof ColorMaterialProperty) {\n            var currentColor;\n            if (defined(this._materialProperty.color) && (this._materialProperty.color.isConstant || isAvailable)) {\n                currentColor = this._materialProperty.color.getValue(time, scratchColor);\n            }\n            if (!defined(currentColor)) {\n                currentColor = Color.WHITE;\n            }\n            color = ColorGeometryInstanceAttribute.fromColor(currentColor);\n            attributes.color = color;\n        }\n        if (defined(this._options.offsetAttribute)) {\n            attributes.offset = OffsetGeometryInstanceAttribute.fromCartesian3(Property.getValueOrDefault(this._terrainOffsetProperty, time, defaultOffset, offsetScratch));\n        }\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : new EllipsoidGeometry(this._options),\n            modelMatrix : skipModelMatrix ? undefined : entity.computeModelMatrixForHeightReference(time, entity.ellipsoid.heightReference, this._options.radii.z * 0.5, this._scene.mapProjection.ellipsoid, modelMatrixResult),\n            attributes : attributes\n        });\n    };\n\n    /**\n     * Creates the geometry instance which represents the outline of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @param {Boolean} [skipModelMatrix=false] Whether to compute a model matrix for the geometry instance\n     * @param {Matrix4} [modelMatrixResult] Used to store the result of the model matrix calculation\n     * @returns {GeometryInstance} The geometry instance representing the outline portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent an outlined geometry.\n     */\n    EllipsoidGeometryUpdater.prototype.createOutlineGeometryInstance = function(time, skipModelMatrix, modelMatrixResult) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n\n        var outlineColor = Property.getValueOrDefault(this._outlineColorProperty, time, Color.BLACK, scratchColor);\n        var distanceDisplayCondition = this._distanceDisplayConditionProperty.getValue(time);\n\n        var attributes = {\n            show : new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._showOutlineProperty.getValue(time)),\n            color : ColorGeometryInstanceAttribute.fromColor(outlineColor),\n            distanceDisplayCondition : DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(distanceDisplayCondition),\n            offset : undefined\n        };\n        if (defined(this._options.offsetAttribute)) {\n            attributes.offset = OffsetGeometryInstanceAttribute.fromCartesian3(Property.getValueOrDefault(this._terrainOffsetProperty, time, defaultOffset, offsetScratch));\n        }\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : new EllipsoidOutlineGeometry(this._options),\n            modelMatrix : skipModelMatrix ? undefined : entity.computeModelMatrixForHeightReference(time, entity.ellipsoid.heightReference, this._options.radii.z * 0.5, this._scene.mapProjection.ellipsoid, modelMatrixResult),\n            attributes : attributes\n        });\n    };\n\n    EllipsoidGeometryUpdater.prototype._computeCenter = function(time, result) {\n        return Property.getValueOrUndefined(this._entity.position, time, result);\n    };\n\n    EllipsoidGeometryUpdater.prototype._isHidden = function(entity, ellipsoid) {\n        return !defined(entity.position) || !defined(ellipsoid.radii) || GeometryUpdater.prototype._isHidden.call(this, entity, ellipsoid);\n    };\n\n    EllipsoidGeometryUpdater.prototype._isDynamic = function(entity, ellipsoid) {\n        return !entity.position.isConstant || //\n               !Property.isConstant(entity.orientation) || //\n               !ellipsoid.radii.isConstant || //\n               !Property.isConstant(ellipsoid.innerRadii) || //\n               !Property.isConstant(ellipsoid.stackPartitions) || //\n               !Property.isConstant(ellipsoid.slicePartitions) || //\n               !Property.isConstant(ellipsoid.outlineWidth) || //\n               !Property.isConstant(ellipsoid.minimumClock) || //\n               !Property.isConstant(ellipsoid.maximumClock) || //\n               !Property.isConstant(ellipsoid.minimumCone) || //\n               !Property.isConstant(ellipsoid.maximumCone) || //\n               !Property.isConstant(ellipsoid.subdivisions);\n    };\n\n    EllipsoidGeometryUpdater.prototype._setStaticOptions = function(entity, ellipsoid) {\n        var heightReference = Property.getValueOrDefault(ellipsoid.heightReference, Iso8601.MINIMUM_VALUE, HeightReference.NONE);\n        var options = this._options;\n        options.vertexFormat = this._materialProperty instanceof ColorMaterialProperty ? PerInstanceColorAppearance.VERTEX_FORMAT : MaterialAppearance.MaterialSupport.TEXTURED.vertexFormat;\n        options.radii = ellipsoid.radii.getValue(Iso8601.MINIMUM_VALUE, options.radii);\n        options.innerRadii = Property.getValueOrUndefined(ellipsoid.innerRadii, options.radii);\n        options.minimumClock = Property.getValueOrUndefined(ellipsoid.minimumClock, Iso8601.MINIMUM_VALUE);\n        options.maximumClock = Property.getValueOrUndefined(ellipsoid.maximumClock, Iso8601.MINIMUM_VALUE);\n        options.minimumCone = Property.getValueOrUndefined(ellipsoid.minimumCone, Iso8601.MINIMUM_VALUE);\n        options.maximumCone = Property.getValueOrUndefined(ellipsoid.maximumCone, Iso8601.MINIMUM_VALUE);\n        options.stackPartitions = Property.getValueOrUndefined(ellipsoid.stackPartitions, Iso8601.MINIMUM_VALUE);\n        options.slicePartitions = Property.getValueOrUndefined(ellipsoid.slicePartitions, Iso8601.MINIMUM_VALUE);\n        options.subdivisions = Property.getValueOrUndefined(ellipsoid.subdivisions, Iso8601.MINIMUM_VALUE);\n        options.offsetAttribute = heightReference !== HeightReference.NONE ? GeometryOffsetAttribute.ALL : undefined;\n    };\n\n    EllipsoidGeometryUpdater.prototype._onEntityPropertyChanged = heightReferenceOnEntityPropertyChanged;\n\n    EllipsoidGeometryUpdater.DynamicGeometryUpdater = DynamicEllipsoidGeometryUpdater;\n\n    /**\n     * @private\n     */\n    function DynamicEllipsoidGeometryUpdater(geometryUpdater, primitives, groundPrimitives) {\n        DynamicGeometryUpdater.call(this, geometryUpdater, primitives, groundPrimitives);\n\n        this._scene = geometryUpdater._scene;\n        this._modelMatrix = new Matrix4();\n        this._attributes = undefined;\n        this._outlineAttributes = undefined;\n        this._lastSceneMode = undefined;\n        this._lastShow = undefined;\n        this._lastOutlineShow = undefined;\n        this._lastOutlineWidth = undefined;\n        this._lastOutlineColor = undefined;\n        this._lastOffset = new Cartesian3();\n        this._material = {};\n    }\n\n    if (defined(Object.create)) {\n        DynamicEllipsoidGeometryUpdater.prototype = Object.create(DynamicGeometryUpdater.prototype);\n        DynamicEllipsoidGeometryUpdater.prototype.constructor = DynamicEllipsoidGeometryUpdater;\n    }\n\n    DynamicEllipsoidGeometryUpdater.prototype.update = function(time) {\n        \n\n        var entity = this._entity;\n        var ellipsoid = entity.ellipsoid;\n        if (!entity.isShowing || !entity.isAvailable(time) || !Property.getValueOrDefault(ellipsoid.show, time, true)) {\n            if (defined(this._primitive)) {\n                this._primitive.show = false;\n            }\n\n            if (defined(this._outlinePrimitive)) {\n                this._outlinePrimitive.show = false;\n            }\n            return;\n        }\n\n        var radii = Property.getValueOrUndefined(ellipsoid.radii, time, radiiScratch);\n        var modelMatrix = defined(radii) ? entity.computeModelMatrixForHeightReference(time, ellipsoid.heightReference, radii.z * 0.5, this._scene.mapProjection.ellipsoid, this._modelMatrix) : undefined;\n        if (!defined(modelMatrix) || !defined(radii)) {\n            if (defined(this._primitive)) {\n                this._primitive.show = false;\n            }\n\n            if (defined(this._outlinePrimitive)) {\n                this._outlinePrimitive.show = false;\n            }\n            return;\n        }\n\n        //Compute attributes and material.\n        var showFill = Property.getValueOrDefault(ellipsoid.fill, time, true);\n        var showOutline = Property.getValueOrDefault(ellipsoid.outline, time, false);\n        var outlineColor = Property.getValueOrClonedDefault(ellipsoid.outlineColor, time, Color.BLACK, scratchColor);\n        var material = MaterialProperty.getValue(time, defaultValue(ellipsoid.material, defaultMaterial), this._material);\n\n        // Check properties that could trigger a primitive rebuild.\n        var innerRadii = Property.getValueOrUndefined(ellipsoid.innerRadii, time, innerRadiiScratch);\n        var minimumClock = Property.getValueOrUndefined(ellipsoid.minimumClock, time);\n        var maximumClock = Property.getValueOrUndefined(ellipsoid.maximumClock, time);\n        var minimumCone = Property.getValueOrUndefined(ellipsoid.minimumCone, time);\n        var maximumCone = Property.getValueOrUndefined(ellipsoid.maximumCone, time);\n        var stackPartitions = Property.getValueOrUndefined(ellipsoid.stackPartitions, time);\n        var slicePartitions = Property.getValueOrUndefined(ellipsoid.slicePartitions, time);\n        var subdivisions = Property.getValueOrUndefined(ellipsoid.subdivisions, time);\n        var outlineWidth = Property.getValueOrDefault(ellipsoid.outlineWidth, time, 1.0);\n        var heightReference = Property.getValueOrDefault(ellipsoid.heightReference, time, HeightReference.NONE);\n        var offsetAttribute = heightReference !== HeightReference.NONE ? GeometryOffsetAttribute.ALL : undefined;\n\n        //In 3D we use a fast path by modifying Primitive.modelMatrix instead of regenerating the primitive every frame.\n        //Also check for height reference because this method doesn't work when the height is relative to terrain.\n        var sceneMode = this._scene.mode;\n        var in3D = sceneMode === SceneMode.SCENE3D && heightReference === HeightReference.NONE;\n\n        var options = this._options;\n\n        var shadows = this._geometryUpdater.shadowsProperty.getValue(time);\n\n        var distanceDisplayConditionProperty = this._geometryUpdater.distanceDisplayConditionProperty;\n        var distanceDisplayCondition = distanceDisplayConditionProperty.getValue(time);\n\n        var offset = Property.getValueOrDefault(this._geometryUpdater.terrainOffsetProperty, time, defaultOffset, offsetScratch);\n\n        //We only rebuild the primitive if something other than the radii has changed\n        //For the radii, we use unit sphere and then deform it with a scale matrix.\n        var rebuildPrimitives = !in3D || this._lastSceneMode !== sceneMode || !defined(this._primitive) || //\n                                options.stackPartitions !== stackPartitions || options.slicePartitions !== slicePartitions || //\n                                defined(innerRadii) && !Cartesian3.equals(options.innerRadii !== innerRadii) || options.minimumClock !== minimumClock || //\n                                options.maximumClock !== maximumClock || options.minimumCone !== minimumCone || //\n                                options.maximumCone !== maximumCone || options.subdivisions !== subdivisions || //\n                                this._lastOutlineWidth !== outlineWidth || options.offsetAttribute !== offsetAttribute;\n\n        if (rebuildPrimitives) {\n            var primitives = this._primitives;\n            primitives.removeAndDestroy(this._primitive);\n            primitives.removeAndDestroy(this._outlinePrimitive);\n            this._primitive = undefined;\n            this._outlinePrimitive = undefined;\n            this._lastSceneMode = sceneMode;\n            this._lastOutlineWidth = outlineWidth;\n\n            options.stackPartitions = stackPartitions;\n            options.slicePartitions = slicePartitions;\n            options.subdivisions = subdivisions;\n            options.offsetAttribute = offsetAttribute;\n            options.radii = Cartesian3.clone(in3D ? unitSphere : radii, options.radii);\n            if (defined(innerRadii)) {\n                if (in3D) {\n                    var mag = Cartesian3.magnitude(radii);\n                    options.innerRadii = Cartesian3.fromElements(innerRadii.x / mag, innerRadii.y / mag, innerRadii.z / mag, options.innerRadii);\n                } else {\n                    options.innerRadii = Cartesian3.clone(innerRadii, options.innerRadii);\n                }\n            } else {\n                options.innerRadii = undefined;\n            }\n            options.minimumClock = minimumClock;\n            options.maximumClock = maximumClock;\n            options.minimumCone = minimumCone;\n            options.maximumCone = maximumCone;\n\n            var appearance = new MaterialAppearance({\n                material : material,\n                translucent : material.isTranslucent(),\n                closed : true\n            });\n            options.vertexFormat = appearance.vertexFormat;\n\n            var fillInstance = this._geometryUpdater.createFillGeometryInstance(time, in3D, this._modelMatrix);\n\n            this._primitive = primitives.add(new Primitive({\n                geometryInstances : fillInstance,\n                appearance : appearance,\n                asynchronous : false,\n                shadows : shadows\n            }));\n\n            var outlineInstance = this._geometryUpdater.createOutlineGeometryInstance(time, in3D, this._modelMatrix);\n            this._outlinePrimitive = primitives.add(new Primitive({\n                geometryInstances : outlineInstance,\n                appearance : new PerInstanceColorAppearance({\n                    flat : true,\n                    translucent : outlineInstance.attributes.color.value[3] !== 255,\n                    renderState : {\n                        lineWidth : this._geometryUpdater._scene.clampLineWidth(outlineWidth)\n                    }\n                }),\n                asynchronous : false,\n                shadows : shadows\n            }));\n\n            this._lastShow = showFill;\n            this._lastOutlineShow = showOutline;\n            this._lastOutlineColor = Color.clone(outlineColor, this._lastOutlineColor);\n            this._lastDistanceDisplayCondition = distanceDisplayCondition;\n            this._lastOffset = Cartesian3.clone(offset, this._lastOffset);\n        } else if (this._primitive.ready) {\n            //Update attributes only.\n            var primitive = this._primitive;\n            var outlinePrimitive = this._outlinePrimitive;\n\n            primitive.show = true;\n            outlinePrimitive.show = true;\n            primitive.appearance.material = material;\n\n            var attributes = this._attributes;\n            if (!defined(attributes)) {\n                attributes = primitive.getGeometryInstanceAttributes(entity);\n                this._attributes = attributes;\n            }\n            if (showFill !== this._lastShow) {\n                attributes.show = ShowGeometryInstanceAttribute.toValue(showFill, attributes.show);\n                this._lastShow = showFill;\n            }\n\n            var outlineAttributes = this._outlineAttributes;\n\n            if (!defined(outlineAttributes)) {\n                outlineAttributes = outlinePrimitive.getGeometryInstanceAttributes(entity);\n                this._outlineAttributes = outlineAttributes;\n            }\n\n            if (showOutline !== this._lastOutlineShow) {\n                outlineAttributes.show = ShowGeometryInstanceAttribute.toValue(showOutline, outlineAttributes.show);\n                this._lastOutlineShow = showOutline;\n            }\n\n            if (!Color.equals(outlineColor, this._lastOutlineColor)) {\n                outlineAttributes.color = ColorGeometryInstanceAttribute.toValue(outlineColor, outlineAttributes.color);\n                Color.clone(outlineColor, this._lastOutlineColor);\n            }\n\n            if (!DistanceDisplayCondition.equals(distanceDisplayCondition, this._lastDistanceDisplayCondition)) {\n                attributes.distanceDisplayCondition = DistanceDisplayConditionGeometryInstanceAttribute.toValue(distanceDisplayCondition, attributes.distanceDisplayCondition);\n                outlineAttributes.distanceDisplayCondition = DistanceDisplayConditionGeometryInstanceAttribute.toValue(distanceDisplayCondition, outlineAttributes.distanceDisplayCondition);\n                DistanceDisplayCondition.clone(distanceDisplayCondition, this._lastDistanceDisplayCondition);\n            }\n\n            if (!Cartesian3.equals(offset, this._lastOffset)) {\n                attributes.offset = OffsetGeometryInstanceAttribute.toValue(offset, attributes.offset);\n                outlineAttributes.offset = OffsetGeometryInstanceAttribute.toValue(offset, attributes.offset);\n                Cartesian3.clone(offset, this._lastOffset);\n            }\n        }\n\n        if (in3D) {\n            //Since we are scaling a unit sphere, we can't let any of the values go to zero.\n            //Instead we clamp them to a small value.  To the naked eye, this produces the same results\n            //that you get passing EllipsoidGeometry a radii with a zero component.\n            radii.x = Math.max(radii.x, 0.001);\n            radii.y = Math.max(radii.y, 0.001);\n            radii.z = Math.max(radii.z, 0.001);\n\n            modelMatrix = Matrix4.multiplyByScale(modelMatrix, radii, modelMatrix);\n            this._primitive.modelMatrix = modelMatrix;\n            this._outlinePrimitive.modelMatrix = modelMatrix;\n        }\n    };\nexport default EllipsoidGeometryUpdater;\n","import BoundingSphere from './BoundingSphere.js';\nimport Cartesian3 from './Cartesian3.js';\nimport Check from './Check.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport PrimitiveType from './PrimitiveType.js';\nimport VertexFormat from './VertexFormat.js';\n\n    /**\n     * Describes geometry representing a plane centered at the origin, with a unit width and length.\n     *\n     * @alias PlaneGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {VertexFormat} [options.vertexFormat=VertexFormat.DEFAULT] The vertex attributes to be computed.\n     *\n     * @example\n     * var planeGeometry = new Cesium.PlaneGeometry({\n     *   vertexFormat : Cesium.VertexFormat.POSITION_ONLY\n     * });\n     */\n    function PlaneGeometry(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        var vertexFormat = defaultValue(options.vertexFormat, VertexFormat.DEFAULT);\n\n        this._vertexFormat = vertexFormat;\n        this._workerName = 'createPlaneGeometry';\n    }\n\n    /**\n     * The number of elements used to pack the object into an array.\n     * @type {Number}\n     */\n    PlaneGeometry.packedLength = VertexFormat.packedLength;\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {PlaneGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    PlaneGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        VertexFormat.pack(value._vertexFormat, array, startingIndex);\n\n        return array;\n    };\n\n    var scratchVertexFormat = new VertexFormat();\n    var scratchOptions = {\n        vertexFormat: scratchVertexFormat\n    };\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {PlaneGeometry} [result] The object into which to store the result.\n     * @returns {PlaneGeometry} The modified result parameter or a new PlaneGeometry instance if one was not provided.\n     */\n    PlaneGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var vertexFormat = VertexFormat.unpack(array, startingIndex, scratchVertexFormat);\n\n        if (!defined(result)) {\n            return new PlaneGeometry(scratchOptions);\n        }\n\n        result._vertexFormat = VertexFormat.clone(vertexFormat, result._vertexFormat);\n\n        return result;\n    };\n\n    var min = new Cartesian3(-0.5, -0.5, 0.0);\n    var max = new Cartesian3( 0.5,  0.5, 0.0);\n\n    /**\n     * Computes the geometric representation of a plane, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {PlaneGeometry} planeGeometry A description of the plane.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    PlaneGeometry.createGeometry = function(planeGeometry) {\n        var vertexFormat = planeGeometry._vertexFormat;\n\n        var attributes = new GeometryAttributes();\n        var indices;\n        var positions;\n\n        if (vertexFormat.position) {\n            // 4 corner points.  Duplicated 3 times each for each incident edge/face.\n            positions = new Float64Array(4 * 3);\n\n            // +z face\n            positions[0]  = min.x;\n            positions[1]  = min.y;\n            positions[2]  = 0.0;\n            positions[3]  = max.x;\n            positions[4]  = min.y;\n            positions[5]  = 0.0;\n            positions[6]  = max.x;\n            positions[7]  = max.y;\n            positions[8]  = 0.0;\n            positions[9]  = min.x;\n            positions[10] = max.y;\n            positions[11] = 0.0;\n\n            attributes.position = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.DOUBLE,\n                componentsPerAttribute : 3,\n                values : positions\n            });\n\n            if (vertexFormat.normal) {\n                var normals = new Float32Array(4 * 3);\n\n                // +z face\n                normals[0]  = 0.0;\n                normals[1]  = 0.0;\n                normals[2]  = 1.0;\n                normals[3]  = 0.0;\n                normals[4]  = 0.0;\n                normals[5]  = 1.0;\n                normals[6]  = 0.0;\n                normals[7]  = 0.0;\n                normals[8]  = 1.0;\n                normals[9]  = 0.0;\n                normals[10] = 0.0;\n                normals[11] = 1.0;\n\n                attributes.normal = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 3,\n                    values : normals\n                });\n            }\n\n            if (vertexFormat.st) {\n                var texCoords = new Float32Array(4 * 2);\n\n                // +z face\n                texCoords[0]  = 0.0;\n                texCoords[1]  = 0.0;\n                texCoords[2]  = 1.0;\n                texCoords[3]  = 0.0;\n                texCoords[4]  = 1.0;\n                texCoords[5]  = 1.0;\n                texCoords[6]  = 0.0;\n                texCoords[7]  = 1.0;\n\n                attributes.st = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 2,\n                    values : texCoords\n                });\n            }\n\n            if (vertexFormat.tangent) {\n                var tangents = new Float32Array(4 * 3);\n\n                // +z face\n                tangents[0]  = 1.0;\n                tangents[1]  = 0.0;\n                tangents[2]  = 0.0;\n                tangents[3]  = 1.0;\n                tangents[4]  = 0.0;\n                tangents[5]  = 0.0;\n                tangents[6]  = 1.0;\n                tangents[7]  = 0.0;\n                tangents[8]  = 0.0;\n                tangents[9]  = 1.0;\n                tangents[10] = 0.0;\n                tangents[11] = 0.0;\n\n                attributes.tangent = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 3,\n                    values : tangents\n                });\n            }\n\n            if (vertexFormat.bitangent) {\n                var bitangents = new Float32Array(4 * 3);\n\n                // +z face\n                bitangents[0] = 0.0;\n                bitangents[1] = 1.0;\n                bitangents[2] = 0.0;\n                bitangents[3] = 0.0;\n                bitangents[4] = 1.0;\n                bitangents[5] = 0.0;\n                bitangents[6] = 0.0;\n                bitangents[7] = 1.0;\n                bitangents[8] = 0.0;\n                bitangents[9] = 0.0;\n                bitangents[10] = 1.0;\n                bitangents[11] = 0.0;\n\n                attributes.bitangent = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 3,\n                    values : bitangents\n                });\n            }\n\n            // 2 triangles\n            indices = new Uint16Array(2 * 3);\n\n            // +z face\n            indices[0] = 0;\n            indices[1] = 1;\n            indices[2] = 2;\n            indices[3] = 0;\n            indices[4] = 2;\n            indices[5] = 3;\n        }\n\n        return new Geometry({\n            attributes : attributes,\n            indices : indices,\n            primitiveType : PrimitiveType.TRIANGLES,\n            boundingSphere : new BoundingSphere(Cartesian3.ZERO, Math.sqrt(2.0))\n        });\n    };\nexport default PlaneGeometry;\n","import BoundingSphere from './BoundingSphere.js';\nimport Cartesian3 from './Cartesian3.js';\nimport Check from './Check.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport defined from './defined.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport PrimitiveType from './PrimitiveType.js';\n\n    /**\n     * Describes geometry representing the outline of a plane centered at the origin, with a unit width and length.\n     *\n     * @alias PlaneOutlineGeometry\n     * @constructor\n     *\n     */\n    function PlaneOutlineGeometry() {\n        this._workerName = 'createPlaneOutlineGeometry';\n    }\n\n    /**\n     * The number of elements used to pack the object into an array.\n     * @type {Number}\n     */\n    PlaneOutlineGeometry.packedLength = 0;\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {PlaneOutlineGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    PlaneOutlineGeometry.pack = function(value, array) {\n        \n\n        return array;\n    };\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {PlaneOutlineGeometry} [result] The object into which to store the result.\n     * @returns {PlaneOutlineGeometry} The modified result parameter or a new PlaneOutlineGeometry instance if one was not provided.\n     */\n    PlaneOutlineGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        if (!defined(result)) {\n            return new PlaneOutlineGeometry();\n        }\n\n        return result;\n    };\n\n    var min = new Cartesian3(-0.5, -0.5, 0.0);\n    var max = new Cartesian3( 0.5,  0.5, 0.0);\n\n    /**\n     * Computes the geometric representation of an outline of a plane, including its vertices, indices, and a bounding sphere.\n     *\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    PlaneOutlineGeometry.createGeometry = function() {\n        var attributes = new GeometryAttributes();\n        var indices = new Uint16Array(4 * 2);\n        var positions = new Float64Array(4 * 3);\n\n        positions[0] = min.x;\n        positions[1] = min.y;\n        positions[2] = min.z;\n        positions[3] = max.x;\n        positions[4] = min.y;\n        positions[5] = min.z;\n        positions[6] = max.x;\n        positions[7] = max.y;\n        positions[8] = min.z;\n        positions[9] = min.x;\n        positions[10] = max.y;\n        positions[11] = min.z;\n\n        attributes.position = new GeometryAttribute({\n            componentDatatype : ComponentDatatype.DOUBLE,\n            componentsPerAttribute : 3,\n            values : positions\n        });\n\n        indices[0] = 0;\n        indices[1] = 1;\n        indices[2] = 1;\n        indices[3] = 2;\n        indices[4] = 2;\n        indices[5] = 3;\n        indices[6] = 3;\n        indices[7] = 0;\n\n        return new Geometry({\n            attributes : attributes,\n            indices : indices,\n            primitiveType : PrimitiveType.LINES,\n            boundingSphere : new BoundingSphere(Cartesian3.ZERO, Math.sqrt(2.0))\n        });\n    };\nexport default PlaneOutlineGeometry;\n","import Cartesian2 from '../Core/Cartesian2.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Check from '../Core/Check.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport DistanceDisplayConditionGeometryInstanceAttribute from '../Core/DistanceDisplayConditionGeometryInstanceAttribute.js';\nimport GeometryInstance from '../Core/GeometryInstance.js';\nimport Iso8601 from '../Core/Iso8601.js';\nimport CesiumMath from '../Core/Math.js';\nimport Matrix3 from '../Core/Matrix3.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport PlaneGeometry from '../Core/PlaneGeometry.js';\nimport PlaneOutlineGeometry from '../Core/PlaneOutlineGeometry.js';\nimport Quaternion from '../Core/Quaternion.js';\nimport ShowGeometryInstanceAttribute from '../Core/ShowGeometryInstanceAttribute.js';\nimport MaterialAppearance from '../Scene/MaterialAppearance.js';\nimport PerInstanceColorAppearance from '../Scene/PerInstanceColorAppearance.js';\nimport ColorMaterialProperty from './ColorMaterialProperty.js';\nimport DynamicGeometryUpdater from './DynamicGeometryUpdater.js';\nimport GeometryUpdater from './GeometryUpdater.js';\nimport Property from './Property.js';\n\n    var positionScratch = new Cartesian3();\n    var scratchColor = new Color();\n\n    function PlaneGeometryOptions(entity) {\n        this.id = entity;\n        this.vertexFormat = undefined;\n        this.plane = undefined;\n        this.dimensions = undefined;\n    }\n\n    /**\n     * A {@link GeometryUpdater} for planes.\n     * Clients do not normally create this class directly, but instead rely on {@link DataSourceDisplay}.\n     * @alias PlaneGeometryUpdater\n     * @constructor\n     *\n     * @param {Entity} entity The entity containing the geometry to be visualized.\n     * @param {Scene} scene The scene where visualization is taking place.\n     */\n    function PlaneGeometryUpdater(entity, scene) {\n        GeometryUpdater.call(this, {\n            entity : entity,\n            scene : scene,\n            geometryOptions : new PlaneGeometryOptions(entity),\n            geometryPropertyName : 'plane',\n            observedPropertyNames : ['availability', 'position', 'orientation', 'plane']\n        });\n\n        this._onEntityPropertyChanged(entity, 'plane', entity.plane, undefined);\n    }\n\n    if (defined(Object.create)) {\n        PlaneGeometryUpdater.prototype = Object.create(GeometryUpdater.prototype);\n        PlaneGeometryUpdater.prototype.constructor = PlaneGeometryUpdater;\n    }\n\n    /**\n     * Creates the geometry instance which represents the fill of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the filled portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent a filled geometry.\n     */\n    PlaneGeometryUpdater.prototype.createFillGeometryInstance = function(time) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n\n        var attributes;\n\n        var color;\n        var show = new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._fillProperty.getValue(time));\n        var distanceDisplayCondition = this._distanceDisplayConditionProperty.getValue(time);\n        var distanceDisplayConditionAttribute = DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(distanceDisplayCondition);\n        if (this._materialProperty instanceof ColorMaterialProperty) {\n            var currentColor;\n            if (defined(this._materialProperty.color) && (this._materialProperty.color.isConstant || isAvailable)) {\n                currentColor = this._materialProperty.color.getValue(time, scratchColor);\n            }\n            if (!defined(currentColor)) {\n                currentColor = Color.WHITE;\n            }\n            color = ColorGeometryInstanceAttribute.fromColor(currentColor);\n            attributes = {\n                show : show,\n                distanceDisplayCondition : distanceDisplayConditionAttribute,\n                color : color\n            };\n        } else {\n            attributes = {\n                show : show,\n                distanceDisplayCondition : distanceDisplayConditionAttribute\n            };\n        }\n\n        var planeGraphics = entity.plane;\n        var options = this._options;\n        var modelMatrix = entity.computeModelMatrix(time);\n        var plane = Property.getValueOrDefault(planeGraphics.plane, time, options.plane);\n        var dimensions = Property.getValueOrUndefined(planeGraphics.dimensions, time, options.dimensions);\n\n        options.plane = plane;\n        options.dimensions = dimensions;\n\n        modelMatrix = createPrimitiveMatrix(plane, dimensions, modelMatrix, this._scene.mapProjection.ellipsoid, modelMatrix);\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : new PlaneGeometry(this._options),\n            modelMatrix : modelMatrix,\n            attributes : attributes\n        });\n    };\n\n    /**\n     * Creates the geometry instance which represents the outline of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the outline portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent an outlined geometry.\n     */\n    PlaneGeometryUpdater.prototype.createOutlineGeometryInstance = function(time) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n        var outlineColor = Property.getValueOrDefault(this._outlineColorProperty, time, Color.BLACK, scratchColor);\n        var distanceDisplayCondition = this._distanceDisplayConditionProperty.getValue(time);\n\n        var planeGraphics = entity.plane;\n        var options = this._options;\n        var modelMatrix = entity.computeModelMatrix(time);\n        var plane = Property.getValueOrDefault(planeGraphics.plane, time, options.plane);\n        var dimensions = Property.getValueOrUndefined(planeGraphics.dimensions, time, options.dimensions);\n\n        options.plane = plane;\n        options.dimensions = dimensions;\n\n        modelMatrix = createPrimitiveMatrix(plane, dimensions, modelMatrix, this._scene.mapProjection.ellipsoid, modelMatrix);\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : new PlaneOutlineGeometry(),\n            modelMatrix : modelMatrix,\n            attributes : {\n                show : new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._showOutlineProperty.getValue(time)),\n                color : ColorGeometryInstanceAttribute.fromColor(outlineColor),\n                distanceDisplayCondition : DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(distanceDisplayCondition)\n            }\n        });\n    };\n\n    PlaneGeometryUpdater.prototype._isHidden = function(entity, plane) {\n        return !defined(plane.plane) || !defined(plane.dimensions) || !defined(entity.position) || GeometryUpdater.prototype._isHidden.call(this, entity, plane);\n    };\n\n    PlaneGeometryUpdater.prototype._getIsClosed = function(options) {\n        return false;\n    };\n\n    PlaneGeometryUpdater.prototype._isDynamic = function(entity, plane) {\n        return !entity.position.isConstant || //\n               !Property.isConstant(entity.orientation) || //\n               !plane.plane.isConstant || //\n               !plane.dimensions.isConstant || //\n               !Property.isConstant(plane.outlineWidth);\n    };\n\n    PlaneGeometryUpdater.prototype._setStaticOptions = function(entity, plane) {\n        var isColorMaterial = this._materialProperty instanceof ColorMaterialProperty;\n\n        var options = this._options;\n        options.vertexFormat = isColorMaterial ? PerInstanceColorAppearance.VERTEX_FORMAT : MaterialAppearance.MaterialSupport.TEXTURED.vertexFormat;\n        options.plane = plane.plane.getValue(Iso8601.MINIMUM_VALUE, options.plane);\n        options.dimensions = plane.dimensions.getValue(Iso8601.MINIMUM_VALUE, options.dimensions);\n    };\n\n    PlaneGeometryUpdater.DynamicGeometryUpdater = DynamicPlaneGeometryUpdater;\n\n    /**\n     * @private\n     */\n    function DynamicPlaneGeometryUpdater(geometryUpdater, primitives, groundPrimitives) {\n        DynamicGeometryUpdater.call(this, geometryUpdater, primitives, groundPrimitives);\n    }\n\n    if (defined(Object.create)) {\n        DynamicPlaneGeometryUpdater.prototype = Object.create(DynamicGeometryUpdater.prototype);\n        DynamicPlaneGeometryUpdater.prototype.constructor = DynamicPlaneGeometryUpdater;\n    }\n\n    DynamicPlaneGeometryUpdater.prototype._isHidden = function(entity, plane, time) {\n        var options = this._options;\n        var position = Property.getValueOrUndefined(entity.position, time, positionScratch);\n        return !defined(position) || !defined(options.plane) || !defined(options.dimensions) || DynamicGeometryUpdater.prototype._isHidden.call(this, entity, plane, time);\n    };\n\n    DynamicPlaneGeometryUpdater.prototype._setOptions = function(entity, plane, time) {\n        var options = this._options;\n        options.plane = Property.getValueOrDefault(plane.plane, time, options.plane);\n        options.dimensions = Property.getValueOrUndefined(plane.dimensions, time, options.dimensions);\n    };\n\n    var scratchAxis = new Cartesian3();\n    var scratchAxis2 = new Cartesian3();\n    var scratchTranslation = new Cartesian3();\n    var scratchNormal = new Cartesian3();\n    var scratchScale = new Cartesian3();\n    var scratchQuaternion = new Quaternion();\n    var scratchMatrix3 = new Matrix3();\n    function createPrimitiveMatrix(plane, dimensions, transform, ellipsoid, result) {\n        var normal = plane.normal;\n        var distance = plane.distance;\n\n        var translation = Cartesian3.multiplyByScalar(normal, -distance, scratchTranslation);\n        translation = Matrix4.multiplyByPoint(transform, translation, translation);\n\n        var transformedNormal = Matrix4.multiplyByPointAsVector(transform, normal, scratchNormal);\n        Cartesian3.normalize(transformedNormal, transformedNormal);\n\n        var up = ellipsoid.geodeticSurfaceNormal(translation, scratchAxis2);\n        if (CesiumMath.equalsEpsilon(Math.abs(Cartesian3.dot(up, transformedNormal)), 1.0, CesiumMath.EPSILON8)) {\n            up = Cartesian3.clone(Cartesian3.UNIT_Z, up);\n            if (CesiumMath.equalsEpsilon(Math.abs(Cartesian3.dot(up, transformedNormal)), 1.0, CesiumMath.EPSILON8)) {\n                up = Cartesian3.clone(Cartesian3.UNIT_X, up);\n            }\n        }\n\n        var left = Cartesian3.cross(up, transformedNormal, scratchAxis);\n        up = Cartesian3.cross(transformedNormal, left, up);\n        Cartesian3.normalize(left, left);\n        Cartesian3.normalize(up, up);\n\n        var rotationMatrix = scratchMatrix3;\n        Matrix3.setColumn(rotationMatrix, 0, left, rotationMatrix);\n        Matrix3.setColumn(rotationMatrix, 1, up, rotationMatrix);\n        Matrix3.setColumn(rotationMatrix, 2, transformedNormal, rotationMatrix);\n        var rotation = Quaternion.fromRotationMatrix(rotationMatrix, scratchQuaternion);\n\n        var scale = Cartesian2.clone(dimensions, scratchScale);\n        scale.z = 1.0;\n\n        return Matrix4.fromTranslationQuaternionRotationScale(translation, rotation, scale, result);\n    }\n\n    /**\n     * @private\n     */\n    PlaneGeometryUpdater.createPrimitiveMatrix = createPrimitiveMatrix;\nexport default PlaneGeometryUpdater;\n","import Cartesian2 from './Cartesian2.js';\nimport Cartesian3 from './Cartesian3.js';\nimport Check from './Check.js';\nimport Matrix3 from './Matrix3.js';\nimport OrientedBoundingBox from './OrientedBoundingBox.js';\n\n    /**\n     * @private\n     */\n    var CoplanarPolygonGeometryLibrary = {};\n\n    var scratchIntersectionPoint = new Cartesian3();\n    var scratchXAxis = new Cartesian3();\n    var scratchYAxis = new Cartesian3();\n    var scratchZAxis = new Cartesian3();\n    var obbScratch = new OrientedBoundingBox();\n\n    CoplanarPolygonGeometryLibrary.validOutline = function(positions) {\n        \n\n        var orientedBoundingBox = OrientedBoundingBox.fromPoints(positions, obbScratch);\n        var halfAxes = orientedBoundingBox.halfAxes;\n        var xAxis = Matrix3.getColumn(halfAxes, 0, scratchXAxis);\n        var yAxis = Matrix3.getColumn(halfAxes, 1, scratchYAxis);\n        var zAxis = Matrix3.getColumn(halfAxes, 2, scratchZAxis);\n\n        var xMag = Cartesian3.magnitude(xAxis);\n        var yMag = Cartesian3.magnitude(yAxis);\n        var zMag = Cartesian3.magnitude(zAxis);\n\n        // If all the points are on a line return undefined because we can't draw a polygon\n        return !((xMag === 0 && (yMag === 0 || zMag === 0)) || (yMag === 0 && zMag === 0));\n    };\n\n    // call after removeDuplicates\n    CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments = function(positions, centerResult, planeAxis1Result, planeAxis2Result) {\n        \n\n        var orientedBoundingBox = OrientedBoundingBox.fromPoints(positions, obbScratch);\n        var halfAxes = orientedBoundingBox.halfAxes;\n        var xAxis = Matrix3.getColumn(halfAxes, 0, scratchXAxis);\n        var yAxis = Matrix3.getColumn(halfAxes, 1, scratchYAxis);\n        var zAxis = Matrix3.getColumn(halfAxes, 2, scratchZAxis);\n\n        var xMag = Cartesian3.magnitude(xAxis);\n        var yMag = Cartesian3.magnitude(yAxis);\n        var zMag = Cartesian3.magnitude(zAxis);\n        var min = Math.min(xMag, yMag, zMag);\n\n        // If all the points are on a line return undefined because we can't draw a polygon\n        if ((xMag === 0 && (yMag === 0 || zMag === 0)) || (yMag === 0 && zMag === 0)) {\n            return false;\n        }\n\n        var planeAxis1;\n        var planeAxis2;\n\n        if (min === yMag || min === zMag) {\n            planeAxis1 = xAxis;\n        }\n        if (min === xMag) {\n            planeAxis1 = yAxis;\n        } else if (min === zMag) {\n            planeAxis2 = yAxis;\n        }\n        if (min === xMag || min === yMag) {\n            planeAxis2 = zAxis;\n        }\n\n        Cartesian3.normalize(planeAxis1, planeAxis1Result);\n        Cartesian3.normalize(planeAxis2, planeAxis2Result);\n        Cartesian3.clone(orientedBoundingBox.center, centerResult);\n        return true;\n    };\n\n    function projectTo2D(position, center, axis1, axis2, result) {\n        var v = Cartesian3.subtract(position, center, scratchIntersectionPoint);\n        var x = Cartesian3.dot(axis1, v);\n        var y = Cartesian3.dot(axis2, v);\n\n        return Cartesian2.fromElements(x, y, result);\n    }\n\n    CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction = function(center, axis1, axis2) {\n        return function(positions) {\n            var positionResults = new Array(positions.length);\n            for (var i = 0; i < positions.length; i++) {\n                positionResults[i] = projectTo2D(positions[i], center, axis1, axis2);\n            }\n\n            return positionResults;\n        };\n    };\n\n    CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction = function(center, axis1, axis2) {\n        return function(position, result) {\n            return projectTo2D(position, center, axis1, axis2, result);\n        };\n    };\nexport default CoplanarPolygonGeometryLibrary;\n","import arrayRemoveDuplicates from './arrayRemoveDuplicates.js';\nimport BoundingRectangle from './BoundingRectangle.js';\nimport BoundingSphere from './BoundingSphere.js';\nimport Cartesian2 from './Cartesian2.js';\nimport Cartesian3 from './Cartesian3.js';\nimport Check from './Check.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport CoplanarPolygonGeometryLibrary from './CoplanarPolygonGeometryLibrary.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport Ellipsoid from './Ellipsoid.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport GeometryInstance from './GeometryInstance.js';\nimport GeometryPipeline from './GeometryPipeline.js';\nimport IndexDatatype from './IndexDatatype.js';\nimport CesiumMath from './Math.js';\nimport Matrix3 from './Matrix3.js';\nimport PolygonGeometryLibrary from './PolygonGeometryLibrary.js';\nimport PolygonPipeline from './PolygonPipeline.js';\nimport PrimitiveType from './PrimitiveType.js';\nimport Quaternion from './Quaternion.js';\nimport VertexFormat from './VertexFormat.js';\n\n    var scratchPosition = new Cartesian3();\n    var scratchBR = new BoundingRectangle();\n    var stScratch = new Cartesian2();\n    var textureCoordinatesOrigin = new Cartesian2();\n    var scratchNormal = new Cartesian3();\n    var scratchTangent = new Cartesian3();\n    var scratchBitangent = new Cartesian3();\n    var centerScratch = new Cartesian3();\n    var axis1Scratch = new Cartesian3();\n    var axis2Scratch = new Cartesian3();\n    var quaternionScratch = new Quaternion();\n    var textureMatrixScratch = new Matrix3();\n    var tangentRotationScratch = new Matrix3();\n    var surfaceNormalScratch = new Cartesian3();\n\n    function createGeometryFromPolygon(polygon, vertexFormat, boundingRectangle, stRotation, projectPointTo2D, normal, tangent, bitangent) {\n        var positions = polygon.positions;\n        var indices = PolygonPipeline.triangulate(polygon.positions2D, polygon.holes);\n\n        /* If polygon is completely unrenderable, just use the first three vertices */\n        if (indices.length < 3) {\n            indices = [0, 1, 2];\n        }\n\n        var newIndices = IndexDatatype.createTypedArray(positions.length, indices.length);\n        newIndices.set(indices);\n\n        var textureMatrix = textureMatrixScratch;\n        if (stRotation !== 0.0) {\n            var rotation = Quaternion.fromAxisAngle(normal, stRotation, quaternionScratch);\n            textureMatrix = Matrix3.fromQuaternion(rotation, textureMatrix);\n\n            if (vertexFormat.tangent || vertexFormat.bitangent) {\n                rotation = Quaternion.fromAxisAngle(normal, -stRotation, quaternionScratch);\n                var tangentRotation = Matrix3.fromQuaternion(rotation, tangentRotationScratch);\n\n                tangent = Cartesian3.normalize(Matrix3.multiplyByVector(tangentRotation, tangent, tangent), tangent);\n                if (vertexFormat.bitangent) {\n                    bitangent = Cartesian3.normalize(Cartesian3.cross(normal, tangent, bitangent), bitangent);\n                }\n            }\n        } else {\n            textureMatrix = Matrix3.clone(Matrix3.IDENTITY, textureMatrix);\n        }\n\n        var stOrigin = textureCoordinatesOrigin;\n        if (vertexFormat.st) {\n            stOrigin.x = boundingRectangle.x;\n            stOrigin.y = boundingRectangle.y;\n        }\n\n        var length = positions.length;\n        var size = length * 3;\n        var flatPositions = new Float64Array(size);\n        var normals = vertexFormat.normal ? new Float32Array(size) : undefined;\n        var tangents = vertexFormat.tangent ? new Float32Array(size) : undefined;\n        var bitangents = vertexFormat.bitangent ? new Float32Array(size) : undefined;\n        var textureCoordinates = vertexFormat.st ? new Float32Array(length * 2) : undefined;\n\n        var positionIndex = 0;\n        var normalIndex = 0;\n        var bitangentIndex = 0;\n        var tangentIndex = 0;\n        var stIndex = 0;\n\n        for (var i = 0; i < length; i++) {\n            var position = positions[i];\n            flatPositions[positionIndex++] = position.x;\n            flatPositions[positionIndex++] = position.y;\n            flatPositions[positionIndex++] = position.z;\n\n            if (vertexFormat.st) {\n                var p = Matrix3.multiplyByVector(textureMatrix, position, scratchPosition);\n                var st = projectPointTo2D(p, stScratch);\n                Cartesian2.subtract(st, stOrigin, st);\n\n                var stx = CesiumMath.clamp(st.x / boundingRectangle.width, 0, 1);\n                var sty = CesiumMath.clamp(st.y / boundingRectangle.height, 0, 1);\n                textureCoordinates[stIndex++] = stx;\n                textureCoordinates[stIndex++] = sty;\n            }\n\n            if (vertexFormat.normal) {\n                normals[normalIndex++] = normal.x;\n                normals[normalIndex++] = normal.y;\n                normals[normalIndex++] = normal.z;\n            }\n\n            if (vertexFormat.tangent) {\n                tangents[tangentIndex++] = tangent.x;\n                tangents[tangentIndex++] = tangent.y;\n                tangents[tangentIndex++] = tangent.z;\n            }\n\n            if (vertexFormat.bitangent) {\n                bitangents[bitangentIndex++] = bitangent.x;\n                bitangents[bitangentIndex++] = bitangent.y;\n                bitangents[bitangentIndex++] = bitangent.z;\n            }\n        }\n\n        var attributes = new GeometryAttributes();\n\n        if (vertexFormat.position) {\n            attributes.position = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.DOUBLE,\n                componentsPerAttribute : 3,\n                values : flatPositions\n            });\n        }\n\n        if (vertexFormat.normal) {\n            attributes.normal = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : normals\n            });\n        }\n\n        if (vertexFormat.tangent) {\n            attributes.tangent = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : tangents\n            });\n        }\n\n        if (vertexFormat.bitangent) {\n            attributes.bitangent = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : bitangents\n            });\n        }\n\n        if (vertexFormat.st) {\n            attributes.st = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 2,\n                values : textureCoordinates\n            });\n        }\n\n        return new Geometry({\n            attributes : attributes,\n            indices : newIndices,\n            primitiveType : PrimitiveType.TRIANGLES\n        });\n    }\n\n    /**\n     * A description of a polygon composed of arbitrary coplanar positions.\n     *\n     * @alias CoplanarPolygonGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {PolygonHierarchy} options.polygonHierarchy A polygon hierarchy that can include holes.\n     * @param {Number} [options.stRotation=0.0] The rotation of the texture coordinates, in radians. A positive rotation is counter-clockwise.\n     * @param {VertexFormat} [options.vertexFormat=VertexFormat.DEFAULT] The vertex attributes to be computed.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid to be used as a reference.\n     *\n     * @example\n     * var polygon = new Cesium.CoplanarPolygonGeometry({\n     *   positions : Cesium.Cartesian3.fromDegreesArrayHeights([\n     *      -90.0, 30.0, 0.0,\n     *      -90.0, 30.0, 1000.0,\n     *      -80.0, 30.0, 1000.0,\n     *      -80.0, 30.0, 0.0\n     *   ])\n     * });\n     * var geometry = Cesium.CoplanarPolygonGeometry.createGeometry(polygon);\n     *\n     * @see CoplanarPolygonGeometry.createGeometry\n     */\n    function CoplanarPolygonGeometry(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n        var polygonHierarchy = options.polygonHierarchy;\n        \n\n        var vertexFormat = defaultValue(options.vertexFormat, VertexFormat.DEFAULT);\n        this._vertexFormat = VertexFormat.clone(vertexFormat);\n        this._polygonHierarchy = polygonHierarchy;\n        this._stRotation = defaultValue(options.stRotation, 0.0);\n        this._ellipsoid = Ellipsoid.clone(defaultValue(options.ellipsoid, Ellipsoid.WGS84));\n        this._workerName = 'createCoplanarPolygonGeometry';\n\n        /**\n         * The number of elements used to pack the object into an array.\n         * @type {Number}\n         */\n        this.packedLength = PolygonGeometryLibrary.computeHierarchyPackedLength(polygonHierarchy) + VertexFormat.packedLength + Ellipsoid.packedLength + 2;\n    }\n\n    /**\n     * A description of a coplanar polygon from an array of positions.\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3[]} options.positions An array of positions that defined the corner points of the polygon.\n     * @param {VertexFormat} [options.vertexFormat=VertexFormat.DEFAULT] The vertex attributes to be computed.\n     * @param {Number} [options.stRotation=0.0] The rotation of the texture coordinates, in radians. A positive rotation is counter-clockwise.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid to be used as a reference.\n     * @returns {CoplanarPolygonGeometry}\n     *\n     * @example\n     * // create a polygon from points\n     * var polygon = Cesium.CoplanarPolygonGeometry.fromPositions({\n     *   positions : Cesium.Cartesian3.fromDegreesArray([\n     *     -72.0, 40.0,\n     *     -70.0, 35.0,\n     *     -75.0, 30.0,\n     *     -70.0, 30.0,\n     *     -68.0, 40.0\n     *   ])\n     * });\n     * var geometry = Cesium.PolygonGeometry.createGeometry(polygon);\n     *\n     * @see PolygonGeometry#createGeometry\n     */\n    CoplanarPolygonGeometry.fromPositions = function(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        \n\n        var newOptions = {\n            polygonHierarchy : {\n                positions : options.positions\n            },\n            vertexFormat : options.vertexFormat,\n            stRotation : options.stRotation,\n            ellipsoid : options.ellipsoid\n        };\n        return new CoplanarPolygonGeometry(newOptions);\n    };\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {CoplanarPolygonGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    CoplanarPolygonGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        startingIndex = PolygonGeometryLibrary.packPolygonHierarchy(value._polygonHierarchy, array, startingIndex);\n\n        Ellipsoid.pack(value._ellipsoid, array, startingIndex);\n        startingIndex += Ellipsoid.packedLength;\n\n        VertexFormat.pack(value._vertexFormat, array, startingIndex);\n        startingIndex += VertexFormat.packedLength;\n\n        array[startingIndex++] = value._stRotation;\n        array[startingIndex] = value.packedLength;\n\n        return array;\n    };\n\n    var scratchEllipsoid = Ellipsoid.clone(Ellipsoid.UNIT_SPHERE);\n    var scratchVertexFormat = new VertexFormat();\n    var scratchOptions = {\n        polygonHierarchy : {}\n    };\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {CoplanarPolygonGeometry} [result] The object into which to store the result.\n     * @returns {CoplanarPolygonGeometry} The modified result parameter or a new CoplanarPolygonGeometry instance if one was not provided.\n     */\n    CoplanarPolygonGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var polygonHierarchy = PolygonGeometryLibrary.unpackPolygonHierarchy(array, startingIndex);\n        startingIndex = polygonHierarchy.startingIndex;\n        delete polygonHierarchy.startingIndex;\n\n        var ellipsoid = Ellipsoid.unpack(array, startingIndex, scratchEllipsoid);\n        startingIndex += Ellipsoid.packedLength;\n\n        var vertexFormat = VertexFormat.unpack(array, startingIndex, scratchVertexFormat);\n        startingIndex += VertexFormat.packedLength;\n\n        var stRotation = array[startingIndex++];\n        var packedLength = array[startingIndex];\n\n        if (!defined(result)) {\n            result = new CoplanarPolygonGeometry(scratchOptions);\n        }\n\n        result._polygonHierarchy = polygonHierarchy;\n        result._ellipsoid = Ellipsoid.clone(ellipsoid, result._ellipsoid);\n        result._vertexFormat = VertexFormat.clone(vertexFormat, result._vertexFormat);\n        result._stRotation = stRotation;\n        result.packedLength = packedLength;\n        return result;\n    };\n\n    /**\n     * Computes the geometric representation of an arbitrary coplanar polygon, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {CoplanarPolygonGeometry} polygonGeometry A description of the polygon.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    CoplanarPolygonGeometry.createGeometry = function(polygonGeometry) {\n        var vertexFormat = polygonGeometry._vertexFormat;\n        var polygonHierarchy = polygonGeometry._polygonHierarchy;\n        var stRotation = polygonGeometry._stRotation;\n\n        var outerPositions = polygonHierarchy.positions;\n        outerPositions = arrayRemoveDuplicates(outerPositions, Cartesian3.equalsEpsilon, true);\n        if (outerPositions.length < 3) {\n            return;\n        }\n\n        var normal = scratchNormal;\n        var tangent = scratchTangent;\n        var bitangent = scratchBitangent;\n        var axis1 = axis1Scratch;\n        var axis2 = axis2Scratch;\n\n        var validGeometry = CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(outerPositions, centerScratch, axis1, axis2);\n        if (!validGeometry) {\n            return undefined;\n        }\n\n        normal = Cartesian3.cross(axis1, axis2, normal);\n        normal = Cartesian3.normalize(normal, normal);\n\n        if (!Cartesian3.equalsEpsilon(centerScratch, Cartesian3.ZERO, CesiumMath.EPSILON6)) {\n            var surfaceNormal = polygonGeometry._ellipsoid.geodeticSurfaceNormal(centerScratch, surfaceNormalScratch);\n            if (Cartesian3.dot(normal, surfaceNormal) < 0) {\n                normal = Cartesian3.negate(normal, normal);\n                axis1 = Cartesian3.negate(axis1, axis1);\n            }\n        }\n\n        var projectPoints = CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(centerScratch, axis1, axis2);\n        var projectPoint = CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(centerScratch, axis1, axis2);\n\n        if (vertexFormat.tangent) {\n            tangent = Cartesian3.clone(axis1, tangent);\n        }\n        if (vertexFormat.bitangent) {\n            bitangent = Cartesian3.clone(axis2, bitangent);\n        }\n\n        var results = PolygonGeometryLibrary.polygonsFromHierarchy(polygonHierarchy, projectPoints, false);\n        var hierarchy = results.hierarchy;\n        var polygons = results.polygons;\n\n        if (hierarchy.length === 0) {\n            return;\n        }\n        outerPositions = hierarchy[0].outerRing;\n\n        var boundingSphere = BoundingSphere.fromPoints(outerPositions);\n        var boundingRectangle = PolygonGeometryLibrary.computeBoundingRectangle(normal, projectPoint, outerPositions, stRotation, scratchBR);\n\n        var geometries = [];\n        for (var i = 0; i < polygons.length; i++) {\n            var geometryInstance = new GeometryInstance({\n                geometry : createGeometryFromPolygon(polygons[i], vertexFormat, boundingRectangle, stRotation, projectPoint, normal, tangent, bitangent)\n            });\n\n            geometries.push(geometryInstance);\n        }\n\n        var geometry = GeometryPipeline.combineInstances(geometries)[0];\n        geometry.attributes.position.values = new Float64Array(geometry.attributes.position.values);\n        geometry.indices = IndexDatatype.createTypedArray(geometry.attributes.position.values.length / 3, geometry.indices);\n\n        var attributes = geometry.attributes;\n        if (!vertexFormat.position) {\n            delete attributes.position;\n        }\n        return new Geometry({\n            attributes : attributes,\n            indices : geometry.indices,\n            primitiveType : geometry.primitiveType,\n            boundingSphere : boundingSphere\n        });\n    };\nexport default CoplanarPolygonGeometry;\n","import arrayRemoveDuplicates from './arrayRemoveDuplicates.js';\nimport BoundingSphere from './BoundingSphere.js';\nimport Cartesian3 from './Cartesian3.js';\nimport Check from './Check.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport CoplanarPolygonGeometryLibrary from './CoplanarPolygonGeometryLibrary.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport GeometryInstance from './GeometryInstance.js';\nimport GeometryPipeline from './GeometryPipeline.js';\nimport IndexDatatype from './IndexDatatype.js';\nimport PolygonGeometryLibrary from './PolygonGeometryLibrary.js';\nimport PrimitiveType from './PrimitiveType.js';\n\n    function createGeometryFromPositions(positions){\n        var length = positions.length;\n        var flatPositions = new Float64Array(length * 3);\n        var indices = IndexDatatype.createTypedArray(length, length * 2);\n\n        var positionIndex = 0;\n        var index = 0;\n\n        for (var i = 0; i < length; i++) {\n            var position = positions[i];\n            flatPositions[positionIndex++] = position.x;\n            flatPositions[positionIndex++] = position.y;\n            flatPositions[positionIndex++] = position.z;\n\n            indices[index++] = i;\n            indices[index++] = (i + 1) % length;\n        }\n\n        var attributes = new GeometryAttributes({\n            position: new GeometryAttribute({\n                componentDatatype : ComponentDatatype.DOUBLE,\n                componentsPerAttribute : 3,\n                values : flatPositions\n            })\n        });\n\n        return new Geometry({\n            attributes : attributes,\n            indices : indices,\n            primitiveType : PrimitiveType.LINES\n        });\n    }\n\n    /**\n     * A description of the outline of a polygon composed of arbitrary coplanar positions.\n     *\n     * @alias CoplanarPolygonOutlineGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {PolygonHierarchy} options.polygonHierarchy A polygon hierarchy that can include holes.\n     *\n     * @see CoplanarPolygonOutlineGeometry.createGeometry\n     *\n     * @example\n     * var polygonOutline = new Cesium.CoplanarPolygonOutlineGeometry({\n     *   positions : Cesium.Cartesian3.fromDegreesArrayHeights([\n     *      -90.0, 30.0, 0.0,\n     *      -90.0, 30.0, 1000.0,\n     *      -80.0, 30.0, 1000.0,\n     *      -80.0, 30.0, 0.0\n     *   ])\n     * });\n     * var geometry = Cesium.CoplanarPolygonOutlineGeometry.createGeometry(polygonOutline);\n     */\n    function CoplanarPolygonOutlineGeometry(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n        var polygonHierarchy = options.polygonHierarchy;\n        \n\n        this._polygonHierarchy = polygonHierarchy;\n        this._workerName = 'createCoplanarPolygonOutlineGeometry';\n\n        /**\n         * The number of elements used to pack the object into an array.\n         * @type {Number}\n         */\n        this.packedLength = PolygonGeometryLibrary.computeHierarchyPackedLength(polygonHierarchy) + 1;\n    }\n\n    /**\n     * A description of a coplanar polygon outline from an array of positions.\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3[]} options.positions An array of positions that defined the corner points of the polygon.\n     * @returns {CoplanarPolygonOutlineGeometry}\n     */\n    CoplanarPolygonOutlineGeometry.fromPositions = function(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        \n\n        var newOptions = {\n            polygonHierarchy : {\n                positions : options.positions\n            }\n        };\n        return new CoplanarPolygonOutlineGeometry(newOptions);\n    };\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {CoplanarPolygonOutlineGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    CoplanarPolygonOutlineGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        startingIndex = PolygonGeometryLibrary.packPolygonHierarchy(value._polygonHierarchy, array, startingIndex);\n\n        array[startingIndex] = value.packedLength;\n\n        return array;\n    };\n\n    var scratchOptions = {\n        polygonHierarchy : {}\n    };\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {CoplanarPolygonOutlineGeometry} [result] The object into which to store the result.\n     * @returns {CoplanarPolygonOutlineGeometry} The modified result parameter or a new CoplanarPolygonOutlineGeometry instance if one was not provided.\n     */\n    CoplanarPolygonOutlineGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var polygonHierarchy = PolygonGeometryLibrary.unpackPolygonHierarchy(array, startingIndex);\n        startingIndex = polygonHierarchy.startingIndex;\n        delete polygonHierarchy.startingIndex;\n        var packedLength = array[startingIndex];\n\n        if (!defined(result)) {\n            result = new CoplanarPolygonOutlineGeometry(scratchOptions);\n        }\n\n        result._polygonHierarchy = polygonHierarchy;\n        result.packedLength = packedLength;\n\n        return result;\n    };\n\n    /**\n     * Computes the geometric representation of an arbitrary coplanar polygon, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {CoplanarPolygonOutlineGeometry} polygonGeometry A description of the polygon.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    CoplanarPolygonOutlineGeometry.createGeometry = function(polygonGeometry) {\n        var polygonHierarchy = polygonGeometry._polygonHierarchy;\n\n        var outerPositions = polygonHierarchy.positions;\n        outerPositions = arrayRemoveDuplicates(outerPositions, Cartesian3.equalsEpsilon, true);\n        if (outerPositions.length < 3) {\n            return;\n        }\n        var isValid = CoplanarPolygonGeometryLibrary.validOutline(outerPositions);\n        if (!isValid) {\n            return undefined;\n        }\n\n        var polygons = PolygonGeometryLibrary.polygonOutlinesFromHierarchy(polygonHierarchy, false);\n\n        if (polygons.length === 0) {\n            return undefined;\n        }\n\n        var geometries = [];\n\n        for (var i = 0; i < polygons.length; i++) {\n            var geometryInstance = new GeometryInstance({\n                geometry : createGeometryFromPositions(polygons[i])\n            });\n            geometries.push(geometryInstance);\n        }\n\n        var geometry = GeometryPipeline.combineInstances(geometries)[0];\n        var boundingSphere = BoundingSphere.fromPoints(polygonHierarchy.positions);\n\n        return new Geometry({\n            attributes : geometry.attributes,\n            indices : geometry.indices,\n            primitiveType : geometry.primitiveType,\n            boundingSphere : boundingSphere\n        });\n    };\nexport default CoplanarPolygonOutlineGeometry;\n","import ArcType from './ArcType.js';\nimport arrayFill from './arrayFill.js';\nimport BoundingRectangle from './BoundingRectangle.js';\nimport BoundingSphere from './BoundingSphere.js';\nimport Cartesian2 from './Cartesian2.js';\nimport Cartesian3 from './Cartesian3.js';\nimport Cartographic from './Cartographic.js';\nimport Check from './Check.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport DeveloperError from './DeveloperError.js';\nimport Ellipsoid from './Ellipsoid.js';\nimport EllipsoidGeodesic from './EllipsoidGeodesic.js';\nimport EllipsoidTangentPlane from './EllipsoidTangentPlane.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryInstance from './GeometryInstance.js';\nimport GeometryOffsetAttribute from './GeometryOffsetAttribute.js';\nimport GeometryPipeline from './GeometryPipeline.js';\nimport IndexDatatype from './IndexDatatype.js';\nimport CesiumMath from './Math.js';\nimport Matrix3 from './Matrix3.js';\nimport PolygonGeometryLibrary from './PolygonGeometryLibrary.js';\nimport PolygonPipeline from './PolygonPipeline.js';\nimport Quaternion from './Quaternion.js';\nimport Rectangle from './Rectangle.js';\nimport VertexFormat from './VertexFormat.js';\nimport WindingOrder from './WindingOrder.js';\n\n    var scratchCarto1 = new Cartographic();\n    var scratchCarto2 = new Cartographic();\n    function adjustPosHeightsForNormal(position, p1, p2, ellipsoid) {\n        var carto1 = ellipsoid.cartesianToCartographic(position, scratchCarto1);\n        var height = carto1.height;\n        var p1Carto = ellipsoid.cartesianToCartographic(p1, scratchCarto2);\n        p1Carto.height = height;\n        ellipsoid.cartographicToCartesian(p1Carto, p1);\n\n        var p2Carto = ellipsoid.cartesianToCartographic(p2, scratchCarto2);\n        p2Carto.height = height - 100;\n        ellipsoid.cartographicToCartesian(p2Carto, p2);\n    }\n\n    var scratchBoundingRectangle = new BoundingRectangle();\n    var scratchPosition = new Cartesian3();\n    var scratchNormal = new Cartesian3();\n    var scratchTangent = new Cartesian3();\n    var scratchBitangent = new Cartesian3();\n    var p1Scratch = new Cartesian3();\n    var p2Scratch = new Cartesian3();\n    var scratchPerPosNormal = new Cartesian3();\n    var scratchPerPosTangent = new Cartesian3();\n    var scratchPerPosBitangent = new Cartesian3();\n\n    var appendTextureCoordinatesOrigin = new Cartesian2();\n    var appendTextureCoordinatesCartesian2 = new Cartesian2();\n    var appendTextureCoordinatesCartesian3 = new Cartesian3();\n    var appendTextureCoordinatesQuaternion = new Quaternion();\n    var appendTextureCoordinatesMatrix3 = new Matrix3();\n    var tangentMatrixScratch = new Matrix3();\n\n    function computeAttributes(options) {\n        var vertexFormat = options.vertexFormat;\n        var geometry = options.geometry;\n        var shadowVolume = options.shadowVolume;\n        var flatPositions = geometry.attributes.position.values;\n        var length = flatPositions.length;\n        var wall = options.wall;\n        var top = options.top || wall;\n        var bottom = options.bottom || wall;\n        if (vertexFormat.st || vertexFormat.normal || vertexFormat.tangent || vertexFormat.bitangent || shadowVolume) {\n            // PERFORMANCE_IDEA: Compute before subdivision, then just interpolate during subdivision.\n            // PERFORMANCE_IDEA: Compute with createGeometryFromPositions() for fast path when there's no holes.\n            var boundingRectangle = options.boundingRectangle;\n            var tangentPlane = options.tangentPlane;\n            var ellipsoid = options.ellipsoid;\n            var stRotation = options.stRotation;\n            var perPositionHeight = options.perPositionHeight;\n\n            var origin = appendTextureCoordinatesOrigin;\n            origin.x = boundingRectangle.x;\n            origin.y = boundingRectangle.y;\n\n            var textureCoordinates = vertexFormat.st ? new Float32Array(2 * (length / 3)) : undefined;\n            var normals;\n            if (vertexFormat.normal) {\n                if (perPositionHeight && top && !wall) {\n                    normals = geometry.attributes.normal.values;\n                } else {\n                    normals = new Float32Array(length);\n                }\n            }\n            var tangents = vertexFormat.tangent ? new Float32Array(length) : undefined;\n            var bitangents = vertexFormat.bitangent ? new Float32Array(length) : undefined;\n            var extrudeNormals = shadowVolume ? new Float32Array(length) : undefined;\n\n            var textureCoordIndex = 0;\n            var attrIndex = 0;\n\n            var normal = scratchNormal;\n            var tangent = scratchTangent;\n            var bitangent = scratchBitangent;\n            var recomputeNormal = true;\n\n            var textureMatrix = appendTextureCoordinatesMatrix3;\n            var tangentRotationMatrix = tangentMatrixScratch;\n            if (stRotation !== 0.0) {\n                var rotation = Quaternion.fromAxisAngle(tangentPlane._plane.normal, stRotation, appendTextureCoordinatesQuaternion);\n                textureMatrix = Matrix3.fromQuaternion(rotation, textureMatrix);\n\n                rotation = Quaternion.fromAxisAngle(tangentPlane._plane.normal, -stRotation, appendTextureCoordinatesQuaternion);\n                tangentRotationMatrix = Matrix3.fromQuaternion(rotation, tangentRotationMatrix);\n            } else {\n                textureMatrix = Matrix3.clone(Matrix3.IDENTITY, textureMatrix);\n                tangentRotationMatrix = Matrix3.clone(Matrix3.IDENTITY, tangentRotationMatrix);\n            }\n\n            var bottomOffset = 0;\n            var bottomOffset2 = 0;\n\n            if (top && bottom) {\n                bottomOffset = length / 2;\n                bottomOffset2 = length / 3;\n\n                length /= 2;\n            }\n\n            for ( var i = 0; i < length; i += 3) {\n                var position = Cartesian3.fromArray(flatPositions, i, appendTextureCoordinatesCartesian3);\n\n                if (vertexFormat.st) {\n                    var p = Matrix3.multiplyByVector(textureMatrix, position, scratchPosition);\n                    p = ellipsoid.scaleToGeodeticSurface(p,p);\n                    var st = tangentPlane.projectPointOntoPlane(p, appendTextureCoordinatesCartesian2);\n                    Cartesian2.subtract(st, origin, st);\n\n                    var stx = CesiumMath.clamp(st.x / boundingRectangle.width, 0, 1);\n                    var sty = CesiumMath.clamp(st.y / boundingRectangle.height, 0, 1);\n                    if (bottom) {\n                        textureCoordinates[textureCoordIndex + bottomOffset2] = stx;\n                        textureCoordinates[textureCoordIndex + 1 + bottomOffset2] = sty;\n                    }\n                    if (top) {\n                        textureCoordinates[textureCoordIndex] = stx;\n                        textureCoordinates[textureCoordIndex + 1] = sty;\n                    }\n\n                    textureCoordIndex += 2;\n                }\n\n                if (vertexFormat.normal || vertexFormat.tangent || vertexFormat.bitangent || shadowVolume) {\n                    var attrIndex1 = attrIndex + 1;\n                    var attrIndex2 = attrIndex + 2;\n\n                    if (wall) {\n                        if (i + 3 < length) {\n                            var p1 = Cartesian3.fromArray(flatPositions, i + 3, p1Scratch);\n\n                            if (recomputeNormal) {\n                                var p2 = Cartesian3.fromArray(flatPositions, i + length, p2Scratch);\n                                if (perPositionHeight) {\n                                    adjustPosHeightsForNormal(position, p1, p2, ellipsoid);\n                                }\n                                Cartesian3.subtract(p1, position, p1);\n                                Cartesian3.subtract(p2, position, p2);\n                                normal = Cartesian3.normalize(Cartesian3.cross(p2, p1, normal), normal);\n                                recomputeNormal = false;\n                            }\n\n                            if (Cartesian3.equalsEpsilon(p1, position, CesiumMath.EPSILON10)) { // if we've reached a corner\n                                recomputeNormal = true;\n                            }\n                        }\n\n                        if (vertexFormat.tangent || vertexFormat.bitangent) {\n                            bitangent = ellipsoid.geodeticSurfaceNormal(position, bitangent);\n                            if (vertexFormat.tangent) {\n                                tangent = Cartesian3.normalize(Cartesian3.cross(bitangent, normal, tangent), tangent);\n                            }\n                        }\n                    } else {\n                        normal = ellipsoid.geodeticSurfaceNormal(position, normal);\n                        if (vertexFormat.tangent || vertexFormat.bitangent) {\n                            if (perPositionHeight) {\n                                scratchPerPosNormal = Cartesian3.fromArray(normals, attrIndex, scratchPerPosNormal);\n                                scratchPerPosTangent = Cartesian3.cross(Cartesian3.UNIT_Z, scratchPerPosNormal, scratchPerPosTangent);\n                                scratchPerPosTangent = Cartesian3.normalize(Matrix3.multiplyByVector(tangentRotationMatrix, scratchPerPosTangent, scratchPerPosTangent), scratchPerPosTangent);\n                                if (vertexFormat.bitangent) {\n                                    scratchPerPosBitangent = Cartesian3.normalize(Cartesian3.cross(scratchPerPosNormal, scratchPerPosTangent, scratchPerPosBitangent), scratchPerPosBitangent);\n                                }\n                            }\n\n                            tangent = Cartesian3.cross(Cartesian3.UNIT_Z, normal, tangent);\n                            tangent = Cartesian3.normalize(Matrix3.multiplyByVector(tangentRotationMatrix, tangent, tangent), tangent);\n                            if (vertexFormat.bitangent) {\n                                bitangent = Cartesian3.normalize(Cartesian3.cross(normal, tangent, bitangent), bitangent);\n                            }\n                        }\n                    }\n\n                    if (vertexFormat.normal) {\n                        if (options.wall) {\n                            normals[attrIndex + bottomOffset] = normal.x;\n                            normals[attrIndex1 + bottomOffset] = normal.y;\n                            normals[attrIndex2 + bottomOffset] = normal.z;\n                        } else if (bottom){\n                            normals[attrIndex + bottomOffset] = -normal.x;\n                            normals[attrIndex1 + bottomOffset] = -normal.y;\n                            normals[attrIndex2 + bottomOffset] = -normal.z;\n                        }\n\n                        if ((top && !perPositionHeight) || wall) {\n                            normals[attrIndex] = normal.x;\n                            normals[attrIndex1] = normal.y;\n                            normals[attrIndex2] = normal.z;\n                        }\n                    }\n\n                    if (shadowVolume) {\n                        if (wall) {\n                            normal = ellipsoid.geodeticSurfaceNormal(position, normal);\n                        }\n                        extrudeNormals[attrIndex + bottomOffset] = -normal.x;\n                        extrudeNormals[attrIndex1 + bottomOffset] = -normal.y;\n                        extrudeNormals[attrIndex2 + bottomOffset] = -normal.z;\n                    }\n\n                    if (vertexFormat.tangent) {\n                        if (options.wall) {\n                            tangents[attrIndex + bottomOffset] = tangent.x;\n                            tangents[attrIndex1 + bottomOffset] = tangent.y;\n                            tangents[attrIndex2 + bottomOffset] = tangent.z;\n                        } else if (bottom) {\n                            tangents[attrIndex + bottomOffset] = -tangent.x;\n                            tangents[attrIndex1 + bottomOffset] = -tangent.y;\n                            tangents[attrIndex2 + bottomOffset] = -tangent.z;\n                        }\n\n                        if(top) {\n                            if (perPositionHeight) {\n                                tangents[attrIndex] = scratchPerPosTangent.x;\n                                tangents[attrIndex1] = scratchPerPosTangent.y;\n                                tangents[attrIndex2] = scratchPerPosTangent.z;\n                            } else {\n                                tangents[attrIndex] = tangent.x;\n                                tangents[attrIndex1] = tangent.y;\n                                tangents[attrIndex2] = tangent.z;\n                            }\n                        }\n                    }\n\n                    if (vertexFormat.bitangent) {\n                        if (bottom) {\n                            bitangents[attrIndex + bottomOffset] = bitangent.x;\n                            bitangents[attrIndex1 + bottomOffset] = bitangent.y;\n                            bitangents[attrIndex2 + bottomOffset] = bitangent.z;\n                        }\n                        if (top) {\n                            if (perPositionHeight) {\n                                bitangents[attrIndex] = scratchPerPosBitangent.x;\n                                bitangents[attrIndex1] = scratchPerPosBitangent.y;\n                                bitangents[attrIndex2] = scratchPerPosBitangent.z;\n                            } else {\n                                bitangents[attrIndex] = bitangent.x;\n                                bitangents[attrIndex1] = bitangent.y;\n                                bitangents[attrIndex2] = bitangent.z;\n                            }\n                        }\n                    }\n                    attrIndex += 3;\n                }\n            }\n\n            if (vertexFormat.st) {\n                geometry.attributes.st = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 2,\n                    values : textureCoordinates\n                });\n            }\n\n            if (vertexFormat.normal) {\n                geometry.attributes.normal = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 3,\n                    values : normals\n                });\n            }\n\n            if (vertexFormat.tangent) {\n                geometry.attributes.tangent = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 3,\n                    values : tangents\n                });\n            }\n\n            if (vertexFormat.bitangent) {\n                geometry.attributes.bitangent = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 3,\n                    values : bitangents\n                });\n            }\n\n            if (shadowVolume) {\n                geometry.attributes.extrudeDirection = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.FLOAT,\n                    componentsPerAttribute : 3,\n                    values : extrudeNormals\n                });\n            }\n        }\n\n        if (options.extrude && defined(options.offsetAttribute)) {\n            var size = flatPositions.length / 3;\n            var offsetAttribute = new Uint8Array(size);\n\n            if (options.offsetAttribute === GeometryOffsetAttribute.TOP) {\n                if ((top && bottom) || wall) {\n                    offsetAttribute = arrayFill(offsetAttribute, 1, 0, size / 2);\n                } else if (top) {\n                    offsetAttribute = arrayFill(offsetAttribute, 1);\n                }\n            } else {\n                var offsetValue = options.offsetAttribute === GeometryOffsetAttribute.NONE ? 0 : 1;\n                offsetAttribute = arrayFill(offsetAttribute, offsetValue);\n            }\n\n            geometry.attributes.applyOffset = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                componentsPerAttribute : 1,\n                values : offsetAttribute\n            });\n        }\n\n        return geometry;\n    }\n\n    var startCartographicScratch = new Cartographic();\n    var endCartographicScratch = new Cartographic();\n    var idlCross = {\n        westOverIDL : 0.0,\n        eastOverIDL : 0.0\n    };\n    var ellipsoidGeodesic = new EllipsoidGeodesic();\n    function computeRectangle(positions, ellipsoid, arcType, granularity, result) {\n        result = defaultValue(result, new Rectangle());\n        if (!defined(positions) || positions.length < 3) {\n            result.west = 0.0;\n            result.north = 0.0;\n            result.south = 0.0;\n            result.east = 0.0;\n            return result;\n        }\n\n        if (arcType === ArcType.RHUMB) {\n            return Rectangle.fromCartesianArray(positions, ellipsoid, result);\n        }\n\n        if (!ellipsoidGeodesic.ellipsoid.equals(ellipsoid)) {\n            ellipsoidGeodesic = new EllipsoidGeodesic(undefined, undefined, ellipsoid);\n        }\n\n        result.west = Number.POSITIVE_INFINITY;\n        result.east = Number.NEGATIVE_INFINITY;\n        result.south = Number.POSITIVE_INFINITY;\n        result.north = Number.NEGATIVE_INFINITY;\n\n        idlCross.westOverIDL = Number.POSITIVE_INFINITY;\n        idlCross.eastOverIDL = Number.NEGATIVE_INFINITY;\n\n        var inverseChordLength = 1.0 / CesiumMath.chordLength(granularity, ellipsoid.maximumRadius);\n        var positionsLength = positions.length;\n        var endCartographic = ellipsoid.cartesianToCartographic(positions[0], endCartographicScratch);\n        var startCartographic = startCartographicScratch;\n        var swap;\n\n        for (var i = 1; i < positionsLength; i++) {\n            swap = startCartographic;\n            startCartographic = endCartographic;\n            endCartographic = ellipsoid.cartesianToCartographic(positions[i], swap);\n            ellipsoidGeodesic.setEndPoints(startCartographic, endCartographic);\n            interpolateAndGrowRectangle(ellipsoidGeodesic, inverseChordLength, result, idlCross);\n        }\n\n        swap = startCartographic;\n        startCartographic = endCartographic;\n        endCartographic = ellipsoid.cartesianToCartographic(positions[0], swap);\n        ellipsoidGeodesic.setEndPoints(startCartographic, endCartographic);\n        interpolateAndGrowRectangle(ellipsoidGeodesic, inverseChordLength, result, idlCross);\n\n        if (result.east - result.west > idlCross.eastOverIDL - idlCross.westOverIDL) {\n            result.west = idlCross.westOverIDL;\n            result.east = idlCross.eastOverIDL;\n\n            if (result.east > CesiumMath.PI) {\n                result.east = result.east - CesiumMath.TWO_PI;\n            }\n            if (result.west > CesiumMath.PI) {\n                result.west = result.west - CesiumMath.TWO_PI;\n            }\n        }\n\n        return result;\n    }\n\n    var interpolatedCartographicScratch = new Cartographic();\n    function interpolateAndGrowRectangle(ellipsoidGeodesic, inverseChordLength, result, idlCross) {\n        var segmentLength = ellipsoidGeodesic.surfaceDistance;\n\n        var numPoints = Math.ceil(segmentLength * inverseChordLength);\n        var subsegmentDistance = numPoints > 0 ? segmentLength / (numPoints - 1) : Number.POSITIVE_INFINITY;\n        var interpolationDistance = 0.0;\n\n        for (var i = 0; i < numPoints; i++) {\n            var interpolatedCartographic = ellipsoidGeodesic.interpolateUsingSurfaceDistance(interpolationDistance, interpolatedCartographicScratch);\n            interpolationDistance += subsegmentDistance;\n            var longitude = interpolatedCartographic.longitude;\n            var latitude = interpolatedCartographic.latitude;\n\n            result.west = Math.min(result.west, longitude);\n            result.east = Math.max(result.east, longitude);\n            result.south = Math.min(result.south, latitude);\n            result.north = Math.max(result.north, latitude);\n\n            var lonAdjusted = longitude >= 0 ?  longitude : longitude +  CesiumMath.TWO_PI;\n            idlCross.westOverIDL = Math.min(idlCross.westOverIDL, lonAdjusted);\n            idlCross.eastOverIDL = Math.max(idlCross.eastOverIDL, lonAdjusted);\n        }\n    }\n\n    var createGeometryFromPositionsExtrudedPositions = [];\n\n    function createGeometryFromPositionsExtruded(ellipsoid, polygon, granularity, hierarchy, perPositionHeight, closeTop, closeBottom, vertexFormat, arcType) {\n        var geos = {\n            walls : []\n        };\n        var i;\n\n        if (closeTop || closeBottom) {\n            var topGeo = PolygonGeometryLibrary.createGeometryFromPositions(ellipsoid, polygon, granularity, perPositionHeight, vertexFormat, arcType);\n\n            var edgePoints = topGeo.attributes.position.values;\n            var indices = topGeo.indices;\n            var numPositions;\n            var newIndices;\n\n            if (closeTop && closeBottom) {\n                var topBottomPositions = edgePoints.concat(edgePoints);\n\n                numPositions = topBottomPositions.length / 3;\n\n                newIndices = IndexDatatype.createTypedArray(numPositions, indices.length * 2);\n                newIndices.set(indices);\n                var ilength = indices.length;\n\n                var length = numPositions / 2;\n\n                for (i = 0; i < ilength; i += 3) {\n                    var i0 = newIndices[i] + length;\n                    var i1 = newIndices[i + 1] + length;\n                    var i2 = newIndices[i + 2] + length;\n\n                    newIndices[i + ilength] = i2;\n                    newIndices[i + 1 + ilength] = i1;\n                    newIndices[i + 2 + ilength] = i0;\n                }\n\n                topGeo.attributes.position.values = topBottomPositions;\n                if (perPositionHeight && vertexFormat.normal) {\n                    var normals = topGeo.attributes.normal.values;\n                    topGeo.attributes.normal.values = new Float32Array(topBottomPositions.length);\n                    topGeo.attributes.normal.values.set(normals);\n                }\n                topGeo.indices = newIndices;\n            } else if (closeBottom) {\n                numPositions = edgePoints.length / 3;\n                newIndices = IndexDatatype.createTypedArray(numPositions, indices.length);\n\n                for (i = 0; i < indices.length; i += 3) {\n                    newIndices[i] = indices[i + 2];\n                    newIndices[i + 1] = indices[i + 1];\n                    newIndices[i + 2] = indices[i];\n                }\n\n                topGeo.indices = newIndices;\n            }\n\n            geos.topAndBottom = new GeometryInstance({\n                geometry : topGeo\n            });\n        }\n\n        var outerRing = hierarchy.outerRing;\n        var tangentPlane = EllipsoidTangentPlane.fromPoints(outerRing, ellipsoid);\n        var positions2D = tangentPlane.projectPointsOntoPlane(outerRing, createGeometryFromPositionsExtrudedPositions);\n\n        var windingOrder = PolygonPipeline.computeWindingOrder2D(positions2D);\n        if (windingOrder === WindingOrder.CLOCKWISE) {\n            outerRing = outerRing.slice().reverse();\n        }\n\n        var wallGeo = PolygonGeometryLibrary.computeWallGeometry(outerRing, ellipsoid, granularity, perPositionHeight, arcType);\n        geos.walls.push(new GeometryInstance({\n            geometry : wallGeo\n        }));\n\n        var holes = hierarchy.holes;\n        for (i = 0; i < holes.length; i++) {\n            var hole = holes[i];\n\n            tangentPlane = EllipsoidTangentPlane.fromPoints(hole, ellipsoid);\n            positions2D = tangentPlane.projectPointsOntoPlane(hole, createGeometryFromPositionsExtrudedPositions);\n\n            windingOrder = PolygonPipeline.computeWindingOrder2D(positions2D);\n            if (windingOrder === WindingOrder.COUNTER_CLOCKWISE) {\n                hole = hole.slice().reverse();\n            }\n\n            wallGeo = PolygonGeometryLibrary.computeWallGeometry(hole, ellipsoid, granularity, perPositionHeight, arcType);\n            geos.walls.push(new GeometryInstance({\n                geometry : wallGeo\n            }));\n        }\n\n        return geos;\n    }\n\n    /**\n     * A description of a polygon on the ellipsoid. The polygon is defined by a polygon hierarchy. Polygon geometry can be rendered with both {@link Primitive} and {@link GroundPrimitive}.\n     *\n     * @alias PolygonGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {PolygonHierarchy} options.polygonHierarchy A polygon hierarchy that can include holes.\n     * @param {Number} [options.height=0.0] The distance in meters between the polygon and the ellipsoid surface.\n     * @param {Number} [options.extrudedHeight] The distance in meters between the polygon's extruded face and the ellipsoid surface.\n     * @param {VertexFormat} [options.vertexFormat=VertexFormat.DEFAULT] The vertex attributes to be computed.\n     * @param {Number} [options.stRotation=0.0] The rotation of the texture coordinates, in radians. A positive rotation is counter-clockwise.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid to be used as a reference.\n     * @param {Number} [options.granularity=CesiumMath.RADIANS_PER_DEGREE] The distance, in radians, between each latitude and longitude. Determines the number of positions in the buffer.\n     * @param {Boolean} [options.perPositionHeight=false] Use the height of options.positions for each position instead of using options.height to determine the height.\n     * @param {Boolean} [options.closeTop=true] When false, leaves off the top of an extruded polygon open.\n     * @param {Boolean} [options.closeBottom=true] When false, leaves off the bottom of an extruded polygon open.\n     * @param {ArcType} [options.arcType=ArcType.GEODESIC] The type of line the polygon edges must follow. Valid options are {@link ArcType.GEODESIC} and {@link ArcType.RHUMB}.\n     *\n     * @see PolygonGeometry#createGeometry\n     * @see PolygonGeometry#fromPositions\n     *\n     * @demo {@link https://sandcastle.cesium.com/index.html?src=Polygon.html|Cesium Sandcastle Polygon Demo}\n     *\n     * @example\n     * // 1. create a polygon from points\n     * var polygon = new Cesium.PolygonGeometry({\n     *   polygonHierarchy : new Cesium.PolygonHierarchy(\n     *     Cesium.Cartesian3.fromDegreesArray([\n     *       -72.0, 40.0,\n     *       -70.0, 35.0,\n     *       -75.0, 30.0,\n     *       -70.0, 30.0,\n     *       -68.0, 40.0\n     *     ])\n     *   )\n     * });\n     * var geometry = Cesium.PolygonGeometry.createGeometry(polygon);\n     *\n     * // 2. create a nested polygon with holes\n     * var polygonWithHole = new Cesium.PolygonGeometry({\n     *   polygonHierarchy : new Cesium.PolygonHierarchy(\n     *     Cesium.Cartesian3.fromDegreesArray([\n     *       -109.0, 30.0,\n     *       -95.0, 30.0,\n     *       -95.0, 40.0,\n     *       -109.0, 40.0\n     *     ]),\n     *     [new Cesium.PolygonHierarchy(\n     *       Cesium.Cartesian3.fromDegreesArray([\n     *         -107.0, 31.0,\n     *         -107.0, 39.0,\n     *         -97.0, 39.0,\n     *         -97.0, 31.0\n     *       ]),\n     *       [new Cesium.PolygonHierarchy(\n     *         Cesium.Cartesian3.fromDegreesArray([\n     *           -105.0, 33.0,\n     *           -99.0, 33.0,\n     *           -99.0, 37.0,\n     *           -105.0, 37.0\n     *         ]),\n     *         [new Cesium.PolygonHierarchy(\n     *           Cesium.Cartesian3.fromDegreesArray([\n     *             -103.0, 34.0,\n     *             -101.0, 34.0,\n     *             -101.0, 36.0,\n     *             -103.0, 36.0\n     *           ])\n     *         )]\n     *       )]\n     *     )]\n     *   )\n     * });\n     * var geometry = Cesium.PolygonGeometry.createGeometry(polygonWithHole);\n     *\n     * // 3. create extruded polygon\n     * var extrudedPolygon = new Cesium.PolygonGeometry({\n     *   polygonHierarchy : new Cesium.PolygonHierarchy(\n     *     Cesium.Cartesian3.fromDegreesArray([\n     *       -72.0, 40.0,\n     *       -70.0, 35.0,\n     *       -75.0, 30.0,\n     *       -70.0, 30.0,\n     *       -68.0, 40.0\n     *     ])\n     *   ),\n     *   extrudedHeight: 300000\n     * });\n     * var geometry = Cesium.PolygonGeometry.createGeometry(extrudedPolygon);\n     */\n    function PolygonGeometry(options) {\n        \n\n        var polygonHierarchy = options.polygonHierarchy;\n        var vertexFormat = defaultValue(options.vertexFormat, VertexFormat.DEFAULT);\n        var ellipsoid = defaultValue(options.ellipsoid, Ellipsoid.WGS84);\n        var granularity = defaultValue(options.granularity, CesiumMath.RADIANS_PER_DEGREE);\n        var stRotation = defaultValue(options.stRotation, 0.0);\n        var perPositionHeight = defaultValue(options.perPositionHeight, false);\n        var perPositionHeightExtrude = perPositionHeight && defined(options.extrudedHeight);\n        var height = defaultValue(options.height, 0.0);\n        var extrudedHeight = defaultValue(options.extrudedHeight, height);\n\n        if (!perPositionHeightExtrude) {\n            var h = Math.max(height, extrudedHeight);\n            extrudedHeight = Math.min(height, extrudedHeight);\n            height = h;\n        }\n\n        this._vertexFormat = VertexFormat.clone(vertexFormat);\n        this._ellipsoid = Ellipsoid.clone(ellipsoid);\n        this._granularity = granularity;\n        this._stRotation = stRotation;\n        this._height = height;\n        this._extrudedHeight = extrudedHeight;\n        this._closeTop = defaultValue(options.closeTop, true);\n        this._closeBottom = defaultValue(options.closeBottom, true);\n        this._polygonHierarchy = polygonHierarchy;\n        this._perPositionHeight = perPositionHeight;\n        this._perPositionHeightExtrude = perPositionHeightExtrude;\n        this._shadowVolume = defaultValue(options.shadowVolume, false);\n        this._workerName = 'createPolygonGeometry';\n        this._offsetAttribute = options.offsetAttribute;\n        this._arcType = defaultValue(options.arcType, ArcType.GEODESIC);\n\n        this._rectangle = undefined;\n        this._textureCoordinateRotationPoints = undefined;\n\n        /**\n         * The number of elements used to pack the object into an array.\n         * @type {Number}\n         */\n        this.packedLength = PolygonGeometryLibrary.computeHierarchyPackedLength(polygonHierarchy) + Ellipsoid.packedLength + VertexFormat.packedLength + 12;\n    }\n\n    /**\n     * A description of a polygon from an array of positions. Polygon geometry can be rendered with both {@link Primitive} and {@link GroundPrimitive}.\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3[]} options.positions An array of positions that defined the corner points of the polygon.\n     * @param {Number} [options.height=0.0] The height of the polygon.\n     * @param {Number} [options.extrudedHeight] The height of the polygon extrusion.\n     * @param {VertexFormat} [options.vertexFormat=VertexFormat.DEFAULT] The vertex attributes to be computed.\n     * @param {Number} [options.stRotation=0.0] The rotation of the texture coordinates, in radians. A positive rotation is counter-clockwise.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid to be used as a reference.\n     * @param {Number} [options.granularity=CesiumMath.RADIANS_PER_DEGREE] The distance, in radians, between each latitude and longitude. Determines the number of positions in the buffer.\n     * @param {Boolean} [options.perPositionHeight=false] Use the height of options.positions for each position instead of using options.height to determine the height.\n     * @param {Boolean} [options.closeTop=true] When false, leaves off the top of an extruded polygon open.\n     * @param {Boolean} [options.closeBottom=true] When false, leaves off the bottom of an extruded polygon open.\n     * @param {ArcType} [options.arcType=ArcType.GEODESIC] The type of line the polygon edges must follow. Valid options are {@link ArcType.GEODESIC} and {@link ArcType.RHUMB}.\n     * @returns {PolygonGeometry}\n     *\n     *\n     * @example\n     * // create a polygon from points\n     * var polygon = Cesium.PolygonGeometry.fromPositions({\n     *   positions : Cesium.Cartesian3.fromDegreesArray([\n     *     -72.0, 40.0,\n     *     -70.0, 35.0,\n     *     -75.0, 30.0,\n     *     -70.0, 30.0,\n     *     -68.0, 40.0\n     *   ])\n     * });\n     * var geometry = Cesium.PolygonGeometry.createGeometry(polygon);\n     *\n     * @see PolygonGeometry#createGeometry\n     */\n    PolygonGeometry.fromPositions = function(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        \n\n        var newOptions = {\n            polygonHierarchy : {\n                positions : options.positions\n            },\n            height : options.height,\n            extrudedHeight : options.extrudedHeight,\n            vertexFormat : options.vertexFormat,\n            stRotation : options.stRotation,\n            ellipsoid : options.ellipsoid,\n            granularity : options.granularity,\n            perPositionHeight : options.perPositionHeight,\n            closeTop : options.closeTop,\n            closeBottom : options.closeBottom,\n            offsetAttribute : options.offsetAttribute,\n            arcType : options.arcType\n        };\n        return new PolygonGeometry(newOptions);\n    };\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {PolygonGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    PolygonGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        startingIndex = PolygonGeometryLibrary.packPolygonHierarchy(value._polygonHierarchy, array, startingIndex);\n\n        Ellipsoid.pack(value._ellipsoid, array, startingIndex);\n        startingIndex += Ellipsoid.packedLength;\n\n        VertexFormat.pack(value._vertexFormat, array, startingIndex);\n        startingIndex += VertexFormat.packedLength;\n\n        array[startingIndex++] = value._height;\n        array[startingIndex++] = value._extrudedHeight;\n        array[startingIndex++] = value._granularity;\n        array[startingIndex++] = value._stRotation;\n        array[startingIndex++] = value._perPositionHeightExtrude ? 1.0 : 0.0;\n        array[startingIndex++] = value._perPositionHeight ? 1.0 : 0.0;\n        array[startingIndex++] = value._closeTop ? 1.0 : 0.0;\n        array[startingIndex++] = value._closeBottom ? 1.0 : 0.0;\n        array[startingIndex++] = value._shadowVolume ? 1.0 : 0.0;\n        array[startingIndex++] = defaultValue(value._offsetAttribute, -1);\n        array[startingIndex++] = value._arcType;\n        array[startingIndex] = value.packedLength;\n\n        return array;\n    };\n\n    var scratchEllipsoid = Ellipsoid.clone(Ellipsoid.UNIT_SPHERE);\n    var scratchVertexFormat = new VertexFormat();\n\n    //Only used to avoid inability to default construct.\n    var dummyOptions = {\n        polygonHierarchy : {}\n    };\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {PolygonGeometry} [result] The object into which to store the result.\n     */\n    PolygonGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var polygonHierarchy = PolygonGeometryLibrary.unpackPolygonHierarchy(array, startingIndex);\n        startingIndex = polygonHierarchy.startingIndex;\n        delete polygonHierarchy.startingIndex;\n\n        var ellipsoid = Ellipsoid.unpack(array, startingIndex, scratchEllipsoid);\n        startingIndex += Ellipsoid.packedLength;\n\n        var vertexFormat = VertexFormat.unpack(array, startingIndex, scratchVertexFormat);\n        startingIndex += VertexFormat.packedLength;\n\n        var height = array[startingIndex++];\n        var extrudedHeight = array[startingIndex++];\n        var granularity = array[startingIndex++];\n        var stRotation = array[startingIndex++];\n        var perPositionHeightExtrude = array[startingIndex++] === 1.0;\n        var perPositionHeight = array[startingIndex++] === 1.0;\n        var closeTop = array[startingIndex++] === 1.0;\n        var closeBottom = array[startingIndex++] === 1.0;\n        var shadowVolume = array[startingIndex++] === 1.0;\n        var offsetAttribute = array[startingIndex++];\n        var arcType = array[startingIndex++];\n        var packedLength = array[startingIndex];\n\n        if (!defined(result)) {\n            result = new PolygonGeometry(dummyOptions);\n        }\n\n        result._polygonHierarchy = polygonHierarchy;\n        result._ellipsoid = Ellipsoid.clone(ellipsoid, result._ellipsoid);\n        result._vertexFormat = VertexFormat.clone(vertexFormat, result._vertexFormat);\n        result._height = height;\n        result._extrudedHeight = extrudedHeight;\n        result._granularity = granularity;\n        result._stRotation = stRotation;\n        result._perPositionHeightExtrude = perPositionHeightExtrude;\n        result._perPositionHeight = perPositionHeight;\n        result._closeTop = closeTop;\n        result._closeBottom = closeBottom;\n        result._shadowVolume = shadowVolume;\n        result._offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n        result._arcType = arcType;\n        result.packedLength = packedLength;\n        return result;\n    };\n\n    /**\n     * Returns the bounding rectangle given the provided options\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {PolygonHierarchy} options.polygonHierarchy A polygon hierarchy that can include holes.\n     * @param {Number} [options.granularity=CesiumMath.RADIANS_PER_DEGREE] The distance, in radians, between each latitude and longitude. Determines the number of positions sampled.\n     * @param {ArcType} [options.arcType=ArcType.GEODESIC] The type of line the polygon edges must follow. Valid options are {@link ArcType.GEODESIC} and {@link ArcType.RHUMB}.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid to be used as a reference.\n     * @param {Rectangle} [result] An object in which to store the result.\n     *\n     * @returns {Rectangle} The result rectangle\n     */\n    PolygonGeometry.computeRectangle = function(options, result) {\n        \n\n        var granularity = defaultValue(options.granularity, CesiumMath.RADIANS_PER_DEGREE);\n        var arcType = defaultValue(options.arcType, ArcType.GEODESIC);\n        \n\n        var polygonHierarchy = options.polygonHierarchy;\n        var ellipsoid = defaultValue(options.ellipsoid, Ellipsoid.WGS84);\n\n        return computeRectangle(polygonHierarchy.positions, ellipsoid, arcType, granularity, result);\n    };\n\n    /**\n     * Computes the geometric representation of a polygon, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {PolygonGeometry} polygonGeometry A description of the polygon.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    PolygonGeometry.createGeometry = function(polygonGeometry) {\n        var vertexFormat = polygonGeometry._vertexFormat;\n        var ellipsoid = polygonGeometry._ellipsoid;\n        var granularity = polygonGeometry._granularity;\n        var stRotation = polygonGeometry._stRotation;\n        var polygonHierarchy = polygonGeometry._polygonHierarchy;\n        var perPositionHeight = polygonGeometry._perPositionHeight;\n        var closeTop = polygonGeometry._closeTop;\n        var closeBottom = polygonGeometry._closeBottom;\n        var arcType = polygonGeometry._arcType;\n\n        var outerPositions = polygonHierarchy.positions;\n        if (outerPositions.length < 3) {\n            return;\n        }\n\n        var tangentPlane = EllipsoidTangentPlane.fromPoints(outerPositions, ellipsoid);\n\n        var results = PolygonGeometryLibrary.polygonsFromHierarchy(polygonHierarchy, tangentPlane.projectPointsOntoPlane.bind(tangentPlane), !perPositionHeight, ellipsoid);\n\n        var hierarchy = results.hierarchy;\n        var polygons = results.polygons;\n\n        if (hierarchy.length === 0) {\n            return;\n        }\n\n        outerPositions = hierarchy[0].outerRing;\n        var boundingRectangle = PolygonGeometryLibrary.computeBoundingRectangle(tangentPlane.plane.normal, tangentPlane.projectPointOntoPlane.bind(tangentPlane), outerPositions, stRotation, scratchBoundingRectangle);\n\n        var geometries = [];\n\n        var height = polygonGeometry._height;\n        var extrudedHeight = polygonGeometry._extrudedHeight;\n        var extrude = polygonGeometry._perPositionHeightExtrude || !CesiumMath.equalsEpsilon(height, extrudedHeight, 0, CesiumMath.EPSILON2);\n\n        var options = {\n            perPositionHeight: perPositionHeight,\n            vertexFormat: vertexFormat,\n            geometry: undefined,\n            tangentPlane: tangentPlane,\n            boundingRectangle: boundingRectangle,\n            ellipsoid: ellipsoid,\n            stRotation: stRotation,\n            bottom: false,\n            top: true,\n            wall: false,\n            extrude: false,\n            arcType: arcType\n        };\n\n        var i;\n\n        if (extrude) {\n            options.extrude = true;\n            options.top = closeTop;\n            options.bottom = closeBottom;\n            options.shadowVolume = polygonGeometry._shadowVolume;\n            options.offsetAttribute = polygonGeometry._offsetAttribute;\n            for (i = 0; i < polygons.length; i++) {\n                var splitGeometry = createGeometryFromPositionsExtruded(ellipsoid, polygons[i], granularity, hierarchy[i], perPositionHeight, closeTop, closeBottom, vertexFormat, arcType);\n\n                var topAndBottom;\n                if (closeTop && closeBottom) {\n                    topAndBottom = splitGeometry.topAndBottom;\n                    options.geometry = PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(topAndBottom.geometry, height, extrudedHeight, ellipsoid, perPositionHeight);\n                } else if (closeTop) {\n                    topAndBottom = splitGeometry.topAndBottom;\n                    topAndBottom.geometry.attributes.position.values = PolygonPipeline.scaleToGeodeticHeight(topAndBottom.geometry.attributes.position.values, height, ellipsoid, !perPositionHeight);\n                    options.geometry = topAndBottom.geometry;\n                } else if (closeBottom) {\n                    topAndBottom = splitGeometry.topAndBottom;\n                    topAndBottom.geometry.attributes.position.values = PolygonPipeline.scaleToGeodeticHeight(topAndBottom.geometry.attributes.position.values, extrudedHeight, ellipsoid, true);\n                    options.geometry = topAndBottom.geometry;\n                }\n                if (closeTop || closeBottom) {\n                    options.wall = false;\n                    topAndBottom.geometry = computeAttributes(options);\n                    geometries.push(topAndBottom);\n                }\n\n                var walls = splitGeometry.walls;\n                options.wall = true;\n                for ( var k = 0; k < walls.length; k++) {\n                    var wall = walls[k];\n                    options.geometry = PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(wall.geometry, height, extrudedHeight, ellipsoid, perPositionHeight);\n                    wall.geometry = computeAttributes(options);\n                    geometries.push(wall);\n                }\n            }\n        } else {\n            for (i = 0; i < polygons.length; i++) {\n                var geometryInstance = new GeometryInstance({\n                    geometry : PolygonGeometryLibrary.createGeometryFromPositions(ellipsoid, polygons[i], granularity, perPositionHeight, vertexFormat, arcType)\n                });\n                geometryInstance.geometry.attributes.position.values = PolygonPipeline.scaleToGeodeticHeight(geometryInstance.geometry.attributes.position.values, height, ellipsoid, !perPositionHeight);\n                options.geometry = geometryInstance.geometry;\n                geometryInstance.geometry = computeAttributes(options);\n\n                if (defined(polygonGeometry._offsetAttribute)) {\n                    var length = geometryInstance.geometry.attributes.position.values.length;\n                    var applyOffset = new Uint8Array(length / 3);\n                    var offsetValue = polygonGeometry._offsetAttribute === GeometryOffsetAttribute.NONE ? 0 : 1;\n                    arrayFill(applyOffset, offsetValue);\n                    geometryInstance.geometry.attributes.applyOffset = new GeometryAttribute({\n                        componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                        componentsPerAttribute : 1,\n                        values: applyOffset\n                    });\n                }\n\n                geometries.push(geometryInstance);\n            }\n        }\n\n        var geometry = GeometryPipeline.combineInstances(geometries)[0];\n        geometry.attributes.position.values = new Float64Array(geometry.attributes.position.values);\n        geometry.indices = IndexDatatype.createTypedArray(geometry.attributes.position.values.length / 3, geometry.indices);\n\n        var attributes = geometry.attributes;\n        var boundingSphere = BoundingSphere.fromVertices(attributes.position.values);\n\n        if (!vertexFormat.position) {\n            delete attributes.position;\n        }\n\n        return new Geometry({\n            attributes : attributes,\n            indices : geometry.indices,\n            primitiveType : geometry.primitiveType,\n            boundingSphere : boundingSphere,\n            offsetAttribute : polygonGeometry._offsetAttribute\n        });\n    };\n\n    /**\n     * @private\n     */\n    PolygonGeometry.createShadowVolume = function(polygonGeometry, minHeightFunc, maxHeightFunc) {\n        var granularity = polygonGeometry._granularity;\n        var ellipsoid = polygonGeometry._ellipsoid;\n\n        var minHeight = minHeightFunc(granularity, ellipsoid);\n        var maxHeight = maxHeightFunc(granularity, ellipsoid);\n\n        return new PolygonGeometry({\n            polygonHierarchy : polygonGeometry._polygonHierarchy,\n            ellipsoid : ellipsoid,\n            stRotation : polygonGeometry._stRotation,\n            granularity : granularity,\n            perPositionHeight : false,\n            extrudedHeight : minHeight,\n            height : maxHeight,\n            vertexFormat : VertexFormat.POSITION_ONLY,\n            shadowVolume: true,\n            arcType : polygonGeometry._arcType\n        });\n    };\n\n    function textureCoordinateRotationPoints(polygonGeometry) {\n        var stRotation = -polygonGeometry._stRotation;\n        if (stRotation === 0.0) {\n            return [0, 0, 0, 1, 1, 0];\n        }\n        var ellipsoid = polygonGeometry._ellipsoid;\n        var positions = polygonGeometry._polygonHierarchy.positions;\n        var boundingRectangle = polygonGeometry.rectangle;\n        return Geometry._textureCoordinateRotationPoints(positions, stRotation, ellipsoid, boundingRectangle);\n    }\n\n    Object.defineProperties(PolygonGeometry.prototype, {\n        /**\n         * @private\n         */\n        rectangle : {\n            get : function() {\n                if (!defined(this._rectangle)) {\n                    var positions = this._polygonHierarchy.positions;\n                    this._rectangle = computeRectangle(positions, this._ellipsoid, this._arcType, this._granularity);\n                }\n\n                return this._rectangle;\n            }\n        },\n        /**\n         * For remapping texture coordinates when rendering PolygonGeometries as GroundPrimitives.\n         * @private\n         */\n        textureCoordinateRotationPoints : {\n            get : function() {\n                if (!defined(this._textureCoordinateRotationPoints)) {\n                    this._textureCoordinateRotationPoints = textureCoordinateRotationPoints(this);\n                }\n                return this._textureCoordinateRotationPoints;\n            }\n        }\n    });\nexport default PolygonGeometry;\n","import ArcType from './ArcType.js';\nimport arrayFill from './arrayFill.js';\nimport BoundingSphere from './BoundingSphere.js';\nimport Check from './Check.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport DeveloperError from './DeveloperError.js';\nimport Ellipsoid from './Ellipsoid.js';\nimport EllipsoidTangentPlane from './EllipsoidTangentPlane.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport GeometryInstance from './GeometryInstance.js';\nimport GeometryOffsetAttribute from './GeometryOffsetAttribute.js';\nimport GeometryPipeline from './GeometryPipeline.js';\nimport IndexDatatype from './IndexDatatype.js';\nimport CesiumMath from './Math.js';\nimport PolygonGeometryLibrary from './PolygonGeometryLibrary.js';\nimport PolygonPipeline from './PolygonPipeline.js';\nimport PrimitiveType from './PrimitiveType.js';\nimport WindingOrder from './WindingOrder.js';\n    var createGeometryFromPositionsPositions = [];\n    var createGeometryFromPositionsSubdivided = [];\n\n    function createGeometryFromPositions(ellipsoid, positions, minDistance, perPositionHeight, arcType) {\n        var tangentPlane = EllipsoidTangentPlane.fromPoints(positions, ellipsoid);\n        var positions2D = tangentPlane.projectPointsOntoPlane(positions, createGeometryFromPositionsPositions);\n\n        var originalWindingOrder = PolygonPipeline.computeWindingOrder2D(positions2D);\n        if (originalWindingOrder === WindingOrder.CLOCKWISE) {\n            positions2D.reverse();\n            positions = positions.slice().reverse();\n        }\n\n        var subdividedPositions;\n        var i;\n\n        var length = positions.length;\n        var index = 0;\n\n        if (!perPositionHeight) {\n            var numVertices = 0;\n            if (arcType === ArcType.GEODESIC) {\n                for (i = 0; i < length; i++) {\n                    numVertices += PolygonGeometryLibrary.subdivideLineCount(positions[i], positions[(i + 1) % length], minDistance);\n                }\n            } else if (arcType === ArcType.RHUMB) {\n                for (i = 0; i < length; i++) {\n                    numVertices += PolygonGeometryLibrary.subdivideRhumbLineCount(ellipsoid, positions[i], positions[(i + 1) % length], minDistance);\n                }\n            }\n            subdividedPositions = new Float64Array(numVertices * 3);\n            for (i = 0; i < length; i++) {\n                var tempPositions;\n                if (arcType === ArcType.GEODESIC) {\n                    tempPositions = PolygonGeometryLibrary.subdivideLine(positions[i], positions[(i + 1) % length], minDistance, createGeometryFromPositionsSubdivided);\n                } else if (arcType === ArcType.RHUMB) {\n                    tempPositions = PolygonGeometryLibrary.subdivideRhumbLine(ellipsoid, positions[i], positions[(i + 1) % length], minDistance, createGeometryFromPositionsSubdivided);\n                }\n                var tempPositionsLength = tempPositions.length;\n                for (var j = 0; j < tempPositionsLength; ++j) {\n                    subdividedPositions[index++] = tempPositions[j];\n                }\n            }\n        } else {\n            subdividedPositions = new Float64Array(length * 2 * 3);\n            for (i = 0; i < length; i++) {\n                var p0 = positions[i];\n                var p1 = positions[(i + 1) % length];\n                subdividedPositions[index++] = p0.x;\n                subdividedPositions[index++] = p0.y;\n                subdividedPositions[index++] = p0.z;\n                subdividedPositions[index++] = p1.x;\n                subdividedPositions[index++] = p1.y;\n                subdividedPositions[index++] = p1.z;\n            }\n        }\n\n        length = subdividedPositions.length / 3;\n        var indicesSize = length * 2;\n        var indices = IndexDatatype.createTypedArray(length, indicesSize);\n        index = 0;\n        for (i = 0; i < length - 1; i++) {\n            indices[index++] = i;\n            indices[index++] = i + 1;\n        }\n        indices[index++] = length - 1;\n        indices[index++] = 0;\n\n        return new GeometryInstance({\n            geometry : new Geometry({\n                attributes : new GeometryAttributes({\n                    position : new GeometryAttribute({\n                        componentDatatype : ComponentDatatype.DOUBLE,\n                        componentsPerAttribute : 3,\n                        values : subdividedPositions\n                    })\n                }),\n                indices : indices,\n                primitiveType : PrimitiveType.LINES\n            })\n        });\n    }\n\n    function createGeometryFromPositionsExtruded(ellipsoid, positions, minDistance, perPositionHeight, arcType) {\n        var tangentPlane = EllipsoidTangentPlane.fromPoints(positions, ellipsoid);\n        var positions2D = tangentPlane.projectPointsOntoPlane(positions, createGeometryFromPositionsPositions);\n\n        var originalWindingOrder = PolygonPipeline.computeWindingOrder2D(positions2D);\n        if (originalWindingOrder === WindingOrder.CLOCKWISE) {\n            positions2D.reverse();\n            positions = positions.slice().reverse();\n        }\n\n        var subdividedPositions;\n        var i;\n\n        var length = positions.length;\n        var corners = new Array(length);\n        var index = 0;\n\n        if (!perPositionHeight) {\n            var numVertices = 0;\n            if (arcType === ArcType.GEODESIC) {\n                for (i = 0; i < length; i++) {\n                    numVertices += PolygonGeometryLibrary.subdivideLineCount(positions[i], positions[(i + 1) % length], minDistance);\n                }\n            } else if (arcType === ArcType.RHUMB) {\n                for (i = 0; i < length; i++) {\n                    numVertices += PolygonGeometryLibrary.subdivideRhumbLineCount(ellipsoid, positions[i], positions[(i + 1) % length], minDistance);\n                }\n            }\n\n            subdividedPositions = new Float64Array(numVertices * 3 * 2);\n            for (i = 0; i < length; ++i) {\n                corners[i] = index / 3;\n                var tempPositions;\n                if (arcType === ArcType.GEODESIC) {\n                    tempPositions = PolygonGeometryLibrary.subdivideLine(positions[i], positions[(i + 1) % length], minDistance, createGeometryFromPositionsSubdivided);\n                } else if (arcType === ArcType.RHUMB) {\n                    tempPositions = PolygonGeometryLibrary.subdivideRhumbLine(ellipsoid, positions[i], positions[(i + 1) % length], minDistance, createGeometryFromPositionsSubdivided);\n                }\n                var tempPositionsLength = tempPositions.length;\n                for (var j = 0; j < tempPositionsLength; ++j) {\n                    subdividedPositions[index++] = tempPositions[j];\n                }\n            }\n        } else {\n            subdividedPositions = new Float64Array(length * 2 * 3 * 2);\n            for (i = 0; i < length; ++i) {\n                corners[i] = index / 3;\n                var p0 = positions[i];\n                var p1 = positions[(i + 1) % length];\n\n                subdividedPositions[index++] = p0.x;\n                subdividedPositions[index++] = p0.y;\n                subdividedPositions[index++] = p0.z;\n                subdividedPositions[index++] = p1.x;\n                subdividedPositions[index++] = p1.y;\n                subdividedPositions[index++] = p1.z;\n            }\n        }\n\n        length = subdividedPositions.length / (3 * 2);\n        var cornersLength = corners.length;\n\n        var indicesSize = ((length * 2) + cornersLength) * 2;\n        var indices = IndexDatatype.createTypedArray(length + cornersLength, indicesSize);\n\n        index = 0;\n        for (i = 0; i < length; ++i) {\n            indices[index++] = i;\n            indices[index++] = (i + 1) % length;\n            indices[index++] = i + length;\n            indices[index++] = ((i + 1) % length) + length;\n        }\n\n        for (i = 0; i < cornersLength; i++) {\n            var corner = corners[i];\n            indices[index++] = corner;\n            indices[index++] = corner + length;\n        }\n\n        return new GeometryInstance({\n            geometry : new Geometry({\n                attributes : new GeometryAttributes({\n                    position : new GeometryAttribute({\n                        componentDatatype : ComponentDatatype.DOUBLE,\n                        componentsPerAttribute : 3,\n                        values : subdividedPositions\n                    })\n                }),\n                indices : indices,\n                primitiveType : PrimitiveType.LINES\n            })\n        });\n    }\n\n    /**\n     * A description of the outline of a polygon on the ellipsoid. The polygon is defined by a polygon hierarchy.\n     *\n     * @alias PolygonOutlineGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {PolygonHierarchy} options.polygonHierarchy A polygon hierarchy that can include holes.\n     * @param {Number} [options.height=0.0] The distance in meters between the polygon and the ellipsoid surface.\n     * @param {Number} [options.extrudedHeight] The distance in meters between the polygon's extruded face and the ellipsoid surface.\n     * @param {VertexFormat} [options.vertexFormat=VertexFormat.DEFAULT] The vertex attributes to be computed.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid to be used as a reference.\n     * @param {Number} [options.granularity=CesiumMath.RADIANS_PER_DEGREE] The distance, in radians, between each latitude and longitude. Determines the number of positions in the buffer.\n     * @param {Boolean} [options.perPositionHeight=false] Use the height of options.positions for each position instead of using options.height to determine the height.\n     * @param {ArcType} [options.arcType=ArcType.GEODESIC] The type of path the outline must follow. Valid options are {@link ArcType.GEODESIC} and {@link ArcType.RHUMB}.\n     *\n     * @see PolygonOutlineGeometry#createGeometry\n     * @see PolygonOutlineGeometry#fromPositions\n     *\n     * @example\n     * // 1. create a polygon outline from points\n     * var polygon = new Cesium.PolygonOutlineGeometry({\n     *   polygonHierarchy : new Cesium.PolygonHierarchy(\n     *     Cesium.Cartesian3.fromDegreesArray([\n     *       -72.0, 40.0,\n     *       -70.0, 35.0,\n     *       -75.0, 30.0,\n     *       -70.0, 30.0,\n     *       -68.0, 40.0\n     *     ])\n     *   )\n     * });\n     * var geometry = Cesium.PolygonOutlineGeometry.createGeometry(polygon);\n     *\n     * // 2. create a nested polygon with holes outline\n     * var polygonWithHole = new Cesium.PolygonOutlineGeometry({\n     *   polygonHierarchy : new Cesium.PolygonHierarchy(\n     *     Cesium.Cartesian3.fromDegreesArray([\n     *       -109.0, 30.0,\n     *       -95.0, 30.0,\n     *       -95.0, 40.0,\n     *       -109.0, 40.0\n     *     ]),\n     *     [new Cesium.PolygonHierarchy(\n     *       Cesium.Cartesian3.fromDegreesArray([\n     *         -107.0, 31.0,\n     *         -107.0, 39.0,\n     *         -97.0, 39.0,\n     *         -97.0, 31.0\n     *       ]),\n     *       [new Cesium.PolygonHierarchy(\n     *         Cesium.Cartesian3.fromDegreesArray([\n     *           -105.0, 33.0,\n     *           -99.0, 33.0,\n     *           -99.0, 37.0,\n     *           -105.0, 37.0\n     *         ]),\n     *         [new Cesium.PolygonHierarchy(\n     *           Cesium.Cartesian3.fromDegreesArray([\n     *             -103.0, 34.0,\n     *             -101.0, 34.0,\n     *             -101.0, 36.0,\n     *             -103.0, 36.0\n     *           ])\n     *         )]\n     *       )]\n     *     )]\n     *   )\n     * });\n     * var geometry = Cesium.PolygonOutlineGeometry.createGeometry(polygonWithHole);\n     *\n     * // 3. create extruded polygon outline\n     * var extrudedPolygon = new Cesium.PolygonOutlineGeometry({\n     *   polygonHierarchy : new Cesium.PolygonHierarchy(\n     *     Cesium.Cartesian3.fromDegreesArray([\n     *       -72.0, 40.0,\n     *       -70.0, 35.0,\n     *       -75.0, 30.0,\n     *       -70.0, 30.0,\n     *       -68.0, 40.0\n     *     ])\n     *   ),\n     *   extrudedHeight: 300000\n     * });\n     * var geometry = Cesium.PolygonOutlineGeometry.createGeometry(extrudedPolygon);\n     */\n    function PolygonOutlineGeometry(options) {\n        \n\n        var polygonHierarchy = options.polygonHierarchy;\n        var ellipsoid = defaultValue(options.ellipsoid, Ellipsoid.WGS84);\n        var granularity = defaultValue(options.granularity, CesiumMath.RADIANS_PER_DEGREE);\n        var perPositionHeight = defaultValue(options.perPositionHeight, false);\n        var perPositionHeightExtrude = perPositionHeight && defined(options.extrudedHeight);\n        var arcType = defaultValue(options.arcType, ArcType.GEODESIC);\n\n        var height = defaultValue(options.height, 0.0);\n        var extrudedHeight = defaultValue(options.extrudedHeight, height);\n\n        if (!perPositionHeightExtrude) {\n            var h = Math.max(height, extrudedHeight);\n            extrudedHeight = Math.min(height, extrudedHeight);\n            height = h;\n        }\n\n        this._ellipsoid = Ellipsoid.clone(ellipsoid);\n        this._granularity = granularity;\n        this._height = height;\n        this._extrudedHeight = extrudedHeight;\n        this._arcType = arcType;\n        this._polygonHierarchy = polygonHierarchy;\n        this._perPositionHeight = perPositionHeight;\n        this._perPositionHeightExtrude = perPositionHeightExtrude;\n        this._offsetAttribute = options.offsetAttribute;\n        this._workerName = 'createPolygonOutlineGeometry';\n\n        /**\n         * The number of elements used to pack the object into an array.\n         * @type {Number}\n         */\n        this.packedLength = PolygonGeometryLibrary.computeHierarchyPackedLength(polygonHierarchy) + Ellipsoid.packedLength + 8;\n    }\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {PolygonOutlineGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    PolygonOutlineGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        startingIndex = PolygonGeometryLibrary.packPolygonHierarchy(value._polygonHierarchy, array, startingIndex);\n\n        Ellipsoid.pack(value._ellipsoid, array, startingIndex);\n        startingIndex += Ellipsoid.packedLength;\n\n        array[startingIndex++] = value._height;\n        array[startingIndex++] = value._extrudedHeight;\n        array[startingIndex++] = value._granularity;\n        array[startingIndex++] = value._perPositionHeightExtrude ? 1.0 : 0.0;\n        array[startingIndex++] = value._perPositionHeight ? 1.0 : 0.0;\n        array[startingIndex++] = value._arcType;\n        array[startingIndex++] = defaultValue(value._offsetAttribute, -1);\n        array[startingIndex] = value.packedLength;\n\n        return array;\n    };\n\n    var scratchEllipsoid = Ellipsoid.clone(Ellipsoid.UNIT_SPHERE);\n    var dummyOptions = {\n        polygonHierarchy : {}\n    };\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {PolygonOutlineGeometry} [result] The object into which to store the result.\n     * @returns {PolygonOutlineGeometry} The modified result parameter or a new PolygonOutlineGeometry instance if one was not provided.\n     */\n    PolygonOutlineGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var polygonHierarchy = PolygonGeometryLibrary.unpackPolygonHierarchy(array, startingIndex);\n        startingIndex = polygonHierarchy.startingIndex;\n        delete polygonHierarchy.startingIndex;\n\n        var ellipsoid = Ellipsoid.unpack(array, startingIndex, scratchEllipsoid);\n        startingIndex += Ellipsoid.packedLength;\n\n        var height = array[startingIndex++];\n        var extrudedHeight = array[startingIndex++];\n        var granularity = array[startingIndex++];\n        var perPositionHeightExtrude = array[startingIndex++] === 1.0;\n        var perPositionHeight = array[startingIndex++] === 1.0;\n        var arcType = array[startingIndex++];\n        var offsetAttribute = array[startingIndex++];\n        var packedLength = array[startingIndex];\n\n        if (!defined(result)) {\n            result = new PolygonOutlineGeometry(dummyOptions);\n        }\n\n        result._polygonHierarchy = polygonHierarchy;\n        result._ellipsoid = Ellipsoid.clone(ellipsoid, result._ellipsoid);\n        result._height = height;\n        result._extrudedHeight = extrudedHeight;\n        result._granularity = granularity;\n        result._perPositionHeight = perPositionHeight;\n        result._perPositionHeightExtrude = perPositionHeightExtrude;\n        result._arcType = arcType;\n        result._offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n        result.packedLength = packedLength;\n\n        return result;\n    };\n\n    /**\n     * A description of a polygon outline from an array of positions.\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3[]} options.positions An array of positions that defined the corner points of the polygon.\n     * @param {Number} [options.height=0.0] The height of the polygon.\n     * @param {Number} [options.extrudedHeight] The height of the polygon extrusion.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid to be used as a reference.\n     * @param {Number} [options.granularity=CesiumMath.RADIANS_PER_DEGREE] The distance, in radians, between each latitude and longitude. Determines the number of positions in the buffer.\n     * @param {Boolean} [options.perPositionHeight=false] Use the height of options.positions for each position instead of using options.height to determine the height.\n     * @param {ArcType} [options.arcType=ArcType.GEODESIC] The type of path the outline must follow. Valid options are {@link LinkType.GEODESIC} and {@link ArcType.RHUMB}.\n     * @returns {PolygonOutlineGeometry}\n     *\n     *\n     * @example\n     * // create a polygon from points\n     * var polygon = Cesium.PolygonOutlineGeometry.fromPositions({\n     *   positions : Cesium.Cartesian3.fromDegreesArray([\n     *     -72.0, 40.0,\n     *     -70.0, 35.0,\n     *     -75.0, 30.0,\n     *     -70.0, 30.0,\n     *     -68.0, 40.0\n     *   ])\n     * });\n     * var geometry = Cesium.PolygonOutlineGeometry.createGeometry(polygon);\n     *\n     * @see PolygonOutlineGeometry#createGeometry\n     */\n    PolygonOutlineGeometry.fromPositions = function(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        \n\n        var newOptions = {\n            polygonHierarchy : {\n                positions : options.positions\n            },\n            height : options.height,\n            extrudedHeight : options.extrudedHeight,\n            ellipsoid : options.ellipsoid,\n            granularity : options.granularity,\n            perPositionHeight : options.perPositionHeight,\n            arcType: options.arcType,\n            offsetAttribute : options.offsetAttribute\n        };\n        return new PolygonOutlineGeometry(newOptions);\n    };\n\n    /**\n     * Computes the geometric representation of a polygon outline, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {PolygonOutlineGeometry} polygonGeometry A description of the polygon outline.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    PolygonOutlineGeometry.createGeometry = function(polygonGeometry) {\n        var ellipsoid = polygonGeometry._ellipsoid;\n        var granularity = polygonGeometry._granularity;\n        var polygonHierarchy = polygonGeometry._polygonHierarchy;\n        var perPositionHeight = polygonGeometry._perPositionHeight;\n        var arcType = polygonGeometry._arcType;\n\n        var polygons = PolygonGeometryLibrary.polygonOutlinesFromHierarchy(polygonHierarchy, !perPositionHeight, ellipsoid);\n\n        if (polygons.length === 0) {\n            return undefined;\n        }\n\n        var geometryInstance;\n        var geometries = [];\n        var minDistance = CesiumMath.chordLength(granularity, ellipsoid.maximumRadius);\n\n        var height = polygonGeometry._height;\n        var extrudedHeight = polygonGeometry._extrudedHeight;\n        var extrude = polygonGeometry._perPositionHeightExtrude || !CesiumMath.equalsEpsilon(height, extrudedHeight, 0, CesiumMath.EPSILON2);\n        var offsetValue;\n        var i;\n        if (extrude) {\n            for (i = 0; i < polygons.length; i++) {\n                geometryInstance = createGeometryFromPositionsExtruded(ellipsoid, polygons[i], minDistance, perPositionHeight, arcType);\n                geometryInstance.geometry = PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(geometryInstance.geometry, height, extrudedHeight, ellipsoid, perPositionHeight);\n                if (defined(polygonGeometry._offsetAttribute)) {\n                    var size = geometryInstance.geometry.attributes.position.values.length / 3;\n                    var offsetAttribute = new Uint8Array(size);\n                    if (polygonGeometry._offsetAttribute === GeometryOffsetAttribute.TOP) {\n                        offsetAttribute = arrayFill(offsetAttribute, 1, 0, size / 2);\n                    } else {\n                        offsetValue = polygonGeometry._offsetAttribute === GeometryOffsetAttribute.NONE ? 0 : 1;\n                        offsetAttribute = arrayFill(offsetAttribute, offsetValue);\n                    }\n\n                    geometryInstance.geometry.attributes.applyOffset = new GeometryAttribute({\n                        componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                        componentsPerAttribute : 1,\n                        values : offsetAttribute\n                    });\n                }\n                geometries.push(geometryInstance);\n            }\n        } else {\n            for (i = 0; i < polygons.length; i++) {\n                geometryInstance = createGeometryFromPositions(ellipsoid, polygons[i], minDistance, perPositionHeight, arcType);\n                geometryInstance.geometry.attributes.position.values = PolygonPipeline.scaleToGeodeticHeight(geometryInstance.geometry.attributes.position.values, height, ellipsoid, !perPositionHeight);\n\n                if (defined(polygonGeometry._offsetAttribute)) {\n                    var length = geometryInstance.geometry.attributes.position.values.length;\n                    var applyOffset = new Uint8Array(length / 3);\n                    offsetValue = polygonGeometry._offsetAttribute === GeometryOffsetAttribute.NONE ? 0 : 1;\n                    arrayFill(applyOffset, offsetValue);\n                    geometryInstance.geometry.attributes.applyOffset = new GeometryAttribute({\n                        componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                        componentsPerAttribute : 1,\n                        values: applyOffset\n                    });\n                }\n\n                geometries.push(geometryInstance);\n            }\n        }\n\n        var geometry = GeometryPipeline.combineInstances(geometries)[0];\n        var boundingSphere = BoundingSphere.fromVertices(geometry.attributes.position.values);\n\n        return new Geometry({\n            attributes : geometry.attributes,\n            indices : geometry.indices,\n            primitiveType : geometry.primitiveType,\n            boundingSphere : boundingSphere,\n            offsetAttribute : polygonGeometry._offsetAttribute\n        });\n    };\nexport default PolygonOutlineGeometry;\n","import ApproximateTerrainHeights from '../Core/ApproximateTerrainHeights.js';\nimport ArcType from '../Core/ArcType.js';\nimport Cartesian2 from '../Core/Cartesian2.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Check from '../Core/Check.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport CoplanarPolygonGeometry from '../Core/CoplanarPolygonGeometry.js';\nimport CoplanarPolygonOutlineGeometry from '../Core/CoplanarPolygonOutlineGeometry.js';\nimport defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport DistanceDisplayConditionGeometryInstanceAttribute from '../Core/DistanceDisplayConditionGeometryInstanceAttribute.js';\nimport EllipsoidTangentPlane from '../Core/EllipsoidTangentPlane.js';\nimport GeometryInstance from '../Core/GeometryInstance.js';\nimport Iso8601 from '../Core/Iso8601.js';\nimport OffsetGeometryInstanceAttribute from '../Core/OffsetGeometryInstanceAttribute.js';\nimport oneTimeWarning from '../Core/oneTimeWarning.js';\nimport PolygonGeometry from '../Core/PolygonGeometry.js';\nimport PolygonOutlineGeometry from '../Core/PolygonOutlineGeometry.js';\nimport Rectangle from '../Core/Rectangle.js';\nimport ShowGeometryInstanceAttribute from '../Core/ShowGeometryInstanceAttribute.js';\nimport HeightReference from '../Scene/HeightReference.js';\nimport MaterialAppearance from '../Scene/MaterialAppearance.js';\nimport PerInstanceColorAppearance from '../Scene/PerInstanceColorAppearance.js';\nimport ColorMaterialProperty from './ColorMaterialProperty.js';\nimport DynamicGeometryUpdater from './DynamicGeometryUpdater.js';\nimport GeometryUpdater from './GeometryUpdater.js';\nimport GroundGeometryUpdater from './GroundGeometryUpdater.js';\nimport Property from './Property.js';\n\n    var heightAndPerPositionHeightWarning = 'Entity polygons cannot have both height and perPositionHeight.  height will be ignored';\n    var heightReferenceAndPerPositionHeightWarning = 'heightReference is not supported for entity polygons with perPositionHeight. heightReference will be ignored';\n\n    var scratchColor = new Color();\n    var defaultOffset = Cartesian3.ZERO;\n    var offsetScratch = new Cartesian3();\n    var scratchRectangle = new Rectangle();\n    var scratch2DPositions = [];\n    var cart2Scratch = new Cartesian2();\n\n    function PolygonGeometryOptions(entity) {\n        this.id = entity;\n        this.vertexFormat = undefined;\n        this.polygonHierarchy = undefined;\n        this.perPositionHeight = undefined;\n        this.closeTop = undefined;\n        this.closeBottom = undefined;\n        this.height = undefined;\n        this.extrudedHeight = undefined;\n        this.granularity = undefined;\n        this.stRotation = undefined;\n        this.offsetAttribute = undefined;\n        this.arcType = undefined;\n    }\n\n    /**\n     * A {@link GeometryUpdater} for polygons.\n     * Clients do not normally create this class directly, but instead rely on {@link DataSourceDisplay}.\n     * @alias PolygonGeometryUpdater\n     * @constructor\n     *\n     * @param {Entity} entity The entity containing the geometry to be visualized.\n     * @param {Scene} scene The scene where visualization is taking place.\n     */\n    function PolygonGeometryUpdater(entity, scene) {\n        GroundGeometryUpdater.call(this, {\n            entity : entity,\n            scene : scene,\n            geometryOptions : new PolygonGeometryOptions(entity),\n            geometryPropertyName : 'polygon',\n            observedPropertyNames : ['availability', 'polygon']\n        });\n\n        this._onEntityPropertyChanged(entity, 'polygon', entity.polygon, undefined);\n    }\n\n    if (defined(Object.create)) {\n        PolygonGeometryUpdater.prototype = Object.create(GroundGeometryUpdater.prototype);\n        PolygonGeometryUpdater.prototype.constructor = PolygonGeometryUpdater;\n    }\n\n    /**\n     * Creates the geometry instance which represents the fill of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the filled portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent a filled geometry.\n     */\n    PolygonGeometryUpdater.prototype.createFillGeometryInstance = function(time) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n        var options = this._options;\n\n        var attributes = {\n            show : new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._fillProperty.getValue(time)),\n            distanceDisplayCondition : DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(time)),\n            offset : undefined,\n            color : undefined\n        };\n\n        if (this._materialProperty instanceof ColorMaterialProperty) {\n            var currentColor;\n            if (defined(this._materialProperty.color) && (this._materialProperty.color.isConstant || isAvailable)) {\n                currentColor = this._materialProperty.color.getValue(time, scratchColor);\n            }\n            if (!defined(currentColor)) {\n                currentColor = Color.WHITE;\n            }\n            attributes.color = ColorGeometryInstanceAttribute.fromColor(currentColor);\n        }\n        if (defined(options.offsetAttribute)) {\n            attributes.offset = OffsetGeometryInstanceAttribute.fromCartesian3(Property.getValueOrDefault(this._terrainOffsetProperty, time, defaultOffset, offsetScratch));\n        }\n\n        var geometry;\n        if (options.perPositionHeight && !defined(options.extrudedHeight)) {\n            geometry = new CoplanarPolygonGeometry(options);\n        } else {\n            geometry = new PolygonGeometry(options);\n        }\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : geometry,\n            attributes : attributes\n        });\n    };\n\n    /**\n     * Creates the geometry instance which represents the outline of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the outline portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent an outlined geometry.\n     */\n    PolygonGeometryUpdater.prototype.createOutlineGeometryInstance = function(time) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n        var options = this._options;\n        var outlineColor = Property.getValueOrDefault(this._outlineColorProperty, time, Color.BLACK, scratchColor);\n        var distanceDisplayCondition = this._distanceDisplayConditionProperty.getValue(time);\n\n        var attributes = {\n            show : new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._showOutlineProperty.getValue(time)),\n            color : ColorGeometryInstanceAttribute.fromColor(outlineColor),\n            distanceDisplayCondition : DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(distanceDisplayCondition),\n            offset : undefined\n        };\n\n        if (defined(options.offsetAttribute)) {\n            attributes.offset = OffsetGeometryInstanceAttribute.fromCartesian3(Property.getValueOrDefault(this._terrainOffsetProperty, time, defaultOffset, offsetScratch));\n        }\n\n        var geometry;\n        if (options.perPositionHeight && !defined(options.extrudedHeight)) {\n            geometry = new CoplanarPolygonOutlineGeometry(options);\n        } else {\n            geometry = new PolygonOutlineGeometry(options);\n        }\n        return new GeometryInstance({\n            id : entity,\n            geometry : geometry,\n            attributes : attributes\n        });\n    };\n\n    PolygonGeometryUpdater.prototype._computeCenter = function(time, result) {\n        var hierarchy = Property.getValueOrUndefined(this._entity.polygon.hierarchy, time);\n        if (!defined(hierarchy)) {\n            return;\n        }\n        var positions = hierarchy.positions;\n        if (positions.length === 0) {\n            return;\n        }\n        var ellipsoid = this._scene.mapProjection.ellipsoid;\n\n        var tangentPlane = EllipsoidTangentPlane.fromPoints(positions, ellipsoid);\n        var positions2D = tangentPlane.projectPointsOntoPlane(positions, scratch2DPositions);\n\n        var length = positions2D.length;\n        var area = 0;\n        var j = length - 1;\n        var centroid2D = new Cartesian2();\n        for (var i = 0; i < length; j = i++) {\n            var p1 = positions2D[i];\n            var p2 = positions2D[j];\n            var f = p1.x * p2.y - p2.x * p1.y;\n\n            var sum = Cartesian2.add(p1, p2, cart2Scratch);\n            sum = Cartesian2.multiplyByScalar(sum, f, sum);\n            centroid2D = Cartesian2.add(centroid2D, sum, centroid2D);\n\n            area += f;\n        }\n\n        var a = 1.0 / (area * 3.0);\n        centroid2D = Cartesian2.multiplyByScalar(centroid2D, a, centroid2D);\n        return tangentPlane.projectPointOntoEllipsoid(centroid2D, result);\n    };\n\n    PolygonGeometryUpdater.prototype._isHidden = function(entity, polygon) {\n        return !defined(polygon.hierarchy) || GeometryUpdater.prototype._isHidden.call(this, entity, polygon);\n    };\n\n    PolygonGeometryUpdater.prototype._isOnTerrain = function(entity, polygon) {\n        var onTerrain = GroundGeometryUpdater.prototype._isOnTerrain.call(this, entity, polygon);\n        var perPositionHeightProperty = polygon.perPositionHeight;\n        var perPositionHeightEnabled = defined(perPositionHeightProperty) && (perPositionHeightProperty.isConstant ? perPositionHeightProperty.getValue(Iso8601.MINIMUM_VALUE) : true);\n        return onTerrain && !perPositionHeightEnabled;\n    };\n\n    PolygonGeometryUpdater.prototype._isDynamic = function(entity, polygon) {\n        return !polygon.hierarchy.isConstant || //\n               !Property.isConstant(polygon.height) || //\n               !Property.isConstant(polygon.extrudedHeight) || //\n               !Property.isConstant(polygon.granularity) || //\n               !Property.isConstant(polygon.stRotation) || //\n               !Property.isConstant(polygon.outlineWidth) || //\n               !Property.isConstant(polygon.perPositionHeight) || //\n               !Property.isConstant(polygon.closeTop) || //\n               !Property.isConstant(polygon.closeBottom) || //\n               !Property.isConstant(polygon.zIndex) || //\n               !Property.isConstant(polygon.arcType) || //\n               (this._onTerrain && !Property.isConstant(this._materialProperty) && !(this._materialProperty instanceof ColorMaterialProperty));\n    };\n\n    PolygonGeometryUpdater.prototype._setStaticOptions = function(entity, polygon) {\n        var isColorMaterial = this._materialProperty instanceof ColorMaterialProperty;\n\n        var options = this._options;\n        options.vertexFormat = isColorMaterial ? PerInstanceColorAppearance.VERTEX_FORMAT : MaterialAppearance.MaterialSupport.TEXTURED.vertexFormat;\n\n        var hierarchyValue = polygon.hierarchy.getValue(Iso8601.MINIMUM_VALUE);\n        var heightValue = Property.getValueOrUndefined(polygon.height, Iso8601.MINIMUM_VALUE);\n        var heightReferenceValue = Property.getValueOrDefault(polygon.heightReference, Iso8601.MINIMUM_VALUE, HeightReference.NONE);\n        var extrudedHeightValue = Property.getValueOrUndefined(polygon.extrudedHeight, Iso8601.MINIMUM_VALUE);\n        var extrudedHeightReferenceValue = Property.getValueOrDefault(polygon.extrudedHeightReference, Iso8601.MINIMUM_VALUE, HeightReference.NONE);\n        var perPositionHeightValue = Property.getValueOrDefault(polygon.perPositionHeight, Iso8601.MINIMUM_VALUE, false);\n\n        heightValue = GroundGeometryUpdater.getGeometryHeight(heightValue, heightReferenceValue);\n\n        var offsetAttribute;\n        if (perPositionHeightValue) {\n            if (defined(heightValue)) {\n                heightValue = undefined;\n                oneTimeWarning(heightAndPerPositionHeightWarning);\n            }\n            if (heightReferenceValue !== HeightReference.NONE && perPositionHeightValue) {\n                heightValue = undefined;\n                oneTimeWarning(heightReferenceAndPerPositionHeightWarning);\n            }\n        } else {\n            if (defined(extrudedHeightValue) && !defined(heightValue)) {\n                heightValue = 0;\n            }\n            offsetAttribute = GroundGeometryUpdater.computeGeometryOffsetAttribute(heightValue, heightReferenceValue, extrudedHeightValue, extrudedHeightReferenceValue);\n        }\n\n        options.polygonHierarchy = hierarchyValue;\n        options.granularity = Property.getValueOrUndefined(polygon.granularity, Iso8601.MINIMUM_VALUE);\n        options.stRotation = Property.getValueOrUndefined(polygon.stRotation, Iso8601.MINIMUM_VALUE);\n        options.perPositionHeight = perPositionHeightValue;\n        options.closeTop = Property.getValueOrDefault(polygon.closeTop, Iso8601.MINIMUM_VALUE, true);\n        options.closeBottom = Property.getValueOrDefault(polygon.closeBottom, Iso8601.MINIMUM_VALUE, true);\n        options.offsetAttribute = offsetAttribute;\n        options.height = heightValue;\n        options.arcType = Property.getValueOrDefault(polygon.arcType, Iso8601.MINIMUM_VALUE, ArcType.GEODESIC);\n\n        extrudedHeightValue = GroundGeometryUpdater.getGeometryExtrudedHeight(extrudedHeightValue, extrudedHeightReferenceValue);\n        if (extrudedHeightValue === GroundGeometryUpdater.CLAMP_TO_GROUND) {\n            extrudedHeightValue = ApproximateTerrainHeights.getMinimumMaximumHeights(PolygonGeometry.computeRectangle(options, scratchRectangle)).minimumTerrainHeight;\n        }\n\n        options.extrudedHeight = extrudedHeightValue;\n    };\n\n    PolygonGeometryUpdater.prototype._getIsClosed = function(options) {\n        var height = options.height;\n        var extrudedHeight = options.extrudedHeight;\n        var isExtruded = defined(extrudedHeight) && extrudedHeight !== height;\n        return !options.perPositionHeight && (!isExtruded && height === 0 || (isExtruded && options.closeTop && options.closeBottom));\n    };\n\n    PolygonGeometryUpdater.DynamicGeometryUpdater = DyanmicPolygonGeometryUpdater;\n\n    /**\n     * @private\n     */\n    function DyanmicPolygonGeometryUpdater(geometryUpdater, primitives, groundPrimitives) {\n        DynamicGeometryUpdater.call(this, geometryUpdater, primitives, groundPrimitives);\n    }\n\n    if (defined(Object.create)) {\n        DyanmicPolygonGeometryUpdater.prototype = Object.create(DynamicGeometryUpdater.prototype);\n        DyanmicPolygonGeometryUpdater.prototype.constructor = DyanmicPolygonGeometryUpdater;\n    }\n\n    DyanmicPolygonGeometryUpdater.prototype._isHidden = function(entity, polygon, time) {\n        return !defined(this._options.polygonHierarchy) || DynamicGeometryUpdater.prototype._isHidden.call(this, entity, polygon, time);\n    };\n\n    DyanmicPolygonGeometryUpdater.prototype._setOptions = function(entity, polygon, time) {\n        var options = this._options;\n\n        options.polygonHierarchy = Property.getValueOrUndefined(polygon.hierarchy, time);\n\n        var heightValue = Property.getValueOrUndefined(polygon.height, time);\n        var heightReferenceValue = Property.getValueOrDefault(polygon.heightReference, time, HeightReference.NONE);\n        var extrudedHeightReferenceValue = Property.getValueOrDefault(polygon.extrudedHeightReference, time, HeightReference.NONE);\n        var extrudedHeightValue = Property.getValueOrUndefined(polygon.extrudedHeight, time);\n        var perPositionHeightValue = Property.getValueOrUndefined(polygon.perPositionHeight, time);\n\n        heightValue = GroundGeometryUpdater.getGeometryHeight(heightValue, extrudedHeightReferenceValue);\n\n        var offsetAttribute;\n        if (perPositionHeightValue) {\n            if (defined(heightValue)) {\n                heightValue = undefined;\n                oneTimeWarning(heightAndPerPositionHeightWarning);\n            }\n            if (heightReferenceValue !== HeightReference.NONE && perPositionHeightValue) {\n                heightValue = undefined;\n                oneTimeWarning(heightReferenceAndPerPositionHeightWarning);\n            }\n        } else {\n            if (defined(extrudedHeightValue) && !defined(heightValue)) {\n                heightValue = 0;\n            }\n\n            offsetAttribute = GroundGeometryUpdater.computeGeometryOffsetAttribute(heightValue, heightReferenceValue, extrudedHeightValue, extrudedHeightReferenceValue);\n        }\n\n        options.granularity = Property.getValueOrUndefined(polygon.granularity, time);\n        options.stRotation = Property.getValueOrUndefined(polygon.stRotation, time);\n        options.perPositionHeight = Property.getValueOrUndefined(polygon.perPositionHeight, time);\n        options.closeTop = Property.getValueOrDefault(polygon.closeTop, time, true);\n        options.closeBottom = Property.getValueOrDefault(polygon.closeBottom, time, true);\n        options.offsetAttribute = offsetAttribute;\n        options.height = heightValue;\n        options.arcType = Property.getValueOrDefault(polygon.arcType, time, ArcType.GEODESIC);\n\n        extrudedHeightValue = GroundGeometryUpdater.getGeometryExtrudedHeight(extrudedHeightValue, extrudedHeightReferenceValue);\n        if (extrudedHeightValue === GroundGeometryUpdater.CLAMP_TO_GROUND) {\n            extrudedHeightValue = ApproximateTerrainHeights.getMinimumMaximumHeights(PolygonGeometry.computeRectangle(options, scratchRectangle)).minimumTerrainHeight;\n        }\n\n        options.extrudedHeight = extrudedHeightValue;\n    };\nexport default PolygonGeometryUpdater;\n","import arrayRemoveDuplicates from './arrayRemoveDuplicates.js';\nimport BoundingRectangle from './BoundingRectangle.js';\nimport BoundingSphere from './BoundingSphere.js';\nimport Cartesian2 from './Cartesian2.js';\nimport Cartesian3 from './Cartesian3.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport CornerType from './CornerType.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport DeveloperError from './DeveloperError.js';\nimport Ellipsoid from './Ellipsoid.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport GeometryPipeline from './GeometryPipeline.js';\nimport IndexDatatype from './IndexDatatype.js';\nimport CesiumMath from './Math.js';\nimport oneTimeWarning from './oneTimeWarning.js';\nimport PolygonPipeline from './PolygonPipeline.js';\nimport PolylineVolumeGeometryLibrary from './PolylineVolumeGeometryLibrary.js';\nimport PrimitiveType from './PrimitiveType.js';\nimport VertexFormat from './VertexFormat.js';\nimport WindingOrder from './WindingOrder.js';\n\n    function computeAttributes(combinedPositions, shape, boundingRectangle, vertexFormat) {\n        var attributes = new GeometryAttributes();\n        if (vertexFormat.position) {\n            attributes.position = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.DOUBLE,\n                componentsPerAttribute : 3,\n                values : combinedPositions\n            });\n        }\n        var shapeLength = shape.length;\n        var vertexCount = combinedPositions.length / 3;\n        var length = (vertexCount - shapeLength * 2) / (shapeLength * 2);\n        var firstEndIndices = PolygonPipeline.triangulate(shape);\n\n        var indicesCount = (length - 1) * (shapeLength) * 6 + firstEndIndices.length * 2;\n        var indices = IndexDatatype.createTypedArray(vertexCount, indicesCount);\n        var i, j;\n        var ll, ul, ur, lr;\n        var offset = shapeLength * 2;\n        var index = 0;\n        for (i = 0; i < length - 1; i++) {\n            for (j = 0; j < shapeLength - 1; j++) {\n                ll = j * 2 + i * shapeLength * 2;\n                lr = ll + offset;\n                ul = ll + 1;\n                ur = ul + offset;\n\n                indices[index++] = ul;\n                indices[index++] = ll;\n                indices[index++] = ur;\n                indices[index++] = ur;\n                indices[index++] = ll;\n                indices[index++] = lr;\n            }\n            ll = shapeLength * 2 - 2 + i * shapeLength * 2;\n            ul = ll + 1;\n            ur = ul + offset;\n            lr = ll + offset;\n\n            indices[index++] = ul;\n            indices[index++] = ll;\n            indices[index++] = ur;\n            indices[index++] = ur;\n            indices[index++] = ll;\n            indices[index++] = lr;\n        }\n\n        if (vertexFormat.st || vertexFormat.tangent || vertexFormat.bitangent) { // st required for tangent/bitangent calculation\n            var st = new Float32Array(vertexCount * 2);\n            var lengthSt = 1 / (length - 1);\n            var heightSt = 1 / (boundingRectangle.height);\n            var heightOffset = boundingRectangle.height / 2;\n            var s, t;\n            var stindex = 0;\n            for (i = 0; i < length; i++) {\n                s = i * lengthSt;\n                t = heightSt * (shape[0].y + heightOffset);\n                st[stindex++] = s;\n                st[stindex++] = t;\n                for (j = 1; j < shapeLength; j++) {\n                    t = heightSt * (shape[j].y + heightOffset);\n                    st[stindex++] = s;\n                    st[stindex++] = t;\n                    st[stindex++] = s;\n                    st[stindex++] = t;\n                }\n                t = heightSt * (shape[0].y + heightOffset);\n                st[stindex++] = s;\n                st[stindex++] = t;\n            }\n            for (j = 0; j < shapeLength; j++) {\n                s = 0;\n                t = heightSt * (shape[j].y + heightOffset);\n                st[stindex++] = s;\n                st[stindex++] = t;\n            }\n            for (j = 0; j < shapeLength; j++) {\n                s = (length - 1) * lengthSt;\n                t = heightSt * (shape[j].y + heightOffset);\n                st[stindex++] = s;\n                st[stindex++] = t;\n            }\n\n            attributes.st = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 2,\n                values : new Float32Array(st)\n            });\n        }\n\n        var endOffset = vertexCount - shapeLength * 2;\n        for (i = 0; i < firstEndIndices.length; i += 3) {\n            var v0 = firstEndIndices[i] + endOffset;\n            var v1 = firstEndIndices[i + 1] + endOffset;\n            var v2 = firstEndIndices[i + 2] + endOffset;\n\n            indices[index++] = v0;\n            indices[index++] = v1;\n            indices[index++] = v2;\n            indices[index++] = v2 + shapeLength;\n            indices[index++] = v1 + shapeLength;\n            indices[index++] = v0 + shapeLength;\n        }\n\n        var geometry = new Geometry({\n            attributes : attributes,\n            indices : indices,\n            boundingSphere : BoundingSphere.fromVertices(combinedPositions),\n            primitiveType : PrimitiveType.TRIANGLES\n        });\n\n        if (vertexFormat.normal) {\n            geometry = GeometryPipeline.computeNormal(geometry);\n        }\n\n        if (vertexFormat.tangent || vertexFormat.bitangent) {\n            try {\n                geometry = GeometryPipeline.computeTangentAndBitangent(geometry);\n            } catch (e) {\n                oneTimeWarning('polyline-volume-tangent-bitangent', 'Unable to compute tangents and bitangents for polyline volume geometry');\n                //TODO https://github.com/CesiumGS/cesium/issues/3609\n            }\n\n            if (!vertexFormat.tangent) {\n                geometry.attributes.tangent = undefined;\n            }\n            if (!vertexFormat.bitangent) {\n                geometry.attributes.bitangent = undefined;\n            }\n            if (!vertexFormat.st) {\n                geometry.attributes.st = undefined;\n            }\n        }\n\n        return geometry;\n    }\n\n    /**\n     * A description of a polyline with a volume (a 2D shape extruded along a polyline).\n     *\n     * @alias PolylineVolumeGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3[]} options.polylinePositions An array of {@link Cartesain3} positions that define the center of the polyline volume.\n     * @param {Cartesian2[]} options.shapePositions An array of {@link Cartesian2} positions that define the shape to be extruded along the polyline\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid to be used as a reference.\n     * @param {Number} [options.granularity=CesiumMath.RADIANS_PER_DEGREE] The distance, in radians, between each latitude and longitude. Determines the number of positions in the buffer.\n     * @param {VertexFormat} [options.vertexFormat=VertexFormat.DEFAULT] The vertex attributes to be computed.\n     * @param {CornerType} [options.cornerType=CornerType.ROUNDED] Determines the style of the corners.\n     *\n     * @see PolylineVolumeGeometry#createGeometry\n     *\n     * @demo {@link https://sandcastle.cesium.com/index.html?src=Polyline%20Volume.html|Cesium Sandcastle Polyline Volume Demo}\n     *\n     * @example\n     * function computeCircle(radius) {\n     *   var positions = [];\n     *   for (var i = 0; i < 360; i++) {\n     *     var radians = Cesium.Math.toRadians(i);\n     *     positions.push(new Cesium.Cartesian2(radius * Math.cos(radians), radius * Math.sin(radians)));\n     *   }\n     *   return positions;\n     * }\n     *\n     * var volume = new Cesium.PolylineVolumeGeometry({\n     *   vertexFormat : Cesium.VertexFormat.POSITION_ONLY,\n     *   polylinePositions : Cesium.Cartesian3.fromDegreesArray([\n     *     -72.0, 40.0,\n     *     -70.0, 35.0\n     *   ]),\n     *   shapePositions : computeCircle(100000.0)\n     * });\n     */\n    function PolylineVolumeGeometry(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n        var positions = options.polylinePositions;\n        var shape = options.shapePositions;\n\n        \n\n        this._positions = positions;\n        this._shape = shape;\n        this._ellipsoid = Ellipsoid.clone(defaultValue(options.ellipsoid, Ellipsoid.WGS84));\n        this._cornerType = defaultValue(options.cornerType, CornerType.ROUNDED);\n        this._vertexFormat = VertexFormat.clone(defaultValue(options.vertexFormat, VertexFormat.DEFAULT));\n        this._granularity = defaultValue(options.granularity, CesiumMath.RADIANS_PER_DEGREE);\n        this._workerName = 'createPolylineVolumeGeometry';\n\n        var numComponents = 1 + positions.length * Cartesian3.packedLength;\n        numComponents += 1 + shape.length * Cartesian2.packedLength;\n\n        /**\n         * The number of elements used to pack the object into an array.\n         * @type {Number}\n         */\n        this.packedLength = numComponents + Ellipsoid.packedLength + VertexFormat.packedLength + 2;\n    }\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {PolylineVolumeGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    PolylineVolumeGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var i;\n\n        var positions = value._positions;\n        var length = positions.length;\n        array[startingIndex++] = length;\n\n        for (i = 0; i < length; ++i, startingIndex += Cartesian3.packedLength) {\n            Cartesian3.pack(positions[i], array, startingIndex);\n        }\n\n        var shape = value._shape;\n        length = shape.length;\n        array[startingIndex++] = length;\n\n        for (i = 0; i < length; ++i, startingIndex += Cartesian2.packedLength) {\n            Cartesian2.pack(shape[i], array, startingIndex);\n        }\n\n        Ellipsoid.pack(value._ellipsoid, array, startingIndex);\n        startingIndex += Ellipsoid.packedLength;\n\n        VertexFormat.pack(value._vertexFormat, array, startingIndex);\n        startingIndex += VertexFormat.packedLength;\n\n        array[startingIndex++] = value._cornerType;\n        array[startingIndex]   = value._granularity;\n\n        return array;\n    };\n\n    var scratchEllipsoid = Ellipsoid.clone(Ellipsoid.UNIT_SPHERE);\n    var scratchVertexFormat = new VertexFormat();\n    var scratchOptions = {\n        polylinePositions : undefined,\n        shapePositions : undefined,\n        ellipsoid : scratchEllipsoid,\n        vertexFormat : scratchVertexFormat,\n        cornerType : undefined,\n        granularity : undefined\n    };\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {PolylineVolumeGeometry} [result] The object into which to store the result.\n     * @returns {PolylineVolumeGeometry} The modified result parameter or a new PolylineVolumeGeometry instance if one was not provided.\n     */\n    PolylineVolumeGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var i;\n\n        var length = array[startingIndex++];\n        var positions = new Array(length);\n\n        for (i = 0; i < length; ++i, startingIndex += Cartesian3.packedLength) {\n            positions[i] = Cartesian3.unpack(array, startingIndex);\n        }\n\n        length = array[startingIndex++];\n        var shape = new Array(length);\n\n        for (i = 0; i < length; ++i, startingIndex += Cartesian2.packedLength) {\n            shape[i] = Cartesian2.unpack(array, startingIndex);\n        }\n\n        var ellipsoid = Ellipsoid.unpack(array, startingIndex, scratchEllipsoid);\n        startingIndex += Ellipsoid.packedLength;\n\n        var vertexFormat = VertexFormat.unpack(array, startingIndex, scratchVertexFormat);\n        startingIndex += VertexFormat.packedLength;\n\n        var cornerType = array[startingIndex++];\n        var granularity = array[startingIndex];\n\n        if (!defined(result)) {\n            scratchOptions.polylinePositions = positions;\n            scratchOptions.shapePositions = shape;\n            scratchOptions.cornerType = cornerType;\n            scratchOptions.granularity = granularity;\n            return new PolylineVolumeGeometry(scratchOptions);\n        }\n\n        result._positions = positions;\n        result._shape = shape;\n        result._ellipsoid = Ellipsoid.clone(ellipsoid, result._ellipsoid);\n        result._vertexFormat = VertexFormat.clone(vertexFormat, result._vertexFormat);\n        result._cornerType = cornerType;\n        result._granularity = granularity;\n\n        return result;\n    };\n\n    var brScratch = new BoundingRectangle();\n\n    /**\n     * Computes the geometric representation of a polyline with a volume, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {PolylineVolumeGeometry} polylineVolumeGeometry A description of the polyline volume.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    PolylineVolumeGeometry.createGeometry = function(polylineVolumeGeometry) {\n        var positions = polylineVolumeGeometry._positions;\n        var cleanPositions = arrayRemoveDuplicates(positions, Cartesian3.equalsEpsilon);\n        var shape2D = polylineVolumeGeometry._shape;\n        shape2D = PolylineVolumeGeometryLibrary.removeDuplicatesFromShape(shape2D);\n\n        if (cleanPositions.length < 2 || shape2D.length < 3) {\n            return undefined;\n        }\n\n        if (PolygonPipeline.computeWindingOrder2D(shape2D) === WindingOrder.CLOCKWISE) {\n            shape2D.reverse();\n        }\n        var boundingRectangle = BoundingRectangle.fromPoints(shape2D, brScratch);\n\n        var computedPositions = PolylineVolumeGeometryLibrary.computePositions(cleanPositions, shape2D, boundingRectangle, polylineVolumeGeometry, true);\n        return computeAttributes(computedPositions, shape2D, boundingRectangle, polylineVolumeGeometry._vertexFormat);\n    };\nexport default PolylineVolumeGeometry;\n","import arrayRemoveDuplicates from './arrayRemoveDuplicates.js';\nimport BoundingRectangle from './BoundingRectangle.js';\nimport BoundingSphere from './BoundingSphere.js';\nimport Cartesian2 from './Cartesian2.js';\nimport Cartesian3 from './Cartesian3.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport CornerType from './CornerType.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport DeveloperError from './DeveloperError.js';\nimport Ellipsoid from './Ellipsoid.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport IndexDatatype from './IndexDatatype.js';\nimport CesiumMath from './Math.js';\nimport PolygonPipeline from './PolygonPipeline.js';\nimport PolylineVolumeGeometryLibrary from './PolylineVolumeGeometryLibrary.js';\nimport PrimitiveType from './PrimitiveType.js';\nimport WindingOrder from './WindingOrder.js';\n\n    function computeAttributes(positions, shape) {\n        var attributes = new GeometryAttributes();\n        attributes.position = new GeometryAttribute({\n            componentDatatype : ComponentDatatype.DOUBLE,\n            componentsPerAttribute : 3,\n            values : positions\n        });\n\n        var shapeLength = shape.length;\n        var vertexCount = attributes.position.values.length / 3;\n        var positionLength = positions.length / 3;\n        var shapeCount = positionLength / shapeLength;\n        var indices = IndexDatatype.createTypedArray(vertexCount, 2 * shapeLength * (shapeCount + 1));\n        var i, j;\n        var index = 0;\n        i = 0;\n        var offset = i * shapeLength;\n        for (j = 0; j < shapeLength - 1; j++) {\n            indices[index++] = j + offset;\n            indices[index++] = j + offset + 1;\n        }\n        indices[index++] = shapeLength - 1 + offset;\n        indices[index++] = offset;\n\n        i = shapeCount - 1;\n        offset = i * shapeLength;\n        for (j = 0; j < shapeLength - 1; j++) {\n            indices[index++] = j + offset;\n            indices[index++] = j + offset + 1;\n        }\n        indices[index++] = shapeLength - 1 + offset;\n        indices[index++] = offset;\n\n        for (i = 0; i < shapeCount - 1; i++) {\n            var firstOffset = shapeLength * i;\n            var secondOffset = firstOffset + shapeLength;\n            for (j = 0; j < shapeLength; j++) {\n                indices[index++] = j + firstOffset;\n                indices[index++] = j + secondOffset;\n            }\n        }\n\n        var geometry = new Geometry({\n            attributes : attributes,\n            indices : IndexDatatype.createTypedArray(vertexCount, indices),\n            boundingSphere : BoundingSphere.fromVertices(positions),\n            primitiveType : PrimitiveType.LINES\n        });\n\n        return geometry;\n    }\n\n    /**\n     * A description of a polyline with a volume (a 2D shape extruded along a polyline).\n     *\n     * @alias PolylineVolumeOutlineGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3[]} options.polylinePositions An array of positions that define the center of the polyline volume.\n     * @param {Cartesian2[]} options.shapePositions An array of positions that define the shape to be extruded along the polyline\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid to be used as a reference.\n     * @param {Number} [options.granularity=CesiumMath.RADIANS_PER_DEGREE] The distance, in radians, between each latitude and longitude. Determines the number of positions in the buffer.\n     * @param {CornerType} [options.cornerType=CornerType.ROUNDED] Determines the style of the corners.\n     *\n     * @see PolylineVolumeOutlineGeometry#createGeometry\n     *\n     * @example\n     * function computeCircle(radius) {\n     *   var positions = [];\n     *   for (var i = 0; i < 360; i++) {\n     *     var radians = Cesium.Math.toRadians(i);\n     *     positions.push(new Cesium.Cartesian2(radius * Math.cos(radians), radius * Math.sin(radians)));\n     *   }\n     *   return positions;\n     * }\n     *\n     * var volumeOutline = new Cesium.PolylineVolumeOutlineGeometry({\n     *   polylinePositions : Cesium.Cartesian3.fromDegreesArray([\n     *     -72.0, 40.0,\n     *     -70.0, 35.0\n     *   ]),\n     *   shapePositions : computeCircle(100000.0)\n     * });\n     */\n    function PolylineVolumeOutlineGeometry(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n        var positions = options.polylinePositions;\n        var shape = options.shapePositions;\n\n        \n\n        this._positions = positions;\n        this._shape = shape;\n        this._ellipsoid = Ellipsoid.clone(defaultValue(options.ellipsoid, Ellipsoid.WGS84));\n        this._cornerType = defaultValue(options.cornerType, CornerType.ROUNDED);\n        this._granularity = defaultValue(options.granularity, CesiumMath.RADIANS_PER_DEGREE);\n        this._workerName = 'createPolylineVolumeOutlineGeometry';\n\n        var numComponents = 1 + positions.length * Cartesian3.packedLength;\n        numComponents += 1 + shape.length * Cartesian2.packedLength;\n\n        /**\n         * The number of elements used to pack the object into an array.\n         * @type {Number}\n         */\n        this.packedLength = numComponents + Ellipsoid.packedLength + 2;\n    }\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {PolylineVolumeOutlineGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    PolylineVolumeOutlineGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var i;\n\n        var positions = value._positions;\n        var length = positions.length;\n        array[startingIndex++] = length;\n\n        for (i = 0; i < length; ++i, startingIndex += Cartesian3.packedLength) {\n            Cartesian3.pack(positions[i], array, startingIndex);\n        }\n\n        var shape = value._shape;\n        length = shape.length;\n        array[startingIndex++] = length;\n\n        for (i = 0; i < length; ++i, startingIndex += Cartesian2.packedLength) {\n            Cartesian2.pack(shape[i], array, startingIndex);\n        }\n\n        Ellipsoid.pack(value._ellipsoid, array, startingIndex);\n        startingIndex += Ellipsoid.packedLength;\n\n        array[startingIndex++] = value._cornerType;\n        array[startingIndex]   = value._granularity;\n\n        return array;\n    };\n\n    var scratchEllipsoid = Ellipsoid.clone(Ellipsoid.UNIT_SPHERE);\n    var scratchOptions = {\n        polylinePositions : undefined,\n        shapePositions : undefined,\n        ellipsoid : scratchEllipsoid,\n        height : undefined,\n        cornerType : undefined,\n        granularity : undefined\n    };\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {PolylineVolumeOutlineGeometry} [result] The object into which to store the result.\n     * @returns {PolylineVolumeOutlineGeometry} The modified result parameter or a new PolylineVolumeOutlineGeometry instance if one was not provided.\n     */\n    PolylineVolumeOutlineGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var i;\n\n        var length = array[startingIndex++];\n        var positions = new Array(length);\n\n        for (i = 0; i < length; ++i, startingIndex += Cartesian3.packedLength) {\n            positions[i] = Cartesian3.unpack(array, startingIndex);\n        }\n\n        length = array[startingIndex++];\n        var shape = new Array(length);\n\n        for (i = 0; i < length; ++i, startingIndex += Cartesian2.packedLength) {\n            shape[i] = Cartesian2.unpack(array, startingIndex);\n        }\n\n        var ellipsoid = Ellipsoid.unpack(array, startingIndex, scratchEllipsoid);\n        startingIndex += Ellipsoid.packedLength;\n\n        var cornerType = array[startingIndex++];\n        var granularity = array[startingIndex];\n\n        if (!defined(result)) {\n            scratchOptions.polylinePositions = positions;\n            scratchOptions.shapePositions = shape;\n            scratchOptions.cornerType = cornerType;\n            scratchOptions.granularity = granularity;\n            return new PolylineVolumeOutlineGeometry(scratchOptions);\n        }\n\n        result._positions = positions;\n        result._shape = shape;\n        result._ellipsoid = Ellipsoid.clone(ellipsoid, result._ellipsoid);\n        result._cornerType = cornerType;\n        result._granularity = granularity;\n\n        return result;\n    };\n\n    var brScratch = new BoundingRectangle();\n\n    /**\n     * Computes the geometric representation of the outline of a polyline with a volume, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {PolylineVolumeOutlineGeometry} polylineVolumeOutlineGeometry A description of the polyline volume outline.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    PolylineVolumeOutlineGeometry.createGeometry = function(polylineVolumeOutlineGeometry) {\n        var positions = polylineVolumeOutlineGeometry._positions;\n        var cleanPositions = arrayRemoveDuplicates(positions, Cartesian3.equalsEpsilon);\n        var shape2D = polylineVolumeOutlineGeometry._shape;\n        shape2D = PolylineVolumeGeometryLibrary.removeDuplicatesFromShape(shape2D);\n\n        if (cleanPositions.length < 2 || shape2D.length < 3) {\n            return undefined;\n        }\n\n        if (PolygonPipeline.computeWindingOrder2D(shape2D) === WindingOrder.CLOCKWISE) {\n            shape2D.reverse();\n        }\n        var boundingRectangle = BoundingRectangle.fromPoints(shape2D, brScratch);\n\n        var computedPositions = PolylineVolumeGeometryLibrary.computePositions(cleanPositions, shape2D, boundingRectangle, polylineVolumeOutlineGeometry, false);\n        return computeAttributes(computedPositions, shape2D);\n    };\nexport default PolylineVolumeOutlineGeometry;\n","import Check from '../Core/Check.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport DistanceDisplayConditionGeometryInstanceAttribute from '../Core/DistanceDisplayConditionGeometryInstanceAttribute.js';\nimport GeometryInstance from '../Core/GeometryInstance.js';\nimport Iso8601 from '../Core/Iso8601.js';\nimport PolylineVolumeGeometry from '../Core/PolylineVolumeGeometry.js';\nimport PolylineVolumeOutlineGeometry from '../Core/PolylineVolumeOutlineGeometry.js';\nimport ShowGeometryInstanceAttribute from '../Core/ShowGeometryInstanceAttribute.js';\nimport MaterialAppearance from '../Scene/MaterialAppearance.js';\nimport PerInstanceColorAppearance from '../Scene/PerInstanceColorAppearance.js';\nimport ColorMaterialProperty from './ColorMaterialProperty.js';\nimport DynamicGeometryUpdater from './DynamicGeometryUpdater.js';\nimport GeometryUpdater from './GeometryUpdater.js';\nimport Property from './Property.js';\n\n    var scratchColor = new Color();\n\n    function PolylineVolumeGeometryOptions(entity) {\n        this.id = entity;\n        this.vertexFormat = undefined;\n        this.polylinePositions = undefined;\n        this.shapePositions = undefined;\n        this.cornerType = undefined;\n        this.granularity = undefined;\n    }\n\n    /**\n     * A {@link GeometryUpdater} for polyline volumes.\n     * Clients do not normally create this class directly, but instead rely on {@link DataSourceDisplay}.\n     * @alias PolylineVolumeGeometryUpdater\n     * @constructor\n     *\n     * @param {Entity} entity The entity containing the geometry to be visualized.\n     * @param {Scene} scene The scene where visualization is taking place.\n     */\n    function PolylineVolumeGeometryUpdater(entity, scene) {\n        GeometryUpdater.call(this, {\n            entity : entity,\n            scene : scene,\n            geometryOptions : new PolylineVolumeGeometryOptions(entity),\n            geometryPropertyName : 'polylineVolume',\n            observedPropertyNames : ['availability', 'polylineVolume']\n        });\n\n        this._onEntityPropertyChanged(entity, 'polylineVolume', entity.polylineVolume, undefined);\n    }\n\n    if (defined(Object.create)) {\n        PolylineVolumeGeometryUpdater.prototype = Object.create(GeometryUpdater.prototype);\n        PolylineVolumeGeometryUpdater.prototype.constructor = PolylineVolumeGeometryUpdater;\n    }\n\n    /**\n     * Creates the geometry instance which represents the fill of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the filled portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent a filled geometry.\n     */\n    PolylineVolumeGeometryUpdater.prototype.createFillGeometryInstance = function(time) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n\n        var attributes;\n\n        var color;\n        var show = new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._fillProperty.getValue(time));\n        var distanceDisplayCondition = this._distanceDisplayConditionProperty.getValue(time);\n        var distanceDisplayConditionAttribute = DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(distanceDisplayCondition);\n        if (this._materialProperty instanceof ColorMaterialProperty) {\n            var currentColor;\n            if (defined(this._materialProperty.color) && (this._materialProperty.color.isConstant || isAvailable)) {\n                currentColor = this._materialProperty.color.getValue(time, scratchColor);\n            }\n            if (!defined(currentColor)) {\n                currentColor = Color.WHITE;\n            }\n            color = ColorGeometryInstanceAttribute.fromColor(currentColor);\n            attributes = {\n                show : show,\n                distanceDisplayCondition : distanceDisplayConditionAttribute,\n                color : color\n            };\n        } else {\n            attributes = {\n                show : show,\n                distanceDisplayCondition : distanceDisplayConditionAttribute\n            };\n        }\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : new PolylineVolumeGeometry(this._options),\n            attributes : attributes\n        });\n    };\n\n    /**\n     * Creates the geometry instance which represents the outline of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the outline portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent an outlined geometry.\n     */\n    PolylineVolumeGeometryUpdater.prototype.createOutlineGeometryInstance = function(time) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n        var outlineColor = Property.getValueOrDefault(this._outlineColorProperty, time, Color.BLACK, scratchColor);\n        var distanceDisplayCondition = this._distanceDisplayConditionProperty.getValue(time);\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : new PolylineVolumeOutlineGeometry(this._options),\n            attributes : {\n                show : new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._showOutlineProperty.getValue(time)),\n                color : ColorGeometryInstanceAttribute.fromColor(outlineColor),\n                distanceDisplayCondition : DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(distanceDisplayCondition)\n            }\n        });\n    };\n\n    PolylineVolumeGeometryUpdater.prototype._isHidden = function(entity, polylineVolume) {\n        return !defined(polylineVolume.positions) || !defined(polylineVolume.shape) || GeometryUpdater.prototype._isHidden.call(this, entity, polylineVolume);\n    };\n\n    PolylineVolumeGeometryUpdater.prototype._isDynamic = function(entity, polylineVolume) {\n        return !polylineVolume.positions.isConstant || //\n               !polylineVolume.shape.isConstant || //\n               !Property.isConstant(polylineVolume.granularity) || //\n               !Property.isConstant(polylineVolume.outlineWidth) || //\n               !Property.isConstant(polylineVolume.cornerType);\n    };\n\n    PolylineVolumeGeometryUpdater.prototype._setStaticOptions = function(entity, polylineVolume) {\n        var granularity = polylineVolume.granularity;\n        var cornerType = polylineVolume.cornerType;\n\n        var options = this._options;\n        var isColorMaterial = this._materialProperty instanceof ColorMaterialProperty;\n        options.vertexFormat = isColorMaterial ? PerInstanceColorAppearance.VERTEX_FORMAT : MaterialAppearance.MaterialSupport.TEXTURED.vertexFormat;\n        options.polylinePositions = polylineVolume.positions.getValue(Iso8601.MINIMUM_VALUE, options.polylinePositions);\n        options.shapePositions = polylineVolume.shape.getValue(Iso8601.MINIMUM_VALUE, options.shape);\n        options.granularity = defined(granularity) ? granularity.getValue(Iso8601.MINIMUM_VALUE) : undefined;\n        options.cornerType = defined(cornerType) ? cornerType.getValue(Iso8601.MINIMUM_VALUE) : undefined;\n    };\n\n    PolylineVolumeGeometryUpdater.DynamicGeometryUpdater = DynamicPolylineVolumeGeometryUpdater;\n\n    /**\n     * @private\n     */\n    function DynamicPolylineVolumeGeometryUpdater(geometryUpdater, primitives, groundPrimitives) {\n        DynamicGeometryUpdater.call(this, geometryUpdater, primitives, groundPrimitives);\n    }\n\n    if (defined(Object.create)) {\n        DynamicPolylineVolumeGeometryUpdater.prototype = Object.create(DynamicGeometryUpdater.prototype);\n        DynamicPolylineVolumeGeometryUpdater.prototype.constructor = DynamicPolylineVolumeGeometryUpdater;\n    }\n\n    DynamicPolylineVolumeGeometryUpdater.prototype._isHidden = function(entity, polylineVolume, time) {\n        var options = this._options;\n        return !defined(options.polylinePositions) || !defined(options.shapePositions) || DynamicGeometryUpdater.prototype._isHidden.call(this, entity, polylineVolume, time);\n    };\n\n    DynamicPolylineVolumeGeometryUpdater.prototype._setOptions = function(entity, polylineVolume, time) {\n        var options = this._options;\n        options.polylinePositions = Property.getValueOrUndefined(polylineVolume.positions, time, options.polylinePositions);\n        options.shapePositions = Property.getValueOrUndefined(polylineVolume.shape, time);\n        options.granularity = Property.getValueOrUndefined(polylineVolume.granularity, time);\n        options.cornerType = Property.getValueOrUndefined(polylineVolume.cornerType, time);\n    };\nexport default PolylineVolumeGeometryUpdater;\n","import arrayFill from './arrayFill.js';\nimport BoundingSphere from './BoundingSphere.js';\nimport Cartesian2 from './Cartesian2.js';\nimport Cartesian3 from './Cartesian3.js';\nimport Cartographic from './Cartographic.js';\nimport Check from './Check.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport DeveloperError from './DeveloperError.js';\nimport Ellipsoid from './Ellipsoid.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport GeometryInstance from './GeometryInstance.js';\nimport GeometryOffsetAttribute from './GeometryOffsetAttribute.js';\nimport GeometryPipeline from './GeometryPipeline.js';\nimport IndexDatatype from './IndexDatatype.js';\nimport CesiumMath from './Math.js';\nimport Matrix2 from './Matrix2.js';\nimport Matrix3 from './Matrix3.js';\nimport PolygonPipeline from './PolygonPipeline.js';\nimport PrimitiveType from './PrimitiveType.js';\nimport Quaternion from './Quaternion.js';\nimport Rectangle from './Rectangle.js';\nimport RectangleGeometryLibrary from './RectangleGeometryLibrary.js';\nimport VertexFormat from './VertexFormat.js';\n\n    var positionScratch = new Cartesian3();\n    var normalScratch = new Cartesian3();\n    var tangentScratch = new Cartesian3();\n    var bitangentScratch = new Cartesian3();\n    var rectangleScratch = new Rectangle();\n    var stScratch = new Cartesian2();\n    var bottomBoundingSphere = new BoundingSphere();\n    var topBoundingSphere = new BoundingSphere();\n\n    function createAttributes(vertexFormat, attributes) {\n        var geo = new Geometry({\n            attributes : new GeometryAttributes(),\n            primitiveType : PrimitiveType.TRIANGLES\n        });\n\n        geo.attributes.position = new GeometryAttribute({\n            componentDatatype : ComponentDatatype.DOUBLE,\n            componentsPerAttribute : 3,\n            values : attributes.positions\n        });\n        if (vertexFormat.normal) {\n            geo.attributes.normal = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : attributes.normals\n            });\n        }\n        if (vertexFormat.tangent) {\n            geo.attributes.tangent = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : attributes.tangents\n            });\n        }\n        if (vertexFormat.bitangent) {\n            geo.attributes.bitangent = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : attributes.bitangents\n            });\n        }\n        return geo;\n    }\n\n    function calculateAttributes(positions, vertexFormat, ellipsoid, tangentRotationMatrix) {\n        var length = positions.length;\n\n        var normals = (vertexFormat.normal) ? new Float32Array(length) : undefined;\n        var tangents = (vertexFormat.tangent) ? new Float32Array(length) : undefined;\n        var bitangents = (vertexFormat.bitangent) ? new Float32Array(length) : undefined;\n\n        var attrIndex = 0;\n        var bitangent = bitangentScratch;\n        var tangent = tangentScratch;\n        var normal = normalScratch;\n        if (vertexFormat.normal || vertexFormat.tangent || vertexFormat.bitangent) {\n            for (var i = 0; i < length; i += 3) {\n                var p = Cartesian3.fromArray(positions, i, positionScratch);\n                var attrIndex1 = attrIndex + 1;\n                var attrIndex2 = attrIndex + 2;\n\n                normal = ellipsoid.geodeticSurfaceNormal(p, normal);\n                if (vertexFormat.tangent || vertexFormat.bitangent) {\n                    Cartesian3.cross(Cartesian3.UNIT_Z, normal, tangent);\n                    Matrix3.multiplyByVector(tangentRotationMatrix, tangent, tangent);\n                    Cartesian3.normalize(tangent, tangent);\n\n                    if (vertexFormat.bitangent) {\n                        Cartesian3.normalize(Cartesian3.cross(normal, tangent, bitangent), bitangent);\n                    }\n                }\n\n                if (vertexFormat.normal) {\n                    normals[attrIndex] = normal.x;\n                    normals[attrIndex1] = normal.y;\n                    normals[attrIndex2] = normal.z;\n                }\n                if (vertexFormat.tangent) {\n                    tangents[attrIndex] = tangent.x;\n                    tangents[attrIndex1] = tangent.y;\n                    tangents[attrIndex2] = tangent.z;\n                }\n                if (vertexFormat.bitangent) {\n                    bitangents[attrIndex] = bitangent.x;\n                    bitangents[attrIndex1] = bitangent.y;\n                    bitangents[attrIndex2] = bitangent.z;\n                }\n                attrIndex += 3;\n            }\n        }\n        return createAttributes(vertexFormat, {\n            positions : positions,\n            normals : normals,\n            tangents : tangents,\n            bitangents : bitangents\n        });\n    }\n\n    var v1Scratch = new Cartesian3();\n    var v2Scratch = new Cartesian3();\n\n    function calculateAttributesWall(positions, vertexFormat, ellipsoid) {\n        var length = positions.length;\n\n        var normals = (vertexFormat.normal) ? new Float32Array(length) : undefined;\n        var tangents = (vertexFormat.tangent) ? new Float32Array(length) : undefined;\n        var bitangents = (vertexFormat.bitangent) ? new Float32Array(length) : undefined;\n\n        var normalIndex = 0;\n        var tangentIndex = 0;\n        var bitangentIndex = 0;\n        var recomputeNormal = true;\n\n        var bitangent = bitangentScratch;\n        var tangent = tangentScratch;\n        var normal = normalScratch;\n        if (vertexFormat.normal || vertexFormat.tangent || vertexFormat.bitangent) {\n            for (var i = 0; i < length; i += 6) {\n                var p = Cartesian3.fromArray(positions, i, positionScratch);\n                var p1 = Cartesian3.fromArray(positions, (i + 6) % length, v1Scratch);\n                if (recomputeNormal) {\n                    var p2 = Cartesian3.fromArray(positions, (i + 3) % length, v2Scratch);\n                    Cartesian3.subtract(p1, p, p1);\n                    Cartesian3.subtract(p2, p, p2);\n                    normal = Cartesian3.normalize(Cartesian3.cross(p2, p1, normal), normal);\n                    recomputeNormal = false;\n                }\n\n                if (Cartesian3.equalsEpsilon(p1, p, CesiumMath.EPSILON10)) { // if we've reached a corner\n                    recomputeNormal = true;\n                }\n\n                if (vertexFormat.tangent || vertexFormat.bitangent) {\n                    bitangent = ellipsoid.geodeticSurfaceNormal(p, bitangent);\n                    if (vertexFormat.tangent) {\n                        tangent = Cartesian3.normalize(Cartesian3.cross(bitangent, normal, tangent), tangent);\n                    }\n                }\n\n                if (vertexFormat.normal) {\n                    normals[normalIndex++] = normal.x;\n                    normals[normalIndex++] = normal.y;\n                    normals[normalIndex++] = normal.z;\n                    normals[normalIndex++] = normal.x;\n                    normals[normalIndex++] = normal.y;\n                    normals[normalIndex++] = normal.z;\n                }\n\n                if (vertexFormat.tangent) {\n                    tangents[tangentIndex++] = tangent.x;\n                    tangents[tangentIndex++] = tangent.y;\n                    tangents[tangentIndex++] = tangent.z;\n                    tangents[tangentIndex++] = tangent.x;\n                    tangents[tangentIndex++] = tangent.y;\n                    tangents[tangentIndex++] = tangent.z;\n                }\n\n                if (vertexFormat.bitangent) {\n                    bitangents[bitangentIndex++] = bitangent.x;\n                    bitangents[bitangentIndex++] = bitangent.y;\n                    bitangents[bitangentIndex++] = bitangent.z;\n                    bitangents[bitangentIndex++] = bitangent.x;\n                    bitangents[bitangentIndex++] = bitangent.y;\n                    bitangents[bitangentIndex++] = bitangent.z;\n                }\n            }\n        }\n\n        return createAttributes(vertexFormat, {\n            positions : positions,\n            normals : normals,\n            tangents : tangents,\n            bitangents : bitangents\n        });\n    }\n\n    function constructRectangle(rectangleGeometry, computedOptions) {\n        var vertexFormat = rectangleGeometry._vertexFormat;\n        var ellipsoid = rectangleGeometry._ellipsoid;\n        var height = computedOptions.height;\n        var width = computedOptions.width;\n        var northCap = computedOptions.northCap;\n        var southCap = computedOptions.southCap;\n\n        var rowStart = 0;\n        var rowEnd = height;\n        var rowHeight = height;\n        var size = 0;\n        if (northCap) {\n            rowStart = 1;\n            rowHeight -= 1;\n            size += 1;\n        }\n        if (southCap) {\n            rowEnd -= 1;\n            rowHeight -= 1;\n            size += 1;\n        }\n        size += (width * rowHeight);\n\n        var positions = (vertexFormat.position) ? new Float64Array(size * 3) : undefined;\n        var textureCoordinates = (vertexFormat.st) ? new Float32Array(size * 2) : undefined;\n\n        var posIndex = 0;\n        var stIndex = 0;\n\n        var position = positionScratch;\n        var st = stScratch;\n\n        var minX = Number.MAX_VALUE;\n        var minY = Number.MAX_VALUE;\n        var maxX = -Number.MAX_VALUE;\n        var maxY = -Number.MAX_VALUE;\n\n        for (var row = rowStart; row < rowEnd; ++row) {\n            for (var col = 0; col < width; ++col) {\n                RectangleGeometryLibrary.computePosition(computedOptions, ellipsoid, vertexFormat.st, row, col, position, st);\n\n                positions[posIndex++] = position.x;\n                positions[posIndex++] = position.y;\n                positions[posIndex++] = position.z;\n\n                if (vertexFormat.st) {\n                    textureCoordinates[stIndex++] = st.x;\n                    textureCoordinates[stIndex++] = st.y;\n\n                    minX = Math.min(minX, st.x);\n                    minY = Math.min(minY, st.y);\n                    maxX = Math.max(maxX, st.x);\n                    maxY = Math.max(maxY, st.y);\n                }\n            }\n        }\n        if (northCap) {\n            RectangleGeometryLibrary.computePosition(computedOptions, ellipsoid, vertexFormat.st, 0, 0, position, st);\n\n            positions[posIndex++] = position.x;\n            positions[posIndex++] = position.y;\n            positions[posIndex++] = position.z;\n\n            if (vertexFormat.st) {\n                textureCoordinates[stIndex++] = st.x;\n                textureCoordinates[stIndex++] = st.y;\n\n                minX = st.x;\n                minY = st.y;\n                maxX = st.x;\n                maxY = st.y;\n            }\n        }\n        if (southCap) {\n            RectangleGeometryLibrary.computePosition(computedOptions, ellipsoid, vertexFormat.st, height - 1, 0, position, st);\n\n            positions[posIndex++] = position.x;\n            positions[posIndex++] = position.y;\n            positions[posIndex] = position.z;\n\n            if (vertexFormat.st) {\n                textureCoordinates[stIndex++] = st.x;\n                textureCoordinates[stIndex] = st.y;\n\n                minX = Math.min(minX, st.x);\n                minY = Math.min(minY, st.y);\n                maxX = Math.max(maxX, st.x);\n                maxY = Math.max(maxY, st.y);\n            }\n        }\n\n        if (vertexFormat.st && (minX < 0.0 || minY < 0.0 || maxX > 1.0 || maxY > 1.0)) {\n            for (var k = 0; k < textureCoordinates.length; k += 2) {\n                textureCoordinates[k] = (textureCoordinates[k] - minX) / (maxX - minX);\n                textureCoordinates[k + 1] = (textureCoordinates[k + 1] - minY) / (maxY - minY);\n            }\n        }\n\n        var geo = calculateAttributes(positions, vertexFormat, ellipsoid, computedOptions.tangentRotationMatrix);\n\n        var indicesSize = 6 * (width - 1) * (rowHeight - 1);\n        if (northCap) {\n            indicesSize += 3 * (width - 1);\n        }\n        if (southCap) {\n            indicesSize += 3 * (width - 1);\n        }\n        var indices = IndexDatatype.createTypedArray(size, indicesSize);\n        var index = 0;\n        var indicesIndex = 0;\n        var i;\n        for (i = 0; i < rowHeight - 1; ++i) {\n            for (var j = 0; j < width - 1; ++j) {\n                var upperLeft = index;\n                var lowerLeft = upperLeft + width;\n                var lowerRight = lowerLeft + 1;\n                var upperRight = upperLeft + 1;\n                indices[indicesIndex++] = upperLeft;\n                indices[indicesIndex++] = lowerLeft;\n                indices[indicesIndex++] = upperRight;\n                indices[indicesIndex++] = upperRight;\n                indices[indicesIndex++] = lowerLeft;\n                indices[indicesIndex++] = lowerRight;\n                ++index;\n            }\n            ++index;\n        }\n        if (northCap || southCap) {\n            var northIndex = size - 1;\n            var southIndex = size - 1;\n            if (northCap && southCap) {\n                northIndex = size - 2;\n            }\n\n            var p1;\n            var p2;\n            index = 0;\n\n            if (northCap) {\n                for (i = 0; i < width - 1; i++) {\n                    p1 = index;\n                    p2 = p1 + 1;\n                    indices[indicesIndex++] = northIndex;\n                    indices[indicesIndex++] = p1;\n                    indices[indicesIndex++] = p2;\n                    ++index;\n                }\n            }\n            if (southCap) {\n                index = (rowHeight - 1) * (width);\n                for (i = 0; i < width - 1; i++) {\n                    p1 = index;\n                    p2 = p1 + 1;\n                    indices[indicesIndex++] = p1;\n                    indices[indicesIndex++] = southIndex;\n                    indices[indicesIndex++] = p2;\n                    ++index;\n                }\n            }\n        }\n\n        geo.indices = indices;\n        if (vertexFormat.st) {\n            geo.attributes.st = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 2,\n                values : textureCoordinates\n            });\n        }\n\n        return geo;\n    }\n\n    function addWallPositions(wallPositions, posIndex, i, topPositions, bottomPositions) {\n        wallPositions[posIndex++] = topPositions[i];\n        wallPositions[posIndex++] = topPositions[i + 1];\n        wallPositions[posIndex++] = topPositions[i + 2];\n        wallPositions[posIndex++] = bottomPositions[i];\n        wallPositions[posIndex++] = bottomPositions[i + 1];\n        wallPositions[posIndex] = bottomPositions[i + 2];\n        return wallPositions;\n    }\n\n    function addWallTextureCoordinates(wallTextures, stIndex, i, st) {\n        wallTextures[stIndex++] = st[i];\n        wallTextures[stIndex++] = st[i + 1];\n        wallTextures[stIndex++] = st[i];\n        wallTextures[stIndex] = st[i + 1];\n        return wallTextures;\n    }\n\n    var scratchVertexFormat = new VertexFormat();\n\n    function constructExtrudedRectangle(rectangleGeometry, computedOptions) {\n        var shadowVolume = rectangleGeometry._shadowVolume;\n        var offsetAttributeValue = rectangleGeometry._offsetAttribute;\n        var vertexFormat = rectangleGeometry._vertexFormat;\n        var minHeight = rectangleGeometry._extrudedHeight;\n        var maxHeight = rectangleGeometry._surfaceHeight;\n        var ellipsoid = rectangleGeometry._ellipsoid;\n\n        var height = computedOptions.height;\n        var width = computedOptions.width;\n\n        var i;\n\n        if (shadowVolume) {\n            var newVertexFormat = VertexFormat.clone(vertexFormat, scratchVertexFormat);\n            newVertexFormat.normal = true;\n            rectangleGeometry._vertexFormat = newVertexFormat;\n        }\n\n        var topBottomGeo = constructRectangle(rectangleGeometry, computedOptions);\n\n        if (shadowVolume) {\n            rectangleGeometry._vertexFormat = vertexFormat;\n        }\n\n        var topPositions = PolygonPipeline.scaleToGeodeticHeight(topBottomGeo.attributes.position.values, maxHeight, ellipsoid, false);\n        topPositions = new Float64Array(topPositions);\n        var length = topPositions.length;\n        var newLength = length * 2;\n        var positions = new Float64Array(newLength);\n        positions.set(topPositions);\n        var bottomPositions = PolygonPipeline.scaleToGeodeticHeight(topBottomGeo.attributes.position.values, minHeight, ellipsoid);\n        positions.set(bottomPositions, length);\n        topBottomGeo.attributes.position.values = positions;\n\n        var normals = (vertexFormat.normal) ? new Float32Array(newLength) : undefined;\n        var tangents = (vertexFormat.tangent) ? new Float32Array(newLength) : undefined;\n        var bitangents = (vertexFormat.bitangent) ? new Float32Array(newLength) : undefined;\n        var textures = (vertexFormat.st) ? new Float32Array(newLength / 3 * 2) : undefined;\n        var topSt;\n        var topNormals;\n        if (vertexFormat.normal) {\n            topNormals = topBottomGeo.attributes.normal.values;\n            normals.set(topNormals);\n            for (i = 0; i < length; i++) {\n                topNormals[i] = -topNormals[i];\n            }\n            normals.set(topNormals, length);\n            topBottomGeo.attributes.normal.values = normals;\n        }\n        if (shadowVolume) {\n            topNormals = topBottomGeo.attributes.normal.values;\n            if (!vertexFormat.normal) {\n                topBottomGeo.attributes.normal = undefined;\n            }\n            var extrudeNormals = new Float32Array(newLength);\n            for (i = 0; i < length; i++) {\n                topNormals[i] = -topNormals[i];\n            }\n            extrudeNormals.set(topNormals, length); //only get normals for bottom layer that's going to be pushed down\n            topBottomGeo.attributes.extrudeDirection = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : extrudeNormals\n            });\n        }\n\n        var offsetValue;\n        var hasOffsets = defined(offsetAttributeValue);\n        if (hasOffsets) {\n            var size = length / 3 * 2;\n            var offsetAttribute = new Uint8Array(size);\n            if (offsetAttributeValue === GeometryOffsetAttribute.TOP) {\n                offsetAttribute = arrayFill(offsetAttribute, 1, 0, size / 2);\n            } else {\n                offsetValue = offsetAttributeValue === GeometryOffsetAttribute.NONE ? 0 : 1;\n                offsetAttribute = arrayFill(offsetAttribute, offsetValue);\n            }\n\n            topBottomGeo.attributes.applyOffset = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                componentsPerAttribute : 1,\n                values : offsetAttribute\n            });\n        }\n\n        if (vertexFormat.tangent) {\n            var topTangents = topBottomGeo.attributes.tangent.values;\n            tangents.set(topTangents);\n            for (i = 0; i < length; i++) {\n                topTangents[i] = -topTangents[i];\n            }\n            tangents.set(topTangents, length);\n            topBottomGeo.attributes.tangent.values = tangents;\n        }\n        if (vertexFormat.bitangent) {\n            var topBitangents = topBottomGeo.attributes.bitangent.values;\n            bitangents.set(topBitangents);\n            bitangents.set(topBitangents, length);\n            topBottomGeo.attributes.bitangent.values = bitangents;\n        }\n        if (vertexFormat.st) {\n            topSt = topBottomGeo.attributes.st.values;\n            textures.set(topSt);\n            textures.set(topSt, length / 3 * 2);\n            topBottomGeo.attributes.st.values = textures;\n        }\n\n        var indices = topBottomGeo.indices;\n        var indicesLength = indices.length;\n        var posLength = length / 3;\n        var newIndices = IndexDatatype.createTypedArray(newLength / 3, indicesLength * 2);\n        newIndices.set(indices);\n        for (i = 0; i < indicesLength; i += 3) {\n            newIndices[i + indicesLength] = indices[i + 2] + posLength;\n            newIndices[i + 1 + indicesLength] = indices[i + 1] + posLength;\n            newIndices[i + 2 + indicesLength] = indices[i] + posLength;\n        }\n        topBottomGeo.indices = newIndices;\n\n        var northCap = computedOptions.northCap;\n        var southCap = computedOptions.southCap;\n\n        var rowHeight = height;\n        var widthMultiplier = 2;\n        var perimeterPositions = 0;\n        var corners = 4;\n        var dupliateCorners = 4;\n        if (northCap) {\n            widthMultiplier -= 1;\n            rowHeight -= 1;\n            perimeterPositions += 1;\n            corners -= 2;\n            dupliateCorners -= 1;\n        }\n        if (southCap) {\n            widthMultiplier -= 1;\n            rowHeight -= 1;\n            perimeterPositions += 1;\n            corners -= 2;\n            dupliateCorners -= 1;\n        }\n        perimeterPositions += (widthMultiplier * width + 2 * rowHeight - corners);\n\n        var wallCount = (perimeterPositions + dupliateCorners) * 2;\n\n        var wallPositions = new Float64Array(wallCount * 3);\n        var wallExtrudeNormals = shadowVolume ? new Float32Array(wallCount * 3) : undefined;\n        var wallOffsetAttribute = hasOffsets ? new Uint8Array(wallCount) : undefined;\n        var wallTextures = (vertexFormat.st) ? new Float32Array(wallCount * 2) : undefined;\n\n        var computeTopOffsets = offsetAttributeValue === GeometryOffsetAttribute.TOP;\n        if (hasOffsets && !computeTopOffsets) {\n            offsetValue = offsetAttributeValue === GeometryOffsetAttribute.ALL ? 1 : 0;\n            wallOffsetAttribute = arrayFill(wallOffsetAttribute, offsetValue);\n        }\n\n        var posIndex = 0;\n        var stIndex = 0;\n        var extrudeNormalIndex = 0;\n        var wallOffsetIndex = 0;\n        var area = width * rowHeight;\n        var threeI;\n        for (i = 0; i < area; i += width) {\n            threeI = i * 3;\n            wallPositions = addWallPositions(wallPositions, posIndex, threeI, topPositions, bottomPositions);\n            posIndex += 6;\n            if (vertexFormat.st) {\n                wallTextures = addWallTextureCoordinates(wallTextures, stIndex, i * 2, topSt);\n                stIndex += 4;\n            }\n            if (shadowVolume) {\n                extrudeNormalIndex += 3;\n                wallExtrudeNormals[extrudeNormalIndex++] = topNormals[threeI];\n                wallExtrudeNormals[extrudeNormalIndex++] = topNormals[threeI + 1];\n                wallExtrudeNormals[extrudeNormalIndex++] = topNormals[threeI + 2];\n            }\n            if (computeTopOffsets) {\n                wallOffsetAttribute[wallOffsetIndex++] = 1;\n                wallOffsetIndex += 1;\n            }\n        }\n\n        if (!southCap) {\n            for (i = area - width; i < area; i++) {\n                threeI = i * 3;\n                wallPositions = addWallPositions(wallPositions, posIndex, threeI, topPositions, bottomPositions);\n                posIndex += 6;\n                if (vertexFormat.st) {\n                    wallTextures = addWallTextureCoordinates(wallTextures, stIndex, i * 2, topSt);\n                    stIndex += 4;\n                }\n                if (shadowVolume) {\n                    extrudeNormalIndex += 3;\n                    wallExtrudeNormals[extrudeNormalIndex++] = topNormals[threeI];\n                    wallExtrudeNormals[extrudeNormalIndex++] = topNormals[threeI + 1];\n                    wallExtrudeNormals[extrudeNormalIndex++] = topNormals[threeI + 2];\n                }\n                if (computeTopOffsets) {\n                    wallOffsetAttribute[wallOffsetIndex++] = 1;\n                    wallOffsetIndex += 1;\n                }\n            }\n        } else {\n            var southIndex = northCap ? area + 1 : area;\n            threeI = southIndex * 3;\n\n            for (i = 0; i < 2; i++) { // duplicate corner points\n                wallPositions = addWallPositions(wallPositions, posIndex, threeI, topPositions, bottomPositions);\n                posIndex += 6;\n                if (vertexFormat.st) {\n                    wallTextures = addWallTextureCoordinates(wallTextures, stIndex, southIndex * 2, topSt);\n                    stIndex += 4;\n                }\n                if (shadowVolume) {\n                    extrudeNormalIndex += 3;\n                    wallExtrudeNormals[extrudeNormalIndex++] = topNormals[threeI];\n                    wallExtrudeNormals[extrudeNormalIndex++] = topNormals[threeI + 1];\n                    wallExtrudeNormals[extrudeNormalIndex++] = topNormals[threeI + 2];\n                }\n                if (computeTopOffsets) {\n                    wallOffsetAttribute[wallOffsetIndex++] = 1;\n                    wallOffsetIndex += 1;\n                }\n            }\n        }\n\n        for (i = area - 1; i > 0; i -= width) {\n            threeI = i * 3;\n            wallPositions = addWallPositions(wallPositions, posIndex, threeI, topPositions, bottomPositions);\n            posIndex += 6;\n            if (vertexFormat.st) {\n                wallTextures = addWallTextureCoordinates(wallTextures, stIndex, i * 2, topSt);\n                stIndex += 4;\n            }\n            if (shadowVolume) {\n                extrudeNormalIndex += 3;\n                wallExtrudeNormals[extrudeNormalIndex++] = topNormals[threeI];\n                wallExtrudeNormals[extrudeNormalIndex++] = topNormals[threeI + 1];\n                wallExtrudeNormals[extrudeNormalIndex++] = topNormals[threeI + 2];\n            }\n            if (computeTopOffsets) {\n                wallOffsetAttribute[wallOffsetIndex++] = 1;\n                wallOffsetIndex += 1;\n            }\n\n        }\n\n        if (!northCap) {\n            for (i = width - 1; i >= 0; i--) {\n                threeI = i * 3;\n                wallPositions = addWallPositions(wallPositions, posIndex, threeI, topPositions, bottomPositions);\n                posIndex += 6;\n                if (vertexFormat.st) {\n                    wallTextures = addWallTextureCoordinates(wallTextures, stIndex, i * 2, topSt);\n                    stIndex += 4;\n                }\n                if (shadowVolume) {\n                    extrudeNormalIndex += 3;\n                    wallExtrudeNormals[extrudeNormalIndex++] = topNormals[threeI];\n                    wallExtrudeNormals[extrudeNormalIndex++] = topNormals[threeI + 1];\n                    wallExtrudeNormals[extrudeNormalIndex++] = topNormals[threeI + 2];\n                }\n                if (computeTopOffsets) {\n                    wallOffsetAttribute[wallOffsetIndex++] = 1;\n                    wallOffsetIndex += 1;\n                }\n            }\n        } else {\n            var northIndex = area;\n            threeI = northIndex * 3;\n\n            for (i = 0; i < 2; i++) { // duplicate corner points\n                wallPositions = addWallPositions(wallPositions, posIndex, threeI, topPositions, bottomPositions);\n                posIndex += 6;\n                if (vertexFormat.st) {\n                    wallTextures = addWallTextureCoordinates(wallTextures, stIndex, northIndex * 2, topSt);\n                    stIndex += 4;\n                }\n                if (shadowVolume) {\n                    extrudeNormalIndex += 3;\n                    wallExtrudeNormals[extrudeNormalIndex++] = topNormals[threeI];\n                    wallExtrudeNormals[extrudeNormalIndex++] = topNormals[threeI + 1];\n                    wallExtrudeNormals[extrudeNormalIndex++] = topNormals[threeI + 2];\n                }\n                if (computeTopOffsets) {\n                    wallOffsetAttribute[wallOffsetIndex++] = 1;\n                    wallOffsetIndex += 1;\n                }\n            }\n        }\n\n        var geo = calculateAttributesWall(wallPositions, vertexFormat, ellipsoid);\n\n        if (vertexFormat.st) {\n            geo.attributes.st = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 2,\n                values : wallTextures\n            });\n        }\n        if (shadowVolume) {\n            geo.attributes.extrudeDirection = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : wallExtrudeNormals\n            });\n        }\n        if (hasOffsets) {\n            geo.attributes.applyOffset = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                componentsPerAttribute : 1,\n                values : wallOffsetAttribute\n            });\n        }\n\n        var wallIndices = IndexDatatype.createTypedArray(wallCount, perimeterPositions * 6);\n\n        var upperLeft;\n        var lowerLeft;\n        var lowerRight;\n        var upperRight;\n        length = wallPositions.length / 3;\n        var index = 0;\n        for (i = 0; i < length - 1; i += 2) {\n            upperLeft = i;\n            upperRight = (upperLeft + 2) % length;\n            var p1 = Cartesian3.fromArray(wallPositions, upperLeft * 3, v1Scratch);\n            var p2 = Cartesian3.fromArray(wallPositions, upperRight * 3, v2Scratch);\n            if (Cartesian3.equalsEpsilon(p1, p2, CesiumMath.EPSILON10)) {\n                continue;\n            }\n            lowerLeft = (upperLeft + 1) % length;\n            lowerRight = (lowerLeft + 2) % length;\n            wallIndices[index++] = upperLeft;\n            wallIndices[index++] = lowerLeft;\n            wallIndices[index++] = upperRight;\n            wallIndices[index++] = upperRight;\n            wallIndices[index++] = lowerLeft;\n            wallIndices[index++] = lowerRight;\n        }\n\n        geo.indices = wallIndices;\n\n        geo = GeometryPipeline.combineInstances([\n            new GeometryInstance({\n                geometry : topBottomGeo\n            }),\n            new GeometryInstance({\n                geometry : geo\n            })\n        ]);\n\n        return geo[0];\n    }\n\n    var scratchRectanglePoints = [new Cartesian3(), new Cartesian3(), new Cartesian3(), new Cartesian3()];\n    var nwScratch = new Cartographic();\n    var stNwScratch = new Cartographic();\n    function computeRectangle(rectangle, granularity, rotation, ellipsoid, result) {\n        if (rotation === 0.0) {\n            return Rectangle.clone(rectangle, result);\n        }\n\n        var computedOptions = RectangleGeometryLibrary.computeOptions(rectangle, granularity, rotation, 0, rectangleScratch, nwScratch);\n\n        var height = computedOptions.height;\n        var width = computedOptions.width;\n\n        var positions = scratchRectanglePoints;\n        RectangleGeometryLibrary.computePosition(computedOptions, ellipsoid, false, 0, 0, positions[0]);\n        RectangleGeometryLibrary.computePosition(computedOptions, ellipsoid, false, 0, width - 1, positions[1]);\n        RectangleGeometryLibrary.computePosition(computedOptions, ellipsoid, false, height - 1, 0, positions[2]);\n        RectangleGeometryLibrary.computePosition(computedOptions, ellipsoid, false, height - 1, width - 1, positions[3]);\n\n        return Rectangle.fromCartesianArray(positions, ellipsoid, result);\n    }\n\n    /**\n     * A description of a cartographic rectangle on an ellipsoid centered at the origin. Rectangle geometry can be rendered with both {@link Primitive} and {@link GroundPrimitive}.\n     *\n     * @alias RectangleGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Rectangle} options.rectangle A cartographic rectangle with north, south, east and west properties in radians.\n     * @param {VertexFormat} [options.vertexFormat=VertexFormat.DEFAULT] The vertex attributes to be computed.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid on which the rectangle lies.\n     * @param {Number} [options.granularity=CesiumMath.RADIANS_PER_DEGREE] The distance, in radians, between each latitude and longitude. Determines the number of positions in the buffer.\n     * @param {Number} [options.height=0.0] The distance in meters between the rectangle and the ellipsoid surface.\n     * @param {Number} [options.rotation=0.0] The rotation of the rectangle, in radians. A positive rotation is counter-clockwise.\n     * @param {Number} [options.stRotation=0.0] The rotation of the texture coordinates, in radians. A positive rotation is counter-clockwise.\n     * @param {Number} [options.extrudedHeight] The distance in meters between the rectangle's extruded face and the ellipsoid surface.\n     *\n     * @exception {DeveloperError} <code>options.rectangle.north</code> must be in the interval [<code>-Pi/2</code>, <code>Pi/2</code>].\n     * @exception {DeveloperError} <code>options.rectangle.south</code> must be in the interval [<code>-Pi/2</code>, <code>Pi/2</code>].\n     * @exception {DeveloperError} <code>options.rectangle.east</code> must be in the interval [<code>-Pi</code>, <code>Pi</code>].\n     * @exception {DeveloperError} <code>options.rectangle.west</code> must be in the interval [<code>-Pi</code>, <code>Pi</code>].\n     * @exception {DeveloperError} <code>options.rectangle.north</code> must be greater than <code>options.rectangle.south</code>.\n     *\n     * @see RectangleGeometry#createGeometry\n     *\n     * @demo {@link https://sandcastle.cesium.com/index.html?src=Rectangle.html|Cesium Sandcastle Rectangle Demo}\n     *\n     * @example\n     * // 1. create a rectangle\n     * var rectangle = new Cesium.RectangleGeometry({\n     *   ellipsoid : Cesium.Ellipsoid.WGS84,\n     *   rectangle : Cesium.Rectangle.fromDegrees(-80.0, 39.0, -74.0, 42.0),\n     *   height : 10000.0\n     * });\n     * var geometry = Cesium.RectangleGeometry.createGeometry(rectangle);\n     *\n     * // 2. create an extruded rectangle without a top\n     * var rectangle = new Cesium.RectangleGeometry({\n     *   ellipsoid : Cesium.Ellipsoid.WGS84,\n     *   rectangle : Cesium.Rectangle.fromDegrees(-80.0, 39.0, -74.0, 42.0),\n     *   height : 10000.0,\n     *   extrudedHeight: 300000\n     * });\n     * var geometry = Cesium.RectangleGeometry.createGeometry(rectangle);\n     */\n    function RectangleGeometry(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        var rectangle = options.rectangle;\n\n        \n\n        var height = defaultValue(options.height, 0.0);\n        var extrudedHeight = defaultValue(options.extrudedHeight, height);\n\n        this._rectangle = Rectangle.clone(rectangle);\n        this._granularity = defaultValue(options.granularity, CesiumMath.RADIANS_PER_DEGREE);\n        this._ellipsoid = Ellipsoid.clone(defaultValue(options.ellipsoid, Ellipsoid.WGS84));\n        this._surfaceHeight = Math.max(height, extrudedHeight);\n        this._rotation = defaultValue(options.rotation, 0.0);\n        this._stRotation = defaultValue(options.stRotation, 0.0);\n        this._vertexFormat = VertexFormat.clone(defaultValue(options.vertexFormat, VertexFormat.DEFAULT));\n        this._extrudedHeight = Math.min(height, extrudedHeight);\n        this._shadowVolume = defaultValue(options.shadowVolume, false);\n        this._workerName = 'createRectangleGeometry';\n        this._offsetAttribute = options.offsetAttribute;\n        this._rotatedRectangle = undefined;\n\n        this._textureCoordinateRotationPoints = undefined;\n    }\n\n    /**\n     * The number of elements used to pack the object into an array.\n     * @type {Number}\n     */\n    RectangleGeometry.packedLength = Rectangle.packedLength + Ellipsoid.packedLength + VertexFormat.packedLength + 7;\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {RectangleGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    RectangleGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        Rectangle.pack(value._rectangle, array, startingIndex);\n        startingIndex += Rectangle.packedLength;\n\n        Ellipsoid.pack(value._ellipsoid, array, startingIndex);\n        startingIndex += Ellipsoid.packedLength;\n\n        VertexFormat.pack(value._vertexFormat, array, startingIndex);\n        startingIndex += VertexFormat.packedLength;\n\n        array[startingIndex++] = value._granularity;\n        array[startingIndex++] = value._surfaceHeight;\n        array[startingIndex++] = value._rotation;\n        array[startingIndex++] = value._stRotation;\n        array[startingIndex++] = value._extrudedHeight;\n        array[startingIndex++] = value._shadowVolume ? 1.0 : 0.0;\n        array[startingIndex] = defaultValue(value._offsetAttribute, -1);\n\n        return array;\n    };\n\n    var scratchRectangle = new Rectangle();\n    var scratchEllipsoid = Ellipsoid.clone(Ellipsoid.UNIT_SPHERE);\n    var scratchOptions = {\n        rectangle : scratchRectangle,\n        ellipsoid : scratchEllipsoid,\n        vertexFormat : scratchVertexFormat,\n        granularity : undefined,\n        height : undefined,\n        rotation : undefined,\n        stRotation : undefined,\n        extrudedHeight : undefined,\n        shadowVolume : undefined,\n        offsetAttribute: undefined\n    };\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {RectangleGeometry} [result] The object into which to store the result.\n     * @returns {RectangleGeometry} The modified result parameter or a new RectangleGeometry instance if one was not provided.\n     */\n    RectangleGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var rectangle = Rectangle.unpack(array, startingIndex, scratchRectangle);\n        startingIndex += Rectangle.packedLength;\n\n        var ellipsoid = Ellipsoid.unpack(array, startingIndex, scratchEllipsoid);\n        startingIndex += Ellipsoid.packedLength;\n\n        var vertexFormat = VertexFormat.unpack(array, startingIndex, scratchVertexFormat);\n        startingIndex += VertexFormat.packedLength;\n\n        var granularity = array[startingIndex++];\n        var surfaceHeight = array[startingIndex++];\n        var rotation = array[startingIndex++];\n        var stRotation = array[startingIndex++];\n        var extrudedHeight = array[startingIndex++];\n        var shadowVolume = array[startingIndex++] === 1.0;\n        var offsetAttribute = array[startingIndex];\n\n        if (!defined(result)) {\n            scratchOptions.granularity = granularity;\n            scratchOptions.height = surfaceHeight;\n            scratchOptions.rotation = rotation;\n            scratchOptions.stRotation = stRotation;\n            scratchOptions.extrudedHeight = extrudedHeight;\n            scratchOptions.shadowVolume = shadowVolume;\n            scratchOptions.offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n\n            return new RectangleGeometry(scratchOptions);\n        }\n\n        result._rectangle = Rectangle.clone(rectangle, result._rectangle);\n        result._ellipsoid = Ellipsoid.clone(ellipsoid, result._ellipsoid);\n        result._vertexFormat = VertexFormat.clone(vertexFormat, result._vertexFormat);\n        result._granularity = granularity;\n        result._surfaceHeight = surfaceHeight;\n        result._rotation = rotation;\n        result._stRotation = stRotation;\n        result._extrudedHeight = extrudedHeight;\n        result._shadowVolume = shadowVolume;\n        result._offsetAttribute = offsetAttribute === -1 ? undefined : offsetAttribute;\n\n        return result;\n    };\n\n    /**\n     * Computes the bounding rectangle based on the provided options\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Rectangle} options.rectangle A cartographic rectangle with north, south, east and west properties in radians.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid on which the rectangle lies.\n     * @param {Number} [options.granularity=CesiumMath.RADIANS_PER_DEGREE] The distance, in radians, between each latitude and longitude. Determines the number of positions in the buffer.\n     * @param {Number} [options.rotation=0.0] The rotation of the rectangle, in radians. A positive rotation is counter-clockwise.\n     * @param {Rectangle} [result] An object in which to store the result.\n     *\n     * @returns {Rectangle} The result rectangle\n     */\n    RectangleGeometry.computeRectangle = function(options, result) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        var rectangle = options.rectangle;\n\n        \n\n        var granularity = defaultValue(options.granularity, CesiumMath.RADIANS_PER_DEGREE);\n        var ellipsoid = defaultValue(options.ellipsoid, Ellipsoid.WGS84);\n        var rotation = defaultValue(options.rotation, 0.0);\n\n        return computeRectangle(rectangle, granularity, rotation, ellipsoid, result);\n    };\n\n    var tangentRotationMatrixScratch = new Matrix3();\n    var quaternionScratch = new Quaternion();\n    var centerScratch = new Cartographic();\n    /**\n     * Computes the geometric representation of a rectangle, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {RectangleGeometry} rectangleGeometry A description of the rectangle.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     *\n     * @exception {DeveloperError} Rotated rectangle is invalid.\n     */\n    RectangleGeometry.createGeometry = function(rectangleGeometry) {\n        if ((CesiumMath.equalsEpsilon(rectangleGeometry._rectangle.north, rectangleGeometry._rectangle.south, CesiumMath.EPSILON10) ||\n             (CesiumMath.equalsEpsilon(rectangleGeometry._rectangle.east, rectangleGeometry._rectangle.west, CesiumMath.EPSILON10)))) {\n            return undefined;\n        }\n\n        var rectangle = rectangleGeometry._rectangle;\n        var ellipsoid = rectangleGeometry._ellipsoid;\n        var rotation = rectangleGeometry._rotation;\n        var stRotation = rectangleGeometry._stRotation;\n        var vertexFormat = rectangleGeometry._vertexFormat;\n\n        var computedOptions = RectangleGeometryLibrary.computeOptions(rectangle, rectangleGeometry._granularity, rotation, stRotation, rectangleScratch, nwScratch, stNwScratch);\n\n        var tangentRotationMatrix = tangentRotationMatrixScratch;\n        if (stRotation !== 0 || rotation !== 0) {\n            var center = Rectangle.center(rectangle, centerScratch);\n            var axis = ellipsoid.geodeticSurfaceNormalCartographic(center, v1Scratch);\n            Quaternion.fromAxisAngle(axis, -stRotation, quaternionScratch);\n            Matrix3.fromQuaternion(quaternionScratch, tangentRotationMatrix);\n        } else {\n            Matrix3.clone(Matrix3.IDENTITY, tangentRotationMatrix);\n        }\n\n        var surfaceHeight = rectangleGeometry._surfaceHeight;\n        var extrudedHeight = rectangleGeometry._extrudedHeight;\n        var extrude = !CesiumMath.equalsEpsilon(surfaceHeight, extrudedHeight, 0, CesiumMath.EPSILON2);\n\n        computedOptions.lonScalar = 1.0 / rectangleGeometry._rectangle.width;\n        computedOptions.latScalar = 1.0 / rectangleGeometry._rectangle.height;\n        computedOptions.tangentRotationMatrix = tangentRotationMatrix;\n\n        var geometry;\n        var boundingSphere;\n        rectangle = rectangleGeometry._rectangle;\n        if (extrude) {\n            geometry = constructExtrudedRectangle(rectangleGeometry, computedOptions);\n            var topBS = BoundingSphere.fromRectangle3D(rectangle, ellipsoid, surfaceHeight, topBoundingSphere);\n            var bottomBS = BoundingSphere.fromRectangle3D(rectangle, ellipsoid, extrudedHeight, bottomBoundingSphere);\n            boundingSphere = BoundingSphere.union(topBS, bottomBS);\n        } else {\n            geometry = constructRectangle(rectangleGeometry, computedOptions);\n            geometry.attributes.position.values = PolygonPipeline.scaleToGeodeticHeight(geometry.attributes.position.values, surfaceHeight, ellipsoid, false);\n\n            if (defined(rectangleGeometry._offsetAttribute)) {\n                var length = geometry.attributes.position.values.length;\n                var applyOffset = new Uint8Array(length / 3);\n                var offsetValue = rectangleGeometry._offsetAttribute === GeometryOffsetAttribute.NONE ? 0 : 1;\n                arrayFill(applyOffset, offsetValue);\n                geometry.attributes.applyOffset = new GeometryAttribute({\n                    componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                    componentsPerAttribute : 1,\n                    values: applyOffset\n                });\n            }\n\n            boundingSphere = BoundingSphere.fromRectangle3D(rectangle, ellipsoid, surfaceHeight);\n        }\n\n        if (!vertexFormat.position) {\n            delete geometry.attributes.position;\n        }\n\n        return new Geometry({\n            attributes : geometry.attributes,\n            indices : geometry.indices,\n            primitiveType : geometry.primitiveType,\n            boundingSphere : boundingSphere,\n            offsetAttribute : rectangleGeometry._offsetAttribute\n        });\n    };\n\n    /**\n     * @private\n     */\n    RectangleGeometry.createShadowVolume = function(rectangleGeometry, minHeightFunc, maxHeightFunc) {\n        var granularity = rectangleGeometry._granularity;\n        var ellipsoid = rectangleGeometry._ellipsoid;\n\n        var minHeight = minHeightFunc(granularity, ellipsoid);\n        var maxHeight = maxHeightFunc(granularity, ellipsoid);\n\n        return new RectangleGeometry({\n            rectangle : rectangleGeometry._rectangle,\n            rotation : rectangleGeometry._rotation,\n            ellipsoid : ellipsoid,\n            stRotation : rectangleGeometry._stRotation,\n            granularity : granularity,\n            extrudedHeight : maxHeight,\n            height : minHeight,\n            vertexFormat : VertexFormat.POSITION_ONLY,\n            shadowVolume : true\n        });\n    };\n\n    var unrotatedTextureRectangleScratch = new Rectangle();\n    var points2DScratch = [new Cartesian2(), new Cartesian2(), new Cartesian2()];\n    var rotation2DScratch = new Matrix2();\n    var rectangleCenterScratch = new Cartographic();\n\n    function textureCoordinateRotationPoints(rectangleGeometry) {\n        if (rectangleGeometry._stRotation === 0.0) {\n            return [0, 0, 0, 1, 1, 0];\n        }\n\n        var rectangle = Rectangle.clone(rectangleGeometry._rectangle, unrotatedTextureRectangleScratch);\n        var granularity = rectangleGeometry._granularity;\n        var ellipsoid = rectangleGeometry._ellipsoid;\n\n        // Rotate to align the texture coordinates with ENU\n        var rotation = rectangleGeometry._rotation - rectangleGeometry._stRotation;\n\n        var unrotatedTextureRectangle = computeRectangle(rectangle, granularity, rotation, ellipsoid, unrotatedTextureRectangleScratch);\n\n        // Assume a computed \"east-north\" texture coordinate system based on spherical or planar tricks, bounded by `boundingRectangle`.\n        // The \"desired\" texture coordinate system forms an oriented rectangle (un-oriented computed) around the geometry that completely and tightly bounds it.\n        // We want to map from the \"east-north\" texture coordinate system into the \"desired\" system using a pair of lines (analagous planes in 2D)\n        // Compute 3 corners of the \"desired\" texture coordinate system in \"east-north\" texture space by the following in cartographic space:\n        // - rotate 3 of the corners in unrotatedTextureRectangle by stRotation around the center of the bounding rectangle\n        // - apply the \"east-north\" system's normalization formula to the rotated cartographics, even though this is likely to produce values outside [0-1].\n        // This gives us a set of points in the \"east-north\" texture coordinate system that can be used to map \"east-north\" texture coordinates to \"desired.\"\n\n        var points2D = points2DScratch;\n        points2D[0].x = unrotatedTextureRectangle.west;\n        points2D[0].y = unrotatedTextureRectangle.south;\n\n        points2D[1].x = unrotatedTextureRectangle.west;\n        points2D[1].y = unrotatedTextureRectangle.north;\n\n        points2D[2].x = unrotatedTextureRectangle.east;\n        points2D[2].y = unrotatedTextureRectangle.south;\n\n        var boundingRectangle = rectangleGeometry.rectangle;\n        var toDesiredInComputed = Matrix2.fromRotation(rectangleGeometry._stRotation, rotation2DScratch);\n        var boundingRectangleCenter = Rectangle.center(boundingRectangle, rectangleCenterScratch);\n\n        for (var i = 0; i < 3; ++i) {\n            var point2D = points2D[i];\n            point2D.x -= boundingRectangleCenter.longitude;\n            point2D.y -= boundingRectangleCenter.latitude;\n            Matrix2.multiplyByVector(toDesiredInComputed, point2D, point2D);\n            point2D.x += boundingRectangleCenter.longitude;\n            point2D.y += boundingRectangleCenter.latitude;\n\n            // Convert point into east-north texture coordinate space\n            point2D.x = (point2D.x - boundingRectangle.west) / boundingRectangle.width;\n            point2D.y = (point2D.y - boundingRectangle.south) / boundingRectangle.height;\n        }\n\n        var minXYCorner = points2D[0];\n        var maxYCorner = points2D[1];\n        var maxXCorner = points2D[2];\n        var result = new Array(6);\n        Cartesian2.pack(minXYCorner, result);\n        Cartesian2.pack(maxYCorner, result, 2);\n        Cartesian2.pack(maxXCorner, result, 4);\n        return result;\n    }\n\n    Object.defineProperties(RectangleGeometry.prototype, {\n        /**\n         * @private\n         */\n        rectangle : {\n            get : function() {\n                if (!defined(this._rotatedRectangle)) {\n                    this._rotatedRectangle = computeRectangle(this._rectangle, this._granularity, this._rotation, this._ellipsoid);\n                }\n                return this._rotatedRectangle;\n            }\n        },\n        /**\n         * For remapping texture coordinates when rendering RectangleGeometries as GroundPrimitives.\n         * This version permits skew in textures by computing offsets directly in cartographic space and\n         * more accurately approximates rendering RectangleGeometries with height as standard Primitives.\n         * @see Geometry#_textureCoordinateRotationPoints\n         * @private\n         */\n        textureCoordinateRotationPoints : {\n            get : function() {\n                if (!defined(this._textureCoordinateRotationPoints)) {\n                    this._textureCoordinateRotationPoints = textureCoordinateRotationPoints(this);\n                }\n                return this._textureCoordinateRotationPoints;\n            }\n        }\n    });\nexport default RectangleGeometry;\n","import ApproximateTerrainHeights from '../Core/ApproximateTerrainHeights.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Cartographic from '../Core/Cartographic.js';\nimport Check from '../Core/Check.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport DistanceDisplayConditionGeometryInstanceAttribute from '../Core/DistanceDisplayConditionGeometryInstanceAttribute.js';\nimport Ellipsoid from '../Core/Ellipsoid.js';\nimport GeometryInstance from '../Core/GeometryInstance.js';\nimport Iso8601 from '../Core/Iso8601.js';\nimport OffsetGeometryInstanceAttribute from '../Core/OffsetGeometryInstanceAttribute.js';\nimport Rectangle from '../Core/Rectangle.js';\nimport RectangleGeometry from '../Core/RectangleGeometry.js';\nimport RectangleOutlineGeometry from '../Core/RectangleOutlineGeometry.js';\nimport ShowGeometryInstanceAttribute from '../Core/ShowGeometryInstanceAttribute.js';\nimport HeightReference from '../Scene/HeightReference.js';\nimport MaterialAppearance from '../Scene/MaterialAppearance.js';\nimport PerInstanceColorAppearance from '../Scene/PerInstanceColorAppearance.js';\nimport ColorMaterialProperty from './ColorMaterialProperty.js';\nimport DynamicGeometryUpdater from './DynamicGeometryUpdater.js';\nimport GeometryUpdater from './GeometryUpdater.js';\nimport GroundGeometryUpdater from './GroundGeometryUpdater.js';\nimport Property from './Property.js';\n\n    var scratchColor = new Color();\n    var defaultOffset = Cartesian3.ZERO;\n    var offsetScratch = new Cartesian3();\n    var scratchRectangle = new Rectangle();\n    var scratchCenterRect = new Rectangle();\n    var scratchCarto = new Cartographic();\n\n    function RectangleGeometryOptions(entity) {\n        this.id = entity;\n        this.vertexFormat = undefined;\n        this.rectangle = undefined;\n        this.height = undefined;\n        this.extrudedHeight = undefined;\n        this.granularity = undefined;\n        this.stRotation = undefined;\n        this.rotation = undefined;\n        this.offsetAttribute = undefined;\n    }\n\n    /**\n     * A {@link GeometryUpdater} for rectangles.\n     * Clients do not normally create this class directly, but instead rely on {@link DataSourceDisplay}.\n     * @alias RectangleGeometryUpdater\n     * @constructor\n     *\n     * @param {Entity} entity The entity containing the geometry to be visualized.\n     * @param {Scene} scene The scene where visualization is taking place.\n     */\n    function RectangleGeometryUpdater(entity, scene) {\n        GroundGeometryUpdater.call(this, {\n            entity : entity,\n            scene : scene,\n            geometryOptions : new RectangleGeometryOptions(entity),\n            geometryPropertyName : 'rectangle',\n            observedPropertyNames : ['availability', 'rectangle']\n        });\n\n        this._onEntityPropertyChanged(entity, 'rectangle', entity.rectangle, undefined);\n    }\n\n    if (defined(Object.create)) {\n        RectangleGeometryUpdater.prototype = Object.create(GroundGeometryUpdater.prototype);\n        RectangleGeometryUpdater.prototype.constructor = RectangleGeometryUpdater;\n    }\n\n    /**\n     * Creates the geometry instance which represents the fill of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the filled portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent a filled geometry.\n     */\n    RectangleGeometryUpdater.prototype.createFillGeometryInstance = function(time) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n\n        var attributes = {\n            show : new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._fillProperty.getValue(time)),\n            distanceDisplayCondition : DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(time)),\n            offset : undefined,\n            color : undefined\n        };\n\n        if (this._materialProperty instanceof ColorMaterialProperty) {\n            var currentColor;\n            if (defined(this._materialProperty.color) && (this._materialProperty.color.isConstant || isAvailable)) {\n                currentColor = this._materialProperty.color.getValue(time, scratchColor);\n            }\n            if (!defined(currentColor)) {\n                currentColor = Color.WHITE;\n            }\n            attributes.color = ColorGeometryInstanceAttribute.fromColor(currentColor);\n        }\n        if (defined(this._options.offsetAttribute)) {\n            attributes.offset = OffsetGeometryInstanceAttribute.fromCartesian3(Property.getValueOrDefault(this._terrainOffsetProperty, time, defaultOffset, offsetScratch));\n        }\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : new RectangleGeometry(this._options),\n            attributes : attributes\n        });\n    };\n\n    /**\n     * Creates the geometry instance which represents the outline of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the outline portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent an outlined geometry.\n     */\n    RectangleGeometryUpdater.prototype.createOutlineGeometryInstance = function(time) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n        var outlineColor = Property.getValueOrDefault(this._outlineColorProperty, time, Color.BLACK, scratchColor);\n        var distanceDisplayCondition = this._distanceDisplayConditionProperty.getValue(time);\n\n        var attributes = {\n            show : new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._showOutlineProperty.getValue(time)),\n            color : ColorGeometryInstanceAttribute.fromColor(outlineColor),\n            distanceDisplayCondition : DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(distanceDisplayCondition),\n            offset : undefined\n        };\n\n        if (defined(this._options.offsetAttribute)) {\n            attributes.offset = OffsetGeometryInstanceAttribute.fromCartesian3(Property.getValueOrDefault(this._terrainOffsetProperty, time, defaultOffset, offsetScratch));\n        }\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : new RectangleOutlineGeometry(this._options),\n            attributes : attributes\n        });\n    };\n\n    RectangleGeometryUpdater.prototype._computeCenter = function(time, result) {\n        var rect = Property.getValueOrUndefined(this._entity.rectangle.coordinates, time, scratchCenterRect);\n        if (!defined(rect)) {\n            return;\n        }\n        var center = Rectangle.center(rect, scratchCarto);\n        return Cartographic.toCartesian(center, Ellipsoid.WGS84, result);\n    };\n\n    RectangleGeometryUpdater.prototype._isHidden = function(entity, rectangle) {\n        return !defined(rectangle.coordinates) || GeometryUpdater.prototype._isHidden.call(this, entity, rectangle);\n    };\n\n    RectangleGeometryUpdater.prototype._isDynamic = function(entity, rectangle) {\n        return !rectangle.coordinates.isConstant || //\n               !Property.isConstant(rectangle.height) || //\n               !Property.isConstant(rectangle.extrudedHeight) || //\n               !Property.isConstant(rectangle.granularity) || //\n               !Property.isConstant(rectangle.stRotation) || //\n               !Property.isConstant(rectangle.rotation) || //\n               !Property.isConstant(rectangle.outlineWidth) || //\n               !Property.isConstant(rectangle.zIndex) || //\n               (this._onTerrain && !Property.isConstant(this._materialProperty) && !(this._materialProperty instanceof ColorMaterialProperty));\n    };\n\n    RectangleGeometryUpdater.prototype._setStaticOptions = function(entity, rectangle) {\n        var isColorMaterial = this._materialProperty instanceof ColorMaterialProperty;\n\n        var heightValue = Property.getValueOrUndefined(rectangle.height, Iso8601.MINIMUM_VALUE);\n        var heightReferenceValue = Property.getValueOrDefault(rectangle.heightReference, Iso8601.MINIMUM_VALUE, HeightReference.NONE);\n        var extrudedHeightValue = Property.getValueOrUndefined(rectangle.extrudedHeight, Iso8601.MINIMUM_VALUE);\n        var extrudedHeightReferenceValue = Property.getValueOrDefault(rectangle.extrudedHeightReference, Iso8601.MINIMUM_VALUE, HeightReference.NONE);\n        if (defined(extrudedHeightValue) && !defined(heightValue)) {\n            heightValue = 0;\n        }\n\n        var options = this._options;\n        options.vertexFormat = isColorMaterial ? PerInstanceColorAppearance.VERTEX_FORMAT : MaterialAppearance.MaterialSupport.TEXTURED.vertexFormat;\n        options.rectangle = rectangle.coordinates.getValue(Iso8601.MINIMUM_VALUE, options.rectangle);\n        options.granularity = Property.getValueOrUndefined(rectangle.granularity, Iso8601.MINIMUM_VALUE);\n        options.stRotation = Property.getValueOrUndefined(rectangle.stRotation, Iso8601.MINIMUM_VALUE);\n        options.rotation = Property.getValueOrUndefined(rectangle.rotation, Iso8601.MINIMUM_VALUE);\n        options.offsetAttribute = GroundGeometryUpdater.computeGeometryOffsetAttribute(heightValue, heightReferenceValue, extrudedHeightValue, extrudedHeightReferenceValue);\n        options.height = GroundGeometryUpdater.getGeometryHeight(heightValue, heightReferenceValue);\n\n        extrudedHeightValue = GroundGeometryUpdater.getGeometryExtrudedHeight(extrudedHeightValue, extrudedHeightReferenceValue);\n        if (extrudedHeightValue === GroundGeometryUpdater.CLAMP_TO_GROUND) {\n            extrudedHeightValue = ApproximateTerrainHeights.getMinimumMaximumHeights(RectangleGeometry.computeRectangle(options, scratchRectangle)).minimumTerrainHeight;\n        }\n\n        options.extrudedHeight = extrudedHeightValue;\n    };\n\n    RectangleGeometryUpdater.DynamicGeometryUpdater = DynamicRectangleGeometryUpdater;\n\n    /**\n     * @private\n     */\n    function DynamicRectangleGeometryUpdater(geometryUpdater, primitives, groundPrimitives) {\n        DynamicGeometryUpdater.call(this, geometryUpdater, primitives, groundPrimitives);\n    }\n\n    if (defined(Object.create)) {\n        DynamicRectangleGeometryUpdater.prototype = Object.create(DynamicGeometryUpdater.prototype);\n        DynamicRectangleGeometryUpdater.prototype.constructor = DynamicRectangleGeometryUpdater;\n    }\n\n    DynamicRectangleGeometryUpdater.prototype._isHidden = function(entity, rectangle, time) {\n        return  !defined(this._options.rectangle) || DynamicGeometryUpdater.prototype._isHidden.call(this, entity, rectangle, time);\n    };\n\n    DynamicRectangleGeometryUpdater.prototype._setOptions = function(entity, rectangle, time) {\n        var options = this._options;\n        var heightValue = Property.getValueOrUndefined(rectangle.height, time);\n        var heightReferenceValue = Property.getValueOrDefault(rectangle.heightReference, time, HeightReference.NONE);\n        var extrudedHeightValue = Property.getValueOrUndefined(rectangle.extrudedHeight, time);\n        var extrudedHeightReferenceValue = Property.getValueOrDefault(rectangle.extrudedHeightReference, time, HeightReference.NONE);\n        if (defined(extrudedHeightValue) && !defined(heightValue)) {\n            heightValue = 0;\n        }\n\n        options.rectangle = Property.getValueOrUndefined(rectangle.coordinates, time, options.rectangle);\n        options.granularity = Property.getValueOrUndefined(rectangle.granularity, time);\n        options.stRotation = Property.getValueOrUndefined(rectangle.stRotation, time);\n        options.rotation = Property.getValueOrUndefined(rectangle.rotation, time);\n        options.offsetAttribute = GroundGeometryUpdater.computeGeometryOffsetAttribute(heightValue, heightReferenceValue, extrudedHeightValue, extrudedHeightReferenceValue);\n        options.height = GroundGeometryUpdater.getGeometryHeight(heightValue, heightReferenceValue);\n\n        extrudedHeightValue = GroundGeometryUpdater.getGeometryExtrudedHeight(extrudedHeightValue, extrudedHeightReferenceValue);\n        if (extrudedHeightValue === GroundGeometryUpdater.CLAMP_TO_GROUND) {\n            extrudedHeightValue = ApproximateTerrainHeights.getMinimumMaximumHeights(RectangleGeometry.computeRectangle(options, scratchRectangle)).minimumTerrainHeight;\n        }\n\n        options.extrudedHeight = extrudedHeightValue;\n    };\nexport default RectangleGeometryUpdater;\n","import AssociativeArray from '../Core/AssociativeArray.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport defined from '../Core/defined.js';\nimport DistanceDisplayCondition from '../Core/DistanceDisplayCondition.js';\nimport DistanceDisplayConditionGeometryInstanceAttribute from '../Core/DistanceDisplayConditionGeometryInstanceAttribute.js';\nimport OffsetGeometryInstanceAttribute from '../Core/OffsetGeometryInstanceAttribute.js';\nimport ShowGeometryInstanceAttribute from '../Core/ShowGeometryInstanceAttribute.js';\nimport Primitive from '../Scene/Primitive.js';\nimport BoundingSphereState from './BoundingSphereState.js';\nimport ColorMaterialProperty from './ColorMaterialProperty.js';\nimport MaterialProperty from './MaterialProperty.js';\nimport Property from './Property.js';\n\n    var colorScratch = new Color();\n    var distanceDisplayConditionScratch = new DistanceDisplayCondition();\n    var defaultDistanceDisplayCondition = new DistanceDisplayCondition();\n    var defaultOffset = Cartesian3.ZERO;\n    var offsetScratch = new Cartesian3();\n\n    function Batch(primitives, translucent, appearanceType, depthFailAppearanceType, depthFailMaterialProperty, closed, shadows) {\n        this.translucent = translucent;\n        this.appearanceType = appearanceType;\n        this.depthFailAppearanceType = depthFailAppearanceType;\n        this.depthFailMaterialProperty = depthFailMaterialProperty;\n        this.depthFailMaterial = undefined;\n        this.closed = closed;\n        this.shadows = shadows;\n        this.primitives = primitives;\n        this.createPrimitive = false;\n        this.waitingOnCreate = false;\n        this.primitive = undefined;\n        this.oldPrimitive = undefined;\n        this.geometry = new AssociativeArray();\n        this.updaters = new AssociativeArray();\n        this.updatersWithAttributes = new AssociativeArray();\n        this.attributes = new AssociativeArray();\n        this.subscriptions = new AssociativeArray();\n        this.showsUpdated = new AssociativeArray();\n        this.itemsToRemove = [];\n        this.invalidated = false;\n\n        var removeMaterialSubscription;\n        if (defined(depthFailMaterialProperty)) {\n            removeMaterialSubscription = depthFailMaterialProperty.definitionChanged.addEventListener(Batch.prototype.onMaterialChanged, this);\n        }\n        this.removeMaterialSubscription = removeMaterialSubscription;\n    }\n\n    Batch.prototype.onMaterialChanged = function() {\n        this.invalidated = true;\n    };\n\n    Batch.prototype.isMaterial = function(updater) {\n        var material = this.depthFailMaterialProperty;\n        var updaterMaterial = updater.depthFailMaterialProperty;\n        if (updaterMaterial === material) {\n            return true;\n        }\n        if (defined(material)) {\n            return material.equals(updaterMaterial);\n        }\n        return false;\n    };\n\n    Batch.prototype.add = function(updater, instance) {\n        var id = updater.id;\n        this.createPrimitive = true;\n        this.geometry.set(id, instance);\n        this.updaters.set(id, updater);\n        if (!updater.hasConstantFill || !updater.fillMaterialProperty.isConstant || !Property.isConstant(updater.distanceDisplayConditionProperty) || !Property.isConstant(updater.terrainOffsetProperty)) {\n            this.updatersWithAttributes.set(id, updater);\n        } else {\n            var that = this;\n            this.subscriptions.set(id, updater.entity.definitionChanged.addEventListener(function(entity, propertyName, newValue, oldValue) {\n                if (propertyName === 'isShowing') {\n                    that.showsUpdated.set(updater.id, updater);\n                }\n            }));\n        }\n    };\n\n    Batch.prototype.remove = function(updater) {\n        var id = updater.id;\n        this.createPrimitive = this.geometry.remove(id) || this.createPrimitive;\n        if (this.updaters.remove(id)) {\n            this.updatersWithAttributes.remove(id);\n            var unsubscribe = this.subscriptions.get(id);\n            if (defined(unsubscribe)) {\n                unsubscribe();\n                this.subscriptions.remove(id);\n                this.showsUpdated.remove(id);\n            }\n            return true;\n        }\n        return false;\n    };\n\n    Batch.prototype.update = function(time) {\n        var isUpdated = true;\n        var removedCount = 0;\n        var primitive = this.primitive;\n        var primitives = this.primitives;\n        var i;\n\n        if (this.createPrimitive) {\n            var geometries = this.geometry.values;\n            var geometriesLength = geometries.length;\n            if (geometriesLength > 0) {\n                if (defined(primitive)) {\n                    if (!defined(this.oldPrimitive)) {\n                        this.oldPrimitive = primitive;\n                    } else {\n                        primitives.remove(primitive);\n                    }\n                }\n\n                var depthFailAppearance;\n                if (defined(this.depthFailAppearanceType)) {\n                    if (defined(this.depthFailMaterialProperty)) {\n                        this.depthFailMaterial = MaterialProperty.getValue(time, this.depthFailMaterialProperty, this.depthFailMaterial);\n                    }\n                    depthFailAppearance = new this.depthFailAppearanceType({\n                        material : this.depthFailMaterial,\n                        translucent : this.translucent,\n                        closed : this.closed\n                    });\n                }\n\n                primitive = new Primitive({\n                    show : false,\n                    asynchronous : true,\n                    geometryInstances : geometries.slice(),\n                    appearance : new this.appearanceType({\n                        translucent : this.translucent,\n                        closed : this.closed\n                    }),\n                    depthFailAppearance : depthFailAppearance,\n                    shadows : this.shadows\n                });\n                primitives.add(primitive);\n                isUpdated = false;\n            } else {\n                if (defined(primitive)) {\n                    primitives.remove(primitive);\n                    primitive = undefined;\n                }\n                var oldPrimitive = this.oldPrimitive;\n                if (defined(oldPrimitive)) {\n                    primitives.remove(oldPrimitive);\n                    this.oldPrimitive = undefined;\n                }\n            }\n\n            this.attributes.removeAll();\n            this.primitive = primitive;\n            this.createPrimitive = false;\n            this.waitingOnCreate = true;\n        } else if (defined(primitive) && primitive.ready) {\n            primitive.show = true;\n            if (defined(this.oldPrimitive)) {\n                primitives.remove(this.oldPrimitive);\n                this.oldPrimitive = undefined;\n            }\n\n            if (defined(this.depthFailAppearanceType) && !(this.depthFailMaterialProperty instanceof ColorMaterialProperty)) {\n                this.depthFailMaterial = MaterialProperty.getValue(time, this.depthFailMaterialProperty, this.depthFailMaterial);\n                this.primitive.depthFailAppearance.material = this.depthFailMaterial;\n            }\n\n            var updatersWithAttributes = this.updatersWithAttributes.values;\n            var length = updatersWithAttributes.length;\n            var waitingOnCreate = this.waitingOnCreate;\n            for (i = 0; i < length; i++) {\n                var updater = updatersWithAttributes[i];\n                var instance = this.geometry.get(updater.id);\n\n                var attributes = this.attributes.get(instance.id.id);\n                if (!defined(attributes)) {\n                    attributes = primitive.getGeometryInstanceAttributes(instance.id);\n                    this.attributes.set(instance.id.id, attributes);\n                }\n\n                if (!updater.fillMaterialProperty.isConstant || waitingOnCreate) {\n                    var colorProperty = updater.fillMaterialProperty.color;\n                    var resultColor = Property.getValueOrDefault(colorProperty, time, Color.WHITE, colorScratch);\n                    if (!Color.equals(attributes._lastColor, resultColor)) {\n                        attributes._lastColor = Color.clone(resultColor, attributes._lastColor);\n                        attributes.color = ColorGeometryInstanceAttribute.toValue(resultColor, attributes.color);\n                        if ((this.translucent && attributes.color[3] === 255) || (!this.translucent && attributes.color[3] !== 255)) {\n                            this.itemsToRemove[removedCount++] = updater;\n                        }\n                    }\n                }\n\n                if (defined(this.depthFailAppearanceType) && updater.depthFailMaterialProperty instanceof ColorMaterialProperty && (!updater.depthFailMaterialProperty.isConstant || waitingOnCreate)) {\n                    var depthFailColorProperty = updater.depthFailMaterialProperty.color;\n                    var depthColor = Property.getValueOrDefault(depthFailColorProperty, time, Color.WHITE, colorScratch);\n                    if (!Color.equals(attributes._lastDepthFailColor, depthColor)) {\n                        attributes._lastDepthFailColor = Color.clone(depthColor, attributes._lastDepthFailColor);\n                        attributes.depthFailColor = ColorGeometryInstanceAttribute.toValue(depthColor, attributes.depthFailColor);\n                    }\n                }\n\n                var show = updater.entity.isShowing && (updater.hasConstantFill || updater.isFilled(time));\n                var currentShow = attributes.show[0] === 1;\n                if (show !== currentShow) {\n                    attributes.show = ShowGeometryInstanceAttribute.toValue(show, attributes.show);\n                }\n\n                var distanceDisplayConditionProperty = updater.distanceDisplayConditionProperty;\n                if (!Property.isConstant(distanceDisplayConditionProperty)) {\n                    var distanceDisplayCondition = Property.getValueOrDefault(distanceDisplayConditionProperty, time, defaultDistanceDisplayCondition, distanceDisplayConditionScratch);\n                    if (!DistanceDisplayCondition.equals(distanceDisplayCondition, attributes._lastDistanceDisplayCondition)) {\n                        attributes._lastDistanceDisplayCondition = DistanceDisplayCondition.clone(distanceDisplayCondition, attributes._lastDistanceDisplayCondition);\n                        attributes.distanceDisplayCondition = DistanceDisplayConditionGeometryInstanceAttribute.toValue(distanceDisplayCondition, attributes.distanceDisplayCondition);\n                    }\n                }\n\n                var offsetProperty = updater.terrainOffsetProperty;\n                if (!Property.isConstant(offsetProperty)) {\n                    var offset = Property.getValueOrDefault(offsetProperty, time, defaultOffset, offsetScratch);\n                    if (!Cartesian3.equals(offset, attributes._lastOffset)) {\n                        attributes._lastOffset = Cartesian3.clone(offset, attributes._lastOffset);\n                        attributes.offset = OffsetGeometryInstanceAttribute.toValue(offset, attributes.offset);\n                    }\n                }\n            }\n\n            this.updateShows(primitive);\n            this.waitingOnCreate = false;\n        } else if (defined(primitive) && !primitive.ready) {\n            isUpdated = false;\n        }\n        this.itemsToRemove.length = removedCount;\n        return isUpdated;\n    };\n\n    Batch.prototype.updateShows = function(primitive) {\n        var showsUpdated = this.showsUpdated.values;\n        var length = showsUpdated.length;\n        for (var i = 0; i < length; i++) {\n            var updater = showsUpdated[i];\n            var instance = this.geometry.get(updater.id);\n\n            var attributes = this.attributes.get(instance.id.id);\n            if (!defined(attributes)) {\n                attributes = primitive.getGeometryInstanceAttributes(instance.id);\n                this.attributes.set(instance.id.id, attributes);\n            }\n\n            var show = updater.entity.isShowing;\n            var currentShow = attributes.show[0] === 1;\n            if (show !== currentShow) {\n                attributes.show = ShowGeometryInstanceAttribute.toValue(show, attributes.show);\n                instance.attributes.show.value[0] = attributes.show[0];\n            }\n        }\n        this.showsUpdated.removeAll();\n    };\n\n    Batch.prototype.contains = function(updater) {\n        return this.updaters.contains(updater.id);\n    };\n\n    Batch.prototype.getBoundingSphere = function(updater, result) {\n        var primitive = this.primitive;\n        if (!primitive.ready) {\n            return BoundingSphereState.PENDING;\n        }\n        var attributes = primitive.getGeometryInstanceAttributes(updater.entity);\n        if (!defined(attributes) || !defined(attributes.boundingSphere) ||//\n            (defined(attributes.show) && attributes.show[0] === 0)) {\n            return BoundingSphereState.FAILED;\n        }\n        attributes.boundingSphere.clone(result);\n        return BoundingSphereState.DONE;\n    };\n\n    Batch.prototype.destroy = function() {\n        var primitive = this.primitive;\n        var primitives = this.primitives;\n        if (defined(primitive)) {\n            primitives.remove(primitive);\n        }\n        var oldPrimitive = this.oldPrimitive;\n        if (defined(oldPrimitive)) {\n            primitives.remove(oldPrimitive);\n        }\n        if (defined(this.removeMaterialSubscription)) {\n            this.removeMaterialSubscription();\n        }\n    };\n\n    /**\n     * @private\n     */\n    function StaticGeometryColorBatch(primitives, appearanceType, depthFailAppearanceType, closed, shadows) {\n        this._solidItems = [];\n        this._translucentItems = [];\n        this._primitives = primitives;\n        this._appearanceType = appearanceType;\n        this._depthFailAppearanceType = depthFailAppearanceType;\n        this._closed = closed;\n        this._shadows = shadows;\n    }\n\n    StaticGeometryColorBatch.prototype.add = function(time, updater) {\n        var items;\n        var translucent;\n        var instance = updater.createFillGeometryInstance(time);\n        if (instance.attributes.color.value[3] === 255) {\n            items = this._solidItems;\n            translucent = false;\n        } else {\n            items = this._translucentItems;\n            translucent = true;\n        }\n\n        var length = items.length;\n        for (var i = 0; i < length; i++) {\n            var item = items[i];\n            if (item.isMaterial(updater)) {\n                item.add(updater, instance);\n                return;\n            }\n        }\n        var batch = new Batch(this._primitives, translucent, this._appearanceType, this._depthFailAppearanceType, updater.depthFailMaterialProperty, this._closed, this._shadows);\n        batch.add(updater, instance);\n        items.push(batch);\n    };\n\n    function removeItem(items, updater) {\n        var length = items.length;\n        for (var i = length - 1; i >= 0; i--) {\n            var item = items[i];\n            if (item.remove(updater)) {\n                if (item.updaters.length === 0) {\n                    items.splice(i, 1);\n                    item.destroy();\n                }\n                return true;\n            }\n        }\n        return false;\n    }\n\n    StaticGeometryColorBatch.prototype.remove = function(updater) {\n        if (!removeItem(this._solidItems, updater)) {\n            removeItem(this._translucentItems, updater);\n        }\n    };\n\n    function moveItems(batch, items, time) {\n        var itemsMoved = false;\n        var length = items.length;\n        for (var i = 0; i < length; ++i) {\n            var item = items[i];\n            var itemsToRemove = item.itemsToRemove;\n            var itemsToMoveLength = itemsToRemove.length;\n            if (itemsToMoveLength > 0) {\n                for (i = 0; i < itemsToMoveLength; i++) {\n                    var updater = itemsToRemove[i];\n                    item.remove(updater);\n                    batch.add(time, updater);\n                    itemsMoved = true;\n                }\n            }\n        }\n        return itemsMoved;\n    }\n\n    function updateItems(batch, items, time, isUpdated) {\n        var length = items.length;\n        var i;\n        for (i = length - 1; i >= 0; i--) {\n            var item = items[i];\n            if (item.invalidated) {\n                items.splice(i, 1);\n                var updaters = item.updaters.values;\n                var updatersLength = updaters.length;\n                for (var h = 0; h < updatersLength; h++) {\n                    batch.add(time, updaters[h]);\n                }\n                item.destroy();\n            }\n        }\n\n        length = items.length;\n        for (i = 0; i < length; ++i) {\n            isUpdated = items[i].update(time) && isUpdated;\n        }\n        return isUpdated;\n    }\n\n    StaticGeometryColorBatch.prototype.update = function(time) {\n        //Perform initial update\n        var isUpdated = updateItems(this, this._solidItems, time, true);\n        isUpdated = updateItems(this, this._translucentItems, time, isUpdated) && isUpdated;\n\n        //If any items swapped between solid/translucent, we need to\n        //move them between batches\n        var solidsMoved = moveItems(this, this._solidItems, time);\n        var translucentsMoved = moveItems(this, this._translucentItems, time);\n\n        //If we moved anything around, we need to re-build the primitive\n        if (solidsMoved || translucentsMoved) {\n            isUpdated = updateItems(this, this._solidItems, time, isUpdated) && isUpdated;\n            isUpdated = updateItems(this, this._translucentItems, time, isUpdated)&& isUpdated;\n        }\n\n        return isUpdated;\n    };\n\n    function getBoundingSphere(items, updater, result) {\n        var length = items.length;\n        for (var i = 0; i < length; i++) {\n            var item = items[i];\n            if (item.contains(updater)){\n                return item.getBoundingSphere(updater, result);\n            }\n        }\n        return BoundingSphereState.FAILED;\n    }\n\n    StaticGeometryColorBatch.prototype.getBoundingSphere = function(updater, result) {\n        var boundingSphere = getBoundingSphere(this._solidItems, updater, result);\n        if (boundingSphere === BoundingSphereState.FAILED) {\n            return getBoundingSphere(this._translucentItems, updater, result);\n        }\n        return boundingSphere;\n    };\n\n    function removeAllPrimitives(items) {\n        var length = items.length;\n        for (var i = 0; i < length; i++) {\n            items[i].destroy();\n        }\n        items.length = 0;\n    }\n\n    StaticGeometryColorBatch.prototype.removeAllPrimitives = function() {\n        removeAllPrimitives(this._solidItems);\n        removeAllPrimitives(this._translucentItems);\n    };\nexport default StaticGeometryColorBatch;\n","import AssociativeArray from '../Core/AssociativeArray.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport defined from '../Core/defined.js';\nimport DistanceDisplayCondition from '../Core/DistanceDisplayCondition.js';\nimport DistanceDisplayConditionGeometryInstanceAttribute from '../Core/DistanceDisplayConditionGeometryInstanceAttribute.js';\nimport OffsetGeometryInstanceAttribute from '../Core/OffsetGeometryInstanceAttribute.js';\nimport ShowGeometryInstanceAttribute from '../Core/ShowGeometryInstanceAttribute.js';\nimport Primitive from '../Scene/Primitive.js';\nimport BoundingSphereState from './BoundingSphereState.js';\nimport ColorMaterialProperty from './ColorMaterialProperty.js';\nimport MaterialProperty from './MaterialProperty.js';\nimport Property from './Property.js';\n\n    var distanceDisplayConditionScratch = new DistanceDisplayCondition();\n    var defaultDistanceDisplayCondition = new DistanceDisplayCondition();\n    var defaultOffset = Cartesian3.ZERO;\n    var offsetScratch = new Cartesian3();\n\n    function Batch(primitives, appearanceType, materialProperty, depthFailAppearanceType, depthFailMaterialProperty, closed, shadows) {\n        this.primitives = primitives;\n        this.appearanceType = appearanceType;\n        this.materialProperty = materialProperty;\n        this.depthFailAppearanceType = depthFailAppearanceType;\n        this.depthFailMaterialProperty = depthFailMaterialProperty;\n        this.closed = closed;\n        this.shadows = shadows;\n        this.updaters = new AssociativeArray();\n        this.createPrimitive = true;\n        this.primitive = undefined;\n        this.oldPrimitive = undefined;\n        this.geometry = new AssociativeArray();\n        this.material = undefined;\n        this.depthFailMaterial = undefined;\n        this.updatersWithAttributes = new AssociativeArray();\n        this.attributes = new AssociativeArray();\n        this.invalidated = false;\n        this.removeMaterialSubscription = materialProperty.definitionChanged.addEventListener(Batch.prototype.onMaterialChanged, this);\n        this.subscriptions = new AssociativeArray();\n        this.showsUpdated = new AssociativeArray();\n    }\n\n    Batch.prototype.onMaterialChanged = function() {\n        this.invalidated = true;\n    };\n\n    Batch.prototype.isMaterial = function(updater) {\n        var material = this.materialProperty;\n        var updaterMaterial = updater.fillMaterialProperty;\n        var depthFailMaterial = this.depthFailMaterialProperty;\n        var updaterDepthFailMaterial = updater.depthFailMaterialProperty;\n\n        if (updaterMaterial === material && updaterDepthFailMaterial === depthFailMaterial) {\n            return true;\n        }\n        var equals = defined(material) && material.equals(updaterMaterial);\n        equals = ((!defined(depthFailMaterial) && !defined(updaterDepthFailMaterial)) || (defined(depthFailMaterial) && depthFailMaterial.equals(updaterDepthFailMaterial))) && equals;\n        return equals;\n    };\n\n    Batch.prototype.add = function(time, updater) {\n        var id = updater.id;\n        this.updaters.set(id, updater);\n        this.geometry.set(id, updater.createFillGeometryInstance(time));\n        if (!updater.hasConstantFill || !updater.fillMaterialProperty.isConstant || !Property.isConstant(updater.distanceDisplayConditionProperty)  || !Property.isConstant(updater.terrainOffsetProperty)) {\n            this.updatersWithAttributes.set(id, updater);\n        } else {\n            var that = this;\n            this.subscriptions.set(id, updater.entity.definitionChanged.addEventListener(function(entity, propertyName, newValue, oldValue) {\n                if (propertyName === 'isShowing') {\n                    that.showsUpdated.set(updater.id, updater);\n                }\n            }));\n        }\n        this.createPrimitive = true;\n    };\n\n    Batch.prototype.remove = function(updater) {\n        var id = updater.id;\n        this.createPrimitive = this.geometry.remove(id) || this.createPrimitive;\n        if (this.updaters.remove(id)) {\n            this.updatersWithAttributes.remove(id);\n            var unsubscribe = this.subscriptions.get(id);\n            if (defined(unsubscribe)) {\n                unsubscribe();\n                this.subscriptions.remove(id);\n                this.showsUpdated.remove(id);\n            }\n            return true;\n        }\n        return false;\n    };\n\n    var colorScratch = new Color();\n\n    Batch.prototype.update = function(time) {\n        var isUpdated = true;\n        var primitive = this.primitive;\n        var primitives = this.primitives;\n        var geometries = this.geometry.values;\n        var i;\n\n        if (this.createPrimitive) {\n            var geometriesLength = geometries.length;\n            if (geometriesLength > 0) {\n                if (defined(primitive)) {\n                    if (!defined(this.oldPrimitive)) {\n                        this.oldPrimitive = primitive;\n                    } else {\n                        primitives.remove(primitive);\n                    }\n                }\n\n                this.material = MaterialProperty.getValue(time, this.materialProperty, this.material);\n\n                var depthFailAppearance;\n                if (defined(this.depthFailMaterialProperty)) {\n                    this.depthFailMaterial = MaterialProperty.getValue(time, this.depthFailMaterialProperty, this.depthFailMaterial);\n                    depthFailAppearance = new this.depthFailAppearanceType({\n                        material : this.depthFailMaterial,\n                        translucent : this.depthFailMaterial.isTranslucent(),\n                        closed : this.closed\n                    });\n                }\n\n                primitive = new Primitive({\n                    show : false,\n                    asynchronous : true,\n                    geometryInstances : geometries.slice(),\n                    appearance : new this.appearanceType({\n                        material : this.material,\n                        translucent : this.material.isTranslucent(),\n                        closed : this.closed\n                    }),\n                    depthFailAppearance : depthFailAppearance,\n                    shadows : this.shadows\n                });\n\n                primitives.add(primitive);\n                isUpdated = false;\n            } else {\n                if (defined(primitive)) {\n                    primitives.remove(primitive);\n                    primitive = undefined;\n                }\n                var oldPrimitive = this.oldPrimitive;\n                if (defined(oldPrimitive)) {\n                    primitives.remove(oldPrimitive);\n                    this.oldPrimitive = undefined;\n                }\n            }\n\n            this.attributes.removeAll();\n            this.primitive = primitive;\n            this.createPrimitive = false;\n        } else if (defined(primitive) && primitive.ready) {\n            primitive.show = true;\n            if (defined(this.oldPrimitive)) {\n                primitives.remove(this.oldPrimitive);\n                this.oldPrimitive = undefined;\n            }\n\n            this.material = MaterialProperty.getValue(time, this.materialProperty, this.material);\n            this.primitive.appearance.material = this.material;\n\n            if (defined(this.depthFailAppearanceType) && !(this.depthFailMaterialProperty instanceof ColorMaterialProperty)) {\n                this.depthFailMaterial = MaterialProperty.getValue(time, this.depthFailMaterialProperty, this.depthFailMaterial);\n                this.primitive.depthFailAppearance.material = this.depthFailMaterial;\n            }\n\n            var updatersWithAttributes = this.updatersWithAttributes.values;\n            var length = updatersWithAttributes.length;\n            for (i = 0; i < length; i++) {\n                var updater = updatersWithAttributes[i];\n                var entity = updater.entity;\n                var instance = this.geometry.get(updater.id);\n\n                var attributes = this.attributes.get(instance.id.id);\n                if (!defined(attributes)) {\n                    attributes = primitive.getGeometryInstanceAttributes(instance.id);\n                    this.attributes.set(instance.id.id, attributes);\n                }\n\n                if (defined(this.depthFailAppearanceType) && this.depthFailMaterialProperty instanceof ColorMaterialProperty && !updater.depthFailMaterialProperty.isConstant) {\n                    var depthFailColorProperty = updater.depthFailMaterialProperty.color;\n                    var depthFailColor = Property.getValueOrDefault(depthFailColorProperty, time, Color.WHITE, colorScratch);\n                    if (!Color.equals(attributes._lastDepthFailColor, depthFailColor)) {\n                        attributes._lastDepthFailColor = Color.clone(depthFailColor, attributes._lastDepthFailColor);\n                        attributes.depthFailColor = ColorGeometryInstanceAttribute.toValue(depthFailColor, attributes.depthFailColor);\n                    }\n                }\n\n                var show = entity.isShowing && (updater.hasConstantFill || updater.isFilled(time));\n                var currentShow = attributes.show[0] === 1;\n                if (show !== currentShow) {\n                    attributes.show = ShowGeometryInstanceAttribute.toValue(show, attributes.show);\n                }\n\n                var distanceDisplayConditionProperty = updater.distanceDisplayConditionProperty;\n                if (!Property.isConstant(distanceDisplayConditionProperty)) {\n                    var distanceDisplayCondition = Property.getValueOrDefault(distanceDisplayConditionProperty, time, defaultDistanceDisplayCondition, distanceDisplayConditionScratch);\n                    if (!DistanceDisplayCondition.equals(distanceDisplayCondition, attributes._lastDistanceDisplayCondition)) {\n                        attributes._lastDistanceDisplayCondition = DistanceDisplayCondition.clone(distanceDisplayCondition, attributes._lastDistanceDisplayCondition);\n                        attributes.distanceDisplayCondition = DistanceDisplayConditionGeometryInstanceAttribute.toValue(distanceDisplayCondition, attributes.distanceDisplayCondition);\n                    }\n                }\n\n                var offsetProperty = updater.terrainOffsetProperty;\n                if (!Property.isConstant(offsetProperty)) {\n                    var offset = Property.getValueOrDefault(offsetProperty, time, defaultOffset, offsetScratch);\n                    if (!Cartesian3.equals(offset, attributes._lastOffset)) {\n                        attributes._lastOffset = Cartesian3.clone(offset, attributes._lastOffset);\n                        attributes.offset = OffsetGeometryInstanceAttribute.toValue(offset, attributes.offset);\n                    }\n                }\n            }\n\n            this.updateShows(primitive);\n        } else if (defined(primitive) && !primitive.ready) {\n            isUpdated = false;\n        }\n        return isUpdated;\n    };\n\n    Batch.prototype.updateShows = function(primitive) {\n        var showsUpdated = this.showsUpdated.values;\n        var length = showsUpdated.length;\n        for (var i = 0; i < length; i++) {\n            var updater = showsUpdated[i];\n            var entity = updater.entity;\n            var instance = this.geometry.get(updater.id);\n\n            var attributes = this.attributes.get(instance.id.id);\n            if (!defined(attributes)) {\n                attributes = primitive.getGeometryInstanceAttributes(instance.id);\n                this.attributes.set(instance.id.id, attributes);\n            }\n\n            var show = entity.isShowing;\n            var currentShow = attributes.show[0] === 1;\n            if (show !== currentShow) {\n                attributes.show = ShowGeometryInstanceAttribute.toValue(show, attributes.show);\n                instance.attributes.show.value[0] = attributes.show[0];\n            }\n        }\n        this.showsUpdated.removeAll();\n    };\n\n    Batch.prototype.contains = function(updater) {\n        return this.updaters.contains(updater.id);\n    };\n\n    Batch.prototype.getBoundingSphere = function(updater, result) {\n        var primitive = this.primitive;\n        if (!primitive.ready) {\n            return BoundingSphereState.PENDING;\n        }\n        var attributes = primitive.getGeometryInstanceAttributes(updater.entity);\n        if (!defined(attributes) || !defined(attributes.boundingSphere) ||\n            (defined(attributes.show) && attributes.show[0] === 0)) {\n            return BoundingSphereState.FAILED;\n        }\n        attributes.boundingSphere.clone(result);\n        return BoundingSphereState.DONE;\n    };\n\n    Batch.prototype.destroy = function() {\n        var primitive = this.primitive;\n        var primitives = this.primitives;\n        if (defined(primitive)) {\n            primitives.remove(primitive);\n        }\n        var oldPrimitive = this.oldPrimitive;\n        if (defined(oldPrimitive)) {\n            primitives.remove(oldPrimitive);\n        }\n        this.removeMaterialSubscription();\n    };\n\n    /**\n     * @private\n     */\n    function StaticGeometryPerMaterialBatch(primitives, appearanceType, depthFailAppearanceType, closed, shadows) {\n        this._items = [];\n        this._primitives = primitives;\n        this._appearanceType = appearanceType;\n        this._depthFailAppearanceType = depthFailAppearanceType;\n        this._closed = closed;\n        this._shadows = shadows;\n    }\n\n    StaticGeometryPerMaterialBatch.prototype.add = function(time, updater) {\n        var items = this._items;\n        var length = items.length;\n        for (var i = 0; i < length; i++) {\n            var item = items[i];\n            if (item.isMaterial(updater)) {\n                item.add(time, updater);\n                return;\n            }\n        }\n        var batch = new Batch(this._primitives, this._appearanceType, updater.fillMaterialProperty, this._depthFailAppearanceType, updater.depthFailMaterialProperty, this._closed, this._shadows);\n        batch.add(time, updater);\n        items.push(batch);\n    };\n\n    StaticGeometryPerMaterialBatch.prototype.remove = function(updater) {\n        var items = this._items;\n        var length = items.length;\n        for (var i = length - 1; i >= 0; i--) {\n            var item = items[i];\n            if (item.remove(updater)) {\n                if (item.updaters.length === 0) {\n                    items.splice(i, 1);\n                    item.destroy();\n                }\n                break;\n            }\n        }\n    };\n\n    StaticGeometryPerMaterialBatch.prototype.update = function(time) {\n        var i;\n        var items = this._items;\n        var length = items.length;\n\n        for (i = length - 1; i >= 0; i--) {\n            var item = items[i];\n            if (item.invalidated) {\n                items.splice(i, 1);\n                var updaters = item.updaters.values;\n                var updatersLength = updaters.length;\n                for (var h = 0; h < updatersLength; h++) {\n                    this.add(time, updaters[h]);\n                }\n                item.destroy();\n            }\n        }\n\n        var isUpdated = true;\n        for (i = 0; i < items.length; i++) {\n            isUpdated = items[i].update(time) && isUpdated;\n        }\n        return isUpdated;\n    };\n\n    StaticGeometryPerMaterialBatch.prototype.getBoundingSphere = function(updater, result) {\n        var items = this._items;\n        var length = items.length;\n        for (var i = 0; i < length; i++) {\n            var item = items[i];\n            if (item.contains(updater)){\n                return item.getBoundingSphere(updater, result);\n            }\n        }\n        return BoundingSphereState.FAILED;\n    };\n\n    StaticGeometryPerMaterialBatch.prototype.removeAllPrimitives = function() {\n        var items = this._items;\n        var length = items.length;\n        for (var i = 0; i < length; i++) {\n            items[i].destroy();\n        }\n        this._items.length = 0;\n    };\nexport default StaticGeometryPerMaterialBatch;\n","\nfunction quickselect(arr, k, left, right, compare) {\n    quickselectStep(arr, k, left || 0, right || (arr.length - 1), compare || defaultCompare);\n};\n\nfunction quickselectStep(arr, k, left, right, compare) {\n\n    while (right > left) {\n        if (right - left > 600) {\n            var n = right - left + 1;\n            var m = k - left + 1;\n            var z = Math.log(n);\n            var s = 0.5 * Math.exp(2 * z / 3);\n            var sd = 0.5 * Math.sqrt(z * s * (n - s) / n) * (m - n / 2 < 0 ? -1 : 1);\n            var newLeft = Math.max(left, Math.floor(k - m * s / n + sd));\n            var newRight = Math.min(right, Math.floor(k + (n - m) * s / n + sd));\n            quickselectStep(arr, k, newLeft, newRight, compare);\n        }\n\n        var t = arr[k];\n        var i = left;\n        var j = right;\n\n        swap(arr, left, k);\n        if (compare(arr[right], t) > 0) swap(arr, left, right);\n\n        while (i < j) {\n            swap(arr, i, j);\n            i++;\n            j--;\n            while (compare(arr[i], t) < 0) i++;\n            while (compare(arr[j], t) > 0) j--;\n        }\n\n        if (compare(arr[left], t) === 0) swap(arr, left, j);\n        else {\n            j++;\n            swap(arr, j, right);\n        }\n\n        if (j <= k) left = j + 1;\n        if (k <= j) right = j - 1;\n    }\n}\n\nfunction swap(arr, i, j) {\n    var tmp = arr[i];\n    arr[i] = arr[j];\n    arr[j] = tmp;\n}\n\nfunction defaultCompare(a, b) {\n    return a < b ? -1 : a > b ? 1 : 0;\n}\n\nexport default quickselect;\n","import quickselect from './quickselect.js';\n\nfunction rbush(maxEntries, format) {\n    if (!(this instanceof rbush)) return new rbush(maxEntries, format);\n\n    // max entries in a node is 9 by default; min node fill is 40% for best performance\n    this._maxEntries = Math.max(4, maxEntries || 9);\n    this._minEntries = Math.max(2, Math.ceil(this._maxEntries * 0.4));\n\n    if (format) {\n        this._initFormat(format);\n    }\n\n    this.clear();\n}\n\nrbush.prototype = {\n\n    all: function () {\n        return this._all(this.data, []);\n    },\n\n    search: function (bbox) {\n\n        var node = this.data,\n            result = [],\n            toBBox = this.toBBox;\n\n        if (!intersects(bbox, node)) return result;\n\n        var nodesToSearch = [],\n            i, len, child, childBBox;\n\n        while (node) {\n            for (i = 0, len = node.children.length; i < len; i++) {\n\n                child = node.children[i];\n                childBBox = node.leaf ? toBBox(child) : child;\n\n                if (intersects(bbox, childBBox)) {\n                    if (node.leaf) result.push(child);\n                    else if (contains(bbox, childBBox)) this._all(child, result);\n                    else nodesToSearch.push(child);\n                }\n            }\n            node = nodesToSearch.pop();\n        }\n\n        return result;\n    },\n\n    collides: function (bbox) {\n\n        var node = this.data,\n            toBBox = this.toBBox;\n\n        if (!intersects(bbox, node)) return false;\n\n        var nodesToSearch = [],\n            i, len, child, childBBox;\n\n        while (node) {\n            for (i = 0, len = node.children.length; i < len; i++) {\n\n                child = node.children[i];\n                childBBox = node.leaf ? toBBox(child) : child;\n\n                if (intersects(bbox, childBBox)) {\n                    if (node.leaf || contains(bbox, childBBox)) return true;\n                    nodesToSearch.push(child);\n                }\n            }\n            node = nodesToSearch.pop();\n        }\n\n        return false;\n    },\n\n    load: function (data) {\n        if (!(data && data.length)) return this;\n\n        if (data.length < this._minEntries) {\n            for (var i = 0, len = data.length; i < len; i++) {\n                this.insert(data[i]);\n            }\n            return this;\n        }\n\n        // recursively build the tree with the given data from scratch using OMT algorithm\n        var node = this._build(data.slice(), 0, data.length - 1, 0);\n\n        if (!this.data.children.length) {\n            // save as is if tree is empty\n            this.data = node;\n\n        } else if (this.data.height === node.height) {\n            // split root if trees have the same height\n            this._splitRoot(this.data, node);\n\n        } else {\n            if (this.data.height < node.height) {\n                // swap trees if inserted one is bigger\n                var tmpNode = this.data;\n                this.data = node;\n                node = tmpNode;\n            }\n\n            // insert the small tree into the large tree at appropriate level\n            this._insert(node, this.data.height - node.height - 1, true);\n        }\n\n        return this;\n    },\n\n    insert: function (item) {\n        if (item) this._insert(item, this.data.height - 1);\n        return this;\n    },\n\n    clear: function () {\n        this.data = createNode([]);\n        return this;\n    },\n\n    remove: function (item, equalsFn) {\n        if (!item) return this;\n\n        var node = this.data,\n            bbox = this.toBBox(item),\n            path = [],\n            indexes = [],\n            i, parent, index, goingUp;\n\n        // depth-first iterative tree traversal\n        while (node || path.length) {\n\n            if (!node) { // go up\n                node = path.pop();\n                parent = path[path.length - 1];\n                i = indexes.pop();\n                goingUp = true;\n            }\n\n            if (node.leaf) { // check current node\n                index = findItem(item, node.children, equalsFn);\n\n                if (index !== -1) {\n                    // item found, remove the item and condense tree upwards\n                    node.children.splice(index, 1);\n                    path.push(node);\n                    this._condense(path);\n                    return this;\n                }\n            }\n\n            if (!goingUp && !node.leaf && contains(node, bbox)) { // go down\n                path.push(node);\n                indexes.push(i);\n                i = 0;\n                parent = node;\n                node = node.children[0];\n\n            } else if (parent) { // go right\n                i++;\n                node = parent.children[i];\n                goingUp = false;\n\n            } else node = null; // nothing found\n        }\n\n        return this;\n    },\n\n    toBBox: function (item) { return item; },\n\n    compareMinX: compareNodeMinX,\n    compareMinY: compareNodeMinY,\n\n    toJSON: function () { return this.data; },\n\n    fromJSON: function (data) {\n        this.data = data;\n        return this;\n    },\n\n    _all: function (node, result) {\n        var nodesToSearch = [];\n        while (node) {\n            if (node.leaf) result.push.apply(result, node.children);\n            else nodesToSearch.push.apply(nodesToSearch, node.children);\n\n            node = nodesToSearch.pop();\n        }\n        return result;\n    },\n\n    _build: function (items, left, right, height) {\n\n        var N = right - left + 1,\n            M = this._maxEntries,\n            node;\n\n        if (N <= M) {\n            // reached leaf level; return leaf\n            node = createNode(items.slice(left, right + 1));\n            calcBBox(node, this.toBBox);\n            return node;\n        }\n\n        if (!height) {\n            // target height of the bulk-loaded tree\n            height = Math.ceil(Math.log(N) / Math.log(M));\n\n            // target number of root entries to maximize storage utilization\n            M = Math.ceil(N / Math.pow(M, height - 1));\n        }\n\n        node = createNode([]);\n        node.leaf = false;\n        node.height = height;\n\n        // split the items into M mostly square tiles\n\n        var N2 = Math.ceil(N / M),\n            N1 = N2 * Math.ceil(Math.sqrt(M)),\n            i, j, right2, right3;\n\n        multiSelect(items, left, right, N1, this.compareMinX);\n\n        for (i = left; i <= right; i += N1) {\n\n            right2 = Math.min(i + N1 - 1, right);\n\n            multiSelect(items, i, right2, N2, this.compareMinY);\n\n            for (j = i; j <= right2; j += N2) {\n\n                right3 = Math.min(j + N2 - 1, right2);\n\n                // pack each entry recursively\n                node.children.push(this._build(items, j, right3, height - 1));\n            }\n        }\n\n        calcBBox(node, this.toBBox);\n\n        return node;\n    },\n\n    _chooseSubtree: function (bbox, node, level, path) {\n\n        var i, len, child, targetNode, area, enlargement, minArea, minEnlargement;\n\n        while (true) {\n            path.push(node);\n\n            if (node.leaf || path.length - 1 === level) break;\n\n            minArea = minEnlargement = Infinity;\n\n            for (i = 0, len = node.children.length; i < len; i++) {\n                child = node.children[i];\n                area = bboxArea(child);\n                enlargement = enlargedArea(bbox, child) - area;\n\n                // choose entry with the least area enlargement\n                if (enlargement < minEnlargement) {\n                    minEnlargement = enlargement;\n                    minArea = area < minArea ? area : minArea;\n                    targetNode = child;\n\n                } else if (enlargement === minEnlargement) {\n                    // otherwise choose one with the smallest area\n                    if (area < minArea) {\n                        minArea = area;\n                        targetNode = child;\n                    }\n                }\n            }\n\n            node = targetNode || node.children[0];\n        }\n\n        return node;\n    },\n\n    _insert: function (item, level, isNode) {\n\n        var toBBox = this.toBBox,\n            bbox = isNode ? item : toBBox(item),\n            insertPath = [];\n\n        // find the best node for accommodating the item, saving all nodes along the path too\n        var node = this._chooseSubtree(bbox, this.data, level, insertPath);\n\n        // put the item into the node\n        node.children.push(item);\n        extend(node, bbox);\n\n        // split on node overflow; propagate upwards if necessary\n        while (level >= 0) {\n            if (insertPath[level].children.length > this._maxEntries) {\n                this._split(insertPath, level);\n                level--;\n            } else break;\n        }\n\n        // adjust bboxes along the insertion path\n        this._adjustParentBBoxes(bbox, insertPath, level);\n    },\n\n    // split overflowed node into two\n    _split: function (insertPath, level) {\n\n        var node = insertPath[level],\n            M = node.children.length,\n            m = this._minEntries;\n\n        this._chooseSplitAxis(node, m, M);\n\n        var splitIndex = this._chooseSplitIndex(node, m, M);\n\n        var newNode = createNode(node.children.splice(splitIndex, node.children.length - splitIndex));\n        newNode.height = node.height;\n        newNode.leaf = node.leaf;\n\n        calcBBox(node, this.toBBox);\n        calcBBox(newNode, this.toBBox);\n\n        if (level) insertPath[level - 1].children.push(newNode);\n        else this._splitRoot(node, newNode);\n    },\n\n    _splitRoot: function (node, newNode) {\n        // split root node\n        this.data = createNode([node, newNode]);\n        this.data.height = node.height + 1;\n        this.data.leaf = false;\n        calcBBox(this.data, this.toBBox);\n    },\n\n    _chooseSplitIndex: function (node, m, M) {\n\n        var i, bbox1, bbox2, overlap, area, minOverlap, minArea, index;\n\n        minOverlap = minArea = Infinity;\n\n        for (i = m; i <= M - m; i++) {\n            bbox1 = distBBox(node, 0, i, this.toBBox);\n            bbox2 = distBBox(node, i, M, this.toBBox);\n\n            overlap = intersectionArea(bbox1, bbox2);\n            area = bboxArea(bbox1) + bboxArea(bbox2);\n\n            // choose distribution with minimum overlap\n            if (overlap < minOverlap) {\n                minOverlap = overlap;\n                index = i;\n\n                minArea = area < minArea ? area : minArea;\n\n            } else if (overlap === minOverlap) {\n                // otherwise choose distribution with minimum area\n                if (area < minArea) {\n                    minArea = area;\n                    index = i;\n                }\n            }\n        }\n\n        return index;\n    },\n\n    // sorts node children by the best axis for split\n    _chooseSplitAxis: function (node, m, M) {\n\n        var compareMinX = node.leaf ? this.compareMinX : compareNodeMinX,\n            compareMinY = node.leaf ? this.compareMinY : compareNodeMinY,\n            xMargin = this._allDistMargin(node, m, M, compareMinX),\n            yMargin = this._allDistMargin(node, m, M, compareMinY);\n\n        // if total distributions margin value is minimal for x, sort by minX,\n        // otherwise it's already sorted by minY\n        if (xMargin < yMargin) node.children.sort(compareMinX);\n    },\n\n    // total margin of all possible split distributions where each node is at least m full\n    _allDistMargin: function (node, m, M, compare) {\n\n        node.children.sort(compare);\n\n        var toBBox = this.toBBox,\n            leftBBox = distBBox(node, 0, m, toBBox),\n            rightBBox = distBBox(node, M - m, M, toBBox),\n            margin = bboxMargin(leftBBox) + bboxMargin(rightBBox),\n            i, child;\n\n        for (i = m; i < M - m; i++) {\n            child = node.children[i];\n            extend(leftBBox, node.leaf ? toBBox(child) : child);\n            margin += bboxMargin(leftBBox);\n        }\n\n        for (i = M - m - 1; i >= m; i--) {\n            child = node.children[i];\n            extend(rightBBox, node.leaf ? toBBox(child) : child);\n            margin += bboxMargin(rightBBox);\n        }\n\n        return margin;\n    },\n\n    _adjustParentBBoxes: function (bbox, path, level) {\n        // adjust bboxes along the given tree path\n        for (var i = level; i >= 0; i--) {\n            extend(path[i], bbox);\n        }\n    },\n\n    _condense: function (path) {\n        // go through the path, removing empty nodes and updating bboxes\n        for (var i = path.length - 1, siblings; i >= 0; i--) {\n            if (path[i].children.length === 0) {\n                if (i > 0) {\n                    siblings = path[i - 1].children;\n                    siblings.splice(siblings.indexOf(path[i]), 1);\n\n                } else this.clear();\n\n            } else calcBBox(path[i], this.toBBox);\n        }\n    },\n\n    _initFormat: function (format) {\n        // data format (minX, minY, maxX, maxY accessors)\n\n        // uses eval-type function compilation instead of just accepting a toBBox function\n        // because the algorithms are very sensitive to sorting functions performance,\n        // so they should be dead simple and without inner calls\n\n        var compareArr = ['return a', ' - b', ';'];\n\n        this.compareMinX = new Function('a', 'b', compareArr.join(format[0]));\n        this.compareMinY = new Function('a', 'b', compareArr.join(format[1]));\n\n        this.toBBox = new Function('a',\n            'return {minX: a' + format[0] +\n            ', minY: a' + format[1] +\n            ', maxX: a' + format[2] +\n            ', maxY: a' + format[3] + '};');\n    }\n};\n\nfunction findItem(item, items, equalsFn) {\n    if (!equalsFn) return items.indexOf(item);\n\n    for (var i = 0; i < items.length; i++) {\n        if (equalsFn(item, items[i])) return i;\n    }\n    return -1;\n}\n\n// calculate node's bbox from bboxes of its children\nfunction calcBBox(node, toBBox) {\n    distBBox(node, 0, node.children.length, toBBox, node);\n}\n\n// min bounding rectangle of node children from k to p-1\nfunction distBBox(node, k, p, toBBox, destNode) {\n    if (!destNode) destNode = createNode(null);\n    destNode.minX = Infinity;\n    destNode.minY = Infinity;\n    destNode.maxX = -Infinity;\n    destNode.maxY = -Infinity;\n\n    for (var i = k, child; i < p; i++) {\n        child = node.children[i];\n        extend(destNode, node.leaf ? toBBox(child) : child);\n    }\n\n    return destNode;\n}\n\nfunction extend(a, b) {\n    a.minX = Math.min(a.minX, b.minX);\n    a.minY = Math.min(a.minY, b.minY);\n    a.maxX = Math.max(a.maxX, b.maxX);\n    a.maxY = Math.max(a.maxY, b.maxY);\n    return a;\n}\n\nfunction compareNodeMinX(a, b) { return a.minX - b.minX; }\nfunction compareNodeMinY(a, b) { return a.minY - b.minY; }\n\nfunction bboxArea(a)   { return (a.maxX - a.minX) * (a.maxY - a.minY); }\nfunction bboxMargin(a) { return (a.maxX - a.minX) + (a.maxY - a.minY); }\n\nfunction enlargedArea(a, b) {\n    return (Math.max(b.maxX, a.maxX) - Math.min(b.minX, a.minX)) *\n           (Math.max(b.maxY, a.maxY) - Math.min(b.minY, a.minY));\n}\n\nfunction intersectionArea(a, b) {\n    var minX = Math.max(a.minX, b.minX),\n        minY = Math.max(a.minY, b.minY),\n        maxX = Math.min(a.maxX, b.maxX),\n        maxY = Math.min(a.maxY, b.maxY);\n\n    return Math.max(0, maxX - minX) *\n           Math.max(0, maxY - minY);\n}\n\nfunction contains(a, b) {\n    return a.minX <= b.minX &&\n           a.minY <= b.minY &&\n           b.maxX <= a.maxX &&\n           b.maxY <= a.maxY;\n}\n\nfunction intersects(a, b) {\n    return b.minX <= a.maxX &&\n           b.minY <= a.maxY &&\n           b.maxX >= a.minX &&\n           b.maxY >= a.minY;\n}\n\nfunction createNode(children) {\n    return {\n        children: children,\n        height: 1,\n        leaf: true,\n        minX: Infinity,\n        minY: Infinity,\n        maxX: -Infinity,\n        maxY: -Infinity\n    };\n}\n\n// sort an array so that items come in groups of n unsorted items, with groups sorted between each other;\n// combines selection algorithm with binary divide & conquer approach\n\nfunction multiSelect(arr, left, right, n, compare) {\n    var stack = [left, right],\n        mid;\n\n    while (stack.length) {\n        right = stack.pop();\n        left = stack.pop();\n\n        if (right - left <= n) continue;\n\n        mid = left + Math.ceil((right - left) / n / 2) * n;\n        quickselect(arr, mid, left, right, compare);\n\n        stack.push(left, mid, mid, right);\n    }\n}\n\nexport default rbush;\n","import rbush from '../ThirdParty/rbush.js';\nimport Check from './Check.js';\n\n    /**\n     * Wrapper around rbush for use with Rectangle types.\n     * @private\n     */\n    function RectangleCollisionChecker() {\n        this._tree = rbush();\n    }\n\n    function RectangleWithId() {\n        this.minX = 0.0;\n        this.minY = 0.0;\n        this.maxX = 0.0;\n        this.maxY = 0.0;\n        this.id = '';\n    }\n\n    RectangleWithId.fromRectangleAndId = function(id, rectangle, result) {\n        result.minX = rectangle.west;\n        result.minY = rectangle.south;\n        result.maxX = rectangle.east;\n        result.maxY = rectangle.north;\n        result.id = id;\n        return result;\n    };\n\n    /**\n     * Insert a rectangle into the collision checker.\n     *\n     * @param {String} id Unique string ID for the rectangle being inserted.\n     * @param {Rectangle} rectangle A Rectangle\n     * @private\n     */\n    RectangleCollisionChecker.prototype.insert = function(id, rectangle) {\n        \n\n        var withId = RectangleWithId.fromRectangleAndId(id, rectangle, new RectangleWithId());\n        this._tree.insert(withId);\n    };\n\n    function idCompare(a, b) {\n        return a.id === b.id;\n    }\n\n    var removalScratch = new RectangleWithId();\n    /**\n     * Remove a rectangle from the collision checker.\n     *\n     * @param {String} id Unique string ID for the rectangle being removed.\n     * @param {Rectangle} rectangle A Rectangle\n     * @private\n     */\n    RectangleCollisionChecker.prototype.remove = function(id, rectangle) {\n        \n\n        var withId = RectangleWithId.fromRectangleAndId(id, rectangle, removalScratch);\n        this._tree.remove(withId, idCompare);\n    };\n\n    var collisionScratch = new RectangleWithId();\n    /**\n     * Checks if a given rectangle collides with any of the rectangles in the collection.\n     *\n     * @param {Rectangle} rectangle A Rectangle that should be checked against the rectangles in the collision checker.\n     * @returns {Boolean} Whether the rectangle collides with any of the rectangles in the collision checker.\n     */\n    RectangleCollisionChecker.prototype.collides = function(rectangle) {\n        \n\n        var withId = RectangleWithId.fromRectangleAndId('', rectangle, collisionScratch);\n        return this._tree.collides(withId);\n    };\nexport default RectangleCollisionChecker;\n","import AssociativeArray from '../Core/AssociativeArray.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport defined from '../Core/defined.js';\nimport DistanceDisplayCondition from '../Core/DistanceDisplayCondition.js';\nimport DistanceDisplayConditionGeometryInstanceAttribute from '../Core/DistanceDisplayConditionGeometryInstanceAttribute.js';\nimport ShowGeometryInstanceAttribute from '../Core/ShowGeometryInstanceAttribute.js';\nimport GroundPrimitive from '../Scene/GroundPrimitive.js';\nimport BoundingSphereState from './BoundingSphereState.js';\nimport Property from './Property.js';\nimport RectangleCollisionChecker from '../Core/RectangleCollisionChecker.js';\n\n    var colorScratch = new Color();\n    var distanceDisplayConditionScratch = new DistanceDisplayCondition();\n    var defaultDistanceDisplayCondition = new DistanceDisplayCondition();\n\n    function Batch(primitives, classificationType, color, zIndex) {\n        this.primitives = primitives;\n        this.zIndex = zIndex;\n        this.classificationType = classificationType;\n        this.color = color;\n        this.createPrimitive = false;\n        this.waitingOnCreate = false;\n        this.primitive = undefined;\n        this.oldPrimitive = undefined;\n        this.geometry = new AssociativeArray();\n        this.updaters = new AssociativeArray();\n        this.updatersWithAttributes = new AssociativeArray();\n        this.attributes = new AssociativeArray();\n        this.subscriptions = new AssociativeArray();\n        this.showsUpdated = new AssociativeArray();\n        this.itemsToRemove = [];\n        this.isDirty = false;\n        this.rectangleCollisionCheck = new RectangleCollisionChecker();\n    }\n\n    Batch.prototype.overlapping = function(rectangle) {\n        return this.rectangleCollisionCheck.collides(rectangle);\n    };\n\n    Batch.prototype.add = function(updater, instance) {\n        var id = updater.id;\n        this.createPrimitive = true;\n        this.geometry.set(id, instance);\n        this.updaters.set(id, updater);\n        this.rectangleCollisionCheck.insert(id, instance.geometry.rectangle);\n        if (!updater.hasConstantFill || !updater.fillMaterialProperty.isConstant || !Property.isConstant(updater.distanceDisplayConditionProperty)) {\n            this.updatersWithAttributes.set(id, updater);\n        } else {\n            var that = this;\n            this.subscriptions.set(id, updater.entity.definitionChanged.addEventListener(function(entity, propertyName, newValue, oldValue) {\n                if (propertyName === 'isShowing') {\n                    that.showsUpdated.set(updater.id, updater);\n                }\n            }));\n        }\n    };\n\n    Batch.prototype.remove = function(updater) {\n        var id = updater.id;\n        var geometryInstance = this.geometry.get(id);\n        this.createPrimitive = this.geometry.remove(id) || this.createPrimitive;\n        if (this.updaters.remove(id)) {\n            this.rectangleCollisionCheck.remove(id, geometryInstance.geometry.rectangle);\n            this.updatersWithAttributes.remove(id);\n            var unsubscribe = this.subscriptions.get(id);\n            if (defined(unsubscribe)) {\n                unsubscribe();\n                this.subscriptions.remove(id);\n                this.showsUpdated.remove(id);\n            }\n            return true;\n        }\n        return false;\n    };\n\n    Batch.prototype.update = function(time) {\n        var isUpdated = true;\n        var removedCount = 0;\n        var primitive = this.primitive;\n        var primitives = this.primitives;\n        var i;\n\n        if (this.createPrimitive) {\n            var geometries = this.geometry.values;\n            var geometriesLength = geometries.length;\n            if (geometriesLength > 0) {\n                if (defined(primitive)) {\n                    if (!defined(this.oldPrimitive)) {\n                        this.oldPrimitive = primitive;\n                    } else {\n                        primitives.remove(primitive);\n                    }\n                }\n\n                primitive = new GroundPrimitive({\n                    show : false,\n                    asynchronous : true,\n                    geometryInstances : geometries.slice(),\n                    classificationType : this.classificationType\n                });\n                primitives.add(primitive, this.zIndex);\n                isUpdated = false;\n            } else {\n                if (defined(primitive)) {\n                    primitives.remove(primitive);\n                    primitive = undefined;\n                }\n                var oldPrimitive = this.oldPrimitive;\n                if (defined(oldPrimitive)) {\n                    primitives.remove(oldPrimitive);\n                    this.oldPrimitive = undefined;\n                }\n            }\n\n            this.attributes.removeAll();\n            this.primitive = primitive;\n            this.createPrimitive = false;\n            this.waitingOnCreate = true;\n        } else if (defined(primitive) && primitive.ready) {\n            primitive.show = true;\n            if (defined(this.oldPrimitive)) {\n                primitives.remove(this.oldPrimitive);\n                this.oldPrimitive = undefined;\n            }\n            var updatersWithAttributes = this.updatersWithAttributes.values;\n            var length = updatersWithAttributes.length;\n            var waitingOnCreate = this.waitingOnCreate;\n            for (i = 0; i < length; i++) {\n                var updater = updatersWithAttributes[i];\n                var instance = this.geometry.get(updater.id);\n\n                var attributes = this.attributes.get(instance.id.id);\n                if (!defined(attributes)) {\n                    attributes = primitive.getGeometryInstanceAttributes(instance.id);\n                    this.attributes.set(instance.id.id, attributes);\n                }\n\n                if (!updater.fillMaterialProperty.isConstant || waitingOnCreate) {\n                    var colorProperty = updater.fillMaterialProperty.color;\n                    var fillColor = Property.getValueOrDefault(colorProperty, time, Color.WHITE, colorScratch);\n\n                    if (!Color.equals(attributes._lastColor, fillColor)) {\n                        attributes._lastColor = Color.clone(fillColor, attributes._lastColor);\n                        attributes.color = ColorGeometryInstanceAttribute.toValue(fillColor, attributes.color);\n                    }\n                }\n\n                var show = updater.entity.isShowing && (updater.hasConstantFill || updater.isFilled(time));\n                var currentShow = attributes.show[0] === 1;\n                if (show !== currentShow) {\n                    attributes.show = ShowGeometryInstanceAttribute.toValue(show, attributes.show);\n                }\n\n                var distanceDisplayConditionProperty = updater.distanceDisplayConditionProperty;\n                if (!Property.isConstant(distanceDisplayConditionProperty)) {\n                    var distanceDisplayCondition = Property.getValueOrDefault(distanceDisplayConditionProperty, time, defaultDistanceDisplayCondition, distanceDisplayConditionScratch);\n                    if (!DistanceDisplayCondition.equals(distanceDisplayCondition, attributes._lastDistanceDisplayCondition)) {\n                        attributes._lastDistanceDisplayCondition = DistanceDisplayCondition.clone(distanceDisplayCondition, attributes._lastDistanceDisplayCondition);\n                        attributes.distanceDisplayCondition = DistanceDisplayConditionGeometryInstanceAttribute.toValue(distanceDisplayCondition, attributes.distanceDisplayCondition);\n                    }\n                }\n            }\n\n            this.updateShows(primitive);\n            this.waitingOnCreate = false;\n        } else if (defined(primitive) && !primitive.ready) {\n            isUpdated = false;\n        }\n        this.itemsToRemove.length = removedCount;\n        return isUpdated;\n    };\n\n    Batch.prototype.updateShows = function(primitive) {\n        var showsUpdated = this.showsUpdated.values;\n        var length = showsUpdated.length;\n        for (var i = 0; i < length; i++) {\n            var updater = showsUpdated[i];\n            var instance = this.geometry.get(updater.id);\n\n            var attributes = this.attributes.get(instance.id.id);\n            if (!defined(attributes)) {\n                attributes = primitive.getGeometryInstanceAttributes(instance.id);\n                this.attributes.set(instance.id.id, attributes);\n            }\n\n            var show = updater.entity.isShowing;\n            var currentShow = attributes.show[0] === 1;\n            if (show !== currentShow) {\n                attributes.show = ShowGeometryInstanceAttribute.toValue(show, attributes.show);\n                instance.attributes.show.value[0] = attributes.show[0];\n            }\n        }\n        this.showsUpdated.removeAll();\n    };\n\n    Batch.prototype.contains = function(updater) {\n        return this.updaters.contains(updater.id);\n    };\n\n    Batch.prototype.getBoundingSphere = function(updater, result) {\n        var primitive = this.primitive;\n        if (!primitive.ready) {\n            return BoundingSphereState.PENDING;\n        }\n\n        var bs = primitive.getBoundingSphere(updater.entity);\n        if (!defined(bs)) {\n            return BoundingSphereState.FAILED;\n        }\n\n        bs.clone(result);\n        return BoundingSphereState.DONE;\n    };\n\n    Batch.prototype.removeAllPrimitives = function() {\n        var primitives = this.primitives;\n\n        var primitive = this.primitive;\n        if (defined(primitive)) {\n            primitives.remove(primitive);\n            this.primitive = undefined;\n            this.geometry.removeAll();\n            this.updaters.removeAll();\n        }\n\n        var oldPrimitive = this.oldPrimitive;\n        if (defined(oldPrimitive)) {\n            primitives.remove(oldPrimitive);\n            this.oldPrimitive = undefined;\n        }\n    };\n\n    /**\n     * @private\n     */\n    function StaticGroundGeometryColorBatch(primitives, classificationType) {\n        this._batches = [];\n        this._primitives = primitives;\n        this._classificationType = classificationType;\n    }\n\n    StaticGroundGeometryColorBatch.prototype.add = function(time, updater) {\n        var instance = updater.createFillGeometryInstance(time);\n        var batches = this._batches;\n        var zIndex = Property.getValueOrDefault(updater.zIndex, 0);\n        var batch;\n        var length = batches.length;\n        for (var i = 0; i < length; ++i) {\n            var item = batches[i];\n            if (item.zIndex === zIndex &&\n                !item.overlapping(instance.geometry.rectangle)) {\n                batch = item;\n                break;\n            }\n        }\n\n        if (!defined(batch)) {\n            batch = new Batch(this._primitives, this._classificationType, instance.attributes.color.value, zIndex);\n            batches.push(batch);\n        }\n        batch.add(updater, instance);\n        return batch;\n    };\n\n    StaticGroundGeometryColorBatch.prototype.remove = function(updater) {\n        var batches = this._batches;\n        var count = batches.length;\n        for (var i = 0; i < count; ++i) {\n            if (batches[i].remove(updater)) {\n                return;\n            }\n        }\n    };\n\n    StaticGroundGeometryColorBatch.prototype.update = function(time) {\n        var i;\n        var updater;\n\n        //Perform initial update\n        var isUpdated = true;\n        var batches = this._batches;\n        var batchCount = batches.length;\n        for (i = 0; i < batchCount; ++i) {\n            isUpdated = batches[i].update(time) && isUpdated;\n        }\n\n        //If any items swapped between batches we need to move them\n        for (i = 0; i < batchCount; ++i) {\n            var oldBatch = batches[i];\n            var itemsToRemove = oldBatch.itemsToRemove;\n            var itemsToMoveLength = itemsToRemove.length;\n            for (var j = 0; j < itemsToMoveLength; j++) {\n                updater = itemsToRemove[j];\n                oldBatch.remove(updater);\n                var newBatch = this.add(time, updater);\n                oldBatch.isDirty = true;\n                newBatch.isDirty = true;\n            }\n        }\n\n        //If we moved anything around, we need to re-build the primitive and remove empty batches\n        for (i = batchCount - 1; i >= 0; --i) {\n            var batch = batches[i];\n            if (batch.isDirty) {\n                isUpdated = batches[i].update(time) && isUpdated;\n                batch.isDirty = false;\n            }\n            if (batch.geometry.length === 0) {\n                batches.splice(i, 1);\n            }\n        }\n\n        return isUpdated;\n    };\n\n    StaticGroundGeometryColorBatch.prototype.getBoundingSphere = function(updater, result) {\n        var batches = this._batches;\n        var batchCount = batches.length;\n        for (var i = 0; i < batchCount; ++i) {\n            var batch = batches[i];\n            if (batch.contains(updater)) {\n                return batch.getBoundingSphere(updater, result);\n            }\n        }\n\n        return BoundingSphereState.FAILED;\n    };\n\n    StaticGroundGeometryColorBatch.prototype.removeAllPrimitives = function() {\n        var batches = this._batches;\n        var batchCount = batches.length;\n        for (var i = 0; i < batchCount; ++i) {\n            batches[i].removeAllPrimitives();\n        }\n    };\nexport default StaticGroundGeometryColorBatch;\n","import AssociativeArray from '../Core/AssociativeArray.js';\nimport defined from '../Core/defined.js';\nimport DistanceDisplayCondition from '../Core/DistanceDisplayCondition.js';\nimport DistanceDisplayConditionGeometryInstanceAttribute from '../Core/DistanceDisplayConditionGeometryInstanceAttribute.js';\nimport RectangleCollisionChecker from '../Core/RectangleCollisionChecker.js';\nimport ShowGeometryInstanceAttribute from '../Core/ShowGeometryInstanceAttribute.js';\nimport GroundPrimitive from '../Scene/GroundPrimitive.js';\nimport ShadowVolumeAppearance from '../Scene/ShadowVolumeAppearance.js';\nimport BoundingSphereState from './BoundingSphereState.js';\nimport ColorMaterialProperty from './ColorMaterialProperty.js';\nimport MaterialProperty from './MaterialProperty.js';\nimport Property from './Property.js';\n\n    var distanceDisplayConditionScratch = new DistanceDisplayCondition();\n    var defaultDistanceDisplayCondition = new DistanceDisplayCondition();\n\n    // Encapsulates a Primitive and all the entities that it represents.\n    function Batch(primitives, classificationType, appearanceType, materialProperty, usingSphericalTextureCoordinates, zIndex) {\n        this.primitives = primitives; // scene level primitive collection\n        this.classificationType = classificationType;\n        this.appearanceType = appearanceType;\n        this.materialProperty = materialProperty;\n        this.updaters = new AssociativeArray();\n        this.createPrimitive = true;\n        this.primitive = undefined; // a GroundPrimitive encapsulating all the entities\n        this.oldPrimitive = undefined;\n        this.geometry = new AssociativeArray();\n        this.material = undefined;\n        this.updatersWithAttributes = new AssociativeArray();\n        this.attributes = new AssociativeArray();\n        this.invalidated = false;\n        this.removeMaterialSubscription = materialProperty.definitionChanged.addEventListener(Batch.prototype.onMaterialChanged, this);\n        this.subscriptions = new AssociativeArray();\n        this.showsUpdated = new AssociativeArray();\n        this.usingSphericalTextureCoordinates = usingSphericalTextureCoordinates;\n        this.zIndex = zIndex;\n        this.rectangleCollisionCheck = new RectangleCollisionChecker();\n    }\n\n    Batch.prototype.onMaterialChanged = function() {\n        this.invalidated = true;\n    };\n\n    Batch.prototype.overlapping = function(rectangle) {\n        return this.rectangleCollisionCheck.collides(rectangle);\n    };\n\n    // Check if the given updater's material is compatible with this batch\n    Batch.prototype.isMaterial = function(updater) {\n        var material = this.materialProperty;\n        var updaterMaterial = updater.fillMaterialProperty;\n\n        if (updaterMaterial === material ||\n            (updaterMaterial instanceof ColorMaterialProperty && material instanceof ColorMaterialProperty)) {\n            return true;\n        }\n        return defined(material) && material.equals(updaterMaterial);\n    };\n\n    Batch.prototype.add = function(time, updater, geometryInstance) {\n        var id = updater.id;\n        this.updaters.set(id, updater);\n        this.geometry.set(id, geometryInstance);\n        this.rectangleCollisionCheck.insert(id, geometryInstance.geometry.rectangle);\n        // Updaters with dynamic attributes must be tracked separately, may exit the batch\n        if (!updater.hasConstantFill || !updater.fillMaterialProperty.isConstant || !Property.isConstant(updater.distanceDisplayConditionProperty)) {\n            this.updatersWithAttributes.set(id, updater);\n        } else {\n            var that = this;\n            // Listen for show changes. These will be synchronized in updateShows.\n            this.subscriptions.set(id, updater.entity.definitionChanged.addEventListener(function(entity, propertyName, newValue, oldValue) {\n                if (propertyName === 'isShowing') {\n                    that.showsUpdated.set(updater.id, updater);\n                }\n            }));\n        }\n        this.createPrimitive = true;\n    };\n\n    Batch.prototype.remove = function(updater) {\n        var id = updater.id;\n        var geometryInstance = this.geometry.get(id);\n        this.createPrimitive = this.geometry.remove(id) || this.createPrimitive;\n        if (this.updaters.remove(id)) {\n            this.rectangleCollisionCheck.remove(id, geometryInstance.geometry.rectangle);\n            this.updatersWithAttributes.remove(id);\n            var unsubscribe = this.subscriptions.get(id);\n            if (defined(unsubscribe)) {\n                unsubscribe();\n                this.subscriptions.remove(id);\n            }\n            return true;\n        }\n        return false;\n    };\n\n    Batch.prototype.update = function(time) {\n        var isUpdated = true;\n        var primitive = this.primitive;\n        var primitives = this.primitives;\n        var geometries = this.geometry.values;\n        var i;\n\n        if (this.createPrimitive) {\n            var geometriesLength = geometries.length;\n            if (geometriesLength > 0) {\n                if (defined(primitive)) {\n                    // Keep a handle to the old primitive so it can be removed when the updated version is ready.\n                    if (!defined(this.oldPrimitive)) {\n                        this.oldPrimitive = primitive;\n                    } else {\n                        // For if the new primitive changes again before it is ready.\n                        primitives.remove(primitive);\n                    }\n                }\n\n                this.material = MaterialProperty.getValue(time, this.materialProperty, this.material);\n\n                primitive = new GroundPrimitive({\n                    show : false,\n                    asynchronous : true,\n                    geometryInstances : geometries.slice(),\n                    appearance : new this.appearanceType({\n                        material : this.material\n                        // translucent and closed properties overridden\n                    }),\n                    classificationType : this.classificationType\n                });\n\n                primitives.add(primitive, this.zIndex);\n                isUpdated = false;\n            } else {\n                if (defined(primitive)) {\n                    primitives.remove(primitive);\n                    primitive = undefined;\n                }\n                var oldPrimitive = this.oldPrimitive;\n                if (defined(oldPrimitive)) {\n                    primitives.remove(oldPrimitive);\n                    this.oldPrimitive = undefined;\n                }\n            }\n\n            this.attributes.removeAll();\n            this.primitive = primitive;\n            this.createPrimitive = false;\n        } else if (defined(primitive) && primitive.ready) {\n            primitive.show = true;\n            if (defined(this.oldPrimitive)) {\n                primitives.remove(this.oldPrimitive);\n                this.oldPrimitive = undefined;\n            }\n\n            this.material = MaterialProperty.getValue(time, this.materialProperty, this.material);\n            this.primitive.appearance.material = this.material;\n\n            var updatersWithAttributes = this.updatersWithAttributes.values;\n            var length = updatersWithAttributes.length;\n            for (i = 0; i < length; i++) {\n                var updater = updatersWithAttributes[i];\n                var entity = updater.entity;\n                var instance = this.geometry.get(updater.id);\n\n                var attributes = this.attributes.get(instance.id.id);\n                if (!defined(attributes)) {\n                    attributes = primitive.getGeometryInstanceAttributes(instance.id);\n                    this.attributes.set(instance.id.id, attributes);\n                }\n\n                var show = entity.isShowing && (updater.hasConstantFill || updater.isFilled(time));\n                var currentShow = attributes.show[0] === 1;\n                if (show !== currentShow) {\n                    attributes.show = ShowGeometryInstanceAttribute.toValue(show, attributes.show);\n                }\n\n                var distanceDisplayConditionProperty = updater.distanceDisplayConditionProperty;\n                if (!Property.isConstant(distanceDisplayConditionProperty)) {\n                    var distanceDisplayCondition = Property.getValueOrDefault(distanceDisplayConditionProperty, time, defaultDistanceDisplayCondition, distanceDisplayConditionScratch);\n                    if (!DistanceDisplayCondition.equals(distanceDisplayCondition, attributes._lastDistanceDisplayCondition)) {\n                        attributes._lastDistanceDisplayCondition = DistanceDisplayCondition.clone(distanceDisplayCondition, attributes._lastDistanceDisplayCondition);\n                        attributes.distanceDisplayCondition = DistanceDisplayConditionGeometryInstanceAttribute.toValue(distanceDisplayCondition, attributes.distanceDisplayCondition);\n                    }\n                }\n            }\n\n            this.updateShows(primitive);\n        } else if (defined(primitive) && !primitive.ready) {\n            isUpdated = false;\n        }\n        return isUpdated;\n    };\n\n    Batch.prototype.updateShows = function(primitive) {\n        var showsUpdated = this.showsUpdated.values;\n        var length = showsUpdated.length;\n        for (var i = 0; i < length; i++) {\n            var updater = showsUpdated[i];\n            var entity = updater.entity;\n            var instance = this.geometry.get(updater.id);\n\n            var attributes = this.attributes.get(instance.id.id);\n            if (!defined(attributes)) {\n                attributes = primitive.getGeometryInstanceAttributes(instance.id);\n                this.attributes.set(instance.id.id, attributes);\n            }\n\n            var show = entity.isShowing;\n            var currentShow = attributes.show[0] === 1;\n            if (show !== currentShow) {\n                attributes.show = ShowGeometryInstanceAttribute.toValue(show, attributes.show);\n                instance.attributes.show.value[0] = attributes.show[0];\n            }\n        }\n        this.showsUpdated.removeAll();\n    };\n\n    Batch.prototype.contains = function(updater) {\n        return this.updaters.contains(updater.id);\n    };\n\n    Batch.prototype.getBoundingSphere = function(updater, result) {\n        var primitive = this.primitive;\n        if (!primitive.ready) {\n            return BoundingSphereState.PENDING;\n        }\n        var attributes = primitive.getGeometryInstanceAttributes(updater.entity);\n        if (!defined(attributes) || !defined(attributes.boundingSphere) ||\n            (defined(attributes.show) && attributes.show[0] === 0)) {\n            return BoundingSphereState.FAILED;\n        }\n        attributes.boundingSphere.clone(result);\n        return BoundingSphereState.DONE;\n    };\n\n    Batch.prototype.destroy = function() {\n        var primitive = this.primitive;\n        var primitives = this.primitives;\n        if (defined(primitive)) {\n            primitives.remove(primitive);\n        }\n        var oldPrimitive = this.oldPrimitive;\n        if (defined(oldPrimitive)) {\n            primitives.remove(oldPrimitive);\n        }\n        this.removeMaterialSubscription();\n    };\n\n    /**\n     * @private\n     */\n    function StaticGroundGeometryPerMaterialBatch(primitives, classificationType, appearanceType) {\n        this._items = [];\n        this._primitives = primitives;\n        this._classificationType = classificationType;\n        this._appearanceType = appearanceType;\n    }\n\n    StaticGroundGeometryPerMaterialBatch.prototype.add = function(time, updater) {\n        var items = this._items;\n        var length = items.length;\n        var geometryInstance = updater.createFillGeometryInstance(time);\n        var usingSphericalTextureCoordinates = ShadowVolumeAppearance.shouldUseSphericalCoordinates(geometryInstance.geometry.rectangle);\n        var zIndex = Property.getValueOrDefault(updater.zIndex, 0);\n        // Check if the Entity represented by the updater can be placed in an existing batch. Requirements:\n        // * compatible material (same material or same color)\n        // * same type of texture coordinates (spherical vs. planar)\n        // * conservatively non-overlapping with any entities in the existing batch\n        for (var i = 0; i < length; ++i) {\n            var item = items[i];\n            if (item.isMaterial(updater) &&\n                item.usingSphericalTextureCoordinates === usingSphericalTextureCoordinates &&\n                item.zIndex === zIndex &&\n                !item.overlapping(geometryInstance.geometry.rectangle)) {\n                item.add(time, updater, geometryInstance);\n                return;\n            }\n        }\n        // If a compatible batch wasn't found, create a new batch.\n        var batch = new Batch(this._primitives, this._classificationType, this._appearanceType, updater.fillMaterialProperty, usingSphericalTextureCoordinates, zIndex);\n        batch.add(time, updater, geometryInstance);\n        items.push(batch);\n    };\n\n    StaticGroundGeometryPerMaterialBatch.prototype.remove = function(updater) {\n        var items = this._items;\n        var length = items.length;\n        for (var i = length - 1; i >= 0; i--) {\n            var item = items[i];\n            if (item.remove(updater)) {\n                if (item.updaters.length === 0) {\n                    items.splice(i, 1);\n                    item.destroy();\n                }\n                break;\n            }\n        }\n    };\n\n    StaticGroundGeometryPerMaterialBatch.prototype.update = function(time) {\n        var i;\n        var items = this._items;\n        var length = items.length;\n\n        for (i = length - 1; i >= 0; i--) {\n            var item = items[i];\n            if (item.invalidated) {\n                items.splice(i, 1);\n                var updaters = item.updaters.values;\n                var updatersLength = updaters.length;\n                for (var h = 0; h < updatersLength; h++) {\n                    this.add(time, updaters[h]);\n                }\n                item.destroy();\n            }\n        }\n\n        var isUpdated = true;\n        for (i = 0; i < items.length; i++) {\n            isUpdated = items[i].update(time) && isUpdated;\n        }\n        return isUpdated;\n    };\n\n    StaticGroundGeometryPerMaterialBatch.prototype.getBoundingSphere = function(updater, result) {\n        var items = this._items;\n        var length = items.length;\n        for (var i = 0; i < length; i++) {\n            var item = items[i];\n            if (item.contains(updater)){\n                return item.getBoundingSphere(updater, result);\n            }\n        }\n        return BoundingSphereState.FAILED;\n    };\n\n    StaticGroundGeometryPerMaterialBatch.prototype.removeAllPrimitives = function() {\n        var items = this._items;\n        var length = items.length;\n        for (var i = 0; i < length; i++) {\n            items[i].destroy();\n        }\n        this._items.length = 0;\n    };\nexport default StaticGroundGeometryPerMaterialBatch;\n","import AssociativeArray from '../Core/AssociativeArray.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport defined from '../Core/defined.js';\nimport DistanceDisplayCondition from '../Core/DistanceDisplayCondition.js';\nimport DistanceDisplayConditionGeometryInstanceAttribute from '../Core/DistanceDisplayConditionGeometryInstanceAttribute.js';\nimport OffsetGeometryInstanceAttribute from '../Core/OffsetGeometryInstanceAttribute.js';\nimport ShowGeometryInstanceAttribute from '../Core/ShowGeometryInstanceAttribute.js';\nimport PerInstanceColorAppearance from '../Scene/PerInstanceColorAppearance.js';\nimport Primitive from '../Scene/Primitive.js';\nimport BoundingSphereState from './BoundingSphereState.js';\nimport Property from './Property.js';\n\n    var colorScratch = new Color();\n    var distanceDisplayConditionScratch = new DistanceDisplayCondition();\n    var defaultDistanceDisplayCondition = new DistanceDisplayCondition();\n    var defaultOffset = Cartesian3.ZERO;\n    var offsetScratch = new Cartesian3();\n\n    function Batch(primitives, translucent, width, shadows) {\n        this.translucent = translucent;\n        this.width = width;\n        this.shadows = shadows;\n        this.primitives = primitives;\n        this.createPrimitive = false;\n        this.waitingOnCreate = false;\n        this.primitive = undefined;\n        this.oldPrimitive = undefined;\n        this.geometry = new AssociativeArray();\n        this.updaters = new AssociativeArray();\n        this.updatersWithAttributes = new AssociativeArray();\n        this.attributes = new AssociativeArray();\n        this.itemsToRemove = [];\n        this.subscriptions = new AssociativeArray();\n        this.showsUpdated = new AssociativeArray();\n    }\n    Batch.prototype.add = function(updater, instance) {\n        var id = updater.id;\n        this.createPrimitive = true;\n        this.geometry.set(id, instance);\n        this.updaters.set(id, updater);\n        if (!updater.hasConstantOutline || !updater.outlineColorProperty.isConstant || !Property.isConstant(updater.distanceDisplayConditionProperty) || !Property.isConstant(updater.terrainOffsetProperty)) {\n            this.updatersWithAttributes.set(id, updater);\n        } else {\n            var that = this;\n            this.subscriptions.set(id, updater.entity.definitionChanged.addEventListener(function(entity, propertyName, newValue, oldValue) {\n                if (propertyName === 'isShowing') {\n                    that.showsUpdated.set(updater.id, updater);\n                }\n            }));\n        }\n    };\n\n    Batch.prototype.remove = function(updater) {\n        var id = updater.id;\n        this.createPrimitive = this.geometry.remove(id) || this.createPrimitive;\n        if (this.updaters.remove(id)) {\n            this.updatersWithAttributes.remove(id);\n            var unsubscribe = this.subscriptions.get(id);\n            if (defined(unsubscribe)) {\n                unsubscribe();\n                this.subscriptions.remove(id);\n                this.showsUpdated.remove(id);\n            }\n            return true;\n        }\n        return false;\n    };\n\n    Batch.prototype.update = function(time) {\n        var isUpdated = true;\n        var removedCount = 0;\n        var primitive = this.primitive;\n        var primitives = this.primitives;\n        var i;\n\n        if (this.createPrimitive) {\n            var geometries = this.geometry.values;\n            var geometriesLength = geometries.length;\n            if (geometriesLength > 0) {\n                if (defined(primitive)) {\n                    if (!defined(this.oldPrimitive)) {\n                        this.oldPrimitive = primitive;\n                    } else {\n                        primitives.remove(primitive);\n                    }\n                }\n\n                primitive = new Primitive({\n                    show : false,\n                    asynchronous : true,\n                    geometryInstances : geometries.slice(),\n                    appearance : new PerInstanceColorAppearance({\n                        flat : true,\n                        translucent : this.translucent,\n                        renderState : {\n                            lineWidth : this.width\n                        }\n                    }),\n                    shadows : this.shadows\n                });\n\n                primitives.add(primitive);\n                isUpdated = false;\n            } else {\n                if (defined(primitive)) {\n                    primitives.remove(primitive);\n                    primitive = undefined;\n                }\n                var oldPrimitive = this.oldPrimitive;\n                if (defined(oldPrimitive)) {\n                    primitives.remove(oldPrimitive);\n                    this.oldPrimitive = undefined;\n                }\n            }\n\n            this.attributes.removeAll();\n            this.primitive = primitive;\n            this.createPrimitive = false;\n            this.waitingOnCreate = true;\n        } else if (defined(primitive) && primitive.ready) {\n            primitive.show = true;\n            if (defined(this.oldPrimitive)) {\n                primitives.remove(this.oldPrimitive);\n                this.oldPrimitive = undefined;\n            }\n\n            var updatersWithAttributes = this.updatersWithAttributes.values;\n            var length = updatersWithAttributes.length;\n            var waitingOnCreate = this.waitingOnCreate;\n            for (i = 0; i < length; i++) {\n                var updater = updatersWithAttributes[i];\n                var instance = this.geometry.get(updater.id);\n\n                var attributes = this.attributes.get(instance.id.id);\n                if (!defined(attributes)) {\n                    attributes = primitive.getGeometryInstanceAttributes(instance.id);\n                    this.attributes.set(instance.id.id, attributes);\n                }\n\n                if (!updater.outlineColorProperty.isConstant || waitingOnCreate) {\n                    var outlineColorProperty = updater.outlineColorProperty;\n                    var outlineColor = Property.getValueOrDefault(outlineColorProperty, time, Color.WHITE, colorScratch);\n                    if (!Color.equals(attributes._lastColor, outlineColor)) {\n                        attributes._lastColor = Color.clone(outlineColor, attributes._lastColor);\n                        attributes.color = ColorGeometryInstanceAttribute.toValue(outlineColor, attributes.color);\n                        if ((this.translucent && attributes.color[3] === 255) || (!this.translucent && attributes.color[3] !== 255)) {\n                            this.itemsToRemove[removedCount++] = updater;\n                        }\n                    }\n                }\n\n                var show = updater.entity.isShowing && (updater.hasConstantOutline || updater.isOutlineVisible(time));\n                var currentShow = attributes.show[0] === 1;\n                if (show !== currentShow) {\n                    attributes.show = ShowGeometryInstanceAttribute.toValue(show, attributes.show);\n                }\n\n                var distanceDisplayConditionProperty = updater.distanceDisplayConditionProperty;\n                if (!Property.isConstant(distanceDisplayConditionProperty)) {\n                    var distanceDisplayCondition = Property.getValueOrDefault(distanceDisplayConditionProperty, time, defaultDistanceDisplayCondition, distanceDisplayConditionScratch);\n                    if (!DistanceDisplayCondition.equals(distanceDisplayCondition, attributes._lastDistanceDisplayCondition)) {\n                        attributes._lastDistanceDisplayCondition = DistanceDisplayCondition.clone(distanceDisplayCondition, attributes._lastDistanceDisplayCondition);\n                        attributes.distanceDisplayCondition = DistanceDisplayConditionGeometryInstanceAttribute.toValue(distanceDisplayCondition, attributes.distanceDisplayCondition);\n                    }\n                }\n\n                var offsetProperty = updater.terrainOffsetProperty;\n                if (!Property.isConstant(offsetProperty)) {\n                    var offset = Property.getValueOrDefault(offsetProperty, time, defaultOffset, offsetScratch);\n                    if (!Cartesian3.equals(offset, attributes._lastOffset)) {\n                        attributes._lastOffset = Cartesian3.clone(offset, attributes._lastOffset);\n                        attributes.offset = OffsetGeometryInstanceAttribute.toValue(offset, attributes.offset);\n                    }\n                }\n            }\n\n            this.updateShows(primitive);\n            this.waitingOnCreate = false;\n        } else if (defined(primitive) && !primitive.ready) {\n            isUpdated = false;\n        }\n\n        this.itemsToRemove.length = removedCount;\n        return isUpdated;\n    };\n\n    Batch.prototype.updateShows = function(primitive) {\n        var showsUpdated = this.showsUpdated.values;\n        var length = showsUpdated.length;\n        for (var i = 0; i < length; i++) {\n            var updater = showsUpdated[i];\n            var instance = this.geometry.get(updater.id);\n\n            var attributes = this.attributes.get(instance.id.id);\n            if (!defined(attributes)) {\n                attributes = primitive.getGeometryInstanceAttributes(instance.id);\n                this.attributes.set(instance.id.id, attributes);\n            }\n\n            var show = updater.entity.isShowing;\n            var currentShow = attributes.show[0] === 1;\n            if (show !== currentShow) {\n                attributes.show = ShowGeometryInstanceAttribute.toValue(show, attributes.show);\n                instance.attributes.show.value[0] = attributes.show[0];\n            }\n        }\n        this.showsUpdated.removeAll();\n    };\n\n    Batch.prototype.contains = function(updater) {\n        return this.updaters.contains(updater.id);\n    };\n\n    Batch.prototype.getBoundingSphere = function(updater, result) {\n        var primitive = this.primitive;\n        if (!primitive.ready) {\n            return BoundingSphereState.PENDING;\n        }\n        var attributes = primitive.getGeometryInstanceAttributes(updater.entity);\n        if (!defined(attributes) || !defined(attributes.boundingSphere) ||//\n            (defined(attributes.show) && attributes.show[0] === 0)) {\n            return BoundingSphereState.FAILED;\n        }\n        attributes.boundingSphere.clone(result);\n        return BoundingSphereState.DONE;\n    };\n\n    Batch.prototype.removeAllPrimitives = function() {\n        var primitives = this.primitives;\n\n        var primitive = this.primitive;\n        if (defined(primitive)) {\n            primitives.remove(primitive);\n            this.primitive = undefined;\n            this.geometry.removeAll();\n            this.updaters.removeAll();\n        }\n\n        var oldPrimitive = this.oldPrimitive;\n        if (defined(oldPrimitive)) {\n            primitives.remove(oldPrimitive);\n            this.oldPrimitive = undefined;\n        }\n    };\n\n    /**\n     * @private\n     */\n    function StaticOutlineGeometryBatch(primitives, scene, shadows) {\n        this._primitives = primitives;\n        this._scene = scene;\n        this._shadows = shadows;\n        this._solidBatches = new AssociativeArray();\n        this._translucentBatches = new AssociativeArray();\n    }\n    StaticOutlineGeometryBatch.prototype.add = function(time, updater) {\n        var instance = updater.createOutlineGeometryInstance(time);\n        var width = this._scene.clampLineWidth(updater.outlineWidth);\n        var batches;\n        var batch;\n        if (instance.attributes.color.value[3] === 255) {\n            batches = this._solidBatches;\n            batch = batches.get(width);\n            if (!defined(batch)) {\n                batch = new Batch(this._primitives, false, width, this._shadows);\n                batches.set(width, batch);\n            }\n            batch.add(updater, instance);\n        } else {\n            batches = this._translucentBatches;\n            batch = batches.get(width);\n            if (!defined(batch)) {\n                batch = new Batch(this._primitives, true, width, this._shadows);\n                batches.set(width, batch);\n            }\n            batch.add(updater, instance);\n        }\n    };\n\n    StaticOutlineGeometryBatch.prototype.remove = function(updater) {\n        var i;\n\n        var solidBatches = this._solidBatches.values;\n        var solidBatchesLength = solidBatches.length;\n        for (i = 0; i < solidBatchesLength; i++) {\n            if (solidBatches[i].remove(updater)) {\n                return;\n            }\n        }\n\n        var translucentBatches = this._translucentBatches.values;\n        var translucentBatchesLength = translucentBatches.length;\n        for (i = 0; i < translucentBatchesLength; i++) {\n            if (translucentBatches[i].remove(updater)) {\n                return;\n            }\n        }\n    };\n\n    StaticOutlineGeometryBatch.prototype.update = function(time) {\n        var i;\n        var x;\n        var updater;\n        var batch;\n        var solidBatches = this._solidBatches.values;\n        var solidBatchesLength = solidBatches.length;\n        var translucentBatches = this._translucentBatches.values;\n        var translucentBatchesLength = translucentBatches.length;\n        var itemsToRemove;\n        var isUpdated = true;\n        var needUpdate = false;\n\n        do {\n            needUpdate = false;\n            for (x = 0; x < solidBatchesLength; x++) {\n                batch = solidBatches[x];\n                //Perform initial update\n                isUpdated = batch.update(time);\n\n                //If any items swapped between solid/translucent, we need to\n                //move them between batches\n                itemsToRemove = batch.itemsToRemove;\n                var solidsToMoveLength = itemsToRemove.length;\n                if (solidsToMoveLength > 0) {\n                    needUpdate = true;\n                    for (i = 0; i < solidsToMoveLength; i++) {\n                        updater = itemsToRemove[i];\n                        batch.remove(updater);\n                        this.add(time, updater);\n                    }\n                }\n            }\n            for (x = 0; x < translucentBatchesLength; x++) {\n                batch = translucentBatches[x];\n                //Perform initial update\n                isUpdated = batch.update(time);\n\n                //If any items swapped between solid/translucent, we need to\n                //move them between batches\n                itemsToRemove = batch.itemsToRemove;\n                var translucentToMoveLength = itemsToRemove.length;\n                if (translucentToMoveLength > 0) {\n                    needUpdate = true;\n                    for (i = 0; i < translucentToMoveLength; i++) {\n                        updater = itemsToRemove[i];\n                        batch.remove(updater);\n                        this.add(time, updater);\n                    }\n                }\n            }\n        } while (needUpdate);\n\n        return isUpdated;\n    };\n\n    StaticOutlineGeometryBatch.prototype.getBoundingSphere = function(updater, result) {\n        var i;\n\n        var solidBatches = this._solidBatches.values;\n        var solidBatchesLength = solidBatches.length;\n        for (i = 0; i < solidBatchesLength; i++) {\n            var solidBatch = solidBatches[i];\n            if (solidBatch.contains(updater)){\n                return solidBatch.getBoundingSphere(updater, result);\n            }\n        }\n\n        var translucentBatches = this._translucentBatches.values;\n        var translucentBatchesLength = translucentBatches.length;\n        for (i = 0; i < translucentBatchesLength; i++) {\n            var translucentBatch = translucentBatches[i];\n            if (translucentBatch.contains(updater)){\n                return translucentBatch.getBoundingSphere(updater, result);\n            }\n        }\n\n        return BoundingSphereState.FAILED;\n    };\n\n    StaticOutlineGeometryBatch.prototype.removeAllPrimitives = function() {\n        var i;\n\n        var solidBatches = this._solidBatches.values;\n        var solidBatchesLength = solidBatches.length;\n        for (i = 0; i < solidBatchesLength; i++) {\n            solidBatches[i].removeAllPrimitives();\n        }\n\n        var translucentBatches = this._translucentBatches.values;\n        var translucentBatchesLength = translucentBatches.length;\n        for (i = 0; i < translucentBatchesLength; i++) {\n            translucentBatches[i].removeAllPrimitives();\n        }\n    };\nexport default StaticOutlineGeometryBatch;\n","import Cartographic from './Cartographic.js';\nimport defined from './defined.js';\nimport EllipsoidTangentPlane from './EllipsoidTangentPlane.js';\nimport CesiumMath from './Math.js';\nimport PolygonPipeline from './PolygonPipeline.js';\nimport PolylinePipeline from './PolylinePipeline.js';\nimport WindingOrder from './WindingOrder.js';\n\n    /**\n     * private\n     */\n    var WallGeometryLibrary = {};\n\n    function latLonEquals(c0, c1) {\n        return ((CesiumMath.equalsEpsilon(c0.latitude, c1.latitude, CesiumMath.EPSILON14)) && (CesiumMath.equalsEpsilon(c0.longitude, c1.longitude, CesiumMath.EPSILON14)));\n    }\n\n    var scratchCartographic1 = new Cartographic();\n    var scratchCartographic2 = new Cartographic();\n    function removeDuplicates(ellipsoid, positions, topHeights, bottomHeights) {\n        var length = positions.length;\n        if (length < 2) {\n            return;\n        }\n\n        var hasBottomHeights = defined(bottomHeights);\n        var hasTopHeights = defined(topHeights);\n        var hasAllZeroHeights = true;\n\n        var cleanedPositions = new Array(length);\n        var cleanedTopHeights = new Array(length);\n        var cleanedBottomHeights = new Array(length);\n\n        var v0 = positions[0];\n        cleanedPositions[0] = v0;\n\n        var c0 = ellipsoid.cartesianToCartographic(v0, scratchCartographic1);\n        if (hasTopHeights) {\n            c0.height = topHeights[0];\n        }\n\n        hasAllZeroHeights = hasAllZeroHeights && c0.height <= 0;\n\n        cleanedTopHeights[0] = c0.height;\n\n        if (hasBottomHeights) {\n            cleanedBottomHeights[0] = bottomHeights[0];\n        } else {\n            cleanedBottomHeights[0] = 0.0;\n        }\n\n        var index = 1;\n        for (var i = 1; i < length; ++i) {\n            var v1 = positions[i];\n            var c1 = ellipsoid.cartesianToCartographic(v1, scratchCartographic2);\n            if (hasTopHeights) {\n                c1.height = topHeights[i];\n            }\n            hasAllZeroHeights = hasAllZeroHeights && c1.height <= 0;\n\n            if (!latLonEquals(c0, c1)) {\n                cleanedPositions[index] = v1; // Shallow copy!\n                cleanedTopHeights[index] = c1.height;\n\n                if (hasBottomHeights) {\n                    cleanedBottomHeights[index] = bottomHeights[i];\n                } else {\n                    cleanedBottomHeights[index] = 0.0;\n                }\n\n                Cartographic.clone(c1, c0);\n                ++index;\n            } else if (c0.height < c1.height) {\n                cleanedTopHeights[index - 1] = c1.height;\n            }\n        }\n\n        if (hasAllZeroHeights || index < 2) {\n            return;\n        }\n\n        cleanedPositions.length = index;\n        cleanedTopHeights.length = index;\n        cleanedBottomHeights.length = index;\n\n        return {\n            positions: cleanedPositions,\n            topHeights: cleanedTopHeights,\n            bottomHeights: cleanedBottomHeights\n        };\n    }\n\n    var positionsArrayScratch = new Array(2);\n    var heightsArrayScratch = new Array(2);\n    var generateArcOptionsScratch = {\n        positions : undefined,\n        height : undefined,\n        granularity : undefined,\n        ellipsoid : undefined\n    };\n\n    /**\n     * @private\n     */\n    WallGeometryLibrary.computePositions = function(ellipsoid, wallPositions, maximumHeights, minimumHeights, granularity, duplicateCorners) {\n        var o = removeDuplicates(ellipsoid, wallPositions, maximumHeights, minimumHeights);\n\n        if (!defined(o)) {\n            return;\n        }\n\n        wallPositions = o.positions;\n        maximumHeights = o.topHeights;\n        minimumHeights = o.bottomHeights;\n\n        if (wallPositions.length >= 3) {\n            // Order positions counter-clockwise\n            var tangentPlane = EllipsoidTangentPlane.fromPoints(wallPositions, ellipsoid);\n            var positions2D = tangentPlane.projectPointsOntoPlane(wallPositions);\n\n            if (PolygonPipeline.computeWindingOrder2D(positions2D) === WindingOrder.CLOCKWISE) {\n                wallPositions.reverse();\n                maximumHeights.reverse();\n                minimumHeights.reverse();\n            }\n        }\n\n        var length = wallPositions.length;\n        var numCorners = length - 2;\n        var topPositions;\n        var bottomPositions;\n\n        var minDistance = CesiumMath.chordLength(granularity, ellipsoid.maximumRadius);\n\n        var generateArcOptions = generateArcOptionsScratch;\n        generateArcOptions.minDistance = minDistance;\n        generateArcOptions.ellipsoid = ellipsoid;\n\n        if (duplicateCorners) {\n            var count = 0;\n            var i;\n\n            for (i = 0; i < length - 1; i++) {\n                count += PolylinePipeline.numberOfPoints(wallPositions[i], wallPositions[i+1], minDistance) + 1;\n            }\n\n            topPositions = new Float64Array(count * 3);\n            bottomPositions = new Float64Array(count * 3);\n\n            var generateArcPositions = positionsArrayScratch;\n            var generateArcHeights = heightsArrayScratch;\n            generateArcOptions.positions = generateArcPositions;\n            generateArcOptions.height = generateArcHeights;\n\n            var offset = 0;\n            for (i = 0; i < length - 1; i++) {\n                generateArcPositions[0] = wallPositions[i];\n                generateArcPositions[1] = wallPositions[i + 1];\n\n                generateArcHeights[0] = maximumHeights[i];\n                generateArcHeights[1] = maximumHeights[i + 1];\n\n                var pos = PolylinePipeline.generateArc(generateArcOptions);\n                topPositions.set(pos, offset);\n\n                generateArcHeights[0] = minimumHeights[i];\n                generateArcHeights[1] = minimumHeights[i + 1];\n\n                bottomPositions.set(PolylinePipeline.generateArc(generateArcOptions), offset);\n\n                offset += pos.length;\n            }\n        } else {\n            generateArcOptions.positions = wallPositions;\n            generateArcOptions.height = maximumHeights;\n            topPositions = new Float64Array(PolylinePipeline.generateArc(generateArcOptions));\n\n            generateArcOptions.height = minimumHeights;\n            bottomPositions = new Float64Array(PolylinePipeline.generateArc(generateArcOptions));\n        }\n\n        return {\n            bottomPositions: bottomPositions,\n            topPositions: topPositions,\n            numCorners: numCorners\n        };\n    };\nexport default WallGeometryLibrary;\n","import BoundingSphere from './BoundingSphere.js';\nimport Cartesian3 from './Cartesian3.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport DeveloperError from './DeveloperError.js';\nimport Ellipsoid from './Ellipsoid.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport IndexDatatype from './IndexDatatype.js';\nimport CesiumMath from './Math.js';\nimport PrimitiveType from './PrimitiveType.js';\nimport VertexFormat from './VertexFormat.js';\nimport WallGeometryLibrary from './WallGeometryLibrary.js';\n\n    var scratchCartesian3Position1 = new Cartesian3();\n    var scratchCartesian3Position2 = new Cartesian3();\n    var scratchCartesian3Position3 = new Cartesian3();\n    var scratchCartesian3Position4 = new Cartesian3();\n    var scratchCartesian3Position5 = new Cartesian3();\n    var scratchBitangent = new Cartesian3();\n    var scratchTangent = new Cartesian3();\n    var scratchNormal = new Cartesian3();\n\n    /**\n     * A description of a wall, which is similar to a KML line string. A wall is defined by a series of points,\n     * which extrude down to the ground. Optionally, they can extrude downwards to a specified height.\n     *\n     * @alias WallGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3[]} options.positions An array of Cartesian objects, which are the points of the wall.\n     * @param {Number} [options.granularity=CesiumMath.RADIANS_PER_DEGREE] The distance, in radians, between each latitude and longitude. Determines the number of positions in the buffer.\n     * @param {Number[]} [options.maximumHeights] An array parallel to <code>positions</code> that give the maximum height of the\n     *        wall at <code>positions</code>. If undefined, the height of each position in used.\n     * @param {Number[]} [options.minimumHeights] An array parallel to <code>positions</code> that give the minimum height of the\n     *        wall at <code>positions</code>. If undefined, the height at each position is 0.0.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid for coordinate manipulation\n     * @param {VertexFormat} [options.vertexFormat=VertexFormat.DEFAULT] The vertex attributes to be computed.\n     *\n     * @exception {DeveloperError} positions length must be greater than or equal to 2.\n     * @exception {DeveloperError} positions and maximumHeights must have the same length.\n     * @exception {DeveloperError} positions and minimumHeights must have the same length.\n     *\n     * @see WallGeometry#createGeometry\n     * @see WallGeometry#fromConstantHeight\n     *\n     * @demo {@link https://sandcastle.cesium.com/index.html?src=Wall.html|Cesium Sandcastle Wall Demo}\n     *\n     * @example\n     * // create a wall that spans from ground level to 10000 meters\n     * var wall = new Cesium.WallGeometry({\n     *   positions : Cesium.Cartesian3.fromDegreesArrayHeights([\n     *     19.0, 47.0, 10000.0,\n     *     19.0, 48.0, 10000.0,\n     *     20.0, 48.0, 10000.0,\n     *     20.0, 47.0, 10000.0,\n     *     19.0, 47.0, 10000.0\n     *   ])\n     * });\n     * var geometry = Cesium.WallGeometry.createGeometry(wall);\n     */\n    function WallGeometry(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        var wallPositions = options.positions;\n        var maximumHeights = options.maximumHeights;\n        var minimumHeights = options.minimumHeights;\n\n        \n\n        var vertexFormat = defaultValue(options.vertexFormat, VertexFormat.DEFAULT);\n        var granularity = defaultValue(options.granularity, CesiumMath.RADIANS_PER_DEGREE);\n        var ellipsoid = defaultValue(options.ellipsoid, Ellipsoid.WGS84);\n\n        this._positions = wallPositions;\n        this._minimumHeights = minimumHeights;\n        this._maximumHeights = maximumHeights;\n        this._vertexFormat = VertexFormat.clone(vertexFormat);\n        this._granularity = granularity;\n        this._ellipsoid = Ellipsoid.clone(ellipsoid);\n        this._workerName = 'createWallGeometry';\n\n        var numComponents = 1 + wallPositions.length * Cartesian3.packedLength + 2;\n        if (defined(minimumHeights)) {\n            numComponents += minimumHeights.length;\n        }\n        if (defined(maximumHeights)) {\n            numComponents += maximumHeights.length;\n        }\n\n        /**\n         * The number of elements used to pack the object into an array.\n         * @type {Number}\n         */\n        this.packedLength = numComponents + Ellipsoid.packedLength + VertexFormat.packedLength + 1;\n    }\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {WallGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    WallGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var i;\n\n        var positions = value._positions;\n        var length = positions.length;\n        array[startingIndex++] = length;\n\n        for (i = 0; i < length; ++i, startingIndex += Cartesian3.packedLength) {\n            Cartesian3.pack(positions[i], array, startingIndex);\n        }\n\n        var minimumHeights = value._minimumHeights;\n        length = defined(minimumHeights) ? minimumHeights.length : 0;\n        array[startingIndex++] = length;\n\n        if (defined(minimumHeights)) {\n            for (i = 0; i < length; ++i) {\n                array[startingIndex++] = minimumHeights[i];\n            }\n        }\n\n        var maximumHeights = value._maximumHeights;\n        length = defined(maximumHeights) ? maximumHeights.length : 0;\n        array[startingIndex++] = length;\n\n        if (defined(maximumHeights)) {\n            for (i = 0; i < length; ++i) {\n                array[startingIndex++] = maximumHeights[i];\n            }\n        }\n\n        Ellipsoid.pack(value._ellipsoid, array, startingIndex);\n        startingIndex += Ellipsoid.packedLength;\n\n        VertexFormat.pack(value._vertexFormat, array, startingIndex);\n        startingIndex += VertexFormat.packedLength;\n\n        array[startingIndex] = value._granularity;\n\n        return array;\n    };\n\n    var scratchEllipsoid = Ellipsoid.clone(Ellipsoid.UNIT_SPHERE);\n    var scratchVertexFormat = new VertexFormat();\n    var scratchOptions = {\n        positions : undefined,\n        minimumHeights : undefined,\n        maximumHeights : undefined,\n        ellipsoid : scratchEllipsoid,\n        vertexFormat : scratchVertexFormat,\n        granularity : undefined\n    };\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {WallGeometry} [result] The object into which to store the result.\n     * @returns {WallGeometry} The modified result parameter or a new WallGeometry instance if one was not provided.\n     */\n    WallGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var i;\n\n        var length = array[startingIndex++];\n        var positions = new Array(length);\n\n        for (i = 0; i < length; ++i, startingIndex += Cartesian3.packedLength) {\n            positions[i] = Cartesian3.unpack(array, startingIndex);\n        }\n\n        length = array[startingIndex++];\n        var minimumHeights;\n\n        if (length > 0) {\n            minimumHeights = new Array(length);\n            for (i = 0; i < length; ++i) {\n                minimumHeights[i] = array[startingIndex++];\n            }\n        }\n\n        length = array[startingIndex++];\n        var maximumHeights;\n\n        if (length > 0) {\n            maximumHeights = new Array(length);\n            for (i = 0; i < length; ++i) {\n                maximumHeights[i] = array[startingIndex++];\n            }\n        }\n\n        var ellipsoid = Ellipsoid.unpack(array, startingIndex, scratchEllipsoid);\n        startingIndex += Ellipsoid.packedLength;\n\n        var vertexFormat = VertexFormat.unpack(array, startingIndex, scratchVertexFormat);\n        startingIndex += VertexFormat.packedLength;\n\n        var granularity = array[startingIndex];\n\n        if (!defined(result)) {\n            scratchOptions.positions = positions;\n            scratchOptions.minimumHeights = minimumHeights;\n            scratchOptions.maximumHeights = maximumHeights;\n            scratchOptions.granularity = granularity;\n            return new WallGeometry(scratchOptions);\n        }\n\n        result._positions = positions;\n        result._minimumHeights = minimumHeights;\n        result._maximumHeights = maximumHeights;\n        result._ellipsoid = Ellipsoid.clone(ellipsoid, result._ellipsoid);\n        result._vertexFormat = VertexFormat.clone(vertexFormat, result._vertexFormat);\n        result._granularity = granularity;\n\n        return result;\n    };\n\n    /**\n     * A description of a wall, which is similar to a KML line string. A wall is defined by a series of points,\n     * which extrude down to the ground. Optionally, they can extrude downwards to a specified height.\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3[]} options.positions An array of Cartesian objects, which are the points of the wall.\n     * @param {Number} [options.maximumHeight] A constant that defines the maximum height of the\n     *        wall at <code>positions</code>. If undefined, the height of each position in used.\n     * @param {Number} [options.minimumHeight] A constant that defines the minimum height of the\n     *        wall at <code>positions</code>. If undefined, the height at each position is 0.0.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid for coordinate manipulation\n     * @param {VertexFormat} [options.vertexFormat=VertexFormat.DEFAULT] The vertex attributes to be computed.\n     * @returns {WallGeometry}\n     *\n     *\n     * @example\n     * // create a wall that spans from 10000 meters to 20000 meters\n     * var wall = Cesium.WallGeometry.fromConstantHeights({\n     *   positions : Cesium.Cartesian3.fromDegreesArray([\n     *     19.0, 47.0,\n     *     19.0, 48.0,\n     *     20.0, 48.0,\n     *     20.0, 47.0,\n     *     19.0, 47.0,\n     *   ]),\n     *   minimumHeight : 20000.0,\n     *   maximumHeight : 10000.0\n     * });\n     * var geometry = Cesium.WallGeometry.createGeometry(wall);\n     *\n     * @see WallGeometry#createGeometry\n     */\n    WallGeometry.fromConstantHeights = function(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n        var positions = options.positions;\n\n        \n\n        var minHeights;\n        var maxHeights;\n\n        var min = options.minimumHeight;\n        var max = options.maximumHeight;\n\n        var doMin = defined(min);\n        var doMax = defined(max);\n        if (doMin || doMax) {\n            var length = positions.length;\n            minHeights = (doMin) ? new Array(length) : undefined;\n            maxHeights = (doMax) ? new Array(length) : undefined;\n\n            for (var i = 0; i < length; ++i) {\n                if (doMin) {\n                    minHeights[i] = min;\n                }\n\n                if (doMax) {\n                    maxHeights[i] = max;\n                }\n            }\n        }\n\n        var newOptions = {\n            positions : positions,\n            maximumHeights : maxHeights,\n            minimumHeights : minHeights,\n            ellipsoid : options.ellipsoid,\n            vertexFormat : options.vertexFormat\n        };\n        return new WallGeometry(newOptions);\n    };\n\n    /**\n     * Computes the geometric representation of a wall, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {WallGeometry} wallGeometry A description of the wall.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    WallGeometry.createGeometry = function(wallGeometry) {\n        var wallPositions = wallGeometry._positions;\n        var minimumHeights = wallGeometry._minimumHeights;\n        var maximumHeights = wallGeometry._maximumHeights;\n        var vertexFormat = wallGeometry._vertexFormat;\n        var granularity = wallGeometry._granularity;\n        var ellipsoid = wallGeometry._ellipsoid;\n\n        var pos = WallGeometryLibrary.computePositions(ellipsoid, wallPositions, maximumHeights, minimumHeights, granularity, true);\n        if (!defined(pos)) {\n            return;\n        }\n\n        var bottomPositions = pos.bottomPositions;\n        var topPositions = pos.topPositions;\n        var numCorners = pos.numCorners;\n\n        var length = topPositions.length;\n        var size = length * 2;\n\n        var positions = vertexFormat.position ? new Float64Array(size) : undefined;\n        var normals = vertexFormat.normal ? new Float32Array(size) : undefined;\n        var tangents = vertexFormat.tangent ? new Float32Array(size) : undefined;\n        var bitangents = vertexFormat.bitangent ? new Float32Array(size) : undefined;\n        var textureCoordinates = vertexFormat.st ? new Float32Array(size / 3 * 2) : undefined;\n\n        var positionIndex = 0;\n        var normalIndex = 0;\n        var bitangentIndex = 0;\n        var tangentIndex = 0;\n        var stIndex = 0;\n\n        // add lower and upper points one after the other, lower\n        // points being even and upper points being odd\n        var normal = scratchNormal;\n        var tangent = scratchTangent;\n        var bitangent = scratchBitangent;\n        var recomputeNormal = true;\n        length /= 3;\n        var i;\n        var s = 0;\n        var ds = 1/(length - wallPositions.length + 1);\n        for (i = 0; i < length; ++i) {\n            var i3 = i * 3;\n            var topPosition = Cartesian3.fromArray(topPositions, i3, scratchCartesian3Position1);\n            var bottomPosition = Cartesian3.fromArray(bottomPositions, i3, scratchCartesian3Position2);\n            if (vertexFormat.position) {\n                // insert the lower point\n                positions[positionIndex++] = bottomPosition.x;\n                positions[positionIndex++] = bottomPosition.y;\n                positions[positionIndex++] = bottomPosition.z;\n\n                // insert the upper point\n                positions[positionIndex++] = topPosition.x;\n                positions[positionIndex++] = topPosition.y;\n                positions[positionIndex++] = topPosition.z;\n            }\n\n            if (vertexFormat.st) {\n                textureCoordinates[stIndex++] = s;\n                textureCoordinates[stIndex++] = 0.0;\n\n                textureCoordinates[stIndex++] = s;\n                textureCoordinates[stIndex++] = 1.0;\n            }\n\n            if (vertexFormat.normal || vertexFormat.tangent || vertexFormat.bitangent) {\n                var nextPosition;\n                var nextTop = Cartesian3.clone(Cartesian3.ZERO, scratchCartesian3Position5);\n                var groundPosition = ellipsoid.scaleToGeodeticSurface(Cartesian3.fromArray(topPositions, i3, scratchCartesian3Position2), scratchCartesian3Position2);\n                if (i + 1 < length) {\n                    nextPosition = ellipsoid.scaleToGeodeticSurface(Cartesian3.fromArray(topPositions, i3 + 3, scratchCartesian3Position3), scratchCartesian3Position3);\n                    nextTop = Cartesian3.fromArray(topPositions, i3 + 3, scratchCartesian3Position5);\n                }\n\n                if (recomputeNormal) {\n                    var scalednextPosition = Cartesian3.subtract(nextTop, topPosition, scratchCartesian3Position4);\n                    var scaledGroundPosition = Cartesian3.subtract(groundPosition, topPosition, scratchCartesian3Position1);\n                    normal = Cartesian3.normalize(Cartesian3.cross(scaledGroundPosition, scalednextPosition, normal), normal);\n                    recomputeNormal = false;\n                }\n\n                if (Cartesian3.equalsEpsilon(nextPosition, groundPosition, CesiumMath.EPSILON10)) {\n                    recomputeNormal = true;\n                } else {\n                    s += ds;\n                    if (vertexFormat.tangent) {\n                        tangent = Cartesian3.normalize(Cartesian3.subtract(nextPosition, groundPosition, tangent), tangent);\n                    }\n                    if (vertexFormat.bitangent) {\n                        bitangent = Cartesian3.normalize(Cartesian3.cross(normal, tangent, bitangent), bitangent);\n                    }\n                }\n\n                if (vertexFormat.normal) {\n                    normals[normalIndex++] = normal.x;\n                    normals[normalIndex++] = normal.y;\n                    normals[normalIndex++] = normal.z;\n\n                    normals[normalIndex++] = normal.x;\n                    normals[normalIndex++] = normal.y;\n                    normals[normalIndex++] = normal.z;\n                }\n\n                if (vertexFormat.tangent) {\n                    tangents[tangentIndex++] = tangent.x;\n                    tangents[tangentIndex++] = tangent.y;\n                    tangents[tangentIndex++] = tangent.z;\n\n                    tangents[tangentIndex++] = tangent.x;\n                    tangents[tangentIndex++] = tangent.y;\n                    tangents[tangentIndex++] = tangent.z;\n                }\n\n                if (vertexFormat.bitangent) {\n                    bitangents[bitangentIndex++] = bitangent.x;\n                    bitangents[bitangentIndex++] = bitangent.y;\n                    bitangents[bitangentIndex++] = bitangent.z;\n\n                    bitangents[bitangentIndex++] = bitangent.x;\n                    bitangents[bitangentIndex++] = bitangent.y;\n                    bitangents[bitangentIndex++] = bitangent.z;\n                }\n            }\n        }\n\n        var attributes = new GeometryAttributes();\n\n        if (vertexFormat.position) {\n            attributes.position = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.DOUBLE,\n                componentsPerAttribute : 3,\n                values : positions\n            });\n        }\n\n        if (vertexFormat.normal) {\n            attributes.normal = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : normals\n            });\n        }\n\n        if (vertexFormat.tangent) {\n            attributes.tangent = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : tangents\n            });\n        }\n\n        if (vertexFormat.bitangent) {\n            attributes.bitangent = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 3,\n                values : bitangents\n            });\n        }\n\n        if (vertexFormat.st) {\n            attributes.st = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 2,\n                values : textureCoordinates\n            });\n        }\n\n        // prepare the side walls, two triangles for each wall\n        //\n        //    A (i+1)  B (i+3) E\n        //    +--------+-------+\n        //    |      / |      /|    triangles:  A C B\n        //    |     /  |     / |                B C D\n        //    |    /   |    /  |\n        //    |   /    |   /   |\n        //    |  /     |  /    |\n        //    | /      | /     |\n        //    +--------+-------+\n        //    C (i)    D (i+2) F\n        //\n\n        var numVertices = size / 3;\n        size -= 6 * (numCorners + 1);\n        var indices = IndexDatatype.createTypedArray(numVertices, size);\n\n        var edgeIndex = 0;\n        for (i = 0; i < numVertices - 2; i += 2) {\n            var LL = i;\n            var LR = i + 2;\n            var pl = Cartesian3.fromArray(positions, LL * 3, scratchCartesian3Position1);\n            var pr = Cartesian3.fromArray(positions, LR * 3, scratchCartesian3Position2);\n            if (Cartesian3.equalsEpsilon(pl, pr, CesiumMath.EPSILON10)) {\n                continue;\n            }\n            var UL = i + 1;\n            var UR = i + 3;\n\n            indices[edgeIndex++] = UL;\n            indices[edgeIndex++] = LL;\n            indices[edgeIndex++] = UR;\n            indices[edgeIndex++] = UR;\n            indices[edgeIndex++] = LL;\n            indices[edgeIndex++] = LR;\n        }\n\n        return new Geometry({\n            attributes : attributes,\n            indices : indices,\n            primitiveType : PrimitiveType.TRIANGLES,\n            boundingSphere : new BoundingSphere.fromVertices(positions)\n        });\n    };\nexport default WallGeometry;\n","import BoundingSphere from './BoundingSphere.js';\nimport Cartesian3 from './Cartesian3.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport DeveloperError from './DeveloperError.js';\nimport Ellipsoid from './Ellipsoid.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport IndexDatatype from './IndexDatatype.js';\nimport CesiumMath from './Math.js';\nimport PrimitiveType from './PrimitiveType.js';\nimport WallGeometryLibrary from './WallGeometryLibrary.js';\n\n    var scratchCartesian3Position1 = new Cartesian3();\n    var scratchCartesian3Position2 = new Cartesian3();\n\n    /**\n     * A description of a wall outline. A wall is defined by a series of points,\n     * which extrude down to the ground. Optionally, they can extrude downwards to a specified height.\n     *\n     * @alias WallOutlineGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3[]} options.positions An array of Cartesian objects, which are the points of the wall.\n     * @param {Number} [options.granularity=CesiumMath.RADIANS_PER_DEGREE] The distance, in radians, between each latitude and longitude. Determines the number of positions in the buffer.\n     * @param {Number[]} [options.maximumHeights] An array parallel to <code>positions</code> that give the maximum height of the\n     *        wall at <code>positions</code>. If undefined, the height of each position in used.\n     * @param {Number[]} [options.minimumHeights] An array parallel to <code>positions</code> that give the minimum height of the\n     *        wall at <code>positions</code>. If undefined, the height at each position is 0.0.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid for coordinate manipulation\n     *\n     * @exception {DeveloperError} positions length must be greater than or equal to 2.\n     * @exception {DeveloperError} positions and maximumHeights must have the same length.\n     * @exception {DeveloperError} positions and minimumHeights must have the same length.\n     *\n     * @see WallGeometry#createGeometry\n     * @see WallGeometry#fromConstantHeight\n     *\n     * @example\n     * // create a wall outline that spans from ground level to 10000 meters\n     * var wall = new Cesium.WallOutlineGeometry({\n     *   positions : Cesium.Cartesian3.fromDegreesArrayHeights([\n     *     19.0, 47.0, 10000.0,\n     *     19.0, 48.0, 10000.0,\n     *     20.0, 48.0, 10000.0,\n     *     20.0, 47.0, 10000.0,\n     *     19.0, 47.0, 10000.0\n     *   ])\n     * });\n     * var geometry = Cesium.WallOutlineGeometry.createGeometry(wall);\n     */\n    function WallOutlineGeometry(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n        var wallPositions = options.positions;\n        var maximumHeights = options.maximumHeights;\n        var minimumHeights = options.minimumHeights;\n\n        \n\n        var granularity = defaultValue(options.granularity, CesiumMath.RADIANS_PER_DEGREE);\n        var ellipsoid = defaultValue(options.ellipsoid, Ellipsoid.WGS84);\n\n        this._positions = wallPositions;\n        this._minimumHeights = minimumHeights;\n        this._maximumHeights = maximumHeights;\n        this._granularity = granularity;\n        this._ellipsoid = Ellipsoid.clone(ellipsoid);\n        this._workerName = 'createWallOutlineGeometry';\n\n        var numComponents = 1 + wallPositions.length * Cartesian3.packedLength + 2;\n        if (defined(minimumHeights)) {\n            numComponents += minimumHeights.length;\n        }\n        if (defined(maximumHeights)) {\n            numComponents += maximumHeights.length;\n        }\n\n        /**\n         * The number of elements used to pack the object into an array.\n         * @type {Number}\n         */\n        this.packedLength = numComponents + Ellipsoid.packedLength + 1;\n    }\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {WallOutlineGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    WallOutlineGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var i;\n\n        var positions = value._positions;\n        var length = positions.length;\n        array[startingIndex++] = length;\n\n        for (i = 0; i < length; ++i, startingIndex += Cartesian3.packedLength) {\n            Cartesian3.pack(positions[i], array, startingIndex);\n        }\n\n        var minimumHeights = value._minimumHeights;\n        length = defined(minimumHeights) ? minimumHeights.length : 0;\n        array[startingIndex++] = length;\n\n        if (defined(minimumHeights)) {\n            for (i = 0; i < length; ++i) {\n                array[startingIndex++] = minimumHeights[i];\n            }\n        }\n\n        var maximumHeights = value._maximumHeights;\n        length = defined(maximumHeights) ? maximumHeights.length : 0;\n        array[startingIndex++] = length;\n\n        if (defined(maximumHeights)) {\n            for (i = 0; i < length; ++i) {\n                array[startingIndex++] = maximumHeights[i];\n            }\n        }\n\n        Ellipsoid.pack(value._ellipsoid, array, startingIndex);\n        startingIndex += Ellipsoid.packedLength;\n\n        array[startingIndex]   = value._granularity;\n\n        return array;\n    };\n\n    var scratchEllipsoid = Ellipsoid.clone(Ellipsoid.UNIT_SPHERE);\n    var scratchOptions = {\n        positions : undefined,\n        minimumHeights : undefined,\n        maximumHeights : undefined,\n        ellipsoid : scratchEllipsoid,\n        granularity : undefined\n    };\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {WallOutlineGeometry} [result] The object into which to store the result.\n     * @returns {WallOutlineGeometry} The modified result parameter or a new WallOutlineGeometry instance if one was not provided.\n     */\n    WallOutlineGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var i;\n\n        var length = array[startingIndex++];\n        var positions = new Array(length);\n\n        for (i = 0; i < length; ++i, startingIndex += Cartesian3.packedLength) {\n            positions[i] = Cartesian3.unpack(array, startingIndex);\n        }\n\n        length = array[startingIndex++];\n        var minimumHeights;\n\n        if (length > 0) {\n            minimumHeights = new Array(length);\n            for (i = 0; i < length; ++i) {\n                minimumHeights[i] = array[startingIndex++];\n            }\n        }\n\n        length = array[startingIndex++];\n        var maximumHeights;\n\n        if (length > 0) {\n            maximumHeights = new Array(length);\n            for (i = 0; i < length; ++i) {\n                maximumHeights[i] = array[startingIndex++];\n            }\n        }\n\n        var ellipsoid = Ellipsoid.unpack(array, startingIndex, scratchEllipsoid);\n        startingIndex += Ellipsoid.packedLength;\n\n        var granularity = array[startingIndex];\n\n        if (!defined(result)) {\n            scratchOptions.positions = positions;\n            scratchOptions.minimumHeights = minimumHeights;\n            scratchOptions.maximumHeights = maximumHeights;\n            scratchOptions.granularity = granularity;\n            return new WallOutlineGeometry(scratchOptions);\n        }\n\n        result._positions = positions;\n        result._minimumHeights = minimumHeights;\n        result._maximumHeights = maximumHeights;\n        result._ellipsoid = Ellipsoid.clone(ellipsoid, result._ellipsoid);\n        result._granularity = granularity;\n\n        return result;\n    };\n\n    /**\n     * A description of a walloutline. A wall is defined by a series of points,\n     * which extrude down to the ground. Optionally, they can extrude downwards to a specified height.\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3[]} options.positions An array of Cartesian objects, which are the points of the wall.\n     * @param {Number} [options.maximumHeight] A constant that defines the maximum height of the\n     *        wall at <code>positions</code>. If undefined, the height of each position in used.\n     * @param {Number} [options.minimumHeight] A constant that defines the minimum height of the\n     *        wall at <code>positions</code>. If undefined, the height at each position is 0.0.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid for coordinate manipulation\n     * @returns {WallOutlineGeometry}\n     *\n     *\n     * @example\n     * // create a wall that spans from 10000 meters to 20000 meters\n     * var wall = Cesium.WallOutlineGeometry.fromConstantHeights({\n     *   positions : Cesium.Cartesian3.fromDegreesArray([\n     *     19.0, 47.0,\n     *     19.0, 48.0,\n     *     20.0, 48.0,\n     *     20.0, 47.0,\n     *     19.0, 47.0,\n     *   ]),\n     *   minimumHeight : 20000.0,\n     *   maximumHeight : 10000.0\n     * });\n     * var geometry = Cesium.WallOutlineGeometry.createGeometry(wall);\n     *\n     * @see WallOutlineGeometry#createGeometry\n     */\n    WallOutlineGeometry.fromConstantHeights = function(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n        var positions = options.positions;\n\n        \n\n        var minHeights;\n        var maxHeights;\n\n        var min = options.minimumHeight;\n        var max = options.maximumHeight;\n\n        var doMin = defined(min);\n        var doMax = defined(max);\n        if (doMin || doMax) {\n            var length = positions.length;\n            minHeights = (doMin) ? new Array(length) : undefined;\n            maxHeights = (doMax) ? new Array(length) : undefined;\n\n            for (var i = 0; i < length; ++i) {\n                if (doMin) {\n                    minHeights[i] = min;\n                }\n\n                if (doMax) {\n                    maxHeights[i] = max;\n                }\n            }\n        }\n\n        var newOptions = {\n            positions : positions,\n            maximumHeights : maxHeights,\n            minimumHeights : minHeights,\n            ellipsoid : options.ellipsoid\n        };\n        return new WallOutlineGeometry(newOptions);\n    };\n\n    /**\n     * Computes the geometric representation of a wall outline, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {WallOutlineGeometry} wallGeometry A description of the wall outline.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    WallOutlineGeometry.createGeometry = function(wallGeometry) {\n        var wallPositions = wallGeometry._positions;\n        var minimumHeights = wallGeometry._minimumHeights;\n        var maximumHeights = wallGeometry._maximumHeights;\n        var granularity = wallGeometry._granularity;\n        var ellipsoid = wallGeometry._ellipsoid;\n\n        var pos = WallGeometryLibrary.computePositions(ellipsoid, wallPositions, maximumHeights, minimumHeights, granularity, false);\n        if (!defined(pos)) {\n            return;\n        }\n\n        var bottomPositions = pos.bottomPositions;\n        var topPositions = pos.topPositions;\n\n        var length = topPositions.length;\n        var size = length * 2;\n\n        var positions = new Float64Array(size);\n        var positionIndex = 0;\n\n        // add lower and upper points one after the other, lower\n        // points being even and upper points being odd\n        length /= 3;\n        var i;\n        for (i = 0; i < length; ++i) {\n            var i3 = i * 3;\n            var topPosition = Cartesian3.fromArray(topPositions, i3, scratchCartesian3Position1);\n            var bottomPosition = Cartesian3.fromArray(bottomPositions, i3, scratchCartesian3Position2);\n\n            // insert the lower point\n            positions[positionIndex++] = bottomPosition.x;\n            positions[positionIndex++] = bottomPosition.y;\n            positions[positionIndex++] = bottomPosition.z;\n\n            // insert the upper point\n            positions[positionIndex++] = topPosition.x;\n            positions[positionIndex++] = topPosition.y;\n            positions[positionIndex++] = topPosition.z;\n        }\n\n        var attributes = new GeometryAttributes({\n            position : new GeometryAttribute({\n                componentDatatype : ComponentDatatype.DOUBLE,\n                componentsPerAttribute : 3,\n                values : positions\n            })\n        });\n\n        var numVertices = size / 3;\n        size = 2 * numVertices - 4 + numVertices;\n        var indices = IndexDatatype.createTypedArray(numVertices, size);\n\n        var edgeIndex = 0;\n        for (i = 0; i < numVertices - 2; i += 2) {\n            var LL = i;\n            var LR = i + 2;\n            var pl = Cartesian3.fromArray(positions, LL * 3, scratchCartesian3Position1);\n            var pr = Cartesian3.fromArray(positions, LR * 3, scratchCartesian3Position2);\n            if (Cartesian3.equalsEpsilon(pl, pr, CesiumMath.EPSILON10)) {\n                continue;\n            }\n            var UL = i + 1;\n            var UR = i + 3;\n\n            indices[edgeIndex++] = UL;\n            indices[edgeIndex++] = LL;\n            indices[edgeIndex++] = UL;\n            indices[edgeIndex++] = UR;\n            indices[edgeIndex++] = LL;\n            indices[edgeIndex++] = LR;\n        }\n\n        indices[edgeIndex++] = numVertices - 2;\n        indices[edgeIndex++] = numVertices - 1;\n\n        return new Geometry({\n            attributes : attributes,\n            indices : indices,\n            primitiveType : PrimitiveType.LINES,\n            boundingSphere : new BoundingSphere.fromVertices(positions)\n        });\n    };\nexport default WallOutlineGeometry;\n","import Check from '../Core/Check.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport defined from '../Core/defined.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport DistanceDisplayConditionGeometryInstanceAttribute from '../Core/DistanceDisplayConditionGeometryInstanceAttribute.js';\nimport GeometryInstance from '../Core/GeometryInstance.js';\nimport Iso8601 from '../Core/Iso8601.js';\nimport ShowGeometryInstanceAttribute from '../Core/ShowGeometryInstanceAttribute.js';\nimport WallGeometry from '../Core/WallGeometry.js';\nimport WallOutlineGeometry from '../Core/WallOutlineGeometry.js';\nimport MaterialAppearance from '../Scene/MaterialAppearance.js';\nimport PerInstanceColorAppearance from '../Scene/PerInstanceColorAppearance.js';\nimport ColorMaterialProperty from './ColorMaterialProperty.js';\nimport DynamicGeometryUpdater from './DynamicGeometryUpdater.js';\nimport GeometryUpdater from './GeometryUpdater.js';\nimport Property from './Property.js';\n\n    var scratchColor = new Color();\n\n    function WallGeometryOptions(entity) {\n        this.id = entity;\n        this.vertexFormat = undefined;\n        this.positions = undefined;\n        this.minimumHeights = undefined;\n        this.maximumHeights = undefined;\n        this.granularity = undefined;\n    }\n\n    /**\n     * A {@link GeometryUpdater} for walls.\n     * Clients do not normally create this class directly, but instead rely on {@link DataSourceDisplay}.\n     * @alias WallGeometryUpdater\n     * @constructor\n     *\n     * @param {Entity} entity The entity containing the geometry to be visualized.\n     * @param {Scene} scene The scene where visualization is taking place.\n     */\n    function WallGeometryUpdater(entity, scene) {\n        GeometryUpdater.call(this, {\n            entity : entity,\n            scene : scene,\n            geometryOptions : new WallGeometryOptions(entity),\n            geometryPropertyName : 'wall',\n            observedPropertyNames : ['availability', 'wall']\n        });\n\n        this._onEntityPropertyChanged(entity, 'wall', entity.wall, undefined);\n    }\n\n    if (defined(Object.create)) {\n        WallGeometryUpdater.prototype = Object.create(GeometryUpdater.prototype);\n        WallGeometryUpdater.prototype.constructor = WallGeometryUpdater;\n    }\n\n    /**\n     * Creates the geometry instance which represents the fill of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the filled portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent a filled geometry.\n     */\n    WallGeometryUpdater.prototype.createFillGeometryInstance = function(time) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n\n        var attributes;\n\n        var color;\n        var show = new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._fillProperty.getValue(time));\n        var distanceDisplayCondition = this._distanceDisplayConditionProperty.getValue(time);\n        var distanceDisplayConditionAttribute = DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(distanceDisplayCondition);\n        if (this._materialProperty instanceof ColorMaterialProperty) {\n            var currentColor;\n            if (defined(this._materialProperty.color) && (this._materialProperty.color.isConstant || isAvailable)) {\n                currentColor = this._materialProperty.color.getValue(time, scratchColor);\n            }\n            if (!defined(currentColor)) {\n                currentColor = Color.WHITE;\n            }\n            color = ColorGeometryInstanceAttribute.fromColor(currentColor);\n            attributes = {\n                show : show,\n                distanceDisplayCondition : distanceDisplayConditionAttribute,\n                color : color\n            };\n        } else {\n            attributes = {\n                show : show,\n                distanceDisplayCondition : distanceDisplayConditionAttribute\n            };\n        }\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : new WallGeometry(this._options),\n            attributes : attributes\n        });\n    };\n\n    /**\n     * Creates the geometry instance which represents the outline of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the outline portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent an outlined geometry.\n     */\n    WallGeometryUpdater.prototype.createOutlineGeometryInstance = function(time) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n        var outlineColor = Property.getValueOrDefault(this._outlineColorProperty, time, Color.BLACK, scratchColor);\n        var distanceDisplayCondition = this._distanceDisplayConditionProperty.getValue(time);\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : new WallOutlineGeometry(this._options),\n            attributes : {\n                show : new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time) && this._showOutlineProperty.getValue(time)),\n                color : ColorGeometryInstanceAttribute.fromColor(outlineColor),\n                distanceDisplayCondition : DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(distanceDisplayCondition)\n            }\n        });\n    };\n\n    WallGeometryUpdater.prototype._isHidden = function(entity, wall) {\n        return !defined(wall.positions) || GeometryUpdater.prototype._isHidden.call(this, entity, wall);\n    };\n\n    WallGeometryUpdater.prototype._getIsClosed = function(options) {\n        return false;\n    };\n\n    WallGeometryUpdater.prototype._isDynamic = function(entity, wall) {\n        return !wall.positions.isConstant || //\n               !Property.isConstant(wall.minimumHeights) || //\n               !Property.isConstant(wall.maximumHeights) || //\n               !Property.isConstant(wall.outlineWidth) || //\n               !Property.isConstant(wall.granularity);\n    };\n\n    WallGeometryUpdater.prototype._setStaticOptions = function(entity, wall) {\n        var minimumHeights = wall.minimumHeights;\n        var maximumHeights = wall.maximumHeights;\n        var granularity = wall.granularity;\n        var isColorMaterial = this._materialProperty instanceof ColorMaterialProperty;\n\n        var options = this._options;\n        options.vertexFormat = isColorMaterial ? PerInstanceColorAppearance.VERTEX_FORMAT : MaterialAppearance.MaterialSupport.TEXTURED.vertexFormat;\n        options.positions = wall.positions.getValue(Iso8601.MINIMUM_VALUE, options.positions);\n        options.minimumHeights = defined(minimumHeights) ? minimumHeights.getValue(Iso8601.MINIMUM_VALUE, options.minimumHeights) : undefined;\n        options.maximumHeights = defined(maximumHeights) ? maximumHeights.getValue(Iso8601.MINIMUM_VALUE, options.maximumHeights) : undefined;\n        options.granularity = defined(granularity) ? granularity.getValue(Iso8601.MINIMUM_VALUE) : undefined;\n    };\n\n    WallGeometryUpdater.DynamicGeometryUpdater = DynamicWallGeometryUpdater;\n\n    /**\n     * @private\n     */\n    function DynamicWallGeometryUpdater(geometryUpdater, primitives, groundPrimitives) {\n        DynamicGeometryUpdater.call(this, geometryUpdater, primitives, groundPrimitives);\n    }\n\n    if (defined(Object.create)) {\n        DynamicWallGeometryUpdater.prototype = Object.create(DynamicGeometryUpdater.prototype);\n        DynamicWallGeometryUpdater.prototype.constructor = DynamicWallGeometryUpdater;\n    }\n\n    DynamicWallGeometryUpdater.prototype._isHidden = function(entity, wall, time) {\n        return  !defined(this._options.positions) || DynamicGeometryUpdater.prototype._isHidden.call(this, entity, wall, time);\n    };\n\n    DynamicWallGeometryUpdater.prototype._setOptions = function(entity, wall, time) {\n        var options = this._options;\n        options.positions = Property.getValueOrUndefined(wall.positions, time, options.positions);\n        options.minimumHeights = Property.getValueOrUndefined(wall.minimumHeights, time, options.minimumHeights);\n        options.maximumHeights = Property.getValueOrUndefined(wall.maximumHeights, time, options.maximumHeights);\n        options.granularity = Property.getValueOrUndefined(wall.granularity, time);\n    };\nexport default WallGeometryUpdater;\n","import AssociativeArray from '../Core/AssociativeArray.js';\nimport BoundingSphere from '../Core/BoundingSphere.js';\nimport Check from '../Core/Check.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport Event from '../Core/Event.js';\nimport EventHelper from '../Core/EventHelper.js';\nimport ClassificationType from '../Scene/ClassificationType.js';\nimport MaterialAppearance from '../Scene/MaterialAppearance.js';\nimport PerInstanceColorAppearance from '../Scene/PerInstanceColorAppearance.js';\nimport ShadowMode from '../Scene/ShadowMode.js';\nimport BoundingSphereState from './BoundingSphereState.js';\nimport BoxGeometryUpdater from './BoxGeometryUpdater.js';\nimport ColorMaterialProperty from './ColorMaterialProperty.js';\nimport CorridorGeometryUpdater from './CorridorGeometryUpdater.js';\nimport CylinderGeometryUpdater from './CylinderGeometryUpdater.js';\nimport DynamicGeometryBatch from './DynamicGeometryBatch.js';\nimport EllipseGeometryUpdater from './EllipseGeometryUpdater.js';\nimport EllipsoidGeometryUpdater from './EllipsoidGeometryUpdater.js';\nimport Entity from './Entity.js';\nimport PlaneGeometryUpdater from './PlaneGeometryUpdater.js';\nimport PolygonGeometryUpdater from './PolygonGeometryUpdater.js';\nimport PolylineVolumeGeometryUpdater from './PolylineVolumeGeometryUpdater.js';\nimport RectangleGeometryUpdater from './RectangleGeometryUpdater.js';\nimport StaticGeometryColorBatch from './StaticGeometryColorBatch.js';\nimport StaticGeometryPerMaterialBatch from './StaticGeometryPerMaterialBatch.js';\nimport StaticGroundGeometryColorBatch from './StaticGroundGeometryColorBatch.js';\nimport StaticGroundGeometryPerMaterialBatch from './StaticGroundGeometryPerMaterialBatch.js';\nimport StaticOutlineGeometryBatch from './StaticOutlineGeometryBatch.js';\nimport WallGeometryUpdater from './WallGeometryUpdater.js';\n\n    var emptyArray = [];\n\n    var geometryUpdaters = [BoxGeometryUpdater, CylinderGeometryUpdater, CorridorGeometryUpdater, EllipseGeometryUpdater, EllipsoidGeometryUpdater, PlaneGeometryUpdater,\n                            PolygonGeometryUpdater, PolylineVolumeGeometryUpdater, RectangleGeometryUpdater, WallGeometryUpdater];\n\n    function GeometryUpdaterSet(entity, scene) {\n        this.entity = entity;\n        this.scene = scene;\n        var updaters = new Array(geometryUpdaters.length);\n        var geometryChanged = new Event();\n        function raiseEvent(geometry) {\n            geometryChanged.raiseEvent(geometry);\n        }\n        var eventHelper = new EventHelper();\n        for (var i = 0; i < updaters.length; i++) {\n            var updater = new geometryUpdaters[i](entity, scene);\n            eventHelper.add(updater.geometryChanged, raiseEvent);\n            updaters[i] = updater;\n        }\n        this.updaters = updaters;\n        this.geometryChanged = geometryChanged;\n        this.eventHelper = eventHelper;\n\n        this._removeEntitySubscription = entity.definitionChanged.addEventListener(GeometryUpdaterSet.prototype._onEntityPropertyChanged, this);\n    }\n\n    GeometryUpdaterSet.prototype._onEntityPropertyChanged = function(entity, propertyName, newValue, oldValue) {\n        var updaters = this.updaters;\n        for (var i = 0; i < updaters.length; i++) {\n            updaters[i]._onEntityPropertyChanged(entity, propertyName, newValue, oldValue);\n        }\n    };\n\n    GeometryUpdaterSet.prototype.forEach = function (callback) {\n        var updaters = this.updaters;\n        for (var i = 0; i < updaters.length; i++) {\n            callback(updaters[i]);\n        }\n    };\n\n    GeometryUpdaterSet.prototype.destroy = function() {\n        this.eventHelper.removeAll();\n        var updaters = this.updaters;\n        for (var i = 0; i < updaters.length; i++) {\n            updaters[i].destroy();\n        }\n        this._removeEntitySubscription();\n        destroyObject(this);\n    };\n\n    /**\n     * A general purpose visualizer for geometry represented by {@link Primitive} instances.\n     * @alias GeometryVisualizer\n     * @constructor\n     *\n     * @param {Scene} scene The scene the primitives will be rendered in.\n     * @param {EntityCollection} entityCollection The entityCollection to visualize.\n     * @param {PrimitiveCollection} [primitives=scene.primitives] A collection to add primitives related to the entities\n     * @param {PrimitiveCollection} [groundPrimitives=scene.groundPrimitives] A collection to add ground primitives related to the entities\n     */\n    function GeometryVisualizer(scene, entityCollection, primitives, groundPrimitives) {\n        \n\n        primitives = defaultValue(primitives, scene.primitives);\n        groundPrimitives = defaultValue(groundPrimitives, scene.groundPrimitives);\n\n        this._scene = scene;\n        this._primitives = primitives;\n        this._groundPrimitives = groundPrimitives;\n        this._entityCollection = undefined;\n        this._addedObjects = new AssociativeArray();\n        this._removedObjects = new AssociativeArray();\n        this._changedObjects = new AssociativeArray();\n\n        var numberOfShadowModes = ShadowMode.NUMBER_OF_SHADOW_MODES;\n        this._outlineBatches = new Array(numberOfShadowModes*2);\n        this._closedColorBatches = new Array(numberOfShadowModes*2);\n        this._closedMaterialBatches = new Array(numberOfShadowModes*2);\n        this._openColorBatches = new Array(numberOfShadowModes*2);\n        this._openMaterialBatches = new Array(numberOfShadowModes*2);\n\n        var supportsMaterialsforEntitiesOnTerrain = Entity.supportsMaterialsforEntitiesOnTerrain(scene);\n        this._supportsMaterialsforEntitiesOnTerrain = supportsMaterialsforEntitiesOnTerrain;\n\n        var i;\n        for (i = 0; i < numberOfShadowModes; ++i) {\n            this._outlineBatches[i] = new StaticOutlineGeometryBatch(primitives, scene, i, false);\n            this._outlineBatches[numberOfShadowModes + i] = new StaticOutlineGeometryBatch(primitives, scene, i, true);\n\n            this._closedColorBatches[i] = new StaticGeometryColorBatch(primitives, PerInstanceColorAppearance, undefined, true, i, true);\n            this._closedColorBatches[numberOfShadowModes + i] = new StaticGeometryColorBatch(primitives, PerInstanceColorAppearance, undefined, true, i, false);\n\n            this._closedMaterialBatches[i] = new StaticGeometryPerMaterialBatch(primitives, MaterialAppearance, undefined, true, i, true);\n            this._closedMaterialBatches[numberOfShadowModes + i] = new StaticGeometryPerMaterialBatch(primitives, MaterialAppearance, undefined, true, i, false);\n\n            this._openColorBatches[i] = new StaticGeometryColorBatch(primitives, PerInstanceColorAppearance, undefined, false, i, true);\n            this._openColorBatches[numberOfShadowModes + i] = new StaticGeometryColorBatch(primitives, PerInstanceColorAppearance, undefined, false, i, false);\n\n            this._openMaterialBatches[i] = new StaticGeometryPerMaterialBatch(primitives, MaterialAppearance, undefined, false, i, true);\n            this._openMaterialBatches[numberOfShadowModes + i] = new StaticGeometryPerMaterialBatch(primitives, MaterialAppearance, undefined, false, i, false);\n        }\n\n        var numberOfClassificationTypes = ClassificationType.NUMBER_OF_CLASSIFICATION_TYPES;\n        var groundColorBatches = new Array(numberOfClassificationTypes);\n        var groundMaterialBatches = [];\n        if (supportsMaterialsforEntitiesOnTerrain) {\n            for (i = 0; i < numberOfClassificationTypes; ++i) {\n                groundMaterialBatches.push(new StaticGroundGeometryPerMaterialBatch(groundPrimitives, i, MaterialAppearance));\n                groundColorBatches[i] = new StaticGroundGeometryColorBatch(groundPrimitives, i);\n            }\n        } else {\n            for (i = 0; i < numberOfClassificationTypes; ++i) {\n                groundColorBatches[i] = new StaticGroundGeometryColorBatch(groundPrimitives, i);\n            }\n        }\n\n        this._groundColorBatches = groundColorBatches;\n        this._groundMaterialBatches = groundMaterialBatches;\n\n        this._dynamicBatch = new DynamicGeometryBatch(primitives, groundPrimitives);\n\n        this._batches = this._outlineBatches.concat(this._closedColorBatches, this._closedMaterialBatches, this._openColorBatches, this._openMaterialBatches, this._groundColorBatches, this._groundMaterialBatches, this._dynamicBatch);\n\n        this._subscriptions = new AssociativeArray();\n        this._updaterSets = new AssociativeArray();\n\n        this._entityCollection = entityCollection;\n        entityCollection.collectionChanged.addEventListener(GeometryVisualizer.prototype._onCollectionChanged, this);\n        this._onCollectionChanged(entityCollection, entityCollection.values, emptyArray);\n    }\n\n    /**\n     * Updates all of the primitives created by this visualizer to match their\n     * Entity counterpart at the given time.\n     *\n     * @param {JulianDate} time The time to update to.\n     * @returns {Boolean} True if the visualizer successfully updated to the provided time,\n     * false if the visualizer is waiting for asynchronous primitives to be created.\n     */\n    GeometryVisualizer.prototype.update = function(time) {\n        \n\n        var addedObjects = this._addedObjects;\n        var added = addedObjects.values;\n        var removedObjects = this._removedObjects;\n        var removed = removedObjects.values;\n        var changedObjects = this._changedObjects;\n        var changed = changedObjects.values;\n\n        var i;\n        var entity;\n        var id;\n        var updaterSet;\n        var that = this;\n\n        for (i = changed.length - 1; i > -1; i--) {\n            entity = changed[i];\n            id = entity.id;\n            updaterSet = this._updaterSets.get(id);\n\n            //If in a single update, an entity gets removed and a new instance\n            //re-added with the same id, the updater no longer tracks the\n            //correct entity, we need to both remove the old one and\n            //add the new one, which is done by pushing the entity\n            //onto the removed/added lists.\n            if (updaterSet.entity === entity) {\n                updaterSet.forEach(function(updater) {\n                    that._removeUpdater(updater);\n                    that._insertUpdaterIntoBatch(time, updater);\n                });\n            } else {\n                removed.push(entity);\n                added.push(entity);\n            }\n        }\n\n        for (i = removed.length - 1; i > -1; i--) {\n            entity = removed[i];\n            id = entity.id;\n            updaterSet = this._updaterSets.get(id);\n            updaterSet.forEach(this._removeUpdater.bind(this));\n            updaterSet.destroy();\n            this._updaterSets.remove(id);\n            this._subscriptions.get(id)();\n            this._subscriptions.remove(id);\n        }\n\n        for (i = added.length - 1; i > -1; i--) {\n            entity = added[i];\n            id = entity.id;\n            updaterSet = new GeometryUpdaterSet(entity, this._scene);\n            this._updaterSets.set(id, updaterSet);\n            updaterSet.forEach(function(updater) {\n                that._insertUpdaterIntoBatch(time, updater);\n            });\n            this._subscriptions.set(id, updaterSet.geometryChanged.addEventListener(GeometryVisualizer._onGeometryChanged, this));\n        }\n\n        addedObjects.removeAll();\n        removedObjects.removeAll();\n        changedObjects.removeAll();\n\n        var isUpdated = true;\n        var batches = this._batches;\n        var length = batches.length;\n        for (i = 0; i < length; i++) {\n            isUpdated = batches[i].update(time) && isUpdated;\n        }\n\n        return isUpdated;\n    };\n\n    var getBoundingSphereArrayScratch = [];\n    var getBoundingSphereBoundingSphereScratch = new BoundingSphere();\n\n    /**\n     * Computes a bounding sphere which encloses the visualization produced for the specified entity.\n     * The bounding sphere is in the fixed frame of the scene's globe.\n     *\n     * @param {Entity} entity The entity whose bounding sphere to compute.\n     * @param {BoundingSphere} result The bounding sphere onto which to store the result.\n     * @returns {BoundingSphereState} BoundingSphereState.DONE if the result contains the bounding sphere,\n     *                       BoundingSphereState.PENDING if the result is still being computed, or\n     *                       BoundingSphereState.FAILED if the entity has no visualization in the current scene.\n     * @private\n     */\n    GeometryVisualizer.prototype.getBoundingSphere = function(entity, result) {\n        \n\n        var boundingSpheres = getBoundingSphereArrayScratch;\n        var tmp = getBoundingSphereBoundingSphereScratch;\n\n        var count = 0;\n        var state = BoundingSphereState.DONE;\n        var batches = this._batches;\n        var batchesLength = batches.length;\n\n        var id = entity.id;\n        var updaters = this._updaterSets.get(id).updaters;\n\n        for (var j = 0; j < updaters.length; j++) {\n            var updater = updaters[j];\n            for (var i = 0; i < batchesLength; i++) {\n                state = batches[i].getBoundingSphere(updater, tmp);\n                if (state === BoundingSphereState.PENDING) {\n                    return BoundingSphereState.PENDING;\n                } else if (state === BoundingSphereState.DONE) {\n                    boundingSpheres[count] = BoundingSphere.clone(tmp, boundingSpheres[count]);\n                    count++;\n                }\n            }\n        }\n\n        if (count === 0) {\n            return BoundingSphereState.FAILED;\n        }\n\n        boundingSpheres.length = count;\n        BoundingSphere.fromBoundingSpheres(boundingSpheres, result);\n        return BoundingSphereState.DONE;\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     *\n     * @returns {Boolean} True if this object was destroyed; otherwise, false.\n     */\n    GeometryVisualizer.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Removes and destroys all primitives created by this instance.\n     */\n    GeometryVisualizer.prototype.destroy = function() {\n        this._entityCollection.collectionChanged.removeEventListener(GeometryVisualizer.prototype._onCollectionChanged, this);\n        this._addedObjects.removeAll();\n        this._removedObjects.removeAll();\n\n        var i;\n        var batches = this._batches;\n        var length = batches.length;\n        for (i = 0; i < length; i++) {\n            batches[i].removeAllPrimitives();\n        }\n\n        var subscriptions = this._subscriptions.values;\n        length = subscriptions.length;\n        for (i = 0; i < length; i++) {\n            subscriptions[i]();\n        }\n        this._subscriptions.removeAll();\n\n        var updaterSets = this._updaterSets.values;\n        length = updaterSets.length;\n        for (i = 0; i < length; i++) {\n            updaterSets[i].destroy();\n        }\n        this._updaterSets.removeAll();\n        return destroyObject(this);\n    };\n\n    /**\n     * @private\n     */\n    GeometryVisualizer.prototype._removeUpdater = function(updater) {\n        //We don't keep track of which batch an updater is in, so just remove it from all of them.\n        var batches = this._batches;\n        var length = batches.length;\n        for (var i = 0; i < length; i++) {\n            batches[i].remove(updater);\n        }\n    };\n\n    /**\n     * @private\n     */\n    GeometryVisualizer.prototype._insertUpdaterIntoBatch = function(time, updater) {\n        if (updater.isDynamic) {\n            this._dynamicBatch.add(time, updater);\n            return;\n        }\n\n        var shadows;\n        if (updater.outlineEnabled || updater.fillEnabled) {\n            shadows = updater.shadowsProperty.getValue(time);\n        }\n\n        var numberOfShadowModes = ShadowMode.NUMBER_OF_SHADOW_MODES;\n        if (updater.outlineEnabled) {\n            if (defined(updater.terrainOffsetProperty)) {\n                this._outlineBatches[numberOfShadowModes + shadows].add(time, updater);\n            } else {\n                this._outlineBatches[shadows].add(time, updater);\n            }\n        }\n\n        if (updater.fillEnabled) {\n            if (updater.onTerrain) {\n                var classificationType = updater.classificationTypeProperty.getValue(time);\n                if (updater.fillMaterialProperty instanceof ColorMaterialProperty) {\n                    this._groundColorBatches[classificationType].add(time, updater);\n                } else {\n                    // If unsupported, updater will not be on terrain.\n                    this._groundMaterialBatches[classificationType].add(time, updater);\n                }\n            } else if (updater.isClosed) {\n                if (updater.fillMaterialProperty instanceof ColorMaterialProperty) {\n                    if (defined(updater.terrainOffsetProperty)) {\n                        this._closedColorBatches[numberOfShadowModes + shadows].add(time, updater);\n                    } else {\n                        this._closedColorBatches[shadows].add(time, updater);\n                    }\n                } else if (defined(updater.terrainOffsetProperty)) {\n                    this._closedMaterialBatches[numberOfShadowModes + shadows].add(time, updater);\n                } else {\n                    this._closedMaterialBatches[shadows].add(time, updater);\n                }\n            } else if (updater.fillMaterialProperty instanceof ColorMaterialProperty) {\n                if (defined(updater.terrainOffsetProperty)) {\n                    this._openColorBatches[numberOfShadowModes + shadows].add(time, updater);\n                } else {\n                    this._openColorBatches[shadows].add(time, updater);\n                }\n            } else if (defined(updater.terrainOffsetProperty)) {\n                this._openMaterialBatches[numberOfShadowModes + shadows].add(time, updater);\n            } else {\n                this._openMaterialBatches[shadows].add(time, updater);\n            }\n        }\n    };\n\n    /**\n     * @private\n     */\n    GeometryVisualizer._onGeometryChanged = function(updater) {\n        var removedObjects = this._removedObjects;\n        var changedObjects = this._changedObjects;\n\n        var entity = updater.entity;\n        var id = entity.id;\n\n        if (!defined(removedObjects.get(id)) && !defined(changedObjects.get(id))) {\n            changedObjects.set(id, entity);\n        }\n    };\n\n    /**\n     * @private\n     */\n    GeometryVisualizer.prototype._onCollectionChanged = function(entityCollection, added, removed) {\n        var addedObjects = this._addedObjects;\n        var removedObjects = this._removedObjects;\n        var changedObjects = this._changedObjects;\n\n        var i;\n        var id;\n        var entity;\n        for (i = removed.length - 1; i > -1; i--) {\n            entity = removed[i];\n            id = entity.id;\n            if (!addedObjects.remove(id)) {\n                removedObjects.set(id, entity);\n                changedObjects.remove(id);\n            }\n        }\n\n        for (i = added.length - 1; i > -1; i--) {\n            entity = added[i];\n            id = entity.id;\n            if (removedObjects.remove(id)) {\n                changedObjects.set(id, entity);\n            } else {\n                addedObjects.set(id, entity);\n            }\n        }\n    };\nexport default GeometryVisualizer;\n","import AssociativeArray from '../Core/AssociativeArray.js';\nimport Cartesian2 from '../Core/Cartesian2.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Color from '../Core/Color.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport DistanceDisplayCondition from '../Core/DistanceDisplayCondition.js';\nimport NearFarScalar from '../Core/NearFarScalar.js';\nimport HeightReference from '../Scene/HeightReference.js';\nimport HorizontalOrigin from '../Scene/HorizontalOrigin.js';\nimport LabelStyle from '../Scene/LabelStyle.js';\nimport VerticalOrigin from '../Scene/VerticalOrigin.js';\nimport BoundingSphereState from './BoundingSphereState.js';\nimport Property from './Property.js';\n\n    var defaultScale = 1.0;\n    var defaultFont = '30px sans-serif';\n    var defaultStyle = LabelStyle.FILL;\n    var defaultFillColor = Color.WHITE;\n    var defaultOutlineColor = Color.BLACK;\n    var defaultOutlineWidth = 1.0;\n    var defaultShowBackground = false;\n    var defaultBackgroundColor = new Color(0.165, 0.165, 0.165, 0.8);\n    var defaultBackgroundPadding = new Cartesian2(7, 5);\n    var defaultPixelOffset = Cartesian2.ZERO;\n    var defaultEyeOffset = Cartesian3.ZERO;\n    var defaultHeightReference = HeightReference.NONE;\n    var defaultHorizontalOrigin = HorizontalOrigin.CENTER;\n    var defaultVerticalOrigin = VerticalOrigin.CENTER;\n\n    var positionScratch = new Cartesian3();\n    var fillColorScratch = new Color();\n    var outlineColorScratch = new Color();\n    var backgroundColorScratch = new Color();\n    var backgroundPaddingScratch = new Cartesian2();\n    var eyeOffsetScratch = new Cartesian3();\n    var pixelOffsetScratch = new Cartesian2();\n    var translucencyByDistanceScratch = new NearFarScalar();\n    var pixelOffsetScaleByDistanceScratch = new NearFarScalar();\n    var scaleByDistanceScratch = new NearFarScalar();\n    var distanceDisplayConditionScratch = new DistanceDisplayCondition();\n\n    function EntityData(entity) {\n        this.entity = entity;\n        this.label = undefined;\n        this.index = undefined;\n    }\n\n    /**\n     * A {@link Visualizer} which maps the {@link LabelGraphics} instance\n     * in {@link Entity#label} to a {@link Label}.\n     * @alias LabelVisualizer\n     * @constructor\n     *\n     * @param {EntityCluster} entityCluster The entity cluster to manage the collection of billboards and optionally cluster with other entities.\n     * @param {EntityCollection} entityCollection The entityCollection to visualize.\n     */\n    function LabelVisualizer(entityCluster, entityCollection) {\n        \n\n        entityCollection.collectionChanged.addEventListener(LabelVisualizer.prototype._onCollectionChanged, this);\n\n        this._cluster = entityCluster;\n        this._entityCollection = entityCollection;\n        this._items = new AssociativeArray();\n\n        this._onCollectionChanged(entityCollection, entityCollection.values, [], []);\n    }\n\n    /**\n     * Updates the primitives created by this visualizer to match their\n     * Entity counterpart at the given time.\n     *\n     * @param {JulianDate} time The time to update to.\n     * @returns {Boolean} This function always returns true.\n     */\n    LabelVisualizer.prototype.update = function(time) {\n        \n\n        var items = this._items.values;\n        var cluster = this._cluster;\n\n        for (var i = 0, len = items.length; i < len; i++) {\n            var item = items[i];\n            var entity = item.entity;\n            var labelGraphics = entity._label;\n            var text;\n            var label = item.label;\n            var show = entity.isShowing && entity.isAvailable(time) && Property.getValueOrDefault(labelGraphics._show, time, true);\n            var position;\n            if (show) {\n                position = Property.getValueOrUndefined(entity._position, time, positionScratch);\n                text = Property.getValueOrUndefined(labelGraphics._text, time);\n                show = defined(position) && defined(text);\n            }\n\n            if (!show) {\n                //don't bother creating or updating anything else\n                returnPrimitive(item, entity, cluster);\n                continue;\n            }\n\n            if (!Property.isConstant(entity._position)) {\n                cluster._clusterDirty = true;\n            }\n\n            var updateClamping = false;\n            var heightReference = Property.getValueOrDefault(labelGraphics._heightReference, time, defaultHeightReference);\n\n            if (!defined(label)) {\n                label = cluster.getLabel(entity);\n                label.id = entity;\n                item.label = label;\n\n                // If this new label happens to have a position and height reference that match our new values,\n                // label._updateClamping will not be called automatically. That's a problem because the clamped\n                // height may be based on different terrain than is now loaded. So we'll manually call\n                // _updateClamping below.\n                updateClamping = Cartesian3.equals(label.position, position) && label.heightReference === heightReference;\n            }\n\n            label.show = true;\n            label.position = position;\n            label.text = text;\n            label.scale = Property.getValueOrDefault(labelGraphics._scale, time, defaultScale);\n            label.font = Property.getValueOrDefault(labelGraphics._font, time, defaultFont);\n            label.style = Property.getValueOrDefault(labelGraphics._style, time, defaultStyle);\n            label.fillColor = Property.getValueOrDefault(labelGraphics._fillColor, time, defaultFillColor, fillColorScratch);\n            label.outlineColor = Property.getValueOrDefault(labelGraphics._outlineColor, time, defaultOutlineColor, outlineColorScratch);\n            label.outlineWidth = Property.getValueOrDefault(labelGraphics._outlineWidth, time, defaultOutlineWidth);\n            label.showBackground = Property.getValueOrDefault(labelGraphics._showBackground, time, defaultShowBackground);\n            label.backgroundColor = Property.getValueOrDefault(labelGraphics._backgroundColor, time, defaultBackgroundColor, backgroundColorScratch);\n            label.backgroundPadding = Property.getValueOrDefault(labelGraphics._backgroundPadding, time, defaultBackgroundPadding, backgroundPaddingScratch);\n            label.pixelOffset = Property.getValueOrDefault(labelGraphics._pixelOffset, time, defaultPixelOffset, pixelOffsetScratch);\n            label.eyeOffset = Property.getValueOrDefault(labelGraphics._eyeOffset, time, defaultEyeOffset, eyeOffsetScratch);\n            label.heightReference = heightReference;\n            label.horizontalOrigin = Property.getValueOrDefault(labelGraphics._horizontalOrigin, time, defaultHorizontalOrigin);\n            label.verticalOrigin = Property.getValueOrDefault(labelGraphics._verticalOrigin, time, defaultVerticalOrigin);\n            label.translucencyByDistance = Property.getValueOrUndefined(labelGraphics._translucencyByDistance, time, translucencyByDistanceScratch);\n            label.pixelOffsetScaleByDistance = Property.getValueOrUndefined(labelGraphics._pixelOffsetScaleByDistance, time, pixelOffsetScaleByDistanceScratch);\n            label.scaleByDistance = Property.getValueOrUndefined(labelGraphics._scaleByDistance, time, scaleByDistanceScratch);\n            label.distanceDisplayCondition = Property.getValueOrUndefined(labelGraphics._distanceDisplayCondition, time, distanceDisplayConditionScratch);\n            label.disableDepthTestDistance = Property.getValueOrUndefined(labelGraphics._disableDepthTestDistance, time);\n\n            if (updateClamping) {\n                label._updateClamping();\n            }\n        }\n        return true;\n    };\n\n    /**\n     * Computes a bounding sphere which encloses the visualization produced for the specified entity.\n     * The bounding sphere is in the fixed frame of the scene's globe.\n     *\n     * @param {Entity} entity The entity whose bounding sphere to compute.\n     * @param {BoundingSphere} result The bounding sphere onto which to store the result.\n     * @returns {BoundingSphereState} BoundingSphereState.DONE if the result contains the bounding sphere,\n     *                       BoundingSphereState.PENDING if the result is still being computed, or\n     *                       BoundingSphereState.FAILED if the entity has no visualization in the current scene.\n     * @private\n     */\n    LabelVisualizer.prototype.getBoundingSphere = function(entity, result) {\n        \n\n        var item = this._items.get(entity.id);\n        if (!defined(item) || !defined(item.label)) {\n            return BoundingSphereState.FAILED;\n        }\n\n        var label = item.label;\n        result.center = Cartesian3.clone(defaultValue(label._clampedPosition, label.position), result.center);\n        result.radius = 0;\n        return BoundingSphereState.DONE;\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     *\n     * @returns {Boolean} True if this object was destroyed; otherwise, false.\n     */\n    LabelVisualizer.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Removes and destroys all primitives created by this instance.\n     */\n    LabelVisualizer.prototype.destroy = function() {\n        this._entityCollection.collectionChanged.removeEventListener(LabelVisualizer.prototype._onCollectionChanged, this);\n        var entities = this._entityCollection.values;\n        for (var i = 0; i < entities.length; i++) {\n            this._cluster.removeLabel(entities[i]);\n        }\n        return destroyObject(this);\n    };\n\n    LabelVisualizer.prototype._onCollectionChanged = function(entityCollection, added, removed, changed) {\n        var i;\n        var entity;\n        var items = this._items;\n        var cluster = this._cluster;\n\n        for (i = added.length - 1; i > -1; i--) {\n            entity = added[i];\n            if (defined(entity._label) && defined(entity._position)) {\n                items.set(entity.id, new EntityData(entity));\n            }\n        }\n\n        for (i = changed.length - 1; i > -1; i--) {\n            entity = changed[i];\n            if (defined(entity._label) && defined(entity._position)) {\n                if (!items.contains(entity.id)) {\n                    items.set(entity.id, new EntityData(entity));\n                }\n            } else {\n                returnPrimitive(items.get(entity.id), entity, cluster);\n                items.remove(entity.id);\n            }\n        }\n\n        for (i = removed.length - 1; i > -1; i--) {\n            entity = removed[i];\n            returnPrimitive(items.get(entity.id), entity, cluster);\n            items.remove(entity.id);\n        }\n    };\n\n    function returnPrimitive(item, entity, cluster) {\n        if (defined(item)) {\n            item.label = undefined;\n            cluster.removeLabel(entity);\n        }\n    }\nexport default LabelVisualizer;\n","import AssociativeArray from '../Core/AssociativeArray.js';\nimport Axis from '../Scene/Axis.js';\nimport BoundingSphere from '../Core/BoundingSphere.js';\nimport Cartesian2 from '../Core/Cartesian2.js';\nimport Color from '../Core/Color.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport Resource from '../Core/Resource.js';\nimport ColorBlendMode from '../Scene/ColorBlendMode.js';\nimport HeightReference from '../Scene/HeightReference.js';\nimport Model from '../Scene/Model.js';\nimport ModelAnimationLoop from '../Scene/ModelAnimationLoop.js';\nimport ShadowMode from '../Scene/ShadowMode.js';\nimport BoundingSphereState from './BoundingSphereState.js';\nimport Property from './Property.js';\n\n    var defaultScale = 1.0;\n    var defaultMinimumPixelSize = 0.0;\n    var defaultIncrementallyLoadTextures = true;\n    var defaultClampAnimations = true;\n    var defaultShadows = ShadowMode.ENABLED;\n    var defaultHeightReference = HeightReference.NONE;\n    var defaultSilhouetteColor = Color.RED;\n    var defaultSilhouetteSize = 0.0;\n    var defaultColor = Color.WHITE;\n    var defaultColorBlendMode = ColorBlendMode.HIGHLIGHT;\n    var defaultColorBlendAmount = 0.5;\n    var defaultImageBasedLightingFactor = new Cartesian2(1.0, 1.0);\n    var defaultUpAxis = Axis.Y;\n\n    var modelMatrixScratch = new Matrix4();\n    var nodeMatrixScratch = new Matrix4();\n\n    /**\n     * A {@link Visualizer} which maps {@link Entity#model} to a {@link Model}.\n     * @alias ModelVisualizer\n     * @constructor\n     *\n     * @param {Scene} scene The scene the primitives will be rendered in.\n     * @param {EntityCollection} entityCollection The entityCollection to visualize.\n     */\n    function ModelVisualizer(scene, entityCollection) {\n        \n\n        entityCollection.collectionChanged.addEventListener(ModelVisualizer.prototype._onCollectionChanged, this);\n\n        this._scene = scene;\n        this._primitives = scene.primitives;\n        this._entityCollection = entityCollection;\n        this._modelHash = {};\n        this._entitiesToVisualize = new AssociativeArray();\n        this._onCollectionChanged(entityCollection, entityCollection.values, [], []);\n    }\n\n    /**\n     * Updates models created this visualizer to match their\n     * Entity counterpart at the given time.\n     *\n     * @param {JulianDate} time The time to update to.\n     * @returns {Boolean} This function always returns true.\n     */\n    ModelVisualizer.prototype.update = function(time) {\n        \n\n        var entities = this._entitiesToVisualize.values;\n        var modelHash = this._modelHash;\n        var primitives = this._primitives;\n\n        for (var i = 0, len = entities.length; i < len; i++) {\n            var entity = entities[i];\n            var modelGraphics = entity._model;\n\n            var resource;\n            var modelData = modelHash[entity.id];\n            var show = entity.isShowing && entity.isAvailable(time) && Property.getValueOrDefault(modelGraphics._show, time, true);\n\n            var modelMatrix;\n            if (show) {\n                modelMatrix = entity.computeModelMatrix(time, modelMatrixScratch);\n                resource = Resource.createIfNeeded(Property.getValueOrUndefined(modelGraphics._uri, time));\n                show = defined(modelMatrix) && defined(resource);\n            }\n\n            if (!show) {\n                if (defined(modelData)) {\n                    modelData.modelPrimitive.show = false;\n                }\n                continue;\n            }\n\n            var model = defined(modelData) ? modelData.modelPrimitive : undefined;\n            if (!defined(model) || resource.url !== modelData.url) {\n                if (defined(model)) {\n                    primitives.removeAndDestroy(model);\n                    delete modelHash[entity.id];\n                }\n                model = Model.fromGltf({\n                    url : resource,\n                    incrementallyLoadTextures : Property.getValueOrDefault(modelGraphics._incrementallyLoadTextures, time, defaultIncrementallyLoadTextures),\n                    scene : this._scene\n                });\n                model.id = entity;\n                primitives.add(model);\n\n                modelData = {\n                    modelPrimitive : model,\n                    url : resource.url,\n                    animationsRunning : false,\n                    nodeTransformationsScratch : {},\n                    articulationsScratch : {},\n                    loadFail : false\n                };\n                modelHash[entity.id] = modelData;\n\n                checkModelLoad(model, entity, modelHash);\n            }\n\n            model.show = true;\n            model.scale = Property.getValueOrDefault(modelGraphics._scale, time, defaultScale);\n            model.minimumPixelSize = Property.getValueOrDefault(modelGraphics._minimumPixelSize, time, defaultMinimumPixelSize);\n            model.maximumScale = Property.getValueOrUndefined(modelGraphics._maximumScale, time);\n            model.modelMatrix = Matrix4.clone(modelMatrix, model.modelMatrix);\n            model.shadows = Property.getValueOrDefault(modelGraphics._shadows, time, defaultShadows);\n            model.heightReference = Property.getValueOrDefault(modelGraphics._heightReference, time, defaultHeightReference);\n            model.distanceDisplayCondition = Property.getValueOrUndefined(modelGraphics._distanceDisplayCondition, time);\n            model.silhouetteColor = Property.getValueOrDefault(modelGraphics._silhouetteColor, time, defaultSilhouetteColor, model._silhouetteColor);\n            model.silhouetteSize = Property.getValueOrDefault(modelGraphics._silhouetteSize, time, defaultSilhouetteSize);\n            model.color = Property.getValueOrDefault(modelGraphics._color, time, defaultColor, model._color);\n            model.colorBlendMode = Property.getValueOrDefault(modelGraphics._colorBlendMode, time, defaultColorBlendMode);\n            model.colorBlendAmount = Property.getValueOrDefault(modelGraphics._colorBlendAmount, time, defaultColorBlendAmount);\n            model.clippingPlanes = Property.getValueOrUndefined(modelGraphics._clippingPlanes, time);\n            model.clampAnimations = Property.getValueOrDefault(modelGraphics._clampAnimations, time, defaultClampAnimations);\n            model.imageBasedLightingFactor = Property.getValueOrDefault(modelGraphics._imageBasedLightingFactor, time, defaultImageBasedLightingFactor);\n            model.lightColor = Property.getValueOrUndefined(modelGraphics._lightColor, time);\n            model._upAxis = Property.getValueOrDefault(modelGraphics._upAxis, time, defaultUpAxis);\n            model._forwardAxis = Property.getValueOrUndefined(modelGraphics._forwardAxis, time);\n\n            if (model.ready) {\n                var runAnimations = Property.getValueOrDefault(modelGraphics._runAnimations, time, true);\n                if (modelData.animationsRunning !== runAnimations) {\n                    if (runAnimations) {\n                        model.activeAnimations.addAll({\n                            loop : ModelAnimationLoop.REPEAT\n                        });\n                    } else {\n                        model.activeAnimations.removeAll();\n                    }\n                    modelData.animationsRunning = runAnimations;\n                }\n\n                // Apply node transformations\n                var nodeTransformations = Property.getValueOrUndefined(modelGraphics._nodeTransformations, time, modelData.nodeTransformationsScratch);\n                if (defined(nodeTransformations)) {\n                    var nodeNames = Object.keys(nodeTransformations);\n                    for (var nodeIndex = 0, nodeLength = nodeNames.length; nodeIndex < nodeLength; ++nodeIndex) {\n                        var nodeName = nodeNames[nodeIndex];\n\n                        var nodeTransformation = nodeTransformations[nodeName];\n                        if (!defined(nodeTransformation)) {\n                            continue;\n                        }\n\n                        var modelNode = model.getNode(nodeName);\n                        if (!defined(modelNode)) {\n                            continue;\n                        }\n\n                        var transformationMatrix = Matrix4.fromTranslationRotationScale(nodeTransformation, nodeMatrixScratch);\n                        modelNode.matrix = Matrix4.multiply(modelNode.originalMatrix, transformationMatrix, transformationMatrix);\n                    }\n                }\n\n                // Apply articulations\n                var anyArticulationUpdated = false;\n                var articulations = Property.getValueOrUndefined(modelGraphics._articulations, time, modelData.articulationsScratch);\n                if (defined(articulations)) {\n                    var articulationStageKeys = Object.keys(articulations);\n                    for (var s = 0, numKeys = articulationStageKeys.length; s < numKeys; ++s) {\n                        var key = articulationStageKeys[s];\n\n                        var articulationStageValue = articulations[key];\n                        if (!defined(articulationStageValue)) {\n                            continue;\n                        }\n\n                        anyArticulationUpdated = true;\n                        model.setArticulationStage(key, articulationStageValue);\n                    }\n                }\n\n                if (anyArticulationUpdated) {\n                    model.applyArticulations();\n                }\n            }\n        }\n\n        return true;\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     *\n     * @returns {Boolean} True if this object was destroyed; otherwise, false.\n     */\n    ModelVisualizer.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Removes and destroys all primitives created by this instance.\n     */\n    ModelVisualizer.prototype.destroy = function() {\n        this._entityCollection.collectionChanged.removeEventListener(ModelVisualizer.prototype._onCollectionChanged, this);\n        var entities = this._entitiesToVisualize.values;\n        var modelHash = this._modelHash;\n        var primitives = this._primitives;\n        for (var i = entities.length - 1; i > -1; i--) {\n            removeModel(this, entities[i], modelHash, primitives);\n        }\n        return destroyObject(this);\n    };\n\n    /**\n     * Computes a bounding sphere which encloses the visualization produced for the specified entity.\n     * The bounding sphere is in the fixed frame of the scene's globe.\n     *\n     * @param {Entity} entity The entity whose bounding sphere to compute.\n     * @param {BoundingSphere} result The bounding sphere onto which to store the result.\n     * @returns {BoundingSphereState} BoundingSphereState.DONE if the result contains the bounding sphere,\n     *                       BoundingSphereState.PENDING if the result is still being computed, or\n     *                       BoundingSphereState.FAILED if the entity has no visualization in the current scene.\n     * @private\n     */\n    ModelVisualizer.prototype.getBoundingSphere = function(entity, result) {\n        \n\n        var modelData = this._modelHash[entity.id];\n        if (!defined(modelData) || modelData.loadFail) {\n            return BoundingSphereState.FAILED;\n        }\n\n        var model = modelData.modelPrimitive;\n        if (!defined(model) || !model.show) {\n            return BoundingSphereState.FAILED;\n        }\n\n        if (!model.ready) {\n            return BoundingSphereState.PENDING;\n        }\n\n        if (model.heightReference === HeightReference.NONE) {\n            BoundingSphere.transform(model.boundingSphere, model.modelMatrix, result);\n        } else {\n            if (!defined(model._clampedModelMatrix) || model._heightChanged) {\n                return BoundingSphereState.PENDING;\n            }\n            BoundingSphere.transform(model.boundingSphere, model._clampedModelMatrix, result);\n        }\n        return BoundingSphereState.DONE;\n    };\n\n    /**\n     * @private\n     */\n    ModelVisualizer.prototype._onCollectionChanged = function(entityCollection, added, removed, changed) {\n        var i;\n        var entity;\n        var entities = this._entitiesToVisualize;\n        var modelHash = this._modelHash;\n        var primitives = this._primitives;\n\n        for (i = added.length - 1; i > -1; i--) {\n            entity = added[i];\n            if (defined(entity._model) && defined(entity._position)) {\n                entities.set(entity.id, entity);\n            }\n        }\n\n        for (i = changed.length - 1; i > -1; i--) {\n            entity = changed[i];\n            if (defined(entity._model) && defined(entity._position)) {\n                clearNodeTransformationsArticulationsScratch(entity, modelHash);\n                entities.set(entity.id, entity);\n            } else {\n                removeModel(this, entity, modelHash, primitives);\n                entities.remove(entity.id);\n            }\n        }\n\n        for (i = removed.length - 1; i > -1; i--) {\n            entity = removed[i];\n            removeModel(this, entity, modelHash, primitives);\n            entities.remove(entity.id);\n        }\n    };\n\n    function removeModel(visualizer, entity, modelHash, primitives) {\n        var modelData = modelHash[entity.id];\n        if (defined(modelData)) {\n            primitives.removeAndDestroy(modelData.modelPrimitive);\n            delete modelHash[entity.id];\n        }\n    }\n\n    function clearNodeTransformationsArticulationsScratch(entity, modelHash) {\n        var modelData = modelHash[entity.id];\n        if (defined(modelData)) {\n            modelData.nodeTransformationsScratch = {};\n            modelData.articulationsScratch = {};\n        }\n    }\n\n    function checkModelLoad(model, entity, modelHash){\n        model.readyPromise.otherwise(function(error){\n            console.error(error);\n            modelHash[entity.id].loadFail = true;\n        });\n    }\nexport default ModelVisualizer;\n","import AssociativeArray from '../Core/AssociativeArray.js';\nimport BoundingSphere from '../Core/BoundingSphere.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport Resource from '../Core/Resource.js';\nimport Cesium3DTileset from '../Scene/Cesium3DTileset.js';\nimport BoundingSphereState from './BoundingSphereState.js';\nimport Property from './Property.js';\n\nvar modelMatrixScratch = new Matrix4();\n\n/**\n * A {@link Visualizer} which maps {@link Entity#tileset} to a {@link Cesium3DTileset}.\n * @alias Cesium3DTilesetVisualizer\n * @constructor\n *\n * @param {Scene} scene The scene the primitives will be rendered in.\n * @param {EntityCollection} entityCollection The entityCollection to visualize.\n */\nfunction Cesium3DTilesetVisualizer(scene, entityCollection) {\n    \n\n    entityCollection.collectionChanged.addEventListener(Cesium3DTilesetVisualizer.prototype._onCollectionChanged, this);\n\n    this._scene = scene;\n    this._primitives = scene.primitives;\n    this._entityCollection = entityCollection;\n    this._tilesetHash = {};\n    this._entitiesToVisualize = new AssociativeArray();\n    this._onCollectionChanged(entityCollection, entityCollection.values, [], []);\n}\n\n/**\n * Updates models created this visualizer to match their\n * Entity counterpart at the given time.\n *\n * @param {JulianDate} time The time to update to.\n * @returns {Boolean} This function always returns true.\n */\nCesium3DTilesetVisualizer.prototype.update = function(time) {\n    \n\n    var entities = this._entitiesToVisualize.values;\n    var tilesetHash = this._tilesetHash;\n    var primitives = this._primitives;\n\n    for (var i = 0, len = entities.length; i < len; i++) {\n        var entity = entities[i];\n        var tilesetGraphics = entity._tileset;\n\n        var resource;\n        var tilesetData = tilesetHash[entity.id];\n        var show = entity.isShowing && entity.isAvailable(time) && Property.getValueOrDefault(tilesetGraphics._show, time, true);\n\n        var modelMatrix;\n        if (show) {\n            modelMatrix = entity.computeModelMatrix(time, modelMatrixScratch);\n            resource = Resource.createIfNeeded(Property.getValueOrUndefined(tilesetGraphics._uri, time));\n        }\n\n        if (!show) {\n            if (defined(tilesetData)) {\n                tilesetData.tilesetPrimitive.show = false;\n            }\n            continue;\n        }\n\n        var tileset = defined(tilesetData) ? tilesetData.tilesetPrimitive : undefined;\n        if (!defined(tileset) || resource.url !== tilesetData.url) {\n            if (defined(tileset)) {\n                primitives.removeAndDestroy(tileset);\n                delete tilesetHash[entity.id];\n            }\n            tileset = new Cesium3DTileset({\n                url: resource\n            });\n            tileset.id = entity;\n            primitives.add(tileset);\n\n            tilesetData = {\n                tilesetPrimitive: tileset,\n                url: resource.url,\n                loadFail: false\n            };\n            tilesetHash[entity.id] = tilesetData;\n\n            checkLoad(tileset, entity, tilesetHash);\n        }\n\n        tileset.show = true;\n        if (defined(modelMatrix)) {\n            tileset.modelMatrix = modelMatrix;\n        }\n        tileset.maximumScreenSpaceError = Property.getValueOrDefault(tilesetGraphics.maximumScreenSpaceError, time, tileset.maximumScreenSpaceError);\n    }\n\n    return true;\n};\n\n/**\n * Returns true if this object was destroyed; otherwise, false.\n *\n * @returns {Boolean} True if this object was destroyed; otherwise, false.\n */\nCesium3DTilesetVisualizer.prototype.isDestroyed = function() {\n    return false;\n};\n\n/**\n * Removes and destroys all primitives created by this instance.\n */\nCesium3DTilesetVisualizer.prototype.destroy = function() {\n    this._entityCollection.collectionChanged.removeEventListener(Cesium3DTilesetVisualizer.prototype._onCollectionChanged, this);\n    var entities = this._entitiesToVisualize.values;\n    var tilesetHash = this._tilesetHash;\n    var primitives = this._primitives;\n    for (var i = entities.length - 1; i > -1; i--) {\n        removeTileset(this, entities[i], tilesetHash, primitives);\n    }\n    return destroyObject(this);\n};\n\n/**\n * Computes a bounding sphere which encloses the visualization produced for the specified entity.\n * The bounding sphere is in the fixed frame of the scene's globe.\n *\n * @param {Entity} entity The entity whose bounding sphere to compute.\n * @param {BoundingSphere} result The bounding sphere onto which to store the result.\n * @returns {BoundingSphereState} BoundingSphereState.DONE if the result contains the bounding sphere,\n *                       BoundingSphereState.PENDING if the result is still being computed, or\n *                       BoundingSphereState.FAILED if the entity has no visualization in the current scene.\n * @private\n */\nCesium3DTilesetVisualizer.prototype.getBoundingSphere = function(entity, result) {\n    \n\n    var tilesetData = this._tilesetHash[entity.id];\n    if (!defined(tilesetData) || tilesetData.loadFail) {\n        return BoundingSphereState.FAILED;\n    }\n\n    var primitive = tilesetData.tilesetPrimitive;\n    if (!defined(primitive) || !primitive.show) {\n        return BoundingSphereState.FAILED;\n    }\n\n    if (!primitive.ready) {\n        return BoundingSphereState.PENDING;\n    }\n\n    BoundingSphere.clone(primitive.boundingSphere, result);\n\n    return BoundingSphereState.DONE;\n};\n\n/**\n * @private\n */\nCesium3DTilesetVisualizer.prototype._onCollectionChanged = function(entityCollection, added, removed, changed) {\n    var i;\n    var entity;\n    var entities = this._entitiesToVisualize;\n    var tilesetHash = this._tilesetHash;\n    var primitives = this._primitives;\n\n    for (i = added.length - 1; i > -1; i--) {\n        entity = added[i];\n        if (defined(entity._tileset)) {\n            entities.set(entity.id, entity);\n        }\n    }\n\n    for (i = changed.length - 1; i > -1; i--) {\n        entity = changed[i];\n        if (defined(entity._tileset)) {\n            entities.set(entity.id, entity);\n        } else {\n            removeTileset(this, entity, tilesetHash, primitives);\n            entities.remove(entity.id);\n        }\n    }\n\n    for (i = removed.length - 1; i > -1; i--) {\n        entity = removed[i];\n        removeTileset(this, entity, tilesetHash, primitives);\n        entities.remove(entity.id);\n    }\n};\n\nfunction removeTileset(visualizer, entity, tilesetHash, primitives) {\n    var tilesetData = tilesetHash[entity.id];\n    if (defined(tilesetData)) {\n        primitives.removeAndDestroy(tilesetData.tilesetPrimitive);\n        delete tilesetHash[entity.id];\n    }\n}\n\nfunction checkLoad(primitive, entity, tilesetHash) {\n    primitive.readyPromise.otherwise(function(error) {\n        console.error(error);\n        tilesetHash[entity.id].loadFail = true;\n    });\n}\nexport default Cesium3DTilesetVisualizer;\n","import AssociativeArray from '../Core/AssociativeArray.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport JulianDate from '../Core/JulianDate.js';\nimport Matrix3 from '../Core/Matrix3.js';\nimport Matrix4 from '../Core/Matrix4.js';\nimport ReferenceFrame from '../Core/ReferenceFrame.js';\nimport TimeInterval from '../Core/TimeInterval.js';\nimport Transforms from '../Core/Transforms.js';\nimport PolylineCollection from '../Scene/PolylineCollection.js';\nimport SceneMode from '../Scene/SceneMode.js';\nimport CompositePositionProperty from './CompositePositionProperty.js';\nimport ConstantPositionProperty from './ConstantPositionProperty.js';\nimport MaterialProperty from './MaterialProperty.js';\nimport Property from './Property.js';\nimport ReferenceProperty from './ReferenceProperty.js';\nimport SampledPositionProperty from './SampledPositionProperty.js';\nimport ScaledPositionProperty from './ScaledPositionProperty.js';\nimport TimeIntervalCollectionPositionProperty from './TimeIntervalCollectionPositionProperty.js';\n\n    var defaultResolution = 60.0;\n    var defaultWidth = 1.0;\n\n    var scratchTimeInterval = new TimeInterval();\n    var subSampleCompositePropertyScratch = new TimeInterval();\n    var subSampleIntervalPropertyScratch = new TimeInterval();\n\n    function EntityData(entity) {\n        this.entity = entity;\n        this.polyline = undefined;\n        this.index = undefined;\n        this.updater = undefined;\n    }\n\n    function subSampleSampledProperty(property, start, stop, times, updateTime, referenceFrame, maximumStep, startingIndex, result) {\n        var r = startingIndex;\n        //Always step exactly on start (but only use it if it exists.)\n        var tmp;\n        tmp = property.getValueInReferenceFrame(start, referenceFrame, result[r]);\n        if (defined(tmp)) {\n            result[r++] = tmp;\n        }\n\n        var steppedOnNow = !defined(updateTime) || JulianDate.lessThanOrEquals(updateTime, start) || JulianDate.greaterThanOrEquals(updateTime, stop);\n\n        //Iterate over all interval times and add the ones that fall in our\n        //time range.  Note that times can contain data outside of\n        //the intervals range.  This is by design for use with interpolation.\n        var t = 0;\n        var len = times.length;\n        var current = times[t];\n        var loopStop = stop;\n        var sampling = false;\n        var sampleStepsToTake;\n        var sampleStepsTaken;\n        var sampleStepSize;\n\n        while (t < len) {\n            if (!steppedOnNow && JulianDate.greaterThanOrEquals(current, updateTime)) {\n                tmp = property.getValueInReferenceFrame(updateTime, referenceFrame, result[r]);\n                if (defined(tmp)) {\n                    result[r++] = tmp;\n                }\n                steppedOnNow = true;\n            }\n            if (JulianDate.greaterThan(current, start) && JulianDate.lessThan(current, loopStop) && !current.equals(updateTime)) {\n                tmp = property.getValueInReferenceFrame(current, referenceFrame, result[r]);\n                if (defined(tmp)) {\n                    result[r++] = tmp;\n                }\n            }\n\n            if (t < (len - 1)) {\n                if (maximumStep > 0 && !sampling) {\n                    var next = times[t + 1];\n                    var secondsUntilNext = JulianDate.secondsDifference(next, current);\n                    sampling = secondsUntilNext > maximumStep;\n\n                    if (sampling) {\n                        sampleStepsToTake = Math.ceil(secondsUntilNext / maximumStep);\n                        sampleStepsTaken = 0;\n                        sampleStepSize = secondsUntilNext / Math.max(sampleStepsToTake, 2);\n                        sampleStepsToTake = Math.max(sampleStepsToTake - 1, 1);\n                    }\n                }\n\n                if (sampling && sampleStepsTaken < sampleStepsToTake) {\n                    current = JulianDate.addSeconds(current, sampleStepSize, new JulianDate());\n                    sampleStepsTaken++;\n                    continue;\n                }\n            }\n            sampling = false;\n            t++;\n            current = times[t];\n        }\n\n        //Always step exactly on stop (but only use it if it exists.)\n        tmp = property.getValueInReferenceFrame(stop, referenceFrame, result[r]);\n        if (defined(tmp)) {\n            result[r++] = tmp;\n        }\n\n        return r;\n    }\n\n    function subSampleGenericProperty(property, start, stop, updateTime, referenceFrame, maximumStep, startingIndex, result) {\n        var tmp;\n        var i = 0;\n        var index = startingIndex;\n        var time = start;\n        var stepSize = Math.max(maximumStep, 60);\n        var steppedOnNow = !defined(updateTime) || JulianDate.lessThanOrEquals(updateTime, start) || JulianDate.greaterThanOrEquals(updateTime, stop);\n        while (JulianDate.lessThan(time, stop)) {\n            if (!steppedOnNow && JulianDate.greaterThanOrEquals(time, updateTime)) {\n                steppedOnNow = true;\n                tmp = property.getValueInReferenceFrame(updateTime, referenceFrame, result[index]);\n                if (defined(tmp)) {\n                    result[index] = tmp;\n                    index++;\n                }\n            }\n            tmp = property.getValueInReferenceFrame(time, referenceFrame, result[index]);\n            if (defined(tmp)) {\n                result[index] = tmp;\n                index++;\n            }\n            i++;\n            time = JulianDate.addSeconds(start, stepSize * i, new JulianDate());\n        }\n        //Always sample stop.\n        tmp = property.getValueInReferenceFrame(stop, referenceFrame, result[index]);\n        if (defined(tmp)) {\n            result[index] = tmp;\n            index++;\n        }\n        return index;\n    }\n\n    function subSampleIntervalProperty(property, start, stop, updateTime, referenceFrame, maximumStep, startingIndex, result) {\n        subSampleIntervalPropertyScratch.start = start;\n        subSampleIntervalPropertyScratch.stop = stop;\n\n        var index = startingIndex;\n        var intervals = property.intervals;\n        for (var i = 0; i < intervals.length; i++) {\n            var interval = intervals.get(i);\n            if (!TimeInterval.intersect(interval, subSampleIntervalPropertyScratch, scratchTimeInterval).isEmpty) {\n                var time = interval.start;\n                if (!interval.isStartIncluded) {\n                    if (interval.isStopIncluded) {\n                        time = interval.stop;\n                    } else {\n                        time = JulianDate.addSeconds(interval.start, JulianDate.secondsDifference(interval.stop, interval.start) / 2, new JulianDate());\n                    }\n                }\n                var tmp = property.getValueInReferenceFrame(time, referenceFrame, result[index]);\n                if (defined(tmp)) {\n                    result[index] = tmp;\n                    index++;\n                }\n            }\n        }\n        return index;\n    }\n\n    function subSampleConstantProperty(property, start, stop, updateTime, referenceFrame, maximumStep, startingIndex, result) {\n        var tmp = property.getValueInReferenceFrame(start, referenceFrame, result[startingIndex]);\n        if (defined(tmp)) {\n            result[startingIndex++] = tmp;\n        }\n        return startingIndex;\n    }\n\n    function subSampleCompositeProperty(property, start, stop, updateTime, referenceFrame, maximumStep, startingIndex, result) {\n        subSampleCompositePropertyScratch.start = start;\n        subSampleCompositePropertyScratch.stop = stop;\n\n        var index = startingIndex;\n        var intervals = property.intervals;\n        for (var i = 0; i < intervals.length; i++) {\n            var interval = intervals.get(i);\n            if (!TimeInterval.intersect(interval, subSampleCompositePropertyScratch, scratchTimeInterval).isEmpty) {\n                var intervalStart = interval.start;\n                var intervalStop = interval.stop;\n\n                var sampleStart = start;\n                if (JulianDate.greaterThan(intervalStart, sampleStart)) {\n                    sampleStart = intervalStart;\n                }\n\n                var sampleStop = stop;\n                if (JulianDate.lessThan(intervalStop, sampleStop)) {\n                    sampleStop = intervalStop;\n                }\n\n                index = reallySubSample(interval.data, sampleStart, sampleStop, updateTime, referenceFrame, maximumStep, index, result);\n            }\n        }\n        return index;\n    }\n\n    function reallySubSample(property, start, stop, updateTime, referenceFrame, maximumStep, index, result) {\n        //Unwrap any references until we have the actual property.\n        while (property instanceof ReferenceProperty) {\n            property = property.resolvedProperty;\n        }\n\n        if (property instanceof SampledPositionProperty) {\n            var times = property._property._times;\n            index = subSampleSampledProperty(property, start, stop, times, updateTime, referenceFrame, maximumStep, index, result);\n        } else if (property instanceof CompositePositionProperty) {\n            index = subSampleCompositeProperty(property, start, stop, updateTime, referenceFrame, maximumStep, index, result);\n        } else if (property instanceof TimeIntervalCollectionPositionProperty) {\n            index = subSampleIntervalProperty(property, start, stop, updateTime, referenceFrame, maximumStep, index, result);\n        } else if (property instanceof ConstantPositionProperty ||\n                   (property instanceof ScaledPositionProperty && Property.isConstant(property))) {\n            index = subSampleConstantProperty(property, start, stop, updateTime, referenceFrame, maximumStep, index, result);\n        } else {\n            //Fallback to generic sampling.\n            index = subSampleGenericProperty(property, start, stop, updateTime, referenceFrame, maximumStep, index, result);\n        }\n        return index;\n    }\n\n    function subSample(property, start, stop, updateTime, referenceFrame, maximumStep, result) {\n        if (!defined(result)) {\n            result = [];\n        }\n\n        var length = reallySubSample(property, start, stop, updateTime, referenceFrame, maximumStep, 0, result);\n        result.length = length;\n        return result;\n    }\n\n    var toFixedScratch = new Matrix3();\n    function PolylineUpdater(scene, referenceFrame) {\n        this._unusedIndexes = [];\n        this._polylineCollection = new PolylineCollection();\n        this._scene = scene;\n        this._referenceFrame = referenceFrame;\n        scene.primitives.add(this._polylineCollection);\n    }\n\n    PolylineUpdater.prototype.update = function(time) {\n        if (this._referenceFrame === ReferenceFrame.INERTIAL) {\n            var toFixed = Transforms.computeIcrfToFixedMatrix(time, toFixedScratch);\n            if (!defined(toFixed)) {\n                toFixed = Transforms.computeTemeToPseudoFixedMatrix(time, toFixedScratch);\n            }\n            Matrix4.fromRotationTranslation(toFixed, Cartesian3.ZERO, this._polylineCollection.modelMatrix);\n        }\n    };\n\n    PolylineUpdater.prototype.updateObject = function(time, item) {\n        var entity = item.entity;\n        var pathGraphics = entity._path;\n        var positionProperty = entity._position;\n\n        var sampleStart;\n        var sampleStop;\n        var showProperty = pathGraphics._show;\n        var polyline = item.polyline;\n        var show = entity.isShowing && (!defined(showProperty) || showProperty.getValue(time));\n\n        //While we want to show the path, there may not actually be anything to show\n        //depending on lead/trail settings.  Compute the interval of the path to\n        //show and check against actual availability.\n        if (show) {\n            var leadTime = Property.getValueOrUndefined(pathGraphics._leadTime, time);\n            var trailTime = Property.getValueOrUndefined(pathGraphics._trailTime, time);\n            var availability = entity._availability;\n            var hasAvailability = defined(availability);\n            var hasLeadTime = defined(leadTime);\n            var hasTrailTime = defined(trailTime);\n\n            //Objects need to have either defined availability or both a lead and trail time in order to\n            //draw a path (since we can't draw \"infinite\" paths.\n            show = hasAvailability || (hasLeadTime && hasTrailTime);\n\n            //The final step is to compute the actual start/stop times of the path to show.\n            //If current time is outside of the availability interval, there's a chance that\n            //we won't have to draw anything anyway.\n            if (show) {\n                if (hasTrailTime) {\n                    sampleStart = JulianDate.addSeconds(time, -trailTime, new JulianDate());\n                }\n                if (hasLeadTime) {\n                    sampleStop = JulianDate.addSeconds(time, leadTime, new JulianDate());\n                }\n\n                if (hasAvailability) {\n                    var start = availability.start;\n                    var stop = availability.stop;\n\n                    if (!hasTrailTime || JulianDate.greaterThan(start, sampleStart)) {\n                        sampleStart = start;\n                    }\n\n                    if (!hasLeadTime || JulianDate.lessThan(stop, sampleStop)) {\n                        sampleStop = stop;\n                    }\n                }\n                show = JulianDate.lessThan(sampleStart, sampleStop);\n            }\n        }\n\n        if (!show) {\n            //don't bother creating or updating anything else\n            if (defined(polyline)) {\n                this._unusedIndexes.push(item.index);\n                item.polyline = undefined;\n                polyline.show = false;\n                item.index = undefined;\n            }\n            return;\n        }\n\n        if (!defined(polyline)) {\n            var unusedIndexes = this._unusedIndexes;\n            var length = unusedIndexes.length;\n            if (length > 0) {\n                var index = unusedIndexes.pop();\n                polyline = this._polylineCollection.get(index);\n                item.index = index;\n            } else {\n                item.index = this._polylineCollection.length;\n                polyline = this._polylineCollection.add();\n            }\n            polyline.id = entity;\n            item.polyline = polyline;\n        }\n\n        var resolution = Property.getValueOrDefault(pathGraphics._resolution, time, defaultResolution);\n\n        polyline.show = true;\n        polyline.positions = subSample(positionProperty, sampleStart, sampleStop, time, this._referenceFrame, resolution, polyline.positions.slice());\n        polyline.material = MaterialProperty.getValue(time, pathGraphics._material, polyline.material);\n        polyline.width = Property.getValueOrDefault(pathGraphics._width, time, defaultWidth);\n        polyline.distanceDisplayCondition = Property.getValueOrUndefined(pathGraphics._distanceDisplayCondition, time, polyline.distanceDisplayCondition);\n    };\n\n    PolylineUpdater.prototype.removeObject = function(item) {\n        var polyline = item.polyline;\n        if (defined(polyline)) {\n            this._unusedIndexes.push(item.index);\n            item.polyline = undefined;\n            polyline.show = false;\n            polyline.id = undefined;\n            item.index = undefined;\n        }\n    };\n\n    PolylineUpdater.prototype.destroy = function() {\n        this._scene.primitives.remove(this._polylineCollection);\n        return destroyObject(this);\n    };\n\n    /**\n     * A {@link Visualizer} which maps {@link Entity#path} to a {@link Polyline}.\n     * @alias PathVisualizer\n     * @constructor\n     *\n     * @param {Scene} scene The scene the primitives will be rendered in.\n     * @param {EntityCollection} entityCollection The entityCollection to visualize.\n     */\n    function PathVisualizer(scene, entityCollection) {\n        \n\n        entityCollection.collectionChanged.addEventListener(PathVisualizer.prototype._onCollectionChanged, this);\n\n        this._scene = scene;\n        this._updaters = {};\n        this._entityCollection = entityCollection;\n        this._items = new AssociativeArray();\n\n        this._onCollectionChanged(entityCollection, entityCollection.values, [], []);\n    }\n\n    /**\n     * Updates all of the primitives created by this visualizer to match their\n     * Entity counterpart at the given time.\n     *\n     * @param {JulianDate} time The time to update to.\n     * @returns {Boolean} This function always returns true.\n     */\n    PathVisualizer.prototype.update = function(time) {\n        \n\n        var updaters = this._updaters;\n        for (var key in updaters) {\n            if (updaters.hasOwnProperty(key)) {\n                updaters[key].update(time);\n            }\n        }\n\n        var items = this._items.values;\n        if (items.length === 0 && defined(this._updaters) && Object.keys(this._updaters).length > 0) {\n            for (var u in updaters) {\n                if (updaters.hasOwnProperty(u)) {\n                    updaters[u].destroy();\n                }\n            }\n            this._updaters = {};\n        }\n\n        for (var i = 0, len = items.length; i < len; i++) {\n            var item = items[i];\n            var entity = item.entity;\n            var positionProperty = entity._position;\n\n            var lastUpdater = item.updater;\n\n            var frameToVisualize = ReferenceFrame.FIXED;\n            if (this._scene.mode === SceneMode.SCENE3D) {\n                frameToVisualize = positionProperty.referenceFrame;\n            }\n\n            var currentUpdater = this._updaters[frameToVisualize];\n\n            if ((lastUpdater === currentUpdater) && (defined(currentUpdater))) {\n                currentUpdater.updateObject(time, item);\n                continue;\n            }\n\n            if (defined(lastUpdater)) {\n                lastUpdater.removeObject(item);\n            }\n\n            if (!defined(currentUpdater)) {\n                currentUpdater = new PolylineUpdater(this._scene, frameToVisualize);\n                currentUpdater.update(time);\n                this._updaters[frameToVisualize] = currentUpdater;\n            }\n\n            item.updater = currentUpdater;\n            if (defined(currentUpdater)) {\n                currentUpdater.updateObject(time, item);\n            }\n        }\n        return true;\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     *\n     * @returns {Boolean} True if this object was destroyed; otherwise, false.\n     */\n    PathVisualizer.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Removes and destroys all primitives created by this instance.\n     */\n    PathVisualizer.prototype.destroy = function() {\n        this._entityCollection.collectionChanged.removeEventListener(PathVisualizer.prototype._onCollectionChanged, this);\n\n        var updaters = this._updaters;\n        for ( var key in updaters) {\n            if (updaters.hasOwnProperty(key)) {\n                updaters[key].destroy();\n            }\n        }\n\n        return destroyObject(this);\n    };\n\n    PathVisualizer.prototype._onCollectionChanged = function(entityCollection, added, removed, changed) {\n        var i;\n        var entity;\n        var item;\n        var items = this._items;\n\n        for (i = added.length - 1; i > -1; i--) {\n            entity = added[i];\n            if (defined(entity._path) && defined(entity._position)) {\n                items.set(entity.id, new EntityData(entity));\n            }\n        }\n\n        for (i = changed.length - 1; i > -1; i--) {\n            entity = changed[i];\n            if (defined(entity._path) && defined(entity._position)) {\n                if (!items.contains(entity.id)) {\n                    items.set(entity.id, new EntityData(entity));\n                }\n            } else {\n                item = items.get(entity.id);\n                if (defined(item)) {\n                    if (defined(item.updater)) {\n                        item.updater.removeObject(item);\n                    }\n                    items.remove(entity.id);\n                }\n            }\n        }\n\n        for (i = removed.length - 1; i > -1; i--) {\n            entity = removed[i];\n            item = items.get(entity.id);\n            if (defined(item)) {\n                if (defined(item.updater)) {\n                    item.updater.removeObject(item);\n                }\n                items.remove(entity.id);\n            }\n        }\n    };\n\n    //for testing\n    PathVisualizer._subSample = subSample;\nexport default PathVisualizer;\n","import AssociativeArray from '../Core/AssociativeArray.js';\nimport Cartesian3 from '../Core/Cartesian3.js';\nimport Color from '../Core/Color.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport DistanceDisplayCondition from '../Core/DistanceDisplayCondition.js';\nimport NearFarScalar from '../Core/NearFarScalar.js';\nimport createBillboardPointCallback from '../Scene/createBillboardPointCallback.js';\nimport HeightReference from '../Scene/HeightReference.js';\nimport BoundingSphereState from './BoundingSphereState.js';\nimport Property from './Property.js';\n\n    var defaultColor = Color.WHITE;\n    var defaultOutlineColor = Color.BLACK;\n    var defaultOutlineWidth = 0.0;\n    var defaultPixelSize = 1.0;\n    var defaultDisableDepthTestDistance = 0.0;\n\n    var colorScratch = new Color();\n    var positionScratch = new Cartesian3();\n    var outlineColorScratch = new Color();\n    var scaleByDistanceScratch = new NearFarScalar();\n    var translucencyByDistanceScratch = new NearFarScalar();\n    var distanceDisplayConditionScratch = new DistanceDisplayCondition();\n\n    function EntityData(entity) {\n        this.entity = entity;\n        this.pointPrimitive = undefined;\n        this.billboard = undefined;\n        this.color = undefined;\n        this.outlineColor = undefined;\n        this.pixelSize = undefined;\n        this.outlineWidth = undefined;\n    }\n\n    /**\n     * A {@link Visualizer} which maps {@link Entity#point} to a {@link PointPrimitive}.\n     * @alias PointVisualizer\n     * @constructor\n     *\n     * @param {EntityCluster} entityCluster The entity cluster to manage the collection of billboards and optionally cluster with other entities.\n     * @param {EntityCollection} entityCollection The entityCollection to visualize.\n     */\n    function PointVisualizer(entityCluster, entityCollection) {\n        \n\n        entityCollection.collectionChanged.addEventListener(PointVisualizer.prototype._onCollectionChanged, this);\n\n        this._cluster = entityCluster;\n        this._entityCollection = entityCollection;\n        this._items = new AssociativeArray();\n        this._onCollectionChanged(entityCollection, entityCollection.values, [], []);\n    }\n\n    /**\n     * Updates the primitives created by this visualizer to match their\n     * Entity counterpart at the given time.\n     *\n     * @param {JulianDate} time The time to update to.\n     * @returns {Boolean} This function always returns true.\n     */\n    PointVisualizer.prototype.update = function(time) {\n        \n\n        var items = this._items.values;\n        var cluster = this._cluster;\n        for (var i = 0, len = items.length; i < len; i++) {\n            var item = items[i];\n            var entity = item.entity;\n            var pointGraphics = entity._point;\n            var pointPrimitive = item.pointPrimitive;\n            var billboard = item.billboard;\n            var heightReference = Property.getValueOrDefault(pointGraphics._heightReference, time, HeightReference.NONE);\n            var show = entity.isShowing && entity.isAvailable(time) && Property.getValueOrDefault(pointGraphics._show, time, true);\n            var position;\n            if (show) {\n                position = Property.getValueOrUndefined(entity._position, time, positionScratch);\n                show = defined(position);\n            }\n            if (!show) {\n                returnPrimitive(item, entity, cluster);\n                continue;\n            }\n\n            if (!Property.isConstant(entity._position)) {\n                cluster._clusterDirty = true;\n            }\n\n            var needsRedraw = false;\n            var updateClamping = false;\n            if ((heightReference !== HeightReference.NONE) && !defined(billboard)) {\n                if (defined(pointPrimitive)) {\n                    returnPrimitive(item, entity, cluster);\n                    pointPrimitive = undefined;\n                }\n\n                billboard = cluster.getBillboard(entity);\n                billboard.id = entity;\n                billboard.image = undefined;\n                item.billboard = billboard;\n                needsRedraw = true;\n\n                // If this new billboard happens to have a position and height reference that match our new values,\n                // billboard._updateClamping will not be called automatically. That's a problem because the clamped\n                // height may be based on different terrain than is now loaded. So we'll manually call\n                // _updateClamping below.\n                updateClamping = Cartesian3.equals(billboard.position, position) && billboard.heightReference === heightReference;\n            } else if ((heightReference === HeightReference.NONE) && !defined(pointPrimitive)) {\n                if (defined(billboard)) {\n                    returnPrimitive(item, entity, cluster);\n                    billboard = undefined;\n                }\n\n                pointPrimitive = cluster.getPoint(entity);\n                pointPrimitive.id = entity;\n                item.pointPrimitive = pointPrimitive;\n            }\n\n            if (defined(pointPrimitive)) {\n                pointPrimitive.show = true;\n                pointPrimitive.position = position;\n                pointPrimitive.scaleByDistance = Property.getValueOrUndefined(pointGraphics._scaleByDistance, time, scaleByDistanceScratch);\n                pointPrimitive.translucencyByDistance = Property.getValueOrUndefined(pointGraphics._translucencyByDistance, time, translucencyByDistanceScratch);\n                pointPrimitive.color = Property.getValueOrDefault(pointGraphics._color, time, defaultColor, colorScratch);\n                pointPrimitive.outlineColor = Property.getValueOrDefault(pointGraphics._outlineColor, time, defaultOutlineColor, outlineColorScratch);\n                pointPrimitive.outlineWidth = Property.getValueOrDefault(pointGraphics._outlineWidth, time, defaultOutlineWidth);\n                pointPrimitive.pixelSize = Property.getValueOrDefault(pointGraphics._pixelSize, time, defaultPixelSize);\n                pointPrimitive.distanceDisplayCondition = Property.getValueOrUndefined(pointGraphics._distanceDisplayCondition, time, distanceDisplayConditionScratch);\n                pointPrimitive.disableDepthTestDistance = Property.getValueOrDefault(pointGraphics._disableDepthTestDistance, time, defaultDisableDepthTestDistance);\n            } else if (defined(billboard)) {\n                billboard.show = true;\n                billboard.position = position;\n                billboard.scaleByDistance = Property.getValueOrUndefined(pointGraphics._scaleByDistance, time, scaleByDistanceScratch);\n                billboard.translucencyByDistance = Property.getValueOrUndefined(pointGraphics._translucencyByDistance, time, translucencyByDistanceScratch);\n                billboard.distanceDisplayCondition = Property.getValueOrUndefined(pointGraphics._distanceDisplayCondition, time, distanceDisplayConditionScratch);\n                billboard.disableDepthTestDistance = Property.getValueOrDefault(pointGraphics._disableDepthTestDistance, time, defaultDisableDepthTestDistance);\n                billboard.heightReference = heightReference;\n\n                var newColor = Property.getValueOrDefault(pointGraphics._color, time, defaultColor, colorScratch);\n                var newOutlineColor = Property.getValueOrDefault(pointGraphics._outlineColor, time, defaultOutlineColor, outlineColorScratch);\n                var newOutlineWidth = Math.round(Property.getValueOrDefault(pointGraphics._outlineWidth, time, defaultOutlineWidth));\n                var newPixelSize = Math.max(1, Math.round(Property.getValueOrDefault(pointGraphics._pixelSize, time, defaultPixelSize)));\n\n                if (newOutlineWidth > 0) {\n                    billboard.scale = 1.0;\n                    needsRedraw = needsRedraw || //\n                                 newOutlineWidth !== item.outlineWidth || //\n                                 newPixelSize !== item.pixelSize || //\n                                 !Color.equals(newColor, item.color) || //\n                                 !Color.equals(newOutlineColor, item.outlineColor);\n                } else {\n                    billboard.scale = newPixelSize / 50.0;\n                    newPixelSize = 50.0;\n                    needsRedraw = needsRedraw || //\n                                 newOutlineWidth !== item.outlineWidth || //\n                                 !Color.equals(newColor, item.color) || //\n                                 !Color.equals(newOutlineColor, item.outlineColor);\n                }\n\n                if (needsRedraw) {\n                    item.color = Color.clone(newColor, item.color);\n                    item.outlineColor = Color.clone(newOutlineColor, item.outlineColor);\n                    item.pixelSize = newPixelSize;\n                    item.outlineWidth = newOutlineWidth;\n\n                    var centerAlpha = newColor.alpha;\n                    var cssColor = newColor.toCssColorString();\n                    var cssOutlineColor = newOutlineColor.toCssColorString();\n                    var textureId = JSON.stringify([cssColor, newPixelSize, cssOutlineColor, newOutlineWidth]);\n\n                    billboard.setImage(textureId, createBillboardPointCallback(centerAlpha, cssColor, cssOutlineColor, newOutlineWidth, newPixelSize));\n                }\n\n                if (updateClamping) {\n                    billboard._updateClamping();\n                }\n            }\n        }\n        return true;\n    };\n\n    /**\n     * Computes a bounding sphere which encloses the visualization produced for the specified entity.\n     * The bounding sphere is in the fixed frame of the scene's globe.\n     *\n     * @param {Entity} entity The entity whose bounding sphere to compute.\n     * @param {BoundingSphere} result The bounding sphere onto which to store the result.\n     * @returns {BoundingSphereState} BoundingSphereState.DONE if the result contains the bounding sphere,\n     *                       BoundingSphereState.PENDING if the result is still being computed, or\n     *                       BoundingSphereState.FAILED if the entity has no visualization in the current scene.\n     * @private\n     */\n    PointVisualizer.prototype.getBoundingSphere = function(entity, result) {\n        \n\n        var item = this._items.get(entity.id);\n        if (!defined(item) || !(defined(item.pointPrimitive) || defined(item.billboard))) {\n            return BoundingSphereState.FAILED;\n        }\n\n        if (defined(item.pointPrimitive)) {\n            result.center = Cartesian3.clone(item.pointPrimitive.position, result.center);\n        } else {\n            var billboard = item.billboard;\n            if (!defined(billboard._clampedPosition)) {\n                return BoundingSphereState.PENDING;\n            }\n            result.center = Cartesian3.clone(billboard._clampedPosition, result.center);\n        }\n\n        result.radius = 0;\n        return BoundingSphereState.DONE;\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     *\n     * @returns {Boolean} True if this object was destroyed; otherwise, false.\n     */\n    PointVisualizer.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Removes and destroys all primitives created by this instance.\n     */\n    PointVisualizer.prototype.destroy = function() {\n        this._entityCollection.collectionChanged.removeEventListener(PointVisualizer.prototype._onCollectionChanged, this);\n        var entities = this._entityCollection.values;\n        for (var i = 0; i < entities.length; i++) {\n            this._cluster.removePoint(entities[i]);\n        }\n        return destroyObject(this);\n    };\n\n    PointVisualizer.prototype._onCollectionChanged = function(entityCollection, added, removed, changed) {\n        var i;\n        var entity;\n        var items = this._items;\n        var cluster = this._cluster;\n\n        for (i = added.length - 1; i > -1; i--) {\n            entity = added[i];\n            if (defined(entity._point) && defined(entity._position)) {\n                items.set(entity.id, new EntityData(entity));\n            }\n        }\n\n        for (i = changed.length - 1; i > -1; i--) {\n            entity = changed[i];\n            if (defined(entity._point) && defined(entity._position)) {\n                if (!items.contains(entity.id)) {\n                    items.set(entity.id, new EntityData(entity));\n                }\n            } else {\n                returnPrimitive(items.get(entity.id), entity, cluster);\n                items.remove(entity.id);\n            }\n        }\n\n        for (i = removed.length - 1; i > -1; i--) {\n            entity = removed[i];\n            returnPrimitive(items.get(entity.id), entity, cluster);\n            items.remove(entity.id);\n        }\n    };\n\n    function returnPrimitive(item, entity, cluster) {\n        if (defined(item)) {\n            var pointPrimitive = item.pointPrimitive;\n            if (defined(pointPrimitive)) {\n                item.pointPrimitive = undefined;\n                cluster.removePoint(entity);\n                return;\n            }\n            var billboard = item.billboard;\n            if (defined(billboard)) {\n                item.billboard = undefined;\n                cluster.removeBillboard(entity);\n            }\n        }\n    }\nexport default PointVisualizer;\n","import ArcType from './ArcType.js';\nimport arrayRemoveDuplicates from './arrayRemoveDuplicates.js';\nimport BoundingSphere from './BoundingSphere.js';\nimport Cartesian3 from './Cartesian3.js';\nimport Color from './Color.js';\nimport ComponentDatatype from './ComponentDatatype.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport DeveloperError from './DeveloperError.js';\nimport Ellipsoid from './Ellipsoid.js';\nimport Geometry from './Geometry.js';\nimport GeometryAttribute from './GeometryAttribute.js';\nimport GeometryAttributes from './GeometryAttributes.js';\nimport GeometryType from './GeometryType.js';\nimport IndexDatatype from './IndexDatatype.js';\nimport CesiumMath from './Math.js';\nimport PolylinePipeline from './PolylinePipeline.js';\nimport PrimitiveType from './PrimitiveType.js';\nimport VertexFormat from './VertexFormat.js';\n\n    var scratchInterpolateColorsArray = [];\n\n    function interpolateColors(p0, p1, color0, color1, numPoints) {\n        var colors = scratchInterpolateColorsArray;\n        colors.length = numPoints;\n        var i;\n\n        var r0 = color0.red;\n        var g0 = color0.green;\n        var b0 = color0.blue;\n        var a0 = color0.alpha;\n\n        var r1 = color1.red;\n        var g1 = color1.green;\n        var b1 = color1.blue;\n        var a1 = color1.alpha;\n\n        if (Color.equals(color0, color1)) {\n            for (i = 0; i < numPoints; i++) {\n                colors[i] = Color.clone(color0);\n            }\n            return colors;\n        }\n\n        var redPerVertex = (r1 - r0) / numPoints;\n        var greenPerVertex = (g1 - g0) / numPoints;\n        var bluePerVertex = (b1 - b0) / numPoints;\n        var alphaPerVertex = (a1 - a0) / numPoints;\n\n        for (i = 0; i < numPoints; i++) {\n            colors[i] = new Color(r0 + i * redPerVertex, g0 + i * greenPerVertex, b0 + i * bluePerVertex, a0 + i * alphaPerVertex);\n        }\n\n        return colors;\n    }\n\n    /**\n     * A description of a polyline modeled as a line strip; the first two positions define a line segment,\n     * and each additional position defines a line segment from the previous position. The polyline is capable of\n     * displaying with a material.\n     *\n     * @alias PolylineGeometry\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Cartesian3[]} options.positions An array of {@link Cartesian3} defining the positions in the polyline as a line strip.\n     * @param {Number} [options.width=1.0] The width in pixels.\n     * @param {Color[]} [options.colors] An Array of {@link Color} defining the per vertex or per segment colors.\n     * @param {Boolean} [options.colorsPerVertex=false] A boolean that determines whether the colors will be flat across each segment of the line or interpolated across the vertices.\n     * @param {ArcType} [options.arcType=ArcType.GEODESIC] The type of line the polyline segments must follow.\n     * @param {Number} [options.granularity=CesiumMath.RADIANS_PER_DEGREE] The distance, in radians, between each latitude and longitude if options.arcType is not ArcType.NONE. Determines the number of positions in the buffer.\n     * @param {VertexFormat} [options.vertexFormat=VertexFormat.DEFAULT] The vertex attributes to be computed.\n     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid to be used as a reference.\n     *\n     * @exception {DeveloperError} At least two positions are required.\n     * @exception {DeveloperError} width must be greater than or equal to one.\n     * @exception {DeveloperError} colors has an invalid length.\n     *\n     * @see PolylineGeometry#createGeometry\n     *\n     * @demo {@link https://sandcastle.cesium.com/index.html?src=Polyline.html|Cesium Sandcastle Polyline Demo}\n     *\n     * @example\n     * // A polyline with two connected line segments\n     * var polyline = new Cesium.PolylineGeometry({\n     *   positions : Cesium.Cartesian3.fromDegreesArray([\n     *     0.0, 0.0,\n     *     5.0, 0.0,\n     *     5.0, 5.0\n     *   ]),\n     *   width : 10.0\n     * });\n     * var geometry = Cesium.PolylineGeometry.createGeometry(polyline);\n     */\n    function PolylineGeometry(options) {\n        options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n        var positions = options.positions;\n        var colors = options.colors;\n        var width = defaultValue(options.width, 1.0);\n        var colorsPerVertex = defaultValue(options.colorsPerVertex, false);\n\n        \n\n        this._positions = positions;\n        this._colors = colors;\n        this._width = width;\n        this._colorsPerVertex = colorsPerVertex;\n        this._vertexFormat = VertexFormat.clone(defaultValue(options.vertexFormat, VertexFormat.DEFAULT));\n\n        this._arcType = defaultValue(options.arcType, ArcType.GEODESIC);\n        this._granularity = defaultValue(options.granularity, CesiumMath.RADIANS_PER_DEGREE);\n        this._ellipsoid = Ellipsoid.clone(defaultValue(options.ellipsoid, Ellipsoid.WGS84));\n        this._workerName = 'createPolylineGeometry';\n\n        var numComponents = 1 + positions.length * Cartesian3.packedLength;\n        numComponents += defined(colors) ? 1 + colors.length * Color.packedLength : 1;\n\n        /**\n         * The number of elements used to pack the object into an array.\n         * @type {Number}\n         */\n        this.packedLength = numComponents + Ellipsoid.packedLength + VertexFormat.packedLength + 4;\n    }\n\n    /**\n     * Stores the provided instance into the provided array.\n     *\n     * @param {PolylineGeometry} value The value to pack.\n     * @param {Number[]} array The array to pack into.\n     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\n     *\n     * @returns {Number[]} The array that was packed into\n     */\n    PolylineGeometry.pack = function(value, array, startingIndex) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var i;\n\n        var positions = value._positions;\n        var length = positions.length;\n        array[startingIndex++] = length;\n\n        for (i = 0; i < length; ++i, startingIndex += Cartesian3.packedLength) {\n            Cartesian3.pack(positions[i], array, startingIndex);\n        }\n\n        var colors = value._colors;\n        length = defined(colors) ? colors.length : 0.0;\n        array[startingIndex++] = length;\n\n        for (i = 0; i < length; ++i, startingIndex += Color.packedLength) {\n            Color.pack(colors[i], array, startingIndex);\n        }\n\n        Ellipsoid.pack(value._ellipsoid, array, startingIndex);\n        startingIndex += Ellipsoid.packedLength;\n\n        VertexFormat.pack(value._vertexFormat, array, startingIndex);\n        startingIndex += VertexFormat.packedLength;\n\n        array[startingIndex++] = value._width;\n        array[startingIndex++] = value._colorsPerVertex ? 1.0 : 0.0;\n        array[startingIndex++] = value._arcType;\n        array[startingIndex]   = value._granularity;\n\n        return array;\n    };\n\n    var scratchEllipsoid = Ellipsoid.clone(Ellipsoid.UNIT_SPHERE);\n    var scratchVertexFormat = new VertexFormat();\n    var scratchOptions = {\n        positions : undefined,\n        colors : undefined,\n        ellipsoid : scratchEllipsoid,\n        vertexFormat : scratchVertexFormat,\n        width : undefined,\n        colorsPerVertex : undefined,\n        arcType : undefined,\n        granularity : undefined\n    };\n\n    /**\n     * Retrieves an instance from a packed array.\n     *\n     * @param {Number[]} array The packed array.\n     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\n     * @param {PolylineGeometry} [result] The object into which to store the result.\n     * @returns {PolylineGeometry} The modified result parameter or a new PolylineGeometry instance if one was not provided.\n     */\n    PolylineGeometry.unpack = function(array, startingIndex, result) {\n        \n\n        startingIndex = defaultValue(startingIndex, 0);\n\n        var i;\n\n        var length = array[startingIndex++];\n        var positions = new Array(length);\n\n        for (i = 0; i < length; ++i, startingIndex += Cartesian3.packedLength) {\n            positions[i] = Cartesian3.unpack(array, startingIndex);\n        }\n\n        length = array[startingIndex++];\n        var colors = length > 0 ? new Array(length) : undefined;\n\n        for (i = 0; i < length; ++i, startingIndex += Color.packedLength) {\n            colors[i] = Color.unpack(array, startingIndex);\n        }\n\n        var ellipsoid = Ellipsoid.unpack(array, startingIndex, scratchEllipsoid);\n        startingIndex += Ellipsoid.packedLength;\n\n        var vertexFormat = VertexFormat.unpack(array, startingIndex, scratchVertexFormat);\n        startingIndex += VertexFormat.packedLength;\n\n        var width = array[startingIndex++];\n        var colorsPerVertex = array[startingIndex++] === 1.0;\n        var arcType = array[startingIndex++];\n        var granularity = array[startingIndex];\n\n        if (!defined(result)) {\n            scratchOptions.positions = positions;\n            scratchOptions.colors = colors;\n            scratchOptions.width = width;\n            scratchOptions.colorsPerVertex = colorsPerVertex;\n            scratchOptions.arcType = arcType;\n            scratchOptions.granularity = granularity;\n            return new PolylineGeometry(scratchOptions);\n        }\n\n        result._positions = positions;\n        result._colors = colors;\n        result._ellipsoid = Ellipsoid.clone(ellipsoid, result._ellipsoid);\n        result._vertexFormat = VertexFormat.clone(vertexFormat, result._vertexFormat);\n        result._width = width;\n        result._colorsPerVertex = colorsPerVertex;\n        result._arcType = arcType;\n        result._granularity = granularity;\n\n        return result;\n    };\n\n    var scratchCartesian3 = new Cartesian3();\n    var scratchPosition = new Cartesian3();\n    var scratchPrevPosition = new Cartesian3();\n    var scratchNextPosition = new Cartesian3();\n\n    /**\n     * Computes the geometric representation of a polyline, including its vertices, indices, and a bounding sphere.\n     *\n     * @param {PolylineGeometry} polylineGeometry A description of the polyline.\n     * @returns {Geometry|undefined} The computed vertices and indices.\n     */\n    PolylineGeometry.createGeometry = function(polylineGeometry) {\n        var width = polylineGeometry._width;\n        var vertexFormat = polylineGeometry._vertexFormat;\n        var colors = polylineGeometry._colors;\n        var colorsPerVertex = polylineGeometry._colorsPerVertex;\n        var arcType = polylineGeometry._arcType;\n        var granularity = polylineGeometry._granularity;\n        var ellipsoid = polylineGeometry._ellipsoid;\n\n        var i;\n        var j;\n        var k;\n\n        var positions = arrayRemoveDuplicates(polylineGeometry._positions, Cartesian3.equalsEpsilon);\n        var positionsLength = positions.length;\n\n        // A width of a pixel or less is not a valid geometry, but in order to support external data\n        // that may have errors we treat this as an empty geometry.\n        if (positionsLength < 2 || width <= 0.0) {\n            return undefined;\n        }\n\n        if (arcType === ArcType.GEODESIC || arcType === ArcType.RHUMB) {\n            var subdivisionSize;\n            var numberOfPointsFunction;\n            if (arcType === ArcType.GEODESIC) {\n                subdivisionSize = CesiumMath.chordLength(granularity, ellipsoid.maximumRadius);\n                numberOfPointsFunction = PolylinePipeline.numberOfPoints;\n            } else {\n                subdivisionSize = granularity;\n                numberOfPointsFunction = PolylinePipeline.numberOfPointsRhumbLine;\n            }\n\n            var heights = PolylinePipeline.extractHeights(positions, ellipsoid);\n\n            if (defined(colors)) {\n                var colorLength = 1;\n                for (i = 0; i < positionsLength - 1; ++i) {\n                    colorLength += numberOfPointsFunction(positions[i], positions[i + 1], subdivisionSize);\n                }\n\n                var newColors = new Array(colorLength);\n                var newColorIndex = 0;\n\n                for (i = 0; i < positionsLength - 1; ++i) {\n                    var p0 = positions[i];\n                    var p1 = positions[i + 1];\n                    var c0 = colors[i];\n\n                    var numColors = numberOfPointsFunction(p0, p1, subdivisionSize);\n                    if (colorsPerVertex && i < colorLength) {\n                        var c1 = colors[i + 1];\n                        var interpolatedColors = interpolateColors(p0, p1, c0, c1, numColors);\n                        var interpolatedColorsLength = interpolatedColors.length;\n                        for (j = 0; j < interpolatedColorsLength; ++j) {\n                            newColors[newColorIndex++] = interpolatedColors[j];\n                        }\n                    } else {\n                        for (j = 0; j < numColors; ++j) {\n                            newColors[newColorIndex++] = Color.clone(c0);\n                        }\n                    }\n                }\n\n                newColors[newColorIndex] = Color.clone(colors[colors.length - 1]);\n                colors = newColors;\n\n                scratchInterpolateColorsArray.length = 0;\n            }\n\n            if (arcType === ArcType.GEODESIC) {\n                positions = PolylinePipeline.generateCartesianArc({\n                    positions: positions,\n                    minDistance: subdivisionSize,\n                    ellipsoid: ellipsoid,\n                    height: heights\n                });\n            } else {\n                positions = PolylinePipeline.generateCartesianRhumbArc({\n                    positions: positions,\n                    granularity: subdivisionSize,\n                    ellipsoid: ellipsoid,\n                    height: heights\n                });\n            }\n        }\n\n        positionsLength = positions.length;\n        var size = positionsLength * 4.0 - 4.0;\n\n        var finalPositions = new Float64Array(size * 3);\n        var prevPositions = new Float64Array(size * 3);\n        var nextPositions = new Float64Array(size * 3);\n        var expandAndWidth = new Float32Array(size * 2);\n        var st = vertexFormat.st ? new Float32Array(size * 2) : undefined;\n        var finalColors = defined(colors) ? new Uint8Array(size * 4) : undefined;\n\n        var positionIndex = 0;\n        var expandAndWidthIndex = 0;\n        var stIndex = 0;\n        var colorIndex = 0;\n        var position;\n\n        for (j = 0; j < positionsLength; ++j) {\n            if (j === 0) {\n                position = scratchCartesian3;\n                Cartesian3.subtract(positions[0], positions[1], position);\n                Cartesian3.add(positions[0], position, position);\n            } else {\n                position = positions[j - 1];\n            }\n\n            Cartesian3.clone(position, scratchPrevPosition);\n            Cartesian3.clone(positions[j], scratchPosition);\n\n            if (j === positionsLength - 1) {\n                position = scratchCartesian3;\n                Cartesian3.subtract(positions[positionsLength - 1], positions[positionsLength - 2], position);\n                Cartesian3.add(positions[positionsLength - 1], position, position);\n            } else {\n                position = positions[j + 1];\n            }\n\n            Cartesian3.clone(position, scratchNextPosition);\n\n            var color0, color1;\n            if (defined(finalColors)) {\n                if (j !== 0 && !colorsPerVertex) {\n                    color0 = colors[j - 1];\n                } else {\n                    color0 = colors[j];\n                }\n\n                if (j !== positionsLength - 1) {\n                    color1 = colors[j];\n                }\n            }\n\n            var startK = j === 0 ? 2 : 0;\n            var endK = j === positionsLength - 1 ? 2 : 4;\n\n            for (k = startK; k < endK; ++k) {\n                Cartesian3.pack(scratchPosition, finalPositions, positionIndex);\n                Cartesian3.pack(scratchPrevPosition, prevPositions, positionIndex);\n                Cartesian3.pack(scratchNextPosition, nextPositions, positionIndex);\n                positionIndex += 3;\n\n                var direction = (k - 2 < 0) ? -1.0 : 1.0;\n                expandAndWidth[expandAndWidthIndex++] = 2 * (k % 2) - 1;       // expand direction\n                expandAndWidth[expandAndWidthIndex++] = direction * width;\n\n                if (vertexFormat.st) {\n                    st[stIndex++] = j / (positionsLength - 1);\n                    st[stIndex++] = Math.max(expandAndWidth[expandAndWidthIndex - 2], 0.0);\n                }\n\n                if (defined(finalColors)) {\n                    var color = (k < 2) ? color0 : color1;\n\n                    finalColors[colorIndex++] = Color.floatToByte(color.red);\n                    finalColors[colorIndex++] = Color.floatToByte(color.green);\n                    finalColors[colorIndex++] = Color.floatToByte(color.blue);\n                    finalColors[colorIndex++] = Color.floatToByte(color.alpha);\n                }\n            }\n        }\n\n        var attributes = new GeometryAttributes();\n\n        attributes.position = new GeometryAttribute({\n            componentDatatype : ComponentDatatype.DOUBLE,\n            componentsPerAttribute : 3,\n            values : finalPositions\n        });\n\n        attributes.prevPosition = new GeometryAttribute({\n            componentDatatype : ComponentDatatype.DOUBLE,\n            componentsPerAttribute : 3,\n            values : prevPositions\n        });\n\n        attributes.nextPosition = new GeometryAttribute({\n            componentDatatype : ComponentDatatype.DOUBLE,\n            componentsPerAttribute : 3,\n            values : nextPositions\n        });\n\n        attributes.expandAndWidth = new GeometryAttribute({\n            componentDatatype : ComponentDatatype.FLOAT,\n            componentsPerAttribute : 2,\n            values : expandAndWidth\n        });\n\n        if (vertexFormat.st) {\n            attributes.st = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.FLOAT,\n                componentsPerAttribute : 2,\n                values : st\n            });\n        }\n\n        if (defined(finalColors)) {\n            attributes.color = new GeometryAttribute({\n                componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n                componentsPerAttribute : 4,\n                values : finalColors,\n                normalize : true\n            });\n        }\n\n        var indices = IndexDatatype.createTypedArray(size, positionsLength * 6 - 6);\n        var index = 0;\n        var indicesIndex = 0;\n        var length = positionsLength - 1.0;\n        for (j = 0; j < length; ++j) {\n            indices[indicesIndex++] = index;\n            indices[indicesIndex++] = index + 2;\n            indices[indicesIndex++] = index + 1;\n\n            indices[indicesIndex++] = index + 1;\n            indices[indicesIndex++] = index + 2;\n            indices[indicesIndex++] = index + 3;\n\n            index += 4;\n        }\n\n        return new Geometry({\n            attributes : attributes,\n            indices : indices,\n            primitiveType : PrimitiveType.TRIANGLES,\n            boundingSphere : BoundingSphere.fromPoints(positions),\n            geometryType : GeometryType.POLYLINES\n        });\n    };\nexport default PolylineGeometry;\n","import ArcType from '../Core/ArcType.js';\nimport BoundingSphere from '../Core/BoundingSphere.js';\nimport Check from '../Core/Check.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport DeveloperError from '../Core/DeveloperError.js';\nimport DistanceDisplayCondition from '../Core/DistanceDisplayCondition.js';\nimport DistanceDisplayConditionGeometryInstanceAttribute from '../Core/DistanceDisplayConditionGeometryInstanceAttribute.js';\nimport Event from '../Core/Event.js';\nimport GeometryInstance from '../Core/GeometryInstance.js';\nimport GroundPolylineGeometry from '../Core/GroundPolylineGeometry.js';\nimport Iso8601 from '../Core/Iso8601.js';\nimport oneTimeWarning from '../Core/oneTimeWarning.js';\nimport PolylineGeometry from '../Core/PolylineGeometry.js';\nimport PolylinePipeline from '../Core/PolylinePipeline.js';\nimport ShowGeometryInstanceAttribute from '../Core/ShowGeometryInstanceAttribute.js';\nimport Entity from '../DataSources/Entity.js';\nimport ClassificationType from '../Scene/ClassificationType.js';\nimport GroundPolylinePrimitive from '../Scene/GroundPolylinePrimitive.js';\nimport PolylineCollection from '../Scene/PolylineCollection.js';\nimport PolylineColorAppearance from '../Scene/PolylineColorAppearance.js';\nimport PolylineMaterialAppearance from '../Scene/PolylineMaterialAppearance.js';\nimport ShadowMode from '../Scene/ShadowMode.js';\nimport BoundingSphereState from './BoundingSphereState.js';\nimport ColorMaterialProperty from './ColorMaterialProperty.js';\nimport ConstantProperty from './ConstantProperty.js';\nimport MaterialProperty from './MaterialProperty.js';\nimport Property from './Property.js';\n\n    var defaultZIndex = new ConstantProperty(0);\n\n    //We use this object to create one polyline collection per-scene.\n    var polylineCollections = {};\n\n    var scratchColor = new Color();\n    var defaultMaterial = new ColorMaterialProperty(Color.WHITE);\n    var defaultShow = new ConstantProperty(true);\n    var defaultShadows = new ConstantProperty(ShadowMode.DISABLED);\n    var defaultDistanceDisplayCondition = new ConstantProperty(new DistanceDisplayCondition());\n    var defaultClassificationType = new ConstantProperty(ClassificationType.BOTH);\n\n    function GeometryOptions() {\n        this.vertexFormat = undefined;\n        this.positions = undefined;\n        this.width = undefined;\n        this.arcType = undefined;\n        this.granularity = undefined;\n    }\n\n    function GroundGeometryOptions() {\n        this.positions = undefined;\n        this.width = undefined;\n        this.arcType = undefined;\n        this.granularity = undefined;\n    }\n\n    /**\n     * A {@link GeometryUpdater} for polylines.\n     * Clients do not normally create this class directly, but instead rely on {@link DataSourceDisplay}.\n     * @alias PolylineGeometryUpdater\n     * @constructor\n     *\n     * @param {Entity} entity The entity containing the geometry to be visualized.\n     * @param {Scene} scene The scene where visualization is taking place.\n     */\n    function PolylineGeometryUpdater(entity, scene) {\n        \n\n        this._entity = entity;\n        this._scene = scene;\n        this._entitySubscription = entity.definitionChanged.addEventListener(PolylineGeometryUpdater.prototype._onEntityPropertyChanged, this);\n        this._fillEnabled = false;\n        this._dynamic = false;\n        this._geometryChanged = new Event();\n        this._showProperty = undefined;\n        this._materialProperty = undefined;\n        this._shadowsProperty = undefined;\n        this._distanceDisplayConditionProperty = undefined;\n        this._classificationTypeProperty = undefined;\n        this._depthFailMaterialProperty = undefined;\n        this._geometryOptions = new GeometryOptions();\n        this._groundGeometryOptions = new GroundGeometryOptions();\n        this._id = 'polyline-' + entity.id;\n        this._clampToGround = false;\n        this._supportsPolylinesOnTerrain = Entity.supportsPolylinesOnTerrain(scene);\n\n        this._zIndex = 0;\n\n        this._onEntityPropertyChanged(entity, 'polyline', entity.polyline, undefined);\n    }\n\n    Object.defineProperties(PolylineGeometryUpdater.prototype, {\n        /**\n         * Gets the unique ID associated with this updater\n         * @memberof PolylineGeometryUpdater.prototype\n         * @type {String}\n         * @readonly\n         */\n        id: {\n            get: function() {\n                return this._id;\n            }\n        },\n        /**\n         * Gets the entity associated with this geometry.\n         * @memberof PolylineGeometryUpdater.prototype\n         *\n         * @type {Entity}\n         * @readonly\n         */\n        entity : {\n            get : function() {\n                return this._entity;\n            }\n        },\n        /**\n         * Gets a value indicating if the geometry has a fill component.\n         * @memberof PolylineGeometryUpdater.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        fillEnabled : {\n            get : function() {\n                return this._fillEnabled;\n            }\n        },\n        /**\n         * Gets a value indicating if fill visibility varies with simulation time.\n         * @memberof PolylineGeometryUpdater.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        hasConstantFill : {\n            get : function() {\n                return !this._fillEnabled || (!defined(this._entity.availability) && Property.isConstant(this._showProperty));\n            }\n        },\n        /**\n         * Gets the material property used to fill the geometry.\n         * @memberof PolylineGeometryUpdater.prototype\n         *\n         * @type {MaterialProperty}\n         * @readonly\n         */\n        fillMaterialProperty : {\n            get : function() {\n                return this._materialProperty;\n            }\n        },\n        /**\n         * Gets the material property used to fill the geometry when it fails the depth test.\n         * @memberof PolylineGeometryUpdater.prototype\n         *\n         * @type {MaterialProperty}\n         * @readonly\n         */\n        depthFailMaterialProperty : {\n            get : function() {\n                return this._depthFailMaterialProperty;\n            }\n        },\n        /**\n         * Gets a value indicating if the geometry has an outline component.\n         * @memberof PolylineGeometryUpdater.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        outlineEnabled : {\n            value : false\n        },\n        /**\n         * Gets a value indicating if outline visibility varies with simulation time.\n         * @memberof PolylineGeometryUpdater.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        hasConstantOutline : {\n            value : true\n        },\n        /**\n         * Gets the {@link Color} property for the geometry outline.\n         * @memberof PolylineGeometryUpdater.prototype\n         *\n         * @type {Property}\n         * @readonly\n         */\n        outlineColorProperty : {\n            value : undefined\n        },\n        /**\n         * Gets the property specifying whether the geometry\n         * casts or receives shadows from light sources.\n         * @memberof PolylineGeometryUpdater.prototype\n         *\n         * @type {Property}\n         * @readonly\n         */\n        shadowsProperty : {\n            get : function() {\n                return this._shadowsProperty;\n            }\n        },\n        /**\n         * Gets or sets the {@link DistanceDisplayCondition} Property specifying at what distance from the camera that this geometry will be displayed.\n         * @memberof PolylineGeometryUpdater.prototype\n         *\n         * @type {Property}\n         * @readonly\n         */\n        distanceDisplayConditionProperty : {\n            get : function() {\n                return this._distanceDisplayConditionProperty;\n            }\n        },\n        /**\n         * Gets or sets the {@link ClassificationType} Property specifying if this geometry will classify terrain, 3D Tiles, or both when on the ground.\n         * @memberof PolylineGeometryUpdater.prototype\n         *\n         * @type {Property}\n         * @readonly\n         */\n        classificationTypeProperty : {\n            get : function() {\n                return this._classificationTypeProperty;\n            }\n        },\n        /**\n         * Gets a value indicating if the geometry is time-varying.\n         * If true, all visualization is delegated to the {@link DynamicGeometryUpdater}\n         * returned by GeometryUpdater#createDynamicUpdater.\n         * @memberof PolylineGeometryUpdater.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        isDynamic : {\n            get : function() {\n                return this._dynamic;\n            }\n        },\n        /**\n         * Gets a value indicating if the geometry is closed.\n         * This property is only valid for static geometry.\n         * @memberof PolylineGeometryUpdater.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        isClosed : {\n            value : false\n        },\n        /**\n         * Gets an event that is raised whenever the public properties\n         * of this updater change.\n         * @memberof PolylineGeometryUpdater.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        geometryChanged : {\n            get : function() {\n                return this._geometryChanged;\n            }\n        },\n\n        /**\n         * Gets a value indicating if the path of the line.\n         * @memberof PolylineGeometryUpdater.prototype\n         *\n         * @type {ArcType}\n         * @readonly\n         */\n        arcType : {\n            get : function() {\n                return this._arcType;\n            }\n        },\n\n        /**\n         * Gets a value indicating if the geometry is clamped to the ground.\n         * Returns false if polylines on terrain is not supported.\n         * @memberof PolylineGeometryUpdater.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         */\n        clampToGround : {\n            get : function() {\n                return this._clampToGround && this._supportsPolylinesOnTerrain;\n            }\n        },\n\n        /**\n         * Gets the zindex\n         * @type {Number}\n         * @memberof PolylineGeometryUpdater.prototype\n         * @readonly\n         */\n        zIndex: {\n            get: function() {\n                return this._zIndex;\n            }\n        }\n    });\n\n    /**\n     * Checks if the geometry is outlined at the provided time.\n     *\n     * @param {JulianDate} time The time for which to retrieve visibility.\n     * @returns {Boolean} true if geometry is outlined at the provided time, false otherwise.\n     */\n    PolylineGeometryUpdater.prototype.isOutlineVisible = function(time) {\n        return false;\n    };\n\n    /**\n     * Checks if the geometry is filled at the provided time.\n     *\n     * @param {JulianDate} time The time for which to retrieve visibility.\n     * @returns {Boolean} true if geometry is filled at the provided time, false otherwise.\n     */\n    PolylineGeometryUpdater.prototype.isFilled = function(time) {\n        var entity = this._entity;\n        var visible = this._fillEnabled && entity.isAvailable(time) && this._showProperty.getValue(time);\n        return defaultValue(visible, false);\n    };\n\n    /**\n     * Creates the geometry instance which represents the fill of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the filled portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent a filled geometry.\n     */\n    PolylineGeometryUpdater.prototype.createFillGeometryInstance = function(time) {\n        \n\n        var entity = this._entity;\n        var isAvailable = entity.isAvailable(time);\n        var show = new ShowGeometryInstanceAttribute(isAvailable && entity.isShowing && this._showProperty.getValue(time));\n        var distanceDisplayCondition = this._distanceDisplayConditionProperty.getValue(time);\n        var distanceDisplayConditionAttribute = DistanceDisplayConditionGeometryInstanceAttribute.fromDistanceDisplayCondition(distanceDisplayCondition);\n\n        var attributes = {\n            show : show,\n            distanceDisplayCondition : distanceDisplayConditionAttribute\n        };\n\n        var currentColor;\n        if (this._materialProperty instanceof ColorMaterialProperty) {\n            if (defined(this._materialProperty.color) && (this._materialProperty.color.isConstant || isAvailable)) {\n                currentColor = this._materialProperty.color.getValue(time, scratchColor);\n            }\n            if (!defined(currentColor)) {\n                currentColor = Color.WHITE;\n            }\n            attributes.color = ColorGeometryInstanceAttribute.fromColor(currentColor);\n        }\n\n        if (this.clampToGround) {\n            return new GeometryInstance({\n                id : entity,\n                geometry : new GroundPolylineGeometry(this._groundGeometryOptions),\n                attributes : attributes\n            });\n        }\n\n        if (defined(this._depthFailMaterialProperty) && this._depthFailMaterialProperty instanceof ColorMaterialProperty) {\n            if (defined(this._depthFailMaterialProperty.color) && (this._depthFailMaterialProperty.color.isConstant || isAvailable)) {\n                currentColor = this._depthFailMaterialProperty.color.getValue(time, scratchColor);\n            }\n            if (!defined(currentColor)) {\n                currentColor = Color.WHITE;\n            }\n            attributes.depthFailColor = ColorGeometryInstanceAttribute.fromColor(currentColor);\n        }\n\n        return new GeometryInstance({\n            id : entity,\n            geometry : new PolylineGeometry(this._geometryOptions),\n            attributes : attributes\n        });\n    };\n\n    /**\n     * Creates the geometry instance which represents the outline of the geometry.\n     *\n     * @param {JulianDate} time The time to use when retrieving initial attribute values.\n     * @returns {GeometryInstance} The geometry instance representing the outline portion of the geometry.\n     *\n     * @exception {DeveloperError} This instance does not represent an outlined geometry.\n     */\n    PolylineGeometryUpdater.prototype.createOutlineGeometryInstance = function(time) {\n        \n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     *\n     * @returns {Boolean} True if this object was destroyed; otherwise, false.\n     */\n    PolylineGeometryUpdater.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys and resources used by the object.  Once an object is destroyed, it should not be used.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     */\n    PolylineGeometryUpdater.prototype.destroy = function() {\n        this._entitySubscription();\n        destroyObject(this);\n    };\n\n    PolylineGeometryUpdater.prototype._onEntityPropertyChanged = function(entity, propertyName, newValue, oldValue) {\n        if (!(propertyName === 'availability' || propertyName === 'polyline')) {\n            return;\n        }\n\n        var polyline = this._entity.polyline;\n\n        if (!defined(polyline)) {\n            if (this._fillEnabled) {\n                this._fillEnabled = false;\n                this._geometryChanged.raiseEvent(this);\n            }\n            return;\n        }\n\n        var positionsProperty = polyline.positions;\n\n        var show = polyline.show;\n        if ((defined(show) && show.isConstant && !show.getValue(Iso8601.MINIMUM_VALUE)) || //\n            (!defined(positionsProperty))) {\n            if (this._fillEnabled) {\n                this._fillEnabled = false;\n                this._geometryChanged.raiseEvent(this);\n            }\n            return;\n        }\n\n        var zIndex = polyline.zIndex;\n        var material = defaultValue(polyline.material, defaultMaterial);\n        var isColorMaterial = material instanceof ColorMaterialProperty;\n        this._materialProperty = material;\n        this._depthFailMaterialProperty = polyline.depthFailMaterial;\n        this._showProperty = defaultValue(show, defaultShow);\n        this._shadowsProperty = defaultValue(polyline.shadows, defaultShadows);\n        this._distanceDisplayConditionProperty = defaultValue(polyline.distanceDisplayCondition, defaultDistanceDisplayCondition);\n        this._classificationTypeProperty = defaultValue(polyline.classificationType, defaultClassificationType);\n        this._fillEnabled = true;\n        this._zIndex = defaultValue(zIndex, defaultZIndex);\n\n        var width = polyline.width;\n        var arcType = polyline.arcType;\n        var clampToGround = polyline.clampToGround;\n        var granularity = polyline.granularity;\n\n        if (!positionsProperty.isConstant || !Property.isConstant(width) ||\n            !Property.isConstant(arcType) || !Property.isConstant(granularity) ||\n            !Property.isConstant(clampToGround) || !Property.isConstant(zIndex)) {\n            if (!this._dynamic) {\n                this._dynamic = true;\n                this._geometryChanged.raiseEvent(this);\n            }\n        } else {\n            var geometryOptions = this._geometryOptions;\n            var positions = positionsProperty.getValue(Iso8601.MINIMUM_VALUE, geometryOptions.positions);\n\n            //Because of the way we currently handle reference properties,\n            //we can't automatically assume the positions are always valid.\n            if (!defined(positions) || positions.length < 2) {\n                if (this._fillEnabled) {\n                    this._fillEnabled = false;\n                    this._geometryChanged.raiseEvent(this);\n                }\n                return;\n            }\n\n            var vertexFormat;\n            if (isColorMaterial && (!defined(this._depthFailMaterialProperty) || this._depthFailMaterialProperty instanceof ColorMaterialProperty)) {\n                vertexFormat = PolylineColorAppearance.VERTEX_FORMAT;\n            } else {\n                vertexFormat = PolylineMaterialAppearance.VERTEX_FORMAT;\n            }\n\n            geometryOptions.vertexFormat = vertexFormat;\n            geometryOptions.positions = positions;\n            geometryOptions.width = defined(width) ? width.getValue(Iso8601.MINIMUM_VALUE) : undefined;\n            geometryOptions.arcType = defined(arcType) ? arcType.getValue(Iso8601.MINIMUM_VALUE) : undefined;\n            geometryOptions.granularity = defined(granularity) ? granularity.getValue(Iso8601.MINIMUM_VALUE) : undefined;\n\n            var groundGeometryOptions = this._groundGeometryOptions;\n            groundGeometryOptions.positions = positions;\n            groundGeometryOptions.width = geometryOptions.width;\n            groundGeometryOptions.arcType = geometryOptions.arcType;\n            groundGeometryOptions.granularity = geometryOptions.granularity;\n\n            this._clampToGround = defined(clampToGround) ? clampToGround.getValue(Iso8601.MINIMUM_VALUE) : false;\n\n            if (!this._clampToGround && defined(zIndex)) {\n                oneTimeWarning('Entity polylines must have clampToGround: true when using zIndex.  zIndex will be ignored.');\n            }\n\n            this._dynamic = false;\n            this._geometryChanged.raiseEvent(this);\n        }\n    };\n\n    /**\n     * Creates the dynamic updater to be used when GeometryUpdater#isDynamic is true.\n     *\n     * @param {PrimitiveCollection} primitives The primitive collection to use.\n     * @param {PrimitiveCollection|OrderedGroundPrimitiveCollection} groundPrimitives The primitive collection to use for ordered ground primitives.\n     * @returns {DynamicGeometryUpdater} The dynamic updater used to update the geometry each frame.\n     *\n     * @exception {DeveloperError} This instance does not represent dynamic geometry.\n     */\n    PolylineGeometryUpdater.prototype.createDynamicUpdater = function(primitives, groundPrimitives) {\n        \n\n        return new DynamicGeometryUpdater(primitives, groundPrimitives, this);\n    };\n\n    /**\n     * @private\n     */\n    var generateCartesianArcOptions = {\n        positions : undefined,\n        granularity : undefined,\n        height : undefined,\n        ellipsoid : undefined\n    };\n\n    function DynamicGeometryUpdater(primitives, groundPrimitives, geometryUpdater) {\n        this._line = undefined;\n        this._primitives = primitives;\n        this._groundPrimitives = groundPrimitives;\n        this._groundPolylinePrimitive = undefined;\n        this._material = undefined;\n        this._geometryUpdater = geometryUpdater;\n        this._positions = [];\n    }\n\n    function getLine(dynamicGeometryUpdater) {\n        if (defined(dynamicGeometryUpdater._line)) {\n            return dynamicGeometryUpdater._line;\n        }\n\n        var sceneId = dynamicGeometryUpdater._geometryUpdater._scene.id;\n        var polylineCollection = polylineCollections[sceneId];\n        var primitives = dynamicGeometryUpdater._primitives;\n        if (!defined(polylineCollection) || polylineCollection.isDestroyed()) {\n            polylineCollection = new PolylineCollection();\n            polylineCollections[sceneId] = polylineCollection;\n            primitives.add(polylineCollection);\n        } else if (!primitives.contains(polylineCollection)) {\n            primitives.add(polylineCollection);\n        }\n\n        var line = polylineCollection.add();\n        line.id = dynamicGeometryUpdater._geometryUpdater._entity;\n        dynamicGeometryUpdater._line = line;\n        return line;\n    }\n\n    DynamicGeometryUpdater.prototype.update = function(time) {\n        var geometryUpdater = this._geometryUpdater;\n        var entity = geometryUpdater._entity;\n        var polyline = entity.polyline;\n\n        var positionsProperty = polyline.positions;\n        var positions = Property.getValueOrUndefined(positionsProperty, time, this._positions);\n\n        // Synchronize with geometryUpdater for GroundPolylinePrimitive\n        geometryUpdater._clampToGround = Property.getValueOrDefault(polyline._clampToGround, time, false);\n        geometryUpdater._groundGeometryOptions.positions = positions;\n        geometryUpdater._groundGeometryOptions.width = Property.getValueOrDefault(polyline._width, time, 1);\n        geometryUpdater._groundGeometryOptions.arcType = Property.getValueOrDefault(polyline._arcType, time, ArcType.GEODESIC);\n        geometryUpdater._groundGeometryOptions.granularity = Property.getValueOrDefault(polyline._granularity, time, 9999);\n\n        var groundPrimitives = this._groundPrimitives;\n\n        if (defined(this._groundPolylinePrimitive)) {\n            groundPrimitives.remove(this._groundPolylinePrimitive); // destroys by default\n            this._groundPolylinePrimitive = undefined;\n        }\n\n        if (geometryUpdater.clampToGround) {\n            if (!entity.isShowing || !entity.isAvailable(time) || !Property.getValueOrDefault(polyline._show, time, true)) {\n                return;\n            }\n\n            if (!defined(positions) || positions.length < 2) {\n                return;\n            }\n\n            var fillMaterialProperty = geometryUpdater.fillMaterialProperty;\n            var appearance;\n            if (fillMaterialProperty instanceof ColorMaterialProperty) {\n                appearance = new PolylineColorAppearance();\n            } else {\n                var material = MaterialProperty.getValue(time, fillMaterialProperty, this._material);\n                appearance = new PolylineMaterialAppearance({\n                    material : material,\n                    translucent : material.isTranslucent()\n                });\n                this._material = material;\n            }\n\n            this._groundPolylinePrimitive = groundPrimitives.add(new GroundPolylinePrimitive({\n                geometryInstances : geometryUpdater.createFillGeometryInstance(time),\n                appearance : appearance,\n                classificationType : geometryUpdater.classificationTypeProperty.getValue(time),\n                asynchronous : false\n            }), Property.getValueOrUndefined(geometryUpdater.zIndex, time));\n\n            // Hide the polyline in the collection, if any\n            if (defined(this._line)) {\n                this._line.show = false;\n            }\n            return;\n        }\n\n        var line = getLine(this);\n\n        if (!entity.isShowing || !entity.isAvailable(time) || !Property.getValueOrDefault(polyline._show, time, true)) {\n            line.show = false;\n            return;\n        }\n\n        if (!defined(positions) || positions.length < 2) {\n            line.show = false;\n            return;\n        }\n\n        var arcType = ArcType.GEODESIC;\n        arcType = Property.getValueOrDefault(polyline._arcType, time, arcType);\n\n        var globe = geometryUpdater._scene.globe;\n        if (arcType !== ArcType.NONE && defined(globe)) {\n            generateCartesianArcOptions.ellipsoid = globe.ellipsoid;\n            generateCartesianArcOptions.positions = positions;\n            generateCartesianArcOptions.granularity = Property.getValueOrUndefined(polyline._granularity, time);\n            generateCartesianArcOptions.height = PolylinePipeline.extractHeights(positions, globe.ellipsoid);\n            if (arcType === ArcType.GEODESIC) {\n                positions = PolylinePipeline.generateCartesianArc(generateCartesianArcOptions);\n            } else {\n                positions = PolylinePipeline.generateCartesianRhumbArc(generateCartesianArcOptions);\n            }\n        }\n\n        line.show = true;\n        line.positions = positions.slice();\n        line.material = MaterialProperty.getValue(time, geometryUpdater.fillMaterialProperty, line.material);\n        line.width = Property.getValueOrDefault(polyline._width, time, 1);\n        line.distanceDisplayCondition = Property.getValueOrUndefined(polyline._distanceDisplayCondition, time, line.distanceDisplayCondition);\n    };\n\n    DynamicGeometryUpdater.prototype.getBoundingSphere = function(result) {\n        \n\n        if (!this._geometryUpdater.clampToGround) {\n            var line = getLine(this);\n            if (line.show && line.positions.length > 0) {\n                BoundingSphere.fromPoints(line.positions, result);\n                return BoundingSphereState.DONE;\n            }\n        } else {\n            var groundPolylinePrimitive = this._groundPolylinePrimitive;\n            if (defined(groundPolylinePrimitive) && groundPolylinePrimitive.show && groundPolylinePrimitive.ready) {\n                var attributes = groundPolylinePrimitive.getGeometryInstanceAttributes(this._geometryUpdater._entity);\n                if (defined(attributes) && defined(attributes.boundingSphere)) {\n                    BoundingSphere.clone(attributes.boundingSphere, result);\n                    return BoundingSphereState.DONE;\n                }\n            }\n\n            if ((defined(groundPolylinePrimitive) && !groundPolylinePrimitive.ready)) {\n                return BoundingSphereState.PENDING;\n            }\n\n            return BoundingSphereState.DONE;\n        }\n\n        return BoundingSphereState.FAILED;\n    };\n\n    DynamicGeometryUpdater.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    DynamicGeometryUpdater.prototype.destroy = function() {\n        var geometryUpdater = this._geometryUpdater;\n        var sceneId = geometryUpdater._scene.id;\n        var polylineCollection = polylineCollections[sceneId];\n        if (defined(polylineCollection)) {\n            polylineCollection.remove(this._line);\n            if (polylineCollection.length === 0) {\n                this._primitives.removeAndDestroy(polylineCollection);\n                delete polylineCollections[sceneId];\n            }\n        }\n        if (defined(this._groundPolylinePrimitive)) {\n            this._groundPrimitives.remove(this._groundPolylinePrimitive);\n        }\n        destroyObject(this);\n    };\nexport default PolylineGeometryUpdater;\n","import AssociativeArray from '../Core/AssociativeArray.js';\nimport Color from '../Core/Color.js';\nimport ColorGeometryInstanceAttribute from '../Core/ColorGeometryInstanceAttribute.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport DistanceDisplayCondition from '../Core/DistanceDisplayCondition.js';\nimport DistanceDisplayConditionGeometryInstanceAttribute from '../Core/DistanceDisplayConditionGeometryInstanceAttribute.js';\nimport ShowGeometryInstanceAttribute from '../Core/ShowGeometryInstanceAttribute.js';\nimport GroundPolylinePrimitive from '../Scene/GroundPolylinePrimitive.js';\nimport PolylineColorAppearance from '../Scene/PolylineColorAppearance.js';\nimport PolylineMaterialAppearance from '../Scene/PolylineMaterialAppearance.js';\nimport BoundingSphereState from './BoundingSphereState.js';\nimport ColorMaterialProperty from './ColorMaterialProperty.js';\nimport MaterialProperty from './MaterialProperty.js';\nimport Property from './Property.js';\n\n    var scratchColor = new Color();\n    var distanceDisplayConditionScratch = new DistanceDisplayCondition();\n    var defaultDistanceDisplayCondition = new DistanceDisplayCondition();\n\n    // Encapsulates a Primitive and all the entities that it represents.\n    function Batch(orderedGroundPrimitives, classificationType, materialProperty, zIndex, asynchronous) {\n        var appearanceType;\n        if (materialProperty instanceof ColorMaterialProperty) {\n            appearanceType = PolylineColorAppearance;\n        } else {\n            appearanceType = PolylineMaterialAppearance;\n        }\n\n        this.orderedGroundPrimitives = orderedGroundPrimitives; // scene level primitive collection\n        this.classificationType = classificationType;\n        this.appearanceType = appearanceType;\n        this.materialProperty = materialProperty;\n        this.updaters = new AssociativeArray();\n        this.createPrimitive = true;\n        this.primitive = undefined; // a GroundPolylinePrimitive encapsulating all the entities\n        this.oldPrimitive = undefined;\n        this.geometry = new AssociativeArray();\n        this.material = undefined;\n        this.updatersWithAttributes = new AssociativeArray();\n        this.attributes = new AssociativeArray();\n        this.invalidated = false;\n        this.removeMaterialSubscription = materialProperty.definitionChanged.addEventListener(Batch.prototype.onMaterialChanged, this);\n        this.subscriptions = new AssociativeArray();\n        this.showsUpdated = new AssociativeArray();\n        this.zIndex = zIndex;\n\n        this._asynchronous = asynchronous;\n    }\n\n    Batch.prototype.onMaterialChanged = function() {\n        this.invalidated = true;\n    };\n\n    // Check if the given updater's material is compatible with this batch\n    Batch.prototype.isMaterial = function(updater) {\n        var material = this.materialProperty;\n        var updaterMaterial = updater.fillMaterialProperty;\n\n        if (updaterMaterial === material ||\n            (updaterMaterial instanceof ColorMaterialProperty && material instanceof ColorMaterialProperty)) {\n            return true;\n        }\n        return defined(material) && material.equals(updaterMaterial);\n    };\n\n    Batch.prototype.add = function(time, updater, geometryInstance) {\n        var id = updater.id;\n        this.updaters.set(id, updater);\n        this.geometry.set(id, geometryInstance);\n        // Updaters with dynamic attributes must be tracked separately, may exit the batch\n        if (!updater.hasConstantFill || !updater.fillMaterialProperty.isConstant || !Property.isConstant(updater.distanceDisplayConditionProperty)) {\n            this.updatersWithAttributes.set(id, updater);\n        } else {\n            var that = this;\n            // Listen for show changes. These will be synchronized in updateShows.\n            this.subscriptions.set(id, updater.entity.definitionChanged.addEventListener(function(entity, propertyName, newValue, oldValue) {\n                if (propertyName === 'isShowing') {\n                    that.showsUpdated.set(updater.id, updater);\n                }\n            }));\n        }\n        this.createPrimitive = true;\n    };\n\n    Batch.prototype.remove = function(updater) {\n        var id = updater.id;\n        this.createPrimitive = this.geometry.remove(id) || this.createPrimitive;\n        if (this.updaters.remove(id)) {\n            this.updatersWithAttributes.remove(id);\n            var unsubscribe = this.subscriptions.get(id);\n            if (defined(unsubscribe)) {\n                unsubscribe();\n                this.subscriptions.remove(id);\n            }\n            return true;\n        }\n        return false;\n    };\n\n    Batch.prototype.update = function(time) {\n        var isUpdated = true;\n        var primitive = this.primitive;\n        var orderedGroundPrimitives = this.orderedGroundPrimitives;\n        var geometries = this.geometry.values;\n        var i;\n\n        if (this.createPrimitive) {\n            var geometriesLength = geometries.length;\n            if (geometriesLength > 0) {\n                if (defined(primitive)) {\n                    // Keep a handle to the old primitive so it can be removed when the updated version is ready.\n                    if (!defined(this.oldPrimitive)) {\n                        this.oldPrimitive = primitive;\n                    } else {\n                        // For if the new primitive changes again before it is ready.\n                        orderedGroundPrimitives.remove(primitive);\n                    }\n                }\n\n                primitive = new GroundPolylinePrimitive({\n                    show : false,\n                    asynchronous : this._asynchronous,\n                    geometryInstances : geometries.slice(),\n                    appearance : new this.appearanceType(),\n                    classificationType : this.classificationType\n                });\n\n                if (this.appearanceType === PolylineMaterialAppearance) {\n                    this.material = MaterialProperty.getValue(time, this.materialProperty, this.material);\n                    primitive.appearance.material = this.material;\n                }\n\n                orderedGroundPrimitives.add(primitive, this.zIndex);\n                isUpdated = false;\n            } else {\n                if (defined(primitive)) {\n                    orderedGroundPrimitives.remove(primitive);\n                    primitive = undefined;\n                }\n                var oldPrimitive = this.oldPrimitive;\n                if (defined(oldPrimitive)) {\n                    orderedGroundPrimitives.remove(oldPrimitive);\n                    this.oldPrimitive = undefined;\n                }\n            }\n\n            this.attributes.removeAll();\n            this.primitive = primitive;\n            this.createPrimitive = false;\n        } else if (defined(primitive) && primitive.ready) {\n            primitive.show = true;\n            if (defined(this.oldPrimitive)) {\n                orderedGroundPrimitives.remove(this.oldPrimitive);\n                this.oldPrimitive = undefined;\n            }\n\n            if (this.appearanceType === PolylineMaterialAppearance) {\n                this.material = MaterialProperty.getValue(time, this.materialProperty, this.material);\n                this.primitive.appearance.material = this.material;\n            }\n            var updatersWithAttributes = this.updatersWithAttributes.values;\n            var length = updatersWithAttributes.length;\n            for (i = 0; i < length; i++) {\n                var updater = updatersWithAttributes[i];\n                var entity = updater.entity;\n                var instance = this.geometry.get(updater.id);\n\n                var attributes = this.attributes.get(instance.id.id);\n                if (!defined(attributes)) {\n                    attributes = primitive.getGeometryInstanceAttributes(instance.id);\n                    this.attributes.set(instance.id.id, attributes);\n                }\n\n                if (!updater.fillMaterialProperty.isConstant) {\n                    var colorProperty = updater.fillMaterialProperty.color;\n                    var resultColor = Property.getValueOrDefault(colorProperty, time, Color.WHITE, scratchColor);\n                    if (!Color.equals(attributes._lastColor, resultColor)) {\n                        attributes._lastColor = Color.clone(resultColor, attributes._lastColor);\n                        attributes.color = ColorGeometryInstanceAttribute.toValue(resultColor, attributes.color);\n                    }\n                }\n\n                var show = entity.isShowing && (updater.hasConstantFill || updater.isFilled(time));\n                var currentShow = attributes.show[0] === 1;\n                if (show !== currentShow) {\n                    attributes.show = ShowGeometryInstanceAttribute.toValue(show, attributes.show);\n                }\n\n                var distanceDisplayConditionProperty = updater.distanceDisplayConditionProperty;\n                if (!Property.isConstant(distanceDisplayConditionProperty)) {\n                    var distanceDisplayCondition = Property.getValueOrDefault(distanceDisplayConditionProperty, time, defaultDistanceDisplayCondition, distanceDisplayConditionScratch);\n                    if (!DistanceDisplayCondition.equals(distanceDisplayCondition, attributes._lastDistanceDisplayCondition)) {\n                        attributes._lastDistanceDisplayCondition = DistanceDisplayCondition.clone(distanceDisplayCondition, attributes._lastDistanceDisplayCondition);\n                        attributes.distanceDisplayCondition = DistanceDisplayConditionGeometryInstanceAttribute.toValue(distanceDisplayCondition, attributes.distanceDisplayCondition);\n                    }\n                }\n            }\n\n            this.updateShows(primitive);\n        } else if (defined(primitive) && !primitive.ready) {\n            isUpdated = false;\n        }\n        return isUpdated;\n    };\n\n    Batch.prototype.updateShows = function(primitive) {\n        var showsUpdated = this.showsUpdated.values;\n        var length = showsUpdated.length;\n        for (var i = 0; i < length; i++) {\n            var updater = showsUpdated[i];\n            var entity = updater.entity;\n            var instance = this.geometry.get(updater.id);\n\n            var attributes = this.attributes.get(instance.id.id);\n            if (!defined(attributes)) {\n                attributes = primitive.getGeometryInstanceAttributes(instance.id);\n                this.attributes.set(instance.id.id, attributes);\n            }\n\n            var show = entity.isShowing;\n            var currentShow = attributes.show[0] === 1;\n            if (show !== currentShow) {\n                attributes.show = ShowGeometryInstanceAttribute.toValue(show, attributes.show);\n                instance.attributes.show.value[0] = attributes.show[0];\n            }\n        }\n        this.showsUpdated.removeAll();\n    };\n\n    Batch.prototype.contains = function(updater) {\n        return this.updaters.contains(updater.id);\n    };\n\n    Batch.prototype.getBoundingSphere = function(updater, result) {\n        var primitive = this.primitive;\n        if (!primitive.ready) {\n            return BoundingSphereState.PENDING;\n        }\n        var attributes = primitive.getGeometryInstanceAttributes(updater.entity);\n        if (!defined(attributes) || !defined(attributes.boundingSphere) ||\n            (defined(attributes.show) && attributes.show[0] === 0)) {\n            return BoundingSphereState.FAILED;\n        }\n        attributes.boundingSphere.clone(result);\n        return BoundingSphereState.DONE;\n    };\n\n    Batch.prototype.destroy = function() {\n        var primitive = this.primitive;\n        var orderedGroundPrimitives = this.orderedGroundPrimitives;\n        if (defined(primitive)) {\n            orderedGroundPrimitives.remove(primitive);\n        }\n        var oldPrimitive = this.oldPrimitive;\n        if (defined(oldPrimitive)) {\n            orderedGroundPrimitives.remove(oldPrimitive);\n        }\n        this.removeMaterialSubscription();\n    };\n\n    /**\n     * @private\n     */\n    function StaticGroundPolylinePerMaterialBatch(orderedGroundPrimitives, classificationType, asynchronous) {\n        this._items = [];\n        this._orderedGroundPrimitives = orderedGroundPrimitives;\n        this._classificationType = classificationType;\n        this._asynchronous = defaultValue(asynchronous, true);\n    }\n\n    StaticGroundPolylinePerMaterialBatch.prototype.add = function(time, updater) {\n        var items = this._items;\n        var length = items.length;\n        var geometryInstance = updater.createFillGeometryInstance(time);\n        var zIndex = Property.getValueOrDefault(updater.zIndex, 0);\n        // Check if the Entity represented by the updater has the same material or a material representable with per-instance color.\n        for (var i = 0; i < length; ++i) {\n            var item = items[i];\n            if (item.isMaterial(updater) &&\n                item.zIndex === zIndex) {\n                item.add(time, updater, geometryInstance);\n                return;\n            }\n        }\n        // If a compatible batch wasn't found, create a new batch.\n        var batch = new Batch(this._orderedGroundPrimitives, this._classificationType, updater.fillMaterialProperty, zIndex, this._asynchronous);\n        batch.add(time, updater, geometryInstance);\n        items.push(batch);\n    };\n\n    StaticGroundPolylinePerMaterialBatch.prototype.remove = function(updater) {\n        var items = this._items;\n        var length = items.length;\n        for (var i = length - 1; i >= 0; i--) {\n            var item = items[i];\n            if (item.remove(updater)) {\n                if (item.updaters.length === 0) {\n                    items.splice(i, 1);\n                    item.destroy();\n                }\n                break;\n            }\n        }\n    };\n\n    StaticGroundPolylinePerMaterialBatch.prototype.update = function(time) {\n        var i;\n        var items = this._items;\n        var length = items.length;\n\n        for (i = length - 1; i >= 0; i--) {\n            var item = items[i];\n            if (item.invalidated) {\n                items.splice(i, 1);\n                var updaters = item.updaters.values;\n                var updatersLength = updaters.length;\n                for (var h = 0; h < updatersLength; h++) {\n                    this.add(time, updaters[h]);\n                }\n                item.destroy();\n            }\n        }\n\n        var isUpdated = true;\n        for (i = 0; i < items.length; i++) {\n            isUpdated = items[i].update(time) && isUpdated;\n        }\n        return isUpdated;\n    };\n\n    StaticGroundPolylinePerMaterialBatch.prototype.getBoundingSphere = function(updater, result) {\n        var items = this._items;\n        var length = items.length;\n        for (var i = 0; i < length; i++) {\n            var item = items[i];\n            if (item.contains(updater)){\n                return item.getBoundingSphere(updater, result);\n            }\n        }\n        return BoundingSphereState.FAILED;\n    };\n\n    StaticGroundPolylinePerMaterialBatch.prototype.removeAllPrimitives = function() {\n        var items = this._items;\n        var length = items.length;\n        for (var i = 0; i < length; i++) {\n            items[i].destroy();\n        }\n        this._items.length = 0;\n    };\nexport default StaticGroundPolylinePerMaterialBatch;\n","import AssociativeArray from '../Core/AssociativeArray.js';\nimport BoundingSphere from '../Core/BoundingSphere.js';\nimport Check from '../Core/Check.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport ClassificationType from '../Scene/ClassificationType.js';\nimport PolylineColorAppearance from '../Scene/PolylineColorAppearance.js';\nimport PolylineMaterialAppearance from '../Scene/PolylineMaterialAppearance.js';\nimport ShadowMode from '../Scene/ShadowMode.js';\nimport BoundingSphereState from './BoundingSphereState.js';\nimport ColorMaterialProperty from './ColorMaterialProperty.js';\nimport DynamicGeometryBatch from './DynamicGeometryBatch.js';\nimport PolylineGeometryUpdater from './PolylineGeometryUpdater.js';\nimport StaticGeometryColorBatch from './StaticGeometryColorBatch.js';\nimport StaticGeometryPerMaterialBatch from './StaticGeometryPerMaterialBatch.js';\nimport StaticGroundPolylinePerMaterialBatch from './StaticGroundPolylinePerMaterialBatch.js';\n\n    var emptyArray = [];\n\n    function removeUpdater(that, updater) {\n        //We don't keep track of which batch an updater is in, so just remove it from all of them.\n        var batches = that._batches;\n        var length = batches.length;\n        for (var i = 0; i < length; i++) {\n            batches[i].remove(updater);\n        }\n    }\n\n    function insertUpdaterIntoBatch(that, time, updater) {\n        if (updater.isDynamic) {\n            that._dynamicBatch.add(time, updater);\n            return;\n        }\n\n        if (updater.clampToGround && updater.fillEnabled) { // Also checks for support\n            var classificationType = updater.classificationTypeProperty.getValue(time);\n            that._groundBatches[classificationType].add(time, updater);\n            return;\n        }\n\n        var shadows;\n        if (updater.fillEnabled) {\n            shadows = updater.shadowsProperty.getValue(time);\n        }\n\n        var multiplier = 0;\n        if (defined(updater.depthFailMaterialProperty)) {\n            multiplier = updater.depthFailMaterialProperty instanceof ColorMaterialProperty ? 1 : 2;\n        }\n\n        var index;\n        if (defined(shadows)) {\n            index = shadows + multiplier * ShadowMode.NUMBER_OF_SHADOW_MODES;\n        }\n\n        if (updater.fillEnabled) {\n            if (updater.fillMaterialProperty instanceof ColorMaterialProperty) {\n                that._colorBatches[index].add(time, updater);\n            } else {\n                that._materialBatches[index].add(time, updater);\n            }\n        }\n    }\n\n    /**\n     * A visualizer for polylines represented by {@link Primitive} instances.\n     * @alias PolylineVisualizer\n     * @constructor\n     *\n     * @param {Scene} scene The scene the primitives will be rendered in.\n     * @param {EntityCollection} entityCollection The entityCollection to visualize.\n     * @param {PrimitiveCollection} [primitives=scene.primitives] A collection to add primitives related to the entities\n     * @param {PrimitiveCollection} [groundPrimitives=scene.groundPrimitives] A collection to add ground primitives related to the entities\n     */\n    function PolylineVisualizer(scene, entityCollection, primitives, groundPrimitives) {\n        \n\n        groundPrimitives = defaultValue(groundPrimitives, scene.groundPrimitives);\n        primitives = defaultValue(primitives, scene.primitives);\n\n        this._scene = scene;\n        this._primitives = primitives;\n        this._entityCollection = undefined;\n        this._addedObjects = new AssociativeArray();\n        this._removedObjects = new AssociativeArray();\n        this._changedObjects = new AssociativeArray();\n\n        var i;\n        var numberOfShadowModes = ShadowMode.NUMBER_OF_SHADOW_MODES;\n        this._colorBatches = new Array(numberOfShadowModes * 3);\n        this._materialBatches = new Array(numberOfShadowModes * 3);\n\n        for (i = 0; i < numberOfShadowModes; ++i) {\n            this._colorBatches[i] = new StaticGeometryColorBatch(primitives, PolylineColorAppearance, undefined, false, i); // no depth fail appearance\n            this._materialBatches[i] = new StaticGeometryPerMaterialBatch(primitives, PolylineMaterialAppearance, undefined, false, i);\n\n            this._colorBatches[i + numberOfShadowModes] = new StaticGeometryColorBatch(primitives, PolylineColorAppearance, PolylineColorAppearance, false, i); //depth fail appearance variations\n            this._materialBatches[i + numberOfShadowModes] = new StaticGeometryPerMaterialBatch(primitives, PolylineMaterialAppearance, PolylineColorAppearance, false, i);\n\n            this._colorBatches[i + numberOfShadowModes * 2] = new StaticGeometryColorBatch(primitives, PolylineColorAppearance, PolylineMaterialAppearance, false, i);\n            this._materialBatches[i + numberOfShadowModes * 2] = new StaticGeometryPerMaterialBatch(primitives, PolylineMaterialAppearance, PolylineMaterialAppearance, false, i);\n        }\n\n        this._dynamicBatch = new DynamicGeometryBatch(primitives, groundPrimitives);\n\n        var numberOfClassificationTypes = ClassificationType.NUMBER_OF_CLASSIFICATION_TYPES;\n        this._groundBatches = new Array(numberOfClassificationTypes);\n\n        for (i = 0; i < numberOfClassificationTypes; ++i) {\n            this._groundBatches[i] = new StaticGroundPolylinePerMaterialBatch(groundPrimitives, i);\n        }\n\n        this._batches = this._colorBatches.concat(this._materialBatches, this._dynamicBatch, this._groundBatches);\n\n        this._subscriptions = new AssociativeArray();\n        this._updaters = new AssociativeArray();\n\n        this._entityCollection = entityCollection;\n        entityCollection.collectionChanged.addEventListener(PolylineVisualizer.prototype._onCollectionChanged, this);\n        this._onCollectionChanged(entityCollection, entityCollection.values, emptyArray);\n    }\n\n    /**\n     * Updates all of the primitives created by this visualizer to match their\n     * Entity counterpart at the given time.\n     *\n     * @param {JulianDate} time The time to update to.\n     * @returns {Boolean} True if the visualizer successfully updated to the provided time,\n     * false if the visualizer is waiting for asynchronous primitives to be created.\n     */\n    PolylineVisualizer.prototype.update = function(time) {\n        \n\n        var addedObjects = this._addedObjects;\n        var added = addedObjects.values;\n        var removedObjects = this._removedObjects;\n        var removed = removedObjects.values;\n        var changedObjects = this._changedObjects;\n        var changed = changedObjects.values;\n\n        var i;\n        var entity;\n        var id;\n        var updater;\n\n        for (i = changed.length - 1; i > -1; i--) {\n            entity = changed[i];\n            id = entity.id;\n            updater = this._updaters.get(id);\n\n            //If in a single update, an entity gets removed and a new instance\n            //re-added with the same id, the updater no longer tracks the\n            //correct entity, we need to both remove the old one and\n            //add the new one, which is done by pushing the entity\n            //onto the removed/added lists.\n            if (updater.entity === entity) {\n                removeUpdater(this, updater);\n                insertUpdaterIntoBatch(this, time, updater);\n            } else {\n                removed.push(entity);\n                added.push(entity);\n            }\n        }\n\n        for (i = removed.length - 1; i > -1; i--) {\n            entity = removed[i];\n            id = entity.id;\n            updater = this._updaters.get(id);\n            removeUpdater(this, updater);\n            updater.destroy();\n            this._updaters.remove(id);\n            this._subscriptions.get(id)();\n            this._subscriptions.remove(id);\n        }\n\n        for (i = added.length - 1; i > -1; i--) {\n            entity = added[i];\n            id = entity.id;\n            updater = new PolylineGeometryUpdater(entity, this._scene);\n            this._updaters.set(id, updater);\n            insertUpdaterIntoBatch(this, time, updater);\n            this._subscriptions.set(id, updater.geometryChanged.addEventListener(PolylineVisualizer._onGeometryChanged, this));\n        }\n\n        addedObjects.removeAll();\n        removedObjects.removeAll();\n        changedObjects.removeAll();\n\n        var isUpdated = true;\n        var batches = this._batches;\n        var length = batches.length;\n        for (i = 0; i < length; i++) {\n            isUpdated = batches[i].update(time) && isUpdated;\n        }\n\n        return isUpdated;\n    };\n\n    var getBoundingSphereArrayScratch = [];\n    var getBoundingSphereBoundingSphereScratch = new BoundingSphere();\n\n    /**\n     * Computes a bounding sphere which encloses the visualization produced for the specified entity.\n     * The bounding sphere is in the fixed frame of the scene's globe.\n     *\n     * @param {Entity} entity The entity whose bounding sphere to compute.\n     * @param {BoundingSphere} result The bounding sphere onto which to store the result.\n     * @returns {BoundingSphereState} BoundingSphereState.DONE if the result contains the bounding sphere,\n     *                       BoundingSphereState.PENDING if the result is still being computed, or\n     *                       BoundingSphereState.FAILED if the entity has no visualization in the current scene.\n     * @private\n     */\n    PolylineVisualizer.prototype.getBoundingSphere = function(entity, result) {\n        \n\n        var boundingSpheres = getBoundingSphereArrayScratch;\n        var tmp = getBoundingSphereBoundingSphereScratch;\n\n        var count = 0;\n        var state = BoundingSphereState.DONE;\n        var batches = this._batches;\n        var batchesLength = batches.length;\n        var updater = this._updaters.get(entity.id);\n        for (var i = 0; i < batchesLength; i++) {\n            state = batches[i].getBoundingSphere(updater, tmp);\n            if (state === BoundingSphereState.PENDING) {\n                return BoundingSphereState.PENDING;\n            } else if (state === BoundingSphereState.DONE) {\n                boundingSpheres[count] = BoundingSphere.clone(tmp, boundingSpheres[count]);\n                count++;\n            }\n        }\n\n        if (count === 0) {\n            return BoundingSphereState.FAILED;\n        }\n\n        boundingSpheres.length = count;\n        BoundingSphere.fromBoundingSpheres(boundingSpheres, result);\n        return BoundingSphereState.DONE;\n    };\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     *\n     * @returns {Boolean} True if this object was destroyed; otherwise, false.\n     */\n    PolylineVisualizer.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Removes and destroys all primitives created by this instance.\n     */\n    PolylineVisualizer.prototype.destroy = function() {\n        this._entityCollection.collectionChanged.removeEventListener(PolylineVisualizer.prototype._onCollectionChanged, this);\n        this._addedObjects.removeAll();\n        this._removedObjects.removeAll();\n\n        var i;\n        var batches = this._batches;\n        var length = batches.length;\n        for (i = 0; i < length; i++) {\n            batches[i].removeAllPrimitives();\n        }\n\n        var subscriptions = this._subscriptions.values;\n        length = subscriptions.length;\n        for (i = 0; i < length; i++) {\n            subscriptions[i]();\n        }\n        this._subscriptions.removeAll();\n        return destroyObject(this);\n    };\n\n    /**\n     * @private\n     */\n    PolylineVisualizer._onGeometryChanged = function(updater) {\n        var removedObjects = this._removedObjects;\n        var changedObjects = this._changedObjects;\n\n        var entity = updater.entity;\n        var id = entity.id;\n\n        if (!defined(removedObjects.get(id)) && !defined(changedObjects.get(id))) {\n            changedObjects.set(id, entity);\n        }\n    };\n\n    /**\n     * @private\n     */\n    PolylineVisualizer.prototype._onCollectionChanged = function(entityCollection, added, removed) {\n        var addedObjects = this._addedObjects;\n        var removedObjects = this._removedObjects;\n        var changedObjects = this._changedObjects;\n\n        var i;\n        var id;\n        var entity;\n        for (i = removed.length - 1; i > -1; i--) {\n            entity = removed[i];\n            id = entity.id;\n            if (!addedObjects.remove(id)) {\n                removedObjects.set(id, entity);\n                changedObjects.remove(id);\n            }\n        }\n\n        for (i = added.length - 1; i > -1; i--) {\n            entity = added[i];\n            id = entity.id;\n            if (removedObjects.remove(id)) {\n                changedObjects.set(id, entity);\n            } else {\n                addedObjects.set(id, entity);\n            }\n        }\n    };\nexport default PolylineVisualizer;\n","import ApproximateTerrainHeights from '../Core/ApproximateTerrainHeights.js';\nimport BoundingSphere from '../Core/BoundingSphere.js';\nimport Check from '../Core/Check.js';\nimport createGuid from '../Core/createGuid.js';\nimport defaultValue from '../Core/defaultValue.js';\nimport defined from '../Core/defined.js';\nimport destroyObject from '../Core/destroyObject.js';\nimport EventHelper from '../Core/EventHelper.js';\nimport GroundPolylinePrimitive from '../Scene/GroundPolylinePrimitive.js';\nimport GroundPrimitive from '../Scene/GroundPrimitive.js';\nimport OrderedGroundPrimitiveCollection from '../Scene/OrderedGroundPrimitiveCollection.js';\nimport PrimitiveCollection from '../Scene/PrimitiveCollection.js';\nimport BillboardVisualizer from './BillboardVisualizer.js';\nimport BoundingSphereState from './BoundingSphereState.js';\nimport CustomDataSource from './CustomDataSource.js';\nimport GeometryVisualizer from './GeometryVisualizer.js';\nimport LabelVisualizer from './LabelVisualizer.js';\nimport ModelVisualizer from './ModelVisualizer.js';\nimport Cesium3DTilesetVisualizer from './Cesium3DTilesetVisualizer.js';\nimport PathVisualizer from './PathVisualizer.js';\nimport PointVisualizer from './PointVisualizer.js';\nimport PolylineVisualizer from './PolylineVisualizer.js';\n\n    /**\n     * Visualizes a collection of {@link DataSource} instances.\n     * @alias DataSourceDisplay\n     * @constructor\n     *\n     * @param {Object} options Object with the following properties:\n     * @param {Scene} options.scene The scene in which to display the data.\n     * @param {DataSourceCollection} options.dataSourceCollection The data sources to display.\n     * @param {DataSourceDisplay~VisualizersCallback} [options.visualizersCallback=DataSourceDisplay.defaultVisualizersCallback]\n     *        A function which creates an array of visualizers used for visualization.\n     *        If undefined, all standard visualizers are used.\n     */\n    function DataSourceDisplay(options) {\n        \n\n        this._displayID = createGuid();\n\n        GroundPrimitive.initializeTerrainHeights();\n        GroundPolylinePrimitive.initializeTerrainHeights();\n\n        var scene = options.scene;\n        var dataSourceCollection = options.dataSourceCollection;\n\n        this._eventHelper = new EventHelper();\n        this._eventHelper.add(dataSourceCollection.dataSourceAdded, this._onDataSourceAdded, this);\n        this._eventHelper.add(dataSourceCollection.dataSourceRemoved, this._onDataSourceRemoved, this);\n        this._eventHelper.add(dataSourceCollection.dataSourceMoved, this._onDataSourceMoved, this);\n        this._eventHelper.add(scene.postRender, this._postRender, this);\n\n        this._dataSourceCollection = dataSourceCollection;\n        this._scene = scene;\n        this._visualizersCallback = defaultValue(options.visualizersCallback, DataSourceDisplay.defaultVisualizersCallback);\n\n        var primitivesAdded = false;\n        var primitives = new PrimitiveCollection();\n        var groundPrimitives = new PrimitiveCollection();\n\n        if (dataSourceCollection.length > 0) {\n            scene.primitives.add(primitives);\n            scene.groundPrimitives.add(groundPrimitives);\n            primitivesAdded = true;\n        }\n\n        this._primitives = primitives;\n        this._groundPrimitives = groundPrimitives;\n\n        for (var i = 0, len = dataSourceCollection.length; i < len; i++) {\n            this._onDataSourceAdded(dataSourceCollection, dataSourceCollection.get(i));\n        }\n\n        var defaultDataSource = new CustomDataSource();\n        this._onDataSourceAdded(undefined, defaultDataSource);\n        this._defaultDataSource = defaultDataSource;\n\n        var removeDefaultDataSourceListener;\n        var removeDataSourceCollectionListener;\n        if (!primitivesAdded) {\n            var that = this;\n            var addPrimitives = function() {\n                scene.primitives.add(primitives);\n                scene.groundPrimitives.add(groundPrimitives);\n                removeDefaultDataSourceListener();\n                removeDataSourceCollectionListener();\n                that._removeDefaultDataSourceListener = undefined;\n                that._removeDataSourceCollectionListener = undefined;\n            };\n            removeDefaultDataSourceListener = defaultDataSource.entities.collectionChanged.addEventListener(addPrimitives);\n            removeDataSourceCollectionListener = dataSourceCollection.dataSourceAdded.addEventListener(addPrimitives);\n        }\n\n        this._removeDefaultDataSourceListener = removeDefaultDataSourceListener;\n        this._removeDataSourceCollectionListener = removeDataSourceCollectionListener;\n\n        this._ready = false;\n    }\n\n    /**\n     * Gets or sets the default function which creates an array of visualizers used for visualization.\n     * By default, this function uses all standard visualizers.\n     *\n     * @type {DataSourceDisplay~VisualizersCallback}\n     */\n    DataSourceDisplay.defaultVisualizersCallback = function(scene, entityCluster, dataSource) {\n        var entities = dataSource.entities;\n        return [new BillboardVisualizer(entityCluster, entities),\n                new GeometryVisualizer(scene, entities, dataSource._primitives, dataSource._groundPrimitives),\n                new LabelVisualizer(entityCluster, entities),\n                new ModelVisualizer(scene, entities),\n                new Cesium3DTilesetVisualizer(scene, entities),\n                new PointVisualizer(entityCluster, entities),\n                new PathVisualizer(scene, entities),\n                new PolylineVisualizer(scene, entities, dataSource._primitives, dataSource._groundPrimitives)];\n    };\n\n    Object.defineProperties(DataSourceDisplay.prototype, {\n        /**\n         * Gets the scene associated with this display.\n         * @memberof DataSourceDisplay.prototype\n         * @type {Scene}\n         */\n        scene : {\n            get : function() {\n                return this._scene;\n            }\n        },\n        /**\n         * Gets the collection of data sources to display.\n         * @memberof DataSourceDisplay.prototype\n         * @type {DataSourceCollection}\n         */\n        dataSources : {\n            get : function() {\n                return this._dataSourceCollection;\n            }\n        },\n        /**\n         * Gets the default data source instance which can be used to\n         * manually create and visualize entities not tied to\n         * a specific data source. This instance is always available\n         * and does not appear in the list dataSources collection.\n         * @memberof DataSourceDisplay.prototype\n         * @type {CustomDataSource}\n         */\n        defaultDataSource : {\n            get : function() {\n                return this._defaultDataSource;\n            }\n        },\n\n        /**\n         * Gets a value indicating whether or not all entities in the data source are ready\n         * @memberof DataSourceDisplay.prototype\n         * @type {Boolean}\n         * @readonly\n         */\n        ready : {\n            get : function() {\n                return this._ready;\n            }\n        }\n    });\n\n    /**\n     * Returns true if this object was destroyed; otherwise, false.\n     * <br /><br />\n     * If this object was destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n     *\n     * @returns {Boolean} True if this object was destroyed; otherwise, false.\n     *\n     * @see DataSourceDisplay#destroy\n     */\n    DataSourceDisplay.prototype.isDestroyed = function() {\n        return false;\n    };\n\n    /**\n     * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n     * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n     * <br /><br />\n     * Once an object is destroyed, it should not be used; calling any function other than\n     * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n     * assign the return value (<code>undefined</code>) to the object as done in the example.\n     *\n     * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n     *\n     *\n     * @example\n     * dataSourceDisplay = dataSourceDisplay.destroy();\n     *\n     * @see DataSourceDisplay#isDestroyed\n     */\n    DataSourceDisplay.prototype.destroy = function() {\n        this._eventHelper.removeAll();\n\n        var dataSourceCollection = this._dataSourceCollection;\n        for (var i = 0, length = dataSourceCollection.length; i < length; ++i) {\n            this._onDataSourceRemoved(this._dataSourceCollection, dataSourceCollection.get(i));\n        }\n        this._onDataSourceRemoved(undefined, this._defaultDataSource);\n\n        if (defined(this._removeDefaultDataSourceListener)) {\n            this._removeDefaultDataSourceListener();\n            this._removeDataSourceCollectionListener();\n        } else {\n            this._scene.primitives.remove(this._primitives);\n            this._scene.groundPrimitives.remove(this._groundPrimitives);\n        }\n\n        return destroyObject(this);\n    };\n\n    /**\n     * Updates the display to the provided time.\n     *\n     * @param {JulianDate} time The simulation time.\n     * @returns {Boolean} True if all data sources are ready to be displayed, false otherwise.\n     */\n    DataSourceDisplay.prototype.update = function(time) {\n        \n\n        if (!ApproximateTerrainHeights.initialized) {\n            this._ready = false;\n            return false;\n        }\n\n        var result = true;\n\n        var i;\n        var x;\n        var visualizers;\n        var vLength;\n        var dataSources = this._dataSourceCollection;\n        var length = dataSources.length;\n        for (i = 0; i < length; i++) {\n            var dataSource = dataSources.get(i);\n            if (defined(dataSource.update)) {\n                result = dataSource.update(time) && result;\n            }\n\n            visualizers = dataSource._visualizersByDisplayID[this._displayID];\n            vLength = visualizers.length;\n            for (x = 0; x < vLength; x++) {\n                result = visualizers[x].update(time) && result;\n            }\n        }\n\n        visualizers = this._defaultDataSource._visualizersByDisplayID[this._displayID];\n        vLength = visualizers.length;\n        for (x = 0; x < vLength; x++) {\n            result = visualizers[x].update(time) && result;\n        }\n\n        this._ready = result;\n\n        return result;\n    };\n\n    DataSourceDisplay.prototype._postRender = function() {\n        // Adds credits for all datasources\n        var frameState = this._scene.frameState;\n        var dataSources = this._dataSourceCollection;\n        var length = dataSources.length;\n        for (var i = 0; i < length; i++) {\n            var dataSource = dataSources.get(i);\n\n            var credit = dataSource.credit;\n            if (defined(credit)) {\n                frameState.creditDisplay.addCredit(credit);\n            }\n\n            // Credits from the resource that the user can't remove\n            var credits = dataSource._resourceCredits;\n            if (defined(credits)) {\n                var creditCount = credits.length;\n                for (var c = 0; c < creditCount; c++) {\n                    frameState.creditDisplay.addCredit(credits[c]);\n                }\n            }\n        }\n    };\n\n    var getBoundingSphereArrayScratch = [];\n    var getBoundingSphereBoundingSphereScratch = new BoundingSphere();\n\n    /**\n     * Computes a bounding sphere which encloses the visualization produced for the specified entity.\n     * The bounding sphere is in the fixed frame of the scene's globe.\n     *\n     * @param {Entity} entity The entity whose bounding sphere to compute.\n     * @param {Boolean} allowPartial If true, pending bounding spheres are ignored and an answer will be returned from the currently available data.\n     *                               If false, the the function will halt and return pending if any of the bounding spheres are pending.\n     * @param {BoundingSphere} result The bounding sphere onto which to store the result.\n     * @returns {BoundingSphereState} BoundingSphereState.DONE if the result contains the bounding sphere,\n     *                       BoundingSphereState.PENDING if the result is still being computed, or\n     *                       BoundingSphereState.FAILED if the entity has no visualization in the current scene.\n     * @private\n     */\n    DataSourceDisplay.prototype.getBoundingSphere = function(entity, allowPartial, result) {\n        \n\n        if (!this._ready) {\n            return BoundingSphereState.PENDING;\n        }\n\n        var i;\n        var length;\n        var dataSource = this._defaultDataSource;\n        if (!dataSource.entities.contains(entity)) {\n            dataSource = undefined;\n\n            var dataSources = this._dataSourceCollection;\n            length = dataSources.length;\n            for (i = 0; i < length; i++) {\n                var d = dataSources.get(i);\n                if (d.entities.contains(entity)) {\n                    dataSource = d;\n                    break;\n                }\n            }\n        }\n\n        if (!defined(dataSource)) {\n            return BoundingSphereState.FAILED;\n        }\n\n        var boundingSpheres = getBoundingSphereArrayScratch;\n        var tmp = getBoundingSphereBoundingSphereScratch;\n\n        var count = 0;\n        var state = BoundingSphereState.DONE;\n        var visualizers = dataSource._visualizers;\n        var visualizersLength = visualizers.length;\n\n        for (i = 0; i < visualizersLength; i++) {\n            var visualizer = visualizers[i];\n            if (defined(visualizer.getBoundingSphere)) {\n                state = visualizers[i].getBoundingSphere(entity, tmp);\n                if (!allowPartial && state === BoundingSphereState.PENDING) {\n                    return BoundingSphereState.PENDING;\n                } else if (state === BoundingSphereState.DONE) {\n                    boundingSpheres[count] = BoundingSphere.clone(tmp, boundingSpheres[count]);\n                    count++;\n                }\n            }\n        }\n\n        if (count === 0) {\n            return BoundingSphereState.FAILED;\n        }\n\n        boundingSpheres.length = count;\n        BoundingSphere.fromBoundingSpheres(boundingSpheres, result);\n        return BoundingSphereState.DONE;\n    };\n\n    DataSourceDisplay.prototype._onDataSourceAdded = function(dataSourceCollection, dataSource) {\n        var scene = this._scene;\n\n        var displayPrimitives = this._primitives;\n        var displayGroundPrimitives = this._groundPrimitives;\n\n        var primitives = displayPrimitives.add(new PrimitiveCollection());\n        var groundPrimitives = displayGroundPrimitives.add(new OrderedGroundPrimitiveCollection());\n\n        dataSource._primitives = primitives;\n        dataSource._groundPrimitives = groundPrimitives;\n\n        var entityCluster = dataSource.clustering;\n        entityCluster._initialize(scene);\n\n        primitives.add(entityCluster);\n\n        var visualizers = this._visualizersCallback(scene, entityCluster, dataSource);\n\n        dataSource._visualizersByDisplayID = dataSource._visualizersByDisplayID || {};\n        dataSource._visualizersByDisplayID[this._displayID] = visualizers;\n\n        dataSource._visualizers = dataSource._visualizers || [];\n        dataSource._visualizers = dataSource._visualizers.concat(visualizers);\n    };\n\n    DataSourceDisplay.prototype._onDataSourceRemoved = function(dataSourceCollection, dataSource) {\n        var displayPrimitives = this._primitives;\n        var displayGroundPrimitives = this._groundPrimitives;\n\n        var primitives = dataSource._primitives;\n        var groundPrimitives = dataSource._groundPrimitives;\n\n        var entityCluster = dataSource.clustering;\n        primitives.remove(entityCluster);\n\n        var visualizers = dataSource._visualizersByDisplayID[this._displayID];\n        if (!defined(visualizers)) {\n            return;\n        }\n\n        var length = visualizers.length;\n        for (var i = 0; i < length; i++) {\n            var visualizer = visualizers[i];\n            visualizer.destroy();\n\n            var index = dataSource._visualizers.indexOf(visualizer);\n            dataSource._visualizers.splice(index, 1);\n        }\n\n        delete dataSource._visualizersByDisplayID[this._displayID];\n\n        displayPrimitives.remove(primitives);\n        displayGroundPrimitives.remove(groundPrimitives);\n    };\n\n    DataSourceDisplay.prototype._onDataSourceMoved = function(dataSource, newIndex, oldIndex) {\n        var displayPrimitives = this._primitives;\n        var displayGroundPrimitives = this._groundPrimitives;\n\n        var primitives = dataSource._primitives;\n        var groundPrimitives = dataSource._groundPrimitives;\n\n        if (newIndex === oldIndex + 1) {\n            displayPrimitives.raise(primitives);\n            displayGroundPrimitives.raise(groundPrimitives);\n        } else if (newIndex === oldIndex - 1) {\n            displayPrimitives.lower(primitives);\n            displayGroundPrimitives.lower(groundPrimitives);\n        } else if (newIndex === 0) {\n            displayPrimitives.lowerToBottom(primitives);\n            displayGroundPrimitives.lowerToBottom(groundPrimitives);\n            displayPrimitives.raise(primitives); // keep defaultDataSource primitives at index 0 since it's not in the collection\n            displayGroundPrimitives.raise(groundPrimitives);\n        } else {\n            displayPrimitives.raiseToTop(primitives);\n            displayGroundPrimitives.raiseToTop(groundPrimitives);\n        }\n    };\n\n    /**\n     * A function which creates an array of visualizers used for visualization.\n     * @callback DataSourceDisplay~VisualizersCallback\n     *\n     * @param {Scene} scene The scene to create visualizers for.\n     * @param {DataSource} dataSource The data source to create visualizers for.\n     * @returns {Visualizer[]} An array of visualizers used for visualization.\n     *\n     * @example\n     * function createVisualizers(scene, dataSource) {\n     *     return [new Cesium.BillboardVisualizer(scene, dataSource.entities)];\n     * }\n     */\nexport default DataSourceDisplay;\n","import ComponentDatatype from './ComponentDatatype.js';\nimport defaultValue from './defaultValue.js';\nimport defined from './defined.js';\nimport DeveloperError from './DeveloperError.js';\n\n    /**\n     * Value and type information for per-instance geometry attribute that determines if the geometry instance will be shown.\n     *\n     * @alias ShowGeometryInstanceAttribute\n     * @constructor\n     *\n     * @param {Boolean} [show=true] Determines if the geometry instance will be shown.\n     *\n     *\n     * @example\n     * var instance = new Cesium.GeometryInstance({\n     *   geometry : new Cesium.BoxGeometry({\n     *     vertexFormat : Cesium.VertexFormat.POSITION_AND_NORMAL,\n     *     minimum : new Cesium.Cartesian3(-250000.0, -250000.0, -250000.0),\n     *     maximum : new Cesium.Cartesian3(250000.0, 250000.0, 250000.0)\n     *   }),\n     *   modelMatrix : Cesium.Matrix4.multiplyByTranslation(Cesium.Transforms.eastNorthUpToFixedFrame(\n     *     Cesium.Cartesian3.fromDegrees(-75.59777, 40.03883)), new Cesium.Cartesian3(0.0, 0.0, 1000000.0), new Cesium.Matrix4()),\n     *   id : 'box',\n     *   attributes : {\n     *     show : new Cesium.ShowGeometryInstanceAttribute(false)\n     *   }\n     * });\n     *\n     * @see GeometryInstance\n     * @see GeometryInstanceAttribute\n     */\n    function ShowGeometryInstanceAttribute(show) {\n        show = defaultValue(show, true);\n\n        /**\n         * The values for the attributes stored in a typed array.\n         *\n         * @type Uint8Array\n         *\n         * @default [1.0]\n         */\n        this.value = ShowGeometryInstanceAttribute.toValue(show);\n    }\n\n    Object.defineProperties(ShowGeometryInstanceAttribute.prototype, {\n        /**\n         * The datatype of each component in the attribute, e.g., individual elements in\n         * {@link ColorGeometryInstanceAttribute#value}.\n         *\n         * @memberof ShowGeometryInstanceAttribute.prototype\n         *\n         * @type {ComponentDatatype}\n         * @readonly\n         *\n         * @default {@link ComponentDatatype.UNSIGNED_BYTE}\n         */\n        componentDatatype : {\n            get : function() {\n                return ComponentDatatype.UNSIGNED_BYTE;\n            }\n        },\n\n        /**\n         * The number of components in the attributes, i.e., {@link ColorGeometryInstanceAttribute#value}.\n         *\n         * @memberof ShowGeometryInstanceAttribute.prototype\n         *\n         * @type {Number}\n         * @readonly\n         *\n         * @default 1\n         */\n        componentsPerAttribute : {\n            get : function() {\n                return 1;\n            }\n        },\n\n        /**\n         * When <code>true</code> and <code>componentDatatype</code> is an integer format,\n         * indicate that the components should be mapped to the range [0, 1] (unsigned)\n         * or [-1, 1] (signed) when they are accessed as floating-point for rendering.\n         *\n         * @memberof ShowGeometryInstanceAttribute.prototype\n         *\n         * @type {Boolean}\n         * @readonly\n         *\n         * @default true\n         */\n        normalize : {\n            get : function() {\n                return false;\n            }\n        }\n    });\n\n    /**\n     * Converts a boolean show to a typed array that can be used to assign a show attribute.\n     *\n     * @param {Boolean} show The show value.\n     * @param {Uint8Array} [result] The array to store the result in, if undefined a new instance will be created.\n     * @returns {Uint8Array} The modified result parameter or a new instance if result was undefined.\n     *\n     * @example\n     * var attributes = primitive.getGeometryInstanceAttributes('an id');\n     * attributes.show = Cesium.ShowGeometryInstanceAttribute.toValue(true, attributes.show);\n     */\n    ShowGeometryInstanceAttribute.toValue = function(show, result) {\n        \n\n        if (!defined(result)) {\n            return new Uint8Array([show]);\n        }\n        result[0] = show;\n        return result;\n    };\nexport default ShowGeometryInstanceAttribute;\n"],"sourceRoot":""}
((self||window).webpackJsonp=(self||window).webpackJsonp||[]).push([[4],{1663:function(e,t,i){e.exports=i.p+"4fff67aa927fc4ecb16298f61b0cf84a.jpg"},1664:function(e,t,i){e.exports=i.p+"b592e228bf0641d6b4f0b79e664177ab.jpg"},1665:function(e,t,i){e.exports=i.p+"c6ab0a71c7048eb83585b34bd32f4ee0.jpg"},1666:function(e,t,i){e.exports=i.p+"27faaa4b21b2a66ac3496b20640e571f.jpg"},1668:function(e,t,i){e.exports=i.p+"0a8e3af0b451f232d7b8e5b1ec17575f.jpg"},1669:function(e,t,i){e.exports=i.p+"f0bbd92eb78a7cfc1106f0a0a3e4cba7.jpg"},1670:function(e,t,i){e.exports=i.p+"ce3752c9dd3b7c390190fb5f104bddd4.jpg"},1671:function(e,t,i){e.exports=i.p+"403aa235dad8bb7ee2a07556f9438677.jpg"},1672:function(e,t,i){e.exports=i.p+"65d2c74e5f08b7aeef95d017e5cb07a6.jpg"},1673:function(e,t,i){e.exports=i.p+"0442d80880107432ae51dd8c6803a249.jpg"},1674:function(e,t,i){"use strict";var a,r=(a=i(20))&&a.__esModule?a:{default:a};var n=i(24).default,o=i(8).default,s=i(10).default,l=i(202).default,u=i(22).default,d=i(183).default,f=i(623),c=new n,h=function(e){if(!o(e))throw new s(r.default.t("map.cesium.devError"));this._cesium=e,this._screenPositionX="-1000px",this._screenPositionY="-1000px",this._tweens=e.scene.tweens,this._container=e.viewer.container,this.position=void 0,this.showSelection=!0,this.transform="",this.opacity=1,u.track(this,["position","_screenPositionX","_screenPositionY","_scale","rotate","showSelection","transform","opacity"]),this.isVisible=void 0,u.defineProperty(this,"isVisible",{get:function(){return this.showSelection&&o(this.position)}}),this.computeScreenSpacePosition=function(t,i){return d.wgs84ToWindowCoordinates(e.scene,t,i)};var t=document.createElement("div");t.className="selection-indicator",this._container.appendChild(t),this._selectionIndicatorElement=t;var i=document.createElement("img");i.setAttribute("src",f),i.setAttribute("alt",""),i.setAttribute("width",50),i.setAttribute("height",50),t.appendChild(i);var a=this;function n(){t.style.top=a._screenPositionY,t.style.left=a._screenPositionX,t.style.transform=a.transform,t.style.opacity=a.opacity}n(),this._subscriptions=[],this._subscriptions.push(u.getObservable(this,"_screenPositionX").subscribe(n)),this._subscriptions.push(u.getObservable(this,"_screenPositionY").subscribe(n)),this._subscriptions.push(u.getObservable(this,"transform").subscribe(n)),this._subscriptions.push(u.getObservable(this,"opacity").subscribe(n))};h.prototype.destroy=function(){this._selectionIndicatorElement.parentNode.removeChild(this._selectionIndicatorElement),this._subscriptions.forEach((function(e){e.dispose()}))},h.prototype.update=function(){if(this.showSelection&&o(this.position)){var e=this.computeScreenSpacePosition(this.position,c);if(o(e)){var t=this._container,i=t.clientWidth,a=t.clientHeight,r=this._selectionIndicatorElement.clientWidth,n=.5*r;e.x=Math.min(Math.max(e.x,-r),i+r)-n,e.y=Math.min(Math.max(e.y,-r),a+r)-n,this._screenPositionX=Math.floor(e.x+.25)+"px",this._screenPositionY=Math.floor(e.y+.25)+"px"}else this._screenPositionX="-1000px",this._screenPositionY="-1000px"}},h.prototype.animateAppear=function(){if(o(this._selectionIndicatorTween)){if(this._selectionIndicatorIsAppearing)return;this._selectionIndicatorTween.cancelTween(),this._selectionIndicatorTween=void 0}this._selectionIndicatorIsAppearing=!0;var e=this;this._selectionIndicatorTween=this._tweens.add({startObject:{scale:2,opacity:0,rotate:-180},stopObject:{scale:1,opacity:1,rotate:0},duration:.8,easingFunction:l.EXPONENTIAL_OUT,update:function(t){e.opacity=t.opacity,e.transform="scale("+t.scale+") rotate("+t.rotate+"deg)"},complete:function(){e._selectionIndicatorTween=void 0},cancel:function(){e._selectionIndicatorTween=void 0}})},h.prototype.animateDepart=function(){if(o(this._selectionIndicatorTween)){if(!this._selectionIndicatorIsAppearing)return;this._selectionIndicatorTween.cancelTween(),this._selectionIndicatorTween=void 0}this._selectionIndicatorIsAppearing=!1;var e=this;this._selectionIndicatorTween=this._tweens.add({startObject:{scale:1,opacity:1},stopObject:{scale:1.5,opacity:0},duration:.8,easingFunction:l.EXPONENTIAL_OUT,update:function(t){e.opacity=t.opacity,e.transform="scale("+t.scale+") rotate(0deg)"},complete:function(){e._selectionIndicatorTween=void 0},cancel:function(){e._selectionIndicatorTween=void 0}})},Object.defineProperties(h.prototype,{container:{get:function(){return this._container}},selectionIndicatorElement:{get:function(){return this._selectionIndicatorElement}},scene:{get:function(){return this._scene}}}),e.exports=h},196:function(e,t,i){"use strict";t.a=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2})},286:function(e,t,i){"use strict";var a=i(8),r=(i(10),i(23)),n=i(140),o=i(130),s=i(38);function l(){this._eventHelper=new n.default,this._definitionChanged=new r.default,this._intervals=new o.default,this._intervals.changedEvent.addEventListener(l.prototype._intervalsChanged,this)}Object.defineProperties(l.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}}}),l.prototype.getValue=function(e,t){var i=this._intervals.findDataForIntervalContainingDate(e);if(Object(a.default)(i))return i.getValue(e,t)},l.prototype.equals=function(e){return this===e||e instanceof l&&this._intervals.equals(e._intervals,s.default.equals)},l.prototype._intervalsChanged=function(){!function(e,t,i,r){function n(){i.raiseEvent(e)}var o=[];t.removeAll();for(var s=r.length,l=0;l<s;l++){var u=r.get(l);Object(a.default)(u.data)&&-1===o.indexOf(u.data)&&t.add(u.data.definitionChanged,n)}}(this,this._eventHelper,this._definitionChanged,this._intervals),this._definitionChanged.raiseEvent(this)},t.a=l},367:function(e,t,i){"use strict";var a=i(9),r=i(8),n=(i(10),i(23)),o=i(137),s=i(286),l=i(38);function u(e){this._referenceFrame=Object(a.default)(e,o.a.FIXED),this._definitionChanged=new n.default,this._composite=new s.a,this._composite.definitionChanged.addEventListener(u.prototype._raiseDefinitionChanged,this)}Object.defineProperties(u.prototype,{isConstant:{get:function(){return this._composite.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._composite.intervals}},referenceFrame:{get:function(){return this._referenceFrame},set:function(e){this._referenceFrame=e}}}),u.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,o.a.FIXED,t)},u.prototype.getValueInReferenceFrame=function(e,t,i){var a=this._composite._intervals.findDataForIntervalContainingDate(e);if(Object(r.default)(a))return a.getValueInReferenceFrame(e,t,i)},u.prototype.equals=function(e){return this===e||e instanceof u&&this._referenceFrame===e._referenceFrame&&this._composite.equals(e._composite,l.default.equals)},u.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)},t.a=u},368:function(e,t,i){"use strict";var a=i(8),r=(i(10),i(23)),n=i(38);function o(e){var t=e._targetProperty;if(!Object(a.default)(t)){var i=e._targetEntity;if(!Object(a.default)(i)){if(i=e._targetCollection.getById(e._targetId),!Object(a.default)(i))return void(e._targetEntity=e._targetProperty=void 0);i.definitionChanged.addEventListener(s.prototype._onTargetEntityDefinitionChanged,e),e._targetEntity=i}var r=e._targetPropertyNames;t=e._targetEntity;for(var n=0,o=r.length;n<o&&Object(a.default)(t);++n)t=t[r[n]];e._targetProperty=t}return t}function s(e,t,i){this._targetCollection=e,this._targetId=t,this._targetPropertyNames=i,this._targetProperty=void 0,this._targetEntity=void 0,this._definitionChanged=new r.default,e.collectionChanged.addEventListener(s.prototype._onCollectionChanged,this)}Object.defineProperties(s.prototype,{isConstant:{get:function(){return n.default.isConstant(o(this))}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){var e=o(this);return Object(a.default)(e)?e.referenceFrame:void 0}},targetId:{get:function(){return this._targetId}},targetCollection:{get:function(){return this._targetCollection}},targetPropertyNames:{get:function(){return this._targetPropertyNames}},resolvedProperty:{get:function(){return o(this)}}}),s.fromString=function(e,t){for(var i,a=[],r=!0,n=!1,o="",l=0;l<t.length;++l){var u=t.charAt(l);n?(o+=u,n=!1):"\\"===u?n=!0:r&&"#"===u?(i=o,r=!1,o=""):r||"."!==u?o+=u:(a.push(o),o="")}return a.push(o),new s(e,i,a)},s.prototype.getValue=function(e,t){var i=o(this);return Object(a.default)(i)?i.getValue(e,t):void 0},s.prototype.getValueInReferenceFrame=function(e,t,i){var r=o(this);return Object(a.default)(r)?r.getValueInReferenceFrame(e,t,i):void 0},s.prototype.getType=function(e){var t=o(this);return Object(a.default)(t)?t.getType(e):void 0},s.prototype.equals=function(e){if(this===e)return!0;var t=this._targetPropertyNames,i=e._targetPropertyNames;if(this._targetCollection!==e._targetCollection||this._targetId!==e._targetId||t.length!==i.length)return!1;for(var a=this._targetPropertyNames.length,r=0;r<a;r++)if(t[r]!==i[r])return!1;return!0},s.prototype._onTargetEntityDefinitionChanged=function(e,t,i,r){Object(a.default)(this._targetProperty)&&this._targetPropertyNames[0]===t&&(this._targetProperty=void 0,this._definitionChanged.raiseEvent(this))},s.prototype._onCollectionChanged=function(e,t,i){var r=this._targetEntity;Object(a.default)(r)&&-1!==i.indexOf(r)?(r.definitionChanged.removeEventListener(s.prototype._onTargetEntityDefinitionChanged,this),this._targetEntity=this._targetProperty=void 0):Object(a.default)(r)||(r=o(this),Object(a.default)(r)&&this._definitionChanged.raiseEvent(this))},t.a=s},369:function(e,t,i){"use strict";var a=i(93),r=i(33),n=i(12),o=(i(15),i(34)),s=i(9),l=i(8),u=(i(10),i(51)),d=i(52),f=i(64),c=i(85),h=i(45),m=i(78),p=new n.default;function _(e){var t=(e=Object(s.default)(e,s.default.EMPTY_OBJECT)).minimum,i=e.maximum,a=Object(s.default)(e.vertexFormat,m.default.DEFAULT);this._minimum=n.default.clone(t),this._maximum=n.default.clone(i),this._vertexFormat=a,this._offsetAttribute=e.offsetAttribute,this._workerName="createBoxGeometry"}_.fromDimensions=function(e){var t=(e=Object(s.default)(e,s.default.EMPTY_OBJECT)).dimensions,i=n.default.multiplyByScalar(t,.5,new n.default);return new _({minimum:n.default.negate(i,new n.default),maximum:i,vertexFormat:e.vertexFormat,offsetAttribute:e.offsetAttribute})},_.fromAxisAlignedBoundingBox=function(e){return new _({minimum:e.minimum,maximum:e.maximum})},_.packedLength=2*n.default.packedLength+m.default.packedLength+1,_.pack=function(e,t,i){return i=Object(s.default)(i,0),n.default.pack(e._minimum,t,i),n.default.pack(e._maximum,t,i+n.default.packedLength),m.default.pack(e._vertexFormat,t,i+2*n.default.packedLength),t[i+2*n.default.packedLength+m.default.packedLength]=Object(s.default)(e._offsetAttribute,-1),t};var g,v=new n.default,y=new n.default,b=new m.default,w={minimum:v,maximum:y,vertexFormat:b,offsetAttribute:void 0};_.unpack=function(e,t,i){t=Object(s.default)(t,0);var a=n.default.unpack(e,t,v),r=n.default.unpack(e,t+n.default.packedLength,y),o=m.default.unpack(e,t+2*n.default.packedLength,b),u=e[t+2*n.default.packedLength+m.default.packedLength];return Object(l.default)(i)?(i._minimum=n.default.clone(a,i._minimum),i._maximum=n.default.clone(r,i._maximum),i._vertexFormat=m.default.clone(o,i._vertexFormat),i._offsetAttribute=-1===u?void 0:u,i):(w.offsetAttribute=-1===u?void 0:u,new _(w))},_.createGeometry=function(e){var t=e._minimum,i=e._maximum,s=e._vertexFormat;if(!n.default.equals(t,i)){var m,_,g=new f.a;if(s.position&&(s.st||s.normal||s.tangent||s.bitangent)){if(s.position&&((_=new Float64Array(72))[0]=t.x,_[1]=t.y,_[2]=i.z,_[3]=i.x,_[4]=t.y,_[5]=i.z,_[6]=i.x,_[7]=i.y,_[8]=i.z,_[9]=t.x,_[10]=i.y,_[11]=i.z,_[12]=t.x,_[13]=t.y,_[14]=t.z,_[15]=i.x,_[16]=t.y,_[17]=t.z,_[18]=i.x,_[19]=i.y,_[20]=t.z,_[21]=t.x,_[22]=i.y,_[23]=t.z,_[24]=i.x,_[25]=t.y,_[26]=t.z,_[27]=i.x,_[28]=i.y,_[29]=t.z,_[30]=i.x,_[31]=i.y,_[32]=i.z,_[33]=i.x,_[34]=t.y,_[35]=i.z,_[36]=t.x,_[37]=t.y,_[38]=t.z,_[39]=t.x,_[40]=i.y,_[41]=t.z,_[42]=t.x,_[43]=i.y,_[44]=i.z,_[45]=t.x,_[46]=t.y,_[47]=i.z,_[48]=t.x,_[49]=i.y,_[50]=t.z,_[51]=i.x,_[52]=i.y,_[53]=t.z,_[54]=i.x,_[55]=i.y,_[56]=i.z,_[57]=t.x,_[58]=i.y,_[59]=i.z,_[60]=t.x,_[61]=t.y,_[62]=t.z,_[63]=i.x,_[64]=t.y,_[65]=t.z,_[66]=i.x,_[67]=t.y,_[68]=i.z,_[69]=t.x,_[70]=t.y,_[71]=i.z,g.position=new d.a({componentDatatype:o.a.DOUBLE,componentsPerAttribute:3,values:_})),s.normal){var v=new Float32Array(72);v[0]=0,v[1]=0,v[2]=1,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=1,v[9]=0,v[10]=0,v[11]=1,v[12]=0,v[13]=0,v[14]=-1,v[15]=0,v[16]=0,v[17]=-1,v[18]=0,v[19]=0,v[20]=-1,v[21]=0,v[22]=0,v[23]=-1,v[24]=1,v[25]=0,v[26]=0,v[27]=1,v[28]=0,v[29]=0,v[30]=1,v[31]=0,v[32]=0,v[33]=1,v[34]=0,v[35]=0,v[36]=-1,v[37]=0,v[38]=0,v[39]=-1,v[40]=0,v[41]=0,v[42]=-1,v[43]=0,v[44]=0,v[45]=-1,v[46]=0,v[47]=0,v[48]=0,v[49]=1,v[50]=0,v[51]=0,v[52]=1,v[53]=0,v[54]=0,v[55]=1,v[56]=0,v[57]=0,v[58]=1,v[59]=0,v[60]=0,v[61]=-1,v[62]=0,v[63]=0,v[64]=-1,v[65]=0,v[66]=0,v[67]=-1,v[68]=0,v[69]=0,v[70]=-1,v[71]=0,g.normal=new d.a({componentDatatype:o.a.FLOAT,componentsPerAttribute:3,values:v})}if(s.st){var y=new Float32Array(48);y[0]=0,y[1]=0,y[2]=1,y[3]=0,y[4]=1,y[5]=1,y[6]=0,y[7]=1,y[8]=1,y[9]=0,y[10]=0,y[11]=0,y[12]=0,y[13]=1,y[14]=1,y[15]=1,y[16]=0,y[17]=0,y[18]=1,y[19]=0,y[20]=1,y[21]=1,y[22]=0,y[23]=1,y[24]=1,y[25]=0,y[26]=0,y[27]=0,y[28]=0,y[29]=1,y[30]=1,y[31]=1,y[32]=1,y[33]=0,y[34]=0,y[35]=0,y[36]=0,y[37]=1,y[38]=1,y[39]=1,y[40]=0,y[41]=0,y[42]=1,y[43]=0,y[44]=1,y[45]=1,y[46]=0,y[47]=1,g.st=new d.a({componentDatatype:o.a.FLOAT,componentsPerAttribute:2,values:y})}if(s.tangent){var b=new Float32Array(72);b[0]=1,b[1]=0,b[2]=0,b[3]=1,b[4]=0,b[5]=0,b[6]=1,b[7]=0,b[8]=0,b[9]=1,b[10]=0,b[11]=0,b[12]=-1,b[13]=0,b[14]=0,b[15]=-1,b[16]=0,b[17]=0,b[18]=-1,b[19]=0,b[20]=0,b[21]=-1,b[22]=0,b[23]=0,b[24]=0,b[25]=1,b[26]=0,b[27]=0,b[28]=1,b[29]=0,b[30]=0,b[31]=1,b[32]=0,b[33]=0,b[34]=1,b[35]=0,b[36]=0,b[37]=-1,b[38]=0,b[39]=0,b[40]=-1,b[41]=0,b[42]=0,b[43]=-1,b[44]=0,b[45]=0,b[46]=-1,b[47]=0,b[48]=-1,b[49]=0,b[50]=0,b[51]=-1,b[52]=0,b[53]=0,b[54]=-1,b[55]=0,b[56]=0,b[57]=-1,b[58]=0,b[59]=0,b[60]=1,b[61]=0,b[62]=0,b[63]=1,b[64]=0,b[65]=0,b[66]=1,b[67]=0,b[68]=0,b[69]=1,b[70]=0,b[71]=0,g.tangent=new d.a({componentDatatype:o.a.FLOAT,componentsPerAttribute:3,values:b})}if(s.bitangent){var w=new Float32Array(72);w[0]=0,w[1]=1,w[2]=0,w[3]=0,w[4]=1,w[5]=0,w[6]=0,w[7]=1,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=1,w[14]=0,w[15]=0,w[16]=1,w[17]=0,w[18]=0,w[19]=1,w[20]=0,w[21]=0,w[22]=1,w[23]=0,w[24]=0,w[25]=0,w[26]=1,w[27]=0,w[28]=0,w[29]=1,w[30]=0,w[31]=0,w[32]=1,w[33]=0,w[34]=0,w[35]=1,w[36]=0,w[37]=0,w[38]=1,w[39]=0,w[40]=0,w[41]=1,w[42]=0,w[43]=0,w[44]=1,w[45]=0,w[46]=0,w[47]=1,w[48]=0,w[49]=0,w[50]=1,w[51]=0,w[52]=0,w[53]=1,w[54]=0,w[55]=0,w[56]=1,w[57]=0,w[58]=0,w[59]=1,w[60]=0,w[61]=0,w[62]=1,w[63]=0,w[64]=0,w[65]=1,w[66]=0,w[67]=0,w[68]=1,w[69]=0,w[70]=0,w[71]=1,g.bitangent=new d.a({componentDatatype:o.a.FLOAT,componentsPerAttribute:3,values:w})}(m=new Uint16Array(36))[0]=0,m[1]=1,m[2]=2,m[3]=0,m[4]=2,m[5]=3,m[6]=6,m[7]=5,m[8]=4,m[9]=7,m[10]=6,m[11]=4,m[12]=8,m[13]=9,m[14]=10,m[15]=8,m[16]=10,m[17]=11,m[18]=14,m[19]=13,m[20]=12,m[21]=15,m[22]=14,m[23]=12,m[24]=18,m[25]=17,m[26]=16,m[27]=19,m[28]=18,m[29]=16,m[30]=20,m[31]=21,m[32]=22,m[33]=20,m[34]=22,m[35]=23}else(_=new Float64Array(24))[0]=t.x,_[1]=t.y,_[2]=t.z,_[3]=i.x,_[4]=t.y,_[5]=t.z,_[6]=i.x,_[7]=i.y,_[8]=t.z,_[9]=t.x,_[10]=i.y,_[11]=t.z,_[12]=t.x,_[13]=t.y,_[14]=i.z,_[15]=i.x,_[16]=t.y,_[17]=i.z,_[18]=i.x,_[19]=i.y,_[20]=i.z,_[21]=t.x,_[22]=i.y,_[23]=i.z,g.position=new d.a({componentDatatype:o.a.DOUBLE,componentsPerAttribute:3,values:_}),(m=new Uint16Array(36))[0]=4,m[1]=5,m[2]=6,m[3]=4,m[4]=6,m[5]=7,m[6]=1,m[7]=0,m[8]=3,m[9]=1,m[10]=3,m[11]=2,m[12]=1,m[13]=6,m[14]=5,m[15]=1,m[16]=2,m[17]=6,m[18]=2,m[19]=3,m[20]=7,m[21]=2,m[22]=7,m[23]=6,m[24]=3,m[25]=0,m[26]=4,m[27]=3,m[28]=4,m[29]=7,m[30]=0,m[31]=1,m[32]=5,m[33]=0,m[34]=5,m[35]=4;var x=n.default.subtract(i,t,p),O=.5*n.default.magnitude(x);if(Object(l.default)(e._offsetAttribute)){var C=_.length,T=new Uint8Array(C/3),E=e._offsetAttribute===c.a.NONE?0:1;Object(a.a)(T,E),g.applyOffset=new d.a({componentDatatype:o.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:T})}return new u.a({attributes:g,indices:m,primitiveType:h.a.TRIANGLES,boundingSphere:new r.default(n.default.ZERO,O),offsetAttribute:e._offsetAttribute})}},_.getUnitBox=function(){return Object(l.default)(g)||(g=_.createGeometry(_.fromDimensions({dimensions:new n.default(1,1,1),vertexFormat:m.default.POSITION_ONLY}))),g},t.a=_},370:function(e,t,i){"use strict";var a=i(74),r=i(9),n=i(8),o=i(18);i(10);function s(e){e=Object(r.default)(e,r.default.EMPTY_OBJECT),this._primitives=[],this._guid=Object(a.default)(),this._zIndex=void 0,this.show=Object(r.default)(e.show,!0),this.destroyPrimitives=Object(r.default)(e.destroyPrimitives,!0)}function l(e,t){return e._primitives.indexOf(t)}Object.defineProperties(s.prototype,{length:{get:function(){return this._primitives.length}}}),s.prototype.add=function(e,t){var i=Object(n.default)(t),a=e._external=e._external||{};return(a._composites=a._composites||{})[this._guid]={collection:this},i?this._primitives.splice(t,0,e):this._primitives.push(e),e},s.prototype.remove=function(e){if(this.contains(e)){var t=this._primitives.indexOf(e);if(-1!==t)return this._primitives.splice(t,1),delete e._external._composites[this._guid],this.destroyPrimitives&&e.destroy(),!0}return!1},s.prototype.removeAndDestroy=function(e){var t=this.remove(e);return t&&!this.destroyPrimitives&&e.destroy(),t},s.prototype.removeAll=function(){for(var e=this._primitives,t=e.length,i=0;i<t;++i)delete e[i]._external._composites[this._guid],this.destroyPrimitives&&e[i].destroy();this._primitives=[]},s.prototype.contains=function(e){return!!(Object(n.default)(e)&&e._external&&e._external._composites&&e._external._composites[this._guid])},s.prototype.raise=function(e){if(Object(n.default)(e)){var t=l(this,e),i=this._primitives;if(t!==i.length-1){var a=i[t];i[t]=i[t+1],i[t+1]=a}}},s.prototype.raiseToTop=function(e){if(Object(n.default)(e)){var t=l(this,e),i=this._primitives;t!==i.length-1&&(i.splice(t,1),i.push(e))}},s.prototype.lower=function(e){if(Object(n.default)(e)){var t=l(this,e),i=this._primitives;if(0!==t){var a=i[t];i[t]=i[t-1],i[t-1]=a}}},s.prototype.lowerToBottom=function(e){if(Object(n.default)(e)){var t=l(this,e),i=this._primitives;0!==t&&(i.splice(t,1),i.unshift(e))}},s.prototype.get=function(e){return this._primitives[e]},s.prototype.update=function(e){if(this.show)for(var t=this._primitives,i=0;i<t.length;++i)t[i].update(e)},s.prototype.prePassesUpdate=function(e){for(var t=this._primitives,i=0;i<t.length;++i){var a=t[i];Object(n.default)(a.prePassesUpdate)&&a.prePassesUpdate(e)}},s.prototype.updateForPass=function(e,t){for(var i=this._primitives,a=0;a<i.length;++a){var r=i[a];Object(n.default)(r.updateForPass)&&r.updateForPass(e,t)}},s.prototype.postPassesUpdate=function(e){for(var t=this._primitives,i=0;i<t.length;++i){var a=t[i];Object(n.default)(a.postPassesUpdate)&&a.postPassesUpdate(e)}},s.prototype.isDestroyed=function(){return!1},s.prototype.destroy=function(){return this.removeAll(),Object(o.default)(this)},t.a=s},512:function(e,t,i){"use strict";var a=i(8),r=(i(10),i(25)),n=i(23),o=i(137),s=i(38);function l(e){this._definitionChanged=new n.default,this._value=void 0,this._removeSubscription=void 0,this.setValue(e)}Object.defineProperties(l.prototype,{isConstant:{get:function(){return s.default.isConstant(this._value)}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return Object(a.default)(this._value)?this._value.referenceFrame:o.a.FIXED}}}),l.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,o.a.FIXED,t)},l.prototype.setValue=function(e){this._value!==e&&(this._value=e,Object(a.default)(this._removeSubscription)&&(this._removeSubscription(),this._removeSubscription=void 0),Object(a.default)(e)&&(this._removeSubscription=e.definitionChanged.addEventListener(this._raiseDefinitionChanged,this)),this._definitionChanged.raiseEvent(this))},l.prototype.getValueInReferenceFrame=function(e,t,i){if(Object(a.default)(this._value))return i=this._value.getValueInReferenceFrame(e,t,i),Object(a.default)(i)?r.default.WGS84.scaleToGeodeticSurface(i,i):void 0},l.prototype.equals=function(e){return this===e||e instanceof l&&this._value===e._value},l.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)},t.a=l},513:function(e,t,i){"use strict";var a=i(93),r=i(33),n=i(24),o=i(12),s=i(34),l=i(9),u=i(8),d=(i(10),i(25)),f=i(51),c=i(52),h=i(64),m=i(85),p=i(49),_=i(14),g=i(45),v=i(78),y=new o.default,b=new o.default,w=new o.default,x=new o.default,O=new o.default,C=new o.default(1,1,1),T=Math.cos,E=Math.sin;function P(e){e=Object(l.default)(e,l.default.EMPTY_OBJECT);var t=Object(l.default)(e.radii,C),i=Object(l.default)(e.innerRadii,t),a=Object(l.default)(e.minimumClock,0),r=Object(l.default)(e.maximumClock,_.default.TWO_PI),n=Object(l.default)(e.minimumCone,0),s=Object(l.default)(e.maximumCone,_.default.PI),u=Math.round(Object(l.default)(e.stackPartitions,64)),d=Math.round(Object(l.default)(e.slicePartitions,64)),f=Object(l.default)(e.vertexFormat,v.default.DEFAULT);this._radii=o.default.clone(t),this._innerRadii=o.default.clone(i),this._minimumClock=a,this._maximumClock=r,this._minimumCone=n,this._maximumCone=s,this._stackPartitions=u,this._slicePartitions=d,this._vertexFormat=v.default.clone(f),this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipsoidGeometry"}P.packedLength=2*o.default.packedLength+v.default.packedLength+7,P.pack=function(e,t,i){return i=Object(l.default)(i,0),o.default.pack(e._radii,t,i),i+=o.default.packedLength,o.default.pack(e._innerRadii,t,i),i+=o.default.packedLength,v.default.pack(e._vertexFormat,t,i),i+=v.default.packedLength,t[i++]=e._minimumClock,t[i++]=e._maximumClock,t[i++]=e._minimumCone,t[i++]=e._maximumCone,t[i++]=e._stackPartitions,t[i++]=e._slicePartitions,t[i]=Object(l.default)(e._offsetAttribute,-1),t};var A,S=new o.default,D=new o.default,I=new v.default,M={radii:S,innerRadii:D,vertexFormat:I,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,offsetAttribute:void 0};P.unpack=function(e,t,i){t=Object(l.default)(t,0);var a=o.default.unpack(e,t,S);t+=o.default.packedLength;var r=o.default.unpack(e,t,D);t+=o.default.packedLength;var n=v.default.unpack(e,t,I);t+=v.default.packedLength;var s=e[t++],d=e[t++],f=e[t++],c=e[t++],h=e[t++],m=e[t++],p=e[t];return Object(u.default)(i)?(i._radii=o.default.clone(a,i._radii),i._innerRadii=o.default.clone(r,i._innerRadii),i._vertexFormat=v.default.clone(n,i._vertexFormat),i._minimumClock=s,i._maximumClock=d,i._minimumCone=f,i._maximumCone=c,i._stackPartitions=h,i._slicePartitions=m,i._offsetAttribute=-1===p?void 0:p,i):(M.minimumClock=s,M.maximumClock=d,M.minimumCone=f,M.maximumCone=c,M.stackPartitions=h,M.slicePartitions=m,M.offsetAttribute=-1===p?void 0:p,new P(M))},P.createGeometry=function(e){var t=e._radii;if(!(t.x<=0||t.y<=0||t.z<=0)){var i=e._innerRadii;if(!(i.x<=0||i.y<=0||i.z<=0)){var l,v,C=e._minimumClock,P=e._maximumClock,A=e._minimumCone,S=e._maximumCone,D=e._vertexFormat,I=e._slicePartitions+1,M=e._stackPartitions+1;(I=Math.round(I*Math.abs(P-C)/_.default.TWO_PI))<2&&(I=2),(M=Math.round(M*Math.abs(S-A)/_.default.PI))<2&&(M=2);var F=0,R=[A],N=[C];for(l=0;l<M;l++)R.push(A+l*(S-A)/(M-1));for(R.push(S),v=0;v<I;v++)N.push(C+v*(P-C)/(I-1));N.push(P);var L=R.length,j=N.length,V=0,U=1,z=i.x!==t.x||i.y!==t.y||i.z!==t.z,B=!1,H=!1,k=!1;z&&(U=2,A>0&&(B=!0,V+=I-1),S<Math.PI&&(H=!0,V+=I-1),(P-C)%_.default.TWO_PI?(k=!0,V+=2*(M-1)+1):V+=1);var W=j*L*U,G=new Float64Array(3*W),Y=Object(a.a)(new Array(W),!1),X=Object(a.a)(new Array(W),!1),Q=I*M*U,q=6*(Q+V+1-(I+M)*U),Z=p.a.createTypedArray(Q,q),K=D.normal?new Float32Array(3*W):void 0,J=D.tangent?new Float32Array(3*W):void 0,$=D.bitangent?new Float32Array(3*W):void 0,ee=D.st?new Float32Array(2*W):void 0,te=new Array(L),ie=new Array(L);for(l=0;l<L;l++)te[l]=E(R[l]),ie[l]=T(R[l]);var ae=new Array(j),re=new Array(j);for(v=0;v<j;v++)re[v]=T(N[v]),ae[v]=E(N[v]);for(l=0;l<L;l++)for(v=0;v<j;v++)G[F++]=t.x*te[l]*re[v],G[F++]=t.y*te[l]*ae[v],G[F++]=t.z*ie[l];var ne,oe,se,le,ue=W/2;if(z)for(l=0;l<L;l++)for(v=0;v<j;v++)G[F++]=i.x*te[l]*re[v],G[F++]=i.y*te[l]*ae[v],G[F++]=i.z*ie[l],Y[ue]=!0,l>0&&l!==L-1&&0!==v&&v!==j-1&&(X[ue]=!0),ue++;for(F=0,l=1;l<L-2;l++)for(ne=l*j,oe=(l+1)*j,v=1;v<j-2;v++)Z[F++]=oe+v,Z[F++]=oe+v+1,Z[F++]=ne+v+1,Z[F++]=oe+v,Z[F++]=ne+v+1,Z[F++]=ne+v;if(z){var de=L*j;for(l=1;l<L-2;l++)for(ne=de+l*j,oe=de+(l+1)*j,v=1;v<j-2;v++)Z[F++]=oe+v,Z[F++]=ne+v,Z[F++]=ne+v+1,Z[F++]=oe+v,Z[F++]=ne+v+1,Z[F++]=oe+v+1}if(z){if(B)for(le=L*j,l=1;l<j-2;l++)Z[F++]=l,Z[F++]=l+1,Z[F++]=le+l+1,Z[F++]=l,Z[F++]=le+l+1,Z[F++]=le+l;if(H)for(se=L*j-j,le=L*j*U-j,l=1;l<j-2;l++)Z[F++]=se+l+1,Z[F++]=se+l,Z[F++]=le+l,Z[F++]=se+l+1,Z[F++]=le+l,Z[F++]=le+l+1}if(k){for(l=1;l<L-2;l++)le=j*L+j*l,se=j*l,Z[F++]=le,Z[F++]=se+j,Z[F++]=se,Z[F++]=le,Z[F++]=le+j,Z[F++]=se+j;for(l=1;l<L-2;l++)le=j*L+j*(l+1)-1,se=j*(l+1)-1,Z[F++]=se+j,Z[F++]=le,Z[F++]=se,Z[F++]=se+j,Z[F++]=le+j,Z[F++]=le}var fe=new h.a;D.position&&(fe.position=new c.a({componentDatatype:s.a.DOUBLE,componentsPerAttribute:3,values:G}));var ce,he=0,me=0,pe=0,_e=0,ge=W/2,ve=d.default.fromCartesian3(t),ye=d.default.fromCartesian3(i);if(D.st||D.normal||D.tangent||D.bitangent){for(l=0;l<W;l++){ce=Y[l]?ye:ve;var be=o.default.fromArray(G,3*l,y),we=ce.geodeticSurfaceNormal(be,b);if(X[l]&&o.default.negate(we,we),D.st){var xe=n.default.negate(we,O);ee[he++]=Math.atan2(xe.y,xe.x)/_.default.TWO_PI+.5,ee[he++]=Math.asin(we.z)/Math.PI+.5}if(D.normal&&(K[me++]=we.x,K[me++]=we.y,K[me++]=we.z),D.tangent||D.bitangent){var Oe,Ce=w,Te=0;if(Y[l]&&(Te=ge),Oe=!B&&l>=Te&&l<Te+2*j?o.default.UNIT_X:o.default.UNIT_Z,o.default.cross(Oe,we,Ce),o.default.normalize(Ce,Ce),D.tangent&&(J[pe++]=Ce.x,J[pe++]=Ce.y,J[pe++]=Ce.z),D.bitangent){var Ee=o.default.cross(we,Ce,x);o.default.normalize(Ee,Ee),$[_e++]=Ee.x,$[_e++]=Ee.y,$[_e++]=Ee.z}}}D.st&&(fe.st=new c.a({componentDatatype:s.a.FLOAT,componentsPerAttribute:2,values:ee})),D.normal&&(fe.normal=new c.a({componentDatatype:s.a.FLOAT,componentsPerAttribute:3,values:K})),D.tangent&&(fe.tangent=new c.a({componentDatatype:s.a.FLOAT,componentsPerAttribute:3,values:J})),D.bitangent&&(fe.bitangent=new c.a({componentDatatype:s.a.FLOAT,componentsPerAttribute:3,values:$}))}if(Object(u.default)(e._offsetAttribute)){var Pe=G.length,Ae=new Uint8Array(Pe/3),Se=e._offsetAttribute===m.a.NONE?0:1;Object(a.a)(Ae,Se),fe.applyOffset=new c.a({componentDatatype:s.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:Ae})}return new f.a({attributes:fe,indices:Z,primitiveType:g.a.TRIANGLES,boundingSphere:r.default.fromEllipsoid(ve),offsetAttribute:e._offsetAttribute})}}},P.getUnitEllipsoid=function(){return Object(u.default)(A)||(A=P.createGeometry(new P({radii:new o.default(1,1,1),vertexFormat:v.default.POSITION_ONLY}))),A},t.a=P},770:function(e,t,i){"use strict";function a(e){return function(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var r=i(33).default,n=i(87).default,o=i(24).default,s=i(12).default,l=i(30).default,u=i(14).default,d=i(9).default,f=i(8).default,c=i(18).default,h=i(10).default,m=i(25).default,p=i(142).default,_=i(199).default,g=i(96).default,v=i(351).default,y=i(373).default,b=i(42).default,w=i(22).default,x=i(145),O=i(28).default,C=i(29).default,T=i(344).default,E=i(183).default,P=i(213).default,A=i(132).default,S=i(62).default,D=i(16).default,I=i(140).default,M=i(129).default,F=i(1674),R=i(228),N=i(418),L=i(27),j=i(406),V=i(37),U=i(426),z=i(170),B=i(20).default,H=function(e,t){N.call(this,e),this.viewer=t,this.scene=t.scene,this.stoppedRendering=!1,this.verboseRendering=!1,this.canShowSplitter=!0,this.dataSourceDisplay=void 0,this._lastClockTime=new b(0,0),this._lastCameraViewMatrix=new O,this._lastCameraMoveTime=0,this._selectionIndicator=new F(this),this._removePostRenderListener=this.scene.postRender.addEventListener(ae.bind(void 0,this)),this._removeInfoBoxCloseListener=void 0,this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this),this._pauseMapInteractionCount=0,this.scene.imagerySplitPosition=this.terria.splitPosition,this.supportsPolylinesOnTerrain=this.scene.context.depthTexture,t.screenSpaceEventHandler.setInputAction(function(e){this.pickFromScreenPosition(e.position)}.bind(this),P.LEFT_CLICK);var i=this.viewer.canvas;if(i.addEventListener("mousemove",this._boundNotifyRepaintRequired,!1),i.addEventListener("mousedown",this._boundNotifyRepaintRequired,!1),i.addEventListener("mouseup",this._boundNotifyRepaintRequired,!1),i.addEventListener("touchstart",this._boundNotifyRepaintRequired,!1),i.addEventListener("touchend",this._boundNotifyRepaintRequired,!1),i.addEventListener("touchmove",this._boundNotifyRepaintRequired,!1),f(window.PointerEvent)&&(i.addEventListener("pointerdown",this._boundNotifyRepaintRequired,!1),i.addEventListener("pointerup",this._boundNotifyRepaintRequired,!1),i.addEventListener("pointermove",this._boundNotifyRepaintRequired,!1)),this._wheelEvent=void 0,"onwheel"in i?this._wheelEvent="wheel":f(document.onmousewheel)?this._wheelEvent="mousewheel":this._wheelEvent="DOMMouseScroll",i.addEventListener(this._wheelEvent,this._boundNotifyRepaintRequired,!1),window.addEventListener("resize",this._boundNotifyRepaintRequired,!1),f(this.viewer.infoBox)&&(this._removeInfoBoxCloseListener=this.viewer.infoBox.viewModel.closeClicked.addEventListener(this._boundNotifyRepaintRequired)),f(this.viewer._clockViewModel)){var a=this.viewer._clockViewModel;this._shouldAnimateSubscription=w.getObservable(a,"shouldAnimate").subscribe(this._boundNotifyRepaintRequired),this._currentTimeSubscription=w.getObservable(a,"currentTime").subscribe(this._boundNotifyRepaintRequired)}f(this.viewer.timeline)&&this.viewer.timeline.addEventListener("settime",this._boundNotifyRepaintRequired,!1),this._selectedFeatureSubscription=w.getObservable(this.terria,"selectedFeature").subscribe((function(){re(this)}),this),this._splitterPositionSubscription=w.getObservable(this.terria,"splitPosition").subscribe((function(){this.scene&&(this.scene.imagerySplitPosition=this.terria.splitPosition,this.notifyRepaintRequired())}),this),this._showSplitterSubscription=w.getObservable(e,"showSplitter").subscribe((function(){this.updateAllItemsForSplitter()}),this);var r=this;this._originalLoadWithXhr=x.load,x.load=function(e,t,i,a,n,o,s,l,u){o.promise.always(r._boundNotifyRepaintRequired),r._originalLoadWithXhr(e,t,i,a,n,o,s,l,u)},this._originalScheduleTask=A.prototype.scheduleTask,A.prototype.scheduleTask=function(e,t){var i=r._originalScheduleTask.call(this,e,t);if(!f(this._originalWorkerMessageSinkRepaint)){this._originalWorkerMessageSinkRepaint=this._worker.onmessage;var a=this;this._worker.onmessage=function(e){a._originalWorkerMessageSinkRepaint(e),r.isDestroyed()?(a._worker.onmessage=a._originalWorkerMessageSinkRepaint,a._originalWorkerMessageSinkRepaint=void 0):r.notifyRepaintRequired()}}return i},this.eventHelper=new I,this.eventHelper.add(this.scene.renderError,(function(t,i){this.terria.error.raiseEvent(new V({sender:this,title:B.t("models.cesiumTerrain.errorRenderingTitle"),message:B.t("models.cesiumTerrain.errorRenderingTitle",{appName:e.appName,email:'<a href="mailto:'+e.supportEmail+'">'+e.supportEmail+"</a>."})+"<pre>"+_(i)+"</pre>"})),this.terria.viewerMode=z.Leaflet}),this),this.eventHelper.add(this.scene.globe.tileLoadProgressEvent,this.updateTilesLoadingCount.bind(this)),re(this)};L(N,H),H.prototype.destroy=function(){return f(this._selectionIndicator)&&(this._selectionIndicator.destroy(),this._selectionIndicator=void 0),f(this._removePostRenderListener)&&(this._removePostRenderListener(),this._removePostRenderListener=void 0),f(this._removeInfoBoxCloseListener)&&this._removeInfoBoxCloseListener(),f(this._shouldAnimateSubscription)&&(this._shouldAnimateSubscription.dispose(),this._shouldAnimateSubscription=void 0),f(this._currentTimeSubscription)&&(this._currentTimeSubscription.dispose(),this._currentTimeSubscription=void 0),f(this.viewer.timeline)&&this.viewer.timeline.removeEventListener("settime",this._boundNotifyRepaintRequired,!1),f(this._selectedFeatureSubscription)&&(this._selectedFeatureSubscription.dispose(),this._selectedFeatureSubscription=void 0),f(this._splitterPositionSubscription)&&(this._splitterPositionSubscription.dispose(),this._splitterPositionSubscription=void 0),f(this._showSplitterSubscription)&&(this._showSplitterSubscription.dispose(),this._showSplitterSubscription=void 0),this.viewer.canvas.removeEventListener("mousemove",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("mousedown",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("mouseup",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("touchstart",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("touchend",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("touchmove",this._boundNotifyRepaintRequired,!1),f(window.PointerEvent)&&(this.viewer.canvas.removeEventListener("pointerdown",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("pointerup",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("pointermove",this._boundNotifyRepaintRequired,!1)),this.viewer.canvas.removeEventListener(this._wheelEvent,this._boundNotifyRepaintRequired,!1),window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1),window.removeEventListener("resize",this._setViewerResolution,!1),x.load=this._originalLoadWithXhr,A.prototype.scheduleTask=this._originalScheduleTask,this.eventHelper.removeAll(),N.disposeCommonListeners(this),c(this)},H.prototype.isDestroyed=function(){return!1};var k=new s,W=new O,G=new s,Y=new s,X=new s,Q=new s,q=new l,Z=new l,K=new l,J=new l;H.prototype.getCurrentExtent=function(){var e=this.scene,t=e.camera,i=e.canvas.clientWidth,a=e.canvas.clientHeight,r=new o(i/2,a/2),n=e.camera.getPickRay(r),l=e.globe.pick(n,e);if(!f(l))return this.terria.homeView.rectangle;var d=this.scene.globe.ellipsoid,c=.5*e.camera.frustum.fovy,h=Math.atan(Math.tan(c)*e.camera.frustum.aspectRatio),m=s.subtract(t.positionWC,l,k),p=s.magnitude(m),_=p*Math.tan(h),g=p*Math.tan(c),v=new s(-_,-g,0),y=new s(_,-g,0),b=new s(_,g,0),w=new s(-_,g,0),x=S.eastNorthUpToFixedFrame(l,d,W),T=O.multiplyByPoint(x,v,G),E=O.multiplyByPoint(x,y,Y),P=O.multiplyByPoint(x,b,X),A=O.multiplyByPoint(x,w,Q),D=d.cartesianToCartographic(T,q),I=d.cartesianToCartographic(E,Z),M=d.cartesianToCartographic(P,K),F=d.cartesianToCartographic(A,J);I.longitude<D.longitude&&(I.longitude+=u.TWO_PI),M.longitude<F.longitude&&(M.longitude+=u.TWO_PI);var R=new C(u.convertLongitudeRange(Math.min(D.longitude,F.longitude)),Math.min(D.latitude,I.latitude),u.convertLongitudeRange(Math.max(M.longitude,I.longitude)),Math.max(M.latitude,F.latitude));return R.center=l,R},H.prototype.getContainer=function(){return this.viewer.container},H.prototype.zoomTo=function(e,t){if(!f(e))throw new h("target is required.");t=d(t,3);var i=this;return i.lastTarget=e,D().then((function(){if(e instanceof C){var a=i.scene.camera,r=a.getRectangleCameraCoordinates(e),n=m.WGS84.cartesianToCartographic(r),o=i.scene.globe.terrainProvider,s=[C.center(e)];return T(o,6,s).then((function(r){if(i.lastTarget===e){var o={longitude:n.longitude,latitude:n.latitude,height:n.height+r[0].height},s=m.WGS84.cartographicToCartesian(o);a.flyTo({duration:t,destination:s})}}))}if(f(e.entities)){if(e.isLoading&&f(e.loadingEvent)){var l=D.defer(),u=e.loadingEvent.addEventListener((function(){u(),l.resolve()}));return l.promise.then((function(){if(i.lastTarget===e)return ee(i,e,t)}))}return ee(i,e)}return f(e.readyPromise)?e.readyPromise.then((function(){f(e.boundingSphere)&&i.lastTarget===e&&te(i,e,t)})):f(e.boundingSphere)?te(i,e):void(f(e.position)?i.scene.camera.flyTo({duration:t,destination:e.position,orientation:{direction:e.direction,up:e.up}}):i.scene.camera.flyTo({duration:t,destination:e.rectangle}))})).then((function(){i.notifyRepaintRequired()}))};var $=new r;function ee(e,t,i){return j((function(){for(var a=e.dataSourceDisplay,o=t.entities.values,s=[],l=0,u=o.length;l<u;l++){var d=n.PENDING;try{d=a.getBoundingSphere(o[l],!1,$)}catch(e){}if(d===n.PENDING)return!1;d!==n.FAILED&&s.push(r.clone($))}var f=r.fromBoundingSpheres(s);return e.scene.camera.flyToBoundingSphere(f,{duration:i}),!0}),{pollInterval:100,timeout:5e3})}function te(e,t,i){var a=t.boundingSphere,n=t.modelMatrix;n&&(a=r.transform(a,n)),e.scene.camera.flyToBoundingSphere(a,{offset:new v(0,-.5,a.radius),duration:i})}function ie(e){return f(e.items)?e.items.length:1}function ae(e,t){var i=g(),a=e.scene;O.equalsEpsilon(e._lastCameraViewMatrix,a.camera.viewMatrix,1e-5)||(e._lastCameraMoveTime=i);var r=i-e._lastCameraMoveTime<1e3,o=a.globe._surface,l=!o._tileProvider.ready||o._tileLoadQueueHigh.length>0||o._tileLoadQueueMedium.length>0||o._tileLoadQueueLow.length>0||o._debug.tilesWaitingForChildren>0;r||l||e.viewer.clock.shouldAnimate||0!==e.scene.tweens.length||(e.verboseRendering&&console.log("stopping rendering @ "+g()),e.viewer.useDefaultRenderLoop=!1,e.stoppedRendering=!0),O.clone(a.camera.viewMatrix,e._lastCameraViewMatrix);var u=e.terria.selectedFeature;if(f(u)){var d;if(f(e.dataSourceDisplay)){var c=f(u.cesiumEntity)?u.cesiumEntity:u;e.dataSourceDisplay.getBoundingSphere(c,!0,$)===n.DONE&&(d=s.clone($.center))}!f(d)&&f(u.position)&&(d=u.position.getValue(e.terria.clock.currentTime)),f(d)&&(e._selectionIndicator.position=d)}e._selectionIndicator.update()}function re(e){var t=e.terria.selectedFeature;e._highlightFeature(t),f(t)&&f(t.position)?(e._selectionIndicator.position=t.position.getValue(e.terria.clock.currentTime),e._selectionIndicator.animateAppear()):e._selectionIndicator.animateDepart(),e._selectionIndicator.update()}H.prototype.captureScreenshot=function(){var e=D.defer(),t=this.scene.postRender.addEventListener((function(){t();try{var i=this.scene.canvas,a=i;if(this.terria.showSplitter){(a=document.createElement("canvas")).width=i.width,a.height=i.height;var r=a.getContext("2d");r.drawImage(i,0,0);var n=this.terria.splitPosition*i.width;r.strokeStyle=this.terria.baseMapContrastColor,r.beginPath(),r.moveTo(n,0),r.lineTo(n,i.height),r.stroke()}e.resolve(a.toDataURL("image/png"))}catch(t){e.reject(t)}}),this);return this.scene.render(this.terria.clock.currentTime),e.promise},H.prototype.notifyRepaintRequired=function(){this.verboseRendering&&!this.viewer.useDefaultRenderLoop&&console.log("starting rendering @ "+g()),this._lastCameraMoveTime=g(),this.viewer.useDefaultRenderLoop=!0},H.prototype.computePositionOnScreen=function(e,t){return E.wgs84ToWindowCoordinates(this.scene,e,t)},H.prototype.addAttribution=function(e){e&&this.scene.frameState.creditDisplay.addDefaultCredit(e)},H.prototype.removeAttribution=function(e){e&&this.scene.frameState.creditDisplay.removeDefaultCredit(e)},H.prototype.getAllAttribution=function(){return this.scene.frameState.creditDisplay._currentFrameCredits.screenCredits.values.concat(this.scene.frameState.creditDisplay._currentFrameCredits.lightboxCredits.values).map((function(e){return e.html}))},H.prototype.updateLayerOrderToKeepOnTop=function(){for(var e=this.terria.nowViewing.items,t=this.scene,i=e.length-1;i>=0;i--)e[i].imageryLayer&&e[i].keepOnTop&&t.imageryLayers.raiseToTop(e[i].imageryLayer)},H.prototype.updateLayerOrderAfterReorder=function(){},H.prototype.raise=function(e){var t=this.terria.nowViewing.items,i=t[e],a=t[e-1];if(f(a.items)||f(a.imageryLayer)){var r,n,o,s=ie(a);if(f(i.items))for(r=i.items.length-1;r>=0;--r)if(o=i.items[r],f(o.imageryLayer))for(n=0;n<s;++n)this.scene.imageryLayers.raise(o.imageryLayer);if(f(i.imageryLayer))for(n=0;n<s;++n)this.scene.imageryLayers.raise(i.imageryLayer)}},H.prototype.lower=function(e){var t=this.terria.nowViewing.items,i=t[e],a=t[e+1];if(f(a.items)||f(a.imageryLayer)){var r,n,o,s=ie(a);if(f(i.items))for(r=0;r<i.items.length;++r)if(o=i.items[r],f(o.imageryLayer))for(n=0;n<s;++n)this.scene.imageryLayers.lower(o.imageryLayer);if(f(i.imageryLayer))for(n=0;n<s;++n)this.scene.imageryLayers.lower(i.imageryLayer)}},H.prototype.lowerToBottom=function(e){if(f(e.items))for(var t=e.items.length-1;t>=0;--t){var i=e.items[t];this.lowerToBottom(i)}f(e._imageryLayer)&&this.terria.cesium.scene.imageryLayers.lowerToBottom(e._imageryLayer)},H.prototype.adjustDisclaimer=function(){},H.prototype.pickFromLocation=function(e,t,i,a){var r=this.scene.globe.ellipsoid.cartographicToCartesian(l.fromDegrees(e.lng,e.lat,e.height)),n=m.WGS84.cartesianToCartographic(r),o=[],s=[];if(this.terria.allowFeatureInfoRequests)for(var u=this.scene.imageryLayers.length-1;u>=0;u--){var d=this.scene.imageryLayers.get(u),c=d._imageryProvider;if(c.url&&t[c.url]){var h=t[c.url];o.push(c.pickFeatures(h.x,h.y,h.level,n.longitude,n.latitude)),s.push(d)}}var p=this._buildPickedFeatures(t,r,i,o,s,n.height,a),_=this.terria.mapInteractionModeStack;f(_)&&_.length>0?_[_.length-1].pickedFeatures=p:this.terria.pickedFeatures=p},H.prototype.pickFromScreenPosition=function(e,t){var i=this.scene.camera.getPickRay(e),a=this.scene.globe.pick(i,this.scene),r=m.WGS84.cartesianToCartographic(a),n=this.pickVectorFeatures(e),o=this._attachProviderCoordHooks(),s=this.terria.allowFeatureInfoRequests?this.scene.imageryLayers.pickImageryLayerFeatures(i,this.scene):Promise.resolve(),l=this._buildPickedFeatures(o,a,n,[s],void 0,r.height,t),u=this.terria.mapInteractionModeStack;f(u)&&u.length>0?u[u.length-1].pickedFeatures=l:this.terria.pickedFeatures=l},H.prototype.pickVectorFeatures=function(e){for(var t=[],i=this.scene.drillPick(e),r=0;r<i.length;++r){var n=i[r],o=n.id;if(!(o&&o.entityCollection&&o.entityCollection.owner&&o.entityCollection.owner.name===N._featureHighlightName))if(!f(o)&&f(n.primitive)&&(o=n.primitive.id),o instanceof p&&-1===t.indexOf(o)){var s=R.fromEntityCollectionOrEntity(o);t.push(s)}else if(n.primitive&&n.primitive._catalogItem&&n.primitive._catalogItem.getFeaturesFromPickResult){var l=n.primitive._catalogItem.getFeaturesFromPickResult(e,n);l&&(Array.isArray(l)?t.push.apply(t,a(l)):t.push(l))}}return t},H.prototype._attachProviderCoordHooks=function(){for(var e={},t=function(t,i,a,r,n,o,s){var l=i.call(t,a,r,n,o,s);return t.url&&(e[t.url]={x:a,y:r,level:n}),t.pickFeatures=i,l},i=0;i<this.scene.imageryLayers.length;i++){var a=this.scene.imageryLayers.get(i).imageryProvider;a.pickFeatures=t.bind(void 0,a,a.pickFeatures)}return e},H.prototype._buildPickedFeatures=function(e,t,i,a,r,n,o){o=d(o,!1);var s=new U;return s.providerCoords=e,s.pickPosition=t,s.allFeaturesAvailablePromise=D.all(a).then(function(e){s.isLoading=!1,s.features=e.reduce(function(e,i,a){if(!f(i))return e;var l=i.map(function(e){return f(r)&&(e.imageryLayer=r[a]),f(e.position)||(e.position=m.WGS84.cartesianToCartographic(t)),f(e.position.height)&&0!==e.position.height||(e.position.height=n),this._createFeatureFromImageryLayerFeature(e)}.bind(this));if(this.terria.showSplitter&&!o){var u=this.computePositionOnScreen(s.pickPosition),d=this.terria.getSplitterSideForScreenPosition(u);l=l.filter((function(e){var t=e.imageryLayer.splitDirection;return t===d||t===M.NONE}))}return e.concat(l)}.bind(this),d(i,[]))}.bind(this)).otherwise((function(){s.isLoading=!1,s.error="An unknown error occurred while picking features."})),s},H.prototype.addImageryProvider=function(e){var t=this.scene,i=e.imageryProvider.errorEvent;f(i)&&i.addEventListener(e.onLoadError);var a=new y(e.imageryProvider,{show:!1,alpha:e.opacity,rectangle:e.clipToRectangle?e.rectangle:void 0,isRequired:e.isRequiredForRendering});return t.imageryLayers.add(a,e.layerIndex),this.updateLayerOrderToKeepOnTop(),a},H.prototype.removeImageryLayer=function(e){this.scene.imageryLayers.remove(e.layer)},H.prototype.showImageryLayer=function(e){e.layer.show=!0},H.prototype.hideImageryLayer=function(e){e.layer.show=!1},H.prototype.isImageryLayerShown=function(e){return e.layer.show},H.prototype.updateItemForSplitter=function(e){f(e.splitDirection)&&f(e.imageryLayer)&&(e.terria.showSplitter?e.imageryLayer.splitDirection=e.splitDirection:e.imageryLayer.splitDirection=M.NONE,e._nextLayer&&(e._nextLayer.splitDirection=e.imageryLayer.splitDirection),this.notifyRepaintRequired())},H.prototype.pauseMapInteraction=function(){++this._pauseMapInteractionCount,1===this._pauseMapInteractionCount&&(this.scene.screenSpaceCameraController.enableInputs=!1)},H.prototype.resumeMapInteraction=function(){var e=this;--this._pauseMapInteractionCount,0===this._pauseMapInteractionCount&&setTimeout((function(){0===e._pauseMapInteractionCount&&(e.scene.screenSpaceCameraController.enableInputs=!0)}),0)},e.exports=H},772:function(e,t,i){"use strict";i.r(t);i(114);var a=i(12),r=i(399),n=i(9),o=i(8),s=i(18),l=i(10),u=i(25),d=i(70),f=i(199),c=i(408),h=i(276),m=i(785),p=i(766);var _=function(e){e=Object(n.default)(e,n.default.EMPTY_OBJECT);var t=Object(n.default)(e.style,p.default.AERIAL);return new m.default({assetId:t})},g=i(33),v=i(30),y=i(354),b=i(23),w=i(129),x=i(157),O=i(126),C=i(29),T=i(39),E=i(59),P=i(61),A="uniform vec4 u_initialColor;\n\n#if TEXTURE_UNITS > 0\nuniform sampler2D u_dayTextures[TEXTURE_UNITS];\nuniform vec4 u_dayTextureTranslationAndScale[TEXTURE_UNITS];\nuniform bool u_dayTextureUseWebMercatorT[TEXTURE_UNITS];\n\n#ifdef APPLY_ALPHA\nuniform float u_dayTextureAlpha[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_SPLIT\nuniform float u_dayTextureSplit[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_BRIGHTNESS\nuniform float u_dayTextureBrightness[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_CONTRAST\nuniform float u_dayTextureContrast[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_HUE\nuniform float u_dayTextureHue[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_SATURATION\nuniform float u_dayTextureSaturation[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_GAMMA\nuniform float u_dayTextureOneOverGamma[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_IMAGERY_CUTOUT\nuniform vec4 u_dayTextureCutoutRectangles[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_COLOR_TO_ALPHA\nuniform vec4 u_colorsToAlpha[TEXTURE_UNITS];\n#endif\n\nuniform vec4 u_dayTextureTexCoordsRectangle[TEXTURE_UNITS];\n#endif\n\n#ifdef SHOW_REFLECTIVE_OCEAN\nuniform sampler2D u_waterMask;\nuniform vec4 u_waterMaskTranslationAndScale;\nuniform float u_zoomedOutOceanSpecularIntensity;\n#endif\n\n#ifdef SHOW_OCEAN_WAVES\nuniform sampler2D u_oceanNormalMap;\n#endif\n\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\nuniform vec2 u_lightingFadeDistance;\n#endif\n\n#ifdef TILE_LIMIT_RECTANGLE\nuniform vec4 u_cartographicLimitRectangle;\n#endif\n\n#ifdef GROUND_ATMOSPHERE\nuniform vec2 u_nightFadeDistance;\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\nuniform sampler2D u_clippingPlanes;\nuniform mat4 u_clippingPlanesMatrix;\nuniform vec4 u_clippingPlanesEdgeStyle;\n#endif\n\n#ifdef SPLIT_TERRAIN\nuniform float u_terrainSplitDirection;\n#endif\n\n#if defined(FOG) && defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))\nuniform float u_minimumBrightness;\n#endif\n\n#ifdef COLOR_CORRECT\nuniform vec3 u_hsbShift; // Hue, saturation, brightness\n#endif\n\n#ifdef HIGHLIGHT_FILL_TILE\nuniform vec4 u_fillHighlightColor;\n#endif\n\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec3 v_textureCoordinates;\nvarying vec3 v_normalMC;\nvarying vec3 v_normalEC;\n\n#ifdef APPLY_MATERIAL\nvarying float v_height;\nvarying float v_slope;\nvarying float v_aspect;\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nvarying float v_distance;\nvarying vec3 v_fogRayleighColor;\nvarying vec3 v_fogMieColor;\n#endif\n\n#ifdef GROUND_ATMOSPHERE\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\n#endif\n\nvec4 sampleAndBlend(\n    vec4 previousColor,\n    sampler2D textureToSample,\n    vec2 tileTextureCoordinates,\n    vec4 textureCoordinateRectangle,\n    vec4 textureCoordinateTranslationAndScale,\n    float textureAlpha,\n    float textureBrightness,\n    float textureContrast,\n    float textureHue,\n    float textureSaturation,\n    float textureOneOverGamma,\n    float split,\n    vec4 colorToAlpha)\n{\n    // This crazy step stuff sets the alpha to 0.0 if this following condition is true:\n    //    tileTextureCoordinates.s < textureCoordinateRectangle.s ||\n    //    tileTextureCoordinates.s > textureCoordinateRectangle.p ||\n    //    tileTextureCoordinates.t < textureCoordinateRectangle.t ||\n    //    tileTextureCoordinates.t > textureCoordinateRectangle.q\n    // In other words, the alpha is zero if the fragment is outside the rectangle\n    // covered by this texture.  Would an actual 'if' yield better performance?\n    vec2 alphaMultiplier = step(textureCoordinateRectangle.st, tileTextureCoordinates);\n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\n\n    alphaMultiplier = step(vec2(0.0), textureCoordinateRectangle.pq - tileTextureCoordinates);\n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\n\n    vec2 translation = textureCoordinateTranslationAndScale.xy;\n    vec2 scale = textureCoordinateTranslationAndScale.zw;\n    vec2 textureCoordinates = tileTextureCoordinates * scale + translation;\n    vec4 value = texture2D(textureToSample, textureCoordinates);\n    vec3 color = value.rgb;\n    float alpha = value.a;\n\n#ifdef APPLY_COLOR_TO_ALPHA\n    vec3 colorDiff = abs(color.rgb - colorToAlpha.rgb);\n    colorDiff.r = max(max(colorDiff.r, colorDiff.g), colorDiff.b);\n    alpha = czm_branchFreeTernary(colorDiff.r < colorToAlpha.a, 0.0, alpha);\n#endif\n\n#if !defined(APPLY_GAMMA)\n    vec4 tempColor = czm_gammaCorrect(vec4(color, alpha));\n    color = tempColor.rgb;\n    alpha = tempColor.a;\n#else\n    color = pow(color, vec3(textureOneOverGamma));\n#endif\n\n#ifdef APPLY_SPLIT\n    float splitPosition = czm_imagerySplitPosition;\n    // Split to the left\n    if (split < 0.0 && gl_FragCoord.x > splitPosition) {\n       alpha = 0.0;\n    }\n    // Split to the right\n    else if (split > 0.0 && gl_FragCoord.x < splitPosition) {\n       alpha = 0.0;\n    }\n#endif\n\n#ifdef APPLY_BRIGHTNESS\n    color = mix(vec3(0.0), color, textureBrightness);\n#endif\n\n#ifdef APPLY_CONTRAST\n    color = mix(vec3(0.5), color, textureContrast);\n#endif\n\n#ifdef APPLY_HUE\n    color = czm_hue(color, textureHue);\n#endif\n\n#ifdef APPLY_SATURATION\n    color = czm_saturation(color, textureSaturation);\n#endif\n\n    float sourceAlpha = alpha * textureAlpha;\n    float outAlpha = mix(previousColor.a, 1.0, sourceAlpha);\n    outAlpha += sign(outAlpha) - 1.0;\n\n    vec3 outColor = mix(previousColor.rgb * previousColor.a, color, sourceAlpha) / outAlpha;\n\n    // When rendering imagery for a tile in multiple passes,\n    // some GPU/WebGL implementation combinations will not blend fragments in\n    // additional passes correctly if their computation includes an unmasked\n    // divide-by-zero operation,\n    // even if it's not in the output or if the output has alpha zero.\n    //\n    // For example, without sanitization for outAlpha,\n    // this renders without artifacts:\n    //   if (outAlpha == 0.0) { outColor = vec3(0.0); }\n    //\n    // but using czm_branchFreeTernary will cause portions of the tile that are\n    // alpha-zero in the additional pass to render as black instead of blending\n    // with the previous pass:\n    //   outColor = czm_branchFreeTernary(outAlpha == 0.0, vec3(0.0), outColor);\n    //\n    // So instead, sanitize against divide-by-zero,\n    // store this state on the sign of outAlpha, and correct on return.\n\n    return vec4(outColor, max(outAlpha, 0.0));\n}\n\nvec3 colorCorrect(vec3 rgb) {\n#ifdef COLOR_CORRECT\n    // Convert rgb color to hsb\n    vec3 hsb = czm_RGBToHSB(rgb);\n    // Perform hsb shift\n    hsb.x += u_hsbShift.x; // hue\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\n    // Convert shifted hsb back to rgb\n    rgb = czm_HSBToRGB(hsb);\n#endif\n    return rgb;\n}\n\nvec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates);\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float specularMapValue, float fade);\n\nvoid main()\n{\n#ifdef TILE_LIMIT_RECTANGLE\n    if (v_textureCoordinates.x < u_cartographicLimitRectangle.x || u_cartographicLimitRectangle.z < v_textureCoordinates.x ||\n        v_textureCoordinates.y < u_cartographicLimitRectangle.y || u_cartographicLimitRectangle.w < v_textureCoordinates.y)\n        {\n            discard;\n        }\n#endif\n\n#ifdef SPLIT_TERRAIN\n    float splitPosition = czm_imagerySplitPosition;\n    if (u_terrainSplitDirection < 0.0 && gl_FragCoord.x > splitPosition) {\n        discard;\n    } else if (u_terrainSplitDirection > 0.0 && gl_FragCoord.x < splitPosition) {\n        discard;\n    }\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\n    float clipDistance = clip(gl_FragCoord, u_clippingPlanes, u_clippingPlanesMatrix);\n#endif\n\n    // The clamp below works around an apparent bug in Chrome Canary v23.0.1241.0\n    // where the fragment shader sees textures coordinates < 0.0 and > 1.0 for the\n    // fragments on the edges of tiles even though the vertex shader is outputting\n    // coordinates strictly in the 0-1 range.\n    vec4 color = computeDayColor(u_initialColor, clamp(v_textureCoordinates, 0.0, 1.0));\n\n#ifdef SHOW_TILE_BOUNDARIES\n    if (v_textureCoordinates.x < (1.0/256.0) || v_textureCoordinates.x > (255.0/256.0) ||\n        v_textureCoordinates.y < (1.0/256.0) || v_textureCoordinates.y > (255.0/256.0))\n    {\n        color = vec4(1.0, 0.0, 0.0, 1.0);\n    }\n#endif\n\n#if defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(HDR)\n    vec3 normalMC = czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0));   // normalized surface normal in model coordinates\n    vec3 normalEC = czm_normal3D * normalMC;                                         // normalized surface normal in eye coordiantes\n#endif\n\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\n    float cameraDist;\n    if (czm_sceneMode == czm_sceneMode2D)\n    {\n        cameraDist = max(czm_frustumPlanes.x - czm_frustumPlanes.y, czm_frustumPlanes.w - czm_frustumPlanes.z) * 0.5;\n    }\n    else if (czm_sceneMode == czm_sceneModeColumbusView)\n    {\n        cameraDist = -czm_view[3].z;\n    }\n    else\n    {\n        cameraDist = length(czm_view[3]);\n    }\n    float fadeOutDist = u_lightingFadeDistance.x;\n    float fadeInDist = u_lightingFadeDistance.y;\n    if (czm_sceneMode != czm_sceneMode3D) {\n        vec3 radii = czm_ellipsoidRadii;\n        float maxRadii = max(radii.x, max(radii.y, radii.z));\n        fadeOutDist -= maxRadii;\n        fadeInDist -= maxRadii;\n    }\n    float fade = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\n#else\n    float fade = 0.0;\n#endif\n\n#ifdef SHOW_REFLECTIVE_OCEAN\n    vec2 waterMaskTranslation = u_waterMaskTranslationAndScale.xy;\n    vec2 waterMaskScale = u_waterMaskTranslationAndScale.zw;\n    vec2 waterMaskTextureCoordinates = v_textureCoordinates.xy * waterMaskScale + waterMaskTranslation;\n    waterMaskTextureCoordinates.y = 1.0 - waterMaskTextureCoordinates.y;\n\n    float mask = texture2D(u_waterMask, waterMaskTextureCoordinates).r;\n\n    if (mask > 0.0)\n    {\n        mat3 enuToEye = czm_eastNorthUpToEyeCoordinates(v_positionMC, normalEC);\n\n        vec2 ellipsoidTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC);\n        vec2 ellipsoidFlippedTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC.zyx);\n\n        vec2 textureCoordinates = mix(ellipsoidTextureCoordinates, ellipsoidFlippedTextureCoordinates, czm_morphTime * smoothstep(0.9, 0.95, normalMC.z));\n\n        color = computeWaterColor(v_positionEC, textureCoordinates, enuToEye, color, mask, fade);\n    }\n#endif\n\n#ifdef APPLY_MATERIAL\n    czm_materialInput materialInput;\n    materialInput.st = v_textureCoordinates.st;\n    materialInput.normalEC = normalize(v_normalEC);\n    materialInput.slope = v_slope;\n    materialInput.height = v_height;\n    materialInput.aspect = v_aspect;\n    czm_material material = czm_getMaterial(materialInput);\n    color.xyz = mix(color.xyz, material.diffuse, material.alpha);\n#endif\n\n#ifdef ENABLE_VERTEX_LIGHTING\n    float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalize(v_normalEC)) * 0.9 + 0.3, 0.0, 1.0);\n    vec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);\n#elif defined(ENABLE_DAYNIGHT_SHADING)\n    float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * 5.0 + 0.3, 0.0, 1.0);\n    diffuseIntensity = mix(1.0, diffuseIntensity, fade);\n    vec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);\n#else\n    vec4 finalColor = color;\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\n    vec4 clippingPlanesEdgeColor = vec4(1.0);\n    clippingPlanesEdgeColor.rgb = u_clippingPlanesEdgeStyle.rgb;\n    float clippingPlanesEdgeWidth = u_clippingPlanesEdgeStyle.a;\n\n    if (clipDistance < clippingPlanesEdgeWidth)\n    {\n        finalColor = clippingPlanesEdgeColor;\n    }\n#endif\n\n#ifdef HIGHLIGHT_FILL_TILE\n    finalColor = vec4(mix(finalColor.rgb, u_fillHighlightColor.rgb, u_fillHighlightColor.a), finalColor.a);\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\n    vec3 fogColor = colorCorrect(v_fogMieColor) + finalColor.rgb * colorCorrect(v_fogRayleighColor);\n#ifndef HDR\n    const float fExposure = 2.0;\n    fogColor = vec3(1.0) - exp(-fExposure * fogColor);\n#endif\n#endif\n\n#if defined(DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN)\n    vec3 atmosphereLightDirection = czm_sunDirectionWC;\n#else\n    vec3 atmosphereLightDirection = czm_lightDirectionWC;\n#endif\n\n#ifdef FOG\n#if defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))\n    float darken = clamp(dot(normalize(czm_viewerPositionWC), atmosphereLightDirection), u_minimumBrightness, 1.0);\n    fogColor *= darken;\n#endif\n\n#ifdef HDR\n    const float modifier = 0.15;\n    finalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor, modifier), finalColor.a);\n#else\n    finalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor), finalColor.a);\n#endif\n#endif\n\n#ifdef GROUND_ATMOSPHERE\n    if (czm_sceneMode != czm_sceneMode3D)\n    {\n        gl_FragColor = finalColor;\n        return;\n    }\n\n#if defined(PER_FRAGMENT_GROUND_ATMOSPHERE) && defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_DAYNIGHT_SHADING) || defined(ENABLE_VERTEX_LIGHTING))\n    float mpp = czm_metersPerPixel(vec4(0.0, 0.0, -czm_currentFrustum.x, 1.0), 1.0);\n    vec2 xy = gl_FragCoord.xy / czm_viewport.zw * 2.0 - vec2(1.0);\n    xy *= czm_viewport.zw * mpp * 0.5;\n\n    vec3 direction = normalize(vec3(xy, -czm_currentFrustum.x));\n    czm_ray ray = czm_ray(vec3(0.0), direction);\n\n    vec3 ellipsoid_center = czm_view[3].xyz;\n\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center, czm_ellipsoidInverseRadii);\n\n    vec3 ellipsoidPosition = czm_pointAlongRay(ray, intersection.start);\n    ellipsoidPosition = (czm_inverseView * vec4(ellipsoidPosition, 1.0)).xyz;\n    AtmosphereColor atmosColor = computeGroundAtmosphereFromSpace(ellipsoidPosition, true, atmosphereLightDirection);\n\n    vec3 groundAtmosphereColor = colorCorrect(atmosColor.mie) + finalColor.rgb * colorCorrect(atmosColor.rayleigh);\n#ifndef HDR\n    groundAtmosphereColor = vec3(1.0) - exp(-fExposure * groundAtmosphereColor);\n#endif\n\n    fadeInDist = u_nightFadeDistance.x;\n    fadeOutDist = u_nightFadeDistance.y;\n\n    float sunlitAtmosphereIntensity = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\n\n#ifdef HDR\n    // Some tweaking to make HDR look better\n    sunlitAtmosphereIntensity = max(sunlitAtmosphereIntensity * sunlitAtmosphereIntensity, 0.03);\n#endif\n\n    groundAtmosphereColor = mix(groundAtmosphereColor, fogColor, sunlitAtmosphereIntensity);\n#else\n    vec3 groundAtmosphereColor = fogColor;\n#endif\n\n#ifdef HDR\n    // Some tweaking to make HDR look better\n    groundAtmosphereColor = czm_saturation(groundAtmosphereColor, 1.6);\n#endif\n\n    finalColor = vec4(mix(finalColor.rgb, groundAtmosphereColor, fade), finalColor.a);\n#endif\n\n    gl_FragColor = finalColor;\n}\n\n#ifdef SHOW_REFLECTIVE_OCEAN\n\nfloat waveFade(float edge0, float edge1, float x)\n{\n    float y = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n    return pow(1.0 - y, 5.0);\n}\n\nfloat linearFade(float edge0, float edge1, float x)\n{\n    return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n}\n\n// Based on water rendering by Jonas Wagner:\n// http://29a.ch/2012/7/19/webgl-terrain-rendering-water-fog\n\n// low altitude wave settings\nconst float oceanFrequencyLowAltitude = 825000.0;\nconst float oceanAnimationSpeedLowAltitude = 0.004;\nconst float oceanOneOverAmplitudeLowAltitude = 1.0 / 2.0;\nconst float oceanSpecularIntensity = 0.5;\n\n// high altitude wave settings\nconst float oceanFrequencyHighAltitude = 125000.0;\nconst float oceanAnimationSpeedHighAltitude = 0.008;\nconst float oceanOneOverAmplitudeHighAltitude = 1.0 / 2.0;\n\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float maskValue, float fade)\n{\n    vec3 positionToEyeEC = -positionEyeCoordinates;\n    float positionToEyeECLength = length(positionToEyeEC);\n\n    // The double normalize below works around a bug in Firefox on Android devices.\n    vec3 normalizedPositionToEyeEC = normalize(normalize(positionToEyeEC));\n\n    // Fade out the waves as the camera moves far from the surface.\n    float waveIntensity = waveFade(70000.0, 1000000.0, positionToEyeECLength);\n\n#ifdef SHOW_OCEAN_WAVES\n    // high altitude waves\n    float time = czm_frameNumber * oceanAnimationSpeedHighAltitude;\n    vec4 noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyHighAltitude, time, 0.0);\n    vec3 normalTangentSpaceHighAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeHighAltitude);\n\n    // low altitude waves\n    time = czm_frameNumber * oceanAnimationSpeedLowAltitude;\n    noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyLowAltitude, time, 0.0);\n    vec3 normalTangentSpaceLowAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeLowAltitude);\n\n    // blend the 2 wave layers based on distance to surface\n    float highAltitudeFade = linearFade(0.0, 60000.0, positionToEyeECLength);\n    float lowAltitudeFade = 1.0 - linearFade(20000.0, 60000.0, positionToEyeECLength);\n    vec3 normalTangentSpace =\n        (highAltitudeFade * normalTangentSpaceHighAltitude) +\n        (lowAltitudeFade * normalTangentSpaceLowAltitude);\n    normalTangentSpace = normalize(normalTangentSpace);\n\n    // fade out the normal perturbation as we move farther from the water surface\n    normalTangentSpace.xy *= waveIntensity;\n    normalTangentSpace = normalize(normalTangentSpace);\n#else\n    vec3 normalTangentSpace = vec3(0.0, 0.0, 1.0);\n#endif\n\n    vec3 normalEC = enuToEye * normalTangentSpace;\n\n    const vec3 waveHighlightColor = vec3(0.3, 0.45, 0.6);\n\n    // Use diffuse light to highlight the waves\n    float diffuseIntensity = czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * maskValue;\n    vec3 diffuseHighlight = waveHighlightColor * diffuseIntensity * (1.0 - fade);\n\n#ifdef SHOW_OCEAN_WAVES\n    // Where diffuse light is low or non-existent, use wave highlights based solely on\n    // the wave bumpiness and no particular light direction.\n    float tsPerturbationRatio = normalTangentSpace.z;\n    vec3 nonDiffuseHighlight = mix(waveHighlightColor * 5.0 * (1.0 - tsPerturbationRatio), vec3(0.0), diffuseIntensity);\n#else\n    vec3 nonDiffuseHighlight = vec3(0.0);\n#endif\n\n    // Add specular highlights in 3D, and in all modes when zoomed in.\n    float specularIntensity = czm_getSpecular(czm_lightDirectionEC, normalizedPositionToEyeEC, normalEC, 10.0);\n    float surfaceReflectance = mix(0.0, mix(u_zoomedOutOceanSpecularIntensity, oceanSpecularIntensity, waveIntensity), maskValue);\n    float specular = specularIntensity * surfaceReflectance;\n\n#ifdef HDR\n    specular *= 1.4;\n\n    float e = 0.2;\n    float d = 3.3;\n    float c = 1.7;\n\n    vec3 color = imageryColor.rgb + (c * (vec3(e) + imageryColor.rgb * d) * (diffuseHighlight + nonDiffuseHighlight + specular));\n#else\n    vec3 color = imageryColor.rgb + diffuseHighlight + nonDiffuseHighlight + specular;\n#endif\n\n    return vec4(color, imageryColor.a);\n}\n\n#endif // #ifdef SHOW_REFLECTIVE_OCEAN\n",S="#ifdef QUANTIZATION_BITS12\nattribute vec4 compressed0;\nattribute float compressed1;\n#else\nattribute vec4 position3DAndHeight;\nattribute vec4 textureCoordAndEncodedNormals;\n#endif\n\nuniform vec3 u_center3D;\nuniform mat4 u_modifiedModelView;\nuniform mat4 u_modifiedModelViewProjection;\nuniform vec4 u_tileRectangle;\n\n// Uniforms for 2D Mercator projection\nuniform vec2 u_southAndNorthLatitude;\nuniform vec2 u_southMercatorYAndOneOverHeight;\n\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\n\nvarying vec3 v_textureCoordinates;\nvarying vec3 v_normalMC;\nvarying vec3 v_normalEC;\n\n#ifdef APPLY_MATERIAL\nvarying float v_slope;\nvarying float v_aspect;\nvarying float v_height;\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nvarying float v_distance;\nvarying vec3 v_fogMieColor;\nvarying vec3 v_fogRayleighColor;\n#endif\n\n// These functions are generated at runtime.\nvec4 getPosition(vec3 position, float height, vec2 textureCoordinates);\nfloat get2DYPositionFraction(vec2 textureCoordinates);\n\nvec4 getPosition3DMode(vec3 position, float height, vec2 textureCoordinates)\n{\n    return u_modifiedModelViewProjection * vec4(position, 1.0);\n}\n\nfloat get2DMercatorYPositionFraction(vec2 textureCoordinates)\n{\n    // The width of a tile at level 11, in radians and assuming a single root tile, is\n    //   2.0 * czm_pi / pow(2.0, 11.0)\n    // We want to just linearly interpolate the 2D position from the texture coordinates\n    // when we're at this level or higher.  The constant below is the expression\n    // above evaluated and then rounded up at the 4th significant digit.\n    const float maxTileWidth = 0.003068;\n    float positionFraction = textureCoordinates.y;\n    float southLatitude = u_southAndNorthLatitude.x;\n    float northLatitude = u_southAndNorthLatitude.y;\n    if (northLatitude - southLatitude > maxTileWidth)\n    {\n        float southMercatorY = u_southMercatorYAndOneOverHeight.x;\n        float oneOverMercatorHeight = u_southMercatorYAndOneOverHeight.y;\n\n        float currentLatitude = mix(southLatitude, northLatitude, textureCoordinates.y);\n        currentLatitude = clamp(currentLatitude, -czm_webMercatorMaxLatitude, czm_webMercatorMaxLatitude);\n        positionFraction = czm_latitudeToWebMercatorFraction(currentLatitude, southMercatorY, oneOverMercatorHeight);\n    }\n    return positionFraction;\n}\n\nfloat get2DGeographicYPositionFraction(vec2 textureCoordinates)\n{\n    return textureCoordinates.y;\n}\n\nvec4 getPositionPlanarEarth(vec3 position, float height, vec2 textureCoordinates)\n{\n    float yPositionFraction = get2DYPositionFraction(textureCoordinates);\n    vec4 rtcPosition2D = vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);\n    return u_modifiedModelViewProjection * rtcPosition2D;\n}\n\nvec4 getPosition2DMode(vec3 position, float height, vec2 textureCoordinates)\n{\n    return getPositionPlanarEarth(position, 0.0, textureCoordinates);\n}\n\nvec4 getPositionColumbusViewMode(vec3 position, float height, vec2 textureCoordinates)\n{\n    return getPositionPlanarEarth(position, height, textureCoordinates);\n}\n\nvec4 getPositionMorphingMode(vec3 position, float height, vec2 textureCoordinates)\n{\n    // We do not do RTC while morphing, so there is potential for jitter.\n    // This is unlikely to be noticeable, though.\n    vec3 position3DWC = position + u_center3D;\n    float yPositionFraction = get2DYPositionFraction(textureCoordinates);\n    vec4 position2DWC = vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);\n    vec4 morphPosition = czm_columbusViewMorph(position2DWC, vec4(position3DWC, 1.0), czm_morphTime);\n    return czm_modelViewProjection * morphPosition;\n}\n\n#ifdef QUANTIZATION_BITS12\nuniform vec2 u_minMaxHeight;\nuniform mat4 u_scaleAndBias;\n#endif\n\nvoid main()\n{\n#ifdef QUANTIZATION_BITS12\n    vec2 xy = czm_decompressTextureCoordinates(compressed0.x);\n    vec2 zh = czm_decompressTextureCoordinates(compressed0.y);\n    vec3 position = vec3(xy, zh.x);\n    float height = zh.y;\n    vec2 textureCoordinates = czm_decompressTextureCoordinates(compressed0.z);\n\n    height = height * (u_minMaxHeight.y - u_minMaxHeight.x) + u_minMaxHeight.x;\n    position = (u_scaleAndBias * vec4(position, 1.0)).xyz;\n\n#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)) && defined(INCLUDE_WEB_MERCATOR_Y)\n    float webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;\n    float encodedNormal = compressed1;\n#elif defined(INCLUDE_WEB_MERCATOR_Y)\n    float webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;\n    float encodedNormal = 0.0;\n#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)\n    float webMercatorT = textureCoordinates.y;\n    float encodedNormal = compressed0.w;\n#else\n    float webMercatorT = textureCoordinates.y;\n    float encodedNormal = 0.0;\n#endif\n\n#else\n    // A single float per element\n    vec3 position = position3DAndHeight.xyz;\n    float height = position3DAndHeight.w;\n    vec2 textureCoordinates = textureCoordAndEncodedNormals.xy;\n\n#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)) && defined(INCLUDE_WEB_MERCATOR_Y)\n    float webMercatorT = textureCoordAndEncodedNormals.z;\n    float encodedNormal = textureCoordAndEncodedNormals.w;\n#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)\n    float webMercatorT = textureCoordinates.y;\n    float encodedNormal = textureCoordAndEncodedNormals.z;\n#elif defined(INCLUDE_WEB_MERCATOR_Y)\n    float webMercatorT = textureCoordAndEncodedNormals.z;\n    float encodedNormal = 0.0;\n#else\n    float webMercatorT = textureCoordinates.y;\n    float encodedNormal = 0.0;\n#endif\n\n#endif\n\n    vec3 position3DWC = position + u_center3D;\n    gl_Position = getPosition(position, height, textureCoordinates);\n\n    v_textureCoordinates = vec3(textureCoordinates, webMercatorT);\n\n#if defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)\n    v_positionEC = (u_modifiedModelView * vec4(position, 1.0)).xyz;\n    v_positionMC = position3DWC;  // position in model coordinates\n    vec3 normalMC = czm_octDecode(encodedNormal);\n    v_normalMC = normalMC;\n    v_normalEC = czm_normal3D * v_normalMC;\n#elif defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(GENERATE_POSITION) || defined(HDR)\n    v_positionEC = (u_modifiedModelView * vec4(position, 1.0)).xyz;\n    v_positionMC = position3DWC;  // position in model coordinates\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\n    AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(position3DWC, false, vec3(0.0));\n    v_fogMieColor = atmosFogColor.mie;\n    v_fogRayleighColor = atmosFogColor.rayleigh;\n    v_distance = length((czm_modelView3D * vec4(position3DWC, 1.0)).xyz);\n#endif\n\n#ifdef APPLY_MATERIAL\n    float northPoleZ = czm_ellipsoidRadii.z;\n    vec3 northPolePositionMC = vec3(0.0, 0.0, northPoleZ);\n    vec3 ellipsoidNormal = normalize(v_positionMC); // For a sphere this is correct, but not generally for an ellipsoid.\n    vec3 vectorEastMC = normalize(cross(northPolePositionMC - v_positionMC, ellipsoidNormal));\n    float dotProd = abs(dot(ellipsoidNormal, v_normalMC));\n    v_slope = acos(dotProd);\n    vec3 normalRejected = ellipsoidNormal * dotProd;\n    vec3 normalProjected = v_normalMC - normalRejected;\n    vec3 aspectVector = normalize(normalProjected);\n    v_aspect = acos(dot(aspectVector, vectorEastMC));\n    float determ = dot(cross(vectorEastMC, aspectVector), ellipsoidNormal);\n    v_aspect = czm_branchFreeTernary(determ < 0.0, 2.0 * czm_pi - v_aspect, v_aspect);\n    v_height = height;\n#endif\n}\n",D="/*!\n * Atmosphere code:\n *\n * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * * Redistributions of source code must retain the above copyright notice,\n *   this list of conditions and the following disclaimer.\n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * * Neither the name of the project nor the names of its contributors may be\n *   used to endorse or promote products derived from this software without\n *   specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * Modifications made by Analytical Graphics, Inc.\n */\n\n // Atmosphere:\n //   Code:  http://sponeil.net/\n //   GPU Gems 2 Article:  https://developer.nvidia.com/gpugems/GPUGems2/gpugems2_chapter16.html\n\nconst float Kr = 0.0025;\nconst float Km = 0.0015;\nconst float ESun = 15.0;\n\nconst float fKrESun = Kr * ESun;\nconst float fKmESun = Km * ESun;\nconst float fKr4PI = Kr * 4.0 * czm_pi;\nconst float fKm4PI = Km * 4.0 * czm_pi;\n\n// Original: vec3(1.0 / pow(0.650, 4.0), 1.0 / pow(0.570, 4.0), 1.0 / pow(0.475, 4.0));\nconst vec3 v3InvWavelength = vec3(5.60204474633241, 9.473284437923038, 19.64380261047721);\n\nconst float fScaleDepth = 0.25;\n\nstruct AtmosphereColor\n{\n    vec3 mie;\n    vec3 rayleigh;\n};\n\nconst int nSamples = 2;\nconst float fSamples = 2.0;\n\nfloat scale(float fCos)\n{\n    float x = 1.0 - fCos;\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nAtmosphereColor computeGroundAtmosphereFromSpace(vec3 v3Pos, bool dynamicLighting, vec3 lightDirectionWC)\n{\n    float fInnerRadius = czm_ellipsoidRadii.x;\n    float fOuterRadius = czm_ellipsoidRadii.x * 1.025;\n    float fOuterRadius2 = fOuterRadius * fOuterRadius;\n\n    float fScale = 1.0 / (fOuterRadius - fInnerRadius);\n    float fScaleOverScaleDepth = fScale / fScaleDepth;\n\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 v3Ray = v3Pos - czm_viewerPositionWC;\n    float fFar = length(v3Ray);\n    v3Ray /= fFar;\n\n    float fCameraHeight = length(czm_viewerPositionWC);\n    float fCameraHeight2 = fCameraHeight * fCameraHeight;\n\n    // This next line is an ANGLE workaround. It is equivalent to B = 2.0 * dot(czm_viewerPositionWC, v3Ray),\n    // which is what it should be, but there are problems at the poles.\n    float B = 2.0 * length(czm_viewerPositionWC) * dot(normalize(czm_viewerPositionWC), v3Ray);\n    float C = fCameraHeight2 - fOuterRadius2;\n    float fDet = max(0.0, B*B - 4.0 * C);\n    float fNear = 0.5 * (-B - sqrt(fDet));\n\n    // Calculate the ray's starting position, then calculate its scattering offset\n    vec3 v3Start = czm_viewerPositionWC + v3Ray * fNear;\n    fFar -= fNear;\n    float fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);\n\n    // The light angle based on the scene's light source would be:\n    //    dot(lightDirectionWC, v3Pos) / length(v3Pos);\n    // When we want the atmosphere to be uniform over the globe so it is set to 1.0.\n\n    float fLightAngle = czm_branchFreeTernary(dynamicLighting, dot(lightDirectionWC, v3Pos) / length(v3Pos), 1.0);\n    float fCameraAngle = dot(-v3Ray, v3Pos) / length(v3Pos);\n    float fCameraScale = scale(fCameraAngle);\n    float fLightScale = scale(fLightAngle);\n    float fCameraOffset = fDepth*fCameraScale;\n    float fTemp = (fLightScale + fCameraScale);\n\n    // Initialize the scattering loop variables\n    float fSampleLength = fFar / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = v3Ray * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n    // Now loop through the sample rays\n    vec3 v3FrontColor = vec3(0.0);\n    vec3 v3Attenuate = vec3(0.0);\n    for(int i=0; i<nSamples; i++)\n    {\n        float fHeight = length(v3SamplePoint);\n        float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n        float fScatter = fDepth*fTemp - fCameraOffset;\n        v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n        v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n        v3SamplePoint += v3SampleRay;\n    }\n\n    AtmosphereColor color;\n    color.mie = v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);\n    color.rayleigh = v3Attenuate; // Calculate the attenuation factor for the ground\n\n    return color;\n}\n\n",I=i(16),M=i(452),F=i(76),R=i(448),N=i(44);function L(e,t,i,a,r){this.numberOfDayTextures=e,this.flags=t,this.material=i,this.shaderProgram=a,this.clippingShaderState=r}function j(){this.baseVertexShaderSource=void 0,this.baseFragmentShaderSource=void 0,this._shadersByTexturesFlags=[],this.material=void 0}j.prototype.getShaderProgram=function(e){var t=e.frameState,i=e.surfaceTile,a=e.numberOfDayTextures,r=e.applyBrightness,n=e.applyContrast,s=e.applyHue,l=e.applySaturation,u=e.applyGamma,d=e.applyAlpha,f=e.applySplit,c=e.showReflectiveOcean,h=e.showOceanWaves,m=e.enableLighting,p=e.dynamicAtmosphereLighting,_=e.dynamicAtmosphereLightingFromSun,g=e.showGroundAtmosphere,v=e.perFragmentGroundAtmosphere,y=e.hasVertexNormals,b=e.useWebMercatorProjection,w=e.enableFog,x=e.enableClippingPlanes,O=e.clippingPlanes,C=e.clippedByBoundaries,T=e.splitTerrain,E=e.hasImageryLayerCutout,P=e.colorCorrect,A=e.highlightFillTile,S=e.colorToAlpha,D=0,I="",j=i.renderedMesh.encoding;j.quantization===M.a.BITS12&&(D=1,I="QUANTIZATION_BITS12");var V=0,U="";C&&(V=1,U="TILE_LIMIT_RECTANGLE");var z=0,B="";E&&(z=1,B="APPLY_IMAGERY_CUTOUT");var H=t.mode,k=H|r<<2|n<<3|s<<4|l<<5|u<<6|d<<7|c<<8|h<<9|m<<10|p<<11|_<<12|g<<13|v<<14|y<<15|b<<16|w<<17|D<<18|f<<19|x<<20|V<<21|z<<22|P<<23|A<<24|S<<25|T<<26,W=0;Object(o.default)(O)&&O.length>0&&(W=x?O.clippingPlanesState:0);var G=i.surfaceShader;if(Object(o.default)(G)&&G.numberOfDayTextures===a&&G.flags===k&&G.material===this.material&&G.clippingShaderState===W)return G.shaderProgram;var Y=this._shadersByTexturesFlags[a];if(Object(o.default)(Y)||(Y=this._shadersByTexturesFlags[a]=[]),G=Y[k],!Object(o.default)(G)||G.material!==this.material||G.clippingShaderState!==W){var X=this.baseVertexShaderSource.clone(),Q=this.baseFragmentShaderSource.clone();0!==W&&Q.sources.unshift(Object(R.a)(O,t.context)),X.defines.push(I),Q.defines.push("TEXTURE_UNITS "+a,U,B),r&&Q.defines.push("APPLY_BRIGHTNESS"),n&&Q.defines.push("APPLY_CONTRAST"),s&&Q.defines.push("APPLY_HUE"),l&&Q.defines.push("APPLY_SATURATION"),u&&Q.defines.push("APPLY_GAMMA"),d&&Q.defines.push("APPLY_ALPHA"),c&&(Q.defines.push("SHOW_REFLECTIVE_OCEAN"),X.defines.push("SHOW_REFLECTIVE_OCEAN")),h&&Q.defines.push("SHOW_OCEAN_WAVES"),S&&Q.defines.push("APPLY_COLOR_TO_ALPHA"),m&&(y?(X.defines.push("ENABLE_VERTEX_LIGHTING"),Q.defines.push("ENABLE_VERTEX_LIGHTING")):(X.defines.push("ENABLE_DAYNIGHT_SHADING"),Q.defines.push("ENABLE_DAYNIGHT_SHADING"))),p&&(Q.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING"),_&&Q.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN")),g&&(X.defines.push("GROUND_ATMOSPHERE"),Q.defines.push("GROUND_ATMOSPHERE"),v&&Q.defines.push("PER_FRAGMENT_GROUND_ATMOSPHERE")),X.defines.push("INCLUDE_WEB_MERCATOR_Y"),Q.defines.push("INCLUDE_WEB_MERCATOR_Y"),w&&(X.defines.push("FOG"),Q.defines.push("FOG")),f&&Q.defines.push("APPLY_SPLIT"),x&&Q.defines.push("ENABLE_CLIPPING_PLANES"),T&&Q.defines.push("SPLIT_TERRAIN"),P&&Q.defines.push("COLOR_CORRECT"),A&&Q.defines.push("HIGHLIGHT_FILL_TILE");var q="    vec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates)\n    {\n        vec4 color = initialColor;\n";E&&(q+="        vec4 cutoutAndColorResult;\n        bool texelUnclipped;\n");for(var Z=0;Z<a;++Z)q+=E?"        cutoutAndColorResult = u_dayTextureCutoutRectangles["+Z+"];\n        texelUnclipped = v_textureCoordinates.x < cutoutAndColorResult.x || cutoutAndColorResult.z < v_textureCoordinates.x || v_textureCoordinates.y < cutoutAndColorResult.y || cutoutAndColorResult.w < v_textureCoordinates.y;\n        cutoutAndColorResult = sampleAndBlend(\n":"        color = sampleAndBlend(\n",q+="            color,\n            u_dayTextures["+Z+"],\n            u_dayTextureUseWebMercatorT["+Z+"] ? textureCoordinates.xz : textureCoordinates.xy,\n            u_dayTextureTexCoordsRectangle["+Z+"],\n            u_dayTextureTranslationAndScale["+Z+"],\n            "+(d?"u_dayTextureAlpha["+Z+"]":"1.0")+",\n            "+(r?"u_dayTextureBrightness["+Z+"]":"0.0")+",\n            "+(n?"u_dayTextureContrast["+Z+"]":"0.0")+",\n            "+(s?"u_dayTextureHue["+Z+"]":"0.0")+",\n            "+(l?"u_dayTextureSaturation["+Z+"]":"0.0")+",\n            "+(u?"u_dayTextureOneOverGamma["+Z+"]":"0.0")+",\n            "+(f?"u_dayTextureSplit["+Z+"]":"0.0")+",\n            "+(S?"u_colorsToAlpha["+Z+"]":"vec4(0.0)")+"\n        );\n",E&&(q+="        color = czm_branchFreeTernary(texelUnclipped, cutoutAndColorResult, color);\n");q+="        return color;\n    }",Q.sources.push(q),X.sources.push(function(e){var t;switch(e){case N.a.SCENE3D:t="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPosition3DMode(position, height, textureCoordinates); }";break;case N.a.SCENE2D:case N.a.COLUMBUS_VIEW:t="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionColumbusViewMode(position, height, textureCoordinates); }";break;case N.a.MORPHING:t="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionMorphingMode(position, height, textureCoordinates); }"}return t}(H)),X.sources.push(function(e){return e?"float get2DYPositionFraction(vec2 textureCoordinates) { return get2DMercatorYPositionFraction(textureCoordinates); }":"float get2DYPositionFraction(vec2 textureCoordinates) { return get2DGeographicYPositionFraction(textureCoordinates); }"}(b));var K=F.a.fromCache({context:t.context,vertexShaderSource:X,fragmentShaderSource:Q,attributeLocations:j.getAttributeLocations()});G=Y[k]=new L(a,k,this.material,K,W)}return i.surfaceShader=G,G.shaderProgram},j.prototype.destroy=function(){var e,t,i=this._shadersByTexturesFlags;for(var a in i)if(i.hasOwnProperty(a)){var r=i[a];if(!Object(o.default)(r))continue;for(e in r)r.hasOwnProperty(e)&&(t=r[e],Object(o.default)(t)&&t.shaderProgram.destroy())}return Object(s.default)(this)};var V=j,U=i(340),z=i(24),B=i(48),H=i(40),k=i(21),W=i(68),G=i(56),Y=i(63),X=i(119),Q=i(49),q=i(91),Z=i(14),K=i(28),J=i(115),$=i(105),ee=i(45),te=i(451),ie=Object.freeze({NONE:-1,PARTIAL:0,FULL:1}),ae=i(158),re=i(104),ne=i(75),oe=i(83),se=i(66),le=i(67),ue=i(57),de=i(92),fe=i(84),ce=i(377),he=i(266),me=i(60),pe=i(221),_e=i(222),ge=i(172),ve=i(161),ye=i(65),be=i(89),we=i(162),xe=i(151),Oe=i(204),Ce=i(268),Te=Object.freeze({START:0,LOADING:1,DONE:2,FAILED:3}),Ee=Object.freeze({FAILED:0,UNLOADED:1,RECEIVING:2,RECEIVED:3,TRANSFORMING:4,TRANSFORMED:5,READY:6});function Pe(){this.imagery=[],this.waterMaskTexture=void 0,this.waterMaskTranslationAndScale=new B.a(0,0,1,1),this.terrainData=void 0,this.vertexArray=void 0,this.orientedBoundingBox=void 0,this.boundingVolumeSourceTile=void 0,this.tileBoundingRegion=void 0,this.occludeePointInScaledSpace=new a.default,this.terrainState=Ee.UNLOADED,this.mesh=void 0,this.fill=void 0,this.pickBoundingSphere=new g.default,this.surfaceShader=void 0,this.isClipped=!0,this.clippedByBoundaries=!1}function Ae(e,t,i,r,n,s){if(e.decodePosition(r,n,s),Object(o.default)(t)&&t!==N.a.SCENE3D){var l=i.ellipsoid.cartesianToCartographic(s);i.project(l,s),a.default.fromElements(s.z,s.x,s.y,s)}return s}Object.defineProperties(Pe.prototype,{eligibleForUnloading:{get:function(){for(var e=this.terrainState,t=!(e===Ee.RECEIVING||e===Ee.TRANSFORMING),i=this.imagery,a=0,r=i.length;t&&a<r;++a){var n=i[a];t=!Object(o.default)(n.loadingImagery)||n.loadingImagery.state!==Ce.a.TRANSITIONING}return t}},renderedMesh:{get:function(){return Object(o.default)(this.vertexArray)?this.mesh:Object(o.default)(this.fill)?this.fill.mesh:void 0}}});var Se=new a.default,De=new a.default,Ie=new a.default,Me=new a.default;Pe.prototype.pick=function(e,t,i,a,r){var n=this.renderedMesh;if(Object(o.default)(n)){for(var s=n.vertices,l=n.indices,u=n.encoding,d=l.length,f=Number.MAX_VALUE,c=0;c<d;c+=3){var h=l[c],m=l[c+1],p=l[c+2],_=Ae(u,t,i,s,h,Se),g=Ae(u,t,i,s,m,De),v=Ae(u,t,i,s,p,Ie),y=x.default.rayTriangleParametric(e,_,g,v,a);Object(o.default)(y)&&y<f&&y>=0&&(f=y)}return f!==Number.MAX_VALUE?O.default.getPoint(e,f,r):void 0}},Pe.prototype.pickTriangle=function(e,t,i,a){var r=this.renderedMesh;if(Object(o.default)(r))for(var n=r.vertices,s=r.indices,l=r.encoding,u=s.length,d=0;d<u;d+=3){var f=s[d],c=s[d+1],h=s[d+2],m=Ae(l,t,i,n,f,Se),p=Ae(l,t,i,n,c,De),_=Ae(l,t,i,n,h,Ie),g=x.default.rayTriangle(e,m,p,_,a,Me);if(Object(o.default)(g))return{intersection:g,v0:m,v1:p,v2:_}}},Pe.prototype.freeResources=function(){Object(o.default)(this.waterMaskTexture)&&(--this.waterMaskTexture.referenceCount,0===this.waterMaskTexture.referenceCount&&this.waterMaskTexture.destroy(),this.waterMaskTexture=void 0),this.terrainData=void 0,this.terrainState=Ee.UNLOADED,this.mesh=void 0,this.fill=this.fill&&this.fill.destroy();for(var e=this.imagery,t=0,i=e.length;t<i;++t)e[t].freeResources();this.imagery.length=0,this.freeVertexArray()},Pe.prototype.freeVertexArray=function(){Pe._freeVertexArray(this.vertexArray),this.vertexArray=void 0,Pe._freeVertexArray(this.wireframeVertexArray),this.wireframeVertexArray=void 0},Pe.initialize=function(e,t,i){var a=e.data;Object(o.default)(a)||(a=e.data=new Pe),e.state===Te.START&&(!function(e,t,i){var a=t.getTileDataAvailable(e.x,e.y,e.level);if(!Object(o.default)(a)&&Object(o.default)(e.parent)){var r=e.parent,n=r.data;Object(o.default)(n)&&Object(o.default)(n.terrainData)&&(a=n.terrainData.isChildAvailable(r.x,r.y,e.x,e.y))}!1===a&&(e.data.terrainState=Ee.FAILED);for(var s=0,l=i.length;s<l;++s){var u=i.get(s);u.show&&u._createTileImagerySkeletons(e,t)}}(e,t,i),e.state=Te.LOADING)},Pe.processStateMachine=function(e,t,i,r,n,s){Pe.initialize(e,i,r);var l=e.data;if(e.state===Te.LOADING&&function(e,t,i,r,n){var s=e.data,l=e.parent;if(s.terrainState===Ee.FAILED&&void 0!==l){void 0!==l.data&&void 0!==l.data.terrainData&&!1!==l.data.terrainData.canUpsample||Pe.processStateMachine(l,t,i,r,!0)}s.terrainState===Ee.FAILED&&function(e,t,i,a,r,n,s){var l=t.parent;if(!l)return void(t.state=Te.FAILED);var u=l.data.terrainData,d=l.x,f=l.y,c=l.level;if(!Object(o.default)(u))return;var h=u.upsample(a.tilingScheme,d,f,c,r,n,s);if(!Object(o.default)(h))return;e.terrainState=Ee.RECEIVING,Object(I.default)(h,(function(t){e.terrainData=t,e.terrainState=Ee.RECEIVED}),(function(){e.terrainState=Ee.FAILED}))}(s,e,0,i,e.x,e.y,e.level);s.terrainState===Ee.UNLOADED&&function(e,t,i,a,r){function n(t){e.terrainData=t,e.terrainState=Ee.RECEIVED,e.request=void 0}function s(){if(e.request.state===_e.a.CANCELLED)return e.terrainData=void 0,e.terrainState=Ee.UNLOADED,void(e.request=void 0);e.terrainState=Ee.FAILED,e.request=void 0;var n="Failed to obtain terrain tile X: "+i+" Y: "+a+" Level: "+r+".";t._requestError=ve.default.handleError(t._requestError,t,t.errorEvent,n,i,a,r,l)}function l(){var l=new pe.a({throttle:!1,throttleByServer:!0,type:ge.a.TERRAIN});e.request=l;var u=t.requestTileGeometry(i,a,r,l);Object(o.default)(u)?(e.terrainState=Ee.RECEIVING,Object(I.default)(u,n,s)):(e.terrainState=Ee.UNLOADED,e.request=void 0)}l()}(s,i,e.x,e.y,e.level);s.terrainState===Ee.RECEIVED&&function(e,t,i,r,n,s){var l=i.tilingScheme,u=e.terrainData.createMesh(l,r,n,s,t.terrainExaggeration);if(!Object(o.default)(u))return;e.terrainState=Ee.TRANSFORMING,Object(I.default)(u,(function(t){e.mesh=t,e.orientedBoundingBox=J.a.clone(t.orientedBoundingBox,e.orientedBoundingBox),e.occludeePointInScaledSpace=a.default.clone(t.occludeePointInScaledSpace,e.occludeePointInScaledSpace),e.terrainState=Ee.TRANSFORMED}),(function(){e.terrainState=Ee.FAILED}))}(s,t,i,e.x,e.y,e.level);s.terrainState===Ee.TRANSFORMED&&function(e,t,i,a,r,n,o){e.vertexArray=Pe._createVertexArrayForMesh(t,e.mesh),e.terrainState=Ee.READY,e.fill=e.fill&&e.fill.destroy(o)}(s,t.context,0,e.x,e.y,e.level,n);if(s.terrainState>=Ee.RECEIVED&&void 0===s.waterMaskTexture&&i.hasWaterMask){if(void 0!==s.terrainData.waterMask)!function(e,t){var i,a=t.terrainData.waterMask,r=function(e){var t=e.cache.tile_waterMaskData;if(!Object(o.default)(t)){var i=P.a.create({context:e,pixelFormat:me.a.LUMINANCE,pixelDatatype:ye.a.UNSIGNED_BYTE,source:{arrayBufferView:new Uint8Array([255]),width:1,height:1}});i.referenceCount=1;var a=new be.a({wrapS:Oe.a.CLAMP_TO_EDGE,wrapT:Oe.a.CLAMP_TO_EDGE,minificationFilter:xe.a.LINEAR,magnificationFilter:we.a.LINEAR});t={allWaterTexture:i,sampler:a,destroy:function(){this.allWaterTexture.destroy()}},e.cache.tile_waterMaskData=t}return t}(e),n=a.length;if(1===n){if(0===a[0])return;i=r.allWaterTexture}else{var s=Math.sqrt(n);(i=P.a.create({context:e,pixelFormat:me.a.LUMINANCE,pixelDatatype:ye.a.UNSIGNED_BYTE,source:{width:s,height:s,arrayBufferView:a},sampler:r.sampler,flipY:!1})).referenceCount=0}++i.referenceCount,t.waterMaskTexture=i,B.a.fromElements(0,0,1,1,t.waterMaskTranslationAndScale)}(t.context,s);else{var u=s._findAncestorTileWithTerrainData(e);Object(o.default)(u)&&Object(o.default)(u.data.waterMaskTexture)&&(s.waterMaskTexture=u.data.waterMaskTexture,++s.waterMaskTexture.referenceCount,s._computeWaterMaskTranslationAndScale(e,u,s.waterMaskTranslationAndScale))}}}(e,t,i,r,n),!s){var u=e.renderable;e.renderable=Object(o.default)(l.vertexArray);var d=l.terrainState===Ee.READY;e.upsampledFromParent=Object(o.default)(l.terrainData)&&l.terrainData.wasCreatedByUpsampling();var f=l.processImagery(e,i,t);if(d&&f){var c=e._loadedCallbacks,h={};for(var m in c)c.hasOwnProperty(m)&&(c[m](e)||(h[m]=c[m]));e._loadedCallbacks=h,e.state=Te.DONE}u&&(e.renderable=!0)}},Pe.prototype.processImagery=function(e,t,i,a){var r,n,s=e.data,l=e.upsampledFromParent,u=!1,d=!0,f=s.imagery;for(r=0,n=f.length;r<n;++r){var c=f[r];if(Object(o.default)(c.loadingImagery)){if(c.loadingImagery.state===Ce.a.PLACEHOLDER){var h=c.loadingImagery.imageryLayer;if(h.imageryProvider.ready){c.freeResources(),f.splice(r,1),h._createTileImagerySkeletons(e,t,r),--r,n=f.length;continue}l=!1}var m=c.processStateMachine(e,i,a);d=d&&m,u=u||m||Object(o.default)(c.readyImagery),l=l&&Object(o.default)(c.loadingImagery)&&(c.loadingImagery.state===Ce.a.FAILED||c.loadingImagery.state===Ce.a.INVALID)}else l=!1}return e.upsampledFromParent=l,e.renderable=e.renderable&&(u||d),d},Pe._createVertexArrayForMesh=function(e,t){var i=t.vertices,a=re.a.createVertexBuffer({context:e,typedArray:i,usage:ne.a.STATIC_DRAW}),r=t.encoding.getAttributes(a),n=t.indices.indexBuffers||{},s=n[e.id];if(!Object(o.default)(s)||s.isDestroyed()){var l=t.indices;(s=re.a.createIndexBuffer({context:e,typedArray:l,usage:ne.a.STATIC_DRAW,indexDatatype:Q.a.fromSizeInBytes(l.BYTES_PER_ELEMENT)})).vertexArrayDestroyable=!1,s.referenceCount=1,n[e.id]=s,t.indices.indexBuffers=n}else++s.referenceCount;return new de.a({context:e,attributes:r,indexBuffer:s})},Pe._freeVertexArray=function(e){if(Object(o.default)(e)){var t=e.indexBuffer;e.destroy(),Object(o.default)(t)&&!t.isDestroyed()&&Object(o.default)(t.referenceCount)&&(--t.referenceCount,0===t.referenceCount&&t.destroy())}},Pe.prototype._findAncestorTileWithTerrainData=function(e){for(var t=e.parent;Object(o.default)(t)&&(!Object(o.default)(t.data)||!Object(o.default)(t.data.terrainData)||t.data.terrainData.wasCreatedByUpsampling());)t=t.parent;return t},Pe.prototype._computeWaterMaskTranslationAndScale=function(e,t,i){var a=t.rectangle,r=e.rectangle,n=r.width,o=r.height,s=n/a.width,l=o/a.height;return i.x=s*(r.west-a.west)/n,i.y=l*(r.south-a.south)/o,i.z=s,i.w=l,i};var Fe=Pe,Re=i(373),Ne=i(73),Le=i(112),je=i(97),Ve=i(205),Ue=i(223),ze=i(519),Be=i(446),He=i(342),ke=i(453),We={WEST:0,NORTH:1,EAST:2,SOUTH:3,NORTHWEST:4,NORTHEAST:5,SOUTHWEST:6,SOUTHEAST:7},Ge={NONE:0,CULLED:1,RENDERED:2,REFINED:3,RENDERED_AND_KICKED:6,REFINED_AND_KICKED:7,CULLED_BUT_NEEDED:9,wasKicked:function(e){return e>=Ge.RENDERED_AND_KICKED},originalResult:function(e){return 3&e},kick:function(e){return 4|e}},Ye=Ge;function Xe(e){this.tile=e,this.frameLastUpdated=void 0,this.westMeshes=[],this.westTiles=[],this.southMeshes=[],this.southTiles=[],this.eastMeshes=[],this.eastTiles=[],this.northMeshes=[],this.northTiles=[],this.southwestMesh=void 0,this.southwestTile=void 0,this.southeastMesh=void 0,this.southeastTile=void 0,this.northwestMesh=void 0,this.northwestTile=void 0,this.northeastMesh=void 0,this.northeastTile=void 0,this.changedThisFrame=!0,this.visitedFrame=void 0,this.enqueuedFrame=void 0,this.mesh=void 0,this.vertexArray=void 0,this.waterMaskTexture=void 0,this.waterMaskTranslationAndScale=new B.a}Xe.prototype.update=function(e,t,i){this.changedThisFrame&&(ft(e,t,this.tile,i),this.changedThisFrame=!1)},Xe.prototype.destroy=function(e){Object(o.default)(this.vertexArray)&&(Object(o.default)(e)?e.push(this.vertexArray):Fe._freeVertexArray(this.vertexArray,e),this.vertexArray=void 0),Object(o.default)(this.waterMaskTexture)&&(--this.waterMaskTexture.referenceCount,0===this.waterMaskTexture.referenceCount&&this.waterMaskTexture.destroy(),this.waterMaskTexture=void 0)};var Qe=new Be.a;function qe(e,t,i,a,r,n,s,u,d){if(void 0!==a){for(var f=a;f&&(f._lastSelectionResultFrame!==r||Ye.wasKicked(f._lastSelectionResult)||Ye.originalResult(f._lastSelectionResult)===Ye.CULLED);){if(s)return;var c=f.parent;if(n>=We.NORTHWEST&&void 0!==c)switch(n){case We.NORTHWEST:f=f===c.northwestChild?c:void 0;break;case We.NORTHEAST:f=f===c.northeastChild?c:void 0;break;case We.SOUTHWEST:f=f===c.southwestChild?c:void 0;break;case We.SOUTHEAST:f=f===c.southeastChild?c:void 0}else f=c}if(void 0!==f)if(f._lastSelectionResult!==Ye.RENDERED){if(Ye.originalResult(a._lastSelectionResult)!==Ye.CULLED)switch(n){case We.WEST:qe(e,t,i,a.northwestChild,r,n,!0,u,d),qe(e,t,i,a.southwestChild,r,n,!0,u,d);break;case We.EAST:qe(e,t,i,a.southeastChild,r,n,!0,u,d),qe(e,t,i,a.northeastChild,r,n,!0,u,d);break;case We.SOUTH:qe(e,t,i,a.southwestChild,r,n,!0,u,d),qe(e,t,i,a.southeastChild,r,n,!0,u,d);break;case We.NORTH:qe(e,t,i,a.northeastChild,r,n,!0,u,d),qe(e,t,i,a.northwestChild,r,n,!0,u,d);break;case We.NORTHWEST:qe(e,t,i,a.northwestChild,r,n,!0,u,d);break;case We.NORTHEAST:qe(e,t,i,a.northeastChild,r,n,!0,u,d);break;case We.SOUTHWEST:qe(e,t,i,a.southwestChild,r,n,!0,u,d);break;case We.SOUTHEAST:qe(e,t,i,a.southeastChild,r,n,!0,u,d);break;default:throw new l.default("Invalid edge")}}else{if(Object(o.default)(f.data.vertexArray))return;!function(e,t,i,a,r,n,s,l){var u=a.data;if(void 0===u.fill)u.fill=new Xe(a);else if(u.fill.visitedFrame===n)return;u.fill.enqueuedFrame!==n&&(u.fill.enqueuedFrame=n,u.fill.changedThisFrame=!1,s.enqueue(a));!function(e,t,i,a,r,n){var s,l,u,d,f,c,h,m=a.data.fill,p=i.data.fill;Object(o.default)(p)?(p.visitedFrame=t.frameNumber,p.changedThisFrame&&(ft(e,t,i,n),p.changedThisFrame=!1),s=i.data.fill.mesh):s=i.data.mesh;switch(r){case We.WEST:l=m.westMeshes,u=m.westTiles;break;case We.SOUTH:l=m.southMeshes,u=m.southTiles;break;case We.EAST:l=m.eastMeshes,u=m.eastTiles;break;case We.NORTH:l=m.northMeshes,u=m.northTiles;break;case We.NORTHWEST:return m.changedThisFrame=m.changedThisFrame||m.northwestMesh!==s,m.northwestMesh=s,void(m.northwestTile=i);case We.NORTHEAST:return m.changedThisFrame=m.changedThisFrame||m.northeastMesh!==s,m.northeastMesh=s,void(m.northeastTile=i);case We.SOUTHWEST:return m.changedThisFrame=m.changedThisFrame||m.southwestMesh!==s,m.southwestMesh=s,void(m.southwestTile=i);case We.SOUTHEAST:return m.changedThisFrame=m.changedThisFrame||m.southeastMesh!==s,m.southeastMesh=s,void(m.southeastTile=i)}if(i.level<=a.level)return m.changedThisFrame=m.changedThisFrame||l[0]!==s||1!==l.length,l[0]=s,u[0]=i,l.length=1,void(u.length=1);var _,g=i.rectangle,v=a.rectangle;switch(r){case We.WEST:for(_=(v.north-v.south)*Z.default.EPSILON5,d=0;d<u.length&&(c=u[d],h=c.rectangle,!Z.default.greaterThan(g.north,h.south,_));++d);for(f=d;f<u.length&&(c=u[f],h=c.rectangle,!Z.default.greaterThanOrEquals(g.south,h.north,_));++f);break;case We.SOUTH:for(_=(v.east-v.west)*Z.default.EPSILON5,d=0;d<u.length&&(c=u[d],h=c.rectangle,!Z.default.lessThan(g.west,h.east,_));++d);for(f=d;f<u.length&&(c=u[f],h=c.rectangle,!Z.default.lessThanOrEquals(g.east,h.west,_));++f);break;case We.EAST:for(_=(v.north-v.south)*Z.default.EPSILON5,d=0;d<u.length&&(c=u[d],h=c.rectangle,!Z.default.lessThan(g.south,h.north,_));++d);for(f=d;f<u.length&&(c=u[f],h=c.rectangle,!Z.default.lessThanOrEquals(g.north,h.south,_));++f);break;case We.NORTH:for(_=(v.east-v.west)*Z.default.EPSILON5,d=0;d<u.length&&(c=u[d],h=c.rectangle,!Z.default.greaterThan(g.east,h.west,_));++d);for(f=d;f<u.length&&(c=u[f],h=c.rectangle,!Z.default.greaterThanOrEquals(g.west,h.east,_));++f);}f-d==1?(m.changedThisFrame=m.changedThisFrame||l[d]!==s,l[d]=s,u[d]=i):(m.changedThisFrame=!0,l.splice(d,f-d,s),u.splice(d,f-d,i))}(e,t,i,a,r,l)}(e,t,i,f,n,r,u,d)}}}Xe.updateFillTiles=function(e,t,i,a){var r=e._quadtree,n=r._levelZeroTiles,s=r._lastSelectionFrameNumber,l=Qe;l.clear();for(var u=0;u<t.length;++u){var d=t[u];Object(o.default)(d.data.vertexArray)&&l.enqueue(t[u])}for(var f=l.dequeue();void 0!==f;){var c=f.findTileToWest(n),h=f.findTileToSouth(n),m=f.findTileToEast(n),p=f.findTileToNorth(n);qe(e,i,f,c,s,We.EAST,!1,l,a),qe(e,i,f,h,s,We.NORTH,!1,l,a),qe(e,i,f,m,s,We.WEST,!1,l,a),qe(e,i,f,p,s,We.SOUTH,!1,l,a);var _=c.findTileToNorth(n),g=c.findTileToSouth(n),v=m.findTileToNorth(n),y=m.findTileToSouth(n);qe(e,i,f,_,s,We.SOUTHEAST,!1,l,a),qe(e,i,f,v,s,We.SOUTHWEST,!1,l,a),qe(e,i,f,g,s,We.NORTHEAST,!1,l,a),qe(e,i,f,y,s,We.NORTHWEST,!1,l,a),f=l.dequeue()}};var Ze=new v.default,Ke=new v.default,Je=new a.default,$e=new a.default,et=new z.default,tt=new z.default,it=new z.default;function at(){this.height=0,this.encodedNormal=new z.default}function rt(e,t,i,a,r,n,s,l,u){if(Object(o.default)(r))return r;var d;if(Object(o.default)(n)&&Object(o.default)(s))d=.5*(n.height+s.height);else if(Object(o.default)(n))d=n.height;else if(Object(o.default)(s))d=s.height;else if(Object(o.default)(l))d=l.height;else{var f=e.tile.data.tileBoundingRegion,c=0,h=0;Object(o.default)(f)&&(c=f.minimumHeight,h=f.maximumHeight),d=.5*(c+h)}return yt(e,t,i,a,d,u),u}var nt={minimumHeight:0,maximumHeight:0},ot=new at,st=new at,lt=new at,ut=new at,dt="undefined"!=typeof Uint8Array?new Uint8Array(81):void 0;function ft(e,t,i,r){Fe.initialize(i,e.terrainProvider,e._imageryLayers);var n=i.data,s=n.fill,l=i.rectangle,u=i.tilingScheme.ellipsoid,d=bt(s,u,0,1,s.northwestTile,s.northwestMesh,s.northTiles,s.northMeshes,s.westTiles,s.westMeshes,lt),f=bt(s,u,0,0,s.southwestTile,s.southwestMesh,s.westTiles,s.westMeshes,s.southTiles,s.southMeshes,ot),c=bt(s,u,1,0,s.southeastTile,s.southeastMesh,s.southTiles,s.southMeshes,s.eastTiles,s.eastMeshes,st),h=bt(s,u,1,1,s.northeastTile,s.northeastMesh,s.eastTiles,s.eastMeshes,s.northTiles,s.northMeshes,ut);d=rt(s,u,0,1,d,f,h,c,lt),f=rt(s,u,0,0,f,d,c,h,ot),c=rt(s,u,1,1,c,f,h,d,st),h=rt(s,u,1,1,h,c,d,f,ut);var m,p,_=f.height,v=c.height,y=d.height,b=h.height,w=Math.min(_,v,y,b),x=Math.max(_,v,y,b),O=.5*(w+x),C=e.getLevelMaximumGeometricError(i.level),T=u.maximumRadius-C,E=4*Math.acos(T/u.maximumRadius);if(E*=1.5,l.width>E&&x-w<=C){var P=new ze.a({width:9,height:9,buffer:dt,structure:{heightOffset:x}});s.mesh=P._createMeshSync(i.tilingScheme,i.x,i.y,i.level,1)}else{var A=new He.a(void 0,void 0,void 0,void 0,!0,!0),S=Ke;S.longitude=.5*(l.east+l.west),S.latitude=.5*(l.north+l.south),S.height=O,A.center=u.cartographicToCartesian(S,A.center);var D,I=5;for(m=0,p=(D=s.westMeshes).length;m<p;++m)I+=D[m].eastIndicesNorthToSouth.length;for(m=0,p=(D=s.southMeshes).length;m<p;++m)I+=D[m].northIndicesWestToEast.length;for(m=0,p=(D=s.eastMeshes).length;m<p;++m)I+=D[m].westIndicesSouthToNorth.length;for(m=0,p=(D=s.northMeshes).length;m<p;++m)I+=D[m].southIndicesEastToWest.length;var M=nt;M.minimumHeight=w,M.maximumHeight=x;var F=A.getStride(),R=new Float32Array(I*F),N=0,L=N,j=N=xt(s,u,A,R,N=ct(u,l,A,R,N,0,1,d.height,d.encodedNormal,1,M),s.westTiles,s.westMeshes,We.EAST,M),V=N=xt(s,u,A,R,N=ct(u,l,A,R,N,0,0,f.height,f.encodedNormal,0,M),s.southTiles,s.southMeshes,We.NORTH,M),U=N=xt(s,u,A,R,N=ct(u,l,A,R,N,1,0,c.height,c.encodedNormal,0,M),s.eastTiles,s.eastMeshes,We.WEST,M);N=xt(s,u,A,R,N=ct(u,l,A,R,N,1,1,h.height,h.encodedNormal,1,M),s.northTiles,s.northMeshes,We.SOUTH,M),w=M.minimumHeight,x=M.maximumHeight;var B=J.a.fromRectangle(l,w,x,i.tilingScheme.ellipsoid),H=ae.a.geodeticLatitudeToMercatorAngle(l.south),k=1/(ae.a.geodeticLatitudeToMercatorAngle(l.north)-H),W=(ae.a.geodeticLatitudeToMercatorAngle(S.latitude)-H)*k;u.geodeticSurfaceNormalCartographic(Ze,$e);var G=Ve.a.octEncode($e,et),Y=N;A.encode(R,N*F,B.center,z.default.fromElements(.5,.5,it),O,G,W);var X,Q=++N,q=3*(Q-1),Z=q*(Q<256?1:2);if((R.length-Q*F)*Float32Array.BYTES_PER_ELEMENT>=Z){var K=Q*F*Float32Array.BYTES_PER_ELEMENT;X=Q<256?new Uint8Array(R.buffer,K,q):new Uint16Array(R.buffer,K,q)}else X=Q<256?new Uint8Array(q):new Uint16Array(q);R=new Float32Array(R.buffer,0,Q*F);var $=0;for(m=0;m<Q-2;++m)X[$++]=Y,X[$++]=m,X[$++]=m+1;X[$++]=Y,X[$++]=m,X[$++]=0;var ee=[];for(m=j;m>=L;--m)ee.push(m);var te=[];for(m=V;m>=j;--m)te.push(m);var ie=[];for(m=U;m>=V;--m)ie.push(m);var re=[];for(re.push(0),m=Y-1;m>=U;--m)re.push(m);s.mesh=new ke.a(A.center,R,X,q,Q,w,x,g.default.fromOrientedBoundingBox(B),function(e,t,i,r,n,o){var s=e.quadtree._occluders.ellipsoid,l=s.ellipsoid,u=Pt;return a.default.fromRadians(i.west,i.south,n,l,u[0]),a.default.fromRadians(i.east,i.south,n,l,u[1]),a.default.fromRadians(i.west,i.north,n,l,u[2]),a.default.fromRadians(i.east,i.north,n,l,u[3]),s.computeHorizonCullingPointPossiblyUnderEllipsoid(t,u,r,o)}(e,B.center,l,w,x),A.getStride(),B,A,t.terrainExaggeration,ee,te,ie,re)}var ne=t.context;Object(o.default)(s.vertexArray)&&(Object(o.default)(r)?r.push(s.vertexArray):Fe._freeVertexArray(s.vertexArray)),s.vertexArray=Fe._createVertexArrayForMesh(ne,s.mesh),n.processImagery(i,e.terrainProvider,t,!0);var oe=s.waterMaskTexture;if(s.waterMaskTexture=void 0,e.terrainProvider.hasWaterMask){var se=n._findAncestorTileWithTerrainData(i);Object(o.default)(se)&&Object(o.default)(se.data.waterMaskTexture)&&(s.waterMaskTexture=se.data.waterMaskTexture,++s.waterMaskTexture.referenceCount,n._computeWaterMaskTranslationAndScale(i,se,s.waterMaskTranslationAndScale))}Object(o.default)(oe)&&(--oe.referenceCount,0===oe.referenceCount&&oe.destroy())}function ct(e,t,i,a,r,n,o,s,l,u,d){var f=Ze;f.longitude=Z.default.lerp(t.west,t.east,n),f.latitude=Z.default.lerp(t.south,t.north,o),f.height=s;var c=e.cartographicToCartesian(f,Je),h=tt;return h.x=n,h.y=o,i.encode(a,r*i.getStride(),c,h,s,l,u),d.minimumHeight=Math.min(d.minimumHeight,s),d.maximumHeight=Math.max(d.maximumHeight,s),r+1}var ht=new C.default;function mt(e,t,i,a){var r=e.rectangle,n=t.rectangle;0===t.x&&1===i.x&&e.x===e.tilingScheme.getNumberOfXTilesAtLevel(e.level)-1?((r=C.default.clone(e.rectangle,ht)).west-=Z.default.TWO_PI,r.east-=Z.default.TWO_PI):0===e.x&&0===i.x&&t.x===t.tilingScheme.getNumberOfXTilesAtLevel(t.level)-1&&((r=C.default.clone(e.rectangle,ht)).west+=Z.default.TWO_PI,r.east+=Z.default.TWO_PI);var o=r.east-r.west,s=(n.west-r.west)/o,l=(n.east-r.west)/o,u=r.north-r.south,d=(n.south-r.south)/u,f=(n.north-r.south)/u,c=(i.x-s)/(l-s),h=(i.y-d)/(f-d);return Math.abs(c)<Math.EPSILON5?c=0:Math.abs(c-1)<Math.EPSILON5&&(c=1),Math.abs(h)<Math.EPSILON5?h=0:Math.abs(h-1)<Math.EPSILON5&&(h=1),a.x=c,a.y=h,a}var pt=new z.default;function _t(e,t,i,a,r){var n=e.encoding,o=e.vertices;if(r.height=n.decodeHeight(o,t),n.hasVertexNormals)n.getOctEncodedNormal(o,t,r.encodedNormal);else{var s=r.encodedNormal;s.x=0,s.y=0}}var gt=new z.default,vt=new a.default;function yt(e,t,i,a,r,n){n.height=r;var o=t.geodeticSurfaceNormalCartographic(Ze,Je);Ve.a.octEncode(o,n.encodedNormal)}function bt(e,t,i,a,r,n,s,l,u,d,f){var c;return Et(e,t,l,s,!1,i,a,f)||Et(e,t,d,u,!0,i,a,f)?f:Tt(r,n)?(_t(n,0===i?0===a?n.eastIndicesNorthToSouth[0]:n.southIndicesEastToWest[0]:0===a?n.northIndicesWestToEast[0]:n.westIndicesSouthToNorth[0],0,0,f),f):(c=0===i?0===a?wt(e.westMeshes,e.westTiles,We.EAST,e.southMeshes,e.southTiles,We.NORTH,i,a):wt(e.northMeshes,e.northTiles,We.SOUTH,e.westMeshes,e.westTiles,We.EAST,i,a):0===a?wt(e.southMeshes,e.southTiles,We.NORTH,e.eastMeshes,e.eastTiles,We.WEST,i,a):wt(e.eastMeshes,e.eastTiles,We.WEST,e.northMeshes,e.northTiles,We.SOUTH,i,a),Object(o.default)(c)?(yt(0,t,0,0,c,f),f):void 0)}function wt(e,t,i,a,r,n,s,l){var u=Ct(e,t,!1,i,s,l),d=Ct(a,r,!0,n,s,l);return Object(o.default)(u)&&Object(o.default)(d)?.5*(u+d):Object(o.default)(u)?u:d}function xt(e,t,i,a,r,n,o,s,l){for(var u=0;u<n.length;++u)r=Ot(e,t,i,a,r,n[u],o[u],s,l);return r}function Ot(e,t,i,a,r,n,o,s,l){var u=n.rectangle;s===We.EAST&&0===e.tile.x?((u=C.default.clone(n.rectangle,ht)).west-=Z.default.TWO_PI,u.east-=Z.default.TWO_PI):s===We.WEST&&0===n.x&&((u=C.default.clone(n.rectangle,ht)).west+=Z.default.TWO_PI,u.east+=Z.default.TWO_PI);var d,f,c,h,m=e.tile.rectangle;switch(r>0&&(i.decodeTextureCoordinates(a,r-1,it),d=it.x,f=it.y),s){case We.WEST:c=o.westIndicesSouthToNorth,h=!1;break;case We.NORTH:c=o.northIndicesWestToEast,h=!0;break;case We.EAST:c=o.eastIndicesNorthToSouth,h=!1;break;case We.SOUTH:c=o.southIndicesEastToWest,h=!0}var p,_,g=n,v=e.tile,y=o.encoding,b=o.vertices,w=i.getStride();y.hasWebMercatorT&&(p=ae.a.geodeticLatitudeToMercatorAngle(m.south),_=1/(ae.a.geodeticLatitudeToMercatorAngle(m.north)-p));for(var x=0;x<c.length;++x){var O=c[x],T=y.decodeTextureCoordinates(b,O,it);mt(g,v,T,T);var E=T.x,P=T.y,A=h?E:P;if(!(A<0||A>1)&&!(Math.abs(E-d)<Z.default.EPSILON5&&Math.abs(P-f)<Z.default.EPSILON5)){var S=Math.abs(E)<Z.default.EPSILON5||Math.abs(E-1)<Z.default.EPSILON5,D=Math.abs(P)<Z.default.EPSILON5||Math.abs(P-1)<Z.default.EPSILON5;if(!S||!D){var I,M=y.decodePosition(b,O,Je),F=y.decodeHeight(b,O);y.hasVertexNormals?I=y.getOctEncodedNormal(b,O,et):((I=et).x=0,I.y=0);var R=P;if(y.hasWebMercatorT){var N=Z.default.lerp(m.south,m.north,P);R=(ae.a.geodeticLatitudeToMercatorAngle(N)-p)*_}i.encode(a,r*w,M,T,F,I,R),l.minimumHeight=Math.min(l.minimumHeight,F),l.maximumHeight=Math.max(l.maximumHeight,F),++r}}}return r}function Ct(e,t,i,a,r,n){var s,l,u;i?(s=0,l=e.length,u=1):(s=e.length-1,l=-1,u=-1);for(var d=s;d!==l;d+=u){var f=e[d];if(Tt(t[d],f)){var c;switch(a){case We.WEST:c=f.westIndicesSouthToNorth;break;case We.SOUTH:c=f.southIndicesEastToWest;break;case We.EAST:c=f.eastIndicesNorthToSouth;break;case We.NORTH:c=f.northIndicesWestToEast}var h=c[i?0:c.length-1];if(Object(o.default)(h))return f.encoding.decodeHeight(f.vertices,h)}}}function Tt(e,t){return Object(o.default)(t)&&(!Object(o.default)(e.data.fill)||!e.data.fill.changedThisFrame)}function Et(e,t,i,r,n,o,s,l){var u,d,f,c,h,m=r[n?0:i.length-1],p=i[n?0:i.length-1];if(Tt(m,p)&&(0===o?0===s?(u=n?p.northIndicesWestToEast:p.eastIndicesNorthToSouth,d=n,f=n):(u=n?p.eastIndicesNorthToSouth:p.southIndicesEastToWest,d=!n,f=!1):0===s?(u=n?p.westIndicesSouthToNorth:p.northIndicesWestToEast,d=!n,f=!0):(u=n?p.southIndicesEastToWest:p.westIndicesSouthToNorth,d=n,f=!n),u.length>0)){h=u[c=n?0:u.length-1],p.encoding.decodeTextureCoordinates(p.vertices,h,it);var _=mt(m,e.tile,it,it);if(_.x===o&&_.y===s)return _t(p,h,0,0,l),!0;if(!((c=Object(Ue.a)(u,d?o:s,(function(t,i){p.encoding.decodeTextureCoordinates(p.vertices,t,it);var a=mt(m,e.tile,it,it);return f?d?a.x-o:a.y-s:d?o-a.x:s-a.y})))<0))return _t(p,u[c],0,0,l),!0;if((c=~c)>0&&c<u.length)return function(e,t,i,r,n,o,s,l,u,d){var f,c=r.encoding,h=r.vertices,m=mt(t,i,c.decodeTextureCoordinates(h,n,it),it),p=mt(t,i,c.decodeTextureCoordinates(h,o,tt),tt);f=u?(s-m.x)/(p.x-m.x):(l-m.y)/(p.y-m.y);var _,g=c.decodeHeight(h,n),v=c.decodeHeight(h,o),y=i.rectangle;if(Ze.longitude=Z.default.lerp(y.west,y.east,s),Ze.latitude=Z.default.lerp(y.south,y.north,l),d.height=Ze.height=Z.default.lerp(g,v,f),c.hasVertexNormals){var b=c.getOctEncodedNormal(h,n,pt),w=c.getOctEncodedNormal(h,o,gt),x=Ve.a.octDecode(b.x,b.y,Je),O=Ve.a.octDecode(w.x,w.y,vt);_=a.default.lerp(x,O,f,Je),a.default.normalize(_,_),Ve.a.octEncode(_,d.encodedNormal)}else _=e.geodeticSurfaceNormalCartographic(Ze,Je),Ve.a.octEncode(_,d.encodedNormal)}(t,m,e.tile,p,u[c-1],u[c],o,s,d,l),!0}return!1}var Pt=[new a.default,new a.default,new a.default,new a.default];var At=Xe,St=i(339);function Dt(e){this.lightingFadeOutDistance=65e5,this.lightingFadeInDistance=9e6,this.hasWaterMask=!1,this.oceanNormalMap=void 0,this.zoomedOutOceanSpecularIntensity=.5,this.enableLighting=!1,this.dynamicAtmosphereLighting=!1,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!1,this.shadows=je.default.RECEIVE_ONLY,this.splitDirection=w.default.NONE,this.fillHighlightColor=void 0,this.hueShift=0,this.saturationShift=0,this.brightnessShift=0,this.showSkirts=!0,this.backFaceCulling=!0,this._quadtree=void 0,this._terrainProvider=e.terrainProvider,this._imageryLayers=e.imageryLayers,this._surfaceShaderSet=e.surfaceShaderSet,this._renderState=void 0,this._blendRenderState=void 0,this._disableCullingRenderState=void 0,this._disableCullingBlendRenderState=void 0,this._errorEvent=new b.default,this._imageryLayers.layerAdded.addEventListener(Dt.prototype._onLayerAdded,this),this._imageryLayers.layerRemoved.addEventListener(Dt.prototype._onLayerRemoved,this),this._imageryLayers.layerMoved.addEventListener(Dt.prototype._onLayerMoved,this),this._imageryLayers.layerShownOrHidden.addEventListener(Dt.prototype._onLayerShownOrHidden,this),this._imageryLayersUpdatedEvent=new b.default,this._layerOrderChanged=!1,this._tilesToRenderByTextureCount=[],this._drawCommands=[],this._uniformMaps=[],this._usedDrawCommands=0,this._vertexArraysToDestroy=[],this._debug={wireframe:!1,boundingSphereTile:void 0},this._baseColor=void 0,this._firstPassInitialColor=void 0,this.baseColor=new k.default(0,0,.5,1),this._clippingPlanes=void 0,this.cartographicLimitRectangle=C.default.clone(C.default.MAX_VALUE),this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1}function It(e,t){var i=e.loadingImagery;Object(o.default)(i)||(i=e.readyImagery);var a=t.loadingImagery;return Object(o.default)(a)||(a=t.readyImagery),i.imageryLayer._layerIndex-a.imageryLayer._layerIndex}Object.defineProperties(Dt.prototype,{baseColor:{get:function(){return this._baseColor},set:function(e){this._baseColor=e,this._firstPassInitialColor=B.a.fromColor(e,this._firstPassInitialColor)}},quadtree:{get:function(){return this._quadtree},set:function(e){this._quadtree=e}},ready:{get:function(){return this._terrainProvider.ready&&(0===this._imageryLayers.length||this._imageryLayers.get(0).imageryProvider.ready)}},tilingScheme:{get:function(){return this._terrainProvider.tilingScheme}},errorEvent:{get:function(){return this._errorEvent}},imageryLayersUpdatedEvent:{get:function(){return this._imageryLayersUpdatedEvent}},terrainProvider:{get:function(){return this._terrainProvider},set:function(e){this._terrainProvider!==e&&(this._terrainProvider=e,Object(o.default)(this._quadtree)&&this._quadtree.invalidateAllTiles())}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){ce.a.setOwner(e,this,"_clippingPlanes")}}}),Dt.prototype.update=function(e){this._imageryLayers._update()},Dt.prototype.initialize=function(e){this._imageryLayers.queueReprojectionCommands(e),this._layerOrderChanged&&(this._layerOrderChanged=!1,this._quadtree.forEachLoadedTile((function(e){e.data.imagery.sort(It)}))),function(e,t){var i=t.creditDisplay;e._terrainProvider.ready&&Object(o.default)(e._terrainProvider.credit)&&i.addCredit(e._terrainProvider.credit);for(var a=e._imageryLayers,r=0,n=a.length;r<n;++r){var s=a.get(r).imageryProvider;s.ready&&Object(o.default)(s.credit)&&i.addCredit(s.credit)}}(this,e);for(var t=this._vertexArraysToDestroy,i=t.length,a=0;a<i;++a)Fe._freeVertexArray(t[a]);t.length=0},Dt.prototype.beginUpdate=function(e){for(var t=this._tilesToRenderByTextureCount,i=0,a=t.length;i<a;++i){var r=t[i];Object(o.default)(r)&&(r.length=0)}var n=this._clippingPlanes;Object(o.default)(n)&&n.enabled&&n.update(e),this._usedDrawCommands=0,this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1},Dt.prototype.endUpdate=function(e){if(!Object(o.default)(this._renderState)){this._renderState=ue.a.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:he.a.LESS}}),this._blendRenderState=ue.a.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:he.a.LESS_OR_EQUAL},blending:fe.a.ALPHA_BLEND});var t=Object(H.default)(this._renderState,!0);t.cull.enabled=!1,this._disableCullingRenderState=ue.a.fromCache(t),(t=Object(H.default)(this._blendRenderState,!0)).cull.enabled=!1,this._disableCullingBlendRenderState=ue.a.fromCache(t)}this._hasFillTilesThisFrame&&this._hasLoadedTilesThisFrame&&At.updateFillTiles(this,this._quadtree._tilesToRender,e,this._vertexArraysToDestroy);for(var i=this._tilesToRenderByTextureCount,a=0,r=i.length;a<r;++a){var n=i[a];if(Object(o.default)(n))for(var s=0,l=n.length;s<l;++s){var u=n[s],d=u.data.tileBoundingRegion;ai(this,u,e),e.minimumTerrainHeight=Math.min(e.minimumTerrainHeight,d.minimumHeight)}}},Dt.prototype.updateForPick=function(e){for(var t=this._drawCommands,i=0,a=this._usedDrawCommands;i<a;++i)e.commandList.push(t[i])},Dt.prototype.cancelReprojections=function(){this._imageryLayers.cancelReprojections()},Dt.prototype.getLevelMaximumGeometricError=function(e){return this._terrainProvider.getLevelMaximumGeometricError(e)},Dt.prototype.loadTile=function(e,t){var i,a=t.data,r=!0;Object(o.default)(a)&&(r=a.boundingVolumeSourceTile!==t||t._lastSelectionResult===Ye.CULLED_BUT_NEEDED,i=a.terrainState),Fe.processStateMachine(t,e,this.terrainProvider,this._imageryLayers,this._vertexArraysToDestroy,r),a=t.data,r&&i!==t.data.terrainState&&this.computeTileVisibility(t,e,this.quadtree.occluders)&&a.boundingVolumeSourceTile===t&&(r=!1,Fe.processStateMachine(t,e,this.terrainProvider,this._imageryLayers,this._vertexArraysToDestroy,r))};var Mt=new g.default,Ft=new C.default,Rt=new C.default,Nt=new v.default;function Lt(e,t){if(t.west<t.east)return t;var i=C.default.clone(t,Rt);return C.default.center(e,Nt).longitude>0?i.east=Z.default.PI:i.west=-Z.default.PI,i}Dt.prototype.computeTileVisibility=function(e,t,i){var r=this.computeDistanceToTile(e,t);if(e._distance=r,t.fog.enabled&&!t.cameraUnderground&&Z.default.fog(r,t.fog.density)>=1)return ie.NONE;var n=e.data,s=n.tileBoundingRegion;if(void 0===n.boundingVolumeSourceTile)return ie.PARTIAL;var l=t.cullingVolume,u=n.orientedBoundingBox;!Object(o.default)(u)&&Object(o.default)(n.renderedMesh)&&(u=n.renderedMesh.boundingSphere3D),n.clippedByBoundaries=!1;var d=Lt(e.rectangle,this.cartographicLimitRectangle),f=C.default.simpleIntersection(d,e.rectangle,Ft);if(!Object(o.default)(f))return ie.NONE;if(C.default.equals(f,e.rectangle)||(n.clippedByBoundaries=!0),t.mode!==N.a.SCENE3D&&(u=Mt,g.default.fromRectangleWithHeights2D(e.rectangle,t.mapProjection,s.minimumHeight,s.maximumHeight,u),a.default.fromElements(u.center.z,u.center.x,u.center.y,u.center),t.mode===N.a.MORPHING&&Object(o.default)(n.renderedMesh)&&(u=g.default.union(n.renderedMesh.boundingSphere3D,u,u))),!Object(o.default)(u))return q.default.INTERSECTING;var c=this._clippingPlanes;if(Object(o.default)(c)&&c.enabled){var h=c.computeIntersectionWithBoundingVolume(u);if(e.isClipped=h!==q.default.INSIDE,h===q.default.OUTSIDE)return ie.NONE}var m=l.computeVisibility(u);if(m===q.default.OUTSIDE)return ie.NONE;var p=t.mode===N.a.SCENE3D&&t.camera.frustum instanceof $.a;if(t.mode===N.a.SCENE3D&&!p&&Object(o.default)(i)&&!t.cameraUnderground){var _=n.occludeePointInScaledSpace;return Object(o.default)(_)?i.ellipsoid.isScaledSpacePointVisiblePossiblyUnderEllipsoid(_,s.minimumHeight)?m:ie.NONE:m}return m},Dt.prototype.canRefine=function(e){return!!Object(o.default)(e.data.terrainData)||void 0!==this.terrainProvider.getTileDataAvailable(2*e.x,2*e.y,e.level+1)};var jt=[],Vt=[];Dt.prototype.canRenderWithoutLosingDetail=function(e,t){var i=e.data,a=jt;a.length=this._imageryLayers.length;var r,n,s,l=!1,u=!1;for(Object(o.default)(i)&&(l=i.terrainState===Ee.READY,u=!0,r=i.imagery),n=0,s=a.length;n<s;++n)a[n]=u;if(Object(o.default)(r))for(n=0,s=r.length;n<s;++n){var d=r[n],f=d.loadingImagery,c=!Object(o.default)(f)||f.state===Ce.a.FAILED||f.state===Ce.a.INVALID,h=(d.loadingImagery||d.readyImagery).imageryLayer._layerIndex;a[h]=c&&a[h]}var m=this.quadtree._lastSelectionFrameNumber,p=Vt;for(p.length=0,p.push(e.southwestChild,e.southeastChild,e.northwestChild,e.northeastChild);p.length>0;){var _=p.pop(),g=_._lastSelectionResultFrame===m?_._lastSelectionResult:Ye.NONE;if(g===Ye.RENDERED){var v=_.data;if(!Object(o.default)(v))continue;if(!l&&_.data.terrainState===Ee.READY)return!1;var y=_.data.imagery;for(n=0,s=y.length;n<s;++n){var b=y[n],w=b.loadingImagery,x=!Object(o.default)(w)||w.state===Ce.a.FAILED||w.state===Ce.a.INVALID,O=(b.loadingImagery||b.readyImagery).imageryLayer._layerIndex;if(x&&!a[O])return!1}}else g===Ye.REFINED&&p.push(_.southwestChild,_.southeastChild,_.northwestChild,_.northeastChild)}return!0};var Ut=new a.default;Dt.prototype.computeTileLoadPriority=function(e,t){var i=e.data;if(void 0===i)return 0;var r=i.orientedBoundingBox;if(void 0===r)return 0;var n=t.camera.positionWC,o=t.camera.directionWC,s=a.default.subtract(r.center,n,Ut),l=a.default.magnitude(s);return l<Z.default.EPSILON5?0:(a.default.divideByScalar(s,l,s),(1-a.default.dot(s,o))*e._distance)};var zt=new K.default,Bt=new K.default,Ht=new B.a,kt=new B.a,Wt=new a.default,Gt=new a.default,Yt=new a.default,Xt=new a.default;Dt.prototype.showTileThisFrame=function(e,t){for(var i=0,a=e.data.imagery,r=0,n=a.length;r<n;++r){var s=a[r];Object(o.default)(s.readyImagery)&&0!==s.readyImagery.imageryLayer.alpha&&++i}var l=this._tilesToRenderByTextureCount[i];Object(o.default)(l)||(l=[],this._tilesToRenderByTextureCount[i]=l),l.push(e);var u=e.data;Object(o.default)(u.vertexArray)?this._hasLoadedTilesThisFrame=!0:this._hasFillTilesThisFrame=!0;var d=this._debug;++d.tilesRendered,d.texturesRendered+=i};var Qt=[new a.default,new a.default,new a.default,new a.default];Dt.prototype.computeDistanceToTile=function(e,t){var i=function(e,t,i){var a=e.data;void 0===a&&(a=e.data=new Fe);void 0===a.tileBoundingRegion&&(a.tileBoundingRegion=new St.a({computeBoundingVolumes:!1,rectangle:e.rectangle,ellipsoid:e.tilingScheme.ellipsoid,minimumHeight:0,maximumHeight:0}));var r=a.terrainData,n=a.mesh,o=a.tileBoundingRegion;if(void 0!==n&&void 0!==n.minimumHeight&&void 0!==n.maximumHeight)return o.minimumHeight=n.minimumHeight,o.maximumHeight=n.maximumHeight,e;if(void 0!==r&&void 0!==r._minimumHeight&&void 0!==r._maximumHeight)return o.minimumHeight=r._minimumHeight*i.terrainExaggeration,o.maximumHeight=r._maximumHeight*i.terrainExaggeration,e;o.minimumHeight=Number.NaN,o.maximumHeight=Number.NaN;var s=e.parent;for(;void 0!==s;){var l=s.data;if(void 0!==l){var u=l.mesh;if(void 0!==u&&void 0!==u.minimumHeight&&void 0!==u.maximumHeight)return o.minimumHeight=u.minimumHeight,o.maximumHeight=u.maximumHeight,s;var d=l.terrainData;if(void 0!==d&&void 0!==d._minimumHeight&&void 0!==d._maximumHeight)return o.minimumHeight=d._minimumHeight*i.terrainExaggeration,o.maximumHeight=d._maximumHeight*i.terrainExaggeration,s}s=s.parent}return}(e,this.terrainProvider,t),r=e.data,n=r.tileBoundingRegion;if(void 0===i)return 9999999999;if(r.boundingVolumeSourceTile!==i){r.boundingVolumeSourceTile=i;var s=e.rectangle;Object(o.default)(s)&&(r.orientedBoundingBox=J.a.fromRectangle(e.rectangle,n.minimumHeight,n.maximumHeight,e.tilingScheme.ellipsoid,r.orientedBoundingBox),r.occludeePointInScaledSpace=function(e,t,i,r,n,o){var s=e.quadtree._occluders.ellipsoid,l=s.ellipsoid,u=Qt;return a.default.fromRadians(i.west,i.south,n,l,u[0]),a.default.fromRadians(i.east,i.south,n,l,u[1]),a.default.fromRadians(i.west,i.north,n,l,u[2]),a.default.fromRadians(i.east,i.north,n,l,u[3]),s.computeHorizonCullingPointPossiblyUnderEllipsoid(t,u,r,o)}(this,r.orientedBoundingBox.center,e.rectangle,n.minimumHeight,n.maximumHeight,r.occludeePointInScaledSpace))}var l=n.minimumHeight,u=n.maximumHeight;if(r.boundingVolumeSourceTile!==e){var d=t.camera.positionCartographic.height;Math.abs(d-l)>Math.abs(d-u)?(n.minimumHeight=l,n.maximumHeight=l):(n.minimumHeight=u,n.maximumHeight=u)}var f=n.distanceToCamera(t);return n.minimumHeight=l,n.maximumHeight=u,f},Dt.prototype.isDestroyed=function(){return!1},Dt.prototype.destroy=function(){return this._tileProvider=this._tileProvider&&this._tileProvider.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),Object(s.default)(this)},Dt.prototype._onLayerAdded=function(e,t){if(e.show){var i=this._terrainProvider,a=this,r=e.imageryProvider,s=this._imageryLayersUpdatedEvent;r._reload=function(){e._imageryCache={},a._quadtree.forEachLoadedTile((function(t){if(!Object(o.default)(t._loadedCallbacks[e._layerIndex])){var a,r=t.data.imagery,s=r.length,l=-1,u=0;for(a=0;a<s;++a){var d=r[a];if(Object(n.default)(d.readyImagery,d.loadingImagery).imageryLayer===e)-1===l&&(l=a),++u;else if(-1!==l)break}if(-1!==l){var f=l+u;e._createTileImagerySkeletons(t,i,f)&&(t._loadedCallbacks[e._layerIndex]=function(e,t,i){return function(a){var r,s,l,u=-1,d=a.data.imagery,f=d.length;for(l=0;l<f;++l)if(r=d[l],(s=Object(n.default)(r.readyImagery,r.loadingImagery)).imageryLayer===t){u=l;break}if(-1!==u){var c=u+e;if(r=d[c],s=Object(o.default)(r)?Object(n.default)(r.readyImagery,r.loadingImagery):void 0,!Object(o.default)(s)||s.imageryLayer!==t)return!t._createTileImagerySkeletons(a,i,c);for(l=u;l<c;++l)d[l].freeResources();d.splice(u,e)}return!0}}(u,e,i),t.state=Te.LOADING)}}}))},this._quadtree.forEachLoadedTile((function(t){e._createTileImagerySkeletons(t,i)&&(t.state=Te.LOADING,0===t.level||t._lastSelectionResultFrame===a.quadtree._lastSelectionFrameNumber&&t._lastSelectionResult===Ye.RENDERED||(t.renderable=!1))})),this._layerOrderChanged=!0,s.raiseEvent()}},Dt.prototype._onLayerRemoved=function(e,t){this._quadtree.forEachLoadedTile((function(t){for(var i=t.data.imagery,a=-1,r=0,n=0,s=i.length;n<s;++n){var l=i[n],u=l.loadingImagery;if(Object(o.default)(u)||(u=l.readyImagery),u.imageryLayer===e)-1===a&&(a=n),l.freeResources(),++r;else if(-1!==a)break}-1!==a&&i.splice(a,r)})),Object(o.default)(e.imageryProvider)&&(e.imageryProvider._reload=void 0),this._imageryLayersUpdatedEvent.raiseEvent()},Dt.prototype._onLayerMoved=function(e,t,i){this._layerOrderChanged=!0,this._imageryLayersUpdatedEvent.raiseEvent()},Dt.prototype._onLayerShownOrHidden=function(e,t,i){i?this._onLayerAdded(e,t):this._onLayerRemoved(e,t)};var qt,Zt,Kt,Jt=new K.default;function $t(e,t){return{u_initialColor:function(){return this.properties.initialColor},u_fillHighlightColor:function(){return this.properties.fillHighlightColor},u_zoomedOutOceanSpecularIntensity:function(){return this.properties.zoomedOutOceanSpecularIntensity},u_oceanNormalMap:function(){return this.properties.oceanNormalMap},u_lightingFadeDistance:function(){return this.properties.lightingFadeDistance},u_nightFadeDistance:function(){return this.properties.nightFadeDistance},u_center3D:function(){return this.properties.center3D},u_tileRectangle:function(){return this.properties.tileRectangle},u_modifiedModelView:function(){var t=e.context.uniformState.view,i=K.default.multiplyByPoint(t,this.properties.rtc,Gt);return K.default.setTranslation(t,i,zt),zt},u_modifiedModelViewProjection:function(){var t=e.context.uniformState.view,i=e.context.uniformState.projection,a=K.default.multiplyByPoint(t,this.properties.rtc,Gt);return K.default.setTranslation(t,a,Bt),K.default.multiply(i,Bt,Bt),Bt},u_dayTextures:function(){return this.properties.dayTextures},u_dayTextureTranslationAndScale:function(){return this.properties.dayTextureTranslationAndScale},u_dayTextureTexCoordsRectangle:function(){return this.properties.dayTextureTexCoordsRectangle},u_dayTextureUseWebMercatorT:function(){return this.properties.dayTextureUseWebMercatorT},u_dayTextureAlpha:function(){return this.properties.dayTextureAlpha},u_dayTextureBrightness:function(){return this.properties.dayTextureBrightness},u_dayTextureContrast:function(){return this.properties.dayTextureContrast},u_dayTextureHue:function(){return this.properties.dayTextureHue},u_dayTextureSaturation:function(){return this.properties.dayTextureSaturation},u_dayTextureOneOverGamma:function(){return this.properties.dayTextureOneOverGamma},u_dayIntensity:function(){return this.properties.dayIntensity},u_southAndNorthLatitude:function(){return this.properties.southAndNorthLatitude},u_southMercatorYAndOneOverHeight:function(){return this.properties.southMercatorYAndOneOverHeight},u_waterMask:function(){return this.properties.waterMask},u_waterMaskTranslationAndScale:function(){return this.properties.waterMaskTranslationAndScale},u_minMaxHeight:function(){return this.properties.minMaxHeight},u_scaleAndBias:function(){return this.properties.scaleAndBias},u_dayTextureSplit:function(){return this.properties.dayTextureSplit},u_dayTextureCutoutRectangles:function(){return this.properties.dayTextureCutoutRectangles},u_clippingPlanes:function(){var i=t._clippingPlanes;return Object(o.default)(i)&&Object(o.default)(i.texture)?i.texture:e.context.defaultTexture},u_cartographicLimitRectangle:function(){return this.properties.localizedCartographicLimitRectangle},u_clippingPlanesMatrix:function(){var i=t._clippingPlanes;return Object(o.default)(i)?K.default.multiply(e.context.uniformState.view,i.modelMatrix,Jt):K.default.IDENTITY},u_clippingPlanesEdgeStyle:function(){var e=this.properties.clippingPlanesEdgeColor;return e.alpha=this.properties.clippingPlanesEdgeWidth,e},u_minimumBrightness:function(){return e.fog.minimumBrightness},u_terrainSplitDirection:function(){return t.splitDirection},u_hsbShift:function(){return this.properties.hsbShift},u_colorsToAlpha:function(){return this.properties.colorsToAlpha},properties:{initialColor:new B.a(0,0,.5,1),fillHighlightColor:new k.default(0,0,0,0),zoomedOutOceanSpecularIntensity:.5,oceanNormalMap:void 0,lightingFadeDistance:new z.default(65e5,9e6),nightFadeDistance:new z.default(1e7,4e7),hsbShift:new a.default,center3D:void 0,rtc:new a.default,modifiedModelView:new K.default,tileRectangle:new B.a,dayTextures:[],dayTextureTranslationAndScale:[],dayTextureTexCoordsRectangle:[],dayTextureUseWebMercatorT:[],dayTextureAlpha:[],dayTextureBrightness:[],dayTextureContrast:[],dayTextureHue:[],dayTextureSaturation:[],dayTextureOneOverGamma:[],dayTextureSplit:[],dayTextureCutoutRectangles:[],dayIntensity:0,colorsToAlpha:[],southAndNorthLatitude:new z.default,southMercatorYAndOneOverHeight:new z.default,waterMask:void 0,waterMaskTranslationAndScale:new B.a,minMaxHeight:new z.default,scaleAndBias:new K.default,clippingPlanesEdgeColor:k.default.clone(k.default.WHITE),clippingPlanesEdgeWidth:0,localizedCartographicLimitRectangle:new B.a}}}function ei(e,t,i){var a,r,n=i.data;if(Object(o.default)(n.vertexArray)?(a=n.mesh,r=n.vertexArray):Object(o.default)(n.fill)&&Object(o.default)(n.fill.vertexArray)&&(a=n.fill.mesh,r=n.fill.vertexArray),Object(o.default)(a)&&Object(o.default)(r)){if(Object(o.default)(n.wireframeVertexArray)){if(n.wireframeVertexArray.mesh===a)return;n.wireframeVertexArray.destroy(),n.wireframeVertexArray=void 0}n.wireframeVertexArray=function(e,t,i){var a={indices:i.indices,primitiveType:ee.a.TRIANGLES};X.a.toWireframe(a);var r=a.indices,n=re.a.createIndexBuffer({context:e,typedArray:r,usage:ne.a.STATIC_DRAW,indexDatatype:Q.a.fromSizeInBytes(r.BYTES_PER_ELEMENT)});return new de.a({context:e,attributes:t._attributes,indexBuffer:n})}(e,r,a),n.wireframeVertexArray.mesh=a}}!function(){var e,t,i=new Y.a({geometry:U.a.fromDimensions({dimensions:new a.default(2,2,2)})}),r=new Y.a({geometry:new te.a({radius:1})}),n=new K.default;function s(e){return new Le.a({geometryInstances:e,appearance:new Ne.a({translucent:!1,flat:!0}),asynchronous:!1})}qt=function(a,r){return a===e?t:(Kt(),e=a,n=K.default.fromRotationTranslation(a.halfAxes,a.center,n),i.modelMatrix=n,i.attributes.color=W.a.fromColor(r),t=s(i))},Zt=function(i,a){return i===e?t:(Kt(),e=i,n=K.default.fromTranslation(i.center,n),n=K.default.multiplyByUniformScale(n,i.radius,n),r.modelMatrix=n,r.attributes.color=W.a.fromColor(a),t=s(r))},Kt=function(){Object(o.default)(t)&&(t.destroy(),t=void 0,e=void 0)}}();var ti=new B.a(0,0,0,0),ii={frameState:void 0,surfaceTile:void 0,numberOfDayTextures:void 0,applyBrightness:void 0,applyContrast:void 0,applyHue:void 0,applySaturation:void 0,applyGamma:void 0,applyAlpha:void 0,applySplit:void 0,showReflectiveOcean:void 0,showOceanWaves:void 0,enableLighting:void 0,dynamicAtmosphereLighting:void 0,dynamicAtmosphereLightingFromSun:void 0,showGroundAtmosphere:void 0,perFragmentGroundAtmosphere:void 0,hasVertexNormals:void 0,useWebMercatorProjection:void 0,enableFog:void 0,enableClippingPlanes:void 0,clippingPlanes:void 0,clippedByBoundaries:void 0,hasImageryLayerCutout:void 0,colorCorrect:void 0,colorToAlpha:void 0};function ai(e,t,i){var r=t.data;Object(o.default)(r.vertexArray)||(void 0===r.fill&&(r.fill=new At(t)),r.fill.update(e,i));var n=i.creditDisplay,s=r.terrainData;if(Object(o.default)(s)&&Object(o.default)(s.credits))for(var l=s.credits,u=0,d=l.length;u<d;++u)n.addCredit(l[u]);var f=oe.a.maximumTextureImageUnits,c=r.waterMaskTexture,h=r.waterMaskTranslationAndScale;!Object(o.default)(c)&&Object(o.default)(r.fill)&&(c=r.fill.waterMaskTexture,h=r.fill.waterMaskTranslationAndScale);var m=i.cameraUnderground,p=e.hasWaterMask&&Object(o.default)(c),_=e.oceanNormalMap,v=p&&Object(o.default)(_),y=e.terrainProvider.ready&&e.terrainProvider.hasVertexNormals,b=i.fog.enabled&&!m,x=e.showGroundAtmosphere,O=je.default.castShadows(e.shadows),T=je.default.receiveShadows(e.shadows),E=e.hueShift,P=e.saturationShift,A=e.brightnessShift,S=!(Z.default.equalsEpsilon(E,0,Z.default.EPSILON7)&&Z.default.equalsEpsilon(P,0,Z.default.EPSILON7)&&Z.default.equalsEpsilon(A,0,Z.default.EPSILON7)),D=!1;if(x){var I,F=i.mode,R=i.camera;I=F===N.a.SCENE2D||F===N.a.COLUMBUS_VIEW?R.positionCartographic.height:a.default.magnitude(R.positionWC);var L=e.nightFadeOutDistance;F!==N.a.SCENE3D&&(L-=i.mapProjection.ellipsoid.maximumRadius),D=I>L}p&&--f,v&&--f,Object(o.default)(i.shadowState)&&i.shadowState.shadowsEnabled&&--f,Object(o.default)(e.clippingPlanes)&&e.clippingPlanes.enabled&&--f;var j=r.renderedMesh,V=j.center,U=j.encoding,z=Ht,H=0,W=0,Y=0,X=0,Q=!1;if(i.mode!==N.a.SCENE3D){var q=i.mapProjection,$=q.project(C.default.southwest(t.rectangle),Yt),te=q.project(C.default.northeast(t.rectangle),Xt);if(z.x=$.x,z.y=$.y,z.z=te.x,z.w=te.y,i.mode!==N.a.MORPHING&&((V=Wt).x=0,V.y=.5*(z.z+z.x),V.z=.5*(z.w+z.y),z.x-=V.y,z.y-=V.z,z.z-=V.y,z.w-=V.z),i.mode===N.a.SCENE2D&&U.quantization===M.a.BITS12){var ie=1/(Math.pow(2,12)-1)*.5,re=(z.z-z.x)*ie,ne=(z.w-z.y)*ie;z.x-=re,z.y-=ne,z.z+=re,z.w+=ne}q instanceof ae.a&&(H=t.rectangle.south,W=t.rectangle.north,Y=ae.a.geodeticLatitudeToMercatorAngle(H),X=1/(ae.a.geodeticLatitudeToMercatorAngle(W)-Y),Q=!0)}var ue=ii;ue.frameState=i,ue.surfaceTile=r,ue.showReflectiveOcean=p,ue.showOceanWaves=v,ue.enableLighting=e.enableLighting,ue.dynamicAtmosphereLighting=e.dynamicAtmosphereLighting,ue.dynamicAtmosphereLightingFromSun=e.dynamicAtmosphereLightingFromSun,ue.showGroundAtmosphere=x,ue.perFragmentGroundAtmosphere=D,ue.hasVertexNormals=y,ue.useWebMercatorProjection=Q,ue.clippedByBoundaries=r.clippedByBoundaries,ue.splitTerrain=e.splitDirection!==w.default.NONE;var de=r.imagery,fe=0,ce=de.length,he=e.showSkirts&&!m,me=e.backFaceCulling&&!m,pe=me?e._renderState:e._disableCullingRenderState,_e=me?e._blendRenderState:e._disableCullingBlendRenderState,ge=pe,ve=e._firstPassInitialColor,ye=i.context;Object(o.default)(e._debug.boundingSphereTile)||Kt();do{var be,we,xe=0;if(e._drawCommands.length<=e._usedDrawCommands?((be=new se.a).owner=t,be.cull=!1,be.boundingVolume=new g.default,be.orientedBoundingBox=void 0,we=$t(i,e),e._drawCommands.push(be),e._uniformMaps.push(we)):(be=e._drawCommands[e._usedDrawCommands],we=e._uniformMaps[e._usedDrawCommands]),be.owner=t,++e._usedDrawCommands,t===e._debug.boundingSphereTile){var Oe=r.orientedBoundingBox;Object(o.default)(Oe)?qt(Oe,k.default.RED).update(i):Object(o.default)(j)&&Object(o.default)(j.boundingSphere3D)&&Zt(j.boundingSphere3D,k.default.RED).update(i)}var Ce=we.properties;B.a.clone(ve,Ce.initialColor),Ce.oceanNormalMap=_,Ce.lightingFadeDistance.x=e.lightingFadeOutDistance,Ce.lightingFadeDistance.y=e.lightingFadeInDistance,Ce.nightFadeDistance.x=e.nightFadeOutDistance,Ce.nightFadeDistance.y=e.nightFadeInDistance,Ce.zoomedOutOceanSpecularIntensity=e.zoomedOutOceanSpecularIntensity;var Te=!Object(o.default)(r.vertexArray)&&Object(o.default)(e.fillHighlightColor)&&e.fillHighlightColor.alpha>0;Te&&k.default.clone(e.fillHighlightColor,Ce.fillHighlightColor),Ce.center3D=j.center,a.default.clone(V,Ce.rtc),B.a.clone(z,Ce.tileRectangle),Ce.southAndNorthLatitude.x=H,Ce.southAndNorthLatitude.y=W,Ce.southMercatorYAndOneOverHeight.x=Y,Ce.southMercatorYAndOneOverHeight.y=X;var Ee=kt,Pe=Lt(t.rectangle,e.cartographicLimitRectangle);a.default.fromElements(E,P,A,Ce.hsbShift);var Ae=t.rectangle,Se=1/Ae.width,De=1/Ae.height;Ee.x=(Pe.west-Ae.west)*Se,Ee.y=(Pe.south-Ae.south)*De,Ee.z=(Pe.east-Ae.west)*Se,Ee.w=(Pe.north-Ae.south)*De,B.a.clone(Ee,Ce.localizedCartographicLimitRectangle);var Ie=b&&Z.default.fog(t._distance,i.fog.density)>Z.default.EPSILON3;S=S&&(Ie||x);for(var Me=!1,Fe=!1,Ne=!1,Le=!1,Ve=!1,Ue=!1,ze=!1,Be=!1,He=!1;xe<f&&fe<ce;){var ke=de[fe],We=ke.readyImagery;if(++fe,Object(o.default)(We)&&0!==We.imageryLayer.alpha){var Ge=ke.useWebMercatorT?We.textureWebMercator:We.texture,Ye=We.imageryLayer;Object(o.default)(ke.textureTranslationAndScale)||(ke.textureTranslationAndScale=Ye._calculateTextureTranslationAndScale(t,ke)),Ce.dayTextures[xe]=Ge,Ce.dayTextureTranslationAndScale[xe]=ke.textureTranslationAndScale,Ce.dayTextureTexCoordsRectangle[xe]=ke.textureCoordinateRectangle,Ce.dayTextureUseWebMercatorT[xe]=ke.useWebMercatorT,Ce.dayTextureAlpha[xe]=Ye.alpha,Ue=Ue||1!==Ce.dayTextureAlpha[xe],Ce.dayTextureBrightness[xe]=Ye.brightness,Me=Me||Ce.dayTextureBrightness[xe]!==Re.default.DEFAULT_BRIGHTNESS,Ce.dayTextureContrast[xe]=Ye.contrast,Fe=Fe||Ce.dayTextureContrast[xe]!==Re.default.DEFAULT_CONTRAST,Ce.dayTextureHue[xe]=Ye.hue,Ne=Ne||Ce.dayTextureHue[xe]!==Re.default.DEFAULT_HUE,Ce.dayTextureSaturation[xe]=Ye.saturation,Le=Le||Ce.dayTextureSaturation[xe]!==Re.default.DEFAULT_SATURATION,Ce.dayTextureOneOverGamma[xe]=1/Ye.gamma,Ve=Ve||Ce.dayTextureOneOverGamma[xe]!==1/Re.default.DEFAULT_GAMMA,Ce.dayTextureSplit[xe]=Ye.splitDirection,ze=ze||0!==Ce.dayTextureSplit[xe];var Xe=Ce.dayTextureCutoutRectangles[xe];if(Object(o.default)(Xe)||(Xe=Ce.dayTextureCutoutRectangles[xe]=new B.a),B.a.clone(B.a.ZERO,Xe),Object(o.default)(Ye.cutoutRectangle)){var Qe=Lt(Ae,Ye.cutoutRectangle),qe=C.default.simpleIntersection(Qe,Ae,Ft);Be=Object(o.default)(qe)||Be,Xe.x=(Qe.west-Ae.west)*Se,Xe.y=(Qe.south-Ae.south)*De,Xe.z=(Qe.east-Ae.west)*Se,Xe.w=(Qe.north-Ae.south)*De}var Ze=Ce.colorsToAlpha[xe];Object(o.default)(Ze)||(Ze=Ce.colorsToAlpha[xe]=new B.a);var Ke=Object(o.default)(Ye.colorToAlpha)&&Ye.colorToAlphaThreshold>0;if(He=He||Ke,Ke){var Je=Ye.colorToAlpha;Ze.x=Je.red,Ze.y=Je.green,Ze.z=Je.blue,Ze.w=Ye.colorToAlphaThreshold}else Ze.w=-1;if(Object(o.default)(We.credits))for(var $e=We.credits,et=0,tt=$e.length;et<tt;++et)n.addCredit($e[et]);++xe}}Ce.dayTextures.length=xe,Ce.waterMask=c,B.a.clone(h,Ce.waterMaskTranslationAndScale),Ce.minMaxHeight.x=U.minimumHeight,Ce.minMaxHeight.y=U.maximumHeight,K.default.clone(U.matrix,Ce.scaleAndBias);var it=e._clippingPlanes,at=Object(o.default)(it)&&it.enabled&&t.isClipped;at&&(Ce.clippingPlanesEdgeColor=k.default.clone(it.edgeColor,Ce.clippingPlanesEdgeColor),Ce.clippingPlanesEdgeWidth=it.edgeWidth),Object(o.default)(e.uniformMap)&&(we=Object(G.default)(we,e.uniformMap)),ue.numberOfDayTextures=xe,ue.applyBrightness=Me,ue.applyContrast=Fe,ue.applyHue=Ne,ue.applySaturation=Le,ue.applyGamma=Ve,ue.applyAlpha=Ue,ue.applySplit=ze,ue.enableFog=Ie,ue.enableClippingPlanes=at,ue.clippingPlanes=it,ue.hasImageryLayerCutout=Be,ue.colorCorrect=S,ue.highlightFillTile=Te,ue.colorToAlpha=He;var rt=r.renderedMesh.indices.length;he||(rt=r.renderedMesh.indexCountWithoutSkirts),be.shaderProgram=e._surfaceShaderSet.getShaderProgram(ue),be.castShadows=O,be.receiveShadows=T,be.renderState=ge,be.primitiveType=ee.a.TRIANGLES,be.vertexArray=r.vertexArray||r.fill.vertexArray,be.count=rt,be.uniformMap=we,be.pass=le.a.GLOBE,e._debug.wireframe&&(ei(ye,0,t),Object(o.default)(r.wireframeVertexArray)&&(be.vertexArray=r.wireframeVertexArray,be.primitiveType=ee.a.LINES,be.count=2*rt));var nt=be.boundingVolume,ot=be.orientedBoundingBox;if(i.mode!==N.a.SCENE3D){var st=r.tileBoundingRegion;g.default.fromRectangleWithHeights2D(t.rectangle,i.mapProjection,st.minimumHeight,st.maximumHeight,nt),a.default.fromElements(nt.center.z,nt.center.x,nt.center.y,nt.center),i.mode===N.a.MORPHING&&(nt=g.default.union(j.boundingSphere3D,nt,nt))}else be.boundingVolume=g.default.clone(j.boundingSphere3D,nt),be.orientedBoundingBox=J.a.clone(r.orientedBoundingBox,ot);be.dirty=!0,i.commandList.push(be),ge=_e,ve=ti}while(fe<ce)}var ri=Dt;function ni(){this._layers=[],this.layerAdded=new b.default,this.layerRemoved=new b.default,this.layerMoved=new b.default,this.layerShownOrHidden=new b.default}function oi(e,t){return e.indexOf(t)}function si(e,t,i){var a=e._layers;if((t=Z.default.clamp(t,0,a.length-1))!==(i=Z.default.clamp(i,0,a.length-1))){var r=a[t];a[t]=a[i],a[i]=r,e._update(),e.layerMoved.raiseEvent(r,i,t)}}Object.defineProperties(ni.prototype,{length:{get:function(){return this._layers.length}}}),ni.prototype.add=function(e,t){Object(o.default)(t)?this._layers.splice(t,0,e):(t=this._layers.length,this._layers.push(e)),this._update(),this.layerAdded.raiseEvent(e,t)},ni.prototype.addImageryProvider=function(e,t){var i=new Re.default(e);return this.add(i,t),i},ni.prototype.remove=function(e,t){t=Object(n.default)(t,!0);var i=this._layers.indexOf(e);return-1!==i&&(this._layers.splice(i,1),this._update(),this.layerRemoved.raiseEvent(e,i),t&&e.destroy(),!0)},ni.prototype.removeAll=function(e){e=Object(n.default)(e,!0);for(var t=this._layers,i=0,a=t.length;i<a;i++){var r=t[i];this.layerRemoved.raiseEvent(r,i),e&&r.destroy()}this._layers=[]},ni.prototype.contains=function(e){return-1!==this.indexOf(e)},ni.prototype.indexOf=function(e){return this._layers.indexOf(e)},ni.prototype.get=function(e){return this._layers[e]},ni.prototype.raise=function(e){var t=oi(this._layers,e);si(this,t,t+1)},ni.prototype.lower=function(e){var t=oi(this._layers,e);si(this,t,t-1)},ni.prototype.raiseToTop=function(e){var t=oi(this._layers,e);t!==this._layers.length-1&&(this._layers.splice(t,1),this._layers.push(e),this._update(),this.layerMoved.raiseEvent(e,this._layers.length-1,t))},ni.prototype.lowerToBottom=function(e){var t=oi(this._layers,e);0!==t&&(this._layers.splice(t,1),this._layers.splice(0,0,e),this._update(),this.layerMoved.raiseEvent(e,0,t))};var li=new C.default;ni.prototype.pickImageryLayerFeatures=function(e,t){var i=t.globe.pick(e,t);if(Object(o.default)(i)){for(var a,r=t.globe.ellipsoid.cartesianToCartographic(i),n=t.globe._surface._tilesToRender,s=0;!Object(o.default)(a)&&s<n.length;++s){var l=n[s];C.default.contains(l.rectangle,r)&&(a=l)}if(Object(o.default)(a)){for(var u=a.data.imagery,d=[],f=[],c=u.length-1;c>=0;--c){var h=u[c],m=h.readyImagery;if(Object(o.default)(m)){var p=m.imageryLayer.imageryProvider;if(Object(o.default)(p.pickFeatures)&&C.default.contains(m.rectangle,r)){var _=li;if(_.west=Z.default.lerp(a.rectangle.west,a.rectangle.east,h.textureCoordinateRectangle.x-1/1024),_.east=Z.default.lerp(a.rectangle.west,a.rectangle.east,h.textureCoordinateRectangle.z+1/1024),_.south=Z.default.lerp(a.rectangle.south,a.rectangle.north,h.textureCoordinateRectangle.y-1/1024),_.north=Z.default.lerp(a.rectangle.south,a.rectangle.north,h.textureCoordinateRectangle.w+1/1024),C.default.contains(_,r)){var g=p.pickFeatures(m.x,m.y,m.level,r.longitude,r.latitude);Object(o.default)(g)&&(d.push(g),f.push(m.imageryLayer))}}}}if(0!==d.length)return I.default.all(d,(function(e){for(var t=[],i=0;i<e.length;++i){var a=e[i],n=f[i];if(Object(o.default)(a)&&a.length>0)for(var s=0;s<a.length;++s){var l=a[s];l.imageryLayer=n,Object(o.default)(l.position)||(l.position=r),t.push(l)}}return t}))}}},ni.prototype.queueReprojectionCommands=function(e){for(var t=this._layers,i=0,a=t.length;i<a;++i)t[i].queueReprojectionCommands(e)},ni.prototype.cancelReprojections=function(){for(var e=this._layers,t=0,i=e.length;t<i;++t)e[t].cancelReprojections()},ni.prototype.isDestroyed=function(){return!1},ni.prototype.destroy=function(){return this.removeAll(!0),Object(s.default)(this)},ni.prototype._update=function(){var e,t,i,a,r=!0,n=this._layers;for(i=0,a=n.length;i<a;++i)(t=n[i])._layerIndex=i,t.show?(t._isBaseLayer=r,r=!1):t._isBaseLayer=!1,t.show!==t._show&&(Object(o.default)(t._show)&&(Object(o.default)(e)||(e=[]),e.push(t)),t._show=t.show);if(Object(o.default)(e))for(i=0,a=e.length;i<a;++i)t=e[i],this.layerShownOrHidden.raiseEvent(t,t._layerIndex,t.show)};var ui=ni,di=i(96),fi=i(167),ci=i(430);function hi(e){this._ellipsoid=new ci.a(e.ellipsoid,a.default.ZERO)}Object.defineProperties(hi.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});var mi=hi;function pi(e){this._tilingScheme=e.tilingScheme,this._x=e.x,this._y=e.y,this._level=e.level,this._parent=e.parent,this._rectangle=this._tilingScheme.tileXYToRectangle(this._x,this._y,this._level),this._southwestChild=void 0,this._southeastChild=void 0,this._northwestChild=void 0,this._northeastChild=void 0,this.replacementPrevious=void 0,this.replacementNext=void 0,this._distance=0,this._loadPriority=0,this._customData=[],this._frameUpdated=void 0,this._lastSelectionResult=Ye.NONE,this._lastSelectionResultFrame=void 0,this._loadedCallbacks={},this.state=Te.START,this.renderable=!1,this.upsampledFromParent=!1,this.data=void 0}function _i(e){Object(o.default)(e)&&e.freeResources()}pi.createLevelZeroTiles=function(e){for(var t=e.getNumberOfXTilesAtLevel(0),i=e.getNumberOfYTilesAtLevel(0),a=new Array(t*i),r=0,n=0;n<i;++n)for(var o=0;o<t;++o)a[r++]=new pi({tilingScheme:e,x:o,y:n,level:0});return a},pi.prototype._updateCustomData=function(e,t,i){var a,r,n,s=this.customData;if(Object(o.default)(t)&&Object(o.default)(i)){for(s=s.filter((function(e){return-1===i.indexOf(e)})),this._customData=s,n=this._rectangle,a=0;a<t.length;++a)r=t[a],C.default.contains(n,r.positionCartographic)&&s.push(r);this._frameUpdated=e}else{var l=this._parent;if(Object(o.default)(l)&&this._frameUpdated!==l._frameUpdated){s.length=0,n=this._rectangle;var u=l.customData;for(a=0;a<u.length;++a)r=u[a],C.default.contains(n,r.positionCartographic)&&s.push(r);this._frameUpdated=l._frameUpdated}}},Object.defineProperties(pi.prototype,{tilingScheme:{get:function(){return this._tilingScheme}},x:{get:function(){return this._x}},y:{get:function(){return this._y}},level:{get:function(){return this._level}},parent:{get:function(){return this._parent}},rectangle:{get:function(){return this._rectangle}},children:{get:function(){return[this.northwestChild,this.northeastChild,this.southwestChild,this.southeastChild]}},southwestChild:{get:function(){return Object(o.default)(this._southwestChild)||(this._southwestChild=new pi({tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y+1,level:this.level+1,parent:this})),this._southwestChild}},southeastChild:{get:function(){return Object(o.default)(this._southeastChild)||(this._southeastChild=new pi({tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y+1,level:this.level+1,parent:this})),this._southeastChild}},northwestChild:{get:function(){return Object(o.default)(this._northwestChild)||(this._northwestChild=new pi({tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y,level:this.level+1,parent:this})),this._northwestChild}},northeastChild:{get:function(){return Object(o.default)(this._northeastChild)||(this._northeastChild=new pi({tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y,level:this.level+1,parent:this})),this._northeastChild}},customData:{get:function(){return this._customData}},needsLoading:{get:function(){return this.state<Te.DONE}},eligibleForUnloading:{get:function(){var e=!0;return Object(o.default)(this.data)&&(e=this.data.eligibleForUnloading,Object(o.default)(e)||(e=!0)),e}}}),pi.prototype.findLevelZeroTile=function(e,t,i){var a=this.tilingScheme.getNumberOfXTilesAtLevel(0);if(t<0?t+=a:t>=a&&(t-=a),!(i<0||i>=this.tilingScheme.getNumberOfYTilesAtLevel(0)))return e.filter((function(e){return e.x===t&&e.y===i}))[0]},pi.prototype.findTileToWest=function(e){var t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x-1,this.y);if(t.southeastChild===this)return t.southwestChild;if(t.northeastChild===this)return t.northwestChild;var i=t.findTileToWest(e);return void 0!==i?t.southwestChild===this?i.southeastChild:i.northeastChild:void 0},pi.prototype.findTileToEast=function(e){var t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x+1,this.y);if(t.southwestChild===this)return t.southeastChild;if(t.northwestChild===this)return t.northeastChild;var i=t.findTileToEast(e);return void 0!==i?t.southeastChild===this?i.southwestChild:i.northwestChild:void 0},pi.prototype.findTileToSouth=function(e){var t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x,this.y+1);if(t.northwestChild===this)return t.southwestChild;if(t.northeastChild===this)return t.southeastChild;var i=t.findTileToSouth(e);return void 0!==i?t.southwestChild===this?i.northwestChild:i.northeastChild:void 0},pi.prototype.findTileToNorth=function(e){var t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x,this.y-1);if(t.southwestChild===this)return t.northwestChild;if(t.southeastChild===this)return t.northeastChild;var i=t.findTileToNorth(e);return void 0!==i?t.northwestChild===this?i.southwestChild:i.southeastChild:void 0},pi.prototype.freeResources=function(){this.state=Te.START,this.renderable=!1,this.upsampledFromParent=!1,Object(o.default)(this.data)&&Object(o.default)(this.data.freeResources)&&this.data.freeResources(),_i(this._southwestChild),this._southwestChild=void 0,_i(this._southeastChild),this._southeastChild=void 0,_i(this._northwestChild),this._northwestChild=void 0,_i(this._northeastChild),this._northeastChild=void 0};var gi=pi;function vi(){this.head=void 0,this.tail=void 0,this.count=0,this._lastBeforeStartOfFrame=void 0}function yi(e,t){var i=t.replacementPrevious,a=t.replacementNext;t===e._lastBeforeStartOfFrame&&(e._lastBeforeStartOfFrame=a),t===e.head?e.head=a:i.replacementNext=a,t===e.tail?e.tail=i:a.replacementPrevious=i,t.replacementPrevious=void 0,t.replacementNext=void 0,--e.count}vi.prototype.markStartOfRenderFrame=function(){this._lastBeforeStartOfFrame=this.head},vi.prototype.trimTiles=function(e){for(var t=this.tail,i=!0;i&&Object(o.default)(this._lastBeforeStartOfFrame)&&this.count>e&&Object(o.default)(t);){i=t!==this._lastBeforeStartOfFrame;var a=t.replacementPrevious;t.eligibleForUnloading&&(t.freeResources(),yi(this,t)),t=a}},vi.prototype.markTileRendered=function(e){var t=this.head;if(t!==e){if(++this.count,!Object(o.default)(t))return e.replacementPrevious=void 0,e.replacementNext=void 0,this.head=e,void(this.tail=e);(Object(o.default)(e.replacementPrevious)||Object(o.default)(e.replacementNext))&&yi(this,e),e.replacementPrevious=void 0,e.replacementNext=t,t.replacementPrevious=e,this.head=e}else e===this._lastBeforeStartOfFrame&&(this._lastBeforeStartOfFrame=e.replacementNext)};var bi,wi=vi;function xi(e){this._tileProvider=e.tileProvider,this._tileProvider.quadtree=this,this._debug={enableDebugOutput:!1,maxDepth:0,maxDepthVisited:0,tilesVisited:0,tilesCulled:0,tilesRendered:0,tilesWaitingForChildren:0,lastMaxDepth:-1,lastMaxDepthVisited:-1,lastTilesVisited:-1,lastTilesCulled:-1,lastTilesRendered:-1,lastTilesWaitingForChildren:-1,suspendLodUpdate:!1};var t=this._tileProvider.tilingScheme.ellipsoid;this._tilesToRender=[],this._tileLoadQueueHigh=[],this._tileLoadQueueMedium=[],this._tileLoadQueueLow=[],this._tileReplacementQueue=new wi,this._levelZeroTiles=void 0,this._loadQueueTimeSlice=5,this._tilesInvalidated=!1,this._addHeightCallbacks=[],this._removeHeightCallbacks=[],this._tileToUpdateHeights=[],this._lastTileIndex=0,this._updateHeightsTimeSlice=2,this._cameraPositionCartographic=void 0,this._cameraReferenceFrameOriginCartographic=void 0,this.maximumScreenSpaceError=Object(n.default)(e.maximumScreenSpaceError,2),this.tileCacheSize=Object(n.default)(e.tileCacheSize,100),this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this._occluders=new mi({ellipsoid:t}),this._tileLoadProgressEvent=new b.default,this._lastTileLoadQueueLength=0,this._lastSelectionFrameNumber=void 0}function Oi(e){var t=e._debug;t.maxDepth=0,t.maxDepthVisited=0,t.tilesVisited=0,t.tilesCulled=0,t.tilesRendered=0,t.tilesWaitingForChildren=0,e._tileLoadQueueHigh.length=0,e._tileLoadQueueMedium.length=0,e._tileLoadQueueLow.length=0}Object.defineProperties(xi.prototype,{tileProvider:{get:function(){return this._tileProvider}},tileLoadProgressEvent:{get:function(){return this._tileLoadProgressEvent}},occluders:{get:function(){return this._occluders}}}),xi.prototype.invalidateAllTiles=function(){this._tilesInvalidated=!0},xi.prototype.forEachLoadedTile=function(e){for(var t=this._tileReplacementQueue.head;Object(o.default)(t);)t.state!==Te.START&&e(t),t=t.replacementNext},xi.prototype.forEachRenderedTile=function(e){for(var t=this._tilesToRender,i=0,a=t.length;i<a;++i)e(t[i])},xi.prototype.updateHeight=function(e,t){var i=this,a={positionOnEllipsoidSurface:void 0,positionCartographic:e,level:-1,callback:t,removeFunc:function(){for(var e=i._addHeightCallbacks,t=e.length,r=0;r<t;++r)if(e[r]===a){e.splice(r,1);break}i._removeHeightCallbacks.push(a)}};return i._addHeightCallbacks.push(a),a.removeFunc},xi.prototype.update=function(e){Object(o.default)(this._tileProvider.update)&&this._tileProvider.update(e)},xi.prototype.beginFrame=function(e){e.passes.render&&(this._tilesInvalidated&&(!function(e){var t=e._tileReplacementQueue;t.head=void 0,t.tail=void 0,t.count=0,Oi(e);var i=e._levelZeroTiles;if(Object(o.default)(i))for(var a=0;a<i.length;++a){for(var r=i[a].customData,n=r.length,s=0;s<n;++s){var l=r[s];l.level=0,e._addHeightCallbacks.push(l)}i[a].freeResources()}e._levelZeroTiles=void 0,e._tileProvider.cancelReprojections()}(this),this._tilesInvalidated=!1),this._tileProvider.initialize(e),Oi(this),this._debug.suspendLodUpdate||this._tileReplacementQueue.markStartOfRenderFrame())},xi.prototype.render=function(e){var t=e.passes,i=this._tileProvider;t.render&&(i.beginUpdate(e),function(e,t){var i,a=e._debug;if(a.suspendLodUpdate)return;e._tilesToRender.length=0;var r,n=e._tileProvider;if(!Object(o.default)(e._levelZeroTiles)){if(!n.ready)return;var s=n.tilingScheme;e._levelZeroTiles=gi.createLevelZeroTiles(s);var l=e._levelZeroTiles.length;if(Pi.length<l)for(Pi=new Array(l),i=0;i<l;++i)void 0===Pi[i]&&(Pi[i]=new Si)}e._occluders.ellipsoid.cameraPosition=t.camera.positionWC;var u=e._levelZeroTiles,d=u.length>1?e._occluders:void 0;bi=t.camera.positionCartographic,u.sort(Ti);var f,c=e._addHeightCallbacks,h=e._removeHeightCallbacks,m=t.frameNumber;if(c.length>0||h.length>0){for(i=0,f=u.length;i<f;++i)(r=u[i])._updateCustomData(m,c,h);c.length=0,h.length=0}var p=t.camera;e._cameraPositionCartographic=p.positionCartographic;var _=K.default.getTranslation(p.transform,Ei);for(e._cameraReferenceFrameOriginCartographic=e.tileProvider.tilingScheme.ellipsoid.cartesianToCartographic(_,e._cameraReferenceFrameOriginCartographic),i=0,f=u.length;i<f;++i)r=u[i],e._tileReplacementQueue.markTileRendered(r),r.renderable?Ri(e,r,n,t,d,!1,Pi[i]):(Ai(e,e._tileLoadQueueHigh,r,t),++a.tilesWaitingForChildren);e._lastSelectionFrameNumber=m}(this,e),function(e,t){for(var i=e._tileProvider,a=e._tilesToRender,r=0,n=a.length;r<n;++r){var o=a[r];i.showTileThisFrame(o,t)}}(this,e),i.endUpdate(e)),t.pick&&this._tilesToRender.length>0&&i.updateForPick(e)},xi.prototype.endFrame=function(e){e.passes.render&&e.mode!==N.a.MORPHING&&(function(e,t){var i=e._tileLoadQueueHigh,a=e._tileLoadQueueMedium,r=e._tileLoadQueueLow;if(0===i.length&&0===a.length&&0===r.length)return;e._tileReplacementQueue.trimTiles(e.tileCacheSize);var n=Object(di.default)()+e._loadQueueTimeSlice,o=e._tileProvider,s=ji(e,t,o,n,i,!1);s=ji(e,t,o,n,a,s),ji(e,t,o,n,r,s)}(this,e),function(e,t){if(!e.tileProvider.ready)return;var i=Bi;i.length=0;var r,s=e._tileToUpdateHeights,l=e._tileProvider.terrainProvider,u=Object(di.default)(),d=e._updateHeightsTimeSlice,f=u+d,c=t.mode,h=t.mapProjection,m=e.tileProvider.tilingScheme.ellipsoid;for(;s.length>0;){var p=s[0];if(Object(o.default)(p.data)&&Object(o.default)(p.data.mesh)){var _=p.customData,g=_.length,y=!1;for(r=e._lastTileIndex;r<g;++r){var b=_[r];if(p.level>b.level){if(Object(o.default)(b.positionOnEllipsoidSurface)||(b.positionOnEllipsoidSurface=a.default.fromRadians(b.positionCartographic.longitude,b.positionCartographic.latitude,0,m)),c===N.a.SCENE3D){var w=m.geodeticSurfaceNormal(b.positionOnEllipsoidSurface,Vi.direction),x=m.getSurfaceNormalIntersectionWithZAxis(b.positionOnEllipsoidSurface,11500,Vi.origin);if(!Object(o.default)(x)){var O;Object(o.default)(p.data.tileBoundingRegion)&&(O=p.data.tileBoundingRegion.minimumHeight);var T=Math.min(Object(n.default)(O,0),-11500),E=a.default.multiplyByScalar(w,Math.abs(T)+1,zi);a.default.subtract(b.positionOnEllipsoidSurface,E,Vi.origin)}}else v.default.clone(b.positionCartographic,Ui),Ui.height=-11500,h.project(Ui,zi),a.default.fromElements(zi.z,zi.x,zi.y,zi),a.default.clone(zi,Vi.origin),a.default.clone(a.default.UNIT_X,Vi.direction);var P=p.data.pick(Vi,c,h,!1,zi);Object(o.default)(P)&&(b.callback(P),b.level=p.level)}else if(p.level===b.level){for(var A,S=p.children,D=S.length,I=0;I<D&&(A=S[I],!C.default.contains(A.rectangle,b.positionCartographic));++I);var M=l.getTileDataAvailable(A.x,A.y,A.level),F=p.parent;(Object(o.default)(M)&&!M||Object(o.default)(F)&&Object(o.default)(F.data)&&Object(o.default)(F.data.terrainData)&&!F.data.terrainData.isChildAvailable(F.x,F.y,A.x,A.y))&&b.removeFunc()}if(Object(di.default)()>=f){y=!0;break}}if(y){e._lastTileIndex=r;break}e._lastTileIndex=0,s.shift()}else{var R=p._lastSelectionResultFrame===e._lastSelectionFrameNumber?p._lastSelectionResult:Ye.NONE;R!==Ye.RENDERED&&R!==Ye.CULLED_BUT_NEEDED||i.push(p),s.shift(),e._lastTileIndex=0}}for(r=0;r<i.length;r++)s.push(i[r])}(this,e),function(e,t){var i=e._tileLoadQueueHigh.length+e._tileLoadQueueMedium.length+e._tileLoadQueueLow.length;(i!==e._lastTileLoadQueueLength||e._tilesInvalidated)&&(t.afterRender.push(b.default.prototype.raiseEvent.bind(e._tileLoadProgressEvent,i)),e._lastTileLoadQueueLength=i);var a=e._debug;a.enableDebugOutput&&!a.suspendLodUpdate&&(a.maxDepth=e._tilesToRender.reduce((function(e,t){return Math.max(e,t.level)}),-1),a.tilesRendered=e._tilesToRender.length,a.tilesVisited===a.lastTilesVisited&&a.tilesRendered===a.lastTilesRendered&&a.tilesCulled===a.lastTilesCulled&&a.maxDepth===a.lastMaxDepth&&a.tilesWaitingForChildren===a.lastTilesWaitingForChildren&&a.maxDepthVisited===a.lastMaxDepthVisited||(console.log("Visited "+a.tilesVisited+", Rendered: "+a.tilesRendered+", Culled: "+a.tilesCulled+", Max Depth Rendered: "+a.maxDepth+", Max Depth Visited: "+a.maxDepthVisited+", Waiting for children: "+a.tilesWaitingForChildren),a.lastTilesVisited=a.tilesVisited,a.lastTilesRendered=a.tilesRendered,a.lastTilesCulled=a.tilesCulled,a.lastMaxDepth=a.maxDepth,a.lastTilesWaitingForChildren=a.tilesWaitingForChildren,a.lastMaxDepthVisited=a.maxDepthVisited))}(this,e))},xi.prototype.isDestroyed=function(){return!1},xi.prototype.destroy=function(){this._tileProvider=this._tileProvider&&this._tileProvider.destroy()};var Ci=new v.default;function Ti(e,t){var i=C.default.center(e.rectangle,Ci),a=i.longitude-bi.longitude,r=i.latitude-bi.latitude,n=(i=C.default.center(t.rectangle,Ci)).longitude-bi.longitude,o=i.latitude-bi.latitude;return a*a+r*r-(n*n+o*o)}var Ei=new a.default,Pi=[];function Ai(e,t,i,a){i.needsLoading&&(void 0!==e.tileProvider.computeTileLoadPriority&&(i._loadPriority=e.tileProvider.computeTileLoadPriority(i,a)),t.push(i))}function Si(){this.allAreRenderable=!0,this.anyWereRenderedLastFrame=!1,this.notYetRenderableCount=0}function Di(){this.southwest=new Si,this.southeast=new Si,this.northwest=new Si,this.northeast=new Si}Di.prototype.combine=function(e){var t=this.southwest,i=this.southeast,a=this.northwest,r=this.northeast;e.allAreRenderable=t.allAreRenderable&&i.allAreRenderable&&a.allAreRenderable&&r.allAreRenderable,e.anyWereRenderedLastFrame=t.anyWereRenderedLastFrame||i.anyWereRenderedLastFrame||a.anyWereRenderedLastFrame||r.anyWereRenderedLastFrame,e.notYetRenderableCount=t.notYetRenderableCount+i.notYetRenderableCount+a.notYetRenderableCount+r.notYetRenderableCount};for(var Ii=new Array(31),Mi=0;Mi<Ii.length;++Mi)Ii[Mi]=new Di;function Fi(e,t,i,a,r){var n=e._debug;++n.tilesVisited,e._tileReplacementQueue.markTileRendered(i),i._updateCustomData(t.frameNumber),i.level>n.maxDepthVisited&&(n.maxDepthVisited=i.level);var s=function(e,t,i){if(t.mode===N.a.SCENE2D||t.camera.frustum instanceof $.a||t.camera.frustum instanceof fi.a)return function(e,t,i){var a=t.camera.frustum;Object(o.default)(a._offCenterFrustum)&&(a=a._offCenterFrustum);var r=t.context,n=r.drawingBufferWidth,s=r.drawingBufferHeight,l=e._tileProvider.getLevelMaximumGeometricError(i.level),u=Math.max(a.top-a.bottom,a.right-a.left)/Math.max(n,s),d=l/u;t.fog.enabled&&t.mode!==N.a.SCENE2D&&(d-=Z.default.fog(i._distance,t.fog.density)*t.fog.sse);return d/=t.pixelRatio}(e,t,i);var a=e._tileProvider.getLevelMaximumGeometricError(i.level),r=i._distance,n=t.context.drawingBufferHeight,s=t.camera.frustum.sseDenominator,l=a*n/(r*s);t.fog.enabled&&(l-=Z.default.fog(r,t.fog.density)*t.fog.sse);return l/=t.pixelRatio}(e,t,i)<e.maximumScreenSpaceError,l=i.southwestChild,u=i.southeastChild,d=i.northwestChild,f=i.northeastChild,c=e._lastSelectionFrameNumber,h=i._lastSelectionResultFrame===c?i._lastSelectionResult:Ye.NONE,m=e.tileProvider;if(s||a){var p=Ye.originalResult(h)===Ye.RENDERED,_=Ye.originalResult(h)===Ye.CULLED||h===Ye.NONE,g=i.state===Te.DONE,v=p||_||g;if(v||Object(o.default)(m.canRenderWithoutLosingDetail)&&(v=m.canRenderWithoutLosingDetail(i)),v)return s&&Ai(e,e._tileLoadQueueMedium,i,t),Ni(e,i),r.allAreRenderable=i.renderable,r.anyWereRenderedLastFrame=h===Ye.RENDERED,r.notYetRenderableCount=i.renderable?0:1,i._lastSelectionResultFrame=t.frameNumber,i._lastSelectionResult=Ye.RENDERED,void(r.anyWereRenderedLastFrame||e._tileToUpdateHeights.push(i));a=!0,s&&Ai(e,e._tileLoadQueueHigh,i,t)}if(m.canRefine(i)){if(l.upsampledFromParent&&u.upsampledFromParent&&d.upsampledFromParent&&f.upsampledFromParent)return Ni(e,i),Ai(e,e._tileLoadQueueMedium,i,t),e._tileReplacementQueue.markTileRendered(l),e._tileReplacementQueue.markTileRendered(u),e._tileReplacementQueue.markTileRendered(d),e._tileReplacementQueue.markTileRendered(f),r.allAreRenderable=i.renderable,r.anyWereRenderedLastFrame=h===Ye.RENDERED,r.notYetRenderableCount=i.renderable?0:1,i._lastSelectionResultFrame=t.frameNumber,i._lastSelectionResult=Ye.RENDERED,void(r.anyWereRenderedLastFrame||e._tileToUpdateHeights.push(i));i._lastSelectionResultFrame=t.frameNumber,i._lastSelectionResult=Ye.REFINED;var y=e._tilesToRender.length,b=e._tileLoadQueueLow.length,w=e._tileLoadQueueMedium.length,x=e._tileLoadQueueHigh.length,O=e._tileToUpdateHeights.length;if(function(e,t,i,a,r,n,o,s){var l=n.camera.positionCartographic,u=e._tileProvider,d=e._occluders,f=Ii[t.level],c=f.southwest,h=f.southeast,m=f.northwest,p=f.northeast;l.longitude<t.rectangle.east?l.latitude<t.rectangle.north?(Ri(e,t,u,n,d,o,c),Ri(e,i,u,n,d,o,h),Ri(e,a,u,n,d,o,m),Ri(e,r,u,n,d,o,p)):(Ri(e,a,u,n,d,o,m),Ri(e,t,u,n,d,o,c),Ri(e,r,u,n,d,o,p),Ri(e,i,u,n,d,o,h)):l.latitude<t.rectangle.north?(Ri(e,i,u,n,d,o,h),Ri(e,t,u,n,d,o,c),Ri(e,r,u,n,d,o,p),Ri(e,a,u,n,d,o,m)):(Ri(e,r,u,n,d,o,p),Ri(e,a,u,n,d,o,m),Ri(e,i,u,n,d,o,h),Ri(e,t,u,n,d,o,c));f.combine(s)}(e,l,u,d,f,t,a,r),y!==e._tilesToRender.length){var C=r.allAreRenderable,T=r.anyWereRenderedLastFrame,E=r.notYetRenderableCount,P=!1;if(!C&&!T){for(var A=e._tilesToRender,S=y;S<A.length;++S)for(var D=A[S];void 0!==D&&D._lastSelectionResult!==Ye.KICKED&&D!==i;)D._lastSelectionResult=Ye.kick(D._lastSelectionResult),D=D.parent;e._tilesToRender.length=y,e._tileToUpdateHeights.length=O,Ni(e,i),i._lastSelectionResult=Ye.RENDERED;var I=h===Ye.RENDERED;!I&&E>e.loadingDescendantLimit&&(e._tileLoadQueueLow.length=b,e._tileLoadQueueMedium.length=w,e._tileLoadQueueHigh.length=x,Ai(e,e._tileLoadQueueMedium,i,t),r.notYetRenderableCount=i.renderable?0:1,P=!0),r.allAreRenderable=i.renderable,r.anyWereRenderedLastFrame=I,I||e._tileToUpdateHeights.push(i),++n.tilesWaitingForChildren}e.preloadAncestors&&!P&&Ai(e,e._tileLoadQueueLow,i,t)}}else i._lastSelectionResultFrame=t.frameNumber,i._lastSelectionResult=Ye.RENDERED,Ni(e,i),Ai(e,e._tileLoadQueueHigh,i,t),r.allAreRenderable=i.renderable,r.anyWereRenderedLastFrame=h===Ye.RENDERED,r.notYetRenderableCount=i.renderable?0:1}function Ri(e,t,i,a,r,n,s){if(i.computeTileVisibility(t,a,r)!==ie.NONE)return Fi(e,a,t,n,s);if(++e._debug.tilesCulled,e._tileReplacementQueue.markTileRendered(t),s.allAreRenderable=!0,s.anyWereRenderedLastFrame=!1,s.notYetRenderableCount=0,function(e,t){var i=t.rectangle;return Object(o.default)(e._cameraPositionCartographic)&&C.default.contains(i,e._cameraPositionCartographic)||Object(o.default)(e._cameraReferenceFrameOriginCartographic)&&C.default.contains(i,e._cameraReferenceFrameOriginCartographic)}(e,t)){Object(o.default)(t.data)&&Object(o.default)(t.data.vertexArray)||Ai(e,e._tileLoadQueueMedium,t,a);var l=e._lastSelectionFrameNumber,u=t._lastSelectionResultFrame===l?t._lastSelectionResult:Ye.NONE;u!==Ye.CULLED_BUT_NEEDED&&u!==Ye.RENDERED&&e._tileToUpdateHeights.push(t),t._lastSelectionResult=Ye.CULLED_BUT_NEEDED}else e.preloadSiblings||0===t.level?(Ai(e,e._tileLoadQueueLow,t,a),t._lastSelectionResult=Ye.CULLED):t._lastSelectionResult=Ye.CULLED;t._lastSelectionResultFrame=a.frameNumber}function Ni(e,t){e._tilesToRender.push(t)}function Li(e,t){return e._loadPriority-t._loadPriority}function ji(e,t,i,a,r,n){void 0!==i.computeTileLoadPriority&&r.sort(Li);for(var o=0,s=r.length;o<s&&(Object(di.default)()<a||!n);++o){var l=r[o];e._tileReplacementQueue.markTileRendered(l),i.loadTile(t,l),n=!0}return n}var Vi=new O.default,Ui=new v.default,zi=new a.default,Bi=[];var Hi=xi;function ki(e){e=Object(n.default)(e,u.default.WGS84);var t=new y.default({ellipsoid:e}),a=new ui;this._ellipsoid=e,this._imageryLayerCollection=a,this._surfaceShaderSet=new V,this._material=void 0,this._surface=new Hi({tileProvider:new ri({terrainProvider:t,imageryLayers:a,surfaceShaderSet:this._surfaceShaderSet})}),this._terrainProvider=t,this._terrainProviderChanged=new b.default,Wi(this),this.show=!0,this._oceanNormalMapResourceDirty=!0,this._oceanNormalMapResource=new T.default({url:i(1663)}),this.maximumScreenSpaceError=2,this.tileCacheSize=100,this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this.fillHighlightColor=void 0,this.enableLighting=!1,this.dynamicAtmosphereLighting=!0,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!0,this.lightingFadeOutDistance=1e7,this.lightingFadeInDistance=2e7,this.nightFadeOutDistance=1e7,this.nightFadeInDistance=5e7,this.showWaterEffect=!0,this.depthTestAgainstTerrain=!1,this.shadows=je.default.RECEIVE_ONLY,this.splitDirection=w.default.NONE,this.atmosphereHueShift=0,this.atmosphereSaturationShift=0,this.atmosphereBrightnessShift=0,this.showSkirts=!0,this.backFaceCulling=!0,this._oceanNormalMap=void 0,this._zoomedOutOceanSpecularIntensity=void 0}function Wi(e){var t=[],i=Object(o.default)(e._material)&&(e._material.shaderSource.match(/slope/)||e._material.shaderSource.match("normalEC")),a=[D];!Object(o.default)(e._material)||i&&!e._terrainProvider.requestVertexNormals?e._surface._tileProvider.uniformMap=void 0:(a.push(e._material.shaderSource),t.push("APPLY_MATERIAL"),e._surface._tileProvider.uniformMap=e._material._uniforms),a.push(A),e._surfaceShaderSet.baseVertexShaderSource=new E.a({sources:[D,S],defines:t}),e._surfaceShaderSet.baseFragmentShaderSource=new E.a({sources:a,defines:t}),e._surfaceShaderSet.material=e._material}function Gi(e){return function(t,i){return g.default.distanceSquaredTo(t.data.pickBoundingSphere,e)-g.default.distanceSquaredTo(i.data.pickBoundingSphere,e)}}Object.defineProperties(ki.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},imageryLayers:{get:function(){return this._imageryLayerCollection}},imageryLayersUpdatedEvent:{get:function(){return this._surface.tileProvider.imageryLayersUpdatedEvent}},tilesLoaded:{get:function(){return!Object(o.default)(this._surface)||this._surface.tileProvider.ready&&0===this._surface._tileLoadQueueHigh.length&&0===this._surface._tileLoadQueueMedium.length&&0===this._surface._tileLoadQueueLow.length}},baseColor:{get:function(){return this._surface.tileProvider.baseColor},set:function(e){this._surface.tileProvider.baseColor=e}},clippingPlanes:{get:function(){return this._surface.tileProvider.clippingPlanes},set:function(e){this._surface.tileProvider.clippingPlanes=e}},cartographicLimitRectangle:{get:function(){return this._surface.tileProvider.cartographicLimitRectangle},set:function(e){Object(o.default)(e)||(e=C.default.clone(C.default.MAX_VALUE)),this._surface.tileProvider.cartographicLimitRectangle=e}},oceanNormalMapUrl:{get:function(){return this._oceanNormalMapResource.url},set:function(e){this._oceanNormalMapResource.url=e,this._oceanNormalMapResourceDirty=!0}},terrainProvider:{get:function(){return this._terrainProvider},set:function(e){e!==this._terrainProvider&&(this._terrainProvider=e,this._terrainProviderChanged.raiseEvent(e),Object(o.default)(this._material)&&Wi(this))}},terrainProviderChanged:{get:function(){return this._terrainProviderChanged}},tileLoadProgressEvent:{get:function(){return this._surface.tileLoadProgressEvent}},material:{get:function(){return this._material},set:function(e){this._material!==e&&(this._material=e,Wi(this))}}});var Yi=[],Xi={start:0,stop:0};ki.prototype.pickWorldCoordinates=function(e,t,i){var r=t.mode,n=t.mapProjection,s=Yi;s.length=0;var l,u,d,f=this._surface._tilesToRender,c=f.length;for(u=0;u<c;++u){var h=(l=f[u]).data;if(Object(o.default)(h)){var m=h.pickBoundingSphere;if(r!==N.a.SCENE3D)h.pickBoundingSphere=m=g.default.fromRectangleWithHeights2D(l.rectangle,n,h.tileBoundingRegion.minimumHeight,h.tileBoundingRegion.maximumHeight,m),a.default.fromElements(m.center.z,m.center.x,m.center.y,m.center);else{if(!Object(o.default)(h.renderedMesh))continue;g.default.clone(h.renderedMesh.boundingSphere3D,m)}var p=x.default.raySphere(e,m,Xi);Object(o.default)(p)&&s.push(l)}}for(s.sort(Gi(e.origin)),c=s.length,u=0;u<c&&(d=s[u].data.pick(e,t.mode,t.mapProjection,!0,i),!Object(o.default)(d));++u);return d},ki.prototype.pickTriangle=function(e,t,i){var r=t.mode,n=t.mapProjection,s=Yi;s.length=0;var l,u,d,f=this._surface._tilesToRender,c=f.length;for(u=0;u<c;++u){var h=(l=f[u]).data;if(Object(o.default)(h)){var m=h.pickBoundingSphere;r!==N.a.SCENE3D?(g.default.fromRectangleWithHeights2D(l.rectangle,n,h.minimumHeight,h.maximumHeight,m),a.default.fromElements(m.center.z,m.center.x,m.center.y,m.center)):g.default.clone(h.boundingSphere3D,m);var p=x.default.raySphere(e,m,Xi);Object(o.default)(p)&&s.push(l)}}for(s.sort(Gi(e.origin)),c=s.length,u=0;u<c;++u)if(d=s[u].data.pickTriangle(e,t.mode,t.mapProjection,!0,i),Object(o.default)(d)){d.tile=s[u];break}return d};var Qi=new v.default;ki.prototype.pick=function(e,t,i){if(i=this.pickWorldCoordinates(e,t,i),Object(o.default)(i)&&t.mode!==N.a.SCENE3D){i=a.default.fromElements(i.y,i.z,i.x,i);var r=t.mapProjection.unproject(i,Qi);i=t.globe.ellipsoid.cartographicToCartesian(r,i)}return i};var qi=new a.default,Zi=new a.default,Ki=new v.default,Ji=new O.default;function $i(e,t){return Object(o.default)(e)&&C.default.contains(e.rectangle,t)?e:void 0}ki.prototype.getHeight=function(e){var t=this._surface._levelZeroTiles;if(Object(o.default)(t)){var i,r,s=t.length;for(r=0;r<s&&(i=t[r],!C.default.contains(i.rectangle,e));++r);if(!(r>=s)){for(var l=i;Object(o.default)(i);)i=$i(i._southwestChild,e)||$i(i._southeastChild,e)||$i(i._northwestChild,e)||i._northeastChild,Object(o.default)(i)&&Object(o.default)(i.data)&&Object(o.default)(i.data.renderedMesh)&&(l=i);if(i=l,Object(o.default)(i)){var u=this._surface._tileProvider.tilingScheme.ellipsoid,d=a.default.fromRadians(e.longitude,e.latitude,0,u,qi),f=Ji,c=u.geodeticSurfaceNormal(d,f.direction),h=u.getSurfaceNormalIntersectionWithZAxis(d,11500,f.origin);if(!Object(o.default)(h)){var m;Object(o.default)(i.data.tileBoundingRegion)&&(m=i.data.tileBoundingRegion.minimumHeight);var p=Math.min(Object(n.default)(m,0),-11500),_=a.default.multiplyByScalar(c,Math.abs(p)+1,Zi);a.default.subtract(d,_,f.origin)}var g=i.data.pick(f,void 0,void 0,!1,Zi);if(Object(o.default)(g))return u.cartesianToCartographic(g,Ki).height}}}},ki.prototype.update=function(e){this.show&&e.passes.render&&this._surface.update(e)},ki.prototype.beginFrame=function(e){var t=this._surface,i=t.tileProvider,a=this.terrainProvider,r=this.showWaterEffect&&a.ready&&a.hasWaterMask;if(r&&this._oceanNormalMapResourceDirty){this._oceanNormalMapResourceDirty=!1;var n=this._oceanNormalMapResource,s=n.url;if(Object(o.default)(s)){var l=this;Object(I.default)(n.fetchImage(),(function(t){s===l._oceanNormalMapResource.url&&(l._oceanNormalMap=l._oceanNormalMap&&l._oceanNormalMap.destroy(),l._oceanNormalMap=new P.a({context:e.context,source:t}))}))}else this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy()}var u=e.passes,d=e.mode;u.render&&(this.showGroundAtmosphere?this._zoomedOutOceanSpecularIntensity=.4:this._zoomedOutOceanSpecularIntensity=.5,t.maximumScreenSpaceError=this.maximumScreenSpaceError,t.tileCacheSize=this.tileCacheSize,t.loadingDescendantLimit=this.loadingDescendantLimit,t.preloadAncestors=this.preloadAncestors,t.preloadSiblings=this.preloadSiblings,i.terrainProvider=this.terrainProvider,i.lightingFadeOutDistance=this.lightingFadeOutDistance,i.lightingFadeInDistance=this.lightingFadeInDistance,i.nightFadeOutDistance=this.nightFadeOutDistance,i.nightFadeInDistance=this.nightFadeInDistance,i.zoomedOutOceanSpecularIntensity=d===N.a.SCENE3D?this._zoomedOutOceanSpecularIntensity:0,i.hasWaterMask=r,i.oceanNormalMap=this._oceanNormalMap,i.enableLighting=this.enableLighting,i.dynamicAtmosphereLighting=this.dynamicAtmosphereLighting,i.dynamicAtmosphereLightingFromSun=this.dynamicAtmosphereLightingFromSun,i.showGroundAtmosphere=this.showGroundAtmosphere,i.shadows=this.shadows,i.splitDirection=this.splitDirection,i.hueShift=this.atmosphereHueShift,i.saturationShift=this.atmosphereSaturationShift,i.brightnessShift=this.atmosphereBrightnessShift,i.fillHighlightColor=this.fillHighlightColor,i.showSkirts=this.showSkirts,i.backFaceCulling=this.backFaceCulling,t.beginFrame(e))},ki.prototype.render=function(e){this.show&&(Object(o.default)(this._material)&&this._material.update(e.context),this._surface.render(e))},ki.prototype.endFrame=function(e){this.show&&e.passes.render&&this._surface.endFrame(e)},ki.prototype.isDestroyed=function(){return!1},ki.prototype.destroy=function(){return this._surfaceShaderSet=this._surfaceShaderSet&&this._surfaceShaderSet.destroy(),this._surface=this._surface&&this._surface.destroy(),this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy(),Object(s.default)(this)};var ea=ki;var ta=function(e,t,i,a){this.rightAscension=e,this.declination=t,this.rotation=i,this.rotationRate=a},ia=i(42),aa=i(198),ra={},na=-.0529921,oa=-.1059842,sa=13.0120009,la=13.3407154,ua=26.4057084,da=13.064993,fa=1.7484877,ca=new ia.default;ra.ComputeMoon=function(e,t){Object(o.default)(e)||(e=ia.default.now()),ca=ia.default.addSeconds(e,32.184,ca);var i=ia.default.totalDays(ca)-2451545,a=i/aa.a.DAYS_PER_JULIAN_CENTURY,r=(125.045+na*i)*Z.default.RADIANS_PER_DEGREE,n=(250.089+oa*i)*Z.default.RADIANS_PER_DEGREE,s=(260.008+sa*i)*Z.default.RADIANS_PER_DEGREE,l=(176.625+la*i)*Z.default.RADIANS_PER_DEGREE,u=(357.529+.9856003*i)*Z.default.RADIANS_PER_DEGREE,d=(311.589+ua*i)*Z.default.RADIANS_PER_DEGREE,f=(134.963+da*i)*Z.default.RADIANS_PER_DEGREE,c=(276.617+.3287146*i)*Z.default.RADIANS_PER_DEGREE,h=(34.226+fa*i)*Z.default.RADIANS_PER_DEGREE,m=(15.134+-.1589763*i)*Z.default.RADIANS_PER_DEGREE,p=(119.743+.0036096*i)*Z.default.RADIANS_PER_DEGREE,_=(239.961+.1643573*i)*Z.default.RADIANS_PER_DEGREE,g=(25.053+12.9590088*i)*Z.default.RADIANS_PER_DEGREE,v=Math.sin(r),y=Math.sin(n),b=Math.sin(s),w=Math.sin(l),x=Math.sin(u),O=Math.sin(d),C=Math.sin(f),T=Math.sin(c),E=Math.sin(h),P=Math.sin(m),A=Math.sin(p),S=Math.sin(_),D=Math.sin(g),I=Math.cos(r),M=Math.cos(n),F=Math.cos(s),R=Math.cos(l),N=Math.cos(u),L=Math.cos(d),j=Math.cos(f),V=Math.cos(c),U=Math.cos(h),z=Math.cos(m),B=Math.cos(p),H=Math.cos(_),k=Math.cos(g),W=(269.9949+.0031*a-3.8787*v-.1204*y+.07*b-.0172*w+.0072*O-.0052*P+.0043*D)*Z.default.RADIANS_PER_DEGREE,G=(66.5392+.013*a+1.5419*I+.0239*M-.0278*F+.0068*R-.0029*L+9e-4*j+8e-4*z-9e-4*k)*Z.default.RADIANS_PER_DEGREE,Y=(38.3213+13.17635815*i-14e-13*i*i+3.561*v+.1208*y-.0642*b+.0158*w+.0252*x-.0066*O-.0047*C-.0046*T+.0028*E+.0052*P+.004*A+.0019*S-.0044*D)*Z.default.RADIANS_PER_DEGREE,X=(13.17635815-2*i*14e-13+3.561*I*na+.1208*M*oa-.0642*F*sa+.0158*R*la+.0252*N*.9856003-.0066*L*ua-.0047*j*da-.0046*V*.3287146+.0028*U*fa+.0052*z*-.1589763+.004*B*.0036096+.0019*H*.1643573-.0044*k*12.9590088)/86400*Z.default.RADIANS_PER_DEGREE;return Object(o.default)(t)||(t=new ta),t.rightAscension=W,t.declination=G,t.rotation=Y,t.rotationRate=X,t};var ha=ra,ma=i(43),pa=i(54);function _a(e){Object(o.default)(e)&&"function"==typeof e||(e=ha.ComputeMoon),this._computeFunction=e}var ga=new a.default,va=new a.default,ya=new a.default;var ba=new ma.default,wa=new pa.default;_a.prototype.evaluate=function(e,t){Object(o.default)(e)||(e=ia.default.now());var i=this._computeFunction(e),r=function(e,t,i){var r=ga;r.x=Math.cos(e+Z.default.PI_OVER_TWO),r.y=Math.sin(e+Z.default.PI_OVER_TWO),r.z=0;var n=Math.cos(t),s=ya;s.x=n*Math.cos(e),s.y=n*Math.sin(e),s.z=Math.sin(t);var l=a.default.cross(s,r,va);return Object(o.default)(i)||(i=new ma.default),i[0]=r.x,i[1]=l.x,i[2]=s.x,i[3]=r.y,i[4]=l.y,i[5]=s.y,i[6]=r.z,i[7]=l.z,i[8]=s.z,i}(i.rightAscension,i.declination,t),n=Z.default.zeroToTwoPi(i.rotation),s=pa.default.fromAxisAngle(a.default.UNIT_Z,n,wa),l=ma.default.fromQuaternion(pa.default.conjugate(s,s),ba);return ma.default.multiply(l,r,r)};var xa=_a,Oa=i(298),Ca={};var Ta=32.184,Ea=2451545;function Pa(e,t){t=ia.default.addSeconds(e,Ta,t);var i,a=ia.default.totalDays(t)-Ea;return t=ia.default.addSeconds(t,(i=6.239996+.0172019696544*a,.001657*Math.sin(i+.01671*Math.sin(i))),t)}var Aa=new ia.default(2451545,0,Oa.a.TAI),Sa=1e3,Da=Z.default.RADIANS_PER_DEGREE,Ia=Z.default.RADIANS_PER_ARCSECOND,Ma=new ma.default;function Fa(e,t,i,r,n,s,l){i<0&&(i=-i,n+=Z.default.PI);var u=e*(1-t),d=r-n,f=n,c=function(e,t){return function(e,t){var i=Math.floor(e/Z.default.TWO_PI);e-=i*Z.default.TWO_PI;var a=Math.cos(e)-t,r=Math.sin(e)*Math.sqrt(1-t*t),n=Math.atan2(r,a);n=Z.default.zeroToTwoPi(n),e<0&&(n-=Z.default.TWO_PI);return n+=i*Z.default.TWO_PI}(function(e,t){var i,a=Math.floor(e/Z.default.TWO_PI),r=(e-=a*Z.default.TWO_PI)+t*Math.sin(e)/(1-Math.sin(e+t)+Math.sin(e)),n=Number.MAX_VALUE;for(i=0;i<Ra&&Math.abs(n-r)>Na;++i){var o=(n=r)-t*Math.sin(n)-e,s=1-t*Math.cos(n);r=n-o/s}return n=r+a*Z.default.TWO_PI}(e,t),t)}(s-r,t);!function(e,t){if(e<=t)return"Circular";if(e<1-t)return"Elliptical";if(e<=1+t)return"Parabolic"}(t,0);!function(e,t,i,a){var r=Math.cos(e),n=Math.sin(e),s=Math.cos(t),l=Math.sin(t),u=Math.cos(i),d=Math.sin(i);Object(o.default)(a)?(a[0]=u*r-d*n*s,a[1]=d*r+u*n*s,a[2]=n*l,a[3]=-u*n-d*r*s,a[4]=-d*n+u*r*s,a[5]=r*l,a[6]=d*l,a[7]=-u*l,a[8]=s):a=new ma.default(u*r-d*n*s,-u*n-d*r*s,d*l,d*r+u*n*s,-d*n+u*r*s,-u*l,n*l,r*l,s)}(d,i,f,Ma);var h=u*(1+t),m=Math.cos(c),p=Math.sin(c),_=h/(1+t*m);return Object(o.default)(l)?(l.x=_*m,l.y=_*p,l.z=0):l=new a.default(_*m,_*p,0),ma.default.multiplyByVector(Ma,l,l)}var Ra=50,Na=Z.default.EPSILON8;var La=149598022260.7121,ja=100.46645683*Da,Va=1295977422.83429*Ia,Ua=16002,za=21863,Ba=32004,Ha=10931,ka=14529,Wa=16368,Ga=15318,Ya=32794,Xa=64e-7*14959787e4,Qa=-2273887.624,qa=927506.794,Za=14959787e4*-8e-7,Ka=32e-7*14959787e4,Ja=-613351.267,$a=284235.953,er=-164557.657,tr=-2243968.05,ir=-688150.202,ar=1017265.516,rr=807828.498,nr=14e-7*14959787e4,or=359034.888,sr=14959787e4*-28e-7,lr=329115.314,ur=10,dr=16002,fr=21863,cr=10931,hr=1473,mr=32004,pr=4387,_r=73,gr=-325e-7,vr=-322e-7,yr=1e-7*-79,br=232*1e-7,wr=1e-7*-52,xr=97e-7,Or=55e-7,Cr=-41e-7,Tr=-105e-7,Er=-137e-7,Pr=258e-7,Ar=35e-7,Sr=1e-7*-116,Dr=-88e-7,Ir=-112e-7,Mr=-8e-6,Fr=new ia.default(0,0,Oa.a.TAI);function Rr(e,t){Pa(e,Fr);var i=(Fr.dayNumber-Aa.dayNumber+(Fr.secondsOfDay-Aa.secondsOfDay)/aa.a.SECONDS_PER_DAY)/aa.a.DAYS_PER_JULIAN_CENTURY,a=i*i,r=a*i,n=r*i,o=383397.7725+.004*i,s=.055545526-16e-9*i,l=5.15668983*Da,u=-8e-5*i+.02966*a-42e-6*r-13e-8*n,d=83.35324312*Da,f=14643420.2669*i-38.2702*a-.045047*r+21301e-8*n,c=125.04455501*Da,h=-6967919.3631*i+6.3602*a+.007625*r-3586e-8*n,m=218.31664563*Da,p=1732559343.4847*i-6.391*a+.006588*r-3169e-8*n,_=297.85019547*Da+Ia*(1602961601.209*i-6.3706*a+.006593*r-3169e-8*n),g=134.96340251*Da+Ia*(1717915923.2178*i+31.8792*a+.051635*r-2447e-7*n),v=357.52910918*Da+Ia*(129596581.0481*i-.5532*a+136e-6*r-1149e-8*n),y=310.17137918*Da-Ia*(6967051.436*i+6.2068*a+.007618*r-3219e-8*n),b=2*_,w=4*_,x=6*_,O=2*g,C=3*g,T=4*g,E=2*(93.27209062*Da+Ia*(1739527262.8478*i-12.7512*a-.001037*r+417e-8*n));o+=3400.4*Math.cos(b)-635.6*Math.cos(b-g)-235.6*Math.cos(g)+218.1*Math.cos(b-v)+181*Math.cos(b+g),s+=.014216*Math.cos(b-g)+.008551*Math.cos(b-O)-.001383*Math.cos(g)+.001356*Math.cos(b+g)-.001147*Math.cos(w-C)-914e-6*Math.cos(w-O)+869e-6*Math.cos(b-v-g)-627e-6*Math.cos(b)-394e-6*Math.cos(w-T)+282e-6*Math.cos(b-v-O)-279e-6*Math.cos(_-g)-236e-6*Math.cos(O)+231e-6*Math.cos(w)+229e-6*Math.cos(x-T)-201e-6*Math.cos(O-E),u+=486.26*Math.cos(b-E)-40.13*Math.cos(b)+37.51*Math.cos(E)+25.73*Math.cos(O-E)+19.97*Math.cos(b-v-E),f+=-55609*Math.sin(b-g)-34711*Math.sin(b-O)-9792*Math.sin(g)+9385*Math.sin(w-C)+7505*Math.sin(w-O)+5318*Math.sin(b+g)+3484*Math.sin(w-T)-3417*Math.sin(b-v-g)-2530*Math.sin(x-T)-2376*Math.sin(b)-2075*Math.sin(b-C)-1883*Math.sin(O)-1736*Math.sin(x-5*g)+1626*Math.sin(v)-1370*Math.sin(x-C),h+=-5392*Math.sin(b-E)-540*Math.sin(v)-441*Math.sin(b)+423*Math.sin(E)-288*Math.sin(O-E),p+=-3332.9*Math.sin(b)+1197.4*Math.sin(b-g)-662.5*Math.sin(v)+396.3*Math.sin(g)-218*Math.sin(b-v);var P=2*y,A=3*y;u+=46.997*Math.cos(y)*i-.614*Math.cos(b-E+y)*i+.614*Math.cos(b-E-y)*i-.0297*Math.cos(P)*a-.0335*Math.cos(y)*a+.0012*Math.cos(b-E+P)*a-16e-5*Math.cos(y)*r+4e-5*Math.cos(A)*r+4e-5*Math.cos(P)*r;var S=2.116*Math.sin(y)*i-.111*Math.sin(b-E-y)*i-.0015*Math.sin(y)*a;return f+=S,p+=S,h+=-520.77*Math.sin(y)*i+13.66*Math.sin(b-E+y)*i+1.12*Math.sin(b-y)*i-1.06*Math.sin(E-y)*i+.66*Math.sin(P)*a+.371*Math.sin(y)*a-.035*Math.sin(b-E+P)*a-.015*Math.sin(b-E+y)*a+.0014*Math.sin(y)*r-.0011*Math.sin(A)*r-9e-4*Math.sin(P)*r,Fa(o*=Sa,s,l+u*Ia,d+f*Ia,c+h*Ia,m+p*Ia,t)}var Nr=-.01215058143522694;var Lr=new ma.default(1.0000000000000002,5619723173785822e-31,4690511510146299e-34,-5154129427414611e-31,.9174820620691819,-.39777715593191376,-223970096136568e-30,.39777715593191376,.9174820620691819),jr=new a.default;Ca.computeSunPositionInEarthInertialFrame=function(e,t){return Object(o.default)(e)||(e=ia.default.now()),Object(o.default)(t)||(t=new a.default),jr=function(e,t){Pa(e,Fr);var i=(Fr.dayNumber-Aa.dayNumber+(Fr.secondsOfDay-Aa.secondsOfDay)/aa.a.SECONDS_PER_DAY)/(10*aa.a.DAYS_PER_JULIAN_CENTURY),a=.3595362*i,r=La+Xa*Math.cos(Ua*a)+tr*Math.sin(Ua*a)+Qa*Math.cos(za*a)+ir*Math.sin(za*a)+qa*Math.cos(Ba*a)+ar*Math.sin(Ba*a)+Za*Math.cos(Ha*a)+rr*Math.sin(Ha*a)+Ka*Math.cos(ka*a)+nr*Math.sin(ka*a)+Ja*Math.cos(Wa*a)+or*Math.sin(Wa*a)+$a*Math.cos(Ga*a)+sr*Math.sin(Ga*a)+er*Math.cos(Ya*a)+lr*Math.sin(Ya*a),n=ja+Va*i+gr*Math.cos(ur*a)+Tr*Math.sin(ur*a)+vr*Math.cos(dr*a)+Er*Math.sin(dr*a)+yr*Math.cos(fr*a)+Pr*Math.sin(fr*a)+br*Math.cos(cr*a)+Ar*Math.sin(cr*a)+wr*Math.cos(hr*a)+Sr*Math.sin(hr*a)+xr*Math.cos(mr*a)+Dr*Math.sin(mr*a)+Or*Math.cos(pr*a)+Ir*Math.sin(pr*a)+Cr*Math.cos(_r*a)+Mr*Math.sin(_r*a);return Fa(r,.0167086342-.0004203654*i,469.97289*Ia*i,102.93734808*Da+11612.3529*Ia*i,174.87317577*Da-8679.27034*Ia*i,n,t)}(e,jr),t=a.default.negate(jr,t),function(e,t){t=Rr(e,t),a.default.multiplyByScalar(t,Nr,t)}(e,jr),a.default.subtract(t,jr,t),ma.default.multiplyByVector(Lr,t,t),t},Ca.computeMoonPositionInEarthInertialFrame=function(e,t){return Object(o.default)(e)||(e=ia.default.now()),t=Rr(e,t),ma.default.multiplyByVector(Lr,t,t),t};var Vr=Ca,Ur=i(62),zr=i(369),Br=i(78),Hr="#ifdef WRITE_DEPTH\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n#endif\n\nuniform vec3 u_radii;\nuniform vec3 u_oneOverEllipsoidRadiiSquared;\n\nvarying vec3 v_positionEC;\n\nvec4 computeEllipsoidColor(czm_ray ray, float intersection, float side)\n{\n    vec3 positionEC = czm_pointAlongRay(ray, intersection);\n    vec3 positionMC = (czm_inverseModelView * vec4(positionEC, 1.0)).xyz;\n    vec3 geodeticNormal = normalize(czm_geodeticSurfaceNormal(positionMC, vec3(0.0), u_oneOverEllipsoidRadiiSquared));\n    vec3 sphericalNormal = normalize(positionMC / u_radii);\n    vec3 normalMC = geodeticNormal * side;              // normalized surface normal (always facing the viewer) in model coordinates\n    vec3 normalEC = normalize(czm_normal * normalMC);   // normalized surface normal in eye coordiantes\n\n    vec2 st = czm_ellipsoidWgs84TextureCoordinates(sphericalNormal);\n    vec3 positionToEyeEC = -positionEC;\n\n    czm_materialInput materialInput;\n    materialInput.s = st.s;\n    materialInput.st = st;\n    materialInput.str = (positionMC + u_radii) / u_radii;\n    materialInput.normalEC = normalEC;\n    materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(positionMC, normalEC);\n    materialInput.positionToEyeEC = positionToEyeEC;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef ONLY_SUN_LIGHTING\n    return czm_private_phong(normalize(positionToEyeEC), material, czm_sunDirectionEC);\n#else\n    return czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n\nvoid main()\n{\n    // PERFORMANCE_TODO: When dynamic branching is available, compute ratio of maximum and minimum radii\n    // in the vertex shader. Only when it is larger than some constant, march along the ray.\n    // Otherwise perform one intersection test which will be the common case.\n\n    // Test if the ray intersects a sphere with the ellipsoid's maximum radius.\n    // For very oblate ellipsoids, using the ellipsoid's radii for an intersection test\n    // may cause false negatives. This will discard fragments before marching the ray forward.\n    float maxRadius = max(u_radii.x, max(u_radii.y, u_radii.z)) * 1.5;\n    vec3 direction = normalize(v_positionEC);\n    vec3 ellipsoidCenter = czm_modelView[3].xyz;\n\n    float t1 = -1.0;\n    float t2 = -1.0;\n\n    float b = -2.0 * dot(direction, ellipsoidCenter);\n    float c = dot(ellipsoidCenter, ellipsoidCenter) - maxRadius * maxRadius;\n\n    float discriminant = b * b - 4.0 * c;\n    if (discriminant >= 0.0) {\n        t1 = (-b - sqrt(discriminant)) * 0.5;\n        t2 = (-b + sqrt(discriminant)) * 0.5;\n    }\n\n    if (t1 < 0.0 && t2 < 0.0) {\n        discard;\n    }\n\n    float t = min(t1, t2);\n    if (t < 0.0) {\n        t = 0.0;\n    }\n\n    // March ray forward to intersection with larger sphere and find\n    czm_ray ray = czm_ray(t * direction, direction);\n\n    vec3 ellipsoid_inverseRadii = vec3(1.0 / u_radii.x, 1.0 / u_radii.y, 1.0 / u_radii.z);\n\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoidCenter, ellipsoid_inverseRadii);\n\n    if (czm_isEmpty(intersection))\n    {\n        discard;\n    }\n\n    // If the viewer is outside, compute outsideFaceColor, with normals facing outward.\n    vec4 outsideFaceColor = (intersection.start != 0.0) ? computeEllipsoidColor(ray, intersection.start, 1.0) : vec4(0.0);\n\n    // If the viewer either is inside or can see inside, compute insideFaceColor, with normals facing inward.\n    vec4 insideFaceColor = (outsideFaceColor.a < 1.0) ? computeEllipsoidColor(ray, intersection.stop, -1.0) : vec4(0.0);\n\n    gl_FragColor = mix(insideFaceColor, outsideFaceColor, outsideFaceColor.a);\n    gl_FragColor.a = 1.0 - (1.0 - insideFaceColor.a) * (1.0 - outsideFaceColor.a);\n\n#ifdef WRITE_DEPTH\n#ifdef GL_EXT_frag_depth\n    t = (intersection.start != 0.0) ? intersection.start : intersection.stop;\n    vec3 positionEC = czm_pointAlongRay(ray, t);\n    vec4 positionCC = czm_projection * vec4(positionEC, 1.0);\n#ifdef LOG_DEPTH\n    czm_writeLogDepth(1.0 + positionCC.w);\n#else\n    float z = positionCC.z / positionCC.w;\n\n    float n = czm_depthRange.near;\n    float f = czm_depthRange.far;\n\n    gl_FragDepthEXT = (z * (f - n) + f + n) * 0.5;\n#endif\n#endif\n#endif\n}\n",kr="attribute vec3 position;\n\nuniform vec3 u_radii;\n\nvarying vec3 v_positionEC;\n\nvoid main()\n{\n    // In the vertex data, the cube goes from (-1.0, -1.0, -1.0) to (1.0, 1.0, 1.0) in model coordinates.\n    // Scale to consider the radii.  We could also do this once on the CPU when using the BoxGeometry,\n    // but doing it here allows us to change the radii without rewriting the vertex data, and\n    // allows all ellipsoids to reuse the same vertex data.\n    vec4 p = vec4(u_radii * position, 1.0);\n\n    v_positionEC = (czm_modelView * p).xyz;     // position in eye coordinates\n    gl_Position = czm_modelViewProjection * p;  // position in clip coordinates\n\n    // With multi-frustum, when the ellipsoid primitive is positioned on the intersection of two frustums\n    // and close to terrain, the terrain (writes depth) in the closest frustum can overwrite part of the\n    // ellipsoid (does not write depth) that was rendered in the farther frustum.\n    //\n    // Here, we clamp the depth in the vertex shader to avoid being overwritten; however, this creates\n    // artifacts since some fragments can be alpha blended twice.  This is solved by only rendering\n    // the ellipsoid in the closest frustum to the viewer.\n    gl_Position.z = clamp(gl_Position.z, czm_depthRange.near, czm_depthRange.far);\n\n    czm_vertexLogDepth();\n}\n",Wr=i(203),Gr=i(217),Yr={position:0};function Xr(e){e=Object(n.default)(e,n.default.EMPTY_OBJECT),this.center=a.default.clone(Object(n.default)(e.center,a.default.ZERO)),this._center=new a.default,this.radii=a.default.clone(e.radii),this._radii=new a.default,this._oneOverEllipsoidRadiiSquared=new a.default,this._boundingSphere=new g.default,this.modelMatrix=K.default.clone(Object(n.default)(e.modelMatrix,K.default.IDENTITY)),this._modelMatrix=new K.default,this._computedModelMatrix=new K.default,this.show=Object(n.default)(e.show,!0),this.material=Object(n.default)(e.material,Gr.a.fromType(Gr.a.ColorType)),this._material=void 0,this._translucent=void 0,this.id=e.id,this._id=void 0,this.debugShowBoundingVolume=Object(n.default)(e.debugShowBoundingVolume,!1),this.onlySunLighting=Object(n.default)(e.onlySunLighting,!1),this._onlySunLighting=!1,this._depthTestEnabled=Object(n.default)(e.depthTestEnabled,!0),this._useLogDepth=!1,this._sp=void 0,this._rs=void 0,this._va=void 0,this._pickSP=void 0,this._pickId=void 0,this._colorCommand=new se.a({owner:Object(n.default)(e._owner,this)}),this._pickCommand=new se.a({owner:Object(n.default)(e._owner,this),pickOnly:!0});var t=this;this._uniforms={u_radii:function(){return t.radii},u_oneOverEllipsoidRadiiSquared:function(){return t._oneOverEllipsoidRadiiSquared}},this._pickUniforms={czm_pickColor:function(){return t._pickId.color}}}var Qr="#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n";Xr.prototype.update=function(e){if(this.show&&e.mode===N.a.SCENE3D&&Object(o.default)(this.center)&&Object(o.default)(this.radii)){var t=e.context,i=this.material.isTranslucent(),r=this._translucent!==i;Object(o.default)(this._rs)&&!r||(this._translucent=i,this._rs=ue.a.fromCache({cull:{enabled:!0,face:Wr.a.FRONT},depthTest:{enabled:this._depthTestEnabled},depthMask:!i&&t.fragmentDepth,blending:i?fe.a.ALPHA_BLEND:void 0})),Object(o.default)(this._va)||(this._va=function(e){var t=e.cache.ellipsoidPrimitive_vertexArray;if(Object(o.default)(t))return t;var i=zr.a.createGeometry(zr.a.fromDimensions({dimensions:new a.default(2,2,2),vertexFormat:Br.default.POSITION_ONLY}));return t=de.a.fromGeometry({context:e,geometry:i,attributeLocations:Yr,bufferUsage:ne.a.STATIC_DRAW,interleave:!0}),e.cache.ellipsoidPrimitive_vertexArray=t,t}(t));var n=!1,s=this.radii;if(!a.default.equals(this._radii,s)){a.default.clone(s,this._radii);var l=this._oneOverEllipsoidRadiiSquared;l.x=1/(s.x*s.x),l.y=1/(s.y*s.y),l.z=1/(s.z*s.z),n=!0}K.default.equals(this.modelMatrix,this._modelMatrix)&&a.default.equals(this.center,this._center)||(K.default.clone(this.modelMatrix,this._modelMatrix),a.default.clone(this.center,this._center),K.default.multiplyByTranslation(this.modelMatrix,this.center,this._computedModelMatrix),n=!0),n&&(a.default.clone(a.default.ZERO,this._boundingSphere.center),this._boundingSphere.radius=a.default.maximumComponent(s),g.default.transform(this._boundingSphere,this._computedModelMatrix,this._boundingSphere));var u=this._material!==this.material;this._material=this.material,this._material.update(t);var d=this.onlySunLighting!==this._onlySunLighting;this._onlySunLighting=this.onlySunLighting;var f=e.useLogDepth,c=this._useLogDepth!==f;this._useLogDepth=f;var h,m,p=this._colorCommand;(u||d||r||c)&&(h=new E.a({sources:[kr]}),m=new E.a({sources:[this.material.shaderSource,Hr]}),this.onlySunLighting&&m.defines.push("ONLY_SUN_LIGHTING"),!i&&t.fragmentDepth&&m.defines.push("WRITE_DEPTH"),this._useLogDepth&&(h.defines.push("LOG_DEPTH"),m.defines.push("LOG_DEPTH"),m.sources.push(Qr)),this._sp=F.a.replaceCache({context:t,shaderProgram:this._sp,vertexShaderSource:h,fragmentShaderSource:m,attributeLocations:Yr}),p.vertexArray=this._va,p.renderState=this._rs,p.shaderProgram=this._sp,p.uniformMap=Object(G.default)(this._uniforms,this.material._uniforms),p.executeInClosestFrustum=i);var _=e.commandList,v=e.passes;if(v.render&&(p.boundingVolume=this._boundingSphere,p.debugShowBoundingVolume=this.debugShowBoundingVolume,p.modelMatrix=this._computedModelMatrix,p.pass=i?le.a.TRANSLUCENT:le.a.OPAQUE,_.push(p)),v.pick){var y=this._pickCommand;Object(o.default)(this._pickId)&&this._id===this.id||(this._id=this.id,this._pickId=this._pickId&&this._pickId.destroy(),this._pickId=t.createPickId({primitive:this,id:this.id})),(u||d||!Object(o.default)(this._pickSP)||c)&&(h=new E.a({sources:[kr]}),m=new E.a({sources:[this.material.shaderSource,Hr],pickColorQualifier:"uniform"}),this.onlySunLighting&&m.defines.push("ONLY_SUN_LIGHTING"),!i&&t.fragmentDepth&&m.defines.push("WRITE_DEPTH"),this._useLogDepth&&(h.defines.push("LOG_DEPTH"),m.defines.push("LOG_DEPTH"),m.sources.push(Qr)),this._pickSP=F.a.replaceCache({context:t,shaderProgram:this._pickSP,vertexShaderSource:h,fragmentShaderSource:m,attributeLocations:Yr}),y.vertexArray=this._va,y.renderState=this._rs,y.shaderProgram=this._pickSP,y.uniformMap=Object(G.default)(Object(G.default)(this._uniforms,this._pickUniforms),this.material._uniforms),y.executeInClosestFrustum=i),y.boundingVolume=this._boundingSphere,y.modelMatrix=this._computedModelMatrix,y.pass=i?le.a.TRANSLUCENT:le.a.OPAQUE,_.push(y)}}},Xr.prototype.isDestroyed=function(){return!1},Xr.prototype.destroy=function(){return this._sp=this._sp&&this._sp.destroy(),this._pickSP=this._pickSP&&this._pickSP.destroy(),this._pickId=this._pickId&&this._pickId.destroy(),Object(s.default)(this)};var qr=Xr;function Zr(e){var t=(e=Object(n.default)(e,n.default.EMPTY_OBJECT)).textureUrl;Object(o.default)(t)||(t=i(1664)),this.show=Object(n.default)(e.show,!0),this.textureUrl=t,this._ellipsoid=Object(n.default)(e.ellipsoid,u.default.MOON),this.onlySunLighting=Object(n.default)(e.onlySunLighting,!0),this._ellipsoidPrimitive=new qr({radii:this.ellipsoid.radii,material:Gr.a.fromType(Gr.a.ImageType),depthTestEnabled:!1,_owner:this}),this._ellipsoidPrimitive.material.translucent=!1,this._axes=new xa}Object.defineProperties(Zr.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});var Kr=new ma.default,Jr=new ma.default,$r=new a.default,en=[];Zr.prototype.update=function(e){if(this.show){var t=this._ellipsoidPrimitive;t.material.uniforms.image=this.textureUrl,t.onlySunLighting=this.onlySunLighting;var i=e.time;Object(o.default)(Ur.default.computeIcrfToFixedMatrix(i,Kr))||Ur.default.computeTemeToPseudoFixedMatrix(i,Kr);var a=this._axes.evaluate(i,Jr);ma.default.transpose(a,a),ma.default.multiply(Kr,a,a);var r=Vr.computeMoonPositionInEarthInertialFrame(i,$r);ma.default.multiplyByVector(Kr,r,r),K.default.fromRotationTranslation(a,r,t.modelMatrix);var n=e.commandList;return e.commandList=en,en.length=0,t.update(e),e.commandList=n,1===en.length?en[0]:void 0}},Zr.prototype.isDestroyed=function(){return!1},Zr.prototype.destroy=function(){return this._ellipsoidPrimitive=this._ellipsoidPrimitive&&this._ellipsoidPrimitive.destroy(),Object(s.default)(this)};var tn=Zr,an=i(58),rn=i(74),nn=i(232),on=i(184),sn=i(513),ln=i(102),un=[],dn=[];function fn(e,t,i,a,r){if(!(a>=r)){var n=Math.floor(.5*(a+r));fn(e,t,i,a,n),fn(e,t,i,n+1,r),function(e,t,i,a,r,n){var o,s,l=r-a+1,u=n-r,d=un,f=dn;for(o=0;o<l;++o)d[o]=e[a+o];for(s=0;s<u;++s)f[s]=e[r+s+1];o=0,s=0;for(var c=a;c<=n;++c){var h=d[o],m=f[s];o<l&&(s>=u||t(h,m,i)<=0)?(e[c]=h,++o):s<u&&(e[c]=m,++s)}}(e,t,i,a,n,r)}}var cn=function(e,t,i){var a=e.length,r=Math.ceil(.5*a);un.length=r,dn.length=r,fn(e,t,i,0,a-1),un.length=0,dn.length=0};function hn(e,t){this._occluderPosition=a.default.clone(e.center),this._occluderRadius=e.radius,this._horizonDistance=0,this._horizonPlaneNormal=void 0,this._horizonPlanePosition=void 0,this._cameraPosition=void 0,this.cameraPosition=t}var mn=new a.default;Object.defineProperties(hn.prototype,{position:{get:function(){return this._occluderPosition}},radius:{get:function(){return this._occluderRadius}},cameraPosition:{set:function(e){e=a.default.clone(e,this._cameraPosition);var t,i,r,n=a.default.subtract(this._occluderPosition,e,mn),o=a.default.magnitudeSquared(n),s=this._occluderRadius*this._occluderRadius;if(o>s){t=Math.sqrt(o-s),o=1/Math.sqrt(o),i=a.default.multiplyByScalar(n,o,mn);var l=t*t*o;r=a.default.add(e,a.default.multiplyByScalar(i,l,mn),mn)}else t=Number.MAX_VALUE;this._horizonDistance=t,this._horizonPlaneNormal=i,this._horizonPlanePosition=r,this._cameraPosition=e}}}),hn.fromBoundingSphere=function(e,t,i){return Object(o.default)(i)?(a.default.clone(e.center,i._occluderPosition),i._occluderRadius=e.radius,i.cameraPosition=t,i):new hn(e,t)};var pn=new a.default;hn.prototype.isPointVisible=function(e){if(this._horizonDistance!==Number.MAX_VALUE){var t=a.default.subtract(e,this._occluderPosition,pn),i=this._occluderRadius;if((i=a.default.magnitudeSquared(t)-i*i)>0)return i=Math.sqrt(i)+this._horizonDistance,t=a.default.subtract(e,this._cameraPosition,t),i*i>a.default.magnitudeSquared(t)}return!1};var _n=new a.default;hn.prototype.isBoundingSphereVisible=function(e){var t=a.default.clone(e.center,_n),i=e.radius;if(this._horizonDistance!==Number.MAX_VALUE){var r=a.default.subtract(t,this._occluderPosition,pn),n=this._occluderRadius-i;if(n=a.default.magnitudeSquared(r)-n*n,i<this._occluderRadius)return n>0&&(n=Math.sqrt(n)+this._horizonDistance,r=a.default.subtract(t,this._cameraPosition,r),n*n+i*i>a.default.magnitudeSquared(r));if(n>0){r=a.default.subtract(t,this._cameraPosition,r);var o=a.default.magnitudeSquared(r),s=this._occluderRadius*this._occluderRadius,l=i*i;return(this._horizonDistance*this._horizonDistance+s)*l>o*s||(n=Math.sqrt(n)+this._horizonDistance)*n+l>o}return!0}return!1};var gn=new a.default;hn.prototype.computeVisibility=function(e){var t=a.default.clone(e.center),i=e.radius;if(i>this._occluderRadius)return ie.FULL;if(this._horizonDistance!==Number.MAX_VALUE){var r=a.default.subtract(t,this._occluderPosition,gn),n=this._occluderRadius-i,o=a.default.magnitudeSquared(r);if((n=o-n*n)>0){n=Math.sqrt(n)+this._horizonDistance,r=a.default.subtract(t,this._cameraPosition,r);var s=a.default.magnitudeSquared(r);return n*n+i*i<s?ie.NONE:(n=o-(n=this._occluderRadius+i)*n)>0?s<(n=Math.sqrt(n)+this._horizonDistance)*n+i*i?ie.FULL:ie.PARTIAL:(r=a.default.subtract(t,this._horizonPlanePosition,r),a.default.dot(r,this._horizonPlaneNormal)>-i?ie.PARTIAL:ie.FULL)}}return ie.NONE};var vn=new a.default;hn.computeOccludeePoint=function(e,t,i){var r=a.default.clone(t),n=a.default.clone(e.center),o=e.radius,s=i.length,l=a.default.normalize(a.default.subtract(r,n,vn),vn),u=-a.default.dot(l,n),d=hn._anyRotationVector(n,l,u),f=hn._horizonToPlaneNormalDotProduct(e,l,u,d,i[0]);if(f){for(var c,h=1;h<s;++h){if(!(c=hn._horizonToPlaneNormalDotProduct(e,l,u,d,i[h])))return;c<f&&(f=c)}if(!(f<.0017453283658983088)){var m=o/f;return a.default.add(n,a.default.multiplyByScalar(l,m,vn),vn)}}};var yn=[];hn.computeOccludeePointFromRectangle=function(e,t){t=Object(n.default)(t,u.default.WGS84);var i=C.default.subsample(e,t,0,yn),r=g.default.fromPoints(i),o=a.default.ZERO;if(!a.default.equals(o,r.center))return hn.computeOccludeePoint(new g.default(o,t.minimumRadius),r.center,i)};var bn=new a.default;hn._anyRotationVector=function(e,t,i){var r=a.default.abs(t,bn),n=r.x>r.y?0:1;(0===n&&r.z>r.x||1===n&&r.z>r.y)&&(n=2);var o,s=new a.default;0===n?(r.x=e.x,r.y=e.y+1,r.z=e.z+1,o=a.default.UNIT_X):1===n?(r.x=e.x+1,r.y=e.y,r.z=e.z+1,o=a.default.UNIT_Y):(r.x=e.x+1,r.y=e.y+1,r.z=e.z,o=a.default.UNIT_Z);var l=(a.default.dot(t,r)+i)/-a.default.dot(t,o);return a.default.normalize(a.default.subtract(a.default.add(r,a.default.multiplyByScalar(o,l,s),r),e,r),r)};var wn=new a.default;hn._rotationVector=function(e,t,i,r,n){var o=a.default.subtract(r,e,wn);if(o=a.default.normalize(o,o),a.default.dot(t,o)<.9999999847691291){var s=a.default.cross(t,o,o);if(a.default.magnitude(s)>Z.default.EPSILON13)return a.default.normalize(s,new a.default)}return n};var xn=new a.default,On=new a.default,Cn=new a.default,Tn=new a.default;hn._horizonToPlaneNormalDotProduct=function(e,t,i,r,n){var o=a.default.clone(n,xn),s=a.default.clone(e.center,On),l=e.radius,u=a.default.subtract(s,o,Cn),d=a.default.magnitudeSquared(u),f=l*l;if(d<f)return!1;var c=d-f,h=Math.sqrt(c),m=h*(1/Math.sqrt(d))*h;u=a.default.normalize(u,u);var p=a.default.add(o,a.default.multiplyByScalar(u,m,Tn),Tn),_=Math.sqrt(c-m*m),g=this._rotationVector(s,t,i,o,r),v=a.default.fromElements(g.x*g.x*u.x+(g.x*g.y-g.z)*u.y+(g.x*g.z+g.y)*u.z,(g.x*g.y+g.z)*u.x+g.y*g.y*u.y+(g.y*g.z-g.x)*u.z,(g.x*g.z-g.y)*u.x+(g.y*g.z+g.x)*u.y+g.z*g.z*u.z,xn);v=a.default.normalize(v,v);var y=a.default.multiplyByScalar(v,_,xn);g=a.default.normalize(a.default.subtract(a.default.add(p,y,Cn),s,Cn),Cn);var b=a.default.dot(t,g);g=a.default.normalize(a.default.subtract(a.default.subtract(p,y,g),s,g),g);var w=a.default.dot(t,g);return b<w?b:w};var En,Pn=hn,An=i(171),Sn=i(281),Dn=i(525),In=i(132),Mn=i(116),Fn=(i(15),"attribute vec4 position;\nattribute vec2 textureCoordinates;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main() \n{\n    gl_Position = position;\n    v_textureCoordinates = textureCoordinates;\n}\n"),Rn=i(98);function Nn(e){this._context=e}var Ln=new se.a({primitiveType:ee.a.TRIANGLES}),jn=new Mn.a({color:new k.default(0,0,0,0)});Nn.prototype.execute=function(e){Object(o.default)(e.preExecute)&&e.preExecute(e);var t=e.outputTexture,i=t.width,a=t.height,r=this._context,n=Object(o.default)(e.vertexArray)?e.vertexArray:r.getViewportQuadVertexArray(),s=Object(o.default)(e.shaderProgram)?e.shaderProgram:function(e,t){return F.a.fromCache({context:e,vertexShaderSource:Fn,fragmentShaderSource:t,attributeLocations:{position:0,textureCoordinates:1}})}(r,e.fragmentShaderSource),l=function(e,t){return new Rn.a({context:e,colorTextures:[t],destroyAttachments:!1})}(r,t),u=function(e,t){return Object(o.default)(En)&&En.viewport.width===e&&En.viewport.height===t||(En=ue.a.fromCache({viewport:new an.default(0,0,e,t)})),En}(i,a),d=e.uniformMap,f=jn;f.framebuffer=l,f.renderState=u,f.execute(r);var c=Ln;c.vertexArray=n,c.renderState=u,c.shaderProgram=s,c.uniformMap=d,c.framebuffer=l,c.execute(r),l.destroy(),e.persists||(s.destroy(),Object(o.default)(e.vertexArray)&&n.destroy()),Object(o.default)(e.postExecute)&&e.postExecute(t)},Nn.prototype.isDestroyed=function(){return!1},Nn.prototype.destroy=function(){return Object(s.default)(this)};var Vn=Nn,Un=i(34),zn=i(51),Bn=i(52),Hn=i(41),kn=i(47),Wn="uniform sampler2D u_floatTexture;\n\nvoid main()\n{\n    float actual = texture2D(u_floatTexture, vec2(0.5, 0.5)).r;\n    float expected = 123456.0;\n    gl_FragColor = vec4(abs(actual - expected), 0.0, 0.0, 1.0);\n}\n",Gn=i(333);function Yn(e){if(!e.floatingPointTexture)return!1;var t=new Vn(e),i=new P.a({context:e,width:1,height:1,pixelFormat:me.a.RGBA}),a=new P.a({context:e,width:1,height:1,pixelFormat:me.a.RGBA,pixelDatatype:Yn._getFloatPixelType(),source:{width:1,height:1,arrayBufferView:Yn._getArray([123456,0,0,0])}}),r=new Rn.a({context:e,colorTextures:[i],destroyAttachments:!1}),n={framebuffer:r,x:0,y:0,width:1,height:1},o=!1;return new Gn.a({fragmentShaderSource:Wn,outputTexture:i,uniformMap:{u_floatTexture:function(){return a}},persists:!1,postExecute:function(){var t=e.readPixels(n);o=0===t[0]}}).execute(t),t.destroy(),r.destroy(),o}Yn._getFloatPixelType=function(){return ye.a.FLOAT},Yn._getArray=function(e){return new Float32Array(e)};var Xn=Yn,Qn=i(247);var qn=function(e){this.context=e,this.framebuffer=void 0,this.blendingEnabled=void 0,this.scissorTest=void 0,this.viewport=void 0};function Zn(e){this._context=e,this._shaders={},this._numberOfShaders=0,this._shadersToRelease={}}function Kn(e,t){for(var i=t.derivedKeywords,a=i.length,r=0;r<a;++r){var n=i[r]+t.keyword;Kn(e,e._shaders[n])}delete e._shaders[t.keyword],t.shaderProgram.finalDestroy()}Object.defineProperties(Zn.prototype,{numberOfShaders:{get:function(){return this._numberOfShaders}}}),Zn.prototype.replaceShaderProgram=function(e){return Object(o.default)(e.shaderProgram)&&e.shaderProgram.destroy(),this.getShaderProgram(e)},Zn.prototype.getShaderProgram=function(e){var t=e.vertexShaderSource,i=e.fragmentShaderSource,a=e.attributeLocations;"string"==typeof t&&(t=new E.a({sources:[t]})),"string"==typeof i&&(i=new E.a({sources:[i]}));var r,n=t.createCombinedVertexShader(this._context),s=i.createCombinedFragmentShader(this._context),l=n+s+JSON.stringify(a);if(Object(o.default)(this._shaders[l]))r=this._shaders[l],delete this._shadersToRelease[l];else{var u=this._context,d=new F.a({gl:u._gl,logShaderCompilation:u.logShaderCompilation,debugShaders:u.debugShaders,vertexShaderSource:t,vertexShaderText:n,fragmentShaderSource:i,fragmentShaderText:s,attributeLocations:a});r={cache:this,shaderProgram:d,keyword:l,derivedKeywords:[],count:0},d._cachedShader=r,this._shaders[l]=r,++this._numberOfShaders}return++r.count,r.shaderProgram},Zn.prototype.replaceDerivedShaderProgram=function(e,t,i){var a=e._cachedShader,r=t+a.keyword,n=this._shaders[r];if(Object(o.default)(n)){Kn(this,n);var s=a.derivedKeywords.indexOf(t);s>-1&&a.derivedKeywords.splice(s,1)}return this.createDerivedShaderProgram(e,t,i)},Zn.prototype.getDerivedShaderProgram=function(e,t){var i=t+e._cachedShader.keyword,a=this._shaders[i];if(Object(o.default)(a))return a.shaderProgram},Zn.prototype.createDerivedShaderProgram=function(e,t,i){var a=e._cachedShader,r=t+a.keyword,n=i.vertexShaderSource,o=i.fragmentShaderSource,s=i.attributeLocations;"string"==typeof n&&(n=new E.a({sources:[n]})),"string"==typeof o&&(o=new E.a({sources:[o]}));var l=this._context,u=n.createCombinedVertexShader(l),d=o.createCombinedFragmentShader(l),f=new F.a({gl:l._gl,logShaderCompilation:l.logShaderCompilation,debugShaders:l.debugShaders,vertexShaderSource:n,vertexShaderText:u,fragmentShaderSource:o,fragmentShaderText:d,attributeLocations:s}),c={cache:this,shaderProgram:f,keyword:r,derivedKeywords:[],count:0};return a.derivedKeywords.push(t),f._cachedShader=c,this._shaders[r]=c,f},Zn.prototype.destroyReleasedShaderPrograms=function(){var e=this._shadersToRelease;for(var t in e){if(e.hasOwnProperty(t))Kn(this,e[t]),--this._numberOfShaders}this._shadersToRelease={}},Zn.prototype.releaseShaderProgram=function(e){if(Object(o.default)(e)){var t=e._cachedShader;t&&0==--t.count&&(this._shadersToRelease[t.keyword]=t)}},Zn.prototype.isDestroyed=function(){return!1},Zn.prototype.destroy=function(){var e=this._shaders;for(var t in e)e.hasOwnProperty(t)&&e[t].shaderProgram.finalDestroy();return Object(s.default)(this)};var Jn=Zn;function $n(){this._textures={},this._numberOfTextures=0,this._texturesToRelease={}}Object.defineProperties($n.prototype,{numberOfTextures:{get:function(){return this._numberOfTextures}}}),$n.prototype.getTexture=function(e){var t=this._textures[e];if(Object(o.default)(t))return delete this._texturesToRelease[e],++t.count,t.texture},$n.prototype.addTexture=function(e,t){var i={texture:t,count:1};t.finalDestroy=t.destroy;var a=this;t.destroy=function(){0==--i.count&&(a._texturesToRelease[e]=i)},this._textures[e]=i,++this._numberOfTextures},$n.prototype.destroyReleasedTextures=function(){var e=this._texturesToRelease;for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];delete this._textures[t],i.texture.finalDestroy(),--this._numberOfTextures}this._texturesToRelease={}},$n.prototype.isDestroyed=function(){return!1},$n.prototype.destroy=function(){var e=this._textures;for(var t in e)e.hasOwnProperty(t)&&e[t].texture.finalDestroy();return Object(s.default)(this)};var eo=$n,to=i(181);var io=function(e){e=Object(n.default)(e,n.default.EMPTY_OBJECT),this.color=Object(o.default)(e.color)?k.default.clone(e.color):k.default.WHITE,this.intensity=Object(n.default)(e.intensity,2)};function ao(){this.globeDepthTexture=void 0,this.gamma=void 0,this._viewport=new an.default,this._viewportCartesian4=new B.a,this._viewportDirty=!1,this._viewportOrthographicMatrix=K.default.clone(K.default.IDENTITY),this._viewportTransformation=K.default.clone(K.default.IDENTITY),this._model=K.default.clone(K.default.IDENTITY),this._view=K.default.clone(K.default.IDENTITY),this._inverseView=K.default.clone(K.default.IDENTITY),this._projection=K.default.clone(K.default.IDENTITY),this._infiniteProjection=K.default.clone(K.default.IDENTITY),this._entireFrustum=new z.default,this._currentFrustum=new z.default,this._frustumPlanes=new B.a,this._farDepthFromNearPlusOne=void 0,this._log2FarDepthFromNearPlusOne=void 0,this._oneOverLog2FarDepthFromNearPlusOne=void 0,this._frameState=void 0,this._temeToPseudoFixed=ma.default.clone(K.default.IDENTITY),this._view3DDirty=!0,this._view3D=new K.default,this._inverseView3DDirty=!0,this._inverseView3D=new K.default,this._inverseModelDirty=!0,this._inverseModel=new K.default,this._inverseTransposeModelDirty=!0,this._inverseTransposeModel=new ma.default,this._viewRotation=new ma.default,this._inverseViewRotation=new ma.default,this._viewRotation3D=new ma.default,this._inverseViewRotation3D=new ma.default,this._inverseProjectionDirty=!0,this._inverseProjection=new K.default,this._modelViewDirty=!0,this._modelView=new K.default,this._modelView3DDirty=!0,this._modelView3D=new K.default,this._modelViewRelativeToEyeDirty=!0,this._modelViewRelativeToEye=new K.default,this._inverseModelViewDirty=!0,this._inverseModelView=new K.default,this._inverseModelView3DDirty=!0,this._inverseModelView3D=new K.default,this._viewProjectionDirty=!0,this._viewProjection=new K.default,this._inverseViewProjectionDirty=!0,this._inverseViewProjection=new K.default,this._modelViewProjectionDirty=!0,this._modelViewProjection=new K.default,this._inverseModelViewProjectionDirty=!0,this._inverseModelViewProjection=new K.default,this._modelViewProjectionRelativeToEyeDirty=!0,this._modelViewProjectionRelativeToEye=new K.default,this._modelViewInfiniteProjectionDirty=!0,this._modelViewInfiniteProjection=new K.default,this._normalDirty=!0,this._normal=new ma.default,this._normal3DDirty=!0,this._normal3D=new ma.default,this._inverseNormalDirty=!0,this._inverseNormal=new ma.default,this._inverseNormal3DDirty=!0,this._inverseNormal3D=new ma.default,this._encodedCameraPositionMCDirty=!0,this._encodedCameraPositionMC=new to.a,this._cameraPosition=new a.default,this._sunPositionWC=new a.default,this._sunPositionColumbusView=new a.default,this._sunDirectionWC=new a.default,this._sunDirectionEC=new a.default,this._moonDirectionEC=new a.default,this._lightDirectionWC=new a.default,this._lightDirectionEC=new a.default,this._lightColor=new a.default,this._lightColorHdr=new a.default,this._pass=void 0,this._mode=void 0,this._mapProjection=void 0,this._ellipsoid=void 0,this._cameraDirection=new a.default,this._cameraRight=new a.default,this._cameraUp=new a.default,this._frustum2DWidth=0,this._eyeHeight2D=new z.default,this._pixelRatio=1,this._orthographicIn3D=!1,this._backgroundColor=new k.default,this._brdfLut=void 0,this._environmentMap=void 0,this._sphericalHarmonicCoefficients=void 0,this._specularEnvironmentMaps=void 0,this._specularEnvironmentMapsDimensions=new z.default,this._specularEnvironmentMapsMaximumLOD=void 0,this._fogDensity=void 0,this._invertClassificationColor=void 0,this._imagerySplitPosition=0,this._pixelSizePerMeter=void 0,this._geometricToleranceOverMeter=void 0,this._minimumDisableDepthTestDistance=void 0}Object.defineProperties(ao.prototype,{frameState:{get:function(){return this._frameState}},viewport:{get:function(){return this._viewport},set:function(e){if(!an.default.equals(e,this._viewport)){an.default.clone(e,this._viewport);var t=this._viewport,i=this._viewportCartesian4;i.x=t.x,i.y=t.y,i.z=t.width,i.w=t.height,this._viewportDirty=!0}}},viewportCartesian4:{get:function(){return this._viewportCartesian4}},viewportOrthographic:{get:function(){return lo(this),this._viewportOrthographicMatrix}},viewportTransformation:{get:function(){return lo(this),this._viewportTransformation}},model:{get:function(){return this._model},set:function(e){K.default.clone(e,this._model),this._modelView3DDirty=!0,this._inverseModelView3DDirty=!0,this._inverseModelDirty=!0,this._inverseTransposeModelDirty=!0,this._modelViewDirty=!0,this._inverseModelViewDirty=!0,this._modelViewRelativeToEyeDirty=!0,this._inverseModelViewDirty=!0,this._modelViewProjectionDirty=!0,this._inverseModelViewProjectionDirty=!0,this._modelViewProjectionRelativeToEyeDirty=!0,this._modelViewInfiniteProjectionDirty=!0,this._normalDirty=!0,this._inverseNormalDirty=!0,this._normal3DDirty=!0,this._inverseNormal3DDirty=!0,this._encodedCameraPositionMCDirty=!0}},inverseModel:{get:function(){return this._inverseModelDirty&&(this._inverseModelDirty=!1,K.default.inverse(this._model,this._inverseModel)),this._inverseModel}},inverseTransposeModel:{get:function(){var e=this._inverseTransposeModel;return this._inverseTransposeModelDirty&&(this._inverseTransposeModelDirty=!1,K.default.getMatrix3(this.inverseModel,e),ma.default.transpose(e,e)),e}},view:{get:function(){return this._view}},view3D:{get:function(){return yo(this),this._view3D}},viewRotation:{get:function(){return yo(this),this._viewRotation}},viewRotation3D:{get:function(){return yo(this),this._viewRotation3D}},inverseView:{get:function(){return this._inverseView}},inverseView3D:{get:function(){return bo(this),this._inverseView3D}},inverseViewRotation:{get:function(){return this._inverseViewRotation}},inverseViewRotation3D:{get:function(){return bo(this),this._inverseViewRotation3D}},projection:{get:function(){return this._projection}},inverseProjection:{get:function(){var e;return(e=this)._inverseProjectionDirty&&(e._inverseProjectionDirty=!1,e._mode===N.a.SCENE2D||e._mode===N.a.MORPHING||e._orthographicIn3D?K.default.clone(K.default.ZERO,e._inverseProjection):K.default.inverse(e._projection,e._inverseProjection)),this._inverseProjection}},infiniteProjection:{get:function(){return this._infiniteProjection}},modelView:{get:function(){var e;return(e=this)._modelViewDirty&&(e._modelViewDirty=!1,K.default.multiplyTransformation(e._view,e._model,e._modelView)),this._modelView}},modelView3D:{get:function(){var e;return(e=this)._modelView3DDirty&&(e._modelView3DDirty=!1,K.default.multiplyTransformation(e.view3D,e._model,e._modelView3D)),this._modelView3D}},modelViewRelativeToEye:{get:function(){return function(e){if(e._modelViewRelativeToEyeDirty){e._modelViewRelativeToEyeDirty=!1;var t=e.modelView,i=e._modelViewRelativeToEye;i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=0,i[13]=0,i[14]=0,i[15]=t[15]}}(this),this._modelViewRelativeToEye}},inverseModelView:{get:function(){var e;return(e=this)._inverseModelViewDirty&&(e._inverseModelViewDirty=!1,K.default.inverse(e.modelView,e._inverseModelView)),this._inverseModelView}},inverseModelView3D:{get:function(){var e;return(e=this)._inverseModelView3DDirty&&(e._inverseModelView3DDirty=!1,K.default.inverse(e.modelView3D,e._inverseModelView3D)),this._inverseModelView3D}},viewProjection:{get:function(){var e;return(e=this)._viewProjectionDirty&&(e._viewProjectionDirty=!1,K.default.multiply(e._projection,e._view,e._viewProjection)),this._viewProjection}},inverseViewProjection:{get:function(){var e;return(e=this)._inverseViewProjectionDirty&&(e._inverseViewProjectionDirty=!1,K.default.inverse(e.viewProjection,e._inverseViewProjection)),this._inverseViewProjection}},modelViewProjection:{get:function(){var e;return(e=this)._modelViewProjectionDirty&&(e._modelViewProjectionDirty=!1,K.default.multiply(e._projection,e.modelView,e._modelViewProjection)),this._modelViewProjection}},inverseModelViewProjection:{get:function(){var e;return(e=this)._inverseModelViewProjectionDirty&&(e._inverseModelViewProjectionDirty=!1,K.default.inverse(e.modelViewProjection,e._inverseModelViewProjection)),this._inverseModelViewProjection}},modelViewProjectionRelativeToEye:{get:function(){var e;return(e=this)._modelViewProjectionRelativeToEyeDirty&&(e._modelViewProjectionRelativeToEyeDirty=!1,K.default.multiply(e._projection,e.modelViewRelativeToEye,e._modelViewProjectionRelativeToEye)),this._modelViewProjectionRelativeToEye}},modelViewInfiniteProjection:{get:function(){var e;return(e=this)._modelViewInfiniteProjectionDirty&&(e._modelViewInfiniteProjectionDirty=!1,K.default.multiply(e._infiniteProjection,e.modelView,e._modelViewInfiniteProjection)),this._modelViewInfiniteProjection}},normal:{get:function(){return function(e){if(e._normalDirty){e._normalDirty=!1;var t=e._normal;K.default.getMatrix3(e.inverseModelView,t),ma.default.getRotation(t,t),ma.default.transpose(t,t)}}(this),this._normal}},normal3D:{get:function(){return function(e){if(e._normal3DDirty){e._normal3DDirty=!1;var t=e._normal3D;K.default.getMatrix3(e.inverseModelView3D,t),ma.default.getRotation(t,t),ma.default.transpose(t,t)}}(this),this._normal3D}},inverseNormal:{get:function(){var e;return(e=this)._inverseNormalDirty&&(e._inverseNormalDirty=!1,K.default.getMatrix3(e.inverseModelView,e._inverseNormal),ma.default.getRotation(e._inverseNormal,e._inverseNormal)),this._inverseNormal}},inverseNormal3D:{get:function(){var e;return(e=this)._inverseNormal3DDirty&&(e._inverseNormal3DDirty=!1,K.default.getMatrix3(e.inverseModelView3D,e._inverseNormal3D),ma.default.getRotation(e._inverseNormal3D,e._inverseNormal3D)),this._inverseNormal3D}},entireFrustum:{get:function(){return this._entireFrustum}},currentFrustum:{get:function(){return this._currentFrustum}},frustumPlanes:{get:function(){return this._frustumPlanes}},farDepthFromNearPlusOne:{get:function(){return this._farDepthFromNearPlusOne}},log2FarDepthFromNearPlusOne:{get:function(){return this._log2FarDepthFromNearPlusOne}},oneOverLog2FarDepthFromNearPlusOne:{get:function(){return this._oneOverLog2FarDepthFromNearPlusOne}},eyeHeight2D:{get:function(){return this._eyeHeight2D}},sunPositionWC:{get:function(){return this._sunPositionWC}},sunPositionColumbusView:{get:function(){return this._sunPositionColumbusView}},sunDirectionWC:{get:function(){return this._sunDirectionWC}},sunDirectionEC:{get:function(){return this._sunDirectionEC}},moonDirectionEC:{get:function(){return this._moonDirectionEC}},lightDirectionWC:{get:function(){return this._lightDirectionWC}},lightDirectionEC:{get:function(){return this._lightDirectionEC}},lightColor:{get:function(){return this._lightColor}},lightColorHdr:{get:function(){return this._lightColorHdr}},encodedCameraPositionMCHigh:{get:function(){return fo(this),this._encodedCameraPositionMC.high}},encodedCameraPositionMCLow:{get:function(){return fo(this),this._encodedCameraPositionMC.low}},temeToPseudoFixedMatrix:{get:function(){return this._temeToPseudoFixed}},pixelRatio:{get:function(){return this._pixelRatio}},fogDensity:{get:function(){return this._fogDensity}},geometricToleranceOverMeter:{get:function(){return this._geometricToleranceOverMeter}},pass:{get:function(){return this._pass}},backgroundColor:{get:function(){return this._backgroundColor}},brdfLut:{get:function(){return this._brdfLut}},environmentMap:{get:function(){return this._environmentMap}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients}},specularEnvironmentMaps:{get:function(){return this._specularEnvironmentMaps}},specularEnvironmentMapsDimensions:{get:function(){return this._specularEnvironmentMapsDimensions}},specularEnvironmentMapsMaximumLOD:{get:function(){return this._specularEnvironmentMapsMaximumLOD}},imagerySplitPosition:{get:function(){return this._imagerySplitPosition}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance}},invertClassificationColor:{get:function(){return this._invertClassificationColor}},orthographicIn3D:{get:function(){return this._orthographicIn3D}},ellipsoid:{get:function(){return Object(n.default)(this._ellipsoid,u.default.WGS84)}}});var ro=new ma.default,no=new v.default;ao.prototype.updateCamera=function(e){var t,i;t=this,i=e.viewMatrix,K.default.clone(i,t._view),K.default.getMatrix3(i,t._viewRotation),t._view3DDirty=!0,t._inverseView3DDirty=!0,t._modelViewDirty=!0,t._modelView3DDirty=!0,t._modelViewRelativeToEyeDirty=!0,t._inverseModelViewDirty=!0,t._inverseModelView3DDirty=!0,t._viewProjectionDirty=!0,t._inverseViewProjectionDirty=!0,t._modelViewProjectionDirty=!0,t._modelViewProjectionRelativeToEyeDirty=!0,t._modelViewInfiniteProjectionDirty=!0,t._normalDirty=!0,t._inverseNormalDirty=!0,t._normal3DDirty=!0,t._inverseNormal3DDirty=!0,function(e,t){K.default.clone(t,e._inverseView),K.default.getMatrix3(t,e._inverseViewRotation)}(this,e.inverseViewMatrix),function(e,t){a.default.clone(t.positionWC,e._cameraPosition),a.default.clone(t.directionWC,e._cameraDirection),a.default.clone(t.rightWC,e._cameraRight),a.default.clone(t.upWC,e._cameraUp),e._encodedCameraPositionMCDirty=!0}(this,e),this._entireFrustum.x=e.frustum.near,this._entireFrustum.y=e.frustum.far,this.updateFrustum(e.frustum),this._orthographicIn3D=this._mode!==N.a.SCENE2D&&e.frustum instanceof $.a},ao.prototype.updateFrustum=function(e){var t,i;t=this,i=e.projectionMatrix,K.default.clone(i,t._projection),t._inverseProjectionDirty=!0,t._viewProjectionDirty=!0,t._inverseViewProjectionDirty=!0,t._modelViewProjectionDirty=!0,t._modelViewProjectionRelativeToEyeDirty=!0,Object(o.default)(e.infiniteProjectionMatrix)&&function(e,t){K.default.clone(t,e._infiniteProjection),e._modelViewInfiniteProjectionDirty=!0}(this,e.infiniteProjectionMatrix),this._currentFrustum.x=e.near,this._currentFrustum.y=e.far,this._farDepthFromNearPlusOne=e.far-e.near+1,this._log2FarDepthFromNearPlusOne=Z.default.log2(this._farDepthFromNearPlusOne),this._oneOverLog2FarDepthFromNearPlusOne=1/this._log2FarDepthFromNearPlusOne,Object(o.default)(e._offCenterFrustum)&&(e=e._offCenterFrustum),this._frustumPlanes.x=e.top,this._frustumPlanes.y=e.bottom,this._frustumPlanes.z=e.left,this._frustumPlanes.w=e.right},ao.prototype.updatePass=function(e){this._pass=e};var oo=[],so=new io;function lo(e){if(e._viewportDirty){var t=e._viewport;K.default.computeOrthographicOffCenter(t.x,t.x+t.width,t.y,t.y+t.height,0,1,e._viewportOrthographicMatrix),K.default.computeViewportTransformation(t,0,1,e._viewportTransformation),e._viewportDirty=!1}}ao.prototype.update=function(e){this._mode=e.mode,this._mapProjection=e.mapProjection,this._ellipsoid=e.mapProjection.ellipsoid,this._pixelRatio=e.pixelRatio;var t=e.camera;this.updateCamera(t),e.mode===N.a.SCENE2D?(this._frustum2DWidth=t.frustum.right-t.frustum.left,this._eyeHeight2D.x=.5*this._frustum2DWidth,this._eyeHeight2D.y=this._eyeHeight2D.x*this._eyeHeight2D.x):(this._frustum2DWidth=0,this._eyeHeight2D.x=0,this._eyeHeight2D.y=0),function(e,t){Object(o.default)(Ur.default.computeIcrfToFixedMatrix(t.time,ro))||(ro=Ur.default.computeTemeToPseudoFixedMatrix(t.time,ro));var i=Vr.computeSunPositionInEarthInertialFrame(t.time,e._sunPositionWC);ma.default.multiplyByVector(ro,i,i),a.default.normalize(i,e._sunDirectionWC),i=ma.default.multiplyByVector(e.viewRotation3D,i,e._sunDirectionEC),a.default.normalize(i,i),i=Vr.computeMoonPositionInEarthInertialFrame(t.time,e._moonDirectionEC),ma.default.multiplyByVector(ro,i,i),ma.default.multiplyByVector(e.viewRotation3D,i,i),a.default.normalize(i,i);var r=t.mapProjection,n=r.ellipsoid.cartesianToCartographic(e._sunPositionWC,no);r.project(n,e._sunPositionColumbusView)}(this,e);var i=Object(n.default)(e.light,so);i instanceof io?(this._lightDirectionWC=a.default.clone(this._sunDirectionWC,this._lightDirectionWC),this._lightDirectionEC=a.default.clone(this._sunDirectionEC,this._lightDirectionEC)):(this._lightDirectionWC=a.default.normalize(a.default.negate(i.direction,this._lightDirectionWC),this._lightDirectionWC),this._lightDirectionEC=ma.default.multiplyByVector(this.viewRotation3D,this._lightDirectionWC,this._lightDirectionEC));var r=i.color,s=a.default.fromElements(r.red,r.green,r.blue,this._lightColorHdr);s=a.default.multiplyByScalar(s,i.intensity,s);var l=a.default.maximumComponent(s);l>1?a.default.divideByScalar(s,l,this._lightColor):a.default.clone(s,this._lightColor);var u=e.brdfLutGenerator,d=Object(o.default)(u)?u.colorTexture:void 0;this._brdfLut=d,this._environmentMap=Object(n.default)(e.environmentMap,e.context.defaultCubeMap),this._sphericalHarmonicCoefficients=Object(n.default)(e.sphericalHarmonicCoefficients,oo),this._specularEnvironmentMaps=e.specularEnvironmentMaps,this._specularEnvironmentMapsMaximumLOD=e.specularEnvironmentMapsMaximumLOD,Object(o.default)(this._specularEnvironmentMaps)&&z.default.clone(this._specularEnvironmentMaps.dimensions,this._specularEnvironmentMapsDimensions),this._fogDensity=e.fog.density,this._invertClassificationColor=e.invertClassificationColor,this._frameState=e,this._temeToPseudoFixed=Ur.default.computeTemeToPseudoFixedMatrix(e.time,this._temeToPseudoFixed),this._imagerySplitPosition=e.imagerySplitPosition*e.context.drawingBufferWidth;var f,c=t.frustum.fov,h=this._viewport;f=h.height>h.width?2*Math.tan(.5*c)/h.height:2*Math.tan(.5*c)/h.width,this._geometricToleranceOverMeter=f*e.maximumScreenSpaceError,k.default.clone(e.backgroundColor,this._backgroundColor),this._minimumDisableDepthTestDistance=e.minimumDisableDepthTestDistance,this._minimumDisableDepthTestDistance*=this._minimumDisableDepthTestDistance,this._minimumDisableDepthTestDistance===Number.POSITIVE_INFINITY&&(this._minimumDisableDepthTestDistance=-1)};var uo=new a.default;function fo(e){e._encodedCameraPositionMCDirty&&(e._encodedCameraPositionMCDirty=!1,K.default.multiplyByPoint(e.inverseModel,e._cameraPosition,uo),to.a.fromCartesian(uo,e._encodedCameraPositionMC))}var co=new a.default,ho=new a.default,mo=new a.default,po=new a.default,_o=new v.default,go=new a.default,vo=new K.default;function yo(e){e._view3DDirty&&(e._mode===N.a.SCENE3D?K.default.clone(e._view,e._view3D):function(e,t,i,r,n,s,l,u){var d=co;d.x=e.y,d.y=e.z,d.z=e.x;var f=ho;f.x=i.y,f.y=i.z,f.z=i.x;var c=mo;c.x=r.y,c.y=r.z,c.z=r.x;var h=po;h.x=t.y,h.y=t.z,h.z=t.x,s===N.a.SCENE2D&&(d.z=.5*n);var m=l.unproject(d,_o);m.longitude=Z.default.clamp(m.longitude,-Math.PI,Math.PI),m.latitude=Z.default.clamp(m.latitude,-Z.default.PI_OVER_TWO,Z.default.PI_OVER_TWO);var p=l.ellipsoid,_=p.cartographicToCartesian(m,go),g=Ur.default.eastNorthUpToFixedFrame(_,p,vo);K.default.multiplyByPointAsVector(g,f,f),K.default.multiplyByPointAsVector(g,c,c),K.default.multiplyByPointAsVector(g,h,h),Object(o.default)(u)||(u=new K.default),u[0]=f.x,u[1]=c.x,u[2]=-h.x,u[3]=0,u[4]=f.y,u[5]=c.y,u[6]=-h.y,u[7]=0,u[8]=f.z,u[9]=c.z,u[10]=-h.z,u[11]=0,u[12]=-a.default.dot(f,_),u[13]=-a.default.dot(c,_),u[14]=a.default.dot(h,_),u[15]=1}(e._cameraPosition,e._cameraDirection,e._cameraRight,e._cameraUp,e._frustum2DWidth,e._mode,e._mapProjection,e._view3D),K.default.getMatrix3(e._view3D,e._viewRotation3D),e._view3DDirty=!1)}function bo(e){e._inverseView3DDirty&&(K.default.inverseTransformation(e.view3D,e._inverseView3D),K.default.getMatrix3(e._inverseView3D,e._inverseViewRotation3D),e._inverseView3DDirty=!1)}var wo=ao;function xo(e,t,i){var a=e.getError();if(a!==e.NO_ERROR)throw new Hn.default(function(e,t,i,a){for(var r=function(e,t){var i="WebGL Error:  ";switch(t){case e.INVALID_ENUM:i+="INVALID_ENUM";break;case e.INVALID_VALUE:i+="INVALID_VALUE";break;case e.INVALID_OPERATION:i+="INVALID_OPERATION";break;case e.OUT_OF_MEMORY:i+="OUT_OF_MEMORY";break;case e.CONTEXT_LOST_WEBGL:i+="CONTEXT_LOST_WEBGL lost";break;default:i+="Unknown ("+t+")"}return i}(e,a)+": "+t.name+"(",n=0;n<i.length;++n)0!==n&&(r+=", "),r+=i[n];return r+=");"}(e,t,i,a))}function Oo(e,t,i){return{get:function(){var a=e[t];return i(e,"get: "+t,a),e[t]},set:function(a){e[t]=a,i(e,"set: "+t,a)}}}function Co(e,t){for(var i=t.length,a=0;a<i;++a){var r=e.getExtension(t[a]);if(r)return r}}function To(e,t){if("undefined"==typeof WebGLRenderingContext)throw new Hn.default("The browser does not support WebGL.  Visit http://get.webgl.org.");this._canvas=e,t=Object(H.default)(t,!0),(t=Object(n.default)(t,{})).allowTextureFilterAnisotropic=Object(n.default)(t.allowTextureFilterAnisotropic,!0);var i=Object(n.default)(t.webgl,{});i.alpha=Object(n.default)(i.alpha,!1),i.stencil=Object(n.default)(i.stencil,!0);var a,r=Object(n.default)(t.requestWebgl2,!1)&&"undefined"!=typeof WebGL2RenderingContext,s=!1,l=t.getWebGLStub;if(Object(o.default)(l))a=l(e,i);else if(r&&(a=e.getContext("webgl2",i)||e.getContext("experimental-webgl2",i)||void 0,Object(o.default)(a)&&(s=!0)),Object(o.default)(a)||(a=e.getContext("webgl",i)||e.getContext("experimental-webgl",i)||void 0),!Object(o.default)(a))throw new Hn.default("The browser supports WebGL, but initialization failed.");this._originalGLContext=a,this._gl=a,this._webgl2=s,this._id=Object(rn.default)(),this.validateFramebuffer=!1,this.validateShaderProgram=!1,this.logShaderCompilation=!1,this._throwOnWebGLError=!1,this._shaderCache=new Jn(this),this._textureCache=new eo;var u=a;this._stencilBits=u.getParameter(u.STENCIL_BITS),oe.a._maximumCombinedTextureImageUnits=u.getParameter(u.MAX_COMBINED_TEXTURE_IMAGE_UNITS),oe.a._maximumCubeMapSize=u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE),oe.a._maximumFragmentUniformVectors=u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS),oe.a._maximumTextureImageUnits=u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS),oe.a._maximumRenderbufferSize=u.getParameter(u.MAX_RENDERBUFFER_SIZE),oe.a._maximumTextureSize=u.getParameter(u.MAX_TEXTURE_SIZE),oe.a._maximumVaryingVectors=u.getParameter(u.MAX_VARYING_VECTORS),oe.a._maximumVertexAttributes=u.getParameter(u.MAX_VERTEX_ATTRIBS),oe.a._maximumVertexTextureImageUnits=u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS),oe.a._maximumVertexUniformVectors=u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS);var d=u.getParameter(u.ALIASED_LINE_WIDTH_RANGE);oe.a._minimumAliasedLineWidth=d[0],oe.a._maximumAliasedLineWidth=d[1];var f=u.getParameter(u.ALIASED_POINT_SIZE_RANGE);oe.a._minimumAliasedPointSize=f[0],oe.a._maximumAliasedPointSize=f[1];var c=u.getParameter(u.MAX_VIEWPORT_DIMS);oe.a._maximumViewportWidth=c[0],oe.a._maximumViewportHeight=c[1];var h=u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT);oe.a._highpFloatSupported=0!==h.precision;var m=u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT);oe.a._highpIntSupported=0!==m.rangeMax,this._antialias=u.getContextAttributes().antialias,this._standardDerivatives=!!Co(u,["OES_standard_derivatives"]),this._blendMinmax=!!Co(u,["EXT_blend_minmax"]),this._elementIndexUint=!!Co(u,["OES_element_index_uint"]),this._depthTexture=!!Co(u,["WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),this._fragDepth=!!Co(u,["EXT_frag_depth"]),this._debugShaders=Co(u,["WEBGL_debug_shaders"]),this._textureFloat=!!Co(u,["OES_texture_float"]),this._textureHalfFloat=!!Co(u,["OES_texture_half_float"]),this._textureFloatLinear=!!Co(u,["OES_texture_float_linear"]),this._textureHalfFloatLinear=!!Co(u,["OES_texture_half_float_linear"]),this._colorBufferFloat=!!Co(u,["EXT_color_buffer_float","WEBGL_color_buffer_float"]),this._floatBlend=!!Co(u,["EXT_float_blend"]),this._colorBufferHalfFloat=!!Co(u,["EXT_color_buffer_half_float"]),this._s3tc=!!Co(u,["WEBGL_compressed_texture_s3tc","MOZ_WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc"]),this._pvrtc=!!Co(u,["WEBGL_compressed_texture_pvrtc","WEBKIT_WEBGL_compressed_texture_pvrtc"]),this._etc1=!!Co(u,["WEBGL_compressed_texture_etc1"]);var p,_,g,v,y,b,w,x,O,C,T=t.allowTextureFilterAnisotropic?Co(u,["EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"]):void 0;if(this._textureFilterAnisotropic=T,oe.a._maximumTextureFilterAnisotropy=Object(o.default)(T)?u.getParameter(T.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1,s){var E=this;p=function(){return E._gl.createVertexArray()},_=function(e){E._gl.bindVertexArray(e)},g=function(e){E._gl.deleteVertexArray(e)},v=function(e,t,i,a,r){u.drawElementsInstanced(e,t,i,a,r)},y=function(e,t,i,a){u.drawArraysInstanced(e,t,i,a)},b=function(e,t){u.vertexAttribDivisor(e,t)},w=function(e){u.drawBuffers(e)}}else x=Co(u,["OES_vertex_array_object"]),Object(o.default)(x)&&(p=function(){return x.createVertexArrayOES()},_=function(e){x.bindVertexArrayOES(e)},g=function(e){x.deleteVertexArrayOES(e)}),O=Co(u,["ANGLE_instanced_arrays"]),Object(o.default)(O)&&(v=function(e,t,i,a,r){O.drawElementsInstancedANGLE(e,t,i,a,r)},y=function(e,t,i,a){O.drawArraysInstancedANGLE(e,t,i,a)},b=function(e,t){O.vertexAttribDivisorANGLE(e,t)}),C=Co(u,["WEBGL_draw_buffers"]),Object(o.default)(C)&&(w=function(e){C.drawBuffersWEBGL(e)});this.glCreateVertexArray=p,this.glBindVertexArray=_,this.glDeleteVertexArray=g,this.glDrawElementsInstanced=v,this.glDrawArraysInstanced=y,this.glVertexAttribDivisor=b,this.glDrawBuffers=w,this._vertexArrayObject=!!x,this._instancedArrays=!!O,this._drawBuffers=!!C,oe.a._maximumDrawBuffers=this.drawBuffers?u.getParameter(kn.a.MAX_DRAW_BUFFERS):1,oe.a._maximumColorAttachments=this.drawBuffers?u.getParameter(kn.a.MAX_COLOR_ATTACHMENTS):1,this._clearColor=new k.default(0,0,0,0),this._clearDepth=1,this._clearStencil=0;var P=new wo,A=new qn(this),S=ue.a.fromCache();this._defaultPassState=A,this._defaultRenderState=S,this._defaultTexture=void 0,this._defaultCubeMap=void 0,this._us=P,this._currentRenderState=S,this._currentPassState=A,this._currentFramebuffer=void 0,this._maxFrameTextureUnitIndex=0,this._vertexAttribDivisors=[],this._previousDrawInstanced=!1;for(var D=0;D<oe.a._maximumVertexAttributes;D++)this._vertexAttribDivisors.push(0);this._pickObjects={},this._nextPickColor=new Uint32Array(1),this.options=t,this.cache={},ue.a.apply(u,S,A),this._floatTexSixPlaces=Xn(this)}var Eo,Po={};function Ao(e,t,i,a){var r=e._currentRenderState,n=e._currentPassState;e._currentRenderState=t,e._currentPassState=i,ue.a.partialApply(e._gl,r,t,n,i,a)}function So(e,t){if(t!==e._currentFramebuffer){e._currentFramebuffer=t;var i=Eo;if(Object(o.default)(t))t._bind(),i=t._getActiveColorAttachments();else{var a=e._gl;a.bindFramebuffer(a.FRAMEBUFFER,null)}e.drawBuffers&&e.glDrawBuffers(i)}}Object.defineProperties(To.prototype,{id:{get:function(){return this._id}},webgl2:{get:function(){return this._webgl2}},canvas:{get:function(){return this._canvas}},shaderCache:{get:function(){return this._shaderCache}},textureCache:{get:function(){return this._textureCache}},uniformState:{get:function(){return this._us}},stencilBits:{get:function(){return this._stencilBits}},stencilBuffer:{get:function(){return this._stencilBits>=8}},antialias:{get:function(){return this._antialias}},standardDerivatives:{get:function(){return this._standardDerivatives||this._webgl2}},floatBlend:{get:function(){return this._floatBlend}},blendMinmax:{get:function(){return this._blendMinmax||this._webgl2}},elementIndexUint:{get:function(){return this._elementIndexUint||this._webgl2}},depthTexture:{get:function(){return this._depthTexture||this._webgl2}},floatingPointTexture:{get:function(){return this._webgl2||this._textureFloat}},floatTextureSixPlaces:{get:function(){return this._floatTexSixPlaces}},halfFloatingPointTexture:{get:function(){return this._webgl2||this._textureHalfFloat}},textureFloatLinear:{get:function(){return this._textureFloatLinear}},textureHalfFloatLinear:{get:function(){return this._webgl2&&this._textureFloatLinear||!this._webgl2&&this._textureHalfFloatLinear}},textureFilterAnisotropic:{get:function(){return!!this._textureFilterAnisotropic}},s3tc:{get:function(){return this._s3tc}},pvrtc:{get:function(){return this._pvrtc}},etc1:{get:function(){return this._etc1}},vertexArrayObject:{get:function(){return this._vertexArrayObject||this._webgl2}},fragmentDepth:{get:function(){return this._fragDepth||this._webgl2}},instancedArrays:{get:function(){return this._instancedArrays||this._webgl2}},colorBufferFloat:{get:function(){return this._colorBufferFloat}},colorBufferHalfFloat:{get:function(){return this._webgl2&&this._colorBufferFloat||!this._webgl2&&this._colorBufferHalfFloat}},drawBuffers:{get:function(){return this._drawBuffers||this._webgl2}},debugShaders:{get:function(){return this._debugShaders}},throwOnWebGLError:{get:function(){return this._throwOnWebGLError},set:function(e){this._throwOnWebGLError=e,this._gl=function(e,t){if(!Object(o.default)(t))return e;function i(i){return function(){var a=i.apply(e,arguments);return t(e,i,arguments),a}}var a={};for(var r in e){var n=e[r];n instanceof Function?a[r]=i(n):Object.defineProperty(a,r,Oo(e,r,t))}return a}(this._originalGLContext,e?xo:void 0)}},defaultTexture:{get:function(){return void 0===this._defaultTexture&&(this._defaultTexture=new P.a({context:this,source:{width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])},flipY:!1})),this._defaultTexture}},defaultCubeMap:{get:function(){if(void 0===this._defaultCubeMap){var e={width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])};this._defaultCubeMap=new Qn.a({context:this,source:{positiveX:e,negativeX:e,positiveY:e,negativeY:e,positiveZ:e,negativeZ:e},flipY:!1})}return this._defaultCubeMap}},drawingBufferHeight:{get:function(){return this._gl.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._gl.drawingBufferWidth}},defaultFramebuffer:{get:function(){return Po}}}),"undefined"!=typeof WebGLRenderingContext&&(Eo=[kn.a.BACK]);var Do=new Mn.a;To.prototype.clear=function(e,t){e=Object(n.default)(e,Do),t=Object(n.default)(t,this._defaultPassState);var i=this._gl,a=0,r=e.color,s=e.depth,l=e.stencil;Object(o.default)(r)&&(k.default.equals(this._clearColor,r)||(k.default.clone(r,this._clearColor),i.clearColor(r.red,r.green,r.blue,r.alpha)),a|=i.COLOR_BUFFER_BIT),Object(o.default)(s)&&(s!==this._clearDepth&&(this._clearDepth=s,i.clearDepth(s)),a|=i.DEPTH_BUFFER_BIT),Object(o.default)(l)&&(l!==this._clearStencil&&(this._clearStencil=l,i.clearStencil(l)),a|=i.STENCIL_BUFFER_BIT),Ao(this,Object(n.default)(e.renderState,this._defaultRenderState),t,!0),So(this,Object(n.default)(e.framebuffer,t.framebuffer)),i.clear(a)},To.prototype.draw=function(e,t,i,a){t=Object(n.default)(t,this._defaultPassState);var r=Object(n.default)(e._framebuffer,t.framebuffer),s=Object(n.default)(e._renderState,this._defaultRenderState);i=Object(n.default)(i,e._shaderProgram),a=Object(n.default)(a,e._uniformMap),function(e,t,i,a,r){So(e,t),Ao(e,r,i,!1),a._bind(),e._maxFrameTextureUnitIndex=Math.max(e._maxFrameTextureUnitIndex,a.maximumTextureUnitIndex)}(this,r,t,i,s),function(e,t,i,a){var r=t._primitiveType,s=t._vertexArray,l=t._offset,u=t._count,d=t.instanceCount;e._us.model=Object(n.default)(t._modelMatrix,K.default.IDENTITY),i._setUniforms(a,e._us,e.validateShaderProgram),s._bind();var f=s.indexBuffer;Object(o.default)(f)?(l*=f.bytesPerIndex,u=Object(n.default)(u,f.numberOfIndices),0===d?e._gl.drawElements(r,u,f.indexDatatype,l):e.glDrawElementsInstanced(r,u,f.indexDatatype,l,d)):(u=Object(n.default)(u,s.numberOfVertices),0===d?e._gl.drawArrays(r,l,u):e.glDrawArraysInstanced(r,l,u,d)),s._unBind()}(this,e,i,a)},To.prototype.endFrame=function(){var e=this._gl;e.useProgram(null),this._currentFramebuffer=void 0,e.bindFramebuffer(e.FRAMEBUFFER,null);var t=Eo;this.drawBuffers&&this.glDrawBuffers(t);var i=this._maxFrameTextureUnitIndex;this._maxFrameTextureUnitIndex=0;for(var a=0;a<i;++a)e.activeTexture(e.TEXTURE0+a),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null)},To.prototype.readPixels=function(e){var t=this._gl;e=Object(n.default)(e,n.default.EMPTY_OBJECT);var i=Math.max(Object(n.default)(e.x,0),0),a=Math.max(Object(n.default)(e.y,0),0),r=Object(n.default)(e.width,t.drawingBufferWidth),s=Object(n.default)(e.height,t.drawingBufferHeight),l=e.framebuffer,u=ye.a.UNSIGNED_BYTE;Object(o.default)(l)&&l.numberOfColorAttachments>0&&(u=l.getColorTexture(0).pixelDatatype);var d=me.a.createTypedArray(me.a.RGBA,u,r,s);return So(this,l),t.readPixels(i,a,r,s,me.a.RGBA,u,d),d};var Io={position:0,textureCoordinates:1};function Mo(e,t,i){this._pickObjects=e,this.key=t,this.color=i}To.prototype.getViewportQuadVertexArray=function(){var e=this.cache.viewportQuad_vertexArray;if(!Object(o.default)(e)){var t=new zn.a({attributes:{position:new Bn.a({componentDatatype:Un.a.FLOAT,componentsPerAttribute:2,values:[-1,-1,1,-1,1,1,-1,1]}),textureCoordinates:new Bn.a({componentDatatype:Un.a.FLOAT,componentsPerAttribute:2,values:[0,0,1,0,1,1,0,1]})},indices:new Uint16Array([0,1,2,0,2,3]),primitiveType:ee.a.TRIANGLES});e=de.a.fromGeometry({context:this,geometry:t,attributeLocations:Io,bufferUsage:ne.a.STATIC_DRAW,interleave:!0}),this.cache.viewportQuad_vertexArray=e}return e},To.prototype.createViewportQuadCommand=function(e,t){return t=Object(n.default)(t,n.default.EMPTY_OBJECT),new se.a({vertexArray:this.getViewportQuadVertexArray(),primitiveType:ee.a.TRIANGLES,renderState:t.renderState,shaderProgram:F.a.fromCache({context:this,vertexShaderSource:Fn,fragmentShaderSource:e,attributeLocations:Io}),uniformMap:t.uniformMap,owner:t.owner,framebuffer:t.framebuffer,pass:t.pass})},To.prototype.getObjectByPickColor=function(e){return this._pickObjects[e.toRgba()]},Object.defineProperties(Mo.prototype,{object:{get:function(){return this._pickObjects[this.key]},set:function(e){this._pickObjects[this.key]=e}}}),Mo.prototype.destroy=function(){delete this._pickObjects[this.key]},To.prototype.createPickId=function(e){++this._nextPickColor[0];var t=this._nextPickColor[0];if(0===t)throw new Hn.default("Out of unique Pick IDs.");return this._pickObjects[t]=e,new Mo(this._pickObjects,t,k.default.fromRgba(t))},To.prototype.isDestroyed=function(){return!1},To.prototype.destroy=function(){var e=this.cache;for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];Object(o.default)(i.destroy)&&i.destroy()}return this._shaderCache=this._shaderCache.destroy(),this._textureCache=this._textureCache.destroy(),this._defaultTexture=this._defaultTexture&&this._defaultTexture.destroy(),this._defaultCubeMap=this._defaultCubeMap&&this._defaultCubeMap.destroy(),Object(s.default)(this)};var Fo=To,Ro="varying vec2 v_textureCoordinates;\nconst float M_PI = 3.141592653589793;\n\nfloat vdcRadicalInverse(int i)\n{\n    float r;\n    float base = 2.0;\n    float value = 0.0;\n    float invBase = 1.0 / base;\n    float invBi = invBase;\n    for (int x = 0; x < 100; x++)\n    {\n        if (i <= 0)\n        {\n            break;\n        }\n        r = mod(float(i), base);\n        value += r * invBi;\n        invBi *= invBase;\n        i = int(float(i) * invBase);\n    }\n    return value;\n}\n\nvec2 hammersley2D(int i, int N)\n{\n    return vec2(float(i) / float(N), vdcRadicalInverse(i));\n}\n\nvec3 importanceSampleGGX(vec2 xi, float roughness, vec3 N)\n{\n    float a = roughness * roughness;\n    float phi = 2.0 * M_PI * xi.x;\n    float cosTheta = sqrt((1.0 - xi.y) / (1.0 + (a * a - 1.0) * xi.y));\n    float sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n    vec3 H = vec3(sinTheta * cos(phi), sinTheta * sin(phi), cosTheta);\n    vec3 upVector = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\n    vec3 tangentX = normalize(cross(upVector, N));\n    vec3 tangentY = cross(N, tangentX);\n    return tangentX * H.x + tangentY * H.y + N * H.z;\n}\n\nfloat G1_Smith(float NdotV, float k)\n{\n    return NdotV / (NdotV * (1.0 - k) + k);\n}\n\nfloat G_Smith(float roughness, float NdotV, float NdotL)\n{\n    float k = roughness * roughness / 2.0;\n    return G1_Smith(NdotV, k) * G1_Smith(NdotL, k);\n}\n\nvec2 integrateBrdf(float roughness, float NdotV)\n{\n    vec3 V = vec3(sqrt(1.0 - NdotV * NdotV), 0.0, NdotV);\n    float A = 0.0;\n    float B = 0.0;\n    const int NumSamples = 1024;\n    for (int i = 0; i < NumSamples; i++)\n    {\n        vec2 xi = hammersley2D(i, NumSamples);\n        vec3 H = importanceSampleGGX(xi, roughness, vec3(0.0, 0.0, 1.0));\n        vec3 L = 2.0 * dot(V, H) * H - V;\n        float NdotL = clamp(L.z, 0.0, 1.0);\n        float NdotH = clamp(H.z, 0.0, 1.0);\n        float VdotH = clamp(dot(V, H), 0.0, 1.0);\n        if (NdotL > 0.0)\n        {\n            float G = G_Smith(roughness, NdotV, NdotL);\n            float G_Vis = G * VdotH / (NdotH * NdotV);\n            float Fc = pow(1.0 - VdotH, 5.0);\n            A += (1.0 - Fc) * G_Vis;\n            B += Fc * G_Vis;\n        }\n    }\n    return vec2(A, B) / float(NumSamples);\n}\n\nvoid main()\n{\n    gl_FragColor = vec4(integrateBrdf(v_textureCoordinates.y, v_textureCoordinates.x), 0.0, 1.0);\n}\n";function No(){this._framebuffer=void 0,this._colorTexture=void 0,this._drawCommand=void 0}Object.defineProperties(No.prototype,{colorTexture:{get:function(){return this._colorTexture}}}),No.prototype.update=function(e){if(!Object(o.default)(this._colorTexture)){var t=e.context;!function(e,t){var i=new P.a({context:t,width:256,height:256,pixelFormat:me.a.RGBA,pixelDatatype:ye.a.UNSIGNED_BYTE,sampler:be.a.NEAREST});e._colorTexture=i;var a=new Rn.a({context:t,colorTextures:[i],destroyAttachments:!1});e._framebuffer=a}(this,t),function(e,t){var i=e._framebuffer,a=t.createViewportQuadCommand(Ro,{framebuffer:i,renderState:ue.a.fromCache({viewport:new an.default(0,0,256,256)})});e._drawCommand=a}(this,t),this._drawCommand.execute(t),this._framebuffer=this._framebuffer&&this._framebuffer.destroy(),this._drawCommand.shaderProgram=this._drawCommand.shaderProgram&&this._drawCommand.shaderProgram.destroy()}},No.prototype.isDestroyed=function(){return!1},No.prototype.destroy=function(){return this._colorTexture=this._colorTexture&&this._colorTexture.destroy(),Object(s.default)(this)};var Lo=No,jo=i(202),Vo=i(229),Uo=i(351),zo=i(265),Bo=i(743),Ho=Object.freeze({ROTATE:0,INFINITE_SCROLL:1});function ko(e){this._scene=e,this._transform=K.default.clone(K.default.IDENTITY),this._invTransform=K.default.clone(K.default.IDENTITY),this._actualTransform=K.default.clone(K.default.IDENTITY),this._actualInvTransform=K.default.clone(K.default.IDENTITY),this._transformChanged=!1,this.position=new a.default,this._position=new a.default,this._positionWC=new a.default,this._positionCartographic=new v.default,this._oldPositionWC=void 0,this.positionWCDeltaMagnitude=0,this.positionWCDeltaMagnitudeLastFrame=0,this.timeSinceMoved=0,this._lastMovedTimestamp=0,this.direction=new a.default,this._direction=new a.default,this._directionWC=new a.default,this.up=new a.default,this._up=new a.default,this._upWC=new a.default,this.right=new a.default,this._right=new a.default,this._rightWC=new a.default,this.frustum=new An.a,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.fov=Z.default.toRadians(60),this.defaultMoveAmount=1e5,this.defaultLookAmount=Math.PI/60,this.defaultRotateAmount=Math.PI/3600,this.defaultZoomAmount=1e5,this.constrainedAxis=void 0,this.maximumZoomFactor=1.5,this._moveStart=new b.default,this._moveEnd=new b.default,this._changed=new b.default,this._changedPosition=void 0,this._changedDirection=void 0,this._changedFrustum=void 0,this.percentageChanged=.5,this._viewMatrix=new K.default,this._invViewMatrix=new K.default,Wo(this),this._mode=N.a.SCENE3D,this._modeChanged=!0;var t=e.mapProjection;this._projection=t,this._maxCoord=t.project(new v.default(Math.PI,Z.default.PI_OVER_TWO)),this._max2Dfrustum=void 0,nl(this,ko.DEFAULT_VIEW_RECTANGLE,this.position,!0);var i=a.default.magnitude(this.position);i+=i*ko.DEFAULT_VIEW_FACTOR,a.default.normalize(this.position,this.position),a.default.multiplyByScalar(this.position,i,this.position)}function Wo(e){K.default.computeView(e._position,e._direction,e._up,e._right,e._viewMatrix),K.default.multiply(e._viewMatrix,e._actualInvTransform,e._viewMatrix),K.default.inverseTransformation(e._viewMatrix,e._invViewMatrix)}ko.TRANSFORM_2D=new K.default(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),ko.TRANSFORM_2D_INVERSE=K.default.inverseTransformation(ko.TRANSFORM_2D,new K.default),ko.DEFAULT_VIEW_RECTANGLE=C.default.fromDegrees(-95,-20,-70,90),ko.DEFAULT_VIEW_FACTOR=.5,ko.DEFAULT_OFFSET=new Uo.default(0,-Z.default.PI_OVER_FOUR,0),ko.prototype.canPreloadFlight=function(){return Object(o.default)(this._currentFlight)&&this._mode!==N.a.SCENE2D},ko.prototype._updateCameraChanged=function(){if(function(e){if(Object(o.default)(e._oldPositionWC)){e.positionWCDeltaMagnitudeLastFrame=e.positionWCDeltaMagnitude;var t=a.default.subtract(e.positionWC,e._oldPositionWC,e._oldPositionWC);e.positionWCDeltaMagnitude=a.default.magnitude(t),e._oldPositionWC=a.default.clone(e.positionWC,e._oldPositionWC),e.positionWCDeltaMagnitude>0?(e.timeSinceMoved=0,e._lastMovedTimestamp=Object(di.default)()):e.timeSinceMoved=Math.max(Object(di.default)()-e._lastMovedTimestamp,0)/1e3}else e._oldPositionWC=a.default.clone(e.positionWC,e._oldPositionWC)}(this),0!==this._changed.numberOfListeners){var e=this.percentageChanged;if(this._mode!==N.a.SCENE2D){if(!Object(o.default)(this._changedDirection))return this._changedPosition=a.default.clone(this.positionWC,this._changedPosition),void(this._changedDirection=a.default.clone(this.directionWC,this._changedDirection));var t,i=Z.default.acosClamped(a.default.dot(this.directionWC,this._changedDirection));t=Object(o.default)(this.frustum.fovy)?i/(.5*this.frustum.fovy):i;var r=a.default.distance(this.positionWC,this._changedPosition)/this.positionCartographic.height;(t>e||r>e)&&(this._changed.raiseEvent(Math.max(t,r)),this._changedPosition=a.default.clone(this.positionWC,this._changedPosition),this._changedDirection=a.default.clone(this.directionWC,this._changedDirection))}else{if(!Object(o.default)(this._changedFrustum))return this._changedPosition=a.default.clone(this.position,this._changedPosition),void(this._changedFrustum=this.frustum.clone());var n,s=this.position,l=this._changedPosition,u=this.frustum,d=this._changedFrustum,f=s.x+u.left,c=s.x+u.right,h=l.x+d.left,m=l.x+d.right,p=s.y+u.bottom,_=s.y+u.top,g=l.y+d.bottom,v=l.y+d.top,y=Math.max(f,h),b=Math.min(c,m),w=Math.max(p,g),x=Math.min(_,v);if(y>=b||w>=_)n=1;else{var O=d;f<h&&c>m&&p<g&&_>v&&(O=u),n=1-(b-y)*(x-w)/((O.right-O.left)*(O.top-O.bottom))}n>e&&(this._changed.raiseEvent(n),this._changedPosition=a.default.clone(this.position,this._changedPosition),this._changedFrustum=this.frustum.clone(this._changedFrustum))}}};var Go=new v.default,Yo=new a.default,Xo=new a.default,Qo=new B.a,qo=new B.a,Zo=new B.a,Ko=new B.a,Jo=new B.a;var $o=new a.default;function es(e){var t=e._mode,i=!1,r=0;t===N.a.SCENE2D&&(i=(r=e.frustum.right-e.frustum.left)!==e._positionCartographic.height);var n=e._position,o=!a.default.equals(n,e.position)||i;o&&(n=a.default.clone(e.position,e._position));var s=e._direction,l=!a.default.equals(s,e.direction);l&&(a.default.normalize(e.direction,e.direction),s=a.default.clone(e.direction,e._direction));var u=e._up,d=!a.default.equals(u,e.up);d&&(a.default.normalize(e.up,e.up),u=a.default.clone(e.up,e._up));var f=e._right,c=!a.default.equals(f,e.right);c&&(a.default.normalize(e.right,e.right),f=a.default.clone(e.right,e._right));var h=e._transformChanged||e._modeChanged;e._transformChanged=!1,h&&(K.default.inverseTransformation(e._transform,e._invTransform),e._mode===N.a.COLUMBUS_VIEW||e._mode===N.a.SCENE2D?K.default.equals(K.default.IDENTITY,e._transform)?K.default.clone(ko.TRANSFORM_2D,e._actualTransform):e._mode===N.a.COLUMBUS_VIEW?function(e){Ur.default.basisTo2D(e._projection,e._transform,e._actualTransform)}(e):function(e){var t=e._projection,i=t.ellipsoid,r=K.default.getColumn(e._transform,3,Qo),n=i.cartesianToCartographic(r,Go),o=t.project(n,Yo),s=qo;s.x=o.z,s.y=o.x,s.z=o.y,s.w=1;var l=B.a.clone(B.a.UNIT_X,Jo),u=B.a.add(K.default.getColumn(e._transform,0,Xo),r,Xo);i.cartesianToCartographic(u,n),t.project(n,o);var d=Zo;d.x=o.z,d.y=o.x,d.z=o.y,d.w=0,a.default.subtract(d,s,d),d.x=0;var f=Ko;if(a.default.magnitudeSquared(d)>Z.default.EPSILON10)a.default.cross(l,d,f);else{var c=B.a.add(K.default.getColumn(e._transform,1,Xo),r,Xo);i.cartesianToCartographic(c,n),t.project(n,o),f.x=o.z,f.y=o.x,f.z=o.y,f.w=0,a.default.subtract(f,s,f),f.x=0,a.default.magnitudeSquared(f)<Z.default.EPSILON10&&(B.a.clone(B.a.UNIT_Y,d),B.a.clone(B.a.UNIT_Z,f))}a.default.cross(f,l,d),a.default.normalize(d,d),a.default.cross(l,d,f),a.default.normalize(f,f),K.default.setColumn(e._actualTransform,0,d,e._actualTransform),K.default.setColumn(e._actualTransform,1,f,e._actualTransform),K.default.setColumn(e._actualTransform,2,l,e._actualTransform),K.default.setColumn(e._actualTransform,3,s,e._actualTransform)}(e):K.default.clone(e._transform,e._actualTransform),K.default.inverseTransformation(e._actualTransform,e._actualInvTransform),e._modeChanged=!1);var m=e._actualTransform;if(o||h)if(e._positionWC=K.default.multiplyByPoint(m,n,e._positionWC),t===N.a.SCENE3D||t===N.a.MORPHING)e._positionCartographic=e._projection.ellipsoid.cartesianToCartographic(e._positionWC,e._positionCartographic);else{var p=$o;p.x=e._positionWC.y,p.y=e._positionWC.z,p.z=e._positionWC.x,t===N.a.SCENE2D&&(p.z=r),e._projection.unproject(p,e._positionCartographic)}if(l||d||c){var _=a.default.dot(s,a.default.cross(u,f,$o));if(Math.abs(1-_)>Z.default.EPSILON2){var g=1/a.default.magnitudeSquared(u),v=a.default.dot(u,s)*g,y=a.default.multiplyByScalar(s,v,$o);u=a.default.normalize(a.default.subtract(u,y,e._up),e._up),a.default.clone(u,e.up),f=a.default.cross(s,u,e._right),a.default.clone(f,e.right)}}(l||h)&&(e._directionWC=K.default.multiplyByPointAsVector(m,s,e._directionWC),a.default.normalize(e._directionWC,e._directionWC)),(d||h)&&(e._upWC=K.default.multiplyByPointAsVector(m,u,e._upWC),a.default.normalize(e._upWC,e._upWC)),(c||h)&&(e._rightWC=K.default.multiplyByPointAsVector(m,f,e._rightWC),a.default.normalize(e._rightWC,e._rightWC)),(o||l||d||c||h)&&Wo(e)}function ts(e,t){var i;return i=Z.default.equalsEpsilon(Math.abs(e.z),1,Z.default.EPSILON3)?Math.atan2(t.y,t.x)-Z.default.PI_OVER_TWO:Math.atan2(e.y,e.x)-Z.default.PI_OVER_TWO,Z.default.TWO_PI-Z.default.zeroToTwoPi(i)}function is(e){return Z.default.PI_OVER_TWO-Z.default.acosClamped(e.z)}function as(e,t,i){var a=0;return Z.default.equalsEpsilon(Math.abs(e.z),1,Z.default.EPSILON3)||(a=Math.atan2(-i.z,t.z),a=Z.default.zeroToTwoPi(a+Z.default.TWO_PI)),a}var rs=new K.default,ns=new K.default;Object.defineProperties(ko.prototype,{transform:{get:function(){return this._transform}},inverseTransform:{get:function(){return es(this),this._invTransform}},viewMatrix:{get:function(){return es(this),this._viewMatrix}},inverseViewMatrix:{get:function(){return es(this),this._invViewMatrix}},positionCartographic:{get:function(){return es(this),this._positionCartographic}},positionWC:{get:function(){return es(this),this._positionWC}},directionWC:{get:function(){return es(this),this._directionWC}},upWC:{get:function(){return es(this),this._upWC}},rightWC:{get:function(){return es(this),this._rightWC}},heading:{get:function(){if(this._mode!==N.a.MORPHING){var e=this._projection.ellipsoid,t=K.default.clone(this._transform,rs),i=Ur.default.eastNorthUpToFixedFrame(this.positionWC,e,ns);this._setTransform(i);var a=ts(this.direction,this.up);return this._setTransform(t),a}}},pitch:{get:function(){if(this._mode!==N.a.MORPHING){var e=this._projection.ellipsoid,t=K.default.clone(this._transform,rs),i=Ur.default.eastNorthUpToFixedFrame(this.positionWC,e,ns);this._setTransform(i);var a=is(this.direction);return this._setTransform(t),a}}},roll:{get:function(){if(this._mode!==N.a.MORPHING){var e=this._projection.ellipsoid,t=K.default.clone(this._transform,rs),i=Ur.default.eastNorthUpToFixedFrame(this.positionWC,e,ns);this._setTransform(i);var a=as(this.direction,this.up,this.right);return this._setTransform(t),a}}},moveStart:{get:function(){return this._moveStart}},moveEnd:{get:function(){return this._moveEnd}},changed:{get:function(){return this._changed}}}),ko.prototype.update=function(e){var t=!1;if(e!==this._mode&&(this._mode=e,this._modeChanged=e!==N.a.MORPHING,t=this._mode===N.a.SCENE2D),t){var i=this._max2Dfrustum=this.frustum.clone(),a=i.top/i.right;i.right=2*this._maxCoord.x,i.left=-i.right,i.top=a*i.right,i.bottom=-i.top}this._mode===N.a.SCENE2D&&Es(this,this.position)};var os=new a.default,ss=new a.default,ls=new a.default;ko.prototype._setTransform=function(e){var t=a.default.clone(this.positionWC,os),i=a.default.clone(this.upWC,ss),r=a.default.clone(this.directionWC,ls);K.default.clone(e,this._transform),this._transformChanged=!0,es(this);var n=this._actualInvTransform;K.default.multiplyByPoint(n,t,this.position),K.default.multiplyByPointAsVector(n,r,this.direction),K.default.multiplyByPointAsVector(n,i,this.up),a.default.cross(this.direction,this.up,this.right),es(this)};var us=new z.default,ds=new O.default,fs=new a.default,cs=new a.default;ko.prototype._adjustOrthographicFrustum=function(e){if(this.frustum instanceof $.a&&(e||!(this._positionCartographic.height<15e4)))if(K.default.equals(K.default.IDENTITY,this.transform)){var t,i,r=this._scene,n=r.globe;if(Object(o.default)(n)){var s=us;s.x=r.drawingBufferWidth/2,s.y=r.drawingBufferHeight/2;var l=this.getPickRay(s,ds);if(t=n.pickWorldCoordinates(l,r,fs),r.pickPositionSupported&&(i=r.pickPositionWorldCoordinates(s,cs)),Object(o.default)(t)&&Object(o.default)(i)){var u=Object(o.default)(i)?a.default.distance(i,this.positionWC):Number.POSITIVE_INFINITY,d=Object(o.default)(t)?a.default.distance(t,this.positionWC):Number.POSITIVE_INFINITY;this.frustum.width=Math.min(u,d)}else Object(o.default)(i)?this.frustum.width=a.default.distance(i,this.positionWC):Object(o.default)(t)&&(this.frustum.width=a.default.distance(t,this.positionWC))}if(!Object(o.default)(n)||!Object(o.default)(t)&&!Object(o.default)(i)){var f=Math.max(this.positionCartographic.height,0);this.frustum.width=f}}else this.frustum.width=a.default.magnitude(this.position)};var hs=new a.default,ms=new K.default,ps=new K.default,_s=new pa.default,gs=new ma.default,vs=new v.default;var ys=new a.default,bs=new a.default,ws=new a.default;function xs(e,t,i,r){var n=a.default.clone(i.direction,ys),o=a.default.clone(i.up,bs);if(e._scene.mode===N.a.SCENE3D){var s=e._projection.ellipsoid,l=Ur.default.eastNorthUpToFixedFrame(t,s,rs),u=K.default.inverseTransformation(l,ns);K.default.multiplyByPointAsVector(u,n,n),K.default.multiplyByPointAsVector(u,o,o)}var d=a.default.cross(n,o,ws);return r.heading=ts(n,o),r.pitch=is(n),r.roll=as(n,o,d),r}var Os={destination:void 0,orientation:{direction:void 0,up:void 0,heading:void 0,pitch:void 0,roll:void 0},convert:void 0,endTransform:void 0},Cs=new zo.default;ko.prototype.setView=function(e){e=Object(n.default)(e,n.default.EMPTY_OBJECT);var t=Object(n.default)(e.orientation,n.default.EMPTY_OBJECT),i=this._mode;if(i!==N.a.MORPHING){Object(o.default)(e.endTransform)&&this._setTransform(e.endTransform);var r=Object(n.default)(e.convert,!0),s=Object(n.default)(e.destination,a.default.clone(this.positionWC,hs));Object(o.default)(s)&&Object(o.default)(s.west)&&(s=this.getRectangleCameraCoordinates(s,hs),r=!1),Object(o.default)(t.direction)&&(t=xs(this,s,t,Os.orientation)),Cs.heading=Object(n.default)(t.heading,0),Cs.pitch=Object(n.default)(t.pitch,-Z.default.PI_OVER_TWO),Cs.roll=Object(n.default)(t.roll,0),i===N.a.SCENE3D?function(e,t,i){var r=K.default.clone(e.transform,ms),n=Ur.default.eastNorthUpToFixedFrame(t,e._projection.ellipsoid,ps);e._setTransform(n),a.default.clone(a.default.ZERO,e.position),i.heading=i.heading-Z.default.PI_OVER_TWO;var o=pa.default.fromHeadingPitchRoll(i,_s),s=ma.default.fromQuaternion(o,gs);ma.default.getColumn(s,0,e.direction),ma.default.getColumn(s,2,e.up),a.default.cross(e.direction,e.up,e.right),e._setTransform(r),e._adjustOrthographicFrustum(!0)}(this,s,Cs):i===N.a.SCENE2D?function(e,t,i,r){var n=K.default.clone(e.transform,ms);if(e._setTransform(K.default.IDENTITY),!a.default.equals(t,e.positionWC)){if(r){var o=e._projection,s=o.ellipsoid.cartesianToCartographic(t,vs);t=o.project(s,hs)}z.default.clone(t,e.position);var l=.5*-t.z,u=-l,d=e.frustum;if(u>l){var f=d.top/d.right;d.right=u,d.left=l,d.top=d.right*f,d.bottom=-d.top}}if(e._scene.mapMode2D===Ho.ROTATE){i.heading=i.heading-Z.default.PI_OVER_TWO,i.pitch=-Z.default.PI_OVER_TWO,i.roll=0;var c=pa.default.fromHeadingPitchRoll(i,_s),h=ma.default.fromQuaternion(c,gs);ma.default.getColumn(h,2,e.up),a.default.cross(e.direction,e.up,e.right)}e._setTransform(n)}(this,s,Cs,r):function(e,t,i,r){var n=K.default.clone(e.transform,ms);if(e._setTransform(K.default.IDENTITY),!a.default.equals(t,e.positionWC)){if(r){var o=e._projection,s=o.ellipsoid.cartesianToCartographic(t,vs);t=o.project(s,hs)}a.default.clone(t,e.position)}i.heading=i.heading-Z.default.PI_OVER_TWO;var l=pa.default.fromHeadingPitchRoll(i,_s),u=ma.default.fromQuaternion(l,gs);ma.default.getColumn(u,0,e.direction),ma.default.getColumn(u,2,e.up),a.default.cross(e.direction,e.up,e.right),e._setTransform(n),e._adjustOrthographicFrustum(!0)}(this,s,Cs,r)}};var Ts=new a.default;function Es(e,t){var i,a,r=e._scene.mapMode2D===Ho.ROTATE,n=e._maxCoord.x,o=e._maxCoord.y;r?i=-(a=n):(a=t.x-2*n,i=t.x+2*n),t.x>n&&(t.x=a),t.x<-n&&(t.x=i),t.y>o&&(t.y=o),t.y<-o&&(t.y=-o)}ko.prototype.flyHome=function(e){var t=this._mode;if(t===N.a.MORPHING&&this._scene.completeMorph(),t===N.a.SCENE2D)this.flyTo({destination:ko.DEFAULT_VIEW_RECTANGLE,duration:e,endTransform:K.default.IDENTITY});else if(t===N.a.SCENE3D){var i=this.getRectangleCameraCoordinates(ko.DEFAULT_VIEW_RECTANGLE),r=a.default.magnitude(i);r+=r*ko.DEFAULT_VIEW_FACTOR,a.default.normalize(i,i),a.default.multiplyByScalar(i,r,i),this.flyTo({destination:i,duration:e,endTransform:K.default.IDENTITY})}else if(t===N.a.COLUMBUS_VIEW){var n=this._projection.ellipsoid.maximumRadius,o=new a.default(0,-1,1);o=a.default.multiplyByScalar(a.default.normalize(o,o),5*n,o),this.flyTo({destination:o,duration:e,orientation:{heading:0,pitch:-Math.acos(a.default.normalize(o,Ts).z),roll:0},endTransform:K.default.IDENTITY,convert:!1})}},ko.prototype.worldToCameraCoordinates=function(e,t){return Object(o.default)(t)||(t=new B.a),es(this),K.default.multiplyByVector(this._actualInvTransform,e,t)},ko.prototype.worldToCameraCoordinatesPoint=function(e,t){return Object(o.default)(t)||(t=new a.default),es(this),K.default.multiplyByPoint(this._actualInvTransform,e,t)},ko.prototype.worldToCameraCoordinatesVector=function(e,t){return Object(o.default)(t)||(t=new a.default),es(this),K.default.multiplyByPointAsVector(this._actualInvTransform,e,t)},ko.prototype.cameraToWorldCoordinates=function(e,t){return Object(o.default)(t)||(t=new B.a),es(this),K.default.multiplyByVector(this._actualTransform,e,t)},ko.prototype.cameraToWorldCoordinatesPoint=function(e,t){return Object(o.default)(t)||(t=new a.default),es(this),K.default.multiplyByPoint(this._actualTransform,e,t)},ko.prototype.cameraToWorldCoordinatesVector=function(e,t){return Object(o.default)(t)||(t=new a.default),es(this),K.default.multiplyByPointAsVector(this._actualTransform,e,t)};var Ps=new a.default;ko.prototype.move=function(e,t){var i=this.position;a.default.multiplyByScalar(e,t,Ps),a.default.add(i,Ps,i),this._mode===N.a.SCENE2D&&Es(this,i),this._adjustOrthographicFrustum(!0)},ko.prototype.moveForward=function(e){e=Object(n.default)(e,this.defaultMoveAmount),this._mode===N.a.SCENE2D?Vs(this,e):this.move(this.direction,e)},ko.prototype.moveBackward=function(e){e=Object(n.default)(e,this.defaultMoveAmount),this._mode===N.a.SCENE2D?Vs(this,-e):this.move(this.direction,-e)},ko.prototype.moveUp=function(e){e=Object(n.default)(e,this.defaultMoveAmount),this.move(this.up,e)},ko.prototype.moveDown=function(e){e=Object(n.default)(e,this.defaultMoveAmount),this.move(this.up,-e)},ko.prototype.moveRight=function(e){e=Object(n.default)(e,this.defaultMoveAmount),this.move(this.right,e)},ko.prototype.moveLeft=function(e){e=Object(n.default)(e,this.defaultMoveAmount),this.move(this.right,-e)},ko.prototype.lookLeft=function(e){e=Object(n.default)(e,this.defaultLookAmount),this._mode!==N.a.SCENE2D&&this.look(this.up,-e)},ko.prototype.lookRight=function(e){e=Object(n.default)(e,this.defaultLookAmount),this._mode!==N.a.SCENE2D&&this.look(this.up,e)},ko.prototype.lookUp=function(e){e=Object(n.default)(e,this.defaultLookAmount),this._mode!==N.a.SCENE2D&&this.look(this.right,-e)},ko.prototype.lookDown=function(e){e=Object(n.default)(e,this.defaultLookAmount),this._mode!==N.a.SCENE2D&&this.look(this.right,e)};var As=new pa.default,Ss=new ma.default;ko.prototype.look=function(e,t){var i=Object(n.default)(t,this.defaultLookAmount),a=pa.default.fromAxisAngle(e,-i,As),r=ma.default.fromQuaternion(a,Ss),o=this.direction,s=this.up,l=this.right;ma.default.multiplyByVector(r,o,o),ma.default.multiplyByVector(r,s,s),ma.default.multiplyByVector(r,l,l)},ko.prototype.twistLeft=function(e){e=Object(n.default)(e,this.defaultLookAmount),this.look(this.direction,e)},ko.prototype.twistRight=function(e){e=Object(n.default)(e,this.defaultLookAmount),this.look(this.direction,-e)};var Ds=new pa.default,Is=new ma.default;ko.prototype.rotate=function(e,t){var i=Object(n.default)(t,this.defaultRotateAmount),r=pa.default.fromAxisAngle(e,-i,Ds),o=ma.default.fromQuaternion(r,Is);ma.default.multiplyByVector(o,this.position,this.position),ma.default.multiplyByVector(o,this.direction,this.direction),ma.default.multiplyByVector(o,this.up,this.up),a.default.cross(this.direction,this.up,this.right),a.default.cross(this.right,this.direction,this.up),this._adjustOrthographicFrustum(!1)},ko.prototype.rotateDown=function(e){Ls(this,e=Object(n.default)(e,this.defaultRotateAmount))},ko.prototype.rotateUp=function(e){Ls(this,-(e=Object(n.default)(e,this.defaultRotateAmount)))};var Ms=new a.default,Fs=new a.default,Rs=new a.default,Ns=new a.default;function Ls(e,t){var i=e.position;if(Object(o.default)(e.constrainedAxis)&&!a.default.equalsEpsilon(e.position,a.default.ZERO,Z.default.EPSILON2)){var r=a.default.normalize(i,Ms),n=a.default.equalsEpsilon(r,e.constrainedAxis,Z.default.EPSILON2),s=a.default.equalsEpsilon(r,a.default.negate(e.constrainedAxis,Ns),Z.default.EPSILON2);if(n||s)(n&&t<0||s&&t>0)&&e.rotate(e.right,t);else{var l=a.default.normalize(e.constrainedAxis,Fs),u=a.default.dot(r,l),d=Z.default.acosClamped(u);t>0&&t>d&&(t=d-Z.default.EPSILON4),u=a.default.dot(r,a.default.negate(l,Ns)),d=Z.default.acosClamped(u),t<0&&-t>d&&(t=-d+Z.default.EPSILON4);var f=a.default.cross(l,r,Rs);e.rotate(f,t)}}else e.rotate(e.right,t)}function js(e,t){Object(o.default)(e.constrainedAxis)?e.rotate(e.constrainedAxis,t):e.rotate(e.up,t)}function Vs(e,t){var i,a=e.frustum;if(t*=.5,Math.abs(a.top)+Math.abs(a.bottom)>Math.abs(a.left)+Math.abs(a.right)){var r=a.top-t,n=a.bottom+t,o=e._maxCoord.y;e._scene.mapMode2D===Ho.ROTATE&&(o*=e.maximumZoomFactor),n>o&&(n=o,r=-o),r<=n&&(r=1,n=-1),i=a.right/a.top,a.top=r,a.bottom=n,a.right=a.top*i,a.left=-a.right}else{var s=a.right-t,l=a.left+t,u=e._maxCoord.x;e._scene.mapMode2D===Ho.ROTATE&&(u*=e.maximumZoomFactor),s>u&&(s=u,l=-u),s<=l&&(s=1,l=-1),i=a.top/a.right,a.right=s,a.left=l,a.top=a.right*i,a.bottom=-a.top}}function Us(e,t){e.move(e.direction,t)}ko.prototype.rotateRight=function(e){js(this,-(e=Object(n.default)(e,this.defaultRotateAmount)))},ko.prototype.rotateLeft=function(e){js(this,e=Object(n.default)(e,this.defaultRotateAmount))},ko.prototype.zoomIn=function(e){e=Object(n.default)(e,this.defaultZoomAmount),this._mode===N.a.SCENE2D?Vs(this,e):Us(this,e)},ko.prototype.zoomOut=function(e){e=Object(n.default)(e,this.defaultZoomAmount),this._mode===N.a.SCENE2D?Vs(this,-e):Us(this,-e)},ko.prototype.getMagnitude=function(){return this._mode===N.a.SCENE3D?a.default.magnitude(this.position):this._mode===N.a.COLUMBUS_VIEW?Math.abs(this.position.z):this._mode===N.a.SCENE2D?Math.max(this.frustum.right-this.frustum.left,this.frustum.top-this.frustum.bottom):void 0};var zs=new K.default;ko.prototype.lookAt=function(e,t){var i=Ur.default.eastNorthUpToFixedFrame(e,u.default.WGS84,zs);this.lookAtTransform(i,t)};var Bs=new a.default,Hs=new pa.default,ks=new pa.default,Ws=new ma.default;function Gs(e,t,i){t=Z.default.clamp(t,-Z.default.PI_OVER_TWO,Z.default.PI_OVER_TWO),e=Z.default.zeroToTwoPi(e)-Z.default.PI_OVER_TWO;var r=pa.default.fromAxisAngle(a.default.UNIT_Y,-t,Hs),n=pa.default.fromAxisAngle(a.default.UNIT_Z,-e,ks),o=pa.default.multiply(n,r,n),s=ma.default.fromQuaternion(o,Ws),l=a.default.clone(a.default.UNIT_X,Bs);return ma.default.multiplyByVector(s,l,l),a.default.negate(l,l),a.default.multiplyByScalar(l,i,l),l}ko.prototype.lookAtTransform=function(e,t){if(this._setTransform(e),Object(o.default)(t)){var i;if(i=Object(o.default)(t.heading)?Gs(t.heading,t.pitch,t.range):t,this._mode===N.a.SCENE2D){z.default.clone(z.default.ZERO,this.position),a.default.negate(i,this.up),this.up.z=0,a.default.magnitudeSquared(this.up)<Z.default.EPSILON10&&a.default.clone(a.default.UNIT_Y,this.up),a.default.normalize(this.up,this.up),this._setTransform(K.default.IDENTITY),a.default.negate(a.default.UNIT_Z,this.direction),a.default.cross(this.direction,this.up,this.right),a.default.normalize(this.right,this.right);var r=this.frustum,n=r.top/r.right;return r.right=.5*a.default.magnitude(i),r.left=-r.right,r.top=n*r.right,r.bottom=-r.top,void this._setTransform(e)}a.default.clone(i,this.position),a.default.negate(this.position,this.direction),a.default.normalize(this.direction,this.direction),a.default.cross(this.direction,a.default.UNIT_Z,this.right),a.default.magnitudeSquared(this.right)<Z.default.EPSILON10&&a.default.clone(a.default.UNIT_X,this.right),a.default.normalize(this.right,this.right),a.default.cross(this.right,this.direction,this.up),a.default.normalize(this.up,this.up),this._adjustOrthographicFrustum(!0)}};var Ys,Xs=new v.default,Qs=new v.default,qs=new a.default,Zs=new a.default,Ks=new a.default,Js=new a.default,$s=new a.default,el=new a.default,tl=new a.default,il=new a.default,al={direction:new a.default,right:new a.default,up:new a.default};function rl(e,t,i,r){return Math.abs(a.default.dot(t,i))/r-a.default.dot(e,i)}function nl(e,t,i,r){var n=e._projection.ellipsoid,s=r?e:al,l=t.north,u=t.south,d=t.east,f=t.west;f>d&&(d+=Z.default.TWO_PI);var c,h=.5*(f+d);if(u<-Z.default.PI_OVER_TWO+Z.default.RADIANS_PER_DEGREE&&l>Z.default.PI_OVER_TWO-Z.default.RADIANS_PER_DEGREE)c=0;else{var m=Xs;m.longitude=h,m.latitude=l,m.height=0;var p=Qs;p.longitude=h,p.latitude=u,p.height=0;var _=Ys;Object(o.default)(_)&&_.ellipsoid===n||(Ys=_=new Vo.default(void 0,void 0,n)),_.setEndPoints(m,p),c=_.interpolateUsingFraction(.5,Xs).latitude}var g=Xs;g.longitude=h,g.latitude=c,g.height=0;var v=n.cartographicToCartesian(g,tl),y=Xs;y.longitude=d,y.latitude=l;var b=n.cartographicToCartesian(y,qs);y.longitude=f;var w=n.cartographicToCartesian(y,Ks);y.longitude=h;var x=n.cartographicToCartesian(y,$s);y.latitude=u;var O=n.cartographicToCartesian(y,el);y.longitude=d;var C=n.cartographicToCartesian(y,Js);y.longitude=f;var T=n.cartographicToCartesian(y,Zs);a.default.subtract(w,v,w),a.default.subtract(C,v,C),a.default.subtract(b,v,b),a.default.subtract(T,v,T),a.default.subtract(x,v,x),a.default.subtract(O,v,O);var E=n.geodeticSurfaceNormal(v,s.direction);a.default.negate(E,E);var P=a.default.cross(E,a.default.UNIT_Z,s.right);a.default.normalize(P,P);var A,S=a.default.cross(P,E,s.up);if(e.frustum instanceof $.a){var D,I,M=Math.max(a.default.distance(b,w),a.default.distance(C,T)),F=Math.max(a.default.distance(b,C),a.default.distance(w,T)),R=e.frustum._offCenterFrustum.right/e.frustum._offCenterFrustum.top,N=F*R;M>N?I=(D=M)/R:(I=F,D=N),A=Math.max(D,I)}else{var L=Math.tan(.5*e.frustum.fovy),j=e.frustum.aspectRatio*L;if(A=Math.max(rl(E,S,w,L),rl(E,S,C,L),rl(E,S,b,L),rl(E,S,T,L),rl(E,S,x,L),rl(E,S,O,L),rl(E,P,w,j),rl(E,P,C,j),rl(E,P,b,j),rl(E,P,T,j),rl(E,P,x,j),rl(E,P,O,j)),u<0&&l>0){var V=Xs;V.longitude=f,V.latitude=0,V.height=0;var U=n.cartographicToCartesian(V,il);a.default.subtract(U,v,U),A=Math.max(A,rl(E,S,U,L),rl(E,P,U,j)),V.longitude=d,U=n.cartographicToCartesian(V,il),a.default.subtract(U,v,U),A=Math.max(A,rl(E,S,U,L),rl(E,P,U,j))}}return a.default.add(v,a.default.multiplyByScalar(E,-A,il),i)}var ol=new v.default,sl=new a.default,ll=new a.default;var ul=new v.default,dl=new a.default,fl=new a.default;ko.prototype.getRectangleCameraCoordinates=function(e,t){var i=this._mode;return Object(o.default)(t)||(t=new a.default),i===N.a.SCENE3D?nl(this,e,t):i===N.a.COLUMBUS_VIEW?function(e,t,i){var a=e._projection;t.west>t.east&&(t=C.default.MAX_VALUE);var r=e._actualTransform,n=e._actualInvTransform,s=ol;s.longitude=t.east,s.latitude=t.north;var l=a.project(s,sl);K.default.multiplyByPoint(r,l,l),K.default.multiplyByPoint(n,l,l),s.longitude=t.west,s.latitude=t.south;var u=a.project(s,ll);if(K.default.multiplyByPoint(r,u,u),K.default.multiplyByPoint(n,u,u),i.x=.5*(l.x-u.x)+u.x,i.y=.5*(l.y-u.y)+u.y,Object(o.default)(e.frustum.fovy)){var d=Math.tan(.5*e.frustum.fovy),f=e.frustum.aspectRatio*d;i.z=.5*Math.max((l.x-u.x)/f,(l.y-u.y)/d)}else{var c=l.x-u.x,h=l.y-u.y;i.z=Math.max(c,h)}return i}(this,e,t):i===N.a.SCENE2D?function(e,t,i){var a=e._projection,r=t.east;t.west>t.east&&(e._scene.mapMode2D===Ho.INFINITE_SCROLL?r+=Z.default.TWO_PI:r=(t=C.default.MAX_VALUE).east);var n=ul;n.longitude=r,n.latitude=t.north;var o=a.project(n,dl);n.longitude=t.west,n.latitude=t.south;var s,l,u=a.project(n,fl),d=.5*Math.abs(o.x-u.x),f=.5*Math.abs(o.y-u.y),c=e.frustum.right/e.frustum.top,h=f*c;return d>h?l=(s=d)/c:(l=f,s=h),f=Math.max(2*s,2*l),i.x=.5*(o.x-u.x)+u.x,i.y=.5*(o.y-u.y)+u.y,(n=a.unproject(i,n)).height=f,i=a.project(n,i)}(this,e,t):void 0};var cl=new O.default;var hl=new O.default;var ml=new O.default;ko.prototype.pickEllipsoid=function(e,t,i){var r=this._scene.canvas;if(0!==r.clientWidth&&0!==r.clientHeight){if(Object(o.default)(i)||(i=new a.default),t=Object(n.default)(t,u.default.WGS84),this._mode===N.a.SCENE3D)i=function(e,t,i,a){i=Object(n.default)(i,u.default.WGS84);var r=e.getPickRay(t,cl),o=x.default.rayEllipsoid(r,i);if(o){var s=o.start>0?o.start:o.stop;return O.default.getPoint(r,s,a)}}(this,e,t,i);else if(this._mode===N.a.SCENE2D)i=function(e,t,i,r){var n=e.getPickRay(t,hl).origin;n=a.default.fromElements(n.y,n.z,0,n);var o=i.unproject(n);if(!(o.latitude<-Z.default.PI_OVER_TWO||o.latitude>Z.default.PI_OVER_TWO))return i.ellipsoid.cartographicToCartesian(o,r)}(this,e,this._projection,i);else{if(this._mode!==N.a.COLUMBUS_VIEW)return;i=function(e,t,i,r){var n=e.getPickRay(t,ml),o=-n.origin.x/n.direction.x;O.default.getPoint(n,o,r);var s=i.unproject(new a.default(r.y,r.z,0));if(!(s.latitude<-Z.default.PI_OVER_TWO||s.latitude>Z.default.PI_OVER_TWO||s.longitude<-Math.PI||s.longitude>Math.PI))return i.ellipsoid.cartographicToCartesian(s,r)}(this,e,this._projection,i)}return i}};var pl=new a.default,_l=new a.default,gl=new a.default;var vl=new a.default;ko.prototype.getPickRay=function(e,t){Object(o.default)(t)||(t=new O.default);var i=this.frustum;return Object(o.default)(i.aspectRatio)&&Object(o.default)(i.fov)&&Object(o.default)(i.near)?function(e,t,i){var r=e._scene.canvas,n=r.clientWidth,o=r.clientHeight,s=Math.tan(.5*e.frustum.fovy),l=e.frustum.aspectRatio*s,u=e.frustum.near,d=2/n*t.x-1,f=2/o*(o-t.y)-1,c=e.positionWC;a.default.clone(c,i.origin);var h=a.default.multiplyByScalar(e.directionWC,u,pl);a.default.add(c,h,h);var m=a.default.multiplyByScalar(e.rightWC,d*u*l,_l),p=a.default.multiplyByScalar(e.upWC,f*u*s,gl),_=a.default.add(h,m,i.direction);return a.default.add(_,p,_),a.default.subtract(_,c,_),a.default.normalize(_,_),i}(this,e,t):function(e,t,i){var r=e._scene.canvas,n=r.clientWidth,s=r.clientHeight,l=e.frustum;Object(o.default)(l._offCenterFrustum)&&(l=l._offCenterFrustum);var u=2/n*t.x-1;u*=.5*(l.right-l.left);var d=2/s*(s-t.y)-1;d*=.5*(l.top-l.bottom);var f=i.origin;return a.default.clone(e.position,f),a.default.multiplyByScalar(e.right,u,vl),a.default.add(vl,f,f),a.default.multiplyByScalar(e.up,d,vl),a.default.add(vl,f,f),a.default.clone(e.directionWC,i.direction),e._mode!==N.a.COLUMBUS_VIEW&&e._mode!==N.a.SCENE2D||a.default.fromElements(i.origin.z,i.origin.x,i.origin.y,i.origin),i}(this,e,t)};var yl=new a.default,bl=new a.default;ko.prototype.distanceToBoundingSphere=function(e){var t=a.default.subtract(this.positionWC,e.center,yl),i=a.default.multiplyByScalar(this.directionWC,a.default.dot(t,this.directionWC),bl);return Math.max(0,a.default.magnitude(i)-e.radius)};var wl=new z.default;ko.prototype.getPixelSize=function(e,t,i){var a=this.distanceToBoundingSphere(e),r=this.frustum.getPixelDimensions(t,i,a,this._scene.pixelRatio,wl);return Math.max(r.x,r.y)};var xl=new a.default,Ol=new a.default,Cl=new a.default,Tl=new a.default;function El(e,t){var i=e.position,r=e.direction,n=e.worldToCameraCoordinatesVector(a.default.UNIT_X,xl),o=-a.default.dot(n,i)/a.default.dot(n,r),s=a.default.add(i,a.default.multiplyByScalar(r,o,Ol),Ol);e.cameraToWorldCoordinatesPoint(s,s),i=e.cameraToWorldCoordinatesPoint(e.position,Cl);var l=Math.tan(.5*e.frustum.fovy),u=e.frustum.aspectRatio*l,d=a.default.magnitude(a.default.subtract(i,s,Tl)),f=u*d,c=l*d,h=e._maxCoord.x,m=e._maxCoord.y,p=Math.max(f-h,h),_=Math.max(c-m,m);if(i.z<-p||i.z>p||i.y<-_||i.y>_){var g=s.y<-p||s.y>p,v=s.z<-_||s.z>_;if(g||v)return function(e,t,i,r,n,o){var s=a.default.clone(t);return i.y>r?s.y-=i.y-r:i.y<-r&&(s.y+=-r-i.y),i.z>n?s.z-=i.z-n:i.z<-n&&(s.z+=-n-i.z),{easingFunction:jo.default.EXPONENTIAL_OUT,startObject:{time:0},stopObject:{time:1},duration:o,update:function(i){var r=a.default.lerp(t,s,i.time,new a.default);e.worldToCameraCoordinatesPoint(r,e.position)}}}(e,i,s,p,_,t)}}ko.prototype.createCorrectPositionTween=function(e){if(this._mode===N.a.COLUMBUS_VIEW)return El(this,e)};var Pl=new a.default,Al={destination:void 0,heading:void 0,pitch:void 0,roll:void 0,duration:void 0,complete:void 0,cancel:void 0,endTransform:void 0,maximumHeight:void 0,easingFunction:void 0};ko.prototype.cancelFlight=function(){Object(o.default)(this._currentFlight)&&(this._currentFlight.cancelTween(),this._currentFlight=void 0)},ko.prototype.flyTo=function(e){var t=(e=Object(n.default)(e,n.default.EMPTY_OBJECT)).destination;if(this._mode!==N.a.MORPHING){this.cancelFlight();var i=Object(n.default)(e.orientation,n.default.EMPTY_OBJECT);if(Object(o.default)(i.direction)&&(i=xs(this,t,i,Os.orientation)),Object(o.default)(e.duration)&&e.duration<=0){var a=Os;return a.destination=e.destination,a.orientation.heading=i.heading,a.orientation.pitch=i.pitch,a.orientation.roll=i.roll,a.convert=e.convert,a.endTransform=e.endTransform,this.setView(a),void("function"==typeof e.complete&&e.complete())}var r=Object(o.default)(t.west);r&&(t=this.getRectangleCameraCoordinates(t,Pl));var s,l=this;Al.destination=t,Al.heading=i.heading,Al.pitch=i.pitch,Al.roll=i.roll,Al.duration=e.duration,Al.complete=function(){s===l._currentFlight&&(l._currentFlight=void 0),Object(o.default)(e.complete)&&e.complete()},Al.cancel=e.cancel,Al.endTransform=e.endTransform,Al.convert=!r&&e.convert,Al.maximumHeight=e.maximumHeight,Al.pitchAdjustHeight=e.pitchAdjustHeight,Al.flyOverLongitude=e.flyOverLongitude,Al.flyOverLongitudeWeight=e.flyOverLongitudeWeight,Al.easingFunction=e.easingFunction;var u=this._scene,d=Bo.default.createTween(u,Al);if(0!==d.duration){s=u.tweens.add(d),this._currentFlight=s;var f=this._scene.preloadFlightCamera;this._mode!==N.a.SCENE2D&&(Object(o.default)(f)||(f=ko.clone(this)),f.setView({destination:t,orientation:i}),this._scene.preloadFlightCullingVolume=f.frustum.computeCullingVolume(f.positionWC,f.directionWC,f.upWC))}else"function"==typeof d.complete&&d.complete()}};var Sl=100;function Dl(e,t,i){i=Uo.default.clone(Object(o.default)(i)?i:ko.DEFAULT_OFFSET);var a=e._scene.screenSpaceCameraController.minimumZoomDistance,r=e._scene.screenSpaceCameraController.maximumZoomDistance,n=i.range;if(!Object(o.default)(n)||0===n){var s=t.radius;0===s?i.range=Sl:e.frustum instanceof $.a||e._mode===N.a.SCENE2D?i.range=function(e,t){var i,a,r=e.frustum;Object(o.default)(r._offCenterFrustum)&&(r=r._offCenterFrustum);var n=r.right/r.top,s=t*n;return t>s?a=(i=t)/n:(a=t,i=s),1.5*Math.max(i,a)}(e,s):i.range=function(e,t){var i=e.frustum,a=Math.tan(.5*i.fovy),r=i.aspectRatio*a;return Math.max(t/r,t/a)}(e,s),i.range=Z.default.clamp(i.range,a,r)}return i}ko.prototype.viewBoundingSphere=function(e,t){t=Dl(this,e,t),this.lookAt(e.center,t)};var Il=new K.default,Ml=new a.default,Fl=new a.default,Rl=new a.default,Nl=new a.default,Ll=new B.a,jl=new pa.default,Vl=new ma.default;ko.prototype.flyToBoundingSphere=function(e,t){t=Object(n.default)(t,n.default.EMPTY_OBJECT);var i=this._mode===N.a.SCENE2D||this._mode===N.a.COLUMBUS_VIEW;this._setTransform(K.default.IDENTITY);var r,o=Dl(this,e,t.offset);r=i?a.default.multiplyByScalar(a.default.UNIT_Z,o.range,Ml):Gs(o.heading,o.pitch,o.range);var s,l,d=Ur.default.eastNorthUpToFixedFrame(e.center,u.default.WGS84,Il);if(K.default.multiplyByPoint(d,r,r),!i){if(s=a.default.subtract(e.center,r,Fl),a.default.normalize(s,s),l=K.default.multiplyByPointAsVector(d,a.default.UNIT_Z,Rl),1-Math.abs(a.default.dot(s,l))<Z.default.EPSILON6){var f=pa.default.fromAxisAngle(s,o.heading,jl),c=ma.default.fromQuaternion(f,Vl);a.default.fromCartesian4(K.default.getColumn(d,1,Ll),l),ma.default.multiplyByVector(c,l,l)}var h=a.default.cross(s,l,Nl);a.default.cross(h,s,l),a.default.normalize(l,l)}this.flyTo({destination:r,orientation:{direction:s,up:l},duration:t.duration,complete:t.complete,cancel:t.cancel,endTransform:t.endTransform,maximumHeight:t.maximumHeight,easingFunction:t.easingFunction,flyOverLongitude:t.flyOverLongitude,flyOverLongitudeWeight:t.flyOverLongitudeWeight,pitchAdjustHeight:t.pitchAdjustHeight})};var Ul=new a.default,zl=new a.default,Bl=new a.default,Hl=new a.default,kl=[new a.default,new a.default,new a.default,new a.default];var Wl=new z.default,Gl=new a.default,Yl=[new v.default,new v.default,new v.default,new v.default];function Xl(e,t,i,a,r,n){Wl.x=e,Wl.y=t;var s=a.pickEllipsoid(Wl,r,Gl);return Object(o.default)(s)?(Yl[i]=r.cartesianToCartographic(s,Yl[i]),1):(Yl[i]=r.cartesianToCartographic(n[i],Yl[i]),0)}ko.prototype.computeViewRectangle=function(e,t){e=Object(n.default)(e,u.default.WGS84);var i=this.frustum.computeCullingVolume(this.positionWC,this.directionWC,this.upWC),r=new g.default(a.default.ZERO,e.maximumRadius);if(i.computeVisibility(r)!==q.default.OUTSIDE){var o=this._scene.canvas,s=o.clientWidth,l=o.clientHeight,d=0,f=function(e,t){var i,r,n=t.radii,o=e.positionWC,s=a.default.multiplyComponents(t.oneOverRadii,o,Ul),l=a.default.magnitude(s),u=a.default.normalize(s,zl);a.default.equalsEpsilon(u,a.default.UNIT_Z,Z.default.EPSILON10)?(i=new a.default(0,1,0),r=new a.default(0,0,1)):(i=a.default.normalize(a.default.cross(a.default.UNIT_Z,u,Bl),Bl),r=a.default.normalize(a.default.cross(u,i,Hl),Hl));var d=Math.sqrt(a.default.magnitudeSquared(s)-1),f=a.default.multiplyByScalar(u,1/l,Ul),c=d/l,h=a.default.multiplyByScalar(i,c,zl),m=a.default.multiplyByScalar(r,c,Bl),p=a.default.add(f,m,kl[0]);a.default.subtract(p,h,p),a.default.multiplyComponents(n,p,p);var _=a.default.subtract(f,m,kl[1]);a.default.subtract(_,h,_),a.default.multiplyComponents(n,_,_);var g=a.default.subtract(f,m,kl[2]);a.default.add(g,h,g),a.default.multiplyComponents(n,g,g);var v=a.default.add(f,m,kl[3]);return a.default.add(v,h,v),a.default.multiplyComponents(n,v,v),kl}(this,e);if(d+=Xl(0,0,0,this,e,f),d+=Xl(0,l,1,this,e,f),d+=Xl(s,l,2,this,e,f),(d+=Xl(s,0,3,this,e,f))<2)return C.default.MAX_VALUE;t=C.default.fromCartographicArray(Yl,t);for(var c=0,h=Yl[3].longitude,m=0;m<4;++m){var p=Yl[m].longitude,_=Math.abs(p-h);_>Z.default.PI?c+=Z.default.TWO_PI-_:c+=_,h=p}return Z.default.equalsEpsilon(Math.abs(c),Z.default.TWO_PI,Z.default.EPSILON9)&&(t.west=-Z.default.PI,t.east=Z.default.PI,Yl[0].latitude>=0?t.north=Z.default.PI_OVER_TWO:t.south=-Z.default.PI_OVER_TWO),t}},ko.prototype.switchToPerspectiveFrustum=function(){if(!(this._mode===N.a.SCENE2D||this.frustum instanceof An.a)){var e=this._scene;this.frustum=new An.a,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.fov=Z.default.toRadians(60)}},ko.prototype.switchToOrthographicFrustum=function(){if(!(this._mode===N.a.SCENE2D||this.frustum instanceof $.a)){var e=this._scene;this.frustum=new $.a,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.width=a.default.magnitude(this.position);var t=this.frustum.projectionMatrix;Object(o.default)(t)&&this._adjustOrthographicFrustum(!0)}},ko.clone=function(e,t){return Object(o.default)(t)||(t=new ko(e._scene)),a.default.clone(e.position,t.position),a.default.clone(e.direction,t.direction),a.default.clone(e.up,t.up),a.default.clone(e.right,t.right),K.default.clone(e._transform,t.transform),t._transformChanged=!0,t.frustum=e.frustum.clone(),t};var Ql=ko,ql=i(374);var Zl=function(e){this.pass=e.pass,this.commandList=e.commandList,this.camera=e.camera,this.cullingVolume=e.cullingVolume,this.ready=!1},Kl=i(739),Jl=i(64),$l=0,eu=1;function tu(e){var t,i,r=e.frustum,o=e.orientation,s=e.origin,l=Object(n.default)(e.vertexFormat,Br.default.DEFAULT),u=Object(n.default)(e._drawNearPlane,!0);r instanceof An.a?(t=$l,i=An.a.packedLength):r instanceof $.a&&(t=eu,i=$.a.packedLength),this._frustumType=t,this._frustum=r.clone(),this._origin=a.default.clone(s),this._orientation=pa.default.clone(o),this._drawNearPlane=u,this._vertexFormat=l,this._workerName="createFrustumGeometry",this.packedLength=2+i+a.default.packedLength+pa.default.packedLength+Br.default.packedLength}tu.pack=function(e,t,i){i=Object(n.default)(i,0);var r=e._frustumType,o=e._frustum;return t[i++]=r,r===$l?(An.a.pack(o,t,i),i+=An.a.packedLength):($.a.pack(o,t,i),i+=$.a.packedLength),a.default.pack(e._origin,t,i),i+=a.default.packedLength,pa.default.pack(e._orientation,t,i),i+=pa.default.packedLength,Br.default.pack(e._vertexFormat,t,i),t[i+=Br.default.packedLength]=e._drawNearPlane?1:0,t};var iu=new An.a,au=new $.a,ru=new pa.default,nu=new a.default,ou=new Br.default;function su(e,t,i,a,r,n,s,l){for(var u=e/3*2,d=0;d<4;++d)Object(o.default)(t)&&(t[e]=n.x,t[e+1]=n.y,t[e+2]=n.z),Object(o.default)(i)&&(i[e]=s.x,i[e+1]=s.y,i[e+2]=s.z),Object(o.default)(a)&&(a[e]=l.x,a[e+1]=l.y,a[e+2]=l.z),e+=3;r[u]=0,r[u+1]=0,r[u+2]=1,r[u+3]=0,r[u+4]=1,r[u+5]=1,r[u+6]=0,r[u+7]=1}tu.unpack=function(e,t,i){t=Object(n.default)(t,0);var r,s=e[t++];s===$l?(r=An.a.unpack(e,t,iu),t+=An.a.packedLength):(r=$.a.unpack(e,t,au),t+=$.a.packedLength);var l=a.default.unpack(e,t,nu);t+=a.default.packedLength;var u=pa.default.unpack(e,t,ru);t+=pa.default.packedLength;var d=Br.default.unpack(e,t,ou),f=1===e[t+=Br.default.packedLength];if(!Object(o.default)(i))return new tu({frustum:r,origin:l,orientation:u,vertexFormat:d,_drawNearPlane:f});var c=s===i._frustumType?i._frustum:void 0;return i._frustum=r.clone(c),i._frustumType=s,i._origin=a.default.clone(l,i._origin),i._orientation=pa.default.clone(u,i._orientation),i._vertexFormat=Br.default.clone(d,i._vertexFormat),i._drawNearPlane=f,i};var lu=new ma.default,uu=new K.default,du=new K.default,fu=new a.default,cu=new a.default,hu=new a.default,mu=new a.default,pu=new a.default,_u=new a.default,gu=new Array(3),vu=new Array(4);vu[0]=new B.a(-1,-1,1,1),vu[1]=new B.a(1,-1,1,1),vu[2]=new B.a(1,1,1,1),vu[3]=new B.a(-1,1,1,1);for(var yu=new Array(4),bu=0;bu<4;++bu)yu[bu]=new B.a;tu._computeNearFarPlanes=function(e,t,i,r,s,l,u,d){var f=ma.default.fromQuaternion(t,lu),c=Object(n.default)(l,fu),h=Object(n.default)(u,cu),m=Object(n.default)(d,hu);c=ma.default.getColumn(f,0,c),h=ma.default.getColumn(f,1,h),m=ma.default.getColumn(f,2,m),a.default.normalize(c,c),a.default.normalize(h,h),a.default.normalize(m,m),a.default.negate(c,c);var p,_,g=K.default.computeView(e,m,h,c,uu);if(i===$l){var v=r.projectionMatrix,y=K.default.multiply(v,g,du);_=K.default.inverse(y,du)}else p=K.default.inverseTransformation(g,du);Object(o.default)(_)?(gu[0]=r.near,gu[1]=r.far):(gu[0]=0,gu[1]=r.near,gu[2]=r.far);for(var b=0;b<2;++b)for(var w=0;w<4;++w){var x=B.a.clone(vu[w],yu[w]);if(Object(o.default)(_)){var O=1/(x=K.default.multiplyByVector(_,x,x)).w;a.default.multiplyByScalar(x,O,x),a.default.subtract(x,e,x),a.default.normalize(x,x);var C=a.default.dot(m,x);a.default.multiplyByScalar(x,gu[b]/C,x),a.default.add(x,e,x)}else{Object(o.default)(r._offCenterFrustum)&&(r=r._offCenterFrustum);var T=gu[b],E=gu[b+1];x.x=.5*(x.x*(r.right-r.left)+r.left+r.right),x.y=.5*(x.y*(r.top-r.bottom)+r.bottom+r.top),x.z=.5*(x.z*(T-E)-T-E),x.w=1,K.default.multiplyByVector(p,x,x)}s[12*b+3*w]=x.x,s[12*b+3*w+1]=x.y,s[12*b+3*w+2]=x.z}},tu.createGeometry=function(e){var t=e._frustumType,i=e._frustum,r=e._origin,n=e._orientation,s=e._drawNearPlane,l=e._vertexFormat,u=s?6:5,d=new Float64Array(72);tu._computeNearFarPlanes(r,n,t,i,d);var f=24;d[f]=d[12],d[f+1]=d[13],d[f+2]=d[14],d[f+3]=d[0],d[f+4]=d[1],d[f+5]=d[2],d[f+6]=d[9],d[f+7]=d[10],d[f+8]=d[11],d[f+9]=d[21],d[f+10]=d[22],d[f+11]=d[23],d[f+=12]=d[15],d[f+1]=d[16],d[f+2]=d[17],d[f+3]=d[3],d[f+4]=d[4],d[f+5]=d[5],d[f+6]=d[0],d[f+7]=d[1],d[f+8]=d[2],d[f+9]=d[12],d[f+10]=d[13],d[f+11]=d[14],d[f+=12]=d[3],d[f+1]=d[4],d[f+2]=d[5],d[f+3]=d[15],d[f+4]=d[16],d[f+5]=d[17],d[f+6]=d[18],d[f+7]=d[19],d[f+8]=d[20],d[f+9]=d[6],d[f+10]=d[7],d[f+11]=d[8],d[f+=12]=d[6],d[f+1]=d[7],d[f+2]=d[8],d[f+3]=d[18],d[f+4]=d[19],d[f+5]=d[20],d[f+6]=d[21],d[f+7]=d[22],d[f+8]=d[23],d[f+9]=d[9],d[f+10]=d[10],d[f+11]=d[11],s||(d=d.subarray(12));var c=new Jl.a({position:new Bn.a({componentDatatype:Un.a.DOUBLE,componentsPerAttribute:3,values:d})});if(Object(o.default)(l.normal)||Object(o.default)(l.tangent)||Object(o.default)(l.bitangent)||Object(o.default)(l.st)){var h=Object(o.default)(l.normal)?new Float32Array(12*u):void 0,m=Object(o.default)(l.tangent)?new Float32Array(12*u):void 0,p=Object(o.default)(l.bitangent)?new Float32Array(12*u):void 0,_=Object(o.default)(l.st)?new Float32Array(8*u):void 0,v=fu,y=cu,b=hu,w=a.default.negate(v,mu),x=a.default.negate(y,pu),O=a.default.negate(b,_u);f=0,s&&(su(f,h,m,p,_,O,v,y),f+=12),su(f,h,m,p,_,b,w,y),su(f+=12,h,m,p,_,w,O,y),su(f+=12,h,m,p,_,x,O,w),su(f+=12,h,m,p,_,v,b,y),su(f+=12,h,m,p,_,y,b,w),Object(o.default)(h)&&(c.normal=new Bn.a({componentDatatype:Un.a.FLOAT,componentsPerAttribute:3,values:h})),Object(o.default)(m)&&(c.tangent=new Bn.a({componentDatatype:Un.a.FLOAT,componentsPerAttribute:3,values:m})),Object(o.default)(p)&&(c.bitangent=new Bn.a({componentDatatype:Un.a.FLOAT,componentsPerAttribute:3,values:p})),Object(o.default)(_)&&(c.st=new Bn.a({componentDatatype:Un.a.FLOAT,componentsPerAttribute:2,values:_}))}for(var C=new Uint16Array(6*u),T=0;T<u;++T){var E=6*T,P=4*T;C[E]=P,C[E+1]=P+1,C[E+2]=P+2,C[E+3]=P,C[E+4]=P+2,C[E+5]=P+3}return new zn.a({attributes:c,indices:C,primitiveType:ee.a.TRIANGLES,boundingSphere:g.default.fromVertices(d)})};var wu=tu,xu=0,Ou=1;function Cu(e){var t,i,r=e.frustum,o=e.orientation,s=e.origin,l=Object(n.default)(e._drawNearPlane,!0);r instanceof An.a?(t=xu,i=An.a.packedLength):r instanceof $.a&&(t=Ou,i=$.a.packedLength),this._frustumType=t,this._frustum=r.clone(),this._origin=a.default.clone(s),this._orientation=pa.default.clone(o),this._drawNearPlane=l,this._workerName="createFrustumOutlineGeometry",this.packedLength=2+i+a.default.packedLength+pa.default.packedLength}Cu.pack=function(e,t,i){i=Object(n.default)(i,0);var r=e._frustumType,o=e._frustum;return t[i++]=r,r===xu?(An.a.pack(o,t,i),i+=An.a.packedLength):($.a.pack(o,t,i),i+=$.a.packedLength),a.default.pack(e._origin,t,i),i+=a.default.packedLength,pa.default.pack(e._orientation,t,i),t[i+=pa.default.packedLength]=e._drawNearPlane?1:0,t};var Tu=new An.a,Eu=new $.a,Pu=new pa.default,Au=new a.default;Cu.unpack=function(e,t,i){t=Object(n.default)(t,0);var r,s=e[t++];s===xu?(r=An.a.unpack(e,t,Tu),t+=An.a.packedLength):(r=$.a.unpack(e,t,Eu),t+=$.a.packedLength);var l=a.default.unpack(e,t,Au);t+=a.default.packedLength;var u=pa.default.unpack(e,t,Pu),d=1===e[t+=pa.default.packedLength];if(!Object(o.default)(i))return new Cu({frustum:r,origin:l,orientation:u,_drawNearPlane:d});var f=s===i._frustumType?i._frustum:void 0;return i._frustum=r.clone(f),i._frustumType=s,i._origin=a.default.clone(l,i._origin),i._orientation=pa.default.clone(u,i._orientation),i._drawNearPlane=d,i},Cu.createGeometry=function(e){var t=e._frustumType,i=e._frustum,a=e._origin,r=e._orientation,n=e._drawNearPlane,o=new Float64Array(24);wu._computeNearFarPlanes(a,r,t,i,o);for(var s,l,u=new Jl.a({position:new Bn.a({componentDatatype:Un.a.DOUBLE,componentsPerAttribute:3,values:o})}),d=n?2:1,f=new Uint16Array(8*(d+1)),c=n?0:1;c<2;++c)l=4*c,f[s=n?8*c:0]=l,f[s+1]=l+1,f[s+2]=l+1,f[s+3]=l+2,f[s+4]=l+2,f[s+5]=l+3,f[s+6]=l+3,f[s+7]=l;for(c=0;c<2;++c)l=4*c,f[s=8*(d+c)]=l,f[s+1]=l+4,f[s+2]=l+1,f[s+3]=l+5,f[s+4]=l+2,f[s+5]=l+6,f[s+6]=l+3,f[s+7]=l+7;return new zn.a({attributes:u,indices:f,primitiveType:ee.a.LINES,boundingSphere:g.default.fromVertices(o)})};var Su=Cu;function Du(e){e=Object(n.default)(e,n.default.EMPTY_OBJECT),this._camera=e.camera,this._color=Object(n.default)(e.color,k.default.CYAN),this._updateOnChange=Object(n.default)(e.updateOnChange,!0),this.show=Object(n.default)(e.show,!0),this.id=e.id,this._id=void 0,this._outlinePrimitives=[],this._planesPrimitives=[]}var Iu=new a.default,Mu=new ma.default,Fu=new pa.default,Ru=new An.a,Nu=new Sn.a,Lu=new $.a,ju=new fi.a,Vu=new k.default,Uu=[1,1e5];Du.prototype.update=function(e){if(this.show){var t,i,r=this._planesPrimitives,n=this._outlinePrimitives;if(this._updateOnChange){for(i=r.length,t=0;t<i;++t)n[t]=n[t]&&n[t].destroy(),r[t]=r[t]&&r[t].destroy();r.length=0,n.length=0}if(0===r.length){var o,s=this._camera,l=s.frustum;o=l instanceof An.a?Ru:l instanceof Sn.a?Nu:l instanceof $.a?Lu:ju,o=l.clone(o);var u=e.frustumSplits,d=u.length-1;d<=0&&((u=Uu)[0]=this._camera.frustum.near,u[1]=this._camera.frustum.far,d=1);var f=s.positionWC,c=s.directionWC,h=s.upWC,m=s.rightWC;m=a.default.negate(m,Iu);var p=Mu;ma.default.setColumn(p,0,m,p),ma.default.setColumn(p,1,h,p),ma.default.setColumn(p,2,c,p);var _=pa.default.fromRotationMatrix(p,Fu);for(r.length=n.length=d,t=0;t<d;++t)o.near=u[t],o.far=u[t+1],r[t]=new Le.a({geometryInstances:new Y.a({geometry:new wu({origin:f,orientation:_,frustum:o,_drawNearPlane:0===t}),attributes:{color:W.a.fromColor(k.default.fromAlpha(this._color,.1,Vu))},id:this.id,pickPrimitive:this}),appearance:new Ne.a({translucent:!0,flat:!0}),asynchronous:!1}),n[t]=new Le.a({geometryInstances:new Y.a({geometry:new Su({origin:f,orientation:_,frustum:o,_drawNearPlane:0===t}),attributes:{color:W.a.fromColor(this._color)},id:this.id,pickPrimitive:this}),appearance:new Ne.a({translucent:!1,flat:!0}),asynchronous:!1})}for(i=r.length,t=0;t<i;++t)n[t].update(e),r[t].update(e)}},Du.prototype.isDestroyed=function(){return!1},Du.prototype.destroy=function(){for(var e=this._planesPrimitives.length,t=0;t<e;++t)this._outlinePrimitives[t]=this._outlinePrimitives[t]&&this._outlinePrimitives[t].destroy(),this._planesPrimitives[t]=this._planesPrimitives[t]&&this._planesPrimitives[t].destroy();return Object(s.default)(this)};var zu=Du;function Bu(){this._rs=void 0,this._sp=void 0,this._va=void 0,this._command=void 0,this._mode=void 0,this._useLogDepth=!1}var Hu=d.default.supportsTypedArrays()?new Float32Array(12):[],ku=new a.default,Wu=new a.default,Gu=new a.default,Yu=new a.default;Bu.prototype.update=function(e){if(this._mode=e.mode,e.mode===N.a.SCENE3D){var t=e.context,i=e.mapProjection.ellipsoid,r=e.useLogDepth;if(Object(o.default)(this._command)||(this._rs=ue.a.fromCache({cull:{enabled:!0},depthTest:{enabled:!0},colorMask:{red:!1,green:!1,blue:!1,alpha:!1}}),this._command=new se.a({renderState:this._rs,boundingVolume:new g.default(a.default.ZERO,i.maximumRadius),pass:le.a.OPAQUE,owner:this})),!Object(o.default)(this._sp)||this._useLogDepth!==r){this._useLogDepth=r;var n=new E.a({sources:["attribute vec4 position;\n\nvarying vec4 positionEC;\n\nvoid main()\n{\n    positionEC = czm_modelView * position;\n    gl_Position = czm_projection * positionEC;\n\n    czm_vertexLogDepth();\n}\n"]}),s=new E.a({sources:["varying vec4 positionEC;\n\nvoid main()\n{\n    vec3 direction = normalize(positionEC.xyz);\n    czm_ray ray = czm_ray(vec3(0.0), direction);\n\n    vec3 ellipsoid_center = czm_view[3].xyz;\n\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center, czm_ellipsoidInverseRadii);\n    if (!czm_isEmpty(intersection))\n    {\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n    }\n    else\n    {\n        discard;\n    }\n\n    czm_writeLogDepth();\n}\n"]});if(r){s.sources.push("#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n"),s.defines.push("LOG_DEPTH"),n.defines.push("LOG_DEPTH")}this._sp=F.a.replaceCache({shaderProgram:this._sp,context:t,vertexShaderSource:n,fragmentShaderSource:s,attributeLocations:{position:0}}),this._command.shaderProgram=this._sp}var l=function(e,t){var i=e.radii,r=t.camera.positionWC,n=a.default.multiplyComponents(e.oneOverRadii,r,ku),o=a.default.magnitude(n),s=a.default.normalize(n,Wu),l=a.default.normalize(a.default.cross(a.default.UNIT_Z,n,Gu),Gu),u=a.default.normalize(a.default.cross(s,l,Yu),Yu),d=Math.sqrt(a.default.magnitudeSquared(n)-1),f=a.default.multiplyByScalar(s,1/o,ku),c=d/o,h=a.default.multiplyByScalar(l,c,Wu),m=a.default.multiplyByScalar(u,c,Gu),p=a.default.add(f,m,Yu);a.default.subtract(p,h,p),a.default.multiplyComponents(i,p,p),a.default.pack(p,Hu,0);var _=a.default.subtract(f,m,Yu);a.default.subtract(_,h,_),a.default.multiplyComponents(i,_,_),a.default.pack(_,Hu,3);var g=a.default.add(f,m,Yu);a.default.add(g,h,g),a.default.multiplyComponents(i,g,g),a.default.pack(g,Hu,6);var v=a.default.subtract(f,m,Yu);return a.default.add(v,h,v),a.default.multiplyComponents(i,v,v),a.default.pack(v,Hu,9),Hu}(i,e);if(Object(o.default)(this._va))this._va.getAttribute(0).vertexBuffer.copyFromArrayView(l);else{var u=new zn.a({attributes:{position:new Bn.a({componentDatatype:Un.a.FLOAT,componentsPerAttribute:3,values:l})},indices:[0,1,2,2,1,3],primitiveType:ee.a.TRIANGLES});this._va=de.a.fromGeometry({context:t,geometry:u,attributeLocations:{position:0},bufferUsage:ne.a.DYNAMIC_DRAW}),this._command.vertexArray=this._va}}},Bu.prototype.execute=function(e,t){this._mode===N.a.SCENE3D&&this._command.execute(e,t)},Bu.prototype.isDestroyed=function(){return!1},Bu.prototype.destroy=function(){this._sp=this._sp&&this._sp.destroy(),this._va=this._va&&this._va.destroy()};var Xu=Bu;function Qu(){}var qu=/\bgl_FragDepthEXT\b/,Zu=/\bdiscard\b/;Qu.createDepthOnlyDerivedCommand=function(e,t,i,a){var r,n;return Object(o.default)(a)||(a={}),Object(o.default)(a.depthOnlyCommand)&&(r=a.depthOnlyCommand.shaderProgram,n=a.depthOnlyCommand.renderState),a.depthOnlyCommand=se.a.shallowClone(t,a.depthOnlyCommand),Object(o.default)(r)&&a.shaderProgramId===t.shaderProgram.id?(a.depthOnlyCommand.shaderProgram=r,a.depthOnlyCommand.renderState=n):(a.depthOnlyCommand.shaderProgram=function(e,t){var i=e.shaderCache.getDerivedShaderProgram(t,"depthOnly");if(!Object(o.default)(i)){var a,r=t._attributeLocations,n=t.fragmentShaderSource,s=!1,l=n.sources,u=l.length;for(a=0;a<u;++a)if(qu.test(l[a])||Zu.test(l[a])){s=!0;break}var d,f=!1,c=n.defines;for(u=c.length,a=0;a<u;++a)if("LOG_DEPTH"===c[a]){f=!0;break}s||f?!s&&f&&(d="#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\nvoid main() \n{ \n    gl_FragColor = vec4(1.0); \n    czm_writeLogDepth(); \n} \n",n=new E.a({defines:["LOG_DEPTH"],sources:[d]})):(d="void main() \n{ \n    gl_FragColor = vec4(1.0); \n} \n",n=new E.a({sources:[d]})),i=e.shaderCache.createDerivedShaderProgram(t,"depthOnly",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:n,attributeLocations:r})}return i}(i,t.shaderProgram),a.depthOnlyCommand.renderState=function(e,t){var i=e._depthOnlyRenderStateCache,a=i[t.id];if(!Object(o.default)(a)){var r=ue.a.getState(t);r.depthMask=!0,r.colorMask={red:!1,green:!1,blue:!1,alpha:!1},a=ue.a.fromCache(r),i[t.id]=a}return a}(e,t.renderState),a.shaderProgramId=t.shaderProgram.id),a};var Ku=/\s+czm_writeLogDepth\(/,Ju=/\s+czm_vertexLogDepth\(/,$u=/\s*#extension\s+GL_EXT_frag_depth\s*:\s*enable/;Qu.createLogDepthCommand=function(e,t,i){var a;return Object(o.default)(i)||(i={}),Object(o.default)(i.command)&&(a=i.command.shaderProgram),i.command=se.a.shallowClone(e,i.command),Object(o.default)(a)&&i.shaderProgramId===e.shaderProgram.id?i.command.shaderProgram=a:(i.command.shaderProgram=function(e,t){var i=e.shaderCache.getDerivedShaderProgram(t,"logDepth");if(!Object(o.default)(i)){var a,r=t._attributeLocations,n=t.vertexShaderSource.clone(),s=t.fragmentShaderSource.clone();n.defines=Object(o.default)(n.defines)?n.defines.slice(0):[],n.defines.push("LOG_DEPTH"),s.defines=Object(o.default)(s.defines)?s.defines.slice(0):[],s.defines.push("LOG_DEPTH");var l=!1,u=n.sources,d=u.length;for(a=0;a<d;++a)if(Ju.test(u[a])){l=!0;break}if(!l){for(a=0;a<d;++a)u[a]=E.a.replaceMain(u[a],"czm_log_depth_main");"\n\nvoid main() \n{ \n    czm_log_depth_main(); \n    czm_vertexLogDepth(); \n} \n",u.push("\n\nvoid main() \n{ \n    czm_log_depth_main(); \n    czm_vertexLogDepth(); \n} \n")}var f=!0;for(l=!1,d=(u=s.sources).length,a=0;a<d;++a)Ku.test(u[a])&&(l=!0),$u.test(u[a])&&(f=!1);var c="";if(f&&(c+="#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n"),!l){for(a=0;a<d;a++)u[a]=E.a.replaceMain(u[a],"czm_log_depth_main");c+="\nvoid main() \n{ \n    czm_log_depth_main(); \n    czm_writeLogDepth(); \n} \n"}u.push(c),i=e.shaderCache.createDerivedShaderProgram(t,"logDepth",{vertexShaderSource:n,fragmentShaderSource:s,attributeLocations:r})}return i}(t,e.shaderProgram),i.shaderProgramId=e.shaderProgram.id),i},Qu.createPickDerivedCommand=function(e,t,i,a){var r,n;return Object(o.default)(a)||(a={}),Object(o.default)(a.pickCommand)&&(r=a.pickCommand.shaderProgram,n=a.pickCommand.renderState),a.pickCommand=se.a.shallowClone(t,a.pickCommand),Object(o.default)(r)&&a.shaderProgramId===t.shaderProgram.id?(a.pickCommand.shaderProgram=r,a.pickCommand.renderState=n):(a.pickCommand.shaderProgram=function(e,t,i){var a=e.shaderCache.getDerivedShaderProgram(t,"pick");if(!Object(o.default)(a)){for(var r=t._attributeLocations,n=t.fragmentShaderSource,s=n.sources,l=s.length,u="void main() \n{ \n    czm_non_pick_main(); \n    if (gl_FragColor.a == 0.0) { \n        discard; \n    } \n    gl_FragColor = "+i+"; \n} \n",d=new Array(l+1),f=0;f<l;++f)d[f]=E.a.replaceMain(s[f],"czm_non_pick_main");d[l]=u,n=new E.a({sources:d,defines:n.defines}),a=e.shaderCache.createDerivedShaderProgram(t,"pick",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:n,attributeLocations:r})}return a}(i,t.shaderProgram,t.pickId),a.pickCommand.renderState=function(e,t){var i=e.picking.pickRenderStateCache,a=i[t.id];if(!Object(o.default)(a)){var r=ue.a.getState(t);r.blending.enabled=!1,r.depthMask=!0,a=ue.a.fromCache(r),i[t.id]=a}return a}(e,t.renderState),a.shaderProgramId=t.shaderProgram.id),a},Qu.createHdrCommand=function(e,t,i){var a;return Object(o.default)(i)||(i={}),Object(o.default)(i.command)&&(a=i.command.shaderProgram),i.command=se.a.shallowClone(e,i.command),Object(o.default)(a)&&i.shaderProgramId===e.shaderProgram.id?i.command.shaderProgram=a:(i.command.shaderProgram=function(e,t){var i=e.shaderCache.getDerivedShaderProgram(t,"HDR");if(!Object(o.default)(i)){var a=t._attributeLocations,r=t.vertexShaderSource.clone(),n=t.fragmentShaderSource.clone();r.defines=Object(o.default)(r.defines)?r.defines.slice(0):[],r.defines.push("HDR"),n.defines=Object(o.default)(n.defines)?n.defines.slice(0):[],n.defines.push("HDR"),i=e.shaderCache.createDerivedShaderProgram(t,"HDR",{vertexShaderSource:r,fragmentShaderSource:n,attributeLocations:a})}return i}(t,e.shaderProgram),i.shaderProgramId=e.shaderProgram.id),i};var ed=Qu;function td(e){this._scene=e,this._lastAlpha=void 0,this._lastBeta=void 0,this._lastGamma=void 0,this._alpha=void 0,this._beta=void 0,this._gamma=void 0;var t=this;function i(e){var i=e.alpha;if(!Object(o.default)(i))return t._alpha=void 0,t._beta=void 0,void(t._gamma=void 0);t._alpha=Z.default.toRadians(i),t._beta=Z.default.toRadians(e.beta),t._gamma=Z.default.toRadians(e.gamma)}window.addEventListener("deviceorientation",i,!1),this._removeListener=function(){window.removeEventListener("deviceorientation",i,!1)}}var id=new pa.default,ad=new pa.default,rd=new ma.default;td.prototype.update=function(){if(Object(o.default)(this._alpha)){Object(o.default)(this._lastAlpha)||(this._lastAlpha=this._alpha,this._lastBeta=this._beta,this._lastGamma=this._gamma);var e=this._lastAlpha-this._alpha,t=this._lastBeta-this._beta,i=this._lastGamma-this._gamma;!function(e,t,i,a){var r=e.direction,n=e.right,o=e.up,s=pa.default.fromAxisAngle(r,i,ad),l=pa.default.fromAxisAngle(n,a,id),u=pa.default.multiply(l,s,l),d=pa.default.fromAxisAngle(o,t,ad);pa.default.multiply(d,u,u);var f=ma.default.fromQuaternion(u,rd);ma.default.multiplyByVector(f,n,n),ma.default.multiplyByVector(f,o,o),ma.default.multiplyByVector(f,r,r)}(this._scene.camera,-e,t,i),this._lastAlpha=this._alpha,this._lastBeta=this._beta,this._lastGamma=this._gamma}},td.prototype.isDestroyed=function(){return!1},td.prototype.destroy=function(){return this._removeListener(),Object(s.default)(this)};var nd=td;function od(){this.enabled=!0,this.density=2e-4,this.screenSpaceErrorFactor=2,this.minimumBrightness=.03}for(var sd=[359.393,800.749,1275.6501,2151.1192,3141.7763,4777.5198,6281.2493,12364.307,15900.765,49889.0549,78026.8259,99260.7344,120036.3873,151011.0158,156091.1953,203849.3112,274866.9803,319916.3149,493552.0528,628733.5874],ld=[2e-5,2e-4,1e-4,7e-5,5e-5,4e-5,3e-5,19e-6,1e-5,85e-7,62e-7,58e-7,53e-7,52e-7,51e-7,42e-7,4e-6,34e-7,26e-7,22e-7],ud=0;ud<ld.length;++ud)ld[ud]*=1e6;for(var dd=ld[1],fd=ld[ld.length-1],cd=0;cd<ld.length;++cd)ld[cd]=(ld[cd]-fd)/(dd-fd);var hd=0;var md=new a.default;od.prototype.update=function(e){if(e.fog.enabled=this.enabled){var t=e.camera,i=t.positionCartographic;if(!Object(o.default)(i)||i.height>8e5||e.mode!==N.a.SCENE3D)e.fog.enabled=!1;else{var r=i.height,n=function(e){var t,i=sd,a=i.length;if(e<i[0])return hd=0;if(e>i[a-1])return hd=a-2;if(e>=i[hd]){if(hd+1<a&&e<i[hd+1])return hd;if(hd+2<a&&e<i[hd+2])return++hd}else if(hd-1>=0&&e>=i[hd-1])return--hd;for(t=0;t<a-2&&!(e>=i[t]&&e<i[t+1]);++t);return hd=t}(r),s=Z.default.clamp((r-sd[n])/(sd[n+1]-sd[n]),0,1),l=Z.default.lerp(ld[n],ld[n+1],s),u=1e6*this.density;l=l*(u-u/dd*fd)*1e-6;var d=a.default.normalize(t.positionWC,md);l*=1-Math.abs(a.default.dot(t.directionWC,d)),e.fog.density=l,e.fog.sse=this.screenSpaceErrorFactor,e.fog.minimumBrightness=this.minimumBrightness}}};var pd=od;var _d=function(e,t,i){this.context=e,this.commandList=[],this.shadowMaps=[],this.brdfLutGenerator=void 0,this.environmentMap=void 0,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this.specularEnvironmentMapsMaximumLOD=void 0,this.mode=N.a.SCENE3D,this.morphTime=N.a.getMorphTime(N.a.SCENE3D),this.frameNumber=0,this.newFrame=!1,this.time=void 0,this.jobScheduler=i,this.mapProjection=void 0,this.camera=void 0,this.cameraUnderground=!1,this.cullingVolume=void 0,this.occluder=void 0,this.maximumScreenSpaceError=void 0,this.pixelRatio=1,this.passes={render:!1,pick:!1,depth:!1,postProcess:!1,offscreen:!1},this.creditDisplay=t,this.afterRender=[],this.scene3DOnly=!1,this.fog={enabled:!1,density:void 0,sse:void 0,minimumBrightness:void 0},this.terrainExaggeration=1,this.shadowState={shadowsEnabled:!0,lightShadowsEnabled:!0,shadowMaps:[],lightShadowMaps:[],nearPlane:1,farPlane:5e3,closestObjectSize:1e3,lastDirtyTime:0,outOfView:!0},this.imagerySplitPosition=0,this.frustumSplits=[],this.backgroundColor=void 0,this.light=void 0,this.minimumDisableDepthTestDistance=void 0,this.invertClassification=!1,this.invertClassificationColor=void 0,this.useLogDepth=!1,this.tilesetPassState=void 0,this.minimumTerrainHeight=0},gd="uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n}\n",vd="uniform sampler2D u_depthTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    gl_FragColor = czm_packDepth(texture2D(u_depthTexture, v_textureCoordinates).r);\n}\n",yd=i(152),bd=i(206),wd=i(207);function xd(){this._globeColorTexture=void 0,this._primitiveColorTexture=void 0,this._depthStencilTexture=void 0,this._globeDepthTexture=void 0,this._tempGlobeDepthTexture=void 0,this._tempCopyDepthTexture=void 0,this._globeColorFramebuffer=void 0,this._primitiveColorFramebuffer=void 0,this._copyDepthFramebuffer=void 0,this._tempCopyDepthFramebuffer=void 0,this._updateDepthFramebuffer=void 0,this._clearGlobeColorCommand=void 0,this._clearPrimitiveColorCommand=void 0,this._copyColorCommand=void 0,this._copyDepthCommand=void 0,this._tempCopyDepthCommand=void 0,this._updateDepthCommand=void 0,this._mergeColorCommand=void 0,this._viewport=new an.default,this._rs=void 0,this._rsBlend=void 0,this._rsUpdate=void 0,this._useScissorTest=!1,this._scissorRectangle=void 0,this._useLogDepth=void 0,this._useHdr=void 0,this._clearGlobeDepth=void 0,this._debugGlobeDepthViewportCommand=void 0}function Od(e){e._globeColorTexture=e._globeColorTexture&&!e._globeColorTexture.isDestroyed()&&e._globeColorTexture.destroy(),e._depthStencilTexture=e._depthStencilTexture&&!e._depthStencilTexture.isDestroyed()&&e._depthStencilTexture.destroy(),e._globeDepthTexture=e._globeDepthTexture&&!e._globeDepthTexture.isDestroyed()&&e._globeDepthTexture.destroy()}function Cd(e){e._globeColorFramebuffer=e._globeColorFramebuffer&&!e._globeColorFramebuffer.isDestroyed()&&e._globeColorFramebuffer.destroy(),e._copyDepthFramebuffer=e._copyDepthFramebuffer&&!e._copyDepthFramebuffer.isDestroyed()&&e._copyDepthFramebuffer.destroy()}function Td(e){e._tempCopyDepthFramebuffer=e._tempCopyDepthFramebuffer&&!e._tempCopyDepthFramebuffer.isDestroyed()&&e._tempCopyDepthFramebuffer.destroy(),e._updateDepthFramebuffer=e._updateDepthFramebuffer&&!e._updateDepthFramebuffer.isDestroyed()&&e._updateDepthFramebuffer.destroy(),e._tempGlobeDepthTexture=e._tempGlobeDepthTexture&&!e._tempGlobeDepthTexture.isDestroyed()&&e._tempGlobeDepthTexture.destroy()}function Ed(e){e._primitiveColorTexture=e._primitiveColorTexture&&!e._primitiveColorTexture.isDestroyed()&&e._primitiveColorTexture.destroy(),e._primitiveColorFramebuffer=e._primitiveColorFramebuffer&&!e._primitiveColorFramebuffer.isDestroyed()&&e._primitiveColorFramebuffer.destroy()}function Pd(e,t,i,a,r,n){var s=e._globeColorTexture,l=!Object(o.default)(s)||s.width!==i||s.height!==a||r!==e._useHdr;l&&(Od(e),Cd(e),function(e,t,i,a,r){var n=r?t.halfFloatingPointTexture?ye.a.HALF_FLOAT:ye.a.FLOAT:ye.a.UNSIGNED_BYTE;e._globeColorTexture=new P.a({context:t,width:i,height:a,pixelFormat:me.a.RGBA,pixelDatatype:n,sampler:be.a.NEAREST}),e._depthStencilTexture=new P.a({context:t,width:i,height:a,pixelFormat:me.a.DEPTH_STENCIL,pixelDatatype:ye.a.UNSIGNED_INT_24_8}),e._globeDepthTexture=new P.a({context:t,width:i,height:a,pixelFormat:me.a.RGBA,pixelDatatype:ye.a.UNSIGNED_BYTE,sampler:be.a.NEAREST})}(e,t,i,a,r),function(e,t){e._globeColorFramebuffer=new Rn.a({context:t,colorTextures:[e._globeColorTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1}),e._copyDepthFramebuffer=new Rn.a({context:t,colorTextures:[e._globeDepthTexture],destroyAttachments:!1})}(e,t)),(l||n!==e._clearGlobeDepth)&&(Ed(e),n&&function(e,t,i,a,r){var n=r?t.halfFloatingPointTexture?ye.a.HALF_FLOAT:ye.a.FLOAT:ye.a.UNSIGNED_BYTE;e._primitiveColorTexture=new P.a({context:t,width:i,height:a,pixelFormat:me.a.RGBA,pixelDatatype:n,sampler:be.a.NEAREST}),e._primitiveColorFramebuffer=new Rn.a({context:t,colorTextures:[e._primitiveColorTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1})}(e,t,i,a,r))}function Ad(e,t,i,a,r){e._viewport.width=i,e._viewport.height=a;var n=!an.default.equals(e._viewport,r.viewport),s=n!==e._useScissorTest;e._useScissorTest=n,an.default.equals(e._scissorRectangle,r.viewport)||(e._scissorRectangle=an.default.clone(r.viewport,e._scissorRectangle),s=!0),Object(o.default)(e._rs)&&an.default.equals(e._viewport,e._rs.viewport)&&!s||(e._rs=ue.a.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle}}),e._rsBlend=ue.a.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},blending:fe.a.ALPHA_BLEND}),e._rsUpdate=ue.a.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},stencilTest:{enabled:!0,frontFunction:bd.a.EQUAL,frontOperation:{fail:wd.a.KEEP,zFail:wd.a.KEEP,zPass:wd.a.KEEP},backFunction:bd.a.NEVER,reference:yd.a.CESIUM_3D_TILE_MASK,mask:yd.a.CESIUM_3D_TILE_MASK}})),Object(o.default)(e._copyDepthCommand)||(e._copyDepthCommand=t.createViewportQuadCommand(vd,{uniformMap:{u_depthTexture:function(){return e._depthStencilTexture}},owner:e})),e._copyDepthCommand.framebuffer=e._copyDepthFramebuffer,e._copyDepthCommand.renderState=e._rs,Object(o.default)(e._copyColorCommand)||(e._copyColorCommand=t.createViewportQuadCommand(gd,{uniformMap:{colorTexture:function(){return e._globeColorTexture}},owner:e})),e._copyColorCommand.renderState=e._rs,Object(o.default)(e._tempCopyDepthCommand)||(e._tempCopyDepthCommand=t.createViewportQuadCommand(vd,{uniformMap:{u_depthTexture:function(){return e._tempCopyDepthTexture}},owner:e})),e._tempCopyDepthCommand.framebuffer=e._tempCopyDepthFramebuffer,e._tempCopyDepthCommand.renderState=e._rs,Object(o.default)(e._updateDepthCommand)||(e._updateDepthCommand=t.createViewportQuadCommand(gd,{uniformMap:{colorTexture:function(){return e._tempGlobeDepthTexture}},owner:e})),e._updateDepthCommand.framebuffer=e._updateDepthFramebuffer,e._updateDepthCommand.renderState=e._rsUpdate,Object(o.default)(e._clearGlobeColorCommand)||(e._clearGlobeColorCommand=new Mn.a({color:new k.default(0,0,0,0),stencil:0,owner:e})),e._clearGlobeColorCommand.framebuffer=e._globeColorFramebuffer,Object(o.default)(e._clearPrimitiveColorCommand)||(e._clearPrimitiveColorCommand=new Mn.a({color:new k.default(0,0,0,0),stencil:0,owner:e})),e._clearPrimitiveColorCommand.framebuffer=e._primitiveColorFramebuffer,Object(o.default)(e._mergeColorCommand)||(e._mergeColorCommand=t.createViewportQuadCommand(gd,{uniformMap:{colorTexture:function(){return e._primitiveColorTexture}},owner:e})),e._mergeColorCommand.framebuffer=e._globeColorFramebuffer,e._mergeColorCommand.renderState=e._rsBlend}Object.defineProperties(xd.prototype,{framebuffer:{get:function(){return this._globeColorFramebuffer}},primitiveFramebuffer:{get:function(){return this._primitiveColorFramebuffer}}}),xd.prototype.executeDebugGlobeDepth=function(e,t,i){!function(e,t,i,a){if(!Object(o.default)(e._debugGlobeDepthViewportCommand)||a!==e._useLogDepth){var r=new E.a({defines:[a?"LOG_DEPTH":""],sources:["uniform sampler2D u_depthTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    float z_window = czm_unpackDepth(texture2D(u_depthTexture, v_textureCoordinates));\n    z_window = czm_reverseLogDepth(z_window); \n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    float z_ndc = (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n    float scale = pow(z_ndc * 0.5 + 0.5, 8.0);\n    gl_FragColor = vec4(mix(vec3(0.0), vec3(1.0), scale), 1.0);\n}\n"]});e._debugGlobeDepthViewportCommand=t.createViewportQuadCommand(r,{uniformMap:{u_depthTexture:function(){return e._globeDepthTexture}},owner:e}),e._useLogDepth=a}e._debugGlobeDepthViewportCommand.execute(t,i)}(this,e,t,i)},xd.prototype.update=function(e,t,i,a,r){var n=i.width,o=i.height;Pd(this,e,n,o,a,r),Ad(this,e,n,o,t),e.uniformState.globeDepthTexture=void 0,this._useHdr=a,this._clearGlobeDepth=r},xd.prototype.executeCopyDepth=function(e,t){Object(o.default)(this._copyDepthCommand)&&(this._copyDepthCommand.execute(e,t),e.uniformState.globeDepthTexture=this._globeDepthTexture)},xd.prototype.executeUpdateDepth=function(e,t,i){var a=t.framebuffer.depthStencilTexture;if(i||a!==this._depthStencilTexture){if(Object(o.default)(this._updateDepthCommand)){if(!Object(o.default)(this._updateDepthFramebuffer)||this._updateDepthFramebuffer.depthStencilTexture!==a||this._updateDepthFramebuffer.getColorTexture(0)!==this._globeDepthTexture){var r=this._globeDepthTexture.width,n=this._globeDepthTexture.height;Td(this),function(e,t,i,a,r){e._tempGlobeDepthTexture=new P.a({context:t,width:i,height:a,pixelFormat:me.a.RGBA,pixelDatatype:ye.a.UNSIGNED_BYTE,sampler:be.a.NEAREST}),e._tempCopyDepthFramebuffer=new Rn.a({context:t,colorTextures:[e._tempGlobeDepthTexture],destroyAttachments:!1}),e._updateDepthFramebuffer=new Rn.a({context:t,colorTextures:[e._globeDepthTexture],depthStencilTexture:r.framebuffer.depthStencilTexture,destroyAttachments:!1})}(this,e,r,n,t),Ad(this,e,r,n,t)}this._tempCopyDepthTexture=a,this._tempCopyDepthCommand.execute(e,t),this._updateDepthCommand.execute(e,t)}}else Object(o.default)(this._copyDepthCommand)&&this._copyDepthCommand.execute(e,t)},xd.prototype.executeCopyColor=function(e,t){Object(o.default)(this._copyColorCommand)&&this._copyColorCommand.execute(e,t)},xd.prototype.executeMergeColor=function(e,t){Object(o.default)(this._mergeColorCommand)&&this._mergeColorCommand.execute(e,t)},xd.prototype.clear=function(e,t,i){var a=this._clearGlobeColorCommand;Object(o.default)(a)&&(k.default.clone(i,a.color),a.execute(e,t)),a=this._clearPrimitiveColorCommand,Object(o.default)(a)&&Object(o.default)(this._primitiveColorFramebuffer)&&a.execute(e,t)},xd.prototype.isDestroyed=function(){return!1},xd.prototype.destroy=function(){return Od(this),Cd(this),Ed(this),Td(this),Object(o.default)(this._copyColorCommand)&&(this._copyColorCommand.shaderProgram=this._copyColorCommand.shaderProgram.destroy()),Object(o.default)(this._copyDepthCommand)&&(this._copyDepthCommand.shaderProgram=this._copyDepthCommand.shaderProgram.destroy()),Object(o.default)(this._tempCopyDepthCommand)&&(this._tempCopyDepthCommand.shaderProgram=this._tempCopyDepthCommand.shaderProgram.destroy()),Object(o.default)(this._updateDepthCommand)&&(this._updateDepthCommand.shaderProgram=this._updateDepthCommand.shaderProgram.destroy()),Object(o.default)(this._mergeColorCommand)&&(this._mergeColorCommand.shaderProgram=this._mergeColorCommand.shaderProgram.destroy()),Object(o.default)(this._debugGlobeDepthViewportCommand)&&(this._debugGlobeDepthViewportCommand.shaderProgram=this._debugGlobeDepthViewportCommand.shaderProgram.destroy()),Object(s.default)(this)};var Sd=xd;function Dd(){this.previousFramebuffer=void 0,this._previousFramebuffer=void 0,this._texture=void 0,this._classifiedTexture=void 0,this._depthStencilTexture=void 0,this._fbo=void 0,this._fboClassified=void 0,this._rsUnclassified=void 0,this._rsClassified=void 0,this._unclassifiedCommand=void 0,this._classifiedCommand=void 0,this._translucentCommand=void 0,this._clearColorCommand=new Mn.a({color:new k.default(0,0,0,0),owner:this}),this._clearCommand=new Mn.a({color:new k.default(0,0,0,0),depth:1,stencil:0});var e=this;this._uniformMap={colorTexture:function(){return e._texture},depthTexture:function(){return e._depthStencilTexture},classifiedTexture:function(){return e._classifiedTexture}}}Object.defineProperties(Dd.prototype,{unclassifiedCommand:{get:function(){return this._unclassifiedCommand}}}),Dd.isTranslucencySupported=function(e){return e.depthTexture&&e.fragmentDepth};var Id={depthMask:!1,stencilTest:{enabled:!0,frontFunction:bd.a.EQUAL,frontOperation:{fail:wd.a.KEEP,zFail:wd.a.KEEP,zPass:wd.a.KEEP},backFunction:bd.a.NEVER,reference:0,mask:yd.a.CLASSIFICATION_MASK},blending:fe.a.ALPHA_BLEND},Md={depthMask:!1,stencilTest:{enabled:!0,frontFunction:bd.a.NOT_EQUAL,frontOperation:{fail:wd.a.KEEP,zFail:wd.a.KEEP,zPass:wd.a.KEEP},backFunction:bd.a.NEVER,reference:0,mask:yd.a.CLASSIFICATION_MASK},blending:fe.a.ALPHA_BLEND},Fd={depthMask:!0,depthTest:{enabled:!0},stencilTest:yd.a.setCesium3DTileBit(),stencilMask:yd.a.CESIUM_3D_TILE_MASK,blending:fe.a.ALPHA_BLEND};Dd.prototype.update=function(e){var t=this._texture,i=!Object(o.default)(t)||this.previousFramebuffer!==this._previousFramebuffer;this._previousFramebuffer=this.previousFramebuffer;var a,r,n=e.drawingBufferWidth,s=e.drawingBufferHeight,l=!Object(o.default)(t)||t.width!==n||t.height!==s;((l||i)&&(this._texture=this._texture&&this._texture.destroy(),this._classifiedTexture=this._classifiedTexture&&this._classifiedTexture.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._texture=new P.a({context:e,width:n,height:s,pixelFormat:me.a.RGBA,pixelDatatype:ye.a.UNSIGNED_BYTE,sampler:new be.a({wrapS:Oe.a.CLAMP_TO_EDGE,wrapT:Oe.a.CLAMP_TO_EDGE,minificationFilter:xe.a.LINEAR,magnificationFilter:we.a.LINEAR})}),Object(o.default)(this._previousFramebuffer)||(this._classifiedTexture=new P.a({context:e,width:n,height:s,pixelFormat:me.a.RGBA,pixelDatatype:ye.a.UNSIGNED_BYTE,sampler:new be.a({wrapS:Oe.a.CLAMP_TO_EDGE,wrapT:Oe.a.CLAMP_TO_EDGE,minificationFilter:xe.a.LINEAR,magnificationFilter:we.a.LINEAR})}),this._depthStencilTexture=new P.a({context:e,width:n,height:s,pixelFormat:me.a.DEPTH_STENCIL,pixelDatatype:ye.a.UNSIGNED_INT_24_8}))),!Object(o.default)(this._fbo)||l||i)&&(this._fbo=this._fbo&&this._fbo.destroy(),this._fboClassified=this._fboClassified&&this._fboClassified.destroy(),Object(o.default)(this._previousFramebuffer)?(a=this._previousFramebuffer.depthStencilTexture,r=this._previousFramebuffer.depthStencilRenderbuffer):a=this._depthStencilTexture,this._fbo=new Rn.a({context:e,colorTextures:[this._texture],depthStencilTexture:a,depthStencilRenderbuffer:r,destroyAttachments:!1}),Object(o.default)(this._previousFramebuffer)||(this._fboClassified=new Rn.a({context:e,colorTextures:[this._classifiedTexture],depthStencilTexture:a,destroyAttachments:!1})));if(Object(o.default)(this._rsUnclassified)||(this._rsUnclassified=ue.a.fromCache(Id),this._rsClassified=ue.a.fromCache(Md),this._rsDefault=ue.a.fromCache(Fd)),!Object(o.default)(this._unclassifiedCommand)||i){Object(o.default)(this._unclassifiedCommand)&&(this._unclassifiedCommand.shaderProgram=this._unclassifiedCommand.shaderProgram&&this._unclassifiedCommand.shaderProgram.destroy(),this._classifiedCommand.shaderProgram=this._classifiedCommand.shaderProgram&&this._classifiedCommand.shaderProgram.destroy());var u=Object(o.default)(this._previousFramebuffer)?"uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    if (color.a == 0.0)\n    {\n        discard;\n    }\n#ifdef UNCLASSIFIED\n    gl_FragColor = color * czm_invertClassificationColor;\n#else\n    gl_FragColor = color;\n#endif\n}\n":"#extension GL_EXT_frag_depth : enable\nuniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nuniform sampler2D classifiedTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    if (color.a == 0.0)\n    {\n        discard;\n    }\n    bool isClassified = all(equal(texture2D(classifiedTexture, v_textureCoordinates), vec4(0.0)));\n#ifdef UNCLASSIFIED\n    vec4 highlightColor = czm_invertClassificationColor;\n    if (isClassified)\n    {\n        discard;\n    }\n#else\n    vec4 highlightColor = vec4(1.0);\n    if (!isClassified)\n    {\n        discard;\n    }\n#endif\n    gl_FragColor = color * highlightColor;\n    gl_FragDepthEXT = texture2D(depthTexture, v_textureCoordinates).r;\n}\n",d=new E.a({defines:["UNCLASSIFIED"],sources:[u]}),f=new E.a({sources:[u]});this._unclassifiedCommand=e.createViewportQuadCommand(d,{renderState:Object(o.default)(this._previousFramebuffer)?this._rsUnclassified:this._rsDefault,uniformMap:this._uniformMap,owner:this}),this._classifiedCommand=e.createViewportQuadCommand(f,{renderState:Object(o.default)(this._previousFramebuffer)?this._rsClassified:this._rsDefault,uniformMap:this._uniformMap,owner:this}),Object(o.default)(this._translucentCommand)&&(this._translucentCommand.shaderProgram=this._translucentCommand.shaderProgram&&this._translucentCommand.shaderProgram.destroy()),Object(o.default)(this._previousFramebuffer)||(this._translucentCommand=e.createViewportQuadCommand(gd,{renderState:this._rsUnclassified,uniformMap:this._uniformMap,owner:this}))}},Dd.prototype.clear=function(e,t){var i=t.framebuffer;Object(o.default)(this._previousFramebuffer)?(t.framebuffer=this._fbo,this._clearColorCommand.execute(e,t)):(t.framebuffer=this._fbo,this._clearCommand.execute(e,t),t.framebuffer=this._fboClassified,this._clearCommand.execute(e,t)),t.framebuffer=i},Dd.prototype.executeClassified=function(e,t){if(!Object(o.default)(this._previousFramebuffer)){var i=t.framebuffer;t.framebuffer=this._fboClassified,this._translucentCommand.execute(e,t),t.framebuffer=i}this._classifiedCommand.execute(e,t)},Dd.prototype.executeUnclassified=function(e,t){this._unclassifiedCommand.execute(e,t)},Dd.prototype.isDestroyed=function(){return!1},Dd.prototype.destroy=function(){return this._fbo=this._fbo&&this._fbo.destroy(),this._texture=this._texture&&this._texture.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),Object(o.default)(this._unclassifiedCommand)&&(this._unclassifiedCommand.shaderProgram=this._unclassifiedCommand.shaderProgram&&this._unclassifiedCommand.shaderProgram.destroy(),this._classifiedCommand.shaderProgram=this._classifiedCommand.shaderProgram&&this._classifiedCommand.shaderProgram.destroy()),Object(s.default)(this)};var Rd=Dd,Nd=i(653);function Ld(e){this._total=e,this.usedThisFrame=0,this.stolenFromMeThisFrame=0,this.starvedThisFrame=!1,this.starvedLastFrame=!1}function jd(e){var t=new Array(Nd.a.NUMBER_OF_JOB_TYPES);t[Nd.a.TEXTURE]=new Ld(Object(o.default)(e)?e[Nd.a.TEXTURE]:10),t[Nd.a.PROGRAM]=new Ld(Object(o.default)(e)?e[Nd.a.PROGRAM]:10),t[Nd.a.BUFFER]=new Ld(Object(o.default)(e)?e[Nd.a.BUFFER]:30);var i,a=t.length,r=0;for(i=0;i<a;++i)r+=t[i].total;var n=new Array(a);for(i=0;i<a;++i)n[i]=!1;this._totalBudget=r,this._totalUsedThisFrame=0,this._budgets=t,this._executedThisFrame=n}Object.defineProperties(Ld.prototype,{total:{get:function(){return this._total}}}),jd.getTimestamp=di.default,Object.defineProperties(jd.prototype,{totalBudget:{get:function(){return this._totalBudget}}}),jd.prototype.disableThisFrame=function(){this._totalUsedThisFrame=this._totalBudget},jd.prototype.resetBudgets=function(){for(var e=this._budgets,t=e.length,i=0;i<t;++i){var a=e[i];a.starvedLastFrame=a.starvedThisFrame,a.starvedThisFrame=!1,a.usedThisFrame=0,a.stolenFromMeThisFrame=0}this._totalUsedThisFrame=0},jd.prototype.execute=function(e,t){var i,a=this._budgets,r=a[t],n=this._executedThisFrame[t];if(this._totalUsedThisFrame>=this._totalBudget&&n)return r.starvedThisFrame=!0,!1;if(r.usedThisFrame+r.stolenFromMeThisFrame>=r.total){var o,s=a.length;for(o=0;o<s&&(!((i=a[o]).usedThisFrame+i.stolenFromMeThisFrame<i.total)||i.starvedLastFrame);++o);if(o===s&&n)return!1;n&&(r.starvedThisFrame=!0)}var l=jd.getTimestamp();e.execute();var u=jd.getTimestamp()-l;return this._totalUsedThisFrame+=u,i?i.stolenFromMeThisFrame+=u:r.usedThisFrame+=u,this._executedThisFrame[t]=!0,!0};var Vd=jd,Ud=i(782),zd=i(359);function Bd(e){e=Object(n.default)(e,n.default.EMPTY_OBJECT);var t=Object(zd.default)(e.container);this._container=t;var i=document.createElement("div");i.className="cesium-performanceDisplay";var a=document.createElement("div");a.className="cesium-performanceDisplay-fps",this._fpsText=document.createTextNode(""),a.appendChild(this._fpsText);var r=document.createElement("div");r.className="cesium-performanceDisplay-ms",this._msText=document.createTextNode(""),r.appendChild(this._msText),i.appendChild(r),i.appendChild(a),this._container.appendChild(i),this._lastFpsSampleTime=Object(di.default)(),this._lastMsSampleTime=Object(di.default)(),this._fpsFrameCount=0,this._msFrameCount=0,this._throttled=!1;var o=document.createElement("div");o.className="cesium-performanceDisplay-throttled",this._throttledText=document.createTextNode(""),o.appendChild(this._throttledText),i.appendChild(o)}Object.defineProperties(Bd.prototype,{throttled:{get:function(){return this._throttled},set:function(e){this._throttled!==e&&(this._throttledText.nodeValue=e?"(throttled)":"",this._throttled=e)}}}),Bd.prototype.update=function(e){var t=Object(di.default)(),i=Object(n.default)(e,!0);this._fpsFrameCount++;var a=t-this._lastFpsSampleTime;if(a>1e3){var r="N/A";i&&(r=1e3*this._fpsFrameCount/a|0),this._fpsText.nodeValue=r+" FPS",this._lastFpsSampleTime=t,this._fpsFrameCount=0}this._msFrameCount++;var o=t-this._lastMsSampleTime;if(o>200){var s="N/A";i&&(s=(o/this._msFrameCount).toFixed(2)),this._msText.nodeValue=s+" MS",this._lastMsSampleTime=t,this._msFrameCount=0}},Bd.prototype.destroy=function(){return Object(s.default)(this)};var Hd=Bd,kd=i(148),Wd=i(90),Gd=i(236);function Yd(){this._framebuffer=void 0,this._depthTexture=void 0,this._textureToCopy=void 0,this._copyDepthCommand=void 0,this._useLogDepth=void 0,this._debugPickDepthViewportCommand=void 0}function Xd(e){e._depthTexture=e._depthTexture&&!e._depthTexture.isDestroyed()&&e._depthTexture.destroy()}function Qd(e){e._framebuffer=e._framebuffer&&!e._framebuffer.isDestroyed()&&e._framebuffer.destroy()}function qd(e,t,i,a){Xd(e),Qd(e),function(e,t,i,a){e._depthTexture=new P.a({context:t,width:i,height:a,pixelFormat:me.a.RGBA,pixelDatatype:ye.a.UNSIGNED_BYTE})}(e,t,i,a),e._framebuffer=new Rn.a({context:t,colorTextures:[e._depthTexture],destroyAttachments:!1})}Yd.prototype.executeDebugPickDepth=function(e,t,i){!function(e,t,i,a){if(!Object(o.default)(e._debugPickDepthViewportCommand)||a!==e._useLogDepth){var r=new E.a({defines:[a?"LOG_DEPTH":""],sources:["uniform sampler2D u_texture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    float z_window = czm_unpackDepth(texture2D(u_texture, v_textureCoordinates));\n    z_window = czm_reverseLogDepth(z_window); \n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    float z_ndc = (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n    float scale = pow(z_ndc * 0.5 + 0.5, 8.0);\n    gl_FragColor = vec4(mix(vec3(0.0), vec3(1.0), scale), 1.0);\n}\n"]});e._debugPickDepthViewportCommand=t.createViewportQuadCommand(r,{uniformMap:{u_texture:function(){return e._depthTexture}},owner:e}),e._useLogDepth=a}e._debugPickDepthViewportCommand.execute(t,i)}(this,e,t,i)},Yd.prototype.update=function(e,t){!function(e,t,i){var a=i.width,r=i.height,n=e._depthTexture,s=!Object(o.default)(n)||n.width!==a||n.height!==r;Object(o.default)(e._framebuffer)&&!s||qd(e,t,a,r)}(this,e,t),function(e,t,i){if(!Object(o.default)(e._copyDepthCommand)){e._copyDepthCommand=t.createViewportQuadCommand("uniform sampler2D u_texture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    gl_FragColor = czm_packDepth(texture2D(u_texture, v_textureCoordinates).r);\n}\n",{renderState:ue.a.fromCache(),uniformMap:{u_texture:function(){return e._textureToCopy}},owner:e})}e._textureToCopy=i,e._copyDepthCommand.framebuffer=e._framebuffer}(this,e,t)};var Zd=new B.a,Kd=new B.a(1,1/255,1/65025,1/16581375);Yd.prototype.getDepth=function(e,t,i){var a=e.readPixels({x:t,y:i,width:1,height:1,framebuffer:this._framebuffer}),r=B.a.unpack(a,0,Zd);return B.a.divideByScalar(r,255,r),B.a.dot(r,Kd)},Yd.prototype.executeCopyDepth=function(e,t){this._copyDepthCommand.execute(e,t)},Yd.prototype.isDestroyed=function(){return!1},Yd.prototype.destroy=function(){return Xd(this),Qd(this),this._copyDepthCommand.shaderProgram=Object(o.default)(this._copyDepthCommand.shaderProgram)&&this._copyDepthCommand.shaderProgram.destroy(),Object(s.default)(this)};var Jd=Yd,$d=i(370),ef=i(183),tf=i(322);var af=function(e,t){this.near=Object(n.default)(e,0),this.far=Object(n.default)(t,0);for(var i=le.a.NUMBER_OF_PASSES,a=new Array(i),r=new Array(i),o=0;o<i;++o)a[o]=[],r[o]=0;this.commands=a,this.indices=r},rf="#ifdef MRT\n#extension GL_EXT_draw_buffers : enable\n#endif\n\nuniform vec4 u_bgColor;\nuniform sampler2D u_depthTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    if (texture2D(u_depthTexture, v_textureCoordinates).r < 1.0)\n    {\n#ifdef MRT\n        gl_FragData[0] = u_bgColor;\n        gl_FragData[1] = vec4(u_bgColor.a);\n#else\n        gl_FragColor = u_bgColor;\n#endif\n        return;\n    }\n    \n    discard;\n}\n",nf=i(591),of=i(592);function sf(e){this._translucentMultipassSupport=!1,this._translucentMRTSupport=!1;var t=e.colorBufferFloat&&e.depthTexture;this._translucentMRTSupport=e.drawBuffers&&t,this._translucentMultipassSupport=!this._translucentMRTSupport&&t,this._opaqueFBO=void 0,this._opaqueTexture=void 0,this._depthStencilTexture=void 0,this._accumulationTexture=void 0,this._translucentFBO=void 0,this._alphaFBO=void 0,this._adjustTranslucentFBO=void 0,this._adjustAlphaFBO=void 0,this._opaqueClearCommand=new Mn.a({color:new k.default(0,0,0,0),owner:this}),this._translucentMRTClearCommand=new Mn.a({color:new k.default(0,0,0,1),owner:this}),this._translucentMultipassClearCommand=new Mn.a({color:new k.default(0,0,0,0),owner:this}),this._alphaClearCommand=new Mn.a({color:new k.default(1,1,1,1),owner:this}),this._translucentRenderStateCache={},this._alphaRenderStateCache={},this._compositeCommand=void 0,this._adjustTranslucentCommand=void 0,this._adjustAlphaCommand=void 0,this._viewport=new an.default,this._rs=void 0,this._useScissorTest=!1,this._scissorRectangle=void 0,this._useHDR=!1}function lf(e){e._accumulationTexture=e._accumulationTexture&&!e._accumulationTexture.isDestroyed()&&e._accumulationTexture.destroy(),e._revealageTexture=e._revealageTexture&&!e._revealageTexture.isDestroyed()&&e._revealageTexture.destroy()}function uf(e){e._translucentFBO=e._translucentFBO&&!e._translucentFBO.isDestroyed()&&e._translucentFBO.destroy(),e._alphaFBO=e._alphaFBO&&!e._alphaFBO.isDestroyed()&&e._alphaFBO.destroy(),e._adjustTranslucentFBO=e._adjustTranslucentFBO&&!e._adjustTranslucentFBO.isDestroyed()&&e._adjustTranslucentFBO.destroy(),e._adjustAlphaFBO=e._adjustAlphaFBO&&!e._adjustAlphaFBO.isDestroyed()&&e._adjustAlphaFBO.destroy()}function df(e){lf(e),uf(e)}sf.prototype.update=function(e,t,i,a){if(this.isSupported()){this._opaqueFBO=i,this._opaqueTexture=i.getColorTexture(0),this._depthStencilTexture=i.depthStencilTexture;var r=this._opaqueTexture.width,n=this._opaqueTexture.height,s=this._accumulationTexture,l=!Object(o.default)(s)||s.width!==r||s.height!==n||a!==this._useHDR;if(l&&function(e,t,i,a){lf(e),e._accumulationTexture=new P.a({context:t,width:i,height:a,pixelFormat:me.a.RGBA,pixelDatatype:ye.a.FLOAT});var r=new Float32Array(i*a*4);e._revealageTexture=new P.a({context:t,pixelFormat:me.a.RGBA,pixelDatatype:ye.a.FLOAT,source:{arrayBufferView:r,width:i,height:a},flipY:!1})}(this,e,r,n),Object(o.default)(this._translucentFBO)&&!l||function(e,t){uf(e);var i=kn.a.FRAMEBUFFER_COMPLETE,a=!0;if(e._translucentMRTSupport&&(e._translucentFBO=new Rn.a({context:t,colorTextures:[e._accumulationTexture,e._revealageTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1}),e._adjustTranslucentFBO=new Rn.a({context:t,colorTextures:[e._accumulationTexture,e._revealageTexture],destroyAttachments:!1}),e._translucentFBO.status===i&&e._adjustTranslucentFBO.status===i||(uf(e),e._translucentMRTSupport=!1)),!e._translucentMRTSupport){e._translucentFBO=new Rn.a({context:t,colorTextures:[e._accumulationTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1}),e._alphaFBO=new Rn.a({context:t,colorTextures:[e._revealageTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1}),e._adjustTranslucentFBO=new Rn.a({context:t,colorTextures:[e._accumulationTexture],destroyAttachments:!1}),e._adjustAlphaFBO=new Rn.a({context:t,colorTextures:[e._revealageTexture],destroyAttachments:!1});var r=e._translucentFBO.status===i,n=e._alphaFBO.status===i,o=e._adjustTranslucentFBO.status===i,s=e._adjustAlphaFBO.status===i;r&&n&&o&&s||(df(e),e._translucentMultipassSupport=!1,a=!1)}return a}(this,e)){this._useHDR=a;var u,d,f=this;Object(o.default)(this._compositeCommand)||(u=new E.a({sources:["/**\n * Compositing for Weighted Blended Order-Independent Transparency. See:\n * - http://jcgt.org/published/0002/02/09/\n * - http://casual-effects.blogspot.com/2014/03/weighted-blended-order-independent.html\n */\n\nuniform sampler2D u_opaque;\nuniform sampler2D u_accumulation;\nuniform sampler2D u_revealage;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    vec4 opaque = texture2D(u_opaque, v_textureCoordinates);\n    vec4 accum = texture2D(u_accumulation, v_textureCoordinates);\n    float r = texture2D(u_revealage, v_textureCoordinates).r;\n\n#ifdef MRT\n    vec4 transparent = vec4(accum.rgb / clamp(r, 1e-4, 5e4), accum.a);\n#else\n    vec4 transparent = vec4(accum.rgb / clamp(accum.a, 1e-4, 5e4), r);\n#endif\n\n    gl_FragColor = (1.0 - transparent.a) * transparent + transparent.a * opaque;\n\n    if (opaque != czm_backgroundColor)\n    {\n        gl_FragColor.a = 1.0;\n    }\n}\n"]}),this._translucentMRTSupport&&u.defines.push("MRT"),d={u_opaque:function(){return f._opaqueTexture},u_accumulation:function(){return f._accumulationTexture},u_revealage:function(){return f._revealageTexture}},this._compositeCommand=e.createViewportQuadCommand(u,{uniformMap:d,owner:this})),Object(o.default)(this._adjustTranslucentCommand)||(this._translucentMRTSupport?(u=new E.a({defines:["MRT"],sources:[rf]}),d={u_bgColor:function(){return f._translucentMRTClearCommand.color},u_depthTexture:function(){return f._depthStencilTexture}},this._adjustTranslucentCommand=e.createViewportQuadCommand(u,{uniformMap:d,owner:this})):this._translucentMultipassSupport&&(u=new E.a({sources:[rf]}),d={u_bgColor:function(){return f._translucentMultipassClearCommand.color},u_depthTexture:function(){return f._depthStencilTexture}},this._adjustTranslucentCommand=e.createViewportQuadCommand(u,{uniformMap:d,owner:this}),d={u_bgColor:function(){return f._alphaClearCommand.color},u_depthTexture:function(){return f._depthStencilTexture}},this._adjustAlphaCommand=e.createViewportQuadCommand(u,{uniformMap:d,owner:this}))),this._viewport.width=r,this._viewport.height=n;var c=!an.default.equals(this._viewport,t.viewport),h=c!==this._useScissorTest;this._useScissorTest=c,an.default.equals(this._scissorRectangle,t.viewport)||(this._scissorRectangle=an.default.clone(t.viewport,this._scissorRectangle),h=!0),Object(o.default)(this._rs)&&an.default.equals(this._viewport,this._rs.viewport)&&!h||(this._rs=ue.a.fromCache({viewport:this._viewport,scissorTest:{enabled:this._useScissorTest,rectangle:this._scissorRectangle}})),Object(o.default)(this._compositeCommand)&&(this._compositeCommand.renderState=this._rs),this._adjustTranslucentCommand&&(this._adjustTranslucentCommand.renderState=this._rs),Object(o.default)(this._adjustAlphaCommand)&&(this._adjustAlphaCommand.renderState=this._rs)}}};var ff={enabled:!0,color:new k.default(0,0,0,0),equationRgb:nf.a.ADD,equationAlpha:nf.a.ADD,functionSourceRgb:of.a.ONE,functionDestinationRgb:of.a.ONE,functionSourceAlpha:of.a.ZERO,functionDestinationAlpha:of.a.ONE_MINUS_SOURCE_ALPHA},cf={enabled:!0,color:new k.default(0,0,0,0),equationRgb:nf.a.ADD,equationAlpha:nf.a.ADD,functionSourceRgb:of.a.ONE,functionDestinationRgb:of.a.ONE,functionSourceAlpha:of.a.ONE,functionDestinationAlpha:of.a.ONE},hf={enabled:!0,color:new k.default(0,0,0,0),equationRgb:nf.a.ADD,equationAlpha:nf.a.ADD,functionSourceRgb:of.a.ZERO,functionDestinationRgb:of.a.ONE_MINUS_SOURCE_ALPHA,functionSourceAlpha:of.a.ZERO,functionDestinationAlpha:of.a.ONE_MINUS_SOURCE_ALPHA};function mf(e,t,i,a){var r=i[a.id];if(!Object(o.default)(r)){var n=ue.a.getState(a);n.depthMask=!1,n.blending=t,r=ue.a.fromCache(n),i[a.id]=r}return r}var pf="    vec3 Ci = czm_gl_FragColor.rgb * czm_gl_FragColor.a;\n    float ai = czm_gl_FragColor.a;\n    float wzi = czm_alphaWeight(ai);\n    gl_FragData[0] = vec4(Ci * wzi, ai);\n    gl_FragData[1] = vec4(ai * wzi);\n",_f="    vec3 Ci = czm_gl_FragColor.rgb * czm_gl_FragColor.a;\n    float ai = czm_gl_FragColor.a;\n    float wzi = czm_alphaWeight(ai);\n    gl_FragColor = vec4(Ci, ai) * wzi;\n",gf="    float ai = czm_gl_FragColor.a;\n    gl_FragColor = vec4(ai);\n";function vf(e,t,i,a){var r=e.shaderCache.getDerivedShaderProgram(t,i);if(!Object(o.default)(r)){var n=t._attributeLocations,s=t.fragmentShaderSource.clone();s.sources=s.sources.map((function(e){return e=(e=(e=(e=E.a.replaceMain(e,"czm_translucent_main")).replace(/gl_FragColor/g,"czm_gl_FragColor")).replace(/\bdiscard\b/g,"czm_discard = true")).replace(/czm_phong/g,"czm_translucentPhong")})),s.sources.splice(0,0,(-1!==a.indexOf("gl_FragData")?"#extension GL_EXT_draw_buffers : enable \n":"")+"vec4 czm_gl_FragColor;\nbool czm_discard = false;\n"),s.sources.push("void main()\n{\n    czm_translucent_main();\n    if (czm_discard)\n    {\n        discard;\n    }\n"+a+"}\n"),r=e.shaderCache.createDerivedShaderProgram(t,i,{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:s,attributeLocations:n})}return r}sf.prototype.createDerivedCommands=function(e,t,i){var a,r,n,s,l,u,d,f;(Object(o.default)(i)||(i={}),this._translucentMRTSupport)?(Object(o.default)(i.translucentCommand)&&(a=i.translucentCommand.shaderProgram,r=i.translucentCommand.renderState),i.translucentCommand=se.a.shallowClone(e,i.translucentCommand),Object(o.default)(a)&&i.shaderProgramId===e.shaderProgram.id?(i.translucentCommand.shaderProgram=a,i.translucentCommand.renderState=r):(i.translucentCommand.shaderProgram=function(e,t){return vf(e,t,"translucentMRT",pf)}(t,e.shaderProgram),i.translucentCommand.renderState=(d=this,f=e.renderState,mf(0,ff,d._translucentRenderStateCache,f)),i.shaderProgramId=e.shaderProgram.id)):(Object(o.default)(i.translucentCommand)&&(n=i.translucentCommand.shaderProgram,s=i.translucentCommand.renderState,l=i.alphaCommand.shaderProgram,u=i.alphaCommand.renderState),i.translucentCommand=se.a.shallowClone(e,i.translucentCommand),i.alphaCommand=se.a.shallowClone(e,i.alphaCommand),Object(o.default)(n)&&i.shaderProgramId===e.shaderProgram.id?(i.translucentCommand.shaderProgram=n,i.translucentCommand.renderState=s,i.alphaCommand.shaderProgram=l,i.alphaCommand.renderState=u):(i.translucentCommand.shaderProgram=function(e,t){return vf(e,t,"translucentMultipass",_f)}(t,e.shaderProgram),i.translucentCommand.renderState=function(e,t,i){return mf(0,cf,e._translucentRenderStateCache,i)}(this,0,e.renderState),i.alphaCommand.shaderProgram=function(e,t){return vf(e,t,"alphaMultipass",gf)}(t,e.shaderProgram),i.alphaCommand.renderState=function(e,t,i){return mf(0,hf,e._alphaRenderStateCache,i)}(this,0,e.renderState),i.shaderProgramId=e.shaderProgram.id));return i},sf.prototype.executeCommands=function(e,t,i,a,r){this._translucentMRTSupport?function(e,t,i,a,r,n){var s=t.context,l=t.frameState.useLogDepth,u=t._hdr,d=a.framebuffer,f=r.length,c=t.frameState.shadowState.lightShadowsEnabled;a.framebuffer=e._adjustTranslucentFBO,e._adjustTranslucentCommand.execute(s,a);var h,m=e._opaqueFBO;a.framebuffer=e._translucentFBO;for(var p=0;p<f;++p)h=r[p],h=l?h.derivedCommands.logDepth.command:h,h=u?h.derivedCommands.hdr.command:h,i(c&&h.receiveShadows?h.derivedCommands.oit.shadows.translucentCommand:h.derivedCommands.oit.translucentCommand,t,s,a,m);Object(o.default)(n)&&(h=n.unclassifiedCommand,i(c&&h.receiveShadows?h.derivedCommands.oit.shadows.translucentCommand:h.derivedCommands.oit.translucentCommand,t,s,a,m)),a.framebuffer=d}(this,e,t,i,a,r):function(e,t,i,a,r,n){var s,l,u=t.context,d=t.frameState.useLogDepth,f=t._hdr,c=a.framebuffer,h=r.length,m=t.frameState.shadowState.lightShadowsEnabled;a.framebuffer=e._adjustTranslucentFBO,e._adjustTranslucentCommand.execute(u,a),a.framebuffer=e._adjustAlphaFBO,e._adjustAlphaCommand.execute(u,a);var p=e._opaqueFBO;for(a.framebuffer=e._translucentFBO,l=0;l<h;++l)s=r[l],s=d?s.derivedCommands.logDepth.command:s,s=f?s.derivedCommands.hdr.command:s,i(m&&s.receiveShadows?s.derivedCommands.oit.shadows.translucentCommand:s.derivedCommands.oit.translucentCommand,t,u,a,p);for(Object(o.default)(n)&&(s=n.unclassifiedCommand,i(m&&s.receiveShadows?s.derivedCommands.oit.shadows.translucentCommand:s.derivedCommands.oit.translucentCommand,t,u,a,p)),a.framebuffer=e._alphaFBO,l=0;l<h;++l)s=r[l],s=d?s.derivedCommands.logDepth.command:s,s=f?s.derivedCommands.hdr.command:s,i(m&&s.receiveShadows?s.derivedCommands.oit.shadows.alphaCommand:s.derivedCommands.oit.alphaCommand,t,u,a,p);Object(o.default)(n)&&(s=n.unclassifiedCommand,i(m&&s.receiveShadows?s.derivedCommands.oit.shadows.alphaCommand:s.derivedCommands.oit.alphaCommand,t,u,a,p)),a.framebuffer=c}(this,e,t,i,a,r)},sf.prototype.execute=function(e,t){this._compositeCommand.execute(e,t)},sf.prototype.clear=function(e,t,i){var a=t.framebuffer;t.framebuffer=this._opaqueFBO,k.default.clone(i,this._opaqueClearCommand.color),this._opaqueClearCommand.execute(e,t),t.framebuffer=this._translucentFBO,(this._translucentMRTSupport?this._translucentMRTClearCommand:this._translucentMultipassClearCommand).execute(e,t),this._translucentMultipassSupport&&(t.framebuffer=this._alphaFBO,this._alphaClearCommand.execute(e,t)),t.framebuffer=a},sf.prototype.isSupported=function(){return this._translucentMRTSupport||this._translucentMultipassSupport},sf.prototype.isDestroyed=function(){return!1},sf.prototype.destroy=function(){return df(this),Object(o.default)(this._compositeCommand)&&(this._compositeCommand.shaderProgram=this._compositeCommand.shaderProgram&&this._compositeCommand.shaderProgram.destroy()),Object(o.default)(this._adjustTranslucentCommand)&&(this._adjustTranslucentCommand.shaderProgram=this._adjustTranslucentCommand.shaderProgram&&this._adjustTranslucentCommand.shaderProgram.destroy()),Object(o.default)(this._adjustAlphaCommand)&&(this._adjustAlphaCommand.shaderProgram=this._adjustAlphaCommand.shaderProgram&&this._adjustAlphaCommand.shaderProgram.destroy()),Object(s.default)(this)};var yf=sf;function bf(){this._depthStencilTexture=void 0,this._framebuffer=void 0,this._passState=void 0}function wf(e){e._framebuffer=e._framebuffer&&e._framebuffer.destroy(),e._depthStencilTexture=e._depthStencilTexture&&e._depthStencilTexture.destroy()}bf.prototype.update=function(e,t,i){var a=i.width,r=i.height;Object(o.default)(this._framebuffer)&&a===this._depthStencilTexture.width&&r===this._depthStencilTexture.height||(wf(this),function(e,t){var i=t.drawingBufferWidth,a=t.drawingBufferHeight;e._depthStencilTexture=new P.a({context:t,width:i,height:a,pixelFormat:me.a.DEPTH_STENCIL,pixelDatatype:ye.a.UNSIGNED_INT_24_8}),e._framebuffer=new Rn.a({context:t,depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1});var r=new qn(t);r.blendingEnabled=!1,r.scissorTest={enabled:!0,rectangle:new an.default},r.viewport=new an.default,e._passState=r}(this,e));var n=this._framebuffer,s=this._passState;return s.framebuffer=n,s.viewport.width=a,s.viewport.height=r,s.scissorTest.rectangle.x=t.x,s.scissorTest.rectangle.y=r-t.y,s.scissorTest.rectangle.width=1,s.scissorTest.rectangle.height=1,s},bf.prototype.isDestroyed=function(){return!1},bf.prototype.destroy=function(){return wf(this),Object(s.default)(this)};var xf=bf,Of={RGBA4:kn.a.RGBA4,RGB5_A1:kn.a.RGB5_A1,RGB565:kn.a.RGB565,DEPTH_COMPONENT16:kn.a.DEPTH_COMPONENT16,STENCIL_INDEX8:kn.a.STENCIL_INDEX8,DEPTH_STENCIL:kn.a.DEPTH_STENCIL,validate:function(e){return e===Of.RGBA4||e===Of.RGB5_A1||e===Of.RGB565||e===Of.DEPTH_COMPONENT16||e===Of.STENCIL_INDEX8||e===Of.DEPTH_STENCIL}},Cf=Object.freeze(Of);function Tf(e){var t=(e=Object(n.default)(e,n.default.EMPTY_OBJECT)).context._gl,i=(oe.a.maximumRenderbufferSize,Object(n.default)(e.format,Cf.RGBA4)),a=Object(o.default)(e.width)?e.width:t.drawingBufferWidth,r=Object(o.default)(e.height)?e.height:t.drawingBufferHeight;this._gl=t,this._format=i,this._width=a,this._height=r,this._renderbuffer=this._gl.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this._renderbuffer),t.renderbufferStorage(t.RENDERBUFFER,i,a,r),t.bindRenderbuffer(t.RENDERBUFFER,null)}Object.defineProperties(Tf.prototype,{format:{get:function(){return this._format}},width:{get:function(){return this._width}},height:{get:function(){return this._height}}}),Tf.prototype._getRenderbuffer=function(){return this._renderbuffer},Tf.prototype.isDestroyed=function(){return!1},Tf.prototype.destroy=function(){return this._gl.deleteRenderbuffer(this._renderbuffer),Object(s.default)(this)};var Ef=Tf;function Pf(e){var t=new qn(e);t.blendingEnabled=!1,t.scissorTest={enabled:!0,rectangle:new an.default},t.viewport=new an.default,this._context=e,this._fb=void 0,this._passState=t,this._width=0,this._height=0}Pf.prototype.begin=function(e,t){var i=this._context,a=t.width,r=t.height;return an.default.clone(e,this._passState.scissorTest.rectangle),Object(o.default)(this._fb)&&this._width===a&&this._height===r||(this._width=a,this._height=r,this._fb=this._fb&&this._fb.destroy(),this._fb=new Rn.a({context:i,colorTextures:[new P.a({context:i,width:a,height:r})],depthStencilRenderbuffer:new Ef({context:i,width:a,height:r,format:Cf.DEPTH_STENCIL})}),this._passState.framebuffer=this._fb),this._passState.viewport.width=a,this._passState.viewport.height=r,this._passState};var Af=new k.default;Pf.prototype.end=function(e){for(var t=Object(n.default)(e.width,1),i=Object(n.default)(e.height,1),a=this._context,r=a.readPixels({x:e.x,y:e.y,width:t,height:i,framebuffer:this._fb}),s=Math.max(t,i),l=s*s,u=Math.floor(.5*t),d=Math.floor(.5*i),f=0,c=0,h=0,m=-1,p=0;p<l;++p){if(-u<=f&&f<=u&&-d<=c&&c<=d){var _=4*((d-c)*t+f+u);Af.red=k.default.byteToFloat(r[_]),Af.green=k.default.byteToFloat(r[_+1]),Af.blue=k.default.byteToFloat(r[_+2]),Af.alpha=k.default.byteToFloat(r[_+3]);var g=a.getObjectByPickColor(Af);if(Object(o.default)(g))return g}if(f===c||f<0&&-f===c||f>0&&f===1-c){var v=h;h=-m,m=v}f+=h,c+=m}},Pf.prototype.isDestroyed=function(){return!1},Pf.prototype.destroy=function(){return this._fb=this._fb&&this._fb.destroy(),Object(s.default)(this)};var Sf=Pf;function Df(){this._colorTexture=void 0,this._idTexture=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this._framebuffer=void 0,this._idFramebuffer=void 0,this._idClearColor=new k.default(0,0,0,0),this._useHdr=void 0,this._clearCommand=new Mn.a({color:new k.default(0,0,0,0),depth:1,owner:this})}function If(e){e._framebuffer=e._framebuffer&&e._framebuffer.destroy(),e._idFramebuffer=e._idFramebuffer&&e._idFramebuffer.destroy(),e._colorTexture=e._colorTexture&&e._colorTexture.destroy(),e._idTexture=e._idTexture&&e._idTexture.destroy(),e._depthStencilTexture=e._depthStencilTexture&&e._depthStencilTexture.destroy(),e._depthStencilRenderbuffer=e._depthStencilRenderbuffer&&e._depthStencilRenderbuffer.destroy(),e._depthStencilIdTexture=e._depthStencilIdTexture&&e._depthStencilIdTexture.destroy(),e._depthStencilIdRenderbuffer=e._depthStencilIdRenderbuffer&&e._depthStencilIdRenderbuffer.destroy(),e._framebuffer=void 0,e._idFramebuffer=void 0,e._colorTexture=void 0,e._idTexture=void 0,e._depthStencilTexture=void 0,e._depthStencilRenderbuffer=void 0,e._depthStencilIdTexture=void 0,e._depthStencilIdRenderbuffer=void 0}Df.prototype.update=function(e,t,i){var a=t.width,r=t.height,n=this._colorTexture;if(!Object(o.default)(n)||n.width!==a||n.height!==r||i!==this._useHdr){If(this),this._useHdr=i;var s=i?e.halfFloatingPointTexture?ye.a.HALF_FLOAT:ye.a.FLOAT:ye.a.UNSIGNED_BYTE;this._colorTexture=new P.a({context:e,width:a,height:r,pixelFormat:me.a.RGBA,pixelDatatype:s,sampler:be.a.NEAREST}),this._idTexture=new P.a({context:e,width:a,height:r,pixelFormat:me.a.RGBA,pixelDatatype:ye.a.UNSIGNED_BYTE,sampler:be.a.NEAREST}),e.depthTexture?(this._depthStencilTexture=new P.a({context:e,width:a,height:r,pixelFormat:me.a.DEPTH_STENCIL,pixelDatatype:ye.a.UNSIGNED_INT_24_8,sampler:be.a.NEAREST}),this._depthStencilIdTexture=new P.a({context:e,width:a,height:r,pixelFormat:me.a.DEPTH_STENCIL,pixelDatatype:ye.a.UNSIGNED_INT_24_8,sampler:be.a.NEAREST})):(this._depthStencilRenderbuffer=new Ef({context:e,width:a,height:r,format:Cf.DEPTH_STENCIL}),this._depthStencilIdRenderbuffer=new Ef({context:e,width:a,height:r,format:Cf.DEPTH_STENCIL})),this._framebuffer=new Rn.a({context:e,colorTextures:[this._colorTexture],depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1}),this._idFramebuffer=new Rn.a({context:e,colorTextures:[this._idTexture],depthStencilTexture:this._depthStencilIdTexture,depthStencilRenderbuffer:this._depthStencilIdRenderbuffer,destroyAttachments:!1})}},Df.prototype.clear=function(e,t,i){var a=t.framebuffer;t.framebuffer=this._framebuffer,k.default.clone(i,this._clearCommand.color),this._clearCommand.execute(e,t),t.framebuffer=this._idFramebuffer,k.default.clone(this._idClearColor,this._clearCommand.color),this._clearCommand.execute(e,t),t.framebuffer=a},Df.prototype.getFramebuffer=function(){return this._framebuffer},Df.prototype.getIdFramebuffer=function(){return this._idFramebuffer},Df.prototype.isDestroyed=function(){return!1},Df.prototype.destroy=function(){return If(this),Object(s.default)(this)};var Mf=Df;function Ff(){}Ff.getShadowCastShaderKeyword=function(e,t,i,a){return"castShadow "+e+" "+t+" "+i+" "+a},Ff.createShadowCastVertexShader=function(e,t,i){var a=e.defines.slice(0),r=e.sources.slice(0);a.push("SHADOW_MAP"),i&&a.push("GENERATE_POSITION");var n=E.a.findPositionVarying(e),s=Object(o.default)(n);if(t&&!s){for(var l=r.length,u=0;u<l;++u)r[u]=E.a.replaceMain(r[u],"czm_shadow_cast_main");r.push("varying vec3 v_positionEC; \nvoid main() \n{ \n    czm_shadow_cast_main(); \n    v_positionEC = (czm_inverseProjection * gl_Position).xyz; \n}")}return new E.a({defines:a,sources:r})},Ff.createShadowCastFragmentShader=function(e,t,i,a){var r=e.defines.slice(0),n=e.sources.slice(0),s=E.a.findPositionVarying(e),l=Object(o.default)(s);l||(s="v_positionEC");for(var u=n.length,d=0;d<u;++d)n[d]=E.a.replaceMain(n[d],"czm_shadow_cast_main");var f="";return t&&(l||(f+="varying vec3 v_positionEC; \n"),f+="uniform vec4 shadowMap_lightPositionEC; \n"),f+=a?"void main() \n{ \n":"void main() \n{ \n    czm_shadow_cast_main(); \n    if (gl_FragColor.a == 0.0) \n    { \n       discard; \n    } \n",f+=t?"    float distance = length("+s+"); \n    if (distance >= shadowMap_lightPositionEC.w) \n    { \n        discard; \n    } \n    distance /= shadowMap_lightPositionEC.w; // radius \n    gl_FragColor = czm_packDepth(distance); \n":i?"    gl_FragColor = vec4(1.0); \n":"    gl_FragColor = czm_packDepth(gl_FragCoord.z); \n",f+="} \n",n.push(f),new E.a({defines:r,sources:n})},Ff.getShadowReceiveShaderKeyword=function(e,t,i,a){return"receiveShadow "+e._usesDepthTexture+e._polygonOffsetSupported+e._isPointLight+e._isSpotLight+(e._numberOfCascades>1)+e.debugCascadeColors+e.softShadows+t+i+a},Ff.createShadowReceiveVertexShader=function(e,t,i){var a=e.defines.slice(0),r=e.sources.slice(0);return a.push("SHADOW_MAP"),t&&(i?a.push("GENERATE_POSITION_AND_NORMAL"):a.push("GENERATE_POSITION")),new E.a({defines:a,sources:r})},Ff.createShadowReceiveFragmentShader=function(e,t,i,a,r){for(var n=E.a.findNormalVarying(e),s=!a&&Object(o.default)(n)||a&&r,l=E.a.findPositionVarying(e),u=Object(o.default)(l),d=t._usesDepthTexture,f=t._polygonOffsetSupported,c=t._isPointLight,h=t._isSpotLight,m=t._numberOfCascades>1,p=t.debugCascadeColors,_=t.softShadows,g=c?t._pointBias:a?t._terrainBias:t._primitiveBias,v=e.defines.slice(0),y=e.sources.slice(0),b=y.length,w=0;w<b;++w)y[w]=E.a.replaceMain(y[w],"czm_shadow_receive_main");c?v.push("USE_CUBE_MAP_SHADOW"):d&&v.push("USE_SHADOW_DEPTH_TEXTURE"),_&&!c&&v.push("USE_SOFT_SHADOWS"),m&&i&&a&&(s?v.push("ENABLE_VERTEX_LIGHTING"):v.push("ENABLE_DAYNIGHT_SHADING")),i&&g.normalShading&&s&&(v.push("USE_NORMAL_SHADING"),g.normalShadingSmooth>0&&v.push("USE_NORMAL_SHADING_SMOOTH"));var x="";return x+=c?"uniform samplerCube shadowMap_textureCube; \n":"uniform sampler2D shadowMap_texture; \n",x+="uniform mat4 shadowMap_matrix; \nuniform vec3 shadowMap_lightDirectionEC; \nuniform vec4 shadowMap_lightPositionEC; \nuniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness; \nuniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth; \n#ifdef LOG_DEPTH \nvarying vec3 v_logPositionEC; \n#endif \nvec4 getPositionEC() \n{ \n"+(u?"    return vec4("+l+", 1.0); \n":"#ifndef LOG_DEPTH \n    return czm_windowToEyeCoordinates(gl_FragCoord); \n#else \n    return vec4(v_logPositionEC, 1.0); \n#endif \n")+"} \nvec3 getNormalEC() \n{ \n"+(s?"    return normalize("+n+"); \n":"    return vec3(1.0); \n")+"} \nvoid applyNormalOffset(inout vec4 positionEC, vec3 normalEC, float nDotL) \n{ \n"+(g.normalOffset&&s?"    float normalOffset = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.x; \n    float normalOffsetScale = 1.0 - nDotL; \n    vec3 offset = normalOffset * normalOffsetScale * normalEC; \n    positionEC.xyz += offset; \n":"")+"} \n",x+="void main() \n{ \n    czm_shadow_receive_main(); \n    vec4 positionEC = getPositionEC(); \n    vec3 normalEC = getNormalEC(); \n    float depth = -positionEC.z; \n",x+="    czm_shadowParameters shadowParameters; \n    shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy; \n    shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z; \n    shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w; \n    shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w; \n",a?x+="    shadowParameters.depthBias *= max(depth * 0.01, 1.0); \n":f||(x+="    shadowParameters.depthBias *= mix(1.0, 100.0, depth * 0.0015); \n"),x+=c?"    vec3 directionEC = positionEC.xyz - shadowMap_lightPositionEC.xyz; \n    float distance = length(directionEC); \n    directionEC = normalize(directionEC); \n    float radius = shadowMap_lightPositionEC.w; \n    // Stop early if the fragment is beyond the point light radius \n    if (distance > radius) \n    { \n        return; \n    } \n    vec3 directionWC  = czm_inverseViewRotation * directionEC; \n    shadowParameters.depth = distance / radius; \n    shadowParameters.nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \n    shadowParameters.texCoords = directionWC; \n    float visibility = czm_shadowVisibility(shadowMap_textureCube, shadowParameters); \n":h?"    vec3 directionEC = normalize(positionEC.xyz - shadowMap_lightPositionEC.xyz); \n    float nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Spot light uses a perspective projection, so perform the perspective divide \n    shadowPosition /= shadowPosition.w; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n":m?"    float maxDepth = shadowMap_cascadeSplits[1].w; \n    // Stop early if the eye depth exceeds the last cascade \n    if (depth > maxDepth) \n    { \n        return; \n    } \n    // Get the cascade based on the eye-space depth \n    vec4 weights = czm_cascadeWeights(depth); \n    // Apply normal offset \n    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    // Transform position into the cascade \n    vec4 shadowPosition = czm_cascadeMatrix(weights) * positionEC; \n    // Get visibility \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n    // Fade out shadows that are far away \n    float shadowMapMaximumDistance = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.z; \n    float fade = max((depth - shadowMapMaximumDistance * 0.8) / (shadowMapMaximumDistance * 0.2), 0.0); \n    visibility = mix(visibility, 1.0, fade); \n"+(p?"    // Draw cascade colors for debugging \n    gl_FragColor *= czm_cascadeColor(weights); \n":""):"    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n",x+="    gl_FragColor.rgb *= visibility; \n} \n",y.push(x),new E.a({defines:v,sources:y})};var Rf=Ff;function Nf(e){var t=(e=Object(n.default)(e,n.default.EMPTY_OBJECT)).context;this._enabled=Object(n.default)(e.enabled,!0),this._softShadows=Object(n.default)(e.softShadows,!1),this._normalOffset=Object(n.default)(e.normalOffset,!0),this.dirty=!0,this.fromLightSource=Object(n.default)(e.fromLightSource,!0),this.darkness=Object(n.default)(e.darkness,.3),this._darkness=this.darkness,this.maximumDistance=Object(n.default)(e.maximumDistance,5e3),this._outOfView=!1,this._outOfViewPrevious=!1,this._needsUpdate=!0;var i,r=!0;(d.default.isInternetExplorer()||d.default.isEdge()||(d.default.isChrome()||d.default.isFirefox())&&d.default.isWindows()&&!t.depthTexture)&&(r=!1),this._polygonOffsetSupported=r,this._terrainBias={polygonOffset:r,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.5,normalShading:!0,normalShadingSmooth:.3,depthBias:1e-4},this._primitiveBias={polygonOffset:r,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.1,normalShading:!0,normalShadingSmooth:.05,depthBias:2e-5},this._pointBias={polygonOffset:!1,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:0,normalShading:!0,normalShadingSmooth:.1,depthBias:5e-4},this._depthAttachment=void 0,this._colorAttachment=void 0,this._shadowMapMatrix=new K.default,this._shadowMapTexture=void 0,this._lightDirectionEC=new a.default,this._lightPositionEC=new B.a,this._distance=0,this._lightCamera=e.lightCamera,this._shadowMapCamera=new Jf,this._shadowMapCullingVolume=void 0,this._sceneCamera=void 0,this._boundingSphere=new g.default,this._isPointLight=Object(n.default)(e.isPointLight,!1),this._pointLightRadius=Object(n.default)(e.pointLightRadius,100),this._cascadesEnabled=!this._isPointLight&&Object(n.default)(e.cascadesEnabled,!0),this._numberOfCascades=this._cascadesEnabled?Object(n.default)(e.numberOfCascades,4):0,this._fitNearFar=!0,this._maximumCascadeDistances=[25,150,700,Number.MAX_VALUE],this._textureSize=new z.default,this._isSpotLight=!1,this._cascadesEnabled?this._shadowMapCamera.frustum=new fi.a:Object(o.default)(this._lightCamera.frustum.fov)&&(this._isSpotLight=!0),this._cascadeSplits=[new B.a,new B.a],this._cascadeMatrices=[new K.default,new K.default,new K.default,new K.default],this._cascadeDistances=new B.a,i=this._isPointLight?6:this._cascadesEnabled?this._numberOfCascades:1,this._passes=new Array(i);for(var s=0;s<i;++s)this._passes[s]=new Lf(t);this.debugShow=!1,this.debugFreezeFrame=!1,this._debugFreezeFrame=!1,this._debugCascadeColors=!1,this._debugLightFrustum=void 0,this._debugCameraFrustum=void 0,this._debugCascadeFrustums=new Array(this._numberOfCascades),this._debugShadowViewCommand=void 0,this._usesDepthTexture=t.depthTexture,this._isPointLight&&(this._usesDepthTexture=!1),this._primitiveRenderState=void 0,this._terrainRenderState=void 0,this._pointRenderState=void 0,Vf(this),this._clearCommand=new Mn.a({depth:1,color:new k.default}),this._clearPassState=new qn(t),this._size=Object(n.default)(e.size,2048),this.size=this._size}function Lf(e){this.camera=new Jf,this.passState=new qn(e),this.framebuffer=void 0,this.textureOffsets=void 0,this.commandList=[],this.cullingVolume=void 0}function jf(e,t){return ue.a.fromCache({cull:{enabled:!0,face:Wr.a.BACK},depthTest:{enabled:!0},colorMask:{red:e,green:e,blue:e,alpha:e},depthMask:!0,polygonOffset:{enabled:t.polygonOffset,factor:t.polygonOffsetFactor,units:t.polygonOffsetUnits}})}function Vf(e){var t=!e._usesDepthTexture;e._primitiveRenderState=jf(t,e._primitiveBias),e._terrainRenderState=jf(t,e._terrainBias),e._pointRenderState=jf(t,e._pointBias)}function Uf(e){for(var t=e._passes.length,i=0;i<t;++i){var a=e._passes[i],r=a.framebuffer;Object(o.default)(r)&&!r.isDestroyed()&&r.destroy(),a.framebuffer=void 0}e._depthAttachment=e._depthAttachment&&e._depthAttachment.destroy(),e._colorAttachment=e._colorAttachment&&e._colorAttachment.destroy()}function zf(e,t){e._isPointLight?function(e,t){for(var i=new Ef({context:t,width:e._textureSize.x,height:e._textureSize.y,format:Cf.DEPTH_COMPONENT16}),a=new Qn.a({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:me.a.RGBA,pixelDatatype:ye.a.UNSIGNED_BYTE,sampler:be.a.NEAREST}),r=[a.negativeX,a.negativeY,a.negativeZ,a.positiveX,a.positiveY,a.positiveZ],n=0;n<6;++n){var o=new Rn.a({context:t,depthRenderbuffer:i,colorTextures:[r[n]],destroyAttachments:!1}),s=e._passes[n];s.framebuffer=o,s.passState.framebuffer=o}e._shadowMapTexture=a,e._depthAttachment=i,e._colorAttachment=a}(e,t):e._usesDepthTexture?function(e,t){for(var i=new P.a({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:me.a.DEPTH_STENCIL,pixelDatatype:ye.a.UNSIGNED_INT_24_8,sampler:be.a.NEAREST}),a=new Rn.a({context:t,depthStencilTexture:i,destroyAttachments:!1}),r=e._passes.length,n=0;n<r;++n){var o=e._passes[n];o.framebuffer=a,o.passState.framebuffer=a}e._shadowMapTexture=i,e._depthAttachment=i}(e,t):function(e,t){for(var i=new Ef({context:t,width:e._textureSize.x,height:e._textureSize.y,format:Cf.DEPTH_COMPONENT16}),a=new P.a({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:me.a.RGBA,pixelDatatype:ye.a.UNSIGNED_BYTE,sampler:be.a.NEAREST}),r=new Rn.a({context:t,depthRenderbuffer:i,colorTextures:[a],destroyAttachments:!1}),n=e._passes.length,o=0;o<n;++o){var s=e._passes[o];s.framebuffer=r,s.passState.framebuffer=r}e._shadowMapTexture=a,e._depthAttachment=i,e._colorAttachment=a}(e,t)}function Bf(e,t){Object(o.default)(e._passes[0].framebuffer)&&e._shadowMapTexture.width===e._textureSize.x||(Uf(e),zf(e,t),function(e,t){e._usesDepthTexture&&e._passes[0].framebuffer.status!==kn.a.FRAMEBUFFER_COMPLETE&&(e._usesDepthTexture=!1,Vf(e),Uf(e),zf(e,t))}(e,t),Hf(e,t))}function Hf(e,t,i){i=Object(n.default)(i,0),(e._isPointLight||0===i)&&(e._clearCommand.framebuffer=e._passes[i].framebuffer,e._clearCommand.execute(t,e._clearPassState))}Nf.MAXIMUM_DISTANCE=2e4,Nf.prototype.debugCreateRenderStates=function(){Vf(this)},Object.defineProperties(Nf.prototype,{enabled:{get:function(){return this._enabled},set:function(e){this.dirty=this._enabled!==e,this._enabled=e}},normalOffset:{get:function(){return this._normalOffset},set:function(e){this.dirty=this._normalOffset!==e,this._normalOffset=e,this._terrainBias.normalOffset=e,this._primitiveBias.normalOffset=e,this._pointBias.normalOffset=e}},softShadows:{get:function(){return this._softShadows},set:function(e){this.dirty=this._softShadows!==e,this._softShadows=e}},size:{get:function(){return this._size},set:function(e){!function(e,t){e._size=t;var i=e._passes,a=i.length,r=e._textureSize;if(e._isPointLight){t=oe.a.maximumCubeMapSize>=t?t:oe.a.maximumCubeMapSize,r.x=t,r.y=t;var n=new an.default(0,0,t,t);i[0].passState.viewport=n,i[1].passState.viewport=n,i[2].passState.viewport=n,i[3].passState.viewport=n,i[4].passState.viewport=n,i[5].passState.viewport=n}else 1===a?(t=oe.a.maximumTextureSize>=t?t:oe.a.maximumTextureSize,r.x=t,r.y=t,i[0].passState.viewport=new an.default(0,0,t,t)):4===a&&(t=oe.a.maximumTextureSize>=2*t?t:oe.a.maximumTextureSize/2,r.x=2*t,r.y=2*t,i[0].passState.viewport=new an.default(0,0,t,t),i[1].passState.viewport=new an.default(t,0,t,t),i[2].passState.viewport=new an.default(0,t,t,t),i[3].passState.viewport=new an.default(t,t,t,t));e._clearPassState.viewport=new an.default(0,0,r.x,r.y);for(var o=0;o<a;++o){var s=i[o],l=s.passState.viewport,u=l.x/r.x,d=l.y/r.y,f=l.width/r.x,c=l.height/r.y;s.textureOffsets=new K.default(f,0,0,u,0,c,0,d,0,0,1,0,0,0,0,1)}}(this,e)}},outOfView:{get:function(){return this._outOfView}},shadowMapCullingVolume:{get:function(){return this._shadowMapCullingVolume}},passes:{get:function(){return this._passes}},isPointLight:{get:function(){return this._isPointLight}},debugCascadeColors:{get:function(){return this._debugCascadeColors},set:function(e){this.dirty=this._debugCascadeColors!==e,this._debugCascadeColors=e}}});var kf=new an.default;function Wf(e,t){var i=t.context,a=t.context.drawingBufferWidth,r=t.context.drawingBufferHeight,n=.3*Math.min(a,r),s=kf;s.x=a-n,s.y=0,s.width=n,s.height=n;var l=e._debugShadowViewCommand;Object(o.default)(l)||(l=function(e,t){var i;i=e._isPointLight?"uniform samplerCube shadowMap_textureCube; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    vec2 uv = v_textureCoordinates; \n    vec3 dir; \n \n    if (uv.y < 0.5) \n    { \n        if (uv.x < 0.333) \n        { \n            dir.x = -1.0; \n            dir.y = uv.x * 6.0 - 1.0; \n            dir.z = uv.y * 4.0 - 1.0; \n        } \n        else if (uv.x < 0.666) \n        { \n            dir.y = -1.0; \n            dir.x = uv.x * 6.0 - 3.0; \n            dir.z = uv.y * 4.0 - 1.0; \n        } \n        else \n        { \n            dir.z = -1.0; \n            dir.x = uv.x * 6.0 - 5.0; \n            dir.y = uv.y * 4.0 - 1.0; \n        } \n    } \n    else \n    { \n        if (uv.x < 0.333) \n        { \n            dir.x = 1.0; \n            dir.y = uv.x * 6.0 - 1.0; \n            dir.z = uv.y * 4.0 - 3.0; \n        } \n        else if (uv.x < 0.666) \n        { \n            dir.y = 1.0; \n            dir.x = uv.x * 6.0 - 3.0; \n            dir.z = uv.y * 4.0 - 3.0; \n        } \n        else \n        { \n            dir.z = 1.0; \n            dir.x = uv.x * 6.0 - 5.0; \n            dir.y = uv.y * 4.0 - 3.0; \n        } \n    } \n \n    float shadow = czm_unpackDepth(textureCube(shadowMap_textureCube, dir)); \n    gl_FragColor = vec4(vec3(shadow), 1.0); \n} \n":"uniform sampler2D shadowMap_texture; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n"+(e._usesDepthTexture?"    float shadow = texture2D(shadowMap_texture, v_textureCoordinates).r; \n":"    float shadow = czm_unpackDepth(texture2D(shadowMap_texture, v_textureCoordinates)); \n")+"    gl_FragColor = vec4(vec3(shadow), 1.0); \n} \n";var a=t.createViewportQuadCommand(i,{uniformMap:{shadowMap_texture:function(){return e._shadowMapTexture},shadowMap_textureCube:function(){return e._shadowMapTexture}}});return a.pass=le.a.OVERLAY,a}(e,i),e._debugShadowViewCommand=l),Object(o.default)(l.renderState)&&an.default.equals(l.renderState.viewport,s)||(l.renderState=ue.a.fromCache({viewport:an.default.clone(s)})),t.commandList.push(e._debugShadowViewCommand)}var Gf=new Array(8);Gf[0]=new B.a(-1,-1,-1,1),Gf[1]=new B.a(1,-1,-1,1),Gf[2]=new B.a(1,1,-1,1),Gf[3]=new B.a(-1,1,-1,1),Gf[4]=new B.a(-1,-1,1,1),Gf[5]=new B.a(1,-1,1,1),Gf[6]=new B.a(1,1,1,1),Gf[7]=new B.a(-1,1,1,1);for(var Yf=new K.default,Xf=new Array(8),Qf=0;Qf<8;++Qf)Xf[Qf]=new B.a;var qf=[k.default.RED,k.default.GREEN,k.default.BLUE,k.default.MAGENTA],Zf=new a.default;function Kf(e,t){Wf(e,t);var i=e.debugFreezeFrame&&!e._debugFreezeFrame;if(e._debugFreezeFrame=e.debugFreezeFrame,e.debugFreezeFrame&&(i&&(e._debugCameraFrustum=e._debugCameraFrustum&&e._debugCameraFrustum.destroy(),e._debugCameraFrustum=new zu({camera:e._sceneCamera,color:k.default.CYAN,updateOnChange:!1})),e._debugCameraFrustum.update(t)),e._cascadesEnabled){if(e.debugFreezeFrame){i&&(e._debugLightFrustum=e._debugLightFrustum&&e._debugLightFrustum.destroy(),e._debugLightFrustum=new zu({camera:e._shadowMapCamera,color:k.default.YELLOW,updateOnChange:!1})),e._debugLightFrustum.update(t);for(var r=0;r<e._numberOfCascades;++r)i&&(e._debugCascadeFrustums[r]=e._debugCascadeFrustums[r]&&e._debugCascadeFrustums[r].destroy(),e._debugCascadeFrustums[r]=new zu({camera:e._passes[r].camera,color:qf[r],updateOnChange:!1})),e._debugCascadeFrustums[r].update(t)}}else if(e._isPointLight){if(!Object(o.default)(e._debugLightFrustum)||e._needsUpdate){var n=e._shadowMapCamera.positionWC,s=pa.default.IDENTITY,l=2*e._pointLightRadius,u=a.default.fromElements(l,l,l,Zf),d=K.default.fromTranslationQuaternionRotationScale(n,s,u,Yf);e._debugLightFrustum=e._debugLightFrustum&&e._debugLightFrustum.destroy(),e._debugLightFrustum=function(e,t){var i=new Y.a({geometry:new U.a({minimum:new a.default(-.5,-.5,-.5),maximum:new a.default(.5,.5,.5)}),attributes:{color:W.a.fromColor(t)}}),r=new Y.a({geometry:new te.a({radius:.5}),attributes:{color:W.a.fromColor(t)}});return new Le.a({geometryInstances:[i,r],appearance:new Ne.a({translucent:!1,flat:!0}),asynchronous:!1,modelMatrix:e})}(d,k.default.YELLOW)}e._debugLightFrustum.update(t)}else Object(o.default)(e._debugLightFrustum)&&!e._needsUpdate||(e._debugLightFrustum=new zu({camera:e._shadowMapCamera,color:k.default.YELLOW,updateOnChange:!1})),e._debugLightFrustum.update(t)}function Jf(){this.viewMatrix=new K.default,this.inverseViewMatrix=new K.default,this.frustum=void 0,this.positionCartographic=new v.default,this.positionWC=new a.default,this.directionWC=a.default.clone(a.default.UNIT_Z),this.upWC=a.default.clone(a.default.UNIT_Y),this.rightWC=a.default.clone(a.default.UNIT_X),this.viewProjectionMatrix=new K.default}Jf.prototype.clone=function(e){K.default.clone(e.viewMatrix,this.viewMatrix),K.default.clone(e.inverseViewMatrix,this.inverseViewMatrix),this.frustum=e.frustum.clone(this.frustum),v.default.clone(e.positionCartographic,this.positionCartographic),a.default.clone(e.positionWC,this.positionWC),a.default.clone(e.directionWC,this.directionWC),a.default.clone(e.upWC,this.upWC),a.default.clone(e.rightWC,this.rightWC)};var $f=new K.default(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);Jf.prototype.getViewProjection=function(){var e=this.viewMatrix,t=this.frustum.projectionMatrix;return K.default.multiply(t,e,this.viewProjectionMatrix),K.default.multiply($f,this.viewProjectionMatrix,this.viewProjectionMatrix),this.viewProjectionMatrix};var ec=new Array(5),tc=new An.a,ic=new Array(4),ac=new a.default,rc=new a.default;var nc=new K.default,oc=new a.default,sc=new a.default,lc=new a.default;var uc=[new a.default(-1,0,0),new a.default(0,-1,0),new a.default(0,0,-1),new a.default(1,0,0),new a.default(0,1,0),new a.default(0,0,1)],dc=[new a.default(0,-1,0),new a.default(0,0,-1),new a.default(0,-1,0),new a.default(0,-1,0),new a.default(0,0,1),new a.default(0,-1,0)],fc=[new a.default(0,0,1),new a.default(1,0,0),new a.default(-1,0,0),new a.default(0,0,-1),new a.default(1,0,0),new a.default(1,0,0)];var cc=new a.default,hc=new a.default,mc=new g.default,pc=mc.center;function _c(e,t){var i=t.camera,r=e._lightCamera,n=e._sceneCamera,o=e._shadowMapCamera;e._cascadesEnabled?a.default.clone(r.directionWC,o.directionWC):e._isPointLight?a.default.clone(r.positionWC,o.positionWC):o.clone(r);var s,l,u=e._lightDirectionEC;K.default.multiplyByPointAsVector(i.viewMatrix,o.directionWC,u),a.default.normalize(u,u),a.default.negate(u,u),K.default.multiplyByPoint(i.viewMatrix,o.positionWC,e._lightPositionEC),e._lightPositionEC.w=e._pointLightRadius,e._fitNearFar?(s=Math.min(t.shadowState.nearPlane,e.maximumDistance),l=Math.min(t.shadowState.farPlane,e.maximumDistance+1)):(s=i.frustum.near,l=e.maximumDistance),e._sceneCamera=Ql.clone(i,n),i.frustum.clone(e._sceneCamera.frustum),e._sceneCamera.frustum.near=s,e._sceneCamera.frustum.far=l,e._distance=l-s,function(e,t){var i=e._sceneCamera,r=e._shadowMapCamera,n=mc;if(e._cascadesEnabled){if(i.frustum.near>=e.maximumDistance)return e._outOfView=!0,void(e._needsUpdate=!1);var o=t.mapProjection.ellipsoid.geodeticSurfaceNormal(i.positionWC,cc),s=a.default.negate(r.directionWC,hc),l=a.default.dot(o,s),u=Z.default.clamp(l/.1,0,1);if(e._darkness=Z.default.lerp(1,e.darkness,u),l<0)return e._outOfView=!0,void(e._needsUpdate=!1);e._needsUpdate=!0,e._outOfView=!1}else if(e._isPointLight)n.center=r.positionWC,n.radius=e._pointLightRadius,e._outOfView=t.cullingVolume.computeVisibility(n)===q.default.OUTSIDE,e._needsUpdate=!e._outOfView&&!e._boundingSphere.equals(n),g.default.clone(n,e._boundingSphere);else{var d=r.frustum.far/2,f=a.default.add(r.positionWC,a.default.multiplyByScalar(r.directionWC,d,pc),pc);n.center=f,n.radius=d,e._outOfView=t.cullingVolume.computeVisibility(n)===q.default.OUTSIDE,e._needsUpdate=!e._outOfView&&!e._boundingSphere.equals(n),g.default.clone(n,e._boundingSphere)}}(e,t),!e._outOfViewPrevious&&e._outOfView&&(e._needsUpdate=!0),e._outOfViewPrevious=e._outOfView}Nf.prototype.update=function(e){if(_c(this,e),this._needsUpdate)if(Bf(this,e.context),this._isPointLight&&function(e,t){var i=new An.a;i.fov=Z.default.PI_OVER_TWO,i.near=1,i.far=e._pointLightRadius,i.aspectRatio=1;for(var a=0;a<6;++a){var r=e._passes[a].camera;r.positionWC=e._shadowMapCamera.positionWC,r.positionCartographic=t.mapProjection.ellipsoid.cartesianToCartographic(r.positionWC,r.positionCartographic),r.directionWC=uc[a],r.upWC=dc[a],r.rightWC=fc[a],K.default.computeView(r.positionWC,r.directionWC,r.upWC,r.rightWC,r.viewMatrix),K.default.inverse(r.viewMatrix,r.inverseViewMatrix),r.frustum=i}}(this,e),this._cascadesEnabled&&(function(e,t){var i=e._shadowMapCamera,r=e._sceneCamera,n=K.default.multiply(r.frustum.projectionMatrix,r.viewMatrix,Yf),o=K.default.inverse(n,Yf),s=i.directionWC,l=r.directionWC;a.default.equalsEpsilon(s,l,Z.default.EPSILON10)&&(l=r.upWC);var u=a.default.cross(s,l,oc);l=a.default.cross(u,s,sc),a.default.normalize(l,l),a.default.normalize(u,u);for(var d=a.default.fromElements(0,0,0,lc),f=K.default.computeView(d,s,l,u,nc),c=K.default.multiply(f,o,Yf),h=a.default.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,ac),m=a.default.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,rc),p=0;p<8;++p){var _=B.a.clone(Gf[p],Xf[p]);K.default.multiplyByVector(c,_,_),a.default.divideByScalar(_,_.w,_),a.default.minimumByComponent(_,h,h),a.default.maximumByComponent(_,m,m)}m.z+=1e3,h.z-=10;var g=lc;g.x=-.5*(h.x+m.x),g.y=-.5*(h.y+m.y),g.z=-m.z;var v=K.default.fromTranslation(g,Yf);f=K.default.multiply(v,f,f);var y=.5*(m.x-h.x),b=.5*(m.y-h.y),w=m.z-h.z,x=i.frustum;x.left=-y,x.right=y,x.bottom=-b,x.top=b,x.near=.01,x.far=w,K.default.clone(f,i.viewMatrix),K.default.inverse(f,i.inverseViewMatrix),K.default.getTranslation(i.inverseViewMatrix,i.positionWC),t.mapProjection.ellipsoid.cartesianToCartographic(i.positionWC,i.positionCartographic),a.default.clone(s,i.directionWC),a.default.clone(l,i.upWC),a.default.clone(u,i.rightWC)}(this,e),this._numberOfCascades>1&&function(e,t){var i,r=e._shadowMapCamera,n=e._sceneCamera,o=n.frustum.near,s=n.frustum.far,l=e._numberOfCascades,u=s-o,d=s/o,f=.9,c=!1;t.shadowState.closestObjectSize<200&&(c=!0,f=.9);var h=ic,m=ec;for(m[0]=o,m[l]=s,i=0;i<l;++i){var p=(i+1)/l,_=o*Math.pow(d,p),g=o+u*p,v=Z.default.lerp(g,_,f);m[i+1]=v,h[i]=v-m[i]}if(c){for(i=0;i<l;++i)h[i]=Math.min(h[i],e._maximumCascadeDistances[i]);var y=m[0];for(i=0;i<l-1;++i)y+=h[i],m[i+1]=y}B.a.unpack(m,0,e._cascadeSplits[0]),B.a.unpack(m,1,e._cascadeSplits[1]),B.a.unpack(h,0,e._cascadeDistances);var b=r.frustum,w=b.left,x=b.right,O=b.bottom,C=b.top,T=b.near,E=b.far,P=r.positionWC,A=r.directionWC,S=r.upWC,D=n.frustum.clone(tc),I=r.getViewProjection();for(i=0;i<l;++i){D.near=m[i],D.far=m[i+1];for(var M=K.default.multiply(D.projectionMatrix,n.viewMatrix,Yf),F=K.default.inverse(M,Yf),R=K.default.multiply(I,F,Yf),N=a.default.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,ac),L=a.default.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,rc),j=0;j<8;++j){var V=B.a.clone(Gf[j],Xf[j]);K.default.multiplyByVector(R,V,V),a.default.divideByScalar(V,V.w,V),a.default.minimumByComponent(V,N,N),a.default.maximumByComponent(V,L,L)}N.x=Math.max(N.x,0),N.y=Math.max(N.y,0),N.z=0,L.x=Math.min(L.x,1),L.y=Math.min(L.y,1),L.z=Math.min(L.z,1);var U=e._passes[i],z=U.camera;z.clone(r);var H=z.frustum;H.left=w+N.x*(x-w),H.right=w+L.x*(x-w),H.bottom=O+N.y*(C-O),H.top=O+L.y*(C-O),H.near=T+N.z*(E-T),H.far=T+L.z*(E-T),U.cullingVolume=z.frustum.computeCullingVolume(P,A,S);var k=e._cascadeMatrices[i];K.default.multiply(z.getViewProjection(),n.inverseViewMatrix,k),K.default.multiply(U.textureOffsets,k,k)}}(this,e)),this._isPointLight)this._shadowMapCullingVolume=nn.a.fromBoundingSphere(this._boundingSphere);else{var t=this._shadowMapCamera,i=t.positionWC,r=t.directionWC,n=t.upWC;this._shadowMapCullingVolume=t.frustum.computeCullingVolume(i,r,n),1===this._passes.length&&this._passes[0].camera.clone(t)}if(1===this._passes.length){var o=this._sceneCamera.inverseViewMatrix;K.default.multiply(this._shadowMapCamera.getViewProjection(),o,this._shadowMapMatrix)}this.debugShow&&Kf(this,e)},Nf.prototype.updatePass=function(e,t){Hf(this,e,t)};var gc=new z.default;function vc(e,t,i){var a=e._isPointLight?e._pointBias:i?e._terrainBias:e._primitiveBias,r={shadowMap_texture:function(){return e._shadowMapTexture},shadowMap_textureCube:function(){return e._shadowMapTexture},shadowMap_matrix:function(){return e._shadowMapMatrix},shadowMap_cascadeSplits:function(){return e._cascadeSplits},shadowMap_cascadeMatrices:function(){return e._cascadeMatrices},shadowMap_lightDirectionEC:function(){return e._lightDirectionEC},shadowMap_lightPositionEC:function(){return e._lightPositionEC},shadowMap_cascadeDistances:function(){return e._cascadeDistances},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:function(){var t=gc;return t.x=1/e._textureSize.x,t.y=1/e._textureSize.y,B.a.fromElements(t.x,t.y,a.depthBias,a.normalShadingSmooth,this.combinedUniforms1)},shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:function(){return B.a.fromElements(a.normalOffsetScale,e._distance,e.maximumDistance,e._darkness,this.combinedUniforms2)},combinedUniforms1:new B.a,combinedUniforms2:new B.a};return Object(G.default)(t,r,!1)}function yc(e,t,i,a,r,n){var s,l,u;if(Object(o.default)(n)&&(s=n.shaderProgram,l=n.renderState,u=n.uniformMap),(n=se.a.shallowClone(i,n)).castShadows=!0,n.receiveShadows=!1,!Object(o.default)(s)||r!==i.shaderProgram.id||t){var d=i.shaderProgram,f=i.pass===le.a.GLOBE,c=i.pass!==le.a.TRANSLUCENT,h=e._isPointLight,m=e._usesDepthTexture,p=Rf.getShadowCastShaderKeyword(h,f,m,c);if(s=a.shaderCache.getDerivedShaderProgram(d,p),!Object(o.default)(s)){var _=d.vertexShaderSource,g=d.fragmentShaderSource,v=Rf.createShadowCastVertexShader(_,h,f),y=Rf.createShadowCastFragmentShader(g,h,m,c);s=a.shaderCache.createDerivedShaderProgram(d,p,{vertexShaderSource:v,fragmentShaderSource:y,attributeLocations:d._attributeLocations})}l=e._primitiveRenderState,h?l=e._pointRenderState:f&&(l=e._terrainRenderState),i.renderState.cull.enabled||((l=Object(H.default)(l,!1)).cull=Object(H.default)(l.cull,!1),l.cull.enabled=!1,l=ue.a.fromCache(l)),u=vc(e,i.uniformMap,f)}return n.shaderProgram=s,n.renderState=l,n.uniformMap=u,n}Nf.createReceiveDerivedCommand=function(e,t,i,a,r){Object(o.default)(r)||(r={});var n=e.length>0,s=t.shaderProgram,l=s.vertexShaderSource,u=s.fragmentShaderSource,d=t.pass===le.a.GLOBE,f=!1;if(d&&(f=t.owner.data.renderedMesh.encoding.hasVertexNormals),t.receiveShadows&&n){var c,h;Object(o.default)(r.receiveCommand)&&(c=r.receiveCommand.shaderProgram,h=r.receiveCommand.uniformMap),r.receiveCommand=se.a.shallowClone(t,r.receiveCommand),r.castShadows=!1,r.receiveShadows=!0;var m=r.receiveShaderCastShadows!==t.castShadows,p=r.receiveShaderProgramId!==t.shaderProgram.id;if(!Object(o.default)(c)||p||i||m){var _=Rf.getShadowReceiveShaderKeyword(e[0],t.castShadows,d,f);if(c=a.shaderCache.getDerivedShaderProgram(s,_),!Object(o.default)(c)){var g=Rf.createShadowReceiveVertexShader(l,d,f),v=Rf.createShadowReceiveFragmentShader(u,e[0],t.castShadows,d,f);c=a.shaderCache.createDerivedShaderProgram(s,_,{vertexShaderSource:g,fragmentShaderSource:v,attributeLocations:s._attributeLocations})}h=vc(e[0],t.uniformMap,d)}r.receiveCommand.shaderProgram=c,r.receiveCommand.uniformMap=h,r.receiveShaderProgramId=t.shaderProgram.id,r.receiveShaderCastShadows=t.castShadows}return r},Nf.createCastDerivedCommand=function(e,t,i,a,r){if(Object(o.default)(r)||(r={}),t.castShadows){var n=r.castCommands;Object(o.default)(n)||(n=r.castCommands=[]);var s=r.castShaderProgramId,l=e.length;n.length=l;for(var u=0;u<l;++u)n[u]=yc(e[u],i,t,a,s,n[u]);r.castShaderProgramId=t.shaderProgram.id}return r},Nf.prototype.isDestroyed=function(){return!1},Nf.prototype.destroy=function(){Uf(this),this._debugLightFrustum=this._debugLightFrustum&&this._debugLightFrustum.destroy(),this._debugCameraFrustum=this._debugCameraFrustum&&this._debugCameraFrustum.destroy(),this._debugShadowViewCommand=this._debugShadowViewCommand&&this._debugShadowViewCommand.shaderProgram&&this._debugShadowViewCommand.shaderProgram.destroy();for(var e=0;e<this._numberOfCascades;++e)this._debugCascadeFrustums[e]=this._debugCascadeFrustums[e]&&this._debugCascadeFrustums[e].destroy();return Object(s.default)(this)};var bc=Nf;function wc(e,t,i){var a,r,n=e.context,o=[],s=t.frustum.near,l=t.frustum.far,u=e.logarithmicDepthBuffer?e.logarithmicDepthFarToNearRatio:e.farToNearRatio;Tc(s,l,u,Math.ceil(Math.log(l/s)/Math.log(u)),e.logarithmicDepthBuffer,o,!1,void 0),n.depthTexture&&(a=new Sd),e._useOIT&&n.depthTexture&&(r=new yf(n));var d=new qn(n);d.viewport=an.default.clone(i),this.camera=t,this._cameraClone=Ql.clone(t),this._cameraStartFired=!1,this._cameraMovedTime=void 0,this.viewport=i,this.passState=d,this.pickFramebuffer=new Sf(n),this.pickDepthFramebuffer=new xf,this.sceneFramebuffer=new Mf,this.globeDepth=a,this.oit=r,this.pickDepths=[],this.debugGlobeDepths=[],this.frustumCommandsList=o,this.debugFrustumStatistics=void 0,this.updateFrustums=!1}var xc=new a.default,Oc=new a.default;function Cc(e,t,i){var r,n,o,s,l,u=1/Math.max(1,(r=e.position,n=t.position,o=Math.max(Math.abs(r.x),Math.abs(n.x)),s=Math.max(Math.abs(r.y),Math.abs(n.y)),l=Math.max(Math.abs(r.z),Math.abs(n.z)),Math.max(Math.max(o,s),l)));return a.default.multiplyByScalar(e.position,u,xc),a.default.multiplyByScalar(t.position,u,Oc),a.default.equalsEpsilon(xc,Oc,i)&&a.default.equalsEpsilon(e.direction,t.direction,i)&&a.default.equalsEpsilon(e.up,t.up,i)&&a.default.equalsEpsilon(e.right,t.right,i)&&K.default.equalsEpsilon(e.transform,t.transform,i)&&e.frustum.equalsEpsilon(t.frustum,i)}function Tc(e,t,i,a,r,n,s,l){n.length=a;for(var u=0;u<a;++u){var d,f;s?(d=Math.min(t-l,e+u*l),f=Math.min(t,d+l)):(f=i*(d=Math.max(e,Math.pow(i,u)*e)),r||(f=Math.min(t,f)));var c=n[u];Object(o.default)(c)?(c.near=d,c.far=f):c=n[u]=new af(d,f)}}function Ec(e,t,i,a){e.debugShowFrustums&&(i.debugOverlappingFrustums=0);for(var r=t.frustumCommandsList,n=r.length,s=0;s<n;++s){var l=r[s],u=l.near,d=l.far;if(!(a.start>d)){if(a.stop<u)break;var f=i.pass,c=l.indices[f]++;if(l.commands[f][c]=i,e.debugShowFrustums&&(i.debugOverlappingFrustums|=1<<s),i.executeInClosestFrustum)break}}if(e.debugShowFrustums){var h=t.debugFrustumStatistics.commandsInFrustums;h[i.debugOverlappingFrustums]=Object(o.default)(h[i.debugOverlappingFrustums])?h[i.debugOverlappingFrustums]+1:1,++t.debugFrustumStatistics.totalCommands}e.updateDerivedCommands(i)}wc.prototype.checkForCameraUpdates=function(e){var t=this.camera,i=this._cameraClone;return Cc(t,i,Z.default.EPSILON15)?(this._cameraStartFired&&Object(di.default)()-this._cameraMovedTime>e.cameraEventWaitTime&&(t.moveEnd.raiseEvent(),this._cameraStartFired=!1),!1):(this._cameraStartFired||(t.moveStart.raiseEvent(),this._cameraStartFired=!0),this._cameraMovedTime=Object(di.default)(),Ql.clone(t,i),!0)};var Pc=new nn.a,Ac=new tf.a;wc.prototype.createPotentiallyVisibleSet=function(e){var t=e.frameState,i=t.camera,a=i.directionWC,r=i.positionWC,n=e._computeCommandList,s=e._overlayCommandList,l=t.commandList;e.debugShowFrustums&&(this.debugFrustumStatistics={totalCommands:0,commandsInFrustums:{}});for(var u=this.frustumCommandsList,d=u.length,f=le.a.NUMBER_OF_PASSES,c=0;c<d;++c)for(var h=0;h<f;++h)u[c].indices[h]=0;n.length=0,s.length=0;for(var m=Number.MAX_VALUE,p=-Number.MAX_VALUE,_=!1,g=t.shadowState.shadowsEnabled,v=Number.MAX_VALUE,y=-Number.MAX_VALUE,b=Number.MAX_VALUE,w=t.mode===N.a.SCENE3D?t.occluder:void 0,x=t.cullingVolume,O=Pc.planes,C=0;C<5;++C)O[C]=x.planes[C];x=Pc;for(var T=l.length,E=0;E<T;++E){var P=l[E],A=P.pass;if(A===le.a.COMPUTE)n.push(P);else if(A===le.a.OVERLAY)s.push(P);else{var S=P.boundingVolume;if(Object(o.default)(S)){if(!e.isVisible(P,x,w))continue;if(Ac=S.computePlaneDistances(r,a,Ac),m=Math.min(m,Ac.start),p=Math.max(p,Ac.stop),g&&P.receiveShadows&&Ac.start<bc.MAXIMUM_DISTANCE&&!(A===le.a.GLOBE&&Ac.start<-100&&Ac.stop>100)){var D=Ac.stop-Ac.start;A!==le.a.GLOBE&&Ac.start<100&&(b=Math.min(b,D)),v=Math.min(v,Ac.start),y=Math.max(y,Ac.stop)}}else Ac.start=i.frustum.near,Ac.stop=i.frustum.far,_=_||!(P instanceof Mn.a);Ec(e,this,P,Ac)}}_?(m=i.frustum.near,p=i.frustum.far):(m=Math.min(Math.max(m,i.frustum.near),i.frustum.far),p=Math.max(Math.min(p,i.frustum.far),m),g&&(v=Math.min(Math.max(v,i.frustum.near),i.frustum.far),y=Math.max(Math.min(y,i.frustum.far),v))),g&&(t.shadowState.nearPlane=v,t.shadowState.farPlane=y,t.shadowState.closestObjectSize=b);var I,M=e.mode===N.a.SCENE2D,F=t.useLogDepth,R=F?e.logarithmicDepthFarToNearRatio:e.farToNearRatio;M?(p=Math.min(p,i.position.z+e.nearToFarDistance2D),m=Math.min(m,p),I=Math.ceil(Math.max(1,p-m)/e.nearToFarDistance2D)):I=Math.ceil(Math.log(p/m)/Math.log(R)),(this.updateFrustums||m!==Number.MAX_VALUE&&(I!==d||0!==u.length&&(m<u[0].near||p>u[d-1].far&&(F||!Z.default.equalsEpsilon(p,u[d-1].far,Z.default.EPSILON8)))))&&(this.updateFrustums=!1,Tc(m,p,R,I,F,u,M,e.nearToFarDistance2D),this.createPotentiallyVisibleSet(e));var L=t.frustumSplits;L.length=I+1;for(var j=0;j<I;++j)L[j]=u[j].near,j===I-1&&(L[j+1]=u[j].far)},wc.prototype.destroy=function(){var e,t;this.pickFramebuffer=this.pickFramebuffer&&this.pickFramebuffer.destroy(),this.pickDepthFramebuffer=this.pickDepthFramebuffer&&this.pickDepthFramebuffer.destroy(),this.sceneFramebuffer=this.sceneFramebuffer&&this.sceneFramebuffer.destroy(),this.globeDepth=this.globeDepth&&this.globeDepth.destroy(),this.oit=this.oit&&this.oit.destroy();var i=this.pickDepths,a=this.debugGlobeDepths;for(t=i.length,e=0;e<t;++e)i[e].destroy();for(t=a.length,e=0;e<t;++e)a[e].destroy()};var Sc=wc,Dc=.1,Ic=new Zl({pass:ql.a.MOST_DETAILED_PRELOAD}),Mc=new Zl({pass:ql.a.MOST_DETAILED_PICK}),Fc=new Zl({pass:ql.a.PICK});function Rc(e){this._mostDetailedRayPicks=[],this.pickRenderStateCache={},this._pickPositionCache={},this._pickPositionCacheDirty=!1;var t=new an.default(0,0,1,1),i=new Ql(e);i.frustum=new $.a({width:Dc,aspectRatio:1,near:.1}),this._pickOffscreenView=new Sc(e,i,t)}Rc.prototype.update=function(){this._pickPositionCacheDirty=!0},Rc.prototype.getPickDepth=function(e,t){var i=e.view.pickDepths,a=i[t];return Object(o.default)(a)||(a=new Jd,i[t]=a),a};var Nc=new fi.a,Lc=new a.default,jc=new a.default,Vc=new z.default,Uc=new K.default;var zc=new Sn.a,Bc=new z.default;function Hc(e,t,i,r,n){var s=e.camera.frustum;return s instanceof $.a||s instanceof fi.a?function(e,t,i,r,n){var s=e.camera,l=s.frustum;Object(o.default)(l._offCenterFrustum)&&(l=l._offCenterFrustum);var u=2*(t.x-n.x)/n.width-1;u*=.5*(l.right-l.left);var d=2*(n.height-t.y-n.y)/n.height-1;d*=.5*(l.top-l.bottom);var f=K.default.clone(s.transform,Uc);s._setTransform(K.default.IDENTITY);var c=a.default.clone(s.position,Lc);a.default.multiplyByScalar(s.right,u,jc),a.default.add(jc,c,c),a.default.multiplyByScalar(s.up,d,jc),a.default.add(jc,c,c),s._setTransform(f),e.mode===N.a.SCENE2D&&a.default.fromElements(c.z,c.x,c.y,c);var h=l.getPixelDimensions(n.width,n.height,1,1,Vc),m=Nc;return m.right=.5*h.x,m.left=-m.right,m.top=.5*h.y,m.bottom=-m.top,m.near=l.near,m.far=l.far,m.computeCullingVolume(c,s.directionWC,s.upWC)}(e,t,0,0,n):function(e,t,i,a,r){var n=e.camera,o=n.frustum,s=o.near,l=Math.tan(.5*o.fovy),u=o.aspectRatio*l,d=(2*(t.x-r.x)/r.width-1)*s*u,f=(2*(r.height-t.y-r.y)/r.height-1)*s*l,c=o.getPixelDimensions(r.width,r.height,1,1,Bc),h=c.x*i*.5,m=c.y*a*.5,p=zc;return p.top=f+m,p.bottom=f-m,p.right=d+h,p.left=d-h,p.near=s,p.far=o.far,p.computeCullingVolume(n.positionWC,n.directionWC,n.upWC)}(e,t,i,r,n)}var kc=3,Wc=3,Gc=new an.default(0,0,kc,Wc),Yc=new z.default,Xc=new k.default(0,0,0,0);Rc.prototype.pick=function(e,t,i,a){kc=Object(n.default)(i,3),Wc=Object(n.default)(a,kc);var r=e.context,o=r.uniformState,s=e.frameState,l=e.defaultView;e.view=l;var u=l.viewport;u.x=0,u.y=0,u.width=r.drawingBufferWidth,u.height=r.drawingBufferHeight;var d=l.passState;d.viewport=an.default.clone(u,d.viewport);var f=ef.default.transformWindowToDrawingBuffer(e,t,Yc);e.jobScheduler.disableThisFrame(),e.updateFrameState(),s.cullingVolume=Hc(e,f,kc,Wc,u),s.invertClassification=!1,s.passes.pick=!0,s.tilesetPassState=Fc,o.update(s),e.updateEnvironment(),Gc.x=f.x-.5*(kc-1),Gc.y=e.drawingBufferHeight-f.y-.5*(Wc-1),Gc.width=kc,Gc.height=Wc,d=l.pickFramebuffer.begin(Gc,l.viewport),e.updateAndExecuteCommands(d,Xc),e.resolveFramebuffers(d);var c=l.pickFramebuffer.end(Gc);return r.endFrame(),c};var Qc=new An.a,qc=new Sn.a,Zc=new $.a,Kc=new fi.a;Rc.prototype.pickPositionWorldCoordinates=function(e,t,i){if(e.useDepthPicking){var r=t.toString();if(this._pickPositionCacheDirty)this._pickPositionCache={},this._pickPositionCacheDirty=!1;else if(this._pickPositionCache.hasOwnProperty(r))return a.default.clone(this._pickPositionCache[r],i);var n=e.frameState,s=e.context,l=s.uniformState,u=e.defaultView;e.view=u;var d=ef.default.transformWindowToDrawingBuffer(e,t,Yc);e.pickTranslucentDepth?function(e,t){var i=e.context,a=e.frameState,r=e.environmentState,n=e.defaultView;e.view=n;var o=n.viewport;o.x=0,o.y=0,o.width=i.drawingBufferWidth,o.height=i.drawingBufferHeight;var s=n.passState;s.viewport=an.default.clone(o,s.viewport),e.clearPasses(a.passes),a.passes.pick=!0,a.passes.depth=!0,a.cullingVolume=Hc(e,t,1,1,o),a.tilesetPassState=Fc,e.updateEnvironment(),r.renderTranslucentDepthForPick=!0,s=n.pickDepthFramebuffer.update(i,t,o),e.updateAndExecuteCommands(s,Xc),e.resolveFramebuffers(s),i.endFrame()}(e,d):(e.updateFrameState(),l.update(n),e.updateEnvironment()),d.y=e.drawingBufferHeight-d.y;var f,c=e.camera;f=Object(o.default)(c.frustum.fov)?c.frustum.clone(Qc):Object(o.default)(c.frustum.infiniteProjectionMatrix)?c.frustum.clone(qc):Object(o.default)(c.frustum.width)?c.frustum.clone(Zc):c.frustum.clone(Kc);for(var h=u.frustumCommandsList,m=h.length,p=0;p<m;++p){var _=this.getPickDepth(e,p).getDepth(s,d.x,d.y);if(_>0&&_<1){var g,v=h[p];return e.mode===N.a.SCENE2D?(g=c.position.z,c.position.z=g-v.near+1,f.far=Math.max(1,v.far-v.near),f.near=1,l.update(n),l.updateFrustum(f)):(f.near=v.near*(0!==p?e.opaqueFrustumNearOffset:1),f.far=v.far,l.updateFrustum(f)),i=ef.default.drawingBufferToWgs84Coordinates(e,d,_,i),e.mode===N.a.SCENE2D&&(c.position.z=g,l.update(n)),this._pickPositionCache[r]=a.default.clone(i),i}}this._pickPositionCache[r]=void 0}};var Jc=new v.default;function $c(e,t){var i,a,r=[],n=[],s=[],l=[];Object(o.default)(e)||(e=Number.MAX_VALUE);for(var u=t();Object(o.default)(u);){var d=u.object,f=u.position,c=u.exclude;if(Object(o.default)(f)&&!Object(o.default)(d)){r.push(u);break}if(!Object(o.default)(d)||!Object(o.default)(d.primitive))break;if(!c&&(r.push(u),0>=--e))break;var h=d.primitive,m=!1;"function"==typeof h.getGeometryInstanceAttributes&&Object(o.default)(d.id)&&(a=h.getGeometryInstanceAttributes(d.id),Object(o.default)(a)&&Object(o.default)(a.show)&&(m=!0,a.show=Wd.a.toValue(!1,a.show),s.push(a))),d instanceof Gd.a&&(m=!0,d.show=!1,l.push(d)),m||(h.show=!1,n.push(h)),u=t()}for(i=0;i<n.length;++i)n[i].show=!0;for(i=0;i<s.length;++i)(a=s[i]).show=Wd.a.toValue(!0,a.show);for(i=0;i<l.length;++i)l[i].show=!0;return r}Rc.prototype.pickPosition=function(e,t,i){if(i=this.pickPositionWorldCoordinates(e,t,i),Object(o.default)(i)&&e.mode!==N.a.SCENE3D){a.default.fromElements(i.y,i.z,i.x,i);var r=e.mapProjection,n=r.ellipsoid,s=r.unproject(i,Jc);n.cartographicToCartesian(s,i)}return i},Rc.prototype.drillPick=function(e,t,i,a,r){var n=this;return $c(i,(function(){var i=n.pick(e,t,a,r);if(Object(o.default)(i))return{object:i,position:void 0,exclude:!1}})).map((function(e){return e.object}))};var eh=new a.default,th=new a.default;function ih(e,t,i){this.ray=e,this.width=t,this.tilesets=i,this.ready=!1,this.deferred=I.default.defer(),this.promise=this.deferred.promise}function ah(e,t,i,r){var o=t.direction,s=a.default.mostOrthogonalAxis(o,eh),l=a.default.cross(o,s,eh),u=a.default.cross(o,l,th);return r.position=t.origin,r.direction=o,r.up=u,r.right=l,r.frustum.width=Object(n.default)(i,Dc),r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC)}function rh(e,t,i){var a=t.frameState,r=i.ray,n=i.width,o=i.tilesets,s=e._pickOffscreenView.camera,l=ah(0,r,n,s),u=Ic;u.camera=s,u.cullingVolume=l;for(var d=!0,f=o.length,c=0;c<f;++c){var h=o[c];h.show&&t.primitives.contains(h)&&(h.updateForPass(a,u),d=d&&u.ready)}return d&&i.deferred.resolve(),d}function nh(e,t,i,a,r,n){var s=[];if(function e(t,i,a){for(var r=t.length,n=0;n<r;++n){var s=t.get(n);s.show&&(Object(o.default)(s.isCesium3DTileset)?Object(o.default)(i)&&-1!==i.indexOf(s)||a.push(s):s instanceof $d.a&&e(s,i,a))}}(t.primitives,a,s),0===s.length)return I.default.resolve(n());var l=new ih(i,r,s);return e._mostDetailedRayPicks.push(l),l.promise.then((function(){return n()}))}function oh(e,t){return!(!Object(o.default)(e)||!Object(o.default)(t)||0===t.length)&&(t.indexOf(e)>-1||t.indexOf(e.primitive)>-1||t.indexOf(e.id)>-1)}function sh(e,t,i,a,r,n,s,l){return $c(a,(function(){return function(e,t,i,a,r,n,s){var l=t.context,u=l.uniformState,d=t.frameState,f=e._pickOffscreenView;t.view=f,ah(0,i,r,f.camera),Gc=an.default.clone(f.viewport,Gc);var c,h=f.pickFramebuffer.begin(Gc,f.viewport);t.jobScheduler.disableThisFrame(),t.updateFrameState(),d.invertClassification=!1,d.passes.pick=!0,d.passes.offscreen=!0,d.tilesetPassState=s?Mc:Fc,u.update(d),t.updateEnvironment(),t.updateAndExecuteCommands(h,Xc),t.resolveFramebuffers(h);var m=f.pickFramebuffer.end(l);if(t.context.depthTexture)for(var p=f.frustumCommandsList.length,_=0;_<p;++_){var g=e.getPickDepth(t,_).getDepth(l,0,0);if(g>0&&g<1){var v=f.frustumCommandsList[_],y=v.near*(0!==_?t.opaqueFrustumNearOffset:1),b=y+g*(v.far-y);c=O.default.getPoint(i,b);break}}if(t.view=t.defaultView,l.endFrame(),Object(o.default)(m)||Object(o.default)(c))return{object:m,position:c,exclude:!Object(o.default)(c)&&n||oh(m,a)}}(e,t,i,r,n,s,l)}))}function lh(e,t,i,a,r,n,o){var s=sh(e,t,i,1,a,r,n,o);if(s.length>0)return s[0]}function uh(e,t,i,a,r,n,o,s){return sh(e,t,i,a,r,n,o,s)}function dh(e,t){var i=I.default.defer();return t.then((function(t){var a=e.postRender.addEventListener((function(){i.resolve(t),a()}));e.requestRender()})).otherwise((function(e){i.reject(e)})),i.promise}Rc.prototype.updateMostDetailedRayPicks=function(e){for(var t=this._mostDetailedRayPicks,i=0;i<t.length;++i)rh(this,e,t[i])&&t.splice(i--,1)},Rc.prototype.pickFromRay=function(e,t,i,a){return lh(this,e,t,i,a,!1,!1)},Rc.prototype.drillPickFromRay=function(e,t,i,a,r){return uh(this,e,t,i,a,r,!1,!1)},Rc.prototype.pickFromRayMostDetailed=function(e,t,i,a){var r=this;return t=O.default.clone(t),i=Object(o.default)(i)?i.slice():i,dh(e,nh(r,e,t,i,a,(function(){return lh(r,e,t,i,a,!1,!0)})))},Rc.prototype.drillPickFromRayMostDetailed=function(e,t,i,a,r){var n=this;return t=O.default.clone(t),a=Object(o.default)(a)?a.slice():a,dh(e,nh(n,e,t,a,r,(function(){return uh(n,e,t,i,a,r,!1,!0)})))};var fh=new a.default,ch=new a.default,hh=new O.default,mh=new v.default;function ph(e,t){var i=e.globe,r=Object(o.default)(i)?i.ellipsoid:e.mapProjection.ellipsoid,n=kd.a._defaultMaxTerrainHeight,s=r.geodeticSurfaceNormalCartographic(t,ch),l=v.default.toCartesian(t,r,fh),u=hh;u.origin=l,u.direction=s;var d=new O.default;return O.default.getPoint(u,n,d.origin),a.default.negate(s,d.direction),d}function _h(e,t){var i=e.globe,a=Object(o.default)(i)?i.ellipsoid:e.mapProjection.ellipsoid;return ph(e,v.default.fromCartesian(t,a,mh))}function gh(e,t){var i=e.globe,a=Object(o.default)(i)?i.ellipsoid:e.mapProjection.ellipsoid;return v.default.fromCartesian(t,a,mh).height}function vh(e,t,i,a,r){var n=ph(t,i);return nh(e,t,n,a,r,(function(){var i=lh(e,t,n,a,r,!0,!0);if(Object(o.default)(i))return gh(t,i.position)}))}function yh(e,t,i,r,n,s){var l=_h(t,i);return nh(e,t,l,r,n,(function(){var i=lh(e,t,l,r,n,!0,!0);if(Object(o.default)(i))return a.default.clone(i.position,s)}))}Rc.prototype.sampleHeight=function(e,t,i,a){var r=lh(this,e,ph(e,t),i,a,!0,!1);if(Object(o.default)(r))return gh(e,r.position)},Rc.prototype.clampToHeight=function(e,t,i,r,n){var s=lh(this,e,_h(e,t),i,r,!0,!1);if(Object(o.default)(s))return a.default.clone(s.position,n)},Rc.prototype.sampleHeightMostDetailed=function(e,t,i,a){i=Object(o.default)(i)?i.slice():i;for(var r=t.length,n=new Array(r),s=0;s<r;++s)n[s]=vh(this,e,t[s],i,a);return dh(e,I.default.all(n).then((function(e){for(var i=e.length,a=0;a<i;++a)t[a].height=e[a];return t})))},Rc.prototype.clampToHeightMostDetailed=function(e,t,i,a){i=Object(o.default)(i)?i.slice():i;for(var r=t.length,n=new Array(r),s=0;s<r;++s)n[s]=yh(this,e,t[s],i,a,t[s]);return dh(e,I.default.all(n).then((function(e){for(var i=e.length,a=0;a<i;++a)t[a]=e[a];return t})))},Rc.prototype.destroy=function(){this._pickOffscreenView=this._pickOffscreenView&&this._pickOffscreenView.destroy()};var bh=Rc,wh=i(187),xh="#define SAMPLES 8\n\nuniform float delta;\nuniform float sigma;\nuniform float direction; // 0.0 for x direction, 1.0 for y direction\n\nuniform sampler2D colorTexture;\n\n#ifdef USE_STEP_SIZE\nuniform float stepSize;\n#else\nuniform vec2 step;\n#endif\n\nvarying vec2 v_textureCoordinates;\n\n//  Incremental Computation of the Gaussian:\n//  https://developer.nvidia.com/gpugems/GPUGems3/gpugems3_ch40.html\n\nvoid main()\n{\n    vec2 st = v_textureCoordinates;\n    vec2 dir = vec2(1.0 - direction, direction);\n\n#ifdef USE_STEP_SIZE\n    vec2 step = vec2(stepSize * (czm_pixelRatio / czm_viewport.zw));\n#else\n    vec2 step = step;\n#endif\n\n    vec3 g;\n    g.x = 1.0 / (sqrt(czm_twoPi) * sigma);\n    g.y = exp((-0.5 * delta * delta) / (sigma * sigma));\n    g.z = g.y * g.y;\n\n    vec4 result = texture2D(colorTexture, st) * g.x;\n    for (int i = 1; i < SAMPLES; ++i)\n    {\n        g.xy *= g.yz;\n\n        vec2 offset = float(i) * dir * step;\n        result += texture2D(colorTexture, st - offset) * g.x;\n        result += texture2D(colorTexture, st + offset) * g.x;\n    }\n\n    gl_FragColor = result;\n}\n";function Oh(){this._uniformMap=void 0,this._command=void 0,this._colorTexture=void 0,this._depthTexture=void 0,this._ready=!1,this._name="czm_autoexposure",this._logDepthChanged=void 0,this._useLogDepth=void 0,this._framebuffers=void 0,this._previousLuminance=void 0,this._commands=void 0,this._clearCommand=void 0,this._minMaxLuminance=new z.default,this.enabled=!0,this._enabled=!0,this.minimumLuminance=.1,this.maximumLuminance=10}function Ch(e){var t=e._framebuffers;if(Object(o.default)(t)){for(var i=t.length,a=0;a<i;++a)t[a].destroy();e._framebuffers=void 0,e._previousLuminance.destroy(),e._previousLuminance=void 0}}function Th(e){var t=e._commands;if(Object(o.default)(t)){for(var i=t.length,a=0;a<i;++a)t[a].shaderProgram.destroy();e._commands=void 0}}function Eh(e,t){var i;if(0===t)i={colorTexture:function(){return e._colorTexture},colorTextureDimensions:function(){return e._colorTexture.dimensions}};else{var a=e._framebuffers[t-1].getColorTexture(0);i={colorTexture:function(){return a},colorTextureDimensions:function(){return a.dimensions}}}return i.minMaxLuminance=function(){return e._minMaxLuminance},i.previousLuminance=function(){return e._previousLuminance.getColorTexture(0)},i}function Ph(e,t){var i="uniform sampler2D colorTexture; \nvarying vec2 v_textureCoordinates; \nfloat sampleTexture(vec2 offset) { \n";return i+=0===e?"    vec4 color = texture2D(colorTexture, v_textureCoordinates + offset); \n    return czm_luminance(color.rgb); \n":"    return texture2D(colorTexture, v_textureCoordinates + offset).r; \n",i+="}\n\n",i+="uniform vec2 colorTextureDimensions; \nuniform vec2 minMaxLuminance; \nuniform sampler2D previousLuminance; \nvoid main() { \n    float color = 0.0; \n    float xStep = 1.0 / colorTextureDimensions.x; \n    float yStep = 1.0 / colorTextureDimensions.y; \n    int count = 0; \n    for (int i = 0; i < 3; ++i) { \n        for (int j = 0; j < 3; ++j) { \n            vec2 offset; \n            offset.x = -xStep + float(i) * xStep; \n            offset.y = -yStep + float(j) * yStep; \n            if (offset.x < 0.0 || offset.x > 1.0 || offset.y < 0.0 || offset.y > 1.0) { \n                continue; \n            } \n            color += sampleTexture(offset); \n            ++count; \n        } \n    } \n    if (count > 0) { \n        color /= float(count); \n    } \n",e===t-1&&(i+="    float previous = texture2D(previousLuminance, vec2(0.5)).r; \n    color = clamp(color, minMaxLuminance.x, minMaxLuminance.y); \n    color = previous + (color - previous) / (60.0 * 1.5); \n    color = clamp(color, minMaxLuminance.x, minMaxLuminance.y); \n"),i+="    gl_FragColor = vec4(color); \n} \n"}Object.defineProperties(Oh.prototype,{ready:{get:function(){return this._ready}},name:{get:function(){return this._name}},outputTexture:{get:function(){var e=this._framebuffers;if(Object(o.default)(e))return e[e.length-1].getColorTexture(0)}}}),Oh.prototype.clear=function(e){var t=this._framebuffers;if(Object(o.default)(t)){var i=this._clearCommand;Object(o.default)(i)||(i=this._clearCommand=new Mn.a({color:new k.default(0,0,0,0),framebuffer:void 0}));for(var a=t.length,r=0;r<a;++r)i.framebuffer=t[r],i.execute(e)}},Oh.prototype.update=function(e){var t=e.drawingBufferWidth,i=e.drawingBufferHeight;t===this._width&&i===this._height||(this._width=t,this._height=i,function(e,t){Ch(e);for(var i=e._width,a=e._height,r=me.a.RGBA,n=t.halfFloatingPointTexture?ye.a.HALF_FLOAT:ye.a.FLOAT,o=Math.ceil(Math.log(Math.max(i,a))/Math.log(3)),s=new Array(o),l=0;l<o;++l)i=Math.max(Math.ceil(i/3),1),a=Math.max(Math.ceil(a/3),1),s[l]=new Rn.a({context:t,colorTextures:[new P.a({context:t,width:i,height:a,pixelFormat:r,pixelDatatype:n,sampler:be.a.NEAREST})]});var u=s[o-1].getColorTexture(0);e._previousLuminance=new Rn.a({context:t,colorTextures:[new P.a({context:t,width:u.width,height:u.height,pixelFormat:r,pixelDatatype:n,sampler:be.a.NEAREST})]}),e._framebuffers=s}(this,e),function(e,t){Th(e);for(var i=e._framebuffers,a=i.length,r=new Array(a),n=0;n<a;++n)r[n]=t.createViewportQuadCommand(Ph(n,a),{framebuffer:i[n],uniformMap:Eh(e,n)});e._commands=r}(this,e),this._ready||(this._ready=!0)),this._minMaxLuminance.x=this.minimumLuminance,this._minMaxLuminance.y=this.maximumLuminance;var a=this._framebuffers,r=a[a.length-1];a[a.length-1]=this._previousLuminance,this._commands[this._commands.length-1].framebuffer=this._previousLuminance,this._previousLuminance=r},Oh.prototype.execute=function(e,t){this._colorTexture=t;var i=this._commands;if(Object(o.default)(i))for(var a=i.length,r=0;r<a;++r)i[r].execute(e)},Oh.prototype.isDestroyed=function(){return!1},Oh.prototype.destroy=function(){return Ch(this),Th(this),Object(s.default)(this)};var Ah=Oh,Sh={NEAREST:0,LINEAR:1};function Dh(e){var t=(e=Object(n.default)(e,n.default.EMPTY_OBJECT)).fragmentShader,i=Object(n.default)(e.textureScale,1),a=Object(n.default)(e.pixelFormat,me.a.RGBA);this._fragmentShader=t,this._uniforms=e.uniforms,this._textureScale=i,this._forcePowerOfTwo=Object(n.default)(e.forcePowerOfTwo,!1),this._sampleMode=Object(n.default)(e.sampleMode,Sh.NEAREST),this._pixelFormat=a,this._pixelDatatype=Object(n.default)(e.pixelDatatype,ye.a.UNSIGNED_BYTE),this._clearColor=Object(n.default)(e.clearColor,k.default.BLACK),this._uniformMap=void 0,this._command=void 0,this._colorTexture=void 0,this._depthTexture=void 0,this._idTexture=void 0,this._actualUniforms={},this._dirtyUniforms=[],this._texturesToRelease=[],this._texturesToCreate=[],this._texturePromise=void 0;var r=new qn;r.scissorTest={enabled:!0,rectangle:Object(o.default)(e.scissorRectangle)?an.default.clone(e.scissorRectangle):new an.default},this._passState=r,this._ready=!1;var s=e.name;Object(o.default)(s)||(s=Object(rn.default)()),this._name=s,this._logDepthChanged=void 0,this._useLogDepth=void 0,this._selectedIdTexture=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0,this._textureCache=void 0,this._index=void 0,this.enabled=!0,this._enabled=!0}Object.defineProperties(Dh.prototype,{ready:{get:function(){return this._ready}},name:{get:function(){return this._name}},fragmentShader:{get:function(){return this._fragmentShader}},uniforms:{get:function(){return this._uniforms}},textureScale:{get:function(){return this._textureScale}},forcePowerOfTwo:{get:function(){return this._forcePowerOfTwo}},sampleMode:{get:function(){return this._sampleMode}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},clearColor:{get:function(){return this._clearColor}},scissorRectangle:{get:function(){return this._passState.scissorTest.rectangle}},outputTexture:{get:function(){if(Object(o.default)(this._textureCache)){var e=this._textureCache.getFramebuffer(this._name);if(Object(o.default)(e))return e.getColorTexture(0)}}},selected:{get:function(){return this._selected},set:function(e){this._selected=e}},parentSelected:{get:function(){return this._parentSelected},set:function(e){this._parentSelected=e}}});var Ih=/uniform\s+sampler2D\s+depthTexture/g;function Mh(e,t,i){var a=t[i];return("string"==typeof a||a instanceof HTMLCanvasElement||a instanceof HTMLImageElement||a instanceof HTMLVideoElement||a instanceof ImageData)&&e._dirtyUniforms.push(i),{get:function(){return t[i]},set:function(a){var r=t[i];t[i]=a;var n=e._actualUniforms,s=n[i];Object(o.default)(s)&&s!==r&&s instanceof P.a&&!Object(o.default)(e._textureCache.getStageByName(i))&&(e._texturesToRelease.push(s),delete n[i],delete n[i+"Dimensions"]),r instanceof P.a&&e._texturesToRelease.push(r),"string"==typeof a||a instanceof HTMLCanvasElement||a instanceof HTMLImageElement||a instanceof HTMLVideoElement||a instanceof ImageData?e._dirtyUniforms.push(i):n[i]=a}}}function Fh(e,t){return function(){var i=e._actualUniforms[t];return"function"==typeof i?i():i}}function Rh(e,t){return function(){var i=e[t]();if(Object(o.default)(i))return i.dimensions}}function Nh(e,t){return function(i){e._texturesToCreate.push({name:t,source:i})}}function Lh(e,t){return function(){return e._textureCache.getOutputTexture(t)}}function jh(e){Object(o.default)(e._command)&&(e._command.shaderProgram=e._command.shaderProgram&&e._command.shaderProgram.destroy(),e._command=void 0),e._selectedIdTexture=e._selectedIdTexture&&e._selectedIdTexture.destroy();var t=e._textureCache;if(Object(o.default)(t)){var i=e._uniforms,a=e._actualUniforms;for(var r in a)a.hasOwnProperty(r)&&a[r]instanceof P.a&&(Object(o.default)(t.getStageByName(i[r]))||a[r].destroy(),e._dirtyUniforms.push(r))}}Dh.prototype._isSupported=function(e){return!Ih.test(this._fragmentShader)||e.depthTexture},Dh.prototype.update=function(e,t){if(this.enabled===this._enabled||this.enabled||jh(this),this._enabled=this.enabled,this._enabled&&(this._logDepthChanged=t!==this._useLogDepth,this._useLogDepth=t,this._selectedDirty=function(e){var t=Object(o.default)(e._selected)?e._selected.length:0,i=Object(o.default)(e._parentSelected)?e._parentSelected:0,a=e._selected!==e._selectedShadow||t!==e._selectedLength;if(a=a||e._parentSelected!==e._parentSelectedShadow||i!==e._parentSelectedLength,Object(o.default)(e._selected)&&Object(o.default)(e._parentSelected)?e._combinedSelected=e._selected.concat(e._parentSelected):Object(o.default)(e._parentSelected)?e._combinedSelected=e._parentSelected:e._combinedSelected=e._selected,!a&&Object(o.default)(e._combinedSelected)){if(!Object(o.default)(e._combinedSelectedShadow))return!0;t=e._combinedSelected.length;for(var r=0;r<t;++r)if(e._combinedSelected[r]!==e._combinedSelectedShadow[r])return!0}return a}(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=Object(o.default)(this._selected)?this._selected.length:0,this._parentSelectedLength=Object(o.default)(this._parentSelected)?this._parentSelected.length:0,function(e,t){if(e._selectedDirty){e._selectedIdTexture=e._selectedIdTexture&&e._selectedIdTexture.destroy(),e._selectedIdTexture=void 0;var i=e._combinedSelected;if(Object(o.default)(i)){var a,r,n,s=0,l=i.length;for(a=0;a<l;++a)r=i[a],Object(o.default)(r.pickIds)?s+=r.pickIds.length:Object(o.default)(r.pickId)&&++s;if(0===l||0===s){var u=new Uint8Array(4);return u[0]=255,u[1]=255,u[2]=255,u[3]=255,void(e._selectedIdTexture=new P.a({context:t,pixelFormat:me.a.RGBA,pixelDatatype:ye.a.UNSIGNED_BYTE,source:{arrayBufferView:u,width:1,height:1},sampler:be.a.NEAREST}))}var d=0,f=new Uint8Array(4*s);for(a=0;a<l;++a)if(r=i[a],Object(o.default)(r.pickIds))for(var c=r.pickIds,h=c.length,m=0;m<h;++m)n=c[m].color,f[d]=k.default.floatToByte(n.red),f[d+1]=k.default.floatToByte(n.green),f[d+2]=k.default.floatToByte(n.blue),f[d+3]=k.default.floatToByte(n.alpha),d+=4;else Object(o.default)(r.pickId)&&(n=r.pickId.color,f[d]=k.default.floatToByte(n.red),f[d+1]=k.default.floatToByte(n.green),f[d+2]=k.default.floatToByte(n.blue),f[d+3]=k.default.floatToByte(n.alpha),d+=4);e._selectedIdTexture=new P.a({context:t,pixelFormat:me.a.RGBA,pixelDatatype:ye.a.UNSIGNED_BYTE,source:{arrayBufferView:f,width:s,height:1},sampler:be.a.NEAREST})}}}(this,e),function(e){if(!Object(o.default)(e._uniformMap)){var t={},i={},a=e._uniforms,r=e._actualUniforms;for(var n in a)if(a.hasOwnProperty(n)){"function"!=typeof a[n]?(t[n]=Fh(e,n),i[n]=Mh(e,a,n)):(t[n]=a[n],i[n]=a[n]),r[n]=a[n];var s=t[n]();("string"==typeof s||s instanceof P.a||s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement)&&(t[n+"Dimensions"]=Rh(t,n))}e._uniforms={},Object.defineProperties(e._uniforms,i),e._uniformMap=Object(G.default)(t,{colorTexture:function(){return e._colorTexture},colorTextureDimensions:function(){return e._colorTexture.dimensions},depthTexture:function(){return e._depthTexture},depthTextureDimensions:function(){return e._depthTexture.dimensions},czm_idTexture:function(){return e._idTexture},czm_selectedIdTexture:function(){return e._selectedIdTexture},czm_selectedIdTextureStep:function(){return 1/e._selectedIdTexture.width}})}}(this),function(e,t){var i,a,r,n=e._texturesToRelease,s=n.length;for(i=0;i<s;++i)a=(a=n[i])&&a.destroy();n.length=0;var l=e._texturesToCreate;for(s=l.length,i=0;i<s;++i){var u=l[i];r=u.name;var d=u.source;e._actualUniforms[r]=new P.a({context:t,source:d})}l.length=0;var f=e._dirtyUniforms;if(0!==f.length||Object(o.default)(e._texturePromise)){if(0!==f.length&&!Object(o.default)(e._texturePromise)){s=f.length;var c=e._uniforms,h=[];for(i=0;i<s;++i){var m=c[r=f[i]],p=e._textureCache.getStageByName(m);if(Object(o.default)(p))e._actualUniforms[r]=Lh(e,m);else if("string"==typeof m){var _=new T.default({url:m});h.push(_.fetchImage().then(Nh(e,r)))}else e._texturesToCreate.push({name:r,source:m})}f.length=0,h.length>0?(e._ready=!1,e._texturePromise=I.default.all(h).then((function(){e._ready=!0,e._texturePromise=void 0}))):e._ready=!0}}else e._ready=!0}(this,e),function(e,t){if(!Object(o.default)(e._command)||e._logDepthChanged||e._selectedDirty){var i=e._fragmentShader;if(Object(o.default)(e._selectedIdTexture))i="#define CZM_SELECTED_FEATURE \nuniform sampler2D czm_idTexture; \nuniform sampler2D czm_selectedIdTexture; \nuniform float czm_selectedIdTextureStep; \nvarying vec2 v_textureCoordinates; \nbool czm_selected(vec2 offset) \n{ \n    bool selected = false;\n    vec4 id = texture2D(czm_idTexture, v_textureCoordinates + offset); \n    for (int i = 0; i < "+e._selectedIdTexture.width+"; ++i) \n    { \n        vec4 selectedId = texture2D(czm_selectedIdTexture, vec2((float(i) + 0.5) * czm_selectedIdTextureStep, 0.5)); \n        if (all(equal(id, selectedId))) \n        { \n            return true; \n        } \n    } \n    return false; \n} \n\nbool czm_selected() \n{ \n    return czm_selected(vec2(0.0)); \n} \n\n"+(i=i.replace(/varying\s+vec2\s+v_textureCoordinates;/g,""));var a=new E.a({defines:[e._useLogDepth?"LOG_DEPTH":""],sources:[i]});e._command=t.createViewportQuadCommand(a,{uniformMap:e._uniformMap,owner:e})}}(this,e),function(e){var t,i;e._sampleMode===Sh.LINEAR?(t=xe.a.LINEAR,i=we.a.LINEAR):(t=xe.a.NEAREST,i=we.a.NEAREST);var a=e._sampler;Object(o.default)(a)&&a.minificationFilter===t&&a.magnificationFilter===i||(e._sampler=new be.a({wrapS:Oe.a.CLAMP_TO_EDGE,wrapT:Oe.a.CLAMP_TO_EDGE,minificationFilter:t,magnificationFilter:i}))}(this),this._selectedDirty=!1,this._ready)){var i=this._textureCache.getFramebuffer(this._name);if(this._command.framebuffer=i,Object(o.default)(i)){var a,r=i.getColorTexture(0);r.width===e.drawingBufferWidth&&r.height===e.drawingBufferHeight||(a=this._renderState,Object(o.default)(a)&&r.width===a.viewport.width&&r.height===a.viewport.height||(this._renderState=ue.a.fromCache({viewport:new an.default(0,0,r.width,r.height)}))),this._command.renderState=a}}},Dh.prototype.execute=function(e,t,i,a){if(Object(o.default)(this._command)&&Object(o.default)(this._command.framebuffer)&&this._ready&&this._enabled){this._colorTexture=t,this._depthTexture=i,this._idTexture=a,be.a.equals(this._colorTexture.sampler,this._sampler)||(this._colorTexture.sampler=this._sampler);var r=this.scissorRectangle.width>0&&this.scissorRectangle.height>0?this._passState:void 0;Object(o.default)(r)&&(r.context=e),this._command.execute(e,r)}},Dh.prototype.isDestroyed=function(){return!1},Dh.prototype.destroy=function(){return jh(this),Object(s.default)(this)};var Vh=Dh;function Uh(e){e=Object(n.default)(e,n.default.EMPTY_OBJECT),this._stages=e.stages,this._inputPreviousStageTexture=Object(n.default)(e.inputPreviousStageTexture,!0);var t=e.name;Object(o.default)(t)||(t=Object(rn.default)()),this._name=t,this._uniforms=e.uniforms,this._textureCache=void 0,this._index=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0}Object.defineProperties(Uh.prototype,{ready:{get:function(){for(var e=this._stages,t=e.length,i=0;i<t;++i)if(!e[i].ready)return!1;return!0}},name:{get:function(){return this._name}},enabled:{get:function(){return this._stages[0].enabled},set:function(e){for(var t=this._stages,i=t.length,a=0;a<i;++a)t[a].enabled=e}},uniforms:{get:function(){return this._uniforms}},inputPreviousStageTexture:{get:function(){return this._inputPreviousStageTexture}},length:{get:function(){return this._stages.length}},selected:{get:function(){return this._selected},set:function(e){this._selected=e}},parentSelected:{get:function(){return this._parentSelected},set:function(e){this._parentSelected=e}}}),Uh.prototype._isSupported=function(e){for(var t=this._stages,i=t.length,a=0;a<i;++a)if(!t[a]._isSupported(e))return!1;return!0},Uh.prototype.get=function(e){return this._stages[e]},Uh.prototype.update=function(e,t){this._selectedDirty=function(e){var t=Object(o.default)(e._selected)?e._selected.length:0,i=Object(o.default)(e._parentSelected)?e._parentSelected:0,a=e._selected!==e._selectedShadow||t!==e._selectedLength;if(a=a||e._parentSelected!==e._parentSelectedShadow||i!==e._parentSelectedLength,Object(o.default)(e._selected)&&Object(o.default)(e._parentSelected)?e._combinedSelected=e._selected.concat(e._parentSelected):Object(o.default)(e._parentSelected)?e._combinedSelected=e._parentSelected:e._combinedSelected=e._selected,!a&&Object(o.default)(e._combinedSelected)){if(!Object(o.default)(e._combinedSelectedShadow))return!0;t=e._combinedSelected.length;for(var r=0;r<t;++r)if(e._combinedSelected[r]!==e._combinedSelectedShadow[r])return!0}return a}(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=Object(o.default)(this._selected)?this._selected.length:0,this._parentSelectedLength=Object(o.default)(this._parentSelected)?this._parentSelected.length:0;for(var i=this._stages,a=i.length,r=0;r<a;++r){var n=i[r];this._selectedDirty&&(n.parentSelected=this._combinedSelected),n.update(e,t)}},Uh.prototype.isDestroyed=function(){return!1},Uh.prototype.destroy=function(){for(var e=this._stages,t=e.length,i=0;i<t;++i)e[i].destroy();return Object(s.default)(this)};var zh=Uh,Bh={};function Hh(e){var t="#define USE_STEP_SIZE\n"+xh,i=new Vh({name:e+"_x_direction",fragmentShader:t,uniforms:{delta:1,sigma:2,stepSize:1,direction:0},sampleMode:Sh.LINEAR}),a=new Vh({name:e+"_y_direction",fragmentShader:t,uniforms:{delta:1,sigma:2,stepSize:1,direction:1},sampleMode:Sh.LINEAR}),r={};return Object.defineProperties(r,{delta:{get:function(){return i.uniforms.delta},set:function(e){var t=i.uniforms,r=a.uniforms;t.delta=r.delta=e}},sigma:{get:function(){return i.uniforms.sigma},set:function(e){var t=i.uniforms,r=a.uniforms;t.sigma=r.sigma=e}},stepSize:{get:function(){return i.uniforms.stepSize},set:function(e){var t=i.uniforms,r=a.uniforms;t.stepSize=r.stepSize=e}}}),new zh({name:e,stages:[i,a],uniforms:r})}Bh.createBlurStage=function(){return Hh("czm_blur")},Bh.createDepthOfFieldStage=function(){var e=Hh("czm_depth_of_field_blur"),t=new Vh({name:"czm_depth_of_field_composite",fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D blurTexture;\nuniform sampler2D depthTexture;\nuniform float focalDistance;\n\nvarying vec2 v_textureCoordinates;\n\nvec4 toEye(vec2 uv, float depth)\n{\n   vec2 xy = vec2((uv.x * 2.0 - 1.0), ((1.0 - uv.y) * 2.0 - 1.0));\n   vec4 posInCamera = czm_inverseProjection * vec4(xy, depth, 1.0);\n   posInCamera = posInCamera / posInCamera.w;\n   return posInCamera;\n}\n\nfloat computeDepthBlur(float depth)\n{\n    float f;\n    if (depth < focalDistance)\n    {\n        f = (focalDistance - depth) / (focalDistance - czm_currentFrustum.x);\n    }\n    else\n    {\n        f = (depth - focalDistance) / (czm_currentFrustum.y - focalDistance);\n        f = pow(f, 0.1);\n    }\n    f *= f;\n    f = clamp(f, 0.0, 1.0);\n    return pow(f, 0.5);\n}\n\nvoid main(void)\n{\n    float depth = czm_readDepth(depthTexture, v_textureCoordinates);\n    vec4 posInCamera = toEye(v_textureCoordinates, depth);\n    float d = computeDepthBlur(-posInCamera.z);\n    gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), texture2D(blurTexture, v_textureCoordinates), d);\n}\n",uniforms:{focalDistance:5,blurTexture:e.name}}),i={};return Object.defineProperties(i,{focalDistance:{get:function(){return t.uniforms.focalDistance},set:function(e){t.uniforms.focalDistance=e}},delta:{get:function(){return e.uniforms.delta},set:function(t){e.uniforms.delta=t}},sigma:{get:function(){return e.uniforms.sigma},set:function(t){e.uniforms.sigma=t}},stepSize:{get:function(){return e.uniforms.stepSize},set:function(t){e.uniforms.stepSize=t}}}),new zh({name:"czm_depth_of_field",stages:[e,t],inputPreviousStageTexture:!1,uniforms:i})},Bh.isDepthOfFieldSupported=function(e){return e.context.depthTexture},Bh.createEdgeDetectionStage=function(){var e=Object(rn.default)();return new Vh({name:"czm_edge_detection_"+e,fragmentShader:"uniform sampler2D depthTexture;\nuniform float length;\nuniform vec4 color;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    float directions[3];\n    directions[0] = -1.0;\n    directions[1] = 0.0;\n    directions[2] = 1.0;\n\n    float scalars[3];\n    scalars[0] = 3.0;\n    scalars[1] = 10.0;\n    scalars[2] = 3.0;\n\n    float padx = czm_pixelRatio / czm_viewport.z;\n    float pady = czm_pixelRatio / czm_viewport.w;\n\n#ifdef CZM_SELECTED_FEATURE\n    bool selected = false;\n    for (int i = 0; i < 3; ++i)\n    {\n        float dir = directions[i];\n        selected = selected || czm_selected(vec2(-padx, dir * pady));\n        selected = selected || czm_selected(vec2(padx, dir * pady));\n        selected = selected || czm_selected(vec2(dir * padx, -pady));\n        selected = selected || czm_selected(vec2(dir * padx, pady));\n        if (selected)\n        {\n            break;\n        }\n    }\n    if (!selected)\n    {\n        gl_FragColor = vec4(color.rgb, 0.0);\n        return;\n    }\n#endif\n\n    float horizEdge = 0.0;\n    float vertEdge = 0.0;\n\n    for (int i = 0; i < 3; ++i)\n    {\n        float dir = directions[i];\n        float scale = scalars[i];\n\n        horizEdge -= texture2D(depthTexture, v_textureCoordinates + vec2(-padx, dir * pady)).x * scale;\n        horizEdge += texture2D(depthTexture, v_textureCoordinates + vec2(padx, dir * pady)).x * scale;\n\n        vertEdge -= texture2D(depthTexture, v_textureCoordinates + vec2(dir * padx, -pady)).x * scale;\n        vertEdge += texture2D(depthTexture, v_textureCoordinates + vec2(dir * padx, pady)).x * scale;\n    }\n\n    float len = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\n    gl_FragColor = vec4(color.rgb, len > length ? color.a : 0.0);\n}\n",uniforms:{length:.25,color:k.default.clone(k.default.BLACK)}})},Bh.isEdgeDetectionSupported=function(e){return e.context.depthTexture},Bh.createSilhouetteStage=function(e){var t=function(e){if(!Object(o.default)(e))return Bh.createEdgeDetectionStage();for(var t=new zh({name:"czm_edge_detection_multiple",stages:e,inputPreviousStageTexture:!1}),i={},a="",r="",n=0;n<e.length;++n)a+="uniform sampler2D edgeTexture"+n+"; \n",r+="        vec4 edge"+n+" = texture2D(edgeTexture"+n+", v_textureCoordinates); \n        if (edge"+n+".a > 0.0) \n        { \n            color = edge"+n+"; \n            break; \n        } \n",i["edgeTexture"+n]=e[n].name;var s=a+"varying vec2 v_textureCoordinates; \nvoid main() { \n    vec4 color = vec4(0.0); \n    for (int i = 0; i < "+e.length+"; i++) \n    { \n"+r+"    } \n    gl_FragColor = color; \n} \n",l=new Vh({name:"czm_edge_detection_combine",fragmentShader:s,uniforms:i});return new zh({name:"czm_edge_detection_composite",stages:[t,l]})}(e),i=new Vh({name:"czm_silhouette_color_edges",fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D silhouetteTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec4 silhouetteColor = texture2D(silhouetteTexture, v_textureCoordinates);\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    gl_FragColor = mix(color, silhouetteColor, silhouetteColor.a);\n}\n",uniforms:{silhouetteTexture:t.name}});return new zh({name:"czm_silhouette",stages:[t,i],inputPreviousStageTexture:!1,uniforms:t.uniforms})},Bh.isSilhouetteSupported=function(e){return e.context.depthTexture},Bh.createBloomStage=function(){var e=new Vh({name:"czm_bloom_contrast_bias",fragmentShader:"uniform sampler2D colorTexture;\nuniform float contrast;\nuniform float brightness;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec3 sceneColor = texture2D(colorTexture, v_textureCoordinates).xyz;\n    sceneColor = czm_RGBToHSB(sceneColor);\n    sceneColor.z += brightness;\n    sceneColor = czm_HSBToRGB(sceneColor);\n\n    float factor = (259.0 * (contrast + 255.0)) / (255.0 * (259.0 - contrast));\n    sceneColor = factor * (sceneColor - vec3(0.5)) + vec3(0.5);\n    gl_FragColor = vec4(sceneColor, 1.0);\n}\n",uniforms:{contrast:128,brightness:-.3}}),t=Hh("czm_bloom_blur"),i=new zh({name:"czm_bloom_contrast_bias_blur",stages:[e,t]}),a=new Vh({name:"czm_bloom_generate_composite",fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D bloomTexture;\nuniform bool glowOnly;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n\n#ifdef CZM_SELECTED_FEATURE\n    if (czm_selected()) {\n        gl_FragColor = color;\n        return;\n    }\n#endif\n\n    vec4 bloom = texture2D(bloomTexture, v_textureCoordinates);\n    gl_FragColor = glowOnly ? bloom : bloom + color;\n}\n",uniforms:{glowOnly:!1,bloomTexture:i.name}}),r={};return Object.defineProperties(r,{glowOnly:{get:function(){return a.uniforms.glowOnly},set:function(e){a.uniforms.glowOnly=e}},contrast:{get:function(){return e.uniforms.contrast},set:function(t){e.uniforms.contrast=t}},brightness:{get:function(){return e.uniforms.brightness},set:function(t){e.uniforms.brightness=t}},delta:{get:function(){return t.uniforms.delta},set:function(e){t.uniforms.delta=e}},sigma:{get:function(){return t.uniforms.sigma},set:function(e){t.uniforms.sigma=e}},stepSize:{get:function(){return t.uniforms.stepSize},set:function(e){t.uniforms.stepSize=e}}}),new zh({name:"czm_bloom",stages:[i,a],inputPreviousStageTexture:!1,uniforms:r})},Bh.createAmbientOcclusionStage=function(){var e=new Vh({name:"czm_ambient_occlusion_generate",fragmentShader:"uniform sampler2D randomTexture;\nuniform sampler2D depthTexture;\nuniform float intensity;\nuniform float bias;\nuniform float lengthCap;\nuniform float stepSize;\nuniform float frustumLength;\n\nvarying vec2 v_textureCoordinates;\n\nvec4 clipToEye(vec2 uv, float depth)\n{\n    vec2 xy = vec2((uv.x * 2.0 - 1.0), ((1.0 - uv.y) * 2.0 - 1.0));\n    vec4 posEC = czm_inverseProjection * vec4(xy, depth, 1.0);\n    posEC = posEC / posEC.w;\n    return posEC;\n}\n\n//Reconstruct Normal Without Edge Removation\nvec3 getNormalXEdge(vec3 posInCamera, float depthU, float depthD, float depthL, float depthR, vec2 pixelSize)\n{\n    vec4 posInCameraUp = clipToEye(v_textureCoordinates - vec2(0.0, pixelSize.y), depthU);\n    vec4 posInCameraDown = clipToEye(v_textureCoordinates + vec2(0.0, pixelSize.y), depthD);\n    vec4 posInCameraLeft = clipToEye(v_textureCoordinates - vec2(pixelSize.x, 0.0), depthL);\n    vec4 posInCameraRight = clipToEye(v_textureCoordinates + vec2(pixelSize.x, 0.0), depthR);\n\n    vec3 up = posInCamera.xyz - posInCameraUp.xyz;\n    vec3 down = posInCameraDown.xyz - posInCamera.xyz;\n    vec3 left = posInCamera.xyz - posInCameraLeft.xyz;\n    vec3 right = posInCameraRight.xyz - posInCamera.xyz;\n\n    vec3 DX = length(left) < length(right) ? left : right;\n    vec3 DY = length(up) < length(down) ? up : down;\n\n    return normalize(cross(DY, DX));\n}\n\nvoid main(void)\n{\n    float depth = czm_readDepth(depthTexture, v_textureCoordinates);\n    vec4 posInCamera = clipToEye(v_textureCoordinates, depth);\n\n    if (posInCamera.z > frustumLength)\n    {\n        gl_FragColor = vec4(1.0);\n        return;\n    }\n\n    vec2 pixelSize = czm_pixelRatio / czm_viewport.zw;\n    float depthU = czm_readDepth(depthTexture, v_textureCoordinates - vec2(0.0, pixelSize.y));\n    float depthD = czm_readDepth(depthTexture, v_textureCoordinates + vec2(0.0, pixelSize.y));\n    float depthL = czm_readDepth(depthTexture, v_textureCoordinates - vec2(pixelSize.x, 0.0));\n    float depthR = czm_readDepth(depthTexture, v_textureCoordinates + vec2(pixelSize.x, 0.0));\n    vec3 normalInCamera = getNormalXEdge(posInCamera.xyz, depthU, depthD, depthL, depthR, pixelSize);\n\n    float ao = 0.0;\n    vec2 sampleDirection = vec2(1.0, 0.0);\n    float gapAngle = 90.0 * czm_radiansPerDegree;\n\n    // RandomNoise\n    float randomVal = texture2D(randomTexture, v_textureCoordinates).x;\n\n    //Loop for each direction\n    for (int i = 0; i < 4; i++)\n    {\n        float newGapAngle = gapAngle * (float(i) + randomVal);\n        float cosVal = cos(newGapAngle);\n        float sinVal = sin(newGapAngle);\n\n        //Rotate Sampling Direction\n        vec2 rotatedSampleDirection = vec2(cosVal * sampleDirection.x - sinVal * sampleDirection.y, sinVal * sampleDirection.x + cosVal * sampleDirection.y);\n        float localAO = 0.0;\n        float localStepSize = stepSize;\n\n        //Loop for each step\n        for (int j = 0; j < 6; j++)\n        {\n            vec2 newCoords = v_textureCoordinates + rotatedSampleDirection * localStepSize * pixelSize;\n\n            //Exception Handling\n            if(newCoords.x > 1.0 || newCoords.y > 1.0 || newCoords.x < 0.0 || newCoords.y < 0.0)\n            {\n                break;\n            }\n\n            float stepDepthInfo = czm_readDepth(depthTexture, newCoords);\n            vec4 stepPosInCamera = clipToEye(newCoords, stepDepthInfo);\n            vec3 diffVec = stepPosInCamera.xyz - posInCamera.xyz;\n            float len = length(diffVec);\n\n            if (len > lengthCap)\n            {\n                break;\n            }\n\n            float dotVal = clamp(dot(normalInCamera, normalize(diffVec)), 0.0, 1.0 );\n            float weight = len / lengthCap;\n            weight = 1.0 - weight * weight;\n\n            if (dotVal < bias)\n            {\n                dotVal = 0.0;\n            }\n\n            localAO = max(localAO, dotVal * weight);\n            localStepSize += stepSize;\n        }\n        ao += localAO;\n    }\n\n    ao /= 4.0;\n    ao = 1.0 - clamp(ao, 0.0, 1.0);\n    ao = pow(ao, intensity);\n    gl_FragColor = vec4(vec3(ao), 1.0);\n}\n",uniforms:{intensity:3,bias:.1,lengthCap:.26,stepSize:1.95,frustumLength:1e3,randomTexture:void 0}}),t=Hh("czm_ambient_occlusion_blur");t.uniforms.stepSize=.86;var i=new zh({name:"czm_ambient_occlusion_generate_blur",stages:[e,t]}),a=new Vh({name:"czm_ambient_occlusion_composite",fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D ambientOcclusionTexture;\nuniform bool ambientOcclusionOnly;\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec3 color = texture2D(colorTexture, v_textureCoordinates).rgb;\n    vec3 ao = texture2D(ambientOcclusionTexture, v_textureCoordinates).rgb;\n    gl_FragColor.rgb = ambientOcclusionOnly ? ao : ao * color;\n}\n",uniforms:{ambientOcclusionOnly:!1,ambientOcclusionTexture:i.name}}),r={};return Object.defineProperties(r,{intensity:{get:function(){return e.uniforms.intensity},set:function(t){e.uniforms.intensity=t}},bias:{get:function(){return e.uniforms.bias},set:function(t){e.uniforms.bias=t}},lengthCap:{get:function(){return e.uniforms.lengthCap},set:function(t){e.uniforms.lengthCap=t}},stepSize:{get:function(){return e.uniforms.stepSize},set:function(t){e.uniforms.stepSize=t}},frustumLength:{get:function(){return e.uniforms.frustumLength},set:function(t){e.uniforms.frustumLength=t}},randomTexture:{get:function(){return e.uniforms.randomTexture},set:function(t){e.uniforms.randomTexture=t}},delta:{get:function(){return t.uniforms.delta},set:function(e){t.uniforms.delta=e}},sigma:{get:function(){return t.uniforms.sigma},set:function(e){t.uniforms.sigma=e}},blurStepSize:{get:function(){return t.uniforms.stepSize},set:function(e){t.uniforms.stepSize=e}},ambientOcclusionOnly:{get:function(){return a.uniforms.ambientOcclusionOnly},set:function(e){a.uniforms.ambientOcclusionOnly=e}}}),new zh({name:"czm_ambient_occlusion",stages:[i,a],inputPreviousStageTexture:!1,uniforms:r})},Bh.isAmbientOcclusionSupported=function(e){return e.context.depthTexture};Bh.createFXAAStage=function(){return new Vh({name:"czm_FXAA",fragmentShader:"#define FXAA_QUALITY_PRESET 39 \n/**\n * @license\n * Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *  * Redistributions of source code must retain the above copyright\n *    notice, this list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright\n *    notice, this list of conditions and the following disclaimer in the\n *    documentation and/or other materials provided with the distribution.\n *  * Neither the name of NVIDIA CORPORATION nor the names of its\n *    contributors may be used to endorse or promote products derived\n *    from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR\n * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n// NVIDIA GameWorks Graphics Samples GitHub link: https://github.com/NVIDIAGameWorks/GraphicsSamples\n// Original FXAA 3.11 shader link: https://github.com/NVIDIAGameWorks/GraphicsSamples/blob/master/samples/es3-kepler/FXAA/FXAA3_11.h\n\n// Steps used to integrate into Cesium:\n// * The following defines are set:\n//       #define FXAA_PC 1\n//       #define FXAA_WEBGL_1 1\n//       #define FXAA_GREEN_AS_LUMA 1\n//       #define FXAA_EARLY_EXIT 1\n//       #define FXAA_GLSL_120 1\n// * All other preprocessor directives besides the FXAA_QUALITY__P* directives were removed.\n// * Double underscores are invalid for preprocessor directives so replace them with a single underscore. Replace\n//   /FXAA_QUALITY__P(.*)/g with /FXAA_QUALITY__P$1/.\n// * There are no implicit conversions from ivec* to vec* so replace:\n//       #define FxaaInt2 ivec2\n//           with\n//       #define FxaaInt2 vec2\n// * The texture2DLod function is only available in vertex shaders so replace:\n//       #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\n//       #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\n//           with\n//       #define FxaaTexTop(t, p) texture2D(t, p)\n//       #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))\n// * FXAA_QUALITY_PRESET is prepended in the javascript code. We may want to expose that setting in the future.\n// * The following parameters to FxaaPixelShader are unused and can be removed:\n//       fxaaConsolePosPos\n//       fxaaConsoleRcpFrameOpt\n//       fxaaConsoleRcpFrameOpt2\n//       fxaaConsole360RcpFrameOpt2\n//       fxaaConsoleEdgeSharpness\n//       fxaaConsoleEdgeThreshold\n//       fxaaConsoleEdgeThresholdMi\n//       fxaaConsole360ConstDir\n\n//\n// Choose the quality preset.\n// This needs to be compiled into the shader as it effects code.\n// Best option to include multiple presets is to\n// in each shader define the preset, then include this file.\n//\n// OPTIONS\n// -----------------------------------------------------------------------\n// 10 to 15 - default medium dither (10=fastest, 15=highest quality)\n// 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\n// 39       - no dither, very expensive\n//\n// NOTES\n// -----------------------------------------------------------------------\n// 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\n// 13 = about same speed as FXAA 3.9 and better than 12\n// 23 = closest to FXAA 3.9 visually and performance wise\n//  _ = the lowest digit is directly related to performance\n// _  = the highest digit is directly related to style\n//\n//#define FXAA_QUALITY_PRESET 12\n\n\n#if (FXAA_QUALITY_PRESET == 10)\n    #define FXAA_QUALITY_PS 3\n    #define FXAA_QUALITY_P0 1.5\n    #define FXAA_QUALITY_P1 3.0\n    #define FXAA_QUALITY_P2 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 11)\n    #define FXAA_QUALITY_PS 4\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 3.0\n    #define FXAA_QUALITY_P3 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 12)\n    #define FXAA_QUALITY_PS 5\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 4.0\n    #define FXAA_QUALITY_P4 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 13)\n    #define FXAA_QUALITY_PS 6\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 4.0\n    #define FXAA_QUALITY_P5 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 14)\n    #define FXAA_QUALITY_PS 7\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 4.0\n    #define FXAA_QUALITY_P6 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 15)\n    #define FXAA_QUALITY_PS 8\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 4.0\n    #define FXAA_QUALITY_P7 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 20)\n    #define FXAA_QUALITY_PS 3\n    #define FXAA_QUALITY_P0 1.5\n    #define FXAA_QUALITY_P1 2.0\n    #define FXAA_QUALITY_P2 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 21)\n    #define FXAA_QUALITY_PS 4\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 22)\n    #define FXAA_QUALITY_PS 5\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 23)\n    #define FXAA_QUALITY_PS 6\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 24)\n    #define FXAA_QUALITY_PS 7\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 3.0\n    #define FXAA_QUALITY_P6 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 25)\n    #define FXAA_QUALITY_PS 8\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 4.0\n    #define FXAA_QUALITY_P7 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 26)\n    #define FXAA_QUALITY_PS 9\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 4.0\n    #define FXAA_QUALITY_P8 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 27)\n    #define FXAA_QUALITY_PS 10\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 4.0\n    #define FXAA_QUALITY_P9 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 28)\n    #define FXAA_QUALITY_PS 11\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 4.0\n    #define FXAA_QUALITY_P10 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 29)\n    #define FXAA_QUALITY_PS 12\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 2.0\n    #define FXAA_QUALITY_P10 4.0\n    #define FXAA_QUALITY_P11 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 39)\n    #define FXAA_QUALITY_PS 12\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.0\n    #define FXAA_QUALITY_P2 1.0\n    #define FXAA_QUALITY_P3 1.0\n    #define FXAA_QUALITY_P4 1.0\n    #define FXAA_QUALITY_P5 1.5\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 2.0\n    #define FXAA_QUALITY_P10 4.0\n    #define FXAA_QUALITY_P11 8.0\n#endif\n\n#define FxaaBool bool\n#define FxaaFloat float\n#define FxaaFloat2 vec2\n#define FxaaFloat3 vec3\n#define FxaaFloat4 vec4\n#define FxaaHalf float\n#define FxaaHalf2 vec2\n#define FxaaHalf3 vec3\n#define FxaaHalf4 vec4\n#define FxaaInt2 vec2\n#define FxaaTex sampler2D\n\n#define FxaaSat(x) clamp(x, 0.0, 1.0)\n#define FxaaTexTop(t, p) texture2D(t, p)\n#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))\n\nFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\n\nFxaaFloat4 FxaaPixelShader(\n    //\n    // Use noperspective interpolation here (turn off perspective interpolation).\n    // {xy} = center of pixel\n    FxaaFloat2 pos,\n    //\n    // Input color texture.\n    // {rgb_} = color in linear or perceptual color space\n    // if (FXAA_GREEN_AS_LUMA == 0)\n    //     {___a} = luma in perceptual color space (not linear)\n    FxaaTex tex,\n    //\n    // Only used on FXAA Quality.\n    // This must be from a constant/uniform.\n    // {x_} = 1.0/screenWidthInPixels\n    // {_y} = 1.0/screenHeightInPixels\n    FxaaFloat2 fxaaQualityRcpFrame,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITY_SUBPIX define.\n    // It is here now to allow easier tuning.\n    // Choose the amount of sub-pixel aliasing removal.\n    // This can effect sharpness.\n    //   1.00 - upper limit (softer)\n    //   0.75 - default amount of filtering\n    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)\n    //   0.25 - almost off\n    //   0.00 - completely off\n    FxaaFloat fxaaQualitySubpix,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.\n    // It is here now to allow easier tuning.\n    // The minimum amount of local contrast required to apply algorithm.\n    //   0.333 - too little (faster)\n    //   0.250 - low quality\n    //   0.166 - default\n    //   0.125 - high quality\n    //   0.063 - overkill (slower)\n    FxaaFloat fxaaQualityEdgeThreshold,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.\n    // It is here now to allow easier tuning.\n    // Trims the algorithm from processing darks.\n    //   0.0833 - upper limit (default, the start of visible unfiltered edges)\n    //   0.0625 - high quality (faster)\n    //   0.0312 - visible limit (slower)\n    // Special notes when using FXAA_GREEN_AS_LUMA,\n    //   Likely want to set this to zero.\n    //   As colors that are mostly not-green\n    //   will appear very dark in the green channel!\n    //   Tune by looking at mostly non-green content,\n    //   then start at zero and increase until aliasing is a problem.\n    FxaaFloat fxaaQualityEdgeThresholdMin\n) {\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posM;\n    posM.x = pos.x;\n    posM.y = pos.y;\n    FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n    #define lumaM rgbyM.y\n    FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n/*--------------------------------------------------------------------------*/\n    FxaaFloat maxSM = max(lumaS, lumaM);\n    FxaaFloat minSM = min(lumaS, lumaM);\n    FxaaFloat maxESM = max(lumaE, maxSM);\n    FxaaFloat minESM = min(lumaE, minSM);\n    FxaaFloat maxWN = max(lumaN, lumaW);\n    FxaaFloat minWN = min(lumaN, lumaW);\n    FxaaFloat rangeMax = max(maxWN, maxESM);\n    FxaaFloat rangeMin = min(minWN, minESM);\n    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n    FxaaFloat range = rangeMax - rangeMin;\n    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n    FxaaBool earlyExit = range < rangeMaxClamped;\n/*--------------------------------------------------------------------------*/\n    if(earlyExit)\n        return rgbyM;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNS = lumaN + lumaS;\n    FxaaFloat lumaWE = lumaW + lumaE;\n    FxaaFloat subpixRcpRange = 1.0/range;\n    FxaaFloat subpixNSWE = lumaNS + lumaWE;\n    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNESE = lumaNE + lumaSE;\n    FxaaFloat lumaNWNE = lumaNW + lumaNE;\n    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNWSW = lumaNW + lumaSW;\n    FxaaFloat lumaSWSE = lumaSW + lumaSE;\n    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\n    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\n    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;\n    FxaaBool horzSpan = edgeHorz >= edgeVert;\n    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n/*--------------------------------------------------------------------------*/\n    if(!horzSpan) lumaN = lumaW;\n    if(!horzSpan) lumaS = lumaE;\n    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat gradientN = lumaN - lumaM;\n    FxaaFloat gradientS = lumaS - lumaM;\n    FxaaFloat lumaNN = lumaN + lumaM;\n    FxaaFloat lumaSS = lumaS + lumaM;\n    FxaaBool pairN = abs(gradientN) >= abs(gradientS);\n    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));\n    if(pairN) lengthSign = -lengthSign;\n    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posB;\n    posB.x = posM.x;\n    posB.y = posM.y;\n    FxaaFloat2 offNP;\n    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n    if(!horzSpan) posB.x += lengthSign * 0.5;\n    if( horzSpan) posB.y += lengthSign * 0.5;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posN;\n    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\n    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\n    FxaaFloat2 posP;\n    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\n    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\n    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\n    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\n    FxaaFloat subpixE = subpixC * subpixC;\n    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\n/*--------------------------------------------------------------------------*/\n    if(!pairN) lumaNN = lumaSS;\n    FxaaFloat gradientScaled = gradient * 1.0/4.0;\n    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;\n    FxaaFloat subpixF = subpixD * subpixE;\n    FxaaBool lumaMLTZero = lumaMM < 0.0;\n/*--------------------------------------------------------------------------*/\n    lumaEndN -= lumaNN * 0.5;\n    lumaEndP -= lumaNN * 0.5;\n    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;\n    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;\n    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\n    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\n    FxaaBool doneNP = (!doneN) || (!doneP);\n    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\n    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\n/*--------------------------------------------------------------------------*/\n    if(doneNP) {\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n/*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PS > 3)\n        if(doneNP) {\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n/*--------------------------------------------------------------------------*/\n            #if (FXAA_QUALITY_PS > 4)\n            if(doneNP) {\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n/*--------------------------------------------------------------------------*/\n                #if (FXAA_QUALITY_PS > 5)\n                if(doneNP) {\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                    doneN = abs(lumaEndN) >= gradientScaled;\n                    doneP = abs(lumaEndP) >= gradientScaled;\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\n                    doneNP = (!doneN) || (!doneP);\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n/*--------------------------------------------------------------------------*/\n                    #if (FXAA_QUALITY_PS > 6)\n                    if(doneNP) {\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                        doneN = abs(lumaEndN) >= gradientScaled;\n                        doneP = abs(lumaEndP) >= gradientScaled;\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\n                        doneNP = (!doneN) || (!doneP);\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n/*--------------------------------------------------------------------------*/\n                        #if (FXAA_QUALITY_PS > 7)\n                        if(doneNP) {\n                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                            doneN = abs(lumaEndN) >= gradientScaled;\n                            doneP = abs(lumaEndP) >= gradientScaled;\n                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\n                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\n                            doneNP = (!doneN) || (!doneP);\n                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\n                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n/*--------------------------------------------------------------------------*/\n    #if (FXAA_QUALITY_PS > 8)\n    if(doneNP) {\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n/*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PS > 9)\n        if(doneNP) {\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n/*--------------------------------------------------------------------------*/\n            #if (FXAA_QUALITY_PS > 10)\n            if(doneNP) {\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n/*--------------------------------------------------------------------------*/\n                #if (FXAA_QUALITY_PS > 11)\n                if(doneNP) {\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                    doneN = abs(lumaEndN) >= gradientScaled;\n                    doneP = abs(lumaEndP) >= gradientScaled;\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\n                    doneNP = (!doneN) || (!doneP);\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n/*--------------------------------------------------------------------------*/\n                    #if (FXAA_QUALITY_PS > 12)\n                    if(doneNP) {\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                        doneN = abs(lumaEndN) >= gradientScaled;\n                        doneP = abs(lumaEndP) >= gradientScaled;\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\n                        doneNP = (!doneN) || (!doneP);\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n/*--------------------------------------------------------------------------*/\n                    }\n                    #endif\n/*--------------------------------------------------------------------------*/\n                }\n                #endif\n/*--------------------------------------------------------------------------*/\n            }\n            #endif\n/*--------------------------------------------------------------------------*/\n        }\n        #endif\n/*--------------------------------------------------------------------------*/\n    }\n    #endif\n/*--------------------------------------------------------------------------*/\n                        }\n                        #endif\n/*--------------------------------------------------------------------------*/\n                    }\n                    #endif\n/*--------------------------------------------------------------------------*/\n                }\n                #endif\n/*--------------------------------------------------------------------------*/\n            }\n            #endif\n/*--------------------------------------------------------------------------*/\n        }\n        #endif\n/*--------------------------------------------------------------------------*/\n    }\n/*--------------------------------------------------------------------------*/\n    FxaaFloat dstN = posM.x - posN.x;\n    FxaaFloat dstP = posP.x - posM.x;\n    if(!horzSpan) dstN = posM.y - posN.y;\n    if(!horzSpan) dstP = posP.y - posM.y;\n/*--------------------------------------------------------------------------*/\n    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n    FxaaFloat spanLength = (dstP + dstN);\n    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n    FxaaFloat spanLengthRcp = 1.0/spanLength;\n/*--------------------------------------------------------------------------*/\n    FxaaBool directionN = dstN < dstP;\n    FxaaFloat dst = min(dstN, dstP);\n    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\n    FxaaFloat subpixG = subpixF * subpixF;\n    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n    return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n}\n\nvarying vec2 v_textureCoordinates;\n\nuniform sampler2D colorTexture;\n\nconst float fxaaQualitySubpix = 0.5;\nconst float fxaaQualityEdgeThreshold = 0.125;\nconst float fxaaQualityEdgeThresholdMin = 0.0833;\n\nvoid main()\n{\n    vec2 fxaaQualityRcpFrame = vec2(1.0) / czm_viewport.zw;\n    vec4 color = FxaaPixelShader(\n        v_textureCoordinates,\n        colorTexture,\n        fxaaQualityRcpFrame,\n        fxaaQualitySubpix,\n        fxaaQualityEdgeThreshold,\n        fxaaQualityEdgeThresholdMin);\n    float alpha = texture2D(colorTexture, v_textureCoordinates).a;\n    gl_FragColor = vec4(color.rgb, alpha);\n}\n",sampleMode:Sh.LINEAR})},Bh.createAcesTonemappingStage=function(e){var t=e?"#define AUTO_EXPOSURE\n":"";return new Vh({name:"czm_aces",fragmentShader:t+="uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\n\nvoid main()\n{\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 color = fragmentColor.rgb;\n\n#ifdef AUTO_EXPOSURE\n    color /= texture2D(autoExposure, vec2(0.5)).r;\n#endif\n    color = czm_acesTonemapping(color);\n    color = czm_inverseGamma(color);\n\n    gl_FragColor = vec4(color, fragmentColor.a);\n}\n",uniforms:{autoExposure:void 0}})},Bh.createFilmicTonemappingStage=function(e){var t=e?"#define AUTO_EXPOSURE\n":"";return new Vh({name:"czm_filmic",fragmentShader:t+="uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\n\n// See slides 142 and 143:\n//     http://www.gdcvault.com/play/1012459/Uncharted_2__HDR_Lighting\n\nvoid main()\n{\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 color = fragmentColor.rgb;\n\n#ifdef AUTO_EXPOSURE\n    float exposure = texture2D(autoExposure, vec2(0.5)).r;\n    color /= exposure;\n#endif\n\n\tconst float A = 0.22; // shoulder strength\n\tconst float B = 0.30; // linear strength\n\tconst float C = 0.10; // linear angle\n\tconst float D = 0.20; // toe strength\n\tconst float E = 0.01; // toe numerator\n\tconst float F = 0.30; // toe denominator\n\n\tconst float white = 11.2; // linear white point value\n\n\tvec3 c = ((color * (A * color + C * B) + D * E) / (color * ( A * color + B) + D * F)) - E / F;\n\tfloat w = ((white * (A * white + C * B) + D * E) / (white * ( A * white + B) + D * F)) - E / F;\n\n\tc = czm_inverseGamma(c / w);\n\tgl_FragColor = vec4(c, fragmentColor.a);\n}\n",uniforms:{autoExposure:void 0}})},Bh.createReinhardTonemappingStage=function(e){var t=e?"#define AUTO_EXPOSURE\n":"";return new Vh({name:"czm_reinhard",fragmentShader:t+="uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\n\n// See equation 3:\n//    http://www.cs.utah.edu/~reinhard/cdrom/tonemap.pdf\n\nvoid main()\n{\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 color = fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\n    float exposure = texture2D(autoExposure, vec2(0.5)).r;\n    color /= exposure;\n#endif\n    color = color / (1.0 + color);\n    color = czm_inverseGamma(color);\n    gl_FragColor = vec4(color, fragmentColor.a);\n}\n",uniforms:{autoExposure:void 0}})},Bh.createModifiedReinhardTonemappingStage=function(e){var t=e?"#define AUTO_EXPOSURE\n":"";return new Vh({name:"czm_modified_reinhard",fragmentShader:t+="uniform sampler2D colorTexture;\nuniform vec3 white;\n\nvarying vec2 v_textureCoordinates;\n\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\n\n// See equation 4:\n//    http://www.cs.utah.edu/~reinhard/cdrom/tonemap.pdf\n\nvoid main()\n{\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 color = fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\n    float exposure = texture2D(autoExposure, vec2(0.5)).r;\n    color /= exposure;\n#endif\n    color = (color * (1.0 + color / white)) / (1.0 + color);\n    color = czm_inverseGamma(color);\n    gl_FragColor = vec4(color, fragmentColor.a);\n}\n",uniforms:{white:k.default.WHITE,autoExposure:void 0}})},Bh.createAutoExposureStage=function(){return new Ah},Bh.createBlackAndWhiteStage=function(){return new Vh({name:"czm_black_and_white",fragmentShader:"uniform sampler2D colorTexture;\nuniform float gradations;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\n#ifdef CZM_SELECTED_FEATURE\n    if (czm_selected()) {\n        gl_FragColor = vec4(rgb, 1.0);\n        return;\n    }\n#endif\n    float luminance = czm_luminance(rgb);\n    float darkness = luminance * gradations;\n    darkness = (darkness - fract(darkness)) / gradations;\n    gl_FragColor = vec4(vec3(darkness), 1.0);\n}\n",uniforms:{gradations:5}})},Bh.createBrightnessStage=function(){return new Vh({name:"czm_brightness",fragmentShader:"uniform sampler2D colorTexture;\nuniform float brightness;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\n    vec3 target = vec3(0.0);\n    gl_FragColor = vec4(mix(target, rgb, brightness), 1.0);\n}\n",uniforms:{brightness:.5}})},Bh.createNightVisionStage=function(){return new Vh({name:"czm_night_vision",fragmentShader:"uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy ,vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main(void)\n{\n    float noiseValue = rand(v_textureCoordinates + sin(czm_frameNumber)) * 0.1;\n    vec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\n    vec3 green = vec3(0.0, 1.0, 0.0);\n    gl_FragColor = vec4((noiseValue + rgb) * green, 1.0);\n}\n"})},Bh.createDepthViewStage=function(){return new Vh({name:"czm_depth_view",fragmentShader:"uniform sampler2D depthTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    float depth = czm_readDepth(depthTexture, v_textureCoordinates);\n    gl_FragColor = vec4(vec3(depth), 1.0);\n}\n"})},Bh.createLensFlareStage=function(){return new Vh({name:"czm_lens_flare",fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D dirtTexture;\nuniform sampler2D starTexture;\nuniform vec2 dirtTextureDimensions;\nuniform float distortion;\nuniform float ghostDispersal;\nuniform float haloWidth;\nuniform float dirtAmount;\nuniform float earthRadius;\nuniform float intensity;\n\nvarying vec2 v_textureCoordinates;\n\n// whether it is in space or not\n// 6500000.0 is empirical value\n#define DISTANCE_TO_SPACE 6500000.0\n\n// return ndc from world coordinate biased earthRadius\nvec4 getNDCFromWC(vec3 WC, float earthRadius)\n{\n    vec4 positionEC = czm_view * vec4(WC, 1.0);\n    positionEC = vec4(positionEC.x + earthRadius, positionEC.y, positionEC.z, 1.0);\n    vec4 positionWC = czm_eyeToWindowCoordinates(positionEC);\n    return czm_viewportOrthographic * vec4(positionWC.xy, -positionWC.z, 1.0);\n}\n\n// Check if current pixel is included Earth\n// if then mask it gradually\nfloat isInEarth(vec2 texcoord, vec2 sceneSize)\n{\n    vec2 NDC = texcoord * 2.0 - 1.0;\n    vec4 earthPosSC = getNDCFromWC(vec3(0.0), 0.0);\n    vec4 earthPosSCEdge = getNDCFromWC(vec3(0.0), earthRadius * 1.5);\n    NDC.xy -= earthPosSC.xy;\n\n    float X = abs(NDC.x) * sceneSize.x;\n    float Y = abs(NDC.y) * sceneSize.y;\n\n    return clamp(0.0, 1.0, max(sqrt(X * X + Y * Y) / max(abs(earthPosSCEdge.x * sceneSize.x), 1.0) - 0.8 , 0.0));\n}\n\n// For Chromatic effect\nvec4 textureDistorted(sampler2D tex, vec2 texcoord, vec2 direction, vec3 distortion, bool isSpace)\n{\n    vec2 sceneSize = czm_viewport.zw;\n    vec3 color;\n    if(isSpace)\n    {\n        color.r = isInEarth(texcoord + direction * distortion.r, sceneSize) * texture2D(tex, texcoord + direction * distortion.r).r;\n        color.g = isInEarth(texcoord + direction * distortion.g, sceneSize) * texture2D(tex, texcoord + direction * distortion.g).g;\n        color.b = isInEarth(texcoord + direction * distortion.b, sceneSize) * texture2D(tex, texcoord + direction * distortion.b).b;\n    }\n    else\n    {\n        color.r = texture2D(tex, texcoord + direction * distortion.r).r;\n        color.g = texture2D(tex, texcoord + direction * distortion.g).g;\n        color.b = texture2D(tex, texcoord + direction * distortion.b).b;\n    }\n    return vec4(clamp(color, 0.0, 1.0), 0.0);\n}\n\nvoid main(void)\n{\n    vec4 originalColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 rgb = originalColor.rgb;\n    bool isSpace = length(czm_viewerPositionWC.xyz) > DISTANCE_TO_SPACE;\n\n    // Sun position\n    vec4 sunPos = czm_morphTime == 1.0 ? vec4(czm_sunPositionWC, 1.0) : vec4(czm_sunPositionColumbusView.zxy, 1.0);\n    vec4 sunPositionEC = czm_view * sunPos;\n    vec4 sunPositionWC = czm_eyeToWindowCoordinates(sunPositionEC);\n    sunPos = czm_viewportOrthographic * vec4(sunPositionWC.xy, -sunPositionWC.z, 1.0);\n\n    // If sun is not in the screen space, use original color.\n    if(!isSpace || !((sunPos.x >= -1.1 && sunPos.x <= 1.1) && (sunPos.y >= -1.1 && sunPos.y <= 1.1)))\n    {\n        // Lens flare is disabled when not in space until #5932 is fixed.\n        //    https://github.com/CesiumGS/cesium/issues/5932\n        gl_FragColor = originalColor;\n        return;\n    }\n\n    vec2 texcoord = vec2(1.0) - v_textureCoordinates;\n    vec2 pixelSize = czm_pixelRatio / czm_viewport.zw;\n    vec2 invPixelSize = 1.0 / pixelSize;\n    vec3 distortionVec = pixelSize.x * vec3(-distortion, 0.0, distortion);\n\n    // ghost vector to image centre:\n    vec2 ghostVec = (vec2(0.5) - texcoord) * ghostDispersal;\n    vec3 direction = normalize(vec3(ghostVec, 0.0));\n\n    // sample ghosts:\n    vec4 result = vec4(0.0);\n    vec4 ghost = vec4(0.0);\n    for (int i = 0; i < 4; ++i)\n    {\n        vec2 offset = fract(texcoord + ghostVec * float(i));\n        // Only bright spots from the centre of the source image\n        ghost += textureDistorted(colorTexture, offset, direction.xy, distortionVec, isSpace);\n    }\n    result += ghost;\n\n    // sample halo\n    vec2 haloVec = normalize(ghostVec) * haloWidth;\n    float weightForHalo = length(vec2(0.5) - fract(texcoord + haloVec)) / length(vec2(0.5));\n    weightForHalo = pow(1.0 - weightForHalo, 5.0);\n\n    result += textureDistorted(colorTexture, texcoord + haloVec, direction.xy, distortionVec, isSpace) * weightForHalo * 1.5;\n\n    // dirt on lens\n    vec2 dirtTexCoords = (v_textureCoordinates * invPixelSize) / dirtTextureDimensions;\n    if (dirtTexCoords.x > 1.0)\n    {\n        dirtTexCoords.x = mod(floor(dirtTexCoords.x), 2.0) == 1.0 ? 1.0 - fract(dirtTexCoords.x) :  fract(dirtTexCoords.x);\n    }\n    if (dirtTexCoords.y > 1.0)\n    {\n        dirtTexCoords.y = mod(floor(dirtTexCoords.y), 2.0) == 1.0 ? 1.0 - fract(dirtTexCoords.y) :  fract(dirtTexCoords.y);\n    }\n    result += dirtAmount * texture2D(dirtTexture, dirtTexCoords);\n\n    // Rotating starburst texture's coordinate\n    // dot(czm_view[0].xyz, vec3(0.0, 0.0, 1.0)) + dot(czm_view[1].xyz, vec3(0.0, 1.0, 0.0))\n    float camrot = czm_view[0].z + czm_view[1].y;\n    float cosValue = cos(camrot);\n    float sinValue = sin(camrot);\n    mat3 rotation = mat3(\n        cosValue, -sinValue, 0.0,\n        sinValue, cosValue, 0.0,\n        0.0, 0.0, 1.0\n    );\n\n    vec3 st1 = vec3(v_textureCoordinates * 2.0 - vec2(1.0), 1.0);\n    vec3 st2 = vec3((rotation * st1).xy, 1.0);\n    vec3 st3 = st2 * 0.5 + vec3(0.5);\n    vec2 lensStarTexcoord = st3.xy;\n    float weightForLensFlare = length(vec3(sunPos.xy, 0.0));\n    float oneMinusWeightForLensFlare = max(1.0 - weightForLensFlare, 0.0);\n\n    if (!isSpace)\n    {\n        result *= oneMinusWeightForLensFlare * intensity * 0.2;\n    }\n    else\n    {\n        result *= oneMinusWeightForLensFlare * intensity;\n        result *= texture2D(starTexture, lensStarTexcoord) * pow(weightForLensFlare, 1.0) * max((1.0 - length(vec3(st1.xy, 0.0))), 0.0) * 2.0;\n    }\n\n    result += texture2D(colorTexture, v_textureCoordinates);\n\n    gl_FragColor = result;\n}\n",uniforms:{dirtTexture:i(1665),starTexture:i(1666),intensity:2,distortion:10,ghostDispersal:.4,haloWidth:.4,dirtAmount:.4,earthRadius:u.default.WGS84.maximumRadius}})};var kh=Bh;function Wh(e){this._collection=e,this._framebuffers=[],this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0,this._updateDependencies=!1}function Gh(e){for(;Object(o.default)(e.length);)e=e.get(e.length-1);return e.name}function Yh(e,t,i,a,r){if(!a.enabled||!a._isSupported(t))return r;var n=i[a.name]={};Object(o.default)(r)&&(n[Gh(e.getStageByName(r))]=!0);var s=a.uniforms;if(Object(o.default)(s))for(var l=Object.getOwnPropertyNames(s),u=l.length,d=0;d<u;++d){var f=s[l[d]];if("string"==typeof f){var c=e.getStageByName(f);Object(o.default)(c)&&(n[Gh(c)]=!0)}}return a.name}function Xh(e,t,i,a,r){if(Object(o.default)(a.enabled)&&!a.enabled||Object(o.default)(a._isSupported)&&!a._isSupported(t))return r;for(var n,s,l=r,u=!Object(o.default)(a.inputPreviousStageTexture)||a.inputPreviousStageTexture,d=r,f=a.length,c=0;c<f;++c){var h=a.get(c);d=Object(o.default)(h.length)?Xh(e,t,i,h,r):Yh(e,t,i,h,r),u&&(r=d)}if(u)for(n=1;n<f;++n)s=Gh(a.get(n)),Object(o.default)(i[s])||(i[s]={}),i[s][l]=!0;else for(n=1;n<f;++n)for(var m=i[s=Gh(a.get(n))],p=0;p<n;++p)m[Gh(a.get(p))]=!0;return d}function Qh(e,t,i){var a,r,n=e._collection.getStageByName(t),s=n._textureScale,l=n._forcePowerOfTwo,u=n._pixelFormat,d=n._pixelDatatype,f=n._clearColor,c=e._framebuffers,h=c.length;for(a=0;a<h;++a)if(s===(r=c[a]).textureScale&&l===r.forcePowerOfTwo&&u===r.pixelFormat&&d===r.pixelDatatype&&k.default.equals(f,r.clearColor)){for(var m=r.stages,p=m.length,_=!1,g=0;g<p;++g)if(i[m[g]]){_=!0;break}if(!_)break}return Object(o.default)(r)&&a<h?(r.stages.push(t),r):(r={textureScale:s,forcePowerOfTwo:l,pixelFormat:u,pixelDatatype:d,clearColor:f,stages:[t],buffer:void 0,clear:void 0},c.push(r),r)}function qh(e,t){var i=function(e,t){var i={};if(Object(o.default)(e.ambientOcclusion)){var a=e.ambientOcclusion,r=e.bloom,n=e._tonemapping,s=e.fxaa,l=Xh(e,t,i,a,void 0);l=Yh(e,t,i,n,l=Xh(e,t,i,r,l)),Yh(e,t,i,s,l=Xh(e,t,i,e,l))}else Xh(e,t,i,e,void 0);return i}(e._collection,t);for(var a in i)i.hasOwnProperty(a)&&(e._stageNameToFramebuffer[a]=Qh(e,a,i[a]))}function Zh(e){for(var t=e._framebuffers,i=t.length,a=0;a<i;++a){var r=t[a];r.buffer=r.buffer&&r.buffer.destroy(),r.buffer=void 0}}Wh.prototype.updateDependencies=function(){this._updateDependencies=!0},Wh.prototype.update=function(e){var t=this._collection,i=this._updateDependencies,a=Object(o.default)(t.ambientOcclusion)&&t.ambientOcclusion.enabled&&t.ambientOcclusion._isSupported(e),r=Object(o.default)(t.bloom)&&t.bloom.enabled&&t.bloom._isSupported(e),n=Object(o.default)(t._tonemapping)&&t._tonemapping.enabled&&t._tonemapping._isSupported(e),s=Object(o.default)(t.fxaa)&&t.fxaa.enabled&&t.fxaa._isSupported(e),l=!Object(o.default)(t._activeStages)||t._activeStages.length>0||a||r||n||s;if((i||!l&&this._framebuffers.length>0)&&(Zh(this),this._framebuffers.length=0,this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0),i||l){0===this._framebuffers.length&&qh(this,e);var u=e.drawingBufferWidth,d=e.drawingBufferHeight,f=this._width!==u||this._height!==d;(i||f)&&(this._width=u,this._height=d,this._updateDependencies=!1,Zh(this),function(e,t){for(var i=e._width,a=e._height,r=e._framebuffers,n=r.length,o=0;o<n;++o){var s=r[o],l=s.textureScale,u=Math.ceil(i*l),d=Math.ceil(a*l),f=Math.min(u,d);s.forcePowerOfTwo&&(Z.default.isPowerOfTwo(f)||(f=Z.default.nextPowerOfTwo(f)),u=f,d=f),s.buffer=new Rn.a({context:t,colorTextures:[new P.a({context:t,width:u,height:d,pixelFormat:s.pixelFormat,pixelDatatype:s.pixelDatatype})]}),s.clear=new Mn.a({color:s.clearColor,framebuffer:s.buffer})}}(this,e))}},Wh.prototype.clear=function(e){for(var t=this._framebuffers,i=0;i<t.length;++i)t[i].clear.execute(e)},Wh.prototype.getStageByName=function(e){return this._collection.getStageByName(e)},Wh.prototype.getOutputTexture=function(e){return this._collection.getOutputTexture(e)},Wh.prototype.getFramebuffer=function(e){var t=this._stageNameToFramebuffer[e];if(Object(o.default)(t))return t.buffer},Wh.prototype.isDestroyed=function(){return!1},Wh.prototype.destroy=function(){return Zh(this),Object(s.default)(this)};var Kh=Wh,Jh={REINHARD:0,MODIFIED_REINHARD:1,FILMIC:2,ACES:3,validate:function(e){return e===Jh.REINHARD||e===Jh.MODIFIED_REINHARD||e===Jh.FILMIC||e===Jh.ACES}},$h=Object.freeze(Jh),em=[];function tm(){var e=kh.createFXAAStage(),t=kh.createAmbientOcclusionStage(),i=kh.createBloomStage();this._autoExposureEnabled=!1,this._autoExposure=kh.createAutoExposureStage(),this._tonemapping=void 0,this._tonemapper=void 0,this.tonemapper=$h.ACES;var a=this._tonemapping;e.enabled=!1,t.enabled=!1,i.enabled=!1,a.enabled=!1;var r=new Kh(this),n={},s=em;for(s.push(e,t,i,a);s.length>0;){var l=s.pop();n[l.name]=l,l._textureCache=r;var u=l.length;if(Object(o.default)(u))for(var d=0;d<u;++d)s.push(l.get(d))}this._stages=[],this._activeStages=[],this._previousActiveStages=[],this._randomTexture=void 0;var f=this;t.uniforms.randomTexture=function(){return f._randomTexture},this._ao=t,this._bloom=i,this._fxaa=e,this._lastLength=void 0,this._aoEnabled=void 0,this._bloomEnabled=void 0,this._tonemappingEnabled=void 0,this._fxaaEnabled=void 0,this._stagesRemoved=!1,this._textureCacheDirty=!1,this._stageNames=n,this._textureCache=r}function im(e){if(e._stagesRemoved){e._stagesRemoved=!1;for(var t=[],i=e._stages,a=i.length,r=0,n=0;r<a;++r){var o=i[r];o&&(o._index=n++,t.push(o))}e._stages=t}}function am(e){for(;Object(o.default)(e.length);)e=e.get(e.length-1);return e.outputTexture}function rm(e,t,i,a,r){if(Object(o.default)(e.execute))e.execute(t,i,a,r);else{var n,s=e.length;if(e.inputPreviousStageTexture)for(rm(e.get(0),t,i,a,r),n=1;n<s;++n)rm(e.get(n),t,am(e.get(n-1)),a,r);else for(n=0;n<s;++n)rm(e.get(n),t,i,a,r)}}Object.defineProperties(tm.prototype,{ready:{get:function(){for(var e=!1,t=this._stages,i=t.length-1;i>=0;--i){var a=t[i];e=e||a.ready&&a.enabled}var r=this._fxaa,n=this._ao,o=this._bloom,s=this._tonemapping;return e=(e=(e=(e=e||r.ready&&r.enabled)||n.ready&&n.enabled)||o.ready&&o.enabled)||s.ready&&s.enabled}},fxaa:{get:function(){return this._fxaa}},ambientOcclusion:{get:function(){return this._ao}},bloom:{get:function(){return this._bloom}},length:{get:function(){return im(this),this._stages.length}},outputTexture:{get:function(){var e=this._fxaa;if(e.enabled&&e.ready)return this.getOutputTexture(e.name);for(var t=this._stages,i=t.length-1;i>=0;--i){var a=t[i];if(Object(o.default)(a)&&a.ready&&a.enabled)return this.getOutputTexture(a.name)}var r=this._tonemapping;if(r.enabled&&r.ready)return this.getOutputTexture(r.name);var n=this._bloom;if(n.enabled&&n.ready)return this.getOutputTexture(n.name);var s=this._ao;return s.enabled&&s.ready?this.getOutputTexture(s.name):void 0}},hasSelected:{get:function(){for(var e=Object(wh.a)(this._stages);e.length>0;){var t=e.pop();if(Object(o.default)(t)){if(Object(o.default)(t.selected))return!0;var i=t.length;if(Object(o.default)(i))for(var a=0;a<i;++a)e.push(t.get(a))}}return!1}},tonemapper:{get:function(){return this._tonemapper},set:function(e){if(this._tonemapper!==e){Object(o.default)(this._tonemapping)&&(delete this._stageNames[this._tonemapping.name],this._tonemapping.destroy());var t,i=this._autoExposureEnabled;switch(e){case $h.REINHARD:t=kh.createReinhardTonemappingStage(i);break;case $h.MODIFIED_REINHARD:t=kh.createModifiedReinhardTonemappingStage(i);break;case $h.FILMIC:t=kh.createFilmicTonemappingStage(i);break;default:t=kh.createAcesTonemappingStage(i)}if(i){var a=this._autoExposure;t.uniforms.autoExposure=function(){return a.outputTexture}}this._tonemapper=e,this._tonemapping=t,Object(o.default)(this._stageNames)&&(this._stageNames[t.name]=t,t._textureCache=this._textureCache),this._textureCacheDirty=!0}}}}),tm.prototype.add=function(e){var t=this._stageNames,i=em;for(i.push(e);i.length>0;){var a=i.pop();t[a.name]=a,a._textureCache=this._textureCache;var r=a.length;if(Object(o.default)(r))for(var n=0;n<r;++n)i.push(a.get(n))}var s=this._stages;return e._index=s.length,s.push(e),this._textureCacheDirty=!0,e},tm.prototype.remove=function(e){if(!this.contains(e))return!1;var t=this._stageNames,i=em;for(i.push(e);i.length>0;){var a=i.pop();delete t[a.name];var r=a.length;if(Object(o.default)(r))for(var n=0;n<r;++n)i.push(a.get(n))}return this._stages[e._index]=void 0,this._stagesRemoved=!0,this._textureCacheDirty=!0,e._index=void 0,e._textureCache=void 0,e.destroy(),!0},tm.prototype.contains=function(e){return Object(o.default)(e)&&Object(o.default)(e._index)&&e._textureCache===this._textureCache},tm.prototype.get=function(e){return im(this),this._stages[e]},tm.prototype.removeAll=function(){for(var e=this._stages,t=e.length,i=0;i<t;++i)this.remove(e[i]);e.length=0},tm.prototype.getStageByName=function(e){return this._stageNames[e]},tm.prototype.update=function(e,t,i){im(this);var a=this._activeStages,r=this._activeStages=this._previousActiveStages;this._previousActiveStages=a;var n,s,l=this._stages,u=r.length=l.length,d=0;for(n=0;n<u;++n)(s=l[n]).ready&&s.enabled&&s._isSupported(e)&&(r[d++]=s);r.length=d;var f=d!==a.length;if(!f)for(n=0;n<d;++n)if(r[n]!==a[n]){f=!0;break}var c=this._ao,h=this._bloom,m=this._autoExposure,p=this._tonemapping,_=this._fxaa;p.enabled=i;var g=c.enabled&&c._isSupported(e),v=h.enabled&&h._isSupported(e),y=p.enabled&&p._isSupported(e),b=_.enabled&&_._isSupported(e);if((f||this._textureCacheDirty||d!==this._lastLength||g!==this._aoEnabled||v!==this._bloomEnabled||y!==this._tonemappingEnabled||b!==this._fxaaEnabled)&&(this._textureCache.updateDependencies(),this._lastLength=d,this._aoEnabled=g,this._bloomEnabled=v,this._tonemappingEnabled=y,this._fxaaEnabled=b,this._textureCacheDirty=!1),Object(o.default)(this._randomTexture)&&!g&&(this._randomTexture.destroy(),this._randomTexture=void 0),!Object(o.default)(this._randomTexture)&&g){u=196608;var w=new Uint8Array(u);for(n=0;n<u;n+=3)w[n]=Math.floor(255*Math.random());this._randomTexture=new P.a({context:e,pixelFormat:me.a.RGB,pixelDatatype:ye.a.UNSIGNED_BYTE,source:{arrayBufferView:w,width:256,height:256},sampler:new be.a({wrapS:Oe.a.REPEAT,wrapT:Oe.a.REPEAT,minificationFilter:xe.a.NEAREST,magnificationFilter:we.a.NEAREST})})}for(this._textureCache.update(e),_.update(e,t),c.update(e,t),h.update(e,t),p.update(e,t),this._autoExposureEnabled&&m.update(e,t),u=l.length,n=0;n<u;++n)l[n].update(e,t)},tm.prototype.clear=function(e){this._textureCache.clear(e),this._autoExposureEnabled&&this._autoExposure.clear(e)},tm.prototype.getOutputTexture=function(e){var t=this.getStageByName(e);if(Object(o.default)(t))return am(t)},tm.prototype.execute=function(e,t,i,a){var r=this._activeStages,n=r.length,o=this._fxaa,s=this._ao,l=this._bloom,u=this._autoExposure,d=this._tonemapping,f=s.enabled&&s._isSupported(e),c=l.enabled&&l._isSupported(e),h=this._autoExposureEnabled,m=d.enabled&&d._isSupported(e),p=o.enabled&&o._isSupported(e);if(p||f||c||m||0!==n){var _=t;f&&s.ready&&(rm(s,e,_,i,a),_=am(s)),c&&l.ready&&(rm(l,e,_,i,a),_=am(l)),h&&u.ready&&rm(u,e,_,i,a),m&&d.ready&&(rm(d,e,_,i,a),_=am(d));var g=_;if(n>0){rm(r[0],e,_,i,a);for(var v=1;v<n;++v)rm(r[v],e,am(r[v-1]),i,a);g=am(r[n-1])}p&&o.ready&&rm(o,e,g,i,a)}},tm.prototype.copy=function(e,t){if(!Object(o.default)(this._copyColorCommand)){var i=this;this._copyColorCommand=e.createViewportQuadCommand(gd,{uniformMap:{colorTexture:function(){return i.outputTexture}},owner:this})}this._copyColorCommand.framebuffer=t,this._copyColorCommand.execute(e)},tm.prototype.isDestroyed=function(){return!1},tm.prototype.destroy=function(){return this._fxaa.destroy(),this._ao.destroy(),this._bloom.destroy(),this._autoExposure.destroy(),this._tonemapping.destroy(),this.removeAll(),this._textureCache=this._textureCache&&this._textureCache.destroy(),Object(s.default)(this)};var nm=tm,om=i(213);function sm(e){this._scene=e,this._currentTweens=[],this._morphHandler=void 0,this._morphCancelled=!1,this._completeMorph=void 0,this._morphToOrthographic=!1}sm.prototype.completeMorph=function(){Object(o.default)(this._completeMorph)&&this._completeMorph()},sm.prototype.morphTo2D=function(e,t){Object(o.default)(this._completeMorph)&&this._completeMorph();var i=this._scene;this._previousMode=i.mode,this._morphToOrthographic=i.camera.frustum instanceof $.a,this._previousMode!==N.a.SCENE2D&&this._previousMode!==N.a.MORPHING&&(this._scene.morphStart.raiseEvent(this,this._previousMode,N.a.SCENE2D,!0),i._mode=N.a.MORPHING,i.camera._setTransform(K.default.IDENTITY),this._previousMode===N.a.COLUMBUS_VIEW?function(e,t){t*=.5;var i=e._scene,r=i.camera,n=a.default.clone(r.position,Wm),s=a.default.clone(r.direction,Gm),l=a.default.clone(r.up,Ym),u=a.default.negate(a.default.UNIT_Z,Qm),d=a.default.clone(a.default.UNIT_Y,qm),f=Xm;if(t>0)a.default.clone(a.default.ZERO,Xm),f.z=5*i.mapProjection.ellipsoid.maximumRadius;else{a.default.clone(n,Xm);var c=Km;K.default.multiplyByPoint(Ql.TRANSFORM_2D,n,c.origin),K.default.multiplyByPointAsVector(Ql.TRANSFORM_2D,s,c.direction);var h=i.globe;if(Object(o.default)(h)){var m=h.pickWorldCoordinates(c,i,Jm);Object(o.default)(m)&&(K.default.multiplyByPoint(Ql.TRANSFORM_2D_INVERSE,m,f),f.z+=a.default.distance(n,f))}}var p=Zm;p.right=.5*f.z,p.left=-p.right,p.top=p.right*(i.drawingBufferHeight/i.drawingBufferWidth),p.bottom=-p.top;var _=$m;_.position=f,_.direction=u,_.up=d,_.frustum=p;var g=fp(_);function v(e,t){e.position.z=t}xm(e,g);var y=i.tweens.add({duration:t,easingFunction:jo.default.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){Hm(n,f,e.time,r.position),Hm(s,u,e.time,r.direction),Hm(l,d,e.time,r.up),a.default.cross(r.direction,r.up,r.right),a.default.normalize(r.right,r.right),r._adjustOrthographicFrustum(!0)},complete:function(){km(e,t,_,v,g)}});e._currentTweens.push(y)}(this,e):function(e,t,i){t*=.5;var r=e._scene,n=r.camera,s=tp;if(t>0)a.default.clone(a.default.ZERO,s.position),s.position.z=5*i.maximumRadius,a.default.negate(a.default.UNIT_Z,s.direction),a.default.clone(a.default.UNIT_Y,s.up);else{i.cartesianToCartographic(n.positionWC,ep),r.mapProjection.project(ep,s.position),a.default.negate(a.default.UNIT_Z,s.direction),a.default.clone(a.default.UNIT_Y,s.up);var l=rp;a.default.clone(s.position2D,l.origin);var u=a.default.clone(n.directionWC,l.direction),d=i.scaleToGeodeticSurface(n.positionWC,op),f=Ur.default.eastNorthUpToFixedFrame(d,i,np);K.default.inverseTransformation(f,f),K.default.multiplyByPointAsVector(f,u,u),K.default.multiplyByPointAsVector(Ql.TRANSFORM_2D,u,u);var c=r.globe;if(Object(o.default)(c)){var h=c.pickWorldCoordinates(l,r,ap);if(Object(o.default)(h)){var m=a.default.distance(s.position2D,h);h.x+=m,a.default.clone(h,s.position2D)}}}function p(e,t){e.position.x=t}K.default.multiplyByPoint(Ql.TRANSFORM_2D,s.position,s.position2D),K.default.multiplyByPointAsVector(Ql.TRANSFORM_2D,s.direction,s.direction2D),K.default.multiplyByPointAsVector(Ql.TRANSFORM_2D,s.up,s.up2D);var _=s.frustum;_.right=.5*s.position.z,_.left=-_.right,_.top=_.right*(r.drawingBufferHeight/r.drawingBufferWidth),_.bottom=-_.top;var g=ip;K.default.multiplyByPoint(Ql.TRANSFORM_2D_INVERSE,s.position2D,g.position),a.default.clone(s.direction,g.direction),a.default.clone(s.up,g.up),g.frustum=_;var v=fp(g);xm(e,v),lp(e,t,s,(function(){km(e,t,s,p,v)}))}(this,e,t),0===e&&Object(o.default)(this._completeMorph)&&this._completeMorph())};var lm=new a.default,um=new a.default,dm=new a.default,fm=new a.default,cm=new a.default,hm=new a.default,mm=new a.default,pm=new v.default,_m=new K.default,gm=new An.a,vm=new $.a,ym={position:void 0,direction:void 0,up:void 0,position2D:void 0,direction2D:void 0,up2D:void 0,frustum:void 0};sm.prototype.morphToColumbusView=function(e,t){Object(o.default)(this._completeMorph)&&this._completeMorph();var i=this._scene;if(this._previousMode=i.mode,this._previousMode!==N.a.COLUMBUS_VIEW&&this._previousMode!==N.a.MORPHING){this._scene.morphStart.raiseEvent(this,this._previousMode,N.a.COLUMBUS_VIEW,!0),i.camera._setTransform(K.default.IDENTITY);var r,n=lm,s=um,l=dm;if(e>0)n.x=0,n.y=-1,n.z=1,n=a.default.multiplyByScalar(a.default.normalize(n,n),5*t.maximumRadius,n),a.default.negate(a.default.normalize(n,s),s),a.default.cross(a.default.UNIT_X,s,l);else{var u=i.camera;if(this._previousMode===N.a.SCENE2D)a.default.clone(u.position,n),n.z=u.frustum.right-u.frustum.left,a.default.negate(a.default.UNIT_Z,s),a.default.clone(a.default.UNIT_Y,l);else{a.default.clone(u.positionWC,n),a.default.clone(u.directionWC,s),a.default.clone(u.upWC,l);var d=t.scaleToGeodeticSurface(n,mm),f=Ur.default.eastNorthUpToFixedFrame(d,t,_m);K.default.inverseTransformation(f,f),i.mapProjection.project(t.cartesianToCartographic(n,pm),n),K.default.multiplyByPointAsVector(f,s,s),K.default.multiplyByPointAsVector(f,l,l)}}this._morphToOrthographic?((r=vm).width=i.camera.frustum.right-i.camera.frustum.left,r.aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight):((r=gm).aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight,r.fov=Z.default.toRadians(60));var c=ym;c.position=n,c.direction=s,c.up=l,c.frustum=r;var h=function(e){return function(t){var i=t._scene;i._mode=N.a.COLUMBUS_VIEW,i.morphTime=N.a.getMorphTime(N.a.COLUMBUS_VIEW),Om(t);var r=i.camera;(t._previousModeMode!==N.a.MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,a.default.clone(e.position,r.position),a.default.clone(e.direction,r.direction),a.default.clone(e.up,r.up),a.default.cross(r.direction,r.up,r.right),a.default.normalize(r.right,r.right));var n=r.frustum;i.frameState.useLogDepth&&(n.near=.1,n.far=1e10);var s=Object(o.default)(t._completeMorph);t._completeMorph=void 0,i.camera.update(i.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,N.a.COLUMBUS_VIEW,s)}}(c);xm(this,h),this._previousMode===N.a.SCENE2D?function(e,t,i,r){t*=.5;var n=e._scene,o=n.camera,s=a.default.clone(i.position,Um),l=a.default.clone(i.direction,zm),u=a.default.clone(i.up,Bm);function d(){o.frustum=i.frustum.clone();var d=a.default.clone(o.position,Lm),f=a.default.clone(o.direction,jm),c=a.default.clone(o.up,Vm);d.z=s.z;var h=n.tweens.add({duration:t,easingFunction:jo.default.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){Hm(d,s,e.time,o.position),Hm(f,l,e.time,o.direction),Hm(c,u,e.time,o.up),a.default.cross(o.direction,o.up,o.right),a.default.normalize(o.right,o.right)},complete:function(){r(e)}});e._currentTweens.push(h)}n._mode=N.a.MORPHING,e._morphToOrthographic?d():sp(e,0,i,d)}(this,e,c,h):(c.position2D=K.default.multiplyByPoint(Ql.TRANSFORM_2D,n,fm),c.direction2D=K.default.multiplyByPointAsVector(Ql.TRANSFORM_2D,s,cm),c.up2D=K.default.multiplyByPointAsVector(Ql.TRANSFORM_2D,l,hm),i._mode=N.a.MORPHING,lp(this,e,c,h)),0===e&&Object(o.default)(this._completeMorph)&&this._completeMorph()}};var bm={position:new a.default,direction:new a.default,up:new a.default,frustum:void 0},wm=new An.a;function xm(e,t){if(e._scene.completeMorphOnUserInput){e._morphHandler=new h.default(e._scene.canvas);var i=function(){e._morphCancelled=!0,e._scene.camera.cancelFlight(),t(e)};e._completeMorph=i,e._morphHandler.setInputAction(i,om.default.LEFT_DOWN),e._morphHandler.setInputAction(i,om.default.MIDDLE_DOWN),e._morphHandler.setInputAction(i,om.default.RIGHT_DOWN),e._morphHandler.setInputAction(i,om.default.WHEEL)}}function Om(e){for(var t=e._currentTweens,i=0;i<t.length;++i)t[i].cancelTween();e._currentTweens.length=0,e._morphHandler=e._morphHandler&&e._morphHandler.destroy()}sm.prototype.morphTo3D=function(e,t){Object(o.default)(this._completeMorph)&&this._completeMorph();var i=this._scene;if(this._previousMode=i.mode,this._previousMode!==N.a.SCENE3D&&this._previousMode!==N.a.MORPHING){if(this._scene.morphStart.raiseEvent(this,this._previousMode,N.a.SCENE3D,!0),i._mode=N.a.MORPHING,i.camera._setTransform(K.default.IDENTITY),this._previousMode===N.a.SCENE2D)!function(e,t,i){t/=3;var r,n,o=e._scene,s=o.camera;t>0?(r=bm,a.default.fromDegrees(0,0,5*i.maximumRadius,i,r.position),a.default.negate(r.position,r.direction),a.default.normalize(r.direction,r.direction),a.default.clone(a.default.UNIT_Z,r.up)):(s.position.z=s.frustum.right-s.frustum.left,r=Pm(e,i));e._morphToOrthographic?((n=Nm).aspectRatio=o.drawingBufferWidth/o.drawingBufferHeight,n.width=s.frustum.right-s.frustum.left):((n=wm).aspectRatio=o.drawingBufferWidth/o.drawingBufferHeight,n.fov=Z.default.toRadians(60));r.frustum=n;var l,u=dp(r);xm(e,u),l=e._morphToOrthographic?function(){Rm(e,t,r,u)}:function(){sp(e,t,r,(function(){Rm(e,t,r,u)}))};t>0?(o._mode=N.a.SCENE2D,s.flyTo({duration:t,destination:a.default.fromDegrees(0,0,5*i.maximumRadius,i,Um),complete:function(){o._mode=N.a.MORPHING,l()}})):l()}(this,e,t);else{var r,n;e>0?(r=bm,a.default.fromDegrees(0,0,5*t.maximumRadius,t,r.position),a.default.negate(r.position,r.direction),a.default.normalize(r.direction,r.direction),a.default.clone(a.default.UNIT_Z,r.up)):r=Pm(this,t);var s=i.camera;s.frustum instanceof $.a?n=s.frustum.clone():((n=wm).aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight,n.fov=Z.default.toRadians(60)),r.frustum=n;var l=dp(r);xm(this,l),Rm(this,e,r,l)}0===e&&Object(o.default)(this._completeMorph)&&this._completeMorph()}},sm.prototype.isDestroyed=function(){return!1},sm.prototype.destroy=function(){return Om(this),Object(s.default)(this)};var Cm=new v.default,Tm=new a.default,Em=new K.default;function Pm(e,t){var i=e._scene,a=i.camera,r=bm,n=r.position,o=r.direction,s=r.up,l=i.mapProjection.unproject(a.position,Cm);t.cartographicToCartesian(l,n);var u=t.scaleToGeodeticSurface(n,Tm),d=Ur.default.eastNorthUpToFixedFrame(u,t,Em);return K.default.multiplyByPointAsVector(d,a.direction,o),K.default.multiplyByPointAsVector(d,a.up,s),r}var Am=new a.default,Sm=new a.default,Dm=new a.default,Im=new a.default,Mm=new a.default,Fm=new a.default;function Rm(e,t,i,r){t*=.5;var n=e._scene,o=n.camera,s=a.default.clone(o.position,Am),l=a.default.clone(o.direction,Sm),u=a.default.clone(o.up,Dm),d=K.default.multiplyByPoint(Ql.TRANSFORM_2D_INVERSE,i.position,Im),f=K.default.multiplyByPointAsVector(Ql.TRANSFORM_2D_INVERSE,i.direction,Mm),c=K.default.multiplyByPointAsVector(Ql.TRANSFORM_2D_INVERSE,i.up,Fm);var h=n.tweens.add({duration:t,easingFunction:jo.default.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){Hm(s,d,e.time,o.position),Hm(l,f,e.time,o.direction),Hm(u,c,e.time,o.up),a.default.cross(o.direction,o.up,o.right),a.default.normalize(o.right,o.right)},complete:function(){up(e,n,0,1,t,r)}});e._currentTweens.push(h)}var Nm=new $.a,Lm=new a.default,jm=new a.default,Vm=new a.default,Um=new a.default,zm=new a.default,Bm=new a.default;function Hm(e,t,i,r){return a.default.lerp(e,t,i,r)}function km(e,t,i,a,r){var n=e._scene,o=n.camera;if(!(o.frustum instanceof $.a)){var s=o.frustum.fov,l=.5*Z.default.RADIANS_PER_DEGREE,u=i.position.z*Math.tan(.5*s);o.frustum.far=u/Math.tan(.5*l)+1e7;var d=n.tweens.add({duration:t,easingFunction:jo.default.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){o.frustum.fov=Z.default.lerp(s,l,e.time);var t=u/Math.tan(.5*o.frustum.fov);a(o,t)},complete:function(){o.frustum=i.frustum.clone(),r(e)}});e._currentTweens.push(d)}}var Wm=new a.default,Gm=new a.default,Ym=new a.default,Xm=new a.default,Qm=new a.default,qm=new a.default,Zm=new fi.a,Km=new O.default,Jm=new a.default,$m={position:void 0,direction:void 0,up:void 0,frustum:void 0};var ep=new v.default,tp={position:new a.default,direction:new a.default,up:new a.default,position2D:new a.default,direction2D:new a.default,up2D:new a.default,frustum:new fi.a},ip={position:new a.default,direction:new a.default,up:new a.default,frustum:void 0},ap=new a.default,rp=new O.default,np=new K.default,op=new a.default;function sp(e,t,i,a){var r=e._scene,n=r.camera,o=n.frustum.right-n.frustum.left;n.frustum=i.frustum.clone();var s=n.frustum.fov,l=.5*Z.default.RADIANS_PER_DEGREE,u=o*Math.tan(.5*s);n.frustum.far=u/Math.tan(.5*l)+1e7,n.frustum.fov=l;var d=r.tweens.add({duration:t,easingFunction:jo.default.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){n.frustum.fov=Z.default.lerp(l,s,e.time),n.position.z=u/Math.tan(.5*n.frustum.fov)},complete:function(){a(e)}});e._currentTweens.push(d)}function lp(e,t,i,r){var n=e._scene,o=n.camera,s=a.default.clone(o.position,Lm),l=a.default.clone(o.direction,jm),u=a.default.clone(o.up,Vm),d=a.default.clone(i.position2D,Um),f=a.default.clone(i.direction2D,zm),c=a.default.clone(i.up2D,Bm);var h=n.tweens.add({duration:t,easingFunction:jo.default.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){Hm(s,d,e.time,o.position),Hm(l,f,e.time,o.direction),Hm(u,c,e.time,o.up),a.default.cross(o.direction,o.up,o.right),a.default.normalize(o.right,o.right),o._adjustOrthographicFrustum(!0)},complete:function(){up(e,n,1,0,t,r)}});e._currentTweens.push(h)}function up(e,t,i,a,r,n){var s={object:t,property:"morphTime",startValue:i,stopValue:a,duration:r,easingFunction:jo.default.QUARTIC_OUT};Object(o.default)(n)&&(s.complete=function(){n(e)});var l=t.tweens.addProperty(s);e._currentTweens.push(l)}function dp(e){return function(t){var i=t._scene;i._mode=N.a.SCENE3D,i.morphTime=N.a.getMorphTime(N.a.SCENE3D),Om(t);var r=i.camera;(t._previousMode!==N.a.MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,a.default.clone(e.position,r.position),a.default.clone(e.direction,r.direction),a.default.clone(e.up,r.up),a.default.cross(r.direction,r.up,r.right),a.default.normalize(r.right,r.right),r.frustum=e.frustum.clone());var n=r.frustum;i.frameState.useLogDepth&&(n.near=.1,n.far=1e10);var s=Object(o.default)(t._completeMorph);t._completeMorph=void 0,i.camera.update(i.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,N.a.SCENE3D,s)}}function fp(e){return function(t){var i=t._scene;i._mode=N.a.SCENE2D,i.morphTime=N.a.getMorphTime(N.a.SCENE2D),Om(t);var r=i.camera;a.default.clone(e.position,r.position),r.position.z=2*i.mapProjection.ellipsoid.maximumRadius,a.default.clone(e.direction,r.direction),a.default.clone(e.up,r.up),a.default.cross(r.direction,r.up,r.right),a.default.normalize(r.right,r.right),r.frustum=e.frustum.clone();var n=Object(o.default)(t._completeMorph);t._completeMorph=void 0,i.camera.update(i.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,N.a.SCENE2D,n)}}var cp=sm,hp=i(277),mp=i(134),pp=Object.freeze({LEFT_DRAG:0,RIGHT_DRAG:1,MIDDLE_DRAG:2,WHEEL:3,PINCH:4});function _p(e,t){var i=e;return Object(o.default)(t)&&(i+="+"+t),i}function gp(e,t,i){var a=_p(pp.PINCH,t),r=e._update,n=e._isDown,s=e._eventStartPosition,l=e._pressTime,u=e._releaseTime;r[a]=!0,n[a]=!1,s[a]=new z.default;var d=e._movement[a];Object(o.default)(d)||(d=e._movement[a]={}),d.distance={startPosition:new z.default,endPosition:new z.default},d.angleAndHeight={startPosition:new z.default,endPosition:new z.default},d.prevAngle=0,e._eventHandler.setInputAction((function(t){e._buttonsDown++,n[a]=!0,l[a]=new Date,z.default.lerp(t.position1,t.position2,.5,s[a])}),om.default.PINCH_START,t),e._eventHandler.setInputAction((function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),n[a]=!1,u[a]=new Date}),om.default.PINCH_END,t),e._eventHandler.setInputAction((function(e){if(n[a]){r[a]?(l=e,u=d,z.default.clone(l.distance.startPosition,u.distance.startPosition),z.default.clone(l.distance.endPosition,u.distance.endPosition),z.default.clone(l.angleAndHeight.startPosition,u.angleAndHeight.startPosition),z.default.clone(l.angleAndHeight.endPosition,u.angleAndHeight.endPosition),r[a]=!1,d.prevAngle=d.angleAndHeight.startPosition.x):(z.default.clone(e.distance.endPosition,d.distance.endPosition),z.default.clone(e.angleAndHeight.endPosition,d.angleAndHeight.endPosition));for(var t=d.angleAndHeight.endPosition.x,o=d.prevAngle,s=2*Math.PI;t>=o+Math.PI;)t-=s;for(;t<o-Math.PI;)t+=s;d.angleAndHeight.endPosition.x=-t*i.clientWidth/12,d.angleAndHeight.startPosition.x=-o*i.clientWidth/12}var l,u}),om.default.PINCH_MOVE,t)}function vp(e,t){var i=_p(pp.WHEEL,t),a=e._update;a[i]=!0;var r=e._movement[i];Object(o.default)(r)||(r=e._movement[i]={}),r.startPosition=new z.default,r.endPosition=new z.default,e._eventHandler.setInputAction((function(e){var t=15*Z.default.toRadians(e);a[i]?(z.default.clone(z.default.ZERO,r.startPosition),r.endPosition.x=0,r.endPosition.y=t,a[i]=!1):r.endPosition.y=r.endPosition.y+t}),om.default.WHEEL,t)}function yp(e,t,i){var a=_p(i,t),r=e._isDown,n=e._eventStartPosition,s=e._pressTime,l=e._releaseTime;r[a]=!1,n[a]=new z.default;var u,d,f=e._lastMovement[a];Object(o.default)(f)||(f=e._lastMovement[a]={startPosition:new z.default,endPosition:new z.default,valid:!1}),i===pp.LEFT_DRAG?(u=om.default.LEFT_DOWN,d=om.default.LEFT_UP):i===pp.RIGHT_DRAG?(u=om.default.RIGHT_DOWN,d=om.default.RIGHT_UP):i===pp.MIDDLE_DRAG&&(u=om.default.MIDDLE_DOWN,d=om.default.MIDDLE_UP),e._eventHandler.setInputAction((function(t){e._buttonsDown++,f.valid=!1,r[a]=!0,s[a]=new Date,z.default.clone(t.position,n[a])}),u,t),e._eventHandler.setInputAction((function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),r[a]=!1,l[a]=new Date}),d,t)}function bp(e,t){z.default.clone(e.startPosition,t.startPosition),z.default.clone(e.endPosition,t.endPosition)}function wp(e,t){var i=e._update,a=e._movement,r=e._lastMovement,n=e._isDown;for(var s in pp)if(pp.hasOwnProperty(s)){var l=pp[s];if(Object(o.default)(l)){var u=_p(l,t);i[u]=!0,Object(o.default)(e._lastMovement[u])||(e._lastMovement[u]={startPosition:new z.default,endPosition:new z.default,valid:!1}),Object(o.default)(e._movement[u])||(e._movement[u]={startPosition:new z.default,endPosition:new z.default})}}e._eventHandler.setInputAction((function(s){for(var l in pp)if(pp.hasOwnProperty(l)){var u=pp[l];if(Object(o.default)(u)){var d=_p(u,t);n[d]&&(i[d]?(bp(a[d],r[d]),r[d].valid=!0,bp(s,a[d]),i[d]=!1):z.default.clone(s.endPosition,a[d].endPosition))}}z.default.clone(s.endPosition,e._currentMousePosition)}),om.default.MOUSE_MOVE,t)}function xp(e){for(var t in this._eventHandler=new h.default(e),this._update={},this._movement={},this._lastMovement={},this._isDown={},this._eventStartPosition={},this._pressTime={},this._releaseTime={},this._buttonsDown=0,this._currentMousePosition=new z.default,vp(this,void 0),gp(this,void 0,e),yp(this,void 0,pp.LEFT_DRAG),yp(this,void 0,pp.RIGHT_DRAG),yp(this,void 0,pp.MIDDLE_DRAG),wp(this,void 0),hp.default)if(hp.default.hasOwnProperty(t)){var i=hp.default[t];Object(o.default)(i)&&(vp(this,i),gp(this,i,e),yp(this,i,pp.LEFT_DRAG),yp(this,i,pp.RIGHT_DRAG),yp(this,i,pp.MIDDLE_DRAG),wp(this,i))}}Object.defineProperties(xp.prototype,{currentMousePosition:{get:function(){return this._currentMousePosition}},anyButtonDown:{get:function(){var e=!(this._update[_p(pp.WHEEL)]&&this._update[_p(pp.WHEEL,hp.default.SHIFT)]&&this._update[_p(pp.WHEEL,hp.default.CTRL)]&&this._update[_p(pp.WHEEL,hp.default.ALT)]);return this._buttonsDown>0||e}}}),xp.prototype.isMoving=function(e,t){var i=_p(e,t);return!this._update[i]},xp.prototype.getMovement=function(e,t){var i=_p(e,t);return this._movement[i]},xp.prototype.getLastMovement=function(e,t){var i=_p(e,t),a=this._lastMovement[i];if(a.valid)return a},xp.prototype.isButtonDown=function(e,t){var i=_p(e,t);return this._isDown[i]},xp.prototype.getStartMousePosition=function(e,t){if(e===pp.WHEEL)return this._currentMousePosition;var i=_p(e,t);return this._eventStartPosition[i]},xp.prototype.getButtonPressTime=function(e,t){var i=_p(e,t);return this._pressTime[i]},xp.prototype.getButtonReleaseTime=function(e,t){var i=_p(e,t);return this._releaseTime[i]},xp.prototype.reset=function(){for(var e in this._update)this._update.hasOwnProperty(e)&&(this._update[e]=!0)},xp.prototype.isDestroyed=function(){return!1},xp.prototype.destroy=function(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),Object(s.default)(this)};var Op=xp,Cp=i(409);function Tp(e){this.enableInputs=!0,this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.bounceAnimationTime=3,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.translateEventTypes=pp.LEFT_DRAG,this.zoomEventTypes=[pp.RIGHT_DRAG,pp.WHEEL,pp.PINCH],this.rotateEventTypes=pp.LEFT_DRAG,this.tiltEventTypes=[pp.MIDDLE_DRAG,pp.PINCH,{eventType:pp.LEFT_DRAG,modifier:hp.default.CTRL},{eventType:pp.RIGHT_DRAG,modifier:hp.default.CTRL}],this.lookEventTypes={eventType:pp.LEFT_DRAG,modifier:hp.default.SHIFT},this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumCollisionTerrainHeight=15e3,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.minimumTrackBallHeight=75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.enableCollisionDetection=!0,this._scene=e,this._globe=void 0,this._ellipsoid=void 0,this._aggregator=new Op(e.canvas),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaTiltMovement=void 0,this._tweens=new Cp.default,this._tween=void 0,this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new z.default(-1,-1),this._tiltCenter=new a.default,this._rotateMousePosition=new z.default(-1,-1),this._rotateStartPosition=new a.default,this._strafeStartPosition=new a.default,this._zoomMouseStart=new z.default(-1,-1),this._zoomWorldPosition=new a.default,this._useZoomWorldPosition=!1,this._tiltCVOffMap=!1,this._looking=!1,this._rotating=!1,this._strafing=!1,this._zoomingOnVector=!1,this._rotatingZoom=!1,this._adjustedHeightForTerrain=!1;var t=e.mapProjection;this._maxCoord=t.project(new v.default(Math.PI,Z.default.PI_OVER_TWO)),this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3}var Ep=.4;function Pp(e,t,i,a,r,n,s){var l=n[s];Object(o.default)(l)||(l=n[s]={startPosition:new z.default,endPosition:new z.default,motion:new z.default,active:!1});var u,d=e.getButtonPressTime(t,i),f=e.getButtonReleaseTime(t,i),c=d&&f&&(f.getTime()-d.getTime())/1e3,h=new Date,m=f&&(h.getTime()-f.getTime())/1e3;if(d&&f&&c<Ep){var p=function(e,t){if(e<0)return 0;var i=25*(1-t);return Math.exp(-i*e)}(m,a);if(l.active)l.startPosition=z.default.clone(l.endPosition,l.startPosition),l.endPosition=z.default.multiplyByScalar(l.motion,p,l.endPosition),l.endPosition=z.default.add(l.startPosition,l.endPosition,l.endPosition),l.motion=z.default.clone(z.default.ZERO,l.motion);else{var _=e.getLastMovement(t,i);if(!Object(o.default)(_)||(u=_,z.default.equalsEpsilon(u.startPosition,u.endPosition,Z.default.EPSILON14)))return;l.motion.x=.5*(_.endPosition.x-_.startPosition.x),l.motion.y=.5*(_.endPosition.y-_.startPosition.y),l.startPosition=z.default.clone(_.startPosition,l.startPosition),l.endPosition=z.default.multiplyByScalar(l.motion,p,l.endPosition),l.endPosition=z.default.add(l.startPosition,l.endPosition,l.endPosition),l.active=!0}if(isNaN(l.endPosition.x)||isNaN(l.endPosition.y)||z.default.distance(l.startPosition,l.endPosition)<.5)return void(l.active=!1);if(!e.isButtonDown(t,i))r(n,e.getStartMousePosition(t,i),l)}else l.active=!1}var Ap=[];function Sp(e,t,i,a,r,n){if(Object(o.default)(i)){var s=e._aggregator;Array.isArray(i)||(Ap[0]=i,i=Ap);for(var l=i.length,u=0;u<l;++u){var d=i[u],f=Object(o.default)(d.eventType)?d.eventType:d,c=d.modifier,h=s.isMoving(f,c)&&s.getMovement(f,c),m=s.getStartMousePosition(f,c);e.enableInputs&&t&&(h?a(e,m,h):r<1&&Pp(s,f,c,r,a,e,n))}}}var Dp=new O.default,Ip=new a.default,Mp=new z.default,Fp=new a.default,Rp=new z.default,Np=new a.default,Lp=new a.default,jp=new a.default,Vp=new a.default,Up=new a.default,zp=new a.default,Bp=new a.default,Hp=new a.default,kp=new a.default,Wp=new a.default,Gp=new a.default,Yp=new a.default,Xp=new a.default,Qp=new a.default,qp=new a.default,Zp=new a.default,Kp=new a.default,Jp=new a.default,$p={orientation:new zo.default};function e_(e,t,i,r,n,s){var l=1;Object(o.default)(s)&&(l=Z.default.clamp(Math.abs(s),.25,1));var u=e.minimumZoomDistance*l,d=e.maximumZoomDistance,f=r*(n-u);f=Z.default.clamp(f,e._minimumZoomRate,e._maximumZoomRate);var c=(i.endPosition.y-i.startPosition.y)/e._scene.canvas.clientHeight,h=f*(c=Math.min(c,e.maximumMovementRatio));if(!(h>0&&Math.abs(n-u)<1||h<0&&Math.abs(n-d)<1)){n-h<u?h=n-u-1:n-h>d&&(h=n-d);var m=e._scene,p=m.camera,_=m.mode,g=$p.orientation;if(g.heading=p.heading,g.pitch=p.pitch,g.roll=p.roll,p.frustum instanceof $.a)Math.abs(h)>0&&(p.zoomIn(h),p._adjustOrthographicFrustum());else{var v,y=z.default.equals(t,e._zoomMouseStart),b=e._zoomingOnVector,w=e._rotatingZoom;if(y||(e._zoomMouseStart=z.default.clone(t,e._zoomMouseStart),Object(o.default)(e._globe)&&(_===N.a.SCENE2D?(v=p.getPickRay(t,Dp).origin,v=a.default.fromElements(v.y,v.z,v.x)):v=c_(e,t,Ip)),Object(o.default)(v)?(e._useZoomWorldPosition=!0,e._zoomWorldPosition=a.default.clone(v,e._zoomWorldPosition)):e._useZoomWorldPosition=!1,b=e._zoomingOnVector=!1,w=e._rotatingZoom=!1),e._useZoomWorldPosition){var x=_===N.a.COLUMBUS_VIEW;if(p.positionCartographic.height<2e6&&(w=!0),!y||w){if(_===N.a.SCENE2D){var O=e._zoomWorldPosition,C=p.position;if(!a.default.equals(O,C)&&p.positionCartographic.height<2*e._maxCoord.x){var T=p.position.x,E=a.default.subtract(O,C,Fp);a.default.normalize(E,E);var P=a.default.distance(O,C)*h/(.5*p.getMagnitude());p.move(E,.5*P),(p.position.x<0&&T>0||p.position.x>0&&T<0)&&(v=p.getPickRay(t,Dp).origin,v=a.default.fromElements(v.y,v.z,v.x),e._zoomWorldPosition=a.default.clone(v,e._zoomWorldPosition))}}else if(_===N.a.SCENE3D){var A=a.default.normalize(p.position,Up);if(p.positionCartographic.height<3e3&&Math.abs(a.default.dot(p.direction,A))<.6)x=!0;else{var S=m.canvas,D=Rp;D.x=S.clientWidth/2,D.y=S.clientHeight/2;var I=c_(e,D,Np);if(Object(o.default)(I)&&p.positionCartographic.height<1e6){var M=Bp;a.default.clone(p.position,M);var F=e._zoomWorldPosition,R=zp;if(R=a.default.normalize(F,R),a.default.dot(R,A)<0)return;var L=qp,j=Wp;a.default.clone(p.direction,j),a.default.add(M,a.default.multiplyByScalar(j,1e3,Zp),L);var V=Gp,U=Yp;a.default.subtract(F,M,V),a.default.normalize(V,U);var B=a.default.dot(A,U);if(B>=0)return void(e._zoomMouseStart.x=-1);var H=Math.acos(-B),k=a.default.magnitude(M),W=a.default.magnitude(F),G=k-h,Y=a.default.magnitude(V),X=Math.asin(Z.default.clamp(Y/W*Math.sin(H),-1,1))-Math.asin(Z.default.clamp(G/W*Math.sin(H),-1,1))+H,Q=Hp;a.default.normalize(M,Q);var q=kp;q=a.default.cross(U,Q,q),q=a.default.normalize(q,q),a.default.normalize(a.default.cross(Q,q,Zp),j),a.default.multiplyByScalar(a.default.normalize(L,Zp),a.default.magnitude(L)-h,L),a.default.normalize(M,M),a.default.multiplyByScalar(M,G,M);var K=Xp;a.default.multiplyByScalar(a.default.add(a.default.multiplyByScalar(Q,Math.cos(X)-1,Kp),a.default.multiplyByScalar(j,Math.sin(X),Jp),Zp),G,K),a.default.add(M,K,M),a.default.normalize(L,Q),a.default.normalize(a.default.cross(Q,q,Zp),j);var J=Qp;return a.default.multiplyByScalar(a.default.add(a.default.multiplyByScalar(Q,Math.cos(X)-1,Kp),a.default.multiplyByScalar(j,Math.sin(X),Jp),Zp),a.default.magnitude(L),J),a.default.add(L,J,L),a.default.clone(M,p.position),a.default.normalize(a.default.subtract(L,M,Zp),p.direction),a.default.clone(p.direction,p.direction),a.default.cross(p.direction,p.up,p.right),a.default.cross(p.right,p.direction,p.up),void p.setView($p)}if(Object(o.default)(I)){var ee=a.default.normalize(I,Lp),te=a.default.normalize(e._zoomWorldPosition,jp),ie=a.default.dot(te,ee);if(ie>0&&ie<1){var ae=Z.default.acosClamped(ie),re=a.default.cross(te,ee,Vp),ne=h/(Math.abs(ae)>Z.default.toRadians(20)?.75*p.positionCartographic.height:p.positionCartographic.height-h);p.rotate(re,ae*ne)}}else x=!0}}e._rotatingZoom=!x}if(!y&&x||b){var oe=ef.default.wgs84ToWindowCoordinates(m,e._zoomWorldPosition,Mp),se=(_!==N.a.COLUMBUS_VIEW&&z.default.equals(t,e._zoomMouseStart)&&Object(o.default)(oe)?p.getPickRay(oe,Dp):p.getPickRay(t,Dp)).direction;_!==N.a.COLUMBUS_VIEW&&_!==N.a.SCENE2D||a.default.fromElements(se.y,se.z,se.x,se),p.move(se,h),e._zoomingOnVector=!0}else p.zoomIn(h);p.setView($p)}else p.zoomIn(h)}}}var t_=new O.default,i_=new O.default,a_=new a.default;function r_(e,t,i){var r=e._scene.camera,n=r.getPickRay(i.startPosition,t_).origin,o=r.getPickRay(i.endPosition,i_).origin;n=a.default.fromElements(n.y,n.z,n.x,n),o=a.default.fromElements(o.y,o.z,o.x,o);var s=a.default.subtract(n,o,a_),l=a.default.magnitude(s);l>0&&(a.default.normalize(s,s),r.move(s,l))}function n_(e,t,i){Object(o.default)(i.distance)&&(i=i.distance);var a=e._scene.camera;e_(e,t,i,e._zoomFactor,a.getMagnitude())}var o_=new z.default,s_=new z.default;function l_(e,t,i){if(Object(o.default)(i.angleAndHeight))!function(e,t,i){var a=e._rotateFactor*e._rotateRateRangeAdjustment;a>e._maximumRotateRate&&(a=e._maximumRotateRate);a<e._minimumRotateRate&&(a=e._minimumRotateRate);var r=e._scene,n=r.camera,o=r.canvas,s=(i.endPosition.x-i.startPosition.x)/o.clientWidth;s=Math.min(s,e.maximumMovementRatio);var l=a*s*Math.PI*4;n.twistRight(l)}(e,0,i.angleAndHeight);else{var a=e._scene,r=a.camera,n=a.canvas,s=n.clientWidth,l=n.clientHeight,u=o_;u.x=2/s*i.startPosition.x-1,u.y=2/l*(l-i.startPosition.y)-1,u=z.default.normalize(u,u);var d=s_;d.x=2/s*i.endPosition.x-1,d.y=2/l*(l-i.endPosition.y)-1,d=z.default.normalize(d,d);var f=Z.default.acosClamped(u.x);u.y<0&&(f=Z.default.TWO_PI-f);var c=Z.default.acosClamped(d.x);d.y<0&&(c=Z.default.TWO_PI-c);var h=c-f;r.twistRight(h)}}var u_=new O.default,d_=new a.default,f_=new a.default;function c_(e,t,i){var r=e._scene,n=e._globe,s=r.camera;if(Object(o.default)(n)){var l;r.pickPositionSupported&&(l=r.pickPositionWorldCoordinates(t,d_));var u=s.getPickRay(t,u_),d=n.pickWorldCoordinates(u,r,f_);return(Object(o.default)(l)?a.default.distance(l,s.positionWC):Number.POSITIVE_INFINITY)<(Object(o.default)(d)?a.default.distance(d,s.positionWC):Number.POSITIVE_INFINITY)?a.default.clone(l,i):a.default.clone(d,i)}}var h_=new O.default,m_=new O.default,p_=new a.default,__=new a.default,g_=new a.default,v_=new a.default,y_=new mp.a(a.default.UNIT_X,0),b_=new z.default,w_=new z.default;function x_(e,t,i){if(a.default.equals(t,e._translateMousePosition)||(e._looking=!1),a.default.equals(t,e._strafeMousePosition)||(e._strafing=!1),e._looking)Mg(e,t,i);else if(e._strafing)X_(e,t,i);else{var r,n=e._scene.camera,s=z.default.clone(i.startPosition,b_),l=z.default.clone(i.endPosition,w_),u=n.getPickRay(s,h_),d=a.default.clone(a.default.ZERO,v_),f=a.default.UNIT_X;if(n.position.z<e._minimumPickingTerrainHeight&&(r=c_(e,s,p_),Object(o.default)(r)&&(d.x=r.x)),d.x>n.position.z&&Object(o.default)(r))return a.default.clone(r,e._strafeStartPosition),e._strafing=!0,X_(e,t,i),void(e._strafeMousePosition=z.default.clone(t,e._strafeMousePosition));var c=mp.a.fromPointNormal(d,f,y_);u=n.getPickRay(s,h_);var h=x.default.rayPlane(u,c,p_),m=n.getPickRay(l,m_),p=x.default.rayPlane(m,c,__);if(!Object(o.default)(h)||!Object(o.default)(p))return e._looking=!0,Mg(e,t,i),void z.default.clone(t,e._translateMousePosition);var _=a.default.subtract(h,p,g_),g=_.x;_.x=_.y,_.y=_.z,_.z=g;var v=a.default.magnitude(_);v>Z.default.EPSILON6&&(a.default.normalize(_,_),n.move(_,v))}}var O_=new z.default,C_=new O.default,T_=new a.default,E_=new a.default,P_=new K.default,A_=new K.default,S_=new a.default,D_=new mp.a(a.default.UNIT_X,0),I_=new a.default,M_=new v.default,F_=new K.default,R_=new pa.default,N_=new ma.default,L_=new a.default;function j_(e,t,i){if(Object(o.default)(i.angleAndHeight)&&(i=i.angleAndHeight),z.default.equals(t,e._tiltCenterMousePosition)||(e._tiltCVOffMap=!1,e._looking=!1),e._looking)Mg(e,t,i);else{var r=e._scene.camera;e._tiltCVOffMap||!e.onMap()||r.position.z>e._minimumPickingTerrainHeight?(e._tiltCVOffMap=!0,function(e,t,i){var r=e._scene,n=r.camera,s=r.canvas,l=O_;l.x=s.clientWidth/2,l.y=s.clientHeight/2;var d,f=n.getPickRay(l,C_),c=a.default.UNIT_X,h=f.origin,m=f.direction,p=a.default.dot(c,m);Math.abs(p)>Z.default.EPSILON6&&(d=-a.default.dot(c,h)/p);if(!Object(o.default)(d)||d<=0)return e._looking=!0,Mg(e,t,i),void z.default.clone(t,e._tiltCenterMousePosition);var _=a.default.multiplyByScalar(m,d,T_);a.default.add(h,_,_);var g=r.mapProjection,v=g.ellipsoid;a.default.fromElements(_.y,_.z,_.x,_);var y=g.unproject(_,M_);v.cartographicToCartesian(y,_);var b=Ur.default.eastNorthUpToFixedFrame(_,v,P_),w=e._globe,x=e._ellipsoid;e._globe=void 0,e._ellipsoid=u.default.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var O=K.default.clone(n.transform,F_);n._setTransform(b),eg(e,t,i,a.default.UNIT_Z),n._setTransform(O),e._globe=w,e._ellipsoid=x;var C=x.maximumRadius;e._rotateFactor=1/C,e._rotateRateRangeAdjustment=C}(e,t,i)):function(e,t,i){var r,n,s=e._scene,l=s.camera,d=a.default.UNIT_X;if(z.default.equals(t,e._tiltCenterMousePosition))r=a.default.clone(e._tiltCenter,T_);else{if(l.position.z<e._minimumPickingTerrainHeight&&(r=c_(e,t,T_)),!Object(o.default)(r)){var f,c=(n=l.getPickRay(t,C_)).origin,h=n.direction,m=a.default.dot(d,h);if(Math.abs(m)>Z.default.EPSILON6&&(f=-a.default.dot(d,c)/m),!Object(o.default)(f)||f<=0)return e._looking=!0,Mg(e,t,i),void z.default.clone(t,e._tiltCenterMousePosition);r=a.default.multiplyByScalar(h,f,T_),a.default.add(c,r,r)}z.default.clone(t,e._tiltCenterMousePosition),a.default.clone(r,e._tiltCenter)}var p=s.canvas,_=O_;_.x=p.clientWidth/2,_.y=e._tiltCenterMousePosition.y,n=l.getPickRay(_,C_);var g=a.default.clone(a.default.ZERO,S_);g.x=r.x;var v=mp.a.fromPointNormal(g,d,D_),y=x.default.rayPlane(n,v,E_),b=l._projection,w=b.ellipsoid;a.default.fromElements(r.y,r.z,r.x,r);var O=b.unproject(r,M_);w.cartographicToCartesian(O,r);var C,T=Ur.default.eastNorthUpToFixedFrame(r,w,P_);Object(o.default)(y)?(a.default.fromElements(y.y,y.z,y.x,y),O=b.unproject(y,M_),w.cartographicToCartesian(O,y),C=Ur.default.eastNorthUpToFixedFrame(y,w,A_)):C=T;var E=e._globe,P=e._ellipsoid;e._globe=void 0,e._ellipsoid=u.default.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var A=a.default.UNIT_Z,S=K.default.clone(l.transform,F_);l._setTransform(T);var D=a.default.cross(a.default.UNIT_Z,a.default.normalize(l.position,I_),I_),I=a.default.dot(l.right,D);if(eg(e,t,i,A,!1,!0),l._setTransform(C),I<0){i.startPosition.y>i.endPosition.y&&(A=void 0);var M=l.constrainedAxis;l.constrainedAxis=void 0,eg(e,t,i,A,!0,!1),l.constrainedAxis=M}else eg(e,t,i,A,!0,!1);if(Object(o.default)(l.constrainedAxis)){var F=a.default.cross(l.direction,l.constrainedAxis,L_);a.default.equalsEpsilon(F,a.default.ZERO,Z.default.EPSILON6)||(a.default.dot(F,l.right)<0&&a.default.negate(F,F),a.default.cross(F,l.direction,l.up),a.default.cross(l.direction,l.up,l.right),a.default.normalize(l.up,l.up),a.default.normalize(l.right,l.right))}l._setTransform(S),e._globe=E,e._ellipsoid=P;var R=P.maximumRadius;e._rotateFactor=1/R,e._rotateRateRangeAdjustment=R;var N=a.default.clone(l.positionWC,I_);e.enableCollisionDetection&&Ng(e);if(!a.default.equals(l.positionWC,N)){l._setTransform(C),l.worldToCameraCoordinatesPoint(N,N);var L=a.default.magnitudeSquared(N);a.default.magnitudeSquared(l.position)>L&&(a.default.normalize(l.position,l.position),a.default.multiplyByScalar(l.position,Math.sqrt(L),l.position));var j=a.default.angleBetween(N,l.position),V=a.default.cross(N,l.position,N);a.default.normalize(V,V);var U=pa.default.fromAxisAngle(V,j,R_),B=ma.default.fromQuaternion(U,N_);ma.default.multiplyByVector(B,l.direction,l.direction),ma.default.multiplyByVector(B,l.up,l.up),a.default.cross(l.direction,l.up,l.right),a.default.cross(l.right,l.direction,l.up),l._setTransform(S)}}(e,t,i)}}var V_=new z.default,U_=new O.default,z_=new a.default;function B_(e,t,i){Object(o.default)(i.distance)&&(i=i.distance);var r=e._scene,n=r.camera,s=r.canvas,l=V_;l.x=s.clientWidth/2,l.y=s.clientHeight/2;var u,d,f=n.getPickRay(l,U_);if(n.position.z<e._minimumPickingTerrainHeight&&(u=c_(e,l,z_)),Object(o.default)(u))d=a.default.distance(f.origin,u);else{var c=a.default.UNIT_X,h=f.origin,m=f.direction;d=-a.default.dot(c,h)/a.default.dot(c,m)}e_(e,t,i,e._zoomFactor,d)}var H_=new O.default,k_=new mp.a(a.default.UNIT_X,0),W_=new a.default,G_=new a.default,Y_=new a.default;function X_(e,t,i){var r=e._scene,n=r.camera,s=c_(e,i.startPosition,Y_);if(Object(o.default)(s)){var l=i.endPosition,u=n.getPickRay(l,H_),d=a.default.clone(n.direction,G_);r.mode===N.a.COLUMBUS_VIEW&&a.default.fromElements(d.z,d.x,d.y,d);var f=mp.a.fromPointNormal(s,d,k_),c=x.default.rayPlane(u,f,W_);Object(o.default)(c)&&(d=a.default.subtract(s,c,d),r.mode===N.a.COLUMBUS_VIEW&&a.default.fromElements(d.y,d.z,d.x,d),a.default.add(n.position,d,n.position))}}var Q_=new a.default,q_=new v.default,Z_=new a.default,K_=new u.default,J_=new a.default;function $_(e,t,i){var r=e._scene.camera;if(K.default.equals(r.transform,K.default.IDENTITY)){var n,s,l,d=e._ellipsoid.geodeticSurfaceNormal(r.position,J_),f=e._ellipsoid.cartesianToCartographic(r.positionWC,q_).height,c=e._globe;if(Object(o.default)(c)&&f<e._minimumPickingTerrainHeight&&(l=c_(e,i.startPosition,Y_),Object(o.default)(l))){var h=r.getPickRay(i.startPosition,u_),m=e._ellipsoid.geodeticSurfaceNormal(l);Math.abs(a.default.dot(h.direction,m))<.05&&!e._looking&&(e._rotating=!1,e._strafing=!0)}z.default.equals(t,e._rotateMousePosition)?e._looking?Mg(e,t,i,d):e._rotating?eg(e,t,i):e._strafing?(a.default.clone(l,e._strafeStartPosition),X_(e,0,i)):(n=a.default.magnitude(e._rotateStartPosition),(s=Z_).x=s.y=s.z=n,ug(e,t,i,u.default.fromCartesian3(s,K_))):(e._looking=!1,e._rotating=!1,e._strafing=!1,Object(o.default)(c)&&f<e._minimumPickingTerrainHeight?Object(o.default)(l)?a.default.magnitude(r.position)<a.default.magnitude(l)?(a.default.clone(l,e._strafeStartPosition),e._strafing=!0,X_(e,0,i)):(n=a.default.magnitude(l),(s=Z_).x=s.y=s.z=n,ug(e,t,i,u.default.fromCartesian3(s,K_)),a.default.clone(l,e._rotateStartPosition)):(e._looking=!0,Mg(e,t,i,d)):Object(o.default)(r.pickEllipsoid(i.startPosition,e._ellipsoid,Q_))?(ug(e,t,i,e._ellipsoid),a.default.clone(Q_,e._rotateStartPosition)):f>e._minimumTrackBallHeight?(e._rotating=!0,eg(e,t,i)):(e._looking=!0,Mg(e,t,i,d)),z.default.clone(t,e._rotateMousePosition))}else eg(e,t,i)}function eg(e,t,i,r,s,l){s=Object(n.default)(s,!1),l=Object(n.default)(l,!1);var u=e._scene,d=u.camera,f=u.canvas,c=d.constrainedAxis;Object(o.default)(r)&&(d.constrainedAxis=r);var h=a.default.magnitude(d.position),m=e._rotateFactor*(h-e._rotateRateRangeAdjustment);m>e._maximumRotateRate&&(m=e._maximumRotateRate),m<e._minimumRotateRate&&(m=e._minimumRotateRate);var p=(i.startPosition.x-i.endPosition.x)/f.clientWidth,_=(i.startPosition.y-i.endPosition.y)/f.clientHeight;p=Math.min(p,e.maximumMovementRatio),_=Math.min(_,e.maximumMovementRatio);var g=m*p*Math.PI*2,v=m*_*Math.PI;s||d.rotateRight(g),l||d.rotateUp(v),d.constrainedAxis=c}var tg=B.a.clone(B.a.UNIT_W),ig=B.a.clone(B.a.UNIT_W),ag=new a.default,rg=new a.default,ng=new a.default,og=new a.default,sg=new z.default,lg=new z.default;function ug(e,t,i,r){var n=e._scene.camera,s=z.default.clone(i.startPosition,sg),l=z.default.clone(i.endPosition,lg),u=n.pickEllipsoid(s,r,tg),d=n.pickEllipsoid(l,r,ig);if(!Object(o.default)(u)||!Object(o.default)(d))return e._rotating=!0,void eg(e,0,i);if(u=n.worldToCameraCoordinates(u,u),d=n.worldToCameraCoordinates(d,d),Object(o.default)(n.constrainedAxis)){var f=n.constrainedAxis,c=a.default.mostOrthogonalAxis(f,ag);a.default.cross(c,f,c),a.default.normalize(c,c);var h=a.default.cross(f,c,rg),m=a.default.magnitude(u),p=a.default.dot(f,u),_=Math.acos(p/m),g=a.default.multiplyByScalar(f,p,ng);a.default.subtract(u,g,g),a.default.normalize(g,g);var v=a.default.magnitude(d),y=a.default.dot(f,d),b=Math.acos(y/v),w=a.default.multiplyByScalar(f,y,og);a.default.subtract(d,w,w),a.default.normalize(w,w);var x=Math.acos(a.default.dot(g,c));a.default.dot(g,h)<0&&(x=Z.default.TWO_PI-x);var O=Math.acos(a.default.dot(w,c));a.default.dot(w,h)<0&&(O=Z.default.TWO_PI-O);var C,T=x-O;C=a.default.equalsEpsilon(f,n.position,Z.default.EPSILON2)?n.right:a.default.cross(f,n.position,ag);var E,P=a.default.cross(f,C,ag),A=a.default.dot(P,a.default.subtract(u,f,rg)),S=a.default.dot(P,a.default.subtract(d,f,rg));E=A>0&&S>0?b-_:A>0&&S<=0?a.default.dot(n.position,f)>0?-_-b:_+b:_-b,n.rotateRight(T),n.rotateUp(E)}else{a.default.normalize(u,u),a.default.normalize(d,d);var D=a.default.dot(u,d),I=a.default.cross(u,d,ag);if(D<1&&!a.default.equalsEpsilon(I,a.default.ZERO,Z.default.EPSILON14)){var M=Math.acos(D);n.rotate(I,M)}}}var dg=new a.default,fg=new v.default;function cg(e,t,i){Object(o.default)(i.distance)&&(i=i.distance);var r=e._ellipsoid,n=e._scene,s=n.camera,l=n.canvas,u=V_;u.x=l.clientWidth/2,u.y=l.clientHeight/2;var d,f,c=s.getPickRay(u,U_),h=r.cartesianToCartographic(s.position,fg).height;h<e._minimumPickingTerrainHeight&&(d=c_(e,u,z_)),f=Object(o.default)(d)?a.default.distance(c.origin,d):h;var m=a.default.normalize(s.position,dg);e_(e,t,i,e._zoomFactor,f,a.default.dot(m,s.direction))}var hg=new z.default,mg=new O.default,pg=new a.default,_g=new a.default,gg=new K.default,vg=new K.default,yg=new K.default,bg=new pa.default,wg=new ma.default,xg=new v.default,Og=new a.default;function Cg(e,t,i){var r=e._scene.camera;if(K.default.equals(r.transform,K.default.IDENTITY))if(Object(o.default)(i.angleAndHeight)&&(i=i.angleAndHeight),z.default.equals(t,e._tiltCenterMousePosition)||(e._tiltOnEllipsoid=!1,e._looking=!1),e._looking){var n=e._ellipsoid.geodeticSurfaceNormal(r.position,Og);Mg(e,t,i,n)}else{var s=e._ellipsoid.cartesianToCartographic(r.position,xg);e._tiltOnEllipsoid||s.height>e._minimumCollisionTerrainHeight?(e._tiltOnEllipsoid=!0,function(e,t,i){var r=e._ellipsoid,n=e._scene,s=n.camera,l=.25*e.minimumZoomDistance,d=r.cartesianToCartographic(s.positionWC,Tg).height;if(d-l-1<Z.default.EPSILON3&&i.endPosition.y-i.startPosition.y<0)return;var f=n.canvas,c=hg;c.x=f.clientWidth/2,c.y=f.clientHeight/2;var h,m=s.getPickRay(c,mg),p=x.default.rayEllipsoid(m,r);if(Object(o.default)(p))h=O.default.getPoint(m,p.start,pg);else{if(!(d>e._minimumTrackBallHeight)){e._looking=!0;var _=e._ellipsoid.geodeticSurfaceNormal(s.position,Og);return Mg(e,t,i,_),void z.default.clone(t,e._tiltCenterMousePosition)}var g=x.default.grazingAltitudeLocation(m,r);if(!Object(o.default)(g))return;var v=r.cartesianToCartographic(g,xg);v.height=0,h=r.cartographicToCartesian(v,pg)}var y=Ur.default.eastNorthUpToFixedFrame(h,r,gg),b=e._globe,w=e._ellipsoid;e._globe=void 0,e._ellipsoid=u.default.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var C=K.default.clone(s.transform,yg);s._setTransform(y),eg(e,0,i,a.default.UNIT_Z),s._setTransform(C),e._globe=b,e._ellipsoid=w;var T=w.maximumRadius;e._rotateFactor=1/T,e._rotateRateRangeAdjustment=T}(e,t,i)):function(e,t,i){var r,n,s,l=e._ellipsoid,d=e._scene,f=d.camera;if(z.default.equals(t,e._tiltCenterMousePosition))r=a.default.clone(e._tiltCenter,pg);else{if(r=c_(e,t,pg),!Object(o.default)(r)){if(n=f.getPickRay(t,mg),s=x.default.rayEllipsoid(n,l),!Object(o.default)(s)){if(l.cartesianToCartographic(f.position,xg).height<=e._minimumTrackBallHeight){e._looking=!0;var c=e._ellipsoid.geodeticSurfaceNormal(f.position,Og);Mg(e,t,i,c),z.default.clone(t,e._tiltCenterMousePosition)}return}r=O.default.getPoint(n,s.start,pg)}z.default.clone(t,e._tiltCenterMousePosition),a.default.clone(r,e._tiltCenter)}var h=d.canvas,m=hg;m.x=h.clientWidth/2,m.y=e._tiltCenterMousePosition.y,n=f.getPickRay(m,mg);var p=a.default.magnitude(r),_=a.default.fromElements(p,p,p,Z_),g=u.default.fromCartesian3(_,K_);if(s=x.default.rayEllipsoid(n,g),!Object(o.default)(s))return;var v=a.default.magnitude(n.origin)>p?s.start:s.stop,y=O.default.getPoint(n,v,_g),b=Ur.default.eastNorthUpToFixedFrame(r,l,gg),w=Ur.default.eastNorthUpToFixedFrame(y,g,vg),C=e._globe,T=e._ellipsoid;e._globe=void 0,e._ellipsoid=u.default.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var E=a.default.UNIT_Z,P=K.default.clone(f.transform,yg);f._setTransform(b);var A=a.default.cross(y,f.positionWC,L_),S=a.default.dot(f.rightWC,A);if(eg(e,0,i,E,!1,!0),f._setTransform(w),S<0){i.startPosition.y>i.endPosition.y&&(E=void 0);var D=f.constrainedAxis;f.constrainedAxis=void 0,eg(e,0,i,E,!0,!1),f.constrainedAxis=D}else eg(e,0,i,E,!0,!1);if(Object(o.default)(f.constrainedAxis)){var I=a.default.cross(f.direction,f.constrainedAxis,L_);a.default.equalsEpsilon(I,a.default.ZERO,Z.default.EPSILON6)||(a.default.dot(I,f.right)<0&&a.default.negate(I,I),a.default.cross(I,f.direction,f.up),a.default.cross(f.direction,f.up,f.right),a.default.normalize(f.up,f.up),a.default.normalize(f.right,f.right))}f._setTransform(P),e._globe=C,e._ellipsoid=T;var M=T.maximumRadius;e._rotateFactor=1/M,e._rotateRateRangeAdjustment=M;var F=a.default.clone(f.positionWC,L_);e.enableCollisionDetection&&Ng(e);if(!a.default.equals(f.positionWC,F)){f._setTransform(w),f.worldToCameraCoordinatesPoint(F,F);var R=a.default.magnitudeSquared(F);a.default.magnitudeSquared(f.position)>R&&(a.default.normalize(f.position,f.position),a.default.multiplyByScalar(f.position,Math.sqrt(R),f.position));var N=a.default.angleBetween(F,f.position),L=a.default.cross(F,f.position,F);a.default.normalize(L,L);var j=pa.default.fromAxisAngle(L,N,bg),V=ma.default.fromQuaternion(j,wg);ma.default.multiplyByVector(V,f.direction,f.direction),ma.default.multiplyByVector(V,f.up,f.up),a.default.cross(f.direction,f.up,f.right),a.default.cross(f.right,f.direction,f.up),f._setTransform(P)}}(e,t,i)}}var Tg=new v.default;var Eg=new z.default,Pg=new z.default,Ag=new O.default,Sg=new O.default,Dg=new a.default,Ig=new a.default;function Mg(e,t,i,r){var s=e._scene.camera,l=Eg;l.x=i.startPosition.x,l.y=0;var u=Pg;u.x=i.endPosition.x,u.y=0;var d,f,c=s.getPickRay(l,Ag),h=s.getPickRay(u,Sg),m=0;s.frustum instanceof $.a?(d=c.origin,f=h.origin,a.default.add(s.direction,d,d),a.default.add(s.direction,f,f),a.default.subtract(d,s.position,d),a.default.subtract(f,s.position,f),a.default.normalize(d,d),a.default.normalize(f,f)):(d=c.direction,f=h.direction);var p=a.default.dot(d,f);p<1&&(m=Math.acos(p)),m=i.startPosition.x>i.endPosition.x?-m:m;var _=e._horizontalRotationAxis;if(Object(o.default)(r)?s.look(r,-m):Object(o.default)(_)?s.look(_,-m):s.lookLeft(m),l.x=0,l.y=i.startPosition.y,u.x=0,u.y=i.endPosition.y,c=s.getPickRay(l,Ag),h=s.getPickRay(u,Sg),m=0,s.frustum instanceof $.a?(d=c.origin,f=h.origin,a.default.add(s.direction,d,d),a.default.add(s.direction,f,f),a.default.subtract(d,s.position,d),a.default.subtract(f,s.position,f),a.default.normalize(d,d),a.default.normalize(f,f)):(d=c.direction,f=h.direction),(p=a.default.dot(d,f))<1&&(m=Math.acos(p)),m=i.startPosition.y>i.endPosition.y?-m:m,r=Object(n.default)(r,_),Object(o.default)(r)){var g=s.direction,v=a.default.negate(r,Dg),y=a.default.equalsEpsilon(g,r,Z.default.EPSILON2),b=a.default.equalsEpsilon(g,v,Z.default.EPSILON2);if(y||b)(y&&m<0||b&&m>0)&&s.look(s.right,-m);else{p=a.default.dot(g,r);var w=Z.default.acosClamped(p);m>0&&m>w&&(m=w-Z.default.EPSILON4),p=a.default.dot(g,v),w=Z.default.acosClamped(p),m<0&&-m>w&&(m=-w+Z.default.EPSILON4);var x=a.default.cross(r,g,Ig);s.look(x,m)}}else s.lookUp(m)}var Fg=new K.default,Rg=new v.default;function Ng(e){e._adjustedHeightForTerrain=!0;var t=e._scene,i=t.mode,r=t.globe;if(Object(o.default)(r)&&i!==N.a.SCENE2D&&i!==N.a.MORPHING){var n,s,l=t.camera,u=r.ellipsoid,d=t.mapProjection;K.default.equals(l.transform,K.default.IDENTITY)||(n=K.default.clone(l.transform,Fg),s=a.default.magnitude(l.position),l._setTransform(K.default.IDENTITY));var f=Rg;i===N.a.SCENE3D?u.cartesianToCartographic(l.position,f):d.unproject(l.position,f);var c=!1;if(f.height<e._minimumCollisionTerrainHeight){var h=r.getHeight(f);Object(o.default)(h)&&(h+=e.minimumZoomDistance,f.height<h&&(f.height=h,i===N.a.SCENE3D?u.cartographicToCartesian(f,l.position):d.project(f,l.position),c=!0))}Object(o.default)(n)&&(l._setTransform(n),c&&(a.default.normalize(l.position,l.position),a.default.negate(l.position,l.direction),a.default.multiplyByScalar(l.position,Math.max(s,e.minimumZoomDistance),l.position),a.default.normalize(l.direction,l.direction),a.default.cross(l.direction,l.up,l.right),a.default.cross(l.right,l.direction,l.up)))}}Tp.prototype.onMap=function(){var e=this._scene,t=e.mode,i=e.camera;return t!==N.a.COLUMBUS_VIEW||Math.abs(i.position.x)-this._maxCoord.x<0&&Math.abs(i.position.y)-this._maxCoord.y<0};var Lg=new a.default,jg=new a.default;Tp.prototype.update=function(){var e=this._scene.camera;K.default.equals(e.transform,K.default.IDENTITY)?(this._globe=this._scene.globe,this._ellipsoid=Object(o.default)(this._globe)?this._globe.ellipsoid:this._scene.mapProjection.ellipsoid):(this._globe=void 0,this._ellipsoid=u.default.UNIT_SPHERE),this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight*this._scene.terrainExaggeration,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight*this._scene.terrainExaggeration,this._minimumTrackBallHeight=this.minimumTrackBallHeight*this._scene.terrainExaggeration;var t=this._ellipsoid.maximumRadius;this._rotateFactor=1/t,this._rotateRateRangeAdjustment=t,this._adjustedHeightForTerrain=!1;var i,r,n=a.default.clone(e.positionWC,Lg),s=a.default.clone(e.directionWC,jg),l=this._scene.mode;(l===N.a.SCENE2D?(r=(i=this)._scene.mapMode2D===Ho.ROTATE,K.default.equals(K.default.IDENTITY,i._scene.camera.transform)?(Sp(i,i.enableTranslate,i.translateEventTypes,r_,i.inertiaTranslate,"_lastInertiaTranslateMovement"),Sp(i,i.enableZoom,i.zoomEventTypes,n_,i.inertiaZoom,"_lastInertiaZoomMovement"),r&&Sp(i,i.enableRotate,i.tiltEventTypes,l_,i.inertiaSpin,"_lastInertiaTiltMovement")):(Sp(i,i.enableZoom,i.zoomEventTypes,n_,i.inertiaZoom,"_lastInertiaZoomMovement"),r&&Sp(i,i.enableRotate,i.translateEventTypes,l_,i.inertiaSpin,"_lastInertiaSpinMovement"))):l===N.a.COLUMBUS_VIEW?(this._horizontalRotationAxis=a.default.UNIT_Z,function(e){var t=e._scene.camera;if(K.default.equals(K.default.IDENTITY,t.transform)){var i=e._tweens;if(e._aggregator.anyButtonDown&&i.removeAll(),Sp(e,e.enableTilt,e.tiltEventTypes,j_,e.inertiaSpin,"_lastInertiaTiltMovement"),Sp(e,e.enableTranslate,e.translateEventTypes,x_,e.inertiaTranslate,"_lastInertiaTranslateMovement"),Sp(e,e.enableZoom,e.zoomEventTypes,B_,e.inertiaZoom,"_lastInertiaZoomMovement"),Sp(e,e.enableLook,e.lookEventTypes,Mg),!(e._aggregator.anyButtonDown||Object(o.default)(e._lastInertiaZoomMovement)&&e._lastInertiaZoomMovement.active||Object(o.default)(e._lastInertiaTranslateMovement)&&e._lastInertiaTranslateMovement.active||i.contains(e._tween))){var a=t.createCorrectPositionTween(e.bounceAnimationTime);Object(o.default)(a)&&(e._tween=i.add(a))}i.update()}else Sp(e,e.enableRotate,e.rotateEventTypes,eg,e.inertiaSpin,"_lastInertiaSpinMovement"),Sp(e,e.enableZoom,e.zoomEventTypes,cg,e.inertiaZoom,"_lastInertiaZoomMovement")}(this)):l===N.a.SCENE3D&&(this._horizontalRotationAxis=void 0,function(e){Sp(e,e.enableRotate,e.rotateEventTypes,$_,e.inertiaSpin,"_lastInertiaSpinMovement"),Sp(e,e.enableZoom,e.zoomEventTypes,cg,e.inertiaZoom,"_lastInertiaZoomMovement"),Sp(e,e.enableTilt,e.tiltEventTypes,Cg,e.inertiaSpin,"_lastInertiaTiltMovement"),Sp(e,e.enableLook,e.lookEventTypes,Mg)}(this)),this.enableCollisionDetection&&!this._adjustedHeightForTerrain)&&((!a.default.equals(n,e.positionWC)||!a.default.equals(s,e.directionWC))&&Ng(this));this._aggregator.reset()},Tp.prototype.adjustedHeightForTerrain=function(){return this._adjustedHeightForTerrain},Tp.prototype.isDestroyed=function(){return!1},Tp.prototype.destroy=function(){return this._tweens.removeAll(),this._aggregator=this._aggregator&&this._aggregator.destroy(),Object(s.default)(this)};var Vg=Tp,Ug="uniform sampler2D colorTexture;\nuniform sampler2D colorTexture2;\n\nuniform vec2 center;\nuniform float radius;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    vec4 color0 = texture2D(colorTexture, v_textureCoordinates);\n    vec4 color1 = texture2D(colorTexture2, v_textureCoordinates);\n\n    float x = length(gl_FragCoord.xy - center) / radius;\n    float t = smoothstep(0.5, 0.8, x);\n    gl_FragColor = mix(color0 + color1, color1, t);\n}\n",zg='uniform sampler2D colorTexture;\n\nuniform float avgLuminance;\nuniform float threshold;\nuniform float offset;\n\nvarying vec2 v_textureCoordinates;\n\nfloat key(float avg)\n{\n    float guess = 1.5 - (1.5 / (avg * 0.1 + 1.0));\n    return max(0.0, guess) + 0.1;\n}\n\n// See section 9. "The bright-pass filter" of Realtime HDR Rendering\n// http://www.cg.tuwien.ac.at/research/publications/2007/Luksch_2007_RHR/Luksch_2007_RHR-RealtimeHDR%20.pdf\n\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    vec3 xyz = czm_RGBToXYZ(color.rgb);\n    float luminance = xyz.r;\n\n    float scaledLum = key(avgLuminance) * luminance / avgLuminance;\n    float brightLum = max(scaledLum - threshold, 0.0);\n    float brightness = brightLum / (offset + brightLum);\n\n    xyz.r = brightness;\n    gl_FragColor = vec4(czm_XYZToRGB(xyz), 1.0);\n}\n';function Bg(){this._sceneFramebuffer=new Mf;var e=new Array(6);e[0]=new Vh({fragmentShader:gd,textureScale:.125,forcePowerOfTwo:!0,sampleMode:Sh.LINEAR});var t=e[1]=new Vh({fragmentShader:zg,uniforms:{avgLuminance:.5,threshold:.25,offset:.1},textureScale:.125,forcePowerOfTwo:!0}),i=this;this._delta=1,this._sigma=2,this._blurStep=new z.default,e[2]=new Vh({fragmentShader:xh,uniforms:{step:function(){return i._blurStep.x=i._blurStep.y=1/t.outputTexture.width,i._blurStep},delta:function(){return i._delta},sigma:function(){return i._sigma},direction:0},textureScale:.125,forcePowerOfTwo:!0}),e[3]=new Vh({fragmentShader:xh,uniforms:{step:function(){return i._blurStep.x=i._blurStep.y=1/t.outputTexture.width,i._blurStep},delta:function(){return i._delta},sigma:function(){return i._sigma},direction:1},textureScale:.125,forcePowerOfTwo:!0}),e[4]=new Vh({fragmentShader:gd,sampleMode:Sh.LINEAR}),this._uCenter=new z.default,this._uRadius=void 0,e[5]=new Vh({fragmentShader:Ug,uniforms:{center:function(){return i._uCenter},radius:function(){return i._uRadius},colorTexture2:function(){return i._sceneFramebuffer.getFramebuffer().getColorTexture(0)}}}),this._stages=new zh({stages:e});for(var a=new Kh(this),r=e.length,n=0;n<r;++n)e[n]._textureCache=a;this._textureCache=a,this.length=e.length}Bg.prototype.get=function(e){return this._stages.get(e)},Bg.prototype.getStageByName=function(e){for(var t=this._stages.length,i=0;i<t;++i){var a=this._stages.get(i);if(a.name===e)return a}};var Hg=new B.a,kg=new z.default,Wg=new z.default,Gg=new K.default;Bg.prototype.clear=function(e,t,i){this._sceneFramebuffer.clear(e,t,i),this._textureCache.clear(e)},Bg.prototype.update=function(e){var t=e.context,i=e.viewport,a=this._sceneFramebuffer;a.update(t,i);var r=a.getFramebuffer();return this._textureCache.update(t),this._stages.update(t,!1),function(e,t,i){var a=t.uniformState,r=a.sunPositionWC,n=a.view,o=a.viewProjection,s=a.projection,l=K.default.computeViewportTransformation(i,0,1,Gg),u=K.default.multiplyByPoint(n,r,Hg),d=Ur.default.pointToGLWindowCoordinates(o,l,r,kg);u.x+=Z.default.SOLAR_RADIUS;var f=Ur.default.pointToGLWindowCoordinates(s,l,u,u),c=30*z.default.magnitude(z.default.subtract(f,d,f))*2,h=Wg;h.x=c,h.y=c,e._uCenter=z.default.clone(d,e._uCenter),e._uRadius=.15*Math.max(h.x,h.y);var m=t.drawingBufferWidth,p=t.drawingBufferHeight,_=e._stages,g=_.get(0),v=g.outputTexture.width,y=g.outputTexture.height,b=new an.default;b.width=v,b.height=y,l=K.default.computeViewportTransformation(b,0,1,Gg),d=Ur.default.pointToGLWindowCoordinates(o,l,r,kg),h.x*=v/m,h.y*=y/p;var w=g.scissorRectangle;w.x=Math.max(d.x-.5*h.x,0),w.y=Math.max(d.y-.5*h.y,0),w.width=Math.min(h.x,m),w.height=Math.min(h.y,p);for(var x=1;x<4;++x)an.default.clone(w,_.get(x).scissorRectangle)}(this,t,i),r},Bg.prototype.execute=function(e){var t=this._sceneFramebuffer.getFramebuffer().getColorTexture(0),i=this._stages,a=i.length;i.get(0).execute(e,t);for(var r=1;r<a;++r)i.get(r).execute(e,i.get(r-1).outputTexture)},Bg.prototype.copy=function(e,t){if(!Object(o.default)(this._copyColorCommand)){var i=this;this._copyColorCommand=e.createViewportQuadCommand(gd,{uniformMap:{colorTexture:function(){return i._stages.get(i._stages.length-1).outputTexture}},owner:this})}this._copyColorCommand.framebuffer=t,this._copyColorCommand.execute(e)},Bg.prototype.isDestroyed=function(){return!1},Bg.prototype.destroy=function(){return this._textureCache.destroy(),this._stages.destroy(),Object(s.default)(this)};var Yg=Bg,Xg=function(e){return function(){e.frameState.afterRender.push((function(){e.requestRender()}))}};function Qg(e){var t=(e=Object(n.default)(e,n.default.EMPTY_OBJECT)).canvas,i=e.creditContainer,a=e.creditViewport,r=Object(H.default)(e.contextOptions);Object(o.default)(r)||(r={}),Object(o.default)(r.webgl)||(r.webgl={}),r.webgl.powerPreference=Object(n.default)(r.webgl.powerPreference,"high-performance");var s=Object(o.default)(i),l=new Fo(t,r);s||((i=document.createElement("div")).style.position="absolute",i.style.bottom="0",i.style["text-shadow"]="0 0 2px #000000",i.style.color="#ffffff",i.style["font-size"]="10px",i.style["padding-right"]="5px",t.parentNode.appendChild(i)),Object(o.default)(a)||(a=t.parentNode),this._id=Object(rn.default)(),this._jobScheduler=new Vd,this._frameState=new _d(l,new Kl.default(i,"  ",a),this._jobScheduler),this._frameState.scene3DOnly=Object(n.default)(e.scene3DOnly,!1),this._removeCreditContainer=!s,this._creditContainer=i,this._canvas=t,this._context=l,this._computeEngine=new Vn(l),this._globe=void 0,this._primitives=new $d.a,this._groundPrimitives=new $d.a,this._logDepthBuffer=l.fragmentDepth,this._logDepthBufferDirty=!0,this._tweens=new Cp.default,this._shaderFrameCount=0,this._sunPostProcess=void 0,this._computeCommandList=[],this._overlayCommandList=[],this._useOIT=Object(n.default)(e.orderIndependentTranslucency,!0),this._executeOITFunction=void 0,this._depthPlane=new Xu,this._clearColorCommand=new Mn.a({color:new k.default,stencil:0,owner:this}),this._depthClearCommand=new Mn.a({depth:1,owner:this}),this._stencilClearCommand=new Mn.a({stencil:0}),this._classificationStencilClearCommand=new Mn.a({stencil:0,renderState:ue.a.fromCache({stencilMask:yd.a.CLASSIFICATION_MASK})}),this._depthOnlyRenderStateCache={},this._transitioner=new cp(this),this._preUpdate=new b.default,this._postUpdate=new b.default,this._renderError=new b.default,this._preRender=new b.default,this._postRender=new b.default,this._minimumDisableDepthTestDistance=0,this.rethrowRenderErrors=!1,this.completeMorphOnUserInput=!0,this.morphStart=new b.default,this.morphComplete=new b.default,this.skyBox=void 0,this.skyAtmosphere=void 0,this.sun=void 0,this.sunBloom=!0,this._sunBloom=void 0,this.moon=void 0,this.backgroundColor=k.default.clone(k.default.BLACK),this._mode=N.a.SCENE3D,this._mapProjection=Object(o.default)(e.mapProjection)?e.mapProjection:new ln.a,this.morphTime=1,this.farToNearRatio=1e3,this.logarithmicDepthFarToNearRatio=1e9,this.nearToFarDistance2D=175e4,this.debugCommandFilter=void 0,this.debugShowCommands=!1,this.debugShowFrustums=!1,this.debugShowFramesPerSecond=!1,this.debugShowGlobeDepth=!1,this.debugShowDepthFrustum=1,this.debugShowFrustumPlanes=!1,this._debugShowFrustumPlanes=!1,this._debugFrustumPlanes=void 0,this.useDepthPicking=!0,this.pickTranslucentDepth=!1,this.cameraEventWaitTime=500,this.fog=new pd,this._shadowMapCamera=new Ql(this),this.shadowMap=new bc({context:l,lightCamera:this._shadowMapCamera,enabled:Object(n.default)(e.shadows,!1)}),this.invertClassification=!1,this.invertClassificationColor=k.default.clone(k.default.WHITE),this._actualInvertClassificationColor=k.default.clone(this._invertClassificationColor),this._invertClassification=new Rd,this.focalLength=void 0,this.eyeSeparation=void 0,this.postProcessStages=new nm,this._brdfLutGenerator=new Lo,this._terrainExaggeration=Object(n.default)(e.terrainExaggeration,1),this._performanceDisplay=void 0,this._debugVolume=void 0,this._screenSpaceCameraController=new Vg(this),this._cameraUnderground=!1,this._mapMode2D=Object(n.default)(e.mapMode2D,Ho.INFINITE_SCROLL),this._environmentState={skyBoxCommand:void 0,skyAtmosphereCommand:void 0,sunDrawCommand:void 0,sunComputeCommand:void 0,moonCommand:void 0,isSunVisible:!1,isMoonVisible:!1,isReadyForAtmosphere:!1,isSkyAtmosphereVisible:!1,clearGlobeDepth:!1,useDepthPlane:!1,renderTranslucentDepthForPick:!1,originalFramebuffer:void 0,useGlobeDepthFramebuffer:!1,separatePrimitiveFramebuffer:!1,useOIT:!1,useInvertClassification:!1,usePostProcess:!1,usePostProcessSelected:!1,useWebVR:!1},this._useWebVR=!1,this._cameraVR=void 0,this._aspectRatioVR=void 0,this.requestRenderMode=Object(n.default)(e.requestRenderMode,!1),this._renderRequested=!0,this.maximumRenderTimeChange=Object(n.default)(e.maximumRenderTimeChange,0),this._lastRenderTime=void 0,this._frameRateMonitor=void 0,this._removeRequestListenerCallback=Dn.a.requestCompletedEvent.addEventListener(Xg(this)),this._removeTaskProcessorListenerCallback=In.default.taskCompletedEvent.addEventListener(Xg(this)),this._removeGlobeCallbacks=[];var u=new an.default(0,0,l.drawingBufferWidth,l.drawingBufferHeight),d=new Ql(this);this._logDepthBuffer&&(d.frustum.near=.1,d.frustum.far=1e10),this.preloadFlightCamera=new Ql(this),this.preloadFlightCullingVolume=void 0,this._picking=new bh(this),this._defaultView=new Sc(this,d,u),this._view=this._defaultView,this._hdr=void 0,this._hdrDirty=void 0,this.highDynamicRange=!1,this.gamma=2.2,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this._specularEnvironmentMapAtlas=void 0,this.light=new io,av(this,0,ia.default.now()),this.updateFrameState(),this.initializeFrame()}var qg=new B.a;function Zg(e,t,i){var a=e._frameState,r=e._context,n=e._view.oit,s=a.shadowState.lightShadowMaps,l=a.shadowState.lightShadowsEnabled,u=t.derivedCommands;Object(o.default)(t.pickId)&&(u.picking=ed.createPickDerivedCommand(e,t,r,u.picking)),t.pickOnly||(u.depth=ed.createDepthOnlyDerivedCommand(e,t,r,u.depth)),u.originalCommand=t,e._hdr&&(u.hdr=ed.createHdrCommand(t,r,u.hdr),u=(t=u.hdr.command).derivedCommands),l&&t.receiveShadows&&(u.shadows=bc.createReceiveDerivedCommand(s,t,i,r,u.shadows)),t.pass===le.a.TRANSLUCENT&&Object(o.default)(n)&&n.isSupported()&&(l&&t.receiveShadows?(u.oit=Object(o.default)(u.oit)?u.oit:{},u.oit.shadows=n.createDerivedCommands(u.shadows.receiveCommand,r,u.oit.shadows)):u.oit=n.createDerivedCommands(t,r,u.oit))}Object.defineProperties(Qg.prototype,{canvas:{get:function(){return this._canvas}},drawingBufferHeight:{get:function(){return this._context.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._context.drawingBufferWidth}},maximumAliasedLineWidth:{get:function(){return oe.a.maximumAliasedLineWidth}},maximumCubeMapSize:{get:function(){return oe.a.maximumCubeMapSize}},pickPositionSupported:{get:function(){return this._context.depthTexture}},sampleHeightSupported:{get:function(){return this._context.depthTexture}},clampToHeightSupported:{get:function(){return this._context.depthTexture}},invertClassificationSupported:{get:function(){return this._context.depthTexture}},specularEnvironmentMapsSupported:{get:function(){return Ud.a.isSupported(this._context)}},globe:{get:function(){return this._globe},set:function(e){this._globe=this._globe&&this._globe.destroy(),this._globe=e,function(e,t){for(var i=0;i<e._removeGlobeCallbacks.length;++i)e._removeGlobeCallbacks[i]();e._removeGlobeCallbacks.length=0;var a=[];Object(o.default)(t)&&(a.push(t.imageryLayersUpdatedEvent.addEventListener(Xg(e))),a.push(t.terrainProviderChanged.addEventListener(Xg(e)))),e._removeGlobeCallbacks=a}(this,e)}},primitives:{get:function(){return this._primitives}},groundPrimitives:{get:function(){return this._groundPrimitives}},camera:{get:function(){return this._view.camera},set:function(e){this._view.camera=e}},view:{get:function(){return this._view},set:function(e){this._view=e}},defaultView:{get:function(){return this._defaultView}},picking:{get:function(){return this._picking}},screenSpaceCameraController:{get:function(){return this._screenSpaceCameraController}},mapProjection:{get:function(){return this._mapProjection}},jobScheduler:{get:function(){return this._jobScheduler}},frameState:{get:function(){return this._frameState}},environmentState:{get:function(){return this._environmentState}},tweens:{get:function(){return this._tweens}},imageryLayers:{get:function(){if(Object(o.default)(this.globe))return this.globe.imageryLayers}},terrainProvider:{get:function(){if(Object(o.default)(this.globe))return this.globe.terrainProvider},set:function(e){Object(o.default)(this.globe)&&(this.globe.terrainProvider=e)}},terrainProviderChanged:{get:function(){if(Object(o.default)(this.globe))return this.globe.terrainProviderChanged}},preUpdate:{get:function(){return this._preUpdate}},postUpdate:{get:function(){return this._postUpdate}},renderError:{get:function(){return this._renderError}},preRender:{get:function(){return this._preRender}},postRender:{get:function(){return this._postRender}},lastRenderTime:{get:function(){return this._lastRenderTime}},context:{get:function(){return this._context}},debugFrustumStatistics:{get:function(){return this._view.debugFrustumStatistics}},scene3DOnly:{get:function(){return this._frameState.scene3DOnly}},orderIndependentTranslucency:{get:function(){return this._useOIT}},id:{get:function(){return this._id}},mode:{get:function(){return this._mode},set:function(e){e===N.a.SCENE2D?this.morphTo2D(0):e===N.a.SCENE3D?this.morphTo3D(0):e===N.a.COLUMBUS_VIEW&&this.morphToColumbusView(0),this._mode=e}},frustumCommandsList:{get:function(){return this._view.frustumCommandsList}},numberOfFrustums:{get:function(){return this._view.frustumCommandsList.length}},terrainExaggeration:{get:function(){return this._terrainExaggeration}},useWebVR:{get:function(){return this._useWebVR},set:function(e){this._useWebVR=e,this._useWebVR?(this._frameState.creditDisplay.container.style.visibility="hidden",this._cameraVR=new Ql(this),Object(o.default)(this._deviceOrientationCameraController)||(this._deviceOrientationCameraController=new nd(this)),this._aspectRatioVR=this.camera.frustum.aspectRatio):(this._frameState.creditDisplay.container.style.visibility="visible",this._cameraVR=void 0,this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this.camera.frustum.aspectRatio=this._aspectRatioVR,this.camera.frustum.xOffset=0)}},mapMode2D:{get:function(){return this._mapMode2D}},imagerySplitPosition:{get:function(){return this._frameState.imagerySplitPosition},set:function(e){this._frameState.imagerySplitPosition=e}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance},set:function(e){this._minimumDisableDepthTestDistance=e}},logarithmicDepthBuffer:{get:function(){return this._logDepthBuffer},set:function(e){e=this._context.fragmentDepth&&e,this._logDepthBuffer!==e&&(this._logDepthBuffer=e,this._logDepthBufferDirty=!0,this._defaultView.updateFrustums=!0)}},gamma:{get:function(){return this._context.uniformState.gamma},set:function(e){this._context.uniformState.gamma=e}},highDynamicRange:{get:function(){return this._hdr},set:function(e){var t=this._context,i=e&&t.depthTexture&&(t.colorBufferFloat||t.colorBufferHalfFloat);this._hdrDirty=i!==this._hdr,this._hdr=i}},highDynamicRangeSupported:{get:function(){var e=this._context;return e.depthTexture&&(e.colorBufferFloat||e.colorBufferHalfFloat)}},sunColor:{get:function(){return Object(on.default)("sun-color-removed","scene.sunColor will be removed in Cesium 1.69. Use scene.light.color and scene.light.intensity instead."),this.light.color},set:function(e){Object(on.default)("sun-color-removed","scene.sunColor will be removed in Cesium 1.69. Use scene.light.color and scene.light.intensity instead.");var t=a.default.maximumComponent(e),i=B.a.fromElements(e.x,e.y,e.z,1,qg),r=1;t>1&&(a.default.divideByScalar(i,t,i),r=t),this.light.color=k.default.fromCartesian4(i,this.light.color),this.light.intensity=r}},pixelRatio:{get:function(){return this._frameState.pixelRatio},set:function(e){this._frameState.pixelRatio=e}},opaqueFrustumNearOffset:{get:function(){return this._frameState.useLogDepth?.9:.9999}}}),Qg.prototype.getCompressedTextureFormatSupported=function(e){var t=this.context;return("WEBGL_compressed_texture_s3tc"===e||"s3tc"===e)&&t.s3tc||("WEBGL_compressed_texture_pvrtc"===e||"pvrtc"===e)&&t.pvrtc||("WEBGL_compressed_texture_etc1"===e||"etc1"===e)&&t.etc1},Qg.prototype.updateDerivedCommands=function(e){if(Object(o.default)(e.derivedCommands)){var t=this._frameState,i=this._context,a=!1,r=t.shadowState.lastDirtyTime;e.lastDirtyTime!==r&&(e.lastDirtyTime=r,e.dirty=!0,a=!0);var n=t.useLogDepth,s=this._hdr,l=e.derivedCommands,u=Object(o.default)(l.logDepth),d=Object(o.default)(l.hdr),f=Object(o.default)(l.originalCommand),c=n&&!u,h=s&&!d,m=!(n&&s||f);if(e.dirty=e.dirty||c||h||m,e.dirty){e.dirty=!1;var p=t.shadowState.shadowMaps;t.shadowState.shadowsEnabled&&e.castShadows&&(l.shadows=bc.createCastDerivedCommand(p,e,a,i,l.shadows)),(u||c)&&(l.logDepth=ed.createLogDepthCommand(e,i,l.logDepth),Zg(this,l.logDepth.command,a)),(f||m)&&Zg(this,e,a)}}};var Kg,Jg=new Zl({pass:ql.a.RENDER}),$g=new Zl({pass:ql.a.PRELOAD}),ev=new Zl({pass:ql.a.PRELOAD_FLIGHT}),tv=new Zl({pass:ql.a.REQUEST_RENDER_MODE_DEFER_CHECK}),iv=new g.default;function av(e,t,i){var a=e._frameState;a.frameNumber=t,a.time=ia.default.clone(i,a.time)}function rv(e,t,i){var a=se.a.shallowClone(e);a.shaderProgram=function(e,t,i){var a=t.context,r=Object(n.default)(i,e.shaderProgram),s=r.fragmentShaderSource.clone(),l=[];s.sources=s.sources.map((function(e){e=E.a.replaceMain(e,"czm_Debug_main");for(var t,i=/gl_FragData\[(\d+)\]/g;null!==(t=i.exec(e));)-1===l.indexOf(t[1])&&l.push(t[1]);return e}));var u,d=l.length,f="void main() \n{ \n    czm_Debug_main(); \n";if(t.debugShowCommands){Object(o.default)(e._debugColor)||(e._debugColor=k.default.fromRandom());var c=e._debugColor;if(d>0)for(u=0;u<d;++u)f+="    gl_FragData["+l[u]+"].rgb *= vec3("+c.red+", "+c.green+", "+c.blue+"); \n";else f+="    gl_FragColor.rgb *= vec3("+c.red+", "+c.green+", "+c.blue+"); \n"}if(t.debugShowFrustums){var h=1&e.debugOverlappingFrustums?"1.0":"0.0",m=2&e.debugOverlappingFrustums?"1.0":"0.0",p=4&e.debugOverlappingFrustums?"1.0":"0.0";if(d>0)for(u=0;u<d;++u)f+="    gl_FragData["+l[u]+"].rgb *= vec3("+h+", "+m+", "+p+"); \n";else f+="    gl_FragColor.rgb *= vec3("+h+", "+m+", "+p+"); \n"}f+="}",s.sources.push(f);var _=function(e){var t={},i=e.vertexAttributes;for(var a in i)i.hasOwnProperty(a)&&(t[a]=i[a].index);return t}(r);return F.a.fromCache({context:a,vertexShaderSource:r.vertexShaderSource,fragmentShaderSource:s,attributeLocations:_})}(e,t),a.execute(t.context,i),a.shaderProgram.destroy()}Qg.prototype.clearPasses=function(e){e.render=!1,e.pick=!1,e.depth=!1,e.postProcess=!1,e.offscreen=!1},Qg.prototype.updateFrameState=function(){var e=this.camera,t=this._frameState;t.commandList.length=0,t.shadowMaps.length=0,t.brdfLutGenerator=this._brdfLutGenerator,t.environmentMap=this.skyBox&&this.skyBox._cubeMap,t.mode=this._mode,t.morphTime=this.morphTime,t.mapProjection=this.mapProjection,t.camera=e,t.cullingVolume=e.frustum.computeCullingVolume(e.positionWC,e.directionWC,e.upWC),t.occluder=function(e){var t=e.globe;if(e._mode===N.a.SCENE3D&&Object(o.default)(t)&&t.show&&!e._cameraUnderground){var i=t.ellipsoid,a=e.frameState.minimumTerrainHeight;return iv.radius=i.minimumRadius+a,Kg=Pn.fromBoundingSphere(iv,e.camera.positionWC,Kg)}}(this),t.terrainExaggeration=this._terrainExaggeration,t.minimumTerrainHeight=0,t.minimumDisableDepthTestDistance=this._minimumDisableDepthTestDistance,t.invertClassification=this.invertClassification,t.useLogDepth=this._logDepthBuffer&&!(this.camera.frustum instanceof $.a||this.camera.frustum instanceof fi.a),t.light=this.light,t.cameraUnderground=this._cameraUnderground,Object(o.default)(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready?(t.specularEnvironmentMaps=this._specularEnvironmentMapAtlas.texture,t.specularEnvironmentMapsMaximumLOD=this._specularEnvironmentMapAtlas.maximumMipmapLevel):(t.specularEnvironmentMaps=void 0,t.specularEnvironmentMapsMaximumLOD=void 0),t.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients,this._actualInvertClassificationColor=k.default.clone(this.invertClassificationColor,this._actualInvertClassificationColor),Rd.isTranslucencySupported(this._context)||(this._actualInvertClassificationColor.alpha=1),t.invertClassificationColor=this._actualInvertClassificationColor,Object(o.default)(this.globe)?t.maximumScreenSpaceError=this.globe.maximumScreenSpaceError:t.maximumScreenSpaceError=2,this.clearPasses(t.passes),t.tilesetPassState=void 0},Qg.prototype.isVisible=function(e,t,i){return Object(o.default)(e)&&(!Object(o.default)(e.boundingVolume)||!e.cull||t.computeVisibility(e.boundingVolume)!==q.default.OUTSIDE&&(!Object(o.default)(i)||!e.occlude||!e.boundingVolume.isOccluded(i)))};var nv=new K.default(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);function ov(e,t,i,r,n){var s=t._frameState;if(!Object(o.default)(t.debugCommandFilter)||t.debugCommandFilter(e))if(e instanceof Mn.a)e.execute(i,r);else{e.debugShowBoundingVolume&&Object(o.default)(e.boundingVolume)&&function(e,t,i,r){var n,s=t._frameState,l=s.context,u=e.boundingVolume;Object(o.default)(t._debugVolume)&&t._debugVolume.destroy();var d=a.default.clone(u.center);if(s.mode!==N.a.SCENE3D){d=K.default.multiplyByPoint(nv,d,d);var f=s.mapProjection,c=f.unproject(d);d=f.ellipsoid.cartographicToCartesian(c)}if(Object(o.default)(u.radius)){var h=u.radius;n=X.a.toWireframe(sn.a.createGeometry(new sn.a({radii:new a.default(h,h,h),vertexFormat:Ne.a.FLAT_VERTEX_FORMAT}))),t._debugVolume=new Le.a({geometryInstances:new Y.a({geometry:n,modelMatrix:K.default.fromTranslation(d),attributes:{color:new W.a(1,0,0,1)}}),appearance:new Ne.a({flat:!0,translucent:!1}),asynchronous:!1})}else{var m=u.halfAxes;n=X.a.toWireframe(zr.a.createGeometry(zr.a.fromDimensions({dimensions:new a.default(2,2,2),vertexFormat:Ne.a.FLAT_VERTEX_FORMAT}))),t._debugVolume=new Le.a({geometryInstances:new Y.a({geometry:n,modelMatrix:K.default.fromRotationTranslation(m,d,new K.default),attributes:{color:new W.a(1,0,0,1)}}),appearance:new Ne.a({flat:!0,translucent:!1}),asynchronous:!1})}var p,_=s.commandList,g=s.commandList=[];t._debugVolume.update(s),e=g[0],s.useLogDepth&&(e=ed.createLogDepthCommand(e,l).command),Object(o.default)(r)&&(p=i.framebuffer,i.framebuffer=r),e.execute(l,i),Object(o.default)(p)&&(i.framebuffer=p),s.commandList=_}(e,t,r,n),s.useLogDepth&&Object(o.default)(e.derivedCommands.logDepth)&&(e=e.derivedCommands.logDepth.command);var l=s.passes;if(!l.pick&&t._hdr&&Object(o.default)(e.derivedCommands)&&Object(o.default)(e.derivedCommands.hdr)&&(e=e.derivedCommands.hdr.command),l.pick||l.depth){if(l.pick&&!l.depth&&Object(o.default)(e.derivedCommands.picking))return void(e=e.derivedCommands.picking.pickCommand).execute(i,r);if(Object(o.default)(e.derivedCommands.depth))return void(e=e.derivedCommands.depth.depthOnlyCommand).execute(i,r)}t.debugShowCommands||t.debugShowFrustums?rv(e,t,r):s.shadowState.lightShadowsEnabled&&e.receiveShadows&&Object(o.default)(e.derivedCommands.shadows)?e.derivedCommands.shadows.receiveCommand.execute(i,r):e.execute(i,r)}}function sv(e,t,i,a){var r=t._frameState,n=e.derivedCommands;Object(o.default)(n)&&(r.useLogDepth&&Object(o.default)(n.logDepth)&&(e=n.logDepth.command),n=e.derivedCommands,Object(o.default)(n.picking)?(e=n.picking.pickCommand).execute(i,a):Object(o.default)(n.depth)&&(e=n.depth.depthOnlyCommand).execute(i,a))}function lv(e,t,i){return t.boundingVolume.distanceSquaredTo(i)-e.boundingVolume.distanceSquaredTo(i)}function uv(e,t,i){return e.boundingVolume.distanceSquaredTo(i)-t.boundingVolume.distanceSquaredTo(i)+Z.default.EPSILON12}function dv(e,t,i,a,r){var n=e.context;cn(a,lv,e.camera.positionWC),Object(o.default)(r)&&t(r.unclassifiedCommand,e,n,i);for(var s=a.length,l=0;l<s;++l)t(a[l],e,n,i)}function fv(e,t,i,a,r){var n=e.context;cn(a,uv,e.camera.positionWC),Object(o.default)(r)&&t(r.unclassifiedCommand,e,n,i);for(var s=a.length,l=0;l<s;++l)t(a[l],e,n,i)}function cv(e,t){var i=e._view.debugGlobeDepths,a=i[t];return!Object(o.default)(a)&&e.context.depthTexture&&(a=new Sd,i[t]=a),a}nv=K.default.inverseTransformation(nv,nv);var hv=new An.a,mv=new Sn.a,pv=new $.a,_v=new fi.a;function gv(e,t){var i,a=e.camera,r=e.context,n=r.uniformState;n.updateCamera(a),(i=Object(o.default)(a.frustum.fov)?a.frustum.clone(hv):Object(o.default)(a.frustum.infiniteProjectionMatrix)?a.frustum.clone(mv):Object(o.default)(a.frustum.width)?a.frustum.clone(pv):a.frustum.clone(_v)).near=a.frustum.near,i.far=a.frustum.far,n.updateFrustum(i),n.updatePass(le.a.ENVIRONMENT);var s,l=e._frameState.passes,u=l.pick,d=e._environmentState,f=e._view,c=d.renderTranslucentDepthForPick,h=d.useWebVR;if(!u){var m,p=d.skyBoxCommand;if(Object(o.default)(p)&&ov(p,e,r,t),d.isSkyAtmosphereVisible&&ov(d.skyAtmosphereCommand,e,r,t),d.isSunVisible)if(d.sunDrawCommand.execute(r,t),e.sunBloom&&!h)m=d.useGlobeDepthFramebuffer?f.globeDepth.framebuffer:d.usePostProcess?f.sceneFramebuffer.getFramebuffer():d.originalFramebuffer,e._sunPostProcess.execute(r),e._sunPostProcess.copy(r,m),t.framebuffer=m;d.isMoonVisible&&d.moonCommand.execute(r,t)}d.useOIT?(Object(o.default)(e._executeOITFunction)||(e._executeOITFunction=function(e,t,i,a,r){f.oit.executeCommands(e,t,i,a,r)}),s=e._executeOITFunction):s=l.render?dv:fv;for(var _,g=f.frustumCommandsList,v=g.length,y=d.clearGlobeDepth,b=d.useDepthPlane,w=d.separatePrimitiveFramebuffer=!1,x=e._depthClearCommand,O=e._stencilClearCommand,C=e._classificationStencilClearCommand,T=e._depthPlane,E=d.usePostProcessSelected,P=a.position.z,A=0;A<v;++A){var S=v-A-1,D=g[S];e.mode===N.a.SCENE2D?(a.position.z=P-D.near+1,i.far=Math.max(1,D.far-D.near),i.near=1,n.update(e.frameState),n.updateFrustum(i)):(i.near=0!==S?D.near*e.opaqueFrustumNearOffset:D.near,i.far=D.far,n.updateFrustum(i));var I,M=e.debugShowGlobeDepth?cv(e,S):f.globeDepth;w&&(t.framebuffer=M.framebuffer),e.debugShowGlobeDepth&&Object(o.default)(M)&&d.useGlobeDepthFramebuffer&&(M.update(r,t,f.viewport,e._hdr,y),M.clear(r,t,e._clearColorCommand.color),I=t.framebuffer,t.framebuffer=M.framebuffer),x.execute(r,t),r.stencilBuffer&&O.execute(r,t),n.updatePass(le.a.GLOBE);var F,R=D.commands[le.a.GLOBE],L=D.indices[le.a.GLOBE];for(_=0;_<L;++_)ov(R[_],e,r,t);for(Object(o.default)(M)&&d.useGlobeDepthFramebuffer&&M.executeCopyDepth(r,t),e.debugShowGlobeDepth&&Object(o.default)(M)&&d.useGlobeDepthFramebuffer&&(t.framebuffer=I),n.updatePass(le.a.TERRAIN_CLASSIFICATION),R=D.commands[le.a.TERRAIN_CLASSIFICATION],L=D.indices[le.a.TERRAIN_CLASSIFICATION],_=0;_<L;++_)ov(R[_],e,r,t);if(y&&(x.execute(r,t),b&&T.execute(r,t)),w&&(t.framebuffer=M.primitiveFramebuffer),!d.useInvertClassification||u){for(n.updatePass(le.a.CESIUM_3D_TILE),R=D.commands[le.a.CESIUM_3D_TILE],L=D.indices[le.a.CESIUM_3D_TILE],_=0;_<L;++_)ov(R[_],e,r,t);if(L>0)for(Object(o.default)(M)&&d.useGlobeDepthFramebuffer&&M.executeUpdateDepth(r,t,y),n.updatePass(le.a.CESIUM_3D_TILE_CLASSIFICATION),R=D.commands[le.a.CESIUM_3D_TILE_CLASSIFICATION],L=D.indices[le.a.CESIUM_3D_TILE_CLASSIFICATION],_=0;_<L;++_)ov(R[_],e,r,t)}else{e._invertClassification.clear(r,t);var j=t.framebuffer;for(t.framebuffer=e._invertClassification._fbo,n.updatePass(le.a.CESIUM_3D_TILE),R=D.commands[le.a.CESIUM_3D_TILE],L=D.indices[le.a.CESIUM_3D_TILE],_=0;_<L;++_)ov(R[_],e,r,t);for(Object(o.default)(M)&&d.useGlobeDepthFramebuffer&&M.executeUpdateDepth(r,t,y),n.updatePass(le.a.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW),R=D.commands[le.a.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],L=D.indices[le.a.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],_=0;_<L;++_)ov(R[_],e,r,t);for(t.framebuffer=j,e._invertClassification.executeClassified(r,t),1===e.frameState.invertClassificationColor.alpha&&e._invertClassification.executeUnclassified(r,t),L>0&&r.stencilBuffer&&C.execute(r,t),n.updatePass(le.a.CESIUM_3D_TILE_CLASSIFICATION),R=D.commands[le.a.CESIUM_3D_TILE_CLASSIFICATION],L=D.indices[le.a.CESIUM_3D_TILE_CLASSIFICATION],_=0;_<L;++_)ov(R[_],e,r,t)}for(L>0&&r.stencilBuffer&&O.execute(r,t),n.updatePass(le.a.OPAQUE),R=D.commands[le.a.OPAQUE],L=D.indices[le.a.OPAQUE],_=0;_<L;++_)ov(R[_],e,r,t);if(0!==S&&e.mode!==N.a.SCENE2D&&(i.near=D.near,n.updateFrustum(i)),!u&&d.useInvertClassification&&e.frameState.invertClassificationColor.alpha<1&&(F=e._invertClassification),n.updatePass(le.a.TRANSLUCENT),(R=D.commands[le.a.TRANSLUCENT]).length=D.indices[le.a.TRANSLUCENT],s(e,ov,t,R,F),r.depthTexture&&e.useDepthPicking&&(d.useGlobeDepthFramebuffer||c)){var V=c?t.framebuffer.depthStencilTexture:M.framebuffer.depthStencilTexture,U=e._picking.getPickDepth(e,S);U.update(r,V),U.executeCopyDepth(r,t)}if(w&&(t.framebuffer=M.framebuffer),!u&&E){var z=t.framebuffer;for(t.framebuffer=f.sceneFramebuffer.getIdFramebuffer(),i.near=0!==S?D.near*e.opaqueFrustumNearOffset:D.near,i.far=D.far,n.updateFrustum(i),n.updatePass(le.a.GLOBE),R=D.commands[le.a.GLOBE],L=D.indices[le.a.GLOBE],_=0;_<L;++_)sv(R[_],e,r,t);for(y&&(x.framebuffer=t.framebuffer,x.execute(r,t),x.framebuffer=void 0),y&&b&&T.execute(r,t),n.updatePass(le.a.CESIUM_3D_TILE),R=D.commands[le.a.CESIUM_3D_TILE],L=D.indices[le.a.CESIUM_3D_TILE],_=0;_<L;++_)sv(R[_],e,r,t);for(n.updatePass(le.a.OPAQUE),R=D.commands[le.a.OPAQUE],L=D.indices[le.a.OPAQUE],_=0;_<L;++_)sv(R[_],e,r,t);for(n.updatePass(le.a.TRANSLUCENT),R=D.commands[le.a.TRANSLUCENT],L=D.indices[le.a.TRANSLUCENT],_=0;_<L;++_)sv(R[_],e,r,t);t.framebuffer=z}}}function vv(e){e.context.uniformState.updatePass(le.a.COMPUTE);var t=e._environmentState.sunComputeCommand;Object(o.default)(t)&&t.execute(e._computeEngine);for(var i=e._computeCommandList,a=i.length,r=0;r<a;++r)i[r].execute(e._computeEngine)}function yv(e,t,i){for(var a=i.shadowMapCullingVolume,r=i.isPointLight,n=i.passes,o=n.length,s=t.length,l=0;l<s;++l){var u=t[l];if(e.updateDerivedCommands(u),u.castShadows&&(u.pass===le.a.GLOBE||u.pass===le.a.CESIUM_3D_TILE||u.pass===le.a.OPAQUE||u.pass===le.a.TRANSLUCENT)&&e.isVisible(u,a))if(r)for(var d=0;d<o;++d)n[d].commandList.push(u);else if(1===o)n[0].commandList.push(u);else for(var f=!1,c=o-1;c>=0;--c){var h=n[c].cullingVolume;if(e.isVisible(u,h))n[c].commandList.push(u),f=!0;else if(f)break}}}function bv(e){var t=e.frameState,i=t.shadowState.shadowMaps,a=i.length;if(t.shadowState.shadowsEnabled)for(var r=e.context,n=r.uniformState,o=0;o<a;++o){var s=i[o];if(!s.outOfView){var l,u=s.passes,d=u.length;for(l=0;l<d;++l)u[l].commandList.length=0;for(yv(e,e.frameState.commandList,s),l=0;l<d;++l){var f=s.passes[l];n.updateCamera(f.camera),s.updatePass(r,l);for(var c=f.commandList.length,h=0;h<c;++h){var m=f.commandList[h];n.updatePass(m.pass),ov(m.derivedCommands.shadows.castCommands[o],e,r,f.passState)}}}}}var wv=new a.default;Qg.prototype.updateAndExecuteCommands=function(e,t){var i=this._frameState.mode;this._environmentState.useWebVR?function(e,t,i){var r=e._view,o=r.camera,s=e._environmentState.renderTranslucentDepthForPick;Fv(e,t,i),s||Mv(e);r.createPotentiallyVisibleSet(e),s||(vv(e),bv(e));var l=t.viewport;l.x=0,l.y=0,l.width=.5*l.width;var u=Ql.clone(o,e._cameraVR);u.frustum=o.frustum;var d=o.frustum.near,f=d*Object(n.default)(e.focalLength,5),c=Object(n.default)(e.eyeSeparation,f/30),h=a.default.multiplyByScalar(u.right,.5*c,wv);o.frustum.aspectRatio=l.width/l.height;var m=.5*c*d/f;a.default.add(u.position,h,o.position),o.frustum.xOffset=m,gv(e,t),l.x=l.width,a.default.subtract(u.position,h,o.position),o.frustum.xOffset=-m,gv(e,t),Ql.clone(u,o)}(this,e,t):i!==N.a.SCENE2D||this._mapMode2D===Ho.ROTATE?Dv(!0,this,e,t):(Fv(this,e,t),function(e,t){var i=e.context,r=e.frameState,n=e.camera,o=t.viewport,s=an.default.clone(o,Sv);t.viewport=s;var l=xv,u=Ov;e.mapProjection.project(l,u);var d=a.default.clone(n.position,Cv),f=K.default.clone(n.transform,Ev),c=n.frustum.clone();n._setTransform(K.default.IDENTITY);var h=K.default.computeViewportTransformation(s,0,1,Tv),m=n.frustum.projectionMatrix,p=n.positionWC.y,_=a.default.fromElements(Z.default.sign(p)*u.x-p,0,-n.positionWC.x,Pv),g=Ur.default.pointToGLWindowCoordinates(m,h,_,Av);g.x=Math.floor(g.x);var v=s.x,y=s.width;if(0===p||g.x<=v||g.x>=v+y)Dv(!0,e,t);else if(Math.abs(v+.5*y-g.x)<1)s.width=g.x-s.x,n.position.x*=Z.default.sign(n.position.x),n.frustum.right=0,r.cullingVolume=n.frustum.computeCullingVolume(n.positionWC,n.directionWC,n.upWC),i.uniformState.update(r),Dv(!0,e,t),s.x=g.x,n.position.x=-n.position.x,n.frustum.right=-n.frustum.left,n.frustum.left=0,r.cullingVolume=n.frustum.computeCullingVolume(n.positionWC,n.directionWC,n.upWC),i.uniformState.update(r),Dv(!1,e,t);else if(g.x>v+.5*y){s.width=g.x-v;var b=n.frustum.right;n.frustum.right=u.x-p,r.cullingVolume=n.frustum.computeCullingVolume(n.positionWC,n.directionWC,n.upWC),i.uniformState.update(r),Dv(!0,e,t),s.x=g.x,s.width=v+y-g.x,n.position.x=-n.position.x,n.frustum.left=-n.frustum.right,n.frustum.right=b-2*n.frustum.right,r.cullingVolume=n.frustum.computeCullingVolume(n.positionWC,n.directionWC,n.upWC),i.uniformState.update(r),Dv(!1,e,t)}else{s.x=g.x,s.width=v+y-g.x;var w=n.frustum.left;n.frustum.left=-u.x-p,r.cullingVolume=n.frustum.computeCullingVolume(n.positionWC,n.directionWC,n.upWC),i.uniformState.update(r),Dv(!0,e,t),s.x=v,s.width=g.x-v,n.position.x=-n.position.x,n.frustum.right=-n.frustum.left,n.frustum.left=w-2*n.frustum.left,r.cullingVolume=n.frustum.computeCullingVolume(n.positionWC,n.directionWC,n.upWC),i.uniformState.update(r),Dv(!1,e,t)}n._setTransform(f),a.default.clone(d,n.position),n.frustum=c.clone(),t.viewport=o}(this,e))};var xv=new v.default(Math.PI,Z.default.PI_OVER_TWO),Ov=new a.default,Cv=new a.default,Tv=new K.default,Ev=new K.default,Pv=new a.default,Av=new a.default,Sv=new an.default;function Dv(e,t,i,a){var r=t._environmentState,n=t._view,s=r.renderTranslucentDepthForPick;e||s||(t.frameState.commandList.length=0),s||Mv(t),n.createPotentiallyVisibleSet(t),e&&(Object(o.default)(a)&&Fv(t,i,a),s||(vv(t),bv(t))),gv(t,i)}var Iv=new nn.a;function Mv(e){var t=e._frameState;e._groundPrimitives.update(t),e._primitives.update(t),function(e){var t=e._frameState;e.debugShowFrustumPlanes!==e._debugShowFrustumPlanes&&(e.debugShowFrustumPlanes?e._debugFrustumPlanes=new zu({camera:e.camera,updateOnChange:!1}):e._debugFrustumPlanes=e._debugFrustumPlanes&&e._debugFrustumPlanes.destroy(),e._debugShowFrustumPlanes=e.debugShowFrustumPlanes),Object(o.default)(e._debugFrustumPlanes)&&e._debugFrustumPlanes.update(t)}(e),function(e){var t=e._frameState,i=t.shadowMaps,a=i.length,r=a>0&&!t.passes.pick&&e.mode===N.a.SCENE3D;if(r!==t.shadowState.shadowsEnabled&&(++t.shadowState.lastDirtyTime,t.shadowState.shadowsEnabled=r),t.shadowState.lightShadowsEnabled=!1,r){for(var n=0;n<a;++n)if(i[n]!==t.shadowState.shadowMaps[n]){++t.shadowState.lastDirtyTime;break}t.shadowState.shadowMaps.length=0,t.shadowState.lightShadowMaps.length=0;for(var o=0;o<a;++o){var s=i[o];s.update(t),t.shadowState.shadowMaps.push(s),s.fromLightSource&&(t.shadowState.lightShadowMaps.push(s),t.shadowState.lightShadowsEnabled=!0),s.dirty&&(++t.shadowState.lastDirtyTime,s.dirty=!1)}}}(e),e._globe&&e._globe.render(t)}function Fv(e,t,i){var a=e._context,r=e._frameState,n=e._environmentState,s=e._view,l=e._frameState.passes.pick,u=n.useWebVR;n.originalFramebuffer=t.framebuffer,Object(o.default)(e.sun)&&e.sunBloom!==e._sunBloom?(e.sunBloom&&!u?e._sunPostProcess=new Yg:Object(o.default)(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy()),e._sunBloom=e.sunBloom):!Object(o.default)(e.sun)&&Object(o.default)(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy(),e._sunBloom=!1);var d=e._clearColorCommand;k.default.clone(i,d.color),d.execute(a,t);var f=n.useGlobeDepthFramebuffer=Object(o.default)(s.globeDepth);f&&(s.globeDepth.update(a,t,s.viewport,e._hdr,n.clearGlobeDepth),s.globeDepth.clear(a,t,i));var c=s.oit,h=n.useOIT=!l&&Object(o.default)(c)&&c.isSupported();h&&(c.update(a,t,s.globeDepth.framebuffer,e._hdr),c.clear(a,t,i),n.useOIT=c.isSupported());var m,p=e.postProcessStages,_=n.usePostProcess=!l&&(e._hdr||p.length>0||p.ambientOcclusion.enabled||p.fxaa.enabled||p.bloom.enabled);if(n.usePostProcessSelected=!1,_&&(s.sceneFramebuffer.update(a,s.viewport,e._hdr),s.sceneFramebuffer.clear(a,t,i),p.update(a,r.useLogDepth,e._hdr),p.clear(a),_=n.usePostProcess=p.ready,n.usePostProcessSelected=_&&p.hasSelected),n.isSunVisible&&e.sunBloom&&!u?(t.framebuffer=e._sunPostProcess.update(t),e._sunPostProcess.clear(a,t,i)):f?t.framebuffer=s.globeDepth.framebuffer:_&&(t.framebuffer=s.sceneFramebuffer.getFramebuffer()),Object(o.default)(t.framebuffer)&&d.execute(a,t),n.useInvertClassification=!l&&Object(o.default)(t.framebuffer)&&e.invertClassification)if(1===e.frameState.invertClassificationColor.alpha&&n.useGlobeDepthFramebuffer&&(m=s.globeDepth.framebuffer),Object(o.default)(m)||a.depthTexture){if(e._invertClassification.previousFramebuffer=m,e._invertClassification.update(a),e._invertClassification.clear(a,t),e.frameState.invertClassificationColor.alpha<1&&h){var g=e._invertClassification.unclassifiedCommand,v=g.derivedCommands;v.oit=c.createDerivedCommands(g,a,v.oit)}}else n.useInvertClassification=!1}function Rv(e){e._jobScheduler.resetBudgets();var t=e._frameState;e.primitives.prePassesUpdate(t),Object(o.default)(e.globe)&&e.globe.update(t),e._picking.update(),t.creditDisplay.update()}function Nv(e){var t=e._frameState;e.primitives.postPassesUpdate(t),Dn.a.update()}Qg.prototype.updateEnvironment=function(){var e=this._frameState,t=this._view,i=this._environmentState,a=e.passes.render,r=e.passes.offscreen,n=this.skyAtmosphere,s=this.globe;if(!a||this._mode!==N.a.SCENE2D&&t.camera.frustum instanceof $.a||this._cameraUnderground)i.skyAtmosphereCommand=void 0,i.skyBoxCommand=void 0,i.sunDrawCommand=void 0,i.sunComputeCommand=void 0,i.moonCommand=void 0;else{Object(o.default)(n)?(Object(o.default)(s)&&(n.setDynamicAtmosphereColor(s.enableLighting&&s.dynamicAtmosphereLighting,s.dynamicAtmosphereLightingFromSun),i.isReadyForAtmosphere=i.isReadyForAtmosphere||s._surface._tilesToRender.length>0),i.skyAtmosphereCommand=n.update(e),Object(o.default)(i.skyAtmosphereCommand)&&this.updateDerivedCommands(i.skyAtmosphereCommand)):i.skyAtmosphereCommand=void 0,i.skyBoxCommand=Object(o.default)(this.skyBox)?this.skyBox.update(e,this._hdr):void 0;var l=Object(o.default)(this.sun)?this.sun.update(e,t.passState,this._hdr):void 0;i.sunDrawCommand=Object(o.default)(l)?l.drawCommand:void 0,i.sunComputeCommand=Object(o.default)(l)?l.computeCommand:void 0,i.moonCommand=Object(o.default)(this.moon)?this.moon.update(e):void 0}var u=i.clearGlobeDepth=Object(o.default)(s)&&(!s.depthTestAgainstTerrain||this.mode===N.a.SCENE2D);(i.useDepthPlane=u&&this.mode===N.a.SCENE3D&&!this._cameraUnderground)&&this._depthPlane.update(e),i.renderTranslucentDepthForPick=!1,i.useWebVR=this._useWebVR&&this.mode!==N.a.SCENE2D&&!r;for(var d=e.mode===N.a.SCENE3D?e.occluder:void 0,f=e.cullingVolume,c=Iv.planes,h=0;h<5;++h)c[h]=f.planes[h];f=Iv,i.isSkyAtmosphereVisible=Object(o.default)(i.skyAtmosphereCommand)&&i.isReadyForAtmosphere,i.isSunVisible=this.isVisible(i.sunDrawCommand,f,d),i.isMoonVisible=this.isVisible(i.moonCommand,f,d);var m=this.specularEnvironmentMaps,p=this._specularEnvironmentMapAtlas;!Object(o.default)(m)||Object(o.default)(p)&&p.url===m?!Object(o.default)(m)&&Object(o.default)(p)&&(p.destroy(),this._specularEnvironmentMapAtlas=void 0):(p=p&&p.destroy(),this._specularEnvironmentMapAtlas=new Ud.a(m)),Object(o.default)(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(e)},Qg.prototype.resolveFramebuffers=function(e){var t=this._context,i=this._frameState,a=this._environmentState,r=this._view,o=r.globeDepth,s=a.useOIT,l=a.useGlobeDepthFramebuffer,u=a.usePostProcess,d=a.originalFramebuffer,f=l?o.framebuffer:void 0,c=r.sceneFramebuffer.getFramebuffer(),h=r.sceneFramebuffer.getIdFramebuffer();if(a.separatePrimitiveFramebuffer&&o.executeMergeColor(t,e),s&&(e.framebuffer=u?c:d,r.oit.execute(t,e)),u){var m=c;l&&!s&&(m=f);var p=this.postProcessStages,_=m.getColorTexture(0),g=h.getColorTexture(0),v=Object(n.default)(f,c).depthStencilTexture;p.execute(t,_,v,g),p.copy(t,d)}s||u||!l||(e.framebuffer=d,o.executeCopyColor(t,e));var y=i.useLogDepth;this.debugShowGlobeDepth&&l&&cv(this,this.debugShowDepthFrustum-1).executeDebugGlobeDepth(t,e,y);this.debugShowPickDepth&&l&&this._picking.getPickDepth(this,this.debugShowDepthFrustum-1).executeDebugPickDepth(t,e,y)},Qg.prototype.initializeFrame=function(){120==this._shaderFrameCount++&&(this._shaderFrameCount=0,this._context.shaderCache.destroyReleasedShaderPrograms(),this._context.textureCache.destroyReleasedTextures()),this._tweens.update(),this._screenSpaceCameraController.update(),Object(o.default)(this._deviceOrientationCameraController)&&this._deviceOrientationCameraController.update(),this.camera.update(this._mode),this.camera._updateCameraChanged(),this._cameraUnderground=function(e){var t=e.camera,i=e._mode,a=e.globe,r=e._screenSpaceCameraController,n=t.positionCartographic;if(!r.onMap()&&n.height<0)return!0;if(!Object(o.default)(a)||!a.show||i===N.a.SCENE2D||i===N.a.MORPHING)return!1;if(r.adjustedHeightForTerrain())return!1;var s=a.getHeight(n);return!!(Object(o.default)(s)&&n.height<s)}(this)};var Lv=new k.default;function jv(e){var t=e._frameState,i=e.context,r=i.uniformState,s=e._defaultView;e._view=s,e.updateFrameState(),t.passes.render=!0,t.passes.postProcess=e.postProcessStages.hasSelected,t.tilesetPassState=Jg;var l=Object(n.default)(e.backgroundColor,k.default.BLACK);e._hdr&&((l=k.default.clone(l,Lv)).red=Math.pow(l.red,e.gamma),l.green=Math.pow(l.green,e.gamma),l.blue=Math.pow(l.blue,e.gamma)),t.backgroundColor=l,e.fog.update(t),r.update(t);var u=e.shadowMap;Object(o.default)(u)&&u.enabled&&(!Object(o.default)(e.light)||e.light instanceof io?a.default.negate(r.sunDirectionWC,e._shadowMapCamera.direction):a.default.clone(e.light.direction,e._shadowMapCamera.direction),t.shadowMaps.push(u)),e._computeCommandList.length=0,e._overlayCommandList.length=0;var d=s.viewport;d.x=0,d.y=0,d.width=i.drawingBufferWidth,d.height=i.drawingBufferHeight;var f=s.passState;f.framebuffer=void 0,f.blendingEnabled=void 0,f.scissorTest=void 0,f.viewport=an.default.clone(d,f.viewport),Object(o.default)(e.globe)&&e.globe.beginFrame(t),e.updateEnvironment(),e.updateAndExecuteCommands(f,l),e.resolveFramebuffers(f),f.framebuffer=void 0,function(e,t){e.context.uniformState.updatePass(le.a.OVERLAY);for(var i=e.context,a=e._overlayCommandList,r=a.length,n=0;n<r;++n)a[n].execute(i,t)}(e,f),Object(o.default)(e.globe)&&(e.globe.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),i.endFrame()}function Vv(e,t){try{t(e)}catch(t){if(e._renderError.raiseEvent(e,t),e.rethrowRenderErrors)throw t}}function Uv(e){return e._picking.updateMostDetailedRayPicks(e)}function zv(e){var t=e._frameState;$g.camera=t.camera,$g.cullingVolume=t.cullingVolume,e.primitives.updateForPass(t,$g)}function Bv(e){var t=e._frameState;t.camera.canPreloadFlight()&&(ev.camera=e.preloadFlightCamera,ev.cullingVolume=e.preloadFlightCullingVolume,e.primitives.updateForPass(t,ev))}function Hv(e){e.primitives.updateForPass(e._frameState,tv)}Qg.prototype.render=function(e){this._preUpdate.raiseEvent(this,e);var t=this._frameState;t.newFrame=!1,Object(o.default)(e)||(e=ia.default.now());var i=this._view.checkForCameraUpdates(this),a=!this.requestRenderMode||this._renderRequested||i||this._logDepthBufferDirty||this._hdrDirty||this.mode===N.a.MORPHING;if(!a&&Object(o.default)(this.maximumRenderTimeChange)&&Object(o.default)(this._lastRenderTime)){var r=Math.abs(ia.default.secondsDifference(this._lastRenderTime,e));a=a||r>this.maximumRenderTimeChange}a&&(this._lastRenderTime=ia.default.clone(e,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._hdrDirty=!1,av(this,Z.default.incrementWrap(t.frameNumber,15e6,1),e),t.newFrame=!0);Vv(this,Rv),this.primitives.show&&(Vv(this,Uv),Vv(this,zv),Vv(this,Bv),a||Vv(this,Hv)),this._postUpdate.raiseEvent(this,e),a&&(this._preRender.raiseEvent(this,e),t.creditDisplay.beginFrame(),Vv(this,jv)),function(e,t){if(e.debugShowFramesPerSecond){if(!Object(o.default)(e._performanceDisplay)){var i=document.createElement("div");i.className="cesium-performanceDisplay-defaultContainer",e._canvas.parentNode.appendChild(i);var a=new Hd({container:i});e._performanceDisplay=a,e._performanceContainer=i}e._performanceDisplay.throttled=e.requestRenderMode,e._performanceDisplay.update(t)}else Object(o.default)(e._performanceDisplay)&&(e._performanceDisplay=e._performanceDisplay&&e._performanceDisplay.destroy(),e._performanceContainer.parentNode.removeChild(e._performanceContainer))}(this,a),Vv(this,Nv),function(e){for(var t=e._frameState.afterRender,i=0,a=t.length;i<a;++i)t[i](),e.requestRender();t.length=0}(this),a&&(this._postRender.raiseEvent(this,e),t.creditDisplay.endFrame())},Qg.prototype.forceRender=function(e){this._renderRequested=!0,this.render(e)},Qg.prototype.requestRender=function(){this._renderRequested=!0},Qg.prototype.clampLineWidth=function(e){return Math.max(oe.a.minimumAliasedLineWidth,Math.min(e,oe.a.maximumAliasedLineWidth))},Qg.prototype.pick=function(e,t,i){return this._picking.pick(this,e,t,i)},Qg.prototype.pickPositionWorldCoordinates=function(e,t){return this._picking.pickPositionWorldCoordinates(this,e,t)},Qg.prototype.pickPosition=function(e,t){return this._picking.pickPosition(this,e,t)},Qg.prototype.drillPick=function(e,t,i,a){return this._picking.drillPick(this,e,t,i,a)},Qg.prototype.pickFromRay=function(e,t,i){return this._picking.pickFromRay(this,e,t,i)},Qg.prototype.drillPickFromRay=function(e,t,i,a){return this._picking.drillPickFromRay(this,e,t,i,a)},Qg.prototype.pickFromRayMostDetailed=function(e,t,i){return this._picking.pickFromRayMostDetailed(this,e,t,i)},Qg.prototype.drillPickFromRayMostDetailed=function(e,t,i,a){return this._picking.drillPickFromRayMostDetailed(this,e,t,i,a)},Qg.prototype.sampleHeight=function(e,t,i){return this._picking.sampleHeight(this,e,t,i)},Qg.prototype.clampToHeight=function(e,t,i,a){return this._picking.clampToHeight(this,e,t,i,a)},Qg.prototype.sampleHeightMostDetailed=function(e,t,i){return this._picking.sampleHeightMostDetailed(this,e,t,i)},Qg.prototype.clampToHeightMostDetailed=function(e,t,i){return this._picking.clampToHeightMostDetailed(this,e,t,i)},Qg.prototype.cartesianToCanvasCoordinates=function(e,t){return ef.default.wgs84ToWindowCoordinates(this,e,t)},Qg.prototype.completeMorph=function(){this._transitioner.completeMorph()},Qg.prototype.morphTo2D=function(e){var t,i=this.globe;t=Object(o.default)(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=Object(n.default)(e,2),this._transitioner.morphTo2D(e,t)},Qg.prototype.morphToColumbusView=function(e){var t,i=this.globe;t=Object(o.default)(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=Object(n.default)(e,2),this._transitioner.morphToColumbusView(e,t)},Qg.prototype.morphTo3D=function(e){var t,i=this.globe;t=Object(o.default)(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=Object(n.default)(e,2),this._transitioner.morphTo3D(e,t)},Qg.prototype.isDestroyed=function(){return!1},Qg.prototype.destroy=function(){this._tweens.removeAll(),this._computeEngine=this._computeEngine&&this._computeEngine.destroy(),this._screenSpaceCameraController=this._screenSpaceCameraController&&this._screenSpaceCameraController.destroy(),this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this._primitives=this._primitives&&this._primitives.destroy(),this._groundPrimitives=this._groundPrimitives&&this._groundPrimitives.destroy(),this._globe=this._globe&&this._globe.destroy(),this.skyBox=this.skyBox&&this.skyBox.destroy(),this.skyAtmosphere=this.skyAtmosphere&&this.skyAtmosphere.destroy(),this._debugSphere=this._debugSphere&&this._debugSphere.destroy(),this.sun=this.sun&&this.sun.destroy(),this._sunPostProcess=this._sunPostProcess&&this._sunPostProcess.destroy(),this._depthPlane=this._depthPlane&&this._depthPlane.destroy(),this._transitioner=this._transitioner&&this._transitioner.destroy(),this._debugFrustumPlanes=this._debugFrustumPlanes&&this._debugFrustumPlanes.destroy(),this._brdfLutGenerator=this._brdfLutGenerator&&this._brdfLutGenerator.destroy(),this._picking=this._picking&&this._picking.destroy(),this._defaultView=this._defaultView&&this._defaultView.destroy(),this._view=void 0,this._removeCreditContainer&&this._canvas.parentNode.removeChild(this._creditContainer),this.postProcessStages=this.postProcessStages&&this.postProcessStages.destroy(),this._context=this._context&&this._context.destroy(),this._frameState.creditDisplay=this._frameState.creditDisplay&&this._frameState.creditDisplay.destroy(),Object(o.default)(this._performanceDisplay)&&(this._performanceDisplay=this._performanceDisplay&&this._performanceDisplay.destroy(),this._performanceContainer.parentNode.removeChild(this._performanceContainer)),this._removeRequestListenerCallback(),this._removeTaskProcessorListenerCallback();for(var e=0;e<this._removeGlobeCallbacks.length;++e)this._removeGlobeCallbacks[e]();return this._removeGlobeCallbacks.length=0,Object(s.default)(this)};var kv=Qg,Wv='/**\n * @license\n * Copyright (c) 2000-2005, Sean O\'Neil (s_p_oneil@hotmail.com)\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * * Redistributions of source code must retain the above copyright notice,\n *   this list of conditions and the following disclaimer.\n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * * Neither the name of the project nor the names of its contributors may be\n *   used to endorse or promote products derived from this software without\n *   specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * Modifications made by Analytical Graphics, Inc.\n */\n\n // Code:  http://sponeil.net/\n // GPU Gems 2 Article:  https://developer.nvidia.com/gpugems/GPUGems2/gpugems2_chapter16.html\n\n#ifdef COLOR_CORRECT\nuniform vec3 u_hsbShift; // Hue, saturation, brightness\n#endif\n\nuniform vec4 u_cameraAndRadiiAndDynamicAtmosphereColor; // Camera height, outer radius, inner radius, dynamic atmosphere color flag\n\n#ifdef SPLIT_ATMOSPHERE\nuniform float u_splitDirection;\n#endif\n\nconst float g = -0.95;\nconst float g2 = g * g;\n\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\nvarying vec3 v_toCamera;\nvarying vec3 v_positionEC;\n\nvoid main (void)\n{\n#ifdef SPLIT_ATMOSPHERE\n    float splitPosition = czm_imagerySplitPosition;\n    if (u_splitDirection < 0.0 && gl_FragCoord.x > splitPosition) {\n        discard;\n    } else if (u_splitDirection > 0.0 && gl_FragCoord.x < splitPosition) {\n        discard;\n    }\n#endif\n\n     float lightEnum = u_cameraAndRadiiAndDynamicAtmosphereColor.w;\n    vec3 lightDirection =\n        czm_viewerPositionWC * float(lightEnum == 0.0) +\n        czm_lightDirectionWC * float(lightEnum == 1.0) +\n        czm_sunDirectionWC * float(lightEnum == 2.0);\n    lightDirection = normalize(lightDirection);\n\n    // Extra normalize added for Android\n    float cosAngle = dot(lightDirection, normalize(v_toCamera)) / length(v_toCamera);\n    float rayleighPhase = 0.75 * (1.0 + cosAngle * cosAngle);\n    float miePhase = 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + cosAngle * cosAngle) / pow(1.0 + g2 - 2.0 * g * cosAngle, 1.5);\n\n    vec3 rgb = rayleighPhase * v_rayleighColor + miePhase * v_mieColor;\n\n#ifndef HDR\n    const float exposure = 2.0;\n    rgb = vec3(1.0) - exp(-exposure * rgb);\n#endif\n\n#ifdef COLOR_CORRECT\n    // Convert rgb color to hsb\n    vec3 hsb = czm_RGBToHSB(rgb);\n    // Perform hsb shift\n    hsb.x += u_hsbShift.x; // hue\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\n    // Convert shifted hsb back to rgb\n    rgb = czm_HSBToRGB(hsb);\n#endif\n\n    // Alter alpha based on how close the viewer is to the ground (1.0 = on ground, 0.0 = at edge of atmosphere)\n    float atmosphereAlpha = clamp((u_cameraAndRadiiAndDynamicAtmosphereColor.y - u_cameraAndRadiiAndDynamicAtmosphereColor.x) / (u_cameraAndRadiiAndDynamicAtmosphereColor.y - u_cameraAndRadiiAndDynamicAtmosphereColor.z), 0.0, 1.0);\n\n    // Alter alpha based on time of day (0.0 = night , 1.0 = day)\n    float nightAlpha = (lightEnum != 0.0) ? clamp(dot(normalize(czm_viewerPositionWC), lightDirection), 0.0, 1.0) : 1.0;\n    atmosphereAlpha *= pow(nightAlpha, 0.5);\n\n    gl_FragColor = vec4(rgb, mix(rgb.b, 1.0, atmosphereAlpha) * smoothstep(0.0, 1.0, czm_morphTime));\n}\n',Gv="/**\n * @license\n * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * * Redistributions of source code must retain the above copyright notice,\n *   this list of conditions and the following disclaimer.\n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * * Neither the name of the project nor the names of its contributors may be\n *   used to endorse or promote products derived from this software without\n *   specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * Modifications made by Analytical Graphics, Inc.\n */\n\n // Code:  http://sponeil.net/\n // GPU Gems 2 Article:  https://developer.nvidia.com/gpugems/GPUGems2/gpugems2_chapter16.html\n\nattribute vec4 position;\n\nuniform vec4 u_cameraAndRadiiAndDynamicAtmosphereColor; // Camera height, outer radius, inner radius, dynamic atmosphere color flag\n\nconst float Kr = 0.0025;\nconst float Kr4PI = Kr * 4.0 * czm_pi;\nconst float Km = 0.0015;\nconst float Km4PI = Km * 4.0 * czm_pi;\nconst float ESun = 15.0;\nconst float KmESun = Km * ESun;\nconst float KrESun = Kr * ESun;\nconst vec3 InvWavelength = vec3(\n    5.60204474633241,  // Red = 1.0 / Math.pow(0.650, 4.0)\n    9.473284437923038, // Green = 1.0 / Math.pow(0.570, 4.0)\n    19.643802610477206); // Blue = 1.0 / Math.pow(0.475, 4.0)\nconst float rayleighScaleDepth = 0.25;\n\nconst int nSamples = 2;\nconst float fSamples = 2.0;\n\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\nvarying vec3 v_toCamera;\n\nfloat scale(float cosAngle)\n{\n    float x = 1.0 - cosAngle;\n    return rayleighScaleDepth  * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvoid main(void)\n{\n    // Unpack attributes\n    float cameraHeight = u_cameraAndRadiiAndDynamicAtmosphereColor.x;\n    float outerRadius = u_cameraAndRadiiAndDynamicAtmosphereColor.y;\n    float innerRadius = u_cameraAndRadiiAndDynamicAtmosphereColor.z;\n\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 positionV3 = position.xyz;\n    vec3 ray = positionV3 - czm_viewerPositionWC;\n    float far = length(ray);\n    ray /= far;\n    float atmosphereScale = 1.0 / (outerRadius - innerRadius);\n\n#ifdef SKY_FROM_SPACE\n    // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\n    float B = 2.0 * dot(czm_viewerPositionWC, ray);\n    float C = cameraHeight * cameraHeight - outerRadius * outerRadius;\n    float det = max(0.0, B*B - 4.0 * C);\n    float near = 0.5 * (-B - sqrt(det));\n\n    // Calculate the ray's starting position, then calculate its scattering offset\n    vec3 start = czm_viewerPositionWC + ray * near;\n    far -= near;\n    float startAngle = dot(ray, start) / outerRadius;\n    float startDepth = exp(-1.0 / rayleighScaleDepth );\n    float startOffset = startDepth*scale(startAngle);\n#else // SKY_FROM_ATMOSPHERE\n    // Calculate the ray's starting position, then calculate its scattering offset\n    vec3 start = czm_viewerPositionWC;\n    float height = length(start);\n    float depth = exp((atmosphereScale / rayleighScaleDepth ) * (innerRadius - cameraHeight));\n    float startAngle = dot(ray, start) / height;\n    float startOffset = depth*scale(startAngle);\n#endif\n\n    float lightEnum = u_cameraAndRadiiAndDynamicAtmosphereColor.w;\n    vec3 lightDirection =\n        czm_viewerPositionWC * float(lightEnum == 0.0) +\n        czm_lightDirectionWC * float(lightEnum == 1.0) +\n        czm_sunDirectionWC * float(lightEnum == 2.0);\n    lightDirection = normalize(lightDirection);\n\n    // Initialize the scattering loop variables\n    float sampleLength = far / fSamples;\n    float scaledLength = sampleLength * atmosphereScale;\n    vec3 sampleRay = ray * sampleLength;\n    vec3 samplePoint = start + sampleRay * 0.5;\n\n    // Now loop through the sample rays\n    vec3 frontColor = vec3(0.0, 0.0, 0.0);\n\n    for(int i=0; i<nSamples; i++)\n    {\n        float height = length(samplePoint);\n        float depth = exp((atmosphereScale / rayleighScaleDepth ) * (innerRadius - height));\n        float fLightAngle = dot(lightDirection, samplePoint) / height;\n        float fCameraAngle = dot(ray, samplePoint) / height;\n        float fScatter = (startOffset + depth*(scale(fLightAngle) - scale(fCameraAngle)));\n        vec3 attenuate = exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\n        frontColor += attenuate * (depth * scaledLength);\n        samplePoint += sampleRay;\n    }\n\n    // Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\n    v_mieColor = frontColor * KmESun;\n    v_rayleighColor = frontColor * (InvWavelength * KrESun);\n    v_toCamera = czm_viewerPositionWC - positionV3;\n    gl_Position = czm_modelViewProjection * position;\n}\n";
/**
 * @license
 * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * * Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 * * Neither the name of the project nor the names of its contributors may be
 *   used to endorse or promote products derived from this software without
 *   specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Modifications made by Analytical Graphics, Inc.
 */function Yv(e){e=Object(n.default)(e,u.default.WGS84),this.show=!0,this._ellipsoid=e,this._command=new se.a({owner:this}),this._spSkyFromSpace=void 0,this._spSkyFromAtmosphere=void 0,this._spSkyFromSpaceColorCorrect=void 0,this._spSkyFromAtmosphereColorCorrect=void 0,this.hueShift=0,this.saturationShift=0,this.brightnessShift=0,this.splitDirection=w.default.NONE,this._splitDirection=void 0,this._hueSaturationBrightness=new a.default;var t=new B.a;t.w=0,t.y=a.default.maximumComponent(a.default.multiplyByScalar(e.radii,1.025,new a.default)),t.z=e.maximumRadius,this._cameraAndRadiiAndDynamicAtmosphereColor=t;var i=this;this._command.uniformMap={u_cameraAndRadiiAndDynamicAtmosphereColor:function(){return i._cameraAndRadiiAndDynamicAtmosphereColor},u_hsbShift:function(){return i._hueSaturationBrightness.x=i.hueShift,i._hueSaturationBrightness.y=i.saturationShift,i._hueSaturationBrightness.z=i.brightnessShift,i._hueSaturationBrightness},u_splitDirection:function(){return i.splitDirection}}}Object.defineProperties(Yv.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),Yv.prototype.setDynamicAtmosphereColor=function(e,t){this._cameraAndRadiiAndDynamicAtmosphereColor.w=e?t?2:1:0},Yv.prototype.update=function(e){if(this.show){var t=e.mode;if((t===N.a.SCENE3D||t===N.a.MORPHING)&&e.passes.render){var i=this._command,r=e.context;if(!Object(o.default)(i.vertexArray)){var n=sn.a.createGeometry(new sn.a({radii:a.default.multiplyByScalar(this._ellipsoid.radii,1.025,new a.default),slicePartitions:256,stackPartitions:256,vertexFormat:Br.default.POSITION_ONLY}));i.vertexArray=de.a.fromGeometry({context:r,geometry:n,attributeLocations:X.a.createAttributeLocations(n),bufferUsage:ne.a.STATIC_DRAW}),i.renderState=ue.a.fromCache({cull:{enabled:!0,face:Wr.a.FRONT},blending:fe.a.ALPHA_BLEND,depthMask:!1})}if(this.splitDirection!==this._splitDirection){this._spSkyFromSpace=this._spSkyFromSpace&&this._spSkyFromSpace.destroy(),this._spSkyFromAtmosphere=this._spSkyFromAtmosphere&&this._spSkyFromAtmosphere.destroy(),this._spSkyFromSpaceColorCorrect=this._spSkyFromSpaceColorCorrect&&this._spSkyFromSpaceColorCorrect.destroy(),this._spSkyFromAtmosphereColorCorrect=this._spSkyFromAtmosphereColorCorrect&&this._spSkyFromAtmosphereColorCorrect.destroy();var s=new E.a({defines:["SKY_FROM_SPACE"],sources:[Gv]}),l=Wv;this.splitDirection!==w.default.NONE&&(l=new E.a({defines:["SPLIT_ATMOSPHERE"],sources:[Wv]})),this._spSkyFromSpace=F.a.fromCache({context:r,vertexShaderSource:s,fragmentShaderSource:l}),s=new E.a({defines:["SKY_FROM_ATMOSPHERE"],sources:[Gv]}),this._spSkyFromAtmosphere=F.a.fromCache({context:r,vertexShaderSource:s,fragmentShaderSource:l}),this._splitDirection=this.splitDirection}var u,d=(u=this,!(Z.default.equalsEpsilon(u.hueShift,0,Z.default.EPSILON7)&&Z.default.equalsEpsilon(u.saturationShift,0,Z.default.EPSILON7)&&Z.default.equalsEpsilon(u.brightnessShift,0,Z.default.EPSILON7)));if(d&&(!Object(o.default)(this._spSkyFromSpaceColorCorrect)||!Object(o.default)(this._spSkyFromAtmosphereColorCorrect))){var f=e.context,c=new E.a({defines:["SKY_FROM_SPACE"],sources:[Gv]}),h=new E.a({defines:w.default.NONE?["COLOR_CORRECT"]:["COLOR_CORRECT","SPLIT_ATMOSPHERE"],sources:[Wv]});this._spSkyFromSpaceColorCorrect=F.a.fromCache({context:f,vertexShaderSource:c,fragmentShaderSource:h}),c=new E.a({defines:["SKY_FROM_ATMOSPHERE"],sources:[Gv]}),this._spSkyFromAtmosphereColorCorrect=F.a.fromCache({context:f,vertexShaderSource:c,fragmentShaderSource:h})}var m=e.camera.positionWC,p=a.default.magnitude(m);return this._cameraAndRadiiAndDynamicAtmosphereColor.x=p,p>this._cameraAndRadiiAndDynamicAtmosphereColor.y?i.shaderProgram=d?this._spSkyFromSpaceColorCorrect:this._spSkyFromSpace:i.shaderProgram=d?this._spSkyFromAtmosphereColorCorrect:this._spSkyFromAtmosphere,i}}},Yv.prototype.isDestroyed=function(){return!1},Yv.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),this._spSkyFromSpace=this._spSkyFromSpace&&this._spSkyFromSpace.destroy(),this._spSkyFromAtmosphere=this._spSkyFromAtmosphere&&this._spSkyFromAtmosphere.destroy(),this._spSkyFromSpaceColorCorrect=this._spSkyFromSpaceColorCorrect&&this._spSkyFromSpaceColorCorrect.destroy(),this._spSkyFromAtmosphereColorCorrect=this._spSkyFromAtmosphereColorCorrect&&this._spSkyFromAtmosphereColorCorrect.destroy(),Object(s.default)(this)};var Xv=Yv;var Qv=function(e,t){var i={flipY:!0,preferImageBitmap:!0},a=[T.default.createIfNeeded(t.positiveX).fetchImage(i),T.default.createIfNeeded(t.negativeX).fetchImage(i),T.default.createIfNeeded(t.positiveY).fetchImage(i),T.default.createIfNeeded(t.negativeY).fetchImage(i),T.default.createIfNeeded(t.positiveZ).fetchImage(i),T.default.createIfNeeded(t.negativeZ).fetchImage(i)];return I.default.all(a,(function(t){return new Qn.a({context:e,source:{positiveX:t[0],negativeX:t[1],positiveY:t[2],negativeY:t[3],positiveZ:t[4],negativeZ:t[5]}})}))};function qv(e){this.sources=e.sources,this._sources=void 0,this.show=Object(n.default)(e.show,!0),this._command=new se.a({modelMatrix:K.default.clone(K.default.IDENTITY),owner:this}),this._cubeMap=void 0,this._attributeLocations=void 0,this._useHdr=void 0}qv.prototype.update=function(e,t){var i=this;if(this.show&&(e.mode===N.a.SCENE3D||e.mode===N.a.MORPHING)&&e.passes.render){var r=e.context;if(this._sources!==this.sources){this._sources=this.sources;var n=this.sources;"string"==typeof n.positiveX?Qv(r,this._sources).then((function(e){i._cubeMap=i._cubeMap&&i._cubeMap.destroy(),i._cubeMap=e})):(this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),this._cubeMap=new Qn.a({context:r,source:n}))}var s=this._command;if(!Object(o.default)(s.vertexArray)){s.uniformMap={u_cubeMap:function(){return i._cubeMap}};var l=zr.a.createGeometry(zr.a.fromDimensions({dimensions:new a.default(2,2,2),vertexFormat:Br.default.POSITION_ONLY})),u=this._attributeLocations=X.a.createAttributeLocations(l);s.vertexArray=de.a.fromGeometry({context:r,geometry:l,attributeLocations:u,bufferUsage:ne.a.STATIC_DRAW}),s.renderState=ue.a.fromCache({blending:fe.a.ALPHA_BLEND})}if(!Object(o.default)(s.shaderProgram)||this._useHdr!==t){var d=new E.a({defines:[t?"HDR":""],sources:["uniform samplerCube u_cubeMap;\n\nvarying vec3 v_texCoord;\n\nvoid main()\n{\n    vec4 color = textureCube(u_cubeMap, normalize(v_texCoord));\n    gl_FragColor = vec4(czm_gammaCorrect(color).rgb, czm_morphTime);\n}\n"]});s.shaderProgram=F.a.fromCache({context:r,vertexShaderSource:"attribute vec3 position;\n\nvarying vec3 v_texCoord;\n\nvoid main()\n{\n    vec3 p = czm_viewRotation * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\n    gl_Position = czm_projection * vec4(p, 1.0);\n    v_texCoord = position.xyz;\n}\n",fragmentShaderSource:d,attributeLocations:this._attributeLocations}),this._useHdr=t}if(Object(o.default)(this._cubeMap))return s}},qv.prototype.isDestroyed=function(){return!1},qv.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy(),this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),Object(s.default)(this)};var Zv=qv;function Kv(){this.show=!0,this._drawCommand=new se.a({primitiveType:ee.a.TRIANGLES,boundingVolume:new g.default,owner:this}),this._commands={drawCommand:this._drawCommand,computeCommand:void 0},this._boundingVolume=new g.default,this._boundingVolume2D=new g.default,this._texture=void 0,this._drawingBufferWidth=void 0,this._drawingBufferHeight=void 0,this._radiusTS=void 0,this._size=void 0,this.glowFactor=1,this._glowFactorDirty=!1,this._useHdr=void 0;var e=this;this._uniformMap={u_texture:function(){return e._texture},u_size:function(){return e._size}}}Object.defineProperties(Kv.prototype,{glowFactor:{get:function(){return this._glowFactor},set:function(e){e=Math.max(e,0),this._glowFactor=e,this._glowFactorDirty=!0}}});var Jv=new z.default,$v=new z.default,ey=new B.a,ty=new B.a;Kv.prototype.update=function(e,t,i){if(this.show){var r=e.mode;if(r!==N.a.SCENE2D&&r!==N.a.MORPHING&&e.passes.render){var n=e.context,s=t.viewport.width,l=t.viewport.height;if(!Object(o.default)(this._texture)||s!==this._drawingBufferWidth||l!==this._drawingBufferHeight||this._glowFactorDirty||i!==this._useHdr){this._texture=this._texture&&this._texture.destroy(),this._drawingBufferWidth=s,this._drawingBufferHeight=l,this._glowFactorDirty=!1,this._useHdr=i;var u=Math.max(s,l);u=Math.pow(2,Math.ceil(Math.log(u)/Math.log(2))-2),u=Math.max(1,u);var d=i?n.halfFloatingPointTexture?ye.a.HALF_FLOAT:ye.a.FLOAT:ye.a.UNSIGNED_BYTE;this._texture=new P.a({context:n,width:u,height:u,pixelFormat:me.a.RGBA,pixelDatatype:d}),this._glowLengthTS=5*this._glowFactor,this._radiusTS=1/(1+2*this._glowLengthTS)*.5;var f=this,c={u_radiusTS:function(){return f._radiusTS}};this._commands.computeCommand=new Gn.a({fragmentShaderSource:"uniform float u_radiusTS;\n\nvarying vec2 v_textureCoordinates;\n\nvec2 rotate(vec2 p, vec2 direction)\n{\n    return vec2(p.x * direction.x - p.y * direction.y, p.x * direction.y + p.y * direction.x);\n}\n\nvec4 addBurst(vec2 position, vec2 direction, float lengthScalar)\n{\n    vec2 rotatedPosition = rotate(position, direction) * vec2(25.0, 0.75);\n    float radius = length(rotatedPosition) * lengthScalar;\n    float burst = 1.0 - smoothstep(0.0, 0.55, radius);\n    return vec4(burst);\n}\n\nvoid main()\n{\n    float lengthScalar = 2.0 / sqrt(2.0);\n    vec2 position = v_textureCoordinates - vec2(0.5);\n    float radius = length(position) * lengthScalar;\n    float surface = step(radius, u_radiusTS);\n    vec4 color = vec4(vec2(1.0), surface + 0.2, surface);\n\n    float glow = 1.0 - smoothstep(0.0, 0.55, radius);\n    color.ba += mix(vec2(0.0), vec2(1.0), glow) * 0.75;\n\n    vec4 burst = vec4(0.0);\n\n    // The following loop has been manually unrolled for speed, to\n    // avoid sin() and cos().\n    //\n    //for (float i = 0.4; i < 3.2; i += 1.047) {\n    //    vec2 direction = vec2(sin(i), cos(i));\n    //    burst += 0.4 * addBurst(position, direction, lengthScalar);\n    //\n    //    direction = vec2(sin(i - 0.08), cos(i - 0.08));\n    //    burst += 0.3 * addBurst(position, direction, lengthScalar);\n    //}\n\n    burst += 0.4 * addBurst(position, vec2(0.38942,  0.92106), lengthScalar);  // angle == 0.4\n    burst += 0.4 * addBurst(position, vec2(0.99235,  0.12348), lengthScalar);  // angle == 0.4 + 1.047\n    burst += 0.4 * addBurst(position, vec2(0.60327, -0.79754), lengthScalar);  // angle == 0.4 + 1.047 * 2.0\n\n    burst += 0.3 * addBurst(position, vec2(0.31457,  0.94924), lengthScalar);  // angle == 0.4 - 0.08\n    burst += 0.3 * addBurst(position, vec2(0.97931,  0.20239), lengthScalar);  // angle == 0.4 + 1.047 - 0.08\n    burst += 0.3 * addBurst(position, vec2(0.66507, -0.74678), lengthScalar);  // angle == 0.4 + 1.047 * 2.0 - 0.08\n\n    // End of manual loop unrolling.\n\n    color += clamp(burst, vec4(0.0), vec4(1.0)) * 0.15;\n\n    gl_FragColor = clamp(color, vec4(0.0), vec4(1.0));\n}\n",outputTexture:this._texture,uniformMap:c,persists:!1,owner:this,postExecute:function(){f._commands.computeCommand=void 0}})}var h=this._drawCommand;if(!Object(o.default)(h.vertexArray)){var m={direction:0},p=new Uint8Array(8);p[0]=0,p[1]=0,p[2]=255,p[3]=0,p[4]=255,p[5]=255,p[6]=0,p[7]=255;var _=re.a.createVertexBuffer({context:n,typedArray:p,usage:ne.a.STATIC_DRAW}),v=[{index:m.direction,vertexBuffer:_,componentsPerAttribute:2,normalize:!0,componentDatatype:Un.a.UNSIGNED_BYTE}],y=re.a.createIndexBuffer({context:n,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:ne.a.STATIC_DRAW,indexDatatype:Q.a.UNSIGNED_SHORT});h.vertexArray=new de.a({context:n,attributes:v,indexBuffer:y}),h.shaderProgram=F.a.fromCache({context:n,vertexShaderSource:"attribute vec2 direction;\n\nuniform float u_size;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main() \n{\n    vec4 position;\n    if (czm_morphTime == 1.0)\n    {\n        position = vec4(czm_sunPositionWC, 1.0);\n    }\n    else\n    {\n        position = vec4(czm_sunPositionColumbusView.zxy, 1.0);\n    }\n    \n    vec4 positionEC = czm_view * position;\n    vec4 positionWC = czm_eyeToWindowCoordinates(positionEC);\n    \n    vec2 halfSize = vec2(u_size * 0.5);\n    halfSize *= ((direction * 2.0) - 1.0);\n    \n    gl_Position = czm_viewportOrthographic * vec4(positionWC.xy + halfSize, -positionWC.z, 1.0);\n    \n    v_textureCoordinates = direction;\n}\n",fragmentShaderSource:"uniform sampler2D u_texture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    vec4 color = texture2D(u_texture, v_textureCoordinates);\n    gl_FragColor = czm_gammaCorrect(color);\n}\n",attributeLocations:m}),h.renderState=ue.a.fromCache({blending:fe.a.ALPHA_BLEND}),h.uniformMap=this._uniformMap}var b=n.uniformState.sunPositionWC,w=n.uniformState.sunPositionColumbusView,x=this._boundingVolume,O=this._boundingVolume2D;a.default.clone(b,x.center),O.center.x=w.z,O.center.y=w.x,O.center.z=w.y,x.radius=Z.default.SOLAR_RADIUS+Z.default.SOLAR_RADIUS*this._glowLengthTS,O.radius=x.radius,r===N.a.SCENE3D?g.default.clone(x,h.boundingVolume):r===N.a.COLUMBUS_VIEW&&g.default.clone(O,h.boundingVolume);var C=ef.default.computeActualWgs84Position(e,b,ty),T=a.default.magnitude(a.default.subtract(C,e.camera.position,ty)),E=n.uniformState.projection,A=ey;A.x=0,A.y=0,A.z=-T,A.w=1;var S=K.default.multiplyByVector(E,A,ty),D=ef.default.clipToGLWindowCoordinates(t.viewport,S,Jv);A.x=Z.default.SOLAR_RADIUS;var I=K.default.multiplyByVector(E,A,ty),M=ef.default.clipToGLWindowCoordinates(t.viewport,I,$v);return this._size=z.default.magnitude(z.default.subtract(M,D,ty)),this._size=2*this._size*(1+2*this._glowLengthTS),this._size=Math.ceil(this._size),this._commands}}},Kv.prototype.isDestroyed=function(){return!1},Kv.prototype.destroy=function(){var e=this._drawCommand;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy(),this._texture=this._texture&&this._texture.destroy(),Object(s.default)(this)};var iy=Kv;function ay(e){return i(1667)("./tycho2t3_80_"+e+".jpg")}function ry(e){var t=e._useBrowserRecommendedResolution?1:window.devicePixelRatio;return t*=e._resolutionScale,Object(o.default)(e._scene)&&(e._scene.pixelRatio=t),t}function ny(e){var t=e._canvas,i=t.clientWidth,a=t.clientHeight,r=ry(e);e._canvasClientWidth=i,e._canvasClientHeight=a,i*=r,a*=r,t.width=i,t.height=a,e._canRender=0!==i&&0!==a,e._lastDevicePixelRatio=window.devicePixelRatio}function oy(e){var t=e._canvas,i=t.width,a=t.height;if(0!==i&&0!==a){var r=e._scene.camera.frustum;Object(o.default)(r.aspectRatio)?r.aspectRatio=i/a:(r.top=r.right*(a/i),r.bottom=-r.top)}}function sy(e,t){e=Object(zd.default)(e),t=Object(n.default)(t,n.default.EMPTY_OBJECT);var i=document.createElement("div");i.className="cesium-widget",e.appendChild(i);var s=document.createElement("canvas"),l=d.default.supportsImageRenderingPixelated();function f(){s!==s.ownerDocument.activeElement&&s.ownerDocument.activeElement.blur()}this._supportsImageRenderingPixelated=l,l&&(s.style.imageRendering=d.default.imageRenderingValue()),s.oncontextmenu=function(){return!1},s.onselectstart=function(){return!1},s.addEventListener("mousedown",f),s.addEventListener("pointerdown",f),i.appendChild(s);var c=document.createElement("div");c.className="cesium-widget-credits";var m=Object(o.default)(t.creditContainer)?Object(zd.default)(t.creditContainer):i;m.appendChild(c);var p=Object(o.default)(t.creditViewport)?Object(zd.default)(t.creditViewport):i,g=Object(n.default)(t.showRenderLoopErrors,!0),v=Object(n.default)(t.useBrowserRecommendedResolution,!0);this._element=i,this._container=e,this._canvas=s,this._canvasClientWidth=0,this._canvasClientHeight=0,this._lastDevicePixelRatio=0,this._creditViewport=p,this._creditContainer=m,this._innerCreditContainer=c,this._canRender=!1,this._renderLoopRunning=!1,this._showRenderLoopErrors=g,this._resolutionScale=1,this._useBrowserRecommendedResolution=v,this._forceResize=!1,this._clock=Object(o.default)(t.clock)?t.clock:new r.default,ny(this);try{var y=new kv({canvas:s,contextOptions:t.contextOptions,creditContainer:c,creditViewport:p,mapProjection:t.mapProjection,orderIndependentTranslucency:t.orderIndependentTranslucency,scene3DOnly:Object(n.default)(t.scene3DOnly,!1),terrainExaggeration:t.terrainExaggeration,shadows:t.shadows,mapMode2D:t.mapMode2D,requestRenderMode:t.requestRenderMode,maximumRenderTimeChange:t.maximumRenderTimeChange});this._scene=y,y.camera.constrainedAxis=a.default.UNIT_Z,ry(this),oy(this);var b=Object(n.default)(y.mapProjection.ellipsoid,u.default.WGS84),w=t.globe;Object(o.default)(w)||(w=new ea(b)),!1!==w&&(y.globe=w,y.globe.shadows=Object(n.default)(t.terrainShadows,je.default.RECEIVE_ONLY));var x=t.skyBox;Object(o.default)(x)||(x=new Zv({sources:{positiveX:ay("px"),negativeX:ay("mx"),positiveY:ay("py"),negativeY:ay("my"),positiveZ:ay("pz"),negativeZ:ay("mz")}})),!1!==x&&(y.skyBox=x,y.sun=new iy,y.moon=new tn);var O=t.skyAtmosphere;Object(o.default)(O)||(O=new Xv(b)),!1!==O&&(y.skyAtmosphere=O);var C=!1!==t.globe&&t.imageryProvider;Object(o.default)(C)||(C=_()),!1!==C&&y.imageryLayers.addImageryProvider(C),Object(o.default)(t.terrainProvider)&&!1!==t.globe&&(y.terrainProvider=t.terrainProvider),this._screenSpaceEventHandler=new h.default(s),Object(o.default)(t.sceneMode)&&(t.sceneMode===N.a.SCENE2D&&this._scene.morphTo2D(0),t.sceneMode===N.a.COLUMBUS_VIEW&&this._scene.morphToColumbusView(0)),this._useDefaultRenderLoop=void 0,this.useDefaultRenderLoop=Object(n.default)(t.useDefaultRenderLoop,!0),this._targetFrameRate=void 0,this.targetFrameRate=t.targetFrameRate;var T=this;y.renderError.addEventListener((function(e,t){if(T._useDefaultRenderLoop=!1,T._renderLoopRunning=!1,T._showRenderLoopErrors){T.showErrorPanel("An error occurred while rendering.  Rendering has stopped.",void 0,t)}}))}catch(e){if(g){this.showErrorPanel("Error constructing CesiumWidget.",'Visit <a href="http://get.webgl.org">http://get.webgl.org</a> to verify that your web browser and hardware support WebGL.  Consider trying a different web browser or updating your video drivers.  Detailed error information is below:',e)}throw e}}Object.defineProperties(sy.prototype,{container:{get:function(){return this._container}},canvas:{get:function(){return this._canvas}},creditContainer:{get:function(){return this._creditContainer}},creditViewport:{get:function(){return this._creditViewport}},scene:{get:function(){return this._scene}},imageryLayers:{get:function(){return this._scene.imageryLayers}},terrainProvider:{get:function(){return this._scene.terrainProvider},set:function(e){this._scene.terrainProvider=e}},camera:{get:function(){return this._scene.camera}},clock:{get:function(){return this._clock}},screenSpaceEventHandler:{get:function(){return this._screenSpaceEventHandler}},targetFrameRate:{get:function(){return this._targetFrameRate},set:function(e){this._targetFrameRate=e}},useDefaultRenderLoop:{get:function(){return this._useDefaultRenderLoop},set:function(e){this._useDefaultRenderLoop!==e&&(this._useDefaultRenderLoop=e,e&&!this._renderLoopRunning&&function(e){e._renderLoopRunning=!0;var t=0;Object(c.default)((function i(a){if(!e.isDestroyed())if(e._useDefaultRenderLoop)try{var r=e._targetFrameRate;if(Object(o.default)(r)){var n=1e3/r,s=a-t;s>n&&(e.resize(),e.render(),t=a-s%n),Object(c.default)(i)}else e.resize(),e.render(),Object(c.default)(i)}catch(t){if(e._useDefaultRenderLoop=!1,e._renderLoopRunning=!1,e._showRenderLoopErrors){e.showErrorPanel("An error occurred while rendering.  Rendering has stopped.",void 0,t)}}else e._renderLoopRunning=!1}))}(this))}},resolutionScale:{get:function(){return this._resolutionScale},set:function(e){this._resolutionScale!==e&&(this._resolutionScale=e,this._forceResize=!0)}},useBrowserRecommendedResolution:{get:function(){return this._useBrowserRecommendedResolution},set:function(e){this._useBrowserRecommendedResolution!==e&&(this._useBrowserRecommendedResolution=e,this._forceResize=!0)}}}),sy.prototype.showErrorPanel=function(e,t,i){var a=this._element,r=document.createElement("div");r.className="cesium-widget-errorPanel";var n=document.createElement("div");n.className="cesium-widget-errorPanel-content",r.appendChild(n);var s=document.createElement("div");s.className="cesium-widget-errorPanel-header",s.appendChild(document.createTextNode(e)),n.appendChild(s);var l=document.createElement("div");function u(){l.style.maxHeight=Math.max(Math.round(.9*a.clientHeight-100),30)+"px"}if(l.className="cesium-widget-errorPanel-scroll",n.appendChild(l),u(),Object(o.default)(window.addEventListener)&&window.addEventListener("resize",u,!1),Object(o.default)(t)){var d=document.createElement("div");d.className="cesium-widget-errorPanel-message",d.innerHTML="<p>"+t+"</p>",l.appendChild(d)}var c="(no error details available)";Object(o.default)(i)&&(c=Object(f.default)(i));var h=document.createElement("div");h.className="cesium-widget-errorPanel-message",h.appendChild(document.createTextNode(c)),l.appendChild(h);var m=document.createElement("div");m.className="cesium-widget-errorPanel-buttonPanel",n.appendChild(m);var p=document.createElement("button");p.setAttribute("type","button"),p.className="cesium-button",p.appendChild(document.createTextNode("OK")),p.onclick=function(){Object(o.default)(u)&&Object(o.default)(window.removeEventListener)&&window.removeEventListener("resize",u,!1),a.removeChild(r)},m.appendChild(p),a.appendChild(r),"undefined"!=typeof console&&console.error(e+"\n"+t+"\n"+c)},sy.prototype.isDestroyed=function(){return!1},sy.prototype.destroy=function(){this._scene=this._scene&&this._scene.destroy(),this._container.removeChild(this._element),this._creditContainer.removeChild(this._innerCreditContainer),Object(s.default)(this)},sy.prototype.resize=function(){var e=this._canvas;(this._forceResize||this._canvasClientWidth!==e.clientWidth||this._canvasClientHeight!==e.clientHeight||this._lastDevicePixelRatio!==window.devicePixelRatio)&&(this._forceResize=!1,ny(this),oy(this),this._scene.requestRender())},sy.prototype.forceResize=function(){this._lastWidth=0,this.resize()},sy.prototype.render=function(){if(this._canRender){this._scene.initializeFrame();var e=this._clock.tick();this._scene.render(e)}else this._clock.tick()};t.default=sy},773:function(e,t,i){"use strict";i.r(t);var a=i(148),r=i(33),n=(i(15),i(74)),o=i(9),s=i(8),l=i(18),u=i(140),d=i(372),f=i(246),c=i(370);function h(){this._length=0,this._collections={},this._collectionsArray=[],this.show=!0}Object.defineProperties(h.prototype,{length:{get:function(){return this._length}}}),h.prototype.add=function(e,t){t=Object(o.default)(t,0);var i=this._collections[t];if(!Object(s.default)(i)){(i=new c.a({destroyPrimitives:!1}))._zIndex=t,this._collections[t]=i;for(var a=this._collectionsArray,r=0;r<a.length&&a[r]._zIndex<t;)r++;a.splice(r,0,i)}return i.add(e),this._length++,e._zIndex=t,e},h.prototype.set=function(e,t){return t===e._zIndex?e:(this.remove(e,!0),this.add(e,t),e)},h.prototype.remove=function(e,t){if(this.contains(e)){var i,a=e._zIndex,r=this._collections[a];return(i=t?r.remove(e):r.removeAndDestroy(e))&&this._length--,0===r.length&&(this._collectionsArray.splice(this._collectionsArray.indexOf(r),1),this._collections[a]=void 0,r.destroy()),i}return!1},h.prototype.removeAll=function(){for(var e=this._collectionsArray,t=0;t<e.length;t++){var i=e[t];i.destroyPrimitives=!0,i.destroy()}this._collections={},this._collectionsArray=[],this._length=0},h.prototype.contains=function(e){if(!Object(s.default)(e))return!1;var t=this._collections[e._zIndex];return Object(s.default)(t)&&t.contains(e)},h.prototype.update=function(e){if(this.show)for(var t=this._collectionsArray,i=0;i<t.length;i++)t[i].update(e)},h.prototype.isDestroyed=function(){return!1},h.prototype.destroy=function(){return this.removeAll(),Object(l.default)(this)};var m=h,p=i(79),_=i(58),g=i(24),v=i(12),y=i(21),b=i(10),w=i(86),x=i(166),O=i(69),C=i(154),T=i(139),E=i(87),P=i(38),A=y.default.WHITE,S=v.default.ZERO,D=O.default.NONE,I=g.default.ZERO,M=v.default.ZERO,F=C.default.CENTER,R=T.default.CENTER,N=new v.default,L=new y.default,j=new v.default,V=new g.default,U=new x.a,z=new x.a,B=new x.a,H=new _.default,k=new w.a;function W(e){this.entity=e,this.billboard=void 0,this.textureValue=void 0}function G(e,t){t.collectionChanged.addEventListener(G.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new p.default,this._onCollectionChanged(t,t.values,[],[])}function Y(e,t,i){Object(s.default)(e)&&(e.billboard=void 0,i.removeBillboard(t))}G.prototype.update=function(e){for(var t=this._items.values,i=this._cluster,a=0,r=t.length;a<r;a++){var n,o,l=t[a],u=l.entity,d=u._billboard,f=l.billboard,c=u.isShowing&&u.isAvailable(e)&&P.default.getValueOrDefault(d._show,e,!0);if(c&&(o=P.default.getValueOrUndefined(u._position,e,N),n=P.default.getValueOrUndefined(d._image,e),c=Object(s.default)(o)&&Object(s.default)(n)),c){P.default.isConstant(u._position)||(i._clusterDirty=!0),Object(s.default)(f)||((f=i.getBillboard(u)).id=u,f.image=void 0,l.billboard=f),f.show=c,Object(s.default)(f.image)&&l.textureValue===n||(f.image=n,l.textureValue=n),f.position=o,f.color=P.default.getValueOrDefault(d._color,e,A,L),f.eyeOffset=P.default.getValueOrDefault(d._eyeOffset,e,S,j),f.heightReference=P.default.getValueOrDefault(d._heightReference,e,D),f.pixelOffset=P.default.getValueOrDefault(d._pixelOffset,e,I,V),f.scale=P.default.getValueOrDefault(d._scale,e,1),f.rotation=P.default.getValueOrDefault(d._rotation,e,0),f.alignedAxis=P.default.getValueOrDefault(d._alignedAxis,e,M),f.horizontalOrigin=P.default.getValueOrDefault(d._horizontalOrigin,e,F),f.verticalOrigin=P.default.getValueOrDefault(d._verticalOrigin,e,R),f.width=P.default.getValueOrUndefined(d._width,e),f.height=P.default.getValueOrUndefined(d._height,e),f.scaleByDistance=P.default.getValueOrUndefined(d._scaleByDistance,e,U),f.translucencyByDistance=P.default.getValueOrUndefined(d._translucencyByDistance,e,z),f.pixelOffsetScaleByDistance=P.default.getValueOrUndefined(d._pixelOffsetScaleByDistance,e,B),f.sizeInMeters=P.default.getValueOrDefault(d._sizeInMeters,e,!1),f.distanceDisplayCondition=P.default.getValueOrUndefined(d._distanceDisplayCondition,e,k),f.disableDepthTestDistance=P.default.getValueOrUndefined(d._disableDepthTestDistance,e);var h=P.default.getValueOrUndefined(d._imageSubRegion,e,H);Object(s.default)(h)&&f.setImageSubRegion(f._imageId,h)}else Y(l,u,i)}return!0},G.prototype.getBoundingSphere=function(e,t){var i=this._items.get(e.id);if(!Object(s.default)(i)||!Object(s.default)(i.billboard))return E.default.FAILED;var a=i.billboard;if(a.heightReference===O.default.NONE)t.center=v.default.clone(a.position,t.center);else{if(!Object(s.default)(a._clampedPosition))return E.default.PENDING;t.center=v.default.clone(a._clampedPosition,t.center)}return t.radius=0,E.default.DONE},G.prototype.isDestroyed=function(){return!1},G.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(G.prototype._onCollectionChanged,this);for(var e=this._entityCollection.values,t=0;t<e.length;t++)this._cluster.removeBillboard(e[t]);return Object(l.default)(this)},G.prototype._onCollectionChanged=function(e,t,i,a){var r,n,o=this._items,l=this._cluster;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._billboard)&&Object(s.default)(n._position)&&o.set(n.id,new W(n));for(r=a.length-1;r>-1;r--)n=a[r],Object(s.default)(n._billboard)&&Object(s.default)(n._position)?o.contains(n.id)||o.set(n.id,new W(n)):(Y(o.get(n.id),n,l),o.remove(n.id));for(r=i.length-1;r>-1;r--)n=i[r],Y(o.get(n.id),n,l),o.remove(n.id)};var X=G,Q=i(212),q=i(23),Z=i(135),K=i(78),J=i(325),$=i(217);function ee(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT);var t=Object(o.default)(e.translucent,!0),i=Object(o.default)(e.closed,!1),a=Object(o.default)(e.materialSupport,ee.MaterialSupport.TEXTURED);this.material=Object(s.default)(e.material)?e.material:$.a.fromType($.a.ColorType),this.translucent=t,this._vertexShaderSource=Object(o.default)(e.vertexShaderSource,a.vertexShaderSource),this._fragmentShaderSource=Object(o.default)(e.fragmentShaderSource,a.fragmentShaderSource),this._renderState=J.a.getDefaultRenderState(t,i,e.renderState),this._closed=i,this._materialSupport=a,this._vertexFormat=a.vertexFormat,this._flat=Object(o.default)(e.flat,!1),this._faceForward=Object(o.default)(e.faceForward,!i)}Object.defineProperties(ee.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},materialSupport:{get:function(){return this._materialSupport}},vertexFormat:{get:function(){return this._vertexFormat}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}}}),ee.prototype.getFragmentShaderSource=J.a.prototype.getFragmentShaderSource,ee.prototype.isTranslucent=J.a.prototype.isTranslucent,ee.prototype.getRenderState=J.a.prototype.getRenderState,ee.MaterialSupport={BASIC:Object.freeze({vertexFormat:K.default.POSITION_AND_NORMAL,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n"}),TEXTURED:Object.freeze({vertexFormat:K.default.POSITION_NORMAL_AND_ST,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec2 st;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n    v_st = st;\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    materialInput.st = v_st;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n"}),ALL:Object.freeze({vertexFormat:K.default.ALL,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec3 tangent;\nattribute vec3 bitangent;\nattribute vec2 st;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_tangentEC;\nvarying vec3 v_bitangentEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n    v_tangentEC = czm_normal * tangent;                       // tangent in eye coordinates\n    v_bitangentEC = czm_normal * bitangent;                   // bitangent in eye coordinates\n    v_st = st;\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_tangentEC;\nvarying vec3 v_bitangentEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n    mat3 tangentToEyeMatrix = czm_tangentToEyeSpaceMatrix(v_normalEC, v_tangentEC, v_bitangentEC);\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.tangentToEyeMatrix = tangentToEyeMatrix;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    materialInput.st = v_st;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n"})};var te=ee,ie=i(73),ae=i(97),re=i(369),ne=i(340),oe=i(68),se=i(34);function le(e,t){e=Object(o.default)(e,0),t=Object(o.default)(t,Number.MAX_VALUE),this.value=new Float32Array([e,t])}Object.defineProperties(le.prototype,{componentDatatype:{get:function(){return se.a.FLOAT}},componentsPerAttribute:{get:function(){return 2}},normalize:{get:function(){return!1}}}),le.fromDistanceDisplayCondition=function(e){return new le(e.near,e.far)},le.toValue=function(e,t){return Object(s.default)(t)?(t[0]=e.near,t[1]=e.far,t):new Float32Array([e.near,e.far])};var ue=le,de=i(63),fe=i(85),ce=i(82),he=i(136),me=i(90),pe=i(72),_e=i(112);function ge(){b.default.throwInstantiationError()}Object.defineProperties(ge.prototype,{isConstant:{get:b.default.throwInstantiationError},definitionChanged:{get:b.default.throwInstantiationError}}),ge.prototype.getType=b.default.throwInstantiationError,ge.prototype.getValue=b.default.throwInstantiationError,ge.prototype.equals=b.default.throwInstantiationError,ge.getValue=function(e,t,i){var a;return Object(s.default)(t)&&(a=t.getType(e),Object(s.default)(a))?(Object(s.default)(i)&&i.type===a||(i=$.a.fromType(a)),t.getValue(e,i.uniforms),i):(Object(s.default)(i)&&i.type===$.a.ColorType||(i=$.a.fromType($.a.ColorType)),y.default.clone(y.default.WHITE,i.uniforms.color),i)};var ve=ge;function ye(e,t,i){this._primitives=t,this._orderedGroundPrimitives=i,this._primitive=void 0,this._outlinePrimitive=void 0,this._geometryUpdater=e,this._options=e._options,this._entity=e._entity,this._material=void 0}ye.prototype._isHidden=function(e,t,i){return!e.isShowing||!e.isAvailable(i)||!P.default.getValueOrDefault(t.show,i,!0)},ye.prototype._setOptions=b.default.throwInstantiationError,ye.prototype.update=function(e){var t=this._geometryUpdater,i=t._onTerrain,a=this._primitives,r=this._orderedGroundPrimitives;i?r.remove(this._primitive):(a.removeAndDestroy(this._primitive),a.removeAndDestroy(this._outlinePrimitive),this._outlinePrimitive=void 0),this._primitive=void 0;var n=this._entity,o=n[this._geometryUpdater._geometryPropertyName];if(this._setOptions(n,o,e),!this._isHidden(n,o,e)){var l=this._geometryUpdater.shadowsProperty.getValue(e),u=this._options;if(!Object(s.default)(o.fill)||o.fill.getValue(e)){var d,c=t.fillMaterialProperty,h=c instanceof pe.default,m=t._getIsClosed(u);if(h)d=new ie.a({closed:m,flat:i&&!t._supportsMaterialsforEntitiesOnTerrain});else{var p=ve.getValue(e,c,this._material);this._material=p,d=new te({material:p,translucent:p.isTranslucent(),closed:m})}if(i)u.vertexFormat=ie.a.VERTEX_FORMAT,this._primitive=r.add(new f.a({geometryInstances:this._geometryUpdater.createFillGeometryInstance(e),appearance:d,asynchronous:!1,shadows:l,classificationType:this._geometryUpdater.classificationTypeProperty.getValue(e)}),P.default.getValueOrUndefined(this._geometryUpdater.zIndex,e));else{u.vertexFormat=d.vertexFormat;var _=this._geometryUpdater.createFillGeometryInstance(e);h&&(d.translucent=255!==_.attributes.color.value[3]),this._primitive=a.add(new _e.a({geometryInstances:_,appearance:d,asynchronous:!1,shadows:l}))}}if(!i&&Object(s.default)(o.outline)&&o.outline.getValue(e)){var g=this._geometryUpdater.createOutlineGeometryInstance(e),v=P.default.getValueOrDefault(o.outlineWidth,e,1);this._outlinePrimitive=a.add(new _e.a({geometryInstances:g,appearance:new ie.a({flat:!0,translucent:255!==g.attributes.color.value[3],renderState:{lineWidth:t._scene.clampLineWidth(v)}}),asynchronous:!1,shadows:l}))}}},ye.prototype.getBoundingSphere=function(e){var t,i=this._entity,a=this._primitive,n=this._outlinePrimitive;return Object(s.default)(a)&&a.show&&a.ready&&(t=a.getGeometryInstanceAttributes(i),Object(s.default)(t)&&Object(s.default)(t.boundingSphere))?(r.default.clone(t.boundingSphere,e),E.default.DONE):Object(s.default)(n)&&n.show&&n.ready&&(t=n.getGeometryInstanceAttributes(i),Object(s.default)(t)&&Object(s.default)(t.boundingSphere))?(r.default.clone(t.boundingSphere,e),E.default.DONE):Object(s.default)(a)&&!a.ready||Object(s.default)(n)&&!n.ready?E.default.PENDING:E.default.FAILED},ye.prototype.isDestroyed=function(){return!1},ye.prototype.destroy=function(){var e=this._primitives,t=this._orderedGroundPrimitives;this._geometryUpdater._onTerrain?t.remove(this._primitive):e.removeAndDestroy(this._primitive),e.removeAndDestroy(this._outlinePrimitive),Object(l.default)(this)};var be=ye,we=i(185),xe=i(178),Oe=i(142),Ce=new pe.default(y.default.WHITE),Te=new xe.a(!0),Ee=new xe.a(!0),Pe=new xe.a(!1),Ae=new xe.a(y.default.BLACK),Se=new xe.a(ae.default.DISABLED),De=new xe.a(new w.a),Ie=new xe.a(Z.a.BOTH);function Me(e){var t=e.entity,i=e.geometryPropertyName;this._entity=t,this._scene=e.scene,this._fillEnabled=!1,this._isClosed=!1,this._onTerrain=!1,this._dynamic=!1,this._outlineEnabled=!1,this._geometryChanged=new q.default,this._showProperty=void 0,this._materialProperty=void 0,this._showOutlineProperty=void 0,this._outlineColorProperty=void 0,this._outlineWidth=1,this._shadowsProperty=void 0,this._distanceDisplayConditionProperty=void 0,this._classificationTypeProperty=void 0,this._options=e.geometryOptions,this._geometryPropertyName=i,this._id=i+"-"+t.id,this._observedPropertyNames=e.observedPropertyNames,this._supportsMaterialsforEntitiesOnTerrain=Oe.default.supportsMaterialsforEntitiesOnTerrain(e.scene)}Object.defineProperties(Me.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!Object(s.default)(this._entity.availability)&&P.default.isConstant(this._showProperty)&&P.default.isConstant(this._fillProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},outlineEnabled:{get:function(){return this._outlineEnabled}},hasConstantOutline:{get:function(){return!this._outlineEnabled||!Object(s.default)(this._entity.availability)&&P.default.isConstant(this._showProperty)&&P.default.isConstant(this._showOutlineProperty)}},outlineColorProperty:{get:function(){return this._outlineColorProperty}},outlineWidth:{get:function(){return this._outlineWidth}},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},classificationTypeProperty:{get:function(){return this._classificationTypeProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{get:function(){return this._isClosed}},onTerrain:{get:function(){return this._onTerrain}},geometryChanged:{get:function(){return this._geometryChanged}}}),Me.prototype.isOutlineVisible=function(e){var t=this._entity,i=this._outlineEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e);return Object(o.default)(i,!1)},Me.prototype.isFilled=function(e){var t=this._entity,i=this._fillEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e);return Object(o.default)(i,!1)},Me.prototype.createFillGeometryInstance=b.default.throwInstantiationError,Me.prototype.createOutlineGeometryInstance=b.default.throwInstantiationError,Me.prototype.isDestroyed=function(){return!1},Me.prototype.destroy=function(){Object(l.default)(this)},Me.prototype._isHidden=function(e,t){var i=t.show;return Object(s.default)(i)&&i.isConstant&&!i.getValue(ce.default.MINIMUM_VALUE)},Me.prototype._isOnTerrain=function(e,t){return!1},Me.prototype._getIsClosed=function(e){return!0},Me.prototype._isDynamic=b.default.throwInstantiationError,Me.prototype._setStaticOptions=b.default.throwInstantiationError,Me.prototype._onEntityPropertyChanged=function(e,t,i,a){if(-1!==this._observedPropertyNames.indexOf(t)){var r=this._entity[this._geometryPropertyName];if(Object(s.default)(r)){var n=r.fill,l=!Object(s.default)(n)||!n.isConstant||n.getValue(ce.default.MINIMUM_VALUE),u=r.outline,d=Object(s.default)(u);if(d&&u.isConstant&&(d=u.getValue(ce.default.MINIMUM_VALUE)),l||d){var f=r.show;if(this._isHidden(e,r))(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this));else{this._materialProperty=Object(o.default)(r.material,Ce),this._fillProperty=Object(o.default)(n,Ee),this._showProperty=Object(o.default)(f,Te),this._showOutlineProperty=Object(o.default)(r.outline,Pe),this._outlineColorProperty=d?Object(o.default)(r.outlineColor,Ae):void 0,this._shadowsProperty=Object(o.default)(r.shadows,Se),this._distanceDisplayConditionProperty=Object(o.default)(r.distanceDisplayCondition,De),this._classificationTypeProperty=Object(o.default)(r.classificationType,Ie),this._fillEnabled=l;var c=this._isOnTerrain(e,r)&&(this._supportsMaterialsforEntitiesOnTerrain||this._materialProperty instanceof pe.default);if(d&&c&&(Object(we.a)(we.a.geometryOutlines),d=!1),this._onTerrain=c,this._outlineEnabled=d,this._isDynamic(e,r))this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this));else{this._setStaticOptions(e,r),this._isClosed=this._getIsClosed(this._options);var h=r.outlineWidth;this._outlineWidth=Object(s.default)(h)?h.getValue(ce.default.MINIMUM_VALUE):1,this._dynamic=!1,this._geometryChanged.raiseEvent(this)}}}else(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this))}else(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this))}},Me.prototype.createDynamicUpdater=function(e,t){return new this.constructor.DynamicGeometryUpdater(this,e,t)};var Fe=Me,Re=i(175),Ne=i(30),Le=i(14),je=i(44),Ve=new v.default,Ue=new Ne.default;function ze(e,t,i,a){this._scene=e,this._heightReference=i,this._extrudedHeightReference=a,this._positionProperty=t,this._position=new v.default,this._cartographicPosition=new Ne.default,this._normal=new v.default,this._definitionChanged=new q.default,this._terrainHeight=0,this._removeCallbackFunc=void 0,this._removeEventListener=void 0,this._removeModeListener=void 0;var r=this;if(Object(s.default)(e.globe)&&(this._removeEventListener=e.terrainProviderChanged.addEventListener((function(){r._updateClamping()})),this._removeModeListener=e.morphComplete.addEventListener((function(){r._updateClamping()}))),t.isConstant){var n=t.getValue(ce.default.MINIMUM_VALUE,Ve);if(!Object(s.default)(n)||v.default.equals(n,v.default.ZERO)||!Object(s.default)(e.globe))return;this._position=v.default.clone(n,this._position),this._updateClamping(),this._normal=e.globe.ellipsoid.geodeticSurfaceNormal(n,this._normal)}}Object.defineProperties(ze.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}}}),ze.prototype._updateClamping=function(){Object(s.default)(this._removeCallbackFunc)&&this._removeCallbackFunc();var e=this._scene,t=e.globe,i=this._position;if(Object(s.default)(t)&&!v.default.equals(i,v.default.ZERO)){var a=t.ellipsoid,r=t._surface,n=this,o=a.cartesianToCartographic(i,this._cartographicPosition),l=t.getHeight(o);Object(s.default)(l)?this._terrainHeight=l:this._terrainHeight=0,this._removeCallbackFunc=r.updateHeight(o,(function(t){if(e.mode===je.a.SCENE3D){var i=a.cartesianToCartographic(t,Ue);n._terrainHeight=i.height}else n._terrainHeight=t.x;n.definitionChanged.raiseEvent()}))}else this._terrainHeight=0},ze.prototype.getValue=function(e,t){var i=P.default.getValueOrDefault(this._heightReference,e,O.default.NONE),a=P.default.getValueOrDefault(this._extrudedHeightReference,e,O.default.NONE);if(i===O.default.NONE&&a!==O.default.RELATIVE_TO_GROUND)return this._position=v.default.clone(v.default.ZERO,this._position),v.default.clone(v.default.ZERO,t);if(this._positionProperty.isConstant)return v.default.multiplyByScalar(this._normal,this._terrainHeight,t);var r=this._scene,n=this._positionProperty.getValue(e,Ve);if(!Object(s.default)(n)||v.default.equals(n,v.default.ZERO)||!Object(s.default)(r.globe))return v.default.clone(v.default.ZERO,t);if(v.default.equalsEpsilon(this._position,n,Le.default.EPSILON10))return v.default.multiplyByScalar(this._normal,this._terrainHeight,t);this._position=v.default.clone(n,this._position),this._updateClamping();var o=r.globe.ellipsoid.geodeticSurfaceNormal(n,this._normal);return v.default.multiplyByScalar(o,this._terrainHeight,t)},ze.prototype.isDestroyed=function(){return!1},ze.prototype.destroy=function(){return Object(s.default)(this._removeEventListener)&&this._removeEventListener(),Object(s.default)(this._removeModeListener)&&this._removeModeListener(),Object(s.default)(this._removeCallbackFunc)&&this._removeCallbackFunc(),Object(l.default)(this)};var Be=ze;var He=function(e,t,i,a){if(Fe.prototype._onEntityPropertyChanged.call(this,e,t,i,a),-1!==this._observedPropertyNames.indexOf(t)){var r=this._entity[this._geometryPropertyName];if(Object(s.default)(r)){Object(s.default)(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0);var n=r.heightReference;if(Object(s.default)(n)){var o=new Re.default(this._computeCenter.bind(this),!this._dynamic);this._terrainOffsetProperty=new Be(this._scene,o,n)}}}},ke=v.default.ZERO,We=new v.default,Ge=new v.default,Ye=new y.default;function Xe(e){this.id=e,this.vertexFormat=void 0,this.dimensions=void 0,this.offsetAttribute=void 0}function Qe(e,t){Fe.call(this,{entity:e,scene:t,geometryOptions:new Xe(e),geometryPropertyName:"box",observedPropertyNames:["availability","position","orientation","box"]}),this._onEntityPropertyChanged(e,"box",e.box,void 0)}function qe(e,t,i){be.call(this,e,t,i)}Object(s.default)(Object.create)&&(Qe.prototype=Object.create(Fe.prototype),Qe.prototype.constructor=Qe),Object.defineProperties(Qe.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),Qe.prototype.createFillGeometryInstance=function(e){var t,i=this._entity,a=i.isAvailable(e),r=new me.a(a&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),n=this._distanceDisplayConditionProperty.getValue(e),o={show:r,distanceDisplayCondition:ue.fromDistanceDisplayCondition(n),color:void 0,offset:void 0};this._materialProperty instanceof pe.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(t=this._materialProperty.color.getValue(e,Ye)),Object(s.default)(t)||(t=y.default.WHITE),o.color=oe.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(o.offset=he.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,ke,We))),new de.a({id:i,geometry:re.a.fromDimensions(this._options),modelMatrix:i.computeModelMatrixForHeightReference(e,i.box.heightReference,.5*this._options.dimensions.z,this._scene.mapProjection.ellipsoid),attributes:o})},Qe.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,i=t.isAvailable(e),a=P.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,Ye),r=this._distanceDisplayConditionProperty.getValue(e),n={show:new me.a(i&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(a),distanceDisplayCondition:ue.fromDistanceDisplayCondition(r),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(n.offset=he.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,ke,We))),new de.a({id:t,geometry:ne.a.fromDimensions(this._options),modelMatrix:t.computeModelMatrixForHeightReference(e,t.box.heightReference,.5*this._options.dimensions.z,this._scene.mapProjection.ellipsoid),attributes:n})},Qe.prototype._computeCenter=function(e,t){return P.default.getValueOrUndefined(this._entity.position,e,t)},Qe.prototype._isHidden=function(e,t){return!Object(s.default)(t.dimensions)||!Object(s.default)(e.position)||Fe.prototype._isHidden.call(this,e,t)},Qe.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&P.default.isConstant(e.orientation)&&t.dimensions.isConstant&&P.default.isConstant(t.outlineWidth))},Qe.prototype._setStaticOptions=function(e,t){var i=P.default.getValueOrDefault(t.heightReference,ce.default.MINIMUM_VALUE,O.default.NONE),a=this._options;a.vertexFormat=this._materialProperty instanceof pe.default?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,a.dimensions=t.dimensions.getValue(ce.default.MINIMUM_VALUE,a.dimensions),a.offsetAttribute=i!==O.default.NONE?fe.a.ALL:void 0},Qe.prototype._onEntityPropertyChanged=He,Qe.DynamicGeometryUpdater=qe,Object(s.default)(Object.create)&&(qe.prototype=Object.create(be.prototype),qe.prototype.constructor=qe),qe.prototype._isHidden=function(e,t,i){var a=P.default.getValueOrUndefined(e.position,i,Ge),r=this._options.dimensions;return!Object(s.default)(a)||!Object(s.default)(r)||be.prototype._isHidden.call(this,e,t,i)},qe.prototype._setOptions=function(e,t,i){var a=P.default.getValueOrDefault(t.heightReference,i,O.default.NONE),r=this._options;r.dimensions=P.default.getValueOrUndefined(t.dimensions,i,r.dimensions),r.offsetAttribute=a!==O.default.NONE?fe.a.ALL:void 0};var Ze=Qe,Ke=i(93),Je=i(150),$e=i(196),et=i(43),tt=i(239),it=i(48),at=i(208),rt=i(28),nt=i(54),ot=i(62),st=[new v.default,new v.default],lt=new v.default,ut=new v.default,dt=new v.default,ft=new v.default,ct=new v.default,ht=new v.default,mt=new v.default,pt=new v.default,_t=new v.default,gt=new v.default,vt=new v.default,yt={},bt=new Ne.default;function wt(e,t,i,a){var r,n=e[0],o=e[1],s=v.default.angleBetween(n,o),l=Math.ceil(s/a),u=new Array(l);if(t===i){for(r=0;r<l;r++)u[r]=t;return u.push(i),u}var d=(i-t)/l;for(r=1;r<l;r++){var f=t+r*d;u[r]=f}return u[0]=t,u.push(i),u}var xt=new v.default,Ot=new v.default;var Ct=new v.default(-1,0,0),Tt=new rt.default,Et=new rt.default,Pt=new et.default,At=et.default.IDENTITY.clone(),St=new v.default,Dt=new it.a,It=new v.default;function Mt(e,t,i,a,r,n,o,s){var l=St,u=Dt;Tt=ot.default.eastNorthUpToFixedFrame(e,r,Tt),l=rt.default.multiplyByPointAsVector(Tt,Ct,l);var d=function(e,t,i,a){var r=new at.default(i,a),n=r.projectPointOntoPlane(v.default.add(i,e,xt),xt),o=r.projectPointOntoPlane(v.default.add(i,t,Ot),Ot),s=g.default.angleBetween(n,o);return o.x*n.y-o.y*n.x>=0?-s:s}(l=v.default.normalize(l,l),t,e,r);Pt=et.default.fromRotationZ(d,Pt),It.z=n,Tt=rt.default.multiplyTransformation(Tt,rt.default.fromRotationTranslation(Pt,It,Et),Tt);var f=At;f[0]=o;for(var c=0;c<s;c++)for(var h=0;h<i.length;h+=3)u=v.default.fromArray(i,h,u),u=et.default.multiplyByVector(f,u,u),u=rt.default.multiplyByPoint(Tt,u,u),a.push(u.x,u.y,u.z);return a}var Ft=new v.default;function Rt(e,t,i,a,r,n,o){for(var s=0;s<e.length;s+=3){a=Mt(v.default.fromArray(e,s,Ft),t,i,a,r,n[s/3],o,1)}return a}function Nt(e,t){for(var i=e.length,a=new Array(3*i),r=0,n=t.x+t.width/2,o=t.y+t.height/2,s=0;s<i;s++)a[r++]=e[s].x-n,a[r++]=0,a[r++]=e[s].y-o;return a}var Lt=new nt.default,jt=new v.default,Vt=new et.default;function Ut(e,t,i,a,r,n,o,s,l,u){var d,f,c=v.default.angleBetween(v.default.subtract(t,e,gt),v.default.subtract(i,e,vt)),h=a===$e.a.BEVELED?0:Math.ceil(c/Le.default.toRadians(5));if(d=r?et.default.fromQuaternion(nt.default.fromAxisAngle(v.default.negate(e,gt),c/(h+1),Lt),Vt):et.default.fromQuaternion(nt.default.fromAxisAngle(e,c/(h+1),Lt),Vt),t=v.default.clone(t,jt),h>0)for(var m=u?2:1,p=0;p<h;p++)t=et.default.multiplyByVector(d,t,t),f=v.default.subtract(t,e,gt),f=v.default.normalize(f,f),r||(f=v.default.negate(f,f)),o=Mt(n.scaleToGeodeticSurface(t,vt),f,s,o,n,l,1,m);else f=v.default.subtract(t,e,gt),f=v.default.normalize(f,f),r||(f=v.default.negate(f,f)),o=Mt(n.scaleToGeodeticSurface(t,vt),f,s,o,n,l,1,1),i=v.default.clone(i,jt),f=v.default.subtract(i,e,gt),f=v.default.normalize(f,f),r||(f=v.default.negate(f,f)),o=Mt(n.scaleToGeodeticSurface(i,vt),f,s,o,n,l,1,1);return o}yt.removeDuplicatesFromShape=function(e){for(var t=e.length,i=[],a=t-1,r=0;r<t;a=r++){var n=e[a],o=e[r];g.default.equals(n,o)||i.push(o)}return i},yt.angleIsGreaterThanPi=function(e,t,i,a){var r=new at.default(i,a),n=r.projectPointOntoPlane(v.default.add(i,e,xt),xt),o=r.projectPointOntoPlane(v.default.add(i,t,Ot),Ot);return o.x*n.y-o.y*n.x>=0};var zt=new v.default,Bt=new v.default;yt.computePositions=function(e,t,i,a,r){var n=a._ellipsoid,o=function(e,t){for(var i=new Array(e.length),a=0;a<e.length;a++){var r=e[a];bt=t.cartesianToCartographic(r,bt),i[a]=bt.height,e[a]=t.scaleToGeodeticSurface(r,r)}return i}(e,n),s=a._granularity,l=a._cornerType,u=r?function(e,t){var i=e.length,a=new Array(6*i),r=0,n=t.x+t.width/2,o=t.y+t.height/2,s=e[0];a[r++]=s.x-n,a[r++]=0,a[r++]=s.y-o;for(var l=1;l<i;l++){var u=(s=e[l]).x-n,d=s.y-o;a[r++]=u,a[r++]=0,a[r++]=d,a[r++]=u,a[r++]=0,a[r++]=d}return s=e[0],a[r++]=s.x-n,a[r++]=0,a[r++]=s.y-o,a}(t,i):Nt(t,i),d=r?Nt(t,i):void 0,f=i.height/2,c=i.width/2,h=e.length,m=[],p=r?[]:void 0,_=lt,g=ut,y=dt,b=ft,w=ct,x=ht,O=mt,C=pt,T=_t,E=e[0],P=e[1];b=n.geodeticSurfaceNormal(E,b),_=v.default.subtract(P,E,_),_=v.default.normalize(_,_),C=v.default.cross(b,_,C),C=v.default.normalize(C,C);var A,S=o[0],D=o[1];r&&(p=Mt(E,C,d,p,n,S+f,1,1)),T=v.default.clone(E,T),E=P,g=v.default.negate(_,g);for(var I=1;I<h-1;I++){var M=r?2:1;P=e[I+1],_=v.default.subtract(P,E,_),_=v.default.normalize(_,_),y=v.default.add(_,g,y),y=v.default.normalize(y,y),b=n.geodeticSurfaceNormal(E,b);var F=v.default.multiplyByScalar(b,v.default.dot(_,b),zt);v.default.subtract(_,F,F),v.default.normalize(F,F);var R=v.default.multiplyByScalar(b,v.default.dot(g,b),Bt);if(v.default.subtract(g,R,R),v.default.normalize(R,R),!Le.default.equalsEpsilon(Math.abs(v.default.dot(F,R)),1,Le.default.EPSILON7)){y=v.default.cross(y,b,y),y=v.default.cross(b,y,y),y=v.default.normalize(y,y);var N=1/Math.max(.25,v.default.magnitude(v.default.cross(y,g,gt))),L=yt.angleIsGreaterThanPi(_,g,E,n);L?(w=v.default.add(E,v.default.multiplyByScalar(y,N*c,y),w),x=v.default.add(w,v.default.multiplyByScalar(C,c,x),x),st[0]=v.default.clone(T,st[0]),st[1]=v.default.clone(x,st[1]),A=wt(st,S+f,D+f,s),m=Rt(tt.a.generateArc({positions:st,granularity:s,ellipsoid:n}),C,u,m,n,A,1),C=v.default.cross(b,_,C),C=v.default.normalize(C,C),O=v.default.add(w,v.default.multiplyByScalar(C,c,O),O),l===$e.a.ROUNDED||l===$e.a.BEVELED?Ut(w,x,O,l,L,n,m,u,D+f,r):m=Mt(E,y=v.default.negate(y,y),u,m,n,D+f,N,M),T=v.default.clone(O,T)):(w=v.default.add(E,v.default.multiplyByScalar(y,N*c,y),w),x=v.default.add(w,v.default.multiplyByScalar(C,-c,x),x),st[0]=v.default.clone(T,st[0]),st[1]=v.default.clone(x,st[1]),A=wt(st,S+f,D+f,s),m=Rt(tt.a.generateArc({positions:st,granularity:s,ellipsoid:n}),C,u,m,n,A,1),C=v.default.cross(b,_,C),C=v.default.normalize(C,C),O=v.default.add(w,v.default.multiplyByScalar(C,-c,O),O),l===$e.a.ROUNDED||l===$e.a.BEVELED?Ut(w,x,O,l,L,n,m,u,D+f,r):m=Mt(E,y,u,m,n,D+f,N,M),T=v.default.clone(O,T)),g=v.default.negate(_,g)}else m=Mt(T,C,u,m,n,S+f,1,1),T=E;S=D,D=o[I+1],E=P}st[0]=v.default.clone(T,st[0]),st[1]=v.default.clone(E,st[1]),A=wt(st,S+f,D+f,s),m=Rt(tt.a.generateArc({positions:st,granularity:s,ellipsoid:n}),C,u,m,n,A,1),r&&(p=Mt(E,C,d,p,n,D+f,1,1)),h=m.length;var j=r?h+p.length:h,V=new Float64Array(j);return V.set(m),r&&V.set(p,h),V};var Ht=yt,kt={},Wt=new v.default,Gt=new v.default,Yt=new v.default,Xt=new v.default,Qt=[new v.default,new v.default],qt=new v.default,Zt=new v.default,Kt=new v.default,Jt=new v.default,$t=new v.default,ei=new v.default,ti=new v.default,ii=new v.default,ai=new v.default,ri=new v.default,ni=new nt.default,oi=new et.default;function si(e,t,i,a,r){var n,o=v.default.angleBetween(v.default.subtract(t,e,Wt),v.default.subtract(i,e,Gt)),s=a===$e.a.BEVELED?1:Math.ceil(o/Le.default.toRadians(5))+1,l=3*s,u=new Array(l);u[l-3]=i.x,u[l-2]=i.y,u[l-1]=i.z,n=r?et.default.fromQuaternion(nt.default.fromAxisAngle(v.default.negate(e,Wt),o/s,ni),oi):et.default.fromQuaternion(nt.default.fromAxisAngle(e,o/s,ni),oi);var d=0;t=v.default.clone(t,Wt);for(var f=0;f<s;f++)t=et.default.multiplyByVector(n,t,t),u[d++]=t.x,u[d++]=t.y,u[d++]=t.z;return u}function li(e,t,i,a){var r=Wt;return a?r=v.default.add(e,t,r):(t=v.default.negate(t,t),r=v.default.add(e,t,r)),[r.x,r.y,r.z,i.x,i.y,i.z]}function ui(e,t,i,a){for(var r=new Array(e.length),n=new Array(e.length),o=v.default.multiplyByScalar(t,i,Wt),s=v.default.negate(o,Gt),l=0,u=e.length-1,d=0;d<e.length;d+=3){var f=v.default.fromArray(e,d,Yt),c=v.default.add(f,s,Xt);r[l++]=c.x,r[l++]=c.y,r[l++]=c.z;var h=v.default.add(f,o,Xt);n[u--]=h.z,n[u--]=h.y,n[u--]=h.x}return a.push(r,n),a}kt.addAttribute=function(e,t,i,a){var r=t.x,n=t.y,o=t.z;Object(s.default)(i)&&(e[i]=r,e[i+1]=n,e[i+2]=o),Object(s.default)(a)&&(e[a]=o,e[a-1]=n,e[a-2]=r)};var di=new v.default,fi=new v.default;kt.computePositions=function(e){var t=e.granularity,i=e.positions,a=e.ellipsoid,r=e.width/2,n=e.cornerType,o=e.saveAttributes,s=qt,l=Zt,u=Kt,d=Jt,f=$t,c=ei,h=ti,m=ii,p=ai,_=ri,g=[],y=o?[]:void 0,b=o?[]:void 0,w=i[0],x=i[1];l=v.default.normalize(v.default.subtract(x,w,l),l),s=a.geodeticSurfaceNormal(w,s),d=v.default.normalize(v.default.cross(s,l,d),d),o&&(y.push(d.x,d.y,d.z),b.push(s.x,s.y,s.z)),h=v.default.clone(w,h),w=x,u=v.default.negate(l,u);var O,C,T=[],E=i.length;for(O=1;O<E-1;O++){s=a.geodeticSurfaceNormal(w,s),x=i[O+1],l=v.default.normalize(v.default.subtract(x,w,l),l),f=v.default.normalize(v.default.add(l,u,f),f);var P=v.default.multiplyByScalar(s,v.default.dot(l,s),di);v.default.subtract(l,P,P),v.default.normalize(P,P);var A=v.default.multiplyByScalar(s,v.default.dot(u,s),fi);if(v.default.subtract(u,A,A),v.default.normalize(A,A),!Le.default.equalsEpsilon(Math.abs(v.default.dot(P,A)),1,Le.default.EPSILON7)){f=v.default.cross(f,s,f),f=v.default.cross(s,f,f),f=v.default.normalize(f,f);var S=r/Math.max(.25,v.default.magnitude(v.default.cross(f,u,Wt))),D=Ht.angleIsGreaterThanPi(l,u,w,a);f=v.default.multiplyByScalar(f,S,f),D?(m=v.default.add(w,f,m),_=v.default.add(m,v.default.multiplyByScalar(d,r,_),_),p=v.default.add(m,v.default.multiplyByScalar(d,2*r,p),p),Qt[0]=v.default.clone(h,Qt[0]),Qt[1]=v.default.clone(_,Qt[1]),g=ui(tt.a.generateArc({positions:Qt,granularity:t,ellipsoid:a}),d,r,g),o&&(y.push(d.x,d.y,d.z),b.push(s.x,s.y,s.z)),c=v.default.clone(p,c),d=v.default.normalize(v.default.cross(s,l,d),d),p=v.default.add(m,v.default.multiplyByScalar(d,2*r,p),p),h=v.default.add(m,v.default.multiplyByScalar(d,r,h),h),n===$e.a.ROUNDED||n===$e.a.BEVELED?T.push({leftPositions:si(m,c,p,n,D)}):T.push({leftPositions:li(w,v.default.negate(f,f),p,D)})):(p=v.default.add(w,f,p),_=v.default.add(p,v.default.negate(v.default.multiplyByScalar(d,r,_),_),_),m=v.default.add(p,v.default.negate(v.default.multiplyByScalar(d,2*r,m),m),m),Qt[0]=v.default.clone(h,Qt[0]),Qt[1]=v.default.clone(_,Qt[1]),g=ui(tt.a.generateArc({positions:Qt,granularity:t,ellipsoid:a}),d,r,g),o&&(y.push(d.x,d.y,d.z),b.push(s.x,s.y,s.z)),c=v.default.clone(m,c),d=v.default.normalize(v.default.cross(s,l,d),d),m=v.default.add(p,v.default.negate(v.default.multiplyByScalar(d,2*r,m),m),m),h=v.default.add(p,v.default.negate(v.default.multiplyByScalar(d,r,h),h),h),n===$e.a.ROUNDED||n===$e.a.BEVELED?T.push({rightPositions:si(p,c,m,n,D)}):T.push({rightPositions:li(w,f,m,D)})),u=v.default.negate(l,u)}w=x}return s=a.geodeticSurfaceNormal(w,s),Qt[0]=v.default.clone(h,Qt[0]),Qt[1]=v.default.clone(w,Qt[1]),g=ui(tt.a.generateArc({positions:Qt,granularity:t,ellipsoid:a}),d,r,g),o&&(y.push(d.x,d.y,d.z),b.push(s.x,s.y,s.z)),n===$e.a.ROUNDED&&(C=function(e){var t=qt,i=Zt,a=Kt,r=e[1];i=v.default.fromArray(e[1],r.length-3,i),a=v.default.fromArray(e[0],0,a);var n=si(t=v.default.midpoint(i,a,t),i,a,$e.a.ROUNDED,!1),o=e.length-1,s=e[o-1];return r=e[o],i=v.default.fromArray(s,s.length-3,i),a=v.default.fromArray(r,0,a),[n,si(t=v.default.midpoint(i,a,t),i,a,$e.a.ROUNDED,!1)]}(g)),{positions:g,corners:T,lefts:y,normals:b,endPositions:C}};var ci=kt,hi=i(25),mi=i(51),pi=i(52),_i=i(64),gi=i(49),vi=i(143),yi=i(45),bi=i(29),wi=new v.default,xi=new v.default,Oi=new v.default,Ci=new v.default,Ti=new v.default,Ei=new v.default,Pi=new v.default,Ai=new v.default;function Si(e,t){for(var i=0;i<e.length;i++)e[i]=t.scaleToGeodeticSurface(e[i],e[i]);return e}function Di(e,t,i,a,r,n){var o=e.normals,s=e.tangents,l=e.bitangents,u=v.default.normalize(v.default.cross(i,t,Pi),Pi);n.normal&&ci.addAttribute(o,t,a,r),n.tangent&&ci.addAttribute(s,u,a,r),n.bitangent&&ci.addAttribute(l,i,a,r)}function Ii(e,t,i){var a,r,n,o=e.positions,l=e.corners,u=e.endPositions,d=e.lefts,f=e.normals,c=new _i.a,h=0,m=0,p=0;for(r=0;r<o.length;r+=2)h+=n=o[r].length-3,p+=2*n,m+=o[r+1].length-3;for(h+=3,m+=3,r=0;r<l.length;r++){a=l[r];var _=l[r].leftPositions;Object(s.default)(_)?(h+=n=_.length,p+=n):(m+=n=l[r].rightPositions.length,p+=n)}var g,y=Object(s.default)(u);y&&(h+=g=u[0].length-3,m+=g,p+=6*(g/=3));var b,w,x,O,C,T,E=h+m,P=new Float64Array(E),A={normals:t.normal?new Float32Array(E):void 0,tangents:t.tangent?new Float32Array(E):void 0,bitangents:t.bitangent?new Float32Array(E):void 0},S=0,D=E-1,I=wi,M=xi,F=g/2,R=gi.a.createTypedArray(E/3,p),N=0;if(y){T=Oi,C=Ci;var L=u[0];for(I=v.default.fromArray(f,0,I),M=v.default.fromArray(d,0,M),r=0;r<F;r++)T=v.default.fromArray(L,3*(F-1-r),T),C=v.default.fromArray(L,3*(F+r),C),ci.addAttribute(P,C,S),ci.addAttribute(P,T,void 0,D),Di(A,I,M,S,D,t),O=(w=S/3)+1,x=(b=(D-2)/3)-1,R[N++]=b,R[N++]=w,R[N++]=x,R[N++]=x,R[N++]=w,R[N++]=O,S+=3,D-=3}var j,V,U=0,z=0,B=o[U++],H=o[U++];for(P.set(B,S),P.set(H,D-H.length+1),M=v.default.fromArray(d,z,M),n=H.length-3,r=0;r<n;r+=3)j=i.geodeticSurfaceNormal(v.default.fromArray(B,r,Pi),Pi),V=i.geodeticSurfaceNormal(v.default.fromArray(H,n-r,Ai),Ai),Di(A,I=v.default.normalize(v.default.add(j,V,I),I),M,S,D,t),O=(w=S/3)+1,x=(b=(D-2)/3)-1,R[N++]=b,R[N++]=w,R[N++]=x,R[N++]=x,R[N++]=w,R[N++]=O,S+=3,D-=3;for(j=i.geodeticSurfaceNormal(v.default.fromArray(B,n,Pi),Pi),V=i.geodeticSurfaceNormal(v.default.fromArray(H,n,Ai),Ai),I=v.default.normalize(v.default.add(j,V,I),I),z+=3,r=0;r<l.length;r++){var k,W,G,Y=(a=l[r]).leftPositions,X=a.rightPositions,Q=Ei,q=Oi,Z=Ci;if(I=v.default.fromArray(f,z,I),Object(s.default)(Y)){for(Di(A,I,M,void 0,D,t),D-=3,W=O,G=x,k=0;k<Y.length/3;k++)Q=v.default.fromArray(Y,3*k,Q),R[N++]=W,R[N++]=G-k-1,R[N++]=G-k,ci.addAttribute(P,Q,void 0,D),q=v.default.fromArray(P,3*(G-k-1),q),Z=v.default.fromArray(P,3*W,Z),Di(A,I,M=v.default.normalize(v.default.subtract(q,Z,M),M),void 0,D,t),D-=3;Q=v.default.fromArray(P,3*W,Q),q=v.default.subtract(v.default.fromArray(P,3*G,q),Q,q),Z=v.default.subtract(v.default.fromArray(P,3*(G-k),Z),Q,Z),Di(A,I,M=v.default.normalize(v.default.add(q,Z,M),M),S,void 0,t),S+=3}else{for(Di(A,I,M,S,void 0,t),S+=3,W=x,G=O,k=0;k<X.length/3;k++)Q=v.default.fromArray(X,3*k,Q),R[N++]=W,R[N++]=G+k,R[N++]=G+k+1,ci.addAttribute(P,Q,S),q=v.default.fromArray(P,3*W,q),Z=v.default.fromArray(P,3*(G+k),Z),Di(A,I,M=v.default.normalize(v.default.subtract(q,Z,M),M),S,void 0,t),S+=3;Q=v.default.fromArray(P,3*W,Q),q=v.default.subtract(v.default.fromArray(P,3*(G+k),q),Q,q),Z=v.default.subtract(v.default.fromArray(P,3*G,Z),Q,Z),Di(A,I,M=v.default.normalize(v.default.negate(v.default.add(Z,q,M),M),M),void 0,D,t),D-=3}for(B=o[U++],H=o[U++],B.splice(0,3),H.splice(H.length-3,3),P.set(B,S),P.set(H,D-H.length+1),n=H.length-3,z+=3,M=v.default.fromArray(d,z,M),k=0;k<H.length;k+=3)j=i.geodeticSurfaceNormal(v.default.fromArray(B,k,Pi),Pi),V=i.geodeticSurfaceNormal(v.default.fromArray(H,n-k,Ai),Ai),Di(A,I=v.default.normalize(v.default.add(j,V,I),I),M,S,D,t),w=(O=S/3)-1,b=(x=(D-2)/3)+1,R[N++]=b,R[N++]=w,R[N++]=x,R[N++]=x,R[N++]=w,R[N++]=O,S+=3,D-=3;S-=3,D+=3}if(Di(A,I=v.default.fromArray(f,f.length-3,I),M,S,D,t),y){S+=3,D-=3,T=Oi,C=Ci;var K=u[1];for(r=0;r<F;r++)T=v.default.fromArray(K,3*(g-r-1),T),C=v.default.fromArray(K,3*r,C),ci.addAttribute(P,T,void 0,D),ci.addAttribute(P,C,S),Di(A,I,M,S,D,t),w=(O=S/3)-1,b=(x=(D-2)/3)+1,R[N++]=b,R[N++]=w,R[N++]=x,R[N++]=x,R[N++]=w,R[N++]=O,S+=3,D-=3}if(c.position=new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:P}),t.st){var J,$,ee=new Float32Array(E/3*2),te=0;if(y){h/=3,m/=3;var ie,ae=Math.PI/(g+1);$=1/(h-g+1),J=1/(m-g+1);var re=g/2;for(r=re+1;r<g+1;r++)ie=Le.default.PI_OVER_TWO+ae*r,ee[te++]=J*(1+Math.cos(ie)),ee[te++]=.5*(1+Math.sin(ie));for(r=1;r<m-g+1;r++)ee[te++]=r*J,ee[te++]=0;for(r=g;r>re;r--)ie=Le.default.PI_OVER_TWO-r*ae,ee[te++]=1-J*(1+Math.cos(ie)),ee[te++]=.5*(1+Math.sin(ie));for(r=re;r>0;r--)ie=Le.default.PI_OVER_TWO-ae*r,ee[te++]=1-$*(1+Math.cos(ie)),ee[te++]=.5*(1+Math.sin(ie));for(r=h-g;r>0;r--)ee[te++]=r*$,ee[te++]=1;for(r=1;r<re+1;r++)ie=Le.default.PI_OVER_TWO+ae*r,ee[te++]=$*(1+Math.cos(ie)),ee[te++]=.5*(1+Math.sin(ie))}else{for($=1/((h/=3)-1),J=1/((m/=3)-1),r=0;r<m;r++)ee[te++]=r*J,ee[te++]=0;for(r=h;r>0;r--)ee[te++]=(r-1)*$,ee[te++]=1}c.st=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:ee})}return t.normal&&(c.normal=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:A.normals})),t.tangent&&(c.tangent=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:A.tangents})),t.bitangent&&(c.bitangent=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:A.bitangents})),{attributes:c,indices:R}}function Mi(e,t,i){i[t++]=e[0],i[t++]=e[1],i[t++]=e[2];for(var a=3;a<e.length;a+=3){var r=e[a],n=e[a+1],o=e[a+2];i[t++]=r,i[t++]=n,i[t++]=o,i[t++]=r,i[t++]=n,i[t++]=o}return i[t++]=e[0],i[t++]=e[1],i[t++]=e[2],i}function Fi(e,t){var i=new K.default({position:t.position,normal:t.normal||t.bitangent||e.shadowVolume,tangent:t.tangent,bitangent:t.normal||t.bitangent,st:t.st}),a=e.ellipsoid,r=Ii(ci.computePositions(e),i,a),n=e.height,o=e.extrudedHeight,l=r.attributes,u=r.indices,d=l.position.values,f=d.length,c=new Float64Array(6*f),h=new Float64Array(f);h.set(d);var m,p=new Float64Array(4*f);p=Mi(d=vi.a.scaleToGeodeticHeight(d,n,a),0,p),p=Mi(h=vi.a.scaleToGeodeticHeight(h,o,a),2*f,p),c.set(d),c.set(h,f),c.set(p,2*f),l.position.values=c,l=function(e,t){if(!(t.normal||t.tangent||t.bitangent||t.st))return e;var i,a,r=e.position.values;(t.normal||t.bitangent)&&(i=e.normal.values,a=e.bitangent.values);var n,o=e.position.values.length/18,s=3*o,l=2*o,u=2*s;if(t.normal||t.bitangent||t.tangent){var d=t.normal?new Float32Array(6*s):void 0,f=t.tangent?new Float32Array(6*s):void 0,c=t.bitangent?new Float32Array(6*s):void 0,h=wi,m=xi,p=Oi,_=Ci,g=Ti,y=Ei,b=u;for(n=0;n<s;n+=3){var w=b+u;h=v.default.fromArray(r,n,h),m=v.default.fromArray(r,n+s,m),p=v.default.fromArray(r,(n+3)%s,p),m=v.default.subtract(m,h,m),p=v.default.subtract(p,h,p),_=v.default.normalize(v.default.cross(m,p,_),_),t.normal&&(ci.addAttribute(d,_,w),ci.addAttribute(d,_,w+3),ci.addAttribute(d,_,b),ci.addAttribute(d,_,b+3)),(t.tangent||t.bitangent)&&(y=v.default.fromArray(i,n,y),t.bitangent&&(ci.addAttribute(c,y,w),ci.addAttribute(c,y,w+3),ci.addAttribute(c,y,b),ci.addAttribute(c,y,b+3)),t.tangent&&(g=v.default.normalize(v.default.cross(y,_,g),g),ci.addAttribute(f,g,w),ci.addAttribute(f,g,w+3),ci.addAttribute(f,g,b),ci.addAttribute(f,g,b+3))),b+=6}if(t.normal){for(d.set(i),n=0;n<s;n+=3)d[n+s]=-i[n],d[n+s+1]=-i[n+1],d[n+s+2]=-i[n+2];e.normal.values=d}else e.normal=void 0;if(t.bitangent?(c.set(a),c.set(a,s),e.bitangent.values=c):e.bitangent=void 0,t.tangent){var x=e.tangent.values;f.set(x),f.set(x,s),e.tangent.values=f}}if(t.st){var O=e.st.values,C=new Float32Array(6*l);C.set(O),C.set(O,l);for(var T=2*l,E=0;E<2;E++){for(C[T++]=O[0],C[T++]=O[1],n=2;n<l;n+=2){var P=O[n],A=O[n+1];C[T++]=P,C[T++]=A,C[T++]=P,C[T++]=A}C[T++]=O[0],C[T++]=O[1]}e.st.values=C}return e}(l,t);var _=f/3;if(e.shadowVolume){var g=l.normal.values;f=g.length;var y=new Float32Array(6*f);for(m=0;m<f;m++)g[m]=-g[m];y.set(g,f),y=Mi(g,4*f,y),l.extrudeDirection=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:y}),t.normal||(l.normal=void 0)}if(Object(s.default)(e.offsetAttribute)){var b=new Uint8Array(6*_);if(e.offsetAttribute===fe.a.TOP)b=Object(Ke.a)(b,1,0,_),b=Object(Ke.a)(b,1,2*_,4*_);else{var w=e.offsetAttribute===fe.a.NONE?0:1;b=Object(Ke.a)(b,w)}l.applyOffset=new pi.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})}var x=u.length,O=_+_,C=gi.a.createTypedArray(c.length/3,2*x+3*O);C.set(u);var T,E,P,A,S=x;for(m=0;m<x;m+=3){var D=u[m],I=u[m+1],M=u[m+2];C[S++]=M+_,C[S++]=I+_,C[S++]=D+_}for(m=0;m<O;m+=2)P=(T=m+O)+1,A=(E=T+O)+1,C[S++]=T,C[S++]=E,C[S++]=P,C[S++]=P,C[S++]=E,C[S++]=A;return{attributes:l,indices:C}}var Ri=new v.default,Ni=new v.default,Li=new Ne.default;function ji(e,t,i,a,r,n){var o=v.default.subtract(t,e,Ri);v.default.normalize(o,o);var s=i.geodeticSurfaceNormal(e,Ni),l=v.default.cross(o,s,Ri);v.default.multiplyByScalar(l,a,l);var u=r.latitude,d=r.longitude,f=n.latitude,c=n.longitude;v.default.add(e,l,Ni),i.cartesianToCartographic(Ni,Li);var h=Li.latitude,m=Li.longitude;u=Math.min(u,h),d=Math.min(d,m),f=Math.max(f,h),c=Math.max(c,m),v.default.subtract(e,l,Ni),i.cartesianToCartographic(Ni,Li),h=Li.latitude,m=Li.longitude,u=Math.min(u,h),d=Math.min(d,m),f=Math.max(f,h),c=Math.max(c,m),r.latitude=u,r.longitude=d,n.latitude=f,n.longitude=c}var Vi=new v.default,Ui=new v.default,zi=new Ne.default,Bi=new Ne.default;function Hi(e,t,i,a,r){e=Si(e,t);var n=Object(Je.a)(e,v.default.equalsEpsilon),o=n.length;if(o<2||i<=0)return new bi.default;var l,u,d=.5*i;if(zi.latitude=Number.POSITIVE_INFINITY,zi.longitude=Number.POSITIVE_INFINITY,Bi.latitude=Number.NEGATIVE_INFINITY,Bi.longitude=Number.NEGATIVE_INFINITY,a===$e.a.ROUNDED){var f=n[0];v.default.subtract(f,n[1],Vi),v.default.normalize(Vi,Vi),v.default.multiplyByScalar(Vi,d,Vi),v.default.add(f,Vi,Ui),t.cartesianToCartographic(Ui,Li),l=Li.latitude,u=Li.longitude,zi.latitude=Math.min(zi.latitude,l),zi.longitude=Math.min(zi.longitude,u),Bi.latitude=Math.max(Bi.latitude,l),Bi.longitude=Math.max(Bi.longitude,u)}for(var c=0;c<o-1;++c)ji(n[c],n[c+1],t,d,zi,Bi);var h=n[o-1];v.default.subtract(h,n[o-2],Vi),v.default.normalize(Vi,Vi),v.default.multiplyByScalar(Vi,d,Vi),v.default.add(h,Vi,Ui),ji(h,Ui,t,d,zi,Bi),a===$e.a.ROUNDED&&(t.cartesianToCartographic(Ui,Li),l=Li.latitude,u=Li.longitude,zi.latitude=Math.min(zi.latitude,l),zi.longitude=Math.min(zi.longitude,u),Bi.latitude=Math.max(Bi.latitude,l),Bi.longitude=Math.max(Bi.longitude,u));var m=Object(s.default)(r)?r:new bi.default;return m.north=Bi.latitude,m.south=zi.latitude,m.east=Bi.longitude,m.west=zi.longitude,m}function ki(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,i=e.width,a=Object(o.default)(e.height,0),r=Object(o.default)(e.extrudedHeight,a);this._positions=t,this._ellipsoid=hi.default.clone(Object(o.default)(e.ellipsoid,hi.default.WGS84)),this._vertexFormat=K.default.clone(Object(o.default)(e.vertexFormat,K.default.DEFAULT)),this._width=i,this._height=Math.max(a,r),this._extrudedHeight=Math.min(a,r),this._cornerType=Object(o.default)(e.cornerType,$e.a.ROUNDED),this._granularity=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createCorridorGeometry",this._offsetAttribute=e.offsetAttribute,this._rectangle=void 0,this.packedLength=1+t.length*v.default.packedLength+hi.default.packedLength+K.default.packedLength+7}ki.pack=function(e,t,i){i=Object(o.default)(i,0);var a=e._positions,r=a.length;t[i++]=r;for(var n=0;n<r;++n,i+=v.default.packedLength)v.default.pack(a[n],t,i);return hi.default.pack(e._ellipsoid,t,i),i+=hi.default.packedLength,K.default.pack(e._vertexFormat,t,i),i+=K.default.packedLength,t[i++]=e._width,t[i++]=e._height,t[i++]=e._extrudedHeight,t[i++]=e._cornerType,t[i++]=e._granularity,t[i++]=e._shadowVolume?1:0,t[i]=Object(o.default)(e._offsetAttribute,-1),t};var Wi=hi.default.clone(hi.default.UNIT_SPHERE),Gi=new K.default,Yi={positions:void 0,ellipsoid:Wi,vertexFormat:Gi,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,shadowVolume:void 0,offsetAttribute:void 0};ki.unpack=function(e,t,i){t=Object(o.default)(t,0);for(var a=e[t++],r=new Array(a),n=0;n<a;++n,t+=v.default.packedLength)r[n]=v.default.unpack(e,t);var l=hi.default.unpack(e,t,Wi);t+=hi.default.packedLength;var u=K.default.unpack(e,t,Gi);t+=K.default.packedLength;var d=e[t++],f=e[t++],c=e[t++],h=e[t++],m=e[t++],p=1===e[t++],_=e[t];return Object(s.default)(i)?(i._positions=r,i._ellipsoid=hi.default.clone(l,i._ellipsoid),i._vertexFormat=K.default.clone(u,i._vertexFormat),i._width=d,i._height=f,i._extrudedHeight=c,i._cornerType=h,i._granularity=m,i._shadowVolume=p,i._offsetAttribute=-1===_?void 0:_,i):(Yi.positions=r,Yi.width=d,Yi.height=f,Yi.extrudedHeight=c,Yi.cornerType=h,Yi.granularity=m,Yi.shadowVolume=p,Yi.offsetAttribute=-1===_?void 0:_,new ki(Yi))},ki.computeRectangle=function(e,t){var i=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,a=e.width;return Hi(i,Object(o.default)(e.ellipsoid,hi.default.WGS84),a,Object(o.default)(e.cornerType,$e.a.ROUNDED),t)},ki.createGeometry=function(e){var t=e._positions,i=e._width,a=e._ellipsoid;t=Si(t,a);var n=Object(Je.a)(t,v.default.equalsEpsilon);if(!(n.length<2||i<=0)){var o,l=e._height,u=e._extrudedHeight,d=!Le.default.equalsEpsilon(l,u,0,Le.default.EPSILON2),f=e._vertexFormat,c={ellipsoid:a,positions:n,width:i,cornerType:e._cornerType,granularity:e._granularity,saveAttributes:!0};if(d)c.height=l,c.extrudedHeight=u,c.shadowVolume=e._shadowVolume,c.offsetAttribute=e._offsetAttribute,o=Fi(c,f);else if((o=Ii(ci.computePositions(c),f,a)).attributes.position.values=vi.a.scaleToGeodeticHeight(o.attributes.position.values,l,a),Object(s.default)(e._offsetAttribute)){var h=e._offsetAttribute===fe.a.NONE?0:1,m=o.attributes.position.values.length,p=new Uint8Array(m/3);Object(Ke.a)(p,h),o.attributes.applyOffset=new pi.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:p})}var _=o.attributes,g=r.default.fromVertices(_.position.values,void 0,3);return f.position||(o.attributes.position.values=void 0),new mi.a({attributes:_,indices:o.indices,primitiveType:yi.a.TRIANGLES,boundingSphere:g,offsetAttribute:e._offsetAttribute})}},ki.createShadowVolume=function(e,t,i){var a=e._granularity,r=e._ellipsoid,n=t(a,r),o=i(a,r);return new ki({positions:e._positions,width:e._width,cornerType:e._cornerType,ellipsoid:r,granularity:a,extrudedHeight:n,height:o,vertexFormat:K.default.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(ki.prototype,{rectangle:{get:function(){return Object(s.default)(this._rectangle)||(this._rectangle=Hi(this._positions,this._ellipsoid,this._width,this._cornerType)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return[0,0,0,1,1,0]}}});var Xi=ki,Qi=new v.default,qi=new v.default,Zi=new v.default;function Ki(e,t){var i,a,r,n=[],o=e.positions,l=e.corners,u=e.endPositions,d=new _i.a,f=0,c=0,h=0;for(a=0;a<o.length;a+=2)f+=r=o[a].length-3,h+=r/3*4,c+=o[a+1].length-3;for(f+=3,c+=3,a=0;a<l.length;a++){i=l[a];var m=l[a].leftPositions;Object(s.default)(m)?(f+=r=m.length,h+=r/3*2):(c+=r=l[a].rightPositions.length,h+=r/3*2)}var p,_=Object(s.default)(u);_&&(f+=p=u[0].length-3,c+=p,h+=4*(p/=3));var g,y,b,w,x,O,C=f+c,T=new Float64Array(C),E=0,P=C-1,A=p/2,S=gi.a.createTypedArray(C/3,h+4),D=0;if(S[D++]=E/3,S[D++]=(P-2)/3,_){n.push(E/3),O=Qi,x=qi;var I=u[0];for(a=0;a<A;a++)O=v.default.fromArray(I,3*(A-1-a),O),x=v.default.fromArray(I,3*(A+a),x),ci.addAttribute(T,x,E),ci.addAttribute(T,O,void 0,P),w=(y=E/3)+1,b=(g=(P-2)/3)-1,S[D++]=g,S[D++]=b,S[D++]=y,S[D++]=w,E+=3,P-=3}var M=0,F=o[M++],R=o[M++];for(T.set(F,E),T.set(R,P-R.length+1),r=R.length-3,n.push(E/3,(P-2)/3),a=0;a<r;a+=3)w=(y=E/3)+1,b=(g=(P-2)/3)-1,S[D++]=g,S[D++]=b,S[D++]=y,S[D++]=w,E+=3,P-=3;for(a=0;a<l.length;a++){var N,L,j=(i=l[a]).leftPositions,V=i.rightPositions,U=Zi;if(Object(s.default)(j)){for(P-=3,L=b,n.push(w),N=0;N<j.length/3;N++)U=v.default.fromArray(j,3*N,U),S[D++]=L-N-1,S[D++]=L-N,ci.addAttribute(T,U,void 0,P),P-=3;n.push(L-Math.floor(j.length/6)),t===$e.a.BEVELED&&n.push((P-2)/3+1),E+=3}else{for(E+=3,L=w,n.push(b),N=0;N<V.length/3;N++)U=v.default.fromArray(V,3*N,U),S[D++]=L+N,S[D++]=L+N+1,ci.addAttribute(T,U,E),E+=3;n.push(L+Math.floor(V.length/6)),t===$e.a.BEVELED&&n.push(E/3-1),P-=3}for(F=o[M++],R=o[M++],F.splice(0,3),R.splice(R.length-3,3),T.set(F,E),T.set(R,P-R.length+1),r=R.length-3,N=0;N<R.length;N+=3)y=(w=E/3)-1,g=(b=(P-2)/3)+1,S[D++]=g,S[D++]=b,S[D++]=y,S[D++]=w,E+=3,P-=3;E-=3,P+=3,n.push(E/3,(P-2)/3)}if(_){E+=3,P-=3,O=Qi,x=qi;var z=u[1];for(a=0;a<A;a++)O=v.default.fromArray(z,3*(p-a-1),O),x=v.default.fromArray(z,3*a,x),ci.addAttribute(T,O,void 0,P),ci.addAttribute(T,x,E),y=(w=E/3)-1,g=(b=(P-2)/3)+1,S[D++]=g,S[D++]=b,S[D++]=y,S[D++]=w,E+=3,P-=3;n.push(E/3)}else n.push(E/3,(P-2)/3);return S[D++]=E/3,S[D++]=(P-2)/3,d.position=new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:T}),{attributes:d,indices:S,wallIndices:n}}function Ji(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,i=e.width,a=Object(o.default)(e.height,0),r=Object(o.default)(e.extrudedHeight,a);this._positions=t,this._ellipsoid=hi.default.clone(Object(o.default)(e.ellipsoid,hi.default.WGS84)),this._width=i,this._height=Math.max(a,r),this._extrudedHeight=Math.min(a,r),this._cornerType=Object(o.default)(e.cornerType,$e.a.ROUNDED),this._granularity=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),this._offsetAttribute=e.offsetAttribute,this._workerName="createCorridorOutlineGeometry",this.packedLength=1+t.length*v.default.packedLength+hi.default.packedLength+6}Ji.pack=function(e,t,i){i=Object(o.default)(i,0);var a=e._positions,r=a.length;t[i++]=r;for(var n=0;n<r;++n,i+=v.default.packedLength)v.default.pack(a[n],t,i);return hi.default.pack(e._ellipsoid,t,i),i+=hi.default.packedLength,t[i++]=e._width,t[i++]=e._height,t[i++]=e._extrudedHeight,t[i++]=e._cornerType,t[i++]=e._granularity,t[i]=Object(o.default)(e._offsetAttribute,-1),t};var $i=hi.default.clone(hi.default.UNIT_SPHERE),ea={positions:void 0,ellipsoid:$i,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,offsetAttribute:void 0};Ji.unpack=function(e,t,i){t=Object(o.default)(t,0);for(var a=e[t++],r=new Array(a),n=0;n<a;++n,t+=v.default.packedLength)r[n]=v.default.unpack(e,t);var l=hi.default.unpack(e,t,$i);t+=hi.default.packedLength;var u=e[t++],d=e[t++],f=e[t++],c=e[t++],h=e[t++],m=e[t];return Object(s.default)(i)?(i._positions=r,i._ellipsoid=hi.default.clone(l,i._ellipsoid),i._width=u,i._height=d,i._extrudedHeight=f,i._cornerType=c,i._granularity=h,i._offsetAttribute=-1===m?void 0:m,i):(ea.positions=r,ea.width=u,ea.height=d,ea.extrudedHeight=f,ea.cornerType=c,ea.granularity=h,ea.offsetAttribute=-1===m?void 0:m,new Ji(ea))},Ji.createGeometry=function(e){var t=e._positions,i=e._width,a=e._ellipsoid;t=function(e,t){for(var i=0;i<e.length;i++)e[i]=t.scaleToGeodeticSurface(e[i],e[i]);return e}(t,a);var n=Object(Je.a)(t,v.default.equalsEpsilon);if(!(n.length<2||i<=0)){var o,l=e._height,u=e._extrudedHeight,d=!Le.default.equalsEpsilon(l,u,0,Le.default.EPSILON2),f={ellipsoid:a,positions:n,width:i,cornerType:e._cornerType,granularity:e._granularity,saveAttributes:!1};if(d)f.height=l,f.extrudedHeight=u,f.offsetAttribute=e._offsetAttribute,o=function(e){var t=e.ellipsoid,i=Ki(ci.computePositions(e),e.cornerType),a=i.wallIndices,r=e.height,n=e.extrudedHeight,o=i.attributes,l=i.indices,u=o.position.values,d=u.length,f=new Float64Array(d);f.set(u);var c,h=new Float64Array(2*d);if(u=vi.a.scaleToGeodeticHeight(u,r,t),f=vi.a.scaleToGeodeticHeight(f,n,t),h.set(u),h.set(f,d),o.position.values=h,d/=3,Object(s.default)(e.offsetAttribute)){var m=new Uint8Array(2*d);if(e.offsetAttribute===fe.a.TOP)m=Object(Ke.a)(m,1,0,d);else{var p=e.offsetAttribute===fe.a.NONE?0:1;m=Object(Ke.a)(m,p)}o.applyOffset=new pi.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:m})}var _=l.length,g=gi.a.createTypedArray(h.length/3,2*(_+a.length));g.set(l);var v,y,b=_;for(c=0;c<_;c+=2){var w=l[c],x=l[c+1];g[b++]=w+d,g[b++]=x+d}for(c=0;c<a.length;c++)y=(v=a[c])+d,g[b++]=v,g[b++]=y;return{attributes:o,indices:g}}(f);else if((o=Ki(ci.computePositions(f),f.cornerType)).attributes.position.values=vi.a.scaleToGeodeticHeight(o.attributes.position.values,l,a),Object(s.default)(e._offsetAttribute)){var c=o.attributes.position.values.length,h=new Uint8Array(c/3),m=e._offsetAttribute===fe.a.NONE?0:1;Object(Ke.a)(h,m),o.attributes.applyOffset=new pi.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:h})}var p=o.attributes,_=r.default.fromVertices(p.position.values,void 0,3);return new mi.a({attributes:p,indices:o.indices,primitiveType:yi.a.LINES,boundingSphere:_,offsetAttribute:e._offsetAttribute})}};var ta=Ji,ia=new xe.a(0);function aa(e){Fe.call(this,e),this._zIndex=0,this._terrainOffsetProperty=void 0}Object(s.default)(Object.create)&&(aa.prototype=Object.create(Fe.prototype),aa.prototype.constructor=aa),Object.defineProperties(aa.prototype,{zIndex:{get:function(){return this._zIndex}},terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),aa.prototype._isOnTerrain=function(e,t){return this._fillEnabled&&!Object(s.default)(t.height)&&!Object(s.default)(t.extrudedHeight)&&f.a.isSupported(this._scene)},aa.prototype._getIsClosed=function(e){var t=e.height,i=e.extrudedHeight;return 0===t||Object(s.default)(i)&&i!==t},aa.prototype._computeCenter=b.default.throwInstantiationError,aa.prototype._onEntityPropertyChanged=function(e,t,i,a){if(Fe.prototype._onEntityPropertyChanged.call(this,e,t,i,a),-1!==this._observedPropertyNames.indexOf(t)){var r=this._entity[this._geometryPropertyName];if(Object(s.default)(r)){Object(s.default)(r.zIndex)&&(Object(s.default)(r.height)||Object(s.default)(r.extrudedHeight))&&Object(we.a)(we.a.geometryZIndex),this._zIndex=Object(o.default)(r.zIndex,ia),Object(s.default)(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0);var n=r.heightReference,l=r.extrudedHeightReference;if(Object(s.default)(n)||Object(s.default)(l)){var u=new Re.default(this._computeCenter.bind(this),!this._dynamic);this._terrainOffsetProperty=new Be(this._scene,u,n,l)}}}},aa.prototype.destroy=function(){Object(s.default)(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0),Fe.prototype.destroy.call(this)},aa.getGeometryHeight=function(e,t){if(Object(s.default)(e))return t!==O.default.CLAMP_TO_GROUND?e:0;t!==O.default.NONE&&Object(we.a)(we.a.geometryHeightReference)},aa.getGeometryExtrudedHeight=function(e,t){if(Object(s.default)(e))return t!==O.default.CLAMP_TO_GROUND?e:aa.CLAMP_TO_GROUND;t!==O.default.NONE&&Object(we.a)(we.a.geometryExtrudedHeightReference)},aa.CLAMP_TO_GROUND="clamp",aa.computeGeometryOffsetAttribute=function(e,t,i,a){Object(s.default)(e)&&Object(s.default)(t)||(t=O.default.NONE),Object(s.default)(i)&&Object(s.default)(a)||(a=O.default.NONE);var r=0;return t!==O.default.NONE&&r++,a===O.default.RELATIVE_TO_GROUND&&r++,2===r?fe.a.ALL:1===r?fe.a.TOP:void 0};var ra=aa,na=new y.default,oa=v.default.ZERO,sa=new v.default,la=new bi.default;function ua(e){this.id=e,this.vertexFormat=void 0,this.positions=void 0,this.width=void 0,this.cornerType=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.offsetAttribute=void 0}function da(e,t){ra.call(this,{entity:e,scene:t,geometryOptions:new ua(e),geometryPropertyName:"corridor",observedPropertyNames:["availability","corridor"]}),this._onEntityPropertyChanged(e,"corridor",e.corridor,void 0)}function fa(e,t,i){be.call(this,e,t,i)}Object(s.default)(Object.create)&&(da.prototype=Object.create(ra.prototype),da.prototype.constructor=da),da.prototype.createFillGeometryInstance=function(e){var t,i=this._entity,a=i.isAvailable(e),r={show:new me.a(a&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:ue.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof pe.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(t=this._materialProperty.color.getValue(e,na)),Object(s.default)(t)||(t=y.default.WHITE),r.color=oe.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(r.offset=he.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,oa,sa))),new de.a({id:i,geometry:new Xi(this._options),attributes:r})},da.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,i=t.isAvailable(e),a=P.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,na),r={show:new me.a(i&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(a),distanceDisplayCondition:ue.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(r.offset=he.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,oa,sa))),new de.a({id:t,geometry:new ta(this._options),attributes:r})},da.prototype._computeCenter=function(e,t){var i=P.default.getValueOrUndefined(this._entity.corridor.positions,e);if(Object(s.default)(i)&&0!==i.length)return v.default.clone(i[Math.floor(i.length/2)],t)},da.prototype._isHidden=function(e,t){return!Object(s.default)(t.positions)||!Object(s.default)(t.width)||Fe.prototype._isHidden.call(this,e,t)},da.prototype._isDynamic=function(e,t){return!t.positions.isConstant||!P.default.isConstant(t.height)||!P.default.isConstant(t.extrudedHeight)||!P.default.isConstant(t.granularity)||!P.default.isConstant(t.width)||!P.default.isConstant(t.outlineWidth)||!P.default.isConstant(t.cornerType)||!P.default.isConstant(t.zIndex)||this._onTerrain&&!P.default.isConstant(this._materialProperty)&&!(this._materialProperty instanceof pe.default)},da.prototype._setStaticOptions=function(e,t){var i=P.default.getValueOrUndefined(t.height,ce.default.MINIMUM_VALUE),r=P.default.getValueOrDefault(t.heightReference,ce.default.MINIMUM_VALUE,O.default.NONE),n=P.default.getValueOrUndefined(t.extrudedHeight,ce.default.MINIMUM_VALUE),o=P.default.getValueOrDefault(t.extrudedHeightReference,ce.default.MINIMUM_VALUE,O.default.NONE);Object(s.default)(n)&&!Object(s.default)(i)&&(i=0);var l=this._options;l.vertexFormat=this._materialProperty instanceof pe.default?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,l.positions=t.positions.getValue(ce.default.MINIMUM_VALUE,l.positions),l.width=t.width.getValue(ce.default.MINIMUM_VALUE),l.granularity=P.default.getValueOrUndefined(t.granularity,ce.default.MINIMUM_VALUE),l.cornerType=P.default.getValueOrUndefined(t.cornerType,ce.default.MINIMUM_VALUE),l.offsetAttribute=ra.computeGeometryOffsetAttribute(i,r,n,o),l.height=ra.getGeometryHeight(i,r),(n=ra.getGeometryExtrudedHeight(n,o))===ra.CLAMP_TO_GROUND&&(n=a.a.getMinimumMaximumHeights(Xi.computeRectangle(l,la)).minimumTerrainHeight),l.extrudedHeight=n},da.DynamicGeometryUpdater=fa,Object(s.default)(Object.create)&&(fa.prototype=Object.create(be.prototype),fa.prototype.constructor=fa),fa.prototype._isHidden=function(e,t,i){var a=this._options;return!Object(s.default)(a.positions)||!Object(s.default)(a.width)||be.prototype._isHidden.call(this,e,t,i)},fa.prototype._setOptions=function(e,t,i){var r=this._options,n=P.default.getValueOrUndefined(t.height,i),o=P.default.getValueOrDefault(t.heightReference,i,O.default.NONE),l=P.default.getValueOrUndefined(t.extrudedHeight,i),u=P.default.getValueOrDefault(t.extrudedHeightReference,i,O.default.NONE);Object(s.default)(l)&&!Object(s.default)(n)&&(n=0),r.positions=P.default.getValueOrUndefined(t.positions,i),r.width=P.default.getValueOrUndefined(t.width,i),r.granularity=P.default.getValueOrUndefined(t.granularity,i),r.cornerType=P.default.getValueOrUndefined(t.cornerType,i),r.offsetAttribute=ra.computeGeometryOffsetAttribute(n,o,l,u),r.height=ra.getGeometryHeight(n,o),(l=ra.getGeometryExtrudedHeight(l,u))===ra.CLAMP_TO_GROUND&&(l=a.a.getMinimumMaximumHeights(Xi.computeRectangle(r,la)).minimumTerrainHeight),r.extrudedHeight=l};var ca=da,ha={computePositions:function(e,t,i,a,r){var n,o=.5*e,s=-o,l=a+a,u=new Float64Array(3*(r?2*l:l)),d=0,f=0,c=r?3*l:0,h=r?3*(l+a):3*a;for(n=0;n<a;n++){var m=n/a*Le.default.TWO_PI,p=Math.cos(m),_=Math.sin(m),g=p*i,v=_*i,y=p*t,b=_*t;u[f+c]=g,u[f+c+1]=v,u[f+c+2]=s,u[f+h]=y,u[f+h+1]=b,u[f+h+2]=o,f+=3,r&&(u[d++]=g,u[d++]=v,u[d++]=s,u[d++]=y,u[d++]=b,u[d++]=o)}return u}},ma=ha,pa=new g.default,_a=new v.default,ga=new v.default,va=new v.default,ya=new v.default;function ba(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).length,i=e.topRadius,a=e.bottomRadius,r=Object(o.default)(e.vertexFormat,K.default.DEFAULT),n=Object(o.default)(e.slices,128);this._length=t,this._topRadius=i,this._bottomRadius=a,this._vertexFormat=K.default.clone(r),this._slices=n,this._offsetAttribute=e.offsetAttribute,this._workerName="createCylinderGeometry"}ba.packedLength=K.default.packedLength+5,ba.pack=function(e,t,i){return i=Object(o.default)(i,0),K.default.pack(e._vertexFormat,t,i),i+=K.default.packedLength,t[i++]=e._length,t[i++]=e._topRadius,t[i++]=e._bottomRadius,t[i++]=e._slices,t[i]=Object(o.default)(e._offsetAttribute,-1),t};var wa,xa=new K.default,Oa={vertexFormat:xa,length:void 0,topRadius:void 0,bottomRadius:void 0,slices:void 0,offsetAttribute:void 0};ba.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=K.default.unpack(e,t,xa);t+=K.default.packedLength;var r=e[t++],n=e[t++],l=e[t++],u=e[t++],d=e[t];return Object(s.default)(i)?(i._vertexFormat=K.default.clone(a,i._vertexFormat),i._length=r,i._topRadius=n,i._bottomRadius=l,i._slices=u,i._offsetAttribute=-1===d?void 0:d,i):(Oa.length=r,Oa.topRadius=n,Oa.bottomRadius=l,Oa.slices=u,Oa.offsetAttribute=-1===d?void 0:d,new ba(Oa))},ba.createGeometry=function(e){var t=e._length,i=e._topRadius,a=e._bottomRadius,n=e._vertexFormat,o=e._slices;if(!(t<=0||i<0||a<0||0===i&&0===a)){var l,u=o+o,d=o+u,f=u+u,c=ma.computePositions(t,i,a,o,!0),h=n.st?new Float32Array(2*f):void 0,m=n.normal?new Float32Array(3*f):void 0,p=n.tangent?new Float32Array(3*f):void 0,_=n.bitangent?new Float32Array(3*f):void 0,y=n.normal||n.tangent||n.bitangent;if(y){var b=n.tangent||n.bitangent,w=0,x=0,O=0,C=Math.atan2(a-i,t),T=_a;T.z=Math.sin(C);var E=Math.cos(C),P=va,A=ga;for(l=0;l<o;l++){var S=l/o*Le.default.TWO_PI,D=E*Math.cos(S),I=E*Math.sin(S);y&&(T.x=D,T.y=I,b&&(P=v.default.normalize(v.default.cross(v.default.UNIT_Z,T,P),P)),n.normal&&(m[w++]=T.x,m[w++]=T.y,m[w++]=T.z,m[w++]=T.x,m[w++]=T.y,m[w++]=T.z),n.tangent&&(p[x++]=P.x,p[x++]=P.y,p[x++]=P.z,p[x++]=P.x,p[x++]=P.y,p[x++]=P.z),n.bitangent&&(A=v.default.normalize(v.default.cross(T,P,A),A),_[O++]=A.x,_[O++]=A.y,_[O++]=A.z,_[O++]=A.x,_[O++]=A.y,_[O++]=A.z))}for(l=0;l<o;l++)n.normal&&(m[w++]=0,m[w++]=0,m[w++]=-1),n.tangent&&(p[x++]=1,p[x++]=0,p[x++]=0),n.bitangent&&(_[O++]=0,_[O++]=-1,_[O++]=0);for(l=0;l<o;l++)n.normal&&(m[w++]=0,m[w++]=0,m[w++]=1),n.tangent&&(p[x++]=1,p[x++]=0,p[x++]=0),n.bitangent&&(_[O++]=0,_[O++]=1,_[O++]=0)}var M=12*o-12,F=gi.a.createTypedArray(f,M),R=0,N=0;for(l=0;l<o-1;l++)F[R++]=N,F[R++]=N+2,F[R++]=N+3,F[R++]=N,F[R++]=N+3,F[R++]=N+1,N+=2;for(F[R++]=u-2,F[R++]=0,F[R++]=1,F[R++]=u-2,F[R++]=1,F[R++]=u-1,l=1;l<o-1;l++)F[R++]=u+l+1,F[R++]=u+l,F[R++]=u;for(l=1;l<o-1;l++)F[R++]=d,F[R++]=d+l,F[R++]=d+l+1;var L=0;if(n.st){var j=Math.max(i,a);for(l=0;l<f;l++){var V=v.default.fromArray(c,3*l,ya);h[L++]=(V.x+j)/(2*j),h[L++]=(V.y+j)/(2*j)}}var U=new _i.a;n.position&&(U.position=new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:c})),n.normal&&(U.normal=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:m})),n.tangent&&(U.tangent=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:p})),n.bitangent&&(U.bitangent=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:_})),n.st&&(U.st=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:h})),pa.x=.5*t,pa.y=Math.max(a,i);var z=new r.default(v.default.ZERO,g.default.magnitude(pa));if(Object(s.default)(e._offsetAttribute)){t=c.length;var B=new Uint8Array(t/3),H=e._offsetAttribute===fe.a.NONE?0:1;Object(Ke.a)(B,H),U.applyOffset=new pi.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:B})}return new mi.a({attributes:U,indices:F,primitiveType:yi.a.TRIANGLES,boundingSphere:z,offsetAttribute:e._offsetAttribute})}},ba.getUnitCylinder=function(){return Object(s.default)(wa)||(wa=ba.createGeometry(new ba({topRadius:1,bottomRadius:1,length:1,vertexFormat:K.default.POSITION_ONLY}))),wa};var Ca=ba,Ta=new g.default;function Ea(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).length,i=e.topRadius,a=e.bottomRadius,r=Object(o.default)(e.slices,128),n=Math.max(Object(o.default)(e.numberOfVerticalLines,16),0);this._length=t,this._topRadius=i,this._bottomRadius=a,this._slices=r,this._numberOfVerticalLines=n,this._offsetAttribute=e.offsetAttribute,this._workerName="createCylinderOutlineGeometry"}Ea.packedLength=6,Ea.pack=function(e,t,i){return i=Object(o.default)(i,0),t[i++]=e._length,t[i++]=e._topRadius,t[i++]=e._bottomRadius,t[i++]=e._slices,t[i++]=e._numberOfVerticalLines,t[i]=Object(o.default)(e._offsetAttribute,-1),t};var Pa={length:void 0,topRadius:void 0,bottomRadius:void 0,slices:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};Ea.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=e[t++],r=e[t++],n=e[t++],l=e[t++],u=e[t++],d=e[t];return Object(s.default)(i)?(i._length=a,i._topRadius=r,i._bottomRadius=n,i._slices=l,i._numberOfVerticalLines=u,i._offsetAttribute=-1===d?void 0:d,i):(Pa.length=a,Pa.topRadius=r,Pa.bottomRadius=n,Pa.slices=l,Pa.numberOfVerticalLines=u,Pa.offsetAttribute=-1===d?void 0:d,new Ea(Pa))},Ea.createGeometry=function(e){var t=e._length,i=e._topRadius,a=e._bottomRadius,n=e._slices,o=e._numberOfVerticalLines;if(!(t<=0||i<0||a<0||0===i&&0===a)){var l,u=2*n,d=ma.computePositions(t,i,a,n,!1),f=2*n;if(o>0){var c=Math.min(o,n);l=Math.round(n/c),f+=c}var h,m=gi.a.createTypedArray(u,2*f),p=0;for(h=0;h<n-1;h++)m[p++]=h,m[p++]=h+1,m[p++]=h+n,m[p++]=h+1+n;if(m[p++]=n-1,m[p++]=0,m[p++]=n+n-1,m[p++]=n,o>0)for(h=0;h<n;h+=l)m[p++]=h,m[p++]=h+n;var _=new _i.a;_.position=new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:d}),Ta.x=.5*t,Ta.y=Math.max(a,i);var y=new r.default(v.default.ZERO,g.default.magnitude(Ta));if(Object(s.default)(e._offsetAttribute)){t=d.length;var b=new Uint8Array(t/3),w=e._offsetAttribute===fe.a.NONE?0:1;Object(Ke.a)(b,w),_.applyOffset=new pi.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})}return new mi.a({attributes:_,indices:m,primitiveType:yi.a.LINES,boundingSphere:y,offsetAttribute:e._offsetAttribute})}};var Aa=Ea,Sa=v.default.ZERO,Da=new v.default,Ia=new v.default,Ma=new y.default;function Fa(e){this.id=e,this.vertexFormat=void 0,this.length=void 0,this.topRadius=void 0,this.bottomRadius=void 0,this.slices=void 0,this.numberOfVerticalLines=void 0,this.offsetAttribute=void 0}function Ra(e,t){Fe.call(this,{entity:e,scene:t,geometryOptions:new Fa(e),geometryPropertyName:"cylinder",observedPropertyNames:["availability","position","orientation","cylinder"]}),this._onEntityPropertyChanged(e,"cylinder",e.cylinder,void 0)}function Na(e,t,i){be.call(this,e,t,i)}Object(s.default)(Object.create)&&(Ra.prototype=Object.create(Fe.prototype),Ra.prototype.constructor=Ra),Object.defineProperties(Ra.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),Ra.prototype.createFillGeometryInstance=function(e){var t,i=this._entity,a=i.isAvailable(e),r=new me.a(a&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),n=this._distanceDisplayConditionProperty.getValue(e),o={show:r,distanceDisplayCondition:ue.fromDistanceDisplayCondition(n),color:void 0,offset:void 0};this._materialProperty instanceof pe.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(t=this._materialProperty.color.getValue(e,Ma)),Object(s.default)(t)||(t=y.default.WHITE),o.color=oe.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(o.offset=he.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,Sa,Da))),new de.a({id:i,geometry:new Ca(this._options),modelMatrix:i.computeModelMatrixForHeightReference(e,i.cylinder.heightReference,.5*this._options.length,this._scene.mapProjection.ellipsoid),attributes:o})},Ra.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,i=t.isAvailable(e),a=P.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,Ma),r=this._distanceDisplayConditionProperty.getValue(e),n={show:new me.a(i&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(a),distanceDisplayCondition:ue.fromDistanceDisplayCondition(r),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(n.offset=he.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,Sa,Da))),new de.a({id:t,geometry:new Aa(this._options),modelMatrix:t.computeModelMatrixForHeightReference(e,t.cylinder.heightReference,.5*this._options.length,this._scene.mapProjection.ellipsoid),attributes:n})},Ra.prototype._computeCenter=function(e,t){return P.default.getValueOrUndefined(this._entity.position,e,t)},Ra.prototype._isHidden=function(e,t){return!Object(s.default)(e.position)||!Object(s.default)(t.length)||!Object(s.default)(t.topRadius)||!Object(s.default)(t.bottomRadius)||Fe.prototype._isHidden.call(this,e,t)},Ra.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&P.default.isConstant(e.orientation)&&t.length.isConstant&&t.topRadius.isConstant&&t.bottomRadius.isConstant&&P.default.isConstant(t.slices)&&P.default.isConstant(t.outlineWidth)&&P.default.isConstant(t.numberOfVerticalLines))},Ra.prototype._setStaticOptions=function(e,t){var i=P.default.getValueOrDefault(t.heightReference,ce.default.MINIMUM_VALUE,O.default.NONE),a=this._options;a.vertexFormat=this._materialProperty instanceof pe.default?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,a.length=t.length.getValue(ce.default.MINIMUM_VALUE),a.topRadius=t.topRadius.getValue(ce.default.MINIMUM_VALUE),a.bottomRadius=t.bottomRadius.getValue(ce.default.MINIMUM_VALUE),a.slices=P.default.getValueOrUndefined(t.slices,ce.default.MINIMUM_VALUE),a.numberOfVerticalLines=P.default.getValueOrUndefined(t.numberOfVerticalLines,ce.default.MINIMUM_VALUE),a.offsetAttribute=i!==O.default.NONE?fe.a.ALL:void 0},Ra.prototype._onEntityPropertyChanged=He,Ra.DynamicGeometryUpdater=Na,Object(s.default)(Object.create)&&(Na.prototype=Object.create(be.prototype),Na.prototype.constructor=Na),Na.prototype._isHidden=function(e,t,i){var a=this._options,r=P.default.getValueOrUndefined(e.position,i,Ia);return!Object(s.default)(r)||!Object(s.default)(a.length)||!Object(s.default)(a.topRadius)||!Object(s.default)(a.bottomRadius)||be.prototype._isHidden.call(this,e,t,i)},Na.prototype._setOptions=function(e,t,i){var a=P.default.getValueOrDefault(t.heightReference,i,O.default.NONE),r=this._options;r.length=P.default.getValueOrUndefined(t.length,i),r.topRadius=P.default.getValueOrUndefined(t.topRadius,i),r.bottomRadius=P.default.getValueOrUndefined(t.bottomRadius,i),r.slices=P.default.getValueOrUndefined(t.slices,i),r.numberOfVerticalLines=P.default.getValueOrUndefined(t.numberOfVerticalLines,i),r.offsetAttribute=a!==O.default.NONE?fe.a.ALL:void 0};var La=Ra;function ja(e,t){this._primitives=e,this._orderedGroundPrimitives=t,this._dynamicUpdaters=new p.default}ja.prototype.add=function(e,t){this._dynamicUpdaters.set(t.id,t.createDynamicUpdater(this._primitives,this._orderedGroundPrimitives))},ja.prototype.remove=function(e){var t=e.id,i=this._dynamicUpdaters.get(t);Object(s.default)(i)&&(this._dynamicUpdaters.remove(t),i.destroy())},ja.prototype.update=function(e){for(var t=this._dynamicUpdaters.values,i=0,a=t.length;i<a;i++)t[i].update(e);return!0},ja.prototype.removeAllPrimitives=function(){for(var e=this._dynamicUpdaters.values,t=0,i=e.length;t<i;t++)e[t].destroy();this._dynamicUpdaters.removeAll()},ja.prototype.getBoundingSphere=function(e,t){return e=this._dynamicUpdaters.get(e.id),Object(s.default)(e)&&Object(s.default)(e.getBoundingSphere)?e.getBoundingSphere(t):E.default.FAILED};var Va=ja,Ua={},za=new v.default,Ba=new v.default,Ha=new nt.default,ka=new et.default;function Wa(e,t,i,a,r,n,o,s,l,u){var d=e+t;v.default.multiplyByScalar(a,Math.cos(d),za),v.default.multiplyByScalar(i,Math.sin(d),Ba),v.default.add(za,Ba,za);var f=Math.cos(e);f*=f;var c=Math.sin(e);c*=c;var h=n/Math.sqrt(o*f+r*c)/s;return nt.default.fromAxisAngle(za,h,Ha),et.default.fromQuaternion(Ha,ka),et.default.multiplyByVector(ka,l,u),v.default.normalize(u,u),v.default.multiplyByScalar(u,s,u),u}var Ga=new v.default,Ya=new v.default,Xa=new v.default,Qa=new v.default;Ua.raisePositionsToHeight=function(e,t,i){for(var a=t.ellipsoid,r=t.height,n=t.extrudedHeight,o=i?e.length/3*2:e.length/3,s=new Float64Array(3*o),l=e.length,u=i?l:0,d=0;d<l;d+=3){var f=d+1,c=d+2,h=v.default.fromArray(e,d,Ga);a.scaleToGeodeticSurface(h,h);var m=v.default.clone(h,Ya),p=a.geodeticSurfaceNormal(h,Qa),_=v.default.multiplyByScalar(p,r,Xa);v.default.add(h,_,h),i&&(v.default.multiplyByScalar(p,n,_),v.default.add(m,_,m),s[d+u]=m.x,s[f+u]=m.y,s[c+u]=m.z),s[d]=h.x,s[f]=h.y,s[c]=h.z}return s};var qa=new v.default,Za=new v.default,Ka=new v.default;Ua.computeEllipsePositions=function(e,t,i){var a=e.semiMinorAxis,r=e.semiMajorAxis,n=e.rotation,o=e.center,s=8*e.granularity,l=a*a,u=r*r,d=r*a,f=v.default.magnitude(o),c=v.default.normalize(o,qa),h=v.default.cross(v.default.UNIT_Z,o,Za);h=v.default.normalize(h,h);var m=v.default.cross(c,h,Ka),p=1+Math.ceil(Le.default.PI_OVER_TWO/s),_=Le.default.PI_OVER_TWO/(p-1),g=Le.default.PI_OVER_TWO-p*_;g<0&&(p-=Math.ceil(Math.abs(g)/_));var y,b,w,x,O,C=t?new Array(3*(p*(p+2)*2)):void 0,T=0,E=Ga,P=Ya,A=4*p*3,S=A-1,D=0,I=i?new Array(A):void 0;for(E=Wa(g=Le.default.PI_OVER_TWO,n,m,h,l,d,u,f,c,E),t&&(C[T++]=E.x,C[T++]=E.y,C[T++]=E.z),i&&(I[S--]=E.z,I[S--]=E.y,I[S--]=E.x),g=Le.default.PI_OVER_TWO-_,y=1;y<p+1;++y){if(E=Wa(g,n,m,h,l,d,u,f,c,E),P=Wa(Math.PI-g,n,m,h,l,d,u,f,c,P),t){for(C[T++]=E.x,C[T++]=E.y,C[T++]=E.z,w=2*y+2,b=1;b<w-1;++b)x=b/(w-1),O=v.default.lerp(E,P,x,Xa),C[T++]=O.x,C[T++]=O.y,C[T++]=O.z;C[T++]=P.x,C[T++]=P.y,C[T++]=P.z}i&&(I[S--]=E.z,I[S--]=E.y,I[S--]=E.x,I[D++]=P.x,I[D++]=P.y,I[D++]=P.z),g=Le.default.PI_OVER_TWO-(y+1)*_}for(y=p;y>1;--y){if(E=Wa(-(g=Le.default.PI_OVER_TWO-(y-1)*_),n,m,h,l,d,u,f,c,E),P=Wa(g+Math.PI,n,m,h,l,d,u,f,c,P),t){for(C[T++]=E.x,C[T++]=E.y,C[T++]=E.z,w=2*(y-1)+2,b=1;b<w-1;++b)x=b/(w-1),O=v.default.lerp(E,P,x,Xa),C[T++]=O.x,C[T++]=O.y,C[T++]=O.z;C[T++]=P.x,C[T++]=P.y,C[T++]=P.z}i&&(I[S--]=E.z,I[S--]=E.y,I[S--]=E.x,I[D++]=P.x,I[D++]=P.y,I[D++]=P.z)}E=Wa(-(g=Le.default.PI_OVER_TWO),n,m,h,l,d,u,f,c,E);var M={};return t&&(C[T++]=E.x,C[T++]=E.y,C[T++]=E.z,M.positions=C,M.numPts=p),i&&(I[S--]=E.z,I[S--]=E.y,I[S--]=E.x,M.outerPositions=I),M};var Ja=Ua,$a=i(102),er=i(119),tr=new v.default,ir=new v.default,ar=new v.default,rr=new v.default,nr=new g.default,or=new et.default,sr=new et.default,lr=new nt.default,ur=new v.default,dr=new v.default,fr=new v.default,cr=new Ne.default,hr=new v.default,mr=new g.default,pr=new g.default;function _r(e,t,i){var a=t.vertexFormat,r=t.center,n=t.semiMajorAxis,o=t.semiMinorAxis,l=t.ellipsoid,u=t.stRotation,d=i?e.length/3*2:e.length/3,f=t.shadowVolume,c=a.st?new Float32Array(2*d):void 0,h=a.normal?new Float32Array(3*d):void 0,m=a.tangent?new Float32Array(3*d):void 0,p=a.bitangent?new Float32Array(3*d):void 0,_=f?new Float32Array(3*d):void 0,y=0,b=ur,w=dr,x=fr,O=new $a.a(l),C=O.project(l.cartesianToCartographic(r,cr),hr),T=l.scaleToGeodeticSurface(r,tr);l.geodeticSurfaceNormal(T,T);var E=or,P=sr;if(0!==u){var A=nt.default.fromAxisAngle(T,u,lr);E=et.default.fromQuaternion(A,E),A=nt.default.fromAxisAngle(T,-u,lr),P=et.default.fromQuaternion(A,P)}else E=et.default.clone(et.default.IDENTITY,E),P=et.default.clone(et.default.IDENTITY,P);for(var S=g.default.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,mr),D=g.default.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,pr),I=e.length,M=i?I:0,F=M/3*2,R=0;R<I;R+=3){var N=R+1,L=R+2,j=v.default.fromArray(e,R,tr);if(a.st){var V=et.default.multiplyByVector(E,j,ir),U=O.project(l.cartesianToCartographic(V,cr),ar);v.default.subtract(U,C,U),nr.x=(U.x+n)/(2*n),nr.y=(U.y+o)/(2*o),S.x=Math.min(nr.x,S.x),S.y=Math.min(nr.y,S.y),D.x=Math.max(nr.x,D.x),D.y=Math.max(nr.y,D.y),i&&(c[y+F]=nr.x,c[y+1+F]=nr.y),c[y++]=nr.x,c[y++]=nr.y}(a.normal||a.tangent||a.bitangent||f)&&(b=l.geodeticSurfaceNormal(j,b),f&&(_[R+M]=-b.x,_[N+M]=-b.y,_[L+M]=-b.z),(a.normal||a.tangent||a.bitangent)&&((a.tangent||a.bitangent)&&(w=v.default.normalize(v.default.cross(v.default.UNIT_Z,b,w),w),et.default.multiplyByVector(P,w,w)),a.normal&&(h[R]=b.x,h[N]=b.y,h[L]=b.z,i&&(h[R+M]=-b.x,h[N+M]=-b.y,h[L+M]=-b.z)),a.tangent&&(m[R]=w.x,m[N]=w.y,m[L]=w.z,i&&(m[R+M]=-w.x,m[N+M]=-w.y,m[L+M]=-w.z)),a.bitangent&&(x=v.default.normalize(v.default.cross(b,w,x),x),p[R]=x.x,p[N]=x.y,p[L]=x.z,i&&(p[R+M]=x.x,p[N+M]=x.y,p[L+M]=x.z))))}if(a.st){I=c.length;for(var z=0;z<I;z+=2)c[z]=(c[z]-S.x)/(D.x-S.x),c[z+1]=(c[z+1]-S.y)/(D.y-S.y)}var B=new _i.a;if(a.position){var H=Ja.raisePositionsToHeight(e,t,i);B.position=new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:H})}if(a.st&&(B.st=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:c})),a.normal&&(B.normal=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:h})),a.tangent&&(B.tangent=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:m})),a.bitangent&&(B.bitangent=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:p})),f&&(B.extrudeDirection=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:_})),i&&Object(s.default)(t.offsetAttribute)){var k=new Uint8Array(d);if(t.offsetAttribute===fe.a.TOP)k=Object(Ke.a)(k,1,0,d/2);else{var W=t.offsetAttribute===fe.a.NONE?0:1;k=Object(Ke.a)(k,W)}B.applyOffset=new pi.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:k})}return B}function gr(e){var t,i,a,r,n,o=new Array(e*(e+1)*12-6),s=0;for(t=0,a=1,r=0;r<3;r++)o[s++]=a++,o[s++]=t,o[s++]=a;for(r=2;r<e+1;++r){for(a=r*(r+1)-1,t=(r-1)*r-1,o[s++]=a++,o[s++]=t,o[s++]=a,i=2*r,n=0;n<i-1;++n)o[s++]=a,o[s++]=t++,o[s++]=t,o[s++]=a++,o[s++]=t,o[s++]=a;o[s++]=a++,o[s++]=t,o[s++]=a}for(i=2*e,++a,++t,r=0;r<i-1;++r)o[s++]=a,o[s++]=t++,o[s++]=t,o[s++]=a++,o[s++]=t,o[s++]=a;for(o[s++]=a,o[s++]=t++,o[s++]=t,o[s++]=a++,o[s++]=t++,o[s++]=t,++t,r=e-1;r>1;--r){for(o[s++]=t++,o[s++]=t,o[s++]=a,i=2*r,n=0;n<i-1;++n)o[s++]=a,o[s++]=t++,o[s++]=t,o[s++]=a++,o[s++]=t,o[s++]=a;o[s++]=t++,o[s++]=t++,o[s++]=a++}for(r=0;r<3;r++)o[s++]=t++,o[s++]=t,o[s++]=a;return o}var vr=new v.default;var yr=new r.default,br=new r.default;function wr(e){var t=e.center,i=e.ellipsoid,a=e.semiMajorAxis,n=v.default.multiplyByScalar(i.geodeticSurfaceNormal(t,tr),e.height,tr);yr.center=v.default.add(t,n,yr.center),yr.radius=a,n=v.default.multiplyByScalar(i.geodeticSurfaceNormal(t,n),e.extrudedHeight,n),br.center=v.default.add(t,n,br.center),br.radius=a;var o=Ja.computeEllipsePositions(e,!0,!0),l=o.positions,u=o.numPts,d=o.outerPositions,f=r.default.union(yr,br),c=_r(l,e,!0),h=gr(u),m=h.length;h.length=2*m;for(var p=l.length/3,_=0;_<m;_+=3)h[_+m]=h[_+2]+p,h[_+1+m]=h[_+1]+p,h[_+2+m]=h[_]+p;var y=gi.a.createTypedArray(2*p/3,h),b=new mi.a({attributes:c,indices:y,primitiveType:yi.a.TRIANGLES}),w=function(e,t){var i=t.vertexFormat,a=t.center,r=t.semiMajorAxis,n=t.semiMinorAxis,o=t.ellipsoid,l=t.height,u=t.extrudedHeight,d=t.stRotation,f=e.length/3*2,c=new Float64Array(3*f),h=i.st?new Float32Array(2*f):void 0,m=i.normal?new Float32Array(3*f):void 0,p=i.tangent?new Float32Array(3*f):void 0,_=i.bitangent?new Float32Array(3*f):void 0,y=t.shadowVolume,b=y?new Float32Array(3*f):void 0,w=0,x=ur,O=dr,C=fr,T=new $a.a(o),E=T.project(o.cartesianToCartographic(a,cr),hr),P=o.scaleToGeodeticSurface(a,tr);o.geodeticSurfaceNormal(P,P);for(var A=nt.default.fromAxisAngle(P,d,lr),S=et.default.fromQuaternion(A,or),D=g.default.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,mr),I=g.default.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,pr),M=e.length,F=M/3*2,R=0;R<M;R+=3){var N,L=R+1,j=R+2,V=v.default.fromArray(e,R,tr);if(i.st){var U=et.default.multiplyByVector(S,V,ir),z=T.project(o.cartesianToCartographic(U,cr),ar);v.default.subtract(z,E,z),nr.x=(z.x+r)/(2*r),nr.y=(z.y+n)/(2*n),D.x=Math.min(nr.x,D.x),D.y=Math.min(nr.y,D.y),I.x=Math.max(nr.x,I.x),I.y=Math.max(nr.y,I.y),h[w+F]=nr.x,h[w+1+F]=nr.y,h[w++]=nr.x,h[w++]=nr.y}V=o.scaleToGeodeticSurface(V,V),N=v.default.clone(V,ir),x=o.geodeticSurfaceNormal(V,x),y&&(b[R+M]=-x.x,b[L+M]=-x.y,b[j+M]=-x.z);var B=v.default.multiplyByScalar(x,l,rr);if(V=v.default.add(V,B,V),B=v.default.multiplyByScalar(x,u,B),N=v.default.add(N,B,N),i.position&&(c[R+M]=N.x,c[L+M]=N.y,c[j+M]=N.z,c[R]=V.x,c[L]=V.y,c[j]=V.z),i.normal||i.tangent||i.bitangent){C=v.default.clone(x,C);var H=v.default.fromArray(e,(R+3)%M,rr);v.default.subtract(H,V,H);var k=v.default.subtract(N,V,ar);x=v.default.normalize(v.default.cross(k,H,x),x),i.normal&&(m[R]=x.x,m[L]=x.y,m[j]=x.z,m[R+M]=x.x,m[L+M]=x.y,m[j+M]=x.z),i.tangent&&(O=v.default.normalize(v.default.cross(C,x,O),O),p[R]=O.x,p[L]=O.y,p[j]=O.z,p[R+M]=O.x,p[R+1+M]=O.y,p[R+2+M]=O.z),i.bitangent&&(_[R]=C.x,_[L]=C.y,_[j]=C.z,_[R+M]=C.x,_[L+M]=C.y,_[j+M]=C.z)}}if(i.st){M=h.length;for(var W=0;W<M;W+=2)h[W]=(h[W]-D.x)/(I.x-D.x),h[W+1]=(h[W+1]-D.y)/(I.y-D.y)}var G=new _i.a;if(i.position&&(G.position=new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:c})),i.st&&(G.st=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:h})),i.normal&&(G.normal=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:m})),i.tangent&&(G.tangent=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:p})),i.bitangent&&(G.bitangent=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:_})),y&&(G.extrudeDirection=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:b})),Object(s.default)(t.offsetAttribute)){var Y=new Uint8Array(f);if(t.offsetAttribute===fe.a.TOP)Y=Object(Ke.a)(Y,1,0,f/2);else{var X=t.offsetAttribute===fe.a.NONE?0:1;Y=Object(Ke.a)(Y,X)}G.applyOffset=new pi.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:Y})}return G}(d,e);h=function(e){for(var t=e.length/3,i=gi.a.createTypedArray(t,6*t),a=0,r=0;r<t;r++){var n=r,o=r+t,s=(n+1)%t,l=s+t;i[a++]=n,i[a++]=o,i[a++]=s,i[a++]=s,i[a++]=o,i[a++]=l}return i}(d);var x=gi.a.createTypedArray(2*d.length/3,h),O=new mi.a({attributes:w,indices:x,primitiveType:yi.a.TRIANGLES}),C=er.a.combineInstances([new de.a({geometry:b}),new de.a({geometry:O})]);return{boundingSphere:f,attributes:C[0].attributes,indices:C[0].indices}}function xr(e,t,i,a,r,n,o){for(var s=Ja.computeEllipsePositions({center:e,semiMajorAxis:t,semiMinorAxis:i,rotation:a,granularity:r},!1,!0).outerPositions,l=s.length/3,u=new Array(l),d=0;d<l;++d)u[d]=v.default.fromArray(s,3*d);var f=bi.default.fromCartesianArray(u,n,o);return f.width>Le.default.PI&&(f.north=f.north>0?Le.default.PI_OVER_TWO-Le.default.EPSILON7:f.north,f.south=f.south<0?Le.default.EPSILON7-Le.default.PI_OVER_TWO:f.south,f.east=Le.default.PI,f.west=-Le.default.PI),f}function Or(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).center,i=Object(o.default)(e.ellipsoid,hi.default.WGS84),a=e.semiMajorAxis,r=e.semiMinorAxis,n=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),s=Object(o.default)(e.vertexFormat,K.default.DEFAULT),l=Object(o.default)(e.height,0),u=Object(o.default)(e.extrudedHeight,l);this._center=v.default.clone(t),this._semiMajorAxis=a,this._semiMinorAxis=r,this._ellipsoid=hi.default.clone(i),this._rotation=Object(o.default)(e.rotation,0),this._stRotation=Object(o.default)(e.stRotation,0),this._height=Math.max(u,l),this._granularity=n,this._vertexFormat=K.default.clone(s),this._extrudedHeight=Math.min(u,l),this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createEllipseGeometry",this._offsetAttribute=e.offsetAttribute,this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0}Or.packedLength=v.default.packedLength+hi.default.packedLength+K.default.packedLength+9,Or.pack=function(e,t,i){return i=Object(o.default)(i,0),v.default.pack(e._center,t,i),i+=v.default.packedLength,hi.default.pack(e._ellipsoid,t,i),i+=hi.default.packedLength,K.default.pack(e._vertexFormat,t,i),i+=K.default.packedLength,t[i++]=e._semiMajorAxis,t[i++]=e._semiMinorAxis,t[i++]=e._rotation,t[i++]=e._stRotation,t[i++]=e._height,t[i++]=e._granularity,t[i++]=e._extrudedHeight,t[i++]=e._shadowVolume?1:0,t[i]=Object(o.default)(e._offsetAttribute,-1),t};var Cr=new v.default,Tr=new hi.default,Er=new K.default,Pr={center:Cr,ellipsoid:Tr,vertexFormat:Er,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,stRotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};Or.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=v.default.unpack(e,t,Cr);t+=v.default.packedLength;var r=hi.default.unpack(e,t,Tr);t+=hi.default.packedLength;var n=K.default.unpack(e,t,Er);t+=K.default.packedLength;var l=e[t++],u=e[t++],d=e[t++],f=e[t++],c=e[t++],h=e[t++],m=e[t++],p=1===e[t++],_=e[t];return Object(s.default)(i)?(i._center=v.default.clone(a,i._center),i._ellipsoid=hi.default.clone(r,i._ellipsoid),i._vertexFormat=K.default.clone(n,i._vertexFormat),i._semiMajorAxis=l,i._semiMinorAxis=u,i._rotation=d,i._stRotation=f,i._height=c,i._granularity=h,i._extrudedHeight=m,i._shadowVolume=p,i._offsetAttribute=-1===_?void 0:_,i):(Pr.height=c,Pr.extrudedHeight=m,Pr.granularity=h,Pr.stRotation=f,Pr.rotation=d,Pr.semiMajorAxis=l,Pr.semiMinorAxis=u,Pr.shadowVolume=p,Pr.offsetAttribute=-1===_?void 0:_,new Or(Pr))},Or.computeRectangle=function(e,t){var i=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).center,a=Object(o.default)(e.ellipsoid,hi.default.WGS84),r=e.semiMajorAxis,n=e.semiMinorAxis,s=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE);return xr(i,r,n,Object(o.default)(e.rotation,0),s,a,t)},Or.createGeometry=function(e){if(!(e._semiMajorAxis<=0||e._semiMinorAxis<=0)){var t=e._height,i=e._extrudedHeight,a=!Le.default.equalsEpsilon(t,i,0,Le.default.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);var n,o={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:t,granularity:e._granularity,vertexFormat:e._vertexFormat,stRotation:e._stRotation};if(a)o.extrudedHeight=i,o.shadowVolume=e._shadowVolume,o.offsetAttribute=e._offsetAttribute,n=wr(o);else if(n=function(e){var t=e.center;vr=v.default.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,vr),e.height,vr),vr=v.default.add(t,vr,vr);var i=new r.default(vr,e.semiMajorAxis),a=Ja.computeEllipsePositions(e,!0,!1),n=a.positions,o=a.numPts,s=_r(n,e,!1),l=gr(o);return{boundingSphere:i,attributes:s,indices:l=gi.a.createTypedArray(n.length/3,l)}}(o),Object(s.default)(e._offsetAttribute)){var l=n.attributes.position.values.length,u=new Uint8Array(l/3),d=e._offsetAttribute===fe.a.NONE?0:1;Object(Ke.a)(u,d),n.attributes.applyOffset=new pi.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:u})}return new mi.a({attributes:n.attributes,indices:n.indices,primitiveType:yi.a.TRIANGLES,boundingSphere:n.boundingSphere,offsetAttribute:e._offsetAttribute})}},Or.createShadowVolume=function(e,t,i){var a=e._granularity,r=e._ellipsoid,n=t(a,r),o=i(a,r);return new Or({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:r,rotation:e._rotation,stRotation:e._stRotation,granularity:a,extrudedHeight:n,height:o,vertexFormat:K.default.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(Or.prototype,{rectangle:{get:function(){return Object(s.default)(this._rectangle)||(this._rectangle=xr(this._center,this._semiMajorAxis,this._semiMinorAxis,this._rotation,this._granularity,this._ellipsoid)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return Object(s.default)(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0===t)return[0,0,0,1,1,0];for(var i=Ja.computeEllipsePositions({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,rotation:e._rotation,granularity:e._granularity},!1,!0).outerPositions,a=i.length/3,r=new Array(a),n=0;n<a;++n)r[n]=v.default.fromArray(i,3*n);var o=e._ellipsoid,s=e.rectangle;return mi.a._textureCoordinateRotationPoints(r,t,o,s)}(this)),this._textureCoordinateRotationPoints}}});var Ar=Or,Sr=new v.default,Dr=new v.default;var Ir=new r.default,Mr=new r.default;function Fr(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).center,i=Object(o.default)(e.ellipsoid,hi.default.WGS84),a=e.semiMajorAxis,r=e.semiMinorAxis,n=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),s=Object(o.default)(e.height,0),l=Object(o.default)(e.extrudedHeight,s);this._center=v.default.clone(t),this._semiMajorAxis=a,this._semiMinorAxis=r,this._ellipsoid=hi.default.clone(i),this._rotation=Object(o.default)(e.rotation,0),this._height=Math.max(l,s),this._granularity=n,this._extrudedHeight=Math.min(l,s),this._numberOfVerticalLines=Math.max(Object(o.default)(e.numberOfVerticalLines,16),0),this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipseOutlineGeometry"}Fr.packedLength=v.default.packedLength+hi.default.packedLength+8,Fr.pack=function(e,t,i){return i=Object(o.default)(i,0),v.default.pack(e._center,t,i),i+=v.default.packedLength,hi.default.pack(e._ellipsoid,t,i),i+=hi.default.packedLength,t[i++]=e._semiMajorAxis,t[i++]=e._semiMinorAxis,t[i++]=e._rotation,t[i++]=e._height,t[i++]=e._granularity,t[i++]=e._extrudedHeight,t[i++]=e._numberOfVerticalLines,t[i]=Object(o.default)(e._offsetAttribute,-1),t};var Rr=new v.default,Nr=new hi.default,Lr={center:Rr,ellipsoid:Nr,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};Fr.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=v.default.unpack(e,t,Rr);t+=v.default.packedLength;var r=hi.default.unpack(e,t,Nr);t+=hi.default.packedLength;var n=e[t++],l=e[t++],u=e[t++],d=e[t++],f=e[t++],c=e[t++],h=e[t++],m=e[t];return Object(s.default)(i)?(i._center=v.default.clone(a,i._center),i._ellipsoid=hi.default.clone(r,i._ellipsoid),i._semiMajorAxis=n,i._semiMinorAxis=l,i._rotation=u,i._height=d,i._granularity=f,i._extrudedHeight=c,i._numberOfVerticalLines=h,i._offsetAttribute=-1===m?void 0:m,i):(Lr.height=d,Lr.extrudedHeight=c,Lr.granularity=f,Lr.rotation=u,Lr.semiMajorAxis=n,Lr.semiMinorAxis=l,Lr.numberOfVerticalLines=h,Lr.offsetAttribute=-1===m?void 0:m,new Fr(Lr))},Fr.createGeometry=function(e){if(!(e._semiMajorAxis<=0||e._semiMinorAxis<=0)){var t=e._height,i=e._extrudedHeight,a=!Le.default.equalsEpsilon(t,i,0,Le.default.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);var n,l={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:t,granularity:e._granularity,numberOfVerticalLines:e._numberOfVerticalLines};if(a)l.extrudedHeight=i,l.offsetAttribute=e._offsetAttribute,n=function(e){var t=e.center,i=e.ellipsoid,a=e.semiMajorAxis,n=v.default.multiplyByScalar(i.geodeticSurfaceNormal(t,Sr),e.height,Sr);Ir.center=v.default.add(t,n,Ir.center),Ir.radius=a,n=v.default.multiplyByScalar(i.geodeticSurfaceNormal(t,n),e.extrudedHeight,n),Mr.center=v.default.add(t,n,Mr.center),Mr.radius=a;var l=Ja.computeEllipsePositions(e,!1,!0).outerPositions,u=new _i.a({position:new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:Ja.raisePositionsToHeight(l,e,!0)})});l=u.position.values;var d=r.default.union(Ir,Mr),f=l.length/3;if(Object(s.default)(e.offsetAttribute)){var c=new Uint8Array(f);if(e.offsetAttribute===fe.a.TOP)c=Object(Ke.a)(c,1,0,f/2);else{var h=e.offsetAttribute===fe.a.NONE?0:1;c=Object(Ke.a)(c,h)}u.applyOffset=new pi.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:c})}var m=Object(o.default)(e.numberOfVerticalLines,16);m=Le.default.clamp(m,0,f/2);var p=gi.a.createTypedArray(f,2*f+2*m);f/=2;var _,g,y=0;for(_=0;_<f;++_)p[y++]=_,p[y++]=(_+1)%f,p[y++]=_+f,p[y++]=(_+1)%f+f;if(m>0){var b=Math.min(m,f);g=Math.round(f/b);var w=Math.min(g*m,f);for(_=0;_<w;_+=g)p[y++]=_,p[y++]=_+f}return{boundingSphere:d,attributes:u,indices:p}}(l);else if(n=function(e){var t=e.center;Dr=v.default.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,Dr),e.height,Dr),Dr=v.default.add(t,Dr,Dr);for(var i=new r.default(Dr,e.semiMajorAxis),a=Ja.computeEllipsePositions(e,!1,!0).outerPositions,n=new _i.a({position:new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:Ja.raisePositionsToHeight(a,e,!1)})}),o=a.length/3,s=gi.a.createTypedArray(o,2*o),l=0,u=0;u<o;++u)s[l++]=u,s[l++]=(u+1)%o;return{boundingSphere:i,attributes:n,indices:s}}(l),Object(s.default)(e._offsetAttribute)){var u=n.attributes.position.values.length,d=new Uint8Array(u/3),f=e._offsetAttribute===fe.a.NONE?0:1;Object(Ke.a)(d,f),n.attributes.applyOffset=new pi.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:d})}return new mi.a({attributes:n.attributes,indices:n.indices,primitiveType:yi.a.LINES,boundingSphere:n.boundingSphere,offsetAttribute:e._offsetAttribute})}};var jr=Fr,Vr=new y.default,Ur=v.default.ZERO,zr=new v.default,Br=new bi.default;function Hr(e){this.id=e,this.vertexFormat=void 0,this.center=void 0,this.semiMajorAxis=void 0,this.semiMinorAxis=void 0,this.rotation=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.numberOfVerticalLines=void 0,this.offsetAttribute=void 0}function kr(e,t){ra.call(this,{entity:e,scene:t,geometryOptions:new Hr(e),geometryPropertyName:"ellipse",observedPropertyNames:["availability","position","ellipse"]}),this._onEntityPropertyChanged(e,"ellipse",e.ellipse,void 0)}function Wr(e,t,i){be.call(this,e,t,i)}Object(s.default)(Object.create)&&(kr.prototype=Object.create(ra.prototype),kr.prototype.constructor=kr),kr.prototype.createFillGeometryInstance=function(e){var t,i=this._entity,a=i.isAvailable(e),r={show:new me.a(a&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:ue.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof pe.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(t=this._materialProperty.color.getValue(e,Vr)),Object(s.default)(t)||(t=y.default.WHITE),r.color=oe.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(r.offset=he.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,Ur,zr))),new de.a({id:i,geometry:new Ar(this._options),attributes:r})},kr.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,i=t.isAvailable(e),a=P.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,Vr),r=this._distanceDisplayConditionProperty.getValue(e),n={show:new me.a(i&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(a),distanceDisplayCondition:ue.fromDistanceDisplayCondition(r),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(n.offset=he.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,Ur,zr))),new de.a({id:t,geometry:new jr(this._options),attributes:n})},kr.prototype._computeCenter=function(e,t){return P.default.getValueOrUndefined(this._entity.position,e,t)},kr.prototype._isHidden=function(e,t){var i=e.position;return!Object(s.default)(i)||!Object(s.default)(t.semiMajorAxis)||!Object(s.default)(t.semiMinorAxis)||Fe.prototype._isHidden.call(this,e,t)},kr.prototype._isDynamic=function(e,t){return!e.position.isConstant||!t.semiMajorAxis.isConstant||!t.semiMinorAxis.isConstant||!P.default.isConstant(t.rotation)||!P.default.isConstant(t.height)||!P.default.isConstant(t.extrudedHeight)||!P.default.isConstant(t.granularity)||!P.default.isConstant(t.stRotation)||!P.default.isConstant(t.outlineWidth)||!P.default.isConstant(t.numberOfVerticalLines)||!P.default.isConstant(t.zIndex)||this._onTerrain&&!P.default.isConstant(this._materialProperty)&&!(this._materialProperty instanceof pe.default)},kr.prototype._setStaticOptions=function(e,t){var i=P.default.getValueOrUndefined(t.height,ce.default.MINIMUM_VALUE),r=P.default.getValueOrDefault(t.heightReference,ce.default.MINIMUM_VALUE,O.default.NONE),n=P.default.getValueOrUndefined(t.extrudedHeight,ce.default.MINIMUM_VALUE),o=P.default.getValueOrDefault(t.extrudedHeightReference,ce.default.MINIMUM_VALUE,O.default.NONE);Object(s.default)(n)&&!Object(s.default)(i)&&(i=0);var l=this._options;l.vertexFormat=this._materialProperty instanceof pe.default?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,l.center=e.position.getValue(ce.default.MINIMUM_VALUE,l.center),l.semiMajorAxis=t.semiMajorAxis.getValue(ce.default.MINIMUM_VALUE,l.semiMajorAxis),l.semiMinorAxis=t.semiMinorAxis.getValue(ce.default.MINIMUM_VALUE,l.semiMinorAxis),l.rotation=P.default.getValueOrUndefined(t.rotation,ce.default.MINIMUM_VALUE),l.granularity=P.default.getValueOrUndefined(t.granularity,ce.default.MINIMUM_VALUE),l.stRotation=P.default.getValueOrUndefined(t.stRotation,ce.default.MINIMUM_VALUE),l.numberOfVerticalLines=P.default.getValueOrUndefined(t.numberOfVerticalLines,ce.default.MINIMUM_VALUE),l.offsetAttribute=ra.computeGeometryOffsetAttribute(i,r,n,o),l.height=ra.getGeometryHeight(i,r),(n=ra.getGeometryExtrudedHeight(n,o))===ra.CLAMP_TO_GROUND&&(n=a.a.getMinimumMaximumHeights(Ar.computeRectangle(l,Br)).minimumTerrainHeight),l.extrudedHeight=n},kr.DynamicGeometryUpdater=Wr,Object(s.default)(Object.create)&&(Wr.prototype=Object.create(be.prototype),Wr.prototype.constructor=Wr),Wr.prototype._isHidden=function(e,t,i){var a=this._options;return!Object(s.default)(a.center)||!Object(s.default)(a.semiMajorAxis)||!Object(s.default)(a.semiMinorAxis)||be.prototype._isHidden.call(this,e,t,i)},Wr.prototype._setOptions=function(e,t,i){var r=this._options,n=P.default.getValueOrUndefined(t.height,i),o=P.default.getValueOrDefault(t.heightReference,i,O.default.NONE),l=P.default.getValueOrUndefined(t.extrudedHeight,i),u=P.default.getValueOrDefault(t.extrudedHeightReference,i,O.default.NONE);Object(s.default)(l)&&!Object(s.default)(n)&&(n=0),r.center=P.default.getValueOrUndefined(e.position,i,r.center),r.semiMajorAxis=P.default.getValueOrUndefined(t.semiMajorAxis,i),r.semiMinorAxis=P.default.getValueOrUndefined(t.semiMinorAxis,i),r.rotation=P.default.getValueOrUndefined(t.rotation,i),r.granularity=P.default.getValueOrUndefined(t.granularity,i),r.stRotation=P.default.getValueOrUndefined(t.stRotation,i),r.numberOfVerticalLines=P.default.getValueOrUndefined(t.numberOfVerticalLines,i),r.offsetAttribute=ra.computeGeometryOffsetAttribute(n,o,l,u),r.height=ra.getGeometryHeight(n,o),(l=ra.getGeometryExtrudedHeight(l,u))===ra.CLAMP_TO_GROUND&&(l=a.a.getMinimumMaximumHeights(Ar.computeRectangle(r,Br)).minimumTerrainHeight),r.extrudedHeight=l};var Gr=kr,Yr=i(513),Xr=i(657),Qr=new pe.default(y.default.WHITE),qr=v.default.ZERO,Zr=new v.default,Kr=new v.default,Jr=new v.default,$r=new y.default,en=new v.default(1,1,1);function tn(e){this.id=e,this.vertexFormat=void 0,this.radii=void 0,this.innerRadii=void 0,this.minimumClock=void 0,this.maximumClock=void 0,this.minimumCone=void 0,this.maximumCone=void 0,this.stackPartitions=void 0,this.slicePartitions=void 0,this.subdivisions=void 0,this.offsetAttribute=void 0}function an(e,t){Fe.call(this,{entity:e,scene:t,geometryOptions:new tn(e),geometryPropertyName:"ellipsoid",observedPropertyNames:["availability","position","orientation","ellipsoid"]}),this._onEntityPropertyChanged(e,"ellipsoid",e.ellipsoid,void 0)}function rn(e,t,i){be.call(this,e,t,i),this._scene=e._scene,this._modelMatrix=new rt.default,this._attributes=void 0,this._outlineAttributes=void 0,this._lastSceneMode=void 0,this._lastShow=void 0,this._lastOutlineShow=void 0,this._lastOutlineWidth=void 0,this._lastOutlineColor=void 0,this._lastOffset=new v.default,this._material={}}Object(s.default)(Object.create)&&(an.prototype=Object.create(Fe.prototype),an.prototype.constructor=an),Object.defineProperties(an.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),an.prototype.createFillGeometryInstance=function(e,t,i){var a,r,n=this._entity,o=n.isAvailable(e),l=new me.a(o&&n.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),u=this._distanceDisplayConditionProperty.getValue(e),d={show:l,distanceDisplayCondition:ue.fromDistanceDisplayCondition(u),color:void 0,offset:void 0};this._materialProperty instanceof pe.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||o)&&(r=this._materialProperty.color.getValue(e,$r)),Object(s.default)(r)||(r=y.default.WHITE),a=oe.a.fromColor(r),d.color=a);return Object(s.default)(this._options.offsetAttribute)&&(d.offset=he.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,qr,Zr))),new de.a({id:n,geometry:new Yr.a(this._options),modelMatrix:t?void 0:n.computeModelMatrixForHeightReference(e,n.ellipsoid.heightReference,.5*this._options.radii.z,this._scene.mapProjection.ellipsoid,i),attributes:d})},an.prototype.createOutlineGeometryInstance=function(e,t,i){var a=this._entity,r=a.isAvailable(e),n=P.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,$r),o=this._distanceDisplayConditionProperty.getValue(e),l={show:new me.a(r&&a.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(n),distanceDisplayCondition:ue.fromDistanceDisplayCondition(o),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(l.offset=he.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,qr,Zr))),new de.a({id:a,geometry:new Xr.a(this._options),modelMatrix:t?void 0:a.computeModelMatrixForHeightReference(e,a.ellipsoid.heightReference,.5*this._options.radii.z,this._scene.mapProjection.ellipsoid,i),attributes:l})},an.prototype._computeCenter=function(e,t){return P.default.getValueOrUndefined(this._entity.position,e,t)},an.prototype._isHidden=function(e,t){return!Object(s.default)(e.position)||!Object(s.default)(t.radii)||Fe.prototype._isHidden.call(this,e,t)},an.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&P.default.isConstant(e.orientation)&&t.radii.isConstant&&P.default.isConstant(t.innerRadii)&&P.default.isConstant(t.stackPartitions)&&P.default.isConstant(t.slicePartitions)&&P.default.isConstant(t.outlineWidth)&&P.default.isConstant(t.minimumClock)&&P.default.isConstant(t.maximumClock)&&P.default.isConstant(t.minimumCone)&&P.default.isConstant(t.maximumCone)&&P.default.isConstant(t.subdivisions))},an.prototype._setStaticOptions=function(e,t){var i=P.default.getValueOrDefault(t.heightReference,ce.default.MINIMUM_VALUE,O.default.NONE),a=this._options;a.vertexFormat=this._materialProperty instanceof pe.default?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,a.radii=t.radii.getValue(ce.default.MINIMUM_VALUE,a.radii),a.innerRadii=P.default.getValueOrUndefined(t.innerRadii,a.radii),a.minimumClock=P.default.getValueOrUndefined(t.minimumClock,ce.default.MINIMUM_VALUE),a.maximumClock=P.default.getValueOrUndefined(t.maximumClock,ce.default.MINIMUM_VALUE),a.minimumCone=P.default.getValueOrUndefined(t.minimumCone,ce.default.MINIMUM_VALUE),a.maximumCone=P.default.getValueOrUndefined(t.maximumCone,ce.default.MINIMUM_VALUE),a.stackPartitions=P.default.getValueOrUndefined(t.stackPartitions,ce.default.MINIMUM_VALUE),a.slicePartitions=P.default.getValueOrUndefined(t.slicePartitions,ce.default.MINIMUM_VALUE),a.subdivisions=P.default.getValueOrUndefined(t.subdivisions,ce.default.MINIMUM_VALUE),a.offsetAttribute=i!==O.default.NONE?fe.a.ALL:void 0},an.prototype._onEntityPropertyChanged=He,an.DynamicGeometryUpdater=rn,Object(s.default)(Object.create)&&(rn.prototype=Object.create(be.prototype),rn.prototype.constructor=rn),rn.prototype.update=function(e){var t=this._entity,i=t.ellipsoid;if(!t.isShowing||!t.isAvailable(e)||!P.default.getValueOrDefault(i.show,e,!0))return Object(s.default)(this._primitive)&&(this._primitive.show=!1),void(Object(s.default)(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1));var a=P.default.getValueOrUndefined(i.radii,e,Kr),r=Object(s.default)(a)?t.computeModelMatrixForHeightReference(e,i.heightReference,.5*a.z,this._scene.mapProjection.ellipsoid,this._modelMatrix):void 0;if(!Object(s.default)(r)||!Object(s.default)(a))return Object(s.default)(this._primitive)&&(this._primitive.show=!1),void(Object(s.default)(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1));var n=P.default.getValueOrDefault(i.fill,e,!0),l=P.default.getValueOrDefault(i.outline,e,!1),u=P.default.getValueOrClonedDefault(i.outlineColor,e,y.default.BLACK,$r),d=ve.getValue(e,Object(o.default)(i.material,Qr),this._material),f=P.default.getValueOrUndefined(i.innerRadii,e,Jr),c=P.default.getValueOrUndefined(i.minimumClock,e),h=P.default.getValueOrUndefined(i.maximumClock,e),m=P.default.getValueOrUndefined(i.minimumCone,e),p=P.default.getValueOrUndefined(i.maximumCone,e),_=P.default.getValueOrUndefined(i.stackPartitions,e),g=P.default.getValueOrUndefined(i.slicePartitions,e),b=P.default.getValueOrUndefined(i.subdivisions,e),x=P.default.getValueOrDefault(i.outlineWidth,e,1),C=P.default.getValueOrDefault(i.heightReference,e,O.default.NONE),T=C!==O.default.NONE?fe.a.ALL:void 0,E=this._scene.mode,A=E===je.a.SCENE3D&&C===O.default.NONE,S=this._options,D=this._geometryUpdater.shadowsProperty.getValue(e),I=this._geometryUpdater.distanceDisplayConditionProperty.getValue(e),M=P.default.getValueOrDefault(this._geometryUpdater.terrainOffsetProperty,e,qr,Zr);if(!A||this._lastSceneMode!==E||!Object(s.default)(this._primitive)||S.stackPartitions!==_||S.slicePartitions!==g||Object(s.default)(f)&&!v.default.equals(S.innerRadii!==f)||S.minimumClock!==c||S.maximumClock!==h||S.minimumCone!==m||S.maximumCone!==p||S.subdivisions!==b||this._lastOutlineWidth!==x||S.offsetAttribute!==T){var F=this._primitives;if(F.removeAndDestroy(this._primitive),F.removeAndDestroy(this._outlinePrimitive),this._primitive=void 0,this._outlinePrimitive=void 0,this._lastSceneMode=E,this._lastOutlineWidth=x,S.stackPartitions=_,S.slicePartitions=g,S.subdivisions=b,S.offsetAttribute=T,S.radii=v.default.clone(A?en:a,S.radii),Object(s.default)(f))if(A){var R=v.default.magnitude(a);S.innerRadii=v.default.fromElements(f.x/R,f.y/R,f.z/R,S.innerRadii)}else S.innerRadii=v.default.clone(f,S.innerRadii);else S.innerRadii=void 0;S.minimumClock=c,S.maximumClock=h,S.minimumCone=m,S.maximumCone=p;var N=new te({material:d,translucent:d.isTranslucent(),closed:!0});S.vertexFormat=N.vertexFormat;var L=this._geometryUpdater.createFillGeometryInstance(e,A,this._modelMatrix);this._primitive=F.add(new _e.a({geometryInstances:L,appearance:N,asynchronous:!1,shadows:D}));var j=this._geometryUpdater.createOutlineGeometryInstance(e,A,this._modelMatrix);this._outlinePrimitive=F.add(new _e.a({geometryInstances:j,appearance:new ie.a({flat:!0,translucent:255!==j.attributes.color.value[3],renderState:{lineWidth:this._geometryUpdater._scene.clampLineWidth(x)}}),asynchronous:!1,shadows:D})),this._lastShow=n,this._lastOutlineShow=l,this._lastOutlineColor=y.default.clone(u,this._lastOutlineColor),this._lastDistanceDisplayCondition=I,this._lastOffset=v.default.clone(M,this._lastOffset)}else if(this._primitive.ready){var V=this._primitive,U=this._outlinePrimitive;V.show=!0,U.show=!0,V.appearance.material=d;var z=this._attributes;Object(s.default)(z)||(z=V.getGeometryInstanceAttributes(t),this._attributes=z),n!==this._lastShow&&(z.show=me.a.toValue(n,z.show),this._lastShow=n);var B=this._outlineAttributes;Object(s.default)(B)||(B=U.getGeometryInstanceAttributes(t),this._outlineAttributes=B),l!==this._lastOutlineShow&&(B.show=me.a.toValue(l,B.show),this._lastOutlineShow=l),y.default.equals(u,this._lastOutlineColor)||(B.color=oe.a.toValue(u,B.color),y.default.clone(u,this._lastOutlineColor)),w.a.equals(I,this._lastDistanceDisplayCondition)||(z.distanceDisplayCondition=ue.toValue(I,z.distanceDisplayCondition),B.distanceDisplayCondition=ue.toValue(I,B.distanceDisplayCondition),w.a.clone(I,this._lastDistanceDisplayCondition)),v.default.equals(M,this._lastOffset)||(z.offset=he.a.toValue(M,z.offset),B.offset=he.a.toValue(M,z.offset),v.default.clone(M,this._lastOffset))}A&&(a.x=Math.max(a.x,.001),a.y=Math.max(a.y,.001),a.z=Math.max(a.z,.001),r=rt.default.multiplyByScale(r,a,r),this._primitive.modelMatrix=r,this._outlinePrimitive.modelMatrix=r)};var nn=an;function on(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT);var t=Object(o.default)(e.vertexFormat,K.default.DEFAULT);this._vertexFormat=t,this._workerName="createPlaneGeometry"}on.packedLength=K.default.packedLength,on.pack=function(e,t,i){return i=Object(o.default)(i,0),K.default.pack(e._vertexFormat,t,i),t};var sn=new K.default,ln={vertexFormat:sn};on.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=K.default.unpack(e,t,sn);return Object(s.default)(i)?(i._vertexFormat=K.default.clone(a,i._vertexFormat),i):new on(ln)};var un=new v.default(-.5,-.5,0),dn=new v.default(.5,.5,0);on.createGeometry=function(e){var t,i,a=e._vertexFormat,n=new _i.a;if(a.position){if((i=new Float64Array(12))[0]=un.x,i[1]=un.y,i[2]=0,i[3]=dn.x,i[4]=un.y,i[5]=0,i[6]=dn.x,i[7]=dn.y,i[8]=0,i[9]=un.x,i[10]=dn.y,i[11]=0,n.position=new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:i}),a.normal){var o=new Float32Array(12);o[0]=0,o[1]=0,o[2]=1,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=1,o[9]=0,o[10]=0,o[11]=1,n.normal=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:o})}if(a.st){var s=new Float32Array(8);s[0]=0,s[1]=0,s[2]=1,s[3]=0,s[4]=1,s[5]=1,s[6]=0,s[7]=1,n.st=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:s})}if(a.tangent){var l=new Float32Array(12);l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=0,l[5]=0,l[6]=1,l[7]=0,l[8]=0,l[9]=1,l[10]=0,l[11]=0,n.tangent=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:l})}if(a.bitangent){var u=new Float32Array(12);u[0]=0,u[1]=1,u[2]=0,u[3]=0,u[4]=1,u[5]=0,u[6]=0,u[7]=1,u[8]=0,u[9]=0,u[10]=1,u[11]=0,n.bitangent=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:u})}(t=new Uint16Array(6))[0]=0,t[1]=1,t[2]=2,t[3]=0,t[4]=2,t[5]=3}return new mi.a({attributes:n,indices:t,primitiveType:yi.a.TRIANGLES,boundingSphere:new r.default(v.default.ZERO,Math.sqrt(2))})};var fn=on;function cn(){this._workerName="createPlaneOutlineGeometry"}cn.packedLength=0,cn.pack=function(e,t){return t},cn.unpack=function(e,t,i){return Object(s.default)(i)?i:new cn};var hn=new v.default(-.5,-.5,0),mn=new v.default(.5,.5,0);cn.createGeometry=function(){var e=new _i.a,t=new Uint16Array(8),i=new Float64Array(12);return i[0]=hn.x,i[1]=hn.y,i[2]=hn.z,i[3]=mn.x,i[4]=hn.y,i[5]=hn.z,i[6]=mn.x,i[7]=mn.y,i[8]=hn.z,i[9]=hn.x,i[10]=mn.y,i[11]=hn.z,e.position=new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:i}),t[0]=0,t[1]=1,t[2]=1,t[3]=2,t[4]=2,t[5]=3,t[6]=3,t[7]=0,new mi.a({attributes:e,indices:t,primitiveType:yi.a.LINES,boundingSphere:new r.default(v.default.ZERO,Math.sqrt(2))})};var pn=cn,_n=new v.default,gn=new y.default;function vn(e){this.id=e,this.vertexFormat=void 0,this.plane=void 0,this.dimensions=void 0}function yn(e,t){Fe.call(this,{entity:e,scene:t,geometryOptions:new vn(e),geometryPropertyName:"plane",observedPropertyNames:["availability","position","orientation","plane"]}),this._onEntityPropertyChanged(e,"plane",e.plane,void 0)}function bn(e,t,i){be.call(this,e,t,i)}Object(s.default)(Object.create)&&(yn.prototype=Object.create(Fe.prototype),yn.prototype.constructor=yn),yn.prototype.createFillGeometryInstance=function(e){var t,i,a=this._entity,r=a.isAvailable(e),n=new me.a(r&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),l=ue.fromDistanceDisplayCondition(o);this._materialProperty instanceof pe.default?(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(i=this._materialProperty.color.getValue(e,gn)),Object(s.default)(i)||(i=y.default.WHITE),t={show:n,distanceDisplayCondition:l,color:oe.a.fromColor(i)}):t={show:n,distanceDisplayCondition:l};var u=a.plane,d=this._options,f=a.computeModelMatrix(e),c=P.default.getValueOrDefault(u.plane,e,d.plane),h=P.default.getValueOrUndefined(u.dimensions,e,d.dimensions);return d.plane=c,d.dimensions=h,f=An(c,h,f,this._scene.mapProjection.ellipsoid,f),new de.a({id:a,geometry:new fn(this._options),modelMatrix:f,attributes:t})},yn.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,i=t.isAvailable(e),a=P.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,gn),r=this._distanceDisplayConditionProperty.getValue(e),n=t.plane,o=this._options,s=t.computeModelMatrix(e),l=P.default.getValueOrDefault(n.plane,e,o.plane),u=P.default.getValueOrUndefined(n.dimensions,e,o.dimensions);return o.plane=l,o.dimensions=u,s=An(l,u,s,this._scene.mapProjection.ellipsoid,s),new de.a({id:t,geometry:new pn,modelMatrix:s,attributes:{show:new me.a(i&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(a),distanceDisplayCondition:ue.fromDistanceDisplayCondition(r)}})},yn.prototype._isHidden=function(e,t){return!Object(s.default)(t.plane)||!Object(s.default)(t.dimensions)||!Object(s.default)(e.position)||Fe.prototype._isHidden.call(this,e,t)},yn.prototype._getIsClosed=function(e){return!1},yn.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&P.default.isConstant(e.orientation)&&t.plane.isConstant&&t.dimensions.isConstant&&P.default.isConstant(t.outlineWidth))},yn.prototype._setStaticOptions=function(e,t){var i=this._materialProperty instanceof pe.default,a=this._options;a.vertexFormat=i?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,a.plane=t.plane.getValue(ce.default.MINIMUM_VALUE,a.plane),a.dimensions=t.dimensions.getValue(ce.default.MINIMUM_VALUE,a.dimensions)},yn.DynamicGeometryUpdater=bn,Object(s.default)(Object.create)&&(bn.prototype=Object.create(be.prototype),bn.prototype.constructor=bn),bn.prototype._isHidden=function(e,t,i){var a=this._options,r=P.default.getValueOrUndefined(e.position,i,_n);return!Object(s.default)(r)||!Object(s.default)(a.plane)||!Object(s.default)(a.dimensions)||be.prototype._isHidden.call(this,e,t,i)},bn.prototype._setOptions=function(e,t,i){var a=this._options;a.plane=P.default.getValueOrDefault(t.plane,i,a.plane),a.dimensions=P.default.getValueOrUndefined(t.dimensions,i,a.dimensions)};var wn=new v.default,xn=new v.default,On=new v.default,Cn=new v.default,Tn=new v.default,En=new nt.default,Pn=new et.default;function An(e,t,i,a,r){var n=e.normal,o=e.distance,s=v.default.multiplyByScalar(n,-o,On);s=rt.default.multiplyByPoint(i,s,s);var l=rt.default.multiplyByPointAsVector(i,n,Cn);v.default.normalize(l,l);var u=a.geodeticSurfaceNormal(s,xn);Le.default.equalsEpsilon(Math.abs(v.default.dot(u,l)),1,Le.default.EPSILON8)&&(u=v.default.clone(v.default.UNIT_Z,u),Le.default.equalsEpsilon(Math.abs(v.default.dot(u,l)),1,Le.default.EPSILON8)&&(u=v.default.clone(v.default.UNIT_X,u)));var d=v.default.cross(u,l,wn);u=v.default.cross(l,d,u),v.default.normalize(d,d),v.default.normalize(u,u);var f=Pn;et.default.setColumn(f,0,d,f),et.default.setColumn(f,1,u,f),et.default.setColumn(f,2,l,f);var c=nt.default.fromRotationMatrix(f,En),h=g.default.clone(t,Tn);return h.z=1,rt.default.fromTranslationQuaternionRotationScale(s,c,h,r)}yn.createPrimitiveMatrix=An;var Sn=yn,Dn=i(149),In=i(115),Mn={},Fn=new v.default,Rn=new v.default,Nn=new v.default,Ln=new v.default,jn=new In.a;function Vn(e,t,i,a,r){var n=v.default.subtract(e,t,Fn),o=v.default.dot(i,n),s=v.default.dot(a,n);return g.default.fromElements(o,s,r)}Mn.validOutline=function(e){var t=In.a.fromPoints(e,jn).halfAxes,i=et.default.getColumn(t,0,Rn),a=et.default.getColumn(t,1,Nn),r=et.default.getColumn(t,2,Ln),n=v.default.magnitude(i),o=v.default.magnitude(a),s=v.default.magnitude(r);return!(0===n&&(0===o||0===s)||0===o&&0===s)},Mn.computeProjectTo2DArguments=function(e,t,i,a){var r,n,o=In.a.fromPoints(e,jn),s=o.halfAxes,l=et.default.getColumn(s,0,Rn),u=et.default.getColumn(s,1,Nn),d=et.default.getColumn(s,2,Ln),f=v.default.magnitude(l),c=v.default.magnitude(u),h=v.default.magnitude(d),m=Math.min(f,c,h);return(0!==f||0!==c&&0!==h)&&(0!==c||0!==h)&&(m!==c&&m!==h||(r=l),m===f?r=u:m===h&&(n=u),m!==f&&m!==c||(n=d),v.default.normalize(r,i),v.default.normalize(n,a),v.default.clone(o.center,t),!0)},Mn.createProjectPointsTo2DFunction=function(e,t,i){return function(a){for(var r=new Array(a.length),n=0;n<a.length;n++)r[n]=Vn(a[n],e,t,i);return r}},Mn.createProjectPointTo2DFunction=function(e,t,i){return function(a,r){return Vn(a,e,t,i,r)}};var Un=Mn,zn=i(278),Bn=new v.default,Hn=new _.default,kn=new g.default,Wn=new g.default,Gn=new v.default,Yn=new v.default,Xn=new v.default,Qn=new v.default,qn=new v.default,Zn=new v.default,Kn=new nt.default,Jn=new et.default,$n=new et.default,eo=new v.default;function to(e,t,i,a,r,n,o,s){var l=e.positions,u=vi.a.triangulate(e.positions2D,e.holes);u.length<3&&(u=[0,1,2]);var d=gi.a.createTypedArray(l.length,u.length);d.set(u);var f=Jn;if(0!==a){var c=nt.default.fromAxisAngle(n,a,Kn);if(f=et.default.fromQuaternion(c,f),t.tangent||t.bitangent){c=nt.default.fromAxisAngle(n,-a,Kn);var h=et.default.fromQuaternion(c,$n);o=v.default.normalize(et.default.multiplyByVector(h,o,o),o),t.bitangent&&(s=v.default.normalize(v.default.cross(n,o,s),s))}}else f=et.default.clone(et.default.IDENTITY,f);var m=Wn;t.st&&(m.x=i.x,m.y=i.y);for(var p=l.length,_=3*p,y=new Float64Array(_),b=t.normal?new Float32Array(_):void 0,w=t.tangent?new Float32Array(_):void 0,x=t.bitangent?new Float32Array(_):void 0,O=t.st?new Float32Array(2*p):void 0,C=0,T=0,E=0,P=0,A=0,S=0;S<p;S++){var D=l[S];if(y[C++]=D.x,y[C++]=D.y,y[C++]=D.z,t.st){var I=r(et.default.multiplyByVector(f,D,Bn),kn);g.default.subtract(I,m,I);var M=Le.default.clamp(I.x/i.width,0,1),F=Le.default.clamp(I.y/i.height,0,1);O[A++]=M,O[A++]=F}t.normal&&(b[T++]=n.x,b[T++]=n.y,b[T++]=n.z),t.tangent&&(w[P++]=o.x,w[P++]=o.y,w[P++]=o.z),t.bitangent&&(x[E++]=s.x,x[E++]=s.y,x[E++]=s.z)}var R=new _i.a;return t.position&&(R.position=new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:y})),t.normal&&(R.normal=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:b})),t.tangent&&(R.tangent=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:w})),t.bitangent&&(R.bitangent=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:x})),t.st&&(R.st=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:O})),new mi.a({attributes:R,indices:d,primitiveType:yi.a.TRIANGLES})}function io(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polygonHierarchy,i=Object(o.default)(e.vertexFormat,K.default.DEFAULT);this._vertexFormat=K.default.clone(i),this._polygonHierarchy=t,this._stRotation=Object(o.default)(e.stRotation,0),this._ellipsoid=hi.default.clone(Object(o.default)(e.ellipsoid,hi.default.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=zn.default.computeHierarchyPackedLength(t)+K.default.packedLength+hi.default.packedLength+2}io.fromPositions=function(e){return new io({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},io.pack=function(e,t,i){return i=Object(o.default)(i,0),i=zn.default.packPolygonHierarchy(e._polygonHierarchy,t,i),hi.default.pack(e._ellipsoid,t,i),i+=hi.default.packedLength,K.default.pack(e._vertexFormat,t,i),i+=K.default.packedLength,t[i++]=e._stRotation,t[i]=e.packedLength,t};var ao=hi.default.clone(hi.default.UNIT_SPHERE),ro=new K.default,no={polygonHierarchy:{}};io.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=zn.default.unpackPolygonHierarchy(e,t);t=a.startingIndex,delete a.startingIndex;var r=hi.default.unpack(e,t,ao);t+=hi.default.packedLength;var n=K.default.unpack(e,t,ro);t+=K.default.packedLength;var l=e[t++],u=e[t];return Object(s.default)(i)||(i=new io(no)),i._polygonHierarchy=a,i._ellipsoid=hi.default.clone(r,i._ellipsoid),i._vertexFormat=K.default.clone(n,i._vertexFormat),i._stRotation=l,i.packedLength=u,i},io.createGeometry=function(e){var t=e._vertexFormat,i=e._polygonHierarchy,a=e._stRotation,n=i.positions;if(!((n=Object(Je.a)(n,v.default.equalsEpsilon,!0)).length<3)){var o=Gn,s=Yn,l=Xn,u=qn,d=Zn;if(Un.computeProjectTo2DArguments(n,Qn,u,d)){if(o=v.default.cross(u,d,o),o=v.default.normalize(o,o),!v.default.equalsEpsilon(Qn,v.default.ZERO,Le.default.EPSILON6)){var f=e._ellipsoid.geodeticSurfaceNormal(Qn,eo);v.default.dot(o,f)<0&&(o=v.default.negate(o,o),u=v.default.negate(u,u))}var c=Un.createProjectPointsTo2DFunction(Qn,u,d),h=Un.createProjectPointTo2DFunction(Qn,u,d);t.tangent&&(s=v.default.clone(u,s)),t.bitangent&&(l=v.default.clone(d,l));var m=zn.default.polygonsFromHierarchy(i,c,!1),p=m.hierarchy,_=m.polygons;if(0!==p.length){n=p[0].outerRing;for(var g=r.default.fromPoints(n),y=zn.default.computeBoundingRectangle(o,h,n,a,Hn),b=[],w=0;w<_.length;w++){var x=new de.a({geometry:to(_[w],t,y,a,h,o,s,l)});b.push(x)}var O=er.a.combineInstances(b)[0];O.attributes.position.values=new Float64Array(O.attributes.position.values),O.indices=gi.a.createTypedArray(O.attributes.position.values.length/3,O.indices);var C=O.attributes;return t.position||delete C.position,new mi.a({attributes:C,indices:O.indices,primitiveType:O.primitiveType,boundingSphere:g})}}}};var oo=io;function so(e){for(var t=e.length,i=new Float64Array(3*t),a=gi.a.createTypedArray(t,2*t),r=0,n=0,o=0;o<t;o++){var s=e[o];i[r++]=s.x,i[r++]=s.y,i[r++]=s.z,a[n++]=o,a[n++]=(o+1)%t}var l=new _i.a({position:new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:i})});return new mi.a({attributes:l,indices:a,primitiveType:yi.a.LINES})}function lo(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polygonHierarchy;this._polygonHierarchy=t,this._workerName="createCoplanarPolygonOutlineGeometry",this.packedLength=zn.default.computeHierarchyPackedLength(t)+1}lo.fromPositions=function(e){return new lo({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions}})},lo.pack=function(e,t,i){return i=Object(o.default)(i,0),t[i=zn.default.packPolygonHierarchy(e._polygonHierarchy,t,i)]=e.packedLength,t};var uo={polygonHierarchy:{}};lo.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=zn.default.unpackPolygonHierarchy(e,t);t=a.startingIndex,delete a.startingIndex;var r=e[t];return Object(s.default)(i)||(i=new lo(uo)),i._polygonHierarchy=a,i.packedLength=r,i},lo.createGeometry=function(e){var t=e._polygonHierarchy,i=t.positions;if(!((i=Object(Je.a)(i,v.default.equalsEpsilon,!0)).length<3)&&Un.validOutline(i)){var a=zn.default.polygonOutlinesFromHierarchy(t,!1);if(0!==a.length){for(var n=[],o=0;o<a.length;o++){var s=new de.a({geometry:so(a[o])});n.push(s)}var l=er.a.combineInstances(n)[0],u=r.default.fromPoints(t.positions);return new mi.a({attributes:l.attributes,indices:l.indices,primitiveType:l.primitiveType,boundingSphere:u})}}};var fo=lo,co=i(229),ho=i(133),mo=new Ne.default,po=new Ne.default;function _o(e,t,i,a){var r=a.cartesianToCartographic(e,mo).height,n=a.cartesianToCartographic(t,po);n.height=r,a.cartographicToCartesian(n,t);var o=a.cartesianToCartographic(i,po);o.height=r-100,a.cartographicToCartesian(o,i)}var go=new _.default,vo=new v.default,yo=new v.default,bo=new v.default,wo=new v.default,xo=new v.default,Oo=new v.default,Co=new v.default,To=new v.default,Eo=new v.default,Po=new g.default,Ao=new g.default,So=new v.default,Do=new nt.default,Io=new et.default,Mo=new et.default;function Fo(e){var t=e.vertexFormat,i=e.geometry,a=e.shadowVolume,r=i.attributes.position.values,n=r.length,o=e.wall,l=e.top||o,u=e.bottom||o;if(t.st||t.normal||t.tangent||t.bitangent||a){var d=e.boundingRectangle,f=e.tangentPlane,c=e.ellipsoid,h=e.stRotation,m=e.perPositionHeight,p=Po;p.x=d.x,p.y=d.y;var _,y=t.st?new Float32Array(n/3*2):void 0;t.normal&&(_=m&&l&&!o?i.attributes.normal.values:new Float32Array(n));var b=t.tangent?new Float32Array(n):void 0,w=t.bitangent?new Float32Array(n):void 0,x=a?new Float32Array(n):void 0,O=0,C=0,T=yo,E=bo,P=wo,A=!0,S=Io,D=Mo;if(0!==h){var I=nt.default.fromAxisAngle(f._plane.normal,h,Do);S=et.default.fromQuaternion(I,S),I=nt.default.fromAxisAngle(f._plane.normal,-h,Do),D=et.default.fromQuaternion(I,D)}else S=et.default.clone(et.default.IDENTITY,S),D=et.default.clone(et.default.IDENTITY,D);var M=0,F=0;l&&u&&(M=n/2,F=n/3,n/=2);for(var R=0;R<n;R+=3){var N=v.default.fromArray(r,R,So);if(t.st){var L=et.default.multiplyByVector(S,N,vo);L=c.scaleToGeodeticSurface(L,L);var j=f.projectPointOntoPlane(L,Ao);g.default.subtract(j,p,j);var V=Le.default.clamp(j.x/d.width,0,1),U=Le.default.clamp(j.y/d.height,0,1);u&&(y[O+F]=V,y[O+1+F]=U),l&&(y[O]=V,y[O+1]=U),O+=2}if(t.normal||t.tangent||t.bitangent||a){var z=C+1,B=C+2;if(o){if(R+3<n){var H=v.default.fromArray(r,R+3,xo);if(A){var k=v.default.fromArray(r,R+n,Oo);m&&_o(N,H,k,c),v.default.subtract(H,N,H),v.default.subtract(k,N,k),T=v.default.normalize(v.default.cross(k,H,T),T),A=!1}v.default.equalsEpsilon(H,N,Le.default.EPSILON10)&&(A=!0)}(t.tangent||t.bitangent)&&(P=c.geodeticSurfaceNormal(N,P),t.tangent&&(E=v.default.normalize(v.default.cross(P,T,E),E)))}else T=c.geodeticSurfaceNormal(N,T),(t.tangent||t.bitangent)&&(m&&(Co=v.default.fromArray(_,C,Co),To=v.default.cross(v.default.UNIT_Z,Co,To),To=v.default.normalize(et.default.multiplyByVector(D,To,To),To),t.bitangent&&(Eo=v.default.normalize(v.default.cross(Co,To,Eo),Eo))),E=v.default.cross(v.default.UNIT_Z,T,E),E=v.default.normalize(et.default.multiplyByVector(D,E,E),E),t.bitangent&&(P=v.default.normalize(v.default.cross(T,E,P),P)));t.normal&&(e.wall?(_[C+M]=T.x,_[z+M]=T.y,_[B+M]=T.z):u&&(_[C+M]=-T.x,_[z+M]=-T.y,_[B+M]=-T.z),(l&&!m||o)&&(_[C]=T.x,_[z]=T.y,_[B]=T.z)),a&&(o&&(T=c.geodeticSurfaceNormal(N,T)),x[C+M]=-T.x,x[z+M]=-T.y,x[B+M]=-T.z),t.tangent&&(e.wall?(b[C+M]=E.x,b[z+M]=E.y,b[B+M]=E.z):u&&(b[C+M]=-E.x,b[z+M]=-E.y,b[B+M]=-E.z),l&&(m?(b[C]=To.x,b[z]=To.y,b[B]=To.z):(b[C]=E.x,b[z]=E.y,b[B]=E.z))),t.bitangent&&(u&&(w[C+M]=P.x,w[z+M]=P.y,w[B+M]=P.z),l&&(m?(w[C]=Eo.x,w[z]=Eo.y,w[B]=Eo.z):(w[C]=P.x,w[z]=P.y,w[B]=P.z))),C+=3}}t.st&&(i.attributes.st=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:y})),t.normal&&(i.attributes.normal=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:_})),t.tangent&&(i.attributes.tangent=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:b})),t.bitangent&&(i.attributes.bitangent=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:w})),a&&(i.attributes.extrudeDirection=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:x}))}if(e.extrude&&Object(s.default)(e.offsetAttribute)){var W=r.length/3,G=new Uint8Array(W);if(e.offsetAttribute===fe.a.TOP)l&&u||o?G=Object(Ke.a)(G,1,0,W/2):l&&(G=Object(Ke.a)(G,1));else{var Y=e.offsetAttribute===fe.a.NONE?0:1;G=Object(Ke.a)(G,Y)}i.attributes.applyOffset=new pi.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:G})}return i}var Ro=new Ne.default,No=new Ne.default,Lo={westOverIDL:0,eastOverIDL:0},jo=new co.default;function Vo(e,t,i,a,r){if(r=Object(o.default)(r,new bi.default),!Object(s.default)(e)||e.length<3)return r.west=0,r.north=0,r.south=0,r.east=0,r;if(i===Dn.a.RHUMB)return bi.default.fromCartesianArray(e,t,r);jo.ellipsoid.equals(t)||(jo=new co.default(void 0,void 0,t)),r.west=Number.POSITIVE_INFINITY,r.east=Number.NEGATIVE_INFINITY,r.south=Number.POSITIVE_INFINITY,r.north=Number.NEGATIVE_INFINITY,Lo.westOverIDL=Number.POSITIVE_INFINITY,Lo.eastOverIDL=Number.NEGATIVE_INFINITY;for(var n,l=1/Le.default.chordLength(a,t.maximumRadius),u=e.length,d=t.cartesianToCartographic(e[0],No),f=Ro,c=1;c<u;c++)n=f,f=d,d=t.cartesianToCartographic(e[c],n),jo.setEndPoints(f,d),zo(jo,l,r,Lo);return n=f,f=d,d=t.cartesianToCartographic(e[0],n),jo.setEndPoints(f,d),zo(jo,l,r,Lo),r.east-r.west>Lo.eastOverIDL-Lo.westOverIDL&&(r.west=Lo.westOverIDL,r.east=Lo.eastOverIDL,r.east>Le.default.PI&&(r.east=r.east-Le.default.TWO_PI),r.west>Le.default.PI&&(r.west=r.west-Le.default.TWO_PI)),r}var Uo=new Ne.default;function zo(e,t,i,a){for(var r=e.surfaceDistance,n=Math.ceil(r*t),o=n>0?r/(n-1):Number.POSITIVE_INFINITY,s=0,l=0;l<n;l++){var u=e.interpolateUsingSurfaceDistance(s,Uo);s+=o;var d=u.longitude,f=u.latitude;i.west=Math.min(i.west,d),i.east=Math.max(i.east,d),i.south=Math.min(i.south,f),i.north=Math.max(i.north,f);var c=d>=0?d:d+Le.default.TWO_PI;a.westOverIDL=Math.min(a.westOverIDL,c),a.eastOverIDL=Math.max(a.eastOverIDL,c)}}var Bo=[];function Ho(e,t,i,a,r,n,o,s,l){var u,d={walls:[]};if(n||o){var f,c,h=zn.default.createGeometryFromPositions(e,t,i,r,s,l),m=h.attributes.position.values,p=h.indices;if(n&&o){var _=m.concat(m);f=_.length/3,(c=gi.a.createTypedArray(f,2*p.length)).set(p);var g=p.length,v=f/2;for(u=0;u<g;u+=3){var y=c[u]+v,b=c[u+1]+v,w=c[u+2]+v;c[u+g]=w,c[u+1+g]=b,c[u+2+g]=y}if(h.attributes.position.values=_,r&&s.normal){var x=h.attributes.normal.values;h.attributes.normal.values=new Float32Array(_.length),h.attributes.normal.values.set(x)}h.indices=c}else if(o){for(f=m.length/3,c=gi.a.createTypedArray(f,p.length),u=0;u<p.length;u+=3)c[u]=p[u+2],c[u+1]=p[u+1],c[u+2]=p[u];h.indices=c}d.topAndBottom=new de.a({geometry:h})}var O=a.outerRing,C=at.default.fromPoints(O,e),T=C.projectPointsOntoPlane(O,Bo),E=vi.a.computeWindingOrder2D(T);E===ho.default.CLOCKWISE&&(O=O.slice().reverse());var P=zn.default.computeWallGeometry(O,e,i,r,l);d.walls.push(new de.a({geometry:P}));var A=a.holes;for(u=0;u<A.length;u++){var S=A[u];T=(C=at.default.fromPoints(S,e)).projectPointsOntoPlane(S,Bo),(E=vi.a.computeWindingOrder2D(T))===ho.default.COUNTER_CLOCKWISE&&(S=S.slice().reverse()),P=zn.default.computeWallGeometry(S,e,i,r,l),d.walls.push(new de.a({geometry:P}))}return d}function ko(e){var t=e.polygonHierarchy,i=Object(o.default)(e.vertexFormat,K.default.DEFAULT),a=Object(o.default)(e.ellipsoid,hi.default.WGS84),r=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),n=Object(o.default)(e.stRotation,0),l=Object(o.default)(e.perPositionHeight,!1),u=l&&Object(s.default)(e.extrudedHeight),d=Object(o.default)(e.height,0),f=Object(o.default)(e.extrudedHeight,d);if(!u){var c=Math.max(d,f);f=Math.min(d,f),d=c}this._vertexFormat=K.default.clone(i),this._ellipsoid=hi.default.clone(a),this._granularity=r,this._stRotation=n,this._height=d,this._extrudedHeight=f,this._closeTop=Object(o.default)(e.closeTop,!0),this._closeBottom=Object(o.default)(e.closeBottom,!0),this._polygonHierarchy=t,this._perPositionHeight=l,this._perPositionHeightExtrude=u,this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=e.offsetAttribute,this._arcType=Object(o.default)(e.arcType,Dn.a.GEODESIC),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=zn.default.computeHierarchyPackedLength(t)+hi.default.packedLength+K.default.packedLength+12}ko.fromPositions=function(e){return new ko({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions},height:e.height,extrudedHeight:e.extrudedHeight,vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,closeTop:e.closeTop,closeBottom:e.closeBottom,offsetAttribute:e.offsetAttribute,arcType:e.arcType})},ko.pack=function(e,t,i){return i=Object(o.default)(i,0),i=zn.default.packPolygonHierarchy(e._polygonHierarchy,t,i),hi.default.pack(e._ellipsoid,t,i),i+=hi.default.packedLength,K.default.pack(e._vertexFormat,t,i),i+=K.default.packedLength,t[i++]=e._height,t[i++]=e._extrudedHeight,t[i++]=e._granularity,t[i++]=e._stRotation,t[i++]=e._perPositionHeightExtrude?1:0,t[i++]=e._perPositionHeight?1:0,t[i++]=e._closeTop?1:0,t[i++]=e._closeBottom?1:0,t[i++]=e._shadowVolume?1:0,t[i++]=Object(o.default)(e._offsetAttribute,-1),t[i++]=e._arcType,t[i]=e.packedLength,t};var Wo=hi.default.clone(hi.default.UNIT_SPHERE),Go=new K.default,Yo={polygonHierarchy:{}};ko.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=zn.default.unpackPolygonHierarchy(e,t);t=a.startingIndex,delete a.startingIndex;var r=hi.default.unpack(e,t,Wo);t+=hi.default.packedLength;var n=K.default.unpack(e,t,Go);t+=K.default.packedLength;var l=e[t++],u=e[t++],d=e[t++],f=e[t++],c=1===e[t++],h=1===e[t++],m=1===e[t++],p=1===e[t++],_=1===e[t++],g=e[t++],v=e[t++],y=e[t];return Object(s.default)(i)||(i=new ko(Yo)),i._polygonHierarchy=a,i._ellipsoid=hi.default.clone(r,i._ellipsoid),i._vertexFormat=K.default.clone(n,i._vertexFormat),i._height=l,i._extrudedHeight=u,i._granularity=d,i._stRotation=f,i._perPositionHeightExtrude=c,i._perPositionHeight=h,i._closeTop=m,i._closeBottom=p,i._shadowVolume=_,i._offsetAttribute=-1===g?void 0:g,i._arcType=v,i.packedLength=y,i},ko.computeRectangle=function(e,t){var i=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),a=Object(o.default)(e.arcType,Dn.a.GEODESIC),r=e.polygonHierarchy,n=Object(o.default)(e.ellipsoid,hi.default.WGS84);return Vo(r.positions,n,a,i,t)},ko.createGeometry=function(e){var t=e._vertexFormat,i=e._ellipsoid,a=e._granularity,n=e._stRotation,o=e._polygonHierarchy,l=e._perPositionHeight,u=e._closeTop,d=e._closeBottom,f=e._arcType,c=o.positions;if(!(c.length<3)){var h=at.default.fromPoints(c,i),m=zn.default.polygonsFromHierarchy(o,h.projectPointsOntoPlane.bind(h),!l,i),p=m.hierarchy,_=m.polygons;if(0!==p.length){c=p[0].outerRing;var g,v=zn.default.computeBoundingRectangle(h.plane.normal,h.projectPointOntoPlane.bind(h),c,n,go),y=[],b=e._height,w=e._extrudedHeight,x={perPositionHeight:l,vertexFormat:t,geometry:void 0,tangentPlane:h,boundingRectangle:v,ellipsoid:i,stRotation:n,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:f};if(e._perPositionHeightExtrude||!Le.default.equalsEpsilon(b,w,0,Le.default.EPSILON2))for(x.extrude=!0,x.top=u,x.bottom=d,x.shadowVolume=e._shadowVolume,x.offsetAttribute=e._offsetAttribute,g=0;g<_.length;g++){var O,C=Ho(i,_[g],a,p[g],l,u,d,t,f);u&&d?(O=C.topAndBottom,x.geometry=zn.default.scaleToGeodeticHeightExtruded(O.geometry,b,w,i,l)):u?((O=C.topAndBottom).geometry.attributes.position.values=vi.a.scaleToGeodeticHeight(O.geometry.attributes.position.values,b,i,!l),x.geometry=O.geometry):d&&((O=C.topAndBottom).geometry.attributes.position.values=vi.a.scaleToGeodeticHeight(O.geometry.attributes.position.values,w,i,!0),x.geometry=O.geometry),(u||d)&&(x.wall=!1,O.geometry=Fo(x),y.push(O));var T=C.walls;x.wall=!0;for(var E=0;E<T.length;E++){var P=T[E];x.geometry=zn.default.scaleToGeodeticHeightExtruded(P.geometry,b,w,i,l),P.geometry=Fo(x),y.push(P)}}else for(g=0;g<_.length;g++){var A=new de.a({geometry:zn.default.createGeometryFromPositions(i,_[g],a,l,t,f)});if(A.geometry.attributes.position.values=vi.a.scaleToGeodeticHeight(A.geometry.attributes.position.values,b,i,!l),x.geometry=A.geometry,A.geometry=Fo(x),Object(s.default)(e._offsetAttribute)){var S=A.geometry.attributes.position.values.length,D=new Uint8Array(S/3),I=e._offsetAttribute===fe.a.NONE?0:1;Object(Ke.a)(D,I),A.geometry.attributes.applyOffset=new pi.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:D})}y.push(A)}var M=er.a.combineInstances(y)[0];M.attributes.position.values=new Float64Array(M.attributes.position.values),M.indices=gi.a.createTypedArray(M.attributes.position.values.length/3,M.indices);var F=M.attributes,R=r.default.fromVertices(F.position.values);return t.position||delete F.position,new mi.a({attributes:F,indices:M.indices,primitiveType:M.primitiveType,boundingSphere:R,offsetAttribute:e._offsetAttribute})}}},ko.createShadowVolume=function(e,t,i){var a=e._granularity,r=e._ellipsoid,n=t(a,r),o=i(a,r);return new ko({polygonHierarchy:e._polygonHierarchy,ellipsoid:r,stRotation:e._stRotation,granularity:a,perPositionHeight:!1,extrudedHeight:n,height:o,vertexFormat:K.default.POSITION_ONLY,shadowVolume:!0,arcType:e._arcType})},Object.defineProperties(ko.prototype,{rectangle:{get:function(){if(!Object(s.default)(this._rectangle)){var e=this._polygonHierarchy.positions;this._rectangle=Vo(e,this._ellipsoid,this._arcType,this._granularity)}return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return Object(s.default)(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0===t)return[0,0,0,1,1,0];var i=e._ellipsoid,a=e._polygonHierarchy.positions,r=e.rectangle;return mi.a._textureCoordinateRotationPoints(a,t,i,r)}(this)),this._textureCoordinateRotationPoints}}});var Xo=ko,Qo=[],qo=[];function Zo(e,t,i,a,r){var n,o,s=at.default.fromPoints(t,e).projectPointsOntoPlane(t,Qo);vi.a.computeWindingOrder2D(s)===ho.default.CLOCKWISE&&(s.reverse(),t=t.slice().reverse());var l=t.length,u=0;if(a)for(n=new Float64Array(2*l*3),o=0;o<l;o++){var d=t[o],f=t[(o+1)%l];n[u++]=d.x,n[u++]=d.y,n[u++]=d.z,n[u++]=f.x,n[u++]=f.y,n[u++]=f.z}else{var c=0;if(r===Dn.a.GEODESIC)for(o=0;o<l;o++)c+=zn.default.subdivideLineCount(t[o],t[(o+1)%l],i);else if(r===Dn.a.RHUMB)for(o=0;o<l;o++)c+=zn.default.subdivideRhumbLineCount(e,t[o],t[(o+1)%l],i);for(n=new Float64Array(3*c),o=0;o<l;o++){var h;r===Dn.a.GEODESIC?h=zn.default.subdivideLine(t[o],t[(o+1)%l],i,qo):r===Dn.a.RHUMB&&(h=zn.default.subdivideRhumbLine(e,t[o],t[(o+1)%l],i,qo));for(var m=h.length,p=0;p<m;++p)n[u++]=h[p]}}var _=2*(l=n.length/3),g=gi.a.createTypedArray(l,_);for(u=0,o=0;o<l-1;o++)g[u++]=o,g[u++]=o+1;return g[u++]=l-1,g[u++]=0,new de.a({geometry:new mi.a({attributes:new _i.a({position:new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:n})}),indices:g,primitiveType:yi.a.LINES})})}function Ko(e,t,i,a,r){var n,o,s=at.default.fromPoints(t,e).projectPointsOntoPlane(t,Qo);vi.a.computeWindingOrder2D(s)===ho.default.CLOCKWISE&&(s.reverse(),t=t.slice().reverse());var l=t.length,u=new Array(l),d=0;if(a)for(n=new Float64Array(2*l*3*2),o=0;o<l;++o){u[o]=d/3;var f=t[o],c=t[(o+1)%l];n[d++]=f.x,n[d++]=f.y,n[d++]=f.z,n[d++]=c.x,n[d++]=c.y,n[d++]=c.z}else{var h=0;if(r===Dn.a.GEODESIC)for(o=0;o<l;o++)h+=zn.default.subdivideLineCount(t[o],t[(o+1)%l],i);else if(r===Dn.a.RHUMB)for(o=0;o<l;o++)h+=zn.default.subdivideRhumbLineCount(e,t[o],t[(o+1)%l],i);for(n=new Float64Array(3*h*2),o=0;o<l;++o){var m;u[o]=d/3,r===Dn.a.GEODESIC?m=zn.default.subdivideLine(t[o],t[(o+1)%l],i,qo):r===Dn.a.RHUMB&&(m=zn.default.subdivideRhumbLine(e,t[o],t[(o+1)%l],i,qo));for(var p=m.length,_=0;_<p;++_)n[d++]=m[_]}}l=n.length/6;var g=u.length,v=2*(2*l+g),y=gi.a.createTypedArray(l+g,v);for(d=0,o=0;o<l;++o)y[d++]=o,y[d++]=(o+1)%l,y[d++]=o+l,y[d++]=(o+1)%l+l;for(o=0;o<g;o++){var b=u[o];y[d++]=b,y[d++]=b+l}return new de.a({geometry:new mi.a({attributes:new _i.a({position:new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:n})}),indices:y,primitiveType:yi.a.LINES})})}function Jo(e){var t=e.polygonHierarchy,i=Object(o.default)(e.ellipsoid,hi.default.WGS84),a=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),r=Object(o.default)(e.perPositionHeight,!1),n=r&&Object(s.default)(e.extrudedHeight),l=Object(o.default)(e.arcType,Dn.a.GEODESIC),u=Object(o.default)(e.height,0),d=Object(o.default)(e.extrudedHeight,u);if(!n){var f=Math.max(u,d);d=Math.min(u,d),u=f}this._ellipsoid=hi.default.clone(i),this._granularity=a,this._height=u,this._extrudedHeight=d,this._arcType=l,this._polygonHierarchy=t,this._perPositionHeight=r,this._perPositionHeightExtrude=n,this._offsetAttribute=e.offsetAttribute,this._workerName="createPolygonOutlineGeometry",this.packedLength=zn.default.computeHierarchyPackedLength(t)+hi.default.packedLength+8}Jo.pack=function(e,t,i){return i=Object(o.default)(i,0),i=zn.default.packPolygonHierarchy(e._polygonHierarchy,t,i),hi.default.pack(e._ellipsoid,t,i),i+=hi.default.packedLength,t[i++]=e._height,t[i++]=e._extrudedHeight,t[i++]=e._granularity,t[i++]=e._perPositionHeightExtrude?1:0,t[i++]=e._perPositionHeight?1:0,t[i++]=e._arcType,t[i++]=Object(o.default)(e._offsetAttribute,-1),t[i]=e.packedLength,t};var $o=hi.default.clone(hi.default.UNIT_SPHERE),es={polygonHierarchy:{}};Jo.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=zn.default.unpackPolygonHierarchy(e,t);t=a.startingIndex,delete a.startingIndex;var r=hi.default.unpack(e,t,$o);t+=hi.default.packedLength;var n=e[t++],l=e[t++],u=e[t++],d=1===e[t++],f=1===e[t++],c=e[t++],h=e[t++],m=e[t];return Object(s.default)(i)||(i=new Jo(es)),i._polygonHierarchy=a,i._ellipsoid=hi.default.clone(r,i._ellipsoid),i._height=n,i._extrudedHeight=l,i._granularity=u,i._perPositionHeight=f,i._perPositionHeightExtrude=d,i._arcType=c,i._offsetAttribute=-1===h?void 0:h,i.packedLength=m,i},Jo.fromPositions=function(e){return new Jo({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions},height:e.height,extrudedHeight:e.extrudedHeight,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,arcType:e.arcType,offsetAttribute:e.offsetAttribute})},Jo.createGeometry=function(e){var t=e._ellipsoid,i=e._granularity,a=e._polygonHierarchy,n=e._perPositionHeight,o=e._arcType,l=zn.default.polygonOutlinesFromHierarchy(a,!n,t);if(0!==l.length){var u,d,f,c=[],h=Le.default.chordLength(i,t.maximumRadius),m=e._height,p=e._extrudedHeight;if(e._perPositionHeightExtrude||!Le.default.equalsEpsilon(m,p,0,Le.default.EPSILON2))for(f=0;f<l.length;f++){if((u=Ko(t,l[f],h,n,o)).geometry=zn.default.scaleToGeodeticHeightExtruded(u.geometry,m,p,t,n),Object(s.default)(e._offsetAttribute)){var _=u.geometry.attributes.position.values.length/3,g=new Uint8Array(_);e._offsetAttribute===fe.a.TOP?g=Object(Ke.a)(g,1,0,_/2):(d=e._offsetAttribute===fe.a.NONE?0:1,g=Object(Ke.a)(g,d)),u.geometry.attributes.applyOffset=new pi.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:g})}c.push(u)}else for(f=0;f<l.length;f++){if((u=Zo(t,l[f],h,n,o)).geometry.attributes.position.values=vi.a.scaleToGeodeticHeight(u.geometry.attributes.position.values,m,t,!n),Object(s.default)(e._offsetAttribute)){var v=u.geometry.attributes.position.values.length,y=new Uint8Array(v/3);d=e._offsetAttribute===fe.a.NONE?0:1,Object(Ke.a)(y,d),u.geometry.attributes.applyOffset=new pi.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:y})}c.push(u)}var b=er.a.combineInstances(c)[0],w=r.default.fromVertices(b.attributes.position.values);return new mi.a({attributes:b.attributes,indices:b.indices,primitiveType:b.primitiveType,boundingSphere:w,offsetAttribute:e._offsetAttribute})}};var ts=Jo,is=new y.default,as=v.default.ZERO,rs=new v.default,ns=new bi.default,os=[],ss=new g.default;function ls(e){this.id=e,this.vertexFormat=void 0,this.polygonHierarchy=void 0,this.perPositionHeight=void 0,this.closeTop=void 0,this.closeBottom=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.offsetAttribute=void 0,this.arcType=void 0}function us(e,t){ra.call(this,{entity:e,scene:t,geometryOptions:new ls(e),geometryPropertyName:"polygon",observedPropertyNames:["availability","polygon"]}),this._onEntityPropertyChanged(e,"polygon",e.polygon,void 0)}function ds(e,t,i){be.call(this,e,t,i)}Object(s.default)(Object.create)&&(us.prototype=Object.create(ra.prototype),us.prototype.constructor=us),us.prototype.createFillGeometryInstance=function(e){var t,i,a=this._entity,r=a.isAvailable(e),n=this._options,o={show:new me.a(r&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:ue.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof pe.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(t=this._materialProperty.color.getValue(e,is)),Object(s.default)(t)||(t=y.default.WHITE),o.color=oe.a.fromColor(t));return Object(s.default)(n.offsetAttribute)&&(o.offset=he.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,as,rs))),i=n.perPositionHeight&&!Object(s.default)(n.extrudedHeight)?new oo(n):new Xo(n),new de.a({id:a,geometry:i,attributes:o})},us.prototype.createOutlineGeometryInstance=function(e){var t,i=this._entity,a=i.isAvailable(e),r=this._options,n=P.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,is),o=this._distanceDisplayConditionProperty.getValue(e),l={show:new me.a(a&&i.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(n),distanceDisplayCondition:ue.fromDistanceDisplayCondition(o),offset:void 0};return Object(s.default)(r.offsetAttribute)&&(l.offset=he.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,as,rs))),t=r.perPositionHeight&&!Object(s.default)(r.extrudedHeight)?new fo(r):new ts(r),new de.a({id:i,geometry:t,attributes:l})},us.prototype._computeCenter=function(e,t){var i=P.default.getValueOrUndefined(this._entity.polygon.hierarchy,e);if(Object(s.default)(i)){var a=i.positions;if(0!==a.length){for(var r=this._scene.mapProjection.ellipsoid,n=at.default.fromPoints(a,r),o=n.projectPointsOntoPlane(a,os),l=o.length,u=0,d=l-1,f=new g.default,c=0;c<l;d=c++){var h=o[c],m=o[d],p=h.x*m.y-m.x*h.y,_=g.default.add(h,m,ss);_=g.default.multiplyByScalar(_,p,_),f=g.default.add(f,_,f),u+=p}var v=1/(3*u);return f=g.default.multiplyByScalar(f,v,f),n.projectPointOntoEllipsoid(f,t)}}},us.prototype._isHidden=function(e,t){return!Object(s.default)(t.hierarchy)||Fe.prototype._isHidden.call(this,e,t)},us.prototype._isOnTerrain=function(e,t){var i=ra.prototype._isOnTerrain.call(this,e,t),a=t.perPositionHeight,r=Object(s.default)(a)&&(!a.isConstant||a.getValue(ce.default.MINIMUM_VALUE));return i&&!r},us.prototype._isDynamic=function(e,t){return!t.hierarchy.isConstant||!P.default.isConstant(t.height)||!P.default.isConstant(t.extrudedHeight)||!P.default.isConstant(t.granularity)||!P.default.isConstant(t.stRotation)||!P.default.isConstant(t.outlineWidth)||!P.default.isConstant(t.perPositionHeight)||!P.default.isConstant(t.closeTop)||!P.default.isConstant(t.closeBottom)||!P.default.isConstant(t.zIndex)||!P.default.isConstant(t.arcType)||this._onTerrain&&!P.default.isConstant(this._materialProperty)&&!(this._materialProperty instanceof pe.default)},us.prototype._setStaticOptions=function(e,t){var i=this._materialProperty instanceof pe.default,r=this._options;r.vertexFormat=i?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat;var n,o=t.hierarchy.getValue(ce.default.MINIMUM_VALUE),l=P.default.getValueOrUndefined(t.height,ce.default.MINIMUM_VALUE),u=P.default.getValueOrDefault(t.heightReference,ce.default.MINIMUM_VALUE,O.default.NONE),d=P.default.getValueOrUndefined(t.extrudedHeight,ce.default.MINIMUM_VALUE),f=P.default.getValueOrDefault(t.extrudedHeightReference,ce.default.MINIMUM_VALUE,O.default.NONE),c=P.default.getValueOrDefault(t.perPositionHeight,ce.default.MINIMUM_VALUE,!1);l=ra.getGeometryHeight(l,u),c?(Object(s.default)(l)&&(l=void 0,Object(we.a)("Entity polygons cannot have both height and perPositionHeight.  height will be ignored")),u!==O.default.NONE&&c&&(l=void 0,Object(we.a)("heightReference is not supported for entity polygons with perPositionHeight. heightReference will be ignored"))):(Object(s.default)(d)&&!Object(s.default)(l)&&(l=0),n=ra.computeGeometryOffsetAttribute(l,u,d,f)),r.polygonHierarchy=o,r.granularity=P.default.getValueOrUndefined(t.granularity,ce.default.MINIMUM_VALUE),r.stRotation=P.default.getValueOrUndefined(t.stRotation,ce.default.MINIMUM_VALUE),r.perPositionHeight=c,r.closeTop=P.default.getValueOrDefault(t.closeTop,ce.default.MINIMUM_VALUE,!0),r.closeBottom=P.default.getValueOrDefault(t.closeBottom,ce.default.MINIMUM_VALUE,!0),r.offsetAttribute=n,r.height=l,r.arcType=P.default.getValueOrDefault(t.arcType,ce.default.MINIMUM_VALUE,Dn.a.GEODESIC),(d=ra.getGeometryExtrudedHeight(d,f))===ra.CLAMP_TO_GROUND&&(d=a.a.getMinimumMaximumHeights(Xo.computeRectangle(r,ns)).minimumTerrainHeight),r.extrudedHeight=d},us.prototype._getIsClosed=function(e){var t=e.height,i=e.extrudedHeight,a=Object(s.default)(i)&&i!==t;return!e.perPositionHeight&&(!a&&0===t||a&&e.closeTop&&e.closeBottom)},us.DynamicGeometryUpdater=ds,Object(s.default)(Object.create)&&(ds.prototype=Object.create(be.prototype),ds.prototype.constructor=ds),ds.prototype._isHidden=function(e,t,i){return!Object(s.default)(this._options.polygonHierarchy)||be.prototype._isHidden.call(this,e,t,i)},ds.prototype._setOptions=function(e,t,i){var r=this._options;r.polygonHierarchy=P.default.getValueOrUndefined(t.hierarchy,i);var n,o=P.default.getValueOrUndefined(t.height,i),l=P.default.getValueOrDefault(t.heightReference,i,O.default.NONE),u=P.default.getValueOrDefault(t.extrudedHeightReference,i,O.default.NONE),d=P.default.getValueOrUndefined(t.extrudedHeight,i),f=P.default.getValueOrUndefined(t.perPositionHeight,i);o=ra.getGeometryHeight(o,u),f?(Object(s.default)(o)&&(o=void 0,Object(we.a)("Entity polygons cannot have both height and perPositionHeight.  height will be ignored")),l!==O.default.NONE&&f&&(o=void 0,Object(we.a)("heightReference is not supported for entity polygons with perPositionHeight. heightReference will be ignored"))):(Object(s.default)(d)&&!Object(s.default)(o)&&(o=0),n=ra.computeGeometryOffsetAttribute(o,l,d,u)),r.granularity=P.default.getValueOrUndefined(t.granularity,i),r.stRotation=P.default.getValueOrUndefined(t.stRotation,i),r.perPositionHeight=P.default.getValueOrUndefined(t.perPositionHeight,i),r.closeTop=P.default.getValueOrDefault(t.closeTop,i,!0),r.closeBottom=P.default.getValueOrDefault(t.closeBottom,i,!0),r.offsetAttribute=n,r.height=o,r.arcType=P.default.getValueOrDefault(t.arcType,i,Dn.a.GEODESIC),(d=ra.getGeometryExtrudedHeight(d,u))===ra.CLAMP_TO_GROUND&&(d=a.a.getMinimumMaximumHeights(Xo.computeRectangle(r,ns)).minimumTerrainHeight),r.extrudedHeight=d};var fs=us;function cs(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polylinePositions,i=e.shapePositions;this._positions=t,this._shape=i,this._ellipsoid=hi.default.clone(Object(o.default)(e.ellipsoid,hi.default.WGS84)),this._cornerType=Object(o.default)(e.cornerType,$e.a.ROUNDED),this._vertexFormat=K.default.clone(Object(o.default)(e.vertexFormat,K.default.DEFAULT)),this._granularity=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeGeometry";var a=1+t.length*v.default.packedLength;a+=1+i.length*g.default.packedLength,this.packedLength=a+hi.default.packedLength+K.default.packedLength+2}cs.pack=function(e,t,i){var a;i=Object(o.default)(i,0);var r=e._positions,n=r.length;for(t[i++]=n,a=0;a<n;++a,i+=v.default.packedLength)v.default.pack(r[a],t,i);var s=e._shape;for(n=s.length,t[i++]=n,a=0;a<n;++a,i+=g.default.packedLength)g.default.pack(s[a],t,i);return hi.default.pack(e._ellipsoid,t,i),i+=hi.default.packedLength,K.default.pack(e._vertexFormat,t,i),i+=K.default.packedLength,t[i++]=e._cornerType,t[i]=e._granularity,t};var hs=hi.default.clone(hi.default.UNIT_SPHERE),ms=new K.default,ps={polylinePositions:void 0,shapePositions:void 0,ellipsoid:hs,vertexFormat:ms,cornerType:void 0,granularity:void 0};cs.unpack=function(e,t,i){var a;t=Object(o.default)(t,0);var r=e[t++],n=new Array(r);for(a=0;a<r;++a,t+=v.default.packedLength)n[a]=v.default.unpack(e,t);r=e[t++];var l=new Array(r);for(a=0;a<r;++a,t+=g.default.packedLength)l[a]=g.default.unpack(e,t);var u=hi.default.unpack(e,t,hs);t+=hi.default.packedLength;var d=K.default.unpack(e,t,ms);t+=K.default.packedLength;var f=e[t++],c=e[t];return Object(s.default)(i)?(i._positions=n,i._shape=l,i._ellipsoid=hi.default.clone(u,i._ellipsoid),i._vertexFormat=K.default.clone(d,i._vertexFormat),i._cornerType=f,i._granularity=c,i):(ps.polylinePositions=n,ps.shapePositions=l,ps.cornerType=f,ps.granularity=c,new cs(ps))};var _s=new _.default;cs.createGeometry=function(e){var t=e._positions,i=Object(Je.a)(t,v.default.equalsEpsilon),a=e._shape;if(a=Ht.removeDuplicatesFromShape(a),!(i.length<2||a.length<3)){vi.a.computeWindingOrder2D(a)===ho.default.CLOCKWISE&&a.reverse();var n=_.default.fromPoints(a,_s);return function(e,t,i,a){var n=new _i.a;a.position&&(n.position=new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:e}));var o,s,l,u,d,f,c=t.length,h=e.length/3,m=(h-2*c)/(2*c),p=vi.a.triangulate(t),_=(m-1)*c*6+2*p.length,g=gi.a.createTypedArray(h,_),v=2*c,y=0;for(o=0;o<m-1;o++){for(s=0;s<c-1;s++)f=(l=2*s+o*c*2)+v,d=(u=l+1)+v,g[y++]=u,g[y++]=l,g[y++]=d,g[y++]=d,g[y++]=l,g[y++]=f;d=(u=(l=2*c-2+o*c*2)+1)+v,f=l+v,g[y++]=u,g[y++]=l,g[y++]=d,g[y++]=d,g[y++]=l,g[y++]=f}if(a.st||a.tangent||a.bitangent){var b,w,x=new Float32Array(2*h),O=1/(m-1),C=1/i.height,T=i.height/2,E=0;for(o=0;o<m;o++){for(b=o*O,w=C*(t[0].y+T),x[E++]=b,x[E++]=w,s=1;s<c;s++)w=C*(t[s].y+T),x[E++]=b,x[E++]=w,x[E++]=b,x[E++]=w;w=C*(t[0].y+T),x[E++]=b,x[E++]=w}for(s=0;s<c;s++)b=0,w=C*(t[s].y+T),x[E++]=b,x[E++]=w;for(s=0;s<c;s++)b=(m-1)*O,w=C*(t[s].y+T),x[E++]=b,x[E++]=w;n.st=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:new Float32Array(x)})}var P=h-2*c;for(o=0;o<p.length;o+=3){var A=p[o]+P,S=p[o+1]+P,D=p[o+2]+P;g[y++]=A,g[y++]=S,g[y++]=D,g[y++]=D+c,g[y++]=S+c,g[y++]=A+c}var I=new mi.a({attributes:n,indices:g,boundingSphere:r.default.fromVertices(e),primitiveType:yi.a.TRIANGLES});if(a.normal&&(I=er.a.computeNormal(I)),a.tangent||a.bitangent){try{I=er.a.computeTangentAndBitangent(I)}catch(e){Object(we.a)("polyline-volume-tangent-bitangent","Unable to compute tangents and bitangents for polyline volume geometry")}a.tangent||(I.attributes.tangent=void 0),a.bitangent||(I.attributes.bitangent=void 0),a.st||(I.attributes.st=void 0)}return I}(Ht.computePositions(i,a,n,e,!0),a,n,e._vertexFormat)}};var gs=cs;function vs(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polylinePositions,i=e.shapePositions;this._positions=t,this._shape=i,this._ellipsoid=hi.default.clone(Object(o.default)(e.ellipsoid,hi.default.WGS84)),this._cornerType=Object(o.default)(e.cornerType,$e.a.ROUNDED),this._granularity=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeOutlineGeometry";var a=1+t.length*v.default.packedLength;a+=1+i.length*g.default.packedLength,this.packedLength=a+hi.default.packedLength+2}vs.pack=function(e,t,i){var a;i=Object(o.default)(i,0);var r=e._positions,n=r.length;for(t[i++]=n,a=0;a<n;++a,i+=v.default.packedLength)v.default.pack(r[a],t,i);var s=e._shape;for(n=s.length,t[i++]=n,a=0;a<n;++a,i+=g.default.packedLength)g.default.pack(s[a],t,i);return hi.default.pack(e._ellipsoid,t,i),i+=hi.default.packedLength,t[i++]=e._cornerType,t[i]=e._granularity,t};var ys=hi.default.clone(hi.default.UNIT_SPHERE),bs={polylinePositions:void 0,shapePositions:void 0,ellipsoid:ys,height:void 0,cornerType:void 0,granularity:void 0};vs.unpack=function(e,t,i){var a;t=Object(o.default)(t,0);var r=e[t++],n=new Array(r);for(a=0;a<r;++a,t+=v.default.packedLength)n[a]=v.default.unpack(e,t);r=e[t++];var l=new Array(r);for(a=0;a<r;++a,t+=g.default.packedLength)l[a]=g.default.unpack(e,t);var u=hi.default.unpack(e,t,ys);t+=hi.default.packedLength;var d=e[t++],f=e[t];return Object(s.default)(i)?(i._positions=n,i._shape=l,i._ellipsoid=hi.default.clone(u,i._ellipsoid),i._cornerType=d,i._granularity=f,i):(bs.polylinePositions=n,bs.shapePositions=l,bs.cornerType=d,bs.granularity=f,new vs(bs))};var ws=new _.default;vs.createGeometry=function(e){var t=e._positions,i=Object(Je.a)(t,v.default.equalsEpsilon),a=e._shape;if(a=Ht.removeDuplicatesFromShape(a),!(i.length<2||a.length<3)){vi.a.computeWindingOrder2D(a)===ho.default.CLOCKWISE&&a.reverse();var n=_.default.fromPoints(a,ws);return function(e,t){var i=new _i.a;i.position=new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:e});var a,n,o=t.length,s=i.position.values.length/3,l=e.length/3/o,u=gi.a.createTypedArray(s,2*o*(l+1)),d=0,f=(a=0)*o;for(n=0;n<o-1;n++)u[d++]=n+f,u[d++]=n+f+1;for(u[d++]=o-1+f,u[d++]=f,f=(a=l-1)*o,n=0;n<o-1;n++)u[d++]=n+f,u[d++]=n+f+1;for(u[d++]=o-1+f,u[d++]=f,a=0;a<l-1;a++){var c=o*a,h=c+o;for(n=0;n<o;n++)u[d++]=n+c,u[d++]=n+h}return new mi.a({attributes:i,indices:gi.a.createTypedArray(s,u),boundingSphere:r.default.fromVertices(e),primitiveType:yi.a.LINES})}(Ht.computePositions(i,a,n,e,!1),a)}};var xs=vs,Os=new y.default;function Cs(e){this.id=e,this.vertexFormat=void 0,this.polylinePositions=void 0,this.shapePositions=void 0,this.cornerType=void 0,this.granularity=void 0}function Ts(e,t){Fe.call(this,{entity:e,scene:t,geometryOptions:new Cs(e),geometryPropertyName:"polylineVolume",observedPropertyNames:["availability","polylineVolume"]}),this._onEntityPropertyChanged(e,"polylineVolume",e.polylineVolume,void 0)}function Es(e,t,i){be.call(this,e,t,i)}Object(s.default)(Object.create)&&(Ts.prototype=Object.create(Fe.prototype),Ts.prototype.constructor=Ts),Ts.prototype.createFillGeometryInstance=function(e){var t,i,a=this._entity,r=a.isAvailable(e),n=new me.a(r&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),l=ue.fromDistanceDisplayCondition(o);this._materialProperty instanceof pe.default?(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(i=this._materialProperty.color.getValue(e,Os)),Object(s.default)(i)||(i=y.default.WHITE),t={show:n,distanceDisplayCondition:l,color:oe.a.fromColor(i)}):t={show:n,distanceDisplayCondition:l};return new de.a({id:a,geometry:new gs(this._options),attributes:t})},Ts.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,i=t.isAvailable(e),a=P.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,Os),r=this._distanceDisplayConditionProperty.getValue(e);return new de.a({id:t,geometry:new xs(this._options),attributes:{show:new me.a(i&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(a),distanceDisplayCondition:ue.fromDistanceDisplayCondition(r)}})},Ts.prototype._isHidden=function(e,t){return!Object(s.default)(t.positions)||!Object(s.default)(t.shape)||Fe.prototype._isHidden.call(this,e,t)},Ts.prototype._isDynamic=function(e,t){return!(t.positions.isConstant&&t.shape.isConstant&&P.default.isConstant(t.granularity)&&P.default.isConstant(t.outlineWidth)&&P.default.isConstant(t.cornerType))},Ts.prototype._setStaticOptions=function(e,t){var i=t.granularity,a=t.cornerType,r=this._options,n=this._materialProperty instanceof pe.default;r.vertexFormat=n?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,r.polylinePositions=t.positions.getValue(ce.default.MINIMUM_VALUE,r.polylinePositions),r.shapePositions=t.shape.getValue(ce.default.MINIMUM_VALUE,r.shape),r.granularity=Object(s.default)(i)?i.getValue(ce.default.MINIMUM_VALUE):void 0,r.cornerType=Object(s.default)(a)?a.getValue(ce.default.MINIMUM_VALUE):void 0},Ts.DynamicGeometryUpdater=Es,Object(s.default)(Object.create)&&(Es.prototype=Object.create(be.prototype),Es.prototype.constructor=Es),Es.prototype._isHidden=function(e,t,i){var a=this._options;return!Object(s.default)(a.polylinePositions)||!Object(s.default)(a.shapePositions)||be.prototype._isHidden.call(this,e,t,i)},Es.prototype._setOptions=function(e,t,i){var a=this._options;a.polylinePositions=P.default.getValueOrUndefined(t.positions,i,a.polylinePositions),a.shapePositions=P.default.getValueOrUndefined(t.shape,i),a.granularity=P.default.getValueOrUndefined(t.granularity,i),a.cornerType=P.default.getValueOrUndefined(t.cornerType,i)};var Ps=Ts,As=i(182),Ss=i(656),Ds=new v.default,Is=new v.default,Ms=new v.default,Fs=new v.default,Rs=new bi.default,Ns=new g.default,Ls=new r.default,js=new r.default;function Vs(e,t){var i=new mi.a({attributes:new _i.a,primitiveType:yi.a.TRIANGLES});return i.attributes.position=new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:t.positions}),e.normal&&(i.attributes.normal=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:t.normals})),e.tangent&&(i.attributes.tangent=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:t.tangents})),e.bitangent&&(i.attributes.bitangent=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:t.bitangents})),i}var Us=new v.default,zs=new v.default;function Bs(e,t){var i=e._vertexFormat,a=e._ellipsoid,r=t.height,n=t.width,o=t.northCap,s=t.southCap,l=0,u=r,d=r,f=0;o&&(l=1,d-=1,f+=1),s&&(u-=1,d-=1,f+=1),f+=n*d;for(var c=i.position?new Float64Array(3*f):void 0,h=i.st?new Float32Array(2*f):void 0,m=0,p=0,_=Ds,g=Ns,y=Number.MAX_VALUE,b=Number.MAX_VALUE,w=-Number.MAX_VALUE,x=-Number.MAX_VALUE,O=l;O<u;++O)for(var C=0;C<n;++C)Ss.a.computePosition(t,a,i.st,O,C,_,g),c[m++]=_.x,c[m++]=_.y,c[m++]=_.z,i.st&&(h[p++]=g.x,h[p++]=g.y,y=Math.min(y,g.x),b=Math.min(b,g.y),w=Math.max(w,g.x),x=Math.max(x,g.y));if(o&&(Ss.a.computePosition(t,a,i.st,0,0,_,g),c[m++]=_.x,c[m++]=_.y,c[m++]=_.z,i.st&&(h[p++]=g.x,h[p++]=g.y,y=g.x,b=g.y,w=g.x,x=g.y)),s&&(Ss.a.computePosition(t,a,i.st,r-1,0,_,g),c[m++]=_.x,c[m++]=_.y,c[m]=_.z,i.st&&(h[p++]=g.x,h[p]=g.y,y=Math.min(y,g.x),b=Math.min(b,g.y),w=Math.max(w,g.x),x=Math.max(x,g.y))),i.st&&(y<0||b<0||w>1||x>1))for(var T=0;T<h.length;T+=2)h[T]=(h[T]-y)/(w-y),h[T+1]=(h[T+1]-b)/(x-b);var E=function(e,t,i,a){var r=e.length,n=t.normal?new Float32Array(r):void 0,o=t.tangent?new Float32Array(r):void 0,s=t.bitangent?new Float32Array(r):void 0,l=0,u=Fs,d=Ms,f=Is;if(t.normal||t.tangent||t.bitangent)for(var c=0;c<r;c+=3){var h=v.default.fromArray(e,c,Ds),m=l+1,p=l+2;f=i.geodeticSurfaceNormal(h,f),(t.tangent||t.bitangent)&&(v.default.cross(v.default.UNIT_Z,f,d),et.default.multiplyByVector(a,d,d),v.default.normalize(d,d),t.bitangent&&v.default.normalize(v.default.cross(f,d,u),u)),t.normal&&(n[l]=f.x,n[m]=f.y,n[p]=f.z),t.tangent&&(o[l]=d.x,o[m]=d.y,o[p]=d.z),t.bitangent&&(s[l]=u.x,s[m]=u.y,s[p]=u.z),l+=3}return Vs(t,{positions:e,normals:n,tangents:o,bitangents:s})}(c,i,a,t.tangentRotationMatrix),P=6*(n-1)*(d-1);o&&(P+=3*(n-1)),s&&(P+=3*(n-1));var A,S=gi.a.createTypedArray(f,P),D=0,I=0;for(A=0;A<d-1;++A){for(var M=0;M<n-1;++M){var F=D,R=F+n,N=R+1,L=F+1;S[I++]=F,S[I++]=R,S[I++]=L,S[I++]=L,S[I++]=R,S[I++]=N,++D}++D}if(o||s){var j,V,U=f-1,z=f-1;if(o&&s&&(U=f-2),D=0,o)for(A=0;A<n-1;A++)V=(j=D)+1,S[I++]=U,S[I++]=j,S[I++]=V,++D;if(s)for(D=(d-1)*n,A=0;A<n-1;A++)V=(j=D)+1,S[I++]=j,S[I++]=z,S[I++]=V,++D}return E.indices=S,i.st&&(E.attributes.st=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:h})),E}function Hs(e,t,i,a,r){return e[t++]=a[i],e[t++]=a[i+1],e[t++]=a[i+2],e[t++]=r[i],e[t++]=r[i+1],e[t]=r[i+2],e}function ks(e,t,i,a){return e[t++]=a[i],e[t++]=a[i+1],e[t++]=a[i],e[t]=a[i+1],e}var Ws=new K.default;function Gs(e,t){var i,a=e._shadowVolume,r=e._offsetAttribute,n=e._vertexFormat,o=e._extrudedHeight,l=e._surfaceHeight,u=e._ellipsoid,d=t.height,f=t.width;if(a){var c=K.default.clone(n,Ws);c.normal=!0,e._vertexFormat=c}var h=Bs(e,t);a&&(e._vertexFormat=n);var m=vi.a.scaleToGeodeticHeight(h.attributes.position.values,l,u,!1),p=(m=new Float64Array(m)).length,_=2*p,g=new Float64Array(_);g.set(m);var y=vi.a.scaleToGeodeticHeight(h.attributes.position.values,o,u);g.set(y,p),h.attributes.position.values=g;var b,w,x,O=n.normal?new Float32Array(_):void 0,C=n.tangent?new Float32Array(_):void 0,T=n.bitangent?new Float32Array(_):void 0,E=n.st?new Float32Array(_/3*2):void 0;if(n.normal){for(w=h.attributes.normal.values,O.set(w),i=0;i<p;i++)w[i]=-w[i];O.set(w,p),h.attributes.normal.values=O}if(a){w=h.attributes.normal.values,n.normal||(h.attributes.normal=void 0);var P=new Float32Array(_);for(i=0;i<p;i++)w[i]=-w[i];P.set(w,p),h.attributes.extrudeDirection=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:P})}var A=Object(s.default)(r);if(A){var S=p/3*2,D=new Uint8Array(S);r===fe.a.TOP?D=Object(Ke.a)(D,1,0,S/2):(x=r===fe.a.NONE?0:1,D=Object(Ke.a)(D,x)),h.attributes.applyOffset=new pi.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:D})}if(n.tangent){var I=h.attributes.tangent.values;for(C.set(I),i=0;i<p;i++)I[i]=-I[i];C.set(I,p),h.attributes.tangent.values=C}if(n.bitangent){var M=h.attributes.bitangent.values;T.set(M),T.set(M,p),h.attributes.bitangent.values=T}n.st&&(b=h.attributes.st.values,E.set(b),E.set(b,p/3*2),h.attributes.st.values=E);var F=h.indices,R=F.length,N=p/3,L=gi.a.createTypedArray(_/3,2*R);for(L.set(F),i=0;i<R;i+=3)L[i+R]=F[i+2]+N,L[i+1+R]=F[i+1]+N,L[i+2+R]=F[i]+N;h.indices=L;var j=t.northCap,V=t.southCap,U=d,z=2,B=0,H=4,k=4;j&&(z-=1,U-=1,B+=1,H-=2,k-=1),V&&(z-=1,U-=1,B+=1,H-=2,k-=1);var W=2*((B+=z*f+2*U-H)+k),G=new Float64Array(3*W),Y=a?new Float32Array(3*W):void 0,X=A?new Uint8Array(W):void 0,Q=n.st?new Float32Array(2*W):void 0,q=r===fe.a.TOP;A&&!q&&(x=r===fe.a.ALL?1:0,X=Object(Ke.a)(X,x));var Z,J=0,$=0,ee=0,te=0,ie=f*U;for(i=0;i<ie;i+=f)G=Hs(G,J,Z=3*i,m,y),J+=6,n.st&&(Q=ks(Q,$,2*i,b),$+=4),a&&(ee+=3,Y[ee++]=w[Z],Y[ee++]=w[Z+1],Y[ee++]=w[Z+2]),q&&(X[te++]=1,te+=1);if(V){var ae=j?ie+1:ie;for(Z=3*ae,i=0;i<2;i++)G=Hs(G,J,Z,m,y),J+=6,n.st&&(Q=ks(Q,$,2*ae,b),$+=4),a&&(ee+=3,Y[ee++]=w[Z],Y[ee++]=w[Z+1],Y[ee++]=w[Z+2]),q&&(X[te++]=1,te+=1)}else for(i=ie-f;i<ie;i++)G=Hs(G,J,Z=3*i,m,y),J+=6,n.st&&(Q=ks(Q,$,2*i,b),$+=4),a&&(ee+=3,Y[ee++]=w[Z],Y[ee++]=w[Z+1],Y[ee++]=w[Z+2]),q&&(X[te++]=1,te+=1);for(i=ie-1;i>0;i-=f)G=Hs(G,J,Z=3*i,m,y),J+=6,n.st&&(Q=ks(Q,$,2*i,b),$+=4),a&&(ee+=3,Y[ee++]=w[Z],Y[ee++]=w[Z+1],Y[ee++]=w[Z+2]),q&&(X[te++]=1,te+=1);if(j){var re=ie;for(Z=3*re,i=0;i<2;i++)G=Hs(G,J,Z,m,y),J+=6,n.st&&(Q=ks(Q,$,2*re,b),$+=4),a&&(ee+=3,Y[ee++]=w[Z],Y[ee++]=w[Z+1],Y[ee++]=w[Z+2]),q&&(X[te++]=1,te+=1)}else for(i=f-1;i>=0;i--)G=Hs(G,J,Z=3*i,m,y),J+=6,n.st&&(Q=ks(Q,$,2*i,b),$+=4),a&&(ee+=3,Y[ee++]=w[Z],Y[ee++]=w[Z+1],Y[ee++]=w[Z+2]),q&&(X[te++]=1,te+=1);var ne=function(e,t,i){var a=e.length,r=t.normal?new Float32Array(a):void 0,n=t.tangent?new Float32Array(a):void 0,o=t.bitangent?new Float32Array(a):void 0,s=0,l=0,u=0,d=!0,f=Fs,c=Ms,h=Is;if(t.normal||t.tangent||t.bitangent)for(var m=0;m<a;m+=6){var p=v.default.fromArray(e,m,Ds),_=v.default.fromArray(e,(m+6)%a,Us);if(d){var g=v.default.fromArray(e,(m+3)%a,zs);v.default.subtract(_,p,_),v.default.subtract(g,p,g),h=v.default.normalize(v.default.cross(g,_,h),h),d=!1}v.default.equalsEpsilon(_,p,Le.default.EPSILON10)&&(d=!0),(t.tangent||t.bitangent)&&(f=i.geodeticSurfaceNormal(p,f),t.tangent&&(c=v.default.normalize(v.default.cross(f,h,c),c))),t.normal&&(r[s++]=h.x,r[s++]=h.y,r[s++]=h.z,r[s++]=h.x,r[s++]=h.y,r[s++]=h.z),t.tangent&&(n[l++]=c.x,n[l++]=c.y,n[l++]=c.z,n[l++]=c.x,n[l++]=c.y,n[l++]=c.z),t.bitangent&&(o[u++]=f.x,o[u++]=f.y,o[u++]=f.z,o[u++]=f.x,o[u++]=f.y,o[u++]=f.z)}return Vs(t,{positions:e,normals:r,tangents:n,bitangents:o})}(G,n,u);n.st&&(ne.attributes.st=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:Q})),a&&(ne.attributes.extrudeDirection=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:Y})),A&&(ne.attributes.applyOffset=new pi.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:X}));var oe,le,ue,ce,he=gi.a.createTypedArray(W,6*B);p=G.length/3;var me=0;for(i=0;i<p-1;i+=2){ce=((oe=i)+2)%p;var pe=v.default.fromArray(G,3*oe,Us),_e=v.default.fromArray(G,3*ce,zs);v.default.equalsEpsilon(pe,_e,Le.default.EPSILON10)||(ue=((le=(oe+1)%p)+2)%p,he[me++]=oe,he[me++]=le,he[me++]=ce,he[me++]=ce,he[me++]=le,he[me++]=ue)}return ne.indices=he,(ne=er.a.combineInstances([new de.a({geometry:h}),new de.a({geometry:ne})]))[0]}var Ys=[new v.default,new v.default,new v.default,new v.default],Xs=new Ne.default,Qs=new Ne.default;function qs(e,t,i,a,r){if(0===i)return bi.default.clone(e,r);var n=Ss.a.computeOptions(e,t,i,0,Rs,Xs),o=n.height,s=n.width,l=Ys;return Ss.a.computePosition(n,a,!1,0,0,l[0]),Ss.a.computePosition(n,a,!1,0,s-1,l[1]),Ss.a.computePosition(n,a,!1,o-1,0,l[2]),Ss.a.computePosition(n,a,!1,o-1,s-1,l[3]),bi.default.fromCartesianArray(l,a,r)}function Zs(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).rectangle,i=Object(o.default)(e.height,0),a=Object(o.default)(e.extrudedHeight,i);this._rectangle=bi.default.clone(t),this._granularity=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),this._ellipsoid=hi.default.clone(Object(o.default)(e.ellipsoid,hi.default.WGS84)),this._surfaceHeight=Math.max(i,a),this._rotation=Object(o.default)(e.rotation,0),this._stRotation=Object(o.default)(e.stRotation,0),this._vertexFormat=K.default.clone(Object(o.default)(e.vertexFormat,K.default.DEFAULT)),this._extrudedHeight=Math.min(i,a),this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=e.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}Zs.packedLength=bi.default.packedLength+hi.default.packedLength+K.default.packedLength+7,Zs.pack=function(e,t,i){return i=Object(o.default)(i,0),bi.default.pack(e._rectangle,t,i),i+=bi.default.packedLength,hi.default.pack(e._ellipsoid,t,i),i+=hi.default.packedLength,K.default.pack(e._vertexFormat,t,i),i+=K.default.packedLength,t[i++]=e._granularity,t[i++]=e._surfaceHeight,t[i++]=e._rotation,t[i++]=e._stRotation,t[i++]=e._extrudedHeight,t[i++]=e._shadowVolume?1:0,t[i]=Object(o.default)(e._offsetAttribute,-1),t};var Ks=new bi.default,Js=hi.default.clone(hi.default.UNIT_SPHERE),$s={rectangle:Ks,ellipsoid:Js,vertexFormat:Ws,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};Zs.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=bi.default.unpack(e,t,Ks);t+=bi.default.packedLength;var r=hi.default.unpack(e,t,Js);t+=hi.default.packedLength;var n=K.default.unpack(e,t,Ws);t+=K.default.packedLength;var l=e[t++],u=e[t++],d=e[t++],f=e[t++],c=e[t++],h=1===e[t++],m=e[t];return Object(s.default)(i)?(i._rectangle=bi.default.clone(a,i._rectangle),i._ellipsoid=hi.default.clone(r,i._ellipsoid),i._vertexFormat=K.default.clone(n,i._vertexFormat),i._granularity=l,i._surfaceHeight=u,i._rotation=d,i._stRotation=f,i._extrudedHeight=c,i._shadowVolume=h,i._offsetAttribute=-1===m?void 0:m,i):($s.granularity=l,$s.height=u,$s.rotation=d,$s.stRotation=f,$s.extrudedHeight=c,$s.shadowVolume=h,$s.offsetAttribute=-1===m?void 0:m,new Zs($s))},Zs.computeRectangle=function(e,t){var i=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).rectangle,a=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),r=Object(o.default)(e.ellipsoid,hi.default.WGS84);return qs(i,a,Object(o.default)(e.rotation,0),r,t)};var el=new et.default,tl=new nt.default,il=new Ne.default;Zs.createGeometry=function(e){if(!Le.default.equalsEpsilon(e._rectangle.north,e._rectangle.south,Le.default.EPSILON10)&&!Le.default.equalsEpsilon(e._rectangle.east,e._rectangle.west,Le.default.EPSILON10)){var t=e._rectangle,i=e._ellipsoid,a=e._rotation,n=e._stRotation,o=e._vertexFormat,l=Ss.a.computeOptions(t,e._granularity,a,n,Rs,Xs,Qs),u=el;if(0!==n||0!==a){var d=bi.default.center(t,il),f=i.geodeticSurfaceNormalCartographic(d,Us);nt.default.fromAxisAngle(f,-n,tl),et.default.fromQuaternion(tl,u)}else et.default.clone(et.default.IDENTITY,u);var c,h,m=e._surfaceHeight,p=e._extrudedHeight,_=!Le.default.equalsEpsilon(m,p,0,Le.default.EPSILON2);if(l.lonScalar=1/e._rectangle.width,l.latScalar=1/e._rectangle.height,l.tangentRotationMatrix=u,t=e._rectangle,_){c=Gs(e,l);var g=r.default.fromRectangle3D(t,i,m,js),v=r.default.fromRectangle3D(t,i,p,Ls);h=r.default.union(g,v)}else{if((c=Bs(e,l)).attributes.position.values=vi.a.scaleToGeodeticHeight(c.attributes.position.values,m,i,!1),Object(s.default)(e._offsetAttribute)){var y=c.attributes.position.values.length,b=new Uint8Array(y/3),w=e._offsetAttribute===fe.a.NONE?0:1;Object(Ke.a)(b,w),c.attributes.applyOffset=new pi.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})}h=r.default.fromRectangle3D(t,i,m)}return o.position||delete c.attributes.position,new mi.a({attributes:c.attributes,indices:c.indices,primitiveType:c.primitiveType,boundingSphere:h,offsetAttribute:e._offsetAttribute})}},Zs.createShadowVolume=function(e,t,i){var a=e._granularity,r=e._ellipsoid,n=t(a,r),o=i(a,r);return new Zs({rectangle:e._rectangle,rotation:e._rotation,ellipsoid:r,stRotation:e._stRotation,granularity:a,extrudedHeight:o,height:n,vertexFormat:K.default.POSITION_ONLY,shadowVolume:!0})};var al=new bi.default,rl=[new g.default,new g.default,new g.default],nl=new As.a,ol=new Ne.default;Object.defineProperties(Zs.prototype,{rectangle:{get:function(){return Object(s.default)(this._rotatedRectangle)||(this._rotatedRectangle=qs(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return Object(s.default)(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){if(0===e._stRotation)return[0,0,0,1,1,0];var t=bi.default.clone(e._rectangle,al),i=e._granularity,a=e._ellipsoid,r=qs(t,i,e._rotation-e._stRotation,a,al),n=rl;n[0].x=r.west,n[0].y=r.south,n[1].x=r.west,n[1].y=r.north,n[2].x=r.east,n[2].y=r.south;for(var o=e.rectangle,s=As.a.fromRotation(e._stRotation,nl),l=bi.default.center(o,ol),u=0;u<3;++u){var d=n[u];d.x-=l.longitude,d.y-=l.latitude,As.a.multiplyByVector(s,d,d),d.x+=l.longitude,d.y+=l.latitude,d.x=(d.x-o.west)/o.width,d.y=(d.y-o.south)/o.height}var f=n[0],c=n[1],h=n[2],m=new Array(6);return g.default.pack(f,m),g.default.pack(c,m,2),g.default.pack(h,m,4),m}(this)),this._textureCoordinateRotationPoints}}});var sl=Zs,ll=i(655),ul=new y.default,dl=v.default.ZERO,fl=new v.default,cl=new bi.default,hl=new bi.default,ml=new Ne.default;function pl(e){this.id=e,this.vertexFormat=void 0,this.rectangle=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.rotation=void 0,this.offsetAttribute=void 0}function _l(e,t){ra.call(this,{entity:e,scene:t,geometryOptions:new pl(e),geometryPropertyName:"rectangle",observedPropertyNames:["availability","rectangle"]}),this._onEntityPropertyChanged(e,"rectangle",e.rectangle,void 0)}function gl(e,t,i){be.call(this,e,t,i)}Object(s.default)(Object.create)&&(_l.prototype=Object.create(ra.prototype),_l.prototype.constructor=_l),_l.prototype.createFillGeometryInstance=function(e){var t,i=this._entity,a=i.isAvailable(e),r={show:new me.a(a&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:ue.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof pe.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(t=this._materialProperty.color.getValue(e,ul)),Object(s.default)(t)||(t=y.default.WHITE),r.color=oe.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(r.offset=he.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,dl,fl))),new de.a({id:i,geometry:new sl(this._options),attributes:r})},_l.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,i=t.isAvailable(e),a=P.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,ul),r=this._distanceDisplayConditionProperty.getValue(e),n={show:new me.a(i&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(a),distanceDisplayCondition:ue.fromDistanceDisplayCondition(r),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(n.offset=he.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,dl,fl))),new de.a({id:t,geometry:new ll.a(this._options),attributes:n})},_l.prototype._computeCenter=function(e,t){var i=P.default.getValueOrUndefined(this._entity.rectangle.coordinates,e,hl);if(Object(s.default)(i)){var a=bi.default.center(i,ml);return Ne.default.toCartesian(a,hi.default.WGS84,t)}},_l.prototype._isHidden=function(e,t){return!Object(s.default)(t.coordinates)||Fe.prototype._isHidden.call(this,e,t)},_l.prototype._isDynamic=function(e,t){return!t.coordinates.isConstant||!P.default.isConstant(t.height)||!P.default.isConstant(t.extrudedHeight)||!P.default.isConstant(t.granularity)||!P.default.isConstant(t.stRotation)||!P.default.isConstant(t.rotation)||!P.default.isConstant(t.outlineWidth)||!P.default.isConstant(t.zIndex)||this._onTerrain&&!P.default.isConstant(this._materialProperty)&&!(this._materialProperty instanceof pe.default)},_l.prototype._setStaticOptions=function(e,t){var i=this._materialProperty instanceof pe.default,r=P.default.getValueOrUndefined(t.height,ce.default.MINIMUM_VALUE),n=P.default.getValueOrDefault(t.heightReference,ce.default.MINIMUM_VALUE,O.default.NONE),o=P.default.getValueOrUndefined(t.extrudedHeight,ce.default.MINIMUM_VALUE),l=P.default.getValueOrDefault(t.extrudedHeightReference,ce.default.MINIMUM_VALUE,O.default.NONE);Object(s.default)(o)&&!Object(s.default)(r)&&(r=0);var u=this._options;u.vertexFormat=i?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,u.rectangle=t.coordinates.getValue(ce.default.MINIMUM_VALUE,u.rectangle),u.granularity=P.default.getValueOrUndefined(t.granularity,ce.default.MINIMUM_VALUE),u.stRotation=P.default.getValueOrUndefined(t.stRotation,ce.default.MINIMUM_VALUE),u.rotation=P.default.getValueOrUndefined(t.rotation,ce.default.MINIMUM_VALUE),u.offsetAttribute=ra.computeGeometryOffsetAttribute(r,n,o,l),u.height=ra.getGeometryHeight(r,n),(o=ra.getGeometryExtrudedHeight(o,l))===ra.CLAMP_TO_GROUND&&(o=a.a.getMinimumMaximumHeights(sl.computeRectangle(u,cl)).minimumTerrainHeight),u.extrudedHeight=o},_l.DynamicGeometryUpdater=gl,Object(s.default)(Object.create)&&(gl.prototype=Object.create(be.prototype),gl.prototype.constructor=gl),gl.prototype._isHidden=function(e,t,i){return!Object(s.default)(this._options.rectangle)||be.prototype._isHidden.call(this,e,t,i)},gl.prototype._setOptions=function(e,t,i){var r=this._options,n=P.default.getValueOrUndefined(t.height,i),o=P.default.getValueOrDefault(t.heightReference,i,O.default.NONE),l=P.default.getValueOrUndefined(t.extrudedHeight,i),u=P.default.getValueOrDefault(t.extrudedHeightReference,i,O.default.NONE);Object(s.default)(l)&&!Object(s.default)(n)&&(n=0),r.rectangle=P.default.getValueOrUndefined(t.coordinates,i,r.rectangle),r.granularity=P.default.getValueOrUndefined(t.granularity,i),r.stRotation=P.default.getValueOrUndefined(t.stRotation,i),r.rotation=P.default.getValueOrUndefined(t.rotation,i),r.offsetAttribute=ra.computeGeometryOffsetAttribute(n,o,l,u),r.height=ra.getGeometryHeight(n,o),(l=ra.getGeometryExtrudedHeight(l,u))===ra.CLAMP_TO_GROUND&&(l=a.a.getMinimumMaximumHeights(sl.computeRectangle(r,cl)).minimumTerrainHeight),r.extrudedHeight=l};var vl=_l,yl=new y.default,bl=new w.a,wl=new w.a,xl=v.default.ZERO,Ol=new v.default;function Cl(e,t,i,a,r,n,o){var l;this.translucent=t,this.appearanceType=i,this.depthFailAppearanceType=a,this.depthFailMaterialProperty=r,this.depthFailMaterial=void 0,this.closed=n,this.shadows=o,this.primitives=e,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new p.default,this.updaters=new p.default,this.updatersWithAttributes=new p.default,this.attributes=new p.default,this.subscriptions=new p.default,this.showsUpdated=new p.default,this.itemsToRemove=[],this.invalidated=!1,Object(s.default)(r)&&(l=r.definitionChanged.addEventListener(Cl.prototype.onMaterialChanged,this)),this.removeMaterialSubscription=l}function Tl(e,t,i,a,r){this._solidItems=[],this._translucentItems=[],this._primitives=e,this._appearanceType=t,this._depthFailAppearanceType=i,this._closed=a,this._shadows=r}function El(e,t){for(var i=e.length-1;i>=0;i--){var a=e[i];if(a.remove(t))return 0===a.updaters.length&&(e.splice(i,1),a.destroy()),!0}return!1}function Pl(e,t,i){for(var a=!1,r=t.length,n=0;n<r;++n){var o=t[n],s=o.itemsToRemove,l=s.length;if(l>0)for(n=0;n<l;n++){var u=s[n];o.remove(u),e.add(i,u),a=!0}}return a}function Al(e,t,i,a){var r,n=t.length;for(r=n-1;r>=0;r--){var o=t[r];if(o.invalidated){t.splice(r,1);for(var s=o.updaters.values,l=s.length,u=0;u<l;u++)e.add(i,s[u]);o.destroy()}}for(n=t.length,r=0;r<n;++r)a=t[r].update(i)&&a;return a}function Sl(e,t,i){for(var a=e.length,r=0;r<a;r++){var n=e[r];if(n.contains(t))return n.getBoundingSphere(t,i)}return E.default.FAILED}function Dl(e){for(var t=e.length,i=0;i<t;i++)e[i].destroy();e.length=0}Cl.prototype.onMaterialChanged=function(){this.invalidated=!0},Cl.prototype.isMaterial=function(e){var t=this.depthFailMaterialProperty,i=e.depthFailMaterialProperty;return i===t||!!Object(s.default)(t)&&t.equals(i)},Cl.prototype.add=function(e,t){var i=e.id;if(this.createPrimitive=!0,this.geometry.set(i,t),this.updaters.set(i,e),e.hasConstantFill&&e.fillMaterialProperty.isConstant&&P.default.isConstant(e.distanceDisplayConditionProperty)&&P.default.isConstant(e.terrainOffsetProperty)){var a=this;this.subscriptions.set(i,e.entity.definitionChanged.addEventListener((function(t,i,r,n){"isShowing"===i&&a.showsUpdated.set(e.id,e)})))}else this.updatersWithAttributes.set(i,e)},Cl.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var i=this.subscriptions.get(t);return Object(s.default)(i)&&(i(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1},Cl.prototype.update=function(e){var t,i=!0,a=0,r=this.primitive,n=this.primitives;if(this.createPrimitive){var o=this.geometry.values;if(o.length>0){var l;Object(s.default)(r)&&(Object(s.default)(this.oldPrimitive)?n.remove(r):this.oldPrimitive=r),Object(s.default)(this.depthFailAppearanceType)&&(Object(s.default)(this.depthFailMaterialProperty)&&(this.depthFailMaterial=ve.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial)),l=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.translucent,closed:this.closed})),r=new _e.a({show:!1,asynchronous:!0,geometryInstances:o.slice(),appearance:new this.appearanceType({translucent:this.translucent,closed:this.closed}),depthFailAppearance:l,shadows:this.shadows}),n.add(r),i=!1}else{Object(s.default)(r)&&(n.remove(r),r=void 0);var u=this.oldPrimitive;Object(s.default)(u)&&(n.remove(u),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=r,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(Object(s.default)(r)&&r.ready){r.show=!0,Object(s.default)(this.oldPrimitive)&&(n.remove(this.oldPrimitive),this.oldPrimitive=void 0),!Object(s.default)(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof pe.default||(this.depthFailMaterial=ve.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);var d=this.updatersWithAttributes.values,f=d.length,c=this.waitingOnCreate;for(t=0;t<f;t++){var h=d[t],m=this.geometry.get(h.id),p=this.attributes.get(m.id.id);if(Object(s.default)(p)||(p=r.getGeometryInstanceAttributes(m.id),this.attributes.set(m.id.id,p)),!h.fillMaterialProperty.isConstant||c){var _=h.fillMaterialProperty.color,g=P.default.getValueOrDefault(_,e,y.default.WHITE,yl);y.default.equals(p._lastColor,g)||(p._lastColor=y.default.clone(g,p._lastColor),p.color=oe.a.toValue(g,p.color),(this.translucent&&255===p.color[3]||!this.translucent&&255!==p.color[3])&&(this.itemsToRemove[a++]=h))}if(Object(s.default)(this.depthFailAppearanceType)&&h.depthFailMaterialProperty instanceof pe.default&&(!h.depthFailMaterialProperty.isConstant||c)){var b=h.depthFailMaterialProperty.color,x=P.default.getValueOrDefault(b,e,y.default.WHITE,yl);y.default.equals(p._lastDepthFailColor,x)||(p._lastDepthFailColor=y.default.clone(x,p._lastDepthFailColor),p.depthFailColor=oe.a.toValue(x,p.depthFailColor))}var O=h.entity.isShowing&&(h.hasConstantFill||h.isFilled(e));O!==(1===p.show[0])&&(p.show=me.a.toValue(O,p.show));var C=h.distanceDisplayConditionProperty;if(!P.default.isConstant(C)){var T=P.default.getValueOrDefault(C,e,wl,bl);w.a.equals(T,p._lastDistanceDisplayCondition)||(p._lastDistanceDisplayCondition=w.a.clone(T,p._lastDistanceDisplayCondition),p.distanceDisplayCondition=ue.toValue(T,p.distanceDisplayCondition))}var E=h.terrainOffsetProperty;if(!P.default.isConstant(E)){var A=P.default.getValueOrDefault(E,e,xl,Ol);v.default.equals(A,p._lastOffset)||(p._lastOffset=v.default.clone(A,p._lastOffset),p.offset=he.a.toValue(A,p.offset))}}this.updateShows(r),this.waitingOnCreate=!1}else Object(s.default)(r)&&!r.ready&&(i=!1);return this.itemsToRemove.length=a,i},Cl.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,i=t.length,a=0;a<i;a++){var r=t[a],n=this.geometry.get(r.id),o=this.attributes.get(n.id.id);Object(s.default)(o)||(o=e.getGeometryInstanceAttributes(n.id),this.attributes.set(n.id.id,o));var l=r.entity.isShowing;l!==(1===o.show[0])&&(o.show=me.a.toValue(l,o.show),n.attributes.show.value[0]=o.show[0])}this.showsUpdated.removeAll()},Cl.prototype.contains=function(e){return this.updaters.contains(e.id)},Cl.prototype.getBoundingSphere=function(e,t){var i=this.primitive;if(!i.ready)return E.default.PENDING;var a=i.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(a)||!Object(s.default)(a.boundingSphere)||Object(s.default)(a.show)&&0===a.show[0]?E.default.FAILED:(a.boundingSphere.clone(t),E.default.DONE)},Cl.prototype.destroy=function(){var e=this.primitive,t=this.primitives;Object(s.default)(e)&&t.remove(e);var i=this.oldPrimitive;Object(s.default)(i)&&t.remove(i),Object(s.default)(this.removeMaterialSubscription)&&this.removeMaterialSubscription()},Tl.prototype.add=function(e,t){var i,a,r=t.createFillGeometryInstance(e);255===r.attributes.color.value[3]?(i=this._solidItems,a=!1):(i=this._translucentItems,a=!0);for(var n=i.length,o=0;o<n;o++){var s=i[o];if(s.isMaterial(t))return void s.add(t,r)}var l=new Cl(this._primitives,a,this._appearanceType,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);l.add(t,r),i.push(l)},Tl.prototype.remove=function(e){El(this._solidItems,e)||El(this._translucentItems,e)},Tl.prototype.update=function(e){var t=Al(this,this._solidItems,e,!0);t=Al(this,this._translucentItems,e,t)&&t;var i=Pl(this,this._solidItems,e),a=Pl(this,this._translucentItems,e);return(i||a)&&(t=Al(this,this._solidItems,e,t)&&t,t=Al(this,this._translucentItems,e,t)&&t),t},Tl.prototype.getBoundingSphere=function(e,t){var i=Sl(this._solidItems,e,t);return i===E.default.FAILED?Sl(this._translucentItems,e,t):i},Tl.prototype.removeAllPrimitives=function(){Dl(this._solidItems),Dl(this._translucentItems)};var Il=Tl,Ml=new w.a,Fl=new w.a,Rl=v.default.ZERO,Nl=new v.default;function Ll(e,t,i,a,r,n,o){this.primitives=e,this.appearanceType=t,this.materialProperty=i,this.depthFailAppearanceType=a,this.depthFailMaterialProperty=r,this.closed=n,this.shadows=o,this.updaters=new p.default,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new p.default,this.material=void 0,this.depthFailMaterial=void 0,this.updatersWithAttributes=new p.default,this.attributes=new p.default,this.invalidated=!1,this.removeMaterialSubscription=i.definitionChanged.addEventListener(Ll.prototype.onMaterialChanged,this),this.subscriptions=new p.default,this.showsUpdated=new p.default}Ll.prototype.onMaterialChanged=function(){this.invalidated=!0},Ll.prototype.isMaterial=function(e){var t=this.materialProperty,i=e.fillMaterialProperty,a=this.depthFailMaterialProperty,r=e.depthFailMaterialProperty;if(i===t&&r===a)return!0;var n=Object(s.default)(t)&&t.equals(i);return n=(!Object(s.default)(a)&&!Object(s.default)(r)||Object(s.default)(a)&&a.equals(r))&&n},Ll.prototype.add=function(e,t){var i=t.id;if(this.updaters.set(i,t),this.geometry.set(i,t.createFillGeometryInstance(e)),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&P.default.isConstant(t.distanceDisplayConditionProperty)&&P.default.isConstant(t.terrainOffsetProperty)){var a=this;this.subscriptions.set(i,t.entity.definitionChanged.addEventListener((function(e,i,r,n){"isShowing"===i&&a.showsUpdated.set(t.id,t)})))}else this.updatersWithAttributes.set(i,t);this.createPrimitive=!0},Ll.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var i=this.subscriptions.get(t);return Object(s.default)(i)&&(i(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1};var jl=new y.default;function Vl(e,t,i,a,r){this._items=[],this._primitives=e,this._appearanceType=t,this._depthFailAppearanceType=i,this._closed=a,this._shadows=r}Ll.prototype.update=function(e){var t,i=!0,a=this.primitive,r=this.primitives,n=this.geometry.values;if(this.createPrimitive){if(n.length>0){var o;Object(s.default)(a)&&(Object(s.default)(this.oldPrimitive)?r.remove(a):this.oldPrimitive=a),this.material=ve.getValue(e,this.materialProperty,this.material),Object(s.default)(this.depthFailMaterialProperty)&&(this.depthFailMaterial=ve.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),o=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.depthFailMaterial.isTranslucent(),closed:this.closed})),a=new _e.a({show:!1,asynchronous:!0,geometryInstances:n.slice(),appearance:new this.appearanceType({material:this.material,translucent:this.material.isTranslucent(),closed:this.closed}),depthFailAppearance:o,shadows:this.shadows}),r.add(a),i=!1}else{Object(s.default)(a)&&(r.remove(a),a=void 0);var l=this.oldPrimitive;Object(s.default)(l)&&(r.remove(l),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=a,this.createPrimitive=!1}else if(Object(s.default)(a)&&a.ready){a.show=!0,Object(s.default)(this.oldPrimitive)&&(r.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.material=ve.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material,!Object(s.default)(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof pe.default||(this.depthFailMaterial=ve.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);var u=this.updatersWithAttributes.values,d=u.length;for(t=0;t<d;t++){var f=u[t],c=f.entity,h=this.geometry.get(f.id),m=this.attributes.get(h.id.id);if(Object(s.default)(m)||(m=a.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,m)),Object(s.default)(this.depthFailAppearanceType)&&this.depthFailMaterialProperty instanceof pe.default&&!f.depthFailMaterialProperty.isConstant){var p=f.depthFailMaterialProperty.color,_=P.default.getValueOrDefault(p,e,y.default.WHITE,jl);y.default.equals(m._lastDepthFailColor,_)||(m._lastDepthFailColor=y.default.clone(_,m._lastDepthFailColor),m.depthFailColor=oe.a.toValue(_,m.depthFailColor))}var g=c.isShowing&&(f.hasConstantFill||f.isFilled(e));g!==(1===m.show[0])&&(m.show=me.a.toValue(g,m.show));var b=f.distanceDisplayConditionProperty;if(!P.default.isConstant(b)){var x=P.default.getValueOrDefault(b,e,Fl,Ml);w.a.equals(x,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=w.a.clone(x,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=ue.toValue(x,m.distanceDisplayCondition))}var O=f.terrainOffsetProperty;if(!P.default.isConstant(O)){var C=P.default.getValueOrDefault(O,e,Rl,Nl);v.default.equals(C,m._lastOffset)||(m._lastOffset=v.default.clone(C,m._lastOffset),m.offset=he.a.toValue(C,m.offset))}}this.updateShows(a)}else Object(s.default)(a)&&!a.ready&&(i=!1);return i},Ll.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,i=t.length,a=0;a<i;a++){var r=t[a],n=r.entity,o=this.geometry.get(r.id),l=this.attributes.get(o.id.id);Object(s.default)(l)||(l=e.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,l));var u=n.isShowing;u!==(1===l.show[0])&&(l.show=me.a.toValue(u,l.show),o.attributes.show.value[0]=l.show[0])}this.showsUpdated.removeAll()},Ll.prototype.contains=function(e){return this.updaters.contains(e.id)},Ll.prototype.getBoundingSphere=function(e,t){var i=this.primitive;if(!i.ready)return E.default.PENDING;var a=i.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(a)||!Object(s.default)(a.boundingSphere)||Object(s.default)(a.show)&&0===a.show[0]?E.default.FAILED:(a.boundingSphere.clone(t),E.default.DONE)},Ll.prototype.destroy=function(){var e=this.primitive,t=this.primitives;Object(s.default)(e)&&t.remove(e);var i=this.oldPrimitive;Object(s.default)(i)&&t.remove(i),this.removeMaterialSubscription()},Vl.prototype.add=function(e,t){for(var i=this._items,a=i.length,r=0;r<a;r++){var n=i[r];if(n.isMaterial(t))return void n.add(e,t)}var o=new Ll(this._primitives,this._appearanceType,t.fillMaterialProperty,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);o.add(e,t),i.push(o)},Vl.prototype.remove=function(e){for(var t=this._items,i=t.length-1;i>=0;i--){var a=t[i];if(a.remove(e)){0===a.updaters.length&&(t.splice(i,1),a.destroy());break}}},Vl.prototype.update=function(e){var t,i=this._items;for(t=i.length-1;t>=0;t--){var a=i[t];if(a.invalidated){i.splice(t,1);for(var r=a.updaters.values,n=r.length,o=0;o<n;o++)this.add(e,r[o]);a.destroy()}}var s=!0;for(t=0;t<i.length;t++)s=i[t].update(e)&&s;return s},Vl.prototype.getBoundingSphere=function(e,t){for(var i=this._items,a=i.length,r=0;r<a;r++){var n=i[r];if(n.contains(e))return n.getBoundingSphere(e,t)}return E.default.FAILED},Vl.prototype.removeAllPrimitives=function(){for(var e=this._items,t=e.length,i=0;i<t;i++)e[i].destroy();this._items.length=0};var Ul=Vl;function zl(e,t,i){var a=e[t];e[t]=e[i],e[i]=a}function Bl(e,t){return e<t?-1:e>t?1:0}var Hl=function(e,t,i,a,r){!function e(t,i,a,r,n){for(;r>a;){if(r-a>600){var o=r-a+1,s=i-a+1,l=Math.log(o),u=.5*Math.exp(2*l/3),d=.5*Math.sqrt(l*u*(o-u)/o)*(s-o/2<0?-1:1),f=Math.max(a,Math.floor(i-s*u/o+d)),c=Math.min(r,Math.floor(i+(o-s)*u/o+d));e(t,i,f,c,n)}var h=t[i],m=a,p=r;for(zl(t,a,i),n(t[r],h)>0&&zl(t,a,r);m<p;){for(zl(t,m,p),m++,p--;n(t[m],h)<0;)m++;for(;n(t[p],h)>0;)p--}0===n(t[a],h)?zl(t,a,p):(p++,zl(t,p,r)),p<=i&&(a=p+1),i<=p&&(r=p-1)}}(e,t,i||0,a||e.length-1,r||Bl)};function kl(e,t){if(!(this instanceof kl))return new kl(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&this._initFormat(t),this.clear()}function Wl(e,t,i){if(!i)return t.indexOf(e);for(var a=0;a<t.length;a++)if(i(e,t[a]))return a;return-1}function Gl(e,t){Yl(e,0,e.children.length,t,e)}function Yl(e,t,i,a,r){r||(r=eu(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var n,o=t;o<i;o++)n=e.children[o],Xl(r,e.leaf?a(n):n);return r}function Xl(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function Ql(e,t){return e.minX-t.minX}function ql(e,t){return e.minY-t.minY}function Zl(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function Kl(e){return e.maxX-e.minX+(e.maxY-e.minY)}function Jl(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function $l(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function eu(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function tu(e,t,i,a,r){for(var n,o=[t,i];o.length;)(i=o.pop())-(t=o.pop())<=a||(n=t+Math.ceil((i-t)/a/2)*a,Hl(e,n,t,i,r),o.push(t,n,n,i))}kl.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,i=[],a=this.toBBox;if(!$l(e,t))return i;for(var r,n,o,s,l=[];t;){for(r=0,n=t.children.length;r<n;r++)o=t.children[r],$l(e,s=t.leaf?a(o):o)&&(t.leaf?i.push(o):Jl(e,s)?this._all(o,i):l.push(o));t=l.pop()}return i},collides:function(e){var t=this.data,i=this.toBBox;if(!$l(e,t))return!1;for(var a,r,n,o,s=[];t;){for(a=0,r=t.children.length;a<r;a++)if(n=t.children[a],$l(e,o=t.leaf?i(n):n)){if(t.leaf||Jl(e,o))return!0;s.push(n)}t=s.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}var a=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===a.height)this._splitRoot(this.data,a);else{if(this.data.height<a.height){var r=this.data;this.data=a,a=r}this._insert(a,this.data.height-a.height-1,!0)}else this.data=a;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=eu([]),this},remove:function(e,t){if(!e)return this;for(var i,a,r,n,o=this.data,s=this.toBBox(e),l=[],u=[];o||l.length;){if(o||(o=l.pop(),a=l[l.length-1],i=u.pop(),n=!0),o.leaf&&-1!==(r=Wl(e,o.children,t)))return o.children.splice(r,1),l.push(o),this._condense(l),this;n||o.leaf||!Jl(o,s)?a?(i++,o=a.children[i],n=!1):o=null:(l.push(o),u.push(i),i=0,a=o,o=o.children[0])}return this},toBBox:function(e){return e},compareMinX:Ql,compareMinY:ql,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},_build:function(e,t,i,a){var r,n=i-t+1,o=this._maxEntries;if(n<=o)return Gl(r=eu(e.slice(t,i+1)),this.toBBox),r;a||(a=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,a-1))),(r=eu([])).leaf=!1,r.height=a;var s,l,u,d,f=Math.ceil(n/o),c=f*Math.ceil(Math.sqrt(o));for(tu(e,t,i,c,this.compareMinX),s=t;s<=i;s+=c)for(tu(e,s,u=Math.min(s+c-1,i),f,this.compareMinY),l=s;l<=u;l+=f)d=Math.min(l+f-1,u),r.children.push(this._build(e,l,d,a-1));return Gl(r,this.toBBox),r},_chooseSubtree:function(e,t,i,a){for(var r,n,o,s,l,u,d,f,c,h;a.push(t),!t.leaf&&a.length-1!==i;){for(d=f=1/0,r=0,n=t.children.length;r<n;r++)l=Zl(o=t.children[r]),c=e,h=o,(u=(Math.max(h.maxX,c.maxX)-Math.min(h.minX,c.minX))*(Math.max(h.maxY,c.maxY)-Math.min(h.minY,c.minY))-l)<f?(f=u,d=l<d?l:d,s=o):u===f&&l<d&&(d=l,s=o);t=s||t.children[0]}return t},_insert:function(e,t,i){var a=this.toBBox,r=i?e:a(e),n=[],o=this._chooseSubtree(r,this.data,t,n);for(o.children.push(e),Xl(o,r);t>=0&&n[t].children.length>this._maxEntries;)this._split(n,t),t--;this._adjustParentBBoxes(r,n,t)},_split:function(e,t){var i=e[t],a=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,a);var n=this._chooseSplitIndex(i,r,a),o=eu(i.children.splice(n,i.children.length-n));o.height=i.height,o.leaf=i.leaf,Gl(i,this.toBBox),Gl(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(i,o)},_splitRoot:function(e,t){this.data=eu([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Gl(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,i){var a,r,n,o,s,l,u,d,f,c,h,m,p,_;for(l=u=1/0,a=t;a<=i-t;a++)r=Yl(e,0,a,this.toBBox),n=Yl(e,a,i,this.toBBox),f=r,c=n,h=void 0,m=void 0,p=void 0,_=void 0,h=Math.max(f.minX,c.minX),m=Math.max(f.minY,c.minY),p=Math.min(f.maxX,c.maxX),_=Math.min(f.maxY,c.maxY),o=Math.max(0,p-h)*Math.max(0,_-m),s=Zl(r)+Zl(n),o<l?(l=o,d=a,u=s<u?s:u):o===l&&s<u&&(u=s,d=a);return d},_chooseSplitAxis:function(e,t,i){var a=e.leaf?this.compareMinX:Ql,r=e.leaf?this.compareMinY:ql;this._allDistMargin(e,t,i,a)<this._allDistMargin(e,t,i,r)&&e.children.sort(a)},_allDistMargin:function(e,t,i,a){e.children.sort(a);var r,n,o=this.toBBox,s=Yl(e,0,t,o),l=Yl(e,i-t,i,o),u=Kl(s)+Kl(l);for(r=t;r<i-t;r++)n=e.children[r],Xl(s,e.leaf?o(n):n),u+=Kl(s);for(r=i-t-1;r>=t;r--)n=e.children[r],Xl(l,e.leaf?o(n):n),u+=Kl(l);return u},_adjustParentBBoxes:function(e,t,i){for(var a=i;a>=0;a--)Xl(t[a],e)},_condense:function(e){for(var t,i=e.length-1;i>=0;i--)0===e[i].children.length?i>0?(t=e[i-1].children).splice(t.indexOf(e[i]),1):this.clear():Gl(e[i],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};var iu=kl;function au(){this._tree=iu()}function ru(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.id=""}function nu(e,t){return e.id===t.id}ru.fromRectangleAndId=function(e,t,i){return i.minX=t.west,i.minY=t.south,i.maxX=t.east,i.maxY=t.north,i.id=e,i},au.prototype.insert=function(e,t){var i=ru.fromRectangleAndId(e,t,new ru);this._tree.insert(i)};var ou=new ru;au.prototype.remove=function(e,t){var i=ru.fromRectangleAndId(e,t,ou);this._tree.remove(i,nu)};var su=new ru;au.prototype.collides=function(e){var t=ru.fromRectangleAndId("",e,su);return this._tree.collides(t)};var lu=au,uu=new y.default,du=new w.a,fu=new w.a;function cu(e,t,i,a){this.primitives=e,this.zIndex=a,this.classificationType=t,this.color=i,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new p.default,this.updaters=new p.default,this.updatersWithAttributes=new p.default,this.attributes=new p.default,this.subscriptions=new p.default,this.showsUpdated=new p.default,this.itemsToRemove=[],this.isDirty=!1,this.rectangleCollisionCheck=new lu}function hu(e,t){this._batches=[],this._primitives=e,this._classificationType=t}cu.prototype.overlapping=function(e){return this.rectangleCollisionCheck.collides(e)},cu.prototype.add=function(e,t){var i=e.id;if(this.createPrimitive=!0,this.geometry.set(i,t),this.updaters.set(i,e),this.rectangleCollisionCheck.insert(i,t.geometry.rectangle),e.hasConstantFill&&e.fillMaterialProperty.isConstant&&P.default.isConstant(e.distanceDisplayConditionProperty)){var a=this;this.subscriptions.set(i,e.entity.definitionChanged.addEventListener((function(t,i,r,n){"isShowing"===i&&a.showsUpdated.set(e.id,e)})))}else this.updatersWithAttributes.set(i,e)},cu.prototype.remove=function(e){var t=e.id,i=this.geometry.get(t);if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.rectangleCollisionCheck.remove(t,i.geometry.rectangle),this.updatersWithAttributes.remove(t);var a=this.subscriptions.get(t);return Object(s.default)(a)&&(a(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1},cu.prototype.update=function(e){var t,i=!0,a=this.primitive,r=this.primitives;if(this.createPrimitive){var n=this.geometry.values;if(n.length>0)Object(s.default)(a)&&(Object(s.default)(this.oldPrimitive)?r.remove(a):this.oldPrimitive=a),a=new f.a({show:!1,asynchronous:!0,geometryInstances:n.slice(),classificationType:this.classificationType}),r.add(a,this.zIndex),i=!1;else{Object(s.default)(a)&&(r.remove(a),a=void 0);var o=this.oldPrimitive;Object(s.default)(o)&&(r.remove(o),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=a,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(Object(s.default)(a)&&a.ready){a.show=!0,Object(s.default)(this.oldPrimitive)&&(r.remove(this.oldPrimitive),this.oldPrimitive=void 0);var l=this.updatersWithAttributes.values,u=l.length,d=this.waitingOnCreate;for(t=0;t<u;t++){var c=l[t],h=this.geometry.get(c.id),m=this.attributes.get(h.id.id);if(Object(s.default)(m)||(m=a.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,m)),!c.fillMaterialProperty.isConstant||d){var p=c.fillMaterialProperty.color,_=P.default.getValueOrDefault(p,e,y.default.WHITE,uu);y.default.equals(m._lastColor,_)||(m._lastColor=y.default.clone(_,m._lastColor),m.color=oe.a.toValue(_,m.color))}var g=c.entity.isShowing&&(c.hasConstantFill||c.isFilled(e));g!==(1===m.show[0])&&(m.show=me.a.toValue(g,m.show));var v=c.distanceDisplayConditionProperty;if(!P.default.isConstant(v)){var b=P.default.getValueOrDefault(v,e,fu,du);w.a.equals(b,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=w.a.clone(b,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=ue.toValue(b,m.distanceDisplayCondition))}}this.updateShows(a),this.waitingOnCreate=!1}else Object(s.default)(a)&&!a.ready&&(i=!1);return this.itemsToRemove.length=0,i},cu.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,i=t.length,a=0;a<i;a++){var r=t[a],n=this.geometry.get(r.id),o=this.attributes.get(n.id.id);Object(s.default)(o)||(o=e.getGeometryInstanceAttributes(n.id),this.attributes.set(n.id.id,o));var l=r.entity.isShowing;l!==(1===o.show[0])&&(o.show=me.a.toValue(l,o.show),n.attributes.show.value[0]=o.show[0])}this.showsUpdated.removeAll()},cu.prototype.contains=function(e){return this.updaters.contains(e.id)},cu.prototype.getBoundingSphere=function(e,t){var i=this.primitive;if(!i.ready)return E.default.PENDING;var a=i.getBoundingSphere(e.entity);return Object(s.default)(a)?(a.clone(t),E.default.DONE):E.default.FAILED},cu.prototype.removeAllPrimitives=function(){var e=this.primitives,t=this.primitive;Object(s.default)(t)&&(e.remove(t),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());var i=this.oldPrimitive;Object(s.default)(i)&&(e.remove(i),this.oldPrimitive=void 0)},hu.prototype.add=function(e,t){for(var i,a=t.createFillGeometryInstance(e),r=this._batches,n=P.default.getValueOrDefault(t.zIndex,0),o=r.length,l=0;l<o;++l){var u=r[l];if(u.zIndex===n&&!u.overlapping(a.geometry.rectangle)){i=u;break}}return Object(s.default)(i)||(i=new cu(this._primitives,this._classificationType,a.attributes.color.value,n),r.push(i)),i.add(t,a),i},hu.prototype.remove=function(e){for(var t=this._batches,i=t.length,a=0;a<i;++a)if(t[a].remove(e))return},hu.prototype.update=function(e){var t,i,a=!0,r=this._batches,n=r.length;for(t=0;t<n;++t)a=r[t].update(e)&&a;for(t=0;t<n;++t)for(var o=r[t],s=o.itemsToRemove,l=s.length,u=0;u<l;u++){i=s[u],o.remove(i);var d=this.add(e,i);o.isDirty=!0,d.isDirty=!0}for(t=n-1;t>=0;--t){var f=r[t];f.isDirty&&(a=r[t].update(e)&&a,f.isDirty=!1),0===f.geometry.length&&r.splice(t,1)}return a},hu.prototype.getBoundingSphere=function(e,t){for(var i=this._batches,a=i.length,r=0;r<a;++r){var n=i[r];if(n.contains(e))return n.getBoundingSphere(e,t)}return E.default.FAILED},hu.prototype.removeAllPrimitives=function(){for(var e=this._batches,t=e.length,i=0;i<t;++i)e[i].removeAllPrimitives()};var mu=hu,pu=i(524),_u=new w.a,gu=new w.a;function vu(e,t,i,a,r,n){this.primitives=e,this.classificationType=t,this.appearanceType=i,this.materialProperty=a,this.updaters=new p.default,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new p.default,this.material=void 0,this.updatersWithAttributes=new p.default,this.attributes=new p.default,this.invalidated=!1,this.removeMaterialSubscription=a.definitionChanged.addEventListener(vu.prototype.onMaterialChanged,this),this.subscriptions=new p.default,this.showsUpdated=new p.default,this.usingSphericalTextureCoordinates=r,this.zIndex=n,this.rectangleCollisionCheck=new lu}function yu(e,t,i){this._items=[],this._primitives=e,this._classificationType=t,this._appearanceType=i}vu.prototype.onMaterialChanged=function(){this.invalidated=!0},vu.prototype.overlapping=function(e){return this.rectangleCollisionCheck.collides(e)},vu.prototype.isMaterial=function(e){var t=this.materialProperty,i=e.fillMaterialProperty;return i===t||i instanceof pe.default&&t instanceof pe.default||Object(s.default)(t)&&t.equals(i)},vu.prototype.add=function(e,t,i){var a=t.id;if(this.updaters.set(a,t),this.geometry.set(a,i),this.rectangleCollisionCheck.insert(a,i.geometry.rectangle),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&P.default.isConstant(t.distanceDisplayConditionProperty)){var r=this;this.subscriptions.set(a,t.entity.definitionChanged.addEventListener((function(e,i,a,n){"isShowing"===i&&r.showsUpdated.set(t.id,t)})))}else this.updatersWithAttributes.set(a,t);this.createPrimitive=!0},vu.prototype.remove=function(e){var t=e.id,i=this.geometry.get(t);if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.rectangleCollisionCheck.remove(t,i.geometry.rectangle),this.updatersWithAttributes.remove(t);var a=this.subscriptions.get(t);return Object(s.default)(a)&&(a(),this.subscriptions.remove(t)),!0}return!1},vu.prototype.update=function(e){var t,i=!0,a=this.primitive,r=this.primitives,n=this.geometry.values;if(this.createPrimitive){if(n.length>0)Object(s.default)(a)&&(Object(s.default)(this.oldPrimitive)?r.remove(a):this.oldPrimitive=a),this.material=ve.getValue(e,this.materialProperty,this.material),a=new f.a({show:!1,asynchronous:!0,geometryInstances:n.slice(),appearance:new this.appearanceType({material:this.material}),classificationType:this.classificationType}),r.add(a,this.zIndex),i=!1;else{Object(s.default)(a)&&(r.remove(a),a=void 0);var o=this.oldPrimitive;Object(s.default)(o)&&(r.remove(o),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=a,this.createPrimitive=!1}else if(Object(s.default)(a)&&a.ready){a.show=!0,Object(s.default)(this.oldPrimitive)&&(r.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.material=ve.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material;var l=this.updatersWithAttributes.values,u=l.length;for(t=0;t<u;t++){var d=l[t],c=d.entity,h=this.geometry.get(d.id),m=this.attributes.get(h.id.id);Object(s.default)(m)||(m=a.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,m));var p=c.isShowing&&(d.hasConstantFill||d.isFilled(e));p!==(1===m.show[0])&&(m.show=me.a.toValue(p,m.show));var _=d.distanceDisplayConditionProperty;if(!P.default.isConstant(_)){var g=P.default.getValueOrDefault(_,e,gu,_u);w.a.equals(g,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=w.a.clone(g,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=ue.toValue(g,m.distanceDisplayCondition))}}this.updateShows(a)}else Object(s.default)(a)&&!a.ready&&(i=!1);return i},vu.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,i=t.length,a=0;a<i;a++){var r=t[a],n=r.entity,o=this.geometry.get(r.id),l=this.attributes.get(o.id.id);Object(s.default)(l)||(l=e.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,l));var u=n.isShowing;u!==(1===l.show[0])&&(l.show=me.a.toValue(u,l.show),o.attributes.show.value[0]=l.show[0])}this.showsUpdated.removeAll()},vu.prototype.contains=function(e){return this.updaters.contains(e.id)},vu.prototype.getBoundingSphere=function(e,t){var i=this.primitive;if(!i.ready)return E.default.PENDING;var a=i.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(a)||!Object(s.default)(a.boundingSphere)||Object(s.default)(a.show)&&0===a.show[0]?E.default.FAILED:(a.boundingSphere.clone(t),E.default.DONE)},vu.prototype.destroy=function(){var e=this.primitive,t=this.primitives;Object(s.default)(e)&&t.remove(e);var i=this.oldPrimitive;Object(s.default)(i)&&t.remove(i),this.removeMaterialSubscription()},yu.prototype.add=function(e,t){for(var i=this._items,a=i.length,r=t.createFillGeometryInstance(e),n=pu.a.shouldUseSphericalCoordinates(r.geometry.rectangle),o=P.default.getValueOrDefault(t.zIndex,0),s=0;s<a;++s){var l=i[s];if(l.isMaterial(t)&&l.usingSphericalTextureCoordinates===n&&l.zIndex===o&&!l.overlapping(r.geometry.rectangle))return void l.add(e,t,r)}var u=new vu(this._primitives,this._classificationType,this._appearanceType,t.fillMaterialProperty,n,o);u.add(e,t,r),i.push(u)},yu.prototype.remove=function(e){for(var t=this._items,i=t.length-1;i>=0;i--){var a=t[i];if(a.remove(e)){0===a.updaters.length&&(t.splice(i,1),a.destroy());break}}},yu.prototype.update=function(e){var t,i=this._items;for(t=i.length-1;t>=0;t--){var a=i[t];if(a.invalidated){i.splice(t,1);for(var r=a.updaters.values,n=r.length,o=0;o<n;o++)this.add(e,r[o]);a.destroy()}}var s=!0;for(t=0;t<i.length;t++)s=i[t].update(e)&&s;return s},yu.prototype.getBoundingSphere=function(e,t){for(var i=this._items,a=i.length,r=0;r<a;r++){var n=i[r];if(n.contains(e))return n.getBoundingSphere(e,t)}return E.default.FAILED},yu.prototype.removeAllPrimitives=function(){for(var e=this._items,t=e.length,i=0;i<t;i++)e[i].destroy();this._items.length=0};var bu=yu,wu=new y.default,xu=new w.a,Ou=new w.a,Cu=v.default.ZERO,Tu=new v.default;function Eu(e,t,i,a){this.translucent=t,this.width=i,this.shadows=a,this.primitives=e,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new p.default,this.updaters=new p.default,this.updatersWithAttributes=new p.default,this.attributes=new p.default,this.itemsToRemove=[],this.subscriptions=new p.default,this.showsUpdated=new p.default}function Pu(e,t,i){this._primitives=e,this._scene=t,this._shadows=i,this._solidBatches=new p.default,this._translucentBatches=new p.default}Eu.prototype.add=function(e,t){var i=e.id;if(this.createPrimitive=!0,this.geometry.set(i,t),this.updaters.set(i,e),e.hasConstantOutline&&e.outlineColorProperty.isConstant&&P.default.isConstant(e.distanceDisplayConditionProperty)&&P.default.isConstant(e.terrainOffsetProperty)){var a=this;this.subscriptions.set(i,e.entity.definitionChanged.addEventListener((function(t,i,r,n){"isShowing"===i&&a.showsUpdated.set(e.id,e)})))}else this.updatersWithAttributes.set(i,e)},Eu.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var i=this.subscriptions.get(t);return Object(s.default)(i)&&(i(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1},Eu.prototype.update=function(e){var t,i=!0,a=0,r=this.primitive,n=this.primitives;if(this.createPrimitive){var o=this.geometry.values;if(o.length>0)Object(s.default)(r)&&(Object(s.default)(this.oldPrimitive)?n.remove(r):this.oldPrimitive=r),r=new _e.a({show:!1,asynchronous:!0,geometryInstances:o.slice(),appearance:new ie.a({flat:!0,translucent:this.translucent,renderState:{lineWidth:this.width}}),shadows:this.shadows}),n.add(r),i=!1;else{Object(s.default)(r)&&(n.remove(r),r=void 0);var l=this.oldPrimitive;Object(s.default)(l)&&(n.remove(l),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=r,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(Object(s.default)(r)&&r.ready){r.show=!0,Object(s.default)(this.oldPrimitive)&&(n.remove(this.oldPrimitive),this.oldPrimitive=void 0);var u=this.updatersWithAttributes.values,d=u.length,f=this.waitingOnCreate;for(t=0;t<d;t++){var c=u[t],h=this.geometry.get(c.id),m=this.attributes.get(h.id.id);if(Object(s.default)(m)||(m=r.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,m)),!c.outlineColorProperty.isConstant||f){var p=c.outlineColorProperty,_=P.default.getValueOrDefault(p,e,y.default.WHITE,wu);y.default.equals(m._lastColor,_)||(m._lastColor=y.default.clone(_,m._lastColor),m.color=oe.a.toValue(_,m.color),(this.translucent&&255===m.color[3]||!this.translucent&&255!==m.color[3])&&(this.itemsToRemove[a++]=c))}var g=c.entity.isShowing&&(c.hasConstantOutline||c.isOutlineVisible(e));g!==(1===m.show[0])&&(m.show=me.a.toValue(g,m.show));var b=c.distanceDisplayConditionProperty;if(!P.default.isConstant(b)){var x=P.default.getValueOrDefault(b,e,Ou,xu);w.a.equals(x,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=w.a.clone(x,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=ue.toValue(x,m.distanceDisplayCondition))}var O=c.terrainOffsetProperty;if(!P.default.isConstant(O)){var C=P.default.getValueOrDefault(O,e,Cu,Tu);v.default.equals(C,m._lastOffset)||(m._lastOffset=v.default.clone(C,m._lastOffset),m.offset=he.a.toValue(C,m.offset))}}this.updateShows(r),this.waitingOnCreate=!1}else Object(s.default)(r)&&!r.ready&&(i=!1);return this.itemsToRemove.length=a,i},Eu.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,i=t.length,a=0;a<i;a++){var r=t[a],n=this.geometry.get(r.id),o=this.attributes.get(n.id.id);Object(s.default)(o)||(o=e.getGeometryInstanceAttributes(n.id),this.attributes.set(n.id.id,o));var l=r.entity.isShowing;l!==(1===o.show[0])&&(o.show=me.a.toValue(l,o.show),n.attributes.show.value[0]=o.show[0])}this.showsUpdated.removeAll()},Eu.prototype.contains=function(e){return this.updaters.contains(e.id)},Eu.prototype.getBoundingSphere=function(e,t){var i=this.primitive;if(!i.ready)return E.default.PENDING;var a=i.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(a)||!Object(s.default)(a.boundingSphere)||Object(s.default)(a.show)&&0===a.show[0]?E.default.FAILED:(a.boundingSphere.clone(t),E.default.DONE)},Eu.prototype.removeAllPrimitives=function(){var e=this.primitives,t=this.primitive;Object(s.default)(t)&&(e.remove(t),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());var i=this.oldPrimitive;Object(s.default)(i)&&(e.remove(i),this.oldPrimitive=void 0)},Pu.prototype.add=function(e,t){var i,a,r=t.createOutlineGeometryInstance(e),n=this._scene.clampLineWidth(t.outlineWidth);255===r.attributes.color.value[3]?(a=(i=this._solidBatches).get(n),Object(s.default)(a)||(a=new Eu(this._primitives,!1,n,this._shadows),i.set(n,a)),a.add(t,r)):(a=(i=this._translucentBatches).get(n),Object(s.default)(a)||(a=new Eu(this._primitives,!0,n,this._shadows),i.set(n,a)),a.add(t,r))},Pu.prototype.remove=function(e){var t,i=this._solidBatches.values,a=i.length;for(t=0;t<a;t++)if(i[t].remove(e))return;var r=this._translucentBatches.values,n=r.length;for(t=0;t<n;t++)if(r[t].remove(e))return},Pu.prototype.update=function(e){var t,i,a,r,n,o=this._solidBatches.values,s=o.length,l=this._translucentBatches.values,u=l.length,d=!0,f=!1;do{for(f=!1,i=0;i<s;i++){d=(r=o[i]).update(e);var c=(n=r.itemsToRemove).length;if(c>0)for(f=!0,t=0;t<c;t++)a=n[t],r.remove(a),this.add(e,a)}for(i=0;i<u;i++){d=(r=l[i]).update(e);var h=(n=r.itemsToRemove).length;if(h>0)for(f=!0,t=0;t<h;t++)a=n[t],r.remove(a),this.add(e,a)}}while(f);return d},Pu.prototype.getBoundingSphere=function(e,t){var i,a=this._solidBatches.values,r=a.length;for(i=0;i<r;i++){var n=a[i];if(n.contains(e))return n.getBoundingSphere(e,t)}var o=this._translucentBatches.values,s=o.length;for(i=0;i<s;i++){var l=o[i];if(l.contains(e))return l.getBoundingSphere(e,t)}return E.default.FAILED},Pu.prototype.removeAllPrimitives=function(){var e,t=this._solidBatches.values,i=t.length;for(e=0;e<i;e++)t[e].removeAllPrimitives();var a=this._translucentBatches.values,r=a.length;for(e=0;e<r;e++)a[e].removeAllPrimitives()};var Au=Pu,Su={};function Du(e,t){return Le.default.equalsEpsilon(e.latitude,t.latitude,Le.default.EPSILON14)&&Le.default.equalsEpsilon(e.longitude,t.longitude,Le.default.EPSILON14)}var Iu=new Ne.default,Mu=new Ne.default;var Fu=new Array(2),Ru=new Array(2),Nu={positions:void 0,height:void 0,granularity:void 0,ellipsoid:void 0};Su.computePositions=function(e,t,i,a,r,n){var o=function(e,t,i,a){var r=t.length;if(!(r<2)){var n=Object(s.default)(a),o=Object(s.default)(i),l=!0,u=new Array(r),d=new Array(r),f=new Array(r),c=t[0];u[0]=c;var h=e.cartesianToCartographic(c,Iu);o&&(h.height=i[0]),l=l&&h.height<=0,d[0]=h.height,f[0]=n?a[0]:0;for(var m=1,p=1;p<r;++p){var _=t[p],g=e.cartesianToCartographic(_,Mu);o&&(g.height=i[p]),l=l&&g.height<=0,Du(h,g)?h.height<g.height&&(d[m-1]=g.height):(u[m]=_,d[m]=g.height,f[m]=n?a[p]:0,Ne.default.clone(g,h),++m)}if(!(l||m<2))return u.length=m,d.length=m,f.length=m,{positions:u,topHeights:d,bottomHeights:f}}}(e,t,i,a);if(Object(s.default)(o)){if(t=o.positions,i=o.topHeights,a=o.bottomHeights,t.length>=3){var l=at.default.fromPoints(t,e).projectPointsOntoPlane(t);vi.a.computeWindingOrder2D(l)===ho.default.CLOCKWISE&&(t.reverse(),i.reverse(),a.reverse())}var u,d,f=t.length,c=f-2,h=Le.default.chordLength(r,e.maximumRadius),m=Nu;if(m.minDistance=h,m.ellipsoid=e,n){var p,_=0;for(p=0;p<f-1;p++)_+=tt.a.numberOfPoints(t[p],t[p+1],h)+1;u=new Float64Array(3*_),d=new Float64Array(3*_);var g=Fu,v=Ru;m.positions=g,m.height=v;var y=0;for(p=0;p<f-1;p++){g[0]=t[p],g[1]=t[p+1],v[0]=i[p],v[1]=i[p+1];var b=tt.a.generateArc(m);u.set(b,y),v[0]=a[p],v[1]=a[p+1],d.set(tt.a.generateArc(m),y),y+=b.length}}else m.positions=t,m.height=i,u=new Float64Array(tt.a.generateArc(m)),m.height=a,d=new Float64Array(tt.a.generateArc(m));return{bottomPositions:d,topPositions:u,numCorners:c}}};var Lu=Su,ju=new v.default,Vu=new v.default,Uu=new v.default,zu=new v.default,Bu=new v.default,Hu=new v.default,ku=new v.default,Wu=new v.default;function Gu(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,i=e.maximumHeights,a=e.minimumHeights,r=Object(o.default)(e.vertexFormat,K.default.DEFAULT),n=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),l=Object(o.default)(e.ellipsoid,hi.default.WGS84);this._positions=t,this._minimumHeights=a,this._maximumHeights=i,this._vertexFormat=K.default.clone(r),this._granularity=n,this._ellipsoid=hi.default.clone(l),this._workerName="createWallGeometry";var u=1+t.length*v.default.packedLength+2;Object(s.default)(a)&&(u+=a.length),Object(s.default)(i)&&(u+=i.length),this.packedLength=u+hi.default.packedLength+K.default.packedLength+1}Gu.pack=function(e,t,i){var a;i=Object(o.default)(i,0);var r=e._positions,n=r.length;for(t[i++]=n,a=0;a<n;++a,i+=v.default.packedLength)v.default.pack(r[a],t,i);var l=e._minimumHeights;if(n=Object(s.default)(l)?l.length:0,t[i++]=n,Object(s.default)(l))for(a=0;a<n;++a)t[i++]=l[a];var u=e._maximumHeights;if(n=Object(s.default)(u)?u.length:0,t[i++]=n,Object(s.default)(u))for(a=0;a<n;++a)t[i++]=u[a];return hi.default.pack(e._ellipsoid,t,i),i+=hi.default.packedLength,K.default.pack(e._vertexFormat,t,i),t[i+=K.default.packedLength]=e._granularity,t};var Yu=hi.default.clone(hi.default.UNIT_SPHERE),Xu=new K.default,Qu={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:Yu,vertexFormat:Xu,granularity:void 0};Gu.unpack=function(e,t,i){var a;t=Object(o.default)(t,0);var r,n,l=e[t++],u=new Array(l);for(a=0;a<l;++a,t+=v.default.packedLength)u[a]=v.default.unpack(e,t);if((l=e[t++])>0)for(r=new Array(l),a=0;a<l;++a)r[a]=e[t++];if((l=e[t++])>0)for(n=new Array(l),a=0;a<l;++a)n[a]=e[t++];var d=hi.default.unpack(e,t,Yu);t+=hi.default.packedLength;var f=K.default.unpack(e,t,Xu),c=e[t+=K.default.packedLength];return Object(s.default)(i)?(i._positions=u,i._minimumHeights=r,i._maximumHeights=n,i._ellipsoid=hi.default.clone(d,i._ellipsoid),i._vertexFormat=K.default.clone(f,i._vertexFormat),i._granularity=c,i):(Qu.positions=u,Qu.minimumHeights=r,Qu.maximumHeights=n,Qu.granularity=c,new Gu(Qu))},Gu.fromConstantHeights=function(e){var t,i,a=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,r=e.minimumHeight,n=e.maximumHeight,l=Object(s.default)(r),u=Object(s.default)(n);if(l||u){var d=a.length;t=l?new Array(d):void 0,i=u?new Array(d):void 0;for(var f=0;f<d;++f)l&&(t[f]=r),u&&(i[f]=n)}return new Gu({positions:a,maximumHeights:i,minimumHeights:t,ellipsoid:e.ellipsoid,vertexFormat:e.vertexFormat})},Gu.createGeometry=function(e){var t=e._positions,i=e._minimumHeights,a=e._maximumHeights,n=e._vertexFormat,o=e._granularity,l=e._ellipsoid,u=Lu.computePositions(l,t,a,i,o,!0);if(Object(s.default)(u)){var d,f=u.bottomPositions,c=u.topPositions,h=u.numCorners,m=c.length,p=2*m,_=n.position?new Float64Array(p):void 0,g=n.normal?new Float32Array(p):void 0,y=n.tangent?new Float32Array(p):void 0,b=n.bitangent?new Float32Array(p):void 0,w=n.st?new Float32Array(p/3*2):void 0,x=0,O=0,C=0,T=0,E=0,P=Wu,A=ku,S=Hu,D=!0,I=0,M=1/((m/=3)-t.length+1);for(d=0;d<m;++d){var F=3*d,R=v.default.fromArray(c,F,ju),N=v.default.fromArray(f,F,Vu);if(n.position&&(_[x++]=N.x,_[x++]=N.y,_[x++]=N.z,_[x++]=R.x,_[x++]=R.y,_[x++]=R.z),n.st&&(w[E++]=I,w[E++]=0,w[E++]=I,w[E++]=1),n.normal||n.tangent||n.bitangent){var L,j=v.default.clone(v.default.ZERO,Bu),V=l.scaleToGeodeticSurface(v.default.fromArray(c,F,Vu),Vu);if(d+1<m&&(L=l.scaleToGeodeticSurface(v.default.fromArray(c,F+3,Uu),Uu),j=v.default.fromArray(c,F+3,Bu)),D){var U=v.default.subtract(j,R,zu),z=v.default.subtract(V,R,ju);P=v.default.normalize(v.default.cross(z,U,P),P),D=!1}v.default.equalsEpsilon(L,V,Le.default.EPSILON10)?D=!0:(I+=M,n.tangent&&(A=v.default.normalize(v.default.subtract(L,V,A),A)),n.bitangent&&(S=v.default.normalize(v.default.cross(P,A,S),S))),n.normal&&(g[O++]=P.x,g[O++]=P.y,g[O++]=P.z,g[O++]=P.x,g[O++]=P.y,g[O++]=P.z),n.tangent&&(y[T++]=A.x,y[T++]=A.y,y[T++]=A.z,y[T++]=A.x,y[T++]=A.y,y[T++]=A.z),n.bitangent&&(b[C++]=S.x,b[C++]=S.y,b[C++]=S.z,b[C++]=S.x,b[C++]=S.y,b[C++]=S.z)}}var B=new _i.a;n.position&&(B.position=new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:_})),n.normal&&(B.normal=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:g})),n.tangent&&(B.tangent=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:y})),n.bitangent&&(B.bitangent=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:b})),n.st&&(B.st=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:w}));var H=p/3;p-=6*(h+1);var k=gi.a.createTypedArray(H,p),W=0;for(d=0;d<H-2;d+=2){var G=d,Y=d+2,X=v.default.fromArray(_,3*G,ju),Q=v.default.fromArray(_,3*Y,Vu);if(!v.default.equalsEpsilon(X,Q,Le.default.EPSILON10)){var q=d+1,Z=d+3;k[W++]=q,k[W++]=G,k[W++]=Z,k[W++]=Z,k[W++]=G,k[W++]=Y}}return new mi.a({attributes:B,indices:k,primitiveType:yi.a.TRIANGLES,boundingSphere:new r.default.fromVertices(_)})}};var qu=Gu,Zu=new v.default,Ku=new v.default;function Ju(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,i=e.maximumHeights,a=e.minimumHeights,r=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),n=Object(o.default)(e.ellipsoid,hi.default.WGS84);this._positions=t,this._minimumHeights=a,this._maximumHeights=i,this._granularity=r,this._ellipsoid=hi.default.clone(n),this._workerName="createWallOutlineGeometry";var l=1+t.length*v.default.packedLength+2;Object(s.default)(a)&&(l+=a.length),Object(s.default)(i)&&(l+=i.length),this.packedLength=l+hi.default.packedLength+1}Ju.pack=function(e,t,i){var a;i=Object(o.default)(i,0);var r=e._positions,n=r.length;for(t[i++]=n,a=0;a<n;++a,i+=v.default.packedLength)v.default.pack(r[a],t,i);var l=e._minimumHeights;if(n=Object(s.default)(l)?l.length:0,t[i++]=n,Object(s.default)(l))for(a=0;a<n;++a)t[i++]=l[a];var u=e._maximumHeights;if(n=Object(s.default)(u)?u.length:0,t[i++]=n,Object(s.default)(u))for(a=0;a<n;++a)t[i++]=u[a];return hi.default.pack(e._ellipsoid,t,i),t[i+=hi.default.packedLength]=e._granularity,t};var $u=hi.default.clone(hi.default.UNIT_SPHERE),ed={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:$u,granularity:void 0};Ju.unpack=function(e,t,i){var a;t=Object(o.default)(t,0);var r,n,l=e[t++],u=new Array(l);for(a=0;a<l;++a,t+=v.default.packedLength)u[a]=v.default.unpack(e,t);if((l=e[t++])>0)for(r=new Array(l),a=0;a<l;++a)r[a]=e[t++];if((l=e[t++])>0)for(n=new Array(l),a=0;a<l;++a)n[a]=e[t++];var d=hi.default.unpack(e,t,$u),f=e[t+=hi.default.packedLength];return Object(s.default)(i)?(i._positions=u,i._minimumHeights=r,i._maximumHeights=n,i._ellipsoid=hi.default.clone(d,i._ellipsoid),i._granularity=f,i):(ed.positions=u,ed.minimumHeights=r,ed.maximumHeights=n,ed.granularity=f,new Ju(ed))},Ju.fromConstantHeights=function(e){var t,i,a=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,r=e.minimumHeight,n=e.maximumHeight,l=Object(s.default)(r),u=Object(s.default)(n);if(l||u){var d=a.length;t=l?new Array(d):void 0,i=u?new Array(d):void 0;for(var f=0;f<d;++f)l&&(t[f]=r),u&&(i[f]=n)}return new Ju({positions:a,maximumHeights:i,minimumHeights:t,ellipsoid:e.ellipsoid})},Ju.createGeometry=function(e){var t=e._positions,i=e._minimumHeights,a=e._maximumHeights,n=e._granularity,o=e._ellipsoid,l=Lu.computePositions(o,t,a,i,n,!1);if(Object(s.default)(l)){var u,d=l.bottomPositions,f=l.topPositions,c=f.length,h=2*c,m=new Float64Array(h),p=0;for(c/=3,u=0;u<c;++u){var _=3*u,g=v.default.fromArray(f,_,Zu),y=v.default.fromArray(d,_,Ku);m[p++]=y.x,m[p++]=y.y,m[p++]=y.z,m[p++]=g.x,m[p++]=g.y,m[p++]=g.z}var b=new _i.a({position:new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:m})}),w=h/3;h=2*w-4+w;var x=gi.a.createTypedArray(w,h),O=0;for(u=0;u<w-2;u+=2){var C=u,T=u+2,E=v.default.fromArray(m,3*C,Zu),P=v.default.fromArray(m,3*T,Ku);if(!v.default.equalsEpsilon(E,P,Le.default.EPSILON10)){var A=u+1,S=u+3;x[O++]=A,x[O++]=C,x[O++]=A,x[O++]=S,x[O++]=C,x[O++]=T}}return x[O++]=w-2,x[O++]=w-1,new mi.a({attributes:b,indices:x,primitiveType:yi.a.LINES,boundingSphere:new r.default.fromVertices(m)})}};var td=Ju,id=new y.default;function ad(e){this.id=e,this.vertexFormat=void 0,this.positions=void 0,this.minimumHeights=void 0,this.maximumHeights=void 0,this.granularity=void 0}function rd(e,t){Fe.call(this,{entity:e,scene:t,geometryOptions:new ad(e),geometryPropertyName:"wall",observedPropertyNames:["availability","wall"]}),this._onEntityPropertyChanged(e,"wall",e.wall,void 0)}function nd(e,t,i){be.call(this,e,t,i)}Object(s.default)(Object.create)&&(rd.prototype=Object.create(Fe.prototype),rd.prototype.constructor=rd),rd.prototype.createFillGeometryInstance=function(e){var t,i,a=this._entity,r=a.isAvailable(e),n=new me.a(r&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),l=ue.fromDistanceDisplayCondition(o);this._materialProperty instanceof pe.default?(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(i=this._materialProperty.color.getValue(e,id)),Object(s.default)(i)||(i=y.default.WHITE),t={show:n,distanceDisplayCondition:l,color:oe.a.fromColor(i)}):t={show:n,distanceDisplayCondition:l};return new de.a({id:a,geometry:new qu(this._options),attributes:t})},rd.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,i=t.isAvailable(e),a=P.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,id),r=this._distanceDisplayConditionProperty.getValue(e);return new de.a({id:t,geometry:new td(this._options),attributes:{show:new me.a(i&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(a),distanceDisplayCondition:ue.fromDistanceDisplayCondition(r)}})},rd.prototype._isHidden=function(e,t){return!Object(s.default)(t.positions)||Fe.prototype._isHidden.call(this,e,t)},rd.prototype._getIsClosed=function(e){return!1},rd.prototype._isDynamic=function(e,t){return!(t.positions.isConstant&&P.default.isConstant(t.minimumHeights)&&P.default.isConstant(t.maximumHeights)&&P.default.isConstant(t.outlineWidth)&&P.default.isConstant(t.granularity))},rd.prototype._setStaticOptions=function(e,t){var i=t.minimumHeights,a=t.maximumHeights,r=t.granularity,n=this._materialProperty instanceof pe.default,o=this._options;o.vertexFormat=n?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,o.positions=t.positions.getValue(ce.default.MINIMUM_VALUE,o.positions),o.minimumHeights=Object(s.default)(i)?i.getValue(ce.default.MINIMUM_VALUE,o.minimumHeights):void 0,o.maximumHeights=Object(s.default)(a)?a.getValue(ce.default.MINIMUM_VALUE,o.maximumHeights):void 0,o.granularity=Object(s.default)(r)?r.getValue(ce.default.MINIMUM_VALUE):void 0},rd.DynamicGeometryUpdater=nd,Object(s.default)(Object.create)&&(nd.prototype=Object.create(be.prototype),nd.prototype.constructor=nd),nd.prototype._isHidden=function(e,t,i){return!Object(s.default)(this._options.positions)||be.prototype._isHidden.call(this,e,t,i)},nd.prototype._setOptions=function(e,t,i){var a=this._options;a.positions=P.default.getValueOrUndefined(t.positions,i,a.positions),a.minimumHeights=P.default.getValueOrUndefined(t.minimumHeights,i,a.minimumHeights),a.maximumHeights=P.default.getValueOrUndefined(t.maximumHeights,i,a.maximumHeights),a.granularity=P.default.getValueOrUndefined(t.granularity,i)};var od=[],sd=[Ze,La,ca,Gr,nn,Sn,fs,Ps,vl,rd];function ld(e,t){this.entity=e,this.scene=t;var i=new Array(sd.length),a=new q.default;function r(e){a.raiseEvent(e)}for(var n=new u.default,o=0;o<i.length;o++){var s=new sd[o](e,t);n.add(s.geometryChanged,r),i[o]=s}this.updaters=i,this.geometryChanged=a,this.eventHelper=n,this._removeEntitySubscription=e.definitionChanged.addEventListener(ld.prototype._onEntityPropertyChanged,this)}function ud(e,t,i,a){i=Object(o.default)(i,e.primitives),a=Object(o.default)(a,e.groundPrimitives),this._scene=e,this._primitives=i,this._groundPrimitives=a,this._entityCollection=void 0,this._addedObjects=new p.default,this._removedObjects=new p.default,this._changedObjects=new p.default;var r=ae.default.NUMBER_OF_SHADOW_MODES;this._outlineBatches=new Array(2*r),this._closedColorBatches=new Array(2*r),this._closedMaterialBatches=new Array(2*r),this._openColorBatches=new Array(2*r),this._openMaterialBatches=new Array(2*r);var n,s=Oe.default.supportsMaterialsforEntitiesOnTerrain(e);for(this._supportsMaterialsforEntitiesOnTerrain=s,n=0;n<r;++n)this._outlineBatches[n]=new Au(i,e,n,!1),this._outlineBatches[r+n]=new Au(i,e,n,!0),this._closedColorBatches[n]=new Il(i,ie.a,void 0,!0,n,!0),this._closedColorBatches[r+n]=new Il(i,ie.a,void 0,!0,n,!1),this._closedMaterialBatches[n]=new Ul(i,te,void 0,!0,n,!0),this._closedMaterialBatches[r+n]=new Ul(i,te,void 0,!0,n,!1),this._openColorBatches[n]=new Il(i,ie.a,void 0,!1,n,!0),this._openColorBatches[r+n]=new Il(i,ie.a,void 0,!1,n,!1),this._openMaterialBatches[n]=new Ul(i,te,void 0,!1,n,!0),this._openMaterialBatches[r+n]=new Ul(i,te,void 0,!1,n,!1);var l=Z.a.NUMBER_OF_CLASSIFICATION_TYPES,u=new Array(l),d=[];if(s)for(n=0;n<l;++n)d.push(new bu(a,n,te)),u[n]=new mu(a,n);else for(n=0;n<l;++n)u[n]=new mu(a,n);this._groundColorBatches=u,this._groundMaterialBatches=d,this._dynamicBatch=new Va(i,a),this._batches=this._outlineBatches.concat(this._closedColorBatches,this._closedMaterialBatches,this._openColorBatches,this._openMaterialBatches,this._groundColorBatches,this._groundMaterialBatches,this._dynamicBatch),this._subscriptions=new p.default,this._updaterSets=new p.default,this._entityCollection=t,t.collectionChanged.addEventListener(ud.prototype._onCollectionChanged,this),this._onCollectionChanged(t,t.values,od)}ld.prototype._onEntityPropertyChanged=function(e,t,i,a){for(var r=this.updaters,n=0;n<r.length;n++)r[n]._onEntityPropertyChanged(e,t,i,a)},ld.prototype.forEach=function(e){for(var t=this.updaters,i=0;i<t.length;i++)e(t[i])},ld.prototype.destroy=function(){this.eventHelper.removeAll();for(var e=this.updaters,t=0;t<e.length;t++)e[t].destroy();this._removeEntitySubscription(),Object(l.default)(this)},ud.prototype.update=function(e){var t,i,a,r,n=this._addedObjects,o=n.values,s=this._removedObjects,l=s.values,u=this._changedObjects,d=u.values,f=this;for(t=d.length-1;t>-1;t--)a=(i=d[t]).id,(r=this._updaterSets.get(a)).entity===i?r.forEach((function(t){f._removeUpdater(t),f._insertUpdaterIntoBatch(e,t)})):(l.push(i),o.push(i));for(t=l.length-1;t>-1;t--)a=(i=l[t]).id,(r=this._updaterSets.get(a)).forEach(this._removeUpdater.bind(this)),r.destroy(),this._updaterSets.remove(a),this._subscriptions.get(a)(),this._subscriptions.remove(a);for(t=o.length-1;t>-1;t--)a=(i=o[t]).id,r=new ld(i,this._scene),this._updaterSets.set(a,r),r.forEach((function(t){f._insertUpdaterIntoBatch(e,t)})),this._subscriptions.set(a,r.geometryChanged.addEventListener(ud._onGeometryChanged,this));n.removeAll(),s.removeAll(),u.removeAll();var c=!0,h=this._batches,m=h.length;for(t=0;t<m;t++)c=h[t].update(e)&&c;return c};var dd=[],fd=new r.default;ud.prototype.getBoundingSphere=function(e,t){for(var i=dd,a=fd,n=0,o=E.default.DONE,s=this._batches,l=s.length,u=e.id,d=this._updaterSets.get(u).updaters,f=0;f<d.length;f++)for(var c=d[f],h=0;h<l;h++){if((o=s[h].getBoundingSphere(c,a))===E.default.PENDING)return E.default.PENDING;o===E.default.DONE&&(i[n]=r.default.clone(a,i[n]),n++)}return 0===n?E.default.FAILED:(i.length=n,r.default.fromBoundingSpheres(i,t),E.default.DONE)},ud.prototype.isDestroyed=function(){return!1},ud.prototype.destroy=function(){var e;this._entityCollection.collectionChanged.removeEventListener(ud.prototype._onCollectionChanged,this),this._addedObjects.removeAll(),this._removedObjects.removeAll();var t=this._batches,i=t.length;for(e=0;e<i;e++)t[e].removeAllPrimitives();var a=this._subscriptions.values;for(i=a.length,e=0;e<i;e++)a[e]();this._subscriptions.removeAll();var r=this._updaterSets.values;for(i=r.length,e=0;e<i;e++)r[e].destroy();return this._updaterSets.removeAll(),Object(l.default)(this)},ud.prototype._removeUpdater=function(e){for(var t=this._batches,i=t.length,a=0;a<i;a++)t[a].remove(e)},ud.prototype._insertUpdaterIntoBatch=function(e,t){if(t.isDynamic)this._dynamicBatch.add(e,t);else{var i;(t.outlineEnabled||t.fillEnabled)&&(i=t.shadowsProperty.getValue(e));var a=ae.default.NUMBER_OF_SHADOW_MODES;if(t.outlineEnabled&&(Object(s.default)(t.terrainOffsetProperty)?this._outlineBatches[a+i].add(e,t):this._outlineBatches[i].add(e,t)),t.fillEnabled)if(t.onTerrain){var r=t.classificationTypeProperty.getValue(e);t.fillMaterialProperty instanceof pe.default?this._groundColorBatches[r].add(e,t):this._groundMaterialBatches[r].add(e,t)}else t.isClosed?t.fillMaterialProperty instanceof pe.default?Object(s.default)(t.terrainOffsetProperty)?this._closedColorBatches[a+i].add(e,t):this._closedColorBatches[i].add(e,t):Object(s.default)(t.terrainOffsetProperty)?this._closedMaterialBatches[a+i].add(e,t):this._closedMaterialBatches[i].add(e,t):t.fillMaterialProperty instanceof pe.default?Object(s.default)(t.terrainOffsetProperty)?this._openColorBatches[a+i].add(e,t):this._openColorBatches[i].add(e,t):Object(s.default)(t.terrainOffsetProperty)?this._openMaterialBatches[a+i].add(e,t):this._openMaterialBatches[i].add(e,t)}},ud._onGeometryChanged=function(e){var t=this._removedObjects,i=this._changedObjects,a=e.entity,r=a.id;Object(s.default)(t.get(r))||Object(s.default)(i.get(r))||i.set(r,a)},ud.prototype._onCollectionChanged=function(e,t,i){var a,r,n,o=this._addedObjects,s=this._removedObjects,l=this._changedObjects;for(a=i.length-1;a>-1;a--)r=(n=i[a]).id,o.remove(r)||(s.set(r,n),l.remove(r));for(a=t.length-1;a>-1;a--)r=(n=t[a]).id,s.remove(r)?l.set(r,n):o.set(r,n)};var cd=ud,hd=i(233),md=hd.a.FILL,pd=y.default.WHITE,_d=y.default.BLACK,gd=new y.default(.165,.165,.165,.8),vd=new g.default(7,5),yd=g.default.ZERO,bd=v.default.ZERO,wd=O.default.NONE,xd=C.default.CENTER,Od=T.default.CENTER,Cd=new v.default,Td=new y.default,Ed=new y.default,Pd=new y.default,Ad=new g.default,Sd=new v.default,Dd=new g.default,Id=new x.a,Md=new x.a,Fd=new x.a,Rd=new w.a;function Nd(e){this.entity=e,this.label=void 0,this.index=void 0}function Ld(e,t){t.collectionChanged.addEventListener(Ld.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new p.default,this._onCollectionChanged(t,t.values,[],[])}function jd(e,t,i){Object(s.default)(e)&&(e.label=void 0,i.removeLabel(t))}Ld.prototype.update=function(e){for(var t=this._items.values,i=this._cluster,a=0,r=t.length;a<r;a++){var n,o,l=t[a],u=l.entity,d=u._label,f=l.label,c=u.isShowing&&u.isAvailable(e)&&P.default.getValueOrDefault(d._show,e,!0);if(c&&(o=P.default.getValueOrUndefined(u._position,e,Cd),n=P.default.getValueOrUndefined(d._text,e),c=Object(s.default)(o)&&Object(s.default)(n)),c){P.default.isConstant(u._position)||(i._clusterDirty=!0);var h=!1,m=P.default.getValueOrDefault(d._heightReference,e,wd);Object(s.default)(f)||((f=i.getLabel(u)).id=u,l.label=f,h=v.default.equals(f.position,o)&&f.heightReference===m),f.show=!0,f.position=o,f.text=n,f.scale=P.default.getValueOrDefault(d._scale,e,1),f.font=P.default.getValueOrDefault(d._font,e,"30px sans-serif"),f.style=P.default.getValueOrDefault(d._style,e,md),f.fillColor=P.default.getValueOrDefault(d._fillColor,e,pd,Td),f.outlineColor=P.default.getValueOrDefault(d._outlineColor,e,_d,Ed),f.outlineWidth=P.default.getValueOrDefault(d._outlineWidth,e,1),f.showBackground=P.default.getValueOrDefault(d._showBackground,e,!1),f.backgroundColor=P.default.getValueOrDefault(d._backgroundColor,e,gd,Pd),f.backgroundPadding=P.default.getValueOrDefault(d._backgroundPadding,e,vd,Ad),f.pixelOffset=P.default.getValueOrDefault(d._pixelOffset,e,yd,Dd),f.eyeOffset=P.default.getValueOrDefault(d._eyeOffset,e,bd,Sd),f.heightReference=m,f.horizontalOrigin=P.default.getValueOrDefault(d._horizontalOrigin,e,xd),f.verticalOrigin=P.default.getValueOrDefault(d._verticalOrigin,e,Od),f.translucencyByDistance=P.default.getValueOrUndefined(d._translucencyByDistance,e,Id),f.pixelOffsetScaleByDistance=P.default.getValueOrUndefined(d._pixelOffsetScaleByDistance,e,Md),f.scaleByDistance=P.default.getValueOrUndefined(d._scaleByDistance,e,Fd),f.distanceDisplayCondition=P.default.getValueOrUndefined(d._distanceDisplayCondition,e,Rd),f.disableDepthTestDistance=P.default.getValueOrUndefined(d._disableDepthTestDistance,e),h&&f._updateClamping()}else jd(l,u,i)}return!0},Ld.prototype.getBoundingSphere=function(e,t){var i=this._items.get(e.id);if(!Object(s.default)(i)||!Object(s.default)(i.label))return E.default.FAILED;var a=i.label;return t.center=v.default.clone(Object(o.default)(a._clampedPosition,a.position),t.center),t.radius=0,E.default.DONE},Ld.prototype.isDestroyed=function(){return!1},Ld.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Ld.prototype._onCollectionChanged,this);for(var e=this._entityCollection.values,t=0;t<e.length;t++)this._cluster.removeLabel(e[t]);return Object(l.default)(this)},Ld.prototype._onCollectionChanged=function(e,t,i,a){var r,n,o=this._items,l=this._cluster;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._label)&&Object(s.default)(n._position)&&o.set(n.id,new Nd(n));for(r=a.length-1;r>-1;r--)n=a[r],Object(s.default)(n._label)&&Object(s.default)(n._position)?o.contains(n.id)||o.set(n.id,new Nd(n)):(jd(o.get(n.id),n,l),o.remove(n.id));for(r=i.length-1;r>-1;r--)n=i[r],jd(o.get(n.id),n,l),o.remove(n.id)};var Vd=Ld,Ud=i(186),zd=i(39),Bd=i(447),Hd=i(287),kd=i(449),Wd=ae.default.ENABLED,Gd=O.default.NONE,Yd=y.default.RED,Xd=y.default.WHITE,Qd=Bd.a.HIGHLIGHT,qd=new g.default(1,1),Zd=Ud.default.Y,Kd=new rt.default,Jd=new rt.default;function $d(e,t){t.collectionChanged.addEventListener($d.prototype._onCollectionChanged,this),this._scene=e,this._primitives=e.primitives,this._entityCollection=t,this._modelHash={},this._entitiesToVisualize=new p.default,this._onCollectionChanged(t,t.values,[],[])}function ef(e,t,i,a){var r=i[t.id];Object(s.default)(r)&&(a.removeAndDestroy(r.modelPrimitive),delete i[t.id])}function tf(e,t){var i=t[e.id];Object(s.default)(i)&&(i.nodeTransformationsScratch={},i.articulationsScratch={})}function af(e,t,i){e.readyPromise.otherwise((function(e){console.error(e),i[t.id].loadFail=!0}))}$d.prototype.update=function(e){for(var t=this._entitiesToVisualize.values,i=this._modelHash,a=this._primitives,r=0,n=t.length;r<n;r++){var o,l,u=t[r],d=u._model,f=i[u.id],c=u.isShowing&&u.isAvailable(e)&&P.default.getValueOrDefault(d._show,e,!0);if(c&&(l=u.computeModelMatrix(e,Kd),o=zd.default.createIfNeeded(P.default.getValueOrUndefined(d._uri,e)),c=Object(s.default)(l)&&Object(s.default)(o)),c){var h=Object(s.default)(f)?f.modelPrimitive:void 0;if(Object(s.default)(h)&&o.url===f.url||(Object(s.default)(h)&&(a.removeAndDestroy(h),delete i[u.id]),(h=Hd.default.fromGltf({url:o,incrementallyLoadTextures:P.default.getValueOrDefault(d._incrementallyLoadTextures,e,!0),scene:this._scene})).id=u,a.add(h),f={modelPrimitive:h,url:o.url,animationsRunning:!1,nodeTransformationsScratch:{},articulationsScratch:{},loadFail:!1},i[u.id]=f,af(h,u,i)),h.show=!0,h.scale=P.default.getValueOrDefault(d._scale,e,1),h.minimumPixelSize=P.default.getValueOrDefault(d._minimumPixelSize,e,0),h.maximumScale=P.default.getValueOrUndefined(d._maximumScale,e),h.modelMatrix=rt.default.clone(l,h.modelMatrix),h.shadows=P.default.getValueOrDefault(d._shadows,e,Wd),h.heightReference=P.default.getValueOrDefault(d._heightReference,e,Gd),h.distanceDisplayCondition=P.default.getValueOrUndefined(d._distanceDisplayCondition,e),h.silhouetteColor=P.default.getValueOrDefault(d._silhouetteColor,e,Yd,h._silhouetteColor),h.silhouetteSize=P.default.getValueOrDefault(d._silhouetteSize,e,0),h.color=P.default.getValueOrDefault(d._color,e,Xd,h._color),h.colorBlendMode=P.default.getValueOrDefault(d._colorBlendMode,e,Qd),h.colorBlendAmount=P.default.getValueOrDefault(d._colorBlendAmount,e,.5),h.clippingPlanes=P.default.getValueOrUndefined(d._clippingPlanes,e),h.clampAnimations=P.default.getValueOrDefault(d._clampAnimations,e,!0),h.imageBasedLightingFactor=P.default.getValueOrDefault(d._imageBasedLightingFactor,e,qd),h.lightColor=P.default.getValueOrUndefined(d._lightColor,e),h._upAxis=P.default.getValueOrDefault(d._upAxis,e,Zd),h._forwardAxis=P.default.getValueOrUndefined(d._forwardAxis,e),h.ready){var m=P.default.getValueOrDefault(d._runAnimations,e,!0);f.animationsRunning!==m&&(m?h.activeAnimations.addAll({loop:kd.a.REPEAT}):h.activeAnimations.removeAll(),f.animationsRunning=m);var p=P.default.getValueOrUndefined(d._nodeTransformations,e,f.nodeTransformationsScratch);if(Object(s.default)(p))for(var _=Object.keys(p),g=0,v=_.length;g<v;++g){var y=_[g],b=p[y];if(Object(s.default)(b)){var w=h.getNode(y);if(Object(s.default)(w)){var x=rt.default.fromTranslationRotationScale(b,Jd);w.matrix=rt.default.multiply(w.originalMatrix,x,x)}}}var O=!1,C=P.default.getValueOrUndefined(d._articulations,e,f.articulationsScratch);if(Object(s.default)(C))for(var T=Object.keys(C),E=0,A=T.length;E<A;++E){var S=T[E],D=C[S];Object(s.default)(D)&&(O=!0,h.setArticulationStage(S,D))}O&&h.applyArticulations()}}else Object(s.default)(f)&&(f.modelPrimitive.show=!1)}return!0},$d.prototype.isDestroyed=function(){return!1},$d.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener($d.prototype._onCollectionChanged,this);for(var e=this._entitiesToVisualize.values,t=this._modelHash,i=this._primitives,a=e.length-1;a>-1;a--)ef(this,e[a],t,i);return Object(l.default)(this)},$d.prototype.getBoundingSphere=function(e,t){var i=this._modelHash[e.id];if(!Object(s.default)(i)||i.loadFail)return E.default.FAILED;var a=i.modelPrimitive;if(!Object(s.default)(a)||!a.show)return E.default.FAILED;if(!a.ready)return E.default.PENDING;if(a.heightReference===O.default.NONE)r.default.transform(a.boundingSphere,a.modelMatrix,t);else{if(!Object(s.default)(a._clampedModelMatrix)||a._heightChanged)return E.default.PENDING;r.default.transform(a.boundingSphere,a._clampedModelMatrix,t)}return E.default.DONE},$d.prototype._onCollectionChanged=function(e,t,i,a){var r,n,o=this._entitiesToVisualize,l=this._modelHash,u=this._primitives;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._model)&&Object(s.default)(n._position)&&o.set(n.id,n);for(r=a.length-1;r>-1;r--)n=a[r],Object(s.default)(n._model)&&Object(s.default)(n._position)?(tf(n,l),o.set(n.id,n)):(ef(this,n,l,u),o.remove(n.id));for(r=i.length-1;r>-1;r--)ef(this,n=i[r],l,u),o.remove(n.id)};var rf=$d,nf=i(775),of=new rt.default;function sf(e,t){t.collectionChanged.addEventListener(sf.prototype._onCollectionChanged,this),this._scene=e,this._primitives=e.primitives,this._entityCollection=t,this._tilesetHash={},this._entitiesToVisualize=new p.default,this._onCollectionChanged(t,t.values,[],[])}function lf(e,t,i,a){var r=i[t.id];Object(s.default)(r)&&(a.removeAndDestroy(r.tilesetPrimitive),delete i[t.id])}function uf(e,t,i){e.readyPromise.otherwise((function(e){console.error(e),i[t.id].loadFail=!0}))}sf.prototype.update=function(e){for(var t=this._entitiesToVisualize.values,i=this._tilesetHash,a=this._primitives,r=0,n=t.length;r<n;r++){var o,l,u=t[r],d=u._tileset,f=i[u.id],c=u.isShowing&&u.isAvailable(e)&&P.default.getValueOrDefault(d._show,e,!0);if(c&&(l=u.computeModelMatrix(e,of),o=zd.default.createIfNeeded(P.default.getValueOrUndefined(d._uri,e))),c){var h=Object(s.default)(f)?f.tilesetPrimitive:void 0;Object(s.default)(h)&&o.url===f.url||(Object(s.default)(h)&&(a.removeAndDestroy(h),delete i[u.id]),(h=new nf.default({url:o})).id=u,a.add(h),f={tilesetPrimitive:h,url:o.url,loadFail:!1},i[u.id]=f,uf(h,u,i)),h.show=!0,Object(s.default)(l)&&(h.modelMatrix=l),h.maximumScreenSpaceError=P.default.getValueOrDefault(d.maximumScreenSpaceError,e,h.maximumScreenSpaceError)}else Object(s.default)(f)&&(f.tilesetPrimitive.show=!1)}return!0},sf.prototype.isDestroyed=function(){return!1},sf.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(sf.prototype._onCollectionChanged,this);for(var e=this._entitiesToVisualize.values,t=this._tilesetHash,i=this._primitives,a=e.length-1;a>-1;a--)lf(this,e[a],t,i);return Object(l.default)(this)},sf.prototype.getBoundingSphere=function(e,t){var i=this._tilesetHash[e.id];if(!Object(s.default)(i)||i.loadFail)return E.default.FAILED;var a=i.tilesetPrimitive;return Object(s.default)(a)&&a.show?a.ready?(r.default.clone(a.boundingSphere,t),E.default.DONE):E.default.PENDING:E.default.FAILED},sf.prototype._onCollectionChanged=function(e,t,i,a){var r,n,o=this._entitiesToVisualize,l=this._tilesetHash,u=this._primitives;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._tileset)&&o.set(n.id,n);for(r=a.length-1;r>-1;r--)n=a[r],Object(s.default)(n._tileset)?o.set(n.id,n):(lf(this,n,l,u),o.remove(n.id));for(r=i.length-1;r>-1;r--)lf(this,n=i[r],l,u),o.remove(n.id)};var df=sf,ff=i(42),cf=i(137),hf=i(101),mf=i(522),pf=i(367),_f=i(327),gf=i(368),vf=i(335),yf=i(512),bf=i(435),wf=new hf.default,xf=new hf.default,Of=new hf.default;function Cf(e){this.entity=e,this.polyline=void 0,this.index=void 0,this.updater=void 0}function Tf(e,t,i,a,r,n,o,l){for(;e instanceof gf.a;)e=e.resolvedProperty;e instanceof vf.default?o=function(e,t,i,a,r,n,o,l,u){var d,f=l;d=e.getValueInReferenceFrame(t,n,u[f]),Object(s.default)(d)&&(u[f++]=d);for(var c,h,m,p=!Object(s.default)(r)||ff.default.lessThanOrEquals(r,t)||ff.default.greaterThanOrEquals(r,i),_=0,g=a.length,v=a[_],y=i,b=!1;_<g;){if(!p&&ff.default.greaterThanOrEquals(v,r)&&(d=e.getValueInReferenceFrame(r,n,u[f]),Object(s.default)(d)&&(u[f++]=d),p=!0),ff.default.greaterThan(v,t)&&ff.default.lessThan(v,y)&&!v.equals(r)&&(d=e.getValueInReferenceFrame(v,n,u[f]),Object(s.default)(d)&&(u[f++]=d)),_<g-1){if(o>0&&!b){var w=a[_+1],x=ff.default.secondsDifference(w,v);(b=x>o)&&(c=Math.ceil(x/o),h=0,m=x/Math.max(c,2),c=Math.max(c-1,1))}if(b&&h<c){v=ff.default.addSeconds(v,m,new ff.default),h++;continue}}b=!1,v=a[++_]}return d=e.getValueInReferenceFrame(i,n,u[f]),Object(s.default)(d)&&(u[f++]=d),f}(e,t,i,e._property._times,a,r,n,o,l):o=e instanceof pf.a?function(e,t,i,a,r,n,o,s){xf.start=t,xf.stop=i;for(var l=o,u=e.intervals,d=0;d<u.length;d++){var f=u.get(d);if(!hf.default.intersect(f,xf,wf).isEmpty){var c=f.start,h=f.stop,m=t;ff.default.greaterThan(c,m)&&(m=c);var p=i;ff.default.lessThan(h,p)&&(p=h),l=Tf(f.data,m,p,a,r,n,l,s)}}return l}(e,t,i,a,r,n,o,l):e instanceof bf.default?function(e,t,i,a,r,n,o,l){Of.start=t,Of.stop=i;for(var u=o,d=e.intervals,f=0;f<d.length;f++){var c=d.get(f);if(!hf.default.intersect(c,Of,wf).isEmpty){var h=c.start;c.isStartIncluded||(h=c.isStopIncluded?c.stop:ff.default.addSeconds(c.start,ff.default.secondsDifference(c.stop,c.start)/2,new ff.default));var m=e.getValueInReferenceFrame(h,r,l[u]);Object(s.default)(m)&&(l[u]=m,u++)}}return u}(e,t,i,0,r,0,o,l):e instanceof _f.a||e instanceof yf.a&&P.default.isConstant(e)?function(e,t,i,a,r,n,o,l){var u=e.getValueInReferenceFrame(t,r,l[o]);return Object(s.default)(u)&&(l[o++]=u),o}(e,t,0,0,r,0,o,l):function(e,t,i,a,r,n,o,l){for(var u,d=0,f=o,c=t,h=Math.max(n,60),m=!Object(s.default)(a)||ff.default.lessThanOrEquals(a,t)||ff.default.greaterThanOrEquals(a,i);ff.default.lessThan(c,i);)!m&&ff.default.greaterThanOrEquals(c,a)&&(m=!0,u=e.getValueInReferenceFrame(a,r,l[f]),Object(s.default)(u)&&(l[f]=u,f++)),u=e.getValueInReferenceFrame(c,r,l[f]),Object(s.default)(u)&&(l[f]=u,f++),d++,c=ff.default.addSeconds(t,h*d,new ff.default);return u=e.getValueInReferenceFrame(i,r,l[f]),Object(s.default)(u)&&(l[f]=u,f++),f}(e,t,i,a,r,n,o,l);return o}function Ef(e,t,i,a,r,n,o){Object(s.default)(o)||(o=[]);var l=Tf(e,t,i,a,r,n,0,o);return o.length=l,o}var Pf=new et.default;function Af(e,t){this._unusedIndexes=[],this._polylineCollection=new mf.a,this._scene=e,this._referenceFrame=t,e.primitives.add(this._polylineCollection)}function Sf(e,t){t.collectionChanged.addEventListener(Sf.prototype._onCollectionChanged,this),this._scene=e,this._updaters={},this._entityCollection=t,this._items=new p.default,this._onCollectionChanged(t,t.values,[],[])}Af.prototype.update=function(e){if(this._referenceFrame===cf.a.INERTIAL){var t=ot.default.computeIcrfToFixedMatrix(e,Pf);Object(s.default)(t)||(t=ot.default.computeTemeToPseudoFixedMatrix(e,Pf)),rt.default.fromRotationTranslation(t,v.default.ZERO,this._polylineCollection.modelMatrix)}},Af.prototype.updateObject=function(e,t){var i,a,r=t.entity,n=r._path,o=r._position,l=n._show,u=t.polyline,d=r.isShowing&&(!Object(s.default)(l)||l.getValue(e));if(d){var f=P.default.getValueOrUndefined(n._leadTime,e),c=P.default.getValueOrUndefined(n._trailTime,e),h=r._availability,m=Object(s.default)(h),p=Object(s.default)(f),_=Object(s.default)(c);if(d=m||p&&_){if(_&&(i=ff.default.addSeconds(e,-c,new ff.default)),p&&(a=ff.default.addSeconds(e,f,new ff.default)),m){var g=h.start,v=h.stop;_&&!ff.default.greaterThan(g,i)||(i=g),p&&!ff.default.lessThan(v,a)||(a=v)}d=ff.default.lessThan(i,a)}}if(d){if(!Object(s.default)(u)){var y=this._unusedIndexes;if(y.length>0){var b=y.pop();u=this._polylineCollection.get(b),t.index=b}else t.index=this._polylineCollection.length,u=this._polylineCollection.add();u.id=r,t.polyline=u}var w=P.default.getValueOrDefault(n._resolution,e,60);u.show=!0,u.positions=Ef(o,i,a,e,this._referenceFrame,w,u.positions.slice()),u.material=ve.getValue(e,n._material,u.material),u.width=P.default.getValueOrDefault(n._width,e,1),u.distanceDisplayCondition=P.default.getValueOrUndefined(n._distanceDisplayCondition,e,u.distanceDisplayCondition)}else Object(s.default)(u)&&(this._unusedIndexes.push(t.index),t.polyline=void 0,u.show=!1,t.index=void 0)},Af.prototype.removeObject=function(e){var t=e.polyline;Object(s.default)(t)&&(this._unusedIndexes.push(e.index),e.polyline=void 0,t.show=!1,t.id=void 0,e.index=void 0)},Af.prototype.destroy=function(){return this._scene.primitives.remove(this._polylineCollection),Object(l.default)(this)},Sf.prototype.update=function(e){var t=this._updaters;for(var i in t)t.hasOwnProperty(i)&&t[i].update(e);var a=this._items.values;if(0===a.length&&Object(s.default)(this._updaters)&&Object.keys(this._updaters).length>0){for(var r in t)t.hasOwnProperty(r)&&t[r].destroy();this._updaters={}}for(var n=0,o=a.length;n<o;n++){var l=a[n],u=l.entity._position,d=l.updater,f=cf.a.FIXED;this._scene.mode===je.a.SCENE3D&&(f=u.referenceFrame);var c=this._updaters[f];d===c&&Object(s.default)(c)?c.updateObject(e,l):(Object(s.default)(d)&&d.removeObject(l),Object(s.default)(c)||((c=new Af(this._scene,f)).update(e),this._updaters[f]=c),l.updater=c,Object(s.default)(c)&&c.updateObject(e,l))}return!0},Sf.prototype.isDestroyed=function(){return!1},Sf.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Sf.prototype._onCollectionChanged,this);var e=this._updaters;for(var t in e)e.hasOwnProperty(t)&&e[t].destroy();return Object(l.default)(this)},Sf.prototype._onCollectionChanged=function(e,t,i,a){var r,n,o,l=this._items;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._path)&&Object(s.default)(n._position)&&l.set(n.id,new Cf(n));for(r=a.length-1;r>-1;r--)n=a[r],Object(s.default)(n._path)&&Object(s.default)(n._position)?l.contains(n.id)||l.set(n.id,new Cf(n)):(o=l.get(n.id),Object(s.default)(o)&&(Object(s.default)(o.updater)&&o.updater.removeObject(o),l.remove(n.id)));for(r=i.length-1;r>-1;r--)n=i[r],o=l.get(n.id),Object(s.default)(o)&&(Object(s.default)(o.updater)&&o.updater.removeObject(o),l.remove(n.id))},Sf._subSample=Ef;var Df=Sf,If=i(654),Mf=y.default.WHITE,Ff=y.default.BLACK,Rf=new y.default,Nf=new v.default,Lf=new y.default,jf=new x.a,Vf=new x.a,Uf=new w.a;function zf(e){this.entity=e,this.pointPrimitive=void 0,this.billboard=void 0,this.color=void 0,this.outlineColor=void 0,this.pixelSize=void 0,this.outlineWidth=void 0}function Bf(e,t){t.collectionChanged.addEventListener(Bf.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new p.default,this._onCollectionChanged(t,t.values,[],[])}function Hf(e,t,i){if(Object(s.default)(e)){var a=e.pointPrimitive;if(Object(s.default)(a))return e.pointPrimitive=void 0,void i.removePoint(t);var r=e.billboard;Object(s.default)(r)&&(e.billboard=void 0,i.removeBillboard(t))}}Bf.prototype.update=function(e){for(var t=this._items.values,i=this._cluster,a=0,r=t.length;a<r;a++){var n,o=t[a],l=o.entity,u=l._point,d=o.pointPrimitive,f=o.billboard,c=P.default.getValueOrDefault(u._heightReference,e,O.default.NONE),h=l.isShowing&&l.isAvailable(e)&&P.default.getValueOrDefault(u._show,e,!0);if(h&&(n=P.default.getValueOrUndefined(l._position,e,Nf),h=Object(s.default)(n)),h){P.default.isConstant(l._position)||(i._clusterDirty=!0);var m=!1,p=!1;if(c===O.default.NONE||Object(s.default)(f)?c!==O.default.NONE||Object(s.default)(d)||(Object(s.default)(f)&&(Hf(o,l,i),f=void 0),(d=i.getPoint(l)).id=l,o.pointPrimitive=d):(Object(s.default)(d)&&(Hf(o,l,i),d=void 0),(f=i.getBillboard(l)).id=l,f.image=void 0,o.billboard=f,m=!0,p=v.default.equals(f.position,n)&&f.heightReference===c),Object(s.default)(d))d.show=!0,d.position=n,d.scaleByDistance=P.default.getValueOrUndefined(u._scaleByDistance,e,jf),d.translucencyByDistance=P.default.getValueOrUndefined(u._translucencyByDistance,e,Vf),d.color=P.default.getValueOrDefault(u._color,e,Mf,Rf),d.outlineColor=P.default.getValueOrDefault(u._outlineColor,e,Ff,Lf),d.outlineWidth=P.default.getValueOrDefault(u._outlineWidth,e,0),d.pixelSize=P.default.getValueOrDefault(u._pixelSize,e,1),d.distanceDisplayCondition=P.default.getValueOrUndefined(u._distanceDisplayCondition,e,Uf),d.disableDepthTestDistance=P.default.getValueOrDefault(u._disableDepthTestDistance,e,0);else if(Object(s.default)(f)){f.show=!0,f.position=n,f.scaleByDistance=P.default.getValueOrUndefined(u._scaleByDistance,e,jf),f.translucencyByDistance=P.default.getValueOrUndefined(u._translucencyByDistance,e,Vf),f.distanceDisplayCondition=P.default.getValueOrUndefined(u._distanceDisplayCondition,e,Uf),f.disableDepthTestDistance=P.default.getValueOrDefault(u._disableDepthTestDistance,e,0),f.heightReference=c;var _=P.default.getValueOrDefault(u._color,e,Mf,Rf),g=P.default.getValueOrDefault(u._outlineColor,e,Ff,Lf),b=Math.round(P.default.getValueOrDefault(u._outlineWidth,e,0)),w=Math.max(1,Math.round(P.default.getValueOrDefault(u._pixelSize,e,1)));if(b>0?(f.scale=1,m=m||b!==o.outlineWidth||w!==o.pixelSize||!y.default.equals(_,o.color)||!y.default.equals(g,o.outlineColor)):(f.scale=w/50,w=50,m=m||b!==o.outlineWidth||!y.default.equals(_,o.color)||!y.default.equals(g,o.outlineColor)),m){o.color=y.default.clone(_,o.color),o.outlineColor=y.default.clone(g,o.outlineColor),o.pixelSize=w,o.outlineWidth=b;var x=_.alpha,C=_.toCssColorString(),T=g.toCssColorString(),E=JSON.stringify([C,w,T,b]);f.setImage(E,Object(If.a)(x,C,T,b,w))}p&&f._updateClamping()}}else Hf(o,l,i)}return!0},Bf.prototype.getBoundingSphere=function(e,t){var i=this._items.get(e.id);if(!Object(s.default)(i)||!Object(s.default)(i.pointPrimitive)&&!Object(s.default)(i.billboard))return E.default.FAILED;if(Object(s.default)(i.pointPrimitive))t.center=v.default.clone(i.pointPrimitive.position,t.center);else{var a=i.billboard;if(!Object(s.default)(a._clampedPosition))return E.default.PENDING;t.center=v.default.clone(a._clampedPosition,t.center)}return t.radius=0,E.default.DONE},Bf.prototype.isDestroyed=function(){return!1},Bf.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Bf.prototype._onCollectionChanged,this);for(var e=this._entityCollection.values,t=0;t<e.length;t++)this._cluster.removePoint(e[t]);return Object(l.default)(this)},Bf.prototype._onCollectionChanged=function(e,t,i,a){var r,n,o=this._items,l=this._cluster;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._point)&&Object(s.default)(n._position)&&o.set(n.id,new zf(n));for(r=a.length-1;r>-1;r--)n=a[r],Object(s.default)(n._point)&&Object(s.default)(n._position)?o.contains(n.id)||o.set(n.id,new zf(n)):(Hf(o.get(n.id),n,l),o.remove(n.id));for(r=i.length-1;r>-1;r--)n=i[r],Hf(o.get(n.id),n,l),o.remove(n.id)};var kf=Bf,Wf=i(375),Gf=i(376),Yf=i(589),Xf=i(410),Qf=[];function qf(e,t,i,a,r){var n,o=Qf;o.length=r;var s=i.red,l=i.green,u=i.blue,d=i.alpha,f=a.red,c=a.green,h=a.blue,m=a.alpha;if(y.default.equals(i,a)){for(n=0;n<r;n++)o[n]=y.default.clone(i);return o}var p=(f-s)/r,_=(c-l)/r,g=(h-u)/r,v=(m-d)/r;for(n=0;n<r;n++)o[n]=new y.default(s+n*p,l+n*_,u+n*g,d+n*v);return o}function Zf(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,i=e.colors,a=Object(o.default)(e.width,1),r=Object(o.default)(e.colorsPerVertex,!1);this._positions=t,this._colors=i,this._width=a,this._colorsPerVertex=r,this._vertexFormat=K.default.clone(Object(o.default)(e.vertexFormat,K.default.DEFAULT)),this._arcType=Object(o.default)(e.arcType,Dn.a.GEODESIC),this._granularity=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),this._ellipsoid=hi.default.clone(Object(o.default)(e.ellipsoid,hi.default.WGS84)),this._workerName="createPolylineGeometry";var n=1+t.length*v.default.packedLength;n+=Object(s.default)(i)?1+i.length*y.default.packedLength:1,this.packedLength=n+hi.default.packedLength+K.default.packedLength+4}Zf.pack=function(e,t,i){var a;i=Object(o.default)(i,0);var r=e._positions,n=r.length;for(t[i++]=n,a=0;a<n;++a,i+=v.default.packedLength)v.default.pack(r[a],t,i);var l=e._colors;for(n=Object(s.default)(l)?l.length:0,t[i++]=n,a=0;a<n;++a,i+=y.default.packedLength)y.default.pack(l[a],t,i);return hi.default.pack(e._ellipsoid,t,i),i+=hi.default.packedLength,K.default.pack(e._vertexFormat,t,i),i+=K.default.packedLength,t[i++]=e._width,t[i++]=e._colorsPerVertex?1:0,t[i++]=e._arcType,t[i]=e._granularity,t};var Kf=hi.default.clone(hi.default.UNIT_SPHERE),Jf=new K.default,$f={positions:void 0,colors:void 0,ellipsoid:Kf,vertexFormat:Jf,width:void 0,colorsPerVertex:void 0,arcType:void 0,granularity:void 0};Zf.unpack=function(e,t,i){var a;t=Object(o.default)(t,0);var r=e[t++],n=new Array(r);for(a=0;a<r;++a,t+=v.default.packedLength)n[a]=v.default.unpack(e,t);var l=(r=e[t++])>0?new Array(r):void 0;for(a=0;a<r;++a,t+=y.default.packedLength)l[a]=y.default.unpack(e,t);var u=hi.default.unpack(e,t,Kf);t+=hi.default.packedLength;var d=K.default.unpack(e,t,Jf);t+=K.default.packedLength;var f=e[t++],c=1===e[t++],h=e[t++],m=e[t];return Object(s.default)(i)?(i._positions=n,i._colors=l,i._ellipsoid=hi.default.clone(u,i._ellipsoid),i._vertexFormat=K.default.clone(d,i._vertexFormat),i._width=f,i._colorsPerVertex=c,i._arcType=h,i._granularity=m,i):($f.positions=n,$f.colors=l,$f.width=f,$f.colorsPerVertex=c,$f.arcType=h,$f.granularity=m,new Zf($f))};var ec=new v.default,tc=new v.default,ic=new v.default,ac=new v.default;Zf.createGeometry=function(e){var t,i,a,n=e._width,o=e._vertexFormat,l=e._colors,u=e._colorsPerVertex,d=e._arcType,f=e._granularity,c=e._ellipsoid,h=Object(Je.a)(e._positions,v.default.equalsEpsilon),m=h.length;if(!(m<2||n<=0)){if(d===Dn.a.GEODESIC||d===Dn.a.RHUMB){var p,_;d===Dn.a.GEODESIC?(p=Le.default.chordLength(f,c.maximumRadius),_=tt.a.numberOfPoints):(p=f,_=tt.a.numberOfPointsRhumbLine);var g=tt.a.extractHeights(h,c);if(Object(s.default)(l)){var b=1;for(t=0;t<m-1;++t)b+=_(h[t],h[t+1],p);var w=new Array(b),x=0;for(t=0;t<m-1;++t){var O=h[t],C=h[t+1],T=l[t],E=_(O,C,p);if(u&&t<b){var P=qf(0,0,T,l[t+1],E),A=P.length;for(i=0;i<A;++i)w[x++]=P[i]}else for(i=0;i<E;++i)w[x++]=y.default.clone(T)}w[x]=y.default.clone(l[l.length-1]),l=w,Qf.length=0}h=d===Dn.a.GEODESIC?tt.a.generateCartesianArc({positions:h,minDistance:p,ellipsoid:c,height:g}):tt.a.generateCartesianRhumbArc({positions:h,granularity:p,ellipsoid:c,height:g})}var S,D=4*(m=h.length)-4,I=new Float64Array(3*D),M=new Float64Array(3*D),F=new Float64Array(3*D),R=new Float32Array(2*D),N=o.st?new Float32Array(2*D):void 0,L=Object(s.default)(l)?new Uint8Array(4*D):void 0,j=0,V=0,U=0,z=0;for(i=0;i<m;++i){var B,H;0===i?(S=ec,v.default.subtract(h[0],h[1],S),v.default.add(h[0],S,S)):S=h[i-1],v.default.clone(S,ic),v.default.clone(h[i],tc),i===m-1?(S=ec,v.default.subtract(h[m-1],h[m-2],S),v.default.add(h[m-1],S,S)):S=h[i+1],v.default.clone(S,ac),Object(s.default)(L)&&(B=0===i||u?l[i]:l[i-1],i!==m-1&&(H=l[i]));var k=i===m-1?2:4;for(a=0===i?2:0;a<k;++a){v.default.pack(tc,I,j),v.default.pack(ic,M,j),v.default.pack(ac,F,j),j+=3;var W=a-2<0?-1:1;if(R[V++]=a%2*2-1,R[V++]=W*n,o.st&&(N[U++]=i/(m-1),N[U++]=Math.max(R[V-2],0)),Object(s.default)(L)){var G=a<2?B:H;L[z++]=y.default.floatToByte(G.red),L[z++]=y.default.floatToByte(G.green),L[z++]=y.default.floatToByte(G.blue),L[z++]=y.default.floatToByte(G.alpha)}}}var Y=new _i.a;Y.position=new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:I}),Y.prevPosition=new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:M}),Y.nextPosition=new pi.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:F}),Y.expandAndWidth=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:R}),o.st&&(Y.st=new pi.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:N})),Object(s.default)(L)&&(Y.color=new pi.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:4,values:L,normalize:!0}));var X=gi.a.createTypedArray(D,6*m-6),Q=0,q=0,Z=m-1;for(i=0;i<Z;++i)X[q++]=Q,X[q++]=Q+2,X[q++]=Q+1,X[q++]=Q+1,X[q++]=Q+2,X[q++]=Q+3,Q+=4;return new mi.a({attributes:Y,indices:X,primitiveType:yi.a.TRIANGLES,boundingSphere:r.default.fromPoints(h),geometryType:Xf.a.POLYLINES})}};var rc=Zf,nc=new xe.a(0),oc={},sc=new y.default,lc=new pe.default(y.default.WHITE),uc=new xe.a(!0),dc=new xe.a(ae.default.DISABLED),fc=new xe.a(new w.a),cc=new xe.a(Z.a.BOTH);function hc(){this.vertexFormat=void 0,this.positions=void 0,this.width=void 0,this.arcType=void 0,this.granularity=void 0}function mc(){this.positions=void 0,this.width=void 0,this.arcType=void 0,this.granularity=void 0}function pc(e,t){this._entity=e,this._scene=t,this._entitySubscription=e.definitionChanged.addEventListener(pc.prototype._onEntityPropertyChanged,this),this._fillEnabled=!1,this._dynamic=!1,this._geometryChanged=new q.default,this._showProperty=void 0,this._materialProperty=void 0,this._shadowsProperty=void 0,this._distanceDisplayConditionProperty=void 0,this._classificationTypeProperty=void 0,this._depthFailMaterialProperty=void 0,this._geometryOptions=new hc,this._groundGeometryOptions=new mc,this._id="polyline-"+e.id,this._clampToGround=!1,this._supportsPolylinesOnTerrain=Oe.default.supportsPolylinesOnTerrain(t),this._zIndex=0,this._onEntityPropertyChanged(e,"polyline",e.polyline,void 0)}Object.defineProperties(pc.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!Object(s.default)(this._entity.availability)&&P.default.isConstant(this._showProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},depthFailMaterialProperty:{get:function(){return this._depthFailMaterialProperty}},outlineEnabled:{value:!1},hasConstantOutline:{value:!0},outlineColorProperty:{value:void 0},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},classificationTypeProperty:{get:function(){return this._classificationTypeProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{value:!1},geometryChanged:{get:function(){return this._geometryChanged}},arcType:{get:function(){return this._arcType}},clampToGround:{get:function(){return this._clampToGround&&this._supportsPolylinesOnTerrain}},zIndex:{get:function(){return this._zIndex}}}),pc.prototype.isOutlineVisible=function(e){return!1},pc.prototype.isFilled=function(e){var t=this._entity,i=this._fillEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e);return Object(o.default)(i,!1)},pc.prototype.createFillGeometryInstance=function(e){var t,i=this._entity,a=i.isAvailable(e),r=new me.a(a&&i.isShowing&&this._showProperty.getValue(e)),n=this._distanceDisplayConditionProperty.getValue(e),o={show:r,distanceDisplayCondition:ue.fromDistanceDisplayCondition(n)};return this._materialProperty instanceof pe.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(t=this._materialProperty.color.getValue(e,sc)),Object(s.default)(t)||(t=y.default.WHITE),o.color=oe.a.fromColor(t)),this.clampToGround?new de.a({id:i,geometry:new Yf.a(this._groundGeometryOptions),attributes:o}):(Object(s.default)(this._depthFailMaterialProperty)&&this._depthFailMaterialProperty instanceof pe.default&&(Object(s.default)(this._depthFailMaterialProperty.color)&&(this._depthFailMaterialProperty.color.isConstant||a)&&(t=this._depthFailMaterialProperty.color.getValue(e,sc)),Object(s.default)(t)||(t=y.default.WHITE),o.depthFailColor=oe.a.fromColor(t)),new de.a({id:i,geometry:new rc(this._geometryOptions),attributes:o}))},pc.prototype.createOutlineGeometryInstance=function(e){},pc.prototype.isDestroyed=function(){return!1},pc.prototype.destroy=function(){this._entitySubscription(),Object(l.default)(this)},pc.prototype._onEntityPropertyChanged=function(e,t,i,a){if("availability"===t||"polyline"===t){var r=this._entity.polyline;if(Object(s.default)(r)){var n=r.positions,l=r.show;if(Object(s.default)(l)&&l.isConstant&&!l.getValue(ce.default.MINIMUM_VALUE)||!Object(s.default)(n))this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this));else{var u=r.zIndex,d=Object(o.default)(r.material,lc),f=d instanceof pe.default;this._materialProperty=d,this._depthFailMaterialProperty=r.depthFailMaterial,this._showProperty=Object(o.default)(l,uc),this._shadowsProperty=Object(o.default)(r.shadows,dc),this._distanceDisplayConditionProperty=Object(o.default)(r.distanceDisplayCondition,fc),this._classificationTypeProperty=Object(o.default)(r.classificationType,cc),this._fillEnabled=!0,this._zIndex=Object(o.default)(u,nc);var c=r.width,h=r.arcType,m=r.clampToGround,p=r.granularity;if(n.isConstant&&P.default.isConstant(c)&&P.default.isConstant(h)&&P.default.isConstant(p)&&P.default.isConstant(m)&&P.default.isConstant(u)){var _,g=this._geometryOptions,v=n.getValue(ce.default.MINIMUM_VALUE,g.positions);if(!Object(s.default)(v)||v.length<2)return void(this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this)));_=f&&(!Object(s.default)(this._depthFailMaterialProperty)||this._depthFailMaterialProperty instanceof pe.default)?Wf.a.VERTEX_FORMAT:Gf.a.VERTEX_FORMAT,g.vertexFormat=_,g.positions=v,g.width=Object(s.default)(c)?c.getValue(ce.default.MINIMUM_VALUE):void 0,g.arcType=Object(s.default)(h)?h.getValue(ce.default.MINIMUM_VALUE):void 0,g.granularity=Object(s.default)(p)?p.getValue(ce.default.MINIMUM_VALUE):void 0;var y=this._groundGeometryOptions;y.positions=v,y.width=g.width,y.arcType=g.arcType,y.granularity=g.granularity,this._clampToGround=!!Object(s.default)(m)&&m.getValue(ce.default.MINIMUM_VALUE),!this._clampToGround&&Object(s.default)(u)&&Object(we.a)("Entity polylines must have clampToGround: true when using zIndex.  zIndex will be ignored."),this._dynamic=!1,this._geometryChanged.raiseEvent(this)}else this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this))}}else this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this))}},pc.prototype.createDynamicUpdater=function(e,t){return new gc(e,t,this)};var _c={positions:void 0,granularity:void 0,height:void 0,ellipsoid:void 0};function gc(e,t,i){this._line=void 0,this._primitives=e,this._groundPrimitives=t,this._groundPolylinePrimitive=void 0,this._material=void 0,this._geometryUpdater=i,this._positions=[]}function vc(e){if(Object(s.default)(e._line))return e._line;var t=e._geometryUpdater._scene.id,i=oc[t],a=e._primitives;!Object(s.default)(i)||i.isDestroyed()?(i=new mf.a,oc[t]=i,a.add(i)):a.contains(i)||a.add(i);var r=i.add();return r.id=e._geometryUpdater._entity,e._line=r,r}gc.prototype.update=function(e){var t=this._geometryUpdater,i=t._entity,a=i.polyline,r=a.positions,n=P.default.getValueOrUndefined(r,e,this._positions);t._clampToGround=P.default.getValueOrDefault(a._clampToGround,e,!1),t._groundGeometryOptions.positions=n,t._groundGeometryOptions.width=P.default.getValueOrDefault(a._width,e,1),t._groundGeometryOptions.arcType=P.default.getValueOrDefault(a._arcType,e,Dn.a.GEODESIC),t._groundGeometryOptions.granularity=P.default.getValueOrDefault(a._granularity,e,9999);var o=this._groundPrimitives;if(Object(s.default)(this._groundPolylinePrimitive)&&(o.remove(this._groundPolylinePrimitive),this._groundPolylinePrimitive=void 0),t.clampToGround){if(!i.isShowing||!i.isAvailable(e)||!P.default.getValueOrDefault(a._show,e,!0))return;if(!Object(s.default)(n)||n.length<2)return;var l,u=t.fillMaterialProperty;if(u instanceof pe.default)l=new Wf.a;else{var f=ve.getValue(e,u,this._material);l=new Gf.a({material:f,translucent:f.isTranslucent()}),this._material=f}return this._groundPolylinePrimitive=o.add(new d.a({geometryInstances:t.createFillGeometryInstance(e),appearance:l,classificationType:t.classificationTypeProperty.getValue(e),asynchronous:!1}),P.default.getValueOrUndefined(t.zIndex,e)),void(Object(s.default)(this._line)&&(this._line.show=!1))}var c=vc(this);if(i.isShowing&&i.isAvailable(e)&&P.default.getValueOrDefault(a._show,e,!0))if(!Object(s.default)(n)||n.length<2)c.show=!1;else{var h=Dn.a.GEODESIC;h=P.default.getValueOrDefault(a._arcType,e,h);var m=t._scene.globe;h!==Dn.a.NONE&&Object(s.default)(m)&&(_c.ellipsoid=m.ellipsoid,_c.positions=n,_c.granularity=P.default.getValueOrUndefined(a._granularity,e),_c.height=tt.a.extractHeights(n,m.ellipsoid),n=h===Dn.a.GEODESIC?tt.a.generateCartesianArc(_c):tt.a.generateCartesianRhumbArc(_c)),c.show=!0,c.positions=n.slice(),c.material=ve.getValue(e,t.fillMaterialProperty,c.material),c.width=P.default.getValueOrDefault(a._width,e,1),c.distanceDisplayCondition=P.default.getValueOrUndefined(a._distanceDisplayCondition,e,c.distanceDisplayCondition)}else c.show=!1},gc.prototype.getBoundingSphere=function(e){if(this._geometryUpdater.clampToGround){var t=this._groundPolylinePrimitive;if(Object(s.default)(t)&&t.show&&t.ready){var i=t.getGeometryInstanceAttributes(this._geometryUpdater._entity);if(Object(s.default)(i)&&Object(s.default)(i.boundingSphere))return r.default.clone(i.boundingSphere,e),E.default.DONE}return Object(s.default)(t)&&!t.ready?E.default.PENDING:E.default.DONE}var a=vc(this);return a.show&&a.positions.length>0?(r.default.fromPoints(a.positions,e),E.default.DONE):E.default.FAILED},gc.prototype.isDestroyed=function(){return!1},gc.prototype.destroy=function(){var e=this._geometryUpdater._scene.id,t=oc[e];Object(s.default)(t)&&(t.remove(this._line),0===t.length&&(this._primitives.removeAndDestroy(t),delete oc[e])),Object(s.default)(this._groundPolylinePrimitive)&&this._groundPrimitives.remove(this._groundPolylinePrimitive),Object(l.default)(this)};var yc=pc,bc=new y.default,wc=new w.a,xc=new w.a;function Oc(e,t,i,a,r){var n;n=i instanceof pe.default?Wf.a:Gf.a,this.orderedGroundPrimitives=e,this.classificationType=t,this.appearanceType=n,this.materialProperty=i,this.updaters=new p.default,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new p.default,this.material=void 0,this.updatersWithAttributes=new p.default,this.attributes=new p.default,this.invalidated=!1,this.removeMaterialSubscription=i.definitionChanged.addEventListener(Oc.prototype.onMaterialChanged,this),this.subscriptions=new p.default,this.showsUpdated=new p.default,this.zIndex=a,this._asynchronous=r}function Cc(e,t,i){this._items=[],this._orderedGroundPrimitives=e,this._classificationType=t,this._asynchronous=Object(o.default)(i,!0)}Oc.prototype.onMaterialChanged=function(){this.invalidated=!0},Oc.prototype.isMaterial=function(e){var t=this.materialProperty,i=e.fillMaterialProperty;return i===t||i instanceof pe.default&&t instanceof pe.default||Object(s.default)(t)&&t.equals(i)},Oc.prototype.add=function(e,t,i){var a=t.id;if(this.updaters.set(a,t),this.geometry.set(a,i),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&P.default.isConstant(t.distanceDisplayConditionProperty)){var r=this;this.subscriptions.set(a,t.entity.definitionChanged.addEventListener((function(e,i,a,n){"isShowing"===i&&r.showsUpdated.set(t.id,t)})))}else this.updatersWithAttributes.set(a,t);this.createPrimitive=!0},Oc.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var i=this.subscriptions.get(t);return Object(s.default)(i)&&(i(),this.subscriptions.remove(t)),!0}return!1},Oc.prototype.update=function(e){var t,i=!0,a=this.primitive,r=this.orderedGroundPrimitives,n=this.geometry.values;if(this.createPrimitive){if(n.length>0)Object(s.default)(a)&&(Object(s.default)(this.oldPrimitive)?r.remove(a):this.oldPrimitive=a),a=new d.a({show:!1,asynchronous:this._asynchronous,geometryInstances:n.slice(),appearance:new this.appearanceType,classificationType:this.classificationType}),this.appearanceType===Gf.a&&(this.material=ve.getValue(e,this.materialProperty,this.material),a.appearance.material=this.material),r.add(a,this.zIndex),i=!1;else{Object(s.default)(a)&&(r.remove(a),a=void 0);var o=this.oldPrimitive;Object(s.default)(o)&&(r.remove(o),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=a,this.createPrimitive=!1}else if(Object(s.default)(a)&&a.ready){a.show=!0,Object(s.default)(this.oldPrimitive)&&(r.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.appearanceType===Gf.a&&(this.material=ve.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material);var l=this.updatersWithAttributes.values,u=l.length;for(t=0;t<u;t++){var f=l[t],c=f.entity,h=this.geometry.get(f.id),m=this.attributes.get(h.id.id);if(Object(s.default)(m)||(m=a.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,m)),!f.fillMaterialProperty.isConstant){var p=f.fillMaterialProperty.color,_=P.default.getValueOrDefault(p,e,y.default.WHITE,bc);y.default.equals(m._lastColor,_)||(m._lastColor=y.default.clone(_,m._lastColor),m.color=oe.a.toValue(_,m.color))}var g=c.isShowing&&(f.hasConstantFill||f.isFilled(e));g!==(1===m.show[0])&&(m.show=me.a.toValue(g,m.show));var v=f.distanceDisplayConditionProperty;if(!P.default.isConstant(v)){var b=P.default.getValueOrDefault(v,e,xc,wc);w.a.equals(b,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=w.a.clone(b,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=ue.toValue(b,m.distanceDisplayCondition))}}this.updateShows(a)}else Object(s.default)(a)&&!a.ready&&(i=!1);return i},Oc.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,i=t.length,a=0;a<i;a++){var r=t[a],n=r.entity,o=this.geometry.get(r.id),l=this.attributes.get(o.id.id);Object(s.default)(l)||(l=e.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,l));var u=n.isShowing;u!==(1===l.show[0])&&(l.show=me.a.toValue(u,l.show),o.attributes.show.value[0]=l.show[0])}this.showsUpdated.removeAll()},Oc.prototype.contains=function(e){return this.updaters.contains(e.id)},Oc.prototype.getBoundingSphere=function(e,t){var i=this.primitive;if(!i.ready)return E.default.PENDING;var a=i.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(a)||!Object(s.default)(a.boundingSphere)||Object(s.default)(a.show)&&0===a.show[0]?E.default.FAILED:(a.boundingSphere.clone(t),E.default.DONE)},Oc.prototype.destroy=function(){var e=this.primitive,t=this.orderedGroundPrimitives;Object(s.default)(e)&&t.remove(e);var i=this.oldPrimitive;Object(s.default)(i)&&t.remove(i),this.removeMaterialSubscription()},Cc.prototype.add=function(e,t){for(var i=this._items,a=i.length,r=t.createFillGeometryInstance(e),n=P.default.getValueOrDefault(t.zIndex,0),o=0;o<a;++o){var s=i[o];if(s.isMaterial(t)&&s.zIndex===n)return void s.add(e,t,r)}var l=new Oc(this._orderedGroundPrimitives,this._classificationType,t.fillMaterialProperty,n,this._asynchronous);l.add(e,t,r),i.push(l)},Cc.prototype.remove=function(e){for(var t=this._items,i=t.length-1;i>=0;i--){var a=t[i];if(a.remove(e)){0===a.updaters.length&&(t.splice(i,1),a.destroy());break}}},Cc.prototype.update=function(e){var t,i=this._items;for(t=i.length-1;t>=0;t--){var a=i[t];if(a.invalidated){i.splice(t,1);for(var r=a.updaters.values,n=r.length,o=0;o<n;o++)this.add(e,r[o]);a.destroy()}}var s=!0;for(t=0;t<i.length;t++)s=i[t].update(e)&&s;return s},Cc.prototype.getBoundingSphere=function(e,t){for(var i=this._items,a=i.length,r=0;r<a;r++){var n=i[r];if(n.contains(e))return n.getBoundingSphere(e,t)}return E.default.FAILED},Cc.prototype.removeAllPrimitives=function(){for(var e=this._items,t=e.length,i=0;i<t;i++)e[i].destroy();this._items.length=0};var Tc=Cc,Ec=[];function Pc(e,t){for(var i=e._batches,a=i.length,r=0;r<a;r++)i[r].remove(t)}function Ac(e,t,i){if(i.isDynamic)e._dynamicBatch.add(t,i);else if(i.clampToGround&&i.fillEnabled){var a=i.classificationTypeProperty.getValue(t);e._groundBatches[a].add(t,i)}else{var r;i.fillEnabled&&(r=i.shadowsProperty.getValue(t));var n,o=0;Object(s.default)(i.depthFailMaterialProperty)&&(o=i.depthFailMaterialProperty instanceof pe.default?1:2),Object(s.default)(r)&&(n=r+o*ae.default.NUMBER_OF_SHADOW_MODES),i.fillEnabled&&(i.fillMaterialProperty instanceof pe.default?e._colorBatches[n].add(t,i):e._materialBatches[n].add(t,i))}}function Sc(e,t,i,a){var r;a=Object(o.default)(a,e.groundPrimitives),i=Object(o.default)(i,e.primitives),this._scene=e,this._primitives=i,this._entityCollection=void 0,this._addedObjects=new p.default,this._removedObjects=new p.default,this._changedObjects=new p.default;var n=ae.default.NUMBER_OF_SHADOW_MODES;for(this._colorBatches=new Array(3*n),this._materialBatches=new Array(3*n),r=0;r<n;++r)this._colorBatches[r]=new Il(i,Wf.a,void 0,!1,r),this._materialBatches[r]=new Ul(i,Gf.a,void 0,!1,r),this._colorBatches[r+n]=new Il(i,Wf.a,Wf.a,!1,r),this._materialBatches[r+n]=new Ul(i,Gf.a,Wf.a,!1,r),this._colorBatches[r+2*n]=new Il(i,Wf.a,Gf.a,!1,r),this._materialBatches[r+2*n]=new Ul(i,Gf.a,Gf.a,!1,r);this._dynamicBatch=new Va(i,a);var s=Z.a.NUMBER_OF_CLASSIFICATION_TYPES;for(this._groundBatches=new Array(s),r=0;r<s;++r)this._groundBatches[r]=new Tc(a,r);this._batches=this._colorBatches.concat(this._materialBatches,this._dynamicBatch,this._groundBatches),this._subscriptions=new p.default,this._updaters=new p.default,this._entityCollection=t,t.collectionChanged.addEventListener(Sc.prototype._onCollectionChanged,this),this._onCollectionChanged(t,t.values,Ec)}Sc.prototype.update=function(e){var t,i,a,r,n=this._addedObjects,o=n.values,s=this._removedObjects,l=s.values,u=this._changedObjects,d=u.values;for(t=d.length-1;t>-1;t--)a=(i=d[t]).id,(r=this._updaters.get(a)).entity===i?(Pc(this,r),Ac(this,e,r)):(l.push(i),o.push(i));for(t=l.length-1;t>-1;t--)a=(i=l[t]).id,Pc(this,r=this._updaters.get(a)),r.destroy(),this._updaters.remove(a),this._subscriptions.get(a)(),this._subscriptions.remove(a);for(t=o.length-1;t>-1;t--)a=(i=o[t]).id,r=new yc(i,this._scene),this._updaters.set(a,r),Ac(this,e,r),this._subscriptions.set(a,r.geometryChanged.addEventListener(Sc._onGeometryChanged,this));n.removeAll(),s.removeAll(),u.removeAll();var f=!0,c=this._batches,h=c.length;for(t=0;t<h;t++)f=c[t].update(e)&&f;return f};var Dc=[],Ic=new r.default;Sc.prototype.getBoundingSphere=function(e,t){for(var i=Dc,a=Ic,n=0,o=E.default.DONE,s=this._batches,l=s.length,u=this._updaters.get(e.id),d=0;d<l;d++){if((o=s[d].getBoundingSphere(u,a))===E.default.PENDING)return E.default.PENDING;o===E.default.DONE&&(i[n]=r.default.clone(a,i[n]),n++)}return 0===n?E.default.FAILED:(i.length=n,r.default.fromBoundingSpheres(i,t),E.default.DONE)},Sc.prototype.isDestroyed=function(){return!1},Sc.prototype.destroy=function(){var e;this._entityCollection.collectionChanged.removeEventListener(Sc.prototype._onCollectionChanged,this),this._addedObjects.removeAll(),this._removedObjects.removeAll();var t=this._batches,i=t.length;for(e=0;e<i;e++)t[e].removeAllPrimitives();var a=this._subscriptions.values;for(i=a.length,e=0;e<i;e++)a[e]();return this._subscriptions.removeAll(),Object(l.default)(this)},Sc._onGeometryChanged=function(e){var t=this._removedObjects,i=this._changedObjects,a=e.entity,r=a.id;Object(s.default)(t.get(r))||Object(s.default)(i.get(r))||i.set(r,a)},Sc.prototype._onCollectionChanged=function(e,t,i){var a,r,n,o=this._addedObjects,s=this._removedObjects,l=this._changedObjects;for(a=i.length-1;a>-1;a--)r=(n=i[a]).id,o.remove(r)||(s.set(r,n),l.remove(r));for(a=t.length-1;a>-1;a--)r=(n=t[a]).id,s.remove(r)?l.set(r,n):o.set(r,n)};var Mc=Sc;function Fc(e){this._displayID=Object(n.default)(),f.a.initializeTerrainHeights(),d.a.initializeTerrainHeights();var t=e.scene,i=e.dataSourceCollection;this._eventHelper=new u.default,this._eventHelper.add(i.dataSourceAdded,this._onDataSourceAdded,this),this._eventHelper.add(i.dataSourceRemoved,this._onDataSourceRemoved,this),this._eventHelper.add(i.dataSourceMoved,this._onDataSourceMoved,this),this._eventHelper.add(t.postRender,this._postRender,this),this._dataSourceCollection=i,this._scene=t,this._visualizersCallback=Object(o.default)(e.visualizersCallback,Fc.defaultVisualizersCallback);var a=!1,r=new c.a,s=new c.a;i.length>0&&(t.primitives.add(r),t.groundPrimitives.add(s),a=!0),this._primitives=r,this._groundPrimitives=s;for(var l=0,h=i.length;l<h;l++)this._onDataSourceAdded(i,i.get(l));var m,p,_=new Q.default;if(this._onDataSourceAdded(void 0,_),this._defaultDataSource=_,!a){var g=this,v=function(){t.primitives.add(r),t.groundPrimitives.add(s),m(),p(),g._removeDefaultDataSourceListener=void 0,g._removeDataSourceCollectionListener=void 0};m=_.entities.collectionChanged.addEventListener(v),p=i.dataSourceAdded.addEventListener(v)}this._removeDefaultDataSourceListener=m,this._removeDataSourceCollectionListener=p,this._ready=!1}Fc.defaultVisualizersCallback=function(e,t,i){var a=i.entities;return[new X(t,a),new cd(e,a,i._primitives,i._groundPrimitives),new Vd(t,a),new rf(e,a),new df(e,a),new kf(t,a),new Df(e,a),new Mc(e,a,i._primitives,i._groundPrimitives)]},Object.defineProperties(Fc.prototype,{scene:{get:function(){return this._scene}},dataSources:{get:function(){return this._dataSourceCollection}},defaultDataSource:{get:function(){return this._defaultDataSource}},ready:{get:function(){return this._ready}}}),Fc.prototype.isDestroyed=function(){return!1},Fc.prototype.destroy=function(){this._eventHelper.removeAll();for(var e=this._dataSourceCollection,t=0,i=e.length;t<i;++t)this._onDataSourceRemoved(this._dataSourceCollection,e.get(t));return this._onDataSourceRemoved(void 0,this._defaultDataSource),Object(s.default)(this._removeDefaultDataSourceListener)?(this._removeDefaultDataSourceListener(),this._removeDataSourceCollectionListener()):(this._scene.primitives.remove(this._primitives),this._scene.groundPrimitives.remove(this._groundPrimitives)),Object(l.default)(this)},Fc.prototype.update=function(e){if(!a.a.initialized)return this._ready=!1,!1;var t,i,r,n,o=!0,l=this._dataSourceCollection,u=l.length;for(t=0;t<u;t++){var d=l.get(t);for(Object(s.default)(d.update)&&(o=d.update(e)&&o),n=(r=d._visualizersByDisplayID[this._displayID]).length,i=0;i<n;i++)o=r[i].update(e)&&o}for(n=(r=this._defaultDataSource._visualizersByDisplayID[this._displayID]).length,i=0;i<n;i++)o=r[i].update(e)&&o;return this._ready=o,o},Fc.prototype._postRender=function(){for(var e=this._scene.frameState,t=this._dataSourceCollection,i=t.length,a=0;a<i;a++){var r=t.get(a),n=r.credit;Object(s.default)(n)&&e.creditDisplay.addCredit(n);var o=r._resourceCredits;if(Object(s.default)(o))for(var l=o.length,u=0;u<l;u++)e.creditDisplay.addCredit(o[u])}};var Rc=[],Nc=new r.default;Fc.prototype.getBoundingSphere=function(e,t,i){if(!this._ready)return E.default.PENDING;var a,n,o=this._defaultDataSource;if(!o.entities.contains(e)){o=void 0;var l=this._dataSourceCollection;for(n=l.length,a=0;a<n;a++){var u=l.get(a);if(u.entities.contains(e)){o=u;break}}}if(!Object(s.default)(o))return E.default.FAILED;var d=Rc,f=Nc,c=0,h=E.default.DONE,m=o._visualizers,p=m.length;for(a=0;a<p;a++){var _=m[a];if(Object(s.default)(_.getBoundingSphere)){if(h=m[a].getBoundingSphere(e,f),!t&&h===E.default.PENDING)return E.default.PENDING;h===E.default.DONE&&(d[c]=r.default.clone(f,d[c]),c++)}}return 0===c?E.default.FAILED:(d.length=c,r.default.fromBoundingSpheres(d,i),E.default.DONE)},Fc.prototype._onDataSourceAdded=function(e,t){var i=this._scene,a=this._primitives,r=this._groundPrimitives,n=a.add(new c.a),o=r.add(new m);t._primitives=n,t._groundPrimitives=o;var s=t.clustering;s._initialize(i),n.add(s);var l=this._visualizersCallback(i,s,t);t._visualizersByDisplayID=t._visualizersByDisplayID||{},t._visualizersByDisplayID[this._displayID]=l,t._visualizers=t._visualizers||[],t._visualizers=t._visualizers.concat(l)},Fc.prototype._onDataSourceRemoved=function(e,t){var i=this._primitives,a=this._groundPrimitives,r=t._primitives,n=t._groundPrimitives,o=t.clustering;r.remove(o);var l=t._visualizersByDisplayID[this._displayID];if(Object(s.default)(l)){for(var u=l.length,d=0;d<u;d++){var f=l[d];f.destroy();var c=t._visualizers.indexOf(f);t._visualizers.splice(c,1)}delete t._visualizersByDisplayID[this._displayID],i.remove(r),a.remove(n)}},Fc.prototype._onDataSourceMoved=function(e,t,i){var a=this._primitives,r=this._groundPrimitives,n=e._primitives,o=e._groundPrimitives;t===i+1?(a.raise(n),r.raise(o)):t===i-1?(a.lower(n),r.lower(o)):0===t?(a.lowerToBottom(n),r.lowerToBottom(o),a.raise(n),r.raise(o)):(a.raiseToTop(n),r.raiseToTop(o))};t.default=Fc},90:function(e,t,i){"use strict";var a=i(34),r=i(9),n=i(8);i(10);function o(e){e=Object(r.default)(e,!0),this.value=o.toValue(e)}Object.defineProperties(o.prototype,{componentDatatype:{get:function(){return a.a.UNSIGNED_BYTE}},componentsPerAttribute:{get:function(){return 1}},normalize:{get:function(){return!1}}}),o.toValue=function(e,t){return Object(n.default)(t)?(t[0]=e,t):new Uint8Array([e])},t.a=o}}]);
//# sourceMappingURL=4.TerriaMap.js.map
(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{1702:function(e,t,i){"use strict";t.a=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2})},1703:function(e,t,i){"use strict";var a=i(0),r=(i(9),i(21)),n=i(317),o=i(160),s=i(54);function l(){this._eventHelper=new n.default,this._definitionChanged=new r.default,this._intervals=new o.default,this._intervals.changedEvent.addEventListener(l.prototype._intervalsChanged,this)}Object.defineProperties(l.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}}}),l.prototype.getValue=function(e,t){var i=this._intervals.findDataForIntervalContainingDate(e);if(Object(a.default)(i))return i.getValue(e,t)},l.prototype.equals=function(e){return this===e||e instanceof l&&this._intervals.equals(e._intervals,s.default.equals)},l.prototype._intervalsChanged=function(){!function(e,t,i,r){function n(){i.raiseEvent(e)}var o=[];t.removeAll();for(var s=r.length,l=0;l<s;l++){var u=r.get(l);Object(a.default)(u.data)&&-1===o.indexOf(u.data)&&t.add(u.data.definitionChanged,n)}}(this,this._eventHelper,this._definitionChanged,this._intervals),this._definitionChanged.raiseEvent(this)},t.a=l},1704:function(e,t,i){"use strict";var a=i(3),r={HIGHLIGHT:0,REPLACE:1,MIX:2,getColorBlend:function(e,t){return e===r.HIGHLIGHT?0:e===r.REPLACE?1:e===r.MIX?a.default.clamp(t,a.default.EPSILON4,1):void 0}};t.a=Object.freeze(r)},1705:function(e,t,i){"use strict";var a=i(2),r=i(0),n=(i(9),i(21)),o=i(175),s=i(1703),l=i(54);function u(e){this._referenceFrame=Object(a.default)(e,o.a.FIXED),this._definitionChanged=new n.default,this._composite=new s.a,this._composite.definitionChanged.addEventListener(u.prototype._raiseDefinitionChanged,this)}Object.defineProperties(u.prototype,{isConstant:{get:function(){return this._composite.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._composite.intervals}},referenceFrame:{get:function(){return this._referenceFrame},set:function(e){this._referenceFrame=e}}}),u.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,o.a.FIXED,t)},u.prototype.getValueInReferenceFrame=function(e,t,i){var a=this._composite._intervals.findDataForIntervalContainingDate(e);if(Object(r.default)(a))return a.getValueInReferenceFrame(e,t,i)},u.prototype.equals=function(e){return this===e||e instanceof u&&this._referenceFrame===e._referenceFrame&&this._composite.equals(e._composite,l.default.equals)},u.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)},t.a=u},1706:function(e,t,i){"use strict";var a=i(0),r=(i(9),i(21)),n=i(54);function o(e){var t=e._targetProperty;if(!Object(a.default)(t)){var i=e._targetEntity;if(!Object(a.default)(i)){if(i=e._targetCollection.getById(e._targetId),!Object(a.default)(i))return void(e._targetEntity=e._targetProperty=void 0);i.definitionChanged.addEventListener(s.prototype._onTargetEntityDefinitionChanged,e),e._targetEntity=i}var r=e._targetPropertyNames;t=e._targetEntity;for(var n=0,o=r.length;n<o&&Object(a.default)(t);++n)t=t[r[n]];e._targetProperty=t}return t}function s(e,t,i){this._targetCollection=e,this._targetId=t,this._targetPropertyNames=i,this._targetProperty=void 0,this._targetEntity=void 0,this._definitionChanged=new r.default,e.collectionChanged.addEventListener(s.prototype._onCollectionChanged,this)}Object.defineProperties(s.prototype,{isConstant:{get:function(){return n.default.isConstant(o(this))}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){var e=o(this);return Object(a.default)(e)?e.referenceFrame:void 0}},targetId:{get:function(){return this._targetId}},targetCollection:{get:function(){return this._targetCollection}},targetPropertyNames:{get:function(){return this._targetPropertyNames}},resolvedProperty:{get:function(){return o(this)}}}),s.fromString=function(e,t){for(var i,a=[],r=!0,n=!1,o="",l=0;l<t.length;++l){var u=t.charAt(l);n?(o+=u,n=!1):"\\"===u?n=!0:r&&"#"===u?(i=o,r=!1,o=""):r||"."!==u?o+=u:(a.push(o),o="")}return a.push(o),new s(e,i,a)},s.prototype.getValue=function(e,t){var i=o(this);return Object(a.default)(i)?i.getValue(e,t):void 0},s.prototype.getValueInReferenceFrame=function(e,t,i){var r=o(this);return Object(a.default)(r)?r.getValueInReferenceFrame(e,t,i):void 0},s.prototype.getType=function(e){var t=o(this);return Object(a.default)(t)?t.getType(e):void 0},s.prototype.equals=function(e){if(this===e)return!0;var t=this._targetPropertyNames,i=e._targetPropertyNames;if(this._targetCollection!==e._targetCollection||this._targetId!==e._targetId||t.length!==i.length)return!1;for(var a=this._targetPropertyNames.length,r=0;r<a;r++)if(t[r]!==i[r])return!1;return!0},s.prototype._onTargetEntityDefinitionChanged=function(e,t,i,r){Object(a.default)(this._targetProperty)&&this._targetPropertyNames[0]===t&&(this._targetProperty=void 0,this._definitionChanged.raiseEvent(this))},s.prototype._onCollectionChanged=function(e,t,i){var r=this._targetEntity;Object(a.default)(r)&&-1!==i.indexOf(r)?(r.definitionChanged.removeEventListener(s.prototype._onTargetEntityDefinitionChanged,this),this._targetEntity=this._targetProperty=void 0):Object(a.default)(r)||(r=o(this),Object(a.default)(r)&&this._definitionChanged.raiseEvent(this))},t.a=s},1707:function(e,t,i){"use strict";var a=i(0),r=(i(9),i(23)),n=i(21),o=i(175),s=i(54);function l(e){this._definitionChanged=new n.default,this._value=void 0,this._removeSubscription=void 0,this.setValue(e)}Object.defineProperties(l.prototype,{isConstant:{get:function(){return s.default.isConstant(this._value)}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return Object(a.default)(this._value)?this._value.referenceFrame:o.a.FIXED}}}),l.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,o.a.FIXED,t)},l.prototype.setValue=function(e){this._value!==e&&(this._value=e,Object(a.default)(this._removeSubscription)&&(this._removeSubscription(),this._removeSubscription=void 0),Object(a.default)(e)&&(this._removeSubscription=e.definitionChanged.addEventListener(this._raiseDefinitionChanged,this)),this._definitionChanged.raiseEvent(this))},l.prototype.getValueInReferenceFrame=function(e,t,i){if(Object(a.default)(this._value))return i=this._value.getValueInReferenceFrame(e,t,i),Object(a.default)(i)?r.default.WGS84.scaleToGeodeticSurface(i,i):void 0},l.prototype.equals=function(e){return this===e||e instanceof l&&this._value===e._value},l.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)},t.a=l},769:function(e,t,i){"use strict";i.r(t);var a=i(155),r=i(19),n=(i(29),i(80)),o=i(2),s=i(0),l=i(22),u=i(317),d=i(547),f=i(545),c=i(348);function h(){this._length=0,this._collections={},this._collectionsArray=[],this.show=!0}Object.defineProperties(h.prototype,{length:{get:function(){return this._length}}}),h.prototype.add=function(e,t){t=Object(o.default)(t,0);var i=this._collections[t];if(!Object(s.default)(i)){(i=new c.a({destroyPrimitives:!1}))._zIndex=t,this._collections[t]=i;for(var a=this._collectionsArray,r=0;r<a.length&&a[r]._zIndex<t;)r++;a.splice(r,0,i)}return i.add(e),this._length++,e._zIndex=t,e},h.prototype.set=function(e,t){return t===e._zIndex||(this.remove(e,!0),this.add(e,t)),e},h.prototype.remove=function(e,t){if(this.contains(e)){var i,a=e._zIndex,r=this._collections[a];return(i=t?r.remove(e):r.removeAndDestroy(e))&&this._length--,0===r.length&&(this._collectionsArray.splice(this._collectionsArray.indexOf(r),1),this._collections[a]=void 0,r.destroy()),i}return!1},h.prototype.removeAll=function(){for(var e=this._collectionsArray,t=0;t<e.length;t++){var i=e[t];i.destroyPrimitives=!0,i.destroy()}this._collections={},this._collectionsArray=[],this._length=0},h.prototype.contains=function(e){if(!Object(s.default)(e))return!1;var t=this._collections[e._zIndex];return Object(s.default)(t)&&t.contains(e)},h.prototype.update=function(e){if(this.show)for(var t=this._collectionsArray,i=0;i<t.length;i++)t[i].update(e)},h.prototype.isDestroyed=function(){return!1},h.prototype.destroy=function(){return this.removeAll(),Object(l.default)(this)};var p=h,m=i(169),_=i(31),g=i(6),v=i(1),b=i(12),y=i(9),O=i(151),w=i(78),x=i(119),E=i(146),T=i(83),C=i(539),A=i(54),j=b.default.WHITE,P=v.default.ZERO,S=x.default.NONE,I=g.default.ZERO,L=v.default.ZERO,D=E.default.CENTER,M=T.default.CENTER,R=new v.default,N=new b.default,V=new v.default,B=new g.default,U=new w.a,F=new w.a,H=new w.a,k=new _.default,z=new O.a;function G(e){this.entity=e,this.billboard=void 0,this.textureValue=void 0}function q(e,t){t.collectionChanged.addEventListener(q.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new m.default,this._onCollectionChanged(t,t.values,[],[])}function W(e,t,i){Object(s.default)(e)&&(e.billboard=void 0,i.removeBillboard(t))}q.prototype.update=function(e){for(var t=this._items.values,i=this._cluster,a=0,r=t.length;a<r;a++){var n,o,l=t[a],u=l.entity,d=u._billboard,f=l.billboard,c=u.isShowing&&u.isAvailable(e)&&A.default.getValueOrDefault(d._show,e,!0);if(c&&(o=A.default.getValueOrUndefined(u._position,e,R),n=A.default.getValueOrUndefined(d._image,e),c=Object(s.default)(o)&&Object(s.default)(n)),c){A.default.isConstant(u._position)||(i._clusterDirty=!0),Object(s.default)(f)||((f=i.getBillboard(u)).id=u,f.image=void 0,l.billboard=f),f.show=c,Object(s.default)(f.image)&&l.textureValue===n||(f.image=n,l.textureValue=n),f.position=o,f.color=A.default.getValueOrDefault(d._color,e,j,N),f.eyeOffset=A.default.getValueOrDefault(d._eyeOffset,e,P,V),f.heightReference=A.default.getValueOrDefault(d._heightReference,e,S),f.pixelOffset=A.default.getValueOrDefault(d._pixelOffset,e,I,B),f.scale=A.default.getValueOrDefault(d._scale,e,1),f.rotation=A.default.getValueOrDefault(d._rotation,e,0),f.alignedAxis=A.default.getValueOrDefault(d._alignedAxis,e,L),f.horizontalOrigin=A.default.getValueOrDefault(d._horizontalOrigin,e,D),f.verticalOrigin=A.default.getValueOrDefault(d._verticalOrigin,e,M),f.width=A.default.getValueOrUndefined(d._width,e),f.height=A.default.getValueOrUndefined(d._height,e),f.scaleByDistance=A.default.getValueOrUndefined(d._scaleByDistance,e,U),f.translucencyByDistance=A.default.getValueOrUndefined(d._translucencyByDistance,e,F),f.pixelOffsetScaleByDistance=A.default.getValueOrUndefined(d._pixelOffsetScaleByDistance,e,H),f.sizeInMeters=A.default.getValueOrDefault(d._sizeInMeters,e,!1),f.distanceDisplayCondition=A.default.getValueOrUndefined(d._distanceDisplayCondition,e,z),f.disableDepthTestDistance=A.default.getValueOrUndefined(d._disableDepthTestDistance,e);var h=A.default.getValueOrUndefined(d._imageSubRegion,e,k);Object(s.default)(h)&&f.setImageSubRegion(f._imageId,h)}else W(l,u,i)}return!0},q.prototype.getBoundingSphere=function(e,t){var i=this._items.get(e.id);if(!Object(s.default)(i)||!Object(s.default)(i.billboard))return C.default.FAILED;var a=i.billboard;if(a.heightReference===x.default.NONE)t.center=v.default.clone(a.position,t.center);else{if(!Object(s.default)(a._clampedPosition))return C.default.PENDING;t.center=v.default.clone(a._clampedPosition,t.center)}return t.radius=0,C.default.DONE},q.prototype.isDestroyed=function(){return!1},q.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(q.prototype._onCollectionChanged,this);for(var e=this._entityCollection.values,t=0;t<e.length;t++)this._cluster.removeBillboard(e[t]);return Object(l.default)(this)},q.prototype._onCollectionChanged=function(e,t,i,a){var r,n,o=this._items,l=this._cluster;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._billboard)&&Object(s.default)(n._position)&&o.set(n.id,new G(n));for(r=a.length-1;r>-1;r--)n=a[r],Object(s.default)(n._billboard)&&Object(s.default)(n._position)?o.contains(n.id)||o.set(n.id,new G(n)):(W(o.get(n.id),n,l),o.remove(n.id));for(r=i.length-1;r>-1;r--)n=i[r],W(o.get(n.id),n,l),o.remove(n.id)};var Y=q,K=i(250),X=i(21),Z=i(181),J=i(63),Q=i(157),$=i(218);function ee(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT);var t=Object(o.default)(e.translucent,!0),i=Object(o.default)(e.closed,!1),a=Object(o.default)(e.materialSupport,ee.MaterialSupport.TEXTURED);this.material=Object(s.default)(e.material)?e.material:$.a.fromType($.a.ColorType),this.translucent=t,this._vertexShaderSource=Object(o.default)(e.vertexShaderSource,a.vertexShaderSource),this._fragmentShaderSource=Object(o.default)(e.fragmentShaderSource,a.fragmentShaderSource),this._renderState=Q.a.getDefaultRenderState(t,i,e.renderState),this._closed=i,this._materialSupport=a,this._vertexFormat=a.vertexFormat,this._flat=Object(o.default)(e.flat,!1),this._faceForward=Object(o.default)(e.faceForward,!i)}Object.defineProperties(ee.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},materialSupport:{get:function(){return this._materialSupport}},vertexFormat:{get:function(){return this._vertexFormat}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}}}),ee.prototype.getFragmentShaderSource=Q.a.prototype.getFragmentShaderSource,ee.prototype.isTranslucent=Q.a.prototype.isTranslucent,ee.prototype.getRenderState=Q.a.prototype.getRenderState,ee.MaterialSupport={BASIC:Object.freeze({vertexFormat:J.default.POSITION_AND_NORMAL,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n"}),TEXTURED:Object.freeze({vertexFormat:J.default.POSITION_NORMAL_AND_ST,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec2 st;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n    v_st = st;\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    materialInput.st = v_st;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n"}),ALL:Object.freeze({vertexFormat:J.default.ALL,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec3 tangent;\nattribute vec3 bitangent;\nattribute vec2 st;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_tangentEC;\nvarying vec3 v_bitangentEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n    v_tangentEC = czm_normal * tangent;                       // tangent in eye coordinates\n    v_bitangentEC = czm_normal * bitangent;                   // bitangent in eye coordinates\n    v_st = st;\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_tangentEC;\nvarying vec3 v_bitangentEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n    mat3 tangentToEyeMatrix = czm_tangentToEyeSpaceMatrix(v_normalEC, v_tangentEC, v_bitangentEC);\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.tangentToEyeMatrix = tangentToEyeMatrix;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    materialInput.st = v_st;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n"})};var te=ee,ie=i(116),ae=i(179),re=i(220),ne=i(387),oe=i(140),se=i(20);function le(e,t){e=Object(o.default)(e,0),t=Object(o.default)(t,Number.MAX_VALUE),this.value=new Float32Array([e,t])}Object.defineProperties(le.prototype,{componentDatatype:{get:function(){return se.a.FLOAT}},componentsPerAttribute:{get:function(){return 2}},normalize:{get:function(){return!1}}}),le.fromDistanceDisplayCondition=function(e){return new le(e.near,e.far)},le.toValue=function(e,t){return Object(s.default)(t)?(t[0]=e.near,t[1]=e.far,t):new Float32Array([e.near,e.far])};var ue=le,de=i(120),fe=i(152),ce=i(158),he=i(540),pe=i(431),me=i(223),_e=i(94);function ge(){y.default.throwInstantiationError()}Object.defineProperties(ge.prototype,{isConstant:{get:y.default.throwInstantiationError},definitionChanged:{get:y.default.throwInstantiationError}}),ge.prototype.getType=y.default.throwInstantiationError,ge.prototype.getValue=y.default.throwInstantiationError,ge.prototype.equals=y.default.throwInstantiationError,ge.getValue=function(e,t,i){var a;return Object(s.default)(t)&&(a=t.getType(e),Object(s.default)(a))?(Object(s.default)(i)&&i.type===a||(i=$.a.fromType(a)),t.getValue(e,i.uniforms),i):(Object(s.default)(i)&&i.type===$.a.ColorType||(i=$.a.fromType($.a.ColorType)),b.default.clone(b.default.WHITE,i.uniforms.color),i)};var ve=ge;function be(e,t,i){this._primitives=t,this._orderedGroundPrimitives=i,this._primitive=void 0,this._outlinePrimitive=void 0,this._geometryUpdater=e,this._options=e._options,this._entity=e._entity,this._material=void 0}be.prototype._isHidden=function(e,t,i){return!e.isShowing||!e.isAvailable(i)||!A.default.getValueOrDefault(t.show,i,!0)},be.prototype._setOptions=y.default.throwInstantiationError,be.prototype.update=function(e){var t=this._geometryUpdater,i=t._onTerrain,a=this._primitives,r=this._orderedGroundPrimitives;i?r.remove(this._primitive):(a.removeAndDestroy(this._primitive),a.removeAndDestroy(this._outlinePrimitive),this._outlinePrimitive=void 0),this._primitive=void 0;var n=this._entity,o=n[this._geometryUpdater._geometryPropertyName];if(this._setOptions(n,o,e),!this._isHidden(n,o,e)){var l=this._geometryUpdater.shadowsProperty.getValue(e),u=this._options;if(!Object(s.default)(o.fill)||o.fill.getValue(e)){var d,c=t.fillMaterialProperty,h=c instanceof me.default,p=t._getIsClosed(u);if(h)d=new ie.a({closed:p,flat:i&&!t._supportsMaterialsforEntitiesOnTerrain});else{var m=ve.getValue(e,c,this._material);this._material=m,d=new te({material:m,translucent:m.isTranslucent(),closed:p})}if(i)u.vertexFormat=ie.a.VERTEX_FORMAT,this._primitive=r.add(new f.a({geometryInstances:this._geometryUpdater.createFillGeometryInstance(e),appearance:d,asynchronous:!1,shadows:l,classificationType:this._geometryUpdater.classificationTypeProperty.getValue(e)}),A.default.getValueOrUndefined(this._geometryUpdater.zIndex,e));else{u.vertexFormat=d.vertexFormat;var _=this._geometryUpdater.createFillGeometryInstance(e);h&&(d.translucent=255!==_.attributes.color.value[3]),this._primitive=a.add(new _e.a({geometryInstances:_,appearance:d,asynchronous:!1,shadows:l}))}}if(!i&&Object(s.default)(o.outline)&&o.outline.getValue(e)){var g=this._geometryUpdater.createOutlineGeometryInstance(e),v=A.default.getValueOrDefault(o.outlineWidth,e,1);this._outlinePrimitive=a.add(new _e.a({geometryInstances:g,appearance:new ie.a({flat:!0,translucent:255!==g.attributes.color.value[3],renderState:{lineWidth:t._scene.clampLineWidth(v)}}),asynchronous:!1,shadows:l}))}}},be.prototype.getBoundingSphere=function(e){var t,i=this._entity,a=this._primitive,n=this._outlinePrimitive;return Object(s.default)(a)&&a.show&&a.ready&&(t=a.getGeometryInstanceAttributes(i),Object(s.default)(t)&&Object(s.default)(t.boundingSphere))||Object(s.default)(n)&&n.show&&n.ready&&(t=n.getGeometryInstanceAttributes(i),Object(s.default)(t)&&Object(s.default)(t.boundingSphere))?(r.default.clone(t.boundingSphere,e),C.default.DONE):Object(s.default)(a)&&!a.ready||Object(s.default)(n)&&!n.ready?C.default.PENDING:C.default.FAILED},be.prototype.isDestroyed=function(){return!1},be.prototype.destroy=function(){var e=this._primitives,t=this._orderedGroundPrimitives;this._geometryUpdater._onTerrain?t.remove(this._primitive):e.removeAndDestroy(this._primitive),e.removeAndDestroy(this._outlinePrimitive),Object(l.default)(this)};var ye=be,Oe=i(542),we=i(130),xe=i(153),Ee=new me.default(b.default.WHITE),Te=new we.a(!0),Ce=new we.a(!0),Ae=new we.a(!1),je=new we.a(b.default.BLACK),Pe=new we.a(ae.a.DISABLED),Se=new we.a(new O.a),Ie=new we.a(Z.a.BOTH);function Le(e){var t=e.entity,i=e.geometryPropertyName;this._entity=t,this._scene=e.scene,this._fillEnabled=!1,this._isClosed=!1,this._onTerrain=!1,this._dynamic=!1,this._outlineEnabled=!1,this._geometryChanged=new X.default,this._showProperty=void 0,this._materialProperty=void 0,this._showOutlineProperty=void 0,this._outlineColorProperty=void 0,this._outlineWidth=1,this._shadowsProperty=void 0,this._distanceDisplayConditionProperty=void 0,this._classificationTypeProperty=void 0,this._options=e.geometryOptions,this._geometryPropertyName=i,this._id=i+"-"+t.id,this._observedPropertyNames=e.observedPropertyNames,this._supportsMaterialsforEntitiesOnTerrain=xe.default.supportsMaterialsforEntitiesOnTerrain(e.scene)}Object.defineProperties(Le.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!Object(s.default)(this._entity.availability)&&A.default.isConstant(this._showProperty)&&A.default.isConstant(this._fillProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},outlineEnabled:{get:function(){return this._outlineEnabled}},hasConstantOutline:{get:function(){return!this._outlineEnabled||!Object(s.default)(this._entity.availability)&&A.default.isConstant(this._showProperty)&&A.default.isConstant(this._showOutlineProperty)}},outlineColorProperty:{get:function(){return this._outlineColorProperty}},outlineWidth:{get:function(){return this._outlineWidth}},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},classificationTypeProperty:{get:function(){return this._classificationTypeProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{get:function(){return this._isClosed}},onTerrain:{get:function(){return this._onTerrain}},geometryChanged:{get:function(){return this._geometryChanged}}}),Le.prototype.isOutlineVisible=function(e){var t=this._entity,i=this._outlineEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e);return Object(o.default)(i,!1)},Le.prototype.isFilled=function(e){var t=this._entity,i=this._fillEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e);return Object(o.default)(i,!1)},Le.prototype.createFillGeometryInstance=y.default.throwInstantiationError,Le.prototype.createOutlineGeometryInstance=y.default.throwInstantiationError,Le.prototype.isDestroyed=function(){return!1},Le.prototype.destroy=function(){Object(l.default)(this)},Le.prototype._isHidden=function(e,t){var i=t.show;return Object(s.default)(i)&&i.isConstant&&!i.getValue(ce.default.MINIMUM_VALUE)},Le.prototype._isOnTerrain=function(e,t){return!1},Le.prototype._getIsClosed=function(e){return!0},Le.prototype._isDynamic=y.default.throwInstantiationError,Le.prototype._setStaticOptions=y.default.throwInstantiationError,Le.prototype._onEntityPropertyChanged=function(e,t,i,a){if(-1!==this._observedPropertyNames.indexOf(t)){var r=this._entity[this._geometryPropertyName];if(Object(s.default)(r)){var n=r.fill,l=!Object(s.default)(n)||!n.isConstant||n.getValue(ce.default.MINIMUM_VALUE),u=r.outline,d=Object(s.default)(u);if(d&&u.isConstant&&(d=u.getValue(ce.default.MINIMUM_VALUE)),l||d){var f=r.show;if(this._isHidden(e,r))(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this));else{this._materialProperty=Object(o.default)(r.material,Ee),this._fillProperty=Object(o.default)(n,Ce),this._showProperty=Object(o.default)(f,Te),this._showOutlineProperty=Object(o.default)(r.outline,Ae),this._outlineColorProperty=d?Object(o.default)(r.outlineColor,je):void 0,this._shadowsProperty=Object(o.default)(r.shadows,Pe),this._distanceDisplayConditionProperty=Object(o.default)(r.distanceDisplayCondition,Se),this._classificationTypeProperty=Object(o.default)(r.classificationType,Ie),this._fillEnabled=l;var c=this._isOnTerrain(e,r)&&(this._supportsMaterialsforEntitiesOnTerrain||this._materialProperty instanceof me.default);if(d&&c&&(Object(Oe.a)(Oe.a.geometryOutlines),d=!1),this._onTerrain=c,this._outlineEnabled=d,this._isDynamic(e,r))this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this));else{this._setStaticOptions(e,r),this._isClosed=this._getIsClosed(this._options);var h=r.outlineWidth;this._outlineWidth=Object(s.default)(h)?h.getValue(ce.default.MINIMUM_VALUE):1,this._dynamic=!1,this._geometryChanged.raiseEvent(this)}}}else(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this))}else(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this))}},Le.prototype.createDynamicUpdater=function(e,t){return new this.constructor.DynamicGeometryUpdater(this,e,t)};var De=Le,Me=i(277),Re=i(15),Ne=i(3),Ve=i(11),Be=new v.default,Ue=new Re.default;function Fe(e,t,i,a){this._scene=e,this._heightReference=i,this._extrudedHeightReference=a,this._positionProperty=t,this._position=new v.default,this._cartographicPosition=new Re.default,this._normal=new v.default,this._definitionChanged=new X.default,this._terrainHeight=0,this._removeCallbackFunc=void 0,this._removeEventListener=void 0,this._removeModeListener=void 0;var r=this;if(Object(s.default)(e.globe)&&(this._removeEventListener=e.terrainProviderChanged.addEventListener((function(){r._updateClamping()})),this._removeModeListener=e.morphComplete.addEventListener((function(){r._updateClamping()}))),t.isConstant){var n=t.getValue(ce.default.MINIMUM_VALUE,Be);if(!Object(s.default)(n)||v.default.equals(n,v.default.ZERO)||!Object(s.default)(e.globe))return;this._position=v.default.clone(n,this._position),this._updateClamping(),this._normal=e.globe.ellipsoid.geodeticSurfaceNormal(n,this._normal)}}Object.defineProperties(Fe.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}}}),Fe.prototype._updateClamping=function(){Object(s.default)(this._removeCallbackFunc)&&this._removeCallbackFunc();var e=this._scene,t=e.globe,i=this._position;if(Object(s.default)(t)&&!v.default.equals(i,v.default.ZERO)){var a=t.ellipsoid,r=t._surface,n=this,o=a.cartesianToCartographic(i,this._cartographicPosition),l=t.getHeight(o);Object(s.default)(l)?this._terrainHeight=l:this._terrainHeight=0,this._removeCallbackFunc=r.updateHeight(o,(function(t){if(e.mode===Ve.a.SCENE3D){var i=a.cartesianToCartographic(t,Ue);n._terrainHeight=i.height}else n._terrainHeight=t.x;n.definitionChanged.raiseEvent()}))}else this._terrainHeight=0},Fe.prototype.getValue=function(e,t){var i=A.default.getValueOrDefault(this._heightReference,e,x.default.NONE),a=A.default.getValueOrDefault(this._extrudedHeightReference,e,x.default.NONE);if(i===x.default.NONE&&a!==x.default.RELATIVE_TO_GROUND)return this._position=v.default.clone(v.default.ZERO,this._position),v.default.clone(v.default.ZERO,t);if(this._positionProperty.isConstant)return v.default.multiplyByScalar(this._normal,this._terrainHeight,t);var r=this._scene,n=this._positionProperty.getValue(e,Be);if(!Object(s.default)(n)||v.default.equals(n,v.default.ZERO)||!Object(s.default)(r.globe))return v.default.clone(v.default.ZERO,t);if(v.default.equalsEpsilon(this._position,n,Ne.default.EPSILON10))return v.default.multiplyByScalar(this._normal,this._terrainHeight,t);this._position=v.default.clone(n,this._position),this._updateClamping();var o=r.globe.ellipsoid.geodeticSurfaceNormal(n,this._normal);return v.default.multiplyByScalar(o,this._terrainHeight,t)},Fe.prototype.isDestroyed=function(){return!1},Fe.prototype.destroy=function(){return Object(s.default)(this._removeEventListener)&&this._removeEventListener(),Object(s.default)(this._removeModeListener)&&this._removeModeListener(),Object(s.default)(this._removeCallbackFunc)&&this._removeCallbackFunc(),Object(l.default)(this)};var He=Fe;var ke=function(e,t,i,a){if(De.prototype._onEntityPropertyChanged.call(this,e,t,i,a),-1!==this._observedPropertyNames.indexOf(t)){var r=this._entity[this._geometryPropertyName];if(Object(s.default)(r)){Object(s.default)(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0);var n=r.heightReference;if(Object(s.default)(n)){var o=new Me.default(this._computeCenter.bind(this),!this._dynamic);this._terrainOffsetProperty=new He(this._scene,o,n)}}}},ze=v.default.ZERO,Ge=new v.default,qe=new v.default,We=new b.default;function Ye(e){this.id=e,this.vertexFormat=void 0,this.dimensions=void 0,this.offsetAttribute=void 0}function Ke(e,t){De.call(this,{entity:e,scene:t,geometryOptions:new Ye(e),geometryPropertyName:"box",observedPropertyNames:["availability","position","orientation","box"]}),this._onEntityPropertyChanged(e,"box",e.box,void 0)}function Xe(e,t,i){ye.call(this,e,t,i)}Object(s.default)(Object.create)&&(Ke.prototype=Object.create(De.prototype),Ke.prototype.constructor=Ke),Object.defineProperties(Ke.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),Ke.prototype.createFillGeometryInstance=function(e){var t,i=this._entity,a=i.isAvailable(e),r=new pe.a(a&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),n=this._distanceDisplayConditionProperty.getValue(e),o={show:r,distanceDisplayCondition:ue.fromDistanceDisplayCondition(n),color:void 0,offset:void 0};this._materialProperty instanceof me.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(t=this._materialProperty.color.getValue(e,We)),Object(s.default)(t)||(t=b.default.WHITE),o.color=oe.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(o.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,ze,Ge))),new de.a({id:i,geometry:re.a.fromDimensions(this._options),modelMatrix:i.computeModelMatrixForHeightReference(e,i.box.heightReference,.5*this._options.dimensions.z,this._scene.mapProjection.ellipsoid),attributes:o})},Ke.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,i=t.isAvailable(e),a=A.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,We),r=this._distanceDisplayConditionProperty.getValue(e),n={show:new pe.a(i&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(a),distanceDisplayCondition:ue.fromDistanceDisplayCondition(r),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(n.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,ze,Ge))),new de.a({id:t,geometry:ne.a.fromDimensions(this._options),modelMatrix:t.computeModelMatrixForHeightReference(e,t.box.heightReference,.5*this._options.dimensions.z,this._scene.mapProjection.ellipsoid),attributes:n})},Ke.prototype._computeCenter=function(e,t){return A.default.getValueOrUndefined(this._entity.position,e,t)},Ke.prototype._isHidden=function(e,t){return!Object(s.default)(t.dimensions)||!Object(s.default)(e.position)||De.prototype._isHidden.call(this,e,t)},Ke.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&A.default.isConstant(e.orientation)&&t.dimensions.isConstant&&A.default.isConstant(t.outlineWidth))},Ke.prototype._setStaticOptions=function(e,t){var i=A.default.getValueOrDefault(t.heightReference,ce.default.MINIMUM_VALUE,x.default.NONE),a=this._options;a.vertexFormat=this._materialProperty instanceof me.default?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,a.dimensions=t.dimensions.getValue(ce.default.MINIMUM_VALUE,a.dimensions),a.offsetAttribute=i!==x.default.NONE?fe.a.ALL:void 0},Ke.prototype._onEntityPropertyChanged=ke,Ke.DynamicGeometryUpdater=Xe,Object(s.default)(Object.create)&&(Xe.prototype=Object.create(ye.prototype),Xe.prototype.constructor=Xe),Xe.prototype._isHidden=function(e,t,i){var a=A.default.getValueOrUndefined(e.position,i,qe),r=this._options.dimensions;return!Object(s.default)(a)||!Object(s.default)(r)||ye.prototype._isHidden.call(this,e,t,i)},Xe.prototype._setOptions=function(e,t,i){var a=A.default.getValueOrDefault(t.heightReference,i,x.default.NONE),r=this._options;r.dimensions=A.default.getValueOrUndefined(t.dimensions,i,r.dimensions),r.offsetAttribute=a!==x.default.NONE?fe.a.ALL:void 0};var Ze=Ke,Je=i(159),Qe=i(247),$e=i(1702),et=i(14),tt=i(23),it=i(282),at=i(211),rt=i(87),nt=i(4),ot=i(75),st={numberOfPoints:function(e,t,i){var a=v.default.distance(e,t);return Math.ceil(a/i)},numberOfPointsRhumbLine:function(e,t,i){var a=Math.pow(e.longitude-t.longitude,2)+Math.pow(e.latitude-t.latitude,2);return Math.ceil(Math.sqrt(a/(i*i)))}},lt=new Re.default;st.extractHeights=function(e,t){for(var i=e.length,a=new Array(i),r=0;r<i;r++){var n=e[r];a[r]=t.cartesianToCartographic(n,lt).height}return a};var ut=new nt.default,dt=new v.default,ft=new v.default,ct=new ot.a(v.default.UNIT_X,0),ht=new v.default,pt=new ot.a(v.default.UNIT_X,0),mt=new v.default,_t=new v.default,gt=[];function vt(e,t,i){var a,r=gt;if(r.length=e,t===i){for(a=0;a<e;a++)r[a]=t;return r}var n=(i-t)/e;for(a=0;a<e;a++){var o=t+a*n;r[a]=o}return r}var bt=new Re.default,yt=new Re.default,Ot=new v.default,wt=new v.default,xt=new v.default,Et=new it.default,Tt=new at.a;function Ct(e,t,i,a,r,n,o,s){var l=a.scaleToGeodeticSurface(e,wt),u=a.scaleToGeodeticSurface(t,xt),d=st.numberOfPoints(e,t,i),f=a.cartesianToCartographic(l,bt),c=a.cartesianToCartographic(u,yt),h=vt(d,r,n);Et.setEndPoints(f,c);var p=Et.surfaceDistance/d,m=s;f.height=r;var _=a.cartographicToCartesian(f,Ot);v.default.pack(_,o,m),m+=3;for(var g=1;g<d;g++){var b=Et.interpolateUsingSurfaceDistance(g*p,yt);b.height=h[g],_=a.cartographicToCartesian(b,Ot),v.default.pack(_,o,m),m+=3}return m}function At(e,t,i,a,r,n,o,s){var l=a.scaleToGeodeticSurface(e,wt),u=a.scaleToGeodeticSurface(t,xt),d=a.cartesianToCartographic(l,bt),f=a.cartesianToCartographic(u,yt),c=st.numberOfPointsRhumbLine(d,f,i),h=vt(c,r,n);Tt.ellipsoid.equals(a)||(Tt=new at.a(void 0,void 0,a)),Tt.setEndPoints(d,f);var p=Tt.surfaceDistance/c,m=s;d.height=r;var _=a.cartographicToCartesian(d,Ot);v.default.pack(_,o,m),m+=3;for(var g=1;g<c;g++){var b=Tt.interpolateUsingSurfaceDistance(g*p,yt);b.height=h[g],_=a.cartographicToCartesian(b,Ot),v.default.pack(_,o,m),m+=3}return m}st.wrapLongitude=function(e,t){var i=[],a=[];if(Object(s.default)(e)&&e.length>0){t=Object(o.default)(t,nt.default.IDENTITY);var r=nt.default.inverseTransformation(t,ut),n=nt.default.multiplyByPoint(r,v.default.ZERO,dt),l=v.default.normalize(nt.default.multiplyByPointAsVector(r,v.default.UNIT_Y,ft),ft),u=ot.a.fromPointNormal(n,l,ct),d=v.default.normalize(nt.default.multiplyByPointAsVector(r,v.default.UNIT_X,ht),ht),f=ot.a.fromPointNormal(n,d,pt),c=1;i.push(v.default.clone(e[0]));for(var h=i[0],p=e.length,m=1;m<p;++m){var _=e[m];if(ot.a.getPointDistance(f,h)<0||ot.a.getPointDistance(f,_)<0){var g=rt.default.lineSegmentPlane(h,_,u,mt);if(Object(s.default)(g)){var b=v.default.multiplyByScalar(l,5e-9,_t);ot.a.getPointDistance(u,h)<0&&v.default.negate(b,b),i.push(v.default.add(g,b,new v.default)),a.push(c+1),v.default.negate(b,b),i.push(v.default.add(g,b,new v.default)),c=1}}i.push(v.default.clone(e[m])),c++,h=_}a.push(c)}return{positions:i,lengths:a}},st.generateArc=function(e){Object(s.default)(e)||(e={});var t=e.positions,i=t.length,a=Object(o.default)(e.ellipsoid,tt.default.WGS84),r=Object(o.default)(e.height,0),n=Array.isArray(r);if(i<1)return[];if(1===i){var l=a.scaleToGeodeticSurface(t[0],wt);if(0!==(r=n?r[0]:r)){var u=a.geodeticSurfaceNormal(l,Ot);v.default.multiplyByScalar(u,r,u),v.default.add(l,u,l)}return[l.x,l.y,l.z]}var d=e.minDistance;if(!Object(s.default)(d)){var f=Object(o.default)(e.granularity,Ne.default.RADIANS_PER_DEGREE);d=Ne.default.chordLength(f,a.maximumRadius)}var c,h=0;for(c=0;c<i-1;c++)h+=st.numberOfPoints(t[c],t[c+1],d);var p=3*(h+1),m=new Array(p),_=0;for(c=0;c<i-1;c++){_=Ct(t[c],t[c+1],d,a,n?r[c]:r,n?r[c+1]:r,m,_)}gt.length=0;var g=t[i-1],b=a.cartesianToCartographic(g,bt);b.height=n?r[i-1]:r;var y=a.cartographicToCartesian(b,Ot);return v.default.pack(y,m,p-3),m};var jt=new Re.default,Pt=new Re.default;st.generateRhumbArc=function(e){Object(s.default)(e)||(e={});var t=e.positions,i=t.length,a=Object(o.default)(e.ellipsoid,tt.default.WGS84),r=Object(o.default)(e.height,0),n=Array.isArray(r);if(i<1)return[];if(1===i){var l=a.scaleToGeodeticSurface(t[0],wt);if(0!==(r=n?r[0]:r)){var u=a.geodeticSurfaceNormal(l,Ot);v.default.multiplyByScalar(u,r,u),v.default.add(l,u,l)}return[l.x,l.y,l.z]}var d,f,c=Object(o.default)(e.granularity,Ne.default.RADIANS_PER_DEGREE),h=0,p=a.cartesianToCartographic(t[0],jt);for(d=0;d<i-1;d++)f=a.cartesianToCartographic(t[d+1],Pt),h+=st.numberOfPointsRhumbLine(p,f,c),p=Re.default.clone(f,jt);var m=3*(h+1),_=new Array(m),g=0;for(d=0;d<i-1;d++){g=At(t[d],t[d+1],c,a,n?r[d]:r,n?r[d+1]:r,_,g)}gt.length=0;var b=t[i-1],y=a.cartesianToCartographic(b,bt);y.height=n?r[i-1]:r;var O=a.cartographicToCartesian(y,Ot);return v.default.pack(O,_,m-3),_},st.generateCartesianArc=function(e){for(var t=st.generateArc(e),i=t.length/3,a=new Array(i),r=0;r<i;r++)a[r]=v.default.unpack(t,3*r);return a},st.generateCartesianRhumbArc=function(e){for(var t=st.generateRhumbArc(e),i=t.length/3,a=new Array(i),r=0;r<i;r++)a[r]=v.default.unpack(t,3*r);return a};var St=st,It=i(18),Lt=i(432),Dt=i(38),Mt=i(53),Rt=[new v.default,new v.default],Nt=new v.default,Vt=new v.default,Bt=new v.default,Ut=new v.default,Ft=new v.default,Ht=new v.default,kt=new v.default,zt=new v.default,Gt=new v.default,qt=new v.default,Wt=new v.default,Yt={},Kt=new Re.default;function Xt(e,t,i,a){var r,n=e[0],o=e[1],s=v.default.angleBetween(n,o),l=Math.ceil(s/a),u=new Array(l);if(t===i){for(r=0;r<l;r++)u[r]=t;return u.push(i),u}var d=(i-t)/l;for(r=1;r<l;r++){var f=t+r*d;u[r]=f}return u[0]=t,u.push(i),u}var Zt=new v.default,Jt=new v.default;var Qt=new v.default(-1,0,0),$t=new nt.default,ei=new nt.default,ti=new et.default,ii=et.default.IDENTITY.clone(),ai=new v.default,ri=new It.a,ni=new v.default;function oi(e,t,i,a,r,n,o,s){var l=ai,u=ri;$t=Mt.default.eastNorthUpToFixedFrame(e,r,$t),l=nt.default.multiplyByPointAsVector($t,Qt,l);var d=function(e,t,i,a){var r=new Lt.default(i,a),n=r.projectPointOntoPlane(v.default.add(i,e,Zt),Zt),o=r.projectPointOntoPlane(v.default.add(i,t,Jt),Jt),s=g.default.angleBetween(n,o);return o.x*n.y-o.y*n.x>=0?-s:s}(l=v.default.normalize(l,l),t,e,r);ti=et.default.fromRotationZ(d,ti),ni.z=n,$t=nt.default.multiplyTransformation($t,nt.default.fromRotationTranslation(ti,ni,ei),$t);var f=ii;f[0]=o;for(var c=0;c<s;c++)for(var h=0;h<i.length;h+=3)u=v.default.fromArray(i,h,u),u=et.default.multiplyByVector(f,u,u),u=nt.default.multiplyByPoint($t,u,u),a.push(u.x,u.y,u.z);return a}var si=new v.default;function li(e,t,i,a,r,n,o){for(var s=0;s<e.length;s+=3){a=oi(v.default.fromArray(e,s,si),t,i,a,r,n[s/3],o,1)}return a}function ui(e,t){for(var i=e.length,a=new Array(3*i),r=0,n=t.x+t.width/2,o=t.y+t.height/2,s=0;s<i;s++)a[r++]=e[s].x-n,a[r++]=0,a[r++]=e[s].y-o;return a}var di=new Dt.default,fi=new v.default,ci=new et.default;function hi(e,t,i,a,r,n,o,s,l,u){var d,f,c=v.default.angleBetween(v.default.subtract(t,e,qt),v.default.subtract(i,e,Wt)),h=a===$e.a.BEVELED?0:Math.ceil(c/Ne.default.toRadians(5));if(d=r?et.default.fromQuaternion(Dt.default.fromAxisAngle(v.default.negate(e,qt),c/(h+1),di),ci):et.default.fromQuaternion(Dt.default.fromAxisAngle(e,c/(h+1),di),ci),t=v.default.clone(t,fi),h>0)for(var p=u?2:1,m=0;m<h;m++)t=et.default.multiplyByVector(d,t,t),f=v.default.subtract(t,e,qt),f=v.default.normalize(f,f),r||(f=v.default.negate(f,f)),o=oi(n.scaleToGeodeticSurface(t,Wt),f,s,o,n,l,1,p);else f=v.default.subtract(t,e,qt),f=v.default.normalize(f,f),r||(f=v.default.negate(f,f)),o=oi(n.scaleToGeodeticSurface(t,Wt),f,s,o,n,l,1,1),i=v.default.clone(i,fi),f=v.default.subtract(i,e,qt),f=v.default.normalize(f,f),r||(f=v.default.negate(f,f)),o=oi(n.scaleToGeodeticSurface(i,Wt),f,s,o,n,l,1,1);return o}Yt.removeDuplicatesFromShape=function(e){for(var t=e.length,i=[],a=t-1,r=0;r<t;a=r++){var n=e[a],o=e[r];g.default.equals(n,o)||i.push(o)}return i},Yt.angleIsGreaterThanPi=function(e,t,i,a){var r=new Lt.default(i,a),n=r.projectPointOntoPlane(v.default.add(i,e,Zt),Zt),o=r.projectPointOntoPlane(v.default.add(i,t,Jt),Jt);return o.x*n.y-o.y*n.x>=0};var pi=new v.default,mi=new v.default;Yt.computePositions=function(e,t,i,a,r){var n=a._ellipsoid,o=function(e,t){for(var i=new Array(e.length),a=0;a<e.length;a++){var r=e[a];Kt=t.cartesianToCartographic(r,Kt),i[a]=Kt.height,e[a]=t.scaleToGeodeticSurface(r,r)}return i}(e,n),s=a._granularity,l=a._cornerType,u=r?function(e,t){var i=e.length,a=new Array(6*i),r=0,n=t.x+t.width/2,o=t.y+t.height/2,s=e[0];a[r++]=s.x-n,a[r++]=0,a[r++]=s.y-o;for(var l=1;l<i;l++){var u=(s=e[l]).x-n,d=s.y-o;a[r++]=u,a[r++]=0,a[r++]=d,a[r++]=u,a[r++]=0,a[r++]=d}return s=e[0],a[r++]=s.x-n,a[r++]=0,a[r++]=s.y-o,a}(t,i):ui(t,i),d=r?ui(t,i):void 0,f=i.height/2,c=i.width/2,h=e.length,p=[],m=r?[]:void 0,_=Nt,g=Vt,b=Bt,y=Ut,O=Ft,w=Ht,x=kt,E=zt,T=Gt,C=e[0],A=e[1];y=n.geodeticSurfaceNormal(C,y),_=v.default.subtract(A,C,_),_=v.default.normalize(_,_),E=v.default.cross(y,_,E),E=v.default.normalize(E,E);var j,P=o[0],S=o[1];r&&(m=oi(C,E,d,m,n,P+f,1,1)),T=v.default.clone(C,T),C=A,g=v.default.negate(_,g);for(var I=1;I<h-1;I++){var L=r?2:1;A=e[I+1],_=v.default.subtract(A,C,_),_=v.default.normalize(_,_),b=v.default.add(_,g,b),b=v.default.normalize(b,b),y=n.geodeticSurfaceNormal(C,y);var D=v.default.multiplyByScalar(y,v.default.dot(_,y),pi);v.default.subtract(_,D,D),v.default.normalize(D,D);var M=v.default.multiplyByScalar(y,v.default.dot(g,y),mi);if(v.default.subtract(g,M,M),v.default.normalize(M,M),!Ne.default.equalsEpsilon(Math.abs(v.default.dot(D,M)),1,Ne.default.EPSILON7)){b=v.default.cross(b,y,b),b=v.default.cross(y,b,b),b=v.default.normalize(b,b);var R=1/Math.max(.25,v.default.magnitude(v.default.cross(b,g,qt))),N=Yt.angleIsGreaterThanPi(_,g,C,n);N?(O=v.default.add(C,v.default.multiplyByScalar(b,R*c,b),O),w=v.default.add(O,v.default.multiplyByScalar(E,c,w),w),Rt[0]=v.default.clone(T,Rt[0]),Rt[1]=v.default.clone(w,Rt[1]),j=Xt(Rt,P+f,S+f,s),p=li(St.generateArc({positions:Rt,granularity:s,ellipsoid:n}),E,u,p,n,j,1),E=v.default.cross(y,_,E),E=v.default.normalize(E,E),x=v.default.add(O,v.default.multiplyByScalar(E,c,x),x),l===$e.a.ROUNDED||l===$e.a.BEVELED?hi(O,w,x,l,N,n,p,u,S+f,r):p=oi(C,b=v.default.negate(b,b),u,p,n,S+f,R,L),T=v.default.clone(x,T)):(O=v.default.add(C,v.default.multiplyByScalar(b,R*c,b),O),w=v.default.add(O,v.default.multiplyByScalar(E,-c,w),w),Rt[0]=v.default.clone(T,Rt[0]),Rt[1]=v.default.clone(w,Rt[1]),j=Xt(Rt,P+f,S+f,s),p=li(St.generateArc({positions:Rt,granularity:s,ellipsoid:n}),E,u,p,n,j,1),E=v.default.cross(y,_,E),E=v.default.normalize(E,E),x=v.default.add(O,v.default.multiplyByScalar(E,-c,x),x),l===$e.a.ROUNDED||l===$e.a.BEVELED?hi(O,w,x,l,N,n,p,u,S+f,r):p=oi(C,b,u,p,n,S+f,R,L),T=v.default.clone(x,T)),g=v.default.negate(_,g)}else p=oi(T,E,u,p,n,P+f,1,1),T=C;P=S,S=o[I+1],C=A}Rt[0]=v.default.clone(T,Rt[0]),Rt[1]=v.default.clone(C,Rt[1]),j=Xt(Rt,P+f,S+f,s),p=li(St.generateArc({positions:Rt,granularity:s,ellipsoid:n}),E,u,p,n,j,1),r&&(m=oi(C,E,d,m,n,S+f,1,1)),h=p.length;var V=r?h+m.length:h,B=new Float64Array(V);return B.set(p),r&&B.set(m,h),B};var _i=Yt,gi={},vi=new v.default,bi=new v.default,yi=new v.default,Oi=new v.default,wi=[new v.default,new v.default],xi=new v.default,Ei=new v.default,Ti=new v.default,Ci=new v.default,Ai=new v.default,ji=new v.default,Pi=new v.default,Si=new v.default,Ii=new v.default,Li=new v.default,Di=new Dt.default,Mi=new et.default;function Ri(e,t,i,a,r){var n,o=v.default.angleBetween(v.default.subtract(t,e,vi),v.default.subtract(i,e,bi)),s=a===$e.a.BEVELED?1:Math.ceil(o/Ne.default.toRadians(5))+1,l=3*s,u=new Array(l);u[l-3]=i.x,u[l-2]=i.y,u[l-1]=i.z,n=r?et.default.fromQuaternion(Dt.default.fromAxisAngle(v.default.negate(e,vi),o/s,Di),Mi):et.default.fromQuaternion(Dt.default.fromAxisAngle(e,o/s,Di),Mi);var d=0;t=v.default.clone(t,vi);for(var f=0;f<s;f++)t=et.default.multiplyByVector(n,t,t),u[d++]=t.x,u[d++]=t.y,u[d++]=t.z;return u}function Ni(e,t,i,a){var r=vi;return a||(t=v.default.negate(t,t)),[(r=v.default.add(e,t,r)).x,r.y,r.z,i.x,i.y,i.z]}function Vi(e,t,i,a){for(var r=new Array(e.length),n=new Array(e.length),o=v.default.multiplyByScalar(t,i,vi),s=v.default.negate(o,bi),l=0,u=e.length-1,d=0;d<e.length;d+=3){var f=v.default.fromArray(e,d,yi),c=v.default.add(f,s,Oi);r[l++]=c.x,r[l++]=c.y,r[l++]=c.z;var h=v.default.add(f,o,Oi);n[u--]=h.z,n[u--]=h.y,n[u--]=h.x}return a.push(r,n),a}gi.addAttribute=function(e,t,i,a){var r=t.x,n=t.y,o=t.z;Object(s.default)(i)&&(e[i]=r,e[i+1]=n,e[i+2]=o),Object(s.default)(a)&&(e[a]=o,e[a-1]=n,e[a-2]=r)};var Bi=new v.default,Ui=new v.default;gi.computePositions=function(e){var t=e.granularity,i=e.positions,a=e.ellipsoid,r=e.width/2,n=e.cornerType,o=e.saveAttributes,s=xi,l=Ei,u=Ti,d=Ci,f=Ai,c=ji,h=Pi,p=Si,m=Ii,_=Li,g=[],b=o?[]:void 0,y=o?[]:void 0,O=i[0],w=i[1];l=v.default.normalize(v.default.subtract(w,O,l),l),s=a.geodeticSurfaceNormal(O,s),d=v.default.normalize(v.default.cross(s,l,d),d),o&&(b.push(d.x,d.y,d.z),y.push(s.x,s.y,s.z)),h=v.default.clone(O,h),O=w,u=v.default.negate(l,u);var x,E,T=[],C=i.length;for(x=1;x<C-1;x++){s=a.geodeticSurfaceNormal(O,s),w=i[x+1],l=v.default.normalize(v.default.subtract(w,O,l),l),f=v.default.normalize(v.default.add(l,u,f),f);var A=v.default.multiplyByScalar(s,v.default.dot(l,s),Bi);v.default.subtract(l,A,A),v.default.normalize(A,A);var j=v.default.multiplyByScalar(s,v.default.dot(u,s),Ui);if(v.default.subtract(u,j,j),v.default.normalize(j,j),!Ne.default.equalsEpsilon(Math.abs(v.default.dot(A,j)),1,Ne.default.EPSILON7)){f=v.default.cross(f,s,f),f=v.default.cross(s,f,f),f=v.default.normalize(f,f);var P=r/Math.max(.25,v.default.magnitude(v.default.cross(f,u,vi))),S=_i.angleIsGreaterThanPi(l,u,O,a);f=v.default.multiplyByScalar(f,P,f),S?(p=v.default.add(O,f,p),_=v.default.add(p,v.default.multiplyByScalar(d,r,_),_),m=v.default.add(p,v.default.multiplyByScalar(d,2*r,m),m),wi[0]=v.default.clone(h,wi[0]),wi[1]=v.default.clone(_,wi[1]),g=Vi(St.generateArc({positions:wi,granularity:t,ellipsoid:a}),d,r,g),o&&(b.push(d.x,d.y,d.z),y.push(s.x,s.y,s.z)),c=v.default.clone(m,c),d=v.default.normalize(v.default.cross(s,l,d),d),m=v.default.add(p,v.default.multiplyByScalar(d,2*r,m),m),h=v.default.add(p,v.default.multiplyByScalar(d,r,h),h),n===$e.a.ROUNDED||n===$e.a.BEVELED?T.push({leftPositions:Ri(p,c,m,n,S)}):T.push({leftPositions:Ni(O,v.default.negate(f,f),m,S)})):(m=v.default.add(O,f,m),_=v.default.add(m,v.default.negate(v.default.multiplyByScalar(d,r,_),_),_),p=v.default.add(m,v.default.negate(v.default.multiplyByScalar(d,2*r,p),p),p),wi[0]=v.default.clone(h,wi[0]),wi[1]=v.default.clone(_,wi[1]),g=Vi(St.generateArc({positions:wi,granularity:t,ellipsoid:a}),d,r,g),o&&(b.push(d.x,d.y,d.z),y.push(s.x,s.y,s.z)),c=v.default.clone(p,c),d=v.default.normalize(v.default.cross(s,l,d),d),p=v.default.add(m,v.default.negate(v.default.multiplyByScalar(d,2*r,p),p),p),h=v.default.add(m,v.default.negate(v.default.multiplyByScalar(d,r,h),h),h),n===$e.a.ROUNDED||n===$e.a.BEVELED?T.push({rightPositions:Ri(m,c,p,n,S)}):T.push({rightPositions:Ni(O,f,p,S)})),u=v.default.negate(l,u)}O=w}return s=a.geodeticSurfaceNormal(O,s),wi[0]=v.default.clone(h,wi[0]),wi[1]=v.default.clone(O,wi[1]),g=Vi(St.generateArc({positions:wi,granularity:t,ellipsoid:a}),d,r,g),o&&(b.push(d.x,d.y,d.z),y.push(s.x,s.y,s.z)),n===$e.a.ROUNDED&&(E=function(e){var t=xi,i=Ei,a=Ti,r=e[1];i=v.default.fromArray(e[1],r.length-3,i),a=v.default.fromArray(e[0],0,a);var n=Ri(t=v.default.midpoint(i,a,t),i,a,$e.a.ROUNDED,!1),o=e.length-1,s=e[o-1];return r=e[o],i=v.default.fromArray(s,s.length-3,i),a=v.default.fromArray(r,0,a),[n,Ri(t=v.default.midpoint(i,a,t),i,a,$e.a.ROUNDED,!1)]}(g)),{positions:g,corners:T,lefts:b,normals:y,endPositions:E}};var Fi=gi,Hi=i(55),ki=i(44),zi=i(125),Gi=i(52),qi=i(198),Wi=i(47),Yi=i(17),Ki=new v.default,Xi=new v.default,Zi=new v.default,Ji=new v.default,Qi=new v.default,$i=new v.default,ea=new v.default,ta=new v.default;function ia(e,t){for(var i=0;i<e.length;i++)e[i]=t.scaleToGeodeticSurface(e[i],e[i]);return e}function aa(e,t,i,a,r,n){var o=e.normals,s=e.tangents,l=e.bitangents,u=v.default.normalize(v.default.cross(i,t,ea),ea);n.normal&&Fi.addAttribute(o,t,a,r),n.tangent&&Fi.addAttribute(s,u,a,r),n.bitangent&&Fi.addAttribute(l,i,a,r)}function ra(e,t,i){var a,r,n,o=e.positions,l=e.corners,u=e.endPositions,d=e.lefts,f=e.normals,c=new zi.a,h=0,p=0,m=0;for(r=0;r<o.length;r+=2)h+=n=o[r].length-3,m+=2*n,p+=o[r+1].length-3;for(h+=3,p+=3,r=0;r<l.length;r++){a=l[r];var _=l[r].leftPositions;Object(s.default)(_)?(h+=n=_.length,m+=n):(p+=n=l[r].rightPositions.length,m+=n)}var g,b=Object(s.default)(u);b&&(h+=g=u[0].length-3,p+=g,m+=6*(g/=3));var y,O,w,x,E,T,C=h+p,A=new Float64Array(C),j={normals:t.normal?new Float32Array(C):void 0,tangents:t.tangent?new Float32Array(C):void 0,bitangents:t.bitangent?new Float32Array(C):void 0},P=0,S=C-1,I=Ki,L=Xi,D=g/2,M=Gi.a.createTypedArray(C/3,m),R=0;if(b){T=Zi,E=Ji;var N=u[0];for(I=v.default.fromArray(f,0,I),L=v.default.fromArray(d,0,L),r=0;r<D;r++)T=v.default.fromArray(N,3*(D-1-r),T),E=v.default.fromArray(N,3*(D+r),E),Fi.addAttribute(A,E,P),Fi.addAttribute(A,T,void 0,S),aa(j,I,L,P,S,t),x=(O=P/3)+1,w=(y=(S-2)/3)-1,M[R++]=y,M[R++]=O,M[R++]=w,M[R++]=w,M[R++]=O,M[R++]=x,P+=3,S-=3}var V,B,U=0,F=0,H=o[U++],k=o[U++];for(A.set(H,P),A.set(k,S-k.length+1),L=v.default.fromArray(d,F,L),n=k.length-3,r=0;r<n;r+=3)V=i.geodeticSurfaceNormal(v.default.fromArray(H,r,ea),ea),B=i.geodeticSurfaceNormal(v.default.fromArray(k,n-r,ta),ta),aa(j,I=v.default.normalize(v.default.add(V,B,I),I),L,P,S,t),x=(O=P/3)+1,w=(y=(S-2)/3)-1,M[R++]=y,M[R++]=O,M[R++]=w,M[R++]=w,M[R++]=O,M[R++]=x,P+=3,S-=3;for(V=i.geodeticSurfaceNormal(v.default.fromArray(H,n,ea),ea),B=i.geodeticSurfaceNormal(v.default.fromArray(k,n,ta),ta),I=v.default.normalize(v.default.add(V,B,I),I),F+=3,r=0;r<l.length;r++){var z,G,q,W=(a=l[r]).leftPositions,Y=a.rightPositions,K=$i,X=Zi,Z=Ji;if(I=v.default.fromArray(f,F,I),Object(s.default)(W)){for(aa(j,I,L,void 0,S,t),S-=3,G=x,q=w,z=0;z<W.length/3;z++)K=v.default.fromArray(W,3*z,K),M[R++]=G,M[R++]=q-z-1,M[R++]=q-z,Fi.addAttribute(A,K,void 0,S),X=v.default.fromArray(A,3*(q-z-1),X),Z=v.default.fromArray(A,3*G,Z),aa(j,I,L=v.default.normalize(v.default.subtract(X,Z,L),L),void 0,S,t),S-=3;K=v.default.fromArray(A,3*G,K),X=v.default.subtract(v.default.fromArray(A,3*q,X),K,X),Z=v.default.subtract(v.default.fromArray(A,3*(q-z),Z),K,Z),aa(j,I,L=v.default.normalize(v.default.add(X,Z,L),L),P,void 0,t),P+=3}else{for(aa(j,I,L,P,void 0,t),P+=3,G=w,q=x,z=0;z<Y.length/3;z++)K=v.default.fromArray(Y,3*z,K),M[R++]=G,M[R++]=q+z,M[R++]=q+z+1,Fi.addAttribute(A,K,P),X=v.default.fromArray(A,3*G,X),Z=v.default.fromArray(A,3*(q+z),Z),aa(j,I,L=v.default.normalize(v.default.subtract(X,Z,L),L),P,void 0,t),P+=3;K=v.default.fromArray(A,3*G,K),X=v.default.subtract(v.default.fromArray(A,3*(q+z),X),K,X),Z=v.default.subtract(v.default.fromArray(A,3*q,Z),K,Z),aa(j,I,L=v.default.normalize(v.default.negate(v.default.add(Z,X,L),L),L),void 0,S,t),S-=3}for(H=o[U++],k=o[U++],H.splice(0,3),k.splice(k.length-3,3),A.set(H,P),A.set(k,S-k.length+1),n=k.length-3,F+=3,L=v.default.fromArray(d,F,L),z=0;z<k.length;z+=3)V=i.geodeticSurfaceNormal(v.default.fromArray(H,z,ea),ea),B=i.geodeticSurfaceNormal(v.default.fromArray(k,n-z,ta),ta),aa(j,I=v.default.normalize(v.default.add(V,B,I),I),L,P,S,t),O=(x=P/3)-1,y=(w=(S-2)/3)+1,M[R++]=y,M[R++]=O,M[R++]=w,M[R++]=w,M[R++]=O,M[R++]=x,P+=3,S-=3;P-=3,S+=3}if(aa(j,I=v.default.fromArray(f,f.length-3,I),L,P,S,t),b){P+=3,S-=3,T=Zi,E=Ji;var J=u[1];for(r=0;r<D;r++)T=v.default.fromArray(J,3*(g-r-1),T),E=v.default.fromArray(J,3*r,E),Fi.addAttribute(A,T,void 0,S),Fi.addAttribute(A,E,P),aa(j,I,L,P,S,t),O=(x=P/3)-1,y=(w=(S-2)/3)+1,M[R++]=y,M[R++]=O,M[R++]=w,M[R++]=w,M[R++]=O,M[R++]=x,P+=3,S-=3}if(c.position=new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:A}),t.st){var Q,$,ee=new Float32Array(C/3*2),te=0;if(b){h/=3,p/=3;var ie,ae=Math.PI/(g+1);$=1/(h-g+1),Q=1/(p-g+1);var re=g/2;for(r=re+1;r<g+1;r++)ie=Ne.default.PI_OVER_TWO+ae*r,ee[te++]=Q*(1+Math.cos(ie)),ee[te++]=.5*(1+Math.sin(ie));for(r=1;r<p-g+1;r++)ee[te++]=r*Q,ee[te++]=0;for(r=g;r>re;r--)ie=Ne.default.PI_OVER_TWO-r*ae,ee[te++]=1-Q*(1+Math.cos(ie)),ee[te++]=.5*(1+Math.sin(ie));for(r=re;r>0;r--)ie=Ne.default.PI_OVER_TWO-ae*r,ee[te++]=1-$*(1+Math.cos(ie)),ee[te++]=.5*(1+Math.sin(ie));for(r=h-g;r>0;r--)ee[te++]=r*$,ee[te++]=1;for(r=1;r<re+1;r++)ie=Ne.default.PI_OVER_TWO+ae*r,ee[te++]=$*(1+Math.cos(ie)),ee[te++]=.5*(1+Math.sin(ie))}else{for($=1/((h/=3)-1),Q=1/((p/=3)-1),r=0;r<p;r++)ee[te++]=r*Q,ee[te++]=0;for(r=h;r>0;r--)ee[te++]=(r-1)*$,ee[te++]=1}c.st=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:ee})}return t.normal&&(c.normal=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:j.normals})),t.tangent&&(c.tangent=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:j.tangents})),t.bitangent&&(c.bitangent=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:j.bitangents})),{attributes:c,indices:M}}function na(e,t,i){i[t++]=e[0],i[t++]=e[1],i[t++]=e[2];for(var a=3;a<e.length;a+=3){var r=e[a],n=e[a+1],o=e[a+2];i[t++]=r,i[t++]=n,i[t++]=o,i[t++]=r,i[t++]=n,i[t++]=o}return i[t++]=e[0],i[t++]=e[1],i[t++]=e[2],i}function oa(e,t){var i=new J.default({position:t.position,normal:t.normal||t.bitangent||e.shadowVolume,tangent:t.tangent,bitangent:t.normal||t.bitangent,st:t.st}),a=e.ellipsoid,r=ra(Fi.computePositions(e),i,a),n=e.height,o=e.extrudedHeight,l=r.attributes,u=r.indices,d=l.position.values,f=d.length,c=new Float64Array(6*f),h=new Float64Array(f);h.set(d);var p,m=new Float64Array(4*f);m=na(d=qi.a.scaleToGeodeticHeight(d,n,a),0,m),m=na(h=qi.a.scaleToGeodeticHeight(h,o,a),2*f,m),c.set(d),c.set(h,f),c.set(m,2*f),l.position.values=c,l=function(e,t){if(!(t.normal||t.tangent||t.bitangent||t.st))return e;var i,a,r=e.position.values;(t.normal||t.bitangent)&&(i=e.normal.values,a=e.bitangent.values);var n,o=e.position.values.length/18,s=3*o,l=2*o,u=2*s;if(t.normal||t.bitangent||t.tangent){var d=t.normal?new Float32Array(6*s):void 0,f=t.tangent?new Float32Array(6*s):void 0,c=t.bitangent?new Float32Array(6*s):void 0,h=Ki,p=Xi,m=Zi,_=Ji,g=Qi,b=$i,y=u;for(n=0;n<s;n+=3){var O=y+u;h=v.default.fromArray(r,n,h),p=v.default.fromArray(r,n+s,p),m=v.default.fromArray(r,(n+3)%s,m),p=v.default.subtract(p,h,p),m=v.default.subtract(m,h,m),_=v.default.normalize(v.default.cross(p,m,_),_),t.normal&&(Fi.addAttribute(d,_,O),Fi.addAttribute(d,_,O+3),Fi.addAttribute(d,_,y),Fi.addAttribute(d,_,y+3)),(t.tangent||t.bitangent)&&(b=v.default.fromArray(i,n,b),t.bitangent&&(Fi.addAttribute(c,b,O),Fi.addAttribute(c,b,O+3),Fi.addAttribute(c,b,y),Fi.addAttribute(c,b,y+3)),t.tangent&&(g=v.default.normalize(v.default.cross(b,_,g),g),Fi.addAttribute(f,g,O),Fi.addAttribute(f,g,O+3),Fi.addAttribute(f,g,y),Fi.addAttribute(f,g,y+3))),y+=6}if(t.normal){for(d.set(i),n=0;n<s;n+=3)d[n+s]=-i[n],d[n+s+1]=-i[n+1],d[n+s+2]=-i[n+2];e.normal.values=d}else e.normal=void 0;if(t.bitangent?(c.set(a),c.set(a,s),e.bitangent.values=c):e.bitangent=void 0,t.tangent){var w=e.tangent.values;f.set(w),f.set(w,s),e.tangent.values=f}}if(t.st){var x=e.st.values,E=new Float32Array(6*l);E.set(x),E.set(x,l);for(var T=2*l,C=0;C<2;C++){for(E[T++]=x[0],E[T++]=x[1],n=2;n<l;n+=2){var A=x[n],j=x[n+1];E[T++]=A,E[T++]=j,E[T++]=A,E[T++]=j}E[T++]=x[0],E[T++]=x[1]}e.st.values=E}return e}(l,t);var _=f/3;if(e.shadowVolume){var g=l.normal.values;f=g.length;var b=new Float32Array(6*f);for(p=0;p<f;p++)g[p]=-g[p];b.set(g,f),b=na(g,4*f,b),l.extrudeDirection=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:b}),t.normal||(l.normal=void 0)}if(Object(s.default)(e.offsetAttribute)){var y=new Uint8Array(6*_);if(e.offsetAttribute===fe.a.TOP)y=Object(Je.a)(y,1,0,_),y=Object(Je.a)(y,1,2*_,4*_);else{var O=e.offsetAttribute===fe.a.NONE?0:1;y=Object(Je.a)(y,O)}l.applyOffset=new ki.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:y})}var w=u.length,x=_+_,E=Gi.a.createTypedArray(c.length/3,2*w+3*x);E.set(u);var T,C,A,j,P=w;for(p=0;p<w;p+=3){var S=u[p],I=u[p+1],L=u[p+2];E[P++]=L+_,E[P++]=I+_,E[P++]=S+_}for(p=0;p<x;p+=2)A=(T=p+x)+1,j=(C=T+x)+1,E[P++]=T,E[P++]=C,E[P++]=A,E[P++]=A,E[P++]=C,E[P++]=j;return{attributes:l,indices:E}}var sa=new v.default,la=new v.default,ua=new Re.default;function da(e,t,i,a,r,n){var o=v.default.subtract(t,e,sa);v.default.normalize(o,o);var s=i.geodeticSurfaceNormal(e,la),l=v.default.cross(o,s,sa);v.default.multiplyByScalar(l,a,l);var u=r.latitude,d=r.longitude,f=n.latitude,c=n.longitude;v.default.add(e,l,la),i.cartesianToCartographic(la,ua);var h=ua.latitude,p=ua.longitude;u=Math.min(u,h),d=Math.min(d,p),f=Math.max(f,h),c=Math.max(c,p),v.default.subtract(e,l,la),i.cartesianToCartographic(la,ua),h=ua.latitude,p=ua.longitude,u=Math.min(u,h),d=Math.min(d,p),f=Math.max(f,h),c=Math.max(c,p),r.latitude=u,r.longitude=d,n.latitude=f,n.longitude=c}var fa=new v.default,ca=new v.default,ha=new Re.default,pa=new Re.default;function ma(e,t,i,a,r){e=ia(e,t);var n=Object(Qe.a)(e,v.default.equalsEpsilon),o=n.length;if(o<2||i<=0)return new Yi.default;var l,u,d=.5*i;if(ha.latitude=Number.POSITIVE_INFINITY,ha.longitude=Number.POSITIVE_INFINITY,pa.latitude=Number.NEGATIVE_INFINITY,pa.longitude=Number.NEGATIVE_INFINITY,a===$e.a.ROUNDED){var f=n[0];v.default.subtract(f,n[1],fa),v.default.normalize(fa,fa),v.default.multiplyByScalar(fa,d,fa),v.default.add(f,fa,ca),t.cartesianToCartographic(ca,ua),l=ua.latitude,u=ua.longitude,ha.latitude=Math.min(ha.latitude,l),ha.longitude=Math.min(ha.longitude,u),pa.latitude=Math.max(pa.latitude,l),pa.longitude=Math.max(pa.longitude,u)}for(var c=0;c<o-1;++c)da(n[c],n[c+1],t,d,ha,pa);var h=n[o-1];v.default.subtract(h,n[o-2],fa),v.default.normalize(fa,fa),v.default.multiplyByScalar(fa,d,fa),v.default.add(h,fa,ca),da(h,ca,t,d,ha,pa),a===$e.a.ROUNDED&&(t.cartesianToCartographic(ca,ua),l=ua.latitude,u=ua.longitude,ha.latitude=Math.min(ha.latitude,l),ha.longitude=Math.min(ha.longitude,u),pa.latitude=Math.max(pa.latitude,l),pa.longitude=Math.max(pa.longitude,u));var p=Object(s.default)(r)?r:new Yi.default;return p.north=pa.latitude,p.south=ha.latitude,p.east=pa.longitude,p.west=ha.longitude,p}function _a(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,i=e.width,a=Object(o.default)(e.height,0),r=Object(o.default)(e.extrudedHeight,a);this._positions=t,this._ellipsoid=tt.default.clone(Object(o.default)(e.ellipsoid,tt.default.WGS84)),this._vertexFormat=J.default.clone(Object(o.default)(e.vertexFormat,J.default.DEFAULT)),this._width=i,this._height=Math.max(a,r),this._extrudedHeight=Math.min(a,r),this._cornerType=Object(o.default)(e.cornerType,$e.a.ROUNDED),this._granularity=Object(o.default)(e.granularity,Ne.default.RADIANS_PER_DEGREE),this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createCorridorGeometry",this._offsetAttribute=e.offsetAttribute,this._rectangle=void 0,this.packedLength=1+t.length*v.default.packedLength+tt.default.packedLength+J.default.packedLength+7}_a.pack=function(e,t,i){i=Object(o.default)(i,0);var a=e._positions,r=a.length;t[i++]=r;for(var n=0;n<r;++n,i+=v.default.packedLength)v.default.pack(a[n],t,i);return tt.default.pack(e._ellipsoid,t,i),i+=tt.default.packedLength,J.default.pack(e._vertexFormat,t,i),i+=J.default.packedLength,t[i++]=e._width,t[i++]=e._height,t[i++]=e._extrudedHeight,t[i++]=e._cornerType,t[i++]=e._granularity,t[i++]=e._shadowVolume?1:0,t[i]=Object(o.default)(e._offsetAttribute,-1),t};var ga=tt.default.clone(tt.default.UNIT_SPHERE),va=new J.default,ba={positions:void 0,ellipsoid:ga,vertexFormat:va,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,shadowVolume:void 0,offsetAttribute:void 0};_a.unpack=function(e,t,i){t=Object(o.default)(t,0);for(var a=e[t++],r=new Array(a),n=0;n<a;++n,t+=v.default.packedLength)r[n]=v.default.unpack(e,t);var l=tt.default.unpack(e,t,ga);t+=tt.default.packedLength;var u=J.default.unpack(e,t,va);t+=J.default.packedLength;var d=e[t++],f=e[t++],c=e[t++],h=e[t++],p=e[t++],m=1===e[t++],_=e[t];return Object(s.default)(i)?(i._positions=r,i._ellipsoid=tt.default.clone(l,i._ellipsoid),i._vertexFormat=J.default.clone(u,i._vertexFormat),i._width=d,i._height=f,i._extrudedHeight=c,i._cornerType=h,i._granularity=p,i._shadowVolume=m,i._offsetAttribute=-1===_?void 0:_,i):(ba.positions=r,ba.width=d,ba.height=f,ba.extrudedHeight=c,ba.cornerType=h,ba.granularity=p,ba.shadowVolume=m,ba.offsetAttribute=-1===_?void 0:_,new _a(ba))},_a.computeRectangle=function(e,t){var i=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,a=e.width;return ma(i,Object(o.default)(e.ellipsoid,tt.default.WGS84),a,Object(o.default)(e.cornerType,$e.a.ROUNDED),t)},_a.createGeometry=function(e){var t=e._positions,i=e._width,a=e._ellipsoid;t=ia(t,a);var n=Object(Qe.a)(t,v.default.equalsEpsilon);if(!(n.length<2||i<=0)){var o,l=e._height,u=e._extrudedHeight,d=!Ne.default.equalsEpsilon(l,u,0,Ne.default.EPSILON2),f=e._vertexFormat,c={ellipsoid:a,positions:n,width:i,cornerType:e._cornerType,granularity:e._granularity,saveAttributes:!0};if(d)c.height=l,c.extrudedHeight=u,c.shadowVolume=e._shadowVolume,c.offsetAttribute=e._offsetAttribute,o=oa(c,f);else if((o=ra(Fi.computePositions(c),f,a)).attributes.position.values=qi.a.scaleToGeodeticHeight(o.attributes.position.values,l,a),Object(s.default)(e._offsetAttribute)){var h=e._offsetAttribute===fe.a.NONE?0:1,p=o.attributes.position.values.length,m=new Uint8Array(p/3);Object(Je.a)(m,h),o.attributes.applyOffset=new ki.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:m})}var _=o.attributes,g=r.default.fromVertices(_.position.values,void 0,3);return f.position||(o.attributes.position.values=void 0),new Hi.a({attributes:_,indices:o.indices,primitiveType:Wi.a.TRIANGLES,boundingSphere:g,offsetAttribute:e._offsetAttribute})}},_a.createShadowVolume=function(e,t,i){var a=e._granularity,r=e._ellipsoid,n=t(a,r),o=i(a,r);return new _a({positions:e._positions,width:e._width,cornerType:e._cornerType,ellipsoid:r,granularity:a,extrudedHeight:n,height:o,vertexFormat:J.default.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(_a.prototype,{rectangle:{get:function(){return Object(s.default)(this._rectangle)||(this._rectangle=ma(this._positions,this._ellipsoid,this._width,this._cornerType)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return[0,0,0,1,1,0]}}});var ya=_a,Oa=new v.default,wa=new v.default,xa=new v.default;function Ea(e,t){var i,a,r,n=[],o=e.positions,l=e.corners,u=e.endPositions,d=new zi.a,f=0,c=0,h=0;for(a=0;a<o.length;a+=2)f+=r=o[a].length-3,h+=r/3*4,c+=o[a+1].length-3;for(f+=3,c+=3,a=0;a<l.length;a++){i=l[a];var p=l[a].leftPositions;Object(s.default)(p)?(f+=r=p.length,h+=r/3*2):(c+=r=l[a].rightPositions.length,h+=r/3*2)}var m,_=Object(s.default)(u);_&&(f+=m=u[0].length-3,c+=m,h+=4*(m/=3));var g,b,y,O,w,x,E=f+c,T=new Float64Array(E),C=0,A=E-1,j=m/2,P=Gi.a.createTypedArray(E/3,h+4),S=0;if(P[S++]=C/3,P[S++]=(A-2)/3,_){n.push(C/3),x=Oa,w=wa;var I=u[0];for(a=0;a<j;a++)x=v.default.fromArray(I,3*(j-1-a),x),w=v.default.fromArray(I,3*(j+a),w),Fi.addAttribute(T,w,C),Fi.addAttribute(T,x,void 0,A),O=(b=C/3)+1,y=(g=(A-2)/3)-1,P[S++]=g,P[S++]=y,P[S++]=b,P[S++]=O,C+=3,A-=3}var L=0,D=o[L++],M=o[L++];for(T.set(D,C),T.set(M,A-M.length+1),r=M.length-3,n.push(C/3,(A-2)/3),a=0;a<r;a+=3)O=(b=C/3)+1,y=(g=(A-2)/3)-1,P[S++]=g,P[S++]=y,P[S++]=b,P[S++]=O,C+=3,A-=3;for(a=0;a<l.length;a++){var R,N,V=(i=l[a]).leftPositions,B=i.rightPositions,U=xa;if(Object(s.default)(V)){for(A-=3,N=y,n.push(O),R=0;R<V.length/3;R++)U=v.default.fromArray(V,3*R,U),P[S++]=N-R-1,P[S++]=N-R,Fi.addAttribute(T,U,void 0,A),A-=3;n.push(N-Math.floor(V.length/6)),t===$e.a.BEVELED&&n.push((A-2)/3+1),C+=3}else{for(C+=3,N=O,n.push(y),R=0;R<B.length/3;R++)U=v.default.fromArray(B,3*R,U),P[S++]=N+R,P[S++]=N+R+1,Fi.addAttribute(T,U,C),C+=3;n.push(N+Math.floor(B.length/6)),t===$e.a.BEVELED&&n.push(C/3-1),A-=3}for(D=o[L++],M=o[L++],D.splice(0,3),M.splice(M.length-3,3),T.set(D,C),T.set(M,A-M.length+1),r=M.length-3,R=0;R<M.length;R+=3)b=(O=C/3)-1,g=(y=(A-2)/3)+1,P[S++]=g,P[S++]=y,P[S++]=b,P[S++]=O,C+=3,A-=3;C-=3,A+=3,n.push(C/3,(A-2)/3)}if(_){C+=3,A-=3,x=Oa,w=wa;var F=u[1];for(a=0;a<j;a++)x=v.default.fromArray(F,3*(m-a-1),x),w=v.default.fromArray(F,3*a,w),Fi.addAttribute(T,x,void 0,A),Fi.addAttribute(T,w,C),b=(O=C/3)-1,g=(y=(A-2)/3)+1,P[S++]=g,P[S++]=y,P[S++]=b,P[S++]=O,C+=3,A-=3;n.push(C/3)}else n.push(C/3,(A-2)/3);return P[S++]=C/3,P[S++]=(A-2)/3,d.position=new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:T}),{attributes:d,indices:P,wallIndices:n}}function Ta(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,i=e.width,a=Object(o.default)(e.height,0),r=Object(o.default)(e.extrudedHeight,a);this._positions=t,this._ellipsoid=tt.default.clone(Object(o.default)(e.ellipsoid,tt.default.WGS84)),this._width=i,this._height=Math.max(a,r),this._extrudedHeight=Math.min(a,r),this._cornerType=Object(o.default)(e.cornerType,$e.a.ROUNDED),this._granularity=Object(o.default)(e.granularity,Ne.default.RADIANS_PER_DEGREE),this._offsetAttribute=e.offsetAttribute,this._workerName="createCorridorOutlineGeometry",this.packedLength=1+t.length*v.default.packedLength+tt.default.packedLength+6}Ta.pack=function(e,t,i){i=Object(o.default)(i,0);var a=e._positions,r=a.length;t[i++]=r;for(var n=0;n<r;++n,i+=v.default.packedLength)v.default.pack(a[n],t,i);return tt.default.pack(e._ellipsoid,t,i),i+=tt.default.packedLength,t[i++]=e._width,t[i++]=e._height,t[i++]=e._extrudedHeight,t[i++]=e._cornerType,t[i++]=e._granularity,t[i]=Object(o.default)(e._offsetAttribute,-1),t};var Ca=tt.default.clone(tt.default.UNIT_SPHERE),Aa={positions:void 0,ellipsoid:Ca,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,offsetAttribute:void 0};Ta.unpack=function(e,t,i){t=Object(o.default)(t,0);for(var a=e[t++],r=new Array(a),n=0;n<a;++n,t+=v.default.packedLength)r[n]=v.default.unpack(e,t);var l=tt.default.unpack(e,t,Ca);t+=tt.default.packedLength;var u=e[t++],d=e[t++],f=e[t++],c=e[t++],h=e[t++],p=e[t];return Object(s.default)(i)?(i._positions=r,i._ellipsoid=tt.default.clone(l,i._ellipsoid),i._width=u,i._height=d,i._extrudedHeight=f,i._cornerType=c,i._granularity=h,i._offsetAttribute=-1===p?void 0:p,i):(Aa.positions=r,Aa.width=u,Aa.height=d,Aa.extrudedHeight=f,Aa.cornerType=c,Aa.granularity=h,Aa.offsetAttribute=-1===p?void 0:p,new Ta(Aa))},Ta.createGeometry=function(e){var t=e._positions,i=e._width,a=e._ellipsoid;t=function(e,t){for(var i=0;i<e.length;i++)e[i]=t.scaleToGeodeticSurface(e[i],e[i]);return e}(t,a);var n=Object(Qe.a)(t,v.default.equalsEpsilon);if(!(n.length<2||i<=0)){var o,l=e._height,u=e._extrudedHeight,d=!Ne.default.equalsEpsilon(l,u,0,Ne.default.EPSILON2),f={ellipsoid:a,positions:n,width:i,cornerType:e._cornerType,granularity:e._granularity,saveAttributes:!1};if(d)f.height=l,f.extrudedHeight=u,f.offsetAttribute=e._offsetAttribute,o=function(e){var t=e.ellipsoid,i=Ea(Fi.computePositions(e),e.cornerType),a=i.wallIndices,r=e.height,n=e.extrudedHeight,o=i.attributes,l=i.indices,u=o.position.values,d=u.length,f=new Float64Array(d);f.set(u);var c,h=new Float64Array(2*d);if(u=qi.a.scaleToGeodeticHeight(u,r,t),f=qi.a.scaleToGeodeticHeight(f,n,t),h.set(u),h.set(f,d),o.position.values=h,d/=3,Object(s.default)(e.offsetAttribute)){var p=new Uint8Array(2*d);if(e.offsetAttribute===fe.a.TOP)p=Object(Je.a)(p,1,0,d);else{var m=e.offsetAttribute===fe.a.NONE?0:1;p=Object(Je.a)(p,m)}o.applyOffset=new ki.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:p})}var _=l.length,g=Gi.a.createTypedArray(h.length/3,2*(_+a.length));g.set(l);var v,b,y=_;for(c=0;c<_;c+=2){var O=l[c],w=l[c+1];g[y++]=O+d,g[y++]=w+d}for(c=0;c<a.length;c++)b=(v=a[c])+d,g[y++]=v,g[y++]=b;return{attributes:o,indices:g}}(f);else if((o=Ea(Fi.computePositions(f),f.cornerType)).attributes.position.values=qi.a.scaleToGeodeticHeight(o.attributes.position.values,l,a),Object(s.default)(e._offsetAttribute)){var c=o.attributes.position.values.length,h=new Uint8Array(c/3),p=e._offsetAttribute===fe.a.NONE?0:1;Object(Je.a)(h,p),o.attributes.applyOffset=new ki.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:h})}var m=o.attributes,_=r.default.fromVertices(m.position.values,void 0,3);return new Hi.a({attributes:m,indices:o.indices,primitiveType:Wi.a.LINES,boundingSphere:_,offsetAttribute:e._offsetAttribute})}};var ja=Ta,Pa=new we.a(0);function Sa(e){De.call(this,e),this._zIndex=0,this._terrainOffsetProperty=void 0}Object(s.default)(Object.create)&&(Sa.prototype=Object.create(De.prototype),Sa.prototype.constructor=Sa),Object.defineProperties(Sa.prototype,{zIndex:{get:function(){return this._zIndex}},terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),Sa.prototype._isOnTerrain=function(e,t){return this._fillEnabled&&!Object(s.default)(t.height)&&!Object(s.default)(t.extrudedHeight)&&f.a.isSupported(this._scene)},Sa.prototype._getIsClosed=function(e){var t=e.height,i=e.extrudedHeight;return 0===t||Object(s.default)(i)&&i!==t},Sa.prototype._computeCenter=y.default.throwInstantiationError,Sa.prototype._onEntityPropertyChanged=function(e,t,i,a){if(De.prototype._onEntityPropertyChanged.call(this,e,t,i,a),-1!==this._observedPropertyNames.indexOf(t)){var r=this._entity[this._geometryPropertyName];if(Object(s.default)(r)){Object(s.default)(r.zIndex)&&(Object(s.default)(r.height)||Object(s.default)(r.extrudedHeight))&&Object(Oe.a)(Oe.a.geometryZIndex),this._zIndex=Object(o.default)(r.zIndex,Pa),Object(s.default)(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0);var n=r.heightReference,l=r.extrudedHeightReference;if(Object(s.default)(n)||Object(s.default)(l)){var u=new Me.default(this._computeCenter.bind(this),!this._dynamic);this._terrainOffsetProperty=new He(this._scene,u,n,l)}}}},Sa.prototype.destroy=function(){Object(s.default)(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0),De.prototype.destroy.call(this)},Sa.getGeometryHeight=function(e,t){if(Object(s.default)(e))return t!==x.default.CLAMP_TO_GROUND?e:0;t!==x.default.NONE&&Object(Oe.a)(Oe.a.geometryHeightReference)},Sa.getGeometryExtrudedHeight=function(e,t){if(Object(s.default)(e))return t!==x.default.CLAMP_TO_GROUND?e:Sa.CLAMP_TO_GROUND;t!==x.default.NONE&&Object(Oe.a)(Oe.a.geometryExtrudedHeightReference)},Sa.CLAMP_TO_GROUND="clamp",Sa.computeGeometryOffsetAttribute=function(e,t,i,a){Object(s.default)(e)&&Object(s.default)(t)||(t=x.default.NONE),Object(s.default)(i)&&Object(s.default)(a)||(a=x.default.NONE);var r=0;return t!==x.default.NONE&&r++,a===x.default.RELATIVE_TO_GROUND&&r++,2===r?fe.a.ALL:1===r?fe.a.TOP:void 0};var Ia=Sa,La=new b.default,Da=v.default.ZERO,Ma=new v.default,Ra=new Yi.default;function Na(e){this.id=e,this.vertexFormat=void 0,this.positions=void 0,this.width=void 0,this.cornerType=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.offsetAttribute=void 0}function Va(e,t){Ia.call(this,{entity:e,scene:t,geometryOptions:new Na(e),geometryPropertyName:"corridor",observedPropertyNames:["availability","corridor"]}),this._onEntityPropertyChanged(e,"corridor",e.corridor,void 0)}function Ba(e,t,i){ye.call(this,e,t,i)}Object(s.default)(Object.create)&&(Va.prototype=Object.create(Ia.prototype),Va.prototype.constructor=Va),Va.prototype.createFillGeometryInstance=function(e){var t,i=this._entity,a=i.isAvailable(e),r={show:new pe.a(a&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:ue.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof me.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(t=this._materialProperty.color.getValue(e,La)),Object(s.default)(t)||(t=b.default.WHITE),r.color=oe.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(r.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,Da,Ma))),new de.a({id:i,geometry:new ya(this._options),attributes:r})},Va.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,i=t.isAvailable(e),a=A.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,La),r={show:new pe.a(i&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(a),distanceDisplayCondition:ue.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(r.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,Da,Ma))),new de.a({id:t,geometry:new ja(this._options),attributes:r})},Va.prototype._computeCenter=function(e,t){var i=A.default.getValueOrUndefined(this._entity.corridor.positions,e);if(Object(s.default)(i)&&0!==i.length)return v.default.clone(i[Math.floor(i.length/2)],t)},Va.prototype._isHidden=function(e,t){return!Object(s.default)(t.positions)||!Object(s.default)(t.width)||De.prototype._isHidden.call(this,e,t)},Va.prototype._isDynamic=function(e,t){return!t.positions.isConstant||!A.default.isConstant(t.height)||!A.default.isConstant(t.extrudedHeight)||!A.default.isConstant(t.granularity)||!A.default.isConstant(t.width)||!A.default.isConstant(t.outlineWidth)||!A.default.isConstant(t.cornerType)||!A.default.isConstant(t.zIndex)||this._onTerrain&&!A.default.isConstant(this._materialProperty)&&!(this._materialProperty instanceof me.default)},Va.prototype._setStaticOptions=function(e,t){var i=A.default.getValueOrUndefined(t.height,ce.default.MINIMUM_VALUE),r=A.default.getValueOrDefault(t.heightReference,ce.default.MINIMUM_VALUE,x.default.NONE),n=A.default.getValueOrUndefined(t.extrudedHeight,ce.default.MINIMUM_VALUE),o=A.default.getValueOrDefault(t.extrudedHeightReference,ce.default.MINIMUM_VALUE,x.default.NONE);Object(s.default)(n)&&!Object(s.default)(i)&&(i=0);var l=this._options;l.vertexFormat=this._materialProperty instanceof me.default?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,l.positions=t.positions.getValue(ce.default.MINIMUM_VALUE,l.positions),l.width=t.width.getValue(ce.default.MINIMUM_VALUE),l.granularity=A.default.getValueOrUndefined(t.granularity,ce.default.MINIMUM_VALUE),l.cornerType=A.default.getValueOrUndefined(t.cornerType,ce.default.MINIMUM_VALUE),l.offsetAttribute=Ia.computeGeometryOffsetAttribute(i,r,n,o),l.height=Ia.getGeometryHeight(i,r),(n=Ia.getGeometryExtrudedHeight(n,o))===Ia.CLAMP_TO_GROUND&&(n=a.a.getMinimumMaximumHeights(ya.computeRectangle(l,Ra)).minimumTerrainHeight),l.extrudedHeight=n},Va.DynamicGeometryUpdater=Ba,Object(s.default)(Object.create)&&(Ba.prototype=Object.create(ye.prototype),Ba.prototype.constructor=Ba),Ba.prototype._isHidden=function(e,t,i){var a=this._options;return!Object(s.default)(a.positions)||!Object(s.default)(a.width)||ye.prototype._isHidden.call(this,e,t,i)},Ba.prototype._setOptions=function(e,t,i){var r=this._options,n=A.default.getValueOrUndefined(t.height,i),o=A.default.getValueOrDefault(t.heightReference,i,x.default.NONE),l=A.default.getValueOrUndefined(t.extrudedHeight,i),u=A.default.getValueOrDefault(t.extrudedHeightReference,i,x.default.NONE);Object(s.default)(l)&&!Object(s.default)(n)&&(n=0),r.positions=A.default.getValueOrUndefined(t.positions,i),r.width=A.default.getValueOrUndefined(t.width,i),r.granularity=A.default.getValueOrUndefined(t.granularity,i),r.cornerType=A.default.getValueOrUndefined(t.cornerType,i),r.offsetAttribute=Ia.computeGeometryOffsetAttribute(n,o,l,u),r.height=Ia.getGeometryHeight(n,o),(l=Ia.getGeometryExtrudedHeight(l,u))===Ia.CLAMP_TO_GROUND&&(l=a.a.getMinimumMaximumHeights(ya.computeRectangle(r,Ra)).minimumTerrainHeight),r.extrudedHeight=l};var Ua=Va,Fa={computePositions:function(e,t,i,a,r){var n,o=.5*e,s=-o,l=a+a,u=new Float64Array(3*(r?2*l:l)),d=0,f=0,c=r?3*l:0,h=r?3*(l+a):3*a;for(n=0;n<a;n++){var p=n/a*Ne.default.TWO_PI,m=Math.cos(p),_=Math.sin(p),g=m*i,v=_*i,b=m*t,y=_*t;u[f+c]=g,u[f+c+1]=v,u[f+c+2]=s,u[f+h]=b,u[f+h+1]=y,u[f+h+2]=o,f+=3,r&&(u[d++]=g,u[d++]=v,u[d++]=s,u[d++]=b,u[d++]=y,u[d++]=o)}return u}},Ha=Fa,ka=new g.default,za=new v.default,Ga=new v.default,qa=new v.default,Wa=new v.default;function Ya(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).length,i=e.topRadius,a=e.bottomRadius,r=Object(o.default)(e.vertexFormat,J.default.DEFAULT),n=Object(o.default)(e.slices,128);this._length=t,this._topRadius=i,this._bottomRadius=a,this._vertexFormat=J.default.clone(r),this._slices=n,this._offsetAttribute=e.offsetAttribute,this._workerName="createCylinderGeometry"}Ya.packedLength=J.default.packedLength+5,Ya.pack=function(e,t,i){return i=Object(o.default)(i,0),J.default.pack(e._vertexFormat,t,i),i+=J.default.packedLength,t[i++]=e._length,t[i++]=e._topRadius,t[i++]=e._bottomRadius,t[i++]=e._slices,t[i]=Object(o.default)(e._offsetAttribute,-1),t};var Ka,Xa=new J.default,Za={vertexFormat:Xa,length:void 0,topRadius:void 0,bottomRadius:void 0,slices:void 0,offsetAttribute:void 0};Ya.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=J.default.unpack(e,t,Xa);t+=J.default.packedLength;var r=e[t++],n=e[t++],l=e[t++],u=e[t++],d=e[t];return Object(s.default)(i)?(i._vertexFormat=J.default.clone(a,i._vertexFormat),i._length=r,i._topRadius=n,i._bottomRadius=l,i._slices=u,i._offsetAttribute=-1===d?void 0:d,i):(Za.length=r,Za.topRadius=n,Za.bottomRadius=l,Za.slices=u,Za.offsetAttribute=-1===d?void 0:d,new Ya(Za))},Ya.createGeometry=function(e){var t=e._length,i=e._topRadius,a=e._bottomRadius,n=e._vertexFormat,o=e._slices;if(!(t<=0||i<0||a<0||0===i&&0===a)){var l,u=o+o,d=o+u,f=u+u,c=Ha.computePositions(t,i,a,o,!0),h=n.st?new Float32Array(2*f):void 0,p=n.normal?new Float32Array(3*f):void 0,m=n.tangent?new Float32Array(3*f):void 0,_=n.bitangent?new Float32Array(3*f):void 0,b=n.normal||n.tangent||n.bitangent;if(b){var y=n.tangent||n.bitangent,O=0,w=0,x=0,E=Math.atan2(a-i,t),T=za;T.z=Math.sin(E);var C=Math.cos(E),A=qa,j=Ga;for(l=0;l<o;l++){var P=l/o*Ne.default.TWO_PI,S=C*Math.cos(P),I=C*Math.sin(P);b&&(T.x=S,T.y=I,y&&(A=v.default.normalize(v.default.cross(v.default.UNIT_Z,T,A),A)),n.normal&&(p[O++]=T.x,p[O++]=T.y,p[O++]=T.z,p[O++]=T.x,p[O++]=T.y,p[O++]=T.z),n.tangent&&(m[w++]=A.x,m[w++]=A.y,m[w++]=A.z,m[w++]=A.x,m[w++]=A.y,m[w++]=A.z),n.bitangent&&(j=v.default.normalize(v.default.cross(T,A,j),j),_[x++]=j.x,_[x++]=j.y,_[x++]=j.z,_[x++]=j.x,_[x++]=j.y,_[x++]=j.z))}for(l=0;l<o;l++)n.normal&&(p[O++]=0,p[O++]=0,p[O++]=-1),n.tangent&&(m[w++]=1,m[w++]=0,m[w++]=0),n.bitangent&&(_[x++]=0,_[x++]=-1,_[x++]=0);for(l=0;l<o;l++)n.normal&&(p[O++]=0,p[O++]=0,p[O++]=1),n.tangent&&(m[w++]=1,m[w++]=0,m[w++]=0),n.bitangent&&(_[x++]=0,_[x++]=1,_[x++]=0)}var L=12*o-12,D=Gi.a.createTypedArray(f,L),M=0,R=0;for(l=0;l<o-1;l++)D[M++]=R,D[M++]=R+2,D[M++]=R+3,D[M++]=R,D[M++]=R+3,D[M++]=R+1,R+=2;for(D[M++]=u-2,D[M++]=0,D[M++]=1,D[M++]=u-2,D[M++]=1,D[M++]=u-1,l=1;l<o-1;l++)D[M++]=u+l+1,D[M++]=u+l,D[M++]=u;for(l=1;l<o-1;l++)D[M++]=d,D[M++]=d+l,D[M++]=d+l+1;var N=0;if(n.st){var V=Math.max(i,a);for(l=0;l<f;l++){var B=v.default.fromArray(c,3*l,Wa);h[N++]=(B.x+V)/(2*V),h[N++]=(B.y+V)/(2*V)}}var U=new zi.a;n.position&&(U.position=new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:c})),n.normal&&(U.normal=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:p})),n.tangent&&(U.tangent=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:m})),n.bitangent&&(U.bitangent=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:_})),n.st&&(U.st=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:h})),ka.x=.5*t,ka.y=Math.max(a,i);var F=new r.default(v.default.ZERO,g.default.magnitude(ka));if(Object(s.default)(e._offsetAttribute)){t=c.length;var H=new Uint8Array(t/3),k=e._offsetAttribute===fe.a.NONE?0:1;Object(Je.a)(H,k),U.applyOffset=new ki.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:H})}return new Hi.a({attributes:U,indices:D,primitiveType:Wi.a.TRIANGLES,boundingSphere:F,offsetAttribute:e._offsetAttribute})}},Ya.getUnitCylinder=function(){return Object(s.default)(Ka)||(Ka=Ya.createGeometry(new Ya({topRadius:1,bottomRadius:1,length:1,vertexFormat:J.default.POSITION_ONLY}))),Ka};var Ja=Ya,Qa=new g.default;function $a(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).length,i=e.topRadius,a=e.bottomRadius,r=Object(o.default)(e.slices,128),n=Math.max(Object(o.default)(e.numberOfVerticalLines,16),0);this._length=t,this._topRadius=i,this._bottomRadius=a,this._slices=r,this._numberOfVerticalLines=n,this._offsetAttribute=e.offsetAttribute,this._workerName="createCylinderOutlineGeometry"}$a.packedLength=6,$a.pack=function(e,t,i){return i=Object(o.default)(i,0),t[i++]=e._length,t[i++]=e._topRadius,t[i++]=e._bottomRadius,t[i++]=e._slices,t[i++]=e._numberOfVerticalLines,t[i]=Object(o.default)(e._offsetAttribute,-1),t};var er={length:void 0,topRadius:void 0,bottomRadius:void 0,slices:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};$a.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=e[t++],r=e[t++],n=e[t++],l=e[t++],u=e[t++],d=e[t];return Object(s.default)(i)?(i._length=a,i._topRadius=r,i._bottomRadius=n,i._slices=l,i._numberOfVerticalLines=u,i._offsetAttribute=-1===d?void 0:d,i):(er.length=a,er.topRadius=r,er.bottomRadius=n,er.slices=l,er.numberOfVerticalLines=u,er.offsetAttribute=-1===d?void 0:d,new $a(er))},$a.createGeometry=function(e){var t=e._length,i=e._topRadius,a=e._bottomRadius,n=e._slices,o=e._numberOfVerticalLines;if(!(t<=0||i<0||a<0||0===i&&0===a)){var l,u=2*n,d=Ha.computePositions(t,i,a,n,!1),f=2*n;if(o>0){var c=Math.min(o,n);l=Math.round(n/c),f+=c}var h,p=Gi.a.createTypedArray(u,2*f),m=0;for(h=0;h<n-1;h++)p[m++]=h,p[m++]=h+1,p[m++]=h+n,p[m++]=h+1+n;if(p[m++]=n-1,p[m++]=0,p[m++]=n+n-1,p[m++]=n,o>0)for(h=0;h<n;h+=l)p[m++]=h,p[m++]=h+n;var _=new zi.a;_.position=new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:d}),Qa.x=.5*t,Qa.y=Math.max(a,i);var b=new r.default(v.default.ZERO,g.default.magnitude(Qa));if(Object(s.default)(e._offsetAttribute)){t=d.length;var y=new Uint8Array(t/3),O=e._offsetAttribute===fe.a.NONE?0:1;Object(Je.a)(y,O),_.applyOffset=new ki.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:y})}return new Hi.a({attributes:_,indices:p,primitiveType:Wi.a.LINES,boundingSphere:b,offsetAttribute:e._offsetAttribute})}};var tr=$a,ir=v.default.ZERO,ar=new v.default,rr=new v.default,nr=new b.default;function or(e){this.id=e,this.vertexFormat=void 0,this.length=void 0,this.topRadius=void 0,this.bottomRadius=void 0,this.slices=void 0,this.numberOfVerticalLines=void 0,this.offsetAttribute=void 0}function sr(e,t){De.call(this,{entity:e,scene:t,geometryOptions:new or(e),geometryPropertyName:"cylinder",observedPropertyNames:["availability","position","orientation","cylinder"]}),this._onEntityPropertyChanged(e,"cylinder",e.cylinder,void 0)}function lr(e,t,i){ye.call(this,e,t,i)}Object(s.default)(Object.create)&&(sr.prototype=Object.create(De.prototype),sr.prototype.constructor=sr),Object.defineProperties(sr.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),sr.prototype.createFillGeometryInstance=function(e){var t,i=this._entity,a=i.isAvailable(e),r=new pe.a(a&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),n=this._distanceDisplayConditionProperty.getValue(e),o={show:r,distanceDisplayCondition:ue.fromDistanceDisplayCondition(n),color:void 0,offset:void 0};this._materialProperty instanceof me.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(t=this._materialProperty.color.getValue(e,nr)),Object(s.default)(t)||(t=b.default.WHITE),o.color=oe.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(o.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,ir,ar))),new de.a({id:i,geometry:new Ja(this._options),modelMatrix:i.computeModelMatrixForHeightReference(e,i.cylinder.heightReference,.5*this._options.length,this._scene.mapProjection.ellipsoid),attributes:o})},sr.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,i=t.isAvailable(e),a=A.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,nr),r=this._distanceDisplayConditionProperty.getValue(e),n={show:new pe.a(i&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(a),distanceDisplayCondition:ue.fromDistanceDisplayCondition(r),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(n.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,ir,ar))),new de.a({id:t,geometry:new tr(this._options),modelMatrix:t.computeModelMatrixForHeightReference(e,t.cylinder.heightReference,.5*this._options.length,this._scene.mapProjection.ellipsoid),attributes:n})},sr.prototype._computeCenter=function(e,t){return A.default.getValueOrUndefined(this._entity.position,e,t)},sr.prototype._isHidden=function(e,t){return!Object(s.default)(e.position)||!Object(s.default)(t.length)||!Object(s.default)(t.topRadius)||!Object(s.default)(t.bottomRadius)||De.prototype._isHidden.call(this,e,t)},sr.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&A.default.isConstant(e.orientation)&&t.length.isConstant&&t.topRadius.isConstant&&t.bottomRadius.isConstant&&A.default.isConstant(t.slices)&&A.default.isConstant(t.outlineWidth)&&A.default.isConstant(t.numberOfVerticalLines))},sr.prototype._setStaticOptions=function(e,t){var i=A.default.getValueOrDefault(t.heightReference,ce.default.MINIMUM_VALUE,x.default.NONE),a=this._options;a.vertexFormat=this._materialProperty instanceof me.default?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,a.length=t.length.getValue(ce.default.MINIMUM_VALUE),a.topRadius=t.topRadius.getValue(ce.default.MINIMUM_VALUE),a.bottomRadius=t.bottomRadius.getValue(ce.default.MINIMUM_VALUE),a.slices=A.default.getValueOrUndefined(t.slices,ce.default.MINIMUM_VALUE),a.numberOfVerticalLines=A.default.getValueOrUndefined(t.numberOfVerticalLines,ce.default.MINIMUM_VALUE),a.offsetAttribute=i!==x.default.NONE?fe.a.ALL:void 0},sr.prototype._onEntityPropertyChanged=ke,sr.DynamicGeometryUpdater=lr,Object(s.default)(Object.create)&&(lr.prototype=Object.create(ye.prototype),lr.prototype.constructor=lr),lr.prototype._isHidden=function(e,t,i){var a=this._options,r=A.default.getValueOrUndefined(e.position,i,rr);return!Object(s.default)(r)||!Object(s.default)(a.length)||!Object(s.default)(a.topRadius)||!Object(s.default)(a.bottomRadius)||ye.prototype._isHidden.call(this,e,t,i)},lr.prototype._setOptions=function(e,t,i){var a=A.default.getValueOrDefault(t.heightReference,i,x.default.NONE),r=this._options;r.length=A.default.getValueOrUndefined(t.length,i),r.topRadius=A.default.getValueOrUndefined(t.topRadius,i),r.bottomRadius=A.default.getValueOrUndefined(t.bottomRadius,i),r.slices=A.default.getValueOrUndefined(t.slices,i),r.numberOfVerticalLines=A.default.getValueOrUndefined(t.numberOfVerticalLines,i),r.offsetAttribute=a!==x.default.NONE?fe.a.ALL:void 0};var ur=sr;function dr(e,t){this._primitives=e,this._orderedGroundPrimitives=t,this._dynamicUpdaters=new m.default}dr.prototype.add=function(e,t){this._dynamicUpdaters.set(t.id,t.createDynamicUpdater(this._primitives,this._orderedGroundPrimitives))},dr.prototype.remove=function(e){var t=e.id,i=this._dynamicUpdaters.get(t);Object(s.default)(i)&&(this._dynamicUpdaters.remove(t),i.destroy())},dr.prototype.update=function(e){for(var t=this._dynamicUpdaters.values,i=0,a=t.length;i<a;i++)t[i].update(e);return!0},dr.prototype.removeAllPrimitives=function(){for(var e=this._dynamicUpdaters.values,t=0,i=e.length;t<i;t++)e[t].destroy();this._dynamicUpdaters.removeAll()},dr.prototype.getBoundingSphere=function(e,t){return e=this._dynamicUpdaters.get(e.id),Object(s.default)(e)&&Object(s.default)(e.getBoundingSphere)?e.getBoundingSphere(t):C.default.FAILED};var fr=dr,cr={},hr=new v.default,pr=new v.default,mr=new Dt.default,_r=new et.default;function gr(e,t,i,a,r,n,o,s,l,u){var d=e+t;v.default.multiplyByScalar(a,Math.cos(d),hr),v.default.multiplyByScalar(i,Math.sin(d),pr),v.default.add(hr,pr,hr);var f=Math.cos(e);f*=f;var c=Math.sin(e);c*=c;var h=n/Math.sqrt(o*f+r*c)/s;return Dt.default.fromAxisAngle(hr,h,mr),et.default.fromQuaternion(mr,_r),et.default.multiplyByVector(_r,l,u),v.default.normalize(u,u),v.default.multiplyByScalar(u,s,u),u}var vr=new v.default,br=new v.default,yr=new v.default,Or=new v.default;cr.raisePositionsToHeight=function(e,t,i){for(var a=t.ellipsoid,r=t.height,n=t.extrudedHeight,o=i?e.length/3*2:e.length/3,s=new Float64Array(3*o),l=e.length,u=i?l:0,d=0;d<l;d+=3){var f=d+1,c=d+2,h=v.default.fromArray(e,d,vr);a.scaleToGeodeticSurface(h,h);var p=v.default.clone(h,br),m=a.geodeticSurfaceNormal(h,Or),_=v.default.multiplyByScalar(m,r,yr);v.default.add(h,_,h),i&&(v.default.multiplyByScalar(m,n,_),v.default.add(p,_,p),s[d+u]=p.x,s[f+u]=p.y,s[c+u]=p.z),s[d]=h.x,s[f]=h.y,s[c]=h.z}return s};var wr=new v.default,xr=new v.default,Er=new v.default;cr.computeEllipsePositions=function(e,t,i){var a=e.semiMinorAxis,r=e.semiMajorAxis,n=e.rotation,o=e.center,s=8*e.granularity,l=a*a,u=r*r,d=r*a,f=v.default.magnitude(o),c=v.default.normalize(o,wr),h=v.default.cross(v.default.UNIT_Z,o,xr);h=v.default.normalize(h,h);var p=v.default.cross(c,h,Er),m=1+Math.ceil(Ne.default.PI_OVER_TWO/s),_=Ne.default.PI_OVER_TWO/(m-1),g=Ne.default.PI_OVER_TWO-m*_;g<0&&(m-=Math.ceil(Math.abs(g)/_));var b,y,O,w,x,E=t?new Array(3*(m*(m+2)*2)):void 0,T=0,C=vr,A=br,j=4*m*3,P=j-1,S=0,I=i?new Array(j):void 0;for(C=gr(g=Ne.default.PI_OVER_TWO,n,p,h,l,d,u,f,c,C),t&&(E[T++]=C.x,E[T++]=C.y,E[T++]=C.z),i&&(I[P--]=C.z,I[P--]=C.y,I[P--]=C.x),g=Ne.default.PI_OVER_TWO-_,b=1;b<m+1;++b){if(C=gr(g,n,p,h,l,d,u,f,c,C),A=gr(Math.PI-g,n,p,h,l,d,u,f,c,A),t){for(E[T++]=C.x,E[T++]=C.y,E[T++]=C.z,O=2*b+2,y=1;y<O-1;++y)w=y/(O-1),x=v.default.lerp(C,A,w,yr),E[T++]=x.x,E[T++]=x.y,E[T++]=x.z;E[T++]=A.x,E[T++]=A.y,E[T++]=A.z}i&&(I[P--]=C.z,I[P--]=C.y,I[P--]=C.x,I[S++]=A.x,I[S++]=A.y,I[S++]=A.z),g=Ne.default.PI_OVER_TWO-(b+1)*_}for(b=m;b>1;--b){if(C=gr(-(g=Ne.default.PI_OVER_TWO-(b-1)*_),n,p,h,l,d,u,f,c,C),A=gr(g+Math.PI,n,p,h,l,d,u,f,c,A),t){for(E[T++]=C.x,E[T++]=C.y,E[T++]=C.z,O=2*(b-1)+2,y=1;y<O-1;++y)w=y/(O-1),x=v.default.lerp(C,A,w,yr),E[T++]=x.x,E[T++]=x.y,E[T++]=x.z;E[T++]=A.x,E[T++]=A.y,E[T++]=A.z}i&&(I[P--]=C.z,I[P--]=C.y,I[P--]=C.x,I[S++]=A.x,I[S++]=A.y,I[S++]=A.z)}C=gr(-(g=Ne.default.PI_OVER_TWO),n,p,h,l,d,u,f,c,C);var L={};return t&&(E[T++]=C.x,E[T++]=C.y,E[T++]=C.z,L.positions=E,L.numPts=m),i&&(I[P--]=C.z,I[P--]=C.y,I[P--]=C.x,L.outerPositions=I),L};var Tr=cr,Cr=i(91),Ar=i(100),jr=new v.default,Pr=new v.default,Sr=new v.default,Ir=new v.default,Lr=new g.default,Dr=new et.default,Mr=new et.default,Rr=new Dt.default,Nr=new v.default,Vr=new v.default,Br=new v.default,Ur=new Re.default,Fr=new v.default,Hr=new g.default,kr=new g.default;function zr(e,t,i){var a=t.vertexFormat,r=t.center,n=t.semiMajorAxis,o=t.semiMinorAxis,l=t.ellipsoid,u=t.stRotation,d=i?e.length/3*2:e.length/3,f=t.shadowVolume,c=a.st?new Float32Array(2*d):void 0,h=a.normal?new Float32Array(3*d):void 0,p=a.tangent?new Float32Array(3*d):void 0,m=a.bitangent?new Float32Array(3*d):void 0,_=f?new Float32Array(3*d):void 0,b=0,y=Nr,O=Vr,w=Br,x=new Cr.a(l),E=x.project(l.cartesianToCartographic(r,Ur),Fr),T=l.scaleToGeodeticSurface(r,jr);l.geodeticSurfaceNormal(T,T);var C=Dr,A=Mr;if(0!==u){var j=Dt.default.fromAxisAngle(T,u,Rr);C=et.default.fromQuaternion(j,C),j=Dt.default.fromAxisAngle(T,-u,Rr),A=et.default.fromQuaternion(j,A)}else C=et.default.clone(et.default.IDENTITY,C),A=et.default.clone(et.default.IDENTITY,A);for(var P=g.default.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Hr),S=g.default.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,kr),I=e.length,L=i?I:0,D=L/3*2,M=0;M<I;M+=3){var R=M+1,N=M+2,V=v.default.fromArray(e,M,jr);if(a.st){var B=et.default.multiplyByVector(C,V,Pr),U=x.project(l.cartesianToCartographic(B,Ur),Sr);v.default.subtract(U,E,U),Lr.x=(U.x+n)/(2*n),Lr.y=(U.y+o)/(2*o),P.x=Math.min(Lr.x,P.x),P.y=Math.min(Lr.y,P.y),S.x=Math.max(Lr.x,S.x),S.y=Math.max(Lr.y,S.y),i&&(c[b+D]=Lr.x,c[b+1+D]=Lr.y),c[b++]=Lr.x,c[b++]=Lr.y}(a.normal||a.tangent||a.bitangent||f)&&(y=l.geodeticSurfaceNormal(V,y),f&&(_[M+L]=-y.x,_[R+L]=-y.y,_[N+L]=-y.z),(a.normal||a.tangent||a.bitangent)&&((a.tangent||a.bitangent)&&(O=v.default.normalize(v.default.cross(v.default.UNIT_Z,y,O),O),et.default.multiplyByVector(A,O,O)),a.normal&&(h[M]=y.x,h[R]=y.y,h[N]=y.z,i&&(h[M+L]=-y.x,h[R+L]=-y.y,h[N+L]=-y.z)),a.tangent&&(p[M]=O.x,p[R]=O.y,p[N]=O.z,i&&(p[M+L]=-O.x,p[R+L]=-O.y,p[N+L]=-O.z)),a.bitangent&&(w=v.default.normalize(v.default.cross(y,O,w),w),m[M]=w.x,m[R]=w.y,m[N]=w.z,i&&(m[M+L]=w.x,m[R+L]=w.y,m[N+L]=w.z))))}if(a.st){I=c.length;for(var F=0;F<I;F+=2)c[F]=(c[F]-P.x)/(S.x-P.x),c[F+1]=(c[F+1]-P.y)/(S.y-P.y)}var H=new zi.a;if(a.position){var k=Tr.raisePositionsToHeight(e,t,i);H.position=new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:k})}if(a.st&&(H.st=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:c})),a.normal&&(H.normal=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:h})),a.tangent&&(H.tangent=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:p})),a.bitangent&&(H.bitangent=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:m})),f&&(H.extrudeDirection=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:_})),i&&Object(s.default)(t.offsetAttribute)){var z=new Uint8Array(d);if(t.offsetAttribute===fe.a.TOP)z=Object(Je.a)(z,1,0,d/2);else{var G=t.offsetAttribute===fe.a.NONE?0:1;z=Object(Je.a)(z,G)}H.applyOffset=new ki.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:z})}return H}function Gr(e){var t,i,a,r,n,o=new Array(e*(e+1)*12-6),s=0;for(t=0,a=1,r=0;r<3;r++)o[s++]=a++,o[s++]=t,o[s++]=a;for(r=2;r<e+1;++r){for(a=r*(r+1)-1,t=(r-1)*r-1,o[s++]=a++,o[s++]=t,o[s++]=a,i=2*r,n=0;n<i-1;++n)o[s++]=a,o[s++]=t++,o[s++]=t,o[s++]=a++,o[s++]=t,o[s++]=a;o[s++]=a++,o[s++]=t,o[s++]=a}for(i=2*e,++a,++t,r=0;r<i-1;++r)o[s++]=a,o[s++]=t++,o[s++]=t,o[s++]=a++,o[s++]=t,o[s++]=a;for(o[s++]=a,o[s++]=t++,o[s++]=t,o[s++]=a++,o[s++]=t++,o[s++]=t,++t,r=e-1;r>1;--r){for(o[s++]=t++,o[s++]=t,o[s++]=a,i=2*r,n=0;n<i-1;++n)o[s++]=a,o[s++]=t++,o[s++]=t,o[s++]=a++,o[s++]=t,o[s++]=a;o[s++]=t++,o[s++]=t++,o[s++]=a++}for(r=0;r<3;r++)o[s++]=t++,o[s++]=t,o[s++]=a;return o}var qr=new v.default;var Wr=new r.default,Yr=new r.default;function Kr(e){var t=e.center,i=e.ellipsoid,a=e.semiMajorAxis,n=v.default.multiplyByScalar(i.geodeticSurfaceNormal(t,jr),e.height,jr);Wr.center=v.default.add(t,n,Wr.center),Wr.radius=a,n=v.default.multiplyByScalar(i.geodeticSurfaceNormal(t,n),e.extrudedHeight,n),Yr.center=v.default.add(t,n,Yr.center),Yr.radius=a;var o=Tr.computeEllipsePositions(e,!0,!0),l=o.positions,u=o.numPts,d=o.outerPositions,f=r.default.union(Wr,Yr),c=zr(l,e,!0),h=Gr(u),p=h.length;h.length=2*p;for(var m=l.length/3,_=0;_<p;_+=3)h[_+p]=h[_+2]+m,h[_+1+p]=h[_+1]+m,h[_+2+p]=h[_]+m;var b=Gi.a.createTypedArray(2*m/3,h),y=new Hi.a({attributes:c,indices:b,primitiveType:Wi.a.TRIANGLES}),O=function(e,t){var i=t.vertexFormat,a=t.center,r=t.semiMajorAxis,n=t.semiMinorAxis,o=t.ellipsoid,l=t.height,u=t.extrudedHeight,d=t.stRotation,f=e.length/3*2,c=new Float64Array(3*f),h=i.st?new Float32Array(2*f):void 0,p=i.normal?new Float32Array(3*f):void 0,m=i.tangent?new Float32Array(3*f):void 0,_=i.bitangent?new Float32Array(3*f):void 0,b=t.shadowVolume,y=b?new Float32Array(3*f):void 0,O=0,w=Nr,x=Vr,E=Br,T=new Cr.a(o),C=T.project(o.cartesianToCartographic(a,Ur),Fr),A=o.scaleToGeodeticSurface(a,jr);o.geodeticSurfaceNormal(A,A);for(var j=Dt.default.fromAxisAngle(A,d,Rr),P=et.default.fromQuaternion(j,Dr),S=g.default.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Hr),I=g.default.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,kr),L=e.length,D=L/3*2,M=0;M<L;M+=3){var R,N=M+1,V=M+2,B=v.default.fromArray(e,M,jr);if(i.st){var U=et.default.multiplyByVector(P,B,Pr),F=T.project(o.cartesianToCartographic(U,Ur),Sr);v.default.subtract(F,C,F),Lr.x=(F.x+r)/(2*r),Lr.y=(F.y+n)/(2*n),S.x=Math.min(Lr.x,S.x),S.y=Math.min(Lr.y,S.y),I.x=Math.max(Lr.x,I.x),I.y=Math.max(Lr.y,I.y),h[O+D]=Lr.x,h[O+1+D]=Lr.y,h[O++]=Lr.x,h[O++]=Lr.y}B=o.scaleToGeodeticSurface(B,B),R=v.default.clone(B,Pr),w=o.geodeticSurfaceNormal(B,w),b&&(y[M+L]=-w.x,y[N+L]=-w.y,y[V+L]=-w.z);var H=v.default.multiplyByScalar(w,l,Ir);if(B=v.default.add(B,H,B),H=v.default.multiplyByScalar(w,u,H),R=v.default.add(R,H,R),i.position&&(c[M+L]=R.x,c[N+L]=R.y,c[V+L]=R.z,c[M]=B.x,c[N]=B.y,c[V]=B.z),i.normal||i.tangent||i.bitangent){E=v.default.clone(w,E);var k=v.default.fromArray(e,(M+3)%L,Ir);v.default.subtract(k,B,k);var z=v.default.subtract(R,B,Sr);w=v.default.normalize(v.default.cross(z,k,w),w),i.normal&&(p[M]=w.x,p[N]=w.y,p[V]=w.z,p[M+L]=w.x,p[N+L]=w.y,p[V+L]=w.z),i.tangent&&(x=v.default.normalize(v.default.cross(E,w,x),x),m[M]=x.x,m[N]=x.y,m[V]=x.z,m[M+L]=x.x,m[M+1+L]=x.y,m[M+2+L]=x.z),i.bitangent&&(_[M]=E.x,_[N]=E.y,_[V]=E.z,_[M+L]=E.x,_[N+L]=E.y,_[V+L]=E.z)}}if(i.st){L=h.length;for(var G=0;G<L;G+=2)h[G]=(h[G]-S.x)/(I.x-S.x),h[G+1]=(h[G+1]-S.y)/(I.y-S.y)}var q=new zi.a;if(i.position&&(q.position=new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:c})),i.st&&(q.st=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:h})),i.normal&&(q.normal=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:p})),i.tangent&&(q.tangent=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:m})),i.bitangent&&(q.bitangent=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:_})),b&&(q.extrudeDirection=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:y})),Object(s.default)(t.offsetAttribute)){var W=new Uint8Array(f);if(t.offsetAttribute===fe.a.TOP)W=Object(Je.a)(W,1,0,f/2);else{var Y=t.offsetAttribute===fe.a.NONE?0:1;W=Object(Je.a)(W,Y)}q.applyOffset=new ki.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:W})}return q}(d,e);h=function(e){for(var t=e.length/3,i=Gi.a.createTypedArray(t,6*t),a=0,r=0;r<t;r++){var n=r,o=r+t,s=(n+1)%t,l=s+t;i[a++]=n,i[a++]=o,i[a++]=s,i[a++]=s,i[a++]=o,i[a++]=l}return i}(d);var w=Gi.a.createTypedArray(2*d.length/3,h),x=new Hi.a({attributes:O,indices:w,primitiveType:Wi.a.TRIANGLES}),E=Ar.a.combineInstances([new de.a({geometry:y}),new de.a({geometry:x})]);return{boundingSphere:f,attributes:E[0].attributes,indices:E[0].indices}}function Xr(e,t,i,a,r,n,o){for(var s=Tr.computeEllipsePositions({center:e,semiMajorAxis:t,semiMinorAxis:i,rotation:a,granularity:r},!1,!0).outerPositions,l=s.length/3,u=new Array(l),d=0;d<l;++d)u[d]=v.default.fromArray(s,3*d);var f=Yi.default.fromCartesianArray(u,n,o);return f.width>Ne.default.PI&&(f.north=f.north>0?Ne.default.PI_OVER_TWO-Ne.default.EPSILON7:f.north,f.south=f.south<0?Ne.default.EPSILON7-Ne.default.PI_OVER_TWO:f.south,f.east=Ne.default.PI,f.west=-Ne.default.PI),f}function Zr(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).center,i=Object(o.default)(e.ellipsoid,tt.default.WGS84),a=e.semiMajorAxis,r=e.semiMinorAxis,n=Object(o.default)(e.granularity,Ne.default.RADIANS_PER_DEGREE),s=Object(o.default)(e.vertexFormat,J.default.DEFAULT),l=Object(o.default)(e.height,0),u=Object(o.default)(e.extrudedHeight,l);this._center=v.default.clone(t),this._semiMajorAxis=a,this._semiMinorAxis=r,this._ellipsoid=tt.default.clone(i),this._rotation=Object(o.default)(e.rotation,0),this._stRotation=Object(o.default)(e.stRotation,0),this._height=Math.max(u,l),this._granularity=n,this._vertexFormat=J.default.clone(s),this._extrudedHeight=Math.min(u,l),this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createEllipseGeometry",this._offsetAttribute=e.offsetAttribute,this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0}Zr.packedLength=v.default.packedLength+tt.default.packedLength+J.default.packedLength+9,Zr.pack=function(e,t,i){return i=Object(o.default)(i,0),v.default.pack(e._center,t,i),i+=v.default.packedLength,tt.default.pack(e._ellipsoid,t,i),i+=tt.default.packedLength,J.default.pack(e._vertexFormat,t,i),i+=J.default.packedLength,t[i++]=e._semiMajorAxis,t[i++]=e._semiMinorAxis,t[i++]=e._rotation,t[i++]=e._stRotation,t[i++]=e._height,t[i++]=e._granularity,t[i++]=e._extrudedHeight,t[i++]=e._shadowVolume?1:0,t[i]=Object(o.default)(e._offsetAttribute,-1),t};var Jr=new v.default,Qr=new tt.default,$r=new J.default,en={center:Jr,ellipsoid:Qr,vertexFormat:$r,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,stRotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};Zr.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=v.default.unpack(e,t,Jr);t+=v.default.packedLength;var r=tt.default.unpack(e,t,Qr);t+=tt.default.packedLength;var n=J.default.unpack(e,t,$r);t+=J.default.packedLength;var l=e[t++],u=e[t++],d=e[t++],f=e[t++],c=e[t++],h=e[t++],p=e[t++],m=1===e[t++],_=e[t];return Object(s.default)(i)?(i._center=v.default.clone(a,i._center),i._ellipsoid=tt.default.clone(r,i._ellipsoid),i._vertexFormat=J.default.clone(n,i._vertexFormat),i._semiMajorAxis=l,i._semiMinorAxis=u,i._rotation=d,i._stRotation=f,i._height=c,i._granularity=h,i._extrudedHeight=p,i._shadowVolume=m,i._offsetAttribute=-1===_?void 0:_,i):(en.height=c,en.extrudedHeight=p,en.granularity=h,en.stRotation=f,en.rotation=d,en.semiMajorAxis=l,en.semiMinorAxis=u,en.shadowVolume=m,en.offsetAttribute=-1===_?void 0:_,new Zr(en))},Zr.computeRectangle=function(e,t){var i=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).center,a=Object(o.default)(e.ellipsoid,tt.default.WGS84),r=e.semiMajorAxis,n=e.semiMinorAxis,s=Object(o.default)(e.granularity,Ne.default.RADIANS_PER_DEGREE);return Xr(i,r,n,Object(o.default)(e.rotation,0),s,a,t)},Zr.createGeometry=function(e){if(!(e._semiMajorAxis<=0||e._semiMinorAxis<=0)){var t=e._height,i=e._extrudedHeight,a=!Ne.default.equalsEpsilon(t,i,0,Ne.default.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);var n,o={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:t,granularity:e._granularity,vertexFormat:e._vertexFormat,stRotation:e._stRotation};if(a)o.extrudedHeight=i,o.shadowVolume=e._shadowVolume,o.offsetAttribute=e._offsetAttribute,n=Kr(o);else if(n=function(e){var t=e.center;qr=v.default.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,qr),e.height,qr),qr=v.default.add(t,qr,qr);var i=new r.default(qr,e.semiMajorAxis),a=Tr.computeEllipsePositions(e,!0,!1),n=a.positions,o=a.numPts,s=zr(n,e,!1),l=Gr(o);return{boundingSphere:i,attributes:s,indices:l=Gi.a.createTypedArray(n.length/3,l)}}(o),Object(s.default)(e._offsetAttribute)){var l=n.attributes.position.values.length,u=new Uint8Array(l/3),d=e._offsetAttribute===fe.a.NONE?0:1;Object(Je.a)(u,d),n.attributes.applyOffset=new ki.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:u})}return new Hi.a({attributes:n.attributes,indices:n.indices,primitiveType:Wi.a.TRIANGLES,boundingSphere:n.boundingSphere,offsetAttribute:e._offsetAttribute})}},Zr.createShadowVolume=function(e,t,i){var a=e._granularity,r=e._ellipsoid,n=t(a,r),o=i(a,r);return new Zr({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:r,rotation:e._rotation,stRotation:e._stRotation,granularity:a,extrudedHeight:n,height:o,vertexFormat:J.default.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(Zr.prototype,{rectangle:{get:function(){return Object(s.default)(this._rectangle)||(this._rectangle=Xr(this._center,this._semiMajorAxis,this._semiMinorAxis,this._rotation,this._granularity,this._ellipsoid)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return Object(s.default)(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0===t)return[0,0,0,1,1,0];for(var i=Tr.computeEllipsePositions({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,rotation:e._rotation,granularity:e._granularity},!1,!0).outerPositions,a=i.length/3,r=new Array(a),n=0;n<a;++n)r[n]=v.default.fromArray(i,3*n);var o=e._ellipsoid,s=e.rectangle;return Hi.a._textureCoordinateRotationPoints(r,t,o,s)}(this)),this._textureCoordinateRotationPoints}}});var tn=Zr,an=new v.default,rn=new v.default;var nn=new r.default,on=new r.default;function sn(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).center,i=Object(o.default)(e.ellipsoid,tt.default.WGS84),a=e.semiMajorAxis,r=e.semiMinorAxis,n=Object(o.default)(e.granularity,Ne.default.RADIANS_PER_DEGREE),s=Object(o.default)(e.height,0),l=Object(o.default)(e.extrudedHeight,s);this._center=v.default.clone(t),this._semiMajorAxis=a,this._semiMinorAxis=r,this._ellipsoid=tt.default.clone(i),this._rotation=Object(o.default)(e.rotation,0),this._height=Math.max(l,s),this._granularity=n,this._extrudedHeight=Math.min(l,s),this._numberOfVerticalLines=Math.max(Object(o.default)(e.numberOfVerticalLines,16),0),this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipseOutlineGeometry"}sn.packedLength=v.default.packedLength+tt.default.packedLength+8,sn.pack=function(e,t,i){return i=Object(o.default)(i,0),v.default.pack(e._center,t,i),i+=v.default.packedLength,tt.default.pack(e._ellipsoid,t,i),i+=tt.default.packedLength,t[i++]=e._semiMajorAxis,t[i++]=e._semiMinorAxis,t[i++]=e._rotation,t[i++]=e._height,t[i++]=e._granularity,t[i++]=e._extrudedHeight,t[i++]=e._numberOfVerticalLines,t[i]=Object(o.default)(e._offsetAttribute,-1),t};var ln=new v.default,un=new tt.default,dn={center:ln,ellipsoid:un,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};sn.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=v.default.unpack(e,t,ln);t+=v.default.packedLength;var r=tt.default.unpack(e,t,un);t+=tt.default.packedLength;var n=e[t++],l=e[t++],u=e[t++],d=e[t++],f=e[t++],c=e[t++],h=e[t++],p=e[t];return Object(s.default)(i)?(i._center=v.default.clone(a,i._center),i._ellipsoid=tt.default.clone(r,i._ellipsoid),i._semiMajorAxis=n,i._semiMinorAxis=l,i._rotation=u,i._height=d,i._granularity=f,i._extrudedHeight=c,i._numberOfVerticalLines=h,i._offsetAttribute=-1===p?void 0:p,i):(dn.height=d,dn.extrudedHeight=c,dn.granularity=f,dn.rotation=u,dn.semiMajorAxis=n,dn.semiMinorAxis=l,dn.numberOfVerticalLines=h,dn.offsetAttribute=-1===p?void 0:p,new sn(dn))},sn.createGeometry=function(e){if(!(e._semiMajorAxis<=0||e._semiMinorAxis<=0)){var t=e._height,i=e._extrudedHeight,a=!Ne.default.equalsEpsilon(t,i,0,Ne.default.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);var n,l={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:t,granularity:e._granularity,numberOfVerticalLines:e._numberOfVerticalLines};if(a)l.extrudedHeight=i,l.offsetAttribute=e._offsetAttribute,n=function(e){var t=e.center,i=e.ellipsoid,a=e.semiMajorAxis,n=v.default.multiplyByScalar(i.geodeticSurfaceNormal(t,an),e.height,an);nn.center=v.default.add(t,n,nn.center),nn.radius=a,n=v.default.multiplyByScalar(i.geodeticSurfaceNormal(t,n),e.extrudedHeight,n),on.center=v.default.add(t,n,on.center),on.radius=a;var l=Tr.computeEllipsePositions(e,!1,!0).outerPositions,u=new zi.a({position:new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:Tr.raisePositionsToHeight(l,e,!0)})});l=u.position.values;var d=r.default.union(nn,on),f=l.length/3;if(Object(s.default)(e.offsetAttribute)){var c=new Uint8Array(f);if(e.offsetAttribute===fe.a.TOP)c=Object(Je.a)(c,1,0,f/2);else{var h=e.offsetAttribute===fe.a.NONE?0:1;c=Object(Je.a)(c,h)}u.applyOffset=new ki.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:c})}var p=Object(o.default)(e.numberOfVerticalLines,16);p=Ne.default.clamp(p,0,f/2);var m=Gi.a.createTypedArray(f,2*f+2*p);f/=2;var _,g,b=0;for(_=0;_<f;++_)m[b++]=_,m[b++]=(_+1)%f,m[b++]=_+f,m[b++]=(_+1)%f+f;if(p>0){var y=Math.min(p,f);g=Math.round(f/y);var O=Math.min(g*p,f);for(_=0;_<O;_+=g)m[b++]=_,m[b++]=_+f}return{boundingSphere:d,attributes:u,indices:m}}(l);else if(n=function(e){var t=e.center;rn=v.default.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,rn),e.height,rn),rn=v.default.add(t,rn,rn);for(var i=new r.default(rn,e.semiMajorAxis),a=Tr.computeEllipsePositions(e,!1,!0).outerPositions,n=new zi.a({position:new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:Tr.raisePositionsToHeight(a,e,!1)})}),o=a.length/3,s=Gi.a.createTypedArray(o,2*o),l=0,u=0;u<o;++u)s[l++]=u,s[l++]=(u+1)%o;return{boundingSphere:i,attributes:n,indices:s}}(l),Object(s.default)(e._offsetAttribute)){var u=n.attributes.position.values.length,d=new Uint8Array(u/3),f=e._offsetAttribute===fe.a.NONE?0:1;Object(Je.a)(d,f),n.attributes.applyOffset=new ki.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:d})}return new Hi.a({attributes:n.attributes,indices:n.indices,primitiveType:Wi.a.LINES,boundingSphere:n.boundingSphere,offsetAttribute:e._offsetAttribute})}};var fn=sn,cn=new b.default,hn=v.default.ZERO,pn=new v.default,mn=new Yi.default;function _n(e){this.id=e,this.vertexFormat=void 0,this.center=void 0,this.semiMajorAxis=void 0,this.semiMinorAxis=void 0,this.rotation=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.numberOfVerticalLines=void 0,this.offsetAttribute=void 0}function gn(e,t){Ia.call(this,{entity:e,scene:t,geometryOptions:new _n(e),geometryPropertyName:"ellipse",observedPropertyNames:["availability","position","ellipse"]}),this._onEntityPropertyChanged(e,"ellipse",e.ellipse,void 0)}function vn(e,t,i){ye.call(this,e,t,i)}Object(s.default)(Object.create)&&(gn.prototype=Object.create(Ia.prototype),gn.prototype.constructor=gn),gn.prototype.createFillGeometryInstance=function(e){var t,i=this._entity,a=i.isAvailable(e),r={show:new pe.a(a&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:ue.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof me.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(t=this._materialProperty.color.getValue(e,cn)),Object(s.default)(t)||(t=b.default.WHITE),r.color=oe.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(r.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,hn,pn))),new de.a({id:i,geometry:new tn(this._options),attributes:r})},gn.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,i=t.isAvailable(e),a=A.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,cn),r=this._distanceDisplayConditionProperty.getValue(e),n={show:new pe.a(i&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(a),distanceDisplayCondition:ue.fromDistanceDisplayCondition(r),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(n.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,hn,pn))),new de.a({id:t,geometry:new fn(this._options),attributes:n})},gn.prototype._computeCenter=function(e,t){return A.default.getValueOrUndefined(this._entity.position,e,t)},gn.prototype._isHidden=function(e,t){var i=e.position;return!Object(s.default)(i)||!Object(s.default)(t.semiMajorAxis)||!Object(s.default)(t.semiMinorAxis)||De.prototype._isHidden.call(this,e,t)},gn.prototype._isDynamic=function(e,t){return!e.position.isConstant||!t.semiMajorAxis.isConstant||!t.semiMinorAxis.isConstant||!A.default.isConstant(t.rotation)||!A.default.isConstant(t.height)||!A.default.isConstant(t.extrudedHeight)||!A.default.isConstant(t.granularity)||!A.default.isConstant(t.stRotation)||!A.default.isConstant(t.outlineWidth)||!A.default.isConstant(t.numberOfVerticalLines)||!A.default.isConstant(t.zIndex)||this._onTerrain&&!A.default.isConstant(this._materialProperty)&&!(this._materialProperty instanceof me.default)},gn.prototype._setStaticOptions=function(e,t){var i=A.default.getValueOrUndefined(t.height,ce.default.MINIMUM_VALUE),r=A.default.getValueOrDefault(t.heightReference,ce.default.MINIMUM_VALUE,x.default.NONE),n=A.default.getValueOrUndefined(t.extrudedHeight,ce.default.MINIMUM_VALUE),o=A.default.getValueOrDefault(t.extrudedHeightReference,ce.default.MINIMUM_VALUE,x.default.NONE);Object(s.default)(n)&&!Object(s.default)(i)&&(i=0);var l=this._options;l.vertexFormat=this._materialProperty instanceof me.default?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,l.center=e.position.getValue(ce.default.MINIMUM_VALUE,l.center),l.semiMajorAxis=t.semiMajorAxis.getValue(ce.default.MINIMUM_VALUE,l.semiMajorAxis),l.semiMinorAxis=t.semiMinorAxis.getValue(ce.default.MINIMUM_VALUE,l.semiMinorAxis),l.rotation=A.default.getValueOrUndefined(t.rotation,ce.default.MINIMUM_VALUE),l.granularity=A.default.getValueOrUndefined(t.granularity,ce.default.MINIMUM_VALUE),l.stRotation=A.default.getValueOrUndefined(t.stRotation,ce.default.MINIMUM_VALUE),l.numberOfVerticalLines=A.default.getValueOrUndefined(t.numberOfVerticalLines,ce.default.MINIMUM_VALUE),l.offsetAttribute=Ia.computeGeometryOffsetAttribute(i,r,n,o),l.height=Ia.getGeometryHeight(i,r),(n=Ia.getGeometryExtrudedHeight(n,o))===Ia.CLAMP_TO_GROUND&&(n=a.a.getMinimumMaximumHeights(tn.computeRectangle(l,mn)).minimumTerrainHeight),l.extrudedHeight=n},gn.DynamicGeometryUpdater=vn,Object(s.default)(Object.create)&&(vn.prototype=Object.create(ye.prototype),vn.prototype.constructor=vn),vn.prototype._isHidden=function(e,t,i){var a=this._options;return!Object(s.default)(a.center)||!Object(s.default)(a.semiMajorAxis)||!Object(s.default)(a.semiMinorAxis)||ye.prototype._isHidden.call(this,e,t,i)},vn.prototype._setOptions=function(e,t,i){var r=this._options,n=A.default.getValueOrUndefined(t.height,i),o=A.default.getValueOrDefault(t.heightReference,i,x.default.NONE),l=A.default.getValueOrUndefined(t.extrudedHeight,i),u=A.default.getValueOrDefault(t.extrudedHeightReference,i,x.default.NONE);Object(s.default)(l)&&!Object(s.default)(n)&&(n=0),r.center=A.default.getValueOrUndefined(e.position,i,r.center),r.semiMajorAxis=A.default.getValueOrUndefined(t.semiMajorAxis,i),r.semiMinorAxis=A.default.getValueOrUndefined(t.semiMinorAxis,i),r.rotation=A.default.getValueOrUndefined(t.rotation,i),r.granularity=A.default.getValueOrUndefined(t.granularity,i),r.stRotation=A.default.getValueOrUndefined(t.stRotation,i),r.numberOfVerticalLines=A.default.getValueOrUndefined(t.numberOfVerticalLines,i),r.offsetAttribute=Ia.computeGeometryOffsetAttribute(n,o,l,u),r.height=Ia.getGeometryHeight(n,o),(l=Ia.getGeometryExtrudedHeight(l,u))===Ia.CLAMP_TO_GROUND&&(l=a.a.getMinimumMaximumHeights(tn.computeRectangle(r,mn)).minimumTerrainHeight),r.extrudedHeight=l};var bn=gn,yn=i(308),On=i(245),wn=new me.default(b.default.WHITE),xn=v.default.ZERO,En=new v.default,Tn=new v.default,Cn=new v.default,An=new b.default,jn=new v.default(1,1,1);function Pn(e){this.id=e,this.vertexFormat=void 0,this.radii=void 0,this.innerRadii=void 0,this.minimumClock=void 0,this.maximumClock=void 0,this.minimumCone=void 0,this.maximumCone=void 0,this.stackPartitions=void 0,this.slicePartitions=void 0,this.subdivisions=void 0,this.offsetAttribute=void 0}function Sn(e,t){De.call(this,{entity:e,scene:t,geometryOptions:new Pn(e),geometryPropertyName:"ellipsoid",observedPropertyNames:["availability","position","orientation","ellipsoid"]}),this._onEntityPropertyChanged(e,"ellipsoid",e.ellipsoid,void 0)}function In(e,t,i){ye.call(this,e,t,i),this._scene=e._scene,this._modelMatrix=new nt.default,this._attributes=void 0,this._outlineAttributes=void 0,this._lastSceneMode=void 0,this._lastShow=void 0,this._lastOutlineShow=void 0,this._lastOutlineWidth=void 0,this._lastOutlineColor=void 0,this._lastOffset=new v.default,this._material={}}Object(s.default)(Object.create)&&(Sn.prototype=Object.create(De.prototype),Sn.prototype.constructor=Sn),Object.defineProperties(Sn.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),Sn.prototype.createFillGeometryInstance=function(e,t,i){var a,r,n=this._entity,o=n.isAvailable(e),l=new pe.a(o&&n.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),u=this._distanceDisplayConditionProperty.getValue(e),d={show:l,distanceDisplayCondition:ue.fromDistanceDisplayCondition(u),color:void 0,offset:void 0};this._materialProperty instanceof me.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||o)&&(r=this._materialProperty.color.getValue(e,An)),Object(s.default)(r)||(r=b.default.WHITE),a=oe.a.fromColor(r),d.color=a);return Object(s.default)(this._options.offsetAttribute)&&(d.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,xn,En))),new de.a({id:n,geometry:new yn.a(this._options),modelMatrix:t?void 0:n.computeModelMatrixForHeightReference(e,n.ellipsoid.heightReference,.5*this._options.radii.z,this._scene.mapProjection.ellipsoid,i),attributes:d})},Sn.prototype.createOutlineGeometryInstance=function(e,t,i){var a=this._entity,r=a.isAvailable(e),n=A.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,An),o=this._distanceDisplayConditionProperty.getValue(e),l={show:new pe.a(r&&a.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(n),distanceDisplayCondition:ue.fromDistanceDisplayCondition(o),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(l.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,xn,En))),new de.a({id:a,geometry:new On.a(this._options),modelMatrix:t?void 0:a.computeModelMatrixForHeightReference(e,a.ellipsoid.heightReference,.5*this._options.radii.z,this._scene.mapProjection.ellipsoid,i),attributes:l})},Sn.prototype._computeCenter=function(e,t){return A.default.getValueOrUndefined(this._entity.position,e,t)},Sn.prototype._isHidden=function(e,t){return!Object(s.default)(e.position)||!Object(s.default)(t.radii)||De.prototype._isHidden.call(this,e,t)},Sn.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&A.default.isConstant(e.orientation)&&t.radii.isConstant&&A.default.isConstant(t.innerRadii)&&A.default.isConstant(t.stackPartitions)&&A.default.isConstant(t.slicePartitions)&&A.default.isConstant(t.outlineWidth)&&A.default.isConstant(t.minimumClock)&&A.default.isConstant(t.maximumClock)&&A.default.isConstant(t.minimumCone)&&A.default.isConstant(t.maximumCone)&&A.default.isConstant(t.subdivisions))},Sn.prototype._setStaticOptions=function(e,t){var i=A.default.getValueOrDefault(t.heightReference,ce.default.MINIMUM_VALUE,x.default.NONE),a=this._options;a.vertexFormat=this._materialProperty instanceof me.default?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,a.radii=t.radii.getValue(ce.default.MINIMUM_VALUE,a.radii),a.innerRadii=A.default.getValueOrUndefined(t.innerRadii,a.radii),a.minimumClock=A.default.getValueOrUndefined(t.minimumClock,ce.default.MINIMUM_VALUE),a.maximumClock=A.default.getValueOrUndefined(t.maximumClock,ce.default.MINIMUM_VALUE),a.minimumCone=A.default.getValueOrUndefined(t.minimumCone,ce.default.MINIMUM_VALUE),a.maximumCone=A.default.getValueOrUndefined(t.maximumCone,ce.default.MINIMUM_VALUE),a.stackPartitions=A.default.getValueOrUndefined(t.stackPartitions,ce.default.MINIMUM_VALUE),a.slicePartitions=A.default.getValueOrUndefined(t.slicePartitions,ce.default.MINIMUM_VALUE),a.subdivisions=A.default.getValueOrUndefined(t.subdivisions,ce.default.MINIMUM_VALUE),a.offsetAttribute=i!==x.default.NONE?fe.a.ALL:void 0},Sn.prototype._onEntityPropertyChanged=ke,Sn.DynamicGeometryUpdater=In,Object(s.default)(Object.create)&&(In.prototype=Object.create(ye.prototype),In.prototype.constructor=In),In.prototype.update=function(e){var t=this._entity,i=t.ellipsoid;if(!t.isShowing||!t.isAvailable(e)||!A.default.getValueOrDefault(i.show,e,!0))return Object(s.default)(this._primitive)&&(this._primitive.show=!1),void(Object(s.default)(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1));var a=A.default.getValueOrUndefined(i.radii,e,Tn),r=Object(s.default)(a)?t.computeModelMatrixForHeightReference(e,i.heightReference,.5*a.z,this._scene.mapProjection.ellipsoid,this._modelMatrix):void 0;if(!Object(s.default)(r)||!Object(s.default)(a))return Object(s.default)(this._primitive)&&(this._primitive.show=!1),void(Object(s.default)(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1));var n=A.default.getValueOrDefault(i.fill,e,!0),l=A.default.getValueOrDefault(i.outline,e,!1),u=A.default.getValueOrClonedDefault(i.outlineColor,e,b.default.BLACK,An),d=ve.getValue(e,Object(o.default)(i.material,wn),this._material),f=A.default.getValueOrUndefined(i.innerRadii,e,Cn),c=A.default.getValueOrUndefined(i.minimumClock,e),h=A.default.getValueOrUndefined(i.maximumClock,e),p=A.default.getValueOrUndefined(i.minimumCone,e),m=A.default.getValueOrUndefined(i.maximumCone,e),_=A.default.getValueOrUndefined(i.stackPartitions,e),g=A.default.getValueOrUndefined(i.slicePartitions,e),y=A.default.getValueOrUndefined(i.subdivisions,e),w=A.default.getValueOrDefault(i.outlineWidth,e,1),E=A.default.getValueOrDefault(i.heightReference,e,x.default.NONE),T=E!==x.default.NONE?fe.a.ALL:void 0,C=this._scene.mode,j=C===Ve.a.SCENE3D&&E===x.default.NONE,P=this._options,S=this._geometryUpdater.shadowsProperty.getValue(e),I=this._geometryUpdater.distanceDisplayConditionProperty.getValue(e),L=A.default.getValueOrDefault(this._geometryUpdater.terrainOffsetProperty,e,xn,En);if(!j||this._lastSceneMode!==C||!Object(s.default)(this._primitive)||P.stackPartitions!==_||P.slicePartitions!==g||Object(s.default)(f)&&!v.default.equals(P.innerRadii!==f)||P.minimumClock!==c||P.maximumClock!==h||P.minimumCone!==p||P.maximumCone!==m||P.subdivisions!==y||this._lastOutlineWidth!==w||P.offsetAttribute!==T){var D=this._primitives;if(D.removeAndDestroy(this._primitive),D.removeAndDestroy(this._outlinePrimitive),this._primitive=void 0,this._outlinePrimitive=void 0,this._lastSceneMode=C,this._lastOutlineWidth=w,P.stackPartitions=_,P.slicePartitions=g,P.subdivisions=y,P.offsetAttribute=T,P.radii=v.default.clone(j?jn:a,P.radii),Object(s.default)(f))if(j){var M=v.default.magnitude(a);P.innerRadii=v.default.fromElements(f.x/M,f.y/M,f.z/M,P.innerRadii)}else P.innerRadii=v.default.clone(f,P.innerRadii);else P.innerRadii=void 0;P.minimumClock=c,P.maximumClock=h,P.minimumCone=p,P.maximumCone=m;var R=new te({material:d,translucent:d.isTranslucent(),closed:!0});P.vertexFormat=R.vertexFormat;var N=this._geometryUpdater.createFillGeometryInstance(e,j,this._modelMatrix);this._primitive=D.add(new _e.a({geometryInstances:N,appearance:R,asynchronous:!1,shadows:S}));var V=this._geometryUpdater.createOutlineGeometryInstance(e,j,this._modelMatrix);this._outlinePrimitive=D.add(new _e.a({geometryInstances:V,appearance:new ie.a({flat:!0,translucent:255!==V.attributes.color.value[3],renderState:{lineWidth:this._geometryUpdater._scene.clampLineWidth(w)}}),asynchronous:!1,shadows:S})),this._lastShow=n,this._lastOutlineShow=l,this._lastOutlineColor=b.default.clone(u,this._lastOutlineColor),this._lastDistanceDisplayCondition=I,this._lastOffset=v.default.clone(L,this._lastOffset)}else if(this._primitive.ready){var B=this._primitive,U=this._outlinePrimitive;B.show=!0,U.show=!0,B.appearance.material=d;var F=this._attributes;Object(s.default)(F)||(F=B.getGeometryInstanceAttributes(t),this._attributes=F),n!==this._lastShow&&(F.show=pe.a.toValue(n,F.show),this._lastShow=n);var H=this._outlineAttributes;Object(s.default)(H)||(H=U.getGeometryInstanceAttributes(t),this._outlineAttributes=H),l!==this._lastOutlineShow&&(H.show=pe.a.toValue(l,H.show),this._lastOutlineShow=l),b.default.equals(u,this._lastOutlineColor)||(H.color=oe.a.toValue(u,H.color),b.default.clone(u,this._lastOutlineColor)),O.a.equals(I,this._lastDistanceDisplayCondition)||(F.distanceDisplayCondition=ue.toValue(I,F.distanceDisplayCondition),H.distanceDisplayCondition=ue.toValue(I,H.distanceDisplayCondition),O.a.clone(I,this._lastDistanceDisplayCondition)),v.default.equals(L,this._lastOffset)||(F.offset=he.a.toValue(L,F.offset),H.offset=he.a.toValue(L,F.offset),v.default.clone(L,this._lastOffset))}j&&(a.x=Math.max(a.x,.001),a.y=Math.max(a.y,.001),a.z=Math.max(a.z,.001),r=nt.default.multiplyByScale(r,a,r),this._primitive.modelMatrix=r,this._outlinePrimitive.modelMatrix=r)};var Ln=Sn;function Dn(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT);var t=Object(o.default)(e.vertexFormat,J.default.DEFAULT);this._vertexFormat=t,this._workerName="createPlaneGeometry"}Dn.packedLength=J.default.packedLength,Dn.pack=function(e,t,i){return i=Object(o.default)(i,0),J.default.pack(e._vertexFormat,t,i),t};var Mn=new J.default,Rn={vertexFormat:Mn};Dn.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=J.default.unpack(e,t,Mn);return Object(s.default)(i)?(i._vertexFormat=J.default.clone(a,i._vertexFormat),i):new Dn(Rn)};var Nn=new v.default(-.5,-.5,0),Vn=new v.default(.5,.5,0);Dn.createGeometry=function(e){var t,i,a=e._vertexFormat,n=new zi.a;if(a.position){if((i=new Float64Array(12))[0]=Nn.x,i[1]=Nn.y,i[2]=0,i[3]=Vn.x,i[4]=Nn.y,i[5]=0,i[6]=Vn.x,i[7]=Vn.y,i[8]=0,i[9]=Nn.x,i[10]=Vn.y,i[11]=0,n.position=new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:i}),a.normal){var o=new Float32Array(12);o[0]=0,o[1]=0,o[2]=1,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=1,o[9]=0,o[10]=0,o[11]=1,n.normal=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:o})}if(a.st){var s=new Float32Array(8);s[0]=0,s[1]=0,s[2]=1,s[3]=0,s[4]=1,s[5]=1,s[6]=0,s[7]=1,n.st=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:s})}if(a.tangent){var l=new Float32Array(12);l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=0,l[5]=0,l[6]=1,l[7]=0,l[8]=0,l[9]=1,l[10]=0,l[11]=0,n.tangent=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:l})}if(a.bitangent){var u=new Float32Array(12);u[0]=0,u[1]=1,u[2]=0,u[3]=0,u[4]=1,u[5]=0,u[6]=0,u[7]=1,u[8]=0,u[9]=0,u[10]=1,u[11]=0,n.bitangent=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:u})}(t=new Uint16Array(6))[0]=0,t[1]=1,t[2]=2,t[3]=0,t[4]=2,t[5]=3}return new Hi.a({attributes:n,indices:t,primitiveType:Wi.a.TRIANGLES,boundingSphere:new r.default(v.default.ZERO,Math.sqrt(2))})};var Bn=Dn;function Un(){this._workerName="createPlaneOutlineGeometry"}Un.packedLength=0,Un.pack=function(e,t){return t},Un.unpack=function(e,t,i){return Object(s.default)(i)?i:new Un};var Fn=new v.default(-.5,-.5,0),Hn=new v.default(.5,.5,0);Un.createGeometry=function(){var e=new zi.a,t=new Uint16Array(8),i=new Float64Array(12);return i[0]=Fn.x,i[1]=Fn.y,i[2]=Fn.z,i[3]=Hn.x,i[4]=Fn.y,i[5]=Fn.z,i[6]=Hn.x,i[7]=Hn.y,i[8]=Fn.z,i[9]=Fn.x,i[10]=Hn.y,i[11]=Fn.z,e.position=new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:i}),t[0]=0,t[1]=1,t[2]=1,t[3]=2,t[4]=2,t[5]=3,t[6]=3,t[7]=0,new Hi.a({attributes:e,indices:t,primitiveType:Wi.a.LINES,boundingSphere:new r.default(v.default.ZERO,Math.sqrt(2))})};var kn=Un,zn=new v.default,Gn=new b.default;function qn(e){this.id=e,this.vertexFormat=void 0,this.plane=void 0,this.dimensions=void 0}function Wn(e,t){De.call(this,{entity:e,scene:t,geometryOptions:new qn(e),geometryPropertyName:"plane",observedPropertyNames:["availability","position","orientation","plane"]}),this._onEntityPropertyChanged(e,"plane",e.plane,void 0)}function Yn(e,t,i){ye.call(this,e,t,i)}Object(s.default)(Object.create)&&(Wn.prototype=Object.create(De.prototype),Wn.prototype.constructor=Wn),Wn.prototype.createFillGeometryInstance=function(e){var t,i,a=this._entity,r=a.isAvailable(e),n=new pe.a(r&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),l=ue.fromDistanceDisplayCondition(o);this._materialProperty instanceof me.default?(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(i=this._materialProperty.color.getValue(e,Gn)),Object(s.default)(i)||(i=b.default.WHITE),t={show:n,distanceDisplayCondition:l,color:oe.a.fromColor(i)}):t={show:n,distanceDisplayCondition:l};var u=a.plane,d=this._options,f=a.computeModelMatrix(e),c=A.default.getValueOrDefault(u.plane,e,d.plane),h=A.default.getValueOrUndefined(u.dimensions,e,d.dimensions);return d.plane=c,d.dimensions=h,f=to(c,h,f,this._scene.mapProjection.ellipsoid,f),new de.a({id:a,geometry:new Bn(this._options),modelMatrix:f,attributes:t})},Wn.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,i=t.isAvailable(e),a=A.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,Gn),r=this._distanceDisplayConditionProperty.getValue(e),n=t.plane,o=this._options,s=t.computeModelMatrix(e),l=A.default.getValueOrDefault(n.plane,e,o.plane),u=A.default.getValueOrUndefined(n.dimensions,e,o.dimensions);return o.plane=l,o.dimensions=u,s=to(l,u,s,this._scene.mapProjection.ellipsoid,s),new de.a({id:t,geometry:new kn,modelMatrix:s,attributes:{show:new pe.a(i&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(a),distanceDisplayCondition:ue.fromDistanceDisplayCondition(r)}})},Wn.prototype._isHidden=function(e,t){return!Object(s.default)(t.plane)||!Object(s.default)(t.dimensions)||!Object(s.default)(e.position)||De.prototype._isHidden.call(this,e,t)},Wn.prototype._getIsClosed=function(e){return!1},Wn.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&A.default.isConstant(e.orientation)&&t.plane.isConstant&&t.dimensions.isConstant&&A.default.isConstant(t.outlineWidth))},Wn.prototype._setStaticOptions=function(e,t){var i=this._materialProperty instanceof me.default,a=this._options;a.vertexFormat=i?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,a.plane=t.plane.getValue(ce.default.MINIMUM_VALUE,a.plane),a.dimensions=t.dimensions.getValue(ce.default.MINIMUM_VALUE,a.dimensions)},Wn.DynamicGeometryUpdater=Yn,Object(s.default)(Object.create)&&(Yn.prototype=Object.create(ye.prototype),Yn.prototype.constructor=Yn),Yn.prototype._isHidden=function(e,t,i){var a=this._options,r=A.default.getValueOrUndefined(e.position,i,zn);return!Object(s.default)(r)||!Object(s.default)(a.plane)||!Object(s.default)(a.dimensions)||ye.prototype._isHidden.call(this,e,t,i)},Yn.prototype._setOptions=function(e,t,i){var a=this._options;a.plane=A.default.getValueOrDefault(t.plane,i,a.plane),a.dimensions=A.default.getValueOrUndefined(t.dimensions,i,a.dimensions)};var Kn=new v.default,Xn=new v.default,Zn=new v.default,Jn=new v.default,Qn=new v.default,$n=new Dt.default,eo=new et.default;function to(e,t,i,a,r){var n=e.normal,o=e.distance,s=v.default.multiplyByScalar(n,-o,Zn);s=nt.default.multiplyByPoint(i,s,s);var l=nt.default.multiplyByPointAsVector(i,n,Jn);v.default.normalize(l,l);var u=a.geodeticSurfaceNormal(s,Xn);Ne.default.equalsEpsilon(Math.abs(v.default.dot(u,l)),1,Ne.default.EPSILON8)&&(u=v.default.clone(v.default.UNIT_Z,u),Ne.default.equalsEpsilon(Math.abs(v.default.dot(u,l)),1,Ne.default.EPSILON8)&&(u=v.default.clone(v.default.UNIT_X,u)));var d=v.default.cross(u,l,Kn);u=v.default.cross(l,d,u),v.default.normalize(d,d),v.default.normalize(u,u);var f=eo;et.default.setColumn(f,0,d,f),et.default.setColumn(f,1,u,f),et.default.setColumn(f,2,l,f);var c=Dt.default.fromRotationMatrix(f,$n),h=g.default.clone(t,Qn);return h.z=1,nt.default.fromTranslationQuaternionRotationScale(s,c,h,r)}Wn.createPrimitiveMatrix=to;var io=Wn,ao=i(134),ro=i(126),no={},oo=new v.default,so=new v.default,lo=new v.default,uo=new v.default,fo=new ro.a;function co(e,t,i,a,r){var n=v.default.subtract(e,t,oo),o=v.default.dot(i,n),s=v.default.dot(a,n);return g.default.fromElements(o,s,r)}no.validOutline=function(e){var t=ro.a.fromPoints(e,fo).halfAxes,i=et.default.getColumn(t,0,so),a=et.default.getColumn(t,1,lo),r=et.default.getColumn(t,2,uo),n=v.default.magnitude(i),o=v.default.magnitude(a),s=v.default.magnitude(r);return!(0===n&&(0===o||0===s)||0===o&&0===s)},no.computeProjectTo2DArguments=function(e,t,i,a){var r,n,o=ro.a.fromPoints(e,fo),s=o.halfAxes,l=et.default.getColumn(s,0,so),u=et.default.getColumn(s,1,lo),d=et.default.getColumn(s,2,uo),f=v.default.magnitude(l),c=v.default.magnitude(u),h=v.default.magnitude(d),p=Math.min(f,c,h);return(0!==f||0!==c&&0!==h)&&(0!==c||0!==h)&&(p!==c&&p!==h||(r=l),p===f?r=u:p===h&&(n=u),p!==f&&p!==c||(n=d),v.default.normalize(r,i),v.default.normalize(n,a),v.default.clone(o.center,t),!0)},no.createProjectPointsTo2DFunction=function(e,t,i){return function(a){for(var r=new Array(a.length),n=0;n<a.length;n++)r[n]=co(a[n],e,t,i);return r}},no.createProjectPointTo2DFunction=function(e,t,i){return function(a,r){return co(a,e,t,i,r)}};var ho=no,po=i(764),mo=new v.default,_o=new _.default,go=new g.default,vo=new g.default,bo=new v.default,yo=new v.default,Oo=new v.default,wo=new v.default,xo=new v.default,Eo=new v.default,To=new Dt.default,Co=new et.default,Ao=new et.default,jo=new v.default;function Po(e,t,i,a,r,n,o,s){var l=e.positions,u=qi.a.triangulate(e.positions2D,e.holes);u.length<3&&(u=[0,1,2]);var d=Gi.a.createTypedArray(l.length,u.length);d.set(u);var f=Co;if(0!==a){var c=Dt.default.fromAxisAngle(n,a,To);if(f=et.default.fromQuaternion(c,f),t.tangent||t.bitangent){c=Dt.default.fromAxisAngle(n,-a,To);var h=et.default.fromQuaternion(c,Ao);o=v.default.normalize(et.default.multiplyByVector(h,o,o),o),t.bitangent&&(s=v.default.normalize(v.default.cross(n,o,s),s))}}else f=et.default.clone(et.default.IDENTITY,f);var p=vo;t.st&&(p.x=i.x,p.y=i.y);for(var m=l.length,_=3*m,b=new Float64Array(_),y=t.normal?new Float32Array(_):void 0,O=t.tangent?new Float32Array(_):void 0,w=t.bitangent?new Float32Array(_):void 0,x=t.st?new Float32Array(2*m):void 0,E=0,T=0,C=0,A=0,j=0,P=0;P<m;P++){var S=l[P];if(b[E++]=S.x,b[E++]=S.y,b[E++]=S.z,t.st){var I=r(et.default.multiplyByVector(f,S,mo),go);g.default.subtract(I,p,I);var L=Ne.default.clamp(I.x/i.width,0,1),D=Ne.default.clamp(I.y/i.height,0,1);x[j++]=L,x[j++]=D}t.normal&&(y[T++]=n.x,y[T++]=n.y,y[T++]=n.z),t.tangent&&(O[A++]=o.x,O[A++]=o.y,O[A++]=o.z),t.bitangent&&(w[C++]=s.x,w[C++]=s.y,w[C++]=s.z)}var M=new zi.a;return t.position&&(M.position=new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:b})),t.normal&&(M.normal=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:y})),t.tangent&&(M.tangent=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:O})),t.bitangent&&(M.bitangent=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:w})),t.st&&(M.st=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:x})),new Hi.a({attributes:M,indices:d,primitiveType:Wi.a.TRIANGLES})}function So(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polygonHierarchy,i=Object(o.default)(e.vertexFormat,J.default.DEFAULT);this._vertexFormat=J.default.clone(i),this._polygonHierarchy=t,this._stRotation=Object(o.default)(e.stRotation,0),this._ellipsoid=tt.default.clone(Object(o.default)(e.ellipsoid,tt.default.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=po.default.computeHierarchyPackedLength(t)+J.default.packedLength+tt.default.packedLength+2}So.fromPositions=function(e){return new So({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},So.pack=function(e,t,i){return i=Object(o.default)(i,0),i=po.default.packPolygonHierarchy(e._polygonHierarchy,t,i),tt.default.pack(e._ellipsoid,t,i),i+=tt.default.packedLength,J.default.pack(e._vertexFormat,t,i),i+=J.default.packedLength,t[i++]=e._stRotation,t[i]=e.packedLength,t};var Io=tt.default.clone(tt.default.UNIT_SPHERE),Lo=new J.default,Do={polygonHierarchy:{}};So.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=po.default.unpackPolygonHierarchy(e,t);t=a.startingIndex,delete a.startingIndex;var r=tt.default.unpack(e,t,Io);t+=tt.default.packedLength;var n=J.default.unpack(e,t,Lo);t+=J.default.packedLength;var l=e[t++],u=e[t];return Object(s.default)(i)||(i=new So(Do)),i._polygonHierarchy=a,i._ellipsoid=tt.default.clone(r,i._ellipsoid),i._vertexFormat=J.default.clone(n,i._vertexFormat),i._stRotation=l,i.packedLength=u,i},So.createGeometry=function(e){var t=e._vertexFormat,i=e._polygonHierarchy,a=e._stRotation,n=i.positions;if(!((n=Object(Qe.a)(n,v.default.equalsEpsilon,!0)).length<3)){var o=bo,s=yo,l=Oo,u=xo,d=Eo;if(ho.computeProjectTo2DArguments(n,wo,u,d)){if(o=v.default.cross(u,d,o),o=v.default.normalize(o,o),!v.default.equalsEpsilon(wo,v.default.ZERO,Ne.default.EPSILON6)){var f=e._ellipsoid.geodeticSurfaceNormal(wo,jo);v.default.dot(o,f)<0&&(o=v.default.negate(o,o),u=v.default.negate(u,u))}var c=ho.createProjectPointsTo2DFunction(wo,u,d),h=ho.createProjectPointTo2DFunction(wo,u,d);t.tangent&&(s=v.default.clone(u,s)),t.bitangent&&(l=v.default.clone(d,l));var p=po.default.polygonsFromHierarchy(i,c,!1),m=p.hierarchy,_=p.polygons;if(0!==m.length){n=m[0].outerRing;for(var g=r.default.fromPoints(n),b=po.default.computeBoundingRectangle(o,h,n,a,_o),y=[],O=0;O<_.length;O++){var w=new de.a({geometry:Po(_[O],t,b,a,h,o,s,l)});y.push(w)}var x=Ar.a.combineInstances(y)[0];x.attributes.position.values=new Float64Array(x.attributes.position.values),x.indices=Gi.a.createTypedArray(x.attributes.position.values.length/3,x.indices);var E=x.attributes;return t.position||delete E.position,new Hi.a({attributes:E,indices:x.indices,primitiveType:x.primitiveType,boundingSphere:g})}}}};var Mo=So;function Ro(e){for(var t=e.length,i=new Float64Array(3*t),a=Gi.a.createTypedArray(t,2*t),r=0,n=0,o=0;o<t;o++){var s=e[o];i[r++]=s.x,i[r++]=s.y,i[r++]=s.z,a[n++]=o,a[n++]=(o+1)%t}var l=new zi.a({position:new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:i})});return new Hi.a({attributes:l,indices:a,primitiveType:Wi.a.LINES})}function No(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polygonHierarchy;this._polygonHierarchy=t,this._workerName="createCoplanarPolygonOutlineGeometry",this.packedLength=po.default.computeHierarchyPackedLength(t)+1}No.fromPositions=function(e){return new No({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions}})},No.pack=function(e,t,i){return i=Object(o.default)(i,0),t[i=po.default.packPolygonHierarchy(e._polygonHierarchy,t,i)]=e.packedLength,t};var Vo={polygonHierarchy:{}};No.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=po.default.unpackPolygonHierarchy(e,t);t=a.startingIndex,delete a.startingIndex;var r=e[t];return Object(s.default)(i)||(i=new No(Vo)),i._polygonHierarchy=a,i.packedLength=r,i},No.createGeometry=function(e){var t=e._polygonHierarchy,i=t.positions;if(!((i=Object(Qe.a)(i,v.default.equalsEpsilon,!0)).length<3)&&ho.validOutline(i)){var a=po.default.polygonOutlinesFromHierarchy(t,!1);if(0!==a.length){for(var n=[],o=0;o<a.length;o++){var s=new de.a({geometry:Ro(a[o])});n.push(s)}var l=Ar.a.combineInstances(n)[0],u=r.default.fromPoints(t.positions);return new Hi.a({attributes:l.attributes,indices:l.indices,primitiveType:l.primitiveType,boundingSphere:u})}}};var Bo=No,Uo=i(190),Fo=new Re.default,Ho=new Re.default;function ko(e,t,i,a){var r=a.cartesianToCartographic(e,Fo).height,n=a.cartesianToCartographic(t,Ho);n.height=r,a.cartographicToCartesian(n,t);var o=a.cartesianToCartographic(i,Ho);o.height=r-100,a.cartographicToCartesian(o,i)}var zo=new _.default,Go=new v.default,qo=new v.default,Wo=new v.default,Yo=new v.default,Ko=new v.default,Xo=new v.default,Zo=new v.default,Jo=new v.default,Qo=new v.default,$o=new g.default,es=new g.default,ts=new v.default,is=new Dt.default,as=new et.default,rs=new et.default;function ns(e){var t=e.vertexFormat,i=e.geometry,a=e.shadowVolume,r=i.attributes.position.values,n=r.length,o=e.wall,l=e.top||o,u=e.bottom||o;if(t.st||t.normal||t.tangent||t.bitangent||a){var d=e.boundingRectangle,f=e.tangentPlane,c=e.ellipsoid,h=e.stRotation,p=e.perPositionHeight,m=$o;m.x=d.x,m.y=d.y;var _,b=t.st?new Float32Array(n/3*2):void 0;t.normal&&(_=p&&l&&!o?i.attributes.normal.values:new Float32Array(n));var y=t.tangent?new Float32Array(n):void 0,O=t.bitangent?new Float32Array(n):void 0,w=a?new Float32Array(n):void 0,x=0,E=0,T=qo,C=Wo,A=Yo,j=!0,P=as,S=rs;if(0!==h){var I=Dt.default.fromAxisAngle(f._plane.normal,h,is);P=et.default.fromQuaternion(I,P),I=Dt.default.fromAxisAngle(f._plane.normal,-h,is),S=et.default.fromQuaternion(I,S)}else P=et.default.clone(et.default.IDENTITY,P),S=et.default.clone(et.default.IDENTITY,S);var L=0,D=0;l&&u&&(L=n/2,D=n/3,n/=2);for(var M=0;M<n;M+=3){var R=v.default.fromArray(r,M,ts);if(t.st){var N=et.default.multiplyByVector(P,R,Go);N=c.scaleToGeodeticSurface(N,N);var V=f.projectPointOntoPlane(N,es);g.default.subtract(V,m,V);var B=Ne.default.clamp(V.x/d.width,0,1),U=Ne.default.clamp(V.y/d.height,0,1);u&&(b[x+D]=B,b[x+1+D]=U),l&&(b[x]=B,b[x+1]=U),x+=2}if(t.normal||t.tangent||t.bitangent||a){var F=E+1,H=E+2;if(o){if(M+3<n){var k=v.default.fromArray(r,M+3,Ko);if(j){var z=v.default.fromArray(r,M+n,Xo);p&&ko(R,k,z,c),v.default.subtract(k,R,k),v.default.subtract(z,R,z),T=v.default.normalize(v.default.cross(z,k,T),T),j=!1}v.default.equalsEpsilon(k,R,Ne.default.EPSILON10)&&(j=!0)}(t.tangent||t.bitangent)&&(A=c.geodeticSurfaceNormal(R,A),t.tangent&&(C=v.default.normalize(v.default.cross(A,T,C),C)))}else T=c.geodeticSurfaceNormal(R,T),(t.tangent||t.bitangent)&&(p&&(Zo=v.default.fromArray(_,E,Zo),Jo=v.default.cross(v.default.UNIT_Z,Zo,Jo),Jo=v.default.normalize(et.default.multiplyByVector(S,Jo,Jo),Jo),t.bitangent&&(Qo=v.default.normalize(v.default.cross(Zo,Jo,Qo),Qo))),C=v.default.cross(v.default.UNIT_Z,T,C),C=v.default.normalize(et.default.multiplyByVector(S,C,C),C),t.bitangent&&(A=v.default.normalize(v.default.cross(T,C,A),A)));t.normal&&(e.wall?(_[E+L]=T.x,_[F+L]=T.y,_[H+L]=T.z):u&&(_[E+L]=-T.x,_[F+L]=-T.y,_[H+L]=-T.z),(l&&!p||o)&&(_[E]=T.x,_[F]=T.y,_[H]=T.z)),a&&(o&&(T=c.geodeticSurfaceNormal(R,T)),w[E+L]=-T.x,w[F+L]=-T.y,w[H+L]=-T.z),t.tangent&&(e.wall?(y[E+L]=C.x,y[F+L]=C.y,y[H+L]=C.z):u&&(y[E+L]=-C.x,y[F+L]=-C.y,y[H+L]=-C.z),l&&(p?(y[E]=Jo.x,y[F]=Jo.y,y[H]=Jo.z):(y[E]=C.x,y[F]=C.y,y[H]=C.z))),t.bitangent&&(u&&(O[E+L]=A.x,O[F+L]=A.y,O[H+L]=A.z),l&&(p?(O[E]=Qo.x,O[F]=Qo.y,O[H]=Qo.z):(O[E]=A.x,O[F]=A.y,O[H]=A.z))),E+=3}}t.st&&(i.attributes.st=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:b})),t.normal&&(i.attributes.normal=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:_})),t.tangent&&(i.attributes.tangent=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:y})),t.bitangent&&(i.attributes.bitangent=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:O})),a&&(i.attributes.extrudeDirection=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:w}))}if(e.extrude&&Object(s.default)(e.offsetAttribute)){var G=r.length/3,q=new Uint8Array(G);if(e.offsetAttribute===fe.a.TOP)l&&u||o?q=Object(Je.a)(q,1,0,G/2):l&&(q=Object(Je.a)(q,1));else{var W=e.offsetAttribute===fe.a.NONE?0:1;q=Object(Je.a)(q,W)}i.attributes.applyOffset=new ki.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:q})}return i}var os=new Re.default,ss=new Re.default,ls={westOverIDL:0,eastOverIDL:0},us=new it.default;function ds(e,t,i,a,r){if(r=Object(o.default)(r,new Yi.default),!Object(s.default)(e)||e.length<3)return r.west=0,r.north=0,r.south=0,r.east=0,r;if(i===ao.a.RHUMB)return Yi.default.fromCartesianArray(e,t,r);us.ellipsoid.equals(t)||(us=new it.default(void 0,void 0,t)),r.west=Number.POSITIVE_INFINITY,r.east=Number.NEGATIVE_INFINITY,r.south=Number.POSITIVE_INFINITY,r.north=Number.NEGATIVE_INFINITY,ls.westOverIDL=Number.POSITIVE_INFINITY,ls.eastOverIDL=Number.NEGATIVE_INFINITY;for(var n,l=1/Ne.default.chordLength(a,t.maximumRadius),u=e.length,d=t.cartesianToCartographic(e[0],ss),f=os,c=1;c<u;c++)n=f,f=d,d=t.cartesianToCartographic(e[c],n),us.setEndPoints(f,d),cs(us,l,r,ls);return n=f,f=d,d=t.cartesianToCartographic(e[0],n),us.setEndPoints(f,d),cs(us,l,r,ls),r.east-r.west>ls.eastOverIDL-ls.westOverIDL&&(r.west=ls.westOverIDL,r.east=ls.eastOverIDL,r.east>Ne.default.PI&&(r.east=r.east-Ne.default.TWO_PI),r.west>Ne.default.PI&&(r.west=r.west-Ne.default.TWO_PI)),r}var fs=new Re.default;function cs(e,t,i,a){for(var r=e.surfaceDistance,n=Math.ceil(r*t),o=n>0?r/(n-1):Number.POSITIVE_INFINITY,s=0,l=0;l<n;l++){var u=e.interpolateUsingSurfaceDistance(s,fs);s+=o;var d=u.longitude,f=u.latitude;i.west=Math.min(i.west,d),i.east=Math.max(i.east,d),i.south=Math.min(i.south,f),i.north=Math.max(i.north,f);var c=d>=0?d:d+Ne.default.TWO_PI;a.westOverIDL=Math.min(a.westOverIDL,c),a.eastOverIDL=Math.max(a.eastOverIDL,c)}}var hs=[];function ps(e,t,i,a,r,n,o,s,l){var u,d={walls:[]};if(n||o){var f,c,h=po.default.createGeometryFromPositions(e,t,i,r,s,l),p=h.attributes.position.values,m=h.indices;if(n&&o){var _=p.concat(p);f=_.length/3,(c=Gi.a.createTypedArray(f,2*m.length)).set(m);var g=m.length,v=f/2;for(u=0;u<g;u+=3){var b=c[u]+v,y=c[u+1]+v,O=c[u+2]+v;c[u+g]=O,c[u+1+g]=y,c[u+2+g]=b}if(h.attributes.position.values=_,r&&s.normal){var w=h.attributes.normal.values;h.attributes.normal.values=new Float32Array(_.length),h.attributes.normal.values.set(w)}h.indices=c}else if(o){for(f=p.length/3,c=Gi.a.createTypedArray(f,m.length),u=0;u<m.length;u+=3)c[u]=m[u+2],c[u+1]=m[u+1],c[u+2]=m[u];h.indices=c}d.topAndBottom=new de.a({geometry:h})}var x=a.outerRing,E=Lt.default.fromPoints(x,e),T=E.projectPointsOntoPlane(x,hs),C=qi.a.computeWindingOrder2D(T);C===Uo.default.CLOCKWISE&&(x=x.slice().reverse());var A=po.default.computeWallGeometry(x,e,i,r,l);d.walls.push(new de.a({geometry:A}));var j=a.holes;for(u=0;u<j.length;u++){var P=j[u];T=(E=Lt.default.fromPoints(P,e)).projectPointsOntoPlane(P,hs),(C=qi.a.computeWindingOrder2D(T))===Uo.default.COUNTER_CLOCKWISE&&(P=P.slice().reverse()),A=po.default.computeWallGeometry(P,e,i,r,l),d.walls.push(new de.a({geometry:A}))}return d}function ms(e){var t=e.polygonHierarchy,i=Object(o.default)(e.vertexFormat,J.default.DEFAULT),a=Object(o.default)(e.ellipsoid,tt.default.WGS84),r=Object(o.default)(e.granularity,Ne.default.RADIANS_PER_DEGREE),n=Object(o.default)(e.stRotation,0),l=Object(o.default)(e.perPositionHeight,!1),u=l&&Object(s.default)(e.extrudedHeight),d=Object(o.default)(e.height,0),f=Object(o.default)(e.extrudedHeight,d);if(!u){var c=Math.max(d,f);f=Math.min(d,f),d=c}this._vertexFormat=J.default.clone(i),this._ellipsoid=tt.default.clone(a),this._granularity=r,this._stRotation=n,this._height=d,this._extrudedHeight=f,this._closeTop=Object(o.default)(e.closeTop,!0),this._closeBottom=Object(o.default)(e.closeBottom,!0),this._polygonHierarchy=t,this._perPositionHeight=l,this._perPositionHeightExtrude=u,this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=e.offsetAttribute,this._arcType=Object(o.default)(e.arcType,ao.a.GEODESIC),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=po.default.computeHierarchyPackedLength(t)+tt.default.packedLength+J.default.packedLength+12}ms.fromPositions=function(e){return new ms({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions},height:e.height,extrudedHeight:e.extrudedHeight,vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,closeTop:e.closeTop,closeBottom:e.closeBottom,offsetAttribute:e.offsetAttribute,arcType:e.arcType})},ms.pack=function(e,t,i){return i=Object(o.default)(i,0),i=po.default.packPolygonHierarchy(e._polygonHierarchy,t,i),tt.default.pack(e._ellipsoid,t,i),i+=tt.default.packedLength,J.default.pack(e._vertexFormat,t,i),i+=J.default.packedLength,t[i++]=e._height,t[i++]=e._extrudedHeight,t[i++]=e._granularity,t[i++]=e._stRotation,t[i++]=e._perPositionHeightExtrude?1:0,t[i++]=e._perPositionHeight?1:0,t[i++]=e._closeTop?1:0,t[i++]=e._closeBottom?1:0,t[i++]=e._shadowVolume?1:0,t[i++]=Object(o.default)(e._offsetAttribute,-1),t[i++]=e._arcType,t[i]=e.packedLength,t};var _s=tt.default.clone(tt.default.UNIT_SPHERE),gs=new J.default,vs={polygonHierarchy:{}};ms.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=po.default.unpackPolygonHierarchy(e,t);t=a.startingIndex,delete a.startingIndex;var r=tt.default.unpack(e,t,_s);t+=tt.default.packedLength;var n=J.default.unpack(e,t,gs);t+=J.default.packedLength;var l=e[t++],u=e[t++],d=e[t++],f=e[t++],c=1===e[t++],h=1===e[t++],p=1===e[t++],m=1===e[t++],_=1===e[t++],g=e[t++],v=e[t++],b=e[t];return Object(s.default)(i)||(i=new ms(vs)),i._polygonHierarchy=a,i._ellipsoid=tt.default.clone(r,i._ellipsoid),i._vertexFormat=J.default.clone(n,i._vertexFormat),i._height=l,i._extrudedHeight=u,i._granularity=d,i._stRotation=f,i._perPositionHeightExtrude=c,i._perPositionHeight=h,i._closeTop=p,i._closeBottom=m,i._shadowVolume=_,i._offsetAttribute=-1===g?void 0:g,i._arcType=v,i.packedLength=b,i},ms.computeRectangle=function(e,t){var i=Object(o.default)(e.granularity,Ne.default.RADIANS_PER_DEGREE),a=Object(o.default)(e.arcType,ao.a.GEODESIC),r=e.polygonHierarchy,n=Object(o.default)(e.ellipsoid,tt.default.WGS84);return ds(r.positions,n,a,i,t)},ms.createGeometry=function(e){var t=e._vertexFormat,i=e._ellipsoid,a=e._granularity,n=e._stRotation,o=e._polygonHierarchy,l=e._perPositionHeight,u=e._closeTop,d=e._closeBottom,f=e._arcType,c=o.positions;if(!(c.length<3)){var h=Lt.default.fromPoints(c,i),p=po.default.polygonsFromHierarchy(o,h.projectPointsOntoPlane.bind(h),!l,i),m=p.hierarchy,_=p.polygons;if(0!==m.length){c=m[0].outerRing;var g,v=po.default.computeBoundingRectangle(h.plane.normal,h.projectPointOntoPlane.bind(h),c,n,zo),b=[],y=e._height,O=e._extrudedHeight,w={perPositionHeight:l,vertexFormat:t,geometry:void 0,tangentPlane:h,boundingRectangle:v,ellipsoid:i,stRotation:n,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:f};if(e._perPositionHeightExtrude||!Ne.default.equalsEpsilon(y,O,0,Ne.default.EPSILON2))for(w.extrude=!0,w.top=u,w.bottom=d,w.shadowVolume=e._shadowVolume,w.offsetAttribute=e._offsetAttribute,g=0;g<_.length;g++){var x,E=ps(i,_[g],a,m[g],l,u,d,t,f);u&&d?(x=E.topAndBottom,w.geometry=po.default.scaleToGeodeticHeightExtruded(x.geometry,y,O,i,l)):u?((x=E.topAndBottom).geometry.attributes.position.values=qi.a.scaleToGeodeticHeight(x.geometry.attributes.position.values,y,i,!l),w.geometry=x.geometry):d&&((x=E.topAndBottom).geometry.attributes.position.values=qi.a.scaleToGeodeticHeight(x.geometry.attributes.position.values,O,i,!0),w.geometry=x.geometry),(u||d)&&(w.wall=!1,x.geometry=ns(w),b.push(x));var T=E.walls;w.wall=!0;for(var C=0;C<T.length;C++){var A=T[C];w.geometry=po.default.scaleToGeodeticHeightExtruded(A.geometry,y,O,i,l),A.geometry=ns(w),b.push(A)}}else for(g=0;g<_.length;g++){var j=new de.a({geometry:po.default.createGeometryFromPositions(i,_[g],a,l,t,f)});if(j.geometry.attributes.position.values=qi.a.scaleToGeodeticHeight(j.geometry.attributes.position.values,y,i,!l),w.geometry=j.geometry,j.geometry=ns(w),Object(s.default)(e._offsetAttribute)){var P=j.geometry.attributes.position.values.length,S=new Uint8Array(P/3),I=e._offsetAttribute===fe.a.NONE?0:1;Object(Je.a)(S,I),j.geometry.attributes.applyOffset=new ki.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:S})}b.push(j)}var L=Ar.a.combineInstances(b)[0];L.attributes.position.values=new Float64Array(L.attributes.position.values),L.indices=Gi.a.createTypedArray(L.attributes.position.values.length/3,L.indices);var D=L.attributes,M=r.default.fromVertices(D.position.values);return t.position||delete D.position,new Hi.a({attributes:D,indices:L.indices,primitiveType:L.primitiveType,boundingSphere:M,offsetAttribute:e._offsetAttribute})}}},ms.createShadowVolume=function(e,t,i){var a=e._granularity,r=e._ellipsoid,n=t(a,r),o=i(a,r);return new ms({polygonHierarchy:e._polygonHierarchy,ellipsoid:r,stRotation:e._stRotation,granularity:a,perPositionHeight:!1,extrudedHeight:n,height:o,vertexFormat:J.default.POSITION_ONLY,shadowVolume:!0,arcType:e._arcType})},Object.defineProperties(ms.prototype,{rectangle:{get:function(){if(!Object(s.default)(this._rectangle)){var e=this._polygonHierarchy.positions;this._rectangle=ds(e,this._ellipsoid,this._arcType,this._granularity)}return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return Object(s.default)(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0===t)return[0,0,0,1,1,0];var i=e._ellipsoid,a=e._polygonHierarchy.positions,r=e.rectangle;return Hi.a._textureCoordinateRotationPoints(a,t,i,r)}(this)),this._textureCoordinateRotationPoints}}});var bs=ms,ys=[],Os=[];function ws(e,t,i,a,r){var n,o,s=Lt.default.fromPoints(t,e).projectPointsOntoPlane(t,ys);qi.a.computeWindingOrder2D(s)===Uo.default.CLOCKWISE&&(s.reverse(),t=t.slice().reverse());var l=t.length,u=0;if(a)for(n=new Float64Array(2*l*3),o=0;o<l;o++){var d=t[o],f=t[(o+1)%l];n[u++]=d.x,n[u++]=d.y,n[u++]=d.z,n[u++]=f.x,n[u++]=f.y,n[u++]=f.z}else{var c=0;if(r===ao.a.GEODESIC)for(o=0;o<l;o++)c+=po.default.subdivideLineCount(t[o],t[(o+1)%l],i);else if(r===ao.a.RHUMB)for(o=0;o<l;o++)c+=po.default.subdivideRhumbLineCount(e,t[o],t[(o+1)%l],i);for(n=new Float64Array(3*c),o=0;o<l;o++){var h;r===ao.a.GEODESIC?h=po.default.subdivideLine(t[o],t[(o+1)%l],i,Os):r===ao.a.RHUMB&&(h=po.default.subdivideRhumbLine(e,t[o],t[(o+1)%l],i,Os));for(var p=h.length,m=0;m<p;++m)n[u++]=h[m]}}var _=2*(l=n.length/3),g=Gi.a.createTypedArray(l,_);for(u=0,o=0;o<l-1;o++)g[u++]=o,g[u++]=o+1;return g[u++]=l-1,g[u++]=0,new de.a({geometry:new Hi.a({attributes:new zi.a({position:new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:n})}),indices:g,primitiveType:Wi.a.LINES})})}function xs(e,t,i,a,r){var n,o,s=Lt.default.fromPoints(t,e).projectPointsOntoPlane(t,ys);qi.a.computeWindingOrder2D(s)===Uo.default.CLOCKWISE&&(s.reverse(),t=t.slice().reverse());var l=t.length,u=new Array(l),d=0;if(a)for(n=new Float64Array(2*l*3*2),o=0;o<l;++o){u[o]=d/3;var f=t[o],c=t[(o+1)%l];n[d++]=f.x,n[d++]=f.y,n[d++]=f.z,n[d++]=c.x,n[d++]=c.y,n[d++]=c.z}else{var h=0;if(r===ao.a.GEODESIC)for(o=0;o<l;o++)h+=po.default.subdivideLineCount(t[o],t[(o+1)%l],i);else if(r===ao.a.RHUMB)for(o=0;o<l;o++)h+=po.default.subdivideRhumbLineCount(e,t[o],t[(o+1)%l],i);for(n=new Float64Array(3*h*2),o=0;o<l;++o){var p;u[o]=d/3,r===ao.a.GEODESIC?p=po.default.subdivideLine(t[o],t[(o+1)%l],i,Os):r===ao.a.RHUMB&&(p=po.default.subdivideRhumbLine(e,t[o],t[(o+1)%l],i,Os));for(var m=p.length,_=0;_<m;++_)n[d++]=p[_]}}l=n.length/6;var g=u.length,v=2*(2*l+g),b=Gi.a.createTypedArray(l+g,v);for(d=0,o=0;o<l;++o)b[d++]=o,b[d++]=(o+1)%l,b[d++]=o+l,b[d++]=(o+1)%l+l;for(o=0;o<g;o++){var y=u[o];b[d++]=y,b[d++]=y+l}return new de.a({geometry:new Hi.a({attributes:new zi.a({position:new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:n})}),indices:b,primitiveType:Wi.a.LINES})})}function Es(e){var t=e.polygonHierarchy,i=Object(o.default)(e.ellipsoid,tt.default.WGS84),a=Object(o.default)(e.granularity,Ne.default.RADIANS_PER_DEGREE),r=Object(o.default)(e.perPositionHeight,!1),n=r&&Object(s.default)(e.extrudedHeight),l=Object(o.default)(e.arcType,ao.a.GEODESIC),u=Object(o.default)(e.height,0),d=Object(o.default)(e.extrudedHeight,u);if(!n){var f=Math.max(u,d);d=Math.min(u,d),u=f}this._ellipsoid=tt.default.clone(i),this._granularity=a,this._height=u,this._extrudedHeight=d,this._arcType=l,this._polygonHierarchy=t,this._perPositionHeight=r,this._perPositionHeightExtrude=n,this._offsetAttribute=e.offsetAttribute,this._workerName="createPolygonOutlineGeometry",this.packedLength=po.default.computeHierarchyPackedLength(t)+tt.default.packedLength+8}Es.pack=function(e,t,i){return i=Object(o.default)(i,0),i=po.default.packPolygonHierarchy(e._polygonHierarchy,t,i),tt.default.pack(e._ellipsoid,t,i),i+=tt.default.packedLength,t[i++]=e._height,t[i++]=e._extrudedHeight,t[i++]=e._granularity,t[i++]=e._perPositionHeightExtrude?1:0,t[i++]=e._perPositionHeight?1:0,t[i++]=e._arcType,t[i++]=Object(o.default)(e._offsetAttribute,-1),t[i]=e.packedLength,t};var Ts=tt.default.clone(tt.default.UNIT_SPHERE),Cs={polygonHierarchy:{}};Es.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=po.default.unpackPolygonHierarchy(e,t);t=a.startingIndex,delete a.startingIndex;var r=tt.default.unpack(e,t,Ts);t+=tt.default.packedLength;var n=e[t++],l=e[t++],u=e[t++],d=1===e[t++],f=1===e[t++],c=e[t++],h=e[t++],p=e[t];return Object(s.default)(i)||(i=new Es(Cs)),i._polygonHierarchy=a,i._ellipsoid=tt.default.clone(r,i._ellipsoid),i._height=n,i._extrudedHeight=l,i._granularity=u,i._perPositionHeight=f,i._perPositionHeightExtrude=d,i._arcType=c,i._offsetAttribute=-1===h?void 0:h,i.packedLength=p,i},Es.fromPositions=function(e){return new Es({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions},height:e.height,extrudedHeight:e.extrudedHeight,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,arcType:e.arcType,offsetAttribute:e.offsetAttribute})},Es.createGeometry=function(e){var t=e._ellipsoid,i=e._granularity,a=e._polygonHierarchy,n=e._perPositionHeight,o=e._arcType,l=po.default.polygonOutlinesFromHierarchy(a,!n,t);if(0!==l.length){var u,d,f,c=[],h=Ne.default.chordLength(i,t.maximumRadius),p=e._height,m=e._extrudedHeight;if(e._perPositionHeightExtrude||!Ne.default.equalsEpsilon(p,m,0,Ne.default.EPSILON2))for(f=0;f<l.length;f++){if((u=xs(t,l[f],h,n,o)).geometry=po.default.scaleToGeodeticHeightExtruded(u.geometry,p,m,t,n),Object(s.default)(e._offsetAttribute)){var _=u.geometry.attributes.position.values.length/3,g=new Uint8Array(_);e._offsetAttribute===fe.a.TOP?g=Object(Je.a)(g,1,0,_/2):(d=e._offsetAttribute===fe.a.NONE?0:1,g=Object(Je.a)(g,d)),u.geometry.attributes.applyOffset=new ki.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:g})}c.push(u)}else for(f=0;f<l.length;f++){if((u=ws(t,l[f],h,n,o)).geometry.attributes.position.values=qi.a.scaleToGeodeticHeight(u.geometry.attributes.position.values,p,t,!n),Object(s.default)(e._offsetAttribute)){var v=u.geometry.attributes.position.values.length,b=new Uint8Array(v/3);d=e._offsetAttribute===fe.a.NONE?0:1,Object(Je.a)(b,d),u.geometry.attributes.applyOffset=new ki.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})}c.push(u)}var y=Ar.a.combineInstances(c)[0],O=r.default.fromVertices(y.attributes.position.values);return new Hi.a({attributes:y.attributes,indices:y.indices,primitiveType:y.primitiveType,boundingSphere:O,offsetAttribute:e._offsetAttribute})}};var As=Es,js=new b.default,Ps=v.default.ZERO,Ss=new v.default,Is=new Yi.default,Ls=[],Ds=new g.default;function Ms(e){this.id=e,this.vertexFormat=void 0,this.polygonHierarchy=void 0,this.perPositionHeight=void 0,this.closeTop=void 0,this.closeBottom=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.offsetAttribute=void 0,this.arcType=void 0}function Rs(e,t){Ia.call(this,{entity:e,scene:t,geometryOptions:new Ms(e),geometryPropertyName:"polygon",observedPropertyNames:["availability","polygon"]}),this._onEntityPropertyChanged(e,"polygon",e.polygon,void 0)}function Ns(e,t,i){ye.call(this,e,t,i)}Object(s.default)(Object.create)&&(Rs.prototype=Object.create(Ia.prototype),Rs.prototype.constructor=Rs),Rs.prototype.createFillGeometryInstance=function(e){var t,i,a=this._entity,r=a.isAvailable(e),n=this._options,o={show:new pe.a(r&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:ue.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof me.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(t=this._materialProperty.color.getValue(e,js)),Object(s.default)(t)||(t=b.default.WHITE),o.color=oe.a.fromColor(t));return Object(s.default)(n.offsetAttribute)&&(o.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,Ps,Ss))),i=n.perPositionHeight&&!Object(s.default)(n.extrudedHeight)?new Mo(n):new bs(n),new de.a({id:a,geometry:i,attributes:o})},Rs.prototype.createOutlineGeometryInstance=function(e){var t,i=this._entity,a=i.isAvailable(e),r=this._options,n=A.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,js),o=this._distanceDisplayConditionProperty.getValue(e),l={show:new pe.a(a&&i.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(n),distanceDisplayCondition:ue.fromDistanceDisplayCondition(o),offset:void 0};return Object(s.default)(r.offsetAttribute)&&(l.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,Ps,Ss))),t=r.perPositionHeight&&!Object(s.default)(r.extrudedHeight)?new Bo(r):new As(r),new de.a({id:i,geometry:t,attributes:l})},Rs.prototype._computeCenter=function(e,t){var i=A.default.getValueOrUndefined(this._entity.polygon.hierarchy,e);if(Object(s.default)(i)){var a=i.positions;if(0!==a.length){for(var r=this._scene.mapProjection.ellipsoid,n=Lt.default.fromPoints(a,r),o=n.projectPointsOntoPlane(a,Ls),l=o.length,u=0,d=l-1,f=new g.default,c=0;c<l;d=c++){var h=o[c],p=o[d],m=h.x*p.y-p.x*h.y,_=g.default.add(h,p,Ds);_=g.default.multiplyByScalar(_,m,_),f=g.default.add(f,_,f),u+=m}var v=1/(3*u);return f=g.default.multiplyByScalar(f,v,f),n.projectPointOntoEllipsoid(f,t)}}},Rs.prototype._isHidden=function(e,t){return!Object(s.default)(t.hierarchy)||De.prototype._isHidden.call(this,e,t)},Rs.prototype._isOnTerrain=function(e,t){var i=Ia.prototype._isOnTerrain.call(this,e,t),a=t.perPositionHeight,r=Object(s.default)(a)&&(!a.isConstant||a.getValue(ce.default.MINIMUM_VALUE));return i&&!r},Rs.prototype._isDynamic=function(e,t){return!t.hierarchy.isConstant||!A.default.isConstant(t.height)||!A.default.isConstant(t.extrudedHeight)||!A.default.isConstant(t.granularity)||!A.default.isConstant(t.stRotation)||!A.default.isConstant(t.outlineWidth)||!A.default.isConstant(t.perPositionHeight)||!A.default.isConstant(t.closeTop)||!A.default.isConstant(t.closeBottom)||!A.default.isConstant(t.zIndex)||!A.default.isConstant(t.arcType)||this._onTerrain&&!A.default.isConstant(this._materialProperty)&&!(this._materialProperty instanceof me.default)},Rs.prototype._setStaticOptions=function(e,t){var i=this._materialProperty instanceof me.default,r=this._options;r.vertexFormat=i?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat;var n,o=t.hierarchy.getValue(ce.default.MINIMUM_VALUE),l=A.default.getValueOrUndefined(t.height,ce.default.MINIMUM_VALUE),u=A.default.getValueOrDefault(t.heightReference,ce.default.MINIMUM_VALUE,x.default.NONE),d=A.default.getValueOrUndefined(t.extrudedHeight,ce.default.MINIMUM_VALUE),f=A.default.getValueOrDefault(t.extrudedHeightReference,ce.default.MINIMUM_VALUE,x.default.NONE),c=A.default.getValueOrDefault(t.perPositionHeight,ce.default.MINIMUM_VALUE,!1);l=Ia.getGeometryHeight(l,u),c?(Object(s.default)(l)&&(l=void 0,Object(Oe.a)("Entity polygons cannot have both height and perPositionHeight.  height will be ignored")),u!==x.default.NONE&&c&&(l=void 0,Object(Oe.a)("heightReference is not supported for entity polygons with perPositionHeight. heightReference will be ignored"))):(Object(s.default)(d)&&!Object(s.default)(l)&&(l=0),n=Ia.computeGeometryOffsetAttribute(l,u,d,f)),r.polygonHierarchy=o,r.granularity=A.default.getValueOrUndefined(t.granularity,ce.default.MINIMUM_VALUE),r.stRotation=A.default.getValueOrUndefined(t.stRotation,ce.default.MINIMUM_VALUE),r.perPositionHeight=c,r.closeTop=A.default.getValueOrDefault(t.closeTop,ce.default.MINIMUM_VALUE,!0),r.closeBottom=A.default.getValueOrDefault(t.closeBottom,ce.default.MINIMUM_VALUE,!0),r.offsetAttribute=n,r.height=l,r.arcType=A.default.getValueOrDefault(t.arcType,ce.default.MINIMUM_VALUE,ao.a.GEODESIC),(d=Ia.getGeometryExtrudedHeight(d,f))===Ia.CLAMP_TO_GROUND&&(d=a.a.getMinimumMaximumHeights(bs.computeRectangle(r,Is)).minimumTerrainHeight),r.extrudedHeight=d},Rs.prototype._getIsClosed=function(e){var t=e.height,i=e.extrudedHeight,a=Object(s.default)(i)&&i!==t;return!e.perPositionHeight&&(!a&&0===t||a&&e.closeTop&&e.closeBottom)},Rs.DynamicGeometryUpdater=Ns,Object(s.default)(Object.create)&&(Ns.prototype=Object.create(ye.prototype),Ns.prototype.constructor=Ns),Ns.prototype._isHidden=function(e,t,i){return!Object(s.default)(this._options.polygonHierarchy)||ye.prototype._isHidden.call(this,e,t,i)},Ns.prototype._setOptions=function(e,t,i){var r=this._options;r.polygonHierarchy=A.default.getValueOrUndefined(t.hierarchy,i);var n,o=A.default.getValueOrUndefined(t.height,i),l=A.default.getValueOrDefault(t.heightReference,i,x.default.NONE),u=A.default.getValueOrDefault(t.extrudedHeightReference,i,x.default.NONE),d=A.default.getValueOrUndefined(t.extrudedHeight,i),f=A.default.getValueOrUndefined(t.perPositionHeight,i);o=Ia.getGeometryHeight(o,u),f?(Object(s.default)(o)&&(o=void 0,Object(Oe.a)("Entity polygons cannot have both height and perPositionHeight.  height will be ignored")),l!==x.default.NONE&&f&&(o=void 0,Object(Oe.a)("heightReference is not supported for entity polygons with perPositionHeight. heightReference will be ignored"))):(Object(s.default)(d)&&!Object(s.default)(o)&&(o=0),n=Ia.computeGeometryOffsetAttribute(o,l,d,u)),r.granularity=A.default.getValueOrUndefined(t.granularity,i),r.stRotation=A.default.getValueOrUndefined(t.stRotation,i),r.perPositionHeight=A.default.getValueOrUndefined(t.perPositionHeight,i),r.closeTop=A.default.getValueOrDefault(t.closeTop,i,!0),r.closeBottom=A.default.getValueOrDefault(t.closeBottom,i,!0),r.offsetAttribute=n,r.height=o,r.arcType=A.default.getValueOrDefault(t.arcType,i,ao.a.GEODESIC),(d=Ia.getGeometryExtrudedHeight(d,u))===Ia.CLAMP_TO_GROUND&&(d=a.a.getMinimumMaximumHeights(bs.computeRectangle(r,Is)).minimumTerrainHeight),r.extrudedHeight=d};var Vs=Rs;function Bs(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polylinePositions,i=e.shapePositions;this._positions=t,this._shape=i,this._ellipsoid=tt.default.clone(Object(o.default)(e.ellipsoid,tt.default.WGS84)),this._cornerType=Object(o.default)(e.cornerType,$e.a.ROUNDED),this._vertexFormat=J.default.clone(Object(o.default)(e.vertexFormat,J.default.DEFAULT)),this._granularity=Object(o.default)(e.granularity,Ne.default.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeGeometry";var a=1+t.length*v.default.packedLength;a+=1+i.length*g.default.packedLength,this.packedLength=a+tt.default.packedLength+J.default.packedLength+2}Bs.pack=function(e,t,i){var a;i=Object(o.default)(i,0);var r=e._positions,n=r.length;for(t[i++]=n,a=0;a<n;++a,i+=v.default.packedLength)v.default.pack(r[a],t,i);var s=e._shape;for(n=s.length,t[i++]=n,a=0;a<n;++a,i+=g.default.packedLength)g.default.pack(s[a],t,i);return tt.default.pack(e._ellipsoid,t,i),i+=tt.default.packedLength,J.default.pack(e._vertexFormat,t,i),i+=J.default.packedLength,t[i++]=e._cornerType,t[i]=e._granularity,t};var Us=tt.default.clone(tt.default.UNIT_SPHERE),Fs=new J.default,Hs={polylinePositions:void 0,shapePositions:void 0,ellipsoid:Us,vertexFormat:Fs,cornerType:void 0,granularity:void 0};Bs.unpack=function(e,t,i){var a;t=Object(o.default)(t,0);var r=e[t++],n=new Array(r);for(a=0;a<r;++a,t+=v.default.packedLength)n[a]=v.default.unpack(e,t);r=e[t++];var l=new Array(r);for(a=0;a<r;++a,t+=g.default.packedLength)l[a]=g.default.unpack(e,t);var u=tt.default.unpack(e,t,Us);t+=tt.default.packedLength;var d=J.default.unpack(e,t,Fs);t+=J.default.packedLength;var f=e[t++],c=e[t];return Object(s.default)(i)?(i._positions=n,i._shape=l,i._ellipsoid=tt.default.clone(u,i._ellipsoid),i._vertexFormat=J.default.clone(d,i._vertexFormat),i._cornerType=f,i._granularity=c,i):(Hs.polylinePositions=n,Hs.shapePositions=l,Hs.cornerType=f,Hs.granularity=c,new Bs(Hs))};var ks=new _.default;Bs.createGeometry=function(e){var t=e._positions,i=Object(Qe.a)(t,v.default.equalsEpsilon),a=e._shape;if(a=_i.removeDuplicatesFromShape(a),!(i.length<2||a.length<3)){qi.a.computeWindingOrder2D(a)===Uo.default.CLOCKWISE&&a.reverse();var n=_.default.fromPoints(a,ks);return function(e,t,i,a){var n=new zi.a;a.position&&(n.position=new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:e}));var o,s,l,u,d,f,c=t.length,h=e.length/3,p=(h-2*c)/(2*c),m=qi.a.triangulate(t),_=(p-1)*c*6+2*m.length,g=Gi.a.createTypedArray(h,_),v=2*c,b=0;for(o=0;o<p-1;o++){for(s=0;s<c-1;s++)f=(l=2*s+o*c*2)+v,d=(u=l+1)+v,g[b++]=u,g[b++]=l,g[b++]=d,g[b++]=d,g[b++]=l,g[b++]=f;d=(u=(l=2*c-2+o*c*2)+1)+v,f=l+v,g[b++]=u,g[b++]=l,g[b++]=d,g[b++]=d,g[b++]=l,g[b++]=f}if(a.st||a.tangent||a.bitangent){var y,O,w=new Float32Array(2*h),x=1/(p-1),E=1/i.height,T=i.height/2,C=0;for(o=0;o<p;o++){for(y=o*x,O=E*(t[0].y+T),w[C++]=y,w[C++]=O,s=1;s<c;s++)O=E*(t[s].y+T),w[C++]=y,w[C++]=O,w[C++]=y,w[C++]=O;O=E*(t[0].y+T),w[C++]=y,w[C++]=O}for(s=0;s<c;s++)y=0,O=E*(t[s].y+T),w[C++]=y,w[C++]=O;for(s=0;s<c;s++)y=(p-1)*x,O=E*(t[s].y+T),w[C++]=y,w[C++]=O;n.st=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:new Float32Array(w)})}var A=h-2*c;for(o=0;o<m.length;o+=3){var j=m[o]+A,P=m[o+1]+A,S=m[o+2]+A;g[b++]=j,g[b++]=P,g[b++]=S,g[b++]=S+c,g[b++]=P+c,g[b++]=j+c}var I=new Hi.a({attributes:n,indices:g,boundingSphere:r.default.fromVertices(e),primitiveType:Wi.a.TRIANGLES});if(a.normal&&(I=Ar.a.computeNormal(I)),a.tangent||a.bitangent){try{I=Ar.a.computeTangentAndBitangent(I)}catch(e){Object(Oe.a)("polyline-volume-tangent-bitangent","Unable to compute tangents and bitangents for polyline volume geometry")}a.tangent||(I.attributes.tangent=void 0),a.bitangent||(I.attributes.bitangent=void 0),a.st||(I.attributes.st=void 0)}return I}(_i.computePositions(i,a,n,e,!0),a,n,e._vertexFormat)}};var zs=Bs;function Gs(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polylinePositions,i=e.shapePositions;this._positions=t,this._shape=i,this._ellipsoid=tt.default.clone(Object(o.default)(e.ellipsoid,tt.default.WGS84)),this._cornerType=Object(o.default)(e.cornerType,$e.a.ROUNDED),this._granularity=Object(o.default)(e.granularity,Ne.default.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeOutlineGeometry";var a=1+t.length*v.default.packedLength;a+=1+i.length*g.default.packedLength,this.packedLength=a+tt.default.packedLength+2}Gs.pack=function(e,t,i){var a;i=Object(o.default)(i,0);var r=e._positions,n=r.length;for(t[i++]=n,a=0;a<n;++a,i+=v.default.packedLength)v.default.pack(r[a],t,i);var s=e._shape;for(n=s.length,t[i++]=n,a=0;a<n;++a,i+=g.default.packedLength)g.default.pack(s[a],t,i);return tt.default.pack(e._ellipsoid,t,i),i+=tt.default.packedLength,t[i++]=e._cornerType,t[i]=e._granularity,t};var qs=tt.default.clone(tt.default.UNIT_SPHERE),Ws={polylinePositions:void 0,shapePositions:void 0,ellipsoid:qs,height:void 0,cornerType:void 0,granularity:void 0};Gs.unpack=function(e,t,i){var a;t=Object(o.default)(t,0);var r=e[t++],n=new Array(r);for(a=0;a<r;++a,t+=v.default.packedLength)n[a]=v.default.unpack(e,t);r=e[t++];var l=new Array(r);for(a=0;a<r;++a,t+=g.default.packedLength)l[a]=g.default.unpack(e,t);var u=tt.default.unpack(e,t,qs);t+=tt.default.packedLength;var d=e[t++],f=e[t];return Object(s.default)(i)?(i._positions=n,i._shape=l,i._ellipsoid=tt.default.clone(u,i._ellipsoid),i._cornerType=d,i._granularity=f,i):(Ws.polylinePositions=n,Ws.shapePositions=l,Ws.cornerType=d,Ws.granularity=f,new Gs(Ws))};var Ys=new _.default;Gs.createGeometry=function(e){var t=e._positions,i=Object(Qe.a)(t,v.default.equalsEpsilon),a=e._shape;if(a=_i.removeDuplicatesFromShape(a),!(i.length<2||a.length<3)){qi.a.computeWindingOrder2D(a)===Uo.default.CLOCKWISE&&a.reverse();var n=_.default.fromPoints(a,Ys);return function(e,t){var i=new zi.a;i.position=new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:e});var a,n,o=t.length,s=i.position.values.length/3,l=e.length/3/o,u=Gi.a.createTypedArray(s,2*o*(l+1)),d=0,f=(a=0)*o;for(n=0;n<o-1;n++)u[d++]=n+f,u[d++]=n+f+1;for(u[d++]=o-1+f,u[d++]=f,f=(a=l-1)*o,n=0;n<o-1;n++)u[d++]=n+f,u[d++]=n+f+1;for(u[d++]=o-1+f,u[d++]=f,a=0;a<l-1;a++){var c=o*a,h=c+o;for(n=0;n<o;n++)u[d++]=n+c,u[d++]=n+h}return new Hi.a({attributes:i,indices:Gi.a.createTypedArray(s,u),boundingSphere:r.default.fromVertices(e),primitiveType:Wi.a.LINES})}(_i.computePositions(i,a,n,e,!1),a)}};var Ks=Gs,Xs=new b.default;function Zs(e){this.id=e,this.vertexFormat=void 0,this.polylinePositions=void 0,this.shapePositions=void 0,this.cornerType=void 0,this.granularity=void 0}function Js(e,t){De.call(this,{entity:e,scene:t,geometryOptions:new Zs(e),geometryPropertyName:"polylineVolume",observedPropertyNames:["availability","polylineVolume"]}),this._onEntityPropertyChanged(e,"polylineVolume",e.polylineVolume,void 0)}function Qs(e,t,i){ye.call(this,e,t,i)}Object(s.default)(Object.create)&&(Js.prototype=Object.create(De.prototype),Js.prototype.constructor=Js),Js.prototype.createFillGeometryInstance=function(e){var t,i,a=this._entity,r=a.isAvailable(e),n=new pe.a(r&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),l=ue.fromDistanceDisplayCondition(o);this._materialProperty instanceof me.default?(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(i=this._materialProperty.color.getValue(e,Xs)),Object(s.default)(i)||(i=b.default.WHITE),t={show:n,distanceDisplayCondition:l,color:oe.a.fromColor(i)}):t={show:n,distanceDisplayCondition:l};return new de.a({id:a,geometry:new zs(this._options),attributes:t})},Js.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,i=t.isAvailable(e),a=A.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,Xs),r=this._distanceDisplayConditionProperty.getValue(e);return new de.a({id:t,geometry:new Ks(this._options),attributes:{show:new pe.a(i&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(a),distanceDisplayCondition:ue.fromDistanceDisplayCondition(r)}})},Js.prototype._isHidden=function(e,t){return!Object(s.default)(t.positions)||!Object(s.default)(t.shape)||De.prototype._isHidden.call(this,e,t)},Js.prototype._isDynamic=function(e,t){return!(t.positions.isConstant&&t.shape.isConstant&&A.default.isConstant(t.granularity)&&A.default.isConstant(t.outlineWidth)&&A.default.isConstant(t.cornerType))},Js.prototype._setStaticOptions=function(e,t){var i=t.granularity,a=t.cornerType,r=this._options,n=this._materialProperty instanceof me.default;r.vertexFormat=n?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,r.polylinePositions=t.positions.getValue(ce.default.MINIMUM_VALUE,r.polylinePositions),r.shapePositions=t.shape.getValue(ce.default.MINIMUM_VALUE,r.shape),r.granularity=Object(s.default)(i)?i.getValue(ce.default.MINIMUM_VALUE):void 0,r.cornerType=Object(s.default)(a)?a.getValue(ce.default.MINIMUM_VALUE):void 0},Js.DynamicGeometryUpdater=Qs,Object(s.default)(Object.create)&&(Qs.prototype=Object.create(ye.prototype),Qs.prototype.constructor=Qs),Qs.prototype._isHidden=function(e,t,i){var a=this._options;return!Object(s.default)(a.polylinePositions)||!Object(s.default)(a.shapePositions)||ye.prototype._isHidden.call(this,e,t,i)},Qs.prototype._setOptions=function(e,t,i){var a=this._options;a.polylinePositions=A.default.getValueOrUndefined(t.positions,i,a.polylinePositions),a.shapePositions=A.default.getValueOrUndefined(t.shape,i),a.granularity=A.default.getValueOrUndefined(t.granularity,i),a.cornerType=A.default.getValueOrUndefined(t.cornerType,i)};var $s=Js,el=i(135),tl=i(276),il=new v.default,al=new v.default,rl=new v.default,nl=new v.default,ol=new Yi.default,sl=new g.default,ll=new r.default,ul=new r.default;function dl(e,t){var i=new Hi.a({attributes:new zi.a,primitiveType:Wi.a.TRIANGLES});return i.attributes.position=new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:t.positions}),e.normal&&(i.attributes.normal=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:t.normals})),e.tangent&&(i.attributes.tangent=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:t.tangents})),e.bitangent&&(i.attributes.bitangent=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:t.bitangents})),i}var fl=new v.default,cl=new v.default;function hl(e,t){var i=e._vertexFormat,a=e._ellipsoid,r=t.height,n=t.width,o=t.northCap,s=t.southCap,l=0,u=r,d=r,f=0;o&&(l=1,d-=1,f+=1),s&&(u-=1,d-=1,f+=1),f+=n*d;for(var c=i.position?new Float64Array(3*f):void 0,h=i.st?new Float32Array(2*f):void 0,p=0,m=0,_=il,g=sl,b=Number.MAX_VALUE,y=Number.MAX_VALUE,O=-Number.MAX_VALUE,w=-Number.MAX_VALUE,x=l;x<u;++x)for(var E=0;E<n;++E)tl.a.computePosition(t,a,i.st,x,E,_,g),c[p++]=_.x,c[p++]=_.y,c[p++]=_.z,i.st&&(h[m++]=g.x,h[m++]=g.y,b=Math.min(b,g.x),y=Math.min(y,g.y),O=Math.max(O,g.x),w=Math.max(w,g.y));if(o&&(tl.a.computePosition(t,a,i.st,0,0,_,g),c[p++]=_.x,c[p++]=_.y,c[p++]=_.z,i.st&&(h[m++]=g.x,h[m++]=g.y,b=g.x,y=g.y,O=g.x,w=g.y)),s&&(tl.a.computePosition(t,a,i.st,r-1,0,_,g),c[p++]=_.x,c[p++]=_.y,c[p]=_.z,i.st&&(h[m++]=g.x,h[m]=g.y,b=Math.min(b,g.x),y=Math.min(y,g.y),O=Math.max(O,g.x),w=Math.max(w,g.y))),i.st&&(b<0||y<0||O>1||w>1))for(var T=0;T<h.length;T+=2)h[T]=(h[T]-b)/(O-b),h[T+1]=(h[T+1]-y)/(w-y);var C=function(e,t,i,a){var r=e.length,n=t.normal?new Float32Array(r):void 0,o=t.tangent?new Float32Array(r):void 0,s=t.bitangent?new Float32Array(r):void 0,l=0,u=nl,d=rl,f=al;if(t.normal||t.tangent||t.bitangent)for(var c=0;c<r;c+=3){var h=v.default.fromArray(e,c,il),p=l+1,m=l+2;f=i.geodeticSurfaceNormal(h,f),(t.tangent||t.bitangent)&&(v.default.cross(v.default.UNIT_Z,f,d),et.default.multiplyByVector(a,d,d),v.default.normalize(d,d),t.bitangent&&v.default.normalize(v.default.cross(f,d,u),u)),t.normal&&(n[l]=f.x,n[p]=f.y,n[m]=f.z),t.tangent&&(o[l]=d.x,o[p]=d.y,o[m]=d.z),t.bitangent&&(s[l]=u.x,s[p]=u.y,s[m]=u.z),l+=3}return dl(t,{positions:e,normals:n,tangents:o,bitangents:s})}(c,i,a,t.tangentRotationMatrix),A=6*(n-1)*(d-1);o&&(A+=3*(n-1)),s&&(A+=3*(n-1));var j,P=Gi.a.createTypedArray(f,A),S=0,I=0;for(j=0;j<d-1;++j){for(var L=0;L<n-1;++L){var D=S,M=D+n,R=M+1,N=D+1;P[I++]=D,P[I++]=M,P[I++]=N,P[I++]=N,P[I++]=M,P[I++]=R,++S}++S}if(o||s){var V,B,U=f-1,F=f-1;if(o&&s&&(U=f-2),S=0,o)for(j=0;j<n-1;j++)B=(V=S)+1,P[I++]=U,P[I++]=V,P[I++]=B,++S;if(s)for(S=(d-1)*n,j=0;j<n-1;j++)B=(V=S)+1,P[I++]=V,P[I++]=F,P[I++]=B,++S}return C.indices=P,i.st&&(C.attributes.st=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:h})),C}function pl(e,t,i,a,r){return e[t++]=a[i],e[t++]=a[i+1],e[t++]=a[i+2],e[t++]=r[i],e[t++]=r[i+1],e[t]=r[i+2],e}function ml(e,t,i,a){return e[t++]=a[i],e[t++]=a[i+1],e[t++]=a[i],e[t]=a[i+1],e}var _l=new J.default;function gl(e,t){var i,a=e._shadowVolume,r=e._offsetAttribute,n=e._vertexFormat,o=e._extrudedHeight,l=e._surfaceHeight,u=e._ellipsoid,d=t.height,f=t.width;if(a){var c=J.default.clone(n,_l);c.normal=!0,e._vertexFormat=c}var h=hl(e,t);a&&(e._vertexFormat=n);var p=qi.a.scaleToGeodeticHeight(h.attributes.position.values,l,u,!1),m=(p=new Float64Array(p)).length,_=2*m,g=new Float64Array(_);g.set(p);var b=qi.a.scaleToGeodeticHeight(h.attributes.position.values,o,u);g.set(b,m),h.attributes.position.values=g;var y,O,w,x=n.normal?new Float32Array(_):void 0,E=n.tangent?new Float32Array(_):void 0,T=n.bitangent?new Float32Array(_):void 0,C=n.st?new Float32Array(_/3*2):void 0;if(n.normal){for(O=h.attributes.normal.values,x.set(O),i=0;i<m;i++)O[i]=-O[i];x.set(O,m),h.attributes.normal.values=x}if(a){O=h.attributes.normal.values,n.normal||(h.attributes.normal=void 0);var A=new Float32Array(_);for(i=0;i<m;i++)O[i]=-O[i];A.set(O,m),h.attributes.extrudeDirection=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:A})}var j=Object(s.default)(r);if(j){var P=m/3*2,S=new Uint8Array(P);r===fe.a.TOP?S=Object(Je.a)(S,1,0,P/2):(w=r===fe.a.NONE?0:1,S=Object(Je.a)(S,w)),h.attributes.applyOffset=new ki.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:S})}if(n.tangent){var I=h.attributes.tangent.values;for(E.set(I),i=0;i<m;i++)I[i]=-I[i];E.set(I,m),h.attributes.tangent.values=E}if(n.bitangent){var L=h.attributes.bitangent.values;T.set(L),T.set(L,m),h.attributes.bitangent.values=T}n.st&&(y=h.attributes.st.values,C.set(y),C.set(y,m/3*2),h.attributes.st.values=C);var D=h.indices,M=D.length,R=m/3,N=Gi.a.createTypedArray(_/3,2*M);for(N.set(D),i=0;i<M;i+=3)N[i+M]=D[i+2]+R,N[i+1+M]=D[i+1]+R,N[i+2+M]=D[i]+R;h.indices=N;var V=t.northCap,B=t.southCap,U=d,F=2,H=0,k=4,z=4;V&&(F-=1,U-=1,H+=1,k-=2,z-=1),B&&(F-=1,U-=1,H+=1,k-=2,z-=1);var G=2*((H+=F*f+2*U-k)+z),q=new Float64Array(3*G),W=a?new Float32Array(3*G):void 0,Y=j?new Uint8Array(G):void 0,K=n.st?new Float32Array(2*G):void 0,X=r===fe.a.TOP;j&&!X&&(w=r===fe.a.ALL?1:0,Y=Object(Je.a)(Y,w));var Z,Q=0,$=0,ee=0,te=0,ie=f*U;for(i=0;i<ie;i+=f)q=pl(q,Q,Z=3*i,p,b),Q+=6,n.st&&(K=ml(K,$,2*i,y),$+=4),a&&(ee+=3,W[ee++]=O[Z],W[ee++]=O[Z+1],W[ee++]=O[Z+2]),X&&(Y[te++]=1,te+=1);if(B){var ae=V?ie+1:ie;for(Z=3*ae,i=0;i<2;i++)q=pl(q,Q,Z,p,b),Q+=6,n.st&&(K=ml(K,$,2*ae,y),$+=4),a&&(ee+=3,W[ee++]=O[Z],W[ee++]=O[Z+1],W[ee++]=O[Z+2]),X&&(Y[te++]=1,te+=1)}else for(i=ie-f;i<ie;i++)q=pl(q,Q,Z=3*i,p,b),Q+=6,n.st&&(K=ml(K,$,2*i,y),$+=4),a&&(ee+=3,W[ee++]=O[Z],W[ee++]=O[Z+1],W[ee++]=O[Z+2]),X&&(Y[te++]=1,te+=1);for(i=ie-1;i>0;i-=f)q=pl(q,Q,Z=3*i,p,b),Q+=6,n.st&&(K=ml(K,$,2*i,y),$+=4),a&&(ee+=3,W[ee++]=O[Z],W[ee++]=O[Z+1],W[ee++]=O[Z+2]),X&&(Y[te++]=1,te+=1);if(V){var re=ie;for(Z=3*re,i=0;i<2;i++)q=pl(q,Q,Z,p,b),Q+=6,n.st&&(K=ml(K,$,2*re,y),$+=4),a&&(ee+=3,W[ee++]=O[Z],W[ee++]=O[Z+1],W[ee++]=O[Z+2]),X&&(Y[te++]=1,te+=1)}else for(i=f-1;i>=0;i--)q=pl(q,Q,Z=3*i,p,b),Q+=6,n.st&&(K=ml(K,$,2*i,y),$+=4),a&&(ee+=3,W[ee++]=O[Z],W[ee++]=O[Z+1],W[ee++]=O[Z+2]),X&&(Y[te++]=1,te+=1);var ne=function(e,t,i){var a=e.length,r=t.normal?new Float32Array(a):void 0,n=t.tangent?new Float32Array(a):void 0,o=t.bitangent?new Float32Array(a):void 0,s=0,l=0,u=0,d=!0,f=nl,c=rl,h=al;if(t.normal||t.tangent||t.bitangent)for(var p=0;p<a;p+=6){var m=v.default.fromArray(e,p,il),_=v.default.fromArray(e,(p+6)%a,fl);if(d){var g=v.default.fromArray(e,(p+3)%a,cl);v.default.subtract(_,m,_),v.default.subtract(g,m,g),h=v.default.normalize(v.default.cross(g,_,h),h),d=!1}v.default.equalsEpsilon(_,m,Ne.default.EPSILON10)&&(d=!0),(t.tangent||t.bitangent)&&(f=i.geodeticSurfaceNormal(m,f),t.tangent&&(c=v.default.normalize(v.default.cross(f,h,c),c))),t.normal&&(r[s++]=h.x,r[s++]=h.y,r[s++]=h.z,r[s++]=h.x,r[s++]=h.y,r[s++]=h.z),t.tangent&&(n[l++]=c.x,n[l++]=c.y,n[l++]=c.z,n[l++]=c.x,n[l++]=c.y,n[l++]=c.z),t.bitangent&&(o[u++]=f.x,o[u++]=f.y,o[u++]=f.z,o[u++]=f.x,o[u++]=f.y,o[u++]=f.z)}return dl(t,{positions:e,normals:r,tangents:n,bitangents:o})}(q,n,u);n.st&&(ne.attributes.st=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:K})),a&&(ne.attributes.extrudeDirection=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:W})),j&&(ne.attributes.applyOffset=new ki.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:Y}));var oe,le,ue,ce,he=Gi.a.createTypedArray(G,6*H);m=q.length/3;var pe=0;for(i=0;i<m-1;i+=2){ce=((oe=i)+2)%m;var me=v.default.fromArray(q,3*oe,fl),_e=v.default.fromArray(q,3*ce,cl);v.default.equalsEpsilon(me,_e,Ne.default.EPSILON10)||(ue=((le=(oe+1)%m)+2)%m,he[pe++]=oe,he[pe++]=le,he[pe++]=ce,he[pe++]=ce,he[pe++]=le,he[pe++]=ue)}return ne.indices=he,(ne=Ar.a.combineInstances([new de.a({geometry:h}),new de.a({geometry:ne})]))[0]}var vl=[new v.default,new v.default,new v.default,new v.default],bl=new Re.default,yl=new Re.default;function Ol(e,t,i,a,r){if(0===i)return Yi.default.clone(e,r);var n=tl.a.computeOptions(e,t,i,0,ol,bl),o=n.height,s=n.width,l=vl;return tl.a.computePosition(n,a,!1,0,0,l[0]),tl.a.computePosition(n,a,!1,0,s-1,l[1]),tl.a.computePosition(n,a,!1,o-1,0,l[2]),tl.a.computePosition(n,a,!1,o-1,s-1,l[3]),Yi.default.fromCartesianArray(l,a,r)}function wl(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).rectangle,i=Object(o.default)(e.height,0),a=Object(o.default)(e.extrudedHeight,i);this._rectangle=Yi.default.clone(t),this._granularity=Object(o.default)(e.granularity,Ne.default.RADIANS_PER_DEGREE),this._ellipsoid=tt.default.clone(Object(o.default)(e.ellipsoid,tt.default.WGS84)),this._surfaceHeight=Math.max(i,a),this._rotation=Object(o.default)(e.rotation,0),this._stRotation=Object(o.default)(e.stRotation,0),this._vertexFormat=J.default.clone(Object(o.default)(e.vertexFormat,J.default.DEFAULT)),this._extrudedHeight=Math.min(i,a),this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=e.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}wl.packedLength=Yi.default.packedLength+tt.default.packedLength+J.default.packedLength+7,wl.pack=function(e,t,i){return i=Object(o.default)(i,0),Yi.default.pack(e._rectangle,t,i),i+=Yi.default.packedLength,tt.default.pack(e._ellipsoid,t,i),i+=tt.default.packedLength,J.default.pack(e._vertexFormat,t,i),i+=J.default.packedLength,t[i++]=e._granularity,t[i++]=e._surfaceHeight,t[i++]=e._rotation,t[i++]=e._stRotation,t[i++]=e._extrudedHeight,t[i++]=e._shadowVolume?1:0,t[i]=Object(o.default)(e._offsetAttribute,-1),t};var xl=new Yi.default,El=tt.default.clone(tt.default.UNIT_SPHERE),Tl={rectangle:xl,ellipsoid:El,vertexFormat:_l,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};wl.unpack=function(e,t,i){t=Object(o.default)(t,0);var a=Yi.default.unpack(e,t,xl);t+=Yi.default.packedLength;var r=tt.default.unpack(e,t,El);t+=tt.default.packedLength;var n=J.default.unpack(e,t,_l);t+=J.default.packedLength;var l=e[t++],u=e[t++],d=e[t++],f=e[t++],c=e[t++],h=1===e[t++],p=e[t];return Object(s.default)(i)?(i._rectangle=Yi.default.clone(a,i._rectangle),i._ellipsoid=tt.default.clone(r,i._ellipsoid),i._vertexFormat=J.default.clone(n,i._vertexFormat),i._granularity=l,i._surfaceHeight=u,i._rotation=d,i._stRotation=f,i._extrudedHeight=c,i._shadowVolume=h,i._offsetAttribute=-1===p?void 0:p,i):(Tl.granularity=l,Tl.height=u,Tl.rotation=d,Tl.stRotation=f,Tl.extrudedHeight=c,Tl.shadowVolume=h,Tl.offsetAttribute=-1===p?void 0:p,new wl(Tl))},wl.computeRectangle=function(e,t){var i=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).rectangle,a=Object(o.default)(e.granularity,Ne.default.RADIANS_PER_DEGREE),r=Object(o.default)(e.ellipsoid,tt.default.WGS84);return Ol(i,a,Object(o.default)(e.rotation,0),r,t)};var Cl=new et.default,Al=new Dt.default,jl=new Re.default;wl.createGeometry=function(e){if(!Ne.default.equalsEpsilon(e._rectangle.north,e._rectangle.south,Ne.default.EPSILON10)&&!Ne.default.equalsEpsilon(e._rectangle.east,e._rectangle.west,Ne.default.EPSILON10)){var t=e._rectangle,i=e._ellipsoid,a=e._rotation,n=e._stRotation,o=e._vertexFormat,l=tl.a.computeOptions(t,e._granularity,a,n,ol,bl,yl),u=Cl;if(0!==n||0!==a){var d=Yi.default.center(t,jl),f=i.geodeticSurfaceNormalCartographic(d,fl);Dt.default.fromAxisAngle(f,-n,Al),et.default.fromQuaternion(Al,u)}else et.default.clone(et.default.IDENTITY,u);var c,h,p=e._surfaceHeight,m=e._extrudedHeight,_=!Ne.default.equalsEpsilon(p,m,0,Ne.default.EPSILON2);if(l.lonScalar=1/e._rectangle.width,l.latScalar=1/e._rectangle.height,l.tangentRotationMatrix=u,t=e._rectangle,_){c=gl(e,l);var g=r.default.fromRectangle3D(t,i,p,ul),v=r.default.fromRectangle3D(t,i,m,ll);h=r.default.union(g,v)}else{if((c=hl(e,l)).attributes.position.values=qi.a.scaleToGeodeticHeight(c.attributes.position.values,p,i,!1),Object(s.default)(e._offsetAttribute)){var b=c.attributes.position.values.length,y=new Uint8Array(b/3),O=e._offsetAttribute===fe.a.NONE?0:1;Object(Je.a)(y,O),c.attributes.applyOffset=new ki.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:y})}h=r.default.fromRectangle3D(t,i,p)}return o.position||delete c.attributes.position,new Hi.a({attributes:c.attributes,indices:c.indices,primitiveType:c.primitiveType,boundingSphere:h,offsetAttribute:e._offsetAttribute})}},wl.createShadowVolume=function(e,t,i){var a=e._granularity,r=e._ellipsoid,n=t(a,r),o=i(a,r);return new wl({rectangle:e._rectangle,rotation:e._rotation,ellipsoid:r,stRotation:e._stRotation,granularity:a,extrudedHeight:o,height:n,vertexFormat:J.default.POSITION_ONLY,shadowVolume:!0})};var Pl=new Yi.default,Sl=[new g.default,new g.default,new g.default],Il=new el.a,Ll=new Re.default;Object.defineProperties(wl.prototype,{rectangle:{get:function(){return Object(s.default)(this._rotatedRectangle)||(this._rotatedRectangle=Ol(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return Object(s.default)(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){if(0===e._stRotation)return[0,0,0,1,1,0];var t=Yi.default.clone(e._rectangle,Pl),i=e._granularity,a=e._ellipsoid,r=Ol(t,i,e._rotation-e._stRotation,a,Pl),n=Sl;n[0].x=r.west,n[0].y=r.south,n[1].x=r.west,n[1].y=r.north,n[2].x=r.east,n[2].y=r.south;for(var o=e.rectangle,s=el.a.fromRotation(e._stRotation,Il),l=Yi.default.center(o,Ll),u=0;u<3;++u){var d=n[u];d.x-=l.longitude,d.y-=l.latitude,el.a.multiplyByVector(s,d,d),d.x+=l.longitude,d.y+=l.latitude,d.x=(d.x-o.west)/o.width,d.y=(d.y-o.south)/o.height}var f=n[0],c=n[1],h=n[2],p=new Array(6);return g.default.pack(f,p),g.default.pack(c,p,2),g.default.pack(h,p,4),p}(this)),this._textureCoordinateRotationPoints}}});var Dl=wl,Ml=i(660),Rl=new b.default,Nl=v.default.ZERO,Vl=new v.default,Bl=new Yi.default,Ul=new Yi.default,Fl=new Re.default;function Hl(e){this.id=e,this.vertexFormat=void 0,this.rectangle=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.rotation=void 0,this.offsetAttribute=void 0}function kl(e,t){Ia.call(this,{entity:e,scene:t,geometryOptions:new Hl(e),geometryPropertyName:"rectangle",observedPropertyNames:["availability","rectangle"]}),this._onEntityPropertyChanged(e,"rectangle",e.rectangle,void 0)}function zl(e,t,i){ye.call(this,e,t,i)}Object(s.default)(Object.create)&&(kl.prototype=Object.create(Ia.prototype),kl.prototype.constructor=kl),kl.prototype.createFillGeometryInstance=function(e){var t,i=this._entity,a=i.isAvailable(e),r={show:new pe.a(a&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:ue.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof me.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(t=this._materialProperty.color.getValue(e,Rl)),Object(s.default)(t)||(t=b.default.WHITE),r.color=oe.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(r.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,Nl,Vl))),new de.a({id:i,geometry:new Dl(this._options),attributes:r})},kl.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,i=t.isAvailable(e),a=A.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,Rl),r=this._distanceDisplayConditionProperty.getValue(e),n={show:new pe.a(i&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(a),distanceDisplayCondition:ue.fromDistanceDisplayCondition(r),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(n.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,Nl,Vl))),new de.a({id:t,geometry:new Ml.a(this._options),attributes:n})},kl.prototype._computeCenter=function(e,t){var i=A.default.getValueOrUndefined(this._entity.rectangle.coordinates,e,Ul);if(Object(s.default)(i)){var a=Yi.default.center(i,Fl);return Re.default.toCartesian(a,tt.default.WGS84,t)}},kl.prototype._isHidden=function(e,t){return!Object(s.default)(t.coordinates)||De.prototype._isHidden.call(this,e,t)},kl.prototype._isDynamic=function(e,t){return!t.coordinates.isConstant||!A.default.isConstant(t.height)||!A.default.isConstant(t.extrudedHeight)||!A.default.isConstant(t.granularity)||!A.default.isConstant(t.stRotation)||!A.default.isConstant(t.rotation)||!A.default.isConstant(t.outlineWidth)||!A.default.isConstant(t.zIndex)||this._onTerrain&&!A.default.isConstant(this._materialProperty)&&!(this._materialProperty instanceof me.default)},kl.prototype._setStaticOptions=function(e,t){var i=this._materialProperty instanceof me.default,r=A.default.getValueOrUndefined(t.height,ce.default.MINIMUM_VALUE),n=A.default.getValueOrDefault(t.heightReference,ce.default.MINIMUM_VALUE,x.default.NONE),o=A.default.getValueOrUndefined(t.extrudedHeight,ce.default.MINIMUM_VALUE),l=A.default.getValueOrDefault(t.extrudedHeightReference,ce.default.MINIMUM_VALUE,x.default.NONE);Object(s.default)(o)&&!Object(s.default)(r)&&(r=0);var u=this._options;u.vertexFormat=i?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,u.rectangle=t.coordinates.getValue(ce.default.MINIMUM_VALUE,u.rectangle),u.granularity=A.default.getValueOrUndefined(t.granularity,ce.default.MINIMUM_VALUE),u.stRotation=A.default.getValueOrUndefined(t.stRotation,ce.default.MINIMUM_VALUE),u.rotation=A.default.getValueOrUndefined(t.rotation,ce.default.MINIMUM_VALUE),u.offsetAttribute=Ia.computeGeometryOffsetAttribute(r,n,o,l),u.height=Ia.getGeometryHeight(r,n),(o=Ia.getGeometryExtrudedHeight(o,l))===Ia.CLAMP_TO_GROUND&&(o=a.a.getMinimumMaximumHeights(Dl.computeRectangle(u,Bl)).minimumTerrainHeight),u.extrudedHeight=o},kl.DynamicGeometryUpdater=zl,Object(s.default)(Object.create)&&(zl.prototype=Object.create(ye.prototype),zl.prototype.constructor=zl),zl.prototype._isHidden=function(e,t,i){return!Object(s.default)(this._options.rectangle)||ye.prototype._isHidden.call(this,e,t,i)},zl.prototype._setOptions=function(e,t,i){var r=this._options,n=A.default.getValueOrUndefined(t.height,i),o=A.default.getValueOrDefault(t.heightReference,i,x.default.NONE),l=A.default.getValueOrUndefined(t.extrudedHeight,i),u=A.default.getValueOrDefault(t.extrudedHeightReference,i,x.default.NONE);Object(s.default)(l)&&!Object(s.default)(n)&&(n=0),r.rectangle=A.default.getValueOrUndefined(t.coordinates,i,r.rectangle),r.granularity=A.default.getValueOrUndefined(t.granularity,i),r.stRotation=A.default.getValueOrUndefined(t.stRotation,i),r.rotation=A.default.getValueOrUndefined(t.rotation,i),r.offsetAttribute=Ia.computeGeometryOffsetAttribute(n,o,l,u),r.height=Ia.getGeometryHeight(n,o),(l=Ia.getGeometryExtrudedHeight(l,u))===Ia.CLAMP_TO_GROUND&&(l=a.a.getMinimumMaximumHeights(Dl.computeRectangle(r,Bl)).minimumTerrainHeight),r.extrudedHeight=l};var Gl=kl,ql=new b.default,Wl=new O.a,Yl=new O.a,Kl=v.default.ZERO,Xl=new v.default;function Zl(e,t,i,a,r,n,o){var l;this.translucent=t,this.appearanceType=i,this.depthFailAppearanceType=a,this.depthFailMaterialProperty=r,this.depthFailMaterial=void 0,this.closed=n,this.shadows=o,this.primitives=e,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new m.default,this.updaters=new m.default,this.updatersWithAttributes=new m.default,this.attributes=new m.default,this.subscriptions=new m.default,this.showsUpdated=new m.default,this.itemsToRemove=[],this.invalidated=!1,Object(s.default)(r)&&(l=r.definitionChanged.addEventListener(Zl.prototype.onMaterialChanged,this)),this.removeMaterialSubscription=l}function Jl(e,t,i,a,r){this._solidItems=[],this._translucentItems=[],this._primitives=e,this._appearanceType=t,this._depthFailAppearanceType=i,this._closed=a,this._shadows=r}function Ql(e,t){for(var i=e.length-1;i>=0;i--){var a=e[i];if(a.remove(t))return 0===a.updaters.length&&(e.splice(i,1),a.destroy()),!0}return!1}function $l(e,t,i){for(var a=!1,r=t.length,n=0;n<r;++n){var o=t[n],s=o.itemsToRemove,l=s.length;if(l>0)for(n=0;n<l;n++){var u=s[n];o.remove(u),e.add(i,u),a=!0}}return a}function eu(e,t,i,a){var r,n=t.length;for(r=n-1;r>=0;r--){var o=t[r];if(o.invalidated){t.splice(r,1);for(var s=o.updaters.values,l=s.length,u=0;u<l;u++)e.add(i,s[u]);o.destroy()}}for(n=t.length,r=0;r<n;++r)a=t[r].update(i)&&a;return a}function tu(e,t,i){for(var a=e.length,r=0;r<a;r++){var n=e[r];if(n.contains(t))return n.getBoundingSphere(t,i)}return C.default.FAILED}function iu(e){for(var t=e.length,i=0;i<t;i++)e[i].destroy();e.length=0}Zl.prototype.onMaterialChanged=function(){this.invalidated=!0},Zl.prototype.isMaterial=function(e){var t=this.depthFailMaterialProperty,i=e.depthFailMaterialProperty;return i===t||!!Object(s.default)(t)&&t.equals(i)},Zl.prototype.add=function(e,t){var i=e.id;if(this.createPrimitive=!0,this.geometry.set(i,t),this.updaters.set(i,e),e.hasConstantFill&&e.fillMaterialProperty.isConstant&&A.default.isConstant(e.distanceDisplayConditionProperty)&&A.default.isConstant(e.terrainOffsetProperty)){var a=this;this.subscriptions.set(i,e.entity.definitionChanged.addEventListener((function(t,i,r,n){"isShowing"===i&&a.showsUpdated.set(e.id,e)})))}else this.updatersWithAttributes.set(i,e)},Zl.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var i=this.subscriptions.get(t);return Object(s.default)(i)&&(i(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1},Zl.prototype.update=function(e){var t,i=!0,a=0,r=this.primitive,n=this.primitives;if(this.createPrimitive){var o=this.geometry.values;if(o.length>0){var l;Object(s.default)(r)&&(Object(s.default)(this.oldPrimitive)?n.remove(r):this.oldPrimitive=r),Object(s.default)(this.depthFailAppearanceType)&&(Object(s.default)(this.depthFailMaterialProperty)&&(this.depthFailMaterial=ve.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial)),l=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.translucent,closed:this.closed})),r=new _e.a({show:!1,asynchronous:!0,geometryInstances:o.slice(),appearance:new this.appearanceType({translucent:this.translucent,closed:this.closed}),depthFailAppearance:l,shadows:this.shadows}),n.add(r),i=!1}else{Object(s.default)(r)&&(n.remove(r),r=void 0);var u=this.oldPrimitive;Object(s.default)(u)&&(n.remove(u),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=r,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(Object(s.default)(r)&&r.ready){r.show=!0,Object(s.default)(this.oldPrimitive)&&(n.remove(this.oldPrimitive),this.oldPrimitive=void 0),!Object(s.default)(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof me.default||(this.depthFailMaterial=ve.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);var d=this.updatersWithAttributes.values,f=d.length,c=this.waitingOnCreate;for(t=0;t<f;t++){var h=d[t],p=this.geometry.get(h.id),m=this.attributes.get(p.id.id);if(Object(s.default)(m)||(m=r.getGeometryInstanceAttributes(p.id),this.attributes.set(p.id.id,m)),!h.fillMaterialProperty.isConstant||c){var _=h.fillMaterialProperty.color,g=A.default.getValueOrDefault(_,e,b.default.WHITE,ql);b.default.equals(m._lastColor,g)||(m._lastColor=b.default.clone(g,m._lastColor),m.color=oe.a.toValue(g,m.color),(this.translucent&&255===m.color[3]||!this.translucent&&255!==m.color[3])&&(this.itemsToRemove[a++]=h))}if(Object(s.default)(this.depthFailAppearanceType)&&h.depthFailMaterialProperty instanceof me.default&&(!h.depthFailMaterialProperty.isConstant||c)){var y=h.depthFailMaterialProperty.color,w=A.default.getValueOrDefault(y,e,b.default.WHITE,ql);b.default.equals(m._lastDepthFailColor,w)||(m._lastDepthFailColor=b.default.clone(w,m._lastDepthFailColor),m.depthFailColor=oe.a.toValue(w,m.depthFailColor))}var x=h.entity.isShowing&&(h.hasConstantFill||h.isFilled(e));x!==(1===m.show[0])&&(m.show=pe.a.toValue(x,m.show));var E=h.distanceDisplayConditionProperty;if(!A.default.isConstant(E)){var T=A.default.getValueOrDefault(E,e,Yl,Wl);O.a.equals(T,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=O.a.clone(T,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=ue.toValue(T,m.distanceDisplayCondition))}var C=h.terrainOffsetProperty;if(!A.default.isConstant(C)){var j=A.default.getValueOrDefault(C,e,Kl,Xl);v.default.equals(j,m._lastOffset)||(m._lastOffset=v.default.clone(j,m._lastOffset),m.offset=he.a.toValue(j,m.offset))}}this.updateShows(r),this.waitingOnCreate=!1}else Object(s.default)(r)&&!r.ready&&(i=!1);return this.itemsToRemove.length=a,i},Zl.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,i=t.length,a=0;a<i;a++){var r=t[a],n=this.geometry.get(r.id),o=this.attributes.get(n.id.id);Object(s.default)(o)||(o=e.getGeometryInstanceAttributes(n.id),this.attributes.set(n.id.id,o));var l=r.entity.isShowing;l!==(1===o.show[0])&&(o.show=pe.a.toValue(l,o.show),n.attributes.show.value[0]=o.show[0])}this.showsUpdated.removeAll()},Zl.prototype.contains=function(e){return this.updaters.contains(e.id)},Zl.prototype.getBoundingSphere=function(e,t){var i=this.primitive;if(!i.ready)return C.default.PENDING;var a=i.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(a)||!Object(s.default)(a.boundingSphere)||Object(s.default)(a.show)&&0===a.show[0]?C.default.FAILED:(a.boundingSphere.clone(t),C.default.DONE)},Zl.prototype.destroy=function(){var e=this.primitive,t=this.primitives;Object(s.default)(e)&&t.remove(e);var i=this.oldPrimitive;Object(s.default)(i)&&t.remove(i),Object(s.default)(this.removeMaterialSubscription)&&this.removeMaterialSubscription()},Jl.prototype.add=function(e,t){var i,a,r=t.createFillGeometryInstance(e);255===r.attributes.color.value[3]?(i=this._solidItems,a=!1):(i=this._translucentItems,a=!0);for(var n=i.length,o=0;o<n;o++){var s=i[o];if(s.isMaterial(t))return void s.add(t,r)}var l=new Zl(this._primitives,a,this._appearanceType,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);l.add(t,r),i.push(l)},Jl.prototype.remove=function(e){Ql(this._solidItems,e)||Ql(this._translucentItems,e)},Jl.prototype.update=function(e){var t=eu(this,this._solidItems,e,!0);t=eu(this,this._translucentItems,e,t)&&t;var i=$l(this,this._solidItems,e),a=$l(this,this._translucentItems,e);return(i||a)&&(t=eu(this,this._solidItems,e,t)&&t,t=eu(this,this._translucentItems,e,t)&&t),t},Jl.prototype.getBoundingSphere=function(e,t){var i=tu(this._solidItems,e,t);return i===C.default.FAILED?tu(this._translucentItems,e,t):i},Jl.prototype.removeAllPrimitives=function(){iu(this._solidItems),iu(this._translucentItems)};var au=Jl,ru=new O.a,nu=new O.a,ou=v.default.ZERO,su=new v.default;function lu(e,t,i,a,r,n,o){this.primitives=e,this.appearanceType=t,this.materialProperty=i,this.depthFailAppearanceType=a,this.depthFailMaterialProperty=r,this.closed=n,this.shadows=o,this.updaters=new m.default,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new m.default,this.material=void 0,this.depthFailMaterial=void 0,this.updatersWithAttributes=new m.default,this.attributes=new m.default,this.invalidated=!1,this.removeMaterialSubscription=i.definitionChanged.addEventListener(lu.prototype.onMaterialChanged,this),this.subscriptions=new m.default,this.showsUpdated=new m.default}lu.prototype.onMaterialChanged=function(){this.invalidated=!0},lu.prototype.isMaterial=function(e){var t=this.materialProperty,i=e.fillMaterialProperty,a=this.depthFailMaterialProperty,r=e.depthFailMaterialProperty;if(i===t&&r===a)return!0;var n=Object(s.default)(t)&&t.equals(i);return n=(!Object(s.default)(a)&&!Object(s.default)(r)||Object(s.default)(a)&&a.equals(r))&&n},lu.prototype.add=function(e,t){var i=t.id;if(this.updaters.set(i,t),this.geometry.set(i,t.createFillGeometryInstance(e)),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&A.default.isConstant(t.distanceDisplayConditionProperty)&&A.default.isConstant(t.terrainOffsetProperty)){var a=this;this.subscriptions.set(i,t.entity.definitionChanged.addEventListener((function(e,i,r,n){"isShowing"===i&&a.showsUpdated.set(t.id,t)})))}else this.updatersWithAttributes.set(i,t);this.createPrimitive=!0},lu.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var i=this.subscriptions.get(t);return Object(s.default)(i)&&(i(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1};var uu=new b.default;function du(e,t,i,a,r){this._items=[],this._primitives=e,this._appearanceType=t,this._depthFailAppearanceType=i,this._closed=a,this._shadows=r}lu.prototype.update=function(e){var t,i=!0,a=this.primitive,r=this.primitives,n=this.geometry.values;if(this.createPrimitive){if(n.length>0){var o;Object(s.default)(a)&&(Object(s.default)(this.oldPrimitive)?r.remove(a):this.oldPrimitive=a),this.material=ve.getValue(e,this.materialProperty,this.material),Object(s.default)(this.depthFailMaterialProperty)&&(this.depthFailMaterial=ve.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),o=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.depthFailMaterial.isTranslucent(),closed:this.closed})),a=new _e.a({show:!1,asynchronous:!0,geometryInstances:n.slice(),appearance:new this.appearanceType({material:this.material,translucent:this.material.isTranslucent(),closed:this.closed}),depthFailAppearance:o,shadows:this.shadows}),r.add(a),i=!1}else{Object(s.default)(a)&&(r.remove(a),a=void 0);var l=this.oldPrimitive;Object(s.default)(l)&&(r.remove(l),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=a,this.createPrimitive=!1}else if(Object(s.default)(a)&&a.ready){a.show=!0,Object(s.default)(this.oldPrimitive)&&(r.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.material=ve.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material,!Object(s.default)(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof me.default||(this.depthFailMaterial=ve.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);var u=this.updatersWithAttributes.values,d=u.length;for(t=0;t<d;t++){var f=u[t],c=f.entity,h=this.geometry.get(f.id),p=this.attributes.get(h.id.id);if(Object(s.default)(p)||(p=a.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,p)),Object(s.default)(this.depthFailAppearanceType)&&this.depthFailMaterialProperty instanceof me.default&&!f.depthFailMaterialProperty.isConstant){var m=f.depthFailMaterialProperty.color,_=A.default.getValueOrDefault(m,e,b.default.WHITE,uu);b.default.equals(p._lastDepthFailColor,_)||(p._lastDepthFailColor=b.default.clone(_,p._lastDepthFailColor),p.depthFailColor=oe.a.toValue(_,p.depthFailColor))}var g=c.isShowing&&(f.hasConstantFill||f.isFilled(e));g!==(1===p.show[0])&&(p.show=pe.a.toValue(g,p.show));var y=f.distanceDisplayConditionProperty;if(!A.default.isConstant(y)){var w=A.default.getValueOrDefault(y,e,nu,ru);O.a.equals(w,p._lastDistanceDisplayCondition)||(p._lastDistanceDisplayCondition=O.a.clone(w,p._lastDistanceDisplayCondition),p.distanceDisplayCondition=ue.toValue(w,p.distanceDisplayCondition))}var x=f.terrainOffsetProperty;if(!A.default.isConstant(x)){var E=A.default.getValueOrDefault(x,e,ou,su);v.default.equals(E,p._lastOffset)||(p._lastOffset=v.default.clone(E,p._lastOffset),p.offset=he.a.toValue(E,p.offset))}}this.updateShows(a)}else Object(s.default)(a)&&!a.ready&&(i=!1);return i},lu.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,i=t.length,a=0;a<i;a++){var r=t[a],n=r.entity,o=this.geometry.get(r.id),l=this.attributes.get(o.id.id);Object(s.default)(l)||(l=e.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,l));var u=n.isShowing;u!==(1===l.show[0])&&(l.show=pe.a.toValue(u,l.show),o.attributes.show.value[0]=l.show[0])}this.showsUpdated.removeAll()},lu.prototype.contains=function(e){return this.updaters.contains(e.id)},lu.prototype.getBoundingSphere=function(e,t){var i=this.primitive;if(!i.ready)return C.default.PENDING;var a=i.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(a)||!Object(s.default)(a.boundingSphere)||Object(s.default)(a.show)&&0===a.show[0]?C.default.FAILED:(a.boundingSphere.clone(t),C.default.DONE)},lu.prototype.destroy=function(){var e=this.primitive,t=this.primitives;Object(s.default)(e)&&t.remove(e);var i=this.oldPrimitive;Object(s.default)(i)&&t.remove(i),this.removeMaterialSubscription()},du.prototype.add=function(e,t){for(var i=this._items,a=i.length,r=0;r<a;r++){var n=i[r];if(n.isMaterial(t))return void n.add(e,t)}var o=new lu(this._primitives,this._appearanceType,t.fillMaterialProperty,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);o.add(e,t),i.push(o)},du.prototype.remove=function(e){for(var t=this._items,i=t.length-1;i>=0;i--){var a=t[i];if(a.remove(e)){0===a.updaters.length&&(t.splice(i,1),a.destroy());break}}},du.prototype.update=function(e){var t,i=this._items;for(t=i.length-1;t>=0;t--){var a=i[t];if(a.invalidated){i.splice(t,1);for(var r=a.updaters.values,n=r.length,o=0;o<n;o++)this.add(e,r[o]);a.destroy()}}var s=!0;for(t=0;t<i.length;t++)s=i[t].update(e)&&s;return s},du.prototype.getBoundingSphere=function(e,t){for(var i=this._items,a=i.length,r=0;r<a;r++){var n=i[r];if(n.contains(e))return n.getBoundingSphere(e,t)}return C.default.FAILED},du.prototype.removeAllPrimitives=function(){for(var e=this._items,t=e.length,i=0;i<t;i++)e[i].destroy();this._items.length=0};var fu=du;function cu(e,t,i){var a=e[t];e[t]=e[i],e[i]=a}function hu(e,t){return e<t?-1:e>t?1:0}var pu=function(e,t,i,a,r){!function e(t,i,a,r,n){for(;r>a;){if(r-a>600){var o=r-a+1,s=i-a+1,l=Math.log(o),u=.5*Math.exp(2*l/3),d=.5*Math.sqrt(l*u*(o-u)/o)*(s-o/2<0?-1:1),f=Math.max(a,Math.floor(i-s*u/o+d)),c=Math.min(r,Math.floor(i+(o-s)*u/o+d));e(t,i,f,c,n)}var h=t[i],p=a,m=r;for(cu(t,a,i),n(t[r],h)>0&&cu(t,a,r);p<m;){for(cu(t,p,m),p++,m--;n(t[p],h)<0;)p++;for(;n(t[m],h)>0;)m--}0===n(t[a],h)?cu(t,a,m):(m++,cu(t,m,r)),m<=i&&(a=m+1),i<=m&&(r=m-1)}}(e,t,i||0,a||e.length-1,r||hu)};function mu(e,t){if(!(this instanceof mu))return new mu(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&this._initFormat(t),this.clear()}function _u(e,t,i){if(!i)return t.indexOf(e);for(var a=0;a<t.length;a++)if(i(e,t[a]))return a;return-1}function gu(e,t){vu(e,0,e.children.length,t,e)}function vu(e,t,i,a,r){r||(r=Cu(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var n,o=t;o<i;o++)n=e.children[o],bu(r,e.leaf?a(n):n);return r}function bu(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function yu(e,t){return e.minX-t.minX}function Ou(e,t){return e.minY-t.minY}function wu(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function xu(e){return e.maxX-e.minX+(e.maxY-e.minY)}function Eu(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function Tu(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function Cu(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Au(e,t,i,a,r){for(var n,o=[t,i];o.length;)(i=o.pop())-(t=o.pop())<=a||(n=t+Math.ceil((i-t)/a/2)*a,pu(e,n,t,i,r),o.push(t,n,n,i))}mu.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,i=[],a=this.toBBox;if(!Tu(e,t))return i;for(var r,n,o,s,l=[];t;){for(r=0,n=t.children.length;r<n;r++)o=t.children[r],Tu(e,s=t.leaf?a(o):o)&&(t.leaf?i.push(o):Eu(e,s)?this._all(o,i):l.push(o));t=l.pop()}return i},collides:function(e){var t=this.data,i=this.toBBox;if(!Tu(e,t))return!1;for(var a,r,n,o,s=[];t;){for(a=0,r=t.children.length;a<r;a++)if(n=t.children[a],Tu(e,o=t.leaf?i(n):n)){if(t.leaf||Eu(e,o))return!0;s.push(n)}t=s.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}var a=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===a.height)this._splitRoot(this.data,a);else{if(this.data.height<a.height){var r=this.data;this.data=a,a=r}this._insert(a,this.data.height-a.height-1,!0)}else this.data=a;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=Cu([]),this},remove:function(e,t){if(!e)return this;for(var i,a,r,n,o=this.data,s=this.toBBox(e),l=[],u=[];o||l.length;){if(o||(o=l.pop(),a=l[l.length-1],i=u.pop(),n=!0),o.leaf&&-1!==(r=_u(e,o.children,t)))return o.children.splice(r,1),l.push(o),this._condense(l),this;n||o.leaf||!Eu(o,s)?a?(i++,o=a.children[i],n=!1):o=null:(l.push(o),u.push(i),i=0,a=o,o=o.children[0])}return this},toBBox:function(e){return e},compareMinX:yu,compareMinY:Ou,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},_build:function(e,t,i,a){var r,n=i-t+1,o=this._maxEntries;if(n<=o)return gu(r=Cu(e.slice(t,i+1)),this.toBBox),r;a||(a=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,a-1))),(r=Cu([])).leaf=!1,r.height=a;var s,l,u,d,f=Math.ceil(n/o),c=f*Math.ceil(Math.sqrt(o));for(Au(e,t,i,c,this.compareMinX),s=t;s<=i;s+=c)for(Au(e,s,u=Math.min(s+c-1,i),f,this.compareMinY),l=s;l<=u;l+=f)d=Math.min(l+f-1,u),r.children.push(this._build(e,l,d,a-1));return gu(r,this.toBBox),r},_chooseSubtree:function(e,t,i,a){for(var r,n,o,s,l,u,d,f,c,h;a.push(t),!t.leaf&&a.length-1!==i;){for(d=f=1/0,r=0,n=t.children.length;r<n;r++)l=wu(o=t.children[r]),c=e,h=o,(u=(Math.max(h.maxX,c.maxX)-Math.min(h.minX,c.minX))*(Math.max(h.maxY,c.maxY)-Math.min(h.minY,c.minY))-l)<f?(f=u,d=l<d?l:d,s=o):u===f&&l<d&&(d=l,s=o);t=s||t.children[0]}return t},_insert:function(e,t,i){var a=this.toBBox,r=i?e:a(e),n=[],o=this._chooseSubtree(r,this.data,t,n);for(o.children.push(e),bu(o,r);t>=0&&n[t].children.length>this._maxEntries;)this._split(n,t),t--;this._adjustParentBBoxes(r,n,t)},_split:function(e,t){var i=e[t],a=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,a);var n=this._chooseSplitIndex(i,r,a),o=Cu(i.children.splice(n,i.children.length-n));o.height=i.height,o.leaf=i.leaf,gu(i,this.toBBox),gu(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(i,o)},_splitRoot:function(e,t){this.data=Cu([e,t]),this.data.height=e.height+1,this.data.leaf=!1,gu(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,i){var a,r,n,o,s,l,u,d,f,c,h,p,m,_;for(l=u=1/0,a=t;a<=i-t;a++)r=vu(e,0,a,this.toBBox),n=vu(e,a,i,this.toBBox),f=r,c=n,h=void 0,p=void 0,m=void 0,_=void 0,h=Math.max(f.minX,c.minX),p=Math.max(f.minY,c.minY),m=Math.min(f.maxX,c.maxX),_=Math.min(f.maxY,c.maxY),o=Math.max(0,m-h)*Math.max(0,_-p),s=wu(r)+wu(n),o<l?(l=o,d=a,u=s<u?s:u):o===l&&s<u&&(u=s,d=a);return d},_chooseSplitAxis:function(e,t,i){var a=e.leaf?this.compareMinX:yu,r=e.leaf?this.compareMinY:Ou;this._allDistMargin(e,t,i,a)<this._allDistMargin(e,t,i,r)&&e.children.sort(a)},_allDistMargin:function(e,t,i,a){e.children.sort(a);var r,n,o=this.toBBox,s=vu(e,0,t,o),l=vu(e,i-t,i,o),u=xu(s)+xu(l);for(r=t;r<i-t;r++)n=e.children[r],bu(s,e.leaf?o(n):n),u+=xu(s);for(r=i-t-1;r>=t;r--)n=e.children[r],bu(l,e.leaf?o(n):n),u+=xu(l);return u},_adjustParentBBoxes:function(e,t,i){for(var a=i;a>=0;a--)bu(t[a],e)},_condense:function(e){for(var t,i=e.length-1;i>=0;i--)0===e[i].children.length?i>0?(t=e[i-1].children).splice(t.indexOf(e[i]),1):this.clear():gu(e[i],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};var ju=mu;function Pu(){this._tree=ju()}function Su(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.id=""}function Iu(e,t){return e.id===t.id}Su.fromRectangleAndId=function(e,t,i){return i.minX=t.west,i.minY=t.south,i.maxX=t.east,i.maxY=t.north,i.id=e,i},Pu.prototype.insert=function(e,t){var i=Su.fromRectangleAndId(e,t,new Su);this._tree.insert(i)};var Lu=new Su;Pu.prototype.remove=function(e,t){var i=Su.fromRectangleAndId(e,t,Lu);this._tree.remove(i,Iu)};var Du=new Su;Pu.prototype.collides=function(e){var t=Su.fromRectangleAndId("",e,Du);return this._tree.collides(t)};var Mu=Pu,Ru=new b.default,Nu=new O.a,Vu=new O.a;function Bu(e,t,i,a){this.primitives=e,this.zIndex=a,this.classificationType=t,this.color=i,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new m.default,this.updaters=new m.default,this.updatersWithAttributes=new m.default,this.attributes=new m.default,this.subscriptions=new m.default,this.showsUpdated=new m.default,this.itemsToRemove=[],this.isDirty=!1,this.rectangleCollisionCheck=new Mu}function Uu(e,t){this._batches=[],this._primitives=e,this._classificationType=t}Bu.prototype.overlapping=function(e){return this.rectangleCollisionCheck.collides(e)},Bu.prototype.add=function(e,t){var i=e.id;if(this.createPrimitive=!0,this.geometry.set(i,t),this.updaters.set(i,e),this.rectangleCollisionCheck.insert(i,t.geometry.rectangle),e.hasConstantFill&&e.fillMaterialProperty.isConstant&&A.default.isConstant(e.distanceDisplayConditionProperty)){var a=this;this.subscriptions.set(i,e.entity.definitionChanged.addEventListener((function(t,i,r,n){"isShowing"===i&&a.showsUpdated.set(e.id,e)})))}else this.updatersWithAttributes.set(i,e)},Bu.prototype.remove=function(e){var t=e.id,i=this.geometry.get(t);if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.rectangleCollisionCheck.remove(t,i.geometry.rectangle),this.updatersWithAttributes.remove(t);var a=this.subscriptions.get(t);return Object(s.default)(a)&&(a(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1},Bu.prototype.update=function(e){var t,i=!0,a=this.primitive,r=this.primitives;if(this.createPrimitive){var n=this.geometry.values;if(n.length>0)Object(s.default)(a)&&(Object(s.default)(this.oldPrimitive)?r.remove(a):this.oldPrimitive=a),a=new f.a({show:!1,asynchronous:!0,geometryInstances:n.slice(),classificationType:this.classificationType}),r.add(a,this.zIndex),i=!1;else{Object(s.default)(a)&&(r.remove(a),a=void 0);var o=this.oldPrimitive;Object(s.default)(o)&&(r.remove(o),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=a,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(Object(s.default)(a)&&a.ready){a.show=!0,Object(s.default)(this.oldPrimitive)&&(r.remove(this.oldPrimitive),this.oldPrimitive=void 0);var l=this.updatersWithAttributes.values,u=l.length,d=this.waitingOnCreate;for(t=0;t<u;t++){var c=l[t],h=this.geometry.get(c.id),p=this.attributes.get(h.id.id);if(Object(s.default)(p)||(p=a.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,p)),!c.fillMaterialProperty.isConstant||d){var m=c.fillMaterialProperty.color,_=A.default.getValueOrDefault(m,e,b.default.WHITE,Ru);b.default.equals(p._lastColor,_)||(p._lastColor=b.default.clone(_,p._lastColor),p.color=oe.a.toValue(_,p.color))}var g=c.entity.isShowing&&(c.hasConstantFill||c.isFilled(e));g!==(1===p.show[0])&&(p.show=pe.a.toValue(g,p.show));var v=c.distanceDisplayConditionProperty;if(!A.default.isConstant(v)){var y=A.default.getValueOrDefault(v,e,Vu,Nu);O.a.equals(y,p._lastDistanceDisplayCondition)||(p._lastDistanceDisplayCondition=O.a.clone(y,p._lastDistanceDisplayCondition),p.distanceDisplayCondition=ue.toValue(y,p.distanceDisplayCondition))}}this.updateShows(a),this.waitingOnCreate=!1}else Object(s.default)(a)&&!a.ready&&(i=!1);return this.itemsToRemove.length=0,i},Bu.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,i=t.length,a=0;a<i;a++){var r=t[a],n=this.geometry.get(r.id),o=this.attributes.get(n.id.id);Object(s.default)(o)||(o=e.getGeometryInstanceAttributes(n.id),this.attributes.set(n.id.id,o));var l=r.entity.isShowing;l!==(1===o.show[0])&&(o.show=pe.a.toValue(l,o.show),n.attributes.show.value[0]=o.show[0])}this.showsUpdated.removeAll()},Bu.prototype.contains=function(e){return this.updaters.contains(e.id)},Bu.prototype.getBoundingSphere=function(e,t){var i=this.primitive;if(!i.ready)return C.default.PENDING;var a=i.getBoundingSphere(e.entity);return Object(s.default)(a)?(a.clone(t),C.default.DONE):C.default.FAILED},Bu.prototype.removeAllPrimitives=function(){var e=this.primitives,t=this.primitive;Object(s.default)(t)&&(e.remove(t),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());var i=this.oldPrimitive;Object(s.default)(i)&&(e.remove(i),this.oldPrimitive=void 0)},Uu.prototype.add=function(e,t){for(var i,a=t.createFillGeometryInstance(e),r=this._batches,n=A.default.getValueOrDefault(t.zIndex,0),o=r.length,l=0;l<o;++l){var u=r[l];if(u.zIndex===n&&!u.overlapping(a.geometry.rectangle)){i=u;break}}return Object(s.default)(i)||(i=new Bu(this._primitives,this._classificationType,a.attributes.color.value,n),r.push(i)),i.add(t,a),i},Uu.prototype.remove=function(e){for(var t=this._batches,i=t.length,a=0;a<i;++a)if(t[a].remove(e))return},Uu.prototype.update=function(e){var t,i,a=!0,r=this._batches,n=r.length;for(t=0;t<n;++t)a=r[t].update(e)&&a;for(t=0;t<n;++t)for(var o=r[t],s=o.itemsToRemove,l=s.length,u=0;u<l;u++){i=s[u],o.remove(i);var d=this.add(e,i);o.isDirty=!0,d.isDirty=!0}for(t=n-1;t>=0;--t){var f=r[t];f.isDirty&&(a=r[t].update(e)&&a,f.isDirty=!1),0===f.geometry.length&&r.splice(t,1)}return a},Uu.prototype.getBoundingSphere=function(e,t){for(var i=this._batches,a=i.length,r=0;r<a;++r){var n=i[r];if(n.contains(e))return n.getBoundingSphere(e,t)}return C.default.FAILED},Uu.prototype.removeAllPrimitives=function(){for(var e=this._batches,t=e.length,i=0;i<t;++i)e[i].removeAllPrimitives()};var Fu=Uu,Hu=i(244),ku=new O.a,zu=new O.a;function Gu(e,t,i,a,r,n){this.primitives=e,this.classificationType=t,this.appearanceType=i,this.materialProperty=a,this.updaters=new m.default,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new m.default,this.material=void 0,this.updatersWithAttributes=new m.default,this.attributes=new m.default,this.invalidated=!1,this.removeMaterialSubscription=a.definitionChanged.addEventListener(Gu.prototype.onMaterialChanged,this),this.subscriptions=new m.default,this.showsUpdated=new m.default,this.usingSphericalTextureCoordinates=r,this.zIndex=n,this.rectangleCollisionCheck=new Mu}function qu(e,t,i){this._items=[],this._primitives=e,this._classificationType=t,this._appearanceType=i}Gu.prototype.onMaterialChanged=function(){this.invalidated=!0},Gu.prototype.overlapping=function(e){return this.rectangleCollisionCheck.collides(e)},Gu.prototype.isMaterial=function(e){var t=this.materialProperty,i=e.fillMaterialProperty;return i===t||i instanceof me.default&&t instanceof me.default||Object(s.default)(t)&&t.equals(i)},Gu.prototype.add=function(e,t,i){var a=t.id;if(this.updaters.set(a,t),this.geometry.set(a,i),this.rectangleCollisionCheck.insert(a,i.geometry.rectangle),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&A.default.isConstant(t.distanceDisplayConditionProperty)){var r=this;this.subscriptions.set(a,t.entity.definitionChanged.addEventListener((function(e,i,a,n){"isShowing"===i&&r.showsUpdated.set(t.id,t)})))}else this.updatersWithAttributes.set(a,t);this.createPrimitive=!0},Gu.prototype.remove=function(e){var t=e.id,i=this.geometry.get(t);if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.rectangleCollisionCheck.remove(t,i.geometry.rectangle),this.updatersWithAttributes.remove(t);var a=this.subscriptions.get(t);return Object(s.default)(a)&&(a(),this.subscriptions.remove(t)),!0}return!1},Gu.prototype.update=function(e){var t,i=!0,a=this.primitive,r=this.primitives,n=this.geometry.values;if(this.createPrimitive){if(n.length>0)Object(s.default)(a)&&(Object(s.default)(this.oldPrimitive)?r.remove(a):this.oldPrimitive=a),this.material=ve.getValue(e,this.materialProperty,this.material),a=new f.a({show:!1,asynchronous:!0,geometryInstances:n.slice(),appearance:new this.appearanceType({material:this.material}),classificationType:this.classificationType}),r.add(a,this.zIndex),i=!1;else{Object(s.default)(a)&&(r.remove(a),a=void 0);var o=this.oldPrimitive;Object(s.default)(o)&&(r.remove(o),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=a,this.createPrimitive=!1}else if(Object(s.default)(a)&&a.ready){a.show=!0,Object(s.default)(this.oldPrimitive)&&(r.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.material=ve.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material;var l=this.updatersWithAttributes.values,u=l.length;for(t=0;t<u;t++){var d=l[t],c=d.entity,h=this.geometry.get(d.id),p=this.attributes.get(h.id.id);Object(s.default)(p)||(p=a.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,p));var m=c.isShowing&&(d.hasConstantFill||d.isFilled(e));m!==(1===p.show[0])&&(p.show=pe.a.toValue(m,p.show));var _=d.distanceDisplayConditionProperty;if(!A.default.isConstant(_)){var g=A.default.getValueOrDefault(_,e,zu,ku);O.a.equals(g,p._lastDistanceDisplayCondition)||(p._lastDistanceDisplayCondition=O.a.clone(g,p._lastDistanceDisplayCondition),p.distanceDisplayCondition=ue.toValue(g,p.distanceDisplayCondition))}}this.updateShows(a)}else Object(s.default)(a)&&!a.ready&&(i=!1);return i},Gu.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,i=t.length,a=0;a<i;a++){var r=t[a],n=r.entity,o=this.geometry.get(r.id),l=this.attributes.get(o.id.id);Object(s.default)(l)||(l=e.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,l));var u=n.isShowing;u!==(1===l.show[0])&&(l.show=pe.a.toValue(u,l.show),o.attributes.show.value[0]=l.show[0])}this.showsUpdated.removeAll()},Gu.prototype.contains=function(e){return this.updaters.contains(e.id)},Gu.prototype.getBoundingSphere=function(e,t){var i=this.primitive;if(!i.ready)return C.default.PENDING;var a=i.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(a)||!Object(s.default)(a.boundingSphere)||Object(s.default)(a.show)&&0===a.show[0]?C.default.FAILED:(a.boundingSphere.clone(t),C.default.DONE)},Gu.prototype.destroy=function(){var e=this.primitive,t=this.primitives;Object(s.default)(e)&&t.remove(e);var i=this.oldPrimitive;Object(s.default)(i)&&t.remove(i),this.removeMaterialSubscription()},qu.prototype.add=function(e,t){for(var i=this._items,a=i.length,r=t.createFillGeometryInstance(e),n=Hu.a.shouldUseSphericalCoordinates(r.geometry.rectangle),o=A.default.getValueOrDefault(t.zIndex,0),s=0;s<a;++s){var l=i[s];if(l.isMaterial(t)&&l.usingSphericalTextureCoordinates===n&&l.zIndex===o&&!l.overlapping(r.geometry.rectangle))return void l.add(e,t,r)}var u=new Gu(this._primitives,this._classificationType,this._appearanceType,t.fillMaterialProperty,n,o);u.add(e,t,r),i.push(u)},qu.prototype.remove=function(e){for(var t=this._items,i=t.length-1;i>=0;i--){var a=t[i];if(a.remove(e)){0===a.updaters.length&&(t.splice(i,1),a.destroy());break}}},qu.prototype.update=function(e){var t,i=this._items;for(t=i.length-1;t>=0;t--){var a=i[t];if(a.invalidated){i.splice(t,1);for(var r=a.updaters.values,n=r.length,o=0;o<n;o++)this.add(e,r[o]);a.destroy()}}var s=!0;for(t=0;t<i.length;t++)s=i[t].update(e)&&s;return s},qu.prototype.getBoundingSphere=function(e,t){for(var i=this._items,a=i.length,r=0;r<a;r++){var n=i[r];if(n.contains(e))return n.getBoundingSphere(e,t)}return C.default.FAILED},qu.prototype.removeAllPrimitives=function(){for(var e=this._items,t=e.length,i=0;i<t;i++)e[i].destroy();this._items.length=0};var Wu=qu,Yu=new b.default,Ku=new O.a,Xu=new O.a,Zu=v.default.ZERO,Ju=new v.default;function Qu(e,t,i,a){this.translucent=t,this.width=i,this.shadows=a,this.primitives=e,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new m.default,this.updaters=new m.default,this.updatersWithAttributes=new m.default,this.attributes=new m.default,this.itemsToRemove=[],this.subscriptions=new m.default,this.showsUpdated=new m.default}function $u(e,t,i){this._primitives=e,this._scene=t,this._shadows=i,this._solidBatches=new m.default,this._translucentBatches=new m.default}Qu.prototype.add=function(e,t){var i=e.id;if(this.createPrimitive=!0,this.geometry.set(i,t),this.updaters.set(i,e),e.hasConstantOutline&&e.outlineColorProperty.isConstant&&A.default.isConstant(e.distanceDisplayConditionProperty)&&A.default.isConstant(e.terrainOffsetProperty)){var a=this;this.subscriptions.set(i,e.entity.definitionChanged.addEventListener((function(t,i,r,n){"isShowing"===i&&a.showsUpdated.set(e.id,e)})))}else this.updatersWithAttributes.set(i,e)},Qu.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var i=this.subscriptions.get(t);return Object(s.default)(i)&&(i(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1},Qu.prototype.update=function(e){var t,i=!0,a=0,r=this.primitive,n=this.primitives;if(this.createPrimitive){var o=this.geometry.values;if(o.length>0)Object(s.default)(r)&&(Object(s.default)(this.oldPrimitive)?n.remove(r):this.oldPrimitive=r),r=new _e.a({show:!1,asynchronous:!0,geometryInstances:o.slice(),appearance:new ie.a({flat:!0,translucent:this.translucent,renderState:{lineWidth:this.width}}),shadows:this.shadows}),n.add(r),i=!1;else{Object(s.default)(r)&&(n.remove(r),r=void 0);var l=this.oldPrimitive;Object(s.default)(l)&&(n.remove(l),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=r,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(Object(s.default)(r)&&r.ready){r.show=!0,Object(s.default)(this.oldPrimitive)&&(n.remove(this.oldPrimitive),this.oldPrimitive=void 0);var u=this.updatersWithAttributes.values,d=u.length,f=this.waitingOnCreate;for(t=0;t<d;t++){var c=u[t],h=this.geometry.get(c.id),p=this.attributes.get(h.id.id);if(Object(s.default)(p)||(p=r.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,p)),!c.outlineColorProperty.isConstant||f){var m=c.outlineColorProperty,_=A.default.getValueOrDefault(m,e,b.default.WHITE,Yu);b.default.equals(p._lastColor,_)||(p._lastColor=b.default.clone(_,p._lastColor),p.color=oe.a.toValue(_,p.color),(this.translucent&&255===p.color[3]||!this.translucent&&255!==p.color[3])&&(this.itemsToRemove[a++]=c))}var g=c.entity.isShowing&&(c.hasConstantOutline||c.isOutlineVisible(e));g!==(1===p.show[0])&&(p.show=pe.a.toValue(g,p.show));var y=c.distanceDisplayConditionProperty;if(!A.default.isConstant(y)){var w=A.default.getValueOrDefault(y,e,Xu,Ku);O.a.equals(w,p._lastDistanceDisplayCondition)||(p._lastDistanceDisplayCondition=O.a.clone(w,p._lastDistanceDisplayCondition),p.distanceDisplayCondition=ue.toValue(w,p.distanceDisplayCondition))}var x=c.terrainOffsetProperty;if(!A.default.isConstant(x)){var E=A.default.getValueOrDefault(x,e,Zu,Ju);v.default.equals(E,p._lastOffset)||(p._lastOffset=v.default.clone(E,p._lastOffset),p.offset=he.a.toValue(E,p.offset))}}this.updateShows(r),this.waitingOnCreate=!1}else Object(s.default)(r)&&!r.ready&&(i=!1);return this.itemsToRemove.length=a,i},Qu.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,i=t.length,a=0;a<i;a++){var r=t[a],n=this.geometry.get(r.id),o=this.attributes.get(n.id.id);Object(s.default)(o)||(o=e.getGeometryInstanceAttributes(n.id),this.attributes.set(n.id.id,o));var l=r.entity.isShowing;l!==(1===o.show[0])&&(o.show=pe.a.toValue(l,o.show),n.attributes.show.value[0]=o.show[0])}this.showsUpdated.removeAll()},Qu.prototype.contains=function(e){return this.updaters.contains(e.id)},Qu.prototype.getBoundingSphere=function(e,t){var i=this.primitive;if(!i.ready)return C.default.PENDING;var a=i.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(a)||!Object(s.default)(a.boundingSphere)||Object(s.default)(a.show)&&0===a.show[0]?C.default.FAILED:(a.boundingSphere.clone(t),C.default.DONE)},Qu.prototype.removeAllPrimitives=function(){var e=this.primitives,t=this.primitive;Object(s.default)(t)&&(e.remove(t),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());var i=this.oldPrimitive;Object(s.default)(i)&&(e.remove(i),this.oldPrimitive=void 0)},$u.prototype.add=function(e,t){var i,a,r=t.createOutlineGeometryInstance(e),n=this._scene.clampLineWidth(t.outlineWidth);255===r.attributes.color.value[3]?(a=(i=this._solidBatches).get(n),Object(s.default)(a)||(a=new Qu(this._primitives,!1,n,this._shadows),i.set(n,a)),a.add(t,r)):(a=(i=this._translucentBatches).get(n),Object(s.default)(a)||(a=new Qu(this._primitives,!0,n,this._shadows),i.set(n,a)),a.add(t,r))},$u.prototype.remove=function(e){var t,i=this._solidBatches.values,a=i.length;for(t=0;t<a;t++)if(i[t].remove(e))return;var r=this._translucentBatches.values,n=r.length;for(t=0;t<n;t++)if(r[t].remove(e))return},$u.prototype.update=function(e){var t,i,a,r,n,o=this._solidBatches.values,s=o.length,l=this._translucentBatches.values,u=l.length,d=!0,f=!1;do{for(f=!1,i=0;i<s;i++){d=(r=o[i]).update(e);var c=(n=r.itemsToRemove).length;if(c>0)for(f=!0,t=0;t<c;t++)a=n[t],r.remove(a),this.add(e,a)}for(i=0;i<u;i++){d=(r=l[i]).update(e);var h=(n=r.itemsToRemove).length;if(h>0)for(f=!0,t=0;t<h;t++)a=n[t],r.remove(a),this.add(e,a)}}while(f);return d},$u.prototype.getBoundingSphere=function(e,t){var i,a=this._solidBatches.values,r=a.length;for(i=0;i<r;i++){var n=a[i];if(n.contains(e))return n.getBoundingSphere(e,t)}var o=this._translucentBatches.values,s=o.length;for(i=0;i<s;i++){var l=o[i];if(l.contains(e))return l.getBoundingSphere(e,t)}return C.default.FAILED},$u.prototype.removeAllPrimitives=function(){var e,t=this._solidBatches.values,i=t.length;for(e=0;e<i;e++)t[e].removeAllPrimitives();var a=this._translucentBatches.values,r=a.length;for(e=0;e<r;e++)a[e].removeAllPrimitives()};var ed=$u,td={};function id(e,t){return Ne.default.equalsEpsilon(e.latitude,t.latitude,Ne.default.EPSILON14)&&Ne.default.equalsEpsilon(e.longitude,t.longitude,Ne.default.EPSILON14)}var ad=new Re.default,rd=new Re.default;var nd=new Array(2),od=new Array(2),sd={positions:void 0,height:void 0,granularity:void 0,ellipsoid:void 0};td.computePositions=function(e,t,i,a,r,n){var o=function(e,t,i,a){var r=t.length;if(!(r<2)){var n=Object(s.default)(a),o=Object(s.default)(i),l=!0,u=new Array(r),d=new Array(r),f=new Array(r),c=t[0];u[0]=c;var h=e.cartesianToCartographic(c,ad);o&&(h.height=i[0]),l=l&&h.height<=0,d[0]=h.height,f[0]=n?a[0]:0;for(var p=1,m=1;m<r;++m){var _=t[m],g=e.cartesianToCartographic(_,rd);o&&(g.height=i[m]),l=l&&g.height<=0,id(h,g)?h.height<g.height&&(d[p-1]=g.height):(u[p]=_,d[p]=g.height,f[p]=n?a[m]:0,Re.default.clone(g,h),++p)}if(!(l||p<2))return u.length=p,d.length=p,f.length=p,{positions:u,topHeights:d,bottomHeights:f}}}(e,t,i,a);if(Object(s.default)(o)){if(t=o.positions,i=o.topHeights,a=o.bottomHeights,t.length>=3){var l=Lt.default.fromPoints(t,e).projectPointsOntoPlane(t);qi.a.computeWindingOrder2D(l)===Uo.default.CLOCKWISE&&(t.reverse(),i.reverse(),a.reverse())}var u,d,f=t.length,c=f-2,h=Ne.default.chordLength(r,e.maximumRadius),p=sd;if(p.minDistance=h,p.ellipsoid=e,n){var m,_=0;for(m=0;m<f-1;m++)_+=St.numberOfPoints(t[m],t[m+1],h)+1;u=new Float64Array(3*_),d=new Float64Array(3*_);var g=nd,v=od;p.positions=g,p.height=v;var b=0;for(m=0;m<f-1;m++){g[0]=t[m],g[1]=t[m+1],v[0]=i[m],v[1]=i[m+1];var y=St.generateArc(p);u.set(y,b),v[0]=a[m],v[1]=a[m+1],d.set(St.generateArc(p),b),b+=y.length}}else p.positions=t,p.height=i,u=new Float64Array(St.generateArc(p)),p.height=a,d=new Float64Array(St.generateArc(p));return{bottomPositions:d,topPositions:u,numCorners:c}}};var ld=td,ud=new v.default,dd=new v.default,fd=new v.default,cd=new v.default,hd=new v.default,pd=new v.default,md=new v.default,_d=new v.default;function gd(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,i=e.maximumHeights,a=e.minimumHeights,r=Object(o.default)(e.vertexFormat,J.default.DEFAULT),n=Object(o.default)(e.granularity,Ne.default.RADIANS_PER_DEGREE),l=Object(o.default)(e.ellipsoid,tt.default.WGS84);this._positions=t,this._minimumHeights=a,this._maximumHeights=i,this._vertexFormat=J.default.clone(r),this._granularity=n,this._ellipsoid=tt.default.clone(l),this._workerName="createWallGeometry";var u=1+t.length*v.default.packedLength+2;Object(s.default)(a)&&(u+=a.length),Object(s.default)(i)&&(u+=i.length),this.packedLength=u+tt.default.packedLength+J.default.packedLength+1}gd.pack=function(e,t,i){var a;i=Object(o.default)(i,0);var r=e._positions,n=r.length;for(t[i++]=n,a=0;a<n;++a,i+=v.default.packedLength)v.default.pack(r[a],t,i);var l=e._minimumHeights;if(n=Object(s.default)(l)?l.length:0,t[i++]=n,Object(s.default)(l))for(a=0;a<n;++a)t[i++]=l[a];var u=e._maximumHeights;if(n=Object(s.default)(u)?u.length:0,t[i++]=n,Object(s.default)(u))for(a=0;a<n;++a)t[i++]=u[a];return tt.default.pack(e._ellipsoid,t,i),i+=tt.default.packedLength,J.default.pack(e._vertexFormat,t,i),t[i+=J.default.packedLength]=e._granularity,t};var vd=tt.default.clone(tt.default.UNIT_SPHERE),bd=new J.default,yd={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:vd,vertexFormat:bd,granularity:void 0};gd.unpack=function(e,t,i){var a;t=Object(o.default)(t,0);var r,n,l=e[t++],u=new Array(l);for(a=0;a<l;++a,t+=v.default.packedLength)u[a]=v.default.unpack(e,t);if((l=e[t++])>0)for(r=new Array(l),a=0;a<l;++a)r[a]=e[t++];if((l=e[t++])>0)for(n=new Array(l),a=0;a<l;++a)n[a]=e[t++];var d=tt.default.unpack(e,t,vd);t+=tt.default.packedLength;var f=J.default.unpack(e,t,bd),c=e[t+=J.default.packedLength];return Object(s.default)(i)?(i._positions=u,i._minimumHeights=r,i._maximumHeights=n,i._ellipsoid=tt.default.clone(d,i._ellipsoid),i._vertexFormat=J.default.clone(f,i._vertexFormat),i._granularity=c,i):(yd.positions=u,yd.minimumHeights=r,yd.maximumHeights=n,yd.granularity=c,new gd(yd))},gd.fromConstantHeights=function(e){var t,i,a=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,r=e.minimumHeight,n=e.maximumHeight,l=Object(s.default)(r),u=Object(s.default)(n);if(l||u){var d=a.length;t=l?new Array(d):void 0,i=u?new Array(d):void 0;for(var f=0;f<d;++f)l&&(t[f]=r),u&&(i[f]=n)}return new gd({positions:a,maximumHeights:i,minimumHeights:t,ellipsoid:e.ellipsoid,vertexFormat:e.vertexFormat})},gd.createGeometry=function(e){var t=e._positions,i=e._minimumHeights,a=e._maximumHeights,n=e._vertexFormat,o=e._granularity,l=e._ellipsoid,u=ld.computePositions(l,t,a,i,o,!0);if(Object(s.default)(u)){var d,f=u.bottomPositions,c=u.topPositions,h=u.numCorners,p=c.length,m=2*p,_=n.position?new Float64Array(m):void 0,g=n.normal?new Float32Array(m):void 0,b=n.tangent?new Float32Array(m):void 0,y=n.bitangent?new Float32Array(m):void 0,O=n.st?new Float32Array(m/3*2):void 0,w=0,x=0,E=0,T=0,C=0,A=_d,j=md,P=pd,S=!0,I=0,L=1/((p/=3)-t.length+1);for(d=0;d<p;++d){var D=3*d,M=v.default.fromArray(c,D,ud),R=v.default.fromArray(f,D,dd);if(n.position&&(_[w++]=R.x,_[w++]=R.y,_[w++]=R.z,_[w++]=M.x,_[w++]=M.y,_[w++]=M.z),n.st&&(O[C++]=I,O[C++]=0,O[C++]=I,O[C++]=1),n.normal||n.tangent||n.bitangent){var N,V=v.default.clone(v.default.ZERO,hd),B=l.scaleToGeodeticSurface(v.default.fromArray(c,D,dd),dd);if(d+1<p&&(N=l.scaleToGeodeticSurface(v.default.fromArray(c,D+3,fd),fd),V=v.default.fromArray(c,D+3,hd)),S){var U=v.default.subtract(V,M,cd),F=v.default.subtract(B,M,ud);A=v.default.normalize(v.default.cross(F,U,A),A),S=!1}v.default.equalsEpsilon(N,B,Ne.default.EPSILON10)?S=!0:(I+=L,n.tangent&&(j=v.default.normalize(v.default.subtract(N,B,j),j)),n.bitangent&&(P=v.default.normalize(v.default.cross(A,j,P),P))),n.normal&&(g[x++]=A.x,g[x++]=A.y,g[x++]=A.z,g[x++]=A.x,g[x++]=A.y,g[x++]=A.z),n.tangent&&(b[T++]=j.x,b[T++]=j.y,b[T++]=j.z,b[T++]=j.x,b[T++]=j.y,b[T++]=j.z),n.bitangent&&(y[E++]=P.x,y[E++]=P.y,y[E++]=P.z,y[E++]=P.x,y[E++]=P.y,y[E++]=P.z)}}var H=new zi.a;n.position&&(H.position=new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:_})),n.normal&&(H.normal=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:g})),n.tangent&&(H.tangent=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:b})),n.bitangent&&(H.bitangent=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:y})),n.st&&(H.st=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:O}));var k=m/3;m-=6*(h+1);var z=Gi.a.createTypedArray(k,m),G=0;for(d=0;d<k-2;d+=2){var q=d,W=d+2,Y=v.default.fromArray(_,3*q,ud),K=v.default.fromArray(_,3*W,dd);if(!v.default.equalsEpsilon(Y,K,Ne.default.EPSILON10)){var X=d+1,Z=d+3;z[G++]=X,z[G++]=q,z[G++]=Z,z[G++]=Z,z[G++]=q,z[G++]=W}}return new Hi.a({attributes:H,indices:z,primitiveType:Wi.a.TRIANGLES,boundingSphere:new r.default.fromVertices(_)})}};var Od=gd,wd=new v.default,xd=new v.default;function Ed(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,i=e.maximumHeights,a=e.minimumHeights,r=Object(o.default)(e.granularity,Ne.default.RADIANS_PER_DEGREE),n=Object(o.default)(e.ellipsoid,tt.default.WGS84);this._positions=t,this._minimumHeights=a,this._maximumHeights=i,this._granularity=r,this._ellipsoid=tt.default.clone(n),this._workerName="createWallOutlineGeometry";var l=1+t.length*v.default.packedLength+2;Object(s.default)(a)&&(l+=a.length),Object(s.default)(i)&&(l+=i.length),this.packedLength=l+tt.default.packedLength+1}Ed.pack=function(e,t,i){var a;i=Object(o.default)(i,0);var r=e._positions,n=r.length;for(t[i++]=n,a=0;a<n;++a,i+=v.default.packedLength)v.default.pack(r[a],t,i);var l=e._minimumHeights;if(n=Object(s.default)(l)?l.length:0,t[i++]=n,Object(s.default)(l))for(a=0;a<n;++a)t[i++]=l[a];var u=e._maximumHeights;if(n=Object(s.default)(u)?u.length:0,t[i++]=n,Object(s.default)(u))for(a=0;a<n;++a)t[i++]=u[a];return tt.default.pack(e._ellipsoid,t,i),t[i+=tt.default.packedLength]=e._granularity,t};var Td=tt.default.clone(tt.default.UNIT_SPHERE),Cd={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:Td,granularity:void 0};Ed.unpack=function(e,t,i){var a;t=Object(o.default)(t,0);var r,n,l=e[t++],u=new Array(l);for(a=0;a<l;++a,t+=v.default.packedLength)u[a]=v.default.unpack(e,t);if((l=e[t++])>0)for(r=new Array(l),a=0;a<l;++a)r[a]=e[t++];if((l=e[t++])>0)for(n=new Array(l),a=0;a<l;++a)n[a]=e[t++];var d=tt.default.unpack(e,t,Td),f=e[t+=tt.default.packedLength];return Object(s.default)(i)?(i._positions=u,i._minimumHeights=r,i._maximumHeights=n,i._ellipsoid=tt.default.clone(d,i._ellipsoid),i._granularity=f,i):(Cd.positions=u,Cd.minimumHeights=r,Cd.maximumHeights=n,Cd.granularity=f,new Ed(Cd))},Ed.fromConstantHeights=function(e){var t,i,a=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,r=e.minimumHeight,n=e.maximumHeight,l=Object(s.default)(r),u=Object(s.default)(n);if(l||u){var d=a.length;t=l?new Array(d):void 0,i=u?new Array(d):void 0;for(var f=0;f<d;++f)l&&(t[f]=r),u&&(i[f]=n)}return new Ed({positions:a,maximumHeights:i,minimumHeights:t,ellipsoid:e.ellipsoid})},Ed.createGeometry=function(e){var t=e._positions,i=e._minimumHeights,a=e._maximumHeights,n=e._granularity,o=e._ellipsoid,l=ld.computePositions(o,t,a,i,n,!1);if(Object(s.default)(l)){var u,d=l.bottomPositions,f=l.topPositions,c=f.length,h=2*c,p=new Float64Array(h),m=0;for(c/=3,u=0;u<c;++u){var _=3*u,g=v.default.fromArray(f,_,wd),b=v.default.fromArray(d,_,xd);p[m++]=b.x,p[m++]=b.y,p[m++]=b.z,p[m++]=g.x,p[m++]=g.y,p[m++]=g.z}var y=new zi.a({position:new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:p})}),O=h/3;h=2*O-4+O;var w=Gi.a.createTypedArray(O,h),x=0;for(u=0;u<O-2;u+=2){var E=u,T=u+2,C=v.default.fromArray(p,3*E,wd),A=v.default.fromArray(p,3*T,xd);if(!v.default.equalsEpsilon(C,A,Ne.default.EPSILON10)){var j=u+1,P=u+3;w[x++]=j,w[x++]=E,w[x++]=j,w[x++]=P,w[x++]=E,w[x++]=T}}return w[x++]=O-2,w[x++]=O-1,new Hi.a({attributes:y,indices:w,primitiveType:Wi.a.LINES,boundingSphere:new r.default.fromVertices(p)})}};var Ad=Ed,jd=new b.default;function Pd(e){this.id=e,this.vertexFormat=void 0,this.positions=void 0,this.minimumHeights=void 0,this.maximumHeights=void 0,this.granularity=void 0}function Sd(e,t){De.call(this,{entity:e,scene:t,geometryOptions:new Pd(e),geometryPropertyName:"wall",observedPropertyNames:["availability","wall"]}),this._onEntityPropertyChanged(e,"wall",e.wall,void 0)}function Id(e,t,i){ye.call(this,e,t,i)}Object(s.default)(Object.create)&&(Sd.prototype=Object.create(De.prototype),Sd.prototype.constructor=Sd),Sd.prototype.createFillGeometryInstance=function(e){var t,i,a=this._entity,r=a.isAvailable(e),n=new pe.a(r&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),l=ue.fromDistanceDisplayCondition(o);this._materialProperty instanceof me.default?(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(i=this._materialProperty.color.getValue(e,jd)),Object(s.default)(i)||(i=b.default.WHITE),t={show:n,distanceDisplayCondition:l,color:oe.a.fromColor(i)}):t={show:n,distanceDisplayCondition:l};return new de.a({id:a,geometry:new Od(this._options),attributes:t})},Sd.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,i=t.isAvailable(e),a=A.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,jd),r=this._distanceDisplayConditionProperty.getValue(e);return new de.a({id:t,geometry:new Ad(this._options),attributes:{show:new pe.a(i&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(a),distanceDisplayCondition:ue.fromDistanceDisplayCondition(r)}})},Sd.prototype._isHidden=function(e,t){return!Object(s.default)(t.positions)||De.prototype._isHidden.call(this,e,t)},Sd.prototype._getIsClosed=function(e){return!1},Sd.prototype._isDynamic=function(e,t){return!(t.positions.isConstant&&A.default.isConstant(t.minimumHeights)&&A.default.isConstant(t.maximumHeights)&&A.default.isConstant(t.outlineWidth)&&A.default.isConstant(t.granularity))},Sd.prototype._setStaticOptions=function(e,t){var i=t.minimumHeights,a=t.maximumHeights,r=t.granularity,n=this._materialProperty instanceof me.default,o=this._options;o.vertexFormat=n?ie.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,o.positions=t.positions.getValue(ce.default.MINIMUM_VALUE,o.positions),o.minimumHeights=Object(s.default)(i)?i.getValue(ce.default.MINIMUM_VALUE,o.minimumHeights):void 0,o.maximumHeights=Object(s.default)(a)?a.getValue(ce.default.MINIMUM_VALUE,o.maximumHeights):void 0,o.granularity=Object(s.default)(r)?r.getValue(ce.default.MINIMUM_VALUE):void 0},Sd.DynamicGeometryUpdater=Id,Object(s.default)(Object.create)&&(Id.prototype=Object.create(ye.prototype),Id.prototype.constructor=Id),Id.prototype._isHidden=function(e,t,i){return!Object(s.default)(this._options.positions)||ye.prototype._isHidden.call(this,e,t,i)},Id.prototype._setOptions=function(e,t,i){var a=this._options;a.positions=A.default.getValueOrUndefined(t.positions,i,a.positions),a.minimumHeights=A.default.getValueOrUndefined(t.minimumHeights,i,a.minimumHeights),a.maximumHeights=A.default.getValueOrUndefined(t.maximumHeights,i,a.maximumHeights),a.granularity=A.default.getValueOrUndefined(t.granularity,i)};var Ld=[],Dd=[Ze,ur,Ua,bn,Ln,io,Vs,$s,Gl,Sd];function Md(e,t){this.entity=e,this.scene=t;var i=new Array(Dd.length),a=new X.default;function r(e){a.raiseEvent(e)}for(var n=new u.default,o=0;o<i.length;o++){var s=new Dd[o](e,t);n.add(s.geometryChanged,r),i[o]=s}this.updaters=i,this.geometryChanged=a,this.eventHelper=n,this._removeEntitySubscription=e.definitionChanged.addEventListener(Md.prototype._onEntityPropertyChanged,this)}function Rd(e,t,i,a){i=Object(o.default)(i,e.primitives),a=Object(o.default)(a,e.groundPrimitives),this._scene=e,this._primitives=i,this._groundPrimitives=a,this._entityCollection=void 0,this._addedObjects=new m.default,this._removedObjects=new m.default,this._changedObjects=new m.default;var r=ae.a.NUMBER_OF_SHADOW_MODES;this._outlineBatches=new Array(2*r),this._closedColorBatches=new Array(2*r),this._closedMaterialBatches=new Array(2*r),this._openColorBatches=new Array(2*r),this._openMaterialBatches=new Array(2*r);var n,s=xe.default.supportsMaterialsforEntitiesOnTerrain(e);for(this._supportsMaterialsforEntitiesOnTerrain=s,n=0;n<r;++n)this._outlineBatches[n]=new ed(i,e,n,!1),this._outlineBatches[r+n]=new ed(i,e,n,!0),this._closedColorBatches[n]=new au(i,ie.a,void 0,!0,n,!0),this._closedColorBatches[r+n]=new au(i,ie.a,void 0,!0,n,!1),this._closedMaterialBatches[n]=new fu(i,te,void 0,!0,n,!0),this._closedMaterialBatches[r+n]=new fu(i,te,void 0,!0,n,!1),this._openColorBatches[n]=new au(i,ie.a,void 0,!1,n,!0),this._openColorBatches[r+n]=new au(i,ie.a,void 0,!1,n,!1),this._openMaterialBatches[n]=new fu(i,te,void 0,!1,n,!0),this._openMaterialBatches[r+n]=new fu(i,te,void 0,!1,n,!1);var l=Z.a.NUMBER_OF_CLASSIFICATION_TYPES,u=new Array(l),d=[];if(s)for(n=0;n<l;++n)d.push(new Wu(a,n,te)),u[n]=new Fu(a,n);else for(n=0;n<l;++n)u[n]=new Fu(a,n);this._groundColorBatches=u,this._groundMaterialBatches=d,this._dynamicBatch=new fr(i,a),this._batches=this._outlineBatches.concat(this._closedColorBatches,this._closedMaterialBatches,this._openColorBatches,this._openMaterialBatches,this._groundColorBatches,this._groundMaterialBatches,this._dynamicBatch),this._subscriptions=new m.default,this._updaterSets=new m.default,this._entityCollection=t,t.collectionChanged.addEventListener(Rd.prototype._onCollectionChanged,this),this._onCollectionChanged(t,t.values,Ld)}Md.prototype._onEntityPropertyChanged=function(e,t,i,a){for(var r=this.updaters,n=0;n<r.length;n++)r[n]._onEntityPropertyChanged(e,t,i,a)},Md.prototype.forEach=function(e){for(var t=this.updaters,i=0;i<t.length;i++)e(t[i])},Md.prototype.destroy=function(){this.eventHelper.removeAll();for(var e=this.updaters,t=0;t<e.length;t++)e[t].destroy();this._removeEntitySubscription(),Object(l.default)(this)},Rd.prototype.update=function(e){var t,i,a,r,n=this._addedObjects,o=n.values,s=this._removedObjects,l=s.values,u=this._changedObjects,d=u.values,f=this;for(t=d.length-1;t>-1;t--)a=(i=d[t]).id,(r=this._updaterSets.get(a)).entity===i?r.forEach((function(t){f._removeUpdater(t),f._insertUpdaterIntoBatch(e,t)})):(l.push(i),o.push(i));for(t=l.length-1;t>-1;t--)a=(i=l[t]).id,(r=this._updaterSets.get(a)).forEach(this._removeUpdater.bind(this)),r.destroy(),this._updaterSets.remove(a),this._subscriptions.get(a)(),this._subscriptions.remove(a);for(t=o.length-1;t>-1;t--)a=(i=o[t]).id,r=new Md(i,this._scene),this._updaterSets.set(a,r),r.forEach((function(t){f._insertUpdaterIntoBatch(e,t)})),this._subscriptions.set(a,r.geometryChanged.addEventListener(Rd._onGeometryChanged,this));n.removeAll(),s.removeAll(),u.removeAll();var c=!0,h=this._batches,p=h.length;for(t=0;t<p;t++)c=h[t].update(e)&&c;return c};var Nd=[],Vd=new r.default;Rd.prototype.getBoundingSphere=function(e,t){for(var i=Nd,a=Vd,n=0,o=C.default.DONE,s=this._batches,l=s.length,u=e.id,d=this._updaterSets.get(u).updaters,f=0;f<d.length;f++)for(var c=d[f],h=0;h<l;h++){if((o=s[h].getBoundingSphere(c,a))===C.default.PENDING)return C.default.PENDING;o===C.default.DONE&&(i[n]=r.default.clone(a,i[n]),n++)}return 0===n?C.default.FAILED:(i.length=n,r.default.fromBoundingSpheres(i,t),C.default.DONE)},Rd.prototype.isDestroyed=function(){return!1},Rd.prototype.destroy=function(){var e;this._entityCollection.collectionChanged.removeEventListener(Rd.prototype._onCollectionChanged,this),this._addedObjects.removeAll(),this._removedObjects.removeAll();var t=this._batches,i=t.length;for(e=0;e<i;e++)t[e].removeAllPrimitives();var a=this._subscriptions.values;for(i=a.length,e=0;e<i;e++)a[e]();this._subscriptions.removeAll();var r=this._updaterSets.values;for(i=r.length,e=0;e<i;e++)r[e].destroy();return this._updaterSets.removeAll(),Object(l.default)(this)},Rd.prototype._removeUpdater=function(e){for(var t=this._batches,i=t.length,a=0;a<i;a++)t[a].remove(e)},Rd.prototype._insertUpdaterIntoBatch=function(e,t){if(t.isDynamic)this._dynamicBatch.add(e,t);else{var i;(t.outlineEnabled||t.fillEnabled)&&(i=t.shadowsProperty.getValue(e));var a=ae.a.NUMBER_OF_SHADOW_MODES;if(t.outlineEnabled&&(Object(s.default)(t.terrainOffsetProperty)?this._outlineBatches[a+i].add(e,t):this._outlineBatches[i].add(e,t)),t.fillEnabled)if(t.onTerrain){var r=t.classificationTypeProperty.getValue(e);t.fillMaterialProperty instanceof me.default?this._groundColorBatches[r].add(e,t):this._groundMaterialBatches[r].add(e,t)}else t.isClosed?t.fillMaterialProperty instanceof me.default?Object(s.default)(t.terrainOffsetProperty)?this._closedColorBatches[a+i].add(e,t):this._closedColorBatches[i].add(e,t):Object(s.default)(t.terrainOffsetProperty)?this._closedMaterialBatches[a+i].add(e,t):this._closedMaterialBatches[i].add(e,t):t.fillMaterialProperty instanceof me.default?Object(s.default)(t.terrainOffsetProperty)?this._openColorBatches[a+i].add(e,t):this._openColorBatches[i].add(e,t):Object(s.default)(t.terrainOffsetProperty)?this._openMaterialBatches[a+i].add(e,t):this._openMaterialBatches[i].add(e,t)}},Rd._onGeometryChanged=function(e){var t=this._removedObjects,i=this._changedObjects,a=e.entity,r=a.id;Object(s.default)(t.get(r))||Object(s.default)(i.get(r))||i.set(r,a)},Rd.prototype._onCollectionChanged=function(e,t,i){var a,r,n,o=this._addedObjects,s=this._removedObjects,l=this._changedObjects;for(a=i.length-1;a>-1;a--)r=(n=i[a]).id,o.remove(r)||(s.set(r,n),l.remove(r));for(a=t.length-1;a>-1;a--)r=(n=t[a]).id,s.remove(r)?l.set(r,n):o.set(r,n)};var Bd=Rd,Ud=i(195),Fd=Ud.a.FILL,Hd=b.default.WHITE,kd=b.default.BLACK,zd=new b.default(.165,.165,.165,.8),Gd=new g.default(7,5),qd=g.default.ZERO,Wd=v.default.ZERO,Yd=x.default.NONE,Kd=E.default.CENTER,Xd=T.default.CENTER,Zd=new v.default,Jd=new b.default,Qd=new b.default,$d=new b.default,ef=new g.default,tf=new v.default,af=new g.default,rf=new w.a,nf=new w.a,of=new w.a,sf=new O.a;function lf(e){this.entity=e,this.label=void 0,this.index=void 0}function uf(e,t){t.collectionChanged.addEventListener(uf.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new m.default,this._onCollectionChanged(t,t.values,[],[])}function df(e,t,i){Object(s.default)(e)&&(e.label=void 0,i.removeLabel(t))}uf.prototype.update=function(e){for(var t=this._items.values,i=this._cluster,a=0,r=t.length;a<r;a++){var n,o,l=t[a],u=l.entity,d=u._label,f=l.label,c=u.isShowing&&u.isAvailable(e)&&A.default.getValueOrDefault(d._show,e,!0);if(c&&(o=A.default.getValueOrUndefined(u._position,e,Zd),n=A.default.getValueOrUndefined(d._text,e),c=Object(s.default)(o)&&Object(s.default)(n)),c){A.default.isConstant(u._position)||(i._clusterDirty=!0);var h=!1,p=A.default.getValueOrDefault(d._heightReference,e,Yd);Object(s.default)(f)||((f=i.getLabel(u)).id=u,l.label=f,h=v.default.equals(f.position,o)&&f.heightReference===p),f.show=!0,f.position=o,f.text=n,f.scale=A.default.getValueOrDefault(d._scale,e,1),f.font=A.default.getValueOrDefault(d._font,e,"30px sans-serif"),f.style=A.default.getValueOrDefault(d._style,e,Fd),f.fillColor=A.default.getValueOrDefault(d._fillColor,e,Hd,Jd),f.outlineColor=A.default.getValueOrDefault(d._outlineColor,e,kd,Qd),f.outlineWidth=A.default.getValueOrDefault(d._outlineWidth,e,1),f.showBackground=A.default.getValueOrDefault(d._showBackground,e,!1),f.backgroundColor=A.default.getValueOrDefault(d._backgroundColor,e,zd,$d),f.backgroundPadding=A.default.getValueOrDefault(d._backgroundPadding,e,Gd,ef),f.pixelOffset=A.default.getValueOrDefault(d._pixelOffset,e,qd,af),f.eyeOffset=A.default.getValueOrDefault(d._eyeOffset,e,Wd,tf),f.heightReference=p,f.horizontalOrigin=A.default.getValueOrDefault(d._horizontalOrigin,e,Kd),f.verticalOrigin=A.default.getValueOrDefault(d._verticalOrigin,e,Xd),f.translucencyByDistance=A.default.getValueOrUndefined(d._translucencyByDistance,e,rf),f.pixelOffsetScaleByDistance=A.default.getValueOrUndefined(d._pixelOffsetScaleByDistance,e,nf),f.scaleByDistance=A.default.getValueOrUndefined(d._scaleByDistance,e,of),f.distanceDisplayCondition=A.default.getValueOrUndefined(d._distanceDisplayCondition,e,sf),f.disableDepthTestDistance=A.default.getValueOrUndefined(d._disableDepthTestDistance,e),h&&f._updateClamping()}else df(l,u,i)}return!0},uf.prototype.getBoundingSphere=function(e,t){var i=this._items.get(e.id);if(!Object(s.default)(i)||!Object(s.default)(i.label))return C.default.FAILED;var a=i.label;return t.center=v.default.clone(Object(o.default)(a._clampedPosition,a.position),t.center),t.radius=0,C.default.DONE},uf.prototype.isDestroyed=function(){return!1},uf.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(uf.prototype._onCollectionChanged,this);for(var e=this._entityCollection.values,t=0;t<e.length;t++)this._cluster.removeLabel(e[t]);return Object(l.default)(this)},uf.prototype._onCollectionChanged=function(e,t,i,a){var r,n,o=this._items,l=this._cluster;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._label)&&Object(s.default)(n._position)&&o.set(n.id,new lf(n));for(r=a.length-1;r>-1;r--)n=a[r],Object(s.default)(n._label)&&Object(s.default)(n._position)?o.contains(n.id)||o.set(n.id,new lf(n)):(df(o.get(n.id),n,l),o.remove(n.id));for(r=i.length-1;r>-1;r--)n=i[r],df(o.get(n.id),n,l),o.remove(n.id)};var ff=uf,cf={X:0,Y:1,Z:2,Y_UP_TO_Z_UP:nt.default.fromRotationTranslation(et.default.fromRotationX(Ne.default.PI_OVER_TWO)),Z_UP_TO_Y_UP:nt.default.fromRotationTranslation(et.default.fromRotationX(-Ne.default.PI_OVER_TWO)),X_UP_TO_Z_UP:nt.default.fromRotationTranslation(et.default.fromRotationY(-Ne.default.PI_OVER_TWO)),Z_UP_TO_X_UP:nt.default.fromRotationTranslation(et.default.fromRotationY(Ne.default.PI_OVER_TWO)),X_UP_TO_Y_UP:nt.default.fromRotationTranslation(et.default.fromRotationZ(Ne.default.PI_OVER_TWO)),Y_UP_TO_X_UP:nt.default.fromRotationTranslation(et.default.fromRotationZ(-Ne.default.PI_OVER_TWO)),fromName:function(e){return cf[e]}},hf=Object.freeze(cf),pf=i(27),mf=i(1704),_f=i(49),gf=i(57),vf=i(66),bf=i(71),yf=i(295),Of=i(541);var wf=function(e,t){return t=Object(o.default)(t,0),Object(Of.a)(e,t,Math.min(4,e.length))},xf=i(406),Ef=i(16);var Tf=function(e){var t,i=e.uint8Array,a=e.format,r=e.request,n=Object(o.default)(e.flipY,!1),l=new Blob([i],{type:a});return pf.default.supportsImageBitmapOptions().then((function(e){return e?Object(Ef.default)(pf.default.createImageBitmapFromBlob(l,{flipY:n,premultiplyAlpha:!1})):(t=window.URL.createObjectURL(l),new pf.default({url:t,request:r}).fetchImage({flipY:n}))})).then((function(e){return Object(s.default)(t)&&window.URL.revokeObjectURL(t),e})).otherwise((function(e){return Object(s.default)(t)&&window.URL.revokeObjectURL(t),Ef.default.reject(e)}))},Cf=i(297),Af=i(25),jf=i(8),Pf=i(105),Sf=i(43),If=i(45),Lf=i(28),Df=i(35),Mf=i(61),Rf=i(58),Nf=i(30),Vf=i(39),Bf=i(81),Uf=i(107),Ff=i(112);var Hf=function(e,t,i){if(i=Object(o.default)(i,!1)){var a=e.indexOf(t);if(a>-1)return a}return e.push(t),e.length-1};var kf=function(e,t){return Object(s.default)(e.extensionsUsed)&&e.extensionsUsed.indexOf(t)>=0};function zf(){}zf.objectLegacy=function(e,t){if(Object(s.default)(e))for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var a=t(e[i],i);if(Object(s.default)(a))return a}},zf.object=function(e,t){if(Object(s.default)(e))for(var i=e.length,a=0;a<i;a++){var r=t(e[a],a);if(Object(s.default)(r))return r}},zf.topLevel=function(e,t,i){var a=e[t];return Object(s.default)(a)&&!Array.isArray(a)?zf.objectLegacy(a,i):zf.object(a,i)},zf.accessor=function(e,t){return zf.topLevel(e,"accessors",t)},zf.accessorWithSemantic=function(e,t,i){var a={};return zf.mesh(e,(function(e){return zf.meshPrimitive(e,(function(e){var r=zf.meshPrimitiveAttribute(e,(function(e,r){if(0===r.indexOf(t)&&!Object(s.default)(a[e])){a[e]=!0;var n=i(e);if(Object(s.default)(n))return n}}));return Object(s.default)(r)?r:zf.meshPrimitiveTarget(e,(function(e){return zf.meshPrimitiveTargetAttribute(e,(function(e,r){if(0===r.indexOf(t)&&!Object(s.default)(a[e])){a[e]=!0;var n=i(e);if(Object(s.default)(n))return n}}))}))}))}))},zf.accessorContainingVertexAttributeData=function(e,t){var i={};return zf.mesh(e,(function(e){return zf.meshPrimitive(e,(function(e){var a=zf.meshPrimitiveAttribute(e,(function(e){if(!Object(s.default)(i[e])){i[e]=!0;var a=t(e);if(Object(s.default)(a))return a}}));return Object(s.default)(a)?a:zf.meshPrimitiveTarget(e,(function(e){return zf.meshPrimitiveTargetAttribute(e,(function(e){if(!Object(s.default)(i[e])){i[e]=!0;var a=t(e);if(Object(s.default)(a))return a}}))}))}))}))},zf.accessorContainingIndexData=function(e,t){var i={};return zf.mesh(e,(function(e){return zf.meshPrimitive(e,(function(e){var a=e.indices;if(Object(s.default)(a)&&!Object(s.default)(i[a])){i[a]=!0;var r=t(a);if(Object(s.default)(r))return r}}))}))},zf.animation=function(e,t){return zf.topLevel(e,"animations",t)},zf.animationChannel=function(e,t){var i=e.channels;return zf.object(i,t)},zf.animationSampler=function(e,t){var i=e.samplers;return zf.object(i,t)},zf.buffer=function(e,t){return zf.topLevel(e,"buffers",t)},zf.bufferView=function(e,t){return zf.topLevel(e,"bufferViews",t)},zf.camera=function(e,t){return zf.topLevel(e,"cameras",t)},zf.image=function(e,t){return zf.topLevel(e,"images",t)},zf.compressedImage=function(e,t){if(Object(s.default)(e.extras)){var i=e.extras.compressedImage3DTiles;for(var a in i)if(Object.prototype.hasOwnProperty.call(i,a)){var r=t(i[a],a);if(Object(s.default)(r))return r}}},zf.material=function(e,t){return zf.topLevel(e,"materials",t)},zf.materialValue=function(e,t){var i=e.values;for(var a in Object(s.default)(e.extensions)&&Object(s.default)(e.extensions.KHR_techniques_webgl)&&(i=e.extensions.KHR_techniques_webgl.values),i)if(Object.prototype.hasOwnProperty.call(i,a)){var r=t(i[a],a);if(Object(s.default)(r))return r}},zf.mesh=function(e,t){return zf.topLevel(e,"meshes",t)},zf.meshPrimitive=function(e,t){var i=e.primitives;if(Object(s.default)(i))for(var a=i.length,r=0;r<a;r++){var n=t(i[r],r);if(Object(s.default)(n))return n}},zf.meshPrimitiveAttribute=function(e,t){var i=e.attributes;for(var a in i)if(Object.prototype.hasOwnProperty.call(i,a)){var r=t(i[a],a);if(Object(s.default)(r))return r}},zf.meshPrimitiveTarget=function(e,t){var i=e.targets;if(Object(s.default)(i))for(var a=i.length,r=0;r<a;++r){var n=t(i[r],r);if(Object(s.default)(n))return n}},zf.meshPrimitiveTargetAttribute=function(e,t){for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var a=t(e[i],i);if(Object(s.default)(a))return a}},zf.node=function(e,t){return zf.topLevel(e,"nodes",t)},zf.nodeInTree=function(e,t,i){var a=e.nodes;if(Object(s.default)(a))for(var r=t.length,n=0;n<r;n++){var o=t[n],l=a[o];if(Object(s.default)(l)){var u=i(l,o);if(Object(s.default)(u))return u;var d=l.children;if(Object(s.default)(d)&&(u=zf.nodeInTree(e,d,i),Object(s.default)(u)))return u}}},zf.nodeInScene=function(e,t,i){var a=t.nodes;if(Object(s.default)(a))return zf.nodeInTree(e,a,i)},zf.program=function(e,t){return kf(e,"KHR_techniques_webgl")?zf.object(e.extensions.KHR_techniques_webgl.programs,t):zf.topLevel(e,"programs",t)},zf.sampler=function(e,t){return zf.topLevel(e,"samplers",t)},zf.scene=function(e,t){return zf.topLevel(e,"scenes",t)},zf.shader=function(e,t){return kf(e,"KHR_techniques_webgl")?zf.object(e.extensions.KHR_techniques_webgl.shaders,t):zf.topLevel(e,"shaders",t)},zf.skin=function(e,t){return zf.topLevel(e,"skins",t)},zf.skinJoint=function(e,t){var i=e.joints;if(Object(s.default)(i))for(var a=i.length,r=0;r<a;r++){var n=t(i[r]);if(Object(s.default)(n))return n}},zf.techniqueAttribute=function(e,t){var i=e.attributes;for(var a in i)if(Object.prototype.hasOwnProperty.call(i,a)){var r=t(i[a],a);if(Object(s.default)(r))return r}},zf.techniqueUniform=function(e,t){var i=e.uniforms;for(var a in i)if(Object.prototype.hasOwnProperty.call(i,a)){var r=t(i[a],a);if(Object(s.default)(r))return r}},zf.techniqueParameter=function(e,t){var i=e.parameters;for(var a in i)if(Object.prototype.hasOwnProperty.call(i,a)){var r=t(i[a],a);if(Object(s.default)(r))return r}},zf.technique=function(e,t){return kf(e,"KHR_techniques_webgl")?zf.object(e.extensions.KHR_techniques_webgl.techniques,t):zf.topLevel(e,"techniques",t)},zf.texture=function(e,t){return zf.topLevel(e,"textures",t)};var Gf=zf;var qf=function(e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}};var Wf=function(e,t){var i=t.bufferView;if(Object(s.default)(i)){var a=e.bufferViews[i];if(Object(s.default)(a.byteStride)&&a.byteStride>0)return a.byteStride}return se.a.getSizeInBytes(t.componentType)*qf(t.type)};function Yf(e){Object(s.default)(e)&&(e.texCoord=Object(o.default)(e.texCoord,0))}var Kf=function(e){Gf.accessor(e,(function(e){Object(s.default)(e.bufferView)&&(e.byteOffset=Object(o.default)(e.byteOffset,0))})),Gf.bufferView(e,(function(e){Object(s.default)(e.buffer)&&(e.byteOffset=Object(o.default)(e.byteOffset,0))})),Gf.mesh(e,(function(t){Gf.meshPrimitive(t,(function(t){if(t.mode=Object(o.default)(t.mode,jf.a.TRIANGLES),!Object(s.default)(t.material)){Object(s.default)(e.materials)||(e.materials=[]);t.material=Hf(e.materials,{name:"default"})}}))})),Gf.accessorContainingVertexAttributeData(e,(function(t){var i=e.accessors[t],a=i.bufferView;if(i.normalized=Object(o.default)(i.normalized,!1),Object(s.default)(a)){var r=e.bufferViews[a];r.byteStride=Wf(e,i),r.target=jf.a.ARRAY_BUFFER}})),Gf.accessorContainingIndexData(e,(function(t){var i=e.accessors[t].bufferView;Object(s.default)(i)&&(e.bufferViews[i].target=jf.a.ELEMENT_ARRAY_BUFFER)})),Gf.material(e,(function(e){var t=Object(o.default)(e.extensions,o.default.EMPTY_OBJECT),i=t.KHR_materials_common;if(Object(s.default)(i)){var a=i.technique,r=Object(s.default)(i.values)?i.values:{};return i.values=r,r.ambient=Object(s.default)(r.ambient)?r.ambient:[0,0,0,1],r.emission=Object(s.default)(r.emission)?r.emission:[0,0,0,1],r.transparency=Object(o.default)(r.transparency,1),r.transparent=Object(o.default)(r.transparent,!1),r.doubleSided=Object(o.default)(r.doubleSided,!1),void("CONSTANT"!==a&&(r.diffuse=Object(s.default)(r.diffuse)?r.diffuse:[0,0,0,1],"LAMBERT"!==a&&(r.specular=Object(s.default)(r.specular)?r.specular:[0,0,0,1],r.shininess=Object(o.default)(r.shininess,0))))}e.emissiveFactor=Object(o.default)(e.emissiveFactor,[0,0,0]),e.alphaMode=Object(o.default)(e.alphaMode,"OPAQUE"),e.doubleSided=Object(o.default)(e.doubleSided,!1),"MASK"===e.alphaMode&&(e.alphaCutoff=Object(o.default)(e.alphaCutoff,.5));var n=t.KHR_techniques_webgl;Object(s.default)(n)&&Gf.materialValue(e,(function(e){Object(s.default)(e.index)&&Yf(e)})),Yf(e.emissiveTexture),Yf(e.normalTexture),Yf(e.occlusionTexture);var l=e.pbrMetallicRoughness;Object(s.default)(l)&&(l.baseColorFactor=Object(o.default)(l.baseColorFactor,[1,1,1,1]),l.metallicFactor=Object(o.default)(l.metallicFactor,1),l.roughnessFactor=Object(o.default)(l.roughnessFactor,1),Yf(l.baseColorTexture),Yf(l.metallicRoughnessTexture));var u=t.pbrSpecularGlossiness;Object(s.default)(u)&&(u.diffuseFactor=Object(o.default)(u.diffuseFactor,[1,1,1,1]),u.specularFactor=Object(o.default)(u.specularFactor,[1,1,1]),u.glossinessFactor=Object(o.default)(u.glossinessFactor,1),Yf(u.specularGlossinessTexture))})),Gf.animation(e,(function(e){Gf.animationSampler(e,(function(e){e.interpolation=Object(o.default)(e.interpolation,"LINEAR")}))}));var t=function(e){var t={};return Gf.animation(e,(function(e){Gf.animationChannel(e,(function(e){var i=e.target,a=i.node,r=i.path;"translation"!==r&&"rotation"!==r&&"scale"!==r||(t[a]=!0)}))})),t}(e);return Gf.node(e,(function(e,i){Object(s.default)(t[i])||Object(s.default)(e.translation)||Object(s.default)(e.rotation)||Object(s.default)(e.scale)?(e.translation=Object(o.default)(e.translation,[0,0,0]),e.rotation=Object(o.default)(e.rotation,[0,0,0,1]),e.scale=Object(o.default)(e.scale,[1,1,1])):e.matrix=Object(o.default)(e.matrix,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])})),Gf.sampler(e,(function(e){e.wrapS=Object(o.default)(e.wrapS,jf.a.REPEAT),e.wrapT=Object(o.default)(e.wrapT,jf.a.REPEAT)})),Object(s.default)(e.scenes)&&!Object(s.default)(e.scene)&&(e.scene=0),e};function Xf(e){e.extras=Object(s.default)(e.extras)?e.extras:{},e.extras._pipeline=Object(s.default)(e.extras._pipeline)?e.extras._pipeline:{}}var Zf=function(e){return Gf.shader(e,(function(e){Xf(e)})),Gf.buffer(e,(function(e){Xf(e)})),Gf.image(e,(function(e){Xf(e),Gf.compressedImage(e,(function(e){Xf(e)}))})),Xf(e),e};var Jf=function(e,t){var i=e.extensionsRequired;if(Object(s.default)(i)){var a=i.indexOf(t);a>=0&&i.splice(a,1),0===i.length&&delete e.extensionsRequired}};var Qf=function(e,t){var i=e.extensionsUsed;if(Object(s.default)(i)){var a=i.indexOf(t);a>=0&&i.splice(a,1),Jf(e,t),0===i.length&&delete e.extensionsUsed}},$f=i(33);function ec(e,t,i){for(var a=new DataView(e.buffer),r=new Array(i),n=0;n<i;++n)r[n]=a.getUint32(e.byteOffset+t+4*n,!0);return r}var tc=function(e){if("glTF"!==wf(e))throw new $f.default("File is not valid binary glTF");var t=ec(e,0,5),i=t[1];if(1!==i&&2!==i)throw new $f.default("Binary glTF version is not 1 or 2");return 1===i?function(e,t){var i=t[2],a=t[3];if(0!==t[4])throw new $f.default("Binary glTF scene format is not JSON");var r=20+a,n=Object(Of.a)(e,20,a),l=JSON.parse(n);Zf(l);var u=e.subarray(r,i),d=l.buffers;if(Object(s.default)(d)&&Object.keys(d).length>0){var f=Object(o.default)(d.binary_glTF,d.KHR_binary_glTF);Object(s.default)(f)&&(f.extras._pipeline.source=u)}return Qf(l,"KHR_binary_glTF"),l}(e,t):function(e,t){var i,a,r=t[2],n=12;for(;n<r;){var o=ec(e,n,2),l=o[0],u=o[1];n+=8;var d=e.subarray(n,n+l);if(n+=l,1313821514===u){var f=Object(Of.a)(d);i=JSON.parse(f),Zf(i)}else 5130562===u&&(a=d)}if(Object(s.default)(i)&&Object(s.default)(a)){var c=i.buffers;if(Object(s.default)(c)&&c.length>0)c[0].extras._pipeline.source=a}return i}(e,t)};var ic=function(e,t){var i=e.extensionsUsed;Object(s.default)(i)||(i=[],e.extensionsUsed=i),Hf(i,t,!0)};var ac=function(e){switch(e){case se.a.BYTE:return function(e,t,i,a,r){for(var n=0;n<i;++n)r[n]=e.getInt8(t+n*a)};case se.a.UNSIGNED_BYTE:return function(e,t,i,a,r){for(var n=0;n<i;++n)r[n]=e.getUint8(t+n*a)};case se.a.SHORT:return function(e,t,i,a,r){for(var n=0;n<i;++n)r[n]=e.getInt16(t+n*a,!0)};case se.a.UNSIGNED_SHORT:return function(e,t,i,a,r){for(var n=0;n<i;++n)r[n]=e.getUint16(t+n*a,!0)};case se.a.INT:return function(e,t,i,a,r){for(var n=0;n<i;++n)r[n]=e.getInt32(t+n*a,!0)};case se.a.UNSIGNED_INT:return function(e,t,i,a,r){for(var n=0;n<i;++n)r[n]=e.getUint32(t+n*a,!0)};case se.a.FLOAT:return function(e,t,i,a,r){for(var n=0;n<i;++n)r[n]=e.getFloat32(t+n*a,!0)};case se.a.DOUBLE:return function(e,t,i,a,r){for(var n=0;n<i;++n)r[n]=e.getFloat64(t+n*a,!0)}}};var rc=function(e,t){var i=e.bufferViews,a=e.buffers,r=t.bufferView,n=qf(t.type);if(!Object(s.default)(t.bufferView))return{min:Object(Je.a)(new Array(n),0),max:Object(Je.a)(new Array(n),0)};for(var o=Object(Je.a)(new Array(n),Number.POSITIVE_INFINITY),l=Object(Je.a)(new Array(n),Number.NEGATIVE_INFINITY),u=i[r],d=a[u.buffer].extras._pipeline.source,f=t.count,c=Wf(e,t),h=t.byteOffset+u.byteOffset+d.byteOffset,p=t.componentType,m=se.a.getSizeInBytes(p),_=new DataView(d.buffer),g=new Array(n),v=ac(p),b=0;b<f;b++){v(_,h,n,m,g);for(var y=0;y<n;y++){var O=g[y];o[y]=Math.min(o[y],O),l[y]=Math.max(l[y],O)}h+=c}return{min:o,max:l}},nc=[jf.a.FUNC_ADD,jf.a.FUNC_ADD],oc=[jf.a.ONE,jf.a.ZERO,jf.a.ONE,jf.a.ZERO];function sc(e,t){var i=e.enable;return!!Object(s.default)(i)&&i.indexOf(t)>-1}var lc=[jf.a.ZERO,jf.a.ONE,jf.a.SRC_COLOR,jf.a.ONE_MINUS_SRC_COLOR,jf.a.SRC_ALPHA,jf.a.ONE_MINUS_SRC_ALPHA,jf.a.DST_ALPHA,jf.a.ONE_MINUS_DST_ALPHA,jf.a.DST_COLOR,jf.a.ONE_MINUS_DST_COLOR];function uc(e,t){if(!Object(s.default)(e))return t;for(var i=0;i<4;i++)if(-1===lc.indexOf(e[i]))return t;return e}var dc=function(e){var t={},i={},a=e.techniques;return Object(s.default)(a)?(Gf.technique(e,(function(e,a){var r=e.states;if(Object(s.default)(r)){var n=i[a]={};if(sc(r,jf.a.BLEND)){n.alphaMode="BLEND";var l=r.functions;Object(s.default)(l)&&(Object(s.default)(l.blendEquationSeparate)||Object(s.default)(l.blendFuncSeparate))&&(t[a]={blendEquation:Object(o.default)(l.blendEquationSeparate,nc),blendFactors:uc(l.blendFuncSeparate,oc)})}sc(r,jf.a.CULL_FACE)||(n.doubleSided=!0),delete e.states}})),Object.keys(t).length>0&&(Object(s.default)(e.extensions)||(e.extensions={}),ic(e,"KHR_blend")),Gf.material(e,(function(e){if(Object(s.default)(e.technique)){var a=i[e.technique];Gf.objectLegacy(a,(function(t,i){e[i]=t}));var r=t[e.technique];Object(s.default)(r)&&(Object(s.default)(e.extensions)||(e.extensions={}),e.extensions.KHR_blend=r)}})),e):e};var fc=function(e,t){var i=e.extensionsRequired;Object(s.default)(i)||(i=[],e.extensionsRequired=i),Hf(i,t,!0),ic(e,t)};var cc=function(e){var t=e.techniques,i={},a={};if(Object(s.default)(t)){var r={programs:[],shaders:[],techniques:[]},n=e.glExtensionsUsed;delete e.glExtensionsUsed,Gf.technique(e,(function(t,o){var s,l={name:t.name,program:void 0,attributes:{},uniforms:{}};Gf.techniqueAttribute(t,(function(e,i){s=t.parameters[e],l.attributes[i]={semantic:s.semantic}})),Gf.techniqueUniform(t,(function(e,a){s=t.parameters[e],l.uniforms[a]={count:s.count,node:s.node,type:s.type,semantic:s.semantic,value:s.value},i[e]=a}));var u=e.programs[t.program],d={name:u.name,fragmentShader:void 0,vertexShader:void 0,glExtensions:n},f=e.shaders[u.fragmentShader];d.fragmentShader=Hf(r.shaders,f,!0);var c=e.shaders[u.vertexShader];d.vertexShader=Hf(r.shaders,c,!0),l.program=Hf(r.programs,d),a[o]=Hf(r.techniques,l)})),r.techniques.length>0&&(Object(s.default)(e.extensions)||(e.extensions={}),e.extensions.KHR_techniques_webgl=r,ic(e,"KHR_techniques_webgl"),fc(e,"KHR_techniques_webgl"))}return Gf.material(e,(function(e){if(Object(s.default)(e.technique)){var t={technique:a[e.technique]};Gf.objectLegacy(e.values,(function(e,a){Object(s.default)(t.values)||(t.values={});var r=i[a];t.values[r]=e})),Object(s.default)(e.extensions)||(e.extensions={}),e.extensions.KHR_techniques_webgl=t}delete e.technique,delete e.values})),delete e.techniques,delete e.programs,delete e.shaders,e},hc=["mesh","node","material","accessor","bufferView","buffer"];var pc={accessor:"accessors",buffer:"buffers",bufferView:"bufferViews",node:"nodes",material:"materials",mesh:"meshes"};function mc(){}function _c(){}mc.accessor=function(e,t){e.accessors.splice(t,1),Gf.mesh(e,(function(e){Gf.meshPrimitive(e,(function(e){Gf.meshPrimitiveAttribute(e,(function(i,a){i>t&&e.attributes[a]--})),Gf.meshPrimitiveTarget(e,(function(e){Gf.meshPrimitiveTargetAttribute(e,(function(i,a){i>t&&e[a]--}))}));var i=e.indices;Object(s.default)(i)&&i>t&&e.indices--}))})),Gf.skin(e,(function(e){Object(s.default)(e.inverseBindMatrices)&&e.inverseBindMatrices>t&&e.inverseBindMatrices--})),Gf.animation(e,(function(e){Gf.animationSampler(e,(function(e){Object(s.default)(e.input)&&e.input>t&&e.input--,Object(s.default)(e.output)&&e.output>t&&e.output--}))}))},mc.buffer=function(e,t){e.buffers.splice(t,1),Gf.bufferView(e,(function(e){Object(s.default)(e.buffer)&&e.buffer>t&&e.buffer--}))},mc.bufferView=function(e,t){e.bufferViews.splice(t,1),Gf.accessor(e,(function(e){Object(s.default)(e.bufferView)&&e.bufferView>t&&e.bufferView--})),Gf.shader(e,(function(e){Object(s.default)(e.bufferView)&&e.bufferView>t&&e.bufferView--})),Gf.image(e,(function(e){Object(s.default)(e.bufferView)&&e.bufferView>t&&e.bufferView--,Gf.compressedImage(e,(function(e){var i=e.bufferView;Object(s.default)(i)&&i>t&&e.bufferView--}))})),kf(e,"KHR_draco_mesh_compression")&&Gf.mesh(e,(function(e){Gf.meshPrimitive(e,(function(e){Object(s.default)(e.extensions)&&Object(s.default)(e.extensions.KHR_draco_mesh_compression)&&e.extensions.KHR_draco_mesh_compression.bufferView>t&&e.extensions.KHR_draco_mesh_compression.bufferView--}))}))},mc.mesh=function(e,t){e.meshes.splice(t,1),Gf.node(e,(function(e){Object(s.default)(e.mesh)&&(e.mesh>t?e.mesh--:e.mesh===t&&delete e.mesh)}))},mc.node=function(e,t){e.nodes.splice(t,1),Gf.skin(e,(function(e){Object(s.default)(e.skeleton)&&e.skeleton>t&&e.skeleton--,e.joints=e.joints.map((function(e){return e>t?e-1:e}))})),Gf.animation(e,(function(e){Gf.animationChannel(e,(function(e){Object(s.default)(e.target)&&Object(s.default)(e.target.node)&&e.target.node>t&&e.target.node--}))})),Gf.technique(e,(function(e){Gf.techniqueUniform(e,(function(e){Object(s.default)(e.node)&&e.node>t&&e.node--}))})),Gf.node(e,(function(e){Object(s.default)(e.children)&&(e.children=e.children.filter((function(e){return e!==t})).map((function(e){return e>t?e-1:e})))})),Gf.scene(e,(function(e){e.nodes=e.nodes.filter((function(e){return e!==t})).map((function(e){return e>t?e-1:e}))}))},mc.material=function(e,t){e.materials.splice(t,1),Gf.mesh(e,(function(e){Gf.meshPrimitive(e,(function(e){Object(s.default)(e.material)&&e.material>t&&e.material--}))}))},_c.accessor=function(e){var t={};return Gf.mesh(e,(function(e){Gf.meshPrimitive(e,(function(e){Gf.meshPrimitiveAttribute(e,(function(e){t[e]=!0})),Gf.meshPrimitiveTarget(e,(function(e){Gf.meshPrimitiveTargetAttribute(e,(function(e){t[e]=!0}))}));var i=e.indices;Object(s.default)(i)&&(t[i]=!0)}))})),Gf.skin(e,(function(e){Object(s.default)(e.inverseBindMatrices)&&(t[e.inverseBindMatrices]=!0)})),Gf.animation(e,(function(e){Gf.animationSampler(e,(function(e){Object(s.default)(e.input)&&(t[e.input]=!0),Object(s.default)(e.output)&&(t[e.output]=!0)}))})),t},_c.buffer=function(e){var t={};return Gf.bufferView(e,(function(e){Object(s.default)(e.buffer)&&(t[e.buffer]=!0)})),t},_c.bufferView=function(e){var t={};return Gf.accessor(e,(function(e){Object(s.default)(e.bufferView)&&(t[e.bufferView]=!0)})),Gf.shader(e,(function(e){Object(s.default)(e.bufferView)&&(t[e.bufferView]=!0)})),Gf.image(e,(function(e){Object(s.default)(e.bufferView)&&(t[e.bufferView]=!0),Gf.compressedImage(e,(function(e){Object(s.default)(e.bufferView)&&(t[e.bufferView]=!0)}))})),kf(e,"KHR_draco_mesh_compression")&&Gf.mesh(e,(function(e){Gf.meshPrimitive(e,(function(e){Object(s.default)(e.extensions)&&Object(s.default)(e.extensions.KHR_draco_mesh_compression)&&(t[e.extensions.KHR_draco_mesh_compression.bufferView]=!0)}))})),t},_c.mesh=function(e){var t={};return Gf.node(e,(function(i){if(Object(s.default)(i.mesh&&Object(s.default)(e.meshes))){var a=e.meshes[i.mesh];Object(s.default)(a)&&Object(s.default)(a.primitives)&&a.primitives.length>0&&(t[i.mesh]=!0)}})),t},_c.node=function(e){var t={};return Gf.node(e,(function(i,a){(function e(t,i){return!(Object(s.default)(i.mesh)||Object(s.default)(i.camera)||Object(s.default)(i.skin)||Object(s.default)(i.weights)||Object(s.default)(i.extras)||Object(s.default)(i.extensions)&&0!==i.extensions.length)&&(!Object(s.default)(i.children)||0===i.children.filter((function(i){return!e(t,t.nodes[i])})).length)})(e,i)||(t[a]=!0)})),Gf.skin(e,(function(e){Object(s.default)(e.skeleton)&&(t[e.skeleton]=!0),Gf.skinJoint(e,(function(e){t[e]=!0}))})),Gf.animation(e,(function(e){Gf.animationChannel(e,(function(e){Object(s.default)(e.target)&&Object(s.default)(e.target.node)&&(t[e.target.node]=!0)}))})),Gf.technique(e,(function(e){Gf.techniqueUniform(e,(function(e){Object(s.default)(e.node)&&(t[e.node]=!0)}))})),t},_c.material=function(e){var t={};return Gf.mesh(e,(function(e){Gf.meshPrimitive(e,(function(e){Object(s.default)(e.material)&&(t[e.material]=!0)}))})),t};var gc=function(e,t){return t=Object(o.default)(t,hc),hc.forEach((function(i){t.indexOf(i)>-1&&function(e,t){var i=e[pc[t]];if(Object(s.default)(i))for(var a=0,r=_c[t](e),n=i.length,o=0;o<n;++o)r[o]||(mc[t](e,o-a),a++)}(e,i)})),e};var vc=function(e,t){var i={byteLength:t.length,extras:{_pipeline:{source:t}}},a={buffer:Hf(e.buffers,i),byteOffset:0,byteLength:t.length};return Hf(e.bufferViews,a)};var bc=function(e,t){var i=Wf(e,t),a=se.a.getSizeInBytes(t.componentType),r=qf(t.type),n=t.count,o=new Array(r*n);if(!Object(s.default)(t.bufferView))return Object(Je.a)(o,0),o;for(var l=e.bufferViews[t.bufferView],u=e.buffers[l.buffer].extras._pipeline.source,d=t.byteOffset+l.byteOffset+u.byteOffset,f=new DataView(u.buffer),c=new Array(r),h=ac(t.componentType),p=0;p<n;++p){h(f,d,r,a,c);for(var m=0;m<r;++m)o[p*r+m]=c[m];d+=i}return o};function yc(e,t,i){var a=se.a.createTypedArray(i,bc(e,t)),r=new Uint8Array(a.buffer);t.bufferView=vc(e,r),t.componentType=i,t.byteOffset=0}var Oc=function(e){var t;return Gf.accessorWithSemantic(e,"JOINTS_0",(function(i){var a=e.accessors[i];(t=a.componentType)===jf.a.BYTE?yc(e,a,se.a.UNSIGNED_BYTE):t!==jf.a.UNSIGNED_BYTE&&t!==jf.a.UNSIGNED_SHORT&&yc(e,a,se.a.UNSIGNED_SHORT)})),Gf.accessorWithSemantic(e,"WEIGHTS_0",(function(i){var a=e.accessors[i];(t=a.componentType)===jf.a.BYTE?yc(e,a,se.a.UNSIGNED_BYTE):t===jf.a.SHORT&&yc(e,a,se.a.UNSIGNED_SHORT)})),e},wc={.8:function(e){Object(s.default)(e.asset)||(e.asset={});var t=e.asset;if(t.version="1.0","string"==typeof t.profile){var i=t.profile.split(" ");t.profile={api:i[0],version:i[1]}}else t.profile={};Object(s.default)(e.version)&&delete e.version;xc(e),Ec(e),Tc(e),Cc(e),Ac(e),Object(s.default)(e.allExtensions)&&(e.extensionsUsed=e.allExtensions,delete e.allExtensions);if(Object(s.default)(e.lights)){var a=Object(o.default)(e.extensions,{});e.extensions=a;var r=Object(o.default)(a.KHR_materials_common,{});a.KHR_materials_common=r,r.lights=e.lights,delete e.lights,ic(e,"KHR_materials_common")}},"1.0":function(e){e.asset=Object(o.default)(e.asset,{}),e.asset.version="2.0",xc(e),function(e){var t=e.animations;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=t[i],r=a.parameters;if(Object(s.default)(r)){var n=a.samplers;for(var o in n)if(Object.prototype.hasOwnProperty.call(n,o)){var l=n[o];l.input=r[l.input],l.output=r[l.output]}delete a.parameters}}}(e),function(e){Gf.node(e,(function(t,i){Dc(t)&&function e(t,i){Gf.scene(t,(function(e){var t=e.nodes;if(Object(s.default)(t))for(var a=t.length;a>=0;--a)if(t[a]===i)return void t.splice(a,1)})),Gf.node(t,(function(a,r){if(Object(s.default)(a.children)){var n=a.children.indexOf(i);n>-1&&(a.children.splice(n,1),Dc(a)&&e(t,r))}})),delete t.nodes[i]}(e,i)}))}(e),function(e){var t,i,a={accessors:{},animations:{},buffers:{},bufferViews:{},cameras:{},images:{},materials:{},meshes:{},nodes:{},programs:{},samplers:{},scenes:{},shaders:{},skins:{},textures:{},techniques:{}},r={},n=e.nodes;for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(i=n[o].jointName,Object(s.default)(i)&&(r[i]=o));for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)&&Object(s.default)(a[l])){var u={},d=e[l];e[l]=jc(d,u),a[l]=u}for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(r[i]=a.nodes[r[i]]);Object(s.default)(e.scene)&&(e.scene=a.scenes[e.scene]);Gf.bufferView(e,(function(e){Object(s.default)(e.buffer)&&(e.buffer=a.buffers[e.buffer])})),Gf.accessor(e,(function(e){Object(s.default)(e.bufferView)&&(e.bufferView=a.bufferViews[e.bufferView])})),Gf.shader(e,(function(e){var t=e.extensions;if(Object(s.default)(t)){var i=t.KHR_binary_glTF;Object(s.default)(i)&&(e.bufferView=a.bufferViews[i.bufferView],delete t.KHR_binary_glTF),0===Object.keys(t).length&&delete e.extensions}})),Gf.program(e,(function(e){Object(s.default)(e.vertexShader)&&(e.vertexShader=a.shaders[e.vertexShader]),Object(s.default)(e.fragmentShader)&&(e.fragmentShader=a.shaders[e.fragmentShader])})),Gf.technique(e,(function(e){Object(s.default)(e.program)&&(e.program=a.programs[e.program]),Gf.techniqueParameter(e,(function(e){Object(s.default)(e.node)&&(e.node=a.nodes[e.node]);var t=e.value;"string"==typeof t&&(e.value={index:a.textures[t]})}))})),Gf.mesh(e,(function(e){Gf.meshPrimitive(e,(function(e){Object(s.default)(e.indices)&&(e.indices=a.accessors[e.indices]),Gf.meshPrimitiveAttribute(e,(function(t,i){e.attributes[i]=a.accessors[t]})),Object(s.default)(e.material)&&(e.material=a.materials[e.material])}))})),Gf.node(e,(function(i){var r=i.children;if(Object(s.default)(r)){var n=r.length;for(t=0;t<n;++t)r[t]=a.nodes[r[t]]}if(Object(s.default)(i.meshes)){var o=i.meshes,l=o.length;if(l>0)for(i.mesh=a.meshes[o[0]],t=1;t<l;++t){var u={mesh:a.meshes[o[t]]},d=Hf(e.nodes,u);Object(s.default)(r)||(r=[],i.children=r),r.push(d)}delete i.meshes}if(Object(s.default)(i.camera)&&(i.camera=a.cameras[i.camera]),Object(s.default)(i.skin)&&(i.skin=a.skins[i.skin]),Object(s.default)(i.skeletons)){var f=i.skeletons;if(f.length>0&&Object(s.default)(i.skin))e.skins[i.skin].skeleton=a.nodes[f[0]];delete i.skeletons}Object(s.default)(i.jointName)&&delete i.jointName})),Gf.skin(e,(function(e){Object(s.default)(e.inverseBindMatrices)&&(e.inverseBindMatrices=a.accessors[e.inverseBindMatrices]);var i=e.jointNames;if(Object(s.default)(i)){var n=[],o=i.length;for(t=0;t<o;++t)n[t]=r[i[t]];e.joints=n,delete e.jointNames}})),Gf.scene(e,(function(e){var i=e.nodes;if(Object(s.default)(i)){var r=i.length;for(t=0;t<r;++t)i[t]=a.nodes[i[t]]}})),Gf.animation(e,(function(e){var t={};e.samplers=jc(e.samplers,t),Gf.animationSampler(e,(function(e){e.input=a.accessors[e.input],e.output=a.accessors[e.output]})),Gf.animationChannel(e,(function(e){e.sampler=t[e.sampler];var i=e.target;Object(s.default)(i)&&(i.node=a.nodes[i.id],delete i.id)}))})),Gf.material(e,(function(e){Object(s.default)(e.technique)&&(e.technique=a.techniques[e.technique]),Gf.materialValue(e,(function(t,i){"string"==typeof t&&(e.values[i]={index:a.textures[t]})}));var t=e.extensions;if(Object(s.default)(t)){var i=t.KHR_materials_common;Object(s.default)(i)&&Gf.materialValue(i,(function(e,t){"string"==typeof e&&(i.values[t]={index:a.textures[e]})}))}})),Gf.image(e,(function(e){var t=e.extensions;if(Object(s.default)(t)){var i=t.KHR_binary_glTF;Object(s.default)(i)&&(e.bufferView=a.bufferViews[i.bufferView],e.mimeType=i.mimeType,delete t.KHR_binary_glTF),0===Object.keys(t).length&&delete e.extensions}Gf.compressedImage(e,(function(e){var i=e.extensions;if(Object(s.default)(i)){var r=i.KHR_binary_glTF;Object(s.default)(r)&&(e.bufferView=a.bufferViews[r.bufferView],e.mimeType=r.mimeType,delete i.KHR_binary_glTF),0===Object.keys(t).length&&delete e.extensions}}))})),Gf.texture(e,(function(e){Object(s.default)(e.sampler)&&(e.sampler=a.samplers[e.sampler]),Object(s.default)(e.source)&&(e.source=a.images[e.source])}))}(e),function(e){Gf.animation(e,(function(e){Gf.animationSampler(e,(function(e){delete e.name}))}))}(e),function(e){var t=e.asset;delete t.profile,delete t.premultipliedAlpha}(e),function(e){var t=e.extensionsUsed;if(e.extensionsRequired=Object(o.default)(e.extensionsRequired,[]),Object(s.default)(t))for(var i=t.length,a=0;a<i;++a){var r=t[a];Object(s.default)(Pc[r])&&e.extensionsRequired.push(r)}}(e),function(e){Gf.buffer(e,(function(e){Object(s.default)(e.byteLength)||(e.byteLength=e.extras._pipeline.source.length)})),Gf.accessor(e,(function(t){var i=t.bufferView;if(Object(s.default)(i)){var a=e.bufferViews[i],r=Lc(e,t),n=t.byteOffset+t.count*r;a.byteLength=Math.max(Object(o.default)(a.byteLength,0),n)}}))}(e),function(e){var t,i,a,r=e.bufferViews,n={};Gf.accessorContainingVertexAttributeData(e,(function(t){var i=e.accessors[t];Object(s.default)(i.bufferView)&&(n[i.bufferView]=!0)}));var l={};for(var u in Gf.accessor(e,(function(e){Object(s.default)(e.bufferView)&&(l[e.bufferView]=Object(o.default)(l[e.bufferView],[]),l[e.bufferView].push(e))})),l)if(Object.prototype.hasOwnProperty.call(l,u)){a=r[u];var d=l[u];d.sort((function(e,t){return e.byteOffset-t.byteOffset}));var f=0,c=0,h=d.length;for(t=0;t<h;++t){var p=d[t],m=Lc(e,p),_=p.byteOffset,g=p.count*m;delete p.byteStride;var v=t<h-1,b=v?Lc(e,d[t+1]):void 0;if(m!==b){var y=Object(_f.default)(a,!0);n[u]&&(y.byteStride=m),y.byteOffset+=f,y.byteLength=_+g-f;var O=Hf(r,y);for(i=c;i<=t;++i)(p=d[i]).bufferView=O,p.byteOffset=p.byteOffset-f;f=v?d[t+1].byteOffset:void 0,c=t+1}}}gc(e,["accessor","bufferView","buffer"])}(e),function(e){Gf.accessorWithSemantic(e,"POSITION",(function(t){var i=e.accessors[t];if(!Object(s.default)(i.min)||!Object(s.default)(i.max)){var a=rc(e,i);i.min=a.min,i.max=a.max}}))}(e),function(e){Gf.animation(e,(function(t){Gf.animationSampler(t,(function(t){var i=e.accessors[t.input];if(!Object(s.default)(i.min)||!Object(s.default)(i.max)){var a=rc(e,i);i.min=a.min,i.max=a.max}}))}))}(e),function(e){Gf.buffer(e,(function(e){delete e.type}))}(e),function(e){Gf.texture(e,(function(e){delete e.format,delete e.internalFormat,delete e.target,delete e.type}))}(e),function(e){Gf.mesh(e,(function(e){Gf.meshPrimitive(e,(function(e){Gf.meshPrimitiveAttribute(e,(function(t,i){"TEXCOORD"===i?e.attributes.TEXCOORD_0=t:"COLOR"===i&&(e.attributes.COLOR_0=t)})),delete e.attributes.TEXCOORD,delete e.attributes.COLOR}))})),Gf.technique(e,(function(e){Gf.techniqueParameter(e,(function(e){var t=e.semantic;Object(s.default)(t)&&("TEXCOORD"===t?e.semantic="TEXCOORD_0":"COLOR"===t&&(e.semantic="COLOR_0"))}))}))}(e),function(e){var t={};Gf.mesh(e,(function(e){Gf.meshPrimitive(e,(function(e){for(var i in Gf.meshPrimitiveAttribute(e,(function(e,i){if("_"!==i.charAt(0)){var a,r=i.search(/_[0-9]+/g),n=i,o="_0";r>=0&&(n=i.substring(0,r),o=i.substring(r));var l=Ic[n];Object(s.default)(l)?(a=l+o,t[i]=a):Object(s.default)(Sc[n])||(a="_"+i,t[i]=a)}})),t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=t[i],r=e.attributes[i];Object(s.default)(r)&&(delete e.attributes[i],e.attributes[a]=r)}}))})),Gf.technique(e,(function(e){Gf.techniqueParameter(e,(function(e){var i=t[e.semantic];Object(s.default)(i)&&(e.semantic=i)}))}))}(e),Oc(e),function(e){Gf.camera(e,(function(e){var t=e.perspective;if(Object(s.default)(t)){var i=t.aspectRatio;Object(s.default)(i)&&0===i&&delete t.aspectRatio;var a=t.yfov;Object(s.default)(a)&&0===a&&(t.yfov=1)}}))}(e),dc(e),cc(e),function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var i=e[t];Array.isArray(i)&&0===i.length&&delete e[t]}Gf.node(e,(function(e){Object(s.default)(e.children)&&0===e.children.length&&delete e.children}))}(e)},"2.0":void 0};function xc(e){var t=e.materials;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=t[i],r=a.instanceTechnique;Object(s.default)(r)&&(a.technique=r.technique,a.values=r.values,delete a.instanceTechnique)}}function Ec(e){var t=e.meshes;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=t[i].primitives;if(Object(s.default)(a))for(var r=a.length,n=0;n<r;++n){var l=a[n],u=Object(o.default)(l.primitive,jf.a.TRIANGLES);l.mode=Object(o.default)(l.mode,u),delete l.primitive}}}function Tc(e){var t=e.nodes,i=new v.default,a=new Dt.default;for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=t[r];if(Object(s.default)(n.rotation)){var o=n.rotation;v.default.fromArray(o,0,i),Dt.default.fromAxisAngle(i,o[3],a),n.rotation=[a.x,a.y,a.z,a.w]}var l=n.instanceSkin;Object(s.default)(l)&&(n.skeletons=l.skeletons,n.skin=l.skin,n.meshes=l.meshes,delete n.instanceSkin)}}function Cc(e){var t=e.animations,i=e.accessors,a=e.bufferViews,r=e.buffers,n={},o=new v.default,l=new Dt.default;for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u)){var d=t[u],f=d.channels,c=d.parameters,h=d.samplers;if(Object(s.default)(f))for(var p=f.length,m=0;m<p;++m){var _=f[m];if("rotation"===_.target.path){var g=c[h[_.sampler].output];if(Object(s.default)(n[g]))continue;n[g]=!0;for(var b=i[g],y=a[b.bufferView],O=r[y.buffer].extras._pipeline.source,w=O.byteOffset+y.byteOffset+b.byteOffset,x=b.componentType,E=b.count,T=qf(b.type),C=b.count*T,A=se.a.createArrayBufferView(x,O.buffer,w,C),j=0;j<E;j++){var P=j*T;v.default.unpack(A,P,o);var S=A[P+3];Dt.default.fromAxisAngle(o,S,l),Dt.default.pack(l,A,P)}}}}}function Ac(e){var t=e.techniques;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=t[i],r=a.passes;if(Object(s.default)(r)){var n=Object(o.default)(a.pass,"defaultPass");if(Object.prototype.hasOwnProperty.call(r,n)){var l=r[n],u=l.instanceProgram;a.attributes=Object(o.default)(a.attributes,u.attributes),a.program=Object(o.default)(a.program,u.program),a.uniforms=Object(o.default)(a.uniforms,u.uniforms),a.states=Object(o.default)(a.states,l.states)}delete a.passes,delete a.pass}}}function jc(e,t){var i=[];for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=e[a];t[a]=i.length,i.push(r),Object(s.default)(r.name)||(r.name=a)}return i}var Pc={CESIUM_RTC:!0,KHR_materials_common:!0,WEB3D_quantized_attributes:!0};var Sc={POSITION:!0,NORMAL:!0,TANGENT:!0},Ic={COLOR:"COLOR",JOINT:"JOINTS",JOINTS:"JOINTS",TEXCOORD:"TEXCOORD",WEIGHT:"WEIGHTS",WEIGHTS:"WEIGHTS"};function Lc(e,t){return Object(s.default)(t.byteStride)&&0!==t.byteStride?t.byteStride:Wf(e,t)}function Dc(e){return(!Object(s.default)(e.children)||0===e.children.length)&&(!Object(s.default)(e.meshes)||0===e.meshes.length)&&!Object(s.default)(e.camera)&&!Object(s.default)(e.skin)&&!Object(s.default)(e.skeletons)&&!Object(s.default)(e.jointName)&&(!Object(s.default)(e.translation)||v.default.fromArray(e.translation).equals(v.default.ZERO))&&(!Object(s.default)(e.scale)||v.default.fromArray(e.scale).equals(new v.default(1,1,1)))&&(!Object(s.default)(e.rotation)||It.a.fromArray(e.rotation).equals(new It.a(0,0,0,1)))&&(!Object(s.default)(e.matrix)||nt.default.fromColumnMajorArray(e.matrix).equals(nt.default.IDENTITY))&&!Object(s.default)(e.extensions)&&!Object(s.default)(e.extras)}var Mc=function(e,t){var i=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).targetVersion,a=e.version;e.asset=Object(o.default)(e.asset,{version:"1.0"}),e.asset.version=Object(o.default)(e.asset.version,"1.0"),a=Object(o.default)(a,e.asset.version).toString(),Object.prototype.hasOwnProperty.call(wc,a)||(Object(s.default)(a)&&(a=a.substring(0,3)),Object.prototype.hasOwnProperty.call(wc,a)||(a="1.0"));for(var r=wc[a];Object(s.default)(r)&&a!==i;)r(e,t),a=e.asset.version,r=wc[a];return e},Rc=i(97),Nc=i(350),Vc=i(264),Bc=i(543),Uc=i(174);function Fc(){}function Hc(e,t){var i="runtime."+Object.keys(e.createdBufferViews).length,a=e.buffers,r=Object.keys(a).length;return a[r]=t,e.createdBufferViews[i]={buffer:r,byteOffset:0,byteLength:t.byteLength},i}function kc(e,t,i){var a=t._loadResources,r=Hc(a,e);return a.vertexBuffersToCreate.enqueue(r),r}function zc(e,t,i,a){if(Fc._taskProcessorReady){var r=i.primitivesToDecode.peek();if(Object(s.default)(r)){var n=e.scheduleTask(r,[r.array.buffer]);if(Object(s.default)(n))return i.activeDecodingTasks++,i.primitivesToDecode.dequeue(),n.then((function(e){i.activeDecodingTasks--;var a=function(e,t,i){var a=e.typedArray,r=t._loadResources,n=Hc(r,a);return r.indexBuffersToCreate.enqueue({id:n,componentType:se.a.fromTypedArray(a)}),{bufferViewId:n,numberOfIndices:e.numberOfIndices}}(e.indexArray,t),n={},o=e.attributeData;for(var s in o)if(o.hasOwnProperty(s)){var l=o[s],u=kc(l.array,t),d=l.data;d.bufferView=u,n[s]=d}t._decodedData[r.mesh+".primitive."+r.primitive]={bufferView:a.bufferViewId,numberOfIndices:a.numberOfIndices,attributes:n}}))}}}Fc._maxDecodingConcurrency=Math.max(bf.default.hardwareConcurrency-1,1),Fc._decoderTaskProcessor=void 0,Fc._taskProcessorReady=!1,Fc._getDecoderTaskProcessor=function(){if(!Object(s.default)(Fc._decoderTaskProcessor)){var e=new Uc.default("decodeDraco",Fc._maxDecodingConcurrency);e.initWebAssemblyModule({modulePath:"ThirdParty/Workers/draco_wasm_wrapper.js",wasmBinaryFile:"ThirdParty/draco_decoder.wasm",fallbackModulePath:"ThirdParty/Workers/draco_decoder.js"}).then((function(){Fc._taskProcessorReady=!0})),Fc._decoderTaskProcessor=e}return Fc._decoderTaskProcessor},Fc.hasExtension=function(e){return Object(s.default)(e.extensionsRequired.KHR_draco_mesh_compression)||Object(s.default)(e.extensionsUsed.KHR_draco_mesh_compression)},Fc._decodedModelResourceCache=void 0,Fc.parse=function(e,t){if(Fc.hasExtension(e)){var i=e._loadResources,a=e.cacheKey;if(Object(s.default)(a)){Object(s.default)(Fc._decodedModelResourceCache)||(Object(s.default)(t.cache.modelDecodingCache)||(t.cache.modelDecodingCache={}),Fc._decodedModelResourceCache=t.cache.modelDecodingCache);var r=Fc._decodedModelResourceCache[a];if(Object(s.default)(r))return r.count++,void(i.pendingDecodingCache=!0)}var n=e._dequantizeInShader,o=e.gltf;Gf.mesh(o,(function(e,t){Gf.meshPrimitive(e,(function(e,a){if(Object(s.default)(e.extensions)){var r=e.extensions.KHR_draco_mesh_compression;if(Object(s.default)(r)){var l=o.bufferViews[r.bufferView],u=Object(Bc.a)(o.buffers[l.buffer].extras._pipeline.source,l.byteOffset,l.byteOffset+l.byteLength);i.primitivesToDecode.enqueue({mesh:t,primitive:a,array:u,bufferView:l,compressedAttributes:r.attributes,dequantizeInShader:n})}}}))}))}},Fc.decodeModel=function(e,t){if(!Fc.hasExtension(e))return Ef.default.resolve();var i=e._loadResources,a=e.cacheKey;if(Object(s.default)(a)&&Object(s.default)(Fc._decodedModelResourceCache)){var r=Fc._decodedModelResourceCache[a];if(Object(s.default)(r)&&i.pendingDecodingCache)return Object(Ef.default)(r.ready,(function(){e._decodedData=r.data,i.pendingDecodingCache=!1}));Fc._decodedModelResourceCache[a]={ready:!1,count:1,data:void 0}}if(0===i.primitivesToDecode.length)return Ef.default.resolve();for(var n=Fc._getDecoderTaskProcessor(),o=[],l=zc(n,e,i);Object(s.default)(l);)o.push(l),l=zc(n,e,i);return Ef.default.all(o)},Fc.decodePointCloud=function(e){var t=Fc._getDecoderTaskProcessor();if(Fc._taskProcessorReady)return t.scheduleTask(e,[e.buffer.buffer])},Fc.cacheDataForModel=function(e){var t=e.cacheKey;if(Object(s.default)(t)&&Object(s.default)(Fc._decodedModelResourceCache)){var i=Fc._decodedModelResourceCache[t];Object(s.default)(i)&&(i.ready=!0,i.data=e._decodedData)}},Fc.destroyCachedDataForModel=function(e){var t=e.cacheKey;if(Object(s.default)(t)&&Object(s.default)(Fc._decodedModelResourceCache)){var i=Fc._decodedModelResourceCache[t];Object(s.default)(i)&&0==--i.count&&delete Fc._decodedModelResourceCache[t]}};var Gc=Fc;var qc=function(e,t,i){return"    float clipDistance = clip(gl_FragCoord, "+e+", "+t+"); \n    vec4 clippingPlanesEdgeColor = vec4(1.0); \n    clippingPlanesEdgeColor.rgb = "+i+".rgb; \n    float clippingPlanesEdgeWidth = "+i+".a; \n    if (clipDistance > 0.0 && clipDistance < clippingPlanesEdgeWidth) \n    { \n        gl_FragColor = clippingPlanesEdgeColor;\n    } \n"},Wc=i(553),Yc=i(246);function Kc(){this.times=void 0,this.points=void 0,y.default.throwInstantiationError()}Kc.prototype.evaluate=y.default.throwInstantiationError,Kc.prototype.findTimeInterval=function(e,t){var i,a=this.times,r=a.length;if(e>=a[t=Object(o.default)(t,0)]){if(t+1<r&&e<a[t+1])return t;if(t+2<r&&e<a[t+2])return t+1}else if(t-1>=0&&e>=a[t-1])return t-1;if(e>a[t])for(i=t;i<r-1&&!(e>=a[i]&&e<a[i+1]);++i);else for(i=t-1;i>=0&&!(e>=a[i]&&e<a[i+1]);--i);return i===r-1&&(i=r-2),i},Kc.prototype.wrapTime=function(e){var t=this.times,i=t[t.length-1],a=t[0],r=i-a;return e<a&&(e+=(Math.floor((a-e)/r)+1)*r),e>i&&(e-=(Math.floor((e-i)/r)+1)*r),e},Kc.prototype.clampTime=function(e){var t=this.times;return Ne.default.clamp(e,t[0],t[t.length-1])};var Xc=Kc;function Zc(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).points,i=e.times;this._times=i,this._points=t,this._lastTimeIndex=0}Object.defineProperties(Zc.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}}}),Zc.prototype.findTimeInterval=Xc.prototype.findTimeInterval,Zc.prototype.wrapTime=Xc.prototype.wrapTime,Zc.prototype.clampTime=Xc.prototype.clampTime,Zc.prototype.evaluate=function(e,t){var i=this.points,a=this.times,r=this._lastTimeIndex=this.findTimeInterval(e,this._lastTimeIndex),n=(e-a[r])/(a[r+1]-a[r]);return Object(s.default)(t)||(t=new v.default),v.default.lerp(i[r],i[r+1],n,t)};var Jc=Zc;function Qc(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).points,i=e.times;this._times=i,this._points=t,this._evaluateFunction=function(e){var t=e.points,i=e.times;return function(a,r){Object(s.default)(r)||(r=new Dt.default);var n=e._lastTimeIndex=e.findTimeInterval(a,e._lastTimeIndex),o=(a-i[n])/(i[n+1]-i[n]),l=t[n],u=t[n+1];return Dt.default.fastSlerp(l,u,o,r)}}(this),this._lastTimeIndex=0}Object.defineProperties(Qc.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}}}),Qc.prototype.findTimeInterval=Xc.prototype.findTimeInterval,Qc.prototype.wrapTime=Xc.prototype.wrapTime,Qc.prototype.clampTime=Xc.prototype.clampTime,Qc.prototype.evaluate=function(e,t){return this._evaluateFunction(e,t)};var $c=Qc;function eh(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).weights,i=e.times;this._times=i,this._weights=t,this._count=t.length/i.length,this._lastTimeIndex=0}Object.defineProperties(eh.prototype,{times:{get:function(){return this._times}},weights:{get:function(){return this._weights}}}),eh.prototype.findTimeInterval=Xc.prototype.findTimeInterval,eh.prototype.wrapTime=Xc.prototype.wrapTime,eh.prototype.clampTime=Xc.prototype.clampTime,eh.prototype.evaluate=function(e,t){var i=this.weights,a=this.times,r=this._lastTimeIndex=this.findTimeInterval(e,this._lastTimeIndex),n=(e-a[r])/(a[r+1]-a[r]);Object(s.default)(t)||(t=new Array(this._count));for(var o=0;o<this._count;o++){var l=r*this._count+o;t[o]=i[l]*(1-n)+i[l+this._count]*n}return t};var th=eh,ih=Object.freeze({SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"});function ah(){}var rh=/^data\:/i;function nh(e,t){var i=e.gltf,a=i.buffers,r=i.bufferViews[t.bufferView],n=a[r.buffer],o=r.byteOffset+t.byteOffset,s=t.count*qf(t.type),l=rh.test(n.uri)?"":n.uri;return e.cacheKey+"//"+l+"/"+o+"/"+s}var oh={};ah.getAnimationParameterValues=function(e,t){var i=nh(e,t),a=oh[i];if(!Object(s.default)(a)){var r=e.gltf,n=r.buffers,l=r.bufferViews[t.bufferView],u=n[l.buffer].extras._pipeline.source,d=t.componentType,f=t.type,c=qf(f),h=t.count,p=Wf(r,t);a=new Array(h);for(var m=Object(o.default)(t.byteOffset,0),_=l.byteOffset+m,g=0;g<h;g++){var b=se.a.createArrayBufferView(d,u.buffer,u.byteOffset+_,c);"SCALAR"===f?a[g]=b[0]:"VEC3"===f?a[g]=v.default.fromArray(b):"VEC4"===f&&(a[g]=Dt.default.unpack(b)),_+=p}Object(s.default)(e.cacheKey)&&(oh[i]=a)}return a};var sh={};function lh(e){this._value=e}lh.prototype.evaluate=function(e,t){return this._value},lh.prototype.wrapTime=function(e){return 0},lh.prototype.clampTime=function(e){return 0},ah.getAnimationSpline=function(e,t,i,a,r,n,o,l){var u=function(e,t,i){return e.cacheKey+"//"+t+"/"+i}(e,t,a),d=sh[u];if(!Object(s.default)(d)){var f=n,c=l;1===f.length&&1===c.length?d=new lh(c[0]):"LINEAR"===r.interpolation&&("translation"===o||"scale"===o?d=new Jc({times:f,points:c}):"rotation"===o?d=new $c({times:f,points:c}):"weights"===o&&(d=new th({times:f,weights:c}))),Object(s.default)(e.cacheKey)&&(sh[u]=d)}return d};var uh={};ah.getSkinInverseBindMatrices=function(e,t){var i=nh(e,t),a=uh[i];if(!Object(s.default)(a)){var r=e.gltf,n=r.buffers,o=r.bufferViews[t.bufferView],l=n[o.buffer].extras._pipeline.source,u=t.componentType,d=t.type,f=t.count,c=Wf(r,t),h=o.byteOffset+t.byteOffset,p=qf(d);if(a=new Array(f),u===jf.a.FLOAT&&d===ih.MAT4)for(var m=0;m<f;++m){var _=se.a.createArrayBufferView(u,l.buffer,l.byteOffset+h,p);a[m]=nt.default.fromArray(_),h+=c}uh[i]=a}return a};var dh=ah,fh=i(13),ch=Object.freeze({NONE:0,REPEAT:1,MIRRORED_REPEAT:2}),hh=Object.freeze({STOPPED:0,ANIMATING:1});function ph(e,t,i){this._name=i.name,this._startTime=fh.default.clone(e.startTime),this._delay=Object(o.default)(e.delay,0),this._stopTime=e.stopTime,this.removeOnStop=Object(o.default)(e.removeOnStop,!1),this._multiplier=Object(o.default)(e.multiplier,1),this._reverse=Object(o.default)(e.reverse,!1),this._loop=Object(o.default)(e.loop,ch.NONE),this.start=new X.default,this.update=new X.default,this.stop=new X.default,this._state=hh.STOPPED,this._runtimeAnimation=i,this._computedStartTime=void 0,this._duration=void 0;var a=this;this._raiseStartEvent=function(){a.start.raiseEvent(t,a)},this._updateEventTime=0,this._raiseUpdateEvent=function(){a.update.raiseEvent(t,a,a._updateEventTime)},this._raiseStopEvent=function(){a.stop.raiseEvent(t,a)}}Object.defineProperties(ph.prototype,{name:{get:function(){return this._name}},startTime:{get:function(){return this._startTime}},delay:{get:function(){return this._delay}},stopTime:{get:function(){return this._stopTime}},multiplier:{get:function(){return this._multiplier}},reverse:{get:function(){return this._reverse}},loop:{get:function(){return this._loop}}});var mh=ph;function _h(e){this.animationAdded=new X.default,this.animationRemoved=new X.default,this._model=e,this._scheduledAnimations=[],this._previousTime=void 0}function gh(e,t,i){var a=e._model,r=a._runtime.animations[t],n=new mh(i,a,r);return e._scheduledAnimations.push(n),e.animationAdded.raiseEvent(a,n),n}function vh(e,t){for(var i=e.channelEvaluators,a=i.length,r=0;r<a;++r)i[r](t)}Object.defineProperties(_h.prototype,{length:{get:function(){return this._scheduledAnimations.length}}}),_h.prototype.add=function(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT);var t,i=this._model._runtime.animations;if(Object(s.default)(e.index))return gh(this,e.index,e);for(var a=i.length,r=0;r<a;++r)if(i[r].name===e.name){t=r;break}return gh(this,t,e)},_h.prototype.addAll=function(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT);for(var t=[],i=this._model._runtime.animations.length,a=0;a<i;++a)t.push(gh(this,a,e));return t},_h.prototype.remove=function(e){if(Object(s.default)(e)){var t=this._scheduledAnimations,i=t.indexOf(e);if(-1!==i)return t.splice(i,1),this.animationRemoved.raiseEvent(this._model,e),!0}return!1},_h.prototype.removeAll=function(){var e=this._model,t=this._scheduledAnimations,i=t.length;this._scheduledAnimations=[];for(var a=0;a<i;++a)this.animationRemoved.raiseEvent(e,t[a])},_h.prototype.contains=function(e){return!!Object(s.default)(e)&&-1!==this._scheduledAnimations.indexOf(e)},_h.prototype.get=function(e){return this._scheduledAnimations[e]};var bh=[];function yh(e,t,i){return function(){e.animationRemoved.raiseEvent(t,i)}}_h.prototype.update=function(e){var t=this._scheduledAnimations,i=t.length;if(0===i)return this._previousTime=void 0,!1;if(fh.default.equals(e.time,this._previousTime))return!1;this._previousTime=fh.default.clone(e.time,this._previousTime);for(var a=!1,r=e.time,n=this._model,l=0;l<i;++l){var u=t[l],d=u._runtimeAnimation;Object(s.default)(u._computedStartTime)||(u._computedStartTime=fh.default.addSeconds(Object(o.default)(u.startTime,r),u.delay,new fh.default)),Object(s.default)(u._duration)||(u._duration=d.stopTime*(1/u.multiplier));var f=u._computedStartTime,c=u._duration,h=u.stopTime,p=0!==c?fh.default.secondsDifference(r,f)/c:0,m=p>=0,_=u.loop===ch.REPEAT||u.loop===ch.MIRRORED_REPEAT;if((m||_&&!Object(s.default)(u.startTime))&&(p<=1||_)&&(!Object(s.default)(h)||fh.default.lessThanOrEquals(r,h))){if(u._state===hh.STOPPED&&(u._state=hh.ANIMATING,u.start.numberOfListeners>0&&e.afterRender.push(u._raiseStartEvent)),u.loop===ch.REPEAT)p-=Math.floor(p);else if(u.loop===ch.MIRRORED_REPEAT){var g=Math.floor(p),v=p-g;p=g%2==1?1-v:v}u.reverse&&(p=1-p);var b=p*c*u.multiplier;vh(d,b=Ne.default.clamp(b,d.startTime,d.stopTime)),u.update.numberOfListeners>0&&(u._updateEventTime=b,e.afterRender.push(u._raiseUpdateEvent)),a=!0}else m&&u._state===hh.ANIMATING&&(u._state=hh.STOPPED,u.stop.numberOfListeners>0&&e.afterRender.push(u._raiseStopEvent),u.removeOnStop&&bh.push(u))}i=bh.length;for(var y=0;y<i;++y){var O=bh[y];t.splice(t.indexOf(O),1),e.afterRender.push(yh(this,n,O))}return bh.length=0,a};var Oh=_h,wh=i(353);function xh(){this.initialized=!1,this.resourcesParsed=!1,this.vertexBuffersToCreate=new wh.a,this.indexBuffersToCreate=new wh.a,this.buffers={},this.pendingBufferLoads=0,this.programsToCreate=new wh.a,this.shaders={},this.pendingShaderLoads=0,this.texturesToCreate=new wh.a,this.pendingTextureLoads=0,this.texturesToCreateFromBufferView=new wh.a,this.pendingBufferViewToImage=0,this.createSamplers=!0,this.createSkins=!0,this.createRuntimeAnimations=!0,this.createVertexArrays=!0,this.createRenderStates=!0,this.createUniformMaps=!0,this.createRuntimeNodes=!0,this.createdBufferViews={},this.primitivesToDecode=new wh.a,this.activeDecodingTasks=0,this.pendingDecodingCache=!1,this.skinnedNodesIds=[]}xh.prototype.getBuffer=function(e){return t=this.buffers[e.buffer],i=e.byteOffset,a=e.byteLength,t.subarray(i,i+a);var t,i,a},xh.prototype.finishedPendingBufferLoads=function(){return 0===this.pendingBufferLoads},xh.prototype.finishedBuffersCreation=function(){return 0===this.pendingBufferLoads&&0===this.vertexBuffersToCreate.length&&0===this.indexBuffersToCreate.length},xh.prototype.finishedProgramCreation=function(){return 0===this.pendingShaderLoads&&0===this.programsToCreate.length},xh.prototype.finishedTextureCreation=function(){var e=0===this.pendingTextureLoads,t=0===this.texturesToCreate.length&&0===this.texturesToCreateFromBufferView.length;return e&&t},xh.prototype.finishedEverythingButTextureCreation=function(){var e=0===this.pendingBufferLoads&&0===this.pendingShaderLoads,t=0===this.vertexBuffersToCreate.length&&0===this.indexBuffersToCreate.length&&0===this.programsToCreate.length&&0===this.pendingBufferViewToImage;return this.finishedDecoding()&&e&&t},xh.prototype.finishedDecoding=function(){return 0===this.primitivesToDecode.length&&0===this.activeDecodingTasks&&!this.pendingDecodingCache},xh.prototype.finished=function(){return this.finishedDecoding()&&this.finishedTextureCreation()&&this.finishedEverythingButTextureCreation()};var Eh=xh;function Th(e,t,i){this._name=t.name,this._id=i,this._uniformMap=e._uniformMaps[i],this._technique=void 0,this._program=void 0,this._values=void 0}Object.defineProperties(Th.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}}}),Th.prototype.setValue=function(e,t){var i="u_"+e,a=this._uniformMap.values[i];a.value=a.clone(t,a.value)},Th.prototype.getValue=function(e){var t="u_"+e,i=this._uniformMap.values[t];if(Object(s.default)(i))return i.value};var Ch=Th;function Ah(e,t,i){for(var a=[],r=e.primitives,n=r.length,o=0;o<n;++o){var s=r[o];a[o]=t[s.material]}this._name=e.name,this._materials=a,this._id=i}Object.defineProperties(Ah.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},materials:{get:function(){return this._materials}}});var jh=Ah;function Ph(e,t,i,a,r){this._model=e,this._runtimeNode=i,this._name=t.name,this._id=a,this.useMatrix=!1,this._show=!0,this._matrix=nt.default.clone(r),this._originalMatrix=nt.default.clone(r)}Object.defineProperties(Ph.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},show:{get:function(){return this._show},set:function(e){this._show!==e&&(this._show=e,this._model._perNodeShowDirty=!0)}},matrix:{get:function(){return this._matrix},set:function(e){this._matrix=nt.default.clone(e,this._matrix),this.useMatrix=!0;var t=this._model;t._cesiumAnimationsDirty=!0,this._runtimeNode.dirtyNumber=t._maxDirtyNumber}},originalMatrix:{get:function(){return this._originalMatrix}}}),Ph.prototype.setMatrix=function(e){nt.default.clone(e,this._matrix)};var Sh=Ph,Ih={updateForwardAxis:function(e){var t=e.gltf.extras.sourceVersion;(Object(s.default)(t)&&"2.0"!==t||"2.0"!==Ih.getAssetVersion(e.gltf))&&(e._gltfForwardAxis=hf.X)},getAssetVersion:function(e){return Object(s.default)(e.asset)&&Object(s.default)(e.asset.version)?e.asset.version:"1.0"},splitIncompatibleMaterials:function(e){var t=e.accessors,i=e.materials,a={};return Gf.mesh(e,(function(e){Gf.meshPrimitive(e,(function(e){var r,n,o=e.material,l=i[o],u=e.attributes.JOINTS_0;if(Object(s.default)(u)){var d=t[u];r=d.componentType,n=d.type}var f=Object(s.default)(u),c=Object(s.default)(e.attributes.COLOR_0),h=Object(s.default)(e.targets),p=Object(s.default)(e.attributes.NORMAL),m=Object(s.default)(e.attributes.TANGENT),_=Object(s.default)(e.attributes.TEXCOORD_0),g=a[o];if(Object(s.default)(g)){if(g.skinning.skinned!==f||g.skinning.type!==n||g.hasVertexColors!==c||g.hasMorphTargets!==h||g.hasNormals!==p||g.hasTangents!==m||g.hasTexCoords!==_){var v=Object(_f.default)(l,!0);o=Hf(i,v),e.material=o,a[o]={skinning:{skinned:f,componentType:r,type:n},hasVertexColors:c,hasMorphTargets:h,hasNormals:p,hasTangents:m,hasTexCoords:_}}}else a[o]={skinning:{skinned:f,componentType:r,type:n},hasVertexColors:c,hasMorphTargets:h,hasNormals:p,hasTangents:m,hasTexCoords:_}}))})),a},getShaderVariable:function(e){return"SCALAR"===e?"float":e.toLowerCase()},ModelState:{NEEDS_LOAD:0,LOADING:1,LOADED:2,FAILED:3},getFailedLoadFunction:function(e,t,i){return function(a){e._state=Ih.ModelState.FAILED;var r="Failed to load "+t+": "+i;Object(s.default)(a)&&(r+="\n"+a.message),e._readyPromise.reject(new $f.default(r))}},parseBuffers:function(e,t){var i=e._loadResources;Gf.buffer(e.gltf,(function(a,r){if(Object(s.default)(a.extras._pipeline.source))i.buffers[r]=a.extras._pipeline.source;else if(Object(s.default)(t)){var n=e._resource.getDerivedResource({url:a.uri});++i.pendingBufferLoads,n.fetchArrayBuffer().then(t(e,r)).otherwise(Ih.getFailedLoadFunction(e,"buffer",n.url))}}))}},Lh=new v.default,Dh=new v.default;function Mh(e,t){return Gf.techniqueAttribute(e,(function(e,i){if(e.semantic===t)return i}))}function Rh(e,t,i,a){return kf(e,"KHR_techniques_webgl")?function(e,t){if(!(e.semantic!==i||a&&Object(s.default)(e.node)))return t}:function(e,r){var n=t.parameters[e];if(!(n.semantic!==i||a&&Object(s.default)(n.node)))return r}}Ih.computeBoundingSphere=function(e){for(var t=e.gltf,i=t.nodes,a=t.meshes,n=t.scenes[t.scene].nodes,o=n.length,l=[],u=new v.default(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),d=new v.default(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),f=0;f<o;++f){var c=i[n[f]];for(c._transformToRoot=Ih.getTransform(c),l.push(c);l.length>0;){var h=(c=l.pop())._transformToRoot,p=c.mesh;if(Object(s.default)(p))for(var m=a[p].primitives,_=m.length,g=0;g<_;++g){var b=m[g].attributes.POSITION;if(Object(s.default)(b)){var y=Ih.getAccessorMinMax(t,b),O=v.default.fromArray(y.min,0,Lh),w=v.default.fromArray(y.max,0,Dh);Object(s.default)(u)&&Object(s.default)(d)&&(nt.default.multiplyByPoint(h,O,O),nt.default.multiplyByPoint(h,w,w),v.default.minimumByComponent(u,O,u),v.default.maximumByComponent(d,w,d))}}var x=c.children;if(Object(s.default)(x))for(var E=x.length,T=0;T<E;++T){var C=i[x[T]];C._transformToRoot=Ih.getTransform(C),nt.default.multiplyTransformation(h,C._transformToRoot,C._transformToRoot),l.push(C)}delete c._transformToRoot}}var A=r.default.fromCornerPoints(u,d);return e._forwardAxis===hf.Z&&r.default.transformWithoutScale(A,hf.Z_UP_TO_X_UP,A),e._upAxis===hf.Y?r.default.transformWithoutScale(A,hf.Y_UP_TO_Z_UP,A):e._upAxis===hf.X&&r.default.transformWithoutScale(A,hf.X_UP_TO_Z_UP,A),A},Ih.ensureSemanticExistence=function(e){return Gf.mesh(e,(function(t){Gf.meshPrimitive(t,(function(t){!function(e,t){var i=e.accessors,a=e.materials,r=e.extensions.KHR_techniques_webgl,n=r.techniques,o=r.programs,l=r.shaders,u=t.targets,d=t.attributes;for(var f in u)if(u.hasOwnProperty(f)){var c=u[f];for(var h in c)"extras"!==h&&(d[h+"_"+f]=c[h])}var p=n[a[t.material].extensions.KHR_techniques_webgl.technique],m=l[o[p.program].vertexShader];for(var _ in d)if(d.hasOwnProperty(_)&&!Object(s.default)(Mh(p,_))){var g=i[d[_]],v=_.toLowerCase();"_"===v.charAt(0)&&(v=v.slice(1));var b="a_"+v;p.attributes[b]={semantic:_,type:g.componentType};var y=m.extras._pipeline,O=y.source;O="attribute "+Ih.getShaderVariable(g.type)+" "+b+";\n"+O,y.source=O}}(e,t)}))})),e},Ih.createAttributeLocations=function(e,t){var i={},a=!1,r=1;if(Gf.techniqueAttribute(e,(function(e,t){/pos/i.test(t)&&!a?(i[t]=0,a=!0):i[t]=r++})),Object(s.default)(t))for(var n in t)t.hasOwnProperty(n)&&(i[n]=r++);return i},Ih.getAccessorMinMax=function(e,t){var i=e.accessors[t],a=i.extensions,r=i.min,n=i.max;if(Object(s.default)(a)){var o=a.WEB3D_quantized_attributes;Object(s.default)(o)&&(r=o.decodedMin,n=o.decodedMax)}return{min:r,max:n}},Ih.getAttributeOrUniformBySemantic=function(e,t,i,a){return Gf.technique(e,(function(r){if(!Object(s.default)(i)||r.program===i){var n=Gf.techniqueAttribute(r,Rh(e,r,t,a));return Object(s.default)(n)?n:Gf.techniqueUniform(r,Rh(e,r,t,a))}}))},Ih.getDiffuseAttributeOrUniform=function(e,t){var i=Ih.getAttributeOrUniformBySemantic(e,"COLOR_0",t);return Object(s.default)(i)||(i=Ih.getAttributeOrUniformBySemantic(e,"_3DTILESDIFFUSE",t)),i};var Nh=new v.default,Vh=new Dt.default,Bh=new v.default;function Uh(e,t,i){t+="(?!\\w)",t=new RegExp(t,"g");var a=e.search(t);return e.replace(t,(function(e,t){return a===t?e:i}))}function Fh(e,t){var i=e.accessors[t].extensions;if(Object(s.default)(i))return i.WEB3D_quantized_attributes}function Hh(e,t,i){var a=t.material,r=e.materials[a];if(kf(e,"KHR_techniques_webgl")&&Object(s.default)(r.extensions)&&Object(s.default)(r.extensions.KHR_techniques_webgl)){var n=r.extensions.KHR_techniques_webgl.technique,o=e.extensions.KHR_techniques_webgl.techniques[n];return Gf.techniqueAttribute(o,(function(e,t){if(e.semantic===i)return t}))}}function kh(e){var t={value:e,clone:function(e,t){return e},func:function(){return t.value}};return t}function zh(e){var t={value:g.default.fromArray(e),clone:g.default.clone,func:function(){return t.value}};return t}function Gh(e){var t={value:v.default.fromArray(e),clone:v.default.clone,func:function(){return t.value}};return t}function qh(e){var t={value:It.a.fromArray(e),clone:It.a.clone,func:function(){return t.value}};return t}function Wh(e){var t={value:el.a.fromColumnMajorArray(e),clone:el.a.clone,func:function(){return t.value}};return t}function Yh(e){var t={value:et.default.fromColumnMajorArray(e),clone:et.default.clone,func:function(){return t.value}};return t}function Kh(e){var t={value:nt.default.fromColumnMajorArray(e),clone:nt.default.clone,func:function(){return t.value}};return t}function Xh(e,t,i){this._value=void 0,this._textureId=e.index,this._textures=t,this._defaultTexture=i}Ih.getTransform=function(e,t){return Object(s.default)(e.matrix)?nt.default.fromColumnMajorArray(e.matrix,t):nt.default.fromTranslationQuaternionRotationScale(v.default.fromArray(e.translation,0,Nh),Dt.default.unpack(e.rotation,0,Vh),v.default.fromArray(e.scale,0,Bh),t)},Ih.getUsedExtensions=function(e){var t=e.extensionsUsed,i={};if(Object(s.default)(t))for(var a=t.length,r=0;r<a;r++){i[t[r]]=!0}return i},Ih.getRequiredExtensions=function(e){var t=e.extensionsRequired,i={};if(Object(s.default)(t))for(var a=t.length,r=0;r<a;r++){i[t[r]]=!0}return i},Ih.supportedExtensions={AGI_articulations:!0,CESIUM_RTC:!0,EXT_texture_webp:!0,KHR_blend:!0,KHR_binary_glTF:!0,KHR_draco_mesh_compression:!0,KHR_materials_common:!0,KHR_techniques_webgl:!0,KHR_materials_unlit:!0,KHR_materials_pbrSpecularGlossiness:!0,KHR_texture_transform:!0,WEB3D_quantized_attributes:!0},Ih.checkSupportedExtensions=function(e,t){for(var i in e)if(e.hasOwnProperty(i)){if(!Ih.supportedExtensions[i])throw new $f.default("Unsupported glTF Extension: "+i);if("EXT_texture_webp"===i&&!1===t)throw new $f.default("Loaded model requires WebP but browser does not support it.")}},Ih.checkSupportedGlExtensions=function(e,t){if(Object(s.default)(e))for(var i=e.length,a=0;a<i;a++){var r=e[a];if("OES_element_index_uint"!==r)throw new $f.default("Unsupported WebGL Extension: "+r);if(!t.elementIndexUint)throw new $f.default("OES_element_index_uint WebGL extension is not enabled.")}},Ih.modifyShaderForDracoQuantizedAttributes=function(e,t,i,a){var r={};for(var n in a)if(a.hasOwnProperty(n)){var o=a[n],l=o.quantization;if(!Object(s.default)(l))continue;var u=Hh(e,t,n);"_"===n.charAt(0)&&(n=n.substring(1));var d="gltf_u_dec_"+n.toLowerCase();if(!Object(s.default)(r[d])){var f,c="gltf_decoded_"+n,h=u.replace("a_","gltf_a_dec_"),p=o.componentsPerAttribute;i=Uh(i,u,h),i=(f=l.octEncoded?"vec3":p>1?"vec"+p:"float")+" "+h+";\n"+i;var m=3===p&&"COLOR_0"===n;m&&(i=Uh(i,h,"vec4("+h+", 1.0)"));var _="";if(l.octEncoded){var g=d+"_rangeConstant";i="uniform float "+g+";\n"+i,_="\nvoid main() {\n    "+h+" = czm_octDecode("+u+".xy, "+g+").zxy;\n    "+c+"();\n}\n"}else{var v=d+"_normConstant",b=d+"_min";i="uniform float "+v+";\nuniform "+f+" "+b+";\n"+i,_="\nvoid main() {\n    "+h+" = "+b+" + "+u+(m?".xyz":"")+" * "+v+";\n    "+c+"();\n}\n"}i=Nf.a.replaceMain(i,c),i+=_}}return{shader:i}},Ih.modifyShaderForQuantizedAttributes=function(e,t,i){var a={},r=t.attributes;for(var n in r)if(r.hasOwnProperty(n)){var o=Hh(e,t,n),l=t.attributes[n];"_"===n.charAt(0)&&(n=n.substring(1));var u="gltf_u_dec_"+n.toLowerCase(),d=u+"_scale",f=u+"_translate";if(!Object(s.default)(a[u])&&!Object(s.default)(a[d])){var c=Fh(e,l);if(Object(s.default)(c)){var h,p=c.decodeMatrix,m="gltf_decoded_"+n,_=o.replace("a_","gltf_a_dec_"),g=Math.floor(Math.sqrt(p.length));i=(h=g>2?"vec"+(g-1):"float")+" "+_+";\n"+(i=Uh(i,o,_));var v="";5===g?(i="uniform vec4 "+f+";\n"+(i="uniform mat4 "+d+";\n"+i),v="\nvoid main() {\n    "+_+" = "+d+" * "+o+" + "+f+";\n    "+m+"();\n}\n",a[d]={mat:4},a[f]={vec:4}):(i="uniform mat"+g+" "+u+";\n"+i,v="\nvoid main() {\n    "+_+" = "+h+"("+u+" * vec"+g+"("+o+",1.0));\n    "+m+"();\n}\n",a[u]={mat:g}),i=Nf.a.replaceMain(i,m),i+=v}}}return{shader:i,uniforms:a}},Ih.toClipCoordinatesGLSL=function(e,t){var i=Ih.getAttributeOrUniformBySemantic(e,"POSITION"),a=i.replace("a_","gltf_a_dec_");-1!==t.indexOf(a)&&(i=a);var r=Ih.getAttributeOrUniformBySemantic(e,"MODELVIEWPROJECTION",void 0,!0);if(!Object(s.default)(r)||-1===t.indexOf(r)){var n=Ih.getAttributeOrUniformBySemantic(e,"PROJECTION",void 0,!0),o=Ih.getAttributeOrUniformBySemantic(e,"MODELVIEW",void 0,!0);-1!==t.indexOf("czm_instanced_modelView ")?o="czm_instanced_modelView":Object(s.default)(o)||(o=Ih.getAttributeOrUniformBySemantic(e,"CESIUM_RTC_MODELVIEW",void 0,!0)),r=n+" * "+o}return r+" * vec4("+i+".xyz, 1.0)"},Ih.modifyFragmentShaderForLogDepth=function(e){return e=Nf.a.replaceMain(e,"czm_depth_main"),e+="\nvoid main() \n{ \n    czm_depth_main(); \n    czm_writeLogDepth(); \n} \n"},Ih.modifyVertexShaderForLogDepth=function(e,t){return e=Nf.a.replaceMain(e,"czm_depth_main"),e+="\nvoid main() \n{ \n    czm_depth_main(); \n    czm_vertexLogDepth("+t+"); \n} \n"},Object.defineProperties(Xh.prototype,{value:{get:function(){if(!Object(s.default)(this._value)){var e=this._textures[this._textureId];if(!Object(s.default)(e))return this._defaultTexture;this._value=e}return this._value},set:function(e){this._value=e}}}),Xh.prototype.clone=function(e){return e},Xh.prototype.func=void 0;var Zh={};function Jh(e){return[e[20],e[21],e[22],e[23]]}Zh[jf.a.FLOAT]=kh,Zh[jf.a.FLOAT_VEC2]=zh,Zh[jf.a.FLOAT_VEC3]=Gh,Zh[jf.a.FLOAT_VEC4]=qh,Zh[jf.a.INT]=kh,Zh[jf.a.INT_VEC2]=zh,Zh[jf.a.INT_VEC3]=Gh,Zh[jf.a.INT_VEC4]=qh,Zh[jf.a.BOOL]=kh,Zh[jf.a.BOOL_VEC2]=zh,Zh[jf.a.BOOL_VEC3]=Gh,Zh[jf.a.BOOL_VEC4]=qh,Zh[jf.a.FLOAT_MAT2]=Wh,Zh[jf.a.FLOAT_MAT3]=Yh,Zh[jf.a.FLOAT_MAT4]=Kh,Zh[jf.a.SAMPLER_2D]=function(e,t,i){var a=new Xh(e,t,i);return a.func=function(){return a.value},a},Ih.createUniformFunction=function(e,t,i,a){return Zh[e](t,i,a)},Ih.createUniformsForDracoQuantizedAttributes=function(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var a=e[i],r=a.quantization;if(!Object(s.default)(r))continue;"_"===i.charAt(0)&&(i=i.substring(1));var n="gltf_u_dec_"+i.toLowerCase();if(r.octEncoded){var o=n+"_rangeConstant",l=(1<<r.quantizationBits)-1;t[o]=kh(l).func;continue}var u=n+"_normConstant",d=r.range/(1<<r.quantizationBits);t[u]=kh(d).func;var f=n+"_min";switch(a.componentsPerAttribute){case 1:t[f]=kh(r.minValues).func;break;case 2:t[f]=zh(r.minValues).func;break;case 3:t[f]=Gh(r.minValues).func;break;case 4:t[f]=qh(r.minValues).func}}return t},Ih.createUniformsForQuantizedAttributes=function(e,t,i){var a,r=e.accessors,n={},o={},l=t.attributes;for(var u in l)if(l.hasOwnProperty(u)){var d=r[l[u]],f=d.extensions;if("_"===u.charAt(0)&&(u=u.substring(1)),Object(s.default)(f)){var c=f.WEB3D_quantized_attributes;if(Object(s.default)(c)){var h=c.decodeMatrix,p="gltf_u_dec_"+u.toLowerCase();switch(d.type){case ih.SCALAR:o[p]=Wh(h).func,n[p]=!0;break;case ih.VEC2:o[p]=Yh(h).func,n[p]=!0;break;case ih.VEC3:o[p]=Kh(h).func,n[p]=!0;break;case ih.VEC4:var m=p+"_scale",_=p+"_translate";o[m]=Kh((a=h,[a[0],a[1],a[2],a[3],a[5],a[6],a[7],a[8],a[10],a[11],a[12],a[13],a[15],a[16],a[17],a[18]])).func,o[_]=qh(Jh(h)).func,n[m]=!0,n[_]=!0}}}}for(var g in i)if(i.hasOwnProperty(g)&&!n[g]){var v=i[g];Object(s.default)(v.mat)&&(2===v.mat?o[g]=Wh(el.a.IDENTITY).func:3===v.mat?o[g]=Yh(et.default.IDENTITY).func:4===v.mat&&(o[g]=Kh(nt.default.IDENTITY).func)),Object(s.default)(v.vec)&&4===v.vec&&(o[g]=qh([0,0,0,0]).func)}return o};var Qh=new v.default,$h={MODEL:function(e,t){return function(){return e.model}},VIEW:function(e,t){return function(){return e.view}},PROJECTION:function(e,t){return function(){return e.projection}},MODELVIEW:function(e,t){return function(){return e.modelView}},CESIUM_RTC_MODELVIEW:function(e,t){var i=new nt.default;return function(){return Object(s.default)(t._rtcCenter)?(nt.default.getTranslation(e.model,Qh),v.default.add(Qh,t._rtcCenter,Qh),nt.default.multiplyByPoint(e.view,Qh,Qh),nt.default.setTranslation(e.modelView,Qh,i)):e.modelView}},MODELVIEWPROJECTION:function(e,t){return function(){return e.modelViewProjection}},MODELINVERSE:function(e,t){return function(){return e.inverseModel}},VIEWINVERSE:function(e,t){return function(){return e.inverseView}},PROJECTIONINVERSE:function(e,t){return function(){return e.inverseProjection}},MODELVIEWINVERSE:function(e,t){return function(){return e.inverseModelView}},MODELVIEWPROJECTIONINVERSE:function(e,t){return function(){return e.inverseModelViewProjection}},MODELINVERSETRANSPOSE:function(e,t){return function(){return e.inverseTransposeModel}},MODELVIEWINVERSETRANSPOSE:function(e,t){return function(){return e.normal}},VIEWPORT:function(e,t){return function(){return e.viewportCartesian4}}};Ih.getGltfSemanticUniforms=function(){return $h};var ep=Ih,tp=i(535);var ip=function(e){switch(e){case jf.a.FLOAT:return"float";case jf.a.FLOAT_VEC2:return"vec2";case jf.a.FLOAT_VEC3:return"vec3";case jf.a.FLOAT_VEC4:return"vec4";case jf.a.FLOAT_MAT2:return"mat2";case jf.a.FLOAT_MAT3:return"mat3";case jf.a.FLOAT_MAT4:return"mat4";case jf.a.SAMPLER_2D:return"sampler2D";case jf.a.BOOL:return"bool"}};function ap(e,t){var i;switch(i=Object(s.default)(t.value)?t.value:Object(s.default)(t.index)?[t.index]:t,e){case"ambient":case"diffuse":case"emission":case"specular":return 1===i.length?jf.a.SAMPLER_2D:jf.a.FLOAT_VEC4;case"shininess":case"transparency":return jf.a.FLOAT;case"transparent":case"doubleSided":return jf.a.BOOL}}var rp=function(e,t){if(t=Object(o.default)(t,o.default.EMPTY_OBJECT),Object(s.default)(e)&&kf(e,"KHR_materials_common")){kf(e,"KHR_techniques_webgl")||(Object(s.default)(e.extensions)||(e.extensions={}),e.extensions.KHR_techniques_webgl={programs:[],shaders:[],techniques:[]},e.extensionsUsed.push("KHR_techniques_webgl"),e.extensionsRequired.push("KHR_techniques_webgl"));var i=e.extensions.KHR_techniques_webgl;!function(e){var t=e.extensions.KHR_materials_common;if(!Object(s.default)(t)||!Object(s.default)(t.lights))return;for(var i=t.lights,a=i.length,r=0;r<a;r++){var n=i[r];if("ambient"===n.type){Object(s.default)(n.ambient)||(n.ambient={});var l=n.ambient;Object(s.default)(l.color)||(l.color=[1,1,1])}else if("directional"===n.type){Object(s.default)(n.directional)||(n.directional={});var u=n.directional;Object(s.default)(u.color)||(u.color=[1,1,1])}else if("point"===n.type){Object(s.default)(n.point)||(n.point={});var d=n.point;Object(s.default)(d.color)||(d.color=[1,1,1]),d.constantAttenuation=Object(o.default)(d.constantAttenuation,1),d.linearAttenuation=Object(o.default)(d.linearAttenuation,0),d.quadraticAttenuation=Object(o.default)(d.quadraticAttenuation,0)}else if("spot"===n.type){Object(s.default)(n.spot)||(n.spot={});var f=n.spot;Object(s.default)(f.color)||(f.color=[1,1,1]),f.constantAttenuation=Object(o.default)(f.constantAttenuation,1),f.fallOffAngle=Object(o.default)(f.fallOffAngle,3.14159265),f.fallOffExponent=Object(o.default)(f.fallOffExponent,0),f.linearAttenuation=Object(o.default)(f.linearAttenuation,0),f.quadraticAttenuation=Object(o.default)(f.quadraticAttenuation,0)}}}(e);var a=function(e){var t,i={};Object(s.default)(e.extensions)&&Object(s.default)(e.extensions.KHR_materials_common)&&(t=e.extensions.KHR_materials_common.lights);if(Object(s.default)(t)){var a=e.nodes;for(var r in a)if(a.hasOwnProperty(r)){var n=a[r];if(Object(s.default)(n.extensions)&&Object(s.default)(n.extensions.KHR_materials_common)){var o=n.extensions.KHR_materials_common.light;Object(s.default)(o)&&Object(s.default)(t[o])&&(t[o].node=r),delete n.extensions.KHR_materials_common}}var l=0;for(var u in t)if(t.hasOwnProperty(u)){var d=t[u],f=d.type;if("ambient"!==f&&!Object(s.default)(d.node)){delete t[u];continue}var c="light"+l.toString();switch(d.baseName=c,f){case"ambient":var h=d.ambient;i[c+"Color"]={type:jf.a.FLOAT_VEC3,value:h.color};break;case"directional":var p=d.directional;i[c+"Color"]={type:jf.a.FLOAT_VEC3,value:p.color},Object(s.default)(d.node)&&(i[c+"Transform"]={node:d.node,semantic:"MODELVIEW",type:jf.a.FLOAT_MAT4});break;case"point":var m=d.point;i[c+"Color"]={type:jf.a.FLOAT_VEC3,value:m.color},Object(s.default)(d.node)&&(i[c+"Transform"]={node:d.node,semantic:"MODELVIEW",type:jf.a.FLOAT_MAT4}),i[c+"Attenuation"]={type:jf.a.FLOAT_VEC3,value:[m.constantAttenuation,m.linearAttenuation,m.quadraticAttenuation]};break;case"spot":var _=d.spot;i[c+"Color"]={type:jf.a.FLOAT_VEC3,value:_.color},Object(s.default)(d.node)&&(i[c+"Transform"]={node:d.node,semantic:"MODELVIEW",type:jf.a.FLOAT_MAT4},i[c+"InverseTransform"]={node:d.node,semantic:"MODELVIEWINVERSE",type:jf.a.FLOAT_MAT4,useInFragment:!0}),i[c+"Attenuation"]={type:jf.a.FLOAT_VEC3,value:[_.constantAttenuation,_.linearAttenuation,_.quadraticAttenuation]},i[c+"FallOff"]={type:jf.a.FLOAT_VEC2,value:[_.fallOffAngle,_.fallOffExponent]}}++l}}return i}(e),r=ep.splitIncompatibleMaterials(e),n={},l=!1;return Gf.material(e,(function(u,d){if(Object(s.default)(u.extensions)&&Object(s.default)(u.extensions.KHR_materials_common)){var f=u.extensions.KHR_materials_common,c=r[d],h=function(e,t){var i="";i+="technique:"+e.technique+";";for(var a=e.values,r=Object.keys(a).sort(),n=r.length,l=0;l<n;++l){var u=r[l];a.hasOwnProperty(u)&&(i+=u+":"+ap(u,a[u]),i+=";")}var d=Object(o.default)(e.jointCount,0);if(i+=d.toString()+";",Object(s.default)(t)){var f=t.skinning;d>0&&(i+=f.type+";"),i+=t.hasVertexColors}return i}(f,c),p=n[h];Object(s.default)(p)||(p=function(e,t,i,a,r,n){Object(s.default)(a)||(a={});n=Object(o.default)(n,!1);var l,u=t.techniques,d=t.shaders,f=t.programs,c=a.technique.toUpperCase();Object(s.default)(e.extensions)&&Object(s.default)(e.extensions.KHR_materials_common)&&(l=e.extensions.KHR_materials_common.lights);var h,p=a.values,m=Object(o.default)(a.jointCount,0),_=!1,g=!1;Object(s.default)(i)&&(h=i.skinning,_=h.skinned,g=i.hasVertexColors);var v,b="precision highp float;\n",y="precision highp float;\n",O="CONSTANT"!==c,w={u_modelViewMatrix:{semantic:kf(e,"CESIUM_RTC")?"CESIUM_RTC_MODELVIEW":"MODELVIEW",type:jf.a.FLOAT_MAT4},u_projectionMatrix:{semantic:"PROJECTION",type:jf.a.FLOAT_MAT4}};O&&(w.u_normalMatrix={semantic:"MODELVIEWINVERSETRANSPOSE",type:jf.a.FLOAT_MAT3});_&&(w.u_jointMatrix={count:m,semantic:"JOINTMATRIX",type:jf.a.FLOAT_MAT4});var x=!1;for(var E in p)if(p.hasOwnProperty(E)&&"transparent"!==E&&"doubleSided"!==E){var T=ap(E,p[E]);v="u_"+E.toLowerCase(),x||T!==jf.a.SAMPLER_2D||(x=!0),w[v]={type:T}}Object(s.default)(w.u_diffuse)&&(w.u_diffuse.semantic="_3DTILESDIFFUSE");if(Object(s.default)(r))for(var C in r)r.hasOwnProperty(C)&&(w[v="u_"+C]=r[C]);for(v in w)if(w.hasOwnProperty(v)){var A=w[v],j=Object(s.default)(A.count)?"["+A.count+"]":"";A.type!==jf.a.FLOAT_MAT3&&A.type!==jf.a.FLOAT_MAT4||A.useInFragment?(y+="uniform "+ip(A.type)+" "+v+j+";\n",delete A.useInFragment):b+="uniform "+ip(A.type)+" "+v+j+";\n"}var P="";if(_){var S,I,L=qf(h.type),D=!1;if(0===h.type.indexOf("MAT")&&(D=!0,L=Math.sqrt(L)),D)for(S=0;S<L;S++)for(I=0;I<L;I++)P+=0===S&&0===I?"  mat4 skinMat = ":"  skinMat += ",P+="a_weight["+S+"]["+I+"] * u_jointMatrix[int(a_joint["+S+"]["+I+"])];\n";else for(S=0;S<L;S++)P+=0===S?"  mat4 skinMat = ":"  skinMat += ",P+="a_weight["+S+"] * u_jointMatrix[int(a_joint["+S+"])];\n"}var M,R={a_position:{semantic:"POSITION"}};b+="attribute vec3 a_position;\n",b+="varying vec3 v_positionEC;\n",P+=_?"  vec4 pos = u_modelViewMatrix * skinMat * vec4(a_position,1.0);\n":"  vec4 pos = u_modelViewMatrix * vec4(a_position,1.0);\n";P+="  v_positionEC = pos.xyz;\n",P+="  gl_Position = u_projectionMatrix * pos;\n",y+="varying vec3 v_positionEC;\n",O&&(R.a_normal={semantic:"NORMAL"},b+="attribute vec3 a_normal;\n",b+="varying vec3 v_normal;\n",P+=_?"  v_normal = u_normalMatrix * mat3(skinMat) * a_normal;\n":"  v_normal = u_normalMatrix * a_normal;\n",y+="varying vec3 v_normal;\n");x&&(R.a_texcoord_0={semantic:"TEXCOORD_0"},b+="attribute vec2 a_texcoord_0;\n",b+="varying vec2 "+(M="v_texcoord_0")+";\n",P+="  "+M+" = a_texcoord_0;\n",y+="varying vec2 "+M+";\n");if(_){var N=ep.getShaderVariable(h.type);R.a_joint={semantic:"JOINT"},R.a_weight={semantic:"WEIGHT"},b+="attribute "+N+" a_joint;\n",b+="attribute "+N+" a_weight;\n"}g&&(R.a_vertexColor={semantic:"COLOR_0"},b+="attribute vec4 a_vertexColor;\n",b+="varying vec4 v_vertexColor;\n",P+="  v_vertexColor = a_vertexColor;\n",y+="varying vec4 v_vertexColor;\n");n&&(R.a_batchId={semantic:"_BATCHID"},b+="attribute float a_batchId;\n");var V=O&&("BLINN"===c||"PHONG"===c)&&Object(s.default)(w.u_specular)&&Object(s.default)(w.u_shininess)&&w.u_shininess>0,B=!1,U=!1,F="";for(var H in l)if(l.hasOwnProperty(H)){var k=l[H],z=k.type.toLowerCase(),G=k.baseName;F+="  {\n";var q,W,Y="u_"+G+"Color";"ambient"===z?(U=!0,F+="    ambientLight += "+Y+";\n"):O&&(B=!0,q="v_"+G+"Direction",W="v_"+G+"Position","point"!==z&&(b+="varying vec3 "+q+";\n",y+="varying vec3 "+q+";\n",P+="  "+q+" = mat3(u_"+G+"Transform) * vec3(0.,0.,1.);\n","directional"===z&&(F+="    vec3 l = normalize("+q+");\n")),"directional"!==z?(b+="varying vec3 "+W+";\n",y+="varying vec3 "+W+";\n",P+="  "+W+" = u_"+G+"Transform[3].xyz;\n",F+="    vec3 VP = "+W+" - v_positionEC;\n",F+="    vec3 l = normalize(VP);\n",F+="    float range = length(VP);\n",F+="    float attenuation = 1.0 / (u_"+G+"Attenuation.x + ",F+="(u_"+G+"Attenuation.y * range) + ",F+="(u_"+G+"Attenuation.z * range * range));\n"):F+="    float attenuation = 1.0;\n","spot"===z&&(F+="    float spotDot = dot(l, normalize("+q+"));\n",F+="    if (spotDot < cos(u_"+G+"FallOff.x * 0.5))\n",F+="    {\n",F+="      attenuation = 0.0;\n",F+="    }\n",F+="    else\n",F+="    {\n",F+="        attenuation *= max(0.0, pow(spotDot, u_"+G+"FallOff.y));\n",F+="    }\n"),F+="    diffuseLight += "+Y+"* max(dot(normal,l), 0.) * attenuation;\n",V&&("BLINN"===c?(F+="    vec3 h = normalize(l + viewDir);\n",F+="    float specularIntensity = max(0., pow(max(dot(normal, h), 0.), u_shininess)) * attenuation;\n"):(F+="    vec3 reflectDir = reflect(-l, normal);\n",F+="    float specularIntensity = max(0., pow(max(dot(reflectDir, viewDir), 0.), u_shininess)) * attenuation;\n"),F+="    specularLight += "+Y+" * specularIntensity;\n")),F+="  }\n"}U||(F+="  ambientLight += vec3(0.2, 0.2, 0.2);\n");if(!B&&"CONSTANT"!==c){y+="#ifdef USE_CUSTOM_LIGHT_COLOR \n",y+="uniform vec3 gltf_lightColor; \n",y+="#endif \n",F+="#ifndef USE_CUSTOM_LIGHT_COLOR \n",F+="    vec3 lightColor = czm_lightColor;\n",F+="#else \n",F+="    vec3 lightColor = gltf_lightColor;\n",F+="#endif \n",F+="  vec3 l = normalize(czm_lightDirectionEC);\n";F+="  diffuseLight += lightColor * max(dot(normal,l), 0.2);\n",V&&("BLINN"===c?(F+="  vec3 h = normalize(l + viewDir);\n",F+="  float specularIntensity = max(0., pow(max(dot(normal, h), 0.), u_shininess));\n"):(F+="  vec3 reflectDir = reflect(-l, normal);\n",F+="  float specularIntensity = max(0., pow(max(dot(reflectDir, viewDir), 0.), u_shininess));\n"),F+="  specularLight += lightColor * specularIntensity;\n")}b+="void main(void) {\n",b+=P,b+="}\n",y+="void main(void) {\n";var K,X="  vec3 color = vec3(0.0, 0.0, 0.0);\n";O&&(y+="  vec3 normal = normalize(v_normal);\n",a.doubleSided&&(y+="  if (gl_FrontFacing == false)\n",y+="  {\n",y+="    normal = -normal;\n",y+="  }\n"));"CONSTANT"!==c?(Object(s.default)(w.u_diffuse)&&(w.u_diffuse.type===jf.a.SAMPLER_2D?y+="  vec4 diffuse = texture2D(u_diffuse, "+M+");\n":y+="  vec4 diffuse = u_diffuse;\n",y+="  vec3 diffuseLight = vec3(0.0, 0.0, 0.0);\n",X+="  color += diffuse.rgb * diffuseLight;\n"),V&&(w.u_specular.type===jf.a.SAMPLER_2D?y+="  vec3 specular = texture2D(u_specular, "+M+").rgb;\n":y+="  vec3 specular = u_specular.rgb;\n",y+="  vec3 specularLight = vec3(0.0, 0.0, 0.0);\n",X+="  color += specular * specularLight;\n"),K=Object(s.default)(w.u_transparency)?"  gl_FragColor = vec4(color * diffuse.a * u_transparency, diffuse.a * u_transparency);\n":"  gl_FragColor = vec4(color * diffuse.a, diffuse.a);\n"):K=Object(s.default)(w.u_transparency)?"  gl_FragColor = vec4(color * u_transparency, u_transparency);\n":"  gl_FragColor = vec4(color, 1.0);\n";g&&(X+="  color *= v_vertexColor.rgb;\n");Object(s.default)(w.u_emission)&&(w.u_emission.type===jf.a.SAMPLER_2D?y+="  vec3 emission = texture2D(u_emission, "+M+").rgb;\n":y+="  vec3 emission = u_emission.rgb;\n",X+="  color += emission;\n");(Object(s.default)(w.u_ambient)||"CONSTANT"!==c)&&(Object(s.default)(w.u_ambient)?w.u_ambient.type===jf.a.SAMPLER_2D?y+="  vec3 ambient = texture2D(u_ambient, "+M+").rgb;\n":y+="  vec3 ambient = u_ambient.rgb;\n":y+="  vec3 ambient = diffuse.rgb;\n",X+="  color += ambient * ambientLight;\n");y+="  vec3 viewDir = -normalize(v_positionEC);\n",y+="  vec3 ambientLight = vec3(0.0, 0.0, 0.0);\n",y+=F,y+=X,y+=K,y+="}\n";var Z=Hf(d,{type:jf.a.VERTEX_SHADER,extras:{_pipeline:{source:b,extension:".glsl"}}}),J=Hf(d,{type:jf.a.FRAGMENT_SHADER,extras:{_pipeline:{source:y,extension:".glsl"}}}),Q=Hf(f,{fragmentShader:J,vertexShader:Z});return Hf(u,{attributes:R,program:Q,uniforms:w})}(e,i,c,f,a,t.addBatchIdToGeneratedShaders),n[h]=p,l=!0);var m={},_=f.values;for(var g in _)_.hasOwnProperty(g)&&"transparent"!==g&&"doubleSided"!==g&&(m["u_"+g.toLowerCase()]=_[g]);u.extensions.KHR_techniques_webgl={technique:p,values:m},u.alphaMode="OPAQUE",f.transparent&&(u.alphaMode="BLEND"),f.doubleSided&&(u.doubleSided=!0)}})),l?(ep.ensureSemanticExistence(e),e):e}};function np(e,t,i,a,r){var n;return Object(s.default)(i[t+"Offset"])?(n=t+"Coord",r.fragmentShaderMain+="    vec2 "+n+" = computeTexCoord("+a+", "+t+"Offset, "+t+"Rotation, "+t+"Scale);\n"):n=a,n}var op=[0,0],sp=[0],lp=[1,1];function up(e,t,i){if(-1!==e.indexOf("Texture")&&Object(s.default)(t.extensions)&&Object(s.default)(t.extensions.KHR_texture_transform)){var a="u_"+e,r=t.extensions.KHR_texture_transform;i[a+"Offset"]=Object(o.default)(r.offset,op),i[a+"Rotation"]=Object(o.default)(r.rotation,sp),i[a+"Scale"]=Object(o.default)(r.scale,lp),Object(s.default)(t.texCoord)&&Object(s.default)(r.texCoord)&&(i[a].texCoord=r.texCoord)}}function dp(e){if(-1!==e.indexOf("Offset"))return jf.a.FLOAT_VEC2;if(-1!==e.indexOf("Rotation"))return jf.a.FLOAT;if(-1!==e.indexOf("Scale"))return jf.a.FLOAT_VEC2;if(-1!==e.indexOf("Texture"))return jf.a.SAMPLER_2D;switch(e){case"u_baseColorFactor":return jf.a.FLOAT_VEC4;case"u_metallicFactor":case"u_roughnessFactor":return jf.a.FLOAT;case"u_emissiveFactor":return jf.a.FLOAT_VEC3;case"u_diffuseFactor":return jf.a.FLOAT_VEC4;case"u_specularFactor":return jf.a.FLOAT_VEC3;case"u_glossinessFactor":return jf.a.FLOAT}}var fp=function(e,t){if(t=Object(o.default)(t,o.default.EMPTY_OBJECT),kf(e,"KHR_techniques_webgl"))return e;if(!Object(s.default)(e.materials)||0===e.materials.length)return e;Object(s.default)(e.extensions)||(e.extensions={}),Object(s.default)(e.extensionsUsed)||(e.extensionsUsed=[]),Object(s.default)(e.extensionsRequired)||(e.extensionsRequired=[]),e.extensions.KHR_techniques_webgl={programs:[],shaders:[],techniques:[]},e.extensionsUsed.push("KHR_techniques_webgl"),e.extensionsRequired.push("KHR_techniques_webgl");var i=ep.splitIncompatibleMaterials(e);return Gf.material(e,(function(a,r){var n={},l=function(e,t,i,a,r,n){var l,u,d,f=Object(o.default)(n.addBatchIdToGeneratedShaders,!1),c=e.extensions.KHR_techniques_webgl,h=c.techniques,p=c.shaders,m=c.programs,_=function(e){return Object(s.default)(e.extensions)&&Object(s.default)(e.extensions.KHR_materials_pbrSpecularGlossiness)}(t),g=t.pbrMetallicRoughness;if(Object(s.default)(g)&&!_)for(u in g)g.hasOwnProperty(u)&&(d=g[u],a[l="u_"+u]=d,up(u,d,a));if(_){var v=t.extensions.KHR_materials_pbrSpecularGlossiness;for(u in v)v.hasOwnProperty(u)&&(d=v[u],a[l="u_"+u]=d,up(u,d,a))}for(var b in t)t.hasOwnProperty(b)&&(b.indexOf("Texture")>=0||b.indexOf("Factor")>=0)&&(d=t[b],a[l="u_"+b]=d,up(b,d,a));var y,O="precision highp float;\n",w="precision highp float;\n";Object(s.default)(e.skins)&&(y=e.skins[0]);var x,E,T=Object(s.default)(y)?y.joints:[],C=T.length,A=r[i],j=!1,P=!1,S=!1,I=!1,L=!1,D=!1,M=!1;Object(s.default)(A)&&(x=A.skinning,j=x.skinned&&T.length>0,P=A.hasVertexColors,S=A.hasMorphTargets,I=A.hasNormals,L=A.hasTangents,D=A.hasTexCoords);S&&Gf.mesh(e,(function(e){Gf.meshPrimitive(e,(function(e){if(e.material===i){var t=e.targets;Object(s.default)(t)&&(E=t)}}))}));var R={u_modelViewMatrix:{semantic:kf(e,"CESIUM_RTC")?"CESIUM_RTC_MODELVIEW":"MODELVIEW",type:jf.a.FLOAT_MAT4},u_projectionMatrix:{semantic:"PROJECTION",type:jf.a.FLOAT_MAT4}};Object(s.default)(t.extensions)&&Object(s.default)(t.extensions.KHR_materials_unlit)&&(M=!0,I=!1,L=!1);I&&(R.u_normalMatrix={semantic:"MODELVIEWINVERSETRANSPOSE",type:jf.a.FLOAT_MAT3});j&&(R.u_jointMatrix={count:C,semantic:"JOINTMATRIX",type:jf.a.FLOAT_MAT4});S&&(R.u_morphWeights={count:E.length,semantic:"MORPHWEIGHTS",type:jf.a.FLOAT});var N=t.alphaMode;Object(s.default)(N)&&"MASK"===N&&(R.u_alphaCutoff={semantic:"ALPHACUTOFF",type:jf.a.FLOAT});for(l in a)a.hasOwnProperty(l)&&(R[l]={type:dp(l)});var V=Object(o.default)(R.u_baseColorTexture,R.u_baseColorFactor);Object(s.default)(V)&&(V.semantic="_3DTILESDIFFUSE");for(l in R)if(R.hasOwnProperty(l)){var B=R[l],U=Object(s.default)(B.count)?"["+B.count+"]":"";B.type!==jf.a.FLOAT_MAT3&&B.type!==jf.a.FLOAT_MAT4&&"u_morphWeights"!==l||B.useInFragment?(w+="uniform "+ip(B.type)+" "+l+U+";\n",delete B.useInFragment):O+="uniform "+ip(B.type)+" "+l+U+";\n"}var F="";if(j){var H,k,z=qf(x.type),G=!1;if(0===x.type.indexOf("MAT")&&(G=!0,z=Math.sqrt(z)),G)for(H=0;H<z;H++)for(k=0;k<z;k++)F+=0===H&&0===k?"    mat4 skinMatrix = ":"    skinMatrix += ",F+="a_weight["+H+"]["+k+"] * u_jointMatrix[int(a_joint["+H+"]["+k+"])];\n";else for(H=0;H<z;H++)F+=0===H?"    mat4 skinMatrix = ":"    skinMatrix += ",F+="a_weight["+H+"] * u_jointMatrix[int(a_joint["+H+"])];\n"}var q={a_position:{semantic:"POSITION"}};O+="attribute vec3 a_position;\n",I&&(O+="varying vec3 v_positionEC;\n");F+="    vec3 weightedPosition = a_position;\n",I&&(F+="    vec3 weightedNormal = a_normal;\n");L&&(F+="    vec4 weightedTangent = a_tangent;\n");if(S)for(var W=0;W<E.length;W++){var Y=E[W];for(var K in Y)if(Y.hasOwnProperty(K)&&"extras"!==K){var X="a_"+K+"_"+W;q[X]={semantic:K+"_"+W},O+="attribute vec3 "+X+";\n","POSITION"===K?F+="    weightedPosition += u_morphWeights["+W+"] * "+X+";\n":"NORMAL"===K?F+="    weightedNormal += u_morphWeights["+W+"] * "+X+";\n":L&&"TANGENT"===K&&(F+="    weightedTangent.xyz += u_morphWeights["+W+"] * "+X+";\n")}}F+=j?"    vec4 position = skinMatrix * vec4(weightedPosition, 1.0);\n":"    vec4 position = vec4(weightedPosition, 1.0);\n";F+="    position = u_modelViewMatrix * position;\n",I&&(F+="    v_positionEC = position.xyz;\n");F+="    gl_Position = u_projectionMatrix * position;\n",I&&(q.a_normal={semantic:"NORMAL"},O+="attribute vec3 a_normal;\n",O+="varying vec3 v_normal;\n",F+=j?"    v_normal = u_normalMatrix * mat3(skinMatrix) * weightedNormal;\n":"    v_normal = u_normalMatrix * weightedNormal;\n",w+="varying vec3 v_normal;\n",w+="varying vec3 v_positionEC;\n");L&&(q.a_tangent={semantic:"TANGENT"},O+="attribute vec4 a_tangent;\n",O+="varying vec4 v_tangent;\n",F+="    v_tangent.xyz = u_normalMatrix * weightedTangent.xyz;\n",F+="    v_tangent.w = weightedTangent.w;\n",w+="varying vec4 v_tangent;\n");var Z,J,Q,$,ee,te,ie,ae,re="";if(D){q.a_texcoord_0={semantic:"TEXCOORD_0"},O+="attribute vec2 a_texcoord_0;\n",O+="varying vec2 "+(Z="v_texcoord_0")+";\n",F+="    "+Z+" = a_texcoord_0;\n",w+="varying vec2 "+Z+";\n";var ne={fragmentShaderMain:re};J=np(e,"u_normalTexture",a,Z,ne),Q=np(e,"u_baseColorTexture",a,Z,ne),$=np(e,"u_specularGlossinessTexture",a,Z,ne),ee=np(e,"u_diffuseTexture",a,Z,ne),te=np(e,"u_metallicRoughnessTexture",a,Z,ne),ie=np(e,"u_occlusionTexture",a,Z,ne),ae=np(e,"u_emmissiveTexture",a,Z,ne),re=ne.fragmentShaderMain}if(j){var oe=ep.getShaderVariable(x.type);q.a_joint={semantic:"JOINTS_0"},q.a_weight={semantic:"WEIGHTS_0"},O+="attribute "+oe+" a_joint;\n",O+="attribute "+oe+" a_weight;\n"}P&&(q.a_vertexColor={semantic:"COLOR_0"},O+="attribute vec4 a_vertexColor;\n",O+="varying vec4 v_vertexColor;\n",F+="  v_vertexColor = a_vertexColor;\n",w+="varying vec4 v_vertexColor;\n");f&&(q.a_batchId={semantic:"_BATCHID"},O+="attribute float a_batchId;\n");O+="void main(void) \n{\n",O+=F,O+="}\n",I&&(w+="const float M_PI = 3.141592653589793;\n",w+="vec3 lambertianDiffuse(vec3 diffuseColor) \n{\n    return diffuseColor / M_PI;\n}\n\n",w+="vec3 fresnelSchlick2(vec3 f0, vec3 f90, float VdotH) \n{\n    return f0 + (f90 - f0) * pow(clamp(1.0 - VdotH, 0.0, 1.0), 5.0);\n}\n\n",w+="vec3 fresnelSchlick(float metalness, float VdotH) \n{\n    return metalness + (vec3(1.0) - metalness) * pow(1.0 - VdotH, 5.0);\n}\n\n",w+="float smithVisibilityG1(float NdotV, float roughness) \n{\n    float k = (roughness + 1.0) * (roughness + 1.0) / 8.0;\n    return NdotV / (NdotV * (1.0 - k) + k);\n}\n\n",w+="float smithVisibilityGGX(float roughness, float NdotL, float NdotV) \n{\n    return smithVisibilityG1(NdotL, roughness) * smithVisibilityG1(NdotV, roughness);\n}\n\n",w+="float GGX(float roughness, float NdotH) \n{\n    float roughnessSquared = roughness * roughness;\n    float f = (NdotH * roughnessSquared - NdotH) * NdotH + 1.0;\n    return roughnessSquared / (M_PI * f * f);\n}\n\n");w+="vec3 SRGBtoLINEAR3(vec3 srgbIn) \n{\n    return pow(srgbIn, vec3(2.2));\n}\n\n",w+="vec4 SRGBtoLINEAR4(vec4 srgbIn) \n{\n    vec3 linearOut = pow(srgbIn.rgb, vec3(2.2));\n    return vec4(linearOut, srgbIn.a);\n}\n\n",w+="vec3 applyTonemapping(vec3 linearIn) \n{\n#ifndef HDR \n    return czm_acesTonemapping(linearIn);\n#else \n    return linearIn;\n#endif \n}\n\n",w+="vec3 LINEARtoSRGB(vec3 linearIn) \n{\n#ifndef HDR \n    return pow(linearIn, vec3(1.0/2.2));\n#else \n    return linearIn;\n#endif \n}\n\n",w+="vec2 computeTexCoord(vec2 texCoords, vec2 offset, float rotation, vec2 scale) \n{\n    rotation = -rotation; \n    mat3 transform = mat3(\n        cos(rotation) * scale.x, sin(rotation) * scale.x, 0.0, \n       -sin(rotation) * scale.y, cos(rotation) * scale.y, 0.0, \n        offset.x, offset.y, 1.0); \n    vec2 transformedTexCoords = (transform * vec3(fract(texCoords), 1.0)).xy; \n    return transformedTexCoords; \n}\n\n",w+="#ifdef USE_IBL_LIGHTING \n",w+="uniform vec2 gltf_iblFactor; \n",w+="#endif \n",w+="#ifdef USE_CUSTOM_LIGHT_COLOR \n",w+="uniform vec3 gltf_lightColor; \n",w+="#endif \n",w+="void main(void) \n{\n",w+=re,I&&(w+="    vec3 ng = normalize(v_normal);\n",w+="    vec3 positionWC = vec3(czm_inverseView * vec4(v_positionEC, 1.0));\n",Object(s.default)(a.u_normalTexture)?L?(w+="    vec3 t = normalize(v_tangent.xyz);\n",w+="    vec3 b = normalize(cross(ng, t) * v_tangent.w);\n",w+="    mat3 tbn = mat3(t, b, ng);\n",w+="    vec3 n = texture2D(u_normalTexture, "+J+").rgb;\n",w+="    n = normalize(tbn * (2.0 * n - 1.0));\n"):(w="#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n"+w,w+="#ifdef GL_OES_standard_derivatives\n",w+="    vec3 pos_dx = dFdx(v_positionEC);\n",w+="    vec3 pos_dy = dFdy(v_positionEC);\n",w+="    vec3 tex_dx = dFdx(vec3("+J+",0.0));\n",w+="    vec3 tex_dy = dFdy(vec3("+J+",0.0));\n",w+="    vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n",w+="    t = normalize(t - ng * dot(ng, t));\n",w+="    vec3 b = normalize(cross(ng, t));\n",w+="    mat3 tbn = mat3(t, b, ng);\n",w+="    vec3 n = texture2D(u_normalTexture, "+J+").rgb;\n",w+="    n = normalize(tbn * (2.0 * n - 1.0));\n",w+="#else\n",w+="    vec3 n = ng;\n",w+="#endif\n"):w+="    vec3 n = ng;\n",t.doubleSided&&(w+="    if (gl_FrontFacing == false)\n",w+="    {\n",w+="        n = -n;\n",w+="    }\n"));Object(s.default)(a.u_baseColorTexture)?(w+="    vec4 baseColorWithAlpha = SRGBtoLINEAR4(texture2D(u_baseColorTexture, "+Q+"));\n",Object(s.default)(a.u_baseColorFactor)&&(w+="    baseColorWithAlpha *= u_baseColorFactor;\n")):Object(s.default)(a.u_baseColorFactor)?w+="    vec4 baseColorWithAlpha = u_baseColorFactor;\n":w+="    vec4 baseColorWithAlpha = vec4(1.0);\n";P&&(w+="    baseColorWithAlpha *= v_vertexColor;\n");w+="    vec3 baseColor = baseColorWithAlpha.rgb;\n",I?(_?(Object(s.default)(a.u_specularGlossinessTexture)?(w+="    vec4 specularGlossiness = SRGBtoLINEAR4(texture2D(u_specularGlossinessTexture, "+$+"));\n",w+="    vec3 specular = specularGlossiness.rgb;\n",w+="    float glossiness = specularGlossiness.a;\n",Object(s.default)(a.u_specularFactor)&&(w+="    specular *= u_specularFactor;\n"),Object(s.default)(a.u_glossinessFactor)&&(w+="    glossiness *= u_glossinessFactor;\n")):(Object(s.default)(a.u_specularFactor)?w+="    vec3 specular = clamp(u_specularFactor, vec3(0.0), vec3(1.0));\n":w+="    vec3 specular = vec3(1.0);\n",Object(s.default)(a.u_glossinessFactor)?w+="    float glossiness = clamp(u_glossinessFactor, 0.0, 1.0);\n":w+="    float glossiness = 1.0;\n"),Object(s.default)(a.u_diffuseTexture)?(w+="    vec4 diffuse = SRGBtoLINEAR4(texture2D(u_diffuseTexture, "+ee+"));\n",Object(s.default)(a.u_diffuseFactor)&&(w+="    diffuse *= u_diffuseFactor;\n")):Object(s.default)(a.u_diffuseFactor)?w+="    vec4 diffuse = clamp(u_diffuseFactor, vec4(0.0), vec4(1.0));\n":w+="    vec4 diffuse = vec4(1.0);\n"):Object(s.default)(a.u_metallicRoughnessTexture)?(w+="    vec3 metallicRoughness = texture2D(u_metallicRoughnessTexture, "+te+").rgb;\n",w+="    float metalness = clamp(metallicRoughness.b, 0.0, 1.0);\n",w+="    float roughness = clamp(metallicRoughness.g, 0.04, 1.0);\n",Object(s.default)(a.u_metallicFactor)&&(w+="    metalness *= u_metallicFactor;\n"),Object(s.default)(a.u_roughnessFactor)&&(w+="    roughness *= u_roughnessFactor;\n")):(Object(s.default)(a.u_metallicFactor)?w+="    float metalness = clamp(u_metallicFactor, 0.0, 1.0);\n":w+="    float metalness = 1.0;\n",Object(s.default)(a.u_roughnessFactor)?w+="    float roughness = clamp(u_roughnessFactor, 0.04, 1.0);\n":w+="    float roughness = 1.0;\n"),w+="    vec3 v = -normalize(v_positionEC);\n",w+="#ifndef USE_CUSTOM_LIGHT_COLOR \n",w+="    vec3 lightColorHdr = czm_lightColorHdr;\n",w+="#else \n",w+="    vec3 lightColorHdr = gltf_lightColor;\n",w+="#endif \n",w+="    vec3 l = normalize(czm_lightDirectionEC);\n",w+="    vec3 h = normalize(v + l);\n",w+="    float NdotL = clamp(dot(n, l), 0.001, 1.0);\n",w+="    float NdotV = abs(dot(n, v)) + 0.001;\n",w+="    float NdotH = clamp(dot(n, h), 0.0, 1.0);\n",w+="    float LdotH = clamp(dot(l, h), 0.0, 1.0);\n",w+="    float VdotH = clamp(dot(v, h), 0.0, 1.0);\n",w+="    vec3 f0 = vec3(0.04);\n",_?(w+="    float roughness = 1.0 - glossiness;\n",w+="    vec3 diffuseColor = diffuse.rgb * (1.0 - max(max(specular.r, specular.g), specular.b));\n",w+="    vec3 specularColor = specular;\n"):(w+="    vec3 diffuseColor = baseColor * (1.0 - metalness) * (1.0 - f0);\n",w+="    vec3 specularColor = mix(f0, baseColor, metalness);\n"),w+="    float alpha = roughness * roughness;\n",w+="    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n",w+="    vec3 r90 = vec3(clamp(reflectance * 25.0, 0.0, 1.0));\n",w+="    vec3 r0 = specularColor.rgb;\n",w+="    vec3 F = fresnelSchlick2(r0, r90, VdotH);\n",w+="    float G = smithVisibilityGGX(alpha, NdotL, NdotV);\n",w+="    float D = GGX(alpha, NdotH);\n",w+="    vec3 diffuseContribution = (1.0 - F) * lambertianDiffuse(diffuseColor);\n",w+="    vec3 specularContribution = F * G * D / (4.0 * NdotL * NdotV);\n",w+="    vec3 color = NdotL * lightColorHdr * (diffuseContribution + specularContribution);\n",w+="#if defined(USE_IBL_LIGHTING) && !defined(DIFFUSE_IBL) && !defined(SPECULAR_IBL) \n",w+="    vec3 r = normalize(czm_inverseViewRotation * normalize(reflect(v, n)));\n",w+="    float vertexRadius = length(positionWC);\n",w+="    float horizonDotNadir = 1.0 - min(1.0, czm_ellipsoidRadii.x / vertexRadius);\n",w+="    float reflectionDotNadir = dot(r, normalize(positionWC));\n",w+="    r.x = -r.x;\n",w+="    r = -normalize(czm_temeToPseudoFixed * r);\n",w+="    r.x = -r.x;\n",w+="    float inverseRoughness = 1.04 - roughness;\n",w+="    inverseRoughness *= inverseRoughness;\n",w+="    vec3 sceneSkyBox = textureCube(czm_environmentMap, r).rgb * inverseRoughness;\n",w+="    float atmosphereHeight = 0.05;\n",w+="    float blendRegionSize = 0.1 * ((1.0 - inverseRoughness) * 8.0 + 1.1 - horizonDotNadir);\n",w+="    float blendRegionOffset = roughness * -1.0;\n",w+="    float farAboveHorizon = clamp(horizonDotNadir - blendRegionSize * 0.5 + blendRegionOffset, 1.0e-10 - blendRegionSize, 0.99999);\n",w+="    float aroundHorizon = clamp(horizonDotNadir + blendRegionSize * 0.5, 1.0e-10 - blendRegionSize, 0.99999);\n",w+="    float farBelowHorizon = clamp(horizonDotNadir + blendRegionSize * 1.5, 1.0e-10 - blendRegionSize, 0.99999);\n",w+="    float smoothstepHeight = smoothstep(0.0, atmosphereHeight, horizonDotNadir);\n",w+="    vec3 belowHorizonColor = mix(vec3(0.1, 0.15, 0.25), vec3(0.4, 0.7, 0.9), smoothstepHeight);\n",w+="    vec3 nadirColor = belowHorizonColor * 0.5;\n",w+="    vec3 aboveHorizonColor = mix(vec3(0.9, 1.0, 1.2), belowHorizonColor, roughness * 0.5);\n",w+="    vec3 blueSkyColor = mix(vec3(0.18, 0.26, 0.48), aboveHorizonColor, reflectionDotNadir * inverseRoughness * 0.5 + 0.75);\n",w+="    vec3 zenithColor = mix(blueSkyColor, sceneSkyBox, smoothstepHeight);\n",w+="    vec3 blueSkyDiffuseColor = vec3(0.7, 0.85, 0.9);\n",w+="    float diffuseIrradianceFromEarth = (1.0 - horizonDotNadir) * (reflectionDotNadir * 0.25 + 0.75) * smoothstepHeight;\n",w+="    float diffuseIrradianceFromSky = (1.0 - smoothstepHeight) * (1.0 - (reflectionDotNadir * 0.25 + 0.25));\n",w+="    vec3 diffuseIrradiance = blueSkyDiffuseColor * clamp(diffuseIrradianceFromEarth + diffuseIrradianceFromSky, 0.0, 1.0);\n",w+="    float notDistantRough = (1.0 - horizonDotNadir * roughness * 0.8);\n",w+="    vec3 specularIrradiance = mix(zenithColor, aboveHorizonColor, smoothstep(farAboveHorizon, aroundHorizon, reflectionDotNadir) * notDistantRough);\n",w+="    specularIrradiance = mix(specularIrradiance, belowHorizonColor, smoothstep(aroundHorizon, farBelowHorizon, reflectionDotNadir) * inverseRoughness);\n",w+="    specularIrradiance = mix(specularIrradiance, nadirColor, smoothstep(farBelowHorizon, 1.0, reflectionDotNadir) * inverseRoughness);\n",w+="#ifdef USE_SUN_LUMINANCE \n",w+="    float LdotZenith = clamp(dot(normalize(czm_inverseViewRotation * l), normalize(positionWC * -1.0)), 0.001, 1.0);\n",w+="    float S = acos(LdotZenith);\n",w+="    float NdotZenith = clamp(dot(normalize(czm_inverseViewRotation * n), normalize(positionWC * -1.0)), 0.001, 1.0);\n",w+="    float gamma = acos(NdotL);\n",w+="    float numerator = ((0.91 + 10.0 * exp(-3.0 * gamma) + 0.45 * pow(NdotL, 2.0)) * (1.0 - exp(-0.32 / NdotZenith)));\n",w+="    float denominator = (0.91 + 10.0 * exp(-3.0 * S) + 0.45 * pow(LdotZenith,2.0)) * (1.0 - exp(-0.32));\n",w+="    float luminance = gltf_luminanceAtZenith * (numerator / denominator);\n",w+="#endif \n",w+="    vec2 brdfLut = texture2D(czm_brdfLut, vec2(NdotV, roughness)).rg;\n",w+="    vec3 IBLColor = (diffuseIrradiance * diffuseColor * gltf_iblFactor.x) + (specularIrradiance * SRGBtoLINEAR3(specularColor * brdfLut.x + brdfLut.y) * gltf_iblFactor.y);\n",w+="    float maximumComponent = max(max(lightColorHdr.x, lightColorHdr.y), lightColorHdr.z);\n",w+="    vec3 lightColor = lightColorHdr / max(maximumComponent, 1.0);\n",w+="    IBLColor *= lightColor;\n",w+="#ifdef USE_SUN_LUMINANCE \n",w+="    color += IBLColor * luminance;\n",w+="#else \n",w+="    color += IBLColor; \n",w+="#endif \n",w+="#elif defined(DIFFUSE_IBL) || defined(SPECULAR_IBL) \n",w+="    mat3 fixedToENU = mat3(gltf_clippingPlanesMatrix[0][0], gltf_clippingPlanesMatrix[1][0], gltf_clippingPlanesMatrix[2][0], \n",w+="                           gltf_clippingPlanesMatrix[0][1], gltf_clippingPlanesMatrix[1][1], gltf_clippingPlanesMatrix[2][1], \n",w+="                           gltf_clippingPlanesMatrix[0][2], gltf_clippingPlanesMatrix[1][2], gltf_clippingPlanesMatrix[2][2]); \n",w+="    const mat3 yUpToZUp = mat3(-1.0, 0.0, 0.0, 0.0, 0.0, -1.0, 0.0, 1.0, 0.0); \n",w+="    vec3 cubeDir = normalize(yUpToZUp * fixedToENU * normalize(reflect(-v, n))); \n",w+="#ifdef DIFFUSE_IBL \n",w+="#ifdef CUSTOM_SPHERICAL_HARMONICS \n",w+="    vec3 diffuseIrradiance = czm_sphericalHarmonics(cubeDir, gltf_sphericalHarmonicCoefficients); \n",w+="#else \n",w+="    vec3 diffuseIrradiance = czm_sphericalHarmonics(cubeDir, czm_sphericalHarmonicCoefficients); \n",w+="#endif \n",w+="#else \n",w+="    vec3 diffuseIrradiance = vec3(0.0); \n",w+="#endif \n",w+="#ifdef SPECULAR_IBL \n",w+="    vec2 brdfLut = texture2D(czm_brdfLut, vec2(NdotV, roughness)).rg;\n",w+="#ifdef CUSTOM_SPECULAR_IBL \n",w+="    vec3 specularIBL = czm_sampleOctahedralProjection(gltf_specularMap, gltf_specularMapSize, cubeDir,  roughness * gltf_maxSpecularLOD, gltf_maxSpecularLOD);\n",w+="#else \n",w+="    vec3 specularIBL = czm_sampleOctahedralProjection(czm_specularEnvironmentMaps, czm_specularEnvironmentMapSize, cubeDir,  roughness * czm_specularEnvironmentMapsMaximumLOD, czm_specularEnvironmentMapsMaximumLOD);\n",w+="#endif \n",w+="    specularIBL *= F * brdfLut.x + brdfLut.y;\n",w+="#else \n",w+="    vec3 specularIBL = vec3(0.0); \n",w+="#endif \n",w+="    color += diffuseIrradiance * diffuseColor + specularColor * specularIBL;\n",w+="#endif \n"):w+="    vec3 color = baseColor;\n";M||(Object(s.default)(a.u_occlusionTexture)&&(w+="    color *= texture2D(u_occlusionTexture, "+ie+").r;\n"),Object(s.default)(a.u_emissiveTexture)?(w+="    vec3 emissive = SRGBtoLINEAR3(texture2D(u_emissiveTexture, "+ae+").rgb);\n",Object(s.default)(a.u_emissiveFactor)&&(w+="    emissive *= u_emissiveFactor;\n"),w+="    color += emissive;\n"):Object(s.default)(a.u_emissiveFactor)&&(w+="    color += u_emissiveFactor;\n"));M||(w+="    color = applyTonemapping(color);\n");w+="    color = LINEARtoSRGB(color);\n",Object(s.default)(N)?"MASK"===N?(w+="    if (baseColorWithAlpha.a < u_alphaCutoff) {\n",w+="        discard;\n",w+="    }\n",w+="    gl_FragColor = vec4(color, 1.0);\n"):w+="BLEND"===N?"    gl_FragColor = vec4(color, baseColorWithAlpha.a);\n":"    gl_FragColor = vec4(color, 1.0);\n":w+="    gl_FragColor = vec4(color, 1.0);\n";w+="}\n";var se=Hf(p,{type:jf.a.VERTEX_SHADER,extras:{_pipeline:{source:O,extension:".glsl"}}}),le=Hf(p,{type:jf.a.FRAGMENT_SHADER,extras:{_pipeline:{source:w,extension:".glsl"}}}),ue=Hf(m,{isOutline:!!Object(s.default)(t.extensions)&&Object(s.default)(t.extensions.TERRIA_solid_outlines),fragmentShader:le,vertexShader:se});return Hf(h,{attributes:q,program:ue,uniforms:R})}(e,a,r,n,i,t);Object(s.default)(a.extensions)||(a.extensions={}),a.extensions.KHR_techniques_webgl={values:n,technique:l}})),ep.ensureSemanticExistence(e),e},cp=new v.default,hp=ep.ModelState,pp=Ne.default.EPSILON16;function mp(e,t){e._cachedGltf=t}function _p(e){this._gltf=e.gltf,this.ready=e.ready,this.modelsToLoad=[],this.count=0}Object.defineProperties(_p.prototype,{gltf:{set:function(e){this._gltf=e},get:function(){return this._gltf}}}),_p.prototype.makeReady=function(e){this.gltf=e;for(var t=this.modelsToLoad,i=t.length,a=0;a<i;++a){var r=t[a];r.isDestroyed()||mp(r,this)}this.modelsToLoad=void 0,this.ready=!0};var gp={},vp={};function bp(e){var t,i=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).cacheKey;if(this._cacheKey=i,this._cachedGltf=void 0,this._releaseGltfJson=Object(o.default)(e.releaseGltfJson,!1),Object(s.default)(i)&&Object(s.default)(gp[i])&&gp[i].ready)++(t=gp[i]).count;else{var a=e.gltf;if(Object(s.default)(a)){if(a instanceof ArrayBuffer&&(a=new Uint8Array(a)),a instanceof Uint8Array)t=new _p({gltf:tc(a),ready:!0});else t=new _p({gltf:e.gltf,ready:!0});t.count=1,Object(s.default)(i)&&(gp[i]=t)}}mp(this,t);var n=Object(o.default)(e.basePath,"");this._resource=pf.default.createIfNeeded(n);var l=e.credit;"string"==typeof l&&(l=new vf.default(l)),this._credit=l,this._resourceCredits=[],this.show=Object(o.default)(e.show,!0),this.silhouetteColor=Object(o.default)(e.silhouetteColor,b.default.RED),this._silhouetteColor=new b.default,this._silhouetteColorPreviousAlpha=1,this._normalAttributeName=void 0,this.silhouetteSize=Object(o.default)(e.silhouetteSize,0),this.modelMatrix=nt.default.clone(Object(o.default)(e.modelMatrix,nt.default.IDENTITY)),this._modelMatrix=nt.default.clone(this.modelMatrix),this._clampedModelMatrix=void 0,this.scale=Object(o.default)(e.scale,1),this._scale=this.scale,this.minimumPixelSize=Object(o.default)(e.minimumPixelSize,0),this._minimumPixelSize=this.minimumPixelSize,this.maximumScale=e.maximumScale,this._maximumScale=this.maximumScale,this.id=e.id,this._id=e.id,this.heightReference=Object(o.default)(e.heightReference,x.default.NONE),this._heightReference=this.heightReference,this._heightChanged=!1,this._removeUpdateHeightCallback=void 0;var u=e.scene;this._scene=u,Object(s.default)(u)&&Object(s.default)(u.terrainProviderChanged)&&(this._terrainProviderChangedCallback=u.terrainProviderChanged.addEventListener((function(){this._heightChanged=!0}),this)),this._pickObject=e.pickObject,this._allowPicking=Object(o.default)(e.allowPicking,!0),this._ready=!1,this._readyPromise=Ef.default.defer(),this.activeAnimations=new Oh(this),this.clampAnimations=Object(o.default)(e.clampAnimations,!0),this._defaultTexture=void 0,this._incrementallyLoadTextures=Object(o.default)(e.incrementallyLoadTextures,!0),this._asynchronous=Object(o.default)(e.asynchronous,!0),this.shadows=Object(o.default)(e.shadows,ae.a.ENABLED),this._shadows=this.shadows,this.color=b.default.clone(Object(o.default)(e.color,b.default.WHITE)),this._colorPreviousAlpha=1,this.colorBlendMode=Object(o.default)(e.colorBlendMode,mf.a.HIGHLIGHT),this.colorBlendAmount=Object(o.default)(e.colorBlendAmount,.5),this._colorShadingEnabled=!1,this._clippingPlanes=void 0,this.clippingPlanes=e.clippingPlanes,this._clippingPlanesState=0,this.clippingPlanesOriginMatrix=void 0,this.debugShowBoundingVolume=Object(o.default)(e.debugShowBoundingVolume,!1),this._debugShowBoundingVolume=!1,this.debugWireframe=Object(o.default)(e.debugWireframe,!1),this._debugWireframe=!1,this._distanceDisplayCondition=e.distanceDisplayCondition,this._addBatchIdToGeneratedShaders=e.addBatchIdToGeneratedShaders,this._precreatedAttributes=e.precreatedAttributes,this._vertexShaderLoaded=e.vertexShaderLoaded,this._fragmentShaderLoaded=e.fragmentShaderLoaded,this._uniformMapLoaded=e.uniformMapLoaded,this._pickIdLoaded=e.pickIdLoaded,this._ignoreCommands=Object(o.default)(e.ignoreCommands,!1),this._requestType=e.requestType,this._upAxis=Object(o.default)(e.upAxis,hf.Y),this._gltfForwardAxis=hf.Z,this._forwardAxis=e.forwardAxis,this.cull=Object(o.default)(e.cull,!0),this.opaquePass=Object(o.default)(e.opaquePass,Lf.a.OPAQUE),this._computedModelMatrix=new nt.default,this._clippingPlaneModelViewMatrix=nt.default.clone(nt.default.IDENTITY),this._initialRadius=void 0,this._boundingSphere=void 0,this._scaledBoundingSphere=new r.default,this._state=hp.NEEDS_LOAD,this._loadResources=void 0,this._mode=void 0,this._perNodeShowDirty=!1,this._cesiumAnimationsDirty=!1,this._dirty=!1,this._maxDirtyNumber=0,this._runtime={animations:void 0,articulationsByName:void 0,articulationsByStageKey:void 0,stagesByKey:void 0,rootNodes:void 0,nodes:void 0,nodesByName:void 0,skinnedNodes:void 0,meshesByName:void 0,materialsByName:void 0,materialsById:void 0},this._uniformMaps={},this._extensionsUsed=void 0,this._extensionsRequired=void 0,this._quantizedUniforms={},this._programPrimitives={},this._rendererResources={buffers:{},vertexArrays:{},programs:{},sourceShaders:{},silhouettePrograms:{},textures:{},samplers:{},renderStates:{}},this._cachedRendererResources=void 0,this._loadRendererResourcesFromCache=!1,this._dequantizeInShader=Object(o.default)(e.dequantizeInShader,!0),this._decodedData={},this._cachedGeometryByteLength=0,this._cachedTexturesByteLength=0,this._geometryByteLength=0,this._texturesByteLength=0,this._trianglesLength=0,this._sourceTechniques={},this._sourcePrograms={},this._quantizedVertexShaders={},this._nodeCommands=[],this._pickIds=[],this._rtcCenter=void 0,this._rtcCenterEye=void 0,this._rtcCenter3D=void 0,this._rtcCenter2D=void 0,this._sourceVersion=void 0,this._sourceKHRTechniquesWebGL=void 0,this._imageBasedLightingFactor=new g.default(1,1),g.default.clone(e.imageBasedLightingFactor,this._imageBasedLightingFactor),this._lightColor=v.default.clone(e.lightColor),this._luminanceAtZenith=void 0,this.luminanceAtZenith=Object(o.default)(e.luminanceAtZenith,.2),this._sphericalHarmonicCoefficients=e.sphericalHarmonicCoefficients,this._specularEnvironmentMaps=e.specularEnvironmentMaps,this._shouldUpdateSpecularMapAtlas=!0,this._specularEnvironmentMapAtlas=void 0,this._useDefaultSphericalHarmonics=!1,this._useDefaultSpecularMaps=!1,this._shouldRegenerateShaders=!1}function yp(e){return e.stencilBuffer}function Op(e){return!b.default.equals(e.color,b.default.WHITE)||e.colorBlendMode!==mf.a.HIGHLIGHT}function wp(e){var t=e._clippingPlanes;return Object(s.default)(t)&&t.enabled&&0!==t.length}function xp(e,t,i){return e._runtime[t][i]}Object.defineProperties(bp.prototype,{gltf:{get:function(){return Object(s.default)(this._cachedGltf)?this._cachedGltf.gltf:void 0}},releaseGltfJson:{get:function(){return this._releaseGltfJson}},cacheKey:{get:function(){return this._cacheKey}},basePath:{get:function(){return this._resource.url}},boundingSphere:{get:function(){var e=this.modelMatrix;this.heightReference!==x.default.NONE&&this._clampedModelMatrix&&(e=this._clampedModelMatrix);var t=nt.default.getScale(e,cp),i=Object(s.default)(this.maximumScale)?Math.min(this.maximumScale,this.scale):this.scale;v.default.multiplyByScalar(t,i,t);var a=this._scaledBoundingSphere;return a.center=v.default.multiplyComponents(this._boundingSphere.center,t,a.center),a.radius=v.default.maximumComponent(t)*this._initialRadius,Object(s.default)(this._rtcCenter)&&v.default.add(this._rtcCenter,a.center,a.center),a}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},asynchronous:{get:function(){return this._asynchronous}},allowPicking:{get:function(){return this._allowPicking}},incrementallyLoadTextures:{get:function(){return this._incrementallyLoadTextures}},pendingTextureLoads:{get:function(){return Object(s.default)(this._loadResources)?this._loadResources.pendingTextureLoads:0}},dirty:{get:function(){return this._dirty}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){this._distanceDisplayCondition=O.a.clone(e,this._distanceDisplayCondition)}},extensionsUsed:{get:function(){return Object(s.default)(this._extensionsUsed)||(this._extensionsUsed=ep.getUsedExtensions(this.gltf)),this._extensionsUsed}},extensionsRequired:{get:function(){return Object(s.default)(this._extensionsRequired)||(this._extensionsRequired=ep.getRequiredExtensions(this.gltf)),this._extensionsRequired}},upAxis:{get:function(){return this._upAxis}},forwardAxis:{get:function(){return Object(s.default)(this._forwardAxis)?this._forwardAxis:this._gltfForwardAxis}},trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},texturesByteLength:{get:function(){return this._texturesByteLength}},cachedGeometryByteLength:{get:function(){return this._cachedGeometryByteLength}},cachedTexturesByteLength:{get:function(){return this._cachedTexturesByteLength}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){e!==this._clippingPlanes&&Nc.a.setOwner(e,this,"_clippingPlanes")}},pickIds:{get:function(){return this._pickIds}},imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(e){var t=this._imageBasedLightingFactor;e===t||g.default.equals(e,t)||(this._shouldRegenerateShaders=this._shouldRegenerateShaders||this._imageBasedLightingFactor.x>0&&0===e.x||0===this._imageBasedLightingFactor.x&&e.x>0,this._shouldRegenerateShaders=this._shouldRegenerateShaders||this._imageBasedLightingFactor.y>0&&0===e.y||0===this._imageBasedLightingFactor.y&&e.y>0,g.default.clone(e,this._imageBasedLightingFactor))}},lightColor:{get:function(){return this._lightColor},set:function(e){var t=this._lightColor;e===t||v.default.equals(e,t)||(this._shouldRegenerateShaders=this._shouldRegenerateShaders||Object(s.default)(t)&&!Object(s.default)(e)||Object(s.default)(e)&&!Object(s.default)(t),this._lightColor=v.default.clone(e,t))}},luminanceAtZenith:{get:function(){return this._luminanceAtZenith},set:function(e){var t=this._luminanceAtZenith;e!==t&&(this._shouldRegenerateShaders=this._shouldRegenerateShaders||Object(s.default)(t)&&!Object(s.default)(e)||Object(s.default)(e)&&!Object(s.default)(t),this._luminanceAtZenith=e)}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients},set:function(e){e!==this._sphericalHarmonicCoefficients&&(this._sphericalHarmonicCoefficients=e,this._shouldRegenerateShaders=!0)}},specularEnvironmentMaps:{get:function(){return this._specularEnvironmentMaps},set:function(e){this._shouldUpdateSpecularMapAtlas=this._shouldUpdateSpecularMapAtlas||e!==this._specularEnvironmentMaps,this._specularEnvironmentMaps=e}},credit:{get:function(){return this._credit}}}),bp.silhouetteSupported=function(e){return yp(e.context)},bp.fromGltf=function(e){var t=e.url;e=Object(_f.default)(e);var i=pf.default.createIfNeeded(t),a=Object(o.default)(e.basePath,i.clone()),r=pf.default.createIfNeeded(a),l=Object(o.default)(e.cacheKey,vp[Object(yf.a)(i.url)]);Object(s.default)(l)||(l=Object(n.default)(),vp[Object(yf.a)(i.url)]=l),Object(s.default)(e.basePath)&&!Object(s.default)(e.cacheKey)&&(l+=r.url),e.cacheKey=l,e.basePath=r;var u=new bp(e),d=gp[l];return Object(s.default)(d)?d.ready||(++d.count,d.modelsToLoad.push(u)):((d=new _p({ready:!1})).count=1,d.modelsToLoad.push(u),mp(u,d),gp[l]=d,Object(s.default)(i.headers.Accept)||(i.headers.Accept="model/gltf-binary,model/gltf+json;q=0.8,application/json;q=0.2,*/*;q=0.01"),i.fetchArrayBuffer().then((function(e){var t=new Uint8Array(e);if("glTF"===wf(t)){var a=tc(t);d.makeReady(a)}else{var r=Object(Of.a)(t);d.makeReady(JSON.parse(r))}var n=u._resourceCredits,o=i.credits;if(Object(s.default)(o))for(var l=o.length,f=0;f<l;f++)n.push(o[f])})).otherwise(ep.getFailedLoadFunction(u,"model",i.url))),u},bp._gltfCache=gp,bp.prototype.getNode=function(e){var t=xp(this,"nodesByName",e);return Object(s.default)(t)?t.publicNode:void 0},bp.prototype.getMesh=function(e){return xp(this,"meshesByName",e)},bp.prototype.getMaterial=function(e){return xp(this,"materialsByName",e)},bp.prototype.setArticulationStage=function(e,t){var i=xp(this,"stagesByKey",e),a=xp(this,"articulationsByStageKey",e);Object(s.default)(i)&&Object(s.default)(a)&&(t=Ne.default.clamp(t,i.minimumValue,i.maximumValue),Ne.default.equalsEpsilon(i.currentValue,t,pp)||(i.currentValue=t,a.isDirty=!0))};var Ep=new v.default,Tp=new et.default;function Cp(e,t){var i,a=e.currentValue,r=Ep;switch(e.type){case"xRotate":i=et.default.fromRotationX(Ne.default.toRadians(a),Tp),nt.default.multiplyByMatrix3(t,i,t);break;case"yRotate":i=et.default.fromRotationY(Ne.default.toRadians(a),Tp),nt.default.multiplyByMatrix3(t,i,t);break;case"zRotate":i=et.default.fromRotationZ(Ne.default.toRadians(a),Tp),nt.default.multiplyByMatrix3(t,i,t);break;case"xTranslate":r.x=a,r.y=0,r.z=0,nt.default.multiplyByTranslation(t,r,t);break;case"yTranslate":r.x=0,r.y=a,r.z=0,nt.default.multiplyByTranslation(t,r,t);break;case"zTranslate":r.x=0,r.y=0,r.z=a,nt.default.multiplyByTranslation(t,r,t);break;case"xScale":r.x=a,r.y=1,r.z=1,nt.default.multiplyByScale(t,r,t);break;case"yScale":r.x=1,r.y=a,r.z=1,nt.default.multiplyByScale(t,r,t);break;case"zScale":r.x=1,r.y=1,r.z=a,nt.default.multiplyByScale(t,r,t);break;case"uniformScale":nt.default.multiplyByUniformScale(t,a,t)}return t}var Ap=new nt.default;function jp(e,t){return function(i){var a=e._loadResources,r=new Uint8Array(i);--a.pendingBufferLoads,e.gltf.buffers[t].extras._pipeline.source=r}}function Pp(e,t){return function(i){var a=e._loadResources;--a.pendingTextureLoads,a.texturesToCreate.enqueue({id:t,image:i,bufferView:i.bufferView,width:i.width,height:i.height,internalFormat:i.internalFormat})}}bp.prototype.applyArticulations=function(){var e=this._runtime.articulationsByName;for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];if(i.isDirty){i.isDirty=!1;for(var a=i.nodes.length,r=0;r<a;++r){for(var n=i.nodes[r],o=nt.default.clone(n.originalMatrix,Ap),s=i.stages.length,l=0;l<s;++l){o=Cp(i.stages[l],o)}n.matrix=o}}}};var Sp=/(^data:image\/ktx)|(\.ktx$)/i,Ip=/(^data:image\/crn)|(\.crn$)/i;var Lp=new nt.default;var Dp=function(){this.id=void 0,this.model=void 0,this.context=void 0};function Mp(e,t,i){var a=t._loadResources,r=t.gltf.bufferViews[e];Object(s.default)(r)||(r=a.createdBufferViews[e]);var n=Pf.a.createVertexBuffer({context:i,typedArray:a.getBuffer(r),usage:Sf.a.STATIC_DRAW});n.vertexArrayDestroyable=!1,t._rendererResources.buffers[e]=n,t._geometryByteLength+=n.sizeInBytes}Dp.prototype.set=function(e,t,i){this.id=e,this.model=t,this.context=i},Dp.prototype.execute=function(){Mp(this.id,this.model,this.context)};var Rp=function(){this.id=void 0,this.componentType=void 0,this.model=void 0,this.context=void 0};function Np(e,t,i,a){var r=i._loadResources,n=i.gltf.bufferViews[e];Object(s.default)(n)||(n=r.createdBufferViews[e]);var o=Pf.a.createIndexBuffer({context:a,typedArray:r.getBuffer(n),usage:Sf.a.STATIC_DRAW,indexDatatype:t});o.vertexArrayDestroyable=!1,i._rendererResources.buffers[e]=o,i._geometryByteLength+=o.sizeInBytes}Rp.prototype.set=function(e,t,i,a){this.id=e,this.componentType=t,this.model=i,this.context=a},Rp.prototype.execute=function(){Np(this.id,this.componentType,this.model,this.context)};var Vp=new Dp,Bp=new Rp;function Up(e,t){var i=e._runtime.materialsById[t.material];if(Object(s.default)(i))return i._program}function Fp(e,t,i){var a,r,n,o=i._programPrimitives[t];if(!Object(s.default)(o))return e;for(r in o)if(o.hasOwnProperty(r)&&Up(i,a=o[r])===t)break;if(i._programPrimitives[t]=void 0,i.extensionsUsed.WEB3D_quantized_attributes)n=ep.modifyShaderForQuantizedAttributes(i.gltf,a,e),i._quantizedUniforms[t]=n.uniforms;else{var l=i._decodedData[r];if(!Object(s.default)(l))return e;n=ep.modifyShaderForDracoQuantizedAttributes(i.gltf,a,e,l.attributes)}return n.shader}function Hp(e,t,i){return Object(s.default)(i)&&(e=i(e,t)),e}var kp=function(){this.programToCreate=void 0,this.model=void 0,this.context=void 0};function zp(e,t,i){var a=e.programId,r=e.techniqueId,n=t._sourcePrograms[a],o=t._rendererResources.sourceShaders,l=o[n.vertexShader],u=o[n.fragmentShader],d=n.isOutline,f=t._quantizedVertexShaders,c=t._toClipCoordinatesGLSL[a];if(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader){var h=f[a];Object(s.default)(h)||(h=Fp(l,a,t),f[a]=h),l=h}var p=Hp(l,a,t._vertexShaderLoaded),m=Hp(u,a,t._fragmentShaderLoaded);bf.default.isInternetExplorer()||(p=ep.modifyVertexShaderForLogDepth(p,c),m=ep.modifyFragmentShaderForLogDepth(m),d&&(m=m.replace("czm_writeLogDepth();","    czm_writeLogDepth();\n#if defined(LOG_DEPTH) && !defined(DISABLE_LOG_DEPTH_FRAGMENT_WRITE)\n    gl_FragDepthEXT -= 5e-5;\n#endif"))),Object(s.default)(t._uniformMapLoaded)||(m="uniform vec4 czm_pickColor;\n"+m);var _=t._imageBasedLightingFactor.x>0||t._imageBasedLightingFactor.y>0;if(_&&(m="#define USE_IBL_LIGHTING \n\n"+m),Object(s.default)(t._lightColor)&&(m="#define USE_CUSTOM_LIGHT_COLOR \n\n"+m),("2.0"!==t._sourceVersion||t._sourceKHRTechniquesWebGL)&&(m=Nf.a.replaceMain(m,"non_gamma_corrected_main"),m+="\nvoid main() { \n    non_gamma_corrected_main(); \n    gl_FragColor = czm_gammaCorrect(gl_FragColor); \n} \n"),tp.a.isSupported(i)){var g=Object(s.default)(t._sphericalHarmonicCoefficients)||t._useDefaultSphericalHarmonics,v=Object(s.default)(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready||t._useDefaultSpecularMaps;(g||v||_)&&(m="uniform mat4 gltf_clippingPlanesMatrix; \n"+m),Object(s.default)(t._sphericalHarmonicCoefficients)?m="#define DIFFUSE_IBL \n#define CUSTOM_SPHERICAL_HARMONICS \nuniform vec3 gltf_sphericalHarmonicCoefficients[9]; \n"+m:t._useDefaultSphericalHarmonics&&(m="#define DIFFUSE_IBL \n"+m),Object(s.default)(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready?m="#define SPECULAR_IBL \n#define CUSTOM_SPECULAR_IBL \nuniform sampler2D gltf_specularMap; \nuniform vec2 gltf_specularMapSize; \nuniform float gltf_maxSpecularLOD; \n"+m:t._useDefaultSpecularMaps&&(m="#define SPECULAR_IBL \n"+m)}Object(s.default)(t._luminanceAtZenith)&&(m="#define USE_SUN_LUMINANCE \nuniform float gltf_luminanceAtZenith;\n"+m),qp(a,r,m,p,t,i)}function Gp(e,t,i){var a=e.programId,r=e.techniqueId,n=t._sourcePrograms[a],o=t._rendererResources.sourceShaders,l=t._quantizedVertexShaders,u=t._toClipCoordinatesGLSL[a],d=t.clippingPlanes,f=wp(t),c=o[n.vertexShader],h=o[n.fragmentShader];(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader)&&(c=l[a]);var p=h;Op(t)&&(p=bp._modifyShaderForColor(p)),f&&(p=function(e,t,i){return e=Nf.a.replaceMain(e,"gltf_clip_main"),e+=bp._getClippingFunction(t,i)+"\n",e+="uniform sampler2D gltf_clippingPlanes; \nuniform mat4 gltf_clippingPlanesMatrix; \nuniform vec4 gltf_clippingPlanesEdgeStyle; \nvoid main() \n{ \n    gltf_clip_main(); \n"+qc("gltf_clippingPlanes","gltf_clippingPlanesMatrix","gltf_clippingPlanesEdgeStyle")+"} \n"}(p,d,i));var m=Hp(c,a,t._vertexShaderLoaded),_=Hp(p,a,t._fragmentShaderLoaded);bf.default.isInternetExplorer()||(m=ep.modifyVertexShaderForLogDepth(m,u),_=ep.modifyFragmentShaderForLogDepth(_),n.isOutline&&(_=_.replace("czm_writeLogDepth();","    czm_writeLogDepth();\n#if defined(LOG_DEPTH) && !defined(DISABLE_LOG_DEPTH_FRAGMENT_WRITE)\n    gl_FragDepthEXT -= 5e-5;\n#endif")));Object(s.default)(t._uniformMapLoaded)||(_="uniform vec4 czm_pickColor;\n"+_);var g=t._imageBasedLightingFactor.x>0||t._imageBasedLightingFactor.y>0;if(g&&(_="#define USE_IBL_LIGHTING \n\n"+_),Object(s.default)(t._lightColor)&&(_="#define USE_CUSTOM_LIGHT_COLOR \n\n"+_),("2.0"!==t._sourceVersion||t._sourceKHRTechniquesWebGL)&&(_=Nf.a.replaceMain(_,"non_gamma_corrected_main"),_+="\nvoid main() { \n    non_gamma_corrected_main(); \n    gl_FragColor = czm_gammaCorrect(gl_FragColor); \n} \n"),tp.a.isSupported(i)){var v=Object(s.default)(t._sphericalHarmonicCoefficients)||t._useDefaultSphericalHarmonics,b=Object(s.default)(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready||t._useDefaultSpecularMaps;!f&&(v||b||g)&&(_="uniform mat4 gltf_clippingPlanesMatrix; \n"+_),Object(s.default)(t._sphericalHarmonicCoefficients)?_="#define DIFFUSE_IBL \n#define CUSTOM_SPHERICAL_HARMONICS \nuniform vec3 gltf_sphericalHarmonicCoefficients[9]; \n"+_:t._useDefaultSphericalHarmonics&&(_="#define DIFFUSE_IBL \n"+_),Object(s.default)(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready?_="#define SPECULAR_IBL \n#define CUSTOM_SPECULAR_IBL \nuniform sampler2D gltf_specularMap; \nuniform vec2 gltf_specularMapSize; \nuniform float gltf_maxSpecularLOD; \n"+_:t._useDefaultSpecularMaps&&(_="#define SPECULAR_IBL \n"+_)}Object(s.default)(t._luminanceAtZenith)&&(_="#define USE_SUN_LUMINANCE \nuniform float gltf_luminanceAtZenith;\n"+_),qp(a,r,_,m,t,i)}function qp(e,t,i,a,r,n){var o=r._sourceTechniques[t],s=ep.createAttributeLocations(o,r._precreatedAttributes);r._rendererResources.programs[e]=Rf.a.fromCache({context:n,vertexShaderSource:a,fragmentShaderSource:i,attributeLocations:s})}kp.prototype.set=function(e,t,i){this.programToCreate=e,this.model=t,this.context=i},kp.prototype.execute=function(){zp(this.programToCreate,this.model,this.context)};var Wp=new kp;function Yp(e,t){return function(i){e.texturesToCreate.enqueue({id:t.id,image:i,bufferView:void 0}),--e.pendingBufferViewToImage}}var Kp=function(){this.gltfTexture=void 0,this.model=void 0,this.context=void 0};function Xp(e,t,i){var a=t.gltf.textures[e.id],r=t._rendererResources.samplers[a.sampler];Object(s.default)(r)||(r=new Mf.a({wrapS:Uf.a.REPEAT,wrapT:Uf.a.REPEAT}));for(var n=!1,o=t.gltf.materials,l=o.length,u=0;u<l;++u){var d=o[u];if(Object(s.default)(d.extensions)&&Object(s.default)(d.extensions.KHR_techniques_webgl)){var f=d.extensions.KHR_techniques_webgl.values;for(var c in f)if(f.hasOwnProperty(c)&&-1!==c.indexOf("Texture")){var h=f[c];if(h.index===e.id&&Object(s.default)(h.extensions)&&Object(s.default)(h.extensions.KHR_texture_transform)){n=!0;break}}}if(n)break}var p=r.wrapS,m=r.wrapT,_=r.minificationFilter;n&&_!==Bf.a.LINEAR&&_!==Bf.a.NEAREST&&(_=_===Bf.a.NEAREST_MIPMAP_NEAREST||_===Bf.a.NEAREST_MIPMAP_LINEAR?Bf.a.NEAREST:Bf.a.LINEAR,r=new Mf.a({wrapS:r.wrapS,wrapT:r.wrapT,textureMinificationFilter:_,textureMagnificationFilter:r.magnificationFilter}));var g,v=e.internalFormat,b=!(Object(s.default)(v)&&Af.a.isCompressedFormat(v)||_!==Bf.a.NEAREST_MIPMAP_NEAREST&&_!==Bf.a.NEAREST_MIPMAP_LINEAR&&_!==Bf.a.LINEAR_MIPMAP_NEAREST&&_!==Bf.a.LINEAR_MIPMAP_LINEAR),y=b||p===Uf.a.REPEAT||p===Uf.a.MIRRORED_REPEAT||m===Uf.a.REPEAT||m===Uf.a.MIRRORED_REPEAT,O=e.image;if(Object(s.default)(v))g=new Vf.a({context:i,source:{arrayBufferView:e.bufferView},width:e.width,height:e.height,pixelFormat:v,sampler:r});else if(Object(s.default)(O)){var w=!Ne.default.isPowerOfTwo(O.width)||!Ne.default.isPowerOfTwo(O.height);if(y&&w){var x=document.createElement("canvas");x.width=Ne.default.nextPowerOfTwo(O.width),x.height=Ne.default.nextPowerOfTwo(O.height),x.getContext("2d").drawImage(O,0,0,O.width,O.height,0,0,x.width,x.height),O=x}g=new Vf.a({context:i,source:O,pixelFormat:a.internalFormat,pixelDatatype:a.type,sampler:r,flipY:!1}),b&&g.generateMipmap()}Object(s.default)(g)&&(t._rendererResources.textures[e.id]=g,t._texturesByteLength+=g.sizeInBytes)}Kp.prototype.set=function(e,t,i){this.gltfTexture=e,this.model=t,this.context=i},Kp.prototype.execute=function(){Xp(this.gltfTexture,this.model,this.context)};var Zp=new Kp;function Jp(e,t){for(var i=e.length,a={},r=0;r<i;++r)for(var n=[e[r]];n.length>0;){var o=n.pop(),l=t[o];Object(s.default)(l)&&(a[o]=o);var u=l.children;if(Object(s.default)(u))for(var d=u.length,f=0;f<d;++f)n.push(u[f])}return a}function Qp(e){var t=e._loadResources;if(0===t.pendingBufferLoads&&t.createSkins){t.createSkins=!1;var i=e.gltf,a=i.accessors,r={};Gf.skin(i,(function(t,i){var n,o=a[t.inverseBindMatrices];nt.default.equals(t.bindShapeMatrix,nt.default.IDENTITY)||(n=nt.default.clone(t.bindShapeMatrix)),r[i]={inverseBindMatrices:dh.getSkinInverseBindMatrices(e,o),bindShapeMatrix:n}})),function(e,t){for(var i=e.gltf,a=i.skins,r=i.nodes,n=e._runtime.nodes,o=e._loadResources.skinnedNodesIds,l=o.length,u=0;u<l;++u){var d=o[u],f=n[d],c=r[d],h=t[c.skin];f.inverseBindMatrices=h.inverseBindMatrices,f.bindShapeMatrix=h.bindShapeMatrix;var p=[],m=a[c.skin];Object(s.default)(m.skeleton)&&p.push(m.skeleton);for(var _=Jp(p,r),g=a[c.skin].joints,v=g.length,b=0;b<v;++b){var y=n[_[g[b]]];f.joints.push(y)}}}(e,r)}}function $p(e,t,i,a){return function(r){Object(s.default)(a)&&(r=e.clampAnimations?a.clampTime(r):a.wrapTime(r),t[i]=a.evaluate(r,t[i]),t.dirtyNumber=e._maxDirtyNumber)}}function em(e,t){var i=e._loadResources;if(i.finishedBuffersCreation()&&i.finishedProgramCreation()&&i.createVertexArrays){i.createVertexArrays=!1;var a=e._rendererResources.buffers,r=e._rendererResources.vertexArrays,n=e.gltf,o=n.accessors;Gf.mesh(n,(function(i,l){Gf.meshPrimitive(i,(function(i,u){var d,f,c,h=[],p=function(e,t){var i,a,r=e._sourceTechniques,n={},o=e._runtime.materialsById[t.material];if(!Object(s.default)(o))return n;var l=r[o._technique];if(!Object(s.default)(l))return n;var u=l.attributes,d=e._rendererResources.programs[l.program],f=d.vertexAttributes,c=d._attributeLocations;for(i in f)if(f.hasOwnProperty(i)){var h=u[i];Object(s.default)(h)&&(a=c[i],n[h.semantic]=a)}var p=e._precreatedAttributes;if(Object(s.default)(p))for(i in p)p.hasOwnProperty(i)&&(a=c[i],n[i]=a);return n}(e,i),m=e._decodedData[l+".primitive."+u];Gf.meshPrimitiveAttribute(i,(function(e,t){if(d=p[t],Object(s.default)(d)){if(Object(s.default)(m)){var i=m.attributes;if(i.hasOwnProperty(t)){var r=i[t];return void h.push({index:d,vertexBuffer:a[r.bufferView],componentsPerAttribute:r.componentsPerAttribute,componentDatatype:r.componentDatatype,normalize:r.normalized,offsetInBytes:r.byteOffset,strideInBytes:r.byteStride})}}var l=o[e],u=Object(s.default)(l.normalized)&&l.normalized;h.push({index:d,vertexBuffer:a[l.bufferView],componentsPerAttribute:qf(l.type),componentDatatype:l.componentType,normalize:u,offsetInBytes:l.byteOffset,strideInBytes:Wf(n,l)})}}));var _,g=e._precreatedAttributes;if(Object(s.default)(g))for(c in g)g.hasOwnProperty(c)&&(d=p[c],Object(s.default)(d)&&((f=g[c]).index=d,h.push(f)));if(Object(s.default)(i.indices)){var v=o[i.indices].bufferView;Object(s.default)(m)&&(v=m.bufferView),_=a[v]}r[l+".primitive."+u]=new Ff.a({context:t,attributes:h,indexBuffer:_})}))}))}}function tm(e){var t=e._loadResources;t.createRenderStates&&(t.createRenderStates=!1,Gf.material(e.gltf,(function(t,i){!function(e,t,i){var a=e._rendererResources.renderStates,r=[jf.a.FUNC_ADD,jf.a.FUNC_ADD],n=[jf.a.ONE,jf.a.ONE_MINUS_SRC_ALPHA,jf.a.ONE,jf.a.ONE_MINUS_SRC_ALPHA];Object(s.default)(t.extensions)&&Object(s.default)(t.extensions.KHR_blend)&&(r=t.extensions.KHR_blend.blendEquation,n=t.extensions.KHR_blend.blendFactors);var o,l=kf(e.gltf,"TERRIA_solid_outlines"),u=Object(s.default)(t.extensions)&&Object(s.default)(t.extensions.TERRIA_solid_outlines);l&&!u&&(o={enabled:!0,factor:.75,units:1});var d=!t.doubleSided,f="BLEND"===t.alphaMode;a[i]=Df.a.fromCache({cull:{enabled:d},depthTest:{enabled:!0,func:Vc.a.LESS_OR_EQUAL},depthMask:!f,blending:{enabled:f,equationRgb:r[0],equationAlpha:r[1],functionSourceRgb:n[0],functionDestinationRgb:n[1],functionSourceAlpha:n[2],functionDestinationAlpha:n[3]},polygonOffset:o})}(e,t,i)})))}var im={MODEL:function(e,t,i){return function(){return i.computedMatrix}},VIEW:function(e,t,i){return function(){return e.view}},PROJECTION:function(e,t,i){return function(){return e.projection}},MODELVIEW:function(e,t,i){var a=new nt.default;return function(){return nt.default.multiplyTransformation(e.view,i.computedMatrix,a)}},CESIUM_RTC_MODELVIEW:function(e,t,i){var a=new nt.default;return function(){return nt.default.multiplyTransformation(e.view,i.computedMatrix,a),nt.default.setTranslation(a,t._rtcCenterEye,a)}},MODELVIEWPROJECTION:function(e,t,i){var a=new nt.default;return function(){return nt.default.multiplyTransformation(e.view,i.computedMatrix,a),nt.default.multiply(e._projection,a,a)}},MODELINVERSE:function(e,t,i){var a=new nt.default;return function(){return nt.default.inverse(i.computedMatrix,a)}},VIEWINVERSE:function(e,t){return function(){return e.inverseView}},PROJECTIONINVERSE:function(e,t,i){return function(){return e.inverseProjection}},MODELVIEWINVERSE:function(e,t,i){var a=new nt.default,r=new nt.default;return function(){return nt.default.multiplyTransformation(e.view,i.computedMatrix,a),nt.default.inverse(a,r)}},MODELVIEWPROJECTIONINVERSE:function(e,t,i){var a=new nt.default,r=new nt.default;return function(){return nt.default.multiplyTransformation(e.view,i.computedMatrix,a),nt.default.multiply(e._projection,a,a),nt.default.inverse(a,r)}},MODELINVERSETRANSPOSE:function(e,t,i){var a=new nt.default,r=new et.default;return function(){return nt.default.inverse(i.computedMatrix,a),nt.default.getMatrix3(a,r),et.default.transpose(r,r)}},MODELVIEWINVERSETRANSPOSE:function(e,t,i){var a=new nt.default,r=new nt.default,n=new et.default;return function(){return nt.default.multiplyTransformation(e.view,i.computedMatrix,a),nt.default.inverse(a,r),nt.default.getMatrix3(r,n),et.default.transpose(n,n)}},VIEWPORT:function(e,t,i){return function(){return e.viewportCartesian4}}};function am(e,t,i,a,r,n,l){var u,d,f={},c={};return Gf.techniqueUniform(i,(function(i,h){var p;if(Object(s.default)(a)&&Object(s.default)(a[h]))p=ep.createUniformFunction(i.type,a[h],n,l),f[h]=p.func,c[h]=p;else if(Object(s.default)(i.node))f[h]=function(e,t,i,a){var r=t._runtime.nodes[e];return im[i](a,t,r)}(i.node,e,i.semantic,r.uniformState);else if(Object(s.default)(i.semantic))if("JOINTMATRIX"===i.semantic)u=h;else if("MORPHWEIGHTS"===i.semantic)d=h;else if("ALPHACUTOFF"===i.semantic){var m=t.alphaMode;if(Object(s.default)(m)&&"MASK"===m){var _=Object(o.default)(t.alphaCutoff,.5);p=ep.createUniformFunction(i.type,_,n,l),f[h]=p.func,c[h]=p}}else f[h]=ep.getGltfSemanticUniforms()[i.semantic](r.uniformState,e);else if(Object(s.default)(i.value)){var g=ep.createUniformFunction(i.type,i.value,n,l);f[h]=g.func,c[h]=g}})),{map:f,values:c,jointMatrixUniformName:u,morphWeightsUniformName:d}}function rm(e){return ep.createUniformsForDracoQuantizedAttributes(e.attributes)}function nm(e,t){var i=Up(e,t),a=e._quantizedUniforms[i];return ep.createUniformsForQuantizedAttributes(e.gltf,t,a)}function om(e){return function(){return e}}function sm(e){return function(){return e.computedJointMatrices}}function lm(e){return function(){return e.weights}}function um(e){return function(){return e.silhouetteColor}}function dm(e){return function(){return e.silhouetteSize}}function fm(e){return function(){return e.color}}var cm=new nt.default;function hm(e){return function(){var t=e.clippingPlanes;if(!Object(s.default)(t)&&!Object(s.default)(e._sphericalHarmonicCoefficients)&&!Object(s.default)(e._specularEnvironmentMaps))return nt.default.IDENTITY;var i=Object(s.default)(t)?t.modelMatrix:nt.default.IDENTITY;return nt.default.multiply(e._clippingPlaneModelViewMatrix,i,cm)}}function pm(e){return function(){var t=e.clippingPlanes;return Object(s.default)(t)&&t.enabled?t.texture:e._defaultTexture}}function mm(e){return function(){var t=e.clippingPlanes;if(!Object(s.default)(t))return b.default.WHITE.withAlpha(0);var i=b.default.clone(t.edgeColor);return i.alpha=t.edgeWidth,i}}function _m(e){return function(){return mf.a.getColorBlend(e.colorBlendMode,e.colorBlendAmount)}}function gm(e){return function(){return e._imageBasedLightingFactor}}function vm(e){return function(){return e._lightColor}}function bm(e){return function(){return e.luminanceAtZenith}}function ym(e){return function(){return e._sphericalHarmonicCoefficients}}function Om(e){return function(){return e._specularEnvironmentMapAtlas.texture}}function wm(e){return function(){return e._specularEnvironmentMapAtlas.texture.dimensions}}function xm(e){return function(){return e._specularEnvironmentMapAtlas.maximumMipmapLevel}}function Em(e,t){switch(e.mode){case Wi.a.TRIANGLES:return t/3;case Wi.a.TRIANGLE_STRIP:case Wi.a.TRIANGLE_FAN:return Math.max(t-2,0);default:return 0}}function Tm(e,t,i,a,n){for(var o=e._nodeCommands,l=e._pickIds,u=e.allowPicking,d=e._runtime.meshesByName,f=e._rendererResources,c=f.vertexArrays,h=f.programs,p=f.renderStates,m=e._uniformMaps,_=e.gltf,g=_.accessors,b=_.meshes,y=t.mesh,O=b[y],w=O.primitives,x=w.length,E=0;E<x;++E){var T,C=w[E],A=g[C.indices],j=e._runtime.materialsById[C.material]._program,P=e._decodedData[y+".primitive."+E],S=C.attributes.POSITION;if(Object(s.default)(S)){var I=ep.getAccessorMinMax(_,S);T=r.default.fromCornerPoints(v.default.fromArray(I.min),v.default.fromArray(I.max))}var L,D,M=c[y+".primitive."+E];if(Object(s.default)(P))D=P.numberOfIndices,L=0;else if(Object(s.default)(A))D=A.count,L=A.byteOffset/Gi.a.getSizeInBytes(A.componentType);else{D=g[C.attributes.POSITION].count,L=0}e._trianglesLength+=Em(C,D);var R=m[C.material],N=R.uniformMap;if(Object(s.default)(R.jointMatrixUniformName)){var V={};V[R.jointMatrixUniformName]=sm(i),N=Object(gf.default)(N,V)}if(Object(s.default)(R.morphWeightsUniformName)){var B={};B[R.morphWeightsUniformName]=lm(i),N=Object(gf.default)(N,B)}N=Object(gf.default)(N,{gltf_color:fm(e),gltf_colorBlend:_m(e),gltf_clippingPlanes:pm(e),gltf_clippingPlanesEdgeStyle:mm(e),gltf_clippingPlanesMatrix:hm(e),gltf_iblFactor:gm(e),gltf_lightColor:vm(e),gltf_sphericalHarmonicCoefficients:ym(e),gltf_specularMap:Om(e),gltf_specularMapSize:wm(e),gltf_maxSpecularLOD:xm(e),gltf_luminanceAtZenith:bm(e)}),Object(s.default)(e._uniformMapLoaded)&&(N=e._uniformMapLoaded(N,j,i));var U={};e.extensionsUsed.WEB3D_quantized_attributes?U=nm(e,C):e._dequantizeInShader&&Object(s.default)(P)&&(U=rm(P)),N=Object(gf.default)(N,U);var F=p[C.material],H=F.blending.enabled,k=e._pickObject;Object(s.default)(k)||(k={primitive:e,id:e.id,node:i.publicNode,mesh:d[O.name]});var z,G=ae.a.castShadows(e._shadows),q=ae.a.receiveShadows(e._shadows);if(u&&!Object(s.default)(e._uniformMapLoaded)){z=a.createPickId(k),l.push(z);var W={czm_pickColor:om(z.color)};N=Object(gf.default)(N,W)}u&&(z=Object(s.default)(e._pickIdLoaded)&&Object(s.default)(e._uniformMapLoaded)?e._pickIdLoaded():"czm_pickColor");var Y,K=new If.a({boundingVolume:new r.default,cull:e.cull,modelMatrix:new nt.default,primitiveType:C.mode,vertexArray:M,count:D,offset:L,shaderProgram:h[j],castShadows:G,receiveShadows:q,uniformMap:N,renderState:F,owner:k,pass:H?Lf.a.TRANSLUCENT:e.opaquePass,pickId:z});n||((Y=If.a.shallowClone(K)).boundingVolume=new r.default,Y.modelMatrix=new nt.default);var X={show:!0,boundingSphere:T,command:K,command2D:Y,silhouetteModelCommand:void 0,silhouetteModelCommand2D:void 0,silhouetteColorCommand:void 0,silhouetteColorCommand2D:void 0,translucentCommand:void 0,translucentCommand2D:void 0,programId:j};i.commands.push(X),o.push(X)}}function Cm(e,t){var i=t.context,a=t.scene3DOnly,r=e._quantizedVertexShaders,n=e._toClipCoordinatesGLSL={},o=e._sourceTechniques,l=e._sourcePrograms,u=e._rendererResources,d=u.sourceShaders;for(var f in e._loadRendererResourcesFromCache&&(d=u.sourceShaders=e._cachedRendererResources.sourceShaders),o)if(o.hasOwnProperty(f)){var c=o[f].program,h=l[c],p=d[h.vertexShader];if(ep.checkSupportedGlExtensions(h.glExtensions,i),e.extensionsUsed.WEB3D_quantized_attributes||e._dequantizeInShader){var m=r[c];Object(s.default)(m)||(m=Fp(p,c,e),r[c]=m),p=m}p=Hp(p,c,e._vertexShaderLoaded),n[c]=ep.toClipCoordinatesGLSL(e.gltf,p)}if(e._loadRendererResourcesFromCache){var _=e._cachedRendererResources;u.buffers=_.buffers,u.vertexArrays=_.vertexArrays,u.programs=_.programs,u.silhouettePrograms=_.silhouettePrograms,u.textures=_.textures,u.samplers=_.samplers,u.renderStates=_.renderStates,Object(s.default)(e._precreatedAttributes)&&em(e,i),e._cachedGeometryByteLength+=function(e){var t=0;for(var i in e)e.hasOwnProperty(i)&&(t+=e[i].sizeInBytes);return t}(_.buffers),e._cachedTexturesByteLength+=function(e){var t=0;for(var i in e)e.hasOwnProperty(i)&&(t+=e[i].sizeInBytes);return t}(_.textures)}else!function(e,t){var i=e._loadResources;if(0===i.pendingBufferLoads){var a,r=t.context,n=i.vertexBuffersToCreate,o=i.indexBuffersToCreate;if(e.asynchronous){for(;n.length>0&&(Vp.set(n.peek(),e,r),t.jobScheduler.execute(Vp,Yc.a.BUFFER));)n.dequeue();for(;o.length>0&&(a=o.peek(),Bp.set(a.id,a.componentType,e,r),t.jobScheduler.execute(Bp,Yc.a.BUFFER));)o.dequeue()}else{for(;n.length>0;)Mp(n.dequeue(),e,r);for(;o.length>0;)Np((a=o.dequeue()).id,a.componentType,e,r)}}}(e,t),function(e,t){var i=e._loadResources,a=i.programsToCreate;if(0===i.pendingShaderLoads&&0===i.pendingBufferLoads){var r=t.context;if(e.asynchronous)for(;a.length>0&&(Wp.set(a.peek(),e,r),t.jobScheduler.execute(Wp,Yc.a.PROGRAM));)a.dequeue();else for(;a.length>0;)zp(a.dequeue(),e,r)}}(e,t),function(e){var t=e._loadResources;if(t.createSamplers){t.createSamplers=!1;var i=e._rendererResources.samplers;Gf.sampler(e.gltf,(function(e,t){i[t]=new Mf.a({wrapS:e.wrapS,wrapT:e.wrapT,minificationFilter:e.minFilter,magnificationFilter:e.magFilter})}))}}(e),function(e){var t=e._loadResources;if(0===t.pendingBufferLoads)for(;t.texturesToCreateFromBufferView.length>0;){var i=t.texturesToCreateFromBufferView.dequeue(),a=e.gltf,r=a.bufferViews[i.bufferView],n=(a.textures[i.id].source,ep.getFailedLoadFunction(e,"image","id: "+i.id+", bufferView: "+i.bufferView));if("image/ktx"===i.mimeType)Object(Cf.a)(t.getBuffer(r)).then(Pp(e,i.id)).otherwise(n),++e._loadResources.pendingTextureLoads;else if("image/crn"===i.mimeType)Object(xf.a)(t.getBuffer(r)).then(Pp(e,i.id)).otherwise(n),++e._loadResources.pendingTextureLoads;else{var o=Yp(t,i);Tf({uint8Array:t.getBuffer(r),format:i.mimeType,flipY:!1}).then(o).otherwise(n),++t.pendingBufferViewToImage}}}(e),function(e,t){var i=t.context,a=e._loadResources.texturesToCreate;if(e.asynchronous)for(;a.length>0&&(Zp.set(a.peek(),e,i),t.jobScheduler.execute(Zp,Yc.a.TEXTURE));)a.dequeue();else for(;a.length>0;)Xp(a.dequeue(),e,i)}(e,t);Qp(e),function(e){var t=e._loadResources;if(t.finishedPendingBufferLoads()&&t.createRuntimeAnimations){t.createRuntimeAnimations=!1,e._runtime.animations=[];var i=e._runtime.nodes,a=e.gltf.accessors;Gf.animation(e.gltf,(function(t,r){for(var n=t.channels,o=t.samplers,s=Number.MAX_VALUE,l=-Number.MAX_VALUE,u=n.length,d=new Array(u),f=0;f<u;++f){var c=n[f],h=c.target,p=h.path,m=o[c.sampler],_=dh.getAnimationParameterValues(e,a[m.input]),g=dh.getAnimationParameterValues(e,a[m.output]);s=Math.min(s,_[0]),l=Math.max(l,_[_.length-1]);var v=dh.getAnimationSpline(e,r,t,c.sampler,m,_,p,g);d[f]=$p(e,i[h.node],h.path,v)}e._runtime.animations[r]={name:t.name,startTime:s,stopTime:l,channelEvaluators:d}}))}}(e),e._loadRendererResourcesFromCache||(em(e,i),tm(e)),function(e,t){var i=e._loadResources;if(i.finishedProgramCreation()&&i.createUniformMaps){i.createUniformMaps=!1;var a=e.gltf,r=e._sourceTechniques,n=e._uniformMaps,o=e._rendererResources.textures,s=e._defaultTexture;Gf.material(a,(function(i,a){var l=e._runtime.materialsById[a],u=r[l._technique],d=l._values,f=am(e,i,u,d,t,o,s),c=n[a];c.uniformMap=f.map,c.values=f.values,c.jointMatrixUniformName=f.jointMatrixUniformName,c.morphWeightsUniformName=f.morphWeightsUniformName}))}}(e,i),function(e,t,i){var a=e._loadResources;if(a.finishedEverythingButTextureCreation()&&a.createRuntimeNodes){a.createRuntimeNodes=!1;for(var r=[],n=e._runtime.nodes,o=e.gltf,l=o.nodes,u=o.skins,d=o.scenes[o.scene].nodes,f=d.length,c=[],h={},p=0;p<f;++p){c.push({parentRuntimeNode:void 0,gltfNode:l[d[p]],id:d[p]});for(var m=[];c.length>0;){var _=c.pop();h[_.id]=!0;var g=_.parentRuntimeNode,b=_.gltfNode,y=n[_.id];if(0===y.parents.length)if(Object(s.default)(b.matrix))y.matrix=nt.default.fromColumnMajorArray(b.matrix);else{var O=b.rotation;y.translation=v.default.fromArray(b.translation),y.rotation=Dt.default.unpack(O),y.scale=v.default.fromArray(b.scale)}Object(s.default)(g)?(g.children.push(y),y.parents.push(g)):r.push(y),Object(s.default)(b.mesh)&&Tm(e,b,y,t,i);var w=b.children;if(Object(s.default)(w))for(var x=w.length,E=0;E<x;E++){var T=w[E];h[T]||c.push({parentRuntimeNode:y,gltfNode:l[T],id:w[E]})}var C=b.skin;if(Object(s.default)(C)&&m.push(u[C].skeleton),0===c.length)for(var A=0;A<m.length;A++){var j=m[A];h[j]||c.push({parentRuntimeNode:void 0,gltfNode:l[j],id:j})}}}e._runtime.rootNodes=r,e._runtime.nodes=n}}(e,i,a)}function Am(e,t){var i=e.publicNode,a=i.matrix;i.useMatrix&&Object(s.default)(a)?nt.default.clone(a,t):Object(s.default)(e.matrix)?nt.default.clone(e.matrix,t):(nt.default.fromTranslationQuaternionRotationScale(e.translation,e.rotation,e.scale,t),i.setMatrix(t))}var jm=[],Pm=new It.a,Sm=new nt.default;var Im=new nt.default;function Lm(e){var t,i,a=If.a.shallowClone(e);return a.pass=Lf.a.TRANSLUCENT,a.renderState=(t=e.renderState,(i=Object(_f.default)(t,!0)).cull.enabled=!1,i.depthTest.enabled=!0,i.depthMask=!1,i.blending=Rc.a.ALPHA_BLEND,Df.a.fromCache(i)),a}function Dm(e,t,i){var a=t.scene3DOnly,r=e.color.alpha;if(r>0&&r<1){var n=e._nodeCommands,o=n.length;if(!Object(s.default)(n[0].translucentCommand)||i)for(var l=0;l<o;++l){var u=n[l],d=u.command;if(u.translucentCommand=Lm(d),!a){var f=u.command2D;u.translucentCommand2D=Lm(f)}}}}function Mm(e,t){var i=e._rendererResources.programs;for(var a in i)if(i.hasOwnProperty(a)&&i[a]===t)return a}function Rm(e,t,i){var a=t.vertexShaderSource.sources[0],r=t._attributeLocations,n=e._normalAttributeName;a=Nf.a.replaceMain(a,"gltf_silhouette_main"),a+="uniform float gltf_silhouetteSize; \nvoid main() \n{ \n    gltf_silhouette_main(); \n    vec3 n = normalize(czm_normal3D * "+n+"); \n    n.x *= czm_projection[0][0]; \n    n.y *= czm_projection[1][1]; \n    vec4 clip = gl_Position; \n    clip.xy += n.xy * clip.w * gltf_silhouetteSize * czm_pixelRatio / czm_viewport.z; \n    gl_Position = clip; \n}";return Rf.a.fromCache({context:i.context,vertexShaderSource:a,fragmentShaderSource:"uniform vec4 gltf_silhouetteColor; \nvoid main() \n{ \n    gl_FragColor = czm_gammaCorrect(gltf_silhouetteColor); \n}",attributeLocations:r})}function Nm(e,t){return yp(t.context)&&e.silhouetteSize>0&&e.silhouetteColor.alpha>0&&Object(s.default)(e._normalAttributeName)}function Vm(e){return e.color.alpha>0&&e.color.alpha<1}function Bm(e){return 0===e.color.alpha}function Um(e,t){return Math.floor(e)!==Math.floor(t)||Math.ceil(e)!==Math.ceil(t)}var Fm=0;function Hm(e,t){for(var i=++Fm%255,a=function(e){for(var t=e._nodeCommands,i=t.length,a=0;a<i;++a){if(t[a].command.pass===Lf.a.TRANSLUCENT)return!0}return!1}(e)||Vm(e)||e.silhouetteColor.alpha<1,r=e._rendererResources.silhouettePrograms,n=t.scene3DOnly,o=e._nodeCommands,l=o.length,u=0;u<l;++u){var d=o[u],f=d.command,c=Vm(e)?d.translucentCommand:f,h=If.a.shallowClone(c),p=Object(_f.default)(c.renderState);p.stencilTest={enabled:!0,frontFunction:jf.a.ALWAYS,backFunction:jf.a.ALWAYS,reference:i,mask:-1,frontOperation:{fail:jf.a.KEEP,zFail:jf.a.KEEP,zPass:jf.a.REPLACE},backOperation:{fail:jf.a.KEEP,zFail:jf.a.KEEP,zPass:jf.a.REPLACE}},Bm(e)&&(p.colorMask={red:!1,green:!1,blue:!1,alpha:!1},p.depthMask=!1),p=Df.a.fromCache(p),h.renderState=p,d.silhouetteModelCommand=h;var m=If.a.shallowClone(f);(p=Object(_f.default)(f.renderState,!0)).depthTest.enabled=!0,p.cull.enabled=!1,a&&(m.pass=Lf.a.TRANSLUCENT,p.depthMask=!1,p.blending=Rc.a.ALPHA_BLEND),p.stencilTest={enabled:!0,frontFunction:jf.a.NOTEQUAL,backFunction:jf.a.NOTEQUAL,reference:i,mask:-1,frontOperation:{fail:jf.a.KEEP,zFail:jf.a.KEEP,zPass:jf.a.KEEP},backOperation:{fail:jf.a.KEEP,zFail:jf.a.KEEP,zPass:jf.a.KEEP}},p=Df.a.fromCache(p);var _=f.shaderProgram,g=Mm(e,_),v=r[g];Object(s.default)(v)||(v=Rm(e,_,t),r[g]=v);var b=Object(gf.default)(f.uniformMap,{gltf_silhouetteColor:um(e),gltf_silhouetteSize:dm(e)});if(m.renderState=p,m.shaderProgram=v,m.uniformMap=b,m.castShadows=!1,m.receiveShadows=!1,d.silhouetteColorCommand=m,!n){var y=d.command2D,O=If.a.shallowClone(h);O.boundingVolume=y.boundingVolume,O.modelMatrix=y.modelMatrix,d.silhouetteModelCommand2D=O;var w=If.a.shallowClone(m);O.boundingVolume=y.boundingVolume,O.modelMatrix=y.modelMatrix,d.silhouetteColorCommand2D=w}}}function km(e,t,i){if(Nm(e,t)){var a=e._nodeCommands,r=Um(e.color.alpha,e._colorPreviousAlpha)||Um(e.silhouetteColor.alpha,e._silhouetteColorPreviousAlpha)||!Object(s.default)(a[0].silhouetteModelCommand);e._colorPreviousAlpha=e.color.alpha,e._silhouetteColorPreviousAlpha=e.silhouetteColor.alpha,(r||i)&&Hm(e,t)}}var zm=new r.default;var Gm=new v.default,qm=new Re.default;function Wm(e,t){var i=e.scale;if(0!==e.minimumPixelSize){var a=t.context,r=Math.max(a.drawingBufferWidth,a.drawingBufferHeight),n=Object(s.default)(e._clampedModelMatrix)?e._clampedModelMatrix:e.modelMatrix;if(Gm.x=n[12],Gm.y=n[13],Gm.z=n[14],Object(s.default)(e._rtcCenter)&&v.default.add(e._rtcCenter,Gm,Gm),e._mode!==Ve.a.SCENE3D){var o=t.mapProjection,l=o.ellipsoid.cartesianToCartographic(Gm,qm);o.project(l,Gm),v.default.fromElements(Gm.z,Gm.x,Gm.y,Gm)}var u=e.boundingSphere.radius,d=function(e,t,i){return zm.center=e,zm.radius=t,i.camera.getPixelSize(zm,i.context.drawingBufferWidth,i.context.drawingBufferHeight)}(Gm,u,t),f=1/d;Math.min(f*(2*u),r)<e.minimumPixelSize&&(i=e.minimumPixelSize*d/(2*e._initialRadius))}return Object(s.default)(e.maximumScale)?Math.min(e.maximumScale,i):i}function Ym(e){Object(s.default)(e._cacheKey)&&Object(s.default)(e._cachedGltf)&&0==--e._cachedGltf.count&&delete gp[e._cacheKey],e._cachedGltf=void 0}function Km(e,t){this.buffers=void 0,this.vertexArrays=void 0,this.programs=void 0,this.sourceShaders=void 0,this.silhouettePrograms=void 0,this.textures=void 0,this.samplers=void 0,this.renderStates=void 0,this.ready=!1,this.context=e,this.cacheKey=t,this.count=0}function Xm(e){for(var t in e)e.hasOwnProperty(t)&&e[t].destroy()}function Zm(e,t,i){return function(a){if(e.heightReference===x.default.RELATIVE_TO_GROUND){var r=t.cartesianToCartographic(a,qm);r.height+=i.height,t.cartographicToCartesian(r,a)}var n=e._clampedModelMatrix;nt.default.clone(e.modelMatrix,n),n[12]=a.x,n[13]=a.y,n[14]=a.z,e._heightChanged=!0}}Km.prototype.release=function(){if(0==--this.count)return Object(s.default)(this.cacheKey)&&delete this.context.cache.modelRendererResourceCache[this.cacheKey],Xm((e=this).buffers),Xm(e.vertexArrays),Xm(e.programs),Xm(e.silhouettePrograms),Xm(e.textures),Object(l.default)(this);var e};var Jm=new v.default,Qm=new Re.default;function $m(e,t){e.programs!==t.programs&&Xm(e.programs),e.silhouettePrograms!==t.silhouettePrograms&&Xm(e.silhouettePrograms)}bp.prototype.update=function(e){if(e.mode!==Ve.a.MORPHING)if(bf.default.supportsWebP.initialized){var t=bf.default.supportsWebP(),i=e.context;if(this._defaultTexture=i.defaultTexture,this._state===hp.NEEDS_LOAD&&Object(s.default)(this.gltf)){var a,n=this.cacheKey;if(Object(s.default)(n)){i.cache.modelRendererResourceCache=Object(o.default)(i.cache.modelRendererResourceCache,{});var l=i.cache.modelRendererResourceCache;if(a=l[this.cacheKey],Object(s.default)(a)){if(!a.ready)return;++a.count,this._loadRendererResourcesFromCache=!0}else(a=new Km(i,n)).count=1,l[this.cacheKey]=a;this._cachedRendererResources=a}else(a=new Km(i)).count=1,this._cachedRendererResources=a;if(this._state=hp.LOADING,this._state!==hp.FAILED){var u=this.gltf.extensions;if(Object(s.default)(u)&&Object(s.default)(u.CESIUM_RTC)){var d=v.default.fromArray(u.CESIUM_RTC.center);if(!v.default.equals(d,v.default.ZERO)){this._rtcCenter3D=d;var f=e.mapProjection,c=f.ellipsoid.cartesianToCartographic(this._rtcCenter3D),h=f.project(c);v.default.fromElements(h.z,h.x,h.y,h),this._rtcCenter2D=h,this._rtcCenterEye=new v.default,this._rtcCenter=this._rtcCenter3D}}Zf(this.gltf),this._loadResources=new Eh,this._loadRendererResourcesFromCache||ep.parseBuffers(this,jp)}}var p=this._loadResources,m=this._incrementallyLoadTextures,_=!1;if(this._state===hp.LOADING){if(0===p.pendingBufferLoads){if(!p.initialized){if(e.brdfLutGenerator.update(e),ep.checkSupportedExtensions(this.extensionsRequired,t),ep.updateForwardAxis(this),!Object(s.default)(this.gltf.extras.sourceVersion)){var g=this.gltf;g.extras.sourceVersion=ep.getAssetVersion(g),g.extras.sourceKHRTechniquesWebGL=Object(s.default)(ep.getUsedExtensions(g).KHR_techniques_webgl),this._sourceVersion=g.extras.sourceVersion,this._sourceKHRTechniquesWebGL=g.extras.sourceKHRTechniquesWebGL,Mc(g),Kf(g);var b={addBatchIdToGeneratedShaders:this._addBatchIdToGeneratedShaders};rp(g,b),fp(g,b)}this._sourceVersion=this.gltf.extras.sourceVersion,this._sourceKHRTechniquesWebGL=this.gltf.extras.sourceKHRTechniquesWebGL,this._dequantizeInShader=this._dequantizeInShader&&Gc.hasExtension(this),function(e){var t=e.gltf,i=e._loadResources;Gf.buffer(t,(function(e,t){i.buffers[t]=e.extras._pipeline.source}))}(this),function(e){var t={},i={},a={};e._runtime.articulationsByName=t,e._runtime.articulationsByStageKey=i,e._runtime.stagesByKey=a;var r=e.gltf;if(kf(r,"AGI_articulations")&&Object(s.default)(r.extensions)&&Object(s.default)(r.extensions.AGI_articulations)){var n=r.extensions.AGI_articulations.articulations;if(Object(s.default)(n))for(var o=n.length,l=0;l<o;++l){var u=Object(_f.default)(n[l]);u.nodes=[],u.isDirty=!0,t[u.name]=u;for(var d=u.stages.length,f=0;f<d;++f){var c=u.stages[f];c.currentValue=c.initialValue;var h=u.name+" "+c.name;i[h]=u,a[h]=c}}}}(this),function(e){var t=e.gltf;if(kf(t,"KHR_techniques_webgl")){var i=e._sourcePrograms,a=e._sourceTechniques,r=t.extensions.KHR_techniques_webgl.programs;Gf.technique(t,(function(e,t){a[t]=Object(_f.default)(e);var n=e.program;Object(s.default)(i[n])||(i[n]=Object(_f.default)(r[n]))}))}}(this),this._loadRendererResourcesFromCache||(function(e){var t=e.gltf.bufferViews,i=e._loadResources.vertexBuffersToCreate;Gf.bufferView(e.gltf,(function(e,t){e.target===jf.a.ARRAY_BUFFER&&i.enqueue(t)}));var a=e._loadResources.indexBuffersToCreate,r={};Gf.accessor(e.gltf,(function(e){var i=e.bufferView;Object(s.default)(i)&&(t[i].target!==jf.a.ELEMENT_ARRAY_BUFFER||Object(s.default)(r[i])||(r[i]=!0,a.enqueue({id:i,componentType:e.componentType})))}))}(this),function(e){var t=e.gltf,i=t.buffers,a=t.bufferViews,r=e._rendererResources.sourceShaders;Gf.shader(t,(function(t,n){if(Object(s.default)(t.bufferView)){var o=t.bufferView,l=a[o],u=l.buffer,d=i[u],f=Object(Of.a)(d.extras._pipeline.source,l.byteOffset,l.byteLength);r[n]=f}else if(Object(s.default)(t.extras._pipeline.source))r[n]=t.extras._pipeline.source;else{++e._loadResources.pendingShaderLoads;var c=e._resource.getDerivedResource({url:t.uri});c.fetchText().then(function(e,t,i){return function(a){var r=e._loadResources;r.shaders[i]={source:a,type:t,bufferView:void 0},--r.pendingShaderLoads,e._rendererResources.sourceShaders[i]=a}}(e,t.type,n)).otherwise(ep.getFailedLoadFunction(e,"shader",c.url))}}))}(this),function(e){var t=e._sourceTechniques;for(var i in t)if(t.hasOwnProperty(i)){var a=t[i];e._loadResources.programsToCreate.enqueue({programId:a.program,techniqueId:i})}}(this),function(e,t,i){var a,r=e.gltf,n=r.images;Gf.texture(r,(function(r,o){var l=r.source;Object(s.default)(r.extensions)&&Object(s.default)(r.extensions.EXT_texture_webp)&&i&&(l=r.extensions.EXT_texture_webp.source);var u=n[l],d=u.extras,f=u.bufferView,c=u.mimeType;if(a=u.uri,Object(s.default)(d)&&Object(s.default)(d.compressedImage3DTiles)){var h=d.compressedImage3DTiles.crunch,p=d.compressedImage3DTiles.s3tc,m=d.compressedImage3DTiles.pvrtc1,_=d.compressedImage3DTiles.etc1;t.s3tc&&Object(s.default)(h)?(c=h.mimeType,Object(s.default)(h.bufferView)?f=h.bufferView:a=h.uri):t.s3tc&&Object(s.default)(p)?(c=p.mimeType,Object(s.default)(p.bufferView)?f=p.bufferView:a=p.uri):t.pvrtc&&Object(s.default)(m)?(c=m.mimeType,Object(s.default)(m.bufferView)?f=m.bufferView:a=m.uri):t.etc1&&Object(s.default)(_)&&(c=_.mimeType,Object(s.default)(_.bufferView)?f=_.bufferView:a=_.uri)}if(Object(s.default)(f))e._loadResources.texturesToCreateFromBufferView.enqueue({id:o,image:void 0,bufferView:f,mimeType:c});else{++e._loadResources.pendingTextureLoads;var g=e._resource.getDerivedResource({url:a});(Sp.test(a)?Object(Cf.a)(g):Ip.test(a)?Object(xf.a)(g):g.fetchImage()).then(Pp(e,o)).otherwise(ep.getFailedLoadFunction(e,"image",g.url))}}))}(this,i,t)),function(e){var t=e.gltf,i=e._sourceTechniques,a={},r={},n=e._uniformMaps;Gf.material(t,(function(t,o){n[o]={uniformMap:void 0,values:void 0,jointMatrixUniformName:void 0,morphWeightsUniformName:void 0};var l=new Ch(e,t,o);if(Object(s.default)(t.extensions)&&Object(s.default)(t.extensions.KHR_techniques_webgl)){var u=t.extensions.KHR_techniques_webgl.technique;l._technique=u,l._program=i[u].program,Gf.materialValue(t,(function(e,t){Object(s.default)(l._values)||(l._values={}),l._values[t]=Object(_f.default)(e)}))}a[t.name]=l,r[o]=l})),e._runtime.materialsByName=a,e._runtime.materialsById=r}(this),function(e){var t={},i=e._runtime.materialsById;Gf.mesh(e.gltf,(function(a,r){t[a.name]=new jh(a,i,r),(Object(s.default)(e.extensionsUsed.WEB3D_quantized_attributes)||e._dequantizeInShader)&&Gf.meshPrimitive(a,(function(t,i){var a=Up(e,t),n=e._programPrimitives[a];Object(s.default)(n)||(n={},e._programPrimitives[a]=n),n[r+".primitive."+i]=t}))})),e._runtime.meshesByName=t}(this),function(e){var t={},i={},a=[],r=e._loadResources.skinnedNodesIds,n=e._runtime.articulationsByName;Gf.node(e.gltf,(function(o,l){var u={matrix:void 0,translation:void 0,rotation:void 0,scale:void 0,computedShow:!0,transformToRoot:new nt.default,computedMatrix:new nt.default,dirtyNumber:0,commands:[],inverseBindMatrices:void 0,bindShapeMatrix:void 0,joints:[],computedJointMatrices:[],jointName:o.jointName,weights:[],children:[],parents:[],publicNode:void 0};if(u.publicNode=new Sh(e,o,u,l,ep.getTransform(o)),t[l]=u,i[o.name]=u,Object(s.default)(o.skin)&&(r.push(l),a.push(u)),Object(s.default)(o.extensions)&&Object(s.default)(o.extensions.AGI_articulations)){var d=o.extensions.AGI_articulations.articulationName;if(Object(s.default)(d)){var f=nt.default.clone(u.publicNode.originalMatrix,Lp),c=n[d];c.nodes.push(u.publicNode);for(var h=c.stages.length,p=0;p<h;++p){f=Cp(c.stages[p],f)}u.publicNode.matrix=f}}})),e._runtime.nodes=t,e._runtime.nodesByName=i,e._runtime.skinnedNodes=a}(this),Gc.parse(this,i),p.initialized=!0}p.finishedDecoding()||Gc.decodeModel(this,i).otherwise(ep.getFailedLoadFunction(this,"model",this.basePath)),p.finishedDecoding()&&!p.resourcesParsed&&(this._boundingSphere=ep.computeBoundingSphere(this),this._initialRadius=this._boundingSphere.radius,Gc.cacheDataForModel(this),p.resourcesParsed=!0),p.resourcesParsed&&0===p.pendingShaderLoads&&Cm(this,e)}(p.finished()||m&&p.finishedEverythingButTextureCreation())&&(this._state=hp.LOADED,_=!0)}if(Object(s.default)(p)&&this._state===hp.LOADED&&(m&&!_&&Cm(this,e),p.finished())){this._loadResources=void 0;var y=this._rendererResources,O=this._cachedRendererResources;O.buffers=y.buffers,O.vertexArrays=y.vertexArrays,O.programs=y.programs,O.sourceShaders=y.sourceShaders,O.silhouettePrograms=y.silhouettePrograms,O.textures=y.textures,O.samplers=y.samplers,O.renderStates=y.renderStates,O.ready=!0,this._normalAttributeName=ep.getAttributeOrUniformBySemantic(this.gltf,"NORMAL"),Object(s.default)(this._precreatedAttributes)&&(O.vertexArrays={}),this.releaseGltfJson&&Ym(this)}var w=tp.a.isSupported(i);if(this._shouldUpdateSpecularMapAtlas&&w){if(this._shouldUpdateSpecularMapAtlas=!1,this._specularEnvironmentMapAtlas=this._specularEnvironmentMapAtlas&&this._specularEnvironmentMapAtlas.destroy(),this._specularEnvironmentMapAtlas=void 0,Object(s.default)(this._specularEnvironmentMaps)){this._specularEnvironmentMapAtlas=new tp.a(this._specularEnvironmentMaps);var E=this;this._specularEnvironmentMapAtlas.readyPromise.then((function(){E._shouldRegenerateShaders=!0})).otherwise((function(e){console.error("Error loading specularEnvironmentMaps: "+e)}))}this._shouldRegenerateShaders=!0}Object(s.default)(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(e);var T=!Object(s.default)(this._specularEnvironmentMapAtlas)&&Object(s.default)(e.specularEnvironmentMaps)&&!this._useDefaultSpecularMaps,C=!Object(s.default)(e.specularEnvironmentMaps)&&this._useDefaultSpecularMaps,A=!Object(s.default)(this._sphericalHarmonicCoefficients)&&Object(s.default)(e.sphericalHarmonicCoefficients)&&!this._useDefaultSphericalHarmonics,j=!Object(s.default)(e.sphericalHarmonicCoefficients)&&this._useDefaultSphericalHarmonics;this._shouldRegenerateShaders=this._shouldRegenerateShaders||T||C||A||j,this._useDefaultSpecularMaps=!Object(s.default)(this._specularEnvironmentMapAtlas)&&Object(s.default)(e.specularEnvironmentMaps),this._useDefaultSphericalHarmonics=!Object(s.default)(this._sphericalHarmonicCoefficients)&&Object(s.default)(e.sphericalHarmonicCoefficients);var P=Nm(this,e),S=Vm(this),I=Bm(this),L=!Object(s.default)(this.distanceDisplayCondition)||function(e,t){var i,a=e.distanceDisplayCondition,r=a.near*a.near,n=a.far*a.far;if(t.mode===Ve.a.SCENE2D){i=.5*(t.camera.frustum.right-t.camera.frustum.left),i*=i}else{var o=nt.default.getTranslation(e.modelMatrix,Jm);if(t.mode===Ve.a.COLUMBUS_VIEW){var s=t.mapProjection,l=s.ellipsoid.cartesianToCartographic(o,Qm);o=s.project(l,o),v.default.fromElements(o.z,o.x,o.y,o)}i=v.default.distanceSquared(o,t.camera.positionWC)}return i>=r&&i<=n}(this,e),D=this.show&&L&&0!==this.scale&&(!I||P);if(D&&this._state===hp.LOADED||_){var M=this.activeAnimations.update(e)||this._cesiumAnimationsDirty;this._cesiumAnimationsDirty=!1,this._dirty=!1;var R=this.modelMatrix,N=e.mode!==this._mode;this._mode=e.mode;var V=!nt.default.equals(this._modelMatrix,R)||this._scale!==this.scale||this._minimumPixelSize!==this.minimumPixelSize||0!==this.minimumPixelSize||this._maximumScale!==this.maximumScale||this._heightReference!==this.heightReference||this._heightChanged||N;if(V||_){nt.default.clone(R,this._modelMatrix),function(e){Object(s.default)(e._removeUpdateHeightCallback)&&(e._removeUpdateHeightCallback(),e._removeUpdateHeightCallback=void 0);var t=e._scene;if(Object(s.default)(t)&&Object(s.default)(t.globe)&&e.heightReference!==x.default.NONE){var i=t.globe,a=i.ellipsoid,r=e.modelMatrix;Gm.x=r[12],Gm.y=r[13],Gm.z=r[14];var n=a.cartesianToCartographic(Gm);Object(s.default)(e._clampedModelMatrix)||(e._clampedModelMatrix=nt.default.clone(r,new nt.default));var o=i._surface;e._removeUpdateHeightCallback=o.updateHeight(n,Zm(e,a,n));var l=i.getHeight(n);if(Object(s.default)(l)){var u=Zm(e,a,n);Re.default.clone(n,qm),qm.height=l,a.cartographicToCartesian(qm,Gm),u(Gm)}}else e._clampedModelMatrix=void 0}(this),Object(s.default)(this._clampedModelMatrix)&&(R=this._clampedModelMatrix),this._scale=this.scale,this._minimumPixelSize=this.minimumPixelSize,this._maximumScale=this.maximumScale,this._heightReference=this.heightReference,this._heightChanged=!1;var B=Wm(this,e),U=this._computedModelMatrix;nt.default.multiplyByUniformScale(R,B,U),this._upAxis===hf.Y?nt.default.multiplyTransformation(U,hf.Y_UP_TO_Z_UP,U):this._upAxis===hf.X&&nt.default.multiplyTransformation(U,hf.X_UP_TO_Z_UP,U),this.forwardAxis===hf.Z&&nt.default.multiplyTransformation(U,hf.Z_UP_TO_X_UP,U)}(M||V||_)&&(function(e,t,i,a){var n=e._maxDirtyNumber,o=e._runtime.rootNodes,l=o.length,u=jm,d=e._computedModelMatrix;if(e._mode!==Ve.a.SCENE3D&&!e._ignoreCommands){var f=nt.default.getColumn(d,3,Pm);if(It.a.equals(f,It.a.UNIT_W)){var c=e.boundingSphere.center,h=Mt.default.wgs84To2DModelMatrix(a,c,Sm);d=nt.default.multiply(h,d,Sm),Object(s.default)(e._rtcCenter)&&(nt.default.setTranslation(d,It.a.UNIT_W,d),e._rtcCenter=e._rtcCenter2D)}else d=Mt.default.basisTo2D(a,d,Sm),e._rtcCenter=e._rtcCenter3D}for(var p=0;p<l;++p){var m=o[p];for(Am(m,m.transformToRoot),u.push(m);u.length>0;){var _=(m=u.pop()).transformToRoot,g=m.commands;if(m.dirtyNumber===n||t||i){var b=nt.default.multiplyTransformation(d,_,m.computedMatrix),y=g.length;if(y>0)for(var O=0;O<y;++O){var w=g[O],x=w.command;nt.default.clone(b,x.modelMatrix),r.default.transform(w.boundingSphere,x.modelMatrix,x.boundingVolume),Object(s.default)(e._rtcCenter)&&v.default.add(e._rtcCenter,x.boundingVolume.center,x.boundingVolume.center),x=w.command2D,Object(s.default)(x)&&e._mode===Ve.a.SCENE2D&&(nt.default.clone(b,x.modelMatrix),x.modelMatrix[13]-=2*Ne.default.sign(x.modelMatrix[13])*Ne.default.PI*a.ellipsoid.maximumRadius,r.default.transform(w.boundingSphere,x.modelMatrix,x.boundingVolume))}}var E=m.children;if(Object(s.default)(E))for(var T=E.length,C=0;C<T;++C){var A=E[C];A.dirtyNumber=Math.max(A.dirtyNumber,m.dirtyNumber),(A.dirtyNumber===n||i)&&(Am(A,A.transformToRoot),nt.default.multiplyTransformation(_,A.transformToRoot,A.transformToRoot)),u.push(A)}}}++e._maxDirtyNumber}(this,V,_,e.mapProjection),this._dirty=!0,(M||_)&&function(e){for(var t=e._runtime.skinnedNodes,i=t.length,a=0;a<i;++a){var r=t[a];Im=nt.default.inverseTransformation(r.transformToRoot,Im);for(var n=r.computedJointMatrices,o=r.joints,l=r.bindShapeMatrix,u=r.inverseBindMatrices,d=u.length,f=0;f<d;++f)Object(s.default)(n[f])||(n[f]=new nt.default),n[f]=nt.default.multiplyTransformation(Im,o[f].transformToRoot,n[f]),n[f]=nt.default.multiplyTransformation(n[f],u[f],n[f]),Object(s.default)(l)&&(n[f]=nt.default.multiplyTransformation(n[f],l,n[f]))}}(this)),this._perNodeShowDirty&&(this._perNodeShowDirty=!1,function(e){for(var t=e._runtime.rootNodes,i=t.length,a=jm,r=0;r<i;++r){var n=t[r];for(n.computedShow=n.publicNode.show,a.push(n);a.length>0;){for(var o=(n=a.pop()).computedShow,l=n.commands,u=l.length,d=0;d<u;++d)l[d].show=o;var f=n.children;if(Object(s.default)(f))for(var c=f.length,h=0;h<c;++h){var p=f[h];p.computedShow=o&&p.publicNode.show,a.push(p)}}}}(this)),function(e,t){var i=e.id;if(e._id!==i){e._id=i;for(var a=e._pickIds,r=a.length,n=0;n<r;++n)a[n].object.id=i}}(this),function(e){if(e._debugWireframe!==e.debugWireframe){e._debugWireframe=e.debugWireframe;for(var t=e.debugWireframe?Wi.a.LINES:Wi.a.TRIANGLES,i=e._nodeCommands,a=i.length,r=0;r<a;++r)i[r].command.primitiveType=t}}(this),function(e){if(e.debugShowBoundingVolume!==e._debugShowBoundingVolume){e._debugShowBoundingVolume=e.debugShowBoundingVolume;for(var t=e.debugShowBoundingVolume,i=e._nodeCommands,a=i.length,r=0;r<a;++r)i[r].command.debugShowBoundingVolume=t}}(this),function(e){if(e.shadows!==e._shadows){e._shadows=e.shadows;for(var t=ae.a.castShadows(e.shadows),i=ae.a.receiveShadows(e.shadows),a=e._nodeCommands,r=a.length,n=0;n<r;n++){var o=a[n];o.command.castShadows=t,o.command.receiveShadows=i}}}(this),function(e,t){var i=e._clippingPlanes;Object(s.default)(i)&&i.owner===e&&i.enabled&&i.update(t)}(this,e);var F=this._clippingPlanes,H=0,k=Object(s.default)(F)&&F.enabled&&F.length>0,z=Object(s.default)(this._sphericalHarmonicCoefficients)||this._useDefaultSphericalHarmonics,G=Object(s.default)(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready||this._useDefaultSpecularMaps;if(k||z||G){var q=Object(o.default)(this.clippingPlanesOriginMatrix,R);nt.default.multiply(i.uniformState.view3D,q,this._clippingPlaneModelViewMatrix)}k&&(H=F.clippingPlanesState);var W=this._shouldRegenerateShaders;W=W||this._clippingPlanesState!==H,this._clippingPlanesState=H;var Y=Op(this);Y!==this._colorShadingEnabled&&(this._colorShadingEnabled=Y,W=!0),W?function(e,t){var i,a=e._rendererResources,r=e._cachedRendererResources;if($m(a,r),wp(e)||Op(e)||e._shouldRegenerateShaders){e._shouldRegenerateShaders=!1,a.programs={},a.silhouettePrograms={};var n,o={},l=e._sourceTechniques;for(var u in l)l.hasOwnProperty(u)&&(n=l[u],i=n.program,o[i]||(o[i]=!0,Gp({programId:i,techniqueId:u},e,t.context)))}else a.programs=r.programs,a.silhouettePrograms=r.silhouettePrograms;for(var d=a.programs,f=e._nodeCommands,c=f.length,h=0;h<c;++h){var p=f[h];i=p.programId;var m=d[i];p.command.shaderProgram=m,Object(s.default)(p.command2D)&&(p.command2D.shaderProgram=m)}Dm(e,t,!0),km(e,t,!0)}(this,e):(Dm(this,e,!1),km(this,e,!1))}if(_){var K=this;e.afterRender.push((function(){K._ready=!0,K._readyPromise.resolve(K)}))}else{if(D&&!this._ignoreCommands){var X,Z,J,Q=e.commandList,$=e.passes,ee=this._nodeCommands,te=ee.length,ie=e.mapProjection.ellipsoid.maximumRadius*Ne.default.PI;if($.render||$.pick&&this.allowPicking){for(X=0;X<te;++X)if((Z=ee[X]).show){var re=S?Z.translucentCommand:Z.command;if(re=P?Z.silhouetteModelCommand:re,Q.push(re),J=Z.command.boundingVolume,e.mode===Ve.a.SCENE2D&&(J.center.y+J.radius>ie||J.center.y-J.radius<ie)){var ne=S?Z.translucentCommand2D:Z.command2D;ne=P?Z.silhouetteModelCommand2D:ne,Q.push(ne)}}if(P&&!$.pick)for(X=0;X<te;++X)(Z=ee[X]).show&&(Q.push(Z.silhouetteColorCommand),J=Z.command.boundingVolume,e.mode===Ve.a.SCENE2D&&(J.center.y+J.radius>ie||J.center.y-J.radius<ie)&&Q.push(Z.silhouetteColorCommand2D))}}var oe=this._credit;Object(s.default)(oe)&&e.creditDisplay.addCredit(oe);for(var se=this._resourceCredits,le=se.length,ue=0;ue<le;ue++)e.creditDisplay.addCredit(se[ue])}}else bf.default.supportsWebP.initialize()},bp.prototype.isDestroyed=function(){return!1},bp.prototype.destroy=function(){Object(s.default)(this._precreatedAttributes)&&Xm(this._rendererResources.vertexArrays),Object(s.default)(this._removeUpdateHeightCallback)&&(this._removeUpdateHeightCallback(),this._removeUpdateHeightCallback=void 0),Object(s.default)(this._terrainProviderChangedCallback)&&(this._terrainProviderChangedCallback(),this._terrainProviderChangedCallback=void 0),Object(s.default)(this._cachedRendererResources)&&$m(this._rendererResources,this._cachedRendererResources),this._rendererResources=void 0,this._cachedRendererResources=this._cachedRendererResources&&this._cachedRendererResources.release(),Gc.destroyCachedDataForModel(this);for(var e=this._pickIds,t=e.length,i=0;i<t;++i)e[i].destroy();Ym(this),this._quantizedVertexShaders=void 0;var a=this._clippingPlanes;return Object(s.default)(a)&&!a.isDestroyed()&&a.owner===this&&a.destroy(),this._clippingPlanes=void 0,this._specularEnvironmentMapAtlas=this._specularEnvironmentMapAtlas&&this._specularEnvironmentMapAtlas.destroy(),Object(l.default)(this)},bp._getClippingFunction=Wc.a,bp._modifyShaderForColor=function(e){return e=Nf.a.replaceMain(e,"gltf_blend_main"),e+="uniform vec4 gltf_color; \nuniform float gltf_colorBlend; \nvoid main() \n{ \n    gltf_blend_main(); \n    gl_FragColor.rgb = mix(gl_FragColor.rgb, gltf_color.rgb, gltf_colorBlend); \n    float highlight = ceil(gltf_colorBlend); \n    gl_FragColor.rgb *= mix(gltf_color.rgb, vec3(1.0), highlight); \n    gl_FragColor.a *= gltf_color.a; \n} \n"};var e_=bp,t_=ae.a.ENABLED,i_=x.default.NONE,a_=b.default.RED,r_=b.default.WHITE,n_=mf.a.HIGHLIGHT,o_=new g.default(1,1),s_=hf.Y,l_=new nt.default,u_=new nt.default;function d_(e,t){t.collectionChanged.addEventListener(d_.prototype._onCollectionChanged,this),this._scene=e,this._primitives=e.primitives,this._entityCollection=t,this._modelHash={},this._entitiesToVisualize=new m.default,this._onCollectionChanged(t,t.values,[],[])}function f_(e,t,i,a){var r=i[t.id];Object(s.default)(r)&&(a.removeAndDestroy(r.modelPrimitive),delete i[t.id])}function c_(e,t){var i=t[e.id];Object(s.default)(i)&&(i.nodeTransformationsScratch={},i.articulationsScratch={})}function h_(e,t,i){e.readyPromise.otherwise((function(e){console.error(e),i[t.id].loadFail=!0}))}d_.prototype.update=function(e){for(var t=this._entitiesToVisualize.values,i=this._modelHash,a=this._primitives,r=0,n=t.length;r<n;r++){var o,l,u=t[r],d=u._model,f=i[u.id],c=u.isShowing&&u.isAvailable(e)&&A.default.getValueOrDefault(d._show,e,!0);if(c&&(l=u.computeModelMatrix(e,l_),o=pf.default.createIfNeeded(A.default.getValueOrUndefined(d._uri,e)),c=Object(s.default)(l)&&Object(s.default)(o)),c){var h=Object(s.default)(f)?f.modelPrimitive:void 0;if(Object(s.default)(h)&&o.url===f.url||(Object(s.default)(h)&&(a.removeAndDestroy(h),delete i[u.id]),(h=e_.fromGltf({url:o,incrementallyLoadTextures:A.default.getValueOrDefault(d._incrementallyLoadTextures,e,!0),scene:this._scene})).id=u,a.add(h),f={modelPrimitive:h,url:o.url,animationsRunning:!1,nodeTransformationsScratch:{},articulationsScratch:{},loadFail:!1},i[u.id]=f,h_(h,u,i)),h.show=!0,h.scale=A.default.getValueOrDefault(d._scale,e,1),h.minimumPixelSize=A.default.getValueOrDefault(d._minimumPixelSize,e,0),h.maximumScale=A.default.getValueOrUndefined(d._maximumScale,e),h.modelMatrix=nt.default.clone(l,h.modelMatrix),h.shadows=A.default.getValueOrDefault(d._shadows,e,t_),h.heightReference=A.default.getValueOrDefault(d._heightReference,e,i_),h.distanceDisplayCondition=A.default.getValueOrUndefined(d._distanceDisplayCondition,e),h.silhouetteColor=A.default.getValueOrDefault(d._silhouetteColor,e,a_,h._silhouetteColor),h.silhouetteSize=A.default.getValueOrDefault(d._silhouetteSize,e,0),h.color=A.default.getValueOrDefault(d._color,e,r_,h._color),h.colorBlendMode=A.default.getValueOrDefault(d._colorBlendMode,e,n_),h.colorBlendAmount=A.default.getValueOrDefault(d._colorBlendAmount,e,.5),h.clippingPlanes=A.default.getValueOrUndefined(d._clippingPlanes,e),h.clampAnimations=A.default.getValueOrDefault(d._clampAnimations,e,!0),h.imageBasedLightingFactor=A.default.getValueOrDefault(d._imageBasedLightingFactor,e,o_),h.lightColor=A.default.getValueOrUndefined(d._lightColor,e),h._upAxis=A.default.getValueOrDefault(d._upAxis,e,s_),h._forwardAxis=A.default.getValueOrUndefined(d._forwardAxis,e),h.ready){var p=A.default.getValueOrDefault(d._runAnimations,e,!0);f.animationsRunning!==p&&(p?h.activeAnimations.addAll({loop:ch.REPEAT}):h.activeAnimations.removeAll(),f.animationsRunning=p);var m=A.default.getValueOrUndefined(d._nodeTransformations,e,f.nodeTransformationsScratch);if(Object(s.default)(m))for(var _=Object.keys(m),g=0,v=_.length;g<v;++g){var b=_[g],y=m[b];if(Object(s.default)(y)){var O=h.getNode(b);if(Object(s.default)(O)){var w=nt.default.fromTranslationRotationScale(y,u_);O.matrix=nt.default.multiply(O.originalMatrix,w,w)}}}var x=!1,E=A.default.getValueOrUndefined(d._articulations,e,f.articulationsScratch);if(Object(s.default)(E))for(var T=Object.keys(E),C=0,j=T.length;C<j;++C){var P=T[C],S=E[P];Object(s.default)(S)&&(x=!0,h.setArticulationStage(P,S))}x&&h.applyArticulations()}}else Object(s.default)(f)&&(f.modelPrimitive.show=!1)}return!0},d_.prototype.isDestroyed=function(){return!1},d_.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(d_.prototype._onCollectionChanged,this);for(var e=this._entitiesToVisualize.values,t=this._modelHash,i=this._primitives,a=e.length-1;a>-1;a--)f_(this,e[a],t,i);return Object(l.default)(this)},d_.prototype.getBoundingSphere=function(e,t){var i=this._modelHash[e.id];if(!Object(s.default)(i)||i.loadFail)return C.default.FAILED;var a=i.modelPrimitive;if(!Object(s.default)(a)||!a.show)return C.default.FAILED;if(!a.ready)return C.default.PENDING;if(a.heightReference===x.default.NONE)r.default.transform(a.boundingSphere,a.modelMatrix,t);else{if(!Object(s.default)(a._clampedModelMatrix)||a._heightChanged)return C.default.PENDING;r.default.transform(a.boundingSphere,a._clampedModelMatrix,t)}return C.default.DONE},d_.prototype._onCollectionChanged=function(e,t,i,a){var r,n,o=this._entitiesToVisualize,l=this._modelHash,u=this._primitives;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._model)&&Object(s.default)(n._position)&&o.set(n.id,n);for(r=a.length-1;r>-1;r--)n=a[r],Object(s.default)(n._model)&&Object(s.default)(n._position)?(c_(n,l),o.set(n.id,n)):(f_(this,n,l,u),o.remove(n.id));for(r=i.length-1;r>-1;r--)f_(this,n=i[r],l,u),o.remove(n.id)};var p_=d_,m_=i(278),__=i(242),g_=i(92),v_=i(208),b_=i(59),y_=i(56),O_=i(207),w_=i(274),x_=i(101),E_=i(205),T_=i(48),C_=i(32),A_=Object.freeze({HIGHLIGHT:0,REPLACE:1,MIX:2}),j_=i(156),P_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},S_={SCALAR:void 0,VEC2:g.default,VEC3:v.default,VEC4:It.a,MAT2:el.a,MAT3:et.default,MAT4:nt.default};var I_=function(e){var t,i=e.componentType;t="string"==typeof i?se.a.fromName(i):i;var a=P_[e.type],r=S_[e.type];return{componentsPerAttribute:a,classType:r,createArrayBufferView:function(e,i,r){return se.a.createArrayBufferView(t,e,i,a*r)}}},L_=i(114),D_=i(118),M_=i(60),R_=b.default.WHITE;function N_(e,t,i,a,r){var n;this.featuresLength=t,this._translucentFeaturesLength=0,Object(s.default)(i)&&(n=i.extensions),this._extensions=Object(o.default)(n,{});var l,u,d=function(e){var t={};if(!Object(s.default)(e))return t;for(var i in e)e.hasOwnProperty(i)&&"HIERARCHY"!==i&&"extensions"!==i&&"extras"!==i&&(t[i]=Object(_f.default)(e[i],!0));return t}(i);if(this._properties=d,this._batchTableHierarchy=function(e,t,i){if(!Object(s.default)(t))return;var a=e._extensions["3DTILES_batch_table_hierarchy"],r=t.HIERARCHY;Object(s.default)(r)&&(N_._deprecationWarning("batchTableHierarchyExtension","The batch table HIERARCHY property has been moved to an extension. Use extensions.3DTILES_batch_table_hierarchy instead."),e._extensions["3DTILES_batch_table_hierarchy"]=r,a=r);if(!Object(s.default)(a))return;return function(e,t){var i,a,r,n,l=e.instancesLength,u=e.classes,d=e.classIds,f=e.parentCounts,c=e.parentIds,h=l;Object(s.default)(d.byteOffset)&&(d.componentType=Object(o.default)(d.componentType,se.a.UNSIGNED_SHORT),d.type=ih.SCALAR,r=I_(d),d=r.createArrayBufferView(t.buffer,t.byteOffset+d.byteOffset,l));if(Object(s.default)(f))for(Object(s.default)(f.byteOffset)&&(f.componentType=Object(o.default)(f.componentType,se.a.UNSIGNED_SHORT),f.type=ih.SCALAR,r=I_(f),f=r.createArrayBufferView(t.buffer,t.byteOffset+f.byteOffset,l)),n=new Uint16Array(l),h=0,i=0;i<l;++i)n[i]=h,h+=f[i];Object(s.default)(c)&&Object(s.default)(c.byteOffset)&&(c.componentType=Object(o.default)(c.componentType,se.a.UNSIGNED_SHORT),c.type=ih.SCALAR,r=I_(c),c=r.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,h));var p=u.length;for(i=0;i<p;++i){var m=u[i].length,_=u[i].instances,g=V_(m,_,t);u[i].instances=Object(gf.default)(g,_)}var v=Object(Je.a)(new Array(p),0),b=new Uint16Array(l);for(i=0;i<l;++i)a=d[i],b[i]=v[a],++v[a];return{classes:u,classIds:d,classIndexes:b,parentCounts:f,parentIndexes:n,parentIds:c}}(a,i)}(this,i,a),this._batchTableBinaryProperties=V_(t,d,a),this._showAlphaProperties=void 0,this._batchValues=void 0,this._batchValuesDirty=!1,this._batchTexture=void 0,this._defaultTexture=void 0,this._pickTexture=void 0,this._pickIds=[],this._content=e,this._colorChangedCallback=r,t>0){var f=Math.min(t,T_.a.maximumTextureSize),c=Math.ceil(t/T_.a.maximumTextureSize),h=1/f,p=.5*h,m=1/c,_=.5*m;l=new g.default(f,c),u=new It.a(h,p,m,_)}this._textureDimensions=l,this._textureStep=u}function V_(e,t,i){var a;for(var r in t)if(t.hasOwnProperty(r)){var n=t[r],o=n.byteOffset;if(Object(s.default)(o)){var l=n.componentType,u=n.type;if(!Object(s.default)(l))throw new $f.default("componentType is required.");if(!Object(s.default)(u))throw new $f.default("type is required.");if(!Object(s.default)(i))throw new $f.default("Property "+r+" requires a batch table binary.");var d=I_(n),f=d.componentsPerAttribute,c=d.classType,h=d.createArrayBufferView(i.buffer,i.byteOffset+o,e);Object(s.default)(a)||(a={}),a[r]={typedArray:h,componentCount:f,type:c}}}return a}function B_(e){var t=e._textureDimensions;return t.x*t.y*4}function U_(e){if(!Object(s.default)(e._batchValues)){var t=B_(e),i=new Uint8Array(t);Object(Je.a)(i,255),e._batchValues=i}return e._batchValues}function F_(e){if(!Object(s.default)(e._showAlphaProperties)){var t=2*e.featuresLength,i=new Uint8Array(t);Object(Je.a)(i,255),e._showAlphaProperties=i}return e._showAlphaProperties}N_._deprecationWarning=m_.default,Object.defineProperties(N_.prototype,{memorySizeInBytes:{get:function(){var e=0;return Object(s.default)(this._pickTexture)&&(e+=this._pickTexture.sizeInBytes),Object(s.default)(this._batchTexture)&&(e+=this._batchTexture.sizeInBytes),e}}}),N_.getBinaryProperties=function(e,t,i){return V_(e,t,i)},N_.prototype.setShow=function(e,t){if(!t||Object(s.default)(this._showAlphaProperties)){var i=F_(this),a=2*e,r=t?255:0;if(i[a]!==r)i[a]=r,U_(this)[4*e+3]=t?i[a+1]:0,this._batchValuesDirty=!0}},N_.prototype.setAllShow=function(e){for(var t=this.featuresLength,i=0;i<t;++i)this.setShow(i,e)},N_.prototype.getShow=function(e){if(!Object(s.default)(this._showAlphaProperties))return!0;var t=2*e;return 255===this._showAlphaProperties[t]};var H_=new Array(4);N_.prototype.setColor=function(e,t){if(!b.default.equals(t,R_)||Object(s.default)(this._batchValues)){var i=t.toBytes(H_),a=i[3],r=U_(this),n=4*e,o=F_(this),l=2*e;if(r[n]!==i[0]||r[n+1]!==i[1]||r[n+2]!==i[2]||o[l+1]!==a){r[n]=i[0],r[n+1]=i[1],r[n+2]=i[2];var u=255!==o[l+1],d=0!==o[l];r[n+3]=d?a:0,o[l+1]=a;var f=255!==a;f&&!u?++this._translucentFeaturesLength:!f&&u&&--this._translucentFeaturesLength,this._batchValuesDirty=!0,Object(s.default)(this._colorChangedCallback)&&this._colorChangedCallback(e,t)}}},N_.prototype.setAllColor=function(e){for(var t=this.featuresLength,i=0;i<t;++i)this.setColor(i,e)},N_.prototype.getColor=function(e,t){if(!Object(s.default)(this._batchValues))return b.default.clone(R_,t);var i=this._batchValues,a=4*e,r=this._showAlphaProperties,n=2*e;return b.default.fromBytes(i[a],i[a+1],i[a+2],r[n+1],t)},N_.prototype.getPickColor=function(e){return this._pickIds[e]};var k_=new b.default;function z_(e,t){var i=e.typedArray,a=e.componentCount;return 1===a?i[t]:e.type.unpack(i,t*a)}function G_(e,t,i){var a=e.typedArray,r=e.componentCount;1===r?a[t]=i:e.type.pack(i,a,t*r)}N_.prototype.applyStyle=function(e){if(!Object(s.default)(e))return this.setAllColor(R_),void this.setAllShow(!0);for(var t=this._content,i=this.featuresLength,a=0;a<i;++a){var r=t.getFeature(a),n=Object(s.default)(e.color)?e.color.evaluateColor(r,k_):R_,o=!Object(s.default)(e.show)||e.show.evaluate(r);this.setColor(a,n),this.setShow(a,o)}};var q_=[],W_=[],Y_=0;function K_(e,t,i){var a=e.parentCounts,r=e.parentIds;return Object(s.default)(r)?Object(s.default)(a)?function(e,t,i){var a=e.classIds,r=e.parentCounts,n=e.parentIds,o=e.parentIndexes,l=a.length,u=q_;u.length=Math.max(u.length,l);var d=++Y_,f=W_;for(f.length=0,f.push(t);f.length>0;)if(u[t=f.pop()]!==d){u[t]=d;var c=i(e,t);if(Object(s.default)(c))return c;for(var h=r[t],p=o[t],m=0;m<h;++m){var _=n[p+m];_!==t&&f.push(_)}}}(e,t,i):function(e,t,i){for(var a=!0;a;){var r=i(e,t);if(Object(s.default)(r))return r;var n=e.parentIds[t];a=n!==t,t=n}}(e,t,i):i(e,t)}function X_(e,t){return e=Nf.a.replaceMain(e,"tile_main"),t?e+"uniform float tile_colorBlend; \nvoid tile_color(vec4 tile_featureColor) \n{ \n    tile_main(); \n    tile_featureColor = czm_gammaCorrect(tile_featureColor); \n    gl_FragColor.a *= tile_featureColor.a; \n    float highlight = ceil(tile_colorBlend); \n    gl_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight); \n} \n":e+"void tile_color(vec4 tile_featureColor) \n{ \n    tile_main(); \n} \n"}function Z_(e,t,i){if(!Object(s.default)(t))return X_(e,i);var a=new RegExp("(uniform|attribute|in)\\s+(vec[34]|sampler2D)\\s+"+t+";"),r=e.match(a);if(!Object(s.default)(r))return X_(e,i);var n=r[0],o=r[2];e=(e=Nf.a.replaceMain(e,"tile_main")).replace(n,"");var l;if("vec3"===o||"vec4"===o){var u="vec3"===o?"vec4("+t+", 1.0)":t,d="vec3"===o?"tile_diffuse.xyz":"tile_diffuse";a=new RegExp(t,"g"),e=e.replace(a,d),l="    vec4 source = "+u+"; \n    tile_diffuse = tile_diffuse_final(source, tile_featureColor); \n    tile_main(); \n"}else"sampler2D"===o&&(e=function(e,t){for(var i,a="texture2D("+t,r=0,n=e.indexOf(a,r);n>-1;){for(var o=0,s=n;s<e.length;++s){var l=e.charAt(s);if("("===l)++o;else if(")"===l&&0===--o){i=s+1;break}}var u="tile_diffuse_final("+e.slice(n,i)+", tile_diffuse)";e=e.slice(0,n)+u+e.slice(i),r=n+u.length,n=e.indexOf(a,r)}return e}(e,t),l="    tile_diffuse = tile_featureColor; \n    tile_main(); \n");return e="uniform float tile_colorBlend; \nvec4 tile_diffuse = vec4(1.0); \nbool isWhite(vec3 color) \n{ \n    return all(greaterThan(color, vec3(1.0 - czm_epsilon3))); \n} \nvec4 tile_diffuse_final(vec4 sourceDiffuse, vec4 tileDiffuse) \n{ \n    vec4 blendDiffuse = mix(sourceDiffuse, tileDiffuse, tile_colorBlend); \n    vec4 diffuse = isWhite(tileDiffuse.rgb) ? sourceDiffuse : blendDiffuse; \n    return vec4(diffuse.rgb, sourceDiffuse.a); \n} \n"+n+"\n"+e+"\nvoid tile_color(vec4 tile_featureColor) \n{ \n"+l,i&&(e+="    tile_featureColor = czm_gammaCorrect(tile_featureColor); \n    gl_FragColor.a *= tile_featureColor.a; \n    float highlight = ceil(tile_colorBlend); \n    gl_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight); \n"),e+="} \n"}N_.prototype.isClass=function(e,t){var i=this._batchTableHierarchy;if(!Object(s.default)(i))return!1;var a=K_(i,e,(function(e,i){var a=e.classIds[i];if(e.classes[a].name===t)return!0}));return Object(s.default)(a)},N_.prototype.isExactClass=function(e,t){return this.getExactClassName(e)===t},N_.prototype.getExactClassName=function(e){var t=this._batchTableHierarchy;if(Object(s.default)(t)){var i=t.classIds[e];return t.classes[i].name}},N_.prototype.hasProperty=function(e,t){return Object(s.default)(this._properties[t])||Object(s.default)(this._batchTableHierarchy)&&function(e,t,i){var a=K_(e._batchTableHierarchy,t,(function(e,t){var a=e.classIds[t],r=e.classes[a].instances;if(Object(s.default)(r[i]))return!0}));return Object(s.default)(a)}(this,e,t)},N_.prototype.getPropertyNames=function(e,t){(t=Object(s.default)(t)?t:[]).length=0;var i=Object.keys(this._properties);return t.push.apply(t,i),Object(s.default)(this._batchTableHierarchy)&&function(e,t,i){K_(e._batchTableHierarchy,t,(function(e,t){var a=e.classIds[t],r=e.classes[a].instances;for(var n in r)r.hasOwnProperty(n)&&-1===i.indexOf(n)&&i.push(n)}))}(this,e,t),t},N_.prototype.getProperty=function(e,t){if(Object(s.default)(this._batchTableBinaryProperties)){var i=this._batchTableBinaryProperties[t];if(Object(s.default)(i))return z_(i,e)}var a=this._properties[t];if(Object(s.default)(a))return Object(_f.default)(a[e],!0);if(Object(s.default)(this._batchTableHierarchy)){var r=function(e,t,i){return K_(e._batchTableHierarchy,t,(function(e,t){var a=e.classIds[t],r=e.classes[a],n=e.classIndexes[t],o=r.instances[i];if(Object(s.default)(o))return Object(s.default)(o.typedArray)?z_(o,n):Object(_f.default)(o[n],!0)}))}(this,e,t);if(Object(s.default)(r))return r}},N_.prototype.setProperty=function(e,t,i){var a=this.featuresLength;if(Object(s.default)(this._batchTableBinaryProperties)){var r=this._batchTableBinaryProperties[t];if(Object(s.default)(r))return void G_(r,e,i)}if(!Object(s.default)(this._batchTableHierarchy)||!function(e,t,i,a){var r=K_(e._batchTableHierarchy,t,(function(e,t){var r=e.classIds[t],n=e.classes[r],o=e.classIndexes[t],l=n.instances[i];if(Object(s.default)(l))return Object(s.default)(l.typedArray)?G_(l,o,a):l[o]=Object(_f.default)(a,!0),!0}));return Object(s.default)(r)}(this,e,t,i)){var n=this._properties[t];Object(s.default)(n)||(this._properties[t]=new Array(a),n=this._properties[t]),n[e]=Object(_f.default)(i,!0)}},N_.prototype.getVertexShaderCallback=function(e,t,i){if(0!==this.featuresLength){var a=this;return function(r){var n,o=Z_(r,i,!1);return T_.a.maximumVertexTextureImageUnits>0?(n="",e&&(n+="uniform bool tile_translucentCommand; \n"),n+="uniform sampler2D tile_batchTexture; \nvarying vec4 tile_featureColor; \nvarying vec2 tile_featureSt; \nvoid main() \n{ \n    vec2 st = computeSt("+t+"); \n    vec4 featureProperties = texture2D(tile_batchTexture, st); \n    tile_color(featureProperties); \n    float show = ceil(featureProperties.a); \n    gl_Position *= show; \n",e&&(n+="    bool isStyleTranslucent = (featureProperties.a != 1.0); \n    if (czm_pass == czm_passTranslucent) \n    { \n        if (!isStyleTranslucent && !tile_translucentCommand) \n        { \n            gl_Position *= 0.0; \n        } \n    } \n    else \n    { \n        if (isStyleTranslucent) \n        { \n            gl_Position *= 0.0; \n        } \n    } \n"),n+="    tile_featureColor = featureProperties; \n    tile_featureSt = st; \n}"):n="varying vec2 tile_featureSt; \nvoid main() \n{ \n    tile_color(vec4(1.0)); \n    tile_featureSt = computeSt("+t+"); \n}",o+"\n"+(1===a._textureDimensions.y?"uniform vec4 tile_textureStep; \nvec2 computeSt(float batchId) \n{ \n    float stepX = tile_textureStep.x; \n    float centerX = tile_textureStep.y; \n    return vec2(centerX + (batchId * stepX), 0.5); \n} \n":"uniform vec4 tile_textureStep; \nuniform vec2 tile_textureDimensions; \nvec2 computeSt(float batchId) \n{ \n    float stepX = tile_textureStep.x; \n    float centerX = tile_textureStep.y; \n    float stepY = tile_textureStep.z; \n    float centerY = tile_textureStep.w; \n    float xId = mod(batchId, tile_textureDimensions.x); \n    float yId = floor(batchId / tile_textureDimensions.x); \n    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); \n} \n")+n}}},N_.prototype.getFragmentShaderCallback=function(e,t){if(0!==this.featuresLength)return function(i){return i=Z_(i,t,!0),T_.a.maximumVertexTextureImageUnits>0?i+="uniform sampler2D tile_pickTexture; \nvarying vec2 tile_featureSt; \nvarying vec4 tile_featureColor; \nvoid main() \n{ \n    tile_color(tile_featureColor); \n}":(e&&(i+="uniform bool tile_translucentCommand; \n"),i+="uniform sampler2D tile_pickTexture; \nuniform sampler2D tile_batchTexture; \nvarying vec2 tile_featureSt; \nvoid main() \n{ \n    vec4 featureProperties = texture2D(tile_batchTexture, tile_featureSt); \n    if (featureProperties.a == 0.0) { \n        discard; \n    } \n",e&&(i+="    bool isStyleTranslucent = (featureProperties.a != 1.0); \n    if (czm_pass == czm_passTranslucent) \n    { \n        if (!isStyleTranslucent && !tile_translucentCommand) \n        { \n            discard; \n        } \n    } \n    else \n    { \n        if (isStyleTranslucent) \n        { \n            discard; \n        } \n    } \n"),i+="    tile_color(featureProperties); \n} \n"),i}},N_.prototype.getClassificationFragmentShaderCallback=function(){if(0!==this.featuresLength)return function(e){return e=Nf.a.replaceMain(e,"tile_main"),T_.a.maximumVertexTextureImageUnits>0?e+="uniform sampler2D tile_pickTexture;\nvarying vec2 tile_featureSt; \nvarying vec4 tile_featureColor; \nvoid main() \n{ \n    tile_main(); \n    gl_FragColor = tile_featureColor; \n}":e+="uniform sampler2D tile_batchTexture; \nuniform sampler2D tile_pickTexture;\nvarying vec2 tile_featureSt; \nvoid main() \n{ \n    tile_main(); \n    vec4 featureProperties = texture2D(tile_batchTexture, tile_featureSt); \n    if (featureProperties.a == 0.0) { \n        discard; \n    } \n    gl_FragColor = featureProperties; \n} \n",e}},N_.prototype.getUniformMapCallback=function(){if(0!==this.featuresLength){var e=this;return function(t){var i={tile_batchTexture:function(){return Object(o.default)(e._batchTexture,e._defaultTexture)},tile_textureDimensions:function(){return e._textureDimensions},tile_textureStep:function(){return e._textureStep},tile_colorBlend:function(){return t=e._content.tileset,i=t.colorBlendMode,a=t.colorBlendAmount,i===A_.HIGHLIGHT?0:i===A_.REPLACE?1:i===A_.MIX?Ne.default.clamp(a,Ne.default.EPSILON4,1):void 0;var t,i,a},tile_pickTexture:function(){return e._pickTexture}};return Object(gf.default)(t,i)}}},N_.prototype.getPickId=function(){return"texture2D(tile_pickTexture, tile_featureSt)"};var J_=0,Q_=1,$_=2;function eg(e){var t=If.a.shallowClone(e),i=t.pass===Lf.a.TRANSLUCENT;return t.uniformMap=Object(s.default)(t.uniformMap)?t.uniformMap:{},t.uniformMap.tile_translucentCommand=function(){return i},t}function tg(e){var t,i,a=If.a.shallowClone(e);return a.pass=Lf.a.TRANSLUCENT,a.renderState=(t=e.renderState,(i=Object(_f.default)(t,!0)).cull.enabled=!1,i.depthTest.enabled=!0,i.depthMask=!1,i.blending=Rc.a.ALPHA_BLEND,Df.a.fromCache(i)),a}function ig(e){var t,i,a=If.a.shallowClone(e);return a.renderState=(t=e.renderState,(i=Object(_f.default)(t,!0)).stencilTest=L_.a.setCesium3DTileBit(),i.stencilMask=L_.a.CESIUM_3D_TILE_MASK,Df.a.fromCache(i)),a}function ag(e,t){var i=If.a.shallowClone(t),a=Object(_f.default)(i.renderState,!0);a.cull.enabled=!0,a.cull.face=j_.a.FRONT,a.colorMask={red:!1,green:!1,blue:!1,alpha:!1},a.polygonOffset={enabled:!0,factor:5,units:5},a.stencilTest=L_.a.setCesium3DTileBit(),a.stencilMask=L_.a.CESIUM_3D_TILE_MASK,i.renderState=Df.a.fromCache(a),i.castShadows=!1,i.receiveShadows=!1,i.uniformMap=Object(_f.default)(t.uniformMap);var r=new g.default(5,5);return i.uniformMap.u_polygonOffset=function(){return r},i.shaderProgram=function(e,t){var i=e.shaderCache.getDerivedShaderProgram(t,"zBackfaceLogDepth");if(!Object(s.default)(i)){var a=t.fragmentShaderSource.clone();a.defines=Object(s.default)(a.defines)?a.defines.slice(0):[],a.defines.push("POLYGON_OFFSET"),a.sources.unshift("#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n"),i=e.shaderCache.createDerivedShaderProgram(t,"zBackfaceLogDepth",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:a,attributeLocations:t._attributeLocations})}return i}(e,t.shaderProgram),i}function rg(e,t){var i=If.a.shallowClone(e),a=Object(_f.default)(i.renderState,!0);return a.stencilTest.enabled=!0,a.stencilTest.mask=L_.a.SKIP_LOD_MASK,a.stencilTest.reference=L_.a.CESIUM_3D_TILE_MASK|t<<L_.a.SKIP_LOD_BIT_SHIFT,a.stencilTest.frontFunction=D_.a.GREATER_OR_EQUAL,a.stencilTest.frontOperation.zPass=M_.a.REPLACE,a.stencilTest.backFunction=D_.a.GREATER_OR_EQUAL,a.stencilTest.backOperation.zPass=M_.a.REPLACE,a.stencilMask=L_.a.CESIUM_3D_TILE_MASK|L_.a.SKIP_LOD_MASK,i.renderState=Df.a.fromCache(a),i}function ng(e,t,i){var a=e._textureDimensions;return new Vf.a({context:t,pixelFormat:Af.a.RGBA,pixelDatatype:C_.a.UNSIGNED_BYTE,source:{width:a.x,height:a.y,arrayBufferView:i},flipY:!1,sampler:Mf.a.NEAREST})}N_.prototype.addDerivedCommands=function(e,t){for(var i,a=e.commandList,r=a.length,n=this._content._tile,o=n._finalResolution,l=n.tileset,u=l._skipLevelOfDetail&&l._hasMixedContent&&e.context.stencilBuffer,d=function(e){var t=e._translucentFeaturesLength;if(0===t)return J_;if(t===e.featuresLength)return Q_;return $_}(this),f=t;f<r;++f){var c=a[f],h=c.derivedCommands.tileset;Object(s.default)(h)&&!c.dirty||(h={},c.derivedCommands.tileset=h,h.originalCommand=eg(c),c.dirty=!1);var p=h.originalCommand;d!==J_&&c.pass!==Lf.a.TRANSLUCENT&&(Object(s.default)(h.translucent)||(h.translucent=tg(p))),d!==Q_&&c.pass!==Lf.a.TRANSLUCENT&&(Object(s.default)(h.opaque)||(h.opaque=ig(p)),u&&(o||(Object(s.default)(h.zback)||(h.zback=ag(e.context,p)),l._backfaceCommands.push(h.zback)),Object(s.default)(h.stencil)&&n._selectionDepth===(i=h.stencil,void 0,(i.renderState.stencilTest.reference&L_.a.SKIP_LOD_MASK)>>>L_.a.SKIP_LOD_BIT_SHIFT)||(c.renderState.depthMask?h.stencil=rg(p,n._selectionDepth):h.stencil=h.opaque)));var m=u?h.stencil:h.opaque,_=h.translucent;c.pass!==Lf.a.TRANSLUCENT?(d===J_&&(a[f]=m),d===Q_&&(a[f]=_),d===$_&&(a[f]=m,a.push(_))):a[f]=p}},N_.prototype.update=function(e,t){var i=t.context;this._defaultTexture=i.defaultTexture;var a,r,n=t.passes;(n.pick||n.postProcess)&&function(e,t){var i=e.featuresLength;if(!Object(s.default)(e._pickTexture)&&i>0){for(var a=e._pickIds,r=B_(e),n=new Uint8Array(r),o=e._content,l=0;l<i;++l){var u=t.createPickId(o.getFeature(l));a.push(u);var d=u.color,f=4*l;n[f]=b.default.floatToByte(d.red),n[f+1]=b.default.floatToByte(d.green),n[f+2]=b.default.floatToByte(d.blue),n[f+3]=b.default.floatToByte(d.alpha)}e._pickTexture=ng(e,t,n),o.tileset._statistics.batchTableByteLength+=e._pickTexture.sizeInBytes}}(this,i),this._batchValuesDirty&&(this._batchValuesDirty=!1,Object(s.default)(this._batchTexture)||(this._batchTexture=ng(this,i,this._batchValues),e._statistics.batchTableByteLength+=this._batchTexture.sizeInBytes),r=(a=this)._textureDimensions,a._batchTexture.copyFrom({width:r.x,height:r.y,arrayBufferView:a._batchValues}))},N_.prototype.isDestroyed=function(){return!1},N_.prototype.destroy=function(){this._batchTexture=this._batchTexture&&this._batchTexture.destroy(),this._pickTexture=this._pickTexture&&this._pickTexture.destroy();for(var e=this._pickIds,t=e.length,i=0;i<t;++i)e[i].destroy();return Object(l.default)(this)};var og=N_,sg=i(544);function lg(e,t){this.json=e,this.buffer=t,this._cachedTypedArrays={},this.featuresLength=0}function ug(e,t,i,a,r,n){var o=e._cachedTypedArrays,l=o[t];return Object(s.default)(l)||(l=se.a.createArrayBufferView(i,e.buffer.buffer,e.buffer.byteOffset+n,r*a),o[t]=l),l}lg.prototype.getGlobalProperty=function(e,t,i){var a=this.json[e];if(Object(s.default)(a))return Object(s.default)(a.byteOffset)?ug(this,e,t=Object(o.default)(t,se.a.UNSIGNED_INT),i=Object(o.default)(i,1),1,a.byteOffset):a},lg.prototype.getPropertyArray=function(e,t,i){var a=this.json[e];if(Object(s.default)(a))return Object(s.default)(a.byteOffset)?(Object(s.default)(a.componentType)&&(t=se.a.fromName(a.componentType)),ug(this,e,t,i,this.featuresLength,a.byteOffset)):function(e,t,i,a){var r=e._cachedTypedArrays,n=r[t];return Object(s.default)(n)||(n=se.a.createTypedArray(i,a),r[t]=n),n}(this,e,t,a)},lg.prototype.getProperty=function(e,t,i,a,r){var n=this.json[e];if(Object(s.default)(n)){var o=this.getPropertyArray(e,t,i);if(1===i)return o[a];for(var l=0;l<i;++l)r[l]=o[i*a+l];return r}};var dg=lg;var fg=function(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds},cg=i(589),hg="attribute vec3 position;\nattribute float a_batchId;\n\nuniform mat4 u_modifiedModelViewProjection;\n\nvoid main()\n{\n    gl_Position = czm_depthClampFarPlane(u_modifiedModelViewProjection * vec4(position, 1.0));\n}\n",pg={};!function(e){var t=function(e,t){var i=new Error(e+" at character "+t);throw i.index=t,i.description=e,i},i={"-":!0,"!":!0,"~":!0,"+":!0},a={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},r=function(e){var t,i=0;for(var a in e)(t=a.length)>i&&e.hasOwnProperty(a)&&(i=t);return i},n=r(i),o=r(a),s={true:!0,false:!1,null:null},l=function(e){return a[e]||0},u=function(e,t,i){return{type:"||"===e||"&&"===e?"LogicalExpression":"BinaryExpression",operator:e,left:t,right:i}},d=function(e){return e>=48&&e<=57},f=function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=128&&!a[String.fromCharCode(e)]},c=function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e>=128&&!a[String.fromCharCode(e)]},h=function(e){for(var r,h,p=0,m=e.charAt,_=e.charCodeAt,g=function(t){return m.call(e,t)},v=function(t){return _.call(e,t)},b=e.length,y=function(){for(var e=v(p);32===e||9===e;)e=v(++p)},O=function(){var e,i,a=x();return y(),63!==v(p)?a:(p++,(e=O())||t("Expected expression",p),y(),58===v(p)?(p++,(i=O())||t("Expected expression",p),{type:"ConditionalExpression",test:a,consequent:e,alternate:i}):void t("Expected :",p))},w=function(){y();for(var t=e.substr(p,o),i=t.length;i>0;){if(a.hasOwnProperty(t))return p+=i,t;t=t.substr(0,--i)}return!1},x=function(){var e,i,a,r,n,o,s,d;if(o=E(),!(i=w()))return o;for(n={value:i,prec:l(i)},(s=E())||t("Expected expression after "+i,p),r=[o,n,s];(i=w())&&0!==(a=l(i));){for(n={value:i,prec:a};r.length>2&&a<=r[r.length-2].prec;)s=r.pop(),i=r.pop().value,o=r.pop(),e=u(i,o,s),r.push(e);(e=E())||t("Expected expression after "+i,p),r.push(n,e)}for(e=r[d=r.length-1];d>1;)e=u(r[d-1].value,r[d-2],e),d-=2;return e},E=function(){var t,a,r;if(y(),t=v(p),d(t)||46===t)return T();if(39===t||34===t)return C();if(f(t)||40===t)return P();if(91===t)return I();for(r=(a=e.substr(p,n)).length;r>0;){if(i.hasOwnProperty(a))return p+=r,{type:"UnaryExpression",operator:a,argument:E(),prefix:!0};a=a.substr(0,--r)}return!1},T=function(){for(var e,i,a="";d(v(p));)a+=g(p++);if(46===v(p))for(a+=g(p++);d(v(p));)a+=g(p++);if("e"===(e=g(p))||"E"===e){for(a+=g(p++),"+"!==(e=g(p))&&"-"!==e||(a+=g(p++));d(v(p));)a+=g(p++);d(v(p-1))||t("Expected exponent ("+a+g(p)+")",p)}return i=v(p),f(i)?t("Variable names cannot start with a number ("+a+g(p)+")",p):46===i&&t("Unexpected period",p),{type:"Literal",value:parseFloat(a),raw:a}},C=function(){for(var e,i="",a=g(p++),r=!1;p<b;){if((e=g(p++))===a){r=!0;break}if("\\"===e)switch(e=g(p++)){case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:i+="\\"+e}else i+=e}return r||t('Unclosed quote after "'+i+'"',p),{type:"Literal",value:i,raw:a+i+a}},A=function(){var i,a=v(p),r=p;for(f(a)?p++:t("Unexpected "+g(p),p);p<b&&(a=v(p),c(a));)p++;return i=e.slice(r,p),s.hasOwnProperty(i)?{type:"Literal",value:s[i],raw:i}:"this"===i?{type:"ThisExpression"}:{type:"Identifier",name:i}},j=function(e){for(var i,a,r=[],n=!1;p<b;){if(y(),(i=v(p))===e){n=!0,p++;break}44===i?p++:((a=O())&&"Compound"!==a.type||t("Expected comma",p),r.push(a))}return n||t("Expected "+String.fromCharCode(e),p),r},P=function(){var e,i;for(i=40===(e=v(p))?S():A(),y(),e=v(p);46===e||91===e||40===e;)p++,46===e?(y(),i={type:"MemberExpression",computed:!1,object:i,property:A()}):91===e?(i={type:"MemberExpression",computed:!0,object:i,property:O()},y(),93!==(e=v(p))&&t("Unclosed [",p),p++):40===e&&(i={type:"CallExpression",arguments:j(41),callee:i}),y(),e=v(p);return i},S=function(){p++;var e=O();if(y(),41===v(p))return p++,e;t("Unclosed (",p)},I=function(){return p++,{type:"ArrayExpression",elements:j(93)}},L=[];p<b;)59===(r=v(p))||44===r?p++:(h=O())?L.push(h):p<b&&t('Unexpected "'+g(p)+'"',p);return 1===L.length?L[0]:{type:"Compound",body:L}};h.version="0.3.1",h.toString=function(){return"JavaScript Expression Parser (JSEP) v"+h.version},h.addUnaryOp=function(e){return n=Math.max(e.length,n),i[e]=!0,this},h.addBinaryOp=function(e,t){return o=Math.max(e.length,o),a[e]=t,this},h.addLiteral=function(e,t){return s[e]=t,this},h.removeUnaryOp=function(e){return delete i[e],e.length===n&&(n=r(i)),this},h.removeAllUnaryOps=function(){return i={},n=0,this},h.removeBinaryOp=function(e){return delete a[e],e.length===o&&(o=r(a)),this},h.removeAllBinaryOps=function(){return a={},o=0,this},h.removeLiteral=function(e){return delete s[e],this},h.removeAllLiterals=function(){return s={},this},e.jsep=h}(pg);var mg=pg.jsep,_g=Object.freeze({VARIABLE:0,UNARY:1,BINARY:2,TERNARY:3,CONDITIONAL:4,MEMBER:5,FUNCTION_CALL:6,ARRAY:7,REGEX:8,VARIABLE_IN_STRING:9,LITERAL_NULL:10,LITERAL_BOOLEAN:11,LITERAL_NUMBER:12,LITERAL_STRING:13,LITERAL_COLOR:14,LITERAL_VECTOR:15,LITERAL_REGEX:16,LITERAL_UNDEFINED:17,BUILTIN_VARIABLE:18});function gg(e,t){var i;this._expression=e,e=function(e){var t=e,i="",a=t.indexOf("${");for(;a>=0;){var r,n=t.indexOf("'"),o=t.indexOf('"');if(n>=0&&n<a)r=t.indexOf("'",n+1),i+=t.substr(0,r+1),t=t.substr(r+1),a=t.indexOf("${");else if(o>=0&&o<a)r=t.indexOf('"',o+1),i+=t.substr(0,r+1),t=t.substr(r+1),a=t.indexOf("${");else{i+=t.substr(0,a);var s=t.indexOf("}");if(s<0)throw new $f.default("Unmatched {.");i+="czm_"+t.substr(a+2,s-(a+2)),t=t.substr(s+1),a=t.indexOf("${")}}return i+=t}(function(e){return e.replace(wg,"@#%")}(e=function(e,t){if(!Object(s.default)(t))return e;for(var i in t)if(t.hasOwnProperty(i)){var a=new RegExp("\\$\\{"+i+"\\}","g"),r="("+t[i]+")";Object(s.default)(r)&&(e=e.replace(a,r))}return e}(e,t))),mg.addBinaryOp("=~",0),mg.addBinaryOp("!~",0);try{i=mg(e)}catch(e){throw new $f.default(e)}this._runtimeAst=Ng(this,i)}Object.defineProperties(gg.prototype,{expression:{get:function(){return this._expression}}});var vg={arrayIndex:0,arrayArray:[[]],cartesian2Index:0,cartesian3Index:0,cartesian4Index:0,cartesian2Array:[new g.default],cartesian3Array:[new v.default],cartesian4Array:[new It.a],reset:function(){this.arrayIndex=0,this.cartesian2Index=0,this.cartesian3Index=0,this.cartesian4Index=0},getArray:function(){this.arrayIndex>=this.arrayArray.length&&this.arrayArray.push([]);var e=this.arrayArray[this.arrayIndex++];return e.length=0,e},getCartesian2:function(){return this.cartesian2Index>=this.cartesian2Array.length&&this.cartesian2Array.push(new g.default),this.cartesian2Array[this.cartesian2Index++]},getCartesian3:function(){return this.cartesian3Index>=this.cartesian3Array.length&&this.cartesian3Array.push(new v.default),this.cartesian3Array[this.cartesian3Index++]},getCartesian4:function(){return this.cartesian4Index>=this.cartesian4Array.length&&this.cartesian4Array.push(new It.a),this.cartesian4Array[this.cartesian4Index++]}};gg.prototype.evaluate=function(e,t){vg.reset();var i=this._runtimeAst.evaluate(e);return t instanceof b.default&&i instanceof It.a?b.default.fromCartesian4(i,t):i instanceof g.default||i instanceof v.default||i instanceof It.a?i.clone(t):i},gg.prototype.evaluateColor=function(e,t){vg.reset();var i=this._runtimeAst.evaluate(e);return b.default.fromCartesian4(i,t)},gg.prototype.getShaderFunction=function(e,t,i,a){var r=this.getShaderExpression(t,i);return r=a+" "+e+"() \n{ \n    return "+r+"; \n} \n"},gg.prototype.getShaderExpression=function(e,t){return this._runtimeAst.getShaderExpression(e,t)};var bg=["!","-","+"],yg=["+","-","*","/","%","===","!==",">",">=","<","<=","&&","||","!~","=~"],Og=/\${(.*?)}/g,wg=/\\/g,xg=/@#%/g,Eg=new b.default,Tg={abs:jg(Math.abs),sqrt:jg(Math.sqrt),cos:jg(Math.cos),sin:jg(Math.sin),tan:jg(Math.tan),acos:jg(Math.acos),asin:jg(Math.asin),atan:jg(Math.atan),radians:jg(Ne.default.toRadians),degrees:jg(Ne.default.toDegrees),sign:jg(Ne.default.sign),floor:jg(Math.floor),ceil:jg(Math.ceil),round:jg(Math.round),exp:jg(Math.exp),exp2:jg((function(e){return Math.pow(2,e)})),log:jg(Math.log),log2:jg((function(e){return Ne.default.log2(e)})),fract:jg((function(e){return e-Math.floor(e)})),length:function(e,t){if("number"==typeof t)return Math.abs(t);if(t instanceof g.default)return g.default.magnitude(t);if(t instanceof v.default)return v.default.magnitude(t);if(t instanceof It.a)return It.a.magnitude(t);throw new $f.default('Function "'+e+'" requires a vector or number argument. Argument is '+t+".")},normalize:function(e,t){if("number"==typeof t)return 1;if(t instanceof g.default)return g.default.normalize(t,vg.getCartesian2());if(t instanceof v.default)return v.default.normalize(t,vg.getCartesian3());if(t instanceof It.a)return It.a.normalize(t,vg.getCartesian4());throw new $f.default('Function "'+e+'" requires a vector or number argument. Argument is '+t+".")}},Cg={atan2:Pg(Math.atan2,!1),pow:Pg(Math.pow,!1),min:Pg(Math.min,!0),max:Pg(Math.max,!0),distance:function(e,t,i){if("number"==typeof t&&"number"==typeof i)return Math.abs(t-i);if(t instanceof g.default&&i instanceof g.default)return g.default.distance(t,i);if(t instanceof v.default&&i instanceof v.default)return v.default.distance(t,i);if(t instanceof It.a&&i instanceof It.a)return It.a.distance(t,i);throw new $f.default('Function "'+e+'" requires vector or number arguments of matching types. Arguments are '+t+" and "+i+".")},dot:function(e,t,i){if("number"==typeof t&&"number"==typeof i)return t*i;if(t instanceof g.default&&i instanceof g.default)return g.default.dot(t,i);if(t instanceof v.default&&i instanceof v.default)return v.default.dot(t,i);if(t instanceof It.a&&i instanceof It.a)return It.a.dot(t,i);throw new $f.default('Function "'+e+'" requires vector or number arguments of matching types. Arguments are '+t+" and "+i+".")},cross:function(e,t,i){if(t instanceof v.default&&i instanceof v.default)return v.default.cross(t,i,vg.getCartesian3());throw new $f.default('Function "'+e+'" requires vec3 arguments. Arguments are '+t+" and "+i+".")}},Ag={clamp:Sg(Ne.default.clamp,!0),mix:Sg(Ne.default.lerp,!0)};function jg(e){return function(t,i){if("number"==typeof i)return e(i);if(i instanceof g.default)return g.default.fromElements(e(i.x),e(i.y),vg.getCartesian2());if(i instanceof v.default)return v.default.fromElements(e(i.x),e(i.y),e(i.z),vg.getCartesian3());if(i instanceof It.a)return It.a.fromElements(e(i.x),e(i.y),e(i.z),e(i.w),vg.getCartesian4());throw new $f.default('Function "'+t+'" requires a vector or number argument. Argument is '+i+".")}}function Pg(e,t){return function(i,a,r){if(t&&"number"==typeof r){if("number"==typeof a)return e(a,r);if(a instanceof g.default)return g.default.fromElements(e(a.x,r),e(a.y,r),vg.getCartesian2());if(a instanceof v.default)return v.default.fromElements(e(a.x,r),e(a.y,r),e(a.z,r),vg.getCartesian3());if(a instanceof It.a)return It.a.fromElements(e(a.x,r),e(a.y,r),e(a.z,r),e(a.w,r),vg.getCartesian4())}if("number"==typeof a&&"number"==typeof r)return e(a,r);if(a instanceof g.default&&r instanceof g.default)return g.default.fromElements(e(a.x,r.x),e(a.y,r.y),vg.getCartesian2());if(a instanceof v.default&&r instanceof v.default)return v.default.fromElements(e(a.x,r.x),e(a.y,r.y),e(a.z,r.z),vg.getCartesian3());if(a instanceof It.a&&r instanceof It.a)return It.a.fromElements(e(a.x,r.x),e(a.y,r.y),e(a.z,r.z),e(a.w,r.w),vg.getCartesian4());throw new $f.default('Function "'+i+'" requires vector or number arguments of matching types. Arguments are '+a+" and "+r+".")}}function Sg(e,t){return function(i,a,r,n){if(t&&"number"==typeof n){if("number"==typeof a&&"number"==typeof r)return e(a,r,n);if(a instanceof g.default&&r instanceof g.default)return g.default.fromElements(e(a.x,r.x,n),e(a.y,r.y,n),vg.getCartesian2());if(a instanceof v.default&&r instanceof v.default)return v.default.fromElements(e(a.x,r.x,n),e(a.y,r.y,n),e(a.z,r.z,n),vg.getCartesian3());if(a instanceof It.a&&r instanceof It.a)return It.a.fromElements(e(a.x,r.x,n),e(a.y,r.y,n),e(a.z,r.z,n),e(a.w,r.w,n),vg.getCartesian4())}if("number"==typeof a&&"number"==typeof r&&"number"==typeof n)return e(a,r,n);if(a instanceof g.default&&r instanceof g.default&&n instanceof g.default)return g.default.fromElements(e(a.x,r.x,n.x),e(a.y,r.y,n.y),vg.getCartesian2());if(a instanceof v.default&&r instanceof v.default&&n instanceof v.default)return v.default.fromElements(e(a.x,r.x,n.x),e(a.y,r.y,n.y),e(a.z,r.z,n.z),vg.getCartesian3());if(a instanceof It.a&&r instanceof It.a&&n instanceof It.a)return It.a.fromElements(e(a.x,r.x,n.x),e(a.y,r.y,n.y),e(a.z,r.z,n.z),e(a.w,r.w,n.w),vg.getCartesian4());throw new $f.default('Function "'+i+'" requires vector or number arguments of matching types. Arguments are '+a+", "+r+", and "+n+".")}}function Ig(e,t,i,a,r){var n,o,l;this._type=e,this._value=t,this._left=i,this._right=a,this._test=r,this.evaluate=void 0,(n=this)._type===_g.CONDITIONAL?n.evaluate=n._evaluateConditional:n._type===_g.FUNCTION_CALL?"test"===n._value?n.evaluate=n._evaluateRegExpTest:"exec"===n._value?n.evaluate=n._evaluateRegExpExec:"toString"===n._value&&(n.evaluate=n._evaluateToString):n._type===_g.UNARY?"!"===n._value?n.evaluate=n._evaluateNot:"-"===n._value?n.evaluate=n._evaluateNegative:"+"===n._value?n.evaluate=n._evaluatePositive:"isNaN"===n._value?n.evaluate=n._evaluateNaN:"isFinite"===n._value?n.evaluate=n._evaluateIsFinite:"isExactClass"===n._value?n.evaluate=n._evaluateIsExactClass:"isClass"===n._value?n.evaluate=n._evaluateIsClass:"getExactClassName"===n._value?n.evaluate=n._evaluateGetExactClassName:"Boolean"===n._value?n.evaluate=n._evaluateBooleanConversion:"Number"===n._value?n.evaluate=n._evaluateNumberConversion:"String"===n._value?n.evaluate=n._evaluateStringConversion:Object(s.default)(Tg[n._value])&&(n.evaluate=(o=n._value,l=Tg[o],function(e){var t=this._left.evaluate(e);return l(o,t)})):n._type===_g.BINARY?"+"===n._value?n.evaluate=n._evaluatePlus:"-"===n._value?n.evaluate=n._evaluateMinus:"*"===n._value?n.evaluate=n._evaluateTimes:"/"===n._value?n.evaluate=n._evaluateDivide:"%"===n._value?n.evaluate=n._evaluateMod:"==="===n._value?n.evaluate=n._evaluateEqualsStrict:"!=="===n._value?n.evaluate=n._evaluateNotEqualsStrict:"<"===n._value?n.evaluate=n._evaluateLessThan:"<="===n._value?n.evaluate=n._evaluateLessThanOrEquals:">"===n._value?n.evaluate=n._evaluateGreaterThan:">="===n._value?n.evaluate=n._evaluateGreaterThanOrEquals:"&&"===n._value?n.evaluate=n._evaluateAnd:"||"===n._value?n.evaluate=n._evaluateOr:"=~"===n._value?n.evaluate=n._evaluateRegExpMatch:"!~"===n._value?n.evaluate=n._evaluateRegExpNotMatch:Object(s.default)(Cg[n._value])&&(n.evaluate=function(e){var t=Cg[e];return function(i){var a=this._left.evaluate(i),r=this._right.evaluate(i);return t(e,a,r)}}(n._value)):n._type===_g.TERNARY?n.evaluate=function(e){var t=Ag[e];return function(i){var a=this._left.evaluate(i),r=this._right.evaluate(i),n=this._test.evaluate(i);return t(e,a,r,n)}}(n._value):n._type===_g.MEMBER?"brackets"===n._value?n.evaluate=n._evaluateMemberBrackets:n.evaluate=n._evaluateMemberDot:n._type===_g.ARRAY?n.evaluate=n._evaluateArray:n._type===_g.VARIABLE?n.evaluate=n._evaluateVariable:n._type===_g.VARIABLE_IN_STRING?n.evaluate=n._evaluateVariableString:n._type===_g.LITERAL_COLOR?n.evaluate=n._evaluateLiteralColor:n._type===_g.LITERAL_VECTOR?n.evaluate=n._evaluateLiteralVector:n._type===_g.LITERAL_STRING?n.evaluate=n._evaluateLiteralString:n._type===_g.REGEX?n.evaluate=n._evaluateRegExp:n._type===_g.BUILTIN_VARIABLE?"tiles3d_tileset_time"===n._value&&(n.evaluate=Vg):n.evaluate=n._evaluateLiteral}function Lg(e){return e.replace(xg,"\\")}function Dg(e,t){var i,a,r,n,o=t.arguments,l=o.length;if("MemberExpression"===t.callee.type){i=t.callee.property.name;var u=t.callee.object;if("test"===i||"exec"===i){if("regExp"!==u.callee.name)throw new $f.default(i+" is not a function.");return 0===l?"test"===i?new Ig(_g.LITERAL_BOOLEAN,!1):new Ig(_g.LITERAL_NULL,null):(r=Ng(e,u),n=Ng(e,o[0]),new Ig(_g.FUNCTION_CALL,i,r,n))}if("toString"===i)return a=Ng(e,u),new Ig(_g.FUNCTION_CALL,i,a);throw new $f.default('Unexpected function call "'+i+'".')}if("color"===(i=t.callee.name)){if(0===l)return new Ig(_g.LITERAL_COLOR,i);if(a=Ng(e,o[0]),Object(s.default)(o[1])){var d=Ng(e,o[1]);return new Ig(_g.LITERAL_COLOR,i,[a,d])}return new Ig(_g.LITERAL_COLOR,i,[a])}if("rgb"===i||"hsl"===i){if(l<3)throw new $f.default(i+" requires three arguments.");return a=[Ng(e,o[0]),Ng(e,o[1]),Ng(e,o[2])],new Ig(_g.LITERAL_COLOR,i,a)}if("rgba"===i||"hsla"===i){if(l<4)throw new $f.default(i+" requires four arguments.");return a=[Ng(e,o[0]),Ng(e,o[1]),Ng(e,o[2]),Ng(e,o[3])],new Ig(_g.LITERAL_COLOR,i,a)}if("vec2"===i||"vec3"===i||"vec4"===i){a=new Array(l);for(var f=0;f<l;++f)a[f]=Ng(e,o[f]);return new Ig(_g.LITERAL_VECTOR,i,a)}if("isNaN"===i||"isFinite"===i)return 0===l?new Ig(_g.LITERAL_BOOLEAN,"isNaN"===i):(a=Ng(e,o[0]),new Ig(_g.UNARY,i,a));if("isExactClass"===i||"isClass"===i){if(l<1||l>1)throw new $f.default(i+" requires exactly one argument.");return a=Ng(e,o[0]),new Ig(_g.UNARY,i,a)}if("getExactClassName"===i){if(l>0)throw new $f.default(i+" does not take any argument.");return new Ig(_g.UNARY,i)}if(Object(s.default)(Tg[i])){if(1!==l)throw new $f.default(i+" requires exactly one argument.");return a=Ng(e,o[0]),new Ig(_g.UNARY,i,a)}if(Object(s.default)(Cg[i])){if(2!==l)throw new $f.default(i+" requires exactly two arguments.");return r=Ng(e,o[0]),n=Ng(e,o[1]),new Ig(_g.BINARY,i,r,n)}if(Object(s.default)(Ag[i])){if(3!==l)throw new $f.default(i+" requires exactly three arguments.");r=Ng(e,o[0]),n=Ng(e,o[1]);var c=Ng(e,o[2]);return new Ig(_g.TERNARY,i,r,n,c)}if("Boolean"===i)return 0===l?new Ig(_g.LITERAL_BOOLEAN,!1):(a=Ng(e,o[0]),new Ig(_g.UNARY,i,a));if("Number"===i)return 0===l?new Ig(_g.LITERAL_NUMBER,0):(a=Ng(e,o[0]),new Ig(_g.UNARY,i,a));if("String"===i)return 0===l?new Ig(_g.LITERAL_STRING,""):(a=Ng(e,o[0]),new Ig(_g.UNARY,i,a));if("regExp"===i)return function(e,t){var i=t.arguments;if(0===i.length)return new Ig(_g.LITERAL_REGEX,new RegExp);var a,r=Ng(e,i[0]);if(i.length>1){var n=Ng(e,i[1]);if(Rg(r)&&Rg(n)){try{a=new RegExp(Lg(String(r._value)),n._value)}catch(e){throw new $f.default(e)}return new Ig(_g.LITERAL_REGEX,a)}return new Ig(_g.REGEX,r,n)}if(Rg(r)){try{a=new RegExp(Lg(String(r._value)))}catch(e){throw new $f.default(e)}return new Ig(_g.LITERAL_REGEX,a)}return new Ig(_g.REGEX,r)}(e,t);throw new $f.default('Unexpected function call "'+i+'".')}function Mg(e,t){if("Math"===t.object.name)return function(e){var t=e.property.name;return"PI"===t?new Ig(_g.LITERAL_NUMBER,Math.PI):"E"===t?new Ig(_g.LITERAL_NUMBER,Math.E):void 0}(t);if("Number"===t.object.name)return function(e){if("POSITIVE_INFINITY"===e.property.name)return new Ig(_g.LITERAL_NUMBER,Number.POSITIVE_INFINITY)}(t);var i,a=Ng(e,t.object);return t.computed?(i=Ng(e,t.property),new Ig(_g.MEMBER,"brackets",a,i)):(i=new Ig(_g.LITERAL_STRING,t.property.name),new Ig(_g.MEMBER,"dot",a,i))}function Rg(e){return e._type>=_g.LITERAL_NULL}function Ng(e,t){var i,a,r,n;if("Literal"===t.type)i=function(e){var t=typeof e.value;return null===e.value?new Ig(_g.LITERAL_NULL,null):"boolean"===t?new Ig(_g.LITERAL_BOOLEAN,e.value):"number"===t?new Ig(_g.LITERAL_NUMBER,e.value):"string"===t?e.value.indexOf("${")>=0?new Ig(_g.VARIABLE_IN_STRING,e.value):new Ig(_g.LITERAL_STRING,Lg(e.value)):void 0}(t);else if("CallExpression"===t.type)i=Dg(e,t);else if("Identifier"===t.type)i=function(e){if(function(e){return"czm_"===e.substr(0,4)}(e.name)){var t=e.name.substr(4);return"tiles3d_"===t.substr(0,8)?new Ig(_g.BUILTIN_VARIABLE,t):new Ig(_g.VARIABLE,t)}if("NaN"===e.name)return new Ig(_g.LITERAL_NUMBER,NaN);if("Infinity"===e.name)return new Ig(_g.LITERAL_NUMBER,1/0);if("undefined"===e.name)return new Ig(_g.LITERAL_UNDEFINED,void 0);throw new $f.default(e.name+" is not defined.")}(t);else if("UnaryExpression"===t.type){a=t.operator;var o=Ng(e,t.argument);if(!(bg.indexOf(a)>-1))throw new $f.default('Unexpected operator "'+a+'".');i=new Ig(_g.UNARY,a,o)}else if("BinaryExpression"===t.type){if(a=t.operator,r=Ng(e,t.left),n=Ng(e,t.right),!(yg.indexOf(a)>-1))throw new $f.default('Unexpected operator "'+a+'".');i=new Ig(_g.BINARY,a,r,n)}else if("LogicalExpression"===t.type)a=t.operator,r=Ng(e,t.left),n=Ng(e,t.right),yg.indexOf(a)>-1&&(i=new Ig(_g.BINARY,a,r,n));else if("ConditionalExpression"===t.type){var s=Ng(e,t.test);r=Ng(e,t.consequent),n=Ng(e,t.alternate),i=new Ig(_g.CONDITIONAL,"?",r,n,s)}else if("MemberExpression"===t.type)i=Mg(e,t);else{if("ArrayExpression"!==t.type)throw"Compound"===t.type?new $f.default("Provide exactly one expression."):new $f.default("Cannot parse expression.");for(var l=[],u=0;u<t.elements.length;u++)l[u]=Ng(e,t.elements[u]);i=new Ig(_g.ARRAY,l)}return i}function Vg(e){return Object(s.default)(e)?e.content.tileset.timeSinceLoad:0}function Bg(e,t){if(Object(s.default)(e))return e.getProperty(t)}function Ug(e){return"feature"===e._value}function Fg(e){for(var t=e._left,i=t.length,a=0;a<i;++a)if(t[a]._type!==_g.LITERAL_NUMBER)return;var r=t[0]._value,n=t[1]._value,o=t[2]._value,s=4===i?t[3]._value:1;return b.default.fromHsl(r,n,o,s,Eg)}function Hg(e){for(var t=e._left,i=t.length,a=0;a<i;++a)if(t[a]._type!==_g.LITERAL_NUMBER)return;var r=Eg;return r.red=t[0]._value/255,r.green=t[1]._value/255,r.blue=t[2]._value/255,r.alpha=4===i?t[3]._value:1,r}function kg(e){return e%1==0?e.toFixed(1):e.toString()}function zg(e){return"vec4("+kg(e.red)+", "+kg(e.green)+", "+kg(e.blue)+", "+kg(e.alpha)+")"}function Gg(e,t,i,a){for(var r=e.length,n=new Array(r),o=0;o<r;++o)n[o]=e[o].getShaderExpression(t,i,a);return n}Ig.prototype._evaluateLiteral=function(){return this._value},Ig.prototype._evaluateLiteralColor=function(e){var t=Eg,i=this._left;if("color"===this._value)Object(s.default)(i)?i.length>1?(b.default.fromCssColorString(i[0].evaluate(e),t),t.alpha=i[1].evaluate(e)):b.default.fromCssColorString(i[0].evaluate(e),t):b.default.fromBytes(255,255,255,255,t);else if("rgb"===this._value)b.default.fromBytes(i[0].evaluate(e),i[1].evaluate(e),i[2].evaluate(e),255,t);else if("rgba"===this._value){var a=255*i[3].evaluate(e);b.default.fromBytes(i[0].evaluate(e),i[1].evaluate(e),i[2].evaluate(e),a,t)}else"hsl"===this._value?b.default.fromHsl(i[0].evaluate(e),i[1].evaluate(e),i[2].evaluate(e),1,t):"hsla"===this._value&&b.default.fromHsl(i[0].evaluate(e),i[1].evaluate(e),i[2].evaluate(e),i[3].evaluate(e),t);return It.a.fromColor(t,vg.getCartesian4())},Ig.prototype._evaluateLiteralVector=function(e){for(var t=vg.getArray(),i=this._value,a=this._left,r=a.length,n=0;n<r;++n){var o=a[n].evaluate(e);if("number"==typeof o)t.push(o);else if(o instanceof g.default)t.push(o.x,o.y);else if(o instanceof v.default)t.push(o.x,o.y,o.z);else{if(!(o instanceof It.a))throw new $f.default(i+" argument must be a vector or number. Argument is "+o+".");t.push(o.x,o.y,o.z,o.w)}}var s=t.length,l=parseInt(i.charAt(3));if(0===s)throw new $f.default("Invalid "+i+" constructor. No valid arguments.");if(s<l&&s>1)throw new $f.default("Invalid "+i+" constructor. Not enough arguments.");if(s>l&&r>1)throw new $f.default("Invalid "+i+" constructor. Too many arguments.");if(1===s){var u=t[0];t.push(u,u,u)}return"vec2"===i?g.default.fromArray(t,0,vg.getCartesian2()):"vec3"===i?v.default.fromArray(t,0,vg.getCartesian3()):"vec4"===i?It.a.fromArray(t,0,vg.getCartesian4()):void 0},Ig.prototype._evaluateLiteralString=function(){return this._value},Ig.prototype._evaluateVariableString=function(e){for(var t=this._value,i=Og.exec(t);null!==i;){var a=i[0],r=Bg(e,i[1]);Object(s.default)(r)||(r=""),t=t.replace(a,r),i=Og.exec(t)}return t},Ig.prototype._evaluateVariable=function(e){return Bg(e,this._value)},Ig.prototype._evaluateMemberDot=function(e){if(Ug(this._left))return Bg(e,this._right.evaluate(e));var t=this._left.evaluate(e);if(Object(s.default)(t)){var i=this._right.evaluate(e);if(t instanceof g.default||t instanceof v.default||t instanceof It.a){if("r"===i)return t.x;if("g"===i)return t.y;if("b"===i)return t.z;if("a"===i)return t.w}return t[i]}},Ig.prototype._evaluateMemberBrackets=function(e){if(Ug(this._left))return Bg(e,this._right.evaluate(e));var t=this._left.evaluate(e);if(Object(s.default)(t)){var i=this._right.evaluate(e);if(t instanceof g.default||t instanceof v.default||t instanceof It.a){if(0===i||"r"===i)return t.x;if(1===i||"g"===i)return t.y;if(2===i||"b"===i)return t.z;if(3===i||"a"===i)return t.w}return t[i]}},Ig.prototype._evaluateArray=function(e){for(var t=[],i=0;i<this._value.length;i++)t[i]=this._value[i].evaluate(e);return t},Ig.prototype._evaluateNot=function(e){var t=this._left.evaluate(e);if("boolean"!=typeof t)throw new $f.default('Operator "!" requires a boolean argument. Argument is '+t+".");return!t},Ig.prototype._evaluateNegative=function(e){var t=this._left.evaluate(e);if(t instanceof g.default)return g.default.negate(t,vg.getCartesian2());if(t instanceof v.default)return v.default.negate(t,vg.getCartesian3());if(t instanceof It.a)return It.a.negate(t,vg.getCartesian4());if("number"==typeof t)return-t;throw new $f.default('Operator "-" requires a vector or number argument. Argument is '+t+".")},Ig.prototype._evaluatePositive=function(e){var t=this._left.evaluate(e);if(!(t instanceof g.default||t instanceof v.default||t instanceof It.a||"number"==typeof t))throw new $f.default('Operator "+" requires a vector or number argument. Argument is '+t+".");return t},Ig.prototype._evaluateLessThan=function(e){var t=this._left.evaluate(e),i=this._right.evaluate(e);if("number"!=typeof t||"number"!=typeof i)throw new $f.default('Operator "<" requires number arguments. Arguments are '+t+" and "+i+".");return t<i},Ig.prototype._evaluateLessThanOrEquals=function(e){var t=this._left.evaluate(e),i=this._right.evaluate(e);if("number"!=typeof t||"number"!=typeof i)throw new $f.default('Operator "<=" requires number arguments. Arguments are '+t+" and "+i+".");return t<=i},Ig.prototype._evaluateGreaterThan=function(e){var t=this._left.evaluate(e),i=this._right.evaluate(e);if("number"!=typeof t||"number"!=typeof i)throw new $f.default('Operator ">" requires number arguments. Arguments are '+t+" and "+i+".");return t>i},Ig.prototype._evaluateGreaterThanOrEquals=function(e){var t=this._left.evaluate(e),i=this._right.evaluate(e);if("number"!=typeof t||"number"!=typeof i)throw new $f.default('Operator ">=" requires number arguments. Arguments are '+t+" and "+i+".");return t>=i},Ig.prototype._evaluateOr=function(e){var t=this._left.evaluate(e);if("boolean"!=typeof t)throw new $f.default('Operator "||" requires boolean arguments. First argument is '+t+".");if(t)return!0;var i=this._right.evaluate(e);if("boolean"!=typeof i)throw new $f.default('Operator "||" requires boolean arguments. Second argument is '+i+".");return t||i},Ig.prototype._evaluateAnd=function(e){var t=this._left.evaluate(e);if("boolean"!=typeof t)throw new $f.default('Operator "&&" requires boolean arguments. First argument is '+t+".");if(!t)return!1;var i=this._right.evaluate(e);if("boolean"!=typeof i)throw new $f.default('Operator "&&" requires boolean arguments. Second argument is '+i+".");return t&&i},Ig.prototype._evaluatePlus=function(e){var t=this._left.evaluate(e),i=this._right.evaluate(e);if(i instanceof g.default&&t instanceof g.default)return g.default.add(t,i,vg.getCartesian2());if(i instanceof v.default&&t instanceof v.default)return v.default.add(t,i,vg.getCartesian3());if(i instanceof It.a&&t instanceof It.a)return It.a.add(t,i,vg.getCartesian4());if("string"==typeof t||"string"==typeof i)return t+i;if("number"==typeof t&&"number"==typeof i)return t+i;throw new $f.default('Operator "+" requires vector or number arguments of matching types, or at least one string argument. Arguments are '+t+" and "+i+".")},Ig.prototype._evaluateMinus=function(e){var t=this._left.evaluate(e),i=this._right.evaluate(e);if(i instanceof g.default&&t instanceof g.default)return g.default.subtract(t,i,vg.getCartesian2());if(i instanceof v.default&&t instanceof v.default)return v.default.subtract(t,i,vg.getCartesian3());if(i instanceof It.a&&t instanceof It.a)return It.a.subtract(t,i,vg.getCartesian4());if("number"==typeof t&&"number"==typeof i)return t-i;throw new $f.default('Operator "-" requires vector or number arguments of matching types. Arguments are '+t+" and "+i+".")},Ig.prototype._evaluateTimes=function(e){var t=this._left.evaluate(e),i=this._right.evaluate(e);if(i instanceof g.default&&t instanceof g.default)return g.default.multiplyComponents(t,i,vg.getCartesian2());if(i instanceof g.default&&"number"==typeof t)return g.default.multiplyByScalar(i,t,vg.getCartesian2());if(t instanceof g.default&&"number"==typeof i)return g.default.multiplyByScalar(t,i,vg.getCartesian2());if(i instanceof v.default&&t instanceof v.default)return v.default.multiplyComponents(t,i,vg.getCartesian3());if(i instanceof v.default&&"number"==typeof t)return v.default.multiplyByScalar(i,t,vg.getCartesian3());if(t instanceof v.default&&"number"==typeof i)return v.default.multiplyByScalar(t,i,vg.getCartesian3());if(i instanceof It.a&&t instanceof It.a)return It.a.multiplyComponents(t,i,vg.getCartesian4());if(i instanceof It.a&&"number"==typeof t)return It.a.multiplyByScalar(i,t,vg.getCartesian4());if(t instanceof It.a&&"number"==typeof i)return It.a.multiplyByScalar(t,i,vg.getCartesian4());if("number"==typeof t&&"number"==typeof i)return t*i;throw new $f.default('Operator "*" requires vector or number arguments. If both arguments are vectors they must be matching types. Arguments are '+t+" and "+i+".")},Ig.prototype._evaluateDivide=function(e){var t=this._left.evaluate(e),i=this._right.evaluate(e);if(i instanceof g.default&&t instanceof g.default)return g.default.divideComponents(t,i,vg.getCartesian2());if(t instanceof g.default&&"number"==typeof i)return g.default.divideByScalar(t,i,vg.getCartesian2());if(i instanceof v.default&&t instanceof v.default)return v.default.divideComponents(t,i,vg.getCartesian3());if(t instanceof v.default&&"number"==typeof i)return v.default.divideByScalar(t,i,vg.getCartesian3());if(i instanceof It.a&&t instanceof It.a)return It.a.divideComponents(t,i,vg.getCartesian4());if(t instanceof It.a&&"number"==typeof i)return It.a.divideByScalar(t,i,vg.getCartesian4());if("number"==typeof t&&"number"==typeof i)return t/i;throw new $f.default('Operator "/" requires vector or number arguments of matching types, or a number as the second argument. Arguments are '+t+" and "+i+".")},Ig.prototype._evaluateMod=function(e){var t=this._left.evaluate(e),i=this._right.evaluate(e);if(i instanceof g.default&&t instanceof g.default)return g.default.fromElements(t.x%i.x,t.y%i.y,vg.getCartesian2());if(i instanceof v.default&&t instanceof v.default)return v.default.fromElements(t.x%i.x,t.y%i.y,t.z%i.z,vg.getCartesian3());if(i instanceof It.a&&t instanceof It.a)return It.a.fromElements(t.x%i.x,t.y%i.y,t.z%i.z,t.w%i.w,vg.getCartesian4());if("number"==typeof t&&"number"==typeof i)return t%i;throw new $f.default('Operator "%" requires vector or number arguments of matching types. Arguments are '+t+" and "+i+".")},Ig.prototype._evaluateEqualsStrict=function(e){var t=this._left.evaluate(e),i=this._right.evaluate(e);return i instanceof g.default&&t instanceof g.default||i instanceof v.default&&t instanceof v.default||i instanceof It.a&&t instanceof It.a?t.equals(i):t===i},Ig.prototype._evaluateNotEqualsStrict=function(e){var t=this._left.evaluate(e),i=this._right.evaluate(e);return i instanceof g.default&&t instanceof g.default||i instanceof v.default&&t instanceof v.default||i instanceof It.a&&t instanceof It.a?!t.equals(i):t!==i},Ig.prototype._evaluateConditional=function(e){var t=this._test.evaluate(e);if("boolean"!=typeof t)throw new $f.default("Conditional argument of conditional expression must be a boolean. Argument is "+t+".");return t?this._left.evaluate(e):this._right.evaluate(e)},Ig.prototype._evaluateNaN=function(e){return isNaN(this._left.evaluate(e))},Ig.prototype._evaluateIsFinite=function(e){return isFinite(this._left.evaluate(e))},Ig.prototype._evaluateIsExactClass=function(e){return!!Object(s.default)(e)&&e.isExactClass(this._left.evaluate(e))},Ig.prototype._evaluateIsClass=function(e){return!!Object(s.default)(e)&&e.isClass(this._left.evaluate(e))},Ig.prototype._evaluateGetExactClassName=function(e){if(Object(s.default)(e))return e.getExactClassName()},Ig.prototype._evaluateBooleanConversion=function(e){return Boolean(this._left.evaluate(e))},Ig.prototype._evaluateNumberConversion=function(e){return Number(this._left.evaluate(e))},Ig.prototype._evaluateStringConversion=function(e){return String(this._left.evaluate(e))},Ig.prototype._evaluateRegExp=function(e){var t,i=this._value.evaluate(e),a="";Object(s.default)(this._left)&&(a=this._left.evaluate(e));try{t=new RegExp(i,a)}catch(e){throw new $f.default(e)}return t},Ig.prototype._evaluateRegExpTest=function(e){var t=this._left.evaluate(e),i=this._right.evaluate(e);if(!(t instanceof RegExp&&"string"==typeof i))throw new $f.default("RegExp.test requires the first argument to be a RegExp and the second argument to be a string. Arguments are "+t+" and "+i+".");return t.test(i)},Ig.prototype._evaluateRegExpMatch=function(e){var t=this._left.evaluate(e),i=this._right.evaluate(e);if(t instanceof RegExp&&"string"==typeof i)return t.test(i);if(i instanceof RegExp&&"string"==typeof t)return i.test(t);throw new $f.default('Operator "=~" requires one RegExp argument and one string argument. Arguments are '+t+" and "+i+".")},Ig.prototype._evaluateRegExpNotMatch=function(e){var t=this._left.evaluate(e),i=this._right.evaluate(e);if(t instanceof RegExp&&"string"==typeof i)return!t.test(i);if(i instanceof RegExp&&"string"==typeof t)return!i.test(t);throw new $f.default('Operator "!~" requires one RegExp argument and one string argument. Arguments are '+t+" and "+i+".")},Ig.prototype._evaluateRegExpExec=function(e){var t=this._left.evaluate(e),i=this._right.evaluate(e);if(!(t instanceof RegExp&&"string"==typeof i))throw new $f.default("RegExp.exec requires the first argument to be a RegExp and the second argument to be a string. Arguments are "+t+" and "+i+".");var a=t.exec(i);return Object(s.default)(a)?a[1]:null},Ig.prototype._evaluateToString=function(e){var t=this._left.evaluate(e);if(t instanceof RegExp||t instanceof g.default||t instanceof v.default||t instanceof It.a)return String(t);throw new $f.default('Unexpected function call "'+this._value+'".')};Ig.prototype.getShaderExpression=function(e,t,i){var a,r,n,o,l=this._type,u=this._value;switch(Object(s.default)(this._left)&&(r=Array.isArray(this._left)?Gg(this._left,e,t,this):this._left.getShaderExpression(e,t,this)),Object(s.default)(this._right)&&(n=this._right.getShaderExpression(e,t,this)),Object(s.default)(this._test)&&(o=this._test.getShaderExpression(e,t,this)),Array.isArray(this._value)&&(u=Gg(this._value,e,t,this)),l){case _g.VARIABLE:return e+u;case _g.UNARY:if("Boolean"===u)return"bool("+r+")";if("Number"===u)return"float("+r+")";if("round"===u)return"floor("+r+" + 0.5)";if(Object(s.default)(Tg[u]))return u+"("+r+")";if("isNaN"===u)return"("+r+" != "+r+")";if("isFinite"===u)return"(abs("+r+") < czm_infinity)";if("String"===u||"isExactClass"===u||"isClass"===u||"getExactClassName"===u)throw new $f.default('Error generating style shader: "'+u+'" is not supported.');return Object(s.default)(Tg[u])?u+"("+r+")":u+r;case _g.BINARY:return"%"===u?"mod("+r+", "+n+")":"==="===u?"("+r+" == "+n+")":"!=="===u?"("+r+" != "+n+")":"atan2"===u?"atan("+r+", "+n+")":Object(s.default)(Cg[u])?u+"("+r+", "+n+")":"("+r+" "+u+" "+n+")";case _g.TERNARY:if(Object(s.default)(Ag[u]))return u+"("+r+", "+n+", "+o+")";break;case _g.CONDITIONAL:return"("+o+" ? "+r+" : "+n+")";case _g.MEMBER:return"r"===n||"x"===n||"0.0"===n?r+"[0]":"g"===n||"y"===n||"1.0"===n?r+"[1]":"b"===n||"z"===n||"2.0"===n?r+"[2]":"a"===n||"w"===n||"3.0"===n?r+"[3]":r+"[int("+n+")]";case _g.FUNCTION_CALL:throw new $f.default('Error generating style shader: "'+u+'" is not supported.');case _g.ARRAY:if(4===u.length)return"vec4("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+")";if(3===u.length)return"vec3("+u[0]+", "+u[1]+", "+u[2]+")";if(2===u.length)return"vec2("+u[0]+", "+u[1]+")";throw new $f.default("Error generating style shader: Invalid array length. Array length should be 2, 3, or 4.");case _g.REGEX:throw new $f.default("Error generating style shader: Regular expressions are not supported.");case _g.VARIABLE_IN_STRING:throw new $f.default("Error generating style shader: Converting a variable to a string is not supported.");case _g.LITERAL_NULL:return"czm_infinity";case _g.LITERAL_BOOLEAN:return u?"true":"false";case _g.LITERAL_NUMBER:return kg(u);case _g.LITERAL_STRING:if(Object(s.default)(i)&&i._type===_g.MEMBER&&("r"===u||"g"===u||"b"===u||"a"===u||"x"===u||"y"===u||"z"===u||"w"===u))return u;if(a=b.default.fromCssColorString(u,Eg),Object(s.default)(a))return function(e){return"vec3("+kg(e.red)+", "+kg(e.green)+", "+kg(e.blue)+")"}(a);throw new $f.default("Error generating style shader: String literals are not supported.");case _g.LITERAL_COLOR:var d=r;if("color"===u){if(!Object(s.default)(d))return"vec4(1.0)";if(d.length>1){var f=d[0],c=d[1];return"1.0"!==c&&(t.translucent=!0),"vec4("+f+", "+c+")"}return"vec4("+d[0]+", 1.0)"}if("rgb"===u)return a=Hg(this),Object(s.default)(a)?zg(a):"vec4("+d[0]+" / 255.0, "+d[1]+" / 255.0, "+d[2]+" / 255.0, 1.0)";if("rgba"===u)return"1.0"!==d[3]&&(t.translucent=!0),a=Hg(this),Object(s.default)(a)?zg(a):"vec4("+d[0]+" / 255.0, "+d[1]+" / 255.0, "+d[2]+" / 255.0, "+d[3]+")";if("hsl"===u)return a=Fg(this),Object(s.default)(a)?zg(a):"vec4(czm_HSLToRGB(vec3("+d[0]+", "+d[1]+", "+d[2]+")), 1.0)";if("hsla"===u)return a=Fg(this),Object(s.default)(a)?(1!==a.alpha&&(t.translucent=!0),zg(a)):("1.0"!==d[3]&&(t.translucent=!0),"vec4(czm_HSLToRGB(vec3("+d[0]+", "+d[1]+", "+d[2]+")), "+d[3]+")");break;case _g.LITERAL_VECTOR:for(var h=r.length,p=u+"(",m=0;m<h;++m)p+=r[m],m<h-1&&(p+=", ");return p+=")";case _g.LITERAL_REGEX:throw new $f.default("Error generating style shader: Regular expressions are not supported.");case _g.LITERAL_UNDEFINED:return"czm_infinity";case _g.BUILTIN_VARIABLE:if("tiles3d_tileset_time"===u)return"u_time"}};var qg=gg;function Wg(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT),this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._positions=e.positions,this._vertexBatchIds=e.vertexBatchIds,this._indices=e.indices,this._indexCounts=e.indexCounts,this._indexOffsets=e.indexOffsets,this._batchedIndices=e.batchedIndices,this._boundingVolume=e.boundingVolume,this._boundingVolumes=e.boundingVolumes,this._center=Object(o.default)(e.center,v.default.ZERO),this._va=void 0,this._sp=void 0,this._spStencil=void 0,this._spPick=void 0,this._uniformMap=void 0,this._vaSwap=void 0,this._rsStencilPreloadPass=void 0,this._rsStencilPreloadPass3DTiles=void 0,this._rsStencilDepthPass=void 0,this._rsStencilDepthPass3DTiles=void 0,this._rsColorPass=void 0,this._rsPickPass=void 0,this._rsWireframe=void 0,this._commands=[],this._commandsIgnoreShow=[],this._pickCommands=[],this._constantColor=b.default.clone(b.default.WHITE),this._highlightColor=this._constantColor,this._batchDirty=!0,this._pickCommandsDirty=!0,this._framesSinceLastRebatch=0,this._updatingAllCommands=!1,this._trianglesLength=this._indices.length/3,this._geometryByteLength=this._indices.byteLength+this._positions.byteLength+this._vertexBatchIds.byteLength,this.debugWireframe=!1,this._debugWireframe=this.debugWireframe,this._wireframeDirty=!1,this.forceRebatch=!1,this.classificationType=Object(o.default)(e.classificationType,Z.a.BOTH),this._vertexShaderSource=e._vertexShaderSource,this._fragmentShaderSource=e._fragmentShaderSource,this._attributeLocations=e._attributeLocations,this._uniformMap=e._uniformMap,this._pickId=e._pickId,this._modelMatrix=e._modelMatrix,this._boundingSphere=e._boundingSphere,this._batchIdLookUp={};for(var t=this._batchIds.length,i=0;i<t;++i){var a=this._batchIds[i];this._batchIdLookUp[a]=i}}Object.defineProperties(Wg.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}}});var Yg={position:0,a_batchId:1};function Kg(e){var t=e?D_.a.EQUAL:D_.a.ALWAYS;return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:!0,frontFunction:t,frontOperation:{fail:M_.a.KEEP,zFail:M_.a.DECREMENT_WRAP,zPass:M_.a.DECREMENT_WRAP},backFunction:t,backOperation:{fail:M_.a.KEEP,zFail:M_.a.INCREMENT_WRAP,zPass:M_.a.INCREMENT_WRAP},reference:L_.a.CESIUM_3D_TILE_MASK,mask:L_.a.CESIUM_3D_TILE_MASK},stencilMask:L_.a.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1}}function Xg(e){var t=e?D_.a.EQUAL:D_.a.ALWAYS;return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:!0,frontFunction:t,frontOperation:{fail:M_.a.KEEP,zFail:M_.a.KEEP,zPass:M_.a.INCREMENT_WRAP},backFunction:t,backOperation:{fail:M_.a.KEEP,zFail:M_.a.KEEP,zPass:M_.a.DECREMENT_WRAP},reference:L_.a.CESIUM_3D_TILE_MASK,mask:L_.a.CESIUM_3D_TILE_MASK},stencilMask:L_.a.CLASSIFICATION_MASK,depthTest:{enabled:!0,func:Vc.a.LESS_OR_EQUAL},depthMask:!1}}var Zg={stencilTest:{enabled:!0,frontFunction:D_.a.NOT_EQUAL,frontOperation:{fail:M_.a.KEEP,zFail:M_.a.KEEP,zPass:M_.a.DECREMENT_WRAP},backFunction:D_.a.NOT_EQUAL,backOperation:{fail:M_.a.KEEP,zFail:M_.a.KEEP,zPass:M_.a.DECREMENT_WRAP},reference:0,mask:L_.a.CLASSIFICATION_MASK},stencilMask:L_.a.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1,blending:Rc.a.ALPHA_BLEND},Jg={stencilTest:{enabled:!0,frontFunction:D_.a.NOT_EQUAL,frontOperation:{fail:M_.a.KEEP,zFail:M_.a.KEEP,zPass:M_.a.DECREMENT_WRAP},backFunction:D_.a.NOT_EQUAL,backOperation:{fail:M_.a.KEEP,zFail:M_.a.KEEP,zPass:M_.a.DECREMENT_WRAP},reference:0,mask:L_.a.CLASSIFICATION_MASK},stencilMask:L_.a.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1};var Qg=new nt.default,$g=new v.default;function ev(e,t,i,a,r,n,o){for(var s=e.constructor.BYTES_PER_ELEMENT,l=n.length,u=0;u<l;++u){var d=o[n[u]],f=a[d],c=r[d],h=new e.constructor(e.buffer,s*f,c);t.set(h,i),a[d]=i,i+=c}return i}function tv(e,t,i,a,r,n,o){for(var s=e.bytesPerIndex,l=n.length,u=0;u<l;++u){var d=o[n[u]],f=a[d],c=r[d];t.copyFromBuffer(e,f*s,i*s,c*s),a[d]=i,i+=c}return i}function iv(e,t){return t.color.toRgba()-e.color.toRgba()}function av(e,t){if(!e._batchDirty)return!1;for(var i=e._batchedIndices,a=i.length,r=!1,n={},o=0;o<a;++o){var l=i[o].color.toRgba();if(Object(s.default)(n[l])){r=!0;break}n[l]=!0}return r?r&&!e.forceRebatch&&e._framesSinceLastRebatch<120?void++e._framesSinceLastRebatch:(i.sort(iv),t.webgl2?function(e,t){var i=e._indexOffsets,a=e._indexCounts,r=e._batchIdLookUp,n=t.pop(),o=[n],s=e._va.indexBuffer,l=e._vaSwap.indexBuffer,u=tv(s,l,0,i,a,n.batchIds,r);for(n.offset=0,n.count=u;t.length>0;){var d=t.pop();if(b.default.equals(d.color,n.color))u=tv(s,l,u,i,a,d.batchIds,r),n.batchIds=n.batchIds.concat(d.batchIds),n.count=u-n.offset;else{var f=u;u=tv(s,l,u,i,a,d.batchIds,r),d.offset=f,d.count=u-f,o.push(d),n=d}}var c=e._va;e._va=e._vaSwap,e._vaSwap=c,e._batchedIndices=o}(e,i):function(e,t){var i=e._indices,a=e._indexOffsets,r=e._indexCounts,n=e._batchIdLookUp,o=new i.constructor(i.length),s=t.pop(),l=[s],u=ev(i,o,0,a,r,s.batchIds,n);for(s.offset=0,s.count=u;t.length>0;){var d=t.pop();if(b.default.equals(d.color,s.color))u=ev(i,o,u,a,r,d.batchIds,n),s.batchIds=s.batchIds.concat(d.batchIds),s.count=u-s.offset;else{var f=u;u=ev(i,o,u,a,r,d.batchIds,n),d.offset=f,d.count=u-f,l.push(d),s=d}}e._va.indexBuffer.copyFromArrayView(o),e._indices=o,e._batchedIndices=l}(e,i),e._framesSinceLastRebatch=0,e._batchDirty=!1,e._pickCommandsDirty=!0,e._wireframeDirty=!0,!0):(e._batchDirty=!1,!1)}Wg.prototype.createFeatures=function(e,t){for(var i=this._batchIds,a=i.length,r=0;r<a;++r){var n=i[r];t[n]=new sg.a(e,n)}},Wg.prototype.applyDebugSettings=function(e,t){this._highlightColor=e?t:this._constantColor};var rv=new b.default,nv=b.default.WHITE,ov=/\$/;function sv(e,t,i,a){var r,n,o=e.classificationType,l=o!==Z.a.CESIUM_3D_TILE,u=o!==Z.a.TERRAIN,d=t.commandList,f=i.length;for(n=0;n<f;++n)l&&((r=i[n]).pass=Lf.a.TERRAIN_CLASSIFICATION,d.push(r)),u&&((r=i[n].derivedCommands.tileset).pass=Lf.a.CESIUM_3D_TILE_CLASSIFICATION,d.push(r));if(t.invertClassification&&Object(s.default)(a))for(f=a.length,n=0;n<f;++n)d.push(a[n])}Wg.prototype.applyStyle=function(e,t){if(Object(s.default)(e)){var i=e.color,a=i instanceof qg&&!ov.test(i.expression);this._updatingAllCommands=a;var r,n=this._batchIds,o=n.length;for(r=0;r<o;++r){var l=t[n[r]];l.color=Object(s.default)(e.color)?e.color.evaluateColor(l,rv):nv,l.show=!Object(s.default)(e.show)||e.show.evaluate(l)}if(a){var u=this._batchedIndices;for(o=u.length,r=0;r<o;++r)u[r].color=b.default.clone(b.default.WHITE);this._updatingAllCommands=!1,this._batchDirty=!0}}else!function(e,t){e._updatingAllCommands=!0;var i,a=e._batchIds,r=a.length;for(i=0;i<r;++i){var n=t[a[i]];n.show=!0,n.color=b.default.WHITE}var o=e._batchedIndices;for(r=o.length,i=0;i<r;++i)o[i].color=b.default.clone(b.default.WHITE);e._updatingAllCommands=!1,e._batchDirty=!0}(this,t)},Wg.prototype.updateCommands=function(e,t){if(!this._updatingAllCommands){var i=this._batchIdLookUp,a=i[e];if(Object(s.default)(a)){var r,n=this._indexOffsets,o=this._indexCounts,l=n[a],u=o[a],d=this._batchedIndices,f=d.length;for(r=0;r<f;++r){var c=d[r].offset,h=d[r].count;if(l>=c&&l<c+h)break}d.push(new fg({color:b.default.clone(t),offset:l,count:u,batchIds:[e]}));for(var p=[],m=[],_=d[r].batchIds,g=_.length,v=0;v<g;++v){var y=_[v];if(y!==e)n[i[y]]<l?p.push(y):m.push(y)}0!==m.length&&d.push(new fg({color:b.default.clone(d[r].color),offset:l+u,count:d[r].offset+d[r].count-(l+u),batchIds:m})),0!==p.length?(d[r].count=l-d[r].offset,d[r].batchIds=p):d.splice(r,1),this._batchDirty=!0}}},Wg.prototype.update=function(e){var t,i=e.context;!function(e,t){if(!Object(s.default)(e._va)){var i=Pf.a.createVertexBuffer({context:t,typedArray:e._positions,usage:Sf.a.STATIC_DRAW}),a=Pf.a.createVertexBuffer({context:t,typedArray:e._vertexBatchIds,usage:Sf.a.STATIC_DRAW}),r=Pf.a.createIndexBuffer({context:t,typedArray:e._indices,usage:Sf.a.DYNAMIC_DRAW,indexDatatype:2===e._indices.BYTES_PER_ELEMENT?Gi.a.UNSIGNED_SHORT:Gi.a.UNSIGNED_INT}),n=[{index:0,vertexBuffer:i,componentDatatype:se.a.fromTypedArray(e._positions),componentsPerAttribute:3},{index:1,vertexBuffer:a,componentDatatype:se.a.fromTypedArray(e._vertexBatchIds),componentsPerAttribute:1}];e._va=new Ff.a({context:t,attributes:n,indexBuffer:r}),t.webgl2&&(e._vaSwap=new Ff.a({context:t,attributes:n,indexBuffer:Pf.a.createIndexBuffer({context:t,sizeInBytes:r.sizeInBytes,usage:Sf.a.DYNAMIC_DRAW,indexDatatype:r.indexDatatype})})),e._batchedPositions=void 0,e._transferrableBatchIds=void 0,e._vertexBatchIds=void 0,e._verticesPromise=void 0}}(this,i),function(e,t){if(!Object(s.default)(e._sp)){var i=e._batchTable,a=Object(o.default)(e._attributeLocations,Yg),r=e._pickId,n=e._vertexShaderSource,l=e._fragmentShaderSource;if(Object(s.default)(n))return e._sp=Rf.a.fromCache({context:t,vertexShaderSource:n,fragmentShaderSource:l,attributeLocations:a}),e._spStencil=e._sp,l=(l=Nf.a.replaceMain(l,"czm_non_pick_main"))+"void main() \n{ \n    czm_non_pick_main(); \n    gl_FragColor = "+r+"; \n} \n",void(e._spPick=Rf.a.fromCache({context:t,vertexShaderSource:n,fragmentShaderSource:l,attributeLocations:a}));var u=i.getVertexShaderCallback(!1,"a_batchId",void 0)(hg),d=i.getFragmentShaderCallback()(cg.a,!1,void 0);r=i.getPickId();var f=new Nf.a({sources:[u]}),c=new Nf.a({defines:["VECTOR_TILE"],sources:[d]});e._sp=Rf.a.fromCache({context:t,vertexShaderSource:f,fragmentShaderSource:c,attributeLocations:a}),f=new Nf.a({sources:[hg]}),c=new Nf.a({defines:["VECTOR_TILE"],sources:[cg.a]}),e._spStencil=Rf.a.fromCache({context:t,vertexShaderSource:f,fragmentShaderSource:c,attributeLocations:a}),d=(d=Nf.a.replaceMain(d,"czm_non_pick_main"))+"\nvoid main() \n{ \n    czm_non_pick_main(); \n    gl_FragColor = "+r+"; \n} \n";var h=new Nf.a({sources:[u]}),p=new Nf.a({defines:["VECTOR_TILE"],sources:[d]});e._spPick=Rf.a.fromCache({context:t,vertexShaderSource:h,fragmentShaderSource:p,attributeLocations:a})}}(this,i),t=this,Object(s.default)(t._rsStencilPreloadPass)||(t._rsStencilPreloadPass=Df.a.fromCache(Kg(!1)),t._rsStencilPreloadPass3DTiles=Df.a.fromCache(Kg(!0)),t._rsStencilDepthPass=Df.a.fromCache(Xg(!1)),t._rsStencilDepthPass3DTiles=Df.a.fromCache(Xg(!0)),t._rsColorPass=Df.a.fromCache(Zg),t._rsPickPass=Df.a.fromCache(Jg)),function(e,t){if(!Object(s.default)(e._uniformMap)){var i={u_modifiedModelViewProjection:function(){var i=t.uniformState.view,a=t.uniformState.projection;return nt.default.clone(i,Qg),nt.default.multiplyByPoint(Qg,e._center,$g),nt.default.setTranslation(Qg,$g,Qg),nt.default.multiply(a,Qg,Qg),Qg},u_highlightColor:function(){return e._highlightColor}};e._uniformMap=e._batchTable.getUniformMapCallback()(i)}}(this,i);var a=e.passes;a.render&&(function(e,t){var i=av(e,t),a=e._commands,r=e._batchedIndices,n=r.length,l=3*n;if(!Object(s.default)(a)||i||a.length!==l){a.length=l;for(var u=e._va,d=e._sp,f=Object(o.default)(e._modelMatrix,nt.default.IDENTITY),c=e._uniformMap,h=e._boundingVolume,p=0;p<n;++p){var m=r[p].offset,_=r[p].count,g=a[3*p];Object(s.default)(g)||(g=a[3*p]=new If.a({owner:e})),g.vertexArray=u,g.modelMatrix=f,g.offset=m,g.count=_,g.renderState=e._rsStencilPreloadPass,g.shaderProgram=d,g.uniformMap=c,g.boundingVolume=h,g.cull=!1,g.pass=Lf.a.TERRAIN_CLASSIFICATION;var v=If.a.shallowClone(g,g.derivedCommands.tileset);v.renderState=e._rsStencilPreloadPass3DTiles,v.pass=Lf.a.CESIUM_3D_TILE_CLASSIFICATION,g.derivedCommands.tileset=v;var b=a[3*p+1];Object(s.default)(b)||(b=a[3*p+1]=new If.a({owner:e})),b.vertexArray=u,b.modelMatrix=f,b.offset=m,b.count=_,b.renderState=e._rsStencilDepthPass,b.shaderProgram=d,b.uniformMap=c,b.boundingVolume=h,b.cull=!1,b.pass=Lf.a.TERRAIN_CLASSIFICATION;var y=If.a.shallowClone(b,b.derivedCommands.tileset);y.renderState=e._rsStencilDepthPass3DTiles,y.pass=Lf.a.CESIUM_3D_TILE_CLASSIFICATION,b.derivedCommands.tileset=y;var O=a[3*p+2];Object(s.default)(O)||(O=a[3*p+2]=new If.a({owner:e})),O.vertexArray=u,O.modelMatrix=f,O.offset=m,O.count=_,O.renderState=e._rsColorPass,O.shaderProgram=d,O.uniformMap=c,O.boundingVolume=h,O.cull=!1,O.pass=Lf.a.TERRAIN_CLASSIFICATION;var w=If.a.shallowClone(O,O.derivedCommands.tileset);w.pass=Lf.a.CESIUM_3D_TILE_CLASSIFICATION,O.derivedCommands.tileset=w}e._commandsDirty=!0}}(this,i),function(e,t){if(e.classificationType!==Z.a.TERRAIN&&t.invertClassification&&(!Object(s.default)(e._commandsIgnoreShow)||e._commandsDirty)){for(var i=e._commands,a=e._commandsIgnoreShow,r=e._spStencil,n=i.length,o=a.length=n/3*2,l=0,u=0;u<o;u+=2){var d=a[u]=If.a.shallowClone(i[l],a[u]);d.shaderProgram=r,d.pass=Lf.a.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,(d=a[u+1]=If.a.shallowClone(i[l+1],a[u+1])).shaderProgram=r,d.pass=Lf.a.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,l+=3}e._commandsDirty=!1}}(this,e),function(e){var t=e.debugWireframe===e._debugWireframe;if(!(t=t&&!(e.debugWireframe&&e._wireframeDirty))){var i,a;Object(s.default)(e._rsWireframe)||(e._rsWireframe=Df.a.fromCache({})),e.debugWireframe?(i=e._rsWireframe,a=Wi.a.LINES):(i=e._rsColorPass,a=Wi.a.TRIANGLES);for(var r=e._commands,n=r.length,o=0;o<n;o+=3){var l=r[o+2];l.renderState=i,l.primitiveType=a}e._debugWireframe=e.debugWireframe,e._wireframeDirty=!1}}(this),this._debugWireframe?function(e,t){for(var i=e.commandList,a=t.length,r=0;r<a;r+=3){var n=t[r+2];n.pass=Lf.a.OPAQUE,i.push(n)}}(e,this._commands):sv(this,e,this._commands,this._commandsIgnoreShow)),a.pick&&(!function(e){if(e._pickCommandsDirty){var t=e._indexOffsets.length,i=e._pickCommands;i.length=3*t;for(var a=e._va,r=e._spStencil,n=e._spPick,l=Object(o.default)(e._modelMatrix,nt.default.IDENTITY),u=e._uniformMap,d=0;d<t;++d){var f=e._indexOffsets[d],c=e._indexCounts[d],h=Object(s.default)(e._boundingVolumes)?e._boundingVolumes[d]:e.boundingVolume,p=i[3*d];Object(s.default)(p)||(p=i[3*d]=new If.a({owner:e,pickOnly:!0})),p.vertexArray=a,p.modelMatrix=l,p.offset=f,p.count=c,p.renderState=e._rsStencilPreloadPass,p.shaderProgram=r,p.uniformMap=u,p.boundingVolume=h,p.pass=Lf.a.TERRAIN_CLASSIFICATION;var m=If.a.shallowClone(p,p.derivedCommands.tileset);m.renderState=e._rsStencilPreloadPass3DTiles,m.pass=Lf.a.CESIUM_3D_TILE_CLASSIFICATION,p.derivedCommands.tileset=m;var _=i[3*d+1];Object(s.default)(_)||(_=i[3*d+1]=new If.a({owner:e,pickOnly:!0})),_.vertexArray=a,_.modelMatrix=l,_.offset=f,_.count=c,_.renderState=e._rsStencilDepthPass,_.shaderProgram=r,_.uniformMap=u,_.boundingVolume=h,_.pass=Lf.a.TERRAIN_CLASSIFICATION;var g=If.a.shallowClone(_,_.derivedCommands.tileset);g.renderState=e._rsStencilDepthPass3DTiles,g.pass=Lf.a.CESIUM_3D_TILE_CLASSIFICATION,_.derivedCommands.tileset=g;var v=i[3*d+2];Object(s.default)(v)||(v=i[3*d+2]=new If.a({owner:e,pickOnly:!0})),v.vertexArray=a,v.modelMatrix=l,v.offset=f,v.count=c,v.renderState=e._rsPickPass,v.shaderProgram=n,v.uniformMap=u,v.boundingVolume=h,v.pass=Lf.a.TERRAIN_CLASSIFICATION;var b=If.a.shallowClone(v,v.derivedCommands.tileset);b.pass=Lf.a.CESIUM_3D_TILE_CLASSIFICATION,v.derivedCommands.tileset=b}e._pickCommandsDirty=!1}}(this),sv(this,e,this._pickCommands))},Wg.prototype.isDestroyed=function(){return!1},Wg.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spPick=this._spPick&&this._spPick.destroy(),this._vaSwap=this._vaSwap&&this._vaSwap.destroy(),Object(l.default)(this)};var lv=Wg,uv=new v.default,dv=ep.ModelState;function fv(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).gltf;if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),!(t instanceof Uint8Array))throw new $f.default("Only binary glTF is supported as a classifier.");t=tc(t),Mc(t),Kf(t),rp(t),fp(t),Gf.buffer(t,(function(e){if(!Object(s.default)(e.extras._pipeline.source))throw new $f.default("Buffer data must be embedded in the binary gltf.")}));var i=t.nodes,a=t.meshes,n=i[0].mesh;if(1!==i.length||!Object(s.default)(n))throw new $f.default("Only one node is supported for classification and it must have a mesh.");if(1!==a.length)throw new $f.default("Only one mesh is supported when using b3dm for classification.");var l=a[0].primitives;if(1!==l.length)throw new $f.default("Only one primitive per mesh is supported when using b3dm for classification.");var u=l[0].attributes.POSITION;if(!Object(s.default)(u))throw new $f.default("The mesh must have a position attribute.");var d=l[0].attributes._BATCHID;if(!Object(s.default)(d))throw new $f.default("The mesh must have a batch id attribute.");this._gltf=t,this.show=Object(o.default)(e.show,!0),this.modelMatrix=nt.default.clone(Object(o.default)(e.modelMatrix,nt.default.IDENTITY)),this._modelMatrix=nt.default.clone(this.modelMatrix),this._ready=!1,this._readyPromise=Ef.default.defer(),this.debugShowBoundingVolume=Object(o.default)(e.debugShowBoundingVolume,!1),this._debugShowBoundingVolume=!1,this.debugWireframe=Object(o.default)(e.debugWireframe,!1),this._debugWireframe=!1,this._classificationType=e.classificationType,this._vertexShaderLoaded=e.vertexShaderLoaded,this._classificationShaderLoaded=e.classificationShaderLoaded,this._uniformMapLoaded=e.uniformMapLoaded,this._pickIdLoaded=e.pickIdLoaded,this._ignoreCommands=Object(o.default)(e.ignoreCommands,!1),this._upAxis=Object(o.default)(e.upAxis,hf.Y),this._batchTable=e.batchTable,this._computedModelMatrix=new nt.default,this._initialRadius=void 0,this._boundingSphere=void 0,this._scaledBoundingSphere=new r.default,this._state=dv.NEEDS_LOAD,this._loadResources=void 0,this._mode=void 0,this._dirty=!1,this._nodeMatrix=new nt.default,this._primitive=void 0,this._extensionsUsed=void 0,this._extensionsRequired=void 0,this._quantizedUniforms=void 0,this._buffers={},this._vertexArray=void 0,this._shaderProgram=void 0,this._uniformMap=void 0,this._geometryByteLength=0,this._trianglesLength=0,this._rtcCenter=void 0,this._rtcCenterEye=void 0,this._rtcCenter3D=void 0,this._rtcCenter2D=void 0}function cv(e,t){var i=t._loadResources,a=t.gltf.bufferViews[e],r=i.getBuffer(a);t._buffers[e]=r,t._geometryByteLength+=r.byteLength}function hv(e,t,i){var a=i._loadResources,r=i.gltf.bufferViews[e],n={typedArray:a.getBuffer(r),indexDatatype:t};i._buffers[e]=n,i._geometryByteLength+=n.typedArray.byteLength}function pv(e,t){return Object(s.default)(t)&&(e=t(e)),e}function mv(e){var t=e.gltf,i=ep.getAttributeOrUniformBySemantic(t,"POSITION"),a=ep.getAttributeOrUniformBySemantic(t,"_BATCHID"),r={};r[i]=0,r[a]=1;var n,o,l=ep.getAttributeOrUniformBySemantic(t,"MODELVIEWPROJECTION");if(Object(s.default)(l))n="uniform mat4 "+l+";\n",o=l+" * vec4("+i+", 1.0)";else{var u=ep.getAttributeOrUniformBySemantic(t,"PROJECTION"),d=ep.getAttributeOrUniformBySemantic(t,"MODELVIEW");Object(s.default)(d)||(d=ep.getAttributeOrUniformBySemantic(t,"CESIUM_RTC_MODELVIEW")),n="uniform mat4 "+d+";\nuniform mat4 "+u+";\n",o=u+" * "+d+" * vec4("+i+", 1.0)"}var f="attribute vec3 "+i+";\nattribute float "+a+";\n"+n+"void main() {\n"+("    vec4 positionInClipCoords = "+o+";\n")+"    gl_Position = czm_depthClampFarPlane(positionInClipCoords);\n}\n";e.extensionsUsed.WEB3D_quantized_attributes&&(f=function(e,t){var i=t.gltf.meshes[0].primitives[0],a=ep.modifyShaderForQuantizedAttributes(t.gltf,i,e);return t._quantizedUniforms=a.uniforms,a.shader}(f,e));var c=pv(f,e._vertexShaderLoaded),h=pv("#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\nvoid main() \n{ \n    gl_FragColor = vec4(1.0); \n    czm_writeDepthClampedToFarPlane();\n}\n",e._classificationShaderLoaded);c=ep.modifyVertexShaderForLogDepth(c,o),h=ep.modifyFragmentShaderForLogDepth(h),e._shaderProgram={vertexShaderSource:c,fragmentShaderSource:h,attributeLocations:r}}Object.defineProperties(fv.prototype,{gltf:{get:function(){return this._gltf}},boundingSphere:{get:function(){var e=this.modelMatrix,t=nt.default.getScale(e,uv),i=this._scaledBoundingSphere;return i.center=v.default.multiplyComponents(this._boundingSphere.center,t,i.center),i.radius=v.default.maximumComponent(t)*this._initialRadius,Object(s.default)(this._rtcCenter)&&v.default.add(this._rtcCenter,i.center,i.center),i}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},dirty:{get:function(){return this._dirty}},extensionsUsed:{get:function(){return Object(s.default)(this._extensionsUsed)||(this._extensionsUsed=ep.getUsedExtensions(this.gltf)),this._extensionsUsed}},extensionsRequired:{get:function(){return Object(s.default)(this._extensionsRequired)||(this._extensionsRequired=ep.getRequiredExtensions(this.gltf)),this._extensionsRequired}},upAxis:{get:function(){return this._upAxis}},trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},texturesByteLength:{get:function(){return 0}},classificationType:{get:function(){return this._classificationType}}});var _v={PROJECTION:function(e,t){return ep.getGltfSemanticUniforms().PROJECTION(e,t)},MODELVIEW:function(e,t){return ep.getGltfSemanticUniforms().MODELVIEW(e,t)},CESIUM_RTC_MODELVIEW:function(e,t){return ep.getGltfSemanticUniforms().CESIUM_RTC_MODELVIEW(e,t)},MODELVIEWPROJECTION:function(e,t){return ep.getGltfSemanticUniforms().MODELVIEWPROJECTION(e,t)}};function gv(e){var t,i,a=e._batchTable,n=e._uniformMap,o=e._vertexArray,l=e.gltf,u=l.accessors,d=l.meshes[0].primitives[0],f=u[d.indices],c=d.attributes.POSITION,h=ep.getAccessorMinMax(l,c),p=r.default.fromCornerPoints(v.default.fromArray(h.min),v.default.fromArray(h.max));Object(s.default)(f)?(i=f.count,t=f.byteOffset/Gi.a.getSizeInBytes(f.componentType)):(i=u[d.attributes.POSITION].count,t=0);if(e._trianglesLength+=function(e,t){switch(e.mode){case Wi.a.TRIANGLES:return t/3;case Wi.a.TRIANGLE_STRIP:case Wi.a.TRIANGLE_FAN:return Math.max(t-2,0);default:return 0}}(d,i),Object(s.default)(e._uniformMapLoaded)&&(n=e._uniformMapLoaded(n)),e.extensionsUsed.WEB3D_quantized_attributes){var m=function(e,t){return ep.createUniformsForQuantizedAttributes(e.gltf,t,e._quantizedUniforms)}(e,d);n=Object(gf.default)(n,m)}var _=o.attributes.POSITION,g=_.componentDatatype,y=_.vertexBuffer,O=y.byteOffset,w=y.byteLength/se.a.getSizeInBytes(g),x=se.a.createArrayBufferView(g,y.buffer,O,w);g=(_=o.attributes._BATCHID).componentDatatype,O=(y=_.vertexBuffer).byteOffset,w=y.byteLength/se.a.getSizeInBytes(g);var E,T=se.a.createArrayBufferView(g,y.buffer,O,w),C=o.indexBuffer.typedArray;E=o.indexBuffer.indexDatatype===Gi.a.UNSIGNED_SHORT?new Uint16Array(C.buffer,C.byteOffset,C.byteLength/Uint16Array.BYTES_PER_ELEMENT):new Uint32Array(C.buffer,C.byteOffset,C.byteLength/Uint32Array.BYTES_PER_ELEMENT),x=Object(Bc.a)(x);var A,j,P,S=[],I=[],L=[],D=[],M=(T=Object(Bc.a)(T))[(E=Object(Bc.a)(E,t,t+i))[0]];S.push(M),L.push(0);for(var R=E.length,N=1;N<R;++N)(A=T[E[N]])!==M&&(P=N-(j=L[L.length-1]),S.push(A),I.push(P),L.push(N),D.push(new fg({offset:j,count:P,batchIds:[M],color:b.default.WHITE})),M=A);P=R-(j=L[L.length-1]),I.push(P),D.push(new fg({offset:j,count:P,batchIds:[M],color:b.default.WHITE}));var V=e._shaderProgram,B=V.vertexShaderSource,U=V.fragmentShaderSource,F=V.attributeLocations,H=Object(s.default)(e._pickIdLoaded)?e._pickIdLoaded():void 0;e._primitive=new lv({classificationType:e._classificationType,positions:x,indices:E,indexOffsets:L,indexCounts:I,batchIds:S,vertexBatchIds:T,batchedIndices:D,batchTable:a,boundingVolume:new r.default,_vertexShaderSource:B,_fragmentShaderSource:U,_attributeLocations:F,_uniformMap:n,_pickId:H,_modelMatrix:new nt.default,_boundingSphere:p}),e._buffers=void 0,e._vertexArray=void 0,e._shaderProgram=void 0,e._uniformMap=void 0}function vv(e,t){var i=t.context;ep.checkSupportedGlExtensions(e.gltf.glExtensionsUsed,i),function(e){var t=e._loadResources;if(0===t.pendingBufferLoads){for(var i=t.vertexBuffersToCreate,a=t.indexBuffersToCreate;i.length>0;)cv(i.dequeue(),e);for(;a.length>0;){var r=a.dequeue();hv(r.id,r.componentType,e)}}}(e),mv(e),function(e){if(e._loadResources.finishedBuffersCreation()&&!Object(s.default)(e._vertexArray)){var t,i=e._buffers,a=e.gltf,r=a.accessors,n=a.meshes[0].primitives[0],o={POSITION:0,_BATCHID:1},l={};if(Gf.meshPrimitiveAttribute(n,(function(e,t){var n=o[t];if(Object(s.default)(n)){var u=r[e];l[t]={index:n,vertexBuffer:i[u.bufferView],componentsPerAttribute:qf(u.type),componentDatatype:u.componentType,offsetInBytes:u.byteOffset,strideInBytes:Wf(a,u)}}})),Object(s.default)(n.indices)){var u=r[n.indices];t=i[u.bufferView]}e._vertexArray={attributes:l,indexBuffer:t}}}(e),function(e,t){if(!Object(s.default)(e._uniformMap)){var i={};Gf.technique(e.gltf,(function(a){Gf.techniqueUniform(a,(function(a,r){Object(s.default)(a.semantic)&&Object(s.default)(_v[a.semantic])&&(i[r]=_v[a.semantic](t.uniformState,e))}))})),e._uniformMap=i}}(e,i),function(e){if(e._loadResources.finished()&&!Object(s.default)(e._primitive)){var t=e.gltf.nodes[0];e._nodeMatrix=ep.getTransform(t,e._nodeMatrix),gv(e)}}(e)}var bv=new It.a,yv=new nt.default;fv.prototype.updateCommands=function(e,t){this._primitive.updateCommands(e,t)},fv.prototype.update=function(e){if(e.mode!==Ve.a.MORPHING)if(bf.default.supportsWebP.initialized){var t=bf.default.supportsWebP();if(this._state===dv.NEEDS_LOAD&&Object(s.default)(this.gltf)&&(this._state=dv.LOADING,this._state!==dv.FAILED)){var i=this.gltf.extensions;if(Object(s.default)(i)&&Object(s.default)(i.CESIUM_RTC)){var a=v.default.fromArray(i.CESIUM_RTC.center);if(!v.default.equals(a,v.default.ZERO)){this._rtcCenter3D=a;var n=e.mapProjection,o=n.ellipsoid.cartesianToCartographic(this._rtcCenter3D),l=n.project(o);v.default.fromElements(l.z,l.x,l.y,l),this._rtcCenter2D=l,this._rtcCenterEye=new v.default,this._rtcCenter=this._rtcCenter3D}}this._loadResources=new Eh,ep.parseBuffers(this)}var u=this._loadResources,d=!1;this._state===dv.LOADING&&(0===u.pendingBufferLoads&&(ep.checkSupportedExtensions(this.extensionsRequired,t),function(e){var t=e.gltf,i=e._loadResources;Gf.buffer(t,(function(e,t){i.buffers[t]=e.extras._pipeline.source}))}(this),function(e){var t=e.gltf.bufferViews,i=e._loadResources.vertexBuffersToCreate;Gf.bufferView(e.gltf,(function(e,t){e.target===jf.a.ARRAY_BUFFER&&i.enqueue(t)}));var a=e._loadResources.indexBuffersToCreate,r={};Gf.accessor(e.gltf,(function(e){var i=e.bufferView;t[i].target!==jf.a.ELEMENT_ARRAY_BUFFER||Object(s.default)(r[i])||(r[i]=!0,a.enqueue({id:i,componentType:e.componentType}))}))}(this),this._boundingSphere=ep.computeBoundingSphere(this),this._initialRadius=this._boundingSphere.radius,vv(this,e)),u.finished()&&(this._state=dv.LOADED,d=!0)),Object(s.default)(u)&&this._state===dv.LOADED&&(d||vv(this,e),u.finished()&&(this._loadResources=void 0));var f=this.show;if(f&&this._state===dv.LOADED||d){this._dirty=!1;var c=this.modelMatrix,h=e.mode!==this._mode;this._mode=e.mode;var p=!nt.default.equals(this._modelMatrix,c)||h;if(p||d){nt.default.clone(c,this._modelMatrix);var m=this._computedModelMatrix;nt.default.clone(c,m),this._upAxis===hf.Y?nt.default.multiplyTransformation(m,hf.Y_UP_TO_Z_UP,m):this._upAxis===hf.X&&nt.default.multiplyTransformation(m,hf.X_UP_TO_Z_UP,m)}(p||d)&&(!function(e,t,i,a){var n=e._computedModelMatrix;if(e._mode!==Ve.a.SCENE3D&&!e._ignoreCommands){var o=nt.default.getColumn(n,3,bv);if(It.a.equals(o,It.a.UNIT_W)){var l=e.boundingSphere.center,u=Mt.default.wgs84To2DModelMatrix(a,l,yv);n=nt.default.multiply(u,n,yv),Object(s.default)(e._rtcCenter)&&(nt.default.setTranslation(n,It.a.UNIT_W,n),e._rtcCenter=e._rtcCenter2D)}else n=Mt.default.basisTo2D(a,n,yv),e._rtcCenter=e._rtcCenter3D}var d=e._primitive;(t||i)&&(nt.default.multiplyTransformation(n,e._nodeMatrix,d._modelMatrix),r.default.transform(d._boundingSphere,d._modelMatrix,d._boundingVolume),Object(s.default)(e._rtcCenter)&&v.default.add(e._rtcCenter,d._boundingVolume.center,d._boundingVolume.center))}(this,p,d,e.mapProjection),this._dirty=!0)}if(d){var _=this;e.afterRender.push((function(){_._ready=!0,_._readyPromise.resolve(_)}))}else f&&!this._ignoreCommands&&(this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume,this._primitive.debugWireframe=this.debugWireframe,this._primitive.update(e))}else bf.default.supportsWebP.initialize()},fv.prototype.isDestroyed=function(){return!1},fv.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),Object(l.default)(this)};var Ov=fv;function wv(e,t,i,a,r){this._tileset=e,this._tile=t,this._resource=i,this._model=void 0,this._batchTable=void 0,this._features=void 0,this._batchIdAttributeName=void 0,this._diffuseAttributeOrUniformName={},this._rtcCenterTransform=void 0,this._contentModelMatrix=void 0,this.featurePropertiesDirty=!1,function(e,t,i){var a=e._tileset,r=e._tile,n=e._resource,l=Object(o.default)(i,0);i=l;var u=new Uint8Array(t),d=new DataView(t);i+=xv;var f=d.getUint32(i,!0);if(1!==f)throw new $f.default("Only Batched 3D Model version 1 is supported.  Version "+f+" is not.");i+=xv;var c=d.getUint32(i,!0);i+=xv;var h=d.getUint32(i,!0);i+=xv;var p=d.getUint32(i,!0);i+=xv;var m=d.getUint32(i,!0);i+=xv;var _,g,b=d.getUint32(i,!0);i+=xv,m>=570425344?(i-=2*xv,_=h,m=p,b=0,h=0,p=0,wv._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchLength] [batchTableByteLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/master/specification/TileFormats/Batched3DModel.")):b>=570425344&&(i-=xv,_=m,m=h,b=p,h=0,p=0,wv._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchTableJsonByteLength] [batchTableBinaryByteLength] [batchLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/master/specification/TileFormats/Batched3DModel."));if(0===h)g={BATCH_LENGTH:Object(o.default)(_,0)};else{var y=Object(Of.a)(u,i,h);g=JSON.parse(y),i+=h}var O=new Uint8Array(t,i,p);i+=p;var w,x,E,T=new dg(g,O);if(_=T.getGlobalProperty("BATCH_LENGTH"),T.featuresLength=_,m>0){var C=Object(Of.a)(u,i,m);w=JSON.parse(C),i+=m,b>0&&(x=new Uint8Array(t,i,b),x=new Uint8Array(x),i+=b)}Object(s.default)(a.classificationType)&&(E=function(e){return function(t,i){e._model.updateCommands(t,i)}}(e));var A=new og(e,_,w,x,E);e._batchTable=A;var j,P=l+c-i;if(0===P)throw new $f.default("glTF byte length must be greater than 0.");i%4==0?j=new Uint8Array(t,i,P):(wv._deprecationWarning("b3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),j=new Uint8Array(u.subarray(i,i+P)));var S={content:e,primitive:a};e._rtcCenterTransform=nt.default.IDENTITY;var I=T.getGlobalProperty("RTC_CENTER",se.a.FLOAT,3);Object(s.default)(I)&&(e._rtcCenterTransform=nt.default.fromTranslation(v.default.fromArray(I)));e._contentModelMatrix=nt.default.multiply(r.computedTransform,e._rtcCenterTransform,new nt.default),Object(s.default)(a.classificationType)?e._model=new Ov({gltf:j,cull:!1,basePath:n,requestType:E_.a.TILES3D,modelMatrix:e._contentModelMatrix,upAxis:a._gltfUpAxis,forwardAxis:hf.X,debugWireframe:a.debugWireframe,vertexShaderLoaded:Ev(e),classificationShaderLoaded:Av(e),uniformMapLoaded:A.getUniformMapCallback(),pickIdLoaded:Cv(e),classificationType:a._classificationType,batchTable:A}):e._model=new e_({gltf:j,cull:!1,releaseGltfJson:!0,opaquePass:Lf.a.CESIUM_3D_TILE,basePath:n,requestType:E_.a.TILES3D,modelMatrix:e._contentModelMatrix,upAxis:a._gltfUpAxis,forwardAxis:hf.X,shadows:a.shadows,debugWireframe:a.debugWireframe,incrementallyLoadTextures:!1,vertexShaderLoaded:Ev(e),fragmentShaderLoaded:Tv(e),uniformMapLoaded:A.getUniformMapCallback(),pickIdLoaded:Cv(e),addBatchIdToGeneratedShaders:_>0,pickObject:S,imageBasedLightingFactor:a.imageBasedLightingFactor,lightColor:a.lightColor,luminanceAtZenith:a.luminanceAtZenith,sphericalHarmonicCoefficients:a.sphericalHarmonicCoefficients,specularEnvironmentMaps:a.specularEnvironmentMaps})}(this,a,r)}wv._deprecationWarning=m_.default,Object.defineProperties(wv.prototype,{featuresLength:{get:function(){return this._batchTable.featuresLength}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return this._model.trianglesLength}},geometryByteLength:{get:function(){return this._model.geometryByteLength}},texturesByteLength:{get:function(){return this._model.texturesByteLength}},batchTableByteLength:{get:function(){return this._batchTable.memorySizeInBytes}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._model.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var xv=Uint32Array.BYTES_PER_ELEMENT;function Ev(e){return function(t,i){var a=e._batchTable,r=!Object(s.default)(e._tileset.classificationType),n=e._model.gltf;Object(s.default)(n)&&(e._batchIdAttributeName=function(e){var t=ep.getAttributeOrUniformBySemantic(e,"_BATCHID");return Object(s.default)(t)||(t=ep.getAttributeOrUniformBySemantic(e,"BATCHID"),Object(s.default)(t)&&wv._deprecationWarning("b3dm-legacy-batchid","The glTF in this b3dm uses the semantic `BATCHID`. Application-specific semantics should be prefixed with an underscore: `_BATCHID`.")),t}(n),e._diffuseAttributeOrUniformName[i]=ep.getDiffuseAttributeOrUniform(n,i));var o=a.getVertexShaderCallback(r,e._batchIdAttributeName,e._diffuseAttributeOrUniformName[i]);return Object(s.default)(o)?o(t):t}}function Tv(e){return function(t,i){var a=e._batchTable,r=!Object(s.default)(e._tileset.classificationType),n=e._model.gltf;Object(s.default)(n)&&(e._diffuseAttributeOrUniformName[i]=ep.getDiffuseAttributeOrUniform(n,i));var o=a.getFragmentShaderCallback(r,e._diffuseAttributeOrUniformName[i]);return Object(s.default)(o)?o(t):t}}function Cv(e){return function(){return e._batchTable.getPickId()}}function Av(e){return function(t){var i=e._batchTable.getClassificationFragmentShaderCallback();return Object(s.default)(i)?i(t):t}}wv.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)},wv.prototype.getFeature=function(e){return function(e){var t=e.featuresLength;if(!Object(s.default)(e._features)&&t>0){for(var i=new Array(t),a=0;a<t;++a)i[a]=new sg.a(e,a);e._features=i}}(this),this._features[e]},wv.prototype.applyDebugSettings=function(e,t){t=e?t:b.default.WHITE,0===this.featuresLength?this._model.color=t:this._batchTable.setAllColor(t)},wv.prototype.applyStyle=function(e){if(0===this.featuresLength){var t=Object(s.default)(e)&&Object(s.default)(e.color),i=Object(s.default)(e)&&Object(s.default)(e.show);this._model.color=t?e.color.evaluateColor(void 0,this._model.color):b.default.clone(b.default.WHITE,this._model.color),this._model.show=!i||e.show.evaluate(void 0)}else this._batchTable.applyStyle(e)},wv.prototype.update=function(e,t){var i=t.commandList.length;this._batchTable.update(e,t),this._contentModelMatrix=nt.default.multiply(this._tile.computedTransform,this._rtcCenterTransform,this._contentModelMatrix),this._model.modelMatrix=this._contentModelMatrix,this._model.shadows=this._tileset.shadows,this._model.imageBasedLightingFactor=this._tileset.imageBasedLightingFactor,this._model.lightColor=this._tileset.lightColor,this._model.luminanceAtZenith=this._tileset.luminanceAtZenith,this._model.sphericalHarmonicCoefficients=this._tileset.sphericalHarmonicCoefficients,this._model.specularEnvironmentMaps=this._tileset.specularEnvironmentMaps,this._model.debugWireframe=this._tileset.debugWireframe;var a=this._tileset.clippingPlanes;this._model.clippingPlanesOriginMatrix=this._tileset.clippingPlanesOriginMatrix,Object(s.default)(a)&&this._tile.clippingPlanesDirty&&(this._model._clippingPlanes=a.enabled&&this._tile._isClipped?a:void 0),Object(s.default)(a)&&Object(s.default)(this._model._clippingPlanes)&&this._model._clippingPlanes!==a&&(this._model._clippingPlanes=a),this._model.update(t),i<t.commandList.length&&(t.passes.render||t.passes.pick)&&!Object(s.default)(e.classificationType)&&this._batchTable.addDerivedCommands(t,i)},wv.prototype.isDestroyed=function(){return!1},wv.prototype.destroy=function(){return this._model=this._model&&this._model.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Object(l.default)(this)};var jv=wv;function Pv(e,t,i,a,r,n){this._tileset=e,this._tile=t,this._resource=i,this._contents=[],this._readyPromise=Ef.default.defer(),function(e,t,i,a){i=Object(o.default)(i,0);var r=new Uint8Array(t),n=new DataView(t);i+=Sv;var l=n.getUint32(i,!0);if(1!==l)throw new $f.default("Only Composite Tile version 1 is supported. Version "+l+" is not.");i+=Sv,i+=Sv;var u=n.getUint32(i,!0);i+=Sv;for(var d=[],f=0;f<u;++f){var c=wf(r,i),h=n.getUint32(i+2*Sv,!0),p=a[c];if(!Object(s.default)(p))throw new $f.default("Unknown tile content type, "+c+", inside Composite tile");var m=p(e._tileset,e._tile,e._resource,t,i);e._contents.push(m),d.push(m.readyPromise),i+=h}Ef.default.all(d).then((function(){e._readyPromise.resolve(e)})).otherwise((function(t){e._readyPromise.reject(t)}))}(this,a,r,n)}Object.defineProperties(Pv.prototype,{featurePropertiesDirty:{get:function(){for(var e=this._contents,t=e.length,i=0;i<t;++i)if(e[i].featurePropertiesDirty)return!0;return!1},set:function(e){for(var t=this._contents,i=t.length,a=0;a<i;++a)t[a].featurePropertiesDirty=e}},featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){return this._contents}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){}}});var Sv=Uint32Array.BYTES_PER_ELEMENT;Pv.prototype.hasProperty=function(e,t){return!1},Pv.prototype.getFeature=function(e){},Pv.prototype.applyDebugSettings=function(e,t){for(var i=this._contents,a=i.length,r=0;r<a;++r)i[r].applyDebugSettings(e,t)},Pv.prototype.applyStyle=function(e){for(var t=this._contents,i=t.length,a=0;a<i;++a)t[a].applyStyle(e)},Pv.prototype.update=function(e,t){for(var i=this._contents,a=i.length,r=0;r<a;++r)i[r].update(e,t)},Pv.prototype.isDestroyed=function(){return!1},Pv.prototype.destroy=function(){for(var e=this._contents,t=e.length,i=0;i<t;++i)e[i].destroy();return Object(l.default)(this)};var Iv=Pv;function Lv(e){this._boxes=e.boxes,this._boxBatchIds=e.boxBatchIds,this._cylinders=e.cylinders,this._cylinderBatchIds=e.cylinderBatchIds,this._ellipsoids=e.ellipsoids,this._ellipsoidBatchIds=e.ellipsoidBatchIds,this._spheres=e.spheres,this._sphereBatchIds=e.sphereBatchIds,this._modelMatrix=e.modelMatrix,this._batchTable=e.batchTable,this._boundingVolume=e.boundingVolume,this._center=e.center,Object(s.default)(this._center)||(Object(s.default)(this._boundingVolume)?this._center=v.default.clone(this._boundingVolume.center):this._center=v.default.clone(v.default.ZERO)),this._boundingVolumes=void 0,this._batchedIndices=void 0,this._indices=void 0,this._indexOffsets=void 0,this._indexCounts=void 0,this._positions=void 0,this._vertexBatchIds=void 0,this._batchIds=void 0,this._batchTableColors=void 0,this._packedBuffer=void 0,this._ready=!1,this._readyPromise=Ef.default.defer(),this._verticesPromise=void 0,this._primitive=void 0,this.debugWireframe=!1,this.forceRebatch=!1,this.classificationType=Z.a.BOTH}Object.defineProperties(Lv.prototype,{trianglesLength:{get:function(){return Object(s.default)(this._primitive)?this._primitive.trianglesLength:0}},geometryByteLength:{get:function(){return Object(s.default)(this._primitive)?this._primitive.geometryByteLength:0}},readyPromise:{get:function(){return this._readyPromise.promise}}}),Lv.packedBoxLength=nt.default.packedLength+v.default.packedLength,Lv.packedCylinderLength=nt.default.packedLength+2,Lv.packedEllipsoidLength=nt.default.packedLength+v.default.packedLength,Lv.packedSphereLength=v.default.packedLength+1;var Dv=new Uc.default("createVectorTileGeometries"),Mv=new b.default;function Rv(e){if(!Object(s.default)(e._primitive)){if(!Object(s.default)(e._verticesPromise)){var t=e._boxes,i=e._boxBatchIds,a=e._cylinders,n=e._cylinderBatchIds,l=e._ellipsoids,u=e._ellipsoidBatchIds,d=e._spheres,f=e._sphereBatchIds,c=e._batchTableColors,h=e._packedBuffer;if(!Object(s.default)(c)){var p=0;Object(s.default)(e._boxes)&&(t=e._boxes=Object(Bc.a)(t),p+=(i=e._boxBatchIds=Object(Bc.a)(i)).length),Object(s.default)(e._cylinders)&&(a=e._cylinders=Object(Bc.a)(a),p+=(n=e._cylinderBatchIds=Object(Bc.a)(n)).length),Object(s.default)(e._ellipsoids)&&(l=e._ellipsoids=Object(Bc.a)(l),p+=(u=e._ellipsoidBatchIds=Object(Bc.a)(u)).length),Object(s.default)(e._spheres)&&(d=e._sphere=Object(Bc.a)(d),p+=(f=e._sphereBatchIds=Object(Bc.a)(f)).length),c=e._batchTableColors=new Uint32Array(p);for(var m=e._batchTable,_=0;_<p;++_){var g=m.getColor(_,Mv);c[_]=g.toRgba()}h=e._packedBuffer=function(e){var t=new Float64Array(nt.default.packedLength+v.default.packedLength),i=0;return v.default.pack(e._center,t,i),i+=v.default.packedLength,nt.default.pack(e._modelMatrix,t,i),t}(e)}var y=[];Object(s.default)(t)&&y.push(t.buffer,i.buffer),Object(s.default)(a)&&y.push(a.buffer,n.buffer),Object(s.default)(l)&&y.push(l.buffer,u.buffer),Object(s.default)(d)&&y.push(d.buffer,f.buffer),y.push(c.buffer,h.buffer);var O={boxes:Object(s.default)(t)?t.buffer:void 0,boxBatchIds:Object(s.default)(t)?i.buffer:void 0,cylinders:Object(s.default)(a)?a.buffer:void 0,cylinderBatchIds:Object(s.default)(a)?n.buffer:void 0,ellipsoids:Object(s.default)(l)?l.buffer:void 0,ellipsoidBatchIds:Object(s.default)(l)?u.buffer:void 0,spheres:Object(s.default)(d)?d.buffer:void 0,sphereBatchIds:Object(s.default)(d)?f.buffer:void 0,batchTableColors:c.buffer,packedBuffer:h.buffer},w=e._verticesPromise=Dv.scheduleTask(O,y);if(!Object(s.default)(w))return;w.then((function(t){var i=new Float64Array(t.packedBuffer),a=function(e,t){for(var i=0,a=t[i++],n=t[i++],o=e._boundingVolumes=new Array(n),s=0;s<n;++s)o[s]=r.default.unpack(t,i),i+=r.default.packedLength;for(var l=t[i++],u=e._batchedIndices=new Array(l),d=0;d<l;++d){var f=b.default.unpack(t,i);i+=b.default.packedLength;for(var c=t[i++],h=t[i++],p=t[i++],m=new Array(p),_=0;_<p;++_)m[_]=t[i++];u[d]=new fg({color:f,offset:c,count:h,batchIds:m})}return a}(e,i);e._indices=2===a?new Uint16Array(t.indices):new Uint32Array(t.indices),e._indexOffsets=new Uint32Array(t.indexOffsets),e._indexCounts=new Uint32Array(t.indexCounts),e._positions=new Float32Array(t.positions),e._vertexBatchIds=new Uint16Array(t.vertexBatchIds),e._batchIds=new Uint16Array(t.batchIds),e._ready=!0}))}e._ready&&!Object(s.default)(e._primitive)&&(e._primitive=new lv({batchTable:e._batchTable,positions:e._positions,batchIds:e._batchIds,vertexBatchIds:e._vertexBatchIds,indices:e._indices,indexOffsets:e._indexOffsets,indexCounts:e._indexCounts,batchedIndices:e._batchedIndices,boundingVolume:e._boundingVolume,boundingVolumes:e._boundingVolumes,center:e._center,pickObject:Object(o.default)(e._pickObject,e)}),e._boxes=void 0,e._boxBatchIds=void 0,e._cylinders=void 0,e._cylinderBatchIds=void 0,e._ellipsoids=void 0,e._ellipsoidBatchIds=void 0,e._spheres=void 0,e._sphereBatchIds=void 0,e._center=void 0,e._modelMatrix=void 0,e._batchTable=void 0,e._boundingVolume=void 0,e._boundingVolumes=void 0,e._batchedIndices=void 0,e._indices=void 0,e._indexOffsets=void 0,e._indexCounts=void 0,e._positions=void 0,e._vertexBatchIds=void 0,e._batchIds=void 0,e._batchTableColors=void 0,e._packedBuffer=void 0,e._verticesPromise=void 0,e._readyPromise.resolve())}}Lv.prototype.createFeatures=function(e,t){this._primitive.createFeatures(e,t)},Lv.prototype.applyDebugSettings=function(e,t){this._primitive.applyDebugSettings(e,t)},Lv.prototype.applyStyle=function(e,t){this._primitive.applyStyle(e,t)},Lv.prototype.updateCommands=function(e,t){this._primitive.updateCommands(e,t)},Lv.prototype.update=function(e){Rv(this),this._ready&&(this._primitive.debugWireframe=this.debugWireframe,this._primitive.forceRebatch=this.forceRebatch,this._primitive.classificationType=this.classificationType,this._primitive.update(e))},Lv.prototype.isDestroyed=function(){return!1},Lv.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),Object(l.default)(this)};var Nv=Lv;function Vv(e,t,i,a,r){this._tileset=e,this._tile=t,this._resource=i,this._geometries=void 0,this._contentReadyPromise=void 0,this._readyPromise=Ef.default.defer(),this._batchTable=void 0,this._features=void 0,this.featurePropertiesDirty=!1,function(e,t,i){i=Object(o.default)(i,0);var a=new Uint8Array(t),r=new DataView(t);i+=Bv;var n=r.getUint32(i,!0);if(1!==n)throw new $f.default("Only Geometry tile version 1 is supported.  Version "+n+" is not.");i+=Bv;var l=r.getUint32(i,!0);if(i+=Bv,0===l)return void e._readyPromise.resolve(e);var u=r.getUint32(i,!0);if(i+=Bv,0===u)throw new $f.default("Feature table must have a byte length greater than zero");var d=r.getUint32(i,!0);i+=Bv;var f=r.getUint32(i,!0);i+=Bv;var c=r.getUint32(i,!0);i+=Bv;var h=Object(Of.a)(a,i,u),p=JSON.parse(h);i+=u;var m,_,g=new Uint8Array(t,i,d);if(i+=d,f>0){var b=Object(Of.a)(a,i,f);m=JSON.parse(b),i+=f,c>0&&(_=new Uint8Array(t,i,c),_=new Uint8Array(_))}var y=Object(o.default)(p.BOXES_LENGTH,0),O=Object(o.default)(p.CYLINDERS_LENGTH,0),w=Object(o.default)(p.ELLIPSOIDS_LENGTH,0),x=Object(o.default)(p.SPHERES_LENGTH,0),E=y+O+w+x,T=new og(e,E,m,_,function(e){return function(t,i){Object(s.default)(e._geometries)&&e._geometries.updateCommands(t,i)}}(e));if(e._batchTable=T,0===E)return;var C,A=e.tile.computedTransform;Object(s.default)(p.RTC_CENTER)&&(C=v.default.unpack(p.RTC_CENTER),nt.default.multiplyByPoint(A,C,C));var j=function(e,t){var i,a,r,n,l,u=Object(o.default)(e.BOXES_LENGTH,0),d=Object(o.default)(e.CYLINDERS_LENGTH,0),f=Object(o.default)(e.ELLIPSOIDS_LENGTH,0),c=Object(o.default)(e.SPHERES_LENGTH,0);if(u>0&&Object(s.default)(e.BOX_BATCH_IDS)){var h=t.byteOffset+e.BOX_BATCH_IDS.byteOffset;i=new Uint16Array(t.buffer,h,u)}if(d>0&&Object(s.default)(e.CYLINDER_BATCH_IDS)){var p=t.byteOffset+e.CYLINDER_BATCH_IDS.byteOffset;a=new Uint16Array(t.buffer,p,d)}if(f>0&&Object(s.default)(e.ELLIPSOID_BATCH_IDS)){var m=t.byteOffset+e.ELLIPSOID_BATCH_IDS.byteOffset;r=new Uint16Array(t.buffer,m,f)}if(c>0&&Object(s.default)(e.SPHERE_BATCH_IDS)){var _=t.byteOffset+e.SPHERE_BATCH_IDS.byteOffset;n=new Uint16Array(t.buffer,_,c)}var g=Object(s.default)(i)||Object(s.default)(a)||Object(s.default)(r)||Object(s.default)(n),v=u>0&&!Object(s.default)(i)||d>0&&!Object(s.default)(a)||f>0&&!Object(s.default)(r)||c>0&&!Object(s.default)(n);if(g&&v)throw new $f.default("If one group of batch ids is defined, then all batch ids must be defined.");if(!(Object(s.default)(i)||Object(s.default)(a)||Object(s.default)(r)||Object(s.default)(n))){var b=0;if(!Object(s.default)(i)&&u>0)for(i=new Uint16Array(u),l=0;l<u;++l)i[l]=b++;if(!Object(s.default)(a)&&d>0)for(a=new Uint16Array(d),l=0;l<d;++l)a[l]=b++;if(!Object(s.default)(r)&&f>0)for(r=new Uint16Array(f),l=0;l<f;++l)r[l]=b++;if(!Object(s.default)(n)&&c>0)for(n=new Uint16Array(c),l=0;l<c;++l)n[l]=b++}return{boxes:i,cylinders:a,ellipsoids:r,spheres:n}}(p,g);if(y>0||O>0||w>0||x>0){var P,S,I,L;if(y>0){var D=g.byteOffset+p.BOXES.byteOffset;P=new Float32Array(g.buffer,D,Nv.packedBoxLength*y)}if(O>0){var M=g.byteOffset+p.CYLINDERS.byteOffset;S=new Float32Array(g.buffer,M,Nv.packedCylinderLength*O)}if(w>0){var R=g.byteOffset+p.ELLIPSOIDS.byteOffset;I=new Float32Array(g.buffer,R,Nv.packedEllipsoidLength*w)}if(x>0){var N=g.byteOffset+p.SPHERES.byteOffset;L=new Float32Array(g.buffer,N,Nv.packedSphereLength*x)}e._geometries=new Nv({boxes:P,boxBatchIds:j.boxes,cylinders:S,cylinderBatchIds:j.cylinders,ellipsoids:I,ellipsoidBatchIds:j.ellipsoids,spheres:L,sphereBatchIds:j.spheres,center:C,modelMatrix:A,batchTable:T,boundingVolume:e.tile.boundingVolume.boundingVolume})}}(this,a,r)}Object.defineProperties(Vv.prototype,{featuresLength:{get:function(){return Object(s.default)(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return Object(s.default)(this._geometries)?this._geometries.trianglesLength:0}},geometryByteLength:{get:function(){return Object(s.default)(this._geometries)?this._geometries.geometryByteLength:0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return Object(s.default)(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var Bv=Uint32Array.BYTES_PER_ELEMENT;function Uv(e){var t=e.featuresLength;if(!Object(s.default)(e._features)&&t>0){var i=new Array(t);Object(s.default)(e._geometries)&&e._geometries.createFeatures(e,i),e._features=i}}Vv.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)},Vv.prototype.getFeature=function(e){return Uv(this),this._features[e]},Vv.prototype.applyDebugSettings=function(e,t){Object(s.default)(this._geometries)&&this._geometries.applyDebugSettings(e,t)},Vv.prototype.applyStyle=function(e){Uv(this),Object(s.default)(this._geometries)&&this._geometries.applyStyle(e,this._features)},Vv.prototype.update=function(e,t){if(Object(s.default)(this._geometries)&&(this._geometries.classificationType=this._tileset.classificationType,this._geometries.debugWireframe=this._tileset.debugWireframe,this._geometries.update(t)),Object(s.default)(this._batchTable)&&this._geometries._ready&&this._batchTable.update(e,t),!Object(s.default)(this._contentReadyPromise)){var i=this;this._contentReadyPromise=this._geometries.readyPromise.then((function(){i._readyPromise.resolve(i)}))}},Vv.prototype.isDestroyed=function(){return!1},Vv.prototype.destroy=function(){return this._geometries=this._geometries&&this._geometries.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Object(l.default)(this)};var Fv=Vv,Hv=i(76),kv=i(529);function zv(e,t,i){this.primitive=e,this._modelMatrix=nt.default.clone(t),this._instanceId=i}Object.defineProperties(zv.prototype,{instanceId:{get:function(){return this._instanceId}},model:{get:function(){return this.primitive._model}},modelMatrix:{get:function(){return nt.default.clone(this._modelMatrix)},set:function(e){nt.default.clone(e,this._modelMatrix),this.primitive.expandBoundingSphere(this._modelMatrix),this.primitive._dirty=!0}}});var Gv=zv,qv=0,Wv=1,Yv=2,Kv=3;function Xv(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT),this.show=Object(o.default)(e.show,!0),this._instancingSupported=!1,this._dynamic=Object(o.default)(e.dynamic,!1),this._allowPicking=Object(o.default)(e.allowPicking,!0),this._ready=!1,this._readyPromise=Ef.default.defer(),this._state=qv,this._dirty=!1,this._cull=Object(o.default)(e.cull,!0),this._opaquePass=Object(o.default)(e.opaquePass,Lf.a.OPAQUE),this._instances=function(e,t){for(var i=(t=Object(o.default)(t,[])).length,a=new Array(i),r=0;r<i;++r){var n=t[r],s=n.modelMatrix,l=Object(o.default)(n.batchId,r);a[r]=new Gv(e,s,l)}return a}(this,e.instances),this._batchTable=e.batchTable,this._model=void 0,this._vertexBufferTypedArray=void 0,this._vertexBuffer=void 0,this._batchIdBuffer=void 0,this._instancedUniformsByProgram=void 0,this._drawCommands=[],this._modelCommands=void 0,this._boundingSphere=function(e){for(var t=e.length,i=new Array(t),a=0;a<t;++a)i[a]=nt.default.getTranslation(e._instances[a]._modelMatrix,new v.default);return r.default.fromPoints(i)}(this),this._center=v.default.clone(this._boundingSphere.center),this._rtcTransform=new nt.default,this._rtcModelView=new nt.default,this._mode=void 0,this.modelMatrix=nt.default.clone(nt.default.IDENTITY),this._modelMatrix=nt.default.clone(this.modelMatrix),this._url=pf.default.createIfNeeded(e.url),this._requestType=e.requestType,this._gltf=e.gltf,this._basePath=pf.default.createIfNeeded(e.basePath),this._asynchronous=e.asynchronous,this._incrementallyLoadTextures=e.incrementallyLoadTextures,this._upAxis=e.upAxis,this._forwardAxis=e.forwardAxis,this.shadows=Object(o.default)(e.shadows,ae.a.ENABLED),this._shadows=this.shadows,this._pickIdLoaded=e.pickIdLoaded,this.debugShowBoundingVolume=Object(o.default)(e.debugShowBoundingVolume,!1),this._debugShowBoundingVolume=!1,this.debugWireframe=Object(o.default)(e.debugWireframe,!1),this._debugWireframe=!1,this._imageBasedLightingFactor=new g.default(1,1),g.default.clone(e.imageBasedLightingFactor,this._imageBasedLightingFactor),this.lightColor=e.lightColor,this.luminanceAtZenith=e.luminanceAtZenith,this.sphericalHarmonicCoefficients=e.sphericalHarmonicCoefficients,this.specularEnvironmentMaps=e.specularEnvironmentMaps}Object.defineProperties(Xv.prototype,{allowPicking:{get:function(){return this._allowPicking}},length:{get:function(){return this._instances.length}},activeAnimations:{get:function(){return this._model.activeAnimations}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(e){g.default.clone(e,this._imageBasedLightingFactor)}}});var Zv=new v.default,Jv=new nt.default;function Qv(e,t,i,a){return function(r,n){var o=r.semantic;if(Object(s.default)(o)&&e.indexOf(o)>-1){if(!(t.indexOf(o)>-1))throw new $f.default('Shader program cannot be optimized for instancing. Uniform "'+n+'" in program "'+i+'" uses unsupported semantic "'+o+'"');a[n]=o}}}function $v(e,t){if(Object(s.default)(e._instancedUniformsByProgram))return e._instancedUniformsByProgram[t];var i={};e._instancedUniformsByProgram=i;var a=["MODEL","MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELINVERSE","MODELVIEWINVERSE","MODELVIEWPROJECTIONINVERSE","MODELINVERSETRANSPOSE","MODELVIEWINVERSETRANSPOSE"],r=["MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELVIEWINVERSETRANSPOSE"],n=e._model._sourceTechniques;for(var o in n)if(n.hasOwnProperty(o)){var l=n[o],u=l.program;if(!Object(s.default)(i[u])){var d={};i[u]=d,Gf.techniqueUniform(l,Qv(a,r,t,d))}}return i[t]}function eb(e,t){return function(i,a,r){(i=Object(_f.default)(i)).czm_instanced_modifiedModelView=function(e,t){return function(){return nt.default.multiply(t.uniformState.view,e._rtcTransform,e._rtcModelView)}}(e,t),i.czm_instanced_nodeTransform=function(e){return function(){return e.computedMatrix}}(r);var n=$v(e,a);for(var o in n)n.hasOwnProperty(o)&&delete i[o];return Object(s.default)(e._batchTable)&&(i=e._batchTable.getUniformMapCallback()(i)),i}}function tb(e){var t=e._instances,i=e.length,a=e._center,r=e._vertexBufferTypedArray;Object(s.default)(r)||(r=new Float32Array(12*i)),e._dynamic&&(e._vertexBufferTypedArray=r);for(var n=0;n<i;++n){var o=t[n]._modelMatrix,l=nt.default.clone(o,Jv);l[12]-=a.x,l[13]-=a.y,l[14]-=a.z;var u=12*n;r[u+0]=l[0],r[u+1]=l[4],r[u+2]=l[8],r[u+3]=l[12],r[u+4]=l[1],r[u+5]=l[5],r[u+6]=l[9],r[u+7]=l[13],r[u+8]=l[2],r[u+9]=l[6],r[u+10]=l[10],r[u+11]=l[14]}return r}function ib(e,t){var i=e._instancingSupported,a=Object(s.default)(e._batchTable),r=e._allowPicking,n={url:e._url,requestType:e._requestType,gltf:e._gltf,basePath:e._basePath,shadows:e._shadows,cacheKey:void 0,asynchronous:e._asynchronous,allowPicking:r,incrementallyLoadTextures:e._incrementallyLoadTextures,upAxis:e._upAxis,forwardAxis:e._forwardAxis,precreatedAttributes:void 0,vertexShaderLoaded:void 0,fragmentShaderLoaded:void 0,uniformMapLoaded:void 0,pickIdLoaded:e._pickIdLoaded,ignoreCommands:!0,opaquePass:e._opaquePass,imageBasedLightingFactor:e.imageBasedLightingFactor,lightColor:e.lightColor,luminanceAtZenith:e.luminanceAtZenith,sphericalHarmonicCoefficients:e.sphericalHarmonicCoefficients,specularEnvironmentMaps:e.specularEnvironmentMaps};if(a||(e._pickIds=function(e,t){for(var i=e._instances,a=i.length,r=new Array(a),n=0;n<a;++n)r[n]=t.createPickId(i[n]);return r}(e,t)),i){!function(e,t){var i,a=e._instances,r=e.length,n=e._dynamic,o=Object(s.default)(e._batchTable);if(o){var l=new Uint16Array(r);for(i=0;i<r;++i)l[i]=a[i]._instanceId;e._batchIdBuffer=Pf.a.createVertexBuffer({context:t,typedArray:l,usage:Sf.a.STATIC_DRAW})}if(!o){var u=new Uint8Array(4*r);for(i=0;i<r;++i){var d=e._pickIds[i].color,f=4*i;u[f]=b.default.floatToByte(d.red),u[f+1]=b.default.floatToByte(d.green),u[f+2]=b.default.floatToByte(d.blue),u[f+3]=b.default.floatToByte(d.alpha)}e._pickIdBuffer=Pf.a.createVertexBuffer({context:t,typedArray:u,usage:Sf.a.STATIC_DRAW})}var c=tb(e);e._vertexBuffer=Pf.a.createVertexBuffer({context:t,typedArray:c,usage:n?Sf.a.STREAM_DRAW:Sf.a.STATIC_DRAW})}(e,t);var o=se.a.getSizeInBytes(se.a.FLOAT),l={czm_modelMatrixRow0:{index:0,vertexBuffer:e._vertexBuffer,componentsPerAttribute:4,componentDatatype:se.a.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:12*o,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:e._vertexBuffer,componentsPerAttribute:4,componentDatatype:se.a.FLOAT,normalize:!1,offsetInBytes:4*o,strideInBytes:12*o,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:e._vertexBuffer,componentsPerAttribute:4,componentDatatype:se.a.FLOAT,normalize:!1,offsetInBytes:8*o,strideInBytes:12*o,instanceDivisor:1}};a&&(l.a_batchId={index:0,vertexBuffer:e._batchIdBuffer,componentsPerAttribute:1,componentDatatype:se.a.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0,instanceDivisor:1}),a||(l.pickColor={index:0,vertexBuffer:e._pickIdBuffer,componentsPerAttribute:4,componentDatatype:se.a.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0,instanceDivisor:1}),n.precreatedAttributes=l,n.vertexShaderLoaded=function(e){return function(t,i){var a=$v(e,i),r=Object(s.default)(e._batchTable),n=Nf.a.replaceMain(t,"czm_instancing_main"),o="",l="";for(var u in a)if(a.hasOwnProperty(u)){var d,f=a[u];"MODELVIEW"===f||"CESIUM_RTC_MODELVIEW"===f?d="czm_instanced_modelView":"MODELVIEWPROJECTION"===f?(d="czm_instanced_modelViewProjection",o+="mat4 czm_instanced_modelViewProjection;\n",l+="czm_instanced_modelViewProjection = czm_projection * czm_instanced_modelView;\n"):"MODELVIEWINVERSETRANSPOSE"===f&&(d="czm_instanced_modelViewInverseTranspose",o+="mat3 czm_instanced_modelViewInverseTranspose;\n",l+="czm_instanced_modelViewInverseTranspose = mat3(czm_instanced_modelView);\n");var c=new RegExp("uniform.*"+u+".*");n=n.replace(c,""),c=new RegExp(u+"\\b","g"),n=n.replace(c,d)}var h,p,m;r?(h="attribute float a_batchId;\n",p="",m=""):(h="",p="attribute vec4 pickColor;\nvarying vec4 v_pickColor;\n",m="    v_pickColor = pickColor;\n");var _="uniform mat4 czm_instanced_modifiedModelView;\nuniform mat4 czm_instanced_nodeTransform;\n"+o+"mat4 czm_instanced_modelView;\nattribute vec4 czm_modelMatrixRow0;\nattribute vec4 czm_modelMatrixRow1;\nattribute vec4 czm_modelMatrixRow2;\n"+h+p+n+"void main()\n{\n    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0, czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0);\n    czm_instanced_modelView = czm_instanced_modifiedModelView * czm_instanced_model * czm_instanced_nodeTransform;\n"+l+"    czm_instancing_main();\n"+m+"}\n";if(r){var g=e._model.gltf,v=ep.getDiffuseAttributeOrUniform(g,i);_=e._batchTable.getVertexShaderCallback(!0,"a_batchId",v)(_)}return _}}(e),n.fragmentShaderLoaded=function(e){return function(t,i){var a=e._batchTable;if(Object(s.default)(a)){var r=e._model.gltf,n=ep.getDiffuseAttributeOrUniform(r,i);t=a.getFragmentShaderCallback(!0,n)(t)}else t="varying vec4 v_pickColor;\n"+t;return t}}(e),n.uniformMapLoaded=eb(e,t),Object(s.default)(e._url)&&(n.cacheKey=e._url.getUrlComponent()+"#instanced")}else n.vertexShaderLoaded=function(e){return function(t,i){if(Object(s.default)(e._batchTable)){var a=e._model.gltf,r=ep.getDiffuseAttributeOrUniform(a,i);t="uniform float a_batchId\n;"+(t=e._batchTable.getVertexShaderCallback(!0,"a_batchId",r)(t))}return t}}(e),n.fragmentShaderLoaded=function(e){return function(t,i){var a=e._batchTable;if(Object(s.default)(a)){var r=e._model.gltf,n=ep.getDiffuseAttributeOrUniform(r,i);t=a.getFragmentShaderCallback(!0,n)(t)}else t="uniform vec4 czm_pickColor;\n"+t;return t}}(e),n.uniformMapLoaded=function(e){return function(t){return Object(s.default)(e._batchTable)&&(t=e._batchTable.getUniformMapCallback()(t)),t}}(e);Object(s.default)(e._url)?e._model=e_.fromGltf(n):e._model=new e_(n)}function ab(e){return function(){return e}}function rb(e){return function(){return e}}function nb(e){for(var t=e._modelCommands,i=t.length,a=e.length,n=e._rtcTransform,o=e._center,s=0;s<i;++s)for(var l=t[s],u=0;u<a;++u){var d=s*a+u,f=e._drawCommands[d],c=nt.default.clone(e._instances[u]._modelMatrix,Jv);c[12]-=o.x,c[13]-=o.y,c[14]-=o.z,c=nt.default.multiply(n,c,Jv);var h=l.modelMatrix,p=f.modelMatrix;nt.default.multiply(c,h,p);var m=l.boundingVolume,_=f.boundingVolume;r.default.transform(m,c,_)}}function ob(e){for(var t=e._nodeCommands,i=t.length,a=[],r=0;r<i;++r){var n=t[r];n.show&&a.push(n.command)}return a}function sb(e,t){e._drawCommands=[];var i=ob(e._model);t?function(e,t){for(var i=t.length,a=e.length,r=e._boundingSphere,n=e._cull,o=0;o<i;++o){var l=If.a.shallowClone(t[o]);l.instanceCount=a,l.boundingVolume=r,l.cull=n,Object(s.default)(e._batchTable)?l.pickId=e._batchTable.getPickId():l.pickId="v_pickColor",e._drawCommands.push(l)}}(e,i):(!function(e,t){for(var i=e._instances,a=t.length,n=e.length,o=e._batchTable,l=Object(s.default)(o),u=e._cull,d=0;d<a;++d)for(var f=0;f<n;++f){var c=If.a.shallowClone(t[d]);if(c.modelMatrix=new nt.default,c.boundingVolume=new r.default,c.cull=u,c.uniformMap=Object(_f.default)(c.uniformMap),l)c.uniformMap.a_batchId=ab(i[f]._instanceId);else{var h=e._pickIds[f];c.uniformMap.czm_pickColor=rb(h.color)}e._drawCommands.push(c)}}(e,i),nb(e))}Xv.prototype.expandBoundingSphere=function(e){var t=nt.default.getTranslation(e,Zv);r.default.expand(this._boundingSphere,t,this._boundingSphere)},Xv.prototype.update=function(e){if(e.mode!==Ve.a.MORPHING&&this.show&&0!==this.length){var t=e.context;if(this._state===qv){this._state=Wv,this._instancingSupported=t.instancedArrays,ib(this,t);var i=this;this._model.readyPromise.otherwise((function(e){i._state=Kv,i._readyPromise.reject(e)}))}var a=this._instancingSupported,r=this._model;if(r.imageBasedLightingFactor=this.imageBasedLightingFactor,r.lightColor=this.lightColor,r.luminanceAtZenith=this.luminanceAtZenith,r.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients,r.specularEnvironmentMaps=this.specularEnvironmentMaps,r.update(e),r.ready&&this._state===Wv){this._state=Yv,this._ready=!0;var n=r.boundingSphere.radius+v.default.magnitude(r.boundingSphere.center);return this._boundingSphere.radius+=n,this._modelCommands=ob(r),sb(this,a),void this._readyPromise.resolve(this)}if(this._state===Yv){var o,s,l=e.mode!==this._mode,u=this.modelMatrix,d=!nt.default.equals(this._modelMatrix,u);if(l||d){this._mode=e.mode,nt.default.clone(u,this._modelMatrix);var f=nt.default.multiplyByTranslation(this._modelMatrix,this._center,this._rtcTransform);this._mode!==Ve.a.SCENE3D&&(f=Mt.default.basisTo2D(e.mapProjection,f,f)),nt.default.getTranslation(f,this._boundingSphere.center)}a&&this._dirty&&(this._dynamic=!0,this._dirty=!1,s=tb(o=this),o._vertexBuffer.copyFromArrayView(s)),function(e){for(var t=e._nodeCommands,i=t.length,a=0;a<i;a++){if(t[a].command.dirty)return!0}return!1}(r)&&sb(this,a),!a&&(r.dirty||this._dirty||l||d)&&nb(this),function(e){if(e.shadows!==e._shadows){e._shadows=e.shadows;for(var t=ae.a.castShadows(e.shadows),i=ae.a.receiveShadows(e.shadows),a=e._drawCommands,r=a.length,n=0;n<r;++n){var o=a[n];o.castShadows=t,o.receiveShadows=i}}}(this),function(e){if(e._debugWireframe!==e.debugWireframe){e._debugWireframe=e.debugWireframe;for(var t=e.debugWireframe?Wi.a.LINES:Wi.a.TRIANGLES,i=e._drawCommands,a=i.length,r=0;r<a;++r)i[r].primitiveType=t}}(this),function(e){if(e.debugShowBoundingVolume!==e._debugShowBoundingVolume){e._debugShowBoundingVolume=e.debugShowBoundingVolume;for(var t=e._drawCommands,i=t.length,a=0;a<i;++a)t[a].debugShowBoundingVolume=e.debugShowBoundingVolume}}(this);var c=e.passes;if(c.render||c.pick)for(var h=e.commandList,p=this._drawCommands,m=p.length,_=0;_<m;++_)h.push(p[_])}}},Xv.prototype.isDestroyed=function(){return!1},Xv.prototype.destroy=function(){this._model=this._model&&this._model.destroy();var e=this._pickIds;if(Object(s.default)(e))for(var t=e.length,i=0;i<t;++i)e[i].destroy();return Object(l.default)(this)};var lb=Xv;function ub(e,t,i,a,r){this._tileset=e,this._tile=t,this._resource=i,this._modelInstanceCollection=void 0,this._batchTable=void 0,this._features=void 0,this.featurePropertiesDirty=!1,function(e,t,i){var a=Object(o.default)(i,0);i=a;var r=new Uint8Array(t),n=new DataView(t);i+=fb;var l=n.getUint32(i,!0);if(1!==l)throw new $f.default("Only Instanced 3D Model version 1 is supported. Version "+l+" is not.");i+=fb;var u=n.getUint32(i,!0);i+=fb;var d=n.getUint32(i,!0);if(0===d)throw new $f.default("featureTableJsonByteLength is zero, the feature table must be defined.");i+=fb;var f=n.getUint32(i,!0);i+=fb;var c=n.getUint32(i,!0);i+=fb;var h=n.getUint32(i,!0);i+=fb;var p=n.getUint32(i,!0);if(1!==p&&0!==p)throw new $f.default("Only glTF format 0 (uri) or 1 (embedded) are supported. Format "+p+" is not.");i+=fb;var m=Object(Of.a)(r,i,d),_=JSON.parse(m);i+=d;var g=new Uint8Array(t,i,f);i+=f;var b,y,O=new dg(_,g),w=O.getGlobalProperty("INSTANCES_LENGTH");if(O.featuresLength=w,!Object(s.default)(w))throw new $f.default("Feature table global property: INSTANCES_LENGTH must be defined");if(c>0){var x=Object(Of.a)(r,i,c);b=JSON.parse(x),i+=c,h>0&&(y=new Uint8Array(t,i,h),y=new Uint8Array(y),i+=h)}e._batchTable=new og(e,w,b,y);var E,T=a+u-i;if(0===T)throw new $f.default("glTF byte length is zero, i3dm must have a glTF to instance.");i%4==0?E=new Uint8Array(t,i,T):(ub._deprecationWarning("i3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),E=new Uint8Array(r.subarray(i,i+T)));var C=e._tileset,A={instances:new Array(w),batchTable:e._batchTable,cull:!1,url:void 0,requestType:E_.a.TILES3D,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,upAxis:C._gltfUpAxis,forwardAxis:hf.X,opaquePass:Lf.a.CESIUM_3D_TILE,pickIdLoaded:db(e),imageBasedLightingFactor:C.imageBasedLightingFactor,lightColor:C.lightColor,luminanceAtZenith:C.luminanceAtZenith,sphericalHarmonicCoefficients:C.sphericalHarmonicCoefficients,specularEnvironmentMaps:C.specularEnvironmentMaps,shadows:C.shadows};if(0===p){var j=Object(Of.a)(E);j=j.replace(/[\s\0]+$/,""),A.url=e._resource.getDerivedResource({url:j})}else A.gltf=E,A.basePath=e._resource.clone();var P,S=O.getGlobalProperty("EAST_NORTH_UP"),I=O.getGlobalProperty("RTC_CENTER",se.a.FLOAT,3);Object(s.default)(I)&&(P=v.default.unpack(I));for(var L=A.instances,D=new v.default,M=new Array(3),R=new v.default,N=new v.default,V=new v.default,B=new et.default,U=new Dt.default,F=new v.default,H=new kv.a,k=new nt.default,z=0;z<w;z++){var G=O.getProperty("POSITION",se.a.FLOAT,3,z,cb);if(!Object(s.default)(G)){G=M;var q=O.getProperty("POSITION_QUANTIZED",se.a.UNSIGNED_SHORT,3,z,cb);if(!Object(s.default)(q))throw new $f.default("Either POSITION or POSITION_QUANTIZED must be defined for each instance.");var W=O.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",se.a.FLOAT,3);if(!Object(s.default)(W))throw new $f.default("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");var Y=O.getGlobalProperty("QUANTIZED_VOLUME_SCALE",se.a.FLOAT,3);if(!Object(s.default)(Y))throw new $f.default("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(var K=0;K<3;K++)G[K]=q[K]/65535*Y[K]+W[K]}v.default.unpack(G,0,D),Object(s.default)(P)&&v.default.add(D,P,D),H.translation=D;var X=O.getProperty("NORMAL_UP",se.a.FLOAT,3,z,cb),Z=O.getProperty("NORMAL_RIGHT",se.a.FLOAT,3,z,hb),J=!1;if(Object(s.default)(X)){if(!Object(s.default)(Z))throw new $f.default("To define a custom orientation, both NORMAL_UP and NORMAL_RIGHT must be defined.");v.default.unpack(X,0,N),v.default.unpack(Z,0,R),J=!0}else{var Q=O.getProperty("NORMAL_UP_OCT32P",se.a.UNSIGNED_SHORT,2,z,cb),$=O.getProperty("NORMAL_RIGHT_OCT32P",se.a.UNSIGNED_SHORT,2,z,hb);if(Object(s.default)(Q)){if(!Object(s.default)($))throw new $f.default("To define a custom orientation with oct-encoded vectors, both NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P must be defined.");Hv.a.octDecodeInRange(Q[0],Q[1],65535,N),Hv.a.octDecodeInRange($[0],$[1],65535,R),J=!0}else S?(Mt.default.eastNorthUpToFixedFrame(D,tt.default.WGS84,k),nt.default.getMatrix3(k,B)):et.default.clone(et.default.IDENTITY,B)}J&&(v.default.cross(R,N,V),v.default.normalize(V,V),et.default.setColumn(B,0,R,B),et.default.setColumn(B,1,N,B),et.default.setColumn(B,2,V,B)),Dt.default.fromRotationMatrix(B,U),H.rotation=U,F=v.default.fromElements(1,1,1,F);var ee=O.getProperty("SCALE",se.a.FLOAT,1,z);Object(s.default)(ee)&&v.default.multiplyByScalar(F,ee,F);var te=O.getProperty("SCALE_NON_UNIFORM",se.a.FLOAT,3,z,cb);Object(s.default)(te)&&(F.x*=te[0],F.y*=te[1],F.z*=te[2]),H.scale=F;var ie=O.getProperty("BATCH_ID",se.a.UNSIGNED_SHORT,1,z);Object(s.default)(ie)||(ie=z),nt.default.fromTranslationRotationScale(H,k);var ae=k.clone();L[z]={modelMatrix:ae,batchId:ie}}e._modelInstanceCollection=new lb(A)}(this,a,r)}function db(e){return function(){return e._batchTable.getPickId()}}ub._deprecationWarning=m_.default,Object.defineProperties(ub.prototype,{featuresLength:{get:function(){return this._batchTable.featuresLength}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){var e=this._modelInstanceCollection._model;return Object(s.default)(e)?e.trianglesLength:0}},geometryByteLength:{get:function(){var e=this._modelInstanceCollection._model;return Object(s.default)(e)?e.geometryByteLength:0}},texturesByteLength:{get:function(){var e=this._modelInstanceCollection._model;return Object(s.default)(e)?e.texturesByteLength:0}},batchTableByteLength:{get:function(){return this._batchTable.memorySizeInBytes}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._modelInstanceCollection.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var fb=Uint32Array.BYTES_PER_ELEMENT,cb=new Array(4),hb=new Array(4);ub.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)},ub.prototype.getFeature=function(e){this.featuresLength;return function(e){var t=e.featuresLength;if(!Object(s.default)(e._features)&&t>0){for(var i=new Array(t),a=0;a<t;++a)i[a]=new sg.a(e,a);e._features=i}}(this),this._features[e]},ub.prototype.applyDebugSettings=function(e,t){t=e?t:b.default.WHITE,this._batchTable.setAllColor(t)},ub.prototype.applyStyle=function(e){this._batchTable.applyStyle(e)},ub.prototype.update=function(e,t){var i=t.commandList.length;this._batchTable.update(e,t),this._modelInstanceCollection.modelMatrix=this._tile.computedTransform,this._modelInstanceCollection.shadows=this._tileset.shadows,this._modelInstanceCollection.lightColor=this._tileset.lightColor,this._modelInstanceCollection.luminanceAtZenith=this._tileset.luminanceAtZenith,this._modelInstanceCollection.sphericalHarmonicCoefficients=this._tileset.sphericalHarmonicCoefficients,this._modelInstanceCollection.specularEnvironmentMaps=this._tileset.specularEnvironmentMaps,this._modelInstanceCollection.debugWireframe=this._tileset.debugWireframe;var a=this._modelInstanceCollection._model;if(Object(s.default)(a)){var r=this._tileset.clippingPlanes;a.clippingPlanesOriginMatrix=this._tileset.clippingPlanesOriginMatrix,Object(s.default)(r)&&this._tile.clippingPlanesDirty&&(a._clippingPlanes=r.enabled&&this._tile._isClipped?r:void 0),Object(s.default)(r)&&Object(s.default)(a._clippingPlanes)&&a._clippingPlanes!==r&&(a._clippingPlanes=r)}this._modelInstanceCollection.update(t),i<t.commandList.length&&(t.passes.render||t.passes.pick)&&this._batchTable.addDerivedCommands(t,i,!1)},ub.prototype.isDestroyed=function(){return!1},ub.prototype.destroy=function(){return this._modelInstanceCollection=this._modelInstanceCollection&&this._modelInstanceCollection.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Object(l.default)(this)};var pb=ub,mb=i(210),_b=0,gb=1,vb=2,bb=3;function yb(e){this._parsedContent=void 0,this._drawCommand=void 0,this._isTranslucent=!1,this._styleTranslucent=!1,this._constantColor=b.default.clone(b.default.DARKGRAY),this._highlightColor=b.default.clone(b.default.WHITE),this._pointSize=1,this._rtcCenter=void 0,this._quantizedVolumeScale=void 0,this._quantizedVolumeOffset=void 0,this._styleableShaderAttributes=void 0,this._isQuantized=!1,this._isOctEncoded16P=!1,this._isRGB565=!1,this._hasColors=!1,this._hasNormals=!1,this._hasBatchIds=!1,this._decodingState=vb,this._dequantizeInShader=!0,this._isQuantizedDraco=!1,this._isOctEncodedDraco=!1,this._quantizedRange=0,this._octEncodedRange=0,this.backFaceCulling=!1,this._backFaceCulling=!1,this.normalShading=!0,this._normalShading=!0,this._opaqueRenderState=void 0,this._translucentRenderState=void 0,this._mode=void 0,this._ready=!1,this._readyPromise=Ef.default.defer(),this._pointsLength=0,this._geometryByteLength=0,this._vertexShaderLoaded=e.vertexShaderLoaded,this._fragmentShaderLoaded=e.fragmentShaderLoaded,this._uniformMapLoaded=e.uniformMapLoaded,this._batchTableLoaded=e.batchTableLoaded,this._pickIdLoaded=e.pickIdLoaded,this._opaquePass=Object(o.default)(e.opaquePass,Lf.a.OPAQUE),this._cull=Object(o.default)(e.cull,!0),this.style=void 0,this._style=void 0,this.styleDirty=!1,this.modelMatrix=nt.default.clone(nt.default.IDENTITY),this._modelMatrix=nt.default.clone(nt.default.IDENTITY),this.time=0,this.shadows=ae.a.ENABLED,this._boundingSphere=void 0,this.clippingPlanes=void 0,this.isClipped=!1,this.clippingPlanesDirty=!1,this.clippingPlanesOriginMatrix=void 0,this.attenuation=!1,this._attenuation=!1,this.geometricError=0,this.geometricErrorScale=1,this.maximumAttenuation=this._pointSize,function(e,t){var i=t.arrayBuffer,a=Object(o.default)(t.byteOffset,0),r=new Uint8Array(i),n=new DataView(i);a+=Ob;var l=n.getUint32(a,!0);if(1!==l)throw new $f.default("Only Point Cloud tile version 1 is supported.  Version "+l+" is not.");a+=Ob,a+=Ob;var u=n.getUint32(a,!0);if(0===u)throw new $f.default("Feature table must have a byte length greater than zero");a+=Ob;var d=n.getUint32(a,!0);a+=Ob;var f=n.getUint32(a,!0);a+=Ob;var c=n.getUint32(a,!0);a+=Ob;var h=Object(Of.a)(r,a,u),p=JSON.parse(h);a+=u;var m,_,g=new Uint8Array(i,a,d);if(a+=d,f>0){var y=Object(Of.a)(r,a,f);m=JSON.parse(y),a+=f,c>0&&(_=new Uint8Array(i,a,c),a+=c)}var O=new dg(p,g),w=O.getGlobalProperty("POINTS_LENGTH");if(O.featuresLength=w,!Object(s.default)(w))throw new $f.default("Feature table global property: POINTS_LENGTH must be defined");var x,E,T,C,A=O.getGlobalProperty("RTC_CENTER",se.a.FLOAT,3);Object(s.default)(A)&&(e._rtcCenter=v.default.unpack(A));var j,P,S,I,L,D=!1,M=!1,R=!1,N=!1,V=!1,B=!1,U=!1,F=!1,H=Object(s.default)(p.extensions)?p.extensions["3DTILES_draco_point_compression"]:void 0,k=Object(s.default)(m)&&Object(s.default)(m.extensions)?m.extensions["3DTILES_draco_point_compression"]:void 0;Object(s.default)(k)&&(S=k.properties);if(Object(s.default)(H)){P=H.properties;var z=H.byteOffset,G=H.byteLength;if(!Object(s.default)(P)||!Object(s.default)(z)||!Object(s.default)(G))throw new $f.default("Draco properties, byteOffset, and byteLength must be defined");j=Object(Bc.a)(g,z,z+G),D=Object(s.default)(P.POSITION),M=Object(s.default)(P.RGB)||Object(s.default)(P.RGBA),R=Object(s.default)(P.NORMAL),N=Object(s.default)(P.BATCH_ID),B=Object(s.default)(P.RGBA),e._decodingState=_b}Object(s.default)(j)&&(I={buffer:j,featureTableProperties:P,batchTableProperties:S,properties:Object(gf.default)(P,S),dequantizeInShader:e._dequantizeInShader});if(!D)if(Object(s.default)(p.POSITION))x=O.getPropertyArray("POSITION",se.a.FLOAT,3),D=!0;else if(Object(s.default)(p.POSITION_QUANTIZED)){x=O.getPropertyArray("POSITION_QUANTIZED",se.a.UNSIGNED_SHORT,3),V=!0,D=!0;var q=O.getGlobalProperty("QUANTIZED_VOLUME_SCALE",se.a.FLOAT,3);if(!Object(s.default)(q))throw new $f.default("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");e._quantizedVolumeScale=v.default.unpack(q),e._quantizedRange=65535;var W=O.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",se.a.FLOAT,3);if(!Object(s.default)(W))throw new $f.default("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e._quantizedVolumeOffset=v.default.unpack(W)}M||(Object(s.default)(p.RGBA)?(E=O.getPropertyArray("RGBA",se.a.UNSIGNED_BYTE,4),B=!0,M=!0):Object(s.default)(p.RGB)?(E=O.getPropertyArray("RGB",se.a.UNSIGNED_BYTE,3),M=!0):Object(s.default)(p.RGB565)&&(E=O.getPropertyArray("RGB565",se.a.UNSIGNED_SHORT,1),U=!0,M=!0));R||(Object(s.default)(p.NORMAL)?(T=O.getPropertyArray("NORMAL",se.a.FLOAT,3),R=!0):Object(s.default)(p.NORMAL_OCT16P)&&(T=O.getPropertyArray("NORMAL_OCT16P",se.a.UNSIGNED_BYTE,2),F=!0,R=!0));N||Object(s.default)(p.BATCH_ID)&&(C=O.getPropertyArray("BATCH_ID",se.a.UNSIGNED_SHORT,1),N=!0);if(!D)throw new $f.default("Either POSITION or POSITION_QUANTIZED must be defined.");if(Object(s.default)(p.CONSTANT_RGBA)){var Y=O.getGlobalProperty("CONSTANT_RGBA",se.a.UNSIGNED_BYTE,4);e._constantColor=b.default.fromBytes(Y[0],Y[1],Y[2],Y[3],e._constantColor)}if(N){var K=O.getGlobalProperty("BATCH_LENGTH");if(!Object(s.default)(K))throw new $f.default("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");Object(s.default)(_)&&(_=new Uint8Array(_)),Object(s.default)(e._batchTableLoaded)&&e._batchTableLoaded(K,m,_)}!N&&Object(s.default)(_)&&(L=og.getBinaryProperties(w,m,_));e._parsedContent={positions:x,colors:E,normals:T,batchIds:C,styleableProperties:L,draco:I},e._pointsLength=w,e._isQuantized=V,e._isOctEncoded16P=F,e._isRGB565=U,e._isTranslucent=B,e._hasColors=M,e._hasNormals=R,e._hasBatchIds=N}(this,e)}Object.defineProperties(yb.prototype,{pointsLength:{get:function(){return this._pointsLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},color:{get:function(){return b.default.clone(this._highlightColor)},set:function(e){this._highlightColor=b.default.clone(e,this._highlightColor)}},boundingSphere:{get:function(){if(Object(s.default)(this._drawCommand))return this._drawCommand.boundingVolume},set:function(e){this._boundingSphere=r.default.clone(e,this._boundingSphere)}}});var Ob=Uint32Array.BYTES_PER_ELEMENT;var wb,xb=new v.default,Eb=new v.default,Tb=new v.default;function Cb(e){for(var t=e.length/3,i=Math.min(t,20),a=function(e){if(!Object(s.default)(wb)){Ne.default.setRandomNumberSeed(0),wb=new Array(e);for(var t=0;t<e;++t)wb[t]=Ne.default.nextRandomNumber()}return wb}(20),n=Number.MAX_VALUE,o=-Number.MAX_VALUE,l=v.default.fromElements(n,n,n,xb),u=v.default.fromElements(o,o,o,Eb),d=0;d<i;++d){var f=Math.floor(a[d]*t),c=v.default.unpack(e,3*f,Tb);v.default.minimumByComponent(l,c,l),v.default.maximumByComponent(u,c,u)}var h=r.default.fromCornerPoints(l,u);return h.radius+=Ne.default.EPSILON2,h}function Ab(e,t){var i=se.a.fromTypedArray(e);return i===se.a.INT||i===se.a.UNSIGNED_INT||i===se.a.DOUBLE?(Object(Oe.a)("Cast pnts property to floats",'Point cloud property "'+t+'" will be casted to a float array because INT, UNSIGNED_INT, and DOUBLE are not valid WebGL vertex attribute types. Some precision may be lost.'),new Float32Array(e)):e}var jb=new It.a,Pb=new It.a,Sb=new b.default,Ib=new nt.default;var Lb=["POSITION","COLOR","NORMAL","POSITION_ABSOLUTE"];function Db(e,t){for(var i=/czm_tiles3d_style_(\w+)/g,a=i.exec(e);null!==a;){var r=a[1];-1===t.indexOf(r)&&t.push(r),a=i.exec(e)}}function Mb(e,t){for(var i=e.numberOfAttributes,a=0;a<i;++a){var r=e.getAttribute(a);if(r.index===t)return r}}function Rb(e){for(var t=Lb.length,i=0;i<t;++i){var a=Lb[i],r="czm_tiles3d_style_"+a,n=a.toLowerCase();e=e.replace(new RegExp(r+"(\\W)","g"),n+"$1")}return e.replace("()","(vec3 position, vec3 position_absolute, vec4 color, vec3 normal)")}function Nb(e,t,i){var a,r,n,l,u,d,f=t.context,c=Object(s.default)(i),h=e._isQuantized,p=e._isQuantizedDraco,m=e._isOctEncoded16P,_=e._isOctEncodedDraco,g=e._isRGB565,y=e._isTranslucent,O=e._hasColors,w=e._hasNormals,x=e._hasBatchIds,E=e._backFaceCulling,T=e._normalShading,C=e._drawCommand.vertexArray,A=e.clippingPlanes,j=e._attenuation,P=y;if(c){var S={translucent:!1};l=i.getColorShaderFunction("getColorFromStyle","czm_tiles3d_style_",S),u=i.getShowShaderFunction("getShowFromStyle","czm_tiles3d_style_",S),d=i.getPointSizeShaderFunction("getPointSizeFromStyle","czm_tiles3d_style_",S),Object(s.default)(l)&&S.translucent&&(P=!0)}e._styleTranslucent=P;var I=Object(s.default)(l),L=Object(s.default)(u),D=Object(s.default)(d),M=e.isClipped,R=[];I&&(Db(l,R),l=Rb(l)),L&&(Db(u,R),u=Rb(u)),D&&(Db(d,R),d=Rb(d));var N=R.indexOf("COLOR")>=0,V=R.indexOf("NORMAL")>=0,B=R.filter((function(e){return-1===Lb.indexOf(e)}));if(V&&!w)throw new $f.default("Style references the NORMAL semantic but the point cloud does not have normals");var U=e._styleableShaderAttributes;for(r in U)if(U.hasOwnProperty(r)){n=U[r];var F=B.indexOf(r)>=0;Mb(C,n.location).enabled=F}var H=O&&(!I||N);O&&(Mb(C,1).enabled=H);var k=w&&(T||E||V);w&&(Mb(C,2).enabled=k);var z={a_position:0};H&&(z.a_color=1),k&&(z.a_normal=2),x&&(z.a_batchId=3);var G="",q=B.length;for(a=0;a<q;++a){if(n=U[r=B[a]],!Object(s.default)(n))throw new $f.default('Style references a property "'+r+'" that does not exist or is not styleable.');var W=n.componentCount,Y="czm_tiles3d_style_"+r;G+="attribute "+(1===W?"float":"vec"+W)+" "+Y+"; \n",z[Y]=n.location}!function(e,t){var i=t.context,a=e._isQuantized,r=e._isQuantizedDraco,n=e._isOctEncodedDraco,l={u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier:function(){var a=jb;if(a.x=e._attenuation?e.maximumAttenuation:e._pointSize,a.x*=t.pixelRatio,a.y=e.time,e._attenuation){var r,n=t.camera.frustum;r=t.mode===Ve.a.SCENE2D||n instanceof y_.a?Number.POSITIVE_INFINITY:i.drawingBufferHeight/t.camera.frustum.sseDenominator,a.z=e.geometricError*e.geometricErrorScale,a.w=r}return a},u_highlightColor:function(){return e._highlightColor},u_constantColor:function(){return e._constantColor},u_clippingPlanes:function(){var t=e.clippingPlanes;return e.isClipped?t.texture:i.defaultTexture},u_clippingPlanesEdgeStyle:function(){var t=e.clippingPlanes;if(!Object(s.default)(t))return b.default.TRANSPARENT;var i=b.default.clone(t.edgeColor,Sb);return i.alpha=t.edgeWidth,i},u_clippingPlanesMatrix:function(){var t=e.clippingPlanes;if(!Object(s.default)(t))return nt.default.IDENTITY;var a=Object(o.default)(e.clippingPlanesOriginMatrix,e._modelMatrix);return nt.default.multiply(i.uniformState.view3D,a,Ib),nt.default.multiply(Ib,t.modelMatrix,Ib)}};(a||r||n)&&(l=Object(gf.default)(l,{u_quantizedVolumeScaleAndOctEncodedRange:function(){var t=Pb;if(Object(s.default)(e._quantizedVolumeScale)){var i=v.default.clone(e._quantizedVolumeScale,t);v.default.divideByScalar(i,e._quantizedRange,t)}return t.w=e._octEncodedRange,t}})),Object(s.default)(e._uniformMapLoaded)&&(l=e._uniformMapLoaded(l)),e._drawCommand.uniformMap=l}(e,t);var K="attribute vec3 a_position; \nvarying vec4 v_color; \nuniform vec4 u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier; \nuniform vec4 u_constantColor; \nuniform vec4 u_highlightColor; \n";K+="float u_pointSize; \nfloat u_time; \n",j&&(K+="float u_geometricError; \nfloat u_depthMultiplier; \n"),K+=G,H&&(K+=y?"attribute vec4 a_color; \n":g?"attribute float a_color; \nconst float SHIFT_RIGHT_11 = 1.0 / 2048.0; \nconst float SHIFT_RIGHT_5 = 1.0 / 32.0; \nconst float SHIFT_LEFT_11 = 2048.0; \nconst float SHIFT_LEFT_5 = 32.0; \nconst float NORMALIZE_6 = 1.0 / 64.0; \nconst float NORMALIZE_5 = 1.0 / 32.0; \n":"attribute vec3 a_color; \n"),k&&(K+=m||_?"attribute vec2 a_normal; \n":"attribute vec3 a_normal; \n"),x&&(K+="attribute float a_batchId; \n"),(h||p||_)&&(K+="uniform vec4 u_quantizedVolumeScaleAndOctEncodedRange; \n"),I&&(K+=l),L&&(K+=u),D&&(K+=d),K+="void main() \n{ \n    u_pointSize = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.x; \n    u_time = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.y; \n",j&&(K+="    u_geometricError = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.z; \n    u_depthMultiplier = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.w; \n"),K+=H?y?"    vec4 color = a_color; \n":g?"    float compressed = a_color; \n    float r = floor(compressed * SHIFT_RIGHT_11); \n    compressed -= r * SHIFT_LEFT_11; \n    float g = floor(compressed * SHIFT_RIGHT_5); \n    compressed -= g * SHIFT_LEFT_5; \n    float b = compressed; \n    vec3 rgb = vec3(r * NORMALIZE_5, g * NORMALIZE_6, b * NORMALIZE_5); \n    vec4 color = vec4(rgb, 1.0); \n":"    vec4 color = vec4(a_color, 1.0); \n":"    vec4 color = u_constantColor; \n",K+=h||p?"    vec3 position = a_position * u_quantizedVolumeScaleAndOctEncodedRange.xyz; \n":"    vec3 position = a_position; \n",K+="    vec3 position_absolute = vec3(czm_model * vec4(position, 1.0)); \n",k?(K+=m?"    vec3 normal = czm_octDecode(a_normal); \n":_?"    vec3 normal = czm_octDecode(a_normal, u_quantizedVolumeScaleAndOctEncodedRange.w).zxy; \n":"    vec3 normal = a_normal; \n",K+="    vec3 normalEC = czm_normal * normal; \n"):K+="    vec3 normal = vec3(1.0); \n",I&&(K+="    color = getColorFromStyle(position, position_absolute, color, normal); \n"),L&&(K+="    float show = float(getShowFromStyle(position, position_absolute, color, normal)); \n"),K+=D?"    gl_PointSize = getPointSizeFromStyle(position, position_absolute, color, normal) * czm_pixelRatio; \n":j?"    vec4 positionEC = czm_modelView * vec4(position, 1.0); \n    float depth = -positionEC.z; \n    gl_PointSize = min((u_geometricError / depth) * u_depthMultiplier, u_pointSize); \n":"    gl_PointSize = u_pointSize; \n",K+="    color = color * u_highlightColor; \n",k&&T&&(K+="    float diffuseStrength = czm_getLambertDiffuse(czm_lightDirectionEC, normalEC); \n    diffuseStrength = max(diffuseStrength, 0.4); \n    color.xyz *= diffuseStrength * czm_lightColor; \n"),K+="    v_color = color; \n    gl_Position = czm_modelViewProjection * vec4(position, 1.0); \n",k&&E&&(K+="    float visible = step(-normalEC.z, 0.0); \n    gl_Position *= visible; \n    gl_PointSize *= visible; \n"),L&&(K+="    gl_Position.w *= float(show); \n    gl_PointSize *= float(show); \n"),K+="} \n";var X="varying vec4 v_color; \n";M&&(X+="uniform sampler2D u_clippingPlanes; \nuniform mat4 u_clippingPlanesMatrix; \nuniform vec4 u_clippingPlanesEdgeStyle; \n",X+="\n",X+=Object(Wc.a)(A,f),X+="\n"),X+="void main() \n{ \n    gl_FragColor = czm_gammaCorrect(v_color); \n",M&&(X+=qc("u_clippingPlanes","u_clippingPlanesMatrix","u_clippingPlanesEdgeStyle")),X+="} \n",Object(s.default)(e._vertexShaderLoaded)&&(K=e._vertexShaderLoaded(K)),Object(s.default)(e._fragmentShaderLoaded)&&(X=e._fragmentShaderLoaded(X));var Z=e._drawCommand;Object(s.default)(Z.shaderProgram)&&Z.shaderProgram.destroy(),Z.shaderProgram=Rf.a.fromCache({context:f,vertexShaderSource:K,fragmentShaderSource:X,attributeLocations:z});try{Z.shaderProgram._bind()}catch(e){throw new $f.default("Error generating style shader: this may be caused by a type mismatch, index out-of-bounds, or other syntax error.")}}var Vb=new It.a,Bb=new v.default;yb.prototype.update=function(e){if(!function(e,t){if(e._decodingState===vb)return!1;if(e._decodingState===_b){var i=e._parsedContent,a=i.draco,r=Gc.decodePointCloud(a,t);Object(s.default)(r)&&(e._decodingState=gb,r.then((function(t){e._decodingState=vb;var r=Object(s.default)(t.POSITION)?t.POSITION.array:void 0,n=Object(s.default)(t.RGB)?t.RGB.array:void 0,l=Object(s.default)(t.RGBA)?t.RGBA.array:void 0,u=Object(s.default)(t.NORMAL)?t.NORMAL.array:void 0,d=Object(s.default)(t.BATCH_ID)?t.BATCH_ID.array:void 0,f=Object(s.default)(r)&&Object(s.default)(t.POSITION.data.quantization),c=Object(s.default)(u)&&Object(s.default)(t.NORMAL.data.quantization);if(f){var h=t.POSITION.data.quantization,p=h.range;e._quantizedVolumeScale=v.default.fromElements(p,p,p),e._quantizedVolumeOffset=v.default.unpack(h.minValues),e._quantizedRange=(1<<h.quantizationBits)-1,e._isQuantizedDraco=!0}c&&(e._octEncodedRange=(1<<t.NORMAL.data.quantization.quantizationBits)-1,e._isOctEncodedDraco=!0);var m=i.styleableProperties,_=a.batchTableProperties;for(var g in _)if(_.hasOwnProperty(g)){var b=t[g];Object(s.default)(m)||(m={}),m[g]={typedArray:b.array,componentCount:b.data.componentsPerAttribute}}i.positions=Object(o.default)(r,i.positions),i.colors=Object(o.default)(Object(o.default)(l,n),i.colors),i.normals=Object(o.default)(u,i.normals),i.batchIds=Object(o.default)(d,i.batchIds),i.styleableProperties=m})).otherwise((function(t){e._decodingState=bb,e._readyPromise.reject(t)})))}return!0}(this,e.context)){var t=!1,i=!nt.default.equals(this._modelMatrix,this.modelMatrix);if(this._mode!==e.mode&&(this._mode=e.mode,i=!0),Object(s.default)(this._drawCommand)||(!function(e,t){var i,a,n=t.context,o=e._parsedContent,l=e._pointsLength,u=o.positions,d=o.colors,f=o.normals,c=o.batchIds,h=o.styleableProperties,p=Object(s.default)(h),m=e._isQuantized,_=e._isQuantizedDraco,g=e._isOctEncoded16P,b=e._isOctEncodedDraco,y=e._quantizedRange,O=e._octEncodedRange,w=e._isRGB565,x=e._isTranslucent,E=e._hasColors,T=e._hasNormals,C=e._hasBatchIds,A=[],j={};if(e._styleableShaderAttributes=j,p){var P=4;for(var S in h)if(h.hasOwnProperty(S)){var I=h[S],L=Ab(I.typedArray,S);i=I.componentCount,a=se.a.fromTypedArray(L);var D=Pf.a.createVertexBuffer({context:n,typedArray:L,usage:Sf.a.STATIC_DRAW});e._geometryByteLength+=D.sizeInBytes;var M={index:P,vertexBuffer:D,componentsPerAttribute:i,componentDatatype:a,normalize:!1,offsetInBytes:0,strideInBytes:0};A.push(M),j[S]={location:P,componentCount:i},++P}}var R,N,V,B=Pf.a.createVertexBuffer({context:n,typedArray:u,usage:Sf.a.STATIC_DRAW});e._geometryByteLength+=B.sizeInBytes,E&&(R=Pf.a.createVertexBuffer({context:n,typedArray:d,usage:Sf.a.STATIC_DRAW}),e._geometryByteLength+=R.sizeInBytes),T&&(N=Pf.a.createVertexBuffer({context:n,typedArray:f,usage:Sf.a.STATIC_DRAW}),e._geometryByteLength+=N.sizeInBytes),C&&(c=Ab(c,"batchIds"),V=Pf.a.createVertexBuffer({context:n,typedArray:c,usage:Sf.a.STATIC_DRAW}),e._geometryByteLength+=V.sizeInBytes);var U=[];if(a=m?se.a.UNSIGNED_SHORT:_?y<=255?se.a.UNSIGNED_BYTE:se.a.UNSIGNED_SHORT:se.a.FLOAT,U.push({index:0,vertexBuffer:B,componentsPerAttribute:3,componentDatatype:a,normalize:!1,offsetInBytes:0,strideInBytes:0}),e._cull&&(e._boundingSphere=m||_?r.default.fromCornerPoints(v.default.ZERO,e._quantizedVolumeScale):Cb(u)),E)if(w)U.push({index:1,vertexBuffer:R,componentsPerAttribute:1,componentDatatype:se.a.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0});else{var F=x?4:3;U.push({index:1,vertexBuffer:R,componentsPerAttribute:F,componentDatatype:se.a.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0})}T&&(g?(i=2,a=se.a.UNSIGNED_BYTE):b?(i=2,a=O<=255?se.a.UNSIGNED_BYTE:se.a.UNSIGNED_SHORT):(i=3,a=se.a.FLOAT),U.push({index:2,vertexBuffer:N,componentsPerAttribute:i,componentDatatype:a,normalize:!1,offsetInBytes:0,strideInBytes:0})),C&&U.push({index:3,vertexBuffer:V,componentsPerAttribute:1,componentDatatype:se.a.fromTypedArray(c),normalize:!1,offsetInBytes:0,strideInBytes:0}),p&&(U=U.concat(A));var H=new Ff.a({context:n,attributes:U}),k={depthTest:{enabled:!0}};e._opaquePass===Lf.a.CESIUM_3D_TILE&&(k.stencilTest=L_.a.setCesium3DTileBit(),k.stencilMask=L_.a.CESIUM_3D_TILE_MASK),e._opaqueRenderState=Df.a.fromCache(k),e._translucentRenderState=Df.a.fromCache({depthTest:{enabled:!0},depthMask:!1,blending:Rc.a.ALPHA_BLEND}),e._drawCommand=new If.a({boundingVolume:new r.default,cull:e._cull,modelMatrix:new nt.default,primitiveType:Wi.a.POINTS,vertexArray:H,count:l,shaderProgram:void 0,uniformMap:void 0,renderState:x?e._translucentRenderState:e._opaqueRenderState,pass:x?Lf.a.TRANSLUCENT:e._opaquePass,owner:e,castShadows:!1,receiveShadows:!1,pickId:e._pickIdLoaded()})}(this,e),i=!0,t=!0,this._ready=!0,this._readyPromise.resolve(this),this._parsedContent=void 0),i){nt.default.clone(this.modelMatrix,this._modelMatrix);var a=this._drawCommand.modelMatrix;if(nt.default.clone(this._modelMatrix,a),Object(s.default)(this._rtcCenter)&&nt.default.multiplyByTranslation(a,this._rtcCenter,a),Object(s.default)(this._quantizedVolumeOffset)&&nt.default.multiplyByTranslation(a,this._quantizedVolumeOffset,a),e.mode!==Ve.a.SCENE3D){var n=e.mapProjection,l=nt.default.getColumn(a,3,Vb);It.a.equals(l,It.a.UNIT_W)||Mt.default.basisTo2D(n,a,a)}var u=this._drawCommand.boundingVolume;if(r.default.clone(this._boundingSphere,u),this._cull){var d=u.center;nt.default.multiplyByPoint(a,d,d);var f=nt.default.getScale(a,Bb);u.radius*=v.default.maximumComponent(f)}}this.clippingPlanesDirty&&(this.clippingPlanesDirty=!1,t=!0),this._attenuation!==this.attenuation&&(this._attenuation=this.attenuation,t=!0),this.backFaceCulling!==this._backFaceCulling&&(this._backFaceCulling=this.backFaceCulling,t=!0),this.normalShading!==this._normalShading&&(this._normalShading=this.normalShading,t=!0),(this._style!==this.style||this.styleDirty)&&(this._style=this.style,this.styleDirty=!1,t=!0),t&&Nb(this,e,this._style),this._drawCommand.castShadows=ae.a.castShadows(this.shadows),this._drawCommand.receiveShadows=ae.a.receiveShadows(this.shadows);var c=this._highlightColor.alpha<1||this._constantColor.alpha<1||this._styleTranslucent;this._drawCommand.renderState=c?this._translucentRenderState:this._opaqueRenderState,this._drawCommand.pass=c?Lf.a.TRANSLUCENT:this._opaquePass;var h=e.commandList,p=e.passes;(p.render||p.pick)&&h.push(this._drawCommand)}},yb.prototype.isDestroyed=function(){return!1},yb.prototype.destroy=function(){var e=this._drawCommand;return Object(s.default)(e)&&(e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy()),Object(l.default)(this)};var Ub=yb,Fb=i(68);function Hb(){this._framebuffer=void 0,this._colorGBuffer=void 0,this._depthGBuffer=void 0,this._depthTexture=void 0,this._drawCommand=void 0,this._clearCommand=void 0,this._strength=1,this._radius=1}function kb(e){var t=e._framebuffer;Object(s.default)(t)&&(e._colorGBuffer.destroy(),e._depthGBuffer.destroy(),e._depthTexture.destroy(),t.destroy(),e._framebuffer=void 0,e._colorGBuffer=void 0,e._depthGBuffer=void 0,e._depthTexture=void 0,e._drawCommand=void 0,e._clearCommand=void 0)}var zb=new g.default;function Gb(e,t){var i=t.drawingBufferWidth,a=t.drawingBufferHeight,r=e._colorGBuffer,n=!1,o=Object(s.default)(r)&&(r.width!==i||r.height!==a);return Object(s.default)(r)&&!o||(kb(e),function(e,t){var i=t.drawingBufferWidth,a=t.drawingBufferHeight,r=new Vf.a({context:t,width:i,height:a,pixelFormat:Af.a.RGBA,pixelDatatype:C_.a.UNSIGNED_BYTE,sampler:Mf.a.NEAREST}),n=new Vf.a({context:t,width:i,height:a,pixelFormat:Af.a.RGBA,pixelDatatype:C_.a.UNSIGNED_BYTE,sampler:Mf.a.NEAREST}),o=new Vf.a({context:t,width:i,height:a,pixelFormat:Af.a.DEPTH_COMPONENT,pixelDatatype:C_.a.UNSIGNED_INT,sampler:Mf.a.NEAREST});e._framebuffer=new Fb.a({context:t,colorTextures:[r,n],depthTexture:o,destroyAttachments:!1}),e._colorGBuffer=r,e._depthGBuffer=n,e._depthTexture=o}(e,t),function(e,t){var i={u_pointCloud_colorGBuffer:function(){return e._colorGBuffer},u_pointCloud_depthGBuffer:function(){return e._depthGBuffer},u_distanceAndEdlStrength:function(){return zb.x=e._radius,zb.y=e._strength,zb}},a=Df.a.fromCache({blending:Rc.a.ALPHA_BLEND,depthMask:!0,depthTest:{enabled:!0},stencilTest:L_.a.setCesium3DTileBit(),stencilMask:L_.a.CESIUM_3D_TILE_MASK});e._drawCommand=t.createViewportQuadCommand("#extension GL_EXT_frag_depth : enable\n\nuniform sampler2D u_pointCloud_colorGBuffer;\nuniform sampler2D u_pointCloud_depthGBuffer;\nuniform vec2 u_distanceAndEdlStrength;\nvarying vec2 v_textureCoordinates;\n\nvec2 neighborContribution(float log2Depth, vec2 offset)\n{\n    float dist = u_distanceAndEdlStrength.x;\n    vec2 texCoordOrig = v_textureCoordinates + offset * dist;\n    vec2 texCoord0 = v_textureCoordinates + offset * floor(dist);\n    vec2 texCoord1 = v_textureCoordinates + offset * ceil(dist);\n\n    float depthOrLogDepth0 = czm_unpackDepth(texture2D(u_pointCloud_depthGBuffer, texCoord0));\n    float depthOrLogDepth1 = czm_unpackDepth(texture2D(u_pointCloud_depthGBuffer, texCoord1));\n\n    // ignore depth values that are the clear depth\n    if (depthOrLogDepth0 == 0.0 || depthOrLogDepth1 == 0.0) {\n        return vec2(0.0);\n    }\n\n    // interpolate the two adjacent depth values\n    float depthMix = mix(depthOrLogDepth0, depthOrLogDepth1, fract(dist));\n    vec4 eyeCoordinate = czm_windowToEyeCoordinates(texCoordOrig, depthMix);\n    return vec2(max(0.0, log2Depth - log2(-eyeCoordinate.z / eyeCoordinate.w)), 1.0);\n}\n\nvoid main()\n{\n    float depthOrLogDepth = czm_unpackDepth(texture2D(u_pointCloud_depthGBuffer, v_textureCoordinates));\n\n    vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, depthOrLogDepth);\n    eyeCoordinate /= eyeCoordinate.w;\n\n    float log2Depth = log2(-eyeCoordinate.z);\n\n    if (depthOrLogDepth == 0.0) // 0.0 is the clear value for the gbuffer\n    {\n        discard;\n    }\n\n    vec4 color = texture2D(u_pointCloud_colorGBuffer, v_textureCoordinates);\n\n    // sample from neighbors left, right, down, up\n    vec2 texelSize = 1.0 / czm_viewport.zw;\n\n    vec2 responseAndCount = vec2(0.0);\n\n    responseAndCount += neighborContribution(log2Depth, vec2(-texelSize.x, 0.0));\n    responseAndCount += neighborContribution(log2Depth, vec2(+texelSize.x, 0.0));\n    responseAndCount += neighborContribution(log2Depth, vec2(0.0, -texelSize.y));\n    responseAndCount += neighborContribution(log2Depth, vec2(0.0, +texelSize.y));\n\n    float response = responseAndCount.x / responseAndCount.y;\n    float strength = u_distanceAndEdlStrength.y;\n    float shade = exp(-response * 300.0 * strength);\n    color.rgb *= shade;\n    gl_FragColor = vec4(color);\n\n#ifdef LOG_DEPTH\n    czm_writeLogDepth(1.0 + (czm_projection * vec4(eyeCoordinate.xyz, 1.0)).w);\n#else\n    gl_FragDepthEXT = czm_eyeToWindowCoordinates(vec4(eyeCoordinate.xyz, 1.0)).z;\n#endif\n}\n",{uniformMap:i,renderState:a,pass:Lf.a.CESIUM_3D_TILE,owner:e}),e._clearCommand=new g_.a({framebuffer:e._framebuffer,color:new b.default(0,0,0,0),depth:1,renderState:Df.a.fromCache(),pass:Lf.a.CESIUM_3D_TILE,owner:e})}(e,t),n=!0),n}function qb(e){return e.drawBuffers&&e.fragmentDepth}function Wb(e,t){var i=e.shaderCache.getDerivedShaderProgram(t,"EC");if(!Object(s.default)(i)){var a=t._attributeLocations,r=t.fragmentShaderSource.clone();r.sources=r.sources.map((function(e){return e=(e=Nf.a.replaceMain(e,"czm_point_cloud_post_process_main")).replace(/gl_FragColor/g,"gl_FragData[0]")})),r.sources.unshift("#extension GL_EXT_draw_buffers : enable \n"),r.sources.push("void main() \n{ \n    czm_point_cloud_post_process_main(); \n#ifdef LOG_DEPTH\n    czm_writeLogDepth();\n    gl_FragData[1] = czm_packDepth(gl_FragDepthEXT); \n#else\n    gl_FragData[1] = czm_packDepth(gl_FragCoord.z);\n#endif\n}"),i=e.shaderCache.createDerivedShaderProgram(t,"EC",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:r,attributeLocations:a})}return i}Hb.isSupported=qb,Hb.prototype.update=function(e,t,i,a){if(qb(e.context)){this._strength=i.eyeDomeLightingStrength,this._radius=i.eyeDomeLightingRadius*e.pixelRatio;var r,n=Gb(this,e.context),o=e.commandList,l=o.length;for(r=t;r<l;++r){var u=o[r];if(u.primitiveType===Wi.a.POINTS&&u.pass!==Lf.a.TRANSLUCENT){var d=u.derivedCommands.pointCloudProcessor;(!Object(s.default)(d)||u.dirty||n||d.framebuffer!==this._framebuffer)&&(d=If.a.shallowClone(u),u.derivedCommands.pointCloudProcessor=d,d.framebuffer=this._framebuffer,d.shaderProgram=Wb(e.context,u.shaderProgram),d.castShadows=!1,d.receiveShadows=!1),o[r]=d}}var f=this._clearCommand,c=this._drawCommand;c.boundingVolume=a,o.push(c),o.push(f)}},Hb.prototype.isDestroyed=function(){return!1},Hb.prototype.destroy=function(){return kb(this),Object(l.default)(this)};var Yb=Hb;function Kb(e){var t=Object(o.default)(e,{});this.attenuation=Object(o.default)(t.attenuation,!1),this.geometricErrorScale=Object(o.default)(t.geometricErrorScale,1),this.maximumAttenuation=t.maximumAttenuation,this.baseResolution=t.baseResolution,this.eyeDomeLighting=Object(o.default)(t.eyeDomeLighting,!0),this.eyeDomeLightingStrength=Object(o.default)(t.eyeDomeLightingStrength,1),this.eyeDomeLightingRadius=Object(o.default)(t.eyeDomeLightingRadius,1),this.backFaceCulling=Object(o.default)(t.backFaceCulling,!1),this.normalShading=Object(o.default)(t.normalShading,!0)}Kb.isSupported=function(e){return Yb.isSupported(e.context)};var Xb=Kb;function Zb(e,t,i,a,r){var n;this._tileset=e,this._tile=t,this._resource=i,this._pickId=void 0,this._batchTable=void 0,this._styleDirty=!1,this._features=void 0,this.featurePropertiesDirty=!1,this._pointCloud=new Ub({arrayBuffer:a,byteOffset:r,cull:!1,opaquePass:Lf.a.CESIUM_3D_TILE,vertexShaderLoaded:(n=this,function(e){return Object(s.default)(n._batchTable)?n._batchTable.getVertexShaderCallback(!1,"a_batchId",void 0)(e):e}),fragmentShaderLoaded:Jb(this),uniformMapLoaded:Qb(this),batchTableLoaded:$b(this),pickIdLoaded:ey(this)})}function Jb(e){return function(t){return Object(s.default)(e._batchTable)?e._batchTable.getFragmentShaderCallback(!1,void 0)(t):"uniform vec4 czm_pickColor;\n"+t}}function Qb(e){return function(t){return Object(s.default)(e._batchTable)?e._batchTable.getUniformMapCallback()(t):Object(gf.default)(t,{czm_pickColor:function(){return e._pickId.color}})}}function $b(e){return function(t,i,a){e._batchTable=new og(e,t,i,a)}}function ey(e){return function(){return Object(s.default)(e._batchTable)?e._batchTable.getPickId():"czm_pickColor"}}Object.defineProperties(Zb.prototype,{featuresLength:{get:function(){return Object(s.default)(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return this._pointCloud.pointsLength}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return this._pointCloud.geometryByteLength}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return Object(s.default)(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._pointCloud.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}}),Zb.prototype.hasProperty=function(e,t){return!!Object(s.default)(this._batchTable)&&this._batchTable.hasProperty(e,t)},Zb.prototype.getFeature=function(e){if(Object(s.default)(this._batchTable)){this.featuresLength;return function(e){var t=e.featuresLength;if(!Object(s.default)(e._features)&&t>0){for(var i=new Array(t),a=0;a<t;++a)i[a]=new sg.a(e,a);e._features=i}}(this),this._features[e]}},Zb.prototype.applyDebugSettings=function(e,t){this._pointCloud.color=e?t:b.default.WHITE},Zb.prototype.applyStyle=function(e){Object(s.default)(this._batchTable)?this._batchTable.applyStyle(e):this._styleDirty=!0};var ty=new Xb;Zb.prototype.update=function(e,t){var i,a=this._pointCloud,r=Object(o.default)(e.pointCloudShading,ty),n=this._tile,l=this._batchTable,u=t.mode,d=e.clippingPlanes;Object(s.default)(this._pickId)||Object(s.default)(l)||(this._pickId=t.context.createPickId({primitive:e,content:this})),Object(s.default)(l)&&l.update(e,t),i=Object(s.default)(n._contentBoundingVolume)?u===Ve.a.SCENE3D?n._contentBoundingVolume.boundingSphere:n._contentBoundingVolume2D.boundingSphere:u===Ve.a.SCENE3D?n._boundingVolume.boundingSphere:n._boundingVolume2D.boundingSphere;var f=this._styleDirty;this._styleDirty=!1,a.clippingPlanesOriginMatrix=e.clippingPlanesOriginMatrix,a.style=Object(s.default)(l)?void 0:e.style,a.styleDirty=f,a.modelMatrix=n.computedTransform,a.time=e.timeSinceLoad,a.shadows=e.shadows,a.boundingSphere=i,a.clippingPlanes=d,a.isClipped=Object(s.default)(d)&&d.enabled&&n._isClipped,a.clippingPlanesDirty=n.clippingPlanesDirty,a.attenuation=r.attenuation,a.backFaceCulling=r.backFaceCulling,a.normalShading=r.normalShading,a.geometricError=function(e){var t=e._tileset.pointCloudShading,i=e._tile.contentBoundingVolume.boundingSphere.volume(),a=Ne.default.cbrt(i/e.pointsLength),r=e._tile.geometricError;return 0===r&&(r=Object(s.default)(t)&&Object(s.default)(t.baseResolution)?t.baseResolution:a),r}(this),a.geometricErrorScale=r.geometricErrorScale,Object(s.default)(r)&&Object(s.default)(r.maximumAttenuation)?a.maximumAttenuation=r.maximumAttenuation:n.refine===mb.a.ADD?a.maximumAttenuation=5:a.maximumAttenuation=e.maximumScreenSpaceError,a.update(t)},Zb.prototype.isDestroyed=function(){return!1},Zb.prototype.destroy=function(){return this._pickId=this._pickId&&this._pickId.destroy(),this._pointCloud=this._pointCloud&&this._pointCloud.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Object(l.default)(this)};var iy=Zb;function ay(e,t,i,a,r){this._tileset=e,this._tile=t,this._resource=i,this._readyPromise=Ef.default.defer(),this.featurePropertiesDirty=!1,function(e,t,i){i=Object(o.default)(i,0);var a,r=new Uint8Array(t),n=Object(Of.a)(r,i);try{a=JSON.parse(n)}catch(t){return void e._readyPromise.reject(new $f.default("Invalid tile content."))}e._tileset.loadTileset(e._resource,a,e._tile),e._readyPromise.resolve(e)}(this,a,r)}Object.defineProperties(ay.prototype,{featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){}}}),ay.prototype.hasProperty=function(e,t){return!1},ay.prototype.getFeature=function(e){},ay.prototype.applyDebugSettings=function(e,t){},ay.prototype.applyStyle=function(e){},ay.prototype.update=function(e,t){},ay.prototype.isDestroyed=function(){return!1},ay.prototype.destroy=function(){return Object(l.default)(this)};var ry=ay,ny=i(310);var oy=function(e,t,i,a,r){return function(){var n=document.createElement("canvas"),o=r+2*a;n.height=n.width=o;var s=n.getContext("2d");return s.clearRect(0,0,o,o),0!==a&&(s.beginPath(),s.arc(o/2,o/2,o/2,0,2*Math.PI,!0),s.closePath(),s.fillStyle=i,s.fill(),e<1&&(s.save(),s.globalCompositeOperation="destination-out",s.beginPath(),s.arc(o/2,o/2,r/2,0,2*Math.PI,!0),s.closePath(),s.fillStyle="black",s.fill(),s.restore())),s.beginPath(),s.arc(o/2,o/2,r/2,0,2*Math.PI,!0),s.closePath(),s.fillStyle=t,s.fill(),n}};function sy(e,t,i,a,r){this._content=e,this._billboard=i,this._label=a,this._polyline=r,this._batchId=t,this._billboardImage=void 0,this._billboardColor=void 0,this._billboardOutlineColor=void 0,this._billboardOutlineWidth=void 0,this._billboardSize=void 0,this._pointSize=void 0,this._color=void 0,this._pointSize=void 0,this._pointOutlineColor=void 0,this._pointOutlineWidth=void 0,this._heightOffset=void 0,this._pickIds=new Array(3),uy(this)}var ly=new Re.default;function uy(e){var t=e._billboard;if(Object(s.default)(e._billboardImage)&&e._billboardImage!==t.image)t.image=e._billboardImage;else if(!Object(s.default)(e._billboardImage)){var i=Object(o.default)(e._color,sy.defaultColor),a=Object(o.default)(e._pointOutlineColor,sy.defaultPointOutlineColor),r=Object(o.default)(e._pointOutlineWidth,sy.defaultPointOutlineWidth),n=Object(o.default)(e._pointSize,sy.defaultPointSize),l=e._billboardColor,u=e._billboardOutlineColor,d=e._billboardOutlineWidth,f=e._billboardSize;if(!b.default.equals(i,l)||!b.default.equals(a,u)||r!==d||n!==f){e._billboardColor=b.default.clone(i,e._billboardColor),e._billboardOutlineColor=b.default.clone(a,e._billboardOutlineColor),e._billboardOutlineWidth=r,e._billboardSize=n;var c=i.alpha,h=i.toCssColorString(),p=a.toCssColorString(),m=JSON.stringify([h,n,p,r]);t.setImage(m,oy(c,h,p,r,n))}}}Object.defineProperties(sy.prototype,{show:{get:function(){return this._label.show},set:function(e){this._label.show=e,this._billboard.show=e,this._polyline.show=e}},color:{get:function(){return this._color},set:function(e){this._color=b.default.clone(e,this._color),uy(this)}},pointSize:{get:function(){return this._pointSize},set:function(e){this._pointSize=e,uy(this)}},pointOutlineColor:{get:function(){return this._pointOutlineColor},set:function(e){this._pointOutlineColor=b.default.clone(e,this._pointOutlineColor),uy(this)}},pointOutlineWidth:{get:function(){return this._pointOutlineWidth},set:function(e){this._pointOutlineWidth=e,uy(this)}},labelColor:{get:function(){return this._label.fillColor},set:function(e){this._label.fillColor=e,this._polyline.show=this._label.show&&e.alpha>0}},labelOutlineColor:{get:function(){return this._label.outlineColor},set:function(e){this._label.outlineColor=e}},labelOutlineWidth:{get:function(){return this._label.outlineWidth},set:function(e){this._label.outlineWidth=e}},font:{get:function(){return this._label.font},set:function(e){this._label.font=e}},labelStyle:{get:function(){return this._label.style},set:function(e){this._label.style=e}},labelText:{get:function(){return this._label.text},set:function(e){Object(s.default)(e)||(e=""),this._label.text=e}},backgroundColor:{get:function(){return this._label.backgroundColor},set:function(e){this._label.backgroundColor=e}},backgroundPadding:{get:function(){return this._label.backgroundPadding},set:function(e){this._label.backgroundPadding=e}},backgroundEnabled:{get:function(){return this._label.showBackground},set:function(e){this._label.showBackground=e}},scaleByDistance:{get:function(){return this._label.scaleByDistance},set:function(e){this._label.scaleByDistance=e,this._billboard.scaleByDistance=e}},translucencyByDistance:{get:function(){return this._label.translucencyByDistance},set:function(e){this._label.translucencyByDistance=e,this._billboard.translucencyByDistance=e}},distanceDisplayCondition:{get:function(){return this._label.distanceDisplayCondition},set:function(e){this._label.distanceDisplayCondition=e,this._polyline.distanceDisplayCondition=e,this._billboard.distanceDisplayCondition=e}},heightOffset:{get:function(){return this._heightOffset},set:function(e){var t=Object(o.default)(this._heightOffset,0),i=this._content.tileset.ellipsoid,a=i.cartesianToCartographic(this._billboard.position,ly);a.height=a.height-t+e;var r=i.cartographicToCartesian(a);this._billboard.position=r,this._label.position=this._billboard.position,this._polyline.positions=[this._polyline.positions[0],r],this._heightOffset=e}},anchorLineEnabled:{get:function(){return this._polyline.show},set:function(e){this._polyline.show=e}},anchorLineColor:{get:function(){return this._polyline.material.uniforms.color},set:function(e){this._polyline.material.uniforms.color=b.default.clone(e,this._polyline.material.uniforms.color)}},image:{get:function(){return this._billboardImage},set:function(e){var t=this._billboardImage!==e;this._billboardImage=e,t&&uy(this)}},disableDepthTestDistance:{get:function(){return this._label.disableDepthTestDistance},set:function(e){this._label.disableDepthTestDistance=e,this._billboard.disableDepthTestDistance=e}},horizontalOrigin:{get:function(){return this._billboard.horizontalOrigin},set:function(e){this._billboard.horizontalOrigin=e}},verticalOrigin:{get:function(){return this._billboard.verticalOrigin},set:function(e){this._billboard.verticalOrigin=e}},labelHorizontalOrigin:{get:function(){return this._label.horizontalOrigin},set:function(e){this._label.horizontalOrigin=e}},labelVerticalOrigin:{get:function(){return this._label.verticalOrigin},set:function(e){this._label.verticalOrigin=e}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},pickIds:{get:function(){var e=this._pickIds;return e[0]=this._billboard.pickId,e[1]=this._label.pickId,e[2]=this._polyline.pickId,e}}}),sy.defaultColor=b.default.WHITE,sy.defaultPointOutlineColor=b.default.BLACK,sy.defaultPointOutlineWidth=0,sy.defaultPointSize=8,sy.prototype.hasProperty=function(e){return this._content.batchTable.hasProperty(this._batchId,e)},sy.prototype.getPropertyNames=function(e){return this._content.batchTable.getPropertyNames(this._batchId,e)},sy.prototype.getProperty=function(e){return this._content.batchTable.getProperty(this._batchId,e)},sy.prototype.setProperty=function(e,t){this._content.batchTable.setProperty(this._batchId,e,t),this._content.featurePropertiesDirty=!0},sy.prototype.isExactClass=function(e){return this._content.batchTable.isExactClass(this._batchId,e)},sy.prototype.isClass=function(e){return this._content.batchTable.isClass(this._batchId,e)},sy.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)};var dy=sy,fy=i(528),cy=i(85),hy=i(367),py=i(587),my=i(588);function _y(e,t){e=Object(o.default)(e,o.default.EMPTY_OBJECT),this._show=Object(o.default)(e.show,!0),this._width=Object(o.default)(e.width,1),this._loop=Object(o.default)(e.loop,!1),this._distanceDisplayCondition=e.distanceDisplayCondition,this._material=e.material,Object(s.default)(this._material)||(this._material=$.a.fromType($.a.ColorType,{color:new b.default(1,1,1,1)}));var i,a=e.positions;Object(s.default)(a)||(a=[]),this._positions=a,this._actualPositions=Object(Qe.a)(a,v.default.equalsEpsilon),this._loop&&this._actualPositions.length>2&&(this._actualPositions===this._positions&&(this._actualPositions=a.slice()),this._actualPositions.push(v.default.clone(this._actualPositions[0]))),this._length=this._actualPositions.length,this._id=e.id,Object(s.default)(t)&&(i=nt.default.clone(t.modelMatrix)),this._modelMatrix=i,this._segments=St.wrapLongitude(this._actualPositions,i),this._actualLength=void 0,this._propertiesChanged=new Uint32Array(xy),this._polylineCollection=t,this._dirty=!1,this._pickId=void 0,this._boundingVolume=r.default.fromPoints(this._actualPositions),this._boundingVolumeWC=r.default.transform(this._boundingVolume,this._modelMatrix),this._boundingVolume2D=new r.default}var gy=_y.POSITION_INDEX=0,vy=_y.SHOW_INDEX=1,by=_y.WIDTH_INDEX=2,yy=_y.MATERIAL_INDEX=3,Oy=_y.POSITION_SIZE_INDEX=4,wy=_y.DISTANCE_DISPLAY_CONDITION=5,xy=_y.NUMBER_OF_PROPERTIES=6;function Ey(e,t){++e._propertiesChanged[t];var i=e._polylineCollection;Object(s.default)(i)&&(i._updatePolyline(e,t),e._dirty=!0)}Object.defineProperties(_y.prototype,{show:{get:function(){return this._show},set:function(e){e!==this._show&&(this._show=e,Ey(this,vy))}},positions:{get:function(){return this._positions},set:function(e){var t=Object(Qe.a)(e,v.default.equalsEpsilon);this._loop&&t.length>2&&(t===e&&(t=e.slice()),t.push(v.default.clone(t[0]))),this._actualPositions.length===t.length&&this._actualPositions.length===this._length||Ey(this,Oy),this._positions=e,this._actualPositions=t,this._length=t.length,this._boundingVolume=r.default.fromPoints(this._actualPositions,this._boundingVolume),this._boundingVolumeWC=r.default.transform(this._boundingVolume,this._modelMatrix,this._boundingVolumeWC),Ey(this,gy),this.update()}},material:{get:function(){return this._material},set:function(e){this._material!==e&&(this._material=e,Ey(this,yy))}},width:{get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,Ey(this,by))}},loop:{get:function(){return this._loop},set:function(e){if(e!==this._loop){var t=this._actualPositions;e?t.length>2&&!v.default.equals(t[0],t[t.length-1])&&(t.length===this._positions.length&&(this._actualPositions=t=this._positions.slice()),t.push(v.default.clone(t[0]))):t.length>2&&v.default.equals(t[0],t[t.length-1])&&(t.length-1===this._positions.length?this._actualPositions=this._positions:t.pop()),this._loop=e,Ey(this,Oy)}}},id:{get:function(){return this._id},set:function(e){this._id=e,Object(s.default)(this._pickId)&&(this._pickId.object.id=e)}},pickId:{get:function(){return this._pickId}},isDestroyed:{get:function(){return!Object(s.default)(this._polylineCollection)}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){O.a.equals(e,this._distanceDisplayCondition)||(this._distanceDisplayCondition=O.a.clone(e,this._distanceDisplayCondition),Ey(this,wy))}}}),_y.prototype.update=function(){var e=nt.default.IDENTITY;Object(s.default)(this._polylineCollection)&&(e=this._polylineCollection.modelMatrix);var t=this._segments.positions.length,i=this._segments.lengths,a=this._propertiesChanged[gy]>0||this._propertiesChanged[Oy]>0;if(nt.default.equals(e,this._modelMatrix)&&!a||(this._segments=St.wrapLongitude(this._actualPositions,e),this._boundingVolumeWC=r.default.transform(this._boundingVolume,e,this._boundingVolumeWC)),this._modelMatrix=nt.default.clone(e,this._modelMatrix),this._segments.positions.length!==t)Ey(this,Oy);else for(var n=i.length,o=0;o<n;++o)if(i[o]!==this._segments.lengths[o]){Ey(this,Oy);break}},_y.prototype.getPickId=function(e){return Object(s.default)(this._pickId)||(this._pickId=e.createPickId({primitive:this,collection:this._polylineCollection,id:this._id})),this._pickId},_y.prototype._clean=function(){this._dirty=!1;for(var e=this._propertiesChanged,t=0;t<xy-1;++t)e[t]=0},_y.prototype._destroy=function(){this._pickId=this._pickId&&this._pickId.destroy(),this._material=this._material&&this._material.destroy(),this._polylineCollection=void 0};var Ty=_y,Cy=Ty.SHOW_INDEX,Ay=Ty.WIDTH_INDEX,jy=Ty.POSITION_INDEX,Py=Ty.MATERIAL_INDEX,Sy=Ty.POSITION_SIZE_INDEX,Iy=Ty.DISTANCE_DISPLAY_CONDITION,Ly=Ty.NUMBER_OF_PROPERTIES,Dy={texCoordExpandAndBatchIndex:0,position3DHigh:1,position3DLow:2,position2DHigh:3,position2DLow:4,prevPosition3DHigh:5,prevPosition3DLow:6,prevPosition2DHigh:7,prevPosition2DLow:8,nextPosition3DHigh:9,nextPosition3DLow:10,nextPosition2DHigh:11,nextPosition2DLow:12};function My(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT),this.modelMatrix=nt.default.clone(Object(o.default)(e.modelMatrix,nt.default.IDENTITY)),this._modelMatrix=nt.default.clone(nt.default.IDENTITY),this.debugShowBoundingVolume=Object(o.default)(e.debugShowBoundingVolume,!1),this._opaqueRS=void 0,this._translucentRS=void 0,this._colorCommands=[],this._polylinesUpdated=!1,this._polylinesRemoved=!1,this._createVertexArray=!1,this._propertiesChanged=new Uint32Array(Ly),this._polylines=[],this._polylineBuckets={},this._positionBufferUsage={bufferUsage:Sf.a.STATIC_DRAW,frameCount:0},this._mode=void 0,this._polylinesToUpdate=[],this._vertexArrays=[],this._positionBuffer=void 0,this._texCoordExpandAndBatchIndexBuffer=void 0,this._batchTable=void 0,this._createBatchTable=!1,this._useHighlightColor=!1,this._highlightColor=b.default.clone(b.default.WHITE);var t=this;this._uniformMap={u_highlightColor:function(){return t._highlightColor}}}Object.defineProperties(My.prototype,{length:{get:function(){return qy(this),this._polylines.length}}}),My.prototype.add=function(e){var t=new Ty(e,this);return t._index=this._polylines.length,this._polylines.push(t),this._createVertexArray=!0,this._createBatchTable=!0,t},My.prototype.remove=function(e){if(this.contains(e)){if(this._polylinesRemoved=!0,this._createVertexArray=!0,this._createBatchTable=!0,Object(s.default)(e._bucket)){var t=e._bucket;t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy()}return e._destroy(),!0}return!1},My.prototype.removeAll=function(){Wy(this),Ky(this),this._polylineBuckets={},this._polylinesRemoved=!1,this._polylines.length=0,this._polylinesToUpdate.length=0,this._createVertexArray=!0},My.prototype.contains=function(e){return Object(s.default)(e)&&e._polylineCollection===this},My.prototype.get=function(e){return qy(this),this._polylines[e]};var Ry=new cy.a,Ny=new It.a,Vy=new g.default;My.prototype.update=function(e){if(qy(this),0!==this._polylines.length){!function(e,t){var i=t.mode;e._mode===i&&nt.default.equals(e._modelMatrix,e.modelMatrix)||(e._mode=i,e._modelMatrix=nt.default.clone(e.modelMatrix),e._createVertexArray=!0)}(this,e);var t,i=e.context,a=e.mapProjection,n=this._propertiesChanged;if(this._createBatchTable){if(0===T_.a.maximumVertexTextureImageUnits)throw new $f.default("Vertex texture fetch support is required to render polylines. The maximum number of vertex texture image units must be greater than zero.");!function(e,t){Object(s.default)(e._batchTable)&&e._batchTable.destroy();var i=[{functionName:"batchTable_getWidthAndShow",componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:2},{functionName:"batchTable_getPickColor",componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0},{functionName:"batchTable_getCenterHigh",componentDatatype:se.a.FLOAT,componentsPerAttribute:3},{functionName:"batchTable_getCenterLowAndRadius",componentDatatype:se.a.FLOAT,componentsPerAttribute:4},{functionName:"batchTable_getDistanceDisplayCondition",componentDatatype:se.a.FLOAT,componentsPerAttribute:2}];e._batchTable=new my.a(t,i,e._polylines.length)}(this,i),this._createBatchTable=!1}if(this._createVertexArray||function(e){var t=!1,i=e._propertiesChanged,a=e._positionBufferUsage;i[jy]?a.bufferUsage!==Sf.a.STREAM_DRAW?(t=!0,a.bufferUsage=Sf.a.STREAM_DRAW,a.frameCount=100):a.frameCount=100:a.bufferUsage!==Sf.a.STATIC_DRAW&&(0===a.frameCount?(t=!0,a.bufferUsage=Sf.a.STATIC_DRAW):a.frameCount--);return t}(this))Hy(this,i,a);else if(this._polylinesUpdated){var o=this._polylinesToUpdate;if(this._mode!==Ve.a.SCENE3D)for(var l=o.length,u=0;u<l;++u)(t=o[u]).update();if(n[Sy]||n[Py])Hy(this,i,a);else for(var d=o.length,f=this._polylineBuckets,c=0;c<d;++c){n=(t=o[c])._propertiesChanged;var h=t._bucket,p=0;for(var m in f)if(f.hasOwnProperty(m)){if(f[m]===h){n[jy]&&h.writeUpdate(p,t,this._positionBuffer,a);break}p+=f[m].lengthOfPositions}if((n[Cy]||n[Ay])&&this._batchTable.setBatchedAttribute(t._index,0,new g.default(t._width,t._show)),this._batchTable.attributes.length>2){if(n[jy]||n[Sy]){var _=e.mode===Ve.a.SCENE2D?t._boundingVolume2D:t._boundingVolumeWC,v=cy.a.fromCartesian(_.center,Ry),b=It.a.fromElements(v.low.x,v.low.y,v.low.z,_.radius,Ny);this._batchTable.setBatchedAttribute(t._index,2,v.high),this._batchTable.setBatchedAttribute(t._index,3,b)}if(n[Iy]){var y=Vy;y.x=0,y.y=Number.MAX_VALUE;var O=t.distanceDisplayCondition;Object(s.default)(O)&&(y.x=O.near,y.y=O.far),this._batchTable.setBatchedAttribute(t._index,4,y)}}t._clean()}o.length=0,this._polylinesUpdated=!1}n=this._propertiesChanged;for(var w=0;w<Ly;++w)n[w]=0;var x=nt.default.IDENTITY;e.mode===Ve.a.SCENE3D&&(x=this.modelMatrix);var E=e.passes,T=0!==e.morphTime;if(Object(s.default)(this._opaqueRS)&&this._opaqueRS.depthTest.enabled===T||(this._opaqueRS=Df.a.fromCache({depthMask:T,depthTest:{enabled:T}})),Object(s.default)(this._translucentRS)&&this._translucentRS.depthTest.enabled===T||(this._translucentRS=Df.a.fromCache({blending:Rc.a.ALPHA_BLEND,depthMask:!T,depthTest:{enabled:T}})),this._batchTable.update(e),E.render||E.pick)!function(e,t,i,a){for(var n=t.context,o=t.commandList,l=i.length,u=0,d=!0,f=e._vertexArrays,c=e.debugShowBoundingVolume,h=e._batchTable.getUniformMapCallback(),p=f.length,m=0;m<p;++m)for(var _=f[m],g=_.buckets,v=g.length,b=0;b<v;++b){for(var y,O,w,x,E=g[b],T=E.offset,C=E.bucket.shaderProgram,A=E.bucket.polylines,j=A.length,P=0,S=0;S<j;++S){var I=A[S],L=Gy(I._material);if(L!==y){if(Object(s.default)(y)&&P>0){var D=O.isTranslucent();u>=l?(w=new If.a({owner:e}),i.push(w)):w=i[u],++u,x=Object(gf.default)(h(O._uniforms),e._uniformMap),w.boundingVolume=r.default.clone(By,w.boundingVolume),w.modelMatrix=a,w.shaderProgram=C,w.vertexArray=_.va,w.renderState=D?e._translucentRS:e._opaqueRS,w.pass=D?Lf.a.TRANSLUCENT:Lf.a.OPAQUE,w.debugShowBoundingVolume=c,w.pickId="v_pickColor",w.uniformMap=x,w.count=P,w.offset=T,T+=P,P=0,d=!0,o.push(w)}(O=I._material).update(n),y=L}for(var M,R=I._locatorBuckets,N=R.length,V=0;V<N;++V){var B=R[V];B.locator===E&&(P+=B.count)}t.mode===Ve.a.SCENE3D?M=I._boundingVolumeWC:t.mode===Ve.a.COLUMBUS_VIEW?M=I._boundingVolume2D:t.mode===Ve.a.SCENE2D?Object(s.default)(I._boundingVolume2D)&&((M=r.default.clone(I._boundingVolume2D,Uy)).center.x=0):Object(s.default)(I._boundingVolumeWC)&&Object(s.default)(I._boundingVolume2D)&&(M=r.default.union(I._boundingVolumeWC,I._boundingVolume2D,Uy)),d?(d=!1,r.default.clone(M,By)):r.default.union(M,By,By)}Object(s.default)(y)&&P>0&&(u>=l?(w=new If.a({owner:e}),i.push(w)):w=i[u],++u,x=Object(gf.default)(h(O._uniforms),e._uniformMap),w.boundingVolume=r.default.clone(By,w.boundingVolume),w.modelMatrix=a,w.shaderProgram=C,w.vertexArray=_.va,w.renderState=O.isTranslucent()?e._translucentRS:e._opaqueRS,w.pass=O.isTranslucent()?Lf.a.TRANSLUCENT:Lf.a.OPAQUE,w.debugShowBoundingVolume=c,w.pickId="v_pickColor",w.uniformMap=x,w.count=P,w.offset=T,d=!0,o.push(w)),y=void 0}i.length=u}(this,e,this._colorCommands,x)}};var By=new r.default,Uy=new r.default;My.prototype.isDestroyed=function(){return!1},My.prototype.destroy=function(){return Yy(this),Wy(this),Ky(this),this._batchTable=this._batchTable&&this._batchTable.destroy(),Object(l.default)(this)};var Fy=[0,0,0];function Hy(e,t,i){e._createVertexArray=!1,Wy(e),Yy(e),function(e){for(var t=e._mode,i=e._modelMatrix,a=e._polylineBuckets={},r=e._polylines,n=r.length,o=0;o<n;++o){var l=r[o];if(l._actualPositions.length>1){l.update();var u=l.material,d=a[u.type];Object(s.default)(d)||(d=a[u.type]=new Zy(u,t,i)),d.addPolyline(l)}}}(e);var a,r,n=[[]],o=n[0],l=e._batchTable,u=e._useHighlightColor,d=[0],f=0,c=[[]],h=0,p=e._polylineBuckets;for(a in p)p.hasOwnProperty(a)&&((r=p[a]).updateShader(t,l,u),h+=r.lengthOfPositions);if(h>0){var m,_=e._mode,g=new Float32Array(6*h*3),v=new Float32Array(4*h),b=0,y=0,O=0;for(a in p)if(p.hasOwnProperty(a)){(r=p[a]).write(g,v,b,y,O,l,t,i),_===Ve.a.MORPHING&&(Object(s.default)(m)||(m=new Float32Array(6*h*3)),r.writeForMorph(m,b));var w=r.lengthOfPositions;b+=6*w*3,y+=4*w,O+=4*w,f=r.updateIndices(n,d,c,f)}var x,E=e._positionBufferUsage.bufferUsage,T=Sf.a.STATIC_DRAW;e._positionBuffer=Pf.a.createVertexBuffer({context:t,typedArray:g,usage:E}),Object(s.default)(m)&&(x=Pf.a.createVertexBuffer({context:t,typedArray:m,usage:E})),e._texCoordExpandAndBatchIndexBuffer=Pf.a.createVertexBuffer({context:t,typedArray:v,usage:T});for(var C=3*Float32Array.BYTES_PER_ELEMENT,A=4*Float32Array.BYTES_PER_ELEMENT,j=0,P=n.length,S=0;S<P;++S)if((o=n[S]).length>0){var I=new Uint16Array(o),L=Pf.a.createIndexBuffer({context:t,typedArray:I,usage:Sf.a.STATIC_DRAW,indexDatatype:Gi.a.UNSIGNED_SHORT});j+=d[S];var D,M,R,N,V=6*(S*(C*Ne.default.SIXTY_FOUR_KILOBYTES)-j*C),B=C+V,U=C+B,F=C+U,H=C+F,k=C+H,z=S*(A*Ne.default.SIXTY_FOUR_KILOBYTES)-j*A,G=[{index:Dy.position3DHigh,componentsPerAttribute:3,componentDatatype:se.a.FLOAT,offsetInBytes:V,strideInBytes:6*C},{index:Dy.position3DLow,componentsPerAttribute:3,componentDatatype:se.a.FLOAT,offsetInBytes:B,strideInBytes:6*C},{index:Dy.position2DHigh,componentsPerAttribute:3,componentDatatype:se.a.FLOAT,offsetInBytes:V,strideInBytes:6*C},{index:Dy.position2DLow,componentsPerAttribute:3,componentDatatype:se.a.FLOAT,offsetInBytes:B,strideInBytes:6*C},{index:Dy.prevPosition3DHigh,componentsPerAttribute:3,componentDatatype:se.a.FLOAT,offsetInBytes:U,strideInBytes:6*C},{index:Dy.prevPosition3DLow,componentsPerAttribute:3,componentDatatype:se.a.FLOAT,offsetInBytes:F,strideInBytes:6*C},{index:Dy.prevPosition2DHigh,componentsPerAttribute:3,componentDatatype:se.a.FLOAT,offsetInBytes:U,strideInBytes:6*C},{index:Dy.prevPosition2DLow,componentsPerAttribute:3,componentDatatype:se.a.FLOAT,offsetInBytes:F,strideInBytes:6*C},{index:Dy.nextPosition3DHigh,componentsPerAttribute:3,componentDatatype:se.a.FLOAT,offsetInBytes:H,strideInBytes:6*C},{index:Dy.nextPosition3DLow,componentsPerAttribute:3,componentDatatype:se.a.FLOAT,offsetInBytes:k,strideInBytes:6*C},{index:Dy.nextPosition2DHigh,componentsPerAttribute:3,componentDatatype:se.a.FLOAT,offsetInBytes:H,strideInBytes:6*C},{index:Dy.nextPosition2DLow,componentsPerAttribute:3,componentDatatype:se.a.FLOAT,offsetInBytes:k,strideInBytes:6*C},{index:Dy.texCoordExpandAndBatchIndex,componentsPerAttribute:4,componentDatatype:se.a.FLOAT,vertexBuffer:e._texCoordExpandAndBatchIndexBuffer,offsetInBytes:z}];_===Ve.a.SCENE3D?(D=e._positionBuffer,M="vertexBuffer",R=Fy,N="value"):_===Ve.a.SCENE2D||_===Ve.a.COLUMBUS_VIEW?(D=Fy,M="value",R=e._positionBuffer,N="vertexBuffer"):(D=x,M="vertexBuffer",R=e._positionBuffer,N="vertexBuffer"),G[0][M]=D,G[1][M]=D,G[2][N]=R,G[3][N]=R,G[4][M]=D,G[5][M]=D,G[6][N]=R,G[7][N]=R,G[8][M]=D,G[9][M]=D,G[10][N]=R,G[11][N]=R;var q=new Ff.a({context:t,attributes:G,indexBuffer:L});e._vertexArrays.push({va:q,buckets:c[S]})}}}function ky(e,t){return t instanceof Vf.a?t.id:t}var zy=[];function Gy(e){var t=$.a._uniformList[e.type],i=t.length;zy.length=2*i;for(var a=0,r=0;r<i;++r){var n=t[r];zy[a]=n,zy[a+1]=e._uniforms[n](),a+=2}return e.type+":"+JSON.stringify(zy,ky)}function qy(e){if(e._polylinesRemoved){e._polylinesRemoved=!1;for(var t,i=[],a=[],r=0,n=e._polylines.length,o=0;o<n;++o)(t=e._polylines[o]).isDestroyed||(t._index=r++,a.push(t),i.push(t));e._polylines=i,e._polylinesToUpdate=a}}function Wy(e){for(var t=e._polylines,i=t.length,a=0;a<i;++a)if(!t[a].isDestroyed){var r=t[a]._bucket;Object(s.default)(r)&&(r.shaderProgram=r.shaderProgram&&r.shaderProgram.destroy())}}function Yy(e){for(var t=e._vertexArrays.length,i=0;i<t;++i)e._vertexArrays[i].va.destroy();e._vertexArrays.length=0}function Ky(e){for(var t=e._polylines,i=t.length,a=0;a<i;++a)t[a].isDestroyed||t[a]._destroy()}function Xy(e,t,i){this.count=e,this.offset=t,this.bucket=i}function Zy(e,t,i){this.polylines=[],this.lengthOfPositions=0,this.material=e,this.shaderProgram=void 0,this.mode=t,this.modelMatrix=i}function Jy(e){return v.default.dot(v.default.UNIT_X,e._boundingVolume.center)<0||e._boundingVolume.intersectPlane(ot.a.ORIGIN_ZX_PLANE)===b_.default.INTERSECTING}My.prototype._updatePolyline=function(e,t){this._polylinesUpdated=!0,e._dirty||this._polylinesToUpdate.push(e),++this._propertiesChanged[t]},Zy.prototype.addPolyline=function(e){this.polylines.push(e),e._actualLength=this.getPolylinePositionsLength(e),this.lengthOfPositions+=e._actualLength,e._bucket=this},Zy.prototype.updateShader=function(e,t,i){if(!Object(s.default)(this.shaderProgram)){var a=["DISTANCE_DISPLAY_CONDITION"];i&&a.push("VECTOR_TILE"),-1!==this.material.shaderSource.search(/varying\s+float\s+v_polylineAngle;/g)&&a.push("POLYLINE_DASH"),bf.default.isInternetExplorer()||a.push("CLIP_POLYLINE");var r=new Nf.a({defines:a,sources:["varying vec4 v_pickColor;\n",this.material.shaderSource,py.a]}),n=t.getVertexShaderCallback()("attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 position2DHigh;\nattribute vec3 position2DLow;\nattribute vec3 prevPosition3DHigh;\nattribute vec3 prevPosition3DLow;\nattribute vec3 prevPosition2DHigh;\nattribute vec3 prevPosition2DLow;\nattribute vec3 nextPosition3DHigh;\nattribute vec3 nextPosition3DLow;\nattribute vec3 nextPosition2DHigh;\nattribute vec3 nextPosition2DLow;\nattribute vec4 texCoordExpandAndBatchIndex;\n\nvarying vec2  v_st;\nvarying float v_width;\nvarying vec4 v_pickColor;\nvarying float v_polylineAngle;\n\nvoid main()\n{\n    float texCoord = texCoordExpandAndBatchIndex.x;\n    float expandDir = texCoordExpandAndBatchIndex.y;\n    bool usePrev = texCoordExpandAndBatchIndex.z < 0.0;\n    float batchTableIndex = texCoordExpandAndBatchIndex.w;\n\n    vec2 widthAndShow = batchTable_getWidthAndShow(batchTableIndex);\n    float width = widthAndShow.x + 0.5;\n    float show = widthAndShow.y;\n\n    if (width < 1.0)\n    {\n        show = 0.0;\n    }\n\n    vec4 pickColor = batchTable_getPickColor(batchTableIndex);\n\n    vec4 p, prev, next;\n    if (czm_morphTime == 1.0)\n    {\n        p = czm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz);\n        prev = czm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz);\n        next = czm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz);\n    }\n    else if (czm_morphTime == 0.0)\n    {\n        p = czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy);\n        prev = czm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy);\n        next = czm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy);\n    }\n    else\n    {\n        p = czm_columbusViewMorph(\n                czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy),\n                czm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz),\n                czm_morphTime);\n        prev = czm_columbusViewMorph(\n                czm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy),\n                czm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz),\n                czm_morphTime);\n        next = czm_columbusViewMorph(\n                czm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy),\n                czm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz),\n                czm_morphTime);\n    }\n\n    #ifdef DISTANCE_DISPLAY_CONDITION\n        vec3 centerHigh = batchTable_getCenterHigh(batchTableIndex);\n        vec4 centerLowAndRadius = batchTable_getCenterLowAndRadius(batchTableIndex);\n        vec3 centerLow = centerLowAndRadius.xyz;\n        float radius = centerLowAndRadius.w;\n        vec2 distanceDisplayCondition = batchTable_getDistanceDisplayCondition(batchTableIndex);\n\n        float lengthSq;\n        if (czm_sceneMode == czm_sceneMode2D)\n        {\n            lengthSq = czm_eyeHeight2D.y;\n        }\n        else\n        {\n            vec4 center = czm_translateRelativeToEye(centerHigh.xyz, centerLow.xyz);\n            lengthSq = max(0.0, dot(center.xyz, center.xyz) - radius * radius);\n        }\n\n        float nearSq = distanceDisplayCondition.x * distanceDisplayCondition.x;\n        float farSq = distanceDisplayCondition.y * distanceDisplayCondition.y;\n        if (lengthSq < nearSq || lengthSq > farSq)\n        {\n            show = 0.0;\n        }\n    #endif\n\n    vec4 positionWC = getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, v_polylineAngle);\n    gl_Position = czm_viewportOrthographic * positionWC * show;\n\n    v_st = vec2(texCoord, clamp(expandDir, 0.0, 1.0));\n    v_width = width;\n    v_pickColor = pickColor;\n}\n"),o=new Nf.a({defines:a,sources:[hy.a,n]});this.shaderProgram=Rf.a.fromCache({context:e,vertexShaderSource:o,fragmentShaderSource:r,attributeLocations:Dy})}},Zy.prototype.getPolylinePositionsLength=function(e){var t;if(this.mode===Ve.a.SCENE3D||!Jy(e))return 4*(t=e._actualPositions.length)-4;var i=0,a=e._segments.lengths;t=a.length;for(var r=0;r<t;++r)i+=4*a[r]-4;return i};var Qy=new v.default,$y=new v.default,eO=new v.default,tO=new v.default,iO=new It.a,aO=new g.default;Zy.prototype.write=function(e,t,i,a,r,n,o,l){for(var u=this.mode,d=l.ellipsoid.maximumRadius*Ne.default.PI,f=this.polylines,c=f.length,h=0;h<c;++h){for(var p,m=f[h],_=m.width,g=m.show&&_>0,y=m._index,O=this.getSegments(m,l),w=O.positions,x=O.lengths,E=w.length,T=m.getPickId(o).color,C=0,A=0,j=0;j<E;++j){0===j?m._loop?p=w[E-2]:(p=tO,v.default.subtract(w[0],w[1],p),v.default.add(w[0],p,p)):p=w[j-1],v.default.clone(p,$y),v.default.clone(w[j],Qy),j===E-1?m._loop?p=w[1]:(p=tO,v.default.subtract(w[E-1],w[E-2],p),v.default.add(w[E-1],p,p)):p=w[j+1],v.default.clone(p,eO);var P=x[C];j===A+P&&(A+=P,++C);var S=j-A==0,I=j===A+x[C]-1;u===Ve.a.SCENE2D&&($y.z=0,Qy.z=0,eO.z=0),u!==Ve.a.SCENE2D&&u!==Ve.a.MORPHING||(S||I)&&d-Math.abs(Qy.x)<1&&((Qy.x<0&&$y.x>0||Qy.x>0&&$y.x<0)&&v.default.clone(Qy,$y),(Qy.x<0&&eO.x>0||Qy.x>0&&eO.x<0)&&v.default.clone(Qy,eO));for(var L=I?2:4,D=S?2:0;D<L;++D){cy.a.writeElements(Qy,e,i),cy.a.writeElements($y,e,i+6),cy.a.writeElements(eO,e,i+12);var M=D-2<0?-1:1;t[r]=j/(E-1),t[r+1]=D%2*2-1,t[r+2]=M,t[r+3]=y,i+=18,r+=4}}var R=iO;R.x=b.default.floatToByte(T.red),R.y=b.default.floatToByte(T.green),R.z=b.default.floatToByte(T.blue),R.w=b.default.floatToByte(T.alpha);var N=aO;N.x=_,N.y=g?1:0;var V=u===Ve.a.SCENE2D?m._boundingVolume2D:m._boundingVolumeWC,B=cy.a.fromCartesian(V.center,Ry),U=B.high,F=It.a.fromElements(B.low.x,B.low.y,B.low.z,V.radius,Ny),H=Vy;H.x=0,H.y=Number.MAX_VALUE;var k=m.distanceDisplayCondition;Object(s.default)(k)&&(H.x=k.near,H.y=k.far),n.setBatchedAttribute(y,0,N),n.setBatchedAttribute(y,1,R),n.attributes.length>2&&(n.setBatchedAttribute(y,2,U),n.setBatchedAttribute(y,3,F),n.setBatchedAttribute(y,4,H))}};var rO=new v.default,nO=new v.default,oO=new v.default,sO=new v.default;Zy.prototype.writeForMorph=function(e,t){for(var i=this.modelMatrix,a=this.polylines,r=a.length,n=0;n<r;++n)for(var o=a[n],s=o._segments.positions,l=o._segments.lengths,u=s.length,d=0,f=0,c=0;c<u;++c){var h;0===c?o._loop?h=s[u-2]:(h=sO,v.default.subtract(s[0],s[1],h),v.default.add(s[0],h,h)):h=s[c-1],h=nt.default.multiplyByPoint(i,h,nO);var p,m=nt.default.multiplyByPoint(i,s[c],rO);c===u-1?o._loop?p=s[1]:(p=sO,v.default.subtract(s[u-1],s[u-2],p),v.default.add(s[u-1],p,p)):p=s[c+1],p=nt.default.multiplyByPoint(i,p,oO);var _=l[d];c===f+_&&(f+=_,++d);for(var g=c-f==0,b=c===f+l[d]-1?2:4,y=g?2:0;y<b;++y)cy.a.writeElements(m,e,t),cy.a.writeElements(h,e,t+6),cy.a.writeElements(p,e,t+12),t+=18}};var lO=new Array(1);Zy.prototype.updateIndices=function(e,t,i,a){var r=i.length-1,n=new Xy(0,a,this);i[r].push(n);var o=0,s=e[e.length-1],l=0;s.length>0&&(l=s[s.length-1]+1);for(var u=this.polylines,d=u.length,f=0;f<d;++f){var c,h=u[f];if(h._locatorBuckets=[],this.mode===Ve.a.SCENE3D){c=lO;var p=h._actualPositions.length;if(!(p>0))continue;c[0]=p}else c=h._segments.lengths;var m=c.length;if(m>0){for(var _=0,g=0;g<m;++g)for(var v=c[g]-1,b=0;b<v;++b)l+4>Ne.default.SIXTY_FOUR_KILOBYTES&&(h._locatorBuckets.push({locator:n,count:_}),_=0,t.push(4),s=[],e.push(s),l=0,n.count=o,o=0,a=0,n=new Xy(0,0,this),i[++r]=[n]),s.push(l,l+2,l+1),s.push(l+1,l+2,l+3),_+=6,o+=6,a+=6,l+=4;h._locatorBuckets.push({locator:n,count:_}),l+4>Ne.default.SIXTY_FOUR_KILOBYTES&&(t.push(0),s=[],e.push(s),l=0,n.count=o,a=0,o=0,n=new Xy(0,0,this),i[++r]=[n])}h._clean()}return n.count=o,a},Zy.prototype.getPolylineStartIndex=function(e){for(var t=this.polylines,i=0,a=t.length,r=0;r<a;++r){var n=t[r];if(n===e)break;i+=n._actualLength}return i};var uO,dO={positions:void 0,lengths:void 0},fO=new Array(1),cO=new v.default,hO=new Re.default;Zy.prototype.getSegments=function(e,t){var i=e._actualPositions;if(this.mode===Ve.a.SCENE3D)return fO[0]=i.length,dO.positions=i,dO.lengths=fO,dO;Jy(e)&&(i=e._segments.positions);for(var a,n=t.ellipsoid,o=[],s=this.modelMatrix,l=i.length,u=cO,d=0;d<l;++d)a=i[d],u=nt.default.multiplyByPoint(s,a,u),o.push(t.project(n.cartesianToCartographic(u,hO)));if(o.length>0){e._boundingVolume2D=r.default.fromPoints(o,e._boundingVolume2D);var f=e._boundingVolume2D.center;e._boundingVolume2D.center=new v.default(f.z,f.x,f.y)}return dO.positions=o,dO.lengths=e._segments.lengths,dO},Zy.prototype.writeUpdate=function(e,t,i,a){var r=this.mode,n=a.ellipsoid.maximumRadius*Ne.default.PI,o=t._actualLength;if(o){e+=this.getPolylineStartIndex(t);var l=uO,u=6*o*3;!Object(s.default)(l)||l.length<u?l=uO=new Float32Array(u):l.length>u&&(l=new Float32Array(l.buffer,0,u));var d,f=this.getSegments(t,a),c=f.positions,h=f.lengths,p=0,m=0,_=0;o=c.length;for(var g=0;g<o;++g){0===g?t._loop?d=c[o-2]:(d=tO,v.default.subtract(c[0],c[1],d),v.default.add(c[0],d,d)):d=c[g-1],v.default.clone(d,$y),v.default.clone(c[g],Qy),g===o-1?t._loop?d=c[1]:(d=tO,v.default.subtract(c[o-1],c[o-2],d),v.default.add(c[o-1],d,d)):d=c[g+1],v.default.clone(d,eO);var b=h[m];g===_+b&&(_+=b,++m);var y=g-_==0,O=g===_+h[m]-1;r===Ve.a.SCENE2D&&($y.z=0,Qy.z=0,eO.z=0),r!==Ve.a.SCENE2D&&r!==Ve.a.MORPHING||(y||O)&&n-Math.abs(Qy.x)<1&&((Qy.x<0&&$y.x>0||Qy.x>0&&$y.x<0)&&v.default.clone(Qy,$y),(Qy.x<0&&eO.x>0||Qy.x>0&&eO.x<0)&&v.default.clone(Qy,eO));for(var w=O?2:4,x=y?2:0;x<w;++x)cy.a.writeElements(Qy,l,p),cy.a.writeElements($y,l,p+6),cy.a.writeElements(eO,l,p+12),p+=18}i.copyFromArrayView(l,18*Float32Array.BYTES_PER_ELEMENT*e)}};var pO=My;function mO(e){this._positions=e.positions,this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._rectangle=e.rectangle,this._minHeight=e.minimumHeight,this._maxHeight=e.maximumHeight,this._billboardCollection=void 0,this._labelCollection=void 0,this._polylineCollection=void 0,this._verticesPromise=void 0,this._packedBuffer=void 0,this._ready=!1,this._readyPromise=Ef.default.defer(),this._resolvedPromise=!1}Object.defineProperties(mO.prototype,{pointsLength:{get:function(){return this._billboardCollection.length}},texturesByteLength:{get:function(){return this._billboardCollection.textureAtlas.texture.sizeInBytes+this._labelCollection._textureAtlas.texture.sizeInBytes}},readyPromise:{get:function(){return this._readyPromise.promise}}});var _O=new Uc.default("createVectorTilePoints"),gO=new v.default;function vO(e,t){if(!Object(s.default)(e._billboardCollection)){var i;if(!Object(s.default)(e._verticesPromise)){i=e._positions;var a=e._packedBuffer;Object(s.default)(a)||(i=e._positions=Object(Bc.a)(i),e._batchIds=Object(Bc.a)(e._batchIds),a=e._packedBuffer=function(e,t){var i=e._rectangle,a=e._minHeight,r=e._maxHeight,n=2+Yi.default.packedLength+tt.default.packedLength,o=new Float64Array(n),s=0;return o[s++]=a,o[s++]=r,Yi.default.pack(i,o,s),s+=Yi.default.packedLength,tt.default.pack(t,o,s),o}(e,t));var r=[i.buffer,a.buffer],n={positions:i.buffer,packedBuffer:a.buffer},o=e._verticesPromise=_O.scheduleTask(n,r);if(!Object(s.default)(o))return;o.then((function(t){e._positions=new Float64Array(t.positions),e._ready=!0}))}if(e._ready&&!Object(s.default)(e._billboardCollection)){i=e._positions;var l=e._batchTable,u=e._batchIds,d=e._billboardCollection=new ny.a({batchTable:l}),f=e._labelCollection=new fy.a({batchTable:l}),c=e._polylineCollection=new pO;c._useHighlightColor=!0;for(var h=i.length/3,p=0;p<h;++p){var m=u[p],_=v.default.unpack(i,3*p,gO),g=d.add();g.position=_,g._batchIndex=m;var b=f.add();b.text=" ",b.position=_,b._batchIndex=m,c.add().positions=[v.default.clone(_),v.default.clone(_)]}e._positions=void 0,e._packedBuffer=void 0}}}mO.prototype.createFeatures=function(e,t){for(var i=this._billboardCollection,a=this._labelCollection,r=this._polylineCollection,n=this._batchIds,o=n.length,s=0;s<o;++s){var l=n[s],u=i.get(s),d=a.get(s),f=r.get(s);t[l]=new dy(e,l,u,d,f)}},mO.prototype.applyDebugSettings=function(e,t){e?(b.default.clone(t,this._billboardCollection._highlightColor),b.default.clone(t,this._labelCollection._highlightColor),b.default.clone(t,this._polylineCollection._highlightColor)):(b.default.clone(b.default.WHITE,this._billboardCollection._highlightColor),b.default.clone(b.default.WHITE,this._labelCollection._highlightColor),b.default.clone(b.default.WHITE,this._polylineCollection._highlightColor))};var bO=new b.default,yO=new b.default,OO=new b.default,wO=new b.default,xO=new b.default,EO=new b.default,TO=new w.a,CO=new w.a,AO=new O.a;mO.prototype.applyStyle=function(e,t){if(Object(s.default)(e))for(var i=this._batchIds,a=i.length,r=0;r<a;++r){var n=t[i[r]];if(Object(s.default)(e.show)&&(n.show=e.show.evaluate(n)),Object(s.default)(e.pointSize)&&(n.pointSize=e.pointSize.evaluate(n)),Object(s.default)(e.color)&&(n.color=e.color.evaluateColor(n,bO)),Object(s.default)(e.pointOutlineColor)&&(n.pointOutlineColor=e.pointOutlineColor.evaluateColor(n,yO)),Object(s.default)(e.pointOutlineWidth)&&(n.pointOutlineWidth=e.pointOutlineWidth.evaluate(n)),Object(s.default)(e.labelColor)&&(n.labelColor=e.labelColor.evaluateColor(n,OO)),Object(s.default)(e.labelOutlineColor)&&(n.labelOutlineColor=e.labelOutlineColor.evaluateColor(n,wO)),Object(s.default)(e.labelOutlineWidth)&&(n.labelOutlineWidth=e.labelOutlineWidth.evaluate(n)),Object(s.default)(e.font)&&(n.font=e.font.evaluate(n)),Object(s.default)(e.labelStyle)&&(n.labelStyle=e.labelStyle.evaluate(n)),Object(s.default)(e.labelText)?n.labelText=e.labelText.evaluate(n):n.labelText=void 0,Object(s.default)(e.backgroundColor)&&(n.backgroundColor=e.backgroundColor.evaluateColor(n,xO)),Object(s.default)(e.backgroundPadding)&&(n.backgroundPadding=e.backgroundPadding.evaluate(n)),Object(s.default)(e.backgroundEnabled)&&(n.backgroundEnabled=e.backgroundEnabled.evaluate(n)),Object(s.default)(e.scaleByDistance)){var o=e.scaleByDistance.evaluate(n);TO.near=o.x,TO.nearValue=o.y,TO.far=o.z,TO.farValue=o.w,n.scaleByDistance=TO}else n.scaleByDistance=void 0;if(Object(s.default)(e.translucencyByDistance)){var l=e.translucencyByDistance.evaluate(n);CO.near=l.x,CO.nearValue=l.y,CO.far=l.z,CO.farValue=l.w,n.translucencyByDistance=CO}else n.translucencyByDistance=void 0;if(Object(s.default)(e.distanceDisplayCondition)){var u=e.distanceDisplayCondition.evaluate(n);AO.near=u.x,AO.far=u.y,n.distanceDisplayCondition=AO}else n.distanceDisplayCondition=void 0;Object(s.default)(e.heightOffset)&&(n.heightOffset=e.heightOffset.evaluate(n)),Object(s.default)(e.anchorLineEnabled)&&(n.anchorLineEnabled=e.anchorLineEnabled.evaluate(n)),Object(s.default)(e.anchorLineColor)&&(n.anchorLineColor=e.anchorLineColor.evaluateColor(n,EO)),Object(s.default)(e.image)?n.image=e.image.evaluate(n):n.image=void 0,Object(s.default)(e.disableDepthTestDistance)&&(n.disableDepthTestDistance=e.disableDepthTestDistance.evaluate(n)),Object(s.default)(e.horizontalOrigin)&&(n.horizontalOrigin=e.horizontalOrigin.evaluate(n)),Object(s.default)(e.verticalOrigin)&&(n.verticalOrigin=e.verticalOrigin.evaluate(n)),Object(s.default)(e.labelHorizontalOrigin)&&(n.labelHorizontalOrigin=e.labelHorizontalOrigin.evaluate(n)),Object(s.default)(e.labelVerticalOrigin)&&(n.labelVerticalOrigin=e.labelVerticalOrigin.evaluate(n))}else!function(e,t){for(var i=e._batchIds,a=i.length,r=0;r<a;++r){var n=t[i[r]];n.show=!0,n.pointSize=dy.defaultPointSize,n.color=dy.defaultColor,n.pointOutlineColor=dy.defaultPointOutlineColor,n.pointOutlineWidth=dy.defaultPointOutlineWidth,n.labelColor=b.default.WHITE,n.labelOutlineColor=b.default.WHITE,n.labelOutlineWidth=1,n.font="30px sans-serif",n.labelStyle=Ud.a.FILL,n.labelText=void 0,n.backgroundColor=new b.default(.165,.165,.165,.8),n.backgroundPadding=new g.default(7,5),n.backgroundEnabled=!1,n.scaleByDistance=void 0,n.translucencyByDistance=void 0,n.distanceDisplayCondition=void 0,n.heightOffset=0,n.anchorLineEnabled=!1,n.anchorLineColor=b.default.WHITE,n.image=void 0,n.disableDepthTestDistance=0,n.horizontalOrigin=E.default.CENTER,n.verticalOrigin=T.default.CENTER,n.labelHorizontalOrigin=E.default.RIGHT,n.labelVerticalOrigin=T.default.BASELINE}}(this,t)},mO.prototype.update=function(e){vO(this,e.mapProjection.ellipsoid),this._ready&&(this._polylineCollection.update(e),this._billboardCollection.update(e),this._labelCollection.update(e),this._resolvedPromise||(this._readyPromise.resolve(),this._resolvedPromise=!0))},mO.prototype.isDestroyed=function(){return!1},mO.prototype.destroy=function(){return this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy(),this._labelCollection=this._labelCollection&&this._labelCollection.destroy(),this._polylineCollection=this._polylineCollection&&this._polylineCollection.destroy(),Object(l.default)(this)};var jO=mO;function PO(e){this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._positions=e.positions,this._counts=e.counts,this._indices=e.indices,this._indexCounts=e.indexCounts,this._indexOffsets=void 0,this._batchTableColors=void 0,this._packedBuffer=void 0,this._batchedPositions=void 0,this._transferrableBatchIds=void 0,this._vertexBatchIds=void 0,this._ellipsoid=Object(o.default)(e.ellipsoid,tt.default.WGS84),this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._polygonMinimumHeights=e.polygonMinimumHeights,this._polygonMaximumHeights=e.polygonMaximumHeights,this._center=Object(o.default)(e.center,v.default.ZERO),this._rectangle=e.rectangle,this._center=void 0,this._boundingVolume=e.boundingVolume,this._boundingVolumes=void 0,this._batchedIndices=void 0,this._ready=!1,this._readyPromise=Ef.default.defer(),this._verticesPromise=void 0,this._primitive=void 0,this.debugWireframe=!1,this.forceRebatch=!1,this.classificationType=Z.a.BOTH}Object.defineProperties(PO.prototype,{trianglesLength:{get:function(){return Object(s.default)(this._primitive)?this._primitive.trianglesLength:0}},geometryByteLength:{get:function(){return Object(s.default)(this._primitive)?this._primitive.geometryByteLength:0}},readyPromise:{get:function(){return this._readyPromise.promise}}});var SO=new Uc.default("createVectorTilePolygons"),IO=new b.default;function LO(e){if(!Object(s.default)(e._primitive)){if(!Object(s.default)(e._verticesPromise)){var t=e._positions,i=e._counts,a=e._indexCounts,r=e._indices,n=e._transferrableBatchIds,o=e._batchTableColors,l=e._packedBuffer;if(!Object(s.default)(o)){t=e._positions=Object(Bc.a)(e._positions),i=e._counts=Object(Bc.a)(e._counts),a=e._indexCounts=Object(Bc.a)(e._indexCounts),r=e._indices=Object(Bc.a)(e._indices),e._center=e._ellipsoid.cartographicToCartesian(Yi.default.center(e._rectangle)),n=e._transferrableBatchIds=new Uint32Array(e._batchIds),o=e._batchTableColors=new Uint32Array(n.length);for(var u=e._batchTable,d=o.length,f=0;f<d;++f){var c=u.getColor(f,IO);o[f]=c.toRgba()}l=e._packedBuffer=function(e){var t=new Float64Array(3+v.default.packedLength+tt.default.packedLength+Yi.default.packedLength),i=0;return t[i++]=e._indices.BYTES_PER_ELEMENT,t[i++]=e._minimumHeight,t[i++]=e._maximumHeight,v.default.pack(e._center,t,i),i+=v.default.packedLength,tt.default.pack(e._ellipsoid,t,i),i+=tt.default.packedLength,Yi.default.pack(e._rectangle,t,i),t}(e)}var h=[t.buffer,i.buffer,a.buffer,r.buffer,n.buffer,o.buffer,l.buffer],p={packedBuffer:l.buffer,positions:t.buffer,counts:i.buffer,indexCounts:a.buffer,indices:r.buffer,batchIds:n.buffer,batchTableColors:o.buffer},m=e._polygonMinimumHeights,_=e._polygonMaximumHeights;Object(s.default)(m)&&Object(s.default)(_)&&(m=Object(Bc.a)(m),_=Object(Bc.a)(_),h.push(m.buffer,_.buffer),p.minimumHeights=m,p.maximumHeights=_);var g=e._verticesPromise=SO.scheduleTask(p,h);if(!Object(s.default)(g))return;Object(Ef.default)(g,(function(t){e._positions=void 0,e._counts=void 0,e._polygonMinimumHeights=void 0,e._polygonMaximumHeights=void 0;var i=new Float64Array(t.packedBuffer),a=i[0];!function(e,t){for(var i=1,a=t[i++],r=e._boundingVolumes=new Array(a),n=0;n<a;++n)r[n]=ro.a.unpack(t,i),i+=ro.a.packedLength;for(var o=t[i++],s=e._batchedIndices=new Array(o),l=0;l<o;++l){var u=b.default.unpack(t,i);i+=b.default.packedLength;for(var d=t[i++],f=t[i++],c=t[i++],h=new Array(c),p=0;p<c;++p)h[p]=t[i++];s[l]=new fg({color:u,offset:d,count:f,batchIds:h})}}(e,i),e._indices=2===Gi.a.getSizeInBytes(a)?new Uint16Array(t.indices):new Uint32Array(t.indices),e._indexOffsets=new Uint32Array(t.indexOffsets),e._indexCounts=new Uint32Array(t.indexCounts),e._batchedPositions=new Float32Array(t.positions),e._vertexBatchIds=new Uint16Array(t.batchIds),e._ready=!0}))}e._ready&&!Object(s.default)(e._primitive)&&(e._primitive=new lv({batchTable:e._batchTable,positions:e._batchedPositions,batchIds:e._batchIds,vertexBatchIds:e._vertexBatchIds,indices:e._indices,indexOffsets:e._indexOffsets,indexCounts:e._indexCounts,batchedIndices:e._batchedIndices,boundingVolume:e._boundingVolume,boundingVolumes:e._boundingVolumes,center:e._center}),e._batchTable=void 0,e._batchIds=void 0,e._positions=void 0,e._counts=void 0,e._indices=void 0,e._indexCounts=void 0,e._indexOffsets=void 0,e._batchTableColors=void 0,e._packedBuffer=void 0,e._batchedPositions=void 0,e._transferrableBatchIds=void 0,e._vertexBatchIds=void 0,e._ellipsoid=void 0,e._minimumHeight=void 0,e._maximumHeight=void 0,e._polygonMinimumHeights=void 0,e._polygonMaximumHeights=void 0,e._center=void 0,e._rectangle=void 0,e._boundingVolume=void 0,e._boundingVolumes=void 0,e._batchedIndices=void 0,e._verticesPromise=void 0,e._readyPromise.resolve())}}PO.prototype.createFeatures=function(e,t){this._primitive.createFeatures(e,t)},PO.prototype.applyDebugSettings=function(e,t){this._primitive.applyDebugSettings(e,t)},PO.prototype.applyStyle=function(e,t){this._primitive.applyStyle(e,t)},PO.prototype.updateCommands=function(e,t){this._primitive.updateCommands(e,t)},PO.prototype.update=function(e){LO(this),this._ready&&(this._primitive.debugWireframe=this.debugWireframe,this._primitive.forceRebatch=this.forceRebatch,this._primitive.classificationType=this.classificationType,this._primitive.update(e))},PO.prototype.isDestroyed=function(){return!1},PO.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),Object(l.default)(this)};var DO=PO;function MO(e){this._positions=e.positions,this._widths=e.widths,this._counts=e.counts,this._batchIds=e.batchIds,this._ellipsoid=Object(o.default)(e.ellipsoid,tt.default.WGS84),this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._center=e.center,this._rectangle=e.rectangle,this._boundingVolume=e.boundingVolume,this._batchTable=e.batchTable,this._va=void 0,this._sp=void 0,this._rs=void 0,this._uniformMap=void 0,this._command=void 0,this._transferrableBatchIds=void 0,this._packedBuffer=void 0,this._currentPositions=void 0,this._previousPositions=void 0,this._nextPositions=void 0,this._expandAndWidth=void 0,this._vertexBatchIds=void 0,this._indices=void 0,this._constantColor=b.default.clone(b.default.WHITE),this._highlightColor=this._constantColor,this._trianglesLength=0,this._geometryByteLength=0,this._ready=!1,this._readyPromise=Ef.default.defer(),this._verticesPromise=void 0}Object.defineProperties(MO.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},readyPromise:{get:function(){return this._readyPromise.promise}}});var RO=new Uc.default("createVectorTilePolylines"),NO={previousPosition:0,currentPosition:1,nextPosition:2,expandAndWidth:3,a_batchId:4};function VO(e,t){if(!Object(s.default)(e._va)){if(!Object(s.default)(e._verticesPromise)){var i=e._positions,a=e._widths,r=e._counts,n=e._transferrableBatchIds,o=e._packedBuffer;Object(s.default)(o)||(i=e._positions=Object(Bc.a)(i),a=e._widths=Object(Bc.a)(a),r=e._counts=Object(Bc.a)(r),n=e._transferrableBatchIds=Object(Bc.a)(e._batchIds),o=e._packedBuffer=function(e){var t=e._rectangle,i=e._minimumHeight,a=e._maximumHeight,r=e._ellipsoid,n=e._center,o=2+Yi.default.packedLength+tt.default.packedLength+v.default.packedLength,s=new Float64Array(o),l=0;return s[l++]=i,s[l++]=a,Yi.default.pack(t,s,l),l+=Yi.default.packedLength,tt.default.pack(r,s,l),l+=tt.default.packedLength,v.default.pack(n,s,l),s}(e));var l=[i.buffer,a.buffer,r.buffer,n.buffer,o.buffer],u={positions:i.buffer,widths:a.buffer,counts:r.buffer,batchIds:n.buffer,packedBuffer:o.buffer},d=e._verticesPromise=RO.scheduleTask(u,l);if(!Object(s.default)(d))return;Object(Ef.default)(d,(function(t){e._currentPositions=new Float32Array(t.currentPositions),e._previousPositions=new Float32Array(t.previousPositions),e._nextPositions=new Float32Array(t.nextPositions),e._expandAndWidth=new Float32Array(t.expandAndWidth),e._vertexBatchIds=new Uint16Array(t.batchIds);var i=t.indexDatatype;e._indices=i===Gi.a.UNSIGNED_SHORT?new Uint16Array(t.indices):new Uint32Array(t.indices),e._ready=!0}))}if(e._ready&&!Object(s.default)(e._va)){var f=e._currentPositions,c=e._previousPositions,h=e._nextPositions,p=e._expandAndWidth,m=e._vertexBatchIds,_=e._indices,g=c.byteLength+f.byteLength+h.byteLength;g+=p.byteLength+m.byteLength+_.byteLength,e._trianglesLength=_.length/3,e._geometryByteLength=g;var b=Pf.a.createVertexBuffer({context:t,typedArray:c,usage:Sf.a.STATIC_DRAW}),y=Pf.a.createVertexBuffer({context:t,typedArray:f,usage:Sf.a.STATIC_DRAW}),O=Pf.a.createVertexBuffer({context:t,typedArray:h,usage:Sf.a.STATIC_DRAW}),w=Pf.a.createVertexBuffer({context:t,typedArray:p,usage:Sf.a.STATIC_DRAW}),x=Pf.a.createVertexBuffer({context:t,typedArray:m,usage:Sf.a.STATIC_DRAW}),E=Pf.a.createIndexBuffer({context:t,typedArray:_,usage:Sf.a.STATIC_DRAW,indexDatatype:2===_.BYTES_PER_ELEMENT?Gi.a.UNSIGNED_SHORT:Gi.a.UNSIGNED_INT}),T=[{index:NO.previousPosition,vertexBuffer:b,componentDatatype:se.a.FLOAT,componentsPerAttribute:3},{index:NO.currentPosition,vertexBuffer:y,componentDatatype:se.a.FLOAT,componentsPerAttribute:3},{index:NO.nextPosition,vertexBuffer:O,componentDatatype:se.a.FLOAT,componentsPerAttribute:3},{index:NO.expandAndWidth,vertexBuffer:w,componentDatatype:se.a.FLOAT,componentsPerAttribute:2},{index:NO.a_batchId,vertexBuffer:x,componentDatatype:se.a.UNSIGNED_SHORT,componentsPerAttribute:1}];e._va=new Ff.a({context:t,attributes:T,indexBuffer:E}),e._positions=void 0,e._widths=void 0,e._counts=void 0,e._ellipsoid=void 0,e._minimumHeight=void 0,e._maximumHeight=void 0,e._rectangle=void 0,e._transferrableBatchIds=void 0,e._packedBuffer=void 0,e._currentPositions=void 0,e._previousPositions=void 0,e._nextPositions=void 0,e._expandAndWidth=void 0,e._vertexBatchIds=void 0,e._indices=void 0,e._readyPromise.resolve()}}}var BO=new nt.default,UO=new v.default;MO.prototype.createFeatures=function(e,t){for(var i=this._batchIds,a=i.length,r=0;r<a;++r){var n=i[r];t[n]=new sg.a(e,n)}},MO.prototype.applyDebugSettings=function(e,t){this._highlightColor=e?t:this._constantColor};var FO=new b.default,HO=b.default.WHITE;MO.prototype.applyStyle=function(e,t){if(Object(s.default)(e))for(var i=this._batchIds,a=i.length,r=0;r<a;++r){var n=t[i[r]];n.color=Object(s.default)(e.color)?e.color.evaluateColor(n,FO):HO,n.show=!Object(s.default)(e.show)||e.show.evaluate(n)}else!function(e,t){for(var i=e._batchIds,a=i.length,r=0;r<a;++r){var n=t[i[r]];n.show=!0,n.color=b.default.WHITE}}(this,t)},MO.prototype.update=function(e){var t=e.context;if(VO(this,t),function(e,t){Object(s.default)(e._uniformMap)||(e._uniformMap={u_modifiedModelView:function(){var i=t.uniformState.view;return nt.default.clone(i,BO),nt.default.multiplyByPoint(BO,e._center,UO),nt.default.setTranslation(BO,UO,BO),BO},u_highlightColor:function(){return e._highlightColor}})}(this,t),function(e,t){if(!Object(s.default)(e._sp)){var i=e._batchTable,a=i.getVertexShaderCallback(!1,"a_batchId",void 0)("attribute vec4 currentPosition;\nattribute vec4 previousPosition;\nattribute vec4 nextPosition;\nattribute vec2 expandAndWidth;\nattribute float a_batchId;\n\nuniform mat4 u_modifiedModelView;\n\nvoid main()\n{\n    float expandDir = expandAndWidth.x;\n    float width = abs(expandAndWidth.y) + 0.5;\n    bool usePrev = expandAndWidth.y < 0.0;\n\n    vec4 p = u_modifiedModelView * currentPosition;\n    vec4 prev = u_modifiedModelView * previousPosition;\n    vec4 next = u_modifiedModelView * nextPosition;\n\n    float angle;\n    vec4 positionWC = getPolylineWindowCoordinatesEC(p, prev, next, expandDir, width, usePrev, angle);\n    gl_Position = czm_viewportOrthographic * positionWC;\n\n#ifdef LOG_DEPTH\n    czm_vertexLogDepth(czm_projection * p);\n#endif\n}\n"),r=i.getFragmentShaderCallback()("uniform vec4 u_highlightColor; \nvoid main()\n{\n    gl_FragColor = u_highlightColor;\n}\n",!1,void 0),n=new Nf.a({defines:["VECTOR_TILE",bf.default.isInternetExplorer()?"":"CLIP_POLYLINE"],sources:[hy.a,a]}),o=new Nf.a({defines:["VECTOR_TILE"],sources:[r]});e._sp=Rf.a.fromCache({context:t,vertexShaderSource:n,fragmentShaderSource:o,attributeLocations:NO})}}(this,t),function(e){if(!Object(s.default)(e._rs)){e._rs=Df.a.fromCache({blending:Rc.a.ALPHA_BLEND,depthMask:!1,depthTest:{enabled:!0},polygonOffset:{enabled:!0,factor:-5,units:-5}})}}(this),this._ready){var i=e.passes;(i.render||i.pick)&&function(e,t){if(!Object(s.default)(e._command)){var i=e._batchTable.getUniformMapCallback()(e._uniformMap);e._command=new If.a({owner:e,vertexArray:e._va,renderState:e._rs,shaderProgram:e._sp,uniformMap:i,boundingVolume:e._boundingVolume,pass:Lf.a.TRANSLUCENT,pickId:e._batchTable.getPickId()})}t.commandList.push(e._command)}(this,e)}},MO.prototype.isDestroyed=function(){return!1},MO.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),Object(l.default)(this)};var kO=MO;function zO(e,t,i,a,r){this._tileset=e,this._tile=t,this._resource=i,this._polygons=void 0,this._polylines=void 0,this._points=void 0,this._contentReadyPromise=void 0,this._readyPromise=Ef.default.defer(),this._batchTable=void 0,this._features=void 0,this.featurePropertiesDirty=!1,function(e,t,i){i=Object(o.default)(i,0);var a=new Uint8Array(t),r=new DataView(t);i+=GO;var n=r.getUint32(i,!0);if(1!==n)throw new $f.default("Only Vector tile version 1 is supported.  Version "+n+" is not.");i+=GO;var l=r.getUint32(i,!0);if(i+=GO,0===l)return void e._readyPromise.resolve(e);var u=r.getUint32(i,!0);if(i+=GO,0===u)throw new $f.default("Feature table must have a byte length greater than zero");var d=r.getUint32(i,!0);i+=GO;var f=r.getUint32(i,!0);i+=GO;var c=r.getUint32(i,!0);i+=GO;var h=r.getUint32(i,!0);i+=GO;var p=r.getUint32(i,!0);i+=GO;var m=r.getUint32(i,!0);i+=GO;var _=r.getUint32(i,!0);i+=GO;var g=Object(Of.a)(a,i,u),b=JSON.parse(g);i+=u;var y,O,w=new Uint8Array(t,i,d);if(i+=d,f>0){var x=Object(Of.a)(a,i,f);y=JSON.parse(x),i+=f,c>0&&(O=new Uint8Array(t,i,c),O=new Uint8Array(O),i+=c)}var E=Object(o.default)(b.POLYGONS_LENGTH,0),T=Object(o.default)(b.POLYLINES_LENGTH,0),C=Object(o.default)(b.POINTS_LENGTH,0),A=E+T+C,j=new og(e,A,y,O,function(e){return function(t,i){Object(s.default)(e._polygons)&&e._polygons.updateCommands(t,i)}}(e));if(e._batchTable=j,0===A)return;var P=new dg(b,w),S=P.getGlobalProperty("REGION");if(!Object(s.default)(S))throw new $f.default("Feature table global property: REGION must be defined");var I=Yi.default.unpack(S),L=S[4],D=S[5],M=e._tile.computedTransform,R=P.getGlobalProperty("RTC_CENTER",se.a.FLOAT,3);Object(s.default)(R)?(R=v.default.unpack(R),nt.default.multiplyByPoint(M,R,R)):((R=Yi.default.center(I)).height=Ne.default.lerp(L,D,.5),R=tt.default.WGS84.cartographicToCartesian(R));var N=function(e,t){var i,a,r,n,l=Object(o.default)(e.POLYGONS_LENGTH,0),u=Object(o.default)(e.POLYLINES_LENGTH,0),d=Object(o.default)(e.POINTS_LENGTH,0);if(l>0&&Object(s.default)(e.POLYGON_BATCH_IDS)){var f=t.byteOffset+e.POLYGON_BATCH_IDS.byteOffset;i=new Uint16Array(t.buffer,f,l)}if(u>0&&Object(s.default)(e.POLYLINE_BATCH_IDS)){var c=t.byteOffset+e.POLYLINE_BATCH_IDS.byteOffset;a=new Uint16Array(t.buffer,c,u)}if(d>0&&Object(s.default)(e.POINT_BATCH_IDS)){var h=t.byteOffset+e.POINT_BATCH_IDS.byteOffset;r=new Uint16Array(t.buffer,h,d)}var p=Object(s.default)(i)||Object(s.default)(a)||Object(s.default)(r),m=l>0&&!Object(s.default)(i)||u>0&&!Object(s.default)(a)||d>0&&!Object(s.default)(r);if(p&&m)throw new $f.default("If one group of batch ids is defined, then all batch ids must be defined.");if(!Object(s.default)(i)&&!Object(s.default)(a)&&!Object(s.default)(r)){var _=0;if(!Object(s.default)(i)&&l>0)for(i=new Uint16Array(l),n=0;n<l;++n)i[n]=_++;if(!Object(s.default)(a)&&u>0)for(a=new Uint16Array(u),n=0;n<u;++n)a[n]=_++;if(!Object(s.default)(r)&&d>0)for(r=new Uint16Array(d),n=0;n<d;++n)r[n]=_++}return{polygons:i,polylines:a,points:r}}(b,w);if(i+=i%4,E>0){P.featuresLength=E;var V=Object(o.default)(P.getPropertyArray("POLYGON_COUNTS",se.a.UNSIGNED_INT,1),P.getPropertyArray("POLYGON_COUNT",se.a.UNSIGNED_INT,1));if(!Object(s.default)(V))throw new $f.default("Feature table property: POLYGON_COUNTS must be defined when POLYGONS_LENGTH is greater than 0");var B=Object(o.default)(P.getPropertyArray("POLYGON_INDEX_COUNTS",se.a.UNSIGNED_INT,1),P.getPropertyArray("POLYGON_INDEX_COUNT",se.a.UNSIGNED_INT,1));if(!Object(s.default)(B))throw new $f.default("Feature table property: POLYGON_INDEX_COUNTS must be defined when POLYGONS_LENGTH is greater than 0");var U=V.reduce((function(e,t){return e+2*t}),0),F=B.reduce((function(e,t){return e+t}),0),H=new Uint32Array(t,i,F);i+=h;var k,z,G=new Uint16Array(t,i,U);i+=p,Object(s.default)(b.POLYGON_MINIMUM_HEIGHTS)&&Object(s.default)(b.POLYGON_MAXIMUM_HEIGHTS)&&(k=P.getPropertyArray("POLYGON_MINIMUM_HEIGHTS",se.a.FLOAT,1),z=P.getPropertyArray("POLYGON_MAXIMUM_HEIGHTS",se.a.FLOAT,1)),e._polygons=new DO({positions:G,counts:V,indexCounts:B,indices:H,minimumHeight:L,maximumHeight:D,polygonMinimumHeights:k,polygonMaximumHeights:z,center:R,rectangle:I,boundingVolume:e.tile.boundingVolume.boundingVolume,batchTable:j,batchIds:N.polygons,modelMatrix:M})}if(T>0){P.featuresLength=T;var q=Object(o.default)(P.getPropertyArray("POLYLINE_COUNTS",se.a.UNSIGNED_INT,1),P.getPropertyArray("POLYLINE_COUNT",se.a.UNSIGNED_INT,1));if(!Object(s.default)(q))throw new $f.default("Feature table property: POLYLINE_COUNTS must be defined when POLYLINES_LENGTH is greater than 0");var W=P.getPropertyArray("POLYLINE_WIDTHS",se.a.UNSIGNED_SHORT,1);if(!Object(s.default)(W)){W=new Uint16Array(T);for(var Y=0;Y<T;++Y)W[Y]=2}var K=q.reduce((function(e,t){return e+3*t}),0),X=new Uint16Array(t,i,K);i+=m,e._polylines=new kO({positions:X,widths:W,counts:q,batchIds:N.polylines,minimumHeight:L,maximumHeight:D,center:R,rectangle:I,boundingVolume:e.tile.boundingVolume.boundingVolume,batchTable:j})}if(C>0){var Z=new Uint16Array(t,i,3*C);i+=_,e._points=new jO({positions:Z,batchIds:N.points,minimumHeight:L,maximumHeight:D,rectangle:I,batchTable:j})}}(this,a,r)}Object.defineProperties(zO.prototype,{featuresLength:{get:function(){return Object(s.default)(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return Object(s.default)(this._points)?this._points.pointsLength:0}},trianglesLength:{get:function(){var e=0;return Object(s.default)(this._polygons)&&(e+=this._polygons.trianglesLength),Object(s.default)(this._polylines)&&(e+=this._polylines.trianglesLength),e}},geometryByteLength:{get:function(){var e=0;return Object(s.default)(this._polygons)&&(e+=this._polygons.geometryByteLength),Object(s.default)(this._polylines)&&(e+=this._polylines.geometryByteLength),e}},texturesByteLength:{get:function(){return Object(s.default)(this._points)?this._points.texturesByteLength:0}},batchTableByteLength:{get:function(){return Object(s.default)(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var GO=Uint32Array.BYTES_PER_ELEMENT;function qO(e){var t=e.featuresLength;if(!Object(s.default)(e._features)&&t>0){var i=new Array(t);Object(s.default)(e._polygons)&&e._polygons.createFeatures(e,i),Object(s.default)(e._polylines)&&e._polylines.createFeatures(e,i),Object(s.default)(e._points)&&e._points.createFeatures(e,i),e._features=i}}zO.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)},zO.prototype.getFeature=function(e){return qO(this),this._features[e]},zO.prototype.applyDebugSettings=function(e,t){Object(s.default)(this._polygons)&&this._polygons.applyDebugSettings(e,t),Object(s.default)(this._polylines)&&this._polylines.applyDebugSettings(e,t),Object(s.default)(this._points)&&this._points.applyDebugSettings(e,t)},zO.prototype.applyStyle=function(e){qO(this),Object(s.default)(this._polygons)&&this._polygons.applyStyle(e,this._features),Object(s.default)(this._polylines)&&this._polylines.applyStyle(e,this._features),Object(s.default)(this._points)&&this._points.applyStyle(e,this._features)},zO.prototype.update=function(e,t){var i=!0;if(Object(s.default)(this._polygons)&&(this._polygons.classificationType=this._tileset.classificationType,this._polygons.debugWireframe=this._tileset.debugWireframe,this._polygons.update(t),i=i&&this._polygons._ready),Object(s.default)(this._polylines)&&(this._polylines.update(t),i=i&&this._polylines._ready),Object(s.default)(this._points)&&(this._points.update(t),i=i&&this._points._ready),Object(s.default)(this._batchTable)&&i&&this._batchTable.update(e,t),!Object(s.default)(this._contentReadyPromise)){var a=Object(s.default)(this._points)?this._points.readyPromise:void 0,r=Object(s.default)(this._polygons)?this._polygons.readyPromise:void 0,n=Object(s.default)(this._polylines)?this._polylines.readyPromise:void 0,o=this;this._contentReadyPromise=Ef.default.all([a,r,n]).then((function(){o._readyPromise.resolve(o)}))}},zO.prototype.isDestroyed=function(){return!1},zO.prototype.destroy=function(){return this._polygons=this._polygons&&this._polygons.destroy(),this._polylines=this._polylines&&this._polylines.destroy(),this._points=this._points&&this._points.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Object(l.default)(this)};var WO=zO,YO={b3dm:function(e,t,i,a,r){return new jv(e,t,i,a,r)},pnts:function(e,t,i,a,r){return new iy(e,t,i,a,r)},i3dm:function(e,t,i,a,r){return new pb(e,t,i,a,r)},cmpt:function(e,t,i,a,r){return new Iv(e,t,i,a,r,YO)},json:function(e,t,i,a,r){return new ry(e,t,i,a,r)},geom:function(e,t,i,a,r){return new Fv(e,t,i,a,r)},vctr:function(e,t,i,a,r){return new WO(e,t,i,a,r)}},KO=YO,XO=Object.freeze({UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5}),ZO=i(554),JO=i(222);function QO(e,t){this._tileset=e,this._tile=t,this.featurePropertiesDirty=!1}Object.defineProperties(QO.prototype,{featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){}},readyPromise:{get:function(){}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){}},batchTable:{get:function(){}}}),QO.prototype.hasProperty=function(e,t){return!1},QO.prototype.getFeature=function(e){},QO.prototype.applyDebugSettings=function(e,t){},QO.prototype.applyStyle=function(e){},QO.prototype.update=function(e,t){},QO.prototype.isDestroyed=function(){return!1},QO.prototype.destroy=function(){return Object(l.default)(this)};var $O=QO,ew=i(433),tw=i(418);function iw(e,t){0===t&&(t=Ne.default.EPSILON7),this._boundingSphere=new r.default(e,t)}Object.defineProperties(iw.prototype,{center:{get:function(){return this._boundingSphere.center}},radius:{get:function(){return this._boundingSphere.radius}},boundingVolume:{get:function(){return this._boundingSphere}},boundingSphere:{get:function(){return this._boundingSphere}}}),iw.prototype.distanceToCamera=function(e){var t=this._boundingSphere;return Math.max(0,v.default.distance(t.center,e.camera.positionWC)-t.radius)},iw.prototype.intersectPlane=function(e){return r.default.intersectPlane(this._boundingSphere,e)},iw.prototype.update=function(e,t){v.default.clone(e,this._boundingSphere.center),this._boundingSphere.radius=t},iw.prototype.createDebugVolume=function(e){var t=new tw.a({radius:this.radius}),i=nt.default.fromTranslation(this.center,new nt.default.clone(nt.default.IDENTITY)),a=new de.a({geometry:t,id:"outline",modelMatrix:i,attributes:{color:oe.a.fromColor(e)}});return new _e.a({geometryInstances:a,appearance:new ie.a({translucent:!1,flat:!0}),asynchronous:!1})};var aw=iw,rw=new v.default,nw=new v.default,ow=new v.default,sw=new v.default;function lw(e,t,i){i=v.default.cross(e,t,i);var a=v.default.magnitude(i);return v.default.multiplyByScalar(i,Ne.default.EPSILON7/a,i)}function uw(e,t){var i=v.default.normalize(e,sw);return lw(e,v.default.equalsEpsilon(i,v.default.UNIT_X,Ne.default.EPSILON6)?v.default.UNIT_Y:v.default.UNIT_X,t)}function dw(e){var t=et.default.getColumn(e,0,rw),i=et.default.getColumn(e,1,nw),a=et.default.getColumn(e,2,ow),r=v.default.equals(t,v.default.ZERO),n=v.default.equals(i,v.default.ZERO),o=v.default.equals(a,v.default.ZERO);return r||n||o?r&&n&&o?(e[0]=Ne.default.EPSILON7,e[4]=Ne.default.EPSILON7,e[8]=Ne.default.EPSILON7,e):(!r||n||o?r||!n||o?r||n||!o?r?n?o||(i=lw(a,t=uw(a,t),i)):a=lw(i,t=uw(i,t),a):a=lw(i=uw(t,i),t,a):a=lw(i,t,a):i=lw(t,a,i):t=lw(i,a,t),et.default.setColumn(e,0,t,e),et.default.setColumn(e,1,i,e),et.default.setColumn(e,2,a,e),e):e}function fw(e,t){t=dw(t),this._orientedBoundingBox=new ro.a(e,t),this._boundingSphere=r.default.fromOrientedBoundingBox(this._orientedBoundingBox)}Object.defineProperties(fw.prototype,{boundingVolume:{get:function(){return this._orientedBoundingBox}},boundingSphere:{get:function(){return this._boundingSphere}}}),fw.prototype.distanceToCamera=function(e){return Math.sqrt(this._orientedBoundingBox.distanceSquaredTo(e.camera.positionWC))},fw.prototype.intersectPlane=function(e){return this._orientedBoundingBox.intersectPlane(e)},fw.prototype.update=function(e,t){v.default.clone(e,this._orientedBoundingBox.center),t=dw(t),et.default.clone(t,this._orientedBoundingBox.halfAxes),r.default.fromOrientedBoundingBox(this._orientedBoundingBox,this._boundingSphere)},fw.prototype.createDebugVolume=function(e){var t=new ne.a({minimum:new v.default(-1,-1,-1),maximum:new v.default(1,1,1)}),i=nt.default.fromRotationTranslation(this.boundingVolume.halfAxes,this.boundingVolume.center),a=new de.a({geometry:t,id:"outline",modelMatrix:i,attributes:{color:oe.a.fromColor(e)}});return new _e.a({geometryInstances:a,appearance:new ie.a({translucent:!1,flat:!0}),asynchronous:!1})};var cw=fw;function hw(e,t,i,a){this._tileset=e,this._header=i;var r=i.content;this.transform=Object(s.default)(i.transform)?nt.default.unpack(i.transform):nt.default.clone(nt.default.IDENTITY);var n,o,l,u,d,f,c,h,p=Object(s.default)(a)?a.computedTransform:e.modelMatrix,m=nt.default.multiply(p,this.transform,new nt.default),_=Object(s.default)(a)?a._initialTransform:nt.default.IDENTITY;if(this._initialTransform=nt.default.multiply(_,this.transform,new nt.default),this.computedTransform=m,this._boundingVolume=this.createBoundingVolume(i.boundingVolume,m),this._boundingVolume2D=void 0,Object(s.default)(r)&&Object(s.default)(r.boundingVolume)&&(n=this.createBoundingVolume(r.boundingVolume,m)),this._contentBoundingVolume=n,this._contentBoundingVolume2D=void 0,Object(s.default)(i.viewerRequestVolume)&&(o=this.createBoundingVolume(i.viewerRequestVolume,m)),this._viewerRequestVolume=o,this.geometricError=i.geometricError,this._geometricError=i.geometricError,Object(s.default)(this._geometricError)||(this._geometricError=Object(s.default)(a)?a.geometricError:e._geometricError,hw._deprecationWarning("geometricErrorUndefined","Required property geometricError is undefined for this tile. Using parent's geometric error instead.")),this.updateGeometricErrorScale(),Object(s.default)(i.refine)?("replace"!==i.refine&&"add"!==i.refine||hw._deprecationWarning("lowercase-refine",'This tile uses a lowercase refine "'+i.refine+'". Instead use "'+i.refine.toUpperCase()+'".'),l="REPLACE"===i.refine.toUpperCase()?mb.a.REPLACE:mb.a.ADD):l=Object(s.default)(a)?a.refine:mb.a.REPLACE,this.refine=l,this.children=[],this.parent=a,t=pf.default.createIfNeeded(t),Object(s.default)(r)){var g=r.uri;Object(s.default)(r.url)&&(hw._deprecationWarning("contentUrl",'This tileset JSON uses the "content.url" property which has been deprecated. Use "content.uri" instead.'),g=r.url),d=!1,f=XO.UNLOADED,c=t.getDerivedResource({url:g}),h=w_.a.getServerKey(c.getUrlComponent())}else u=new $O(e,this),d=!0,f=XO.READY;this._content=u,this._contentResource=c,this._contentState=f,this._contentReadyToProcessPromise=void 0,this._contentReadyPromise=void 0,this._expiredContent=void 0,this._serverKey=h,this.hasEmptyContent=d,this.hasTilesetContent=!1,this.cacheNode=void 0;var v,y,O=i.expire;Object(s.default)(O)&&(v=O.duration,Object(s.default)(O.date)&&(y=fh.default.fromIso8601(O.date))),this.expireDuration=v,this.expireDate=y,this.lastStyleTime=0,this._optimChildrenWithinParent=ZO.a.NOT_COMPUTED,this.clippingPlanesDirty=!1,this.priorityDeferred=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._screenSpaceErrorProgressiveResolution=0,this._visibilityPlaneMask=0,this._visible=!1,this._inRequestVolume=!1,this._finalResolution=!0,this._depth=0,this._stackLength=0,this._selectionDepth=0,this._updatedVisibilityFrame=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._ancestorWithContent=void 0,this._ancestorWithContentAvailable=void 0,this._refines=!1,this._shouldSelect=!1,this._isClipped=!0,this._clippingPlanesState=0,this._debugBoundingVolume=void 0,this._debugContentBoundingVolume=void 0,this._debugViewerRequestVolume=void 0,this._debugColor=b.default.fromRandom({alpha:1}),this._debugColorizeTiles=!1,this._priority=0,this._priorityHolder=this,this._priorityProgressiveResolution=!1,this._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1,this._priorityReverseScreenSpaceError=0,this._foveatedFactor=0,this._wasMinPriorityChild=!1,this._loadTimestamp=new fh.default,this._commandsLength=0,this._color=void 0,this._colorDirty=!1,this._request=void 0}hw._deprecationWarning=m_.default,Object.defineProperties(hw.prototype,{tileset:{get:function(){return this._tileset}},content:{get:function(){return this._content}},boundingVolume:{get:function(){return this._boundingVolume}},contentBoundingVolume:{get:function(){return Object(o.default)(this._contentBoundingVolume,this._boundingVolume)}},boundingSphere:{get:function(){return this._boundingVolume.boundingSphere}},extras:{get:function(){return this._header.extras}},color:{get:function(){return Object(s.default)(this._color)||(this._color=new b.default),b.default.clone(this._color)},set:function(e){this._color=b.default.clone(e,this._color),this._colorDirty=!0}},contentAvailable:{get:function(){return this.contentReady&&!this.hasEmptyContent&&!this.hasTilesetContent||Object(s.default)(this._expiredContent)&&!this.contentFailed}},contentReady:{get:function(){return this._contentState===XO.READY}},contentUnloaded:{get:function(){return this._contentState===XO.UNLOADED}},contentExpired:{get:function(){return this._contentState===XO.EXPIRED}},contentFailed:{get:function(){return this._contentState===XO.FAILED}},contentReadyToProcessPromise:{get:function(){if(Object(s.default)(this._contentReadyToProcessPromise))return this._contentReadyToProcessPromise.promise}},contentReadyPromise:{get:function(){if(Object(s.default)(this._contentReadyPromise))return this._contentReadyPromise.promise}},commandsLength:{get:function(){return this._commandsLength}}});var pw=new v.default;var mw=new fh.default;hw.prototype.getScreenSpaceError=function(e,t,i){var a=this._tileset,r=Object(o.default)(i,1),n=Object(s.default)(this.parent)?this.parent.geometricError:a._geometricError,l=t?n:this.geometricError;if(0===l)return 0;var u,d=e.camera,f=d.frustum,c=e.context,h=c.drawingBufferWidth,p=c.drawingBufferHeight*r;if(e.mode===Ve.a.SCENE2D||f instanceof y_.a){Object(s.default)(f._offCenterFrustum)&&(f=f._offCenterFrustum),u=l/(Math.max(f.top-f.bottom,f.right-f.left)/Math.max(h,p))}else{var m=Math.max(this._distanceToCamera,Ne.default.EPSILON7);if(u=l*p/(m*d.frustum.sseDenominator),a.dynamicScreenSpaceError){var _=a._dynamicScreenSpaceErrorComputedDensity,g=a.dynamicScreenSpaceErrorFactor;u-=Ne.default.fog(m,_)*g}}return u/=e.pixelRatio},hw.prototype.updateVisibility=function(e){var t=this.parent,i=this._tileset,a=Object(s.default)(t)?t.computedTransform:i.modelMatrix,r=Object(s.default)(t)?t._visibilityPlaneMask:v_.a.MASK_INDETERMINATE;this.updateTransform(a),this._distanceToCamera=this.distanceToTile(e),this._centerZDepth=this.distanceToTileCenter(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._screenSpaceErrorProgressiveResolution=this.getScreenSpaceError(e,!1,i.progressiveResolutionHeightFraction),this._visibilityPlaneMask=this.visibility(e,r),this._visible=this._visibilityPlaneMask!==v_.a.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._priorityReverseScreenSpaceError=function(e,t){var i=t.parent,a=Object(s.default)(i)&&(!e._skipLevelOfDetail||0===t._screenSpaceError||i.hasTilesetContent)?i._screenSpaceError:t._screenSpaceError;return e.root._screenSpaceError-a}(i,this),this._priorityProgressiveResolution=function(e,t){if(e.progressiveResolutionHeightFraction<=0||e.progressiveResolutionHeightFraction>.5)return!1;var i=t._screenSpaceErrorProgressiveResolution>e._maximumScreenSpaceError;t._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1;var a=t.parent,r=e._maximumScreenSpaceError,n=t._screenSpaceErrorProgressiveResolution<=r,o=Object(s.default)(a)&&a._screenSpaceErrorProgressiveResolution>r;return n&&o&&(t._priorityProgressiveResolutionScreenSpaceErrorLeaf=!0,i=!0),i}(i,this),this.priorityDeferred=function(e,t){var i=e._tileset,a=t.camera,r=e.boundingSphere,n=r.radius,o=v.default.multiplyByScalar(a.directionWC,e._centerZDepth,pw),l=v.default.add(a.positionWC,o,pw),u=v.default.subtract(l,r.center,pw);if(v.default.magnitude(u)>n){var d=v.default.normalize(u,pw),f=v.default.multiplyByScalar(d,n,pw),c=v.default.add(r.center,f,pw),h=v.default.subtract(c,a.positionWC,pw),p=v.default.normalize(h,pw);e._foveatedFactor=1-Math.abs(v.default.dot(a.directionWC,p))}else e._foveatedFactor=0;var m=e.refine===mb.a.REPLACE,_=i._skipLevelOfDetail;if(m&&!_||!i.foveatedScreenSpaceError||1===i.foveatedConeSize||e._priorityProgressiveResolution&&m&&_||i._pass===JO.a.PRELOAD_FLIGHT||i._pass===JO.a.PRELOAD)return!1;var g=1-Math.cos(.5*a.frustum.fov),b=i.foveatedConeSize*g;if(e._foveatedFactor<=b)return!1;var y=g-b,O=Ne.default.clamp((e._foveatedFactor-b)/y,0,1),w=i.foveatedInterpolationCallback(i.foveatedMinimumScreenSpaceErrorRelaxation,i.maximumScreenSpaceError,O),x=0===e._screenSpaceError&&Object(s.default)(e.parent)?.5*e.parent._screenSpaceError:e._screenSpaceError;return i.maximumScreenSpaceError-w<=x}(this,e)},hw.prototype.updateExpiration=function(){if(Object(s.default)(this.expireDate)&&this.contentReady&&!this.hasEmptyContent){var e=fh.default.now(mw);fh.default.lessThan(this.expireDate,e)&&(this._contentState=XO.EXPIRED,this._expiredContent=this._content)}},hw.prototype.requestContent=function(){var e=this,t=this._tileset;if(this.hasEmptyContent)return!1;var i=this._contentResource.clone(),a=this.contentExpired;a&&i.setQueryParameters({expired:this.expireDate.toString()});var r,n=new O_.a({throttle:!0,throttleByServer:!0,type:E_.a.TILES3D,priorityFunction:(r=this,function(){return r._priority}),serverKey:this._serverKey});this._request=n,i.request=n;var o=i.fetchArrayBuffer();if(!Object(s.default)(o))return!1;var l=this._contentState;this._contentState=XO.LOADING,this._contentReadyToProcessPromise=Ef.default.defer(),this._contentReadyPromise=Ef.default.defer();var u=function(e,t){return function(i){e._contentState===XO.PROCESSING?--t.statistics.numberOfTilesProcessing:--t.statistics.numberOfPendingRequests,e._contentState=XO.FAILED,e._contentReadyPromise.reject(i),e._contentReadyToProcessPromise.reject(i)}}(this,t);return o.then((function(i){if(!e.isDestroyed()){var r,n=new Uint8Array(i),o=wf(n),l=KO[o];return t._disableSkipLevelOfDetail=t._disableSkipLevelOfDetail||"vctr"===o||"geom"===o,Object(s.default)(l)?r=l(t,e,e._contentResource,i,0):(r=KO.json(t,e,e._contentResource,i,0),e.hasTilesetContent=!0),a&&(e.expireDate=void 0),e._content=r,e._contentState=XO.PROCESSING,e._contentReadyToProcessPromise.resolve(r),r.readyPromise.then((function(t){e.isDestroyed()?u():(!function(e){if(Object(s.default)(e.expireDuration)){var t=fh.default.now(mw);fh.default.addSeconds(t,e.expireDuration,t),Object(s.default)(e.expireDate)?fh.default.lessThan(e.expireDate,t)&&fh.default.clone(t,e.expireDate):e.expireDate=fh.default.clone(t)}}(e),e._selectedFrame=0,e.lastStyleTime=0,fh.default.now(e._loadTimestamp),e._contentState=XO.READY,e._contentReadyPromise.resolve(t))}))}u()})).otherwise((function(i){if(n.state===x_.a.CANCELLED)return e._contentState=l,--t.statistics.numberOfPendingRequests,void++t.statistics.numberOfAttemptedRequests;u(i)})),!0},hw.prototype.unloadContent=function(){this.hasEmptyContent||this.hasTilesetContent||(this._content=this._content&&this._content.destroy(),this._contentState=XO.UNLOADED,this._contentReadyToProcessPromise=void 0,this._contentReadyPromise=void 0,this.lastStyleTime=0,this.clippingPlanesDirty=0===this._clippingPlanesState,this._clippingPlanesState=0,this._debugColorizeTiles=!1,this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy())};var _w=new r.default;function gw(e,t){if(t.mode!==Ve.a.SCENE3D&&!Object(s.default)(e._boundingVolume2D)){var i=e._boundingVolume.boundingSphere,a=r.default.projectTo2D(i,t.mapProjection,_w);e._boundingVolume2D=new aw(a.center,a.radius)}return t.mode!==Ve.a.SCENE3D?e._boundingVolume2D:e._boundingVolume}hw.prototype.visibility=function(e,t){var i=e.cullingVolume,a=gw(this,e),r=this._tileset,n=r.clippingPlanes;if(Object(s.default)(n)&&n.enabled){var o=n.computeIntersectionWithBoundingVolume(a,r.clippingPlanesOriginMatrix);if(this._isClipped=o!==b_.default.INSIDE,o===b_.default.OUTSIDE)return v_.a.MASK_OUTSIDE}return i.computeVisibilityWithPlaneMask(a,t)},hw.prototype.contentVisibility=function(e){if(!Object(s.default)(this._contentBoundingVolume))return b_.default.INSIDE;if(this._visibilityPlaneMask===v_.a.MASK_INSIDE)return b_.default.INSIDE;var t=e.cullingVolume,i=function(e,t){if(t.mode!==Ve.a.SCENE3D&&!Object(s.default)(e._contentBoundingVolume2D)){var i=e._contentBoundingVolume.boundingSphere,a=r.default.projectTo2D(i,t.mapProjection,_w);e._contentBoundingVolume2D=new aw(a.center,a.radius)}return t.mode!==Ve.a.SCENE3D?e._contentBoundingVolume2D:e._contentBoundingVolume}(this,e),a=this._tileset,n=a.clippingPlanes;if(Object(s.default)(n)&&n.enabled){var o=n.computeIntersectionWithBoundingVolume(i,a.clippingPlanesOriginMatrix);if(this._isClipped=o!==b_.default.INSIDE,o===b_.default.OUTSIDE)return b_.default.OUTSIDE}return t.computeVisibility(i)},hw.prototype.distanceToTile=function(e){return gw(this,e).distanceToCamera(e)};var vw=new v.default;hw.prototype.distanceToTileCenter=function(e){var t=gw(this,e).boundingVolume,i=v.default.subtract(t.center,e.camera.positionWC,vw);return v.default.dot(e.camera.directionWC,i)},hw.prototype.insideViewerRequestVolume=function(e){var t=this._viewerRequestVolume;return!Object(s.default)(t)||0===t.distanceToCamera(e)};var bw=new et.default,yw=new v.default,Ow=new et.default,ww=new v.default,xw=new Yi.default,Ew=new ro.a,Tw=new nt.default;function Cw(e,t,i,a){if(!nt.default.equalsEpsilon(t,i,Ne.default.EPSILON8))return function(e,t,i,a){var r=Yi.default.unpack(e,0,xw),n=e[4],o=e[5],l=ro.a.fromRectangle(r,n,o,tt.default.WGS84,Ew),u=l.center,d=l.halfAxes;t=nt.default.multiplyTransformation(t,nt.default.inverseTransformation(i,Tw),Tw),u=nt.default.multiplyByPoint(t,u,u);var f=nt.default.getMatrix3(t,bw);return d=et.default.multiply(f,d,d),Object(s.default)(a)&&a instanceof cw?(a.update(u,d),a):new cw(u,d)}(e,t,i,a);if(Object(s.default)(a))return a;var r=Yi.default.unpack(e,0,xw);return new ew.default({rectangle:r,minimumHeight:e[4],maximumHeight:e[5]})}hw.prototype.createBoundingVolume=function(e,t,i){if(!Object(s.default)(e))throw new $f.default("boundingVolume must be defined");if(Object(s.default)(e.box))return function(e,t,i){var a=v.default.fromElements(e[0],e[1],e[2],ww),r=et.default.fromArray(e,3,Ow);a=nt.default.multiplyByPoint(t,a,a);var n=nt.default.getMatrix3(t,bw);return r=et.default.multiply(n,r,r),Object(s.default)(i)?(i.update(a,r),i):new cw(a,r)}(e.box,t,i);if(Object(s.default)(e.region))return Cw(e.region,t,this._initialTransform,i);if(Object(s.default)(e.sphere))return function(e,t,i){var a=v.default.fromElements(e[0],e[1],e[2],ww),r=e[3];a=nt.default.multiplyByPoint(t,a,a);var n=nt.default.getScale(t,yw);return r*=v.default.maximumComponent(n),Object(s.default)(i)?(i.update(a,r),i):new aw(a,r)}(e.sphere,t,i);throw new $f.default("boundingVolume must contain a sphere, region, or box")},hw.prototype.updateTransform=function(e){e=Object(o.default)(e,nt.default.IDENTITY);var t=nt.default.multiply(e,this.transform,Tw);if(!nt.default.equals(t,this.computedTransform)){nt.default.clone(t,this.computedTransform);var i=this._header,a=this._header.content;this._boundingVolume=this.createBoundingVolume(i.boundingVolume,this.computedTransform,this._boundingVolume),Object(s.default)(this._contentBoundingVolume)&&(this._contentBoundingVolume=this.createBoundingVolume(a.boundingVolume,this.computedTransform,this._contentBoundingVolume)),Object(s.default)(this._viewerRequestVolume)&&(this._viewerRequestVolume=this.createBoundingVolume(i.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)),this.updateGeometricErrorScale(),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy()}},hw.prototype.updateGeometricErrorScale=function(){var e=nt.default.getScale(this.computedTransform,yw),t=v.default.maximumComponent(e);this.geometricError=this._geometricError*t},hw.prototype.update=function(e,t,i){var a=t.commandList.length;!function(e,t){var i=t.clippingPlanes,a=0;Object(s.default)(i)&&e._isClipped&&i.enabled&&(a=i.clippingPlanesState),a!==e._clippingPlanesState&&(e._clippingPlanesState=a,e.clippingPlanesDirty=!0)}(this,e),function(e,t,i,a){if(a.isRender){var r=Object(s.default)(e._header.content)&&Object(s.default)(e._header.content.boundingVolume),n=e.hasEmptyContent||e.hasTilesetContent,o=t.debugShowBoundingVolume||t.debugShowContentBoundingVolume&&!r;if(o){var l;l=e._finalResolution?n?b.default.DARKGRAY:b.default.WHITE:b.default.YELLOW,Object(s.default)(e._debugBoundingVolume)||(e._debugBoundingVolume=e._boundingVolume.createDebugVolume(l)),e._debugBoundingVolume.update(i);var u=e._debugBoundingVolume.getGeometryInstanceAttributes("outline");u.color=oe.a.toValue(l,u.color)}else!o&&Object(s.default)(e._debugBoundingVolume)&&(e._debugBoundingVolume=e._debugBoundingVolume.destroy());t.debugShowContentBoundingVolume&&r?(Object(s.default)(e._debugContentBoundingVolume)||(e._debugContentBoundingVolume=e._contentBoundingVolume.createDebugVolume(b.default.BLUE)),e._debugContentBoundingVolume.update(i)):!t.debugShowContentBoundingVolume&&Object(s.default)(e._debugContentBoundingVolume)&&(e._debugContentBoundingVolume=e._debugContentBoundingVolume.destroy()),t.debugShowViewerRequestVolume&&Object(s.default)(e._viewerRequestVolume)?(Object(s.default)(e._debugViewerRequestVolume)||(e._debugViewerRequestVolume=e._viewerRequestVolume.createDebugVolume(b.default.YELLOW)),e._debugViewerRequestVolume.update(i)):!t.debugShowViewerRequestVolume&&Object(s.default)(e._debugViewerRequestVolume)&&(e._debugViewerRequestVolume=e._debugViewerRequestVolume.destroy());var d=t.debugColorizeTiles&&!e._debugColorizeTiles||Object(s.default)(t._heatmap.tilePropertyName),f=!t.debugColorizeTiles&&e._debugColorizeTiles;d?(t._heatmap.colorize(e,i),e._debugColorizeTiles=!0,e.color=e._debugColor):f&&(e._debugColorizeTiles=!1,e.color=b.default.WHITE),e._colorDirty&&(e._colorDirty=!1,e._content.applyDebugSettings(!0,e._color)),f&&t.makeStyleDirty()}}(this,e,t,i),function(e,t,i){var a=e._content,r=e._expiredContent;if(Object(s.default)(r)){if(!e.contentReady)return void r.update(t,i);e._expiredContent.destroy(),e._expiredContent=void 0}a.update(t,i)}(this,e,t),this._commandsLength=t.commandList.length-a,this.clippingPlanesDirty=!1};var Aw=[];function jw(e,t,i){var a=e*Math.pow(10,t);return parseInt(a)*Math.pow(10,i)}function Pw(e,t,i){return Math.max(Ne.default.normalize(e,t,i)-Ne.default.EPSILON7,0)}hw.prototype.process=function(e,t){var i=t.commandList;t.commandList=Aw,this._content.update(e,t),Aw.length=0,t.commandList=i},hw.prototype.updatePriority=function(){var e=this.tileset,t=e.preferLeaves,i=e._minimumPriority,a=e._maximumPriority,r=Math.pow(10,8),n=Math.pow(10,9),o=Math.pow(10,10),s=Pw(this._depth,i.depth,a.depth);s=t?1-s:s;var l=jw(!e._skipLevelOfDetail&&this.refine===mb.a.REPLACE?Pw(this._priorityHolder._distanceToCamera,i.distance,a.distance):Pw(this._priorityReverseScreenSpaceError,i.reverseScreenSpaceError,a.reverseScreenSpaceError),4,0),u=this._priorityProgressiveResolution?0:r,d=jw(Pw(this._priorityHolder._foveatedFactor,i.foveatedFactor,a.foveatedFactor),4,4),f=this.priorityDeferred?n:0,c=e._pass===JO.a.PRELOAD_FLIGHT?0:o;this._priority=s+l+u+d+f+c},hw.prototype.isDestroyed=function(){return!1},hw.prototype.destroy=function(){return this._content=this._content&&this._content.destroy(),this._expiredContent=this._expiredContent&&!this._expiredContent.isDestroyed()&&this._expiredContent.destroy(),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy(),Object(l.default)(this)};var Sw=hw,Iw={},Lw=new v.default;Iw.checkChildrenWithinParent=function(e){var t=e.children,i=t.length,a=e.boundingVolume;if(a instanceof cw||a instanceof ew.default){var r=a._orientedBoundingBox;e._optimChildrenWithinParent=ZO.a.USE_OPTIMIZATION;for(var n=0;n<i;++n){var o=t[n].boundingVolume;if(!(o instanceof cw||o instanceof ew.default)){e._optimChildrenWithinParent=ZO.a.SKIP_OPTIMIZATION;break}var s=o._orientedBoundingBox,l=v.default.subtract(s.center,r.center,Lw),u=v.default.magnitude(l);if(v.default.divideByScalar(l,u,l),Math.abs(r.halfAxes[0]*l.x)+Math.abs(r.halfAxes[1]*l.y)+Math.abs(r.halfAxes[2]*l.z)+Math.abs(r.halfAxes[3]*l.x)+Math.abs(r.halfAxes[4]*l.y)+Math.abs(r.halfAxes[5]*l.z)+Math.abs(r.halfAxes[6]*l.x)+Math.abs(r.halfAxes[7]*l.y)+Math.abs(r.halfAxes[8]*l.z)<=Math.abs(s.halfAxes[0]*l.x)+Math.abs(s.halfAxes[1]*l.y)+Math.abs(s.halfAxes[2]*l.z)+Math.abs(s.halfAxes[3]*l.x)+Math.abs(s.halfAxes[4]*l.y)+Math.abs(s.halfAxes[5]*l.z)+Math.abs(s.halfAxes[6]*l.x)+Math.abs(s.halfAxes[7]*l.y)+Math.abs(s.halfAxes[8]*l.z)+u){e._optimChildrenWithinParent=ZO.a.SKIP_OPTIMIZATION;break}}}return e._optimChildrenWithinParent===ZO.a.USE_OPTIMIZATION};var Dw=Iw;function Mw(){this.head=void 0,this.tail=void 0,this._length=0}function Rw(e,t,i){this.item=e,this.previous=t,this.next=i}function Nw(e,t){Object(s.default)(t.previous)&&Object(s.default)(t.next)?(t.previous.next=t.next,t.next.previous=t.previous):Object(s.default)(t.previous)?(t.previous.next=void 0,e.tail=t.previous):Object(s.default)(t.next)?(t.next.previous=void 0,e.head=t.next):(e.head=void 0,e.tail=void 0),t.next=void 0,t.previous=void 0}Object.defineProperties(Mw.prototype,{length:{get:function(){return this._length}}}),Mw.prototype.add=function(e){var t=new Rw(e,this.tail,void 0);return Object(s.default)(this.tail)?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t},Mw.prototype.remove=function(e){Object(s.default)(e)&&(Nw(this,e),--this._length)},Mw.prototype.splice=function(e,t){if(e!==t){Nw(this,t);var i=e.next;e.next=t,this.tail===e?this.tail=t:i.previous=t,t.next=i,t.previous=e}};var Vw=Mw;function Bw(){this._list=new Vw,this._sentinel=this._list.add(),this._trimTiles=!1}Bw.prototype.reset=function(){this._list.splice(this._list.tail,this._sentinel)},Bw.prototype.touch=function(e){var t=e.cacheNode;Object(s.default)(t)&&this._list.splice(this._sentinel,t)},Bw.prototype.add=function(e){Object(s.default)(e.cacheNode)||(e.cacheNode=this._list.add(e))},Bw.prototype.unloadTile=function(e,t,i){var a=t.cacheNode;Object(s.default)(a)&&(this._list.remove(a),t.cacheNode=void 0,i(e,t))},Bw.prototype.unloadTiles=function(e,t){var i=this._trimTiles;this._trimTiles=!1;for(var a=this._list,r=1024*e.maximumMemoryUsage*1024,n=this._sentinel,o=a.head;o!==n&&(e.totalMemoryUsageInBytes>r||i);){var s=o.item;o=o.next,this.unloadTile(e,s,t)}},Bw.prototype.trim=function(){this._trimTiles=!0};var Uw=Bw;function Fw(e){this.tilePropertyName=e,this._minimum=Number.MAX_VALUE,this._maximum=-Number.MAX_VALUE,this._previousMinimum=Number.MAX_VALUE,this._previousMaximum=-Number.MAX_VALUE,this._referenceMinimum={},this._referenceMaximum={}}function Hw(e,t){return"_loadTimestamp"===t?fh.default.toDate(e).getTime():e}Fw.prototype.setReferenceMinimumMaximum=function(e,t,i){this._referenceMinimum[i]=Hw(e,i),this._referenceMaximum[i]=Hw(t,i)};var kw=[new b.default(.1,.1,.1,1),new b.default(.153,.278,.878,1),new b.default(.827,.231,.49,1),new b.default(.827,.188,.22,1),new b.default(1,.592,.259,1),new b.default(1,.843,0,1)];Fw.prototype.colorize=function(e,t){var i=this.tilePropertyName;if(Object(s.default)(i)&&e.contentAvailable&&e._selectedFrame===t.frameNumber){var a=function(e,t){var i=e.tilePropertyName;if(Object(s.default)(i)){var a=Hw(t[i],i);return Object(s.default)(a)?(e._maximum=Math.max(a,e._maximum),e._minimum=Math.min(a,e._minimum),a):(e.tilePropertyName=void 0,a)}}(this,e),r=this._previousMinimum,n=this._previousMaximum;if(r!==Number.MAX_VALUE&&n!==-Number.MAX_VALUE){var o=n-r+Ne.default.EPSILON7,l=Ne.default.clamp(a-r,0,o)/o*(kw.length-1),u=Math.floor(l),d=Math.ceil(l),f=l-u,c=kw[u],h=kw[d],p=b.default.clone(b.default.WHITE);p.red=Ne.default.lerp(c.red,h.red,f),p.green=Ne.default.lerp(c.green,h.green,f),p.blue=Ne.default.lerp(c.blue,h.blue,f),e._debugColor=p}}},Fw.prototype.resetMinimumMaximum=function(){var e=this.tilePropertyName;if(Object(s.default)(e)){var t=this._referenceMinimum[e],i=this._referenceMaximum[e],a=Object(s.default)(t)&&Object(s.default)(i);this._previousMinimum=a?t:this._minimum,this._previousMaximum=a?i:this._maximum,this._minimum=Number.MAX_VALUE,this._maximum=-Number.MAX_VALUE}};var zw=Fw;function Gw(){this.selected=0,this.visited=0,this.numberOfCommands=0,this.numberOfAttemptedRequests=0,this.numberOfPendingRequests=0,this.numberOfTilesProcessing=0,this.numberOfTilesWithContentReady=0,this.numberOfTilesTotal=0,this.numberOfLoadedTilesTotal=0,this.numberOfFeaturesSelected=0,this.numberOfFeaturesLoaded=0,this.numberOfPointsSelected=0,this.numberOfPointsLoaded=0,this.numberOfTrianglesSelected=0,this.numberOfTilesStyled=0,this.numberOfFeaturesStyled=0,this.numberOfTilesCulledWithChildrenUnion=0,this.geometryByteLength=0,this.texturesByteLength=0,this.batchTableByteLength=0}function qw(e,t,i,a){var r=t.innerContents,n=t.pointsLength,o=t.trianglesLength,l=t.featuresLength,u=t.geometryByteLength,d=t.texturesByteLength,f=t.batchTableByteLength;if(a?(e.numberOfFeaturesLoaded+=i?-l:l,e.numberOfPointsLoaded+=i?-n:n,e.geometryByteLength+=i?-u:u,e.texturesByteLength+=i?-d:d,e.batchTableByteLength+=i?-f:f):(e.numberOfFeaturesSelected+=i?-l:l,e.numberOfPointsSelected+=i?-n:n,e.numberOfTrianglesSelected+=i?-o:o),Object(s.default)(r))for(var c=r.length,h=0;h<c;++h)qw(e,r[h],i,a)}Gw.prototype.clear=function(){this.selected=0,this.visited=0,this.numberOfCommands=0,this.numberOfAttemptedRequests=0,this.numberOfFeaturesSelected=0,this.numberOfPointsSelected=0,this.numberOfTrianglesSelected=0,this.numberOfTilesStyled=0,this.numberOfFeaturesStyled=0,this.numberOfTilesCulledWithChildrenUnion=0},Gw.prototype.incrementSelectionCounts=function(e){qw(this,e,!1,!1)},Gw.prototype.incrementLoadCounts=function(e){qw(this,e,!1,!0)},Gw.prototype.decrementLoadCounts=function(e){qw(this,e,!0,!0)},Gw.clone=function(e,t){t.selected=e.selected,t.visited=e.visited,t.numberOfCommands=e.numberOfCommands,t.selected=e.selected,t.numberOfAttemptedRequests=e.numberOfAttemptedRequests,t.numberOfPendingRequests=e.numberOfPendingRequests,t.numberOfTilesProcessing=e.numberOfTilesProcessing,t.numberOfTilesWithContentReady=e.numberOfTilesWithContentReady,t.numberOfTilesTotal=e.numberOfTilesTotal,t.numberOfFeaturesSelected=e.numberOfFeaturesSelected,t.numberOfFeaturesLoaded=e.numberOfFeaturesLoaded,t.numberOfPointsSelected=e.numberOfPointsSelected,t.numberOfPointsLoaded=e.numberOfPointsLoaded,t.numberOfTrianglesSelected=e.numberOfTrianglesSelected,t.numberOfTilesStyled=e.numberOfTilesStyled,t.numberOfFeaturesStyled=e.numberOfFeaturesStyled,t.numberOfTilesCulledWithChildrenUnion=e.numberOfTilesCulledWithChildrenUnion,t.geometryByteLength=e.geometryByteLength,t.texturesByteLength=e.texturesByteLength,t.batchTableByteLength=e.batchTableByteLength};var Ww=Gw;function Yw(){this._style=void 0,this._styleDirty=!1,this._lastStyleTime=0}Object.defineProperties(Yw.prototype,{style:{get:function(){return this._style},set:function(e){this._style=e,this._styleDirty=!0}}}),Yw.prototype.makeDirty=function(){this._styleDirty=!0},Yw.prototype.applyStyle=function(e,t){if(e.ready&&(!Object(s.default)(this._style)||this._style.ready)){var i=this._styleDirty;t.isRender&&(this._styleDirty=!1),i&&++this._lastStyleTime;for(var a=this._lastStyleTime,r=e._statistics,n=i?e._selectedTiles:e._selectedTilesToStyle,o=n.length,l=0;l<o;++l){var u=n[l];if(u.lastStyleTime!==a){var d=u.content;u.lastStyleTime=a,d.applyStyle(this._style),r.numberOfFeaturesStyled+=d.featuresLength,++r.numberOfTilesStyled}}}};var Kw=Yw;function Xw(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT),this._url=void 0,this._basePath=void 0,this._root=void 0,this._asset=void 0,this._properties=void 0,this._geometricError=void 0,this._extensionsUsed=void 0,this._gltfUpAxis=void 0,this._cache=new Uw,this._processingQueue=[],this._selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this._loadTimestamp=void 0,this._timeSinceLoad=0,this._updatedVisibilityFrame=0,this._updatedModelMatrixFrame=0,this._modelMatrixChanged=!1,this._previousModelMatrix=void 0,this._extras=void 0,this._credits=void 0,this._cullWithChildrenBounds=Object(o.default)(e.cullWithChildrenBounds,!0),this._allTilesAdditive=!0,this._hasMixedContent=!1,this._stencilClearCommand=void 0,this._backfaceCommands=new __.a,this._maximumScreenSpaceError=Object(o.default)(e.maximumScreenSpaceError,16),this._maximumMemoryUsage=Object(o.default)(e.maximumMemoryUsage,512),this._styleEngine=new Kw,this._modelMatrix=Object(s.default)(e.modelMatrix)?nt.default.clone(e.modelMatrix):nt.default.clone(nt.default.IDENTITY),this._statistics=new Ww,this._statisticsLast=new Ww,this._statisticsPerPass=new Array(JO.a.NUMBER_OF_PASSES);for(var t=0;t<JO.a.NUMBER_OF_PASSES;++t)this._statisticsPerPass[t]=new Ww;this._requestedTilesInFlight=[],this._maximumPriority={foveatedFactor:-Number.MAX_VALUE,depth:-Number.MAX_VALUE,distance:-Number.MAX_VALUE,reverseScreenSpaceError:-Number.MAX_VALUE},this._minimumPriority={foveatedFactor:Number.MAX_VALUE,depth:Number.MAX_VALUE,distance:Number.MAX_VALUE,reverseScreenSpaceError:Number.MAX_VALUE},this._heatmap=new zw(e.debugHeatmapTilePropertyName),this.cullRequestsWhileMoving=Object(o.default)(e.cullRequestsWhileMoving,!0),this._cullRequestsWhileMoving=!1,this.cullRequestsWhileMovingMultiplier=Object(o.default)(e.cullRequestsWhileMovingMultiplier,60),this.progressiveResolutionHeightFraction=Ne.default.clamp(Object(o.default)(e.progressiveResolutionHeightFraction,.3),0,.5),this.preferLeaves=Object(o.default)(e.preferLeaves,!1),this._tilesLoaded=!1,this._initialTilesLoaded=!1,this._tileDebugLabels=void 0,this._readyPromise=Ef.default.defer(),this._classificationType=e.classificationType,this._ellipsoid=Object(o.default)(e.ellipsoid,tt.default.WGS84),this._initialClippingPlanesOriginMatrix=nt.default.IDENTITY,this._clippingPlanesOriginMatrix=void 0,this._clippingPlanesOriginMatrixDirty=!0,this.preloadWhenHidden=Object(o.default)(e.preloadWhenHidden,!1),this.preloadFlightDestinations=Object(o.default)(e.preloadFlightDestinations,!0),this._pass=void 0,this.dynamicScreenSpaceError=Object(o.default)(e.dynamicScreenSpaceError,!1),this.foveatedScreenSpaceError=Object(o.default)(e.foveatedScreenSpaceError,!0),this._foveatedConeSize=Object(o.default)(e.foveatedConeSize,.1),this._foveatedMinimumScreenSpaceErrorRelaxation=Object(o.default)(e.foveatedMinimumScreenSpaceErrorRelaxation,0),this.foveatedInterpolationCallback=Object(o.default)(e.foveatedInterpolationCallback,Ne.default.lerp),this.foveatedTimeDelay=Object(o.default)(e.foveatedTimeDelay,.2),this.dynamicScreenSpaceErrorDensity=.00278,this.dynamicScreenSpaceErrorFactor=4,this.dynamicScreenSpaceErrorHeightFalloff=.25,this._dynamicScreenSpaceErrorComputedDensity=0,this.shadows=Object(o.default)(e.shadows,ae.a.ENABLED),this.show=Object(o.default)(e.show,!0),this.colorBlendMode=A_.HIGHLIGHT,this.colorBlendAmount=.5,this.pointCloudShading=new Xb(e.pointCloudShading),this._pointCloudEyeDomeLighting=new Yb,this.loadProgress=new X.default,this.allTilesLoaded=new X.default,this.initialTilesLoaded=new X.default,this.tileLoad=new X.default,this.tileUnload=new X.default,this.tileFailed=new X.default,this.tileVisible=new X.default,this.skipLevelOfDetail=Object(o.default)(e.skipLevelOfDetail,!1),this._skipLevelOfDetail=this.skipLevelOfDetail,this._disableSkipLevelOfDetail=!1,this.baseScreenSpaceError=Object(o.default)(e.baseScreenSpaceError,1024),this.skipScreenSpaceErrorFactor=Object(o.default)(e.skipScreenSpaceErrorFactor,16),this.skipLevels=Object(o.default)(e.skipLevels,1),this.immediatelyLoadDesiredLevelOfDetail=Object(o.default)(e.immediatelyLoadDesiredLevelOfDetail,!1),this.loadSiblings=Object(o.default)(e.loadSiblings,!1),this._clippingPlanes=void 0,this.clippingPlanes=e.clippingPlanes,this._imageBasedLightingFactor=new g.default(1,1),g.default.clone(e.imageBasedLightingFactor,this._imageBasedLightingFactor),this.lightColor=e.lightColor,this.luminanceAtZenith=Object(o.default)(e.luminanceAtZenith,.2),this.sphericalHarmonicCoefficients=e.sphericalHarmonicCoefficients,this.specularEnvironmentMaps=e.specularEnvironmentMaps,this.debugFreezeFrame=Object(o.default)(e.debugFreezeFrame,!1),this.debugColorizeTiles=Object(o.default)(e.debugColorizeTiles,!1),this.debugWireframe=Object(o.default)(e.debugWireframe,!1),this.debugShowBoundingVolume=Object(o.default)(e.debugShowBoundingVolume,!1),this.debugShowContentBoundingVolume=Object(o.default)(e.debugShowContentBoundingVolume,!1),this.debugShowViewerRequestVolume=Object(o.default)(e.debugShowViewerRequestVolume,!1),this._tileDebugLabels=void 0,this.debugPickedTileLabelOnly=!1,this.debugPickedTile=void 0,this.debugPickPosition=void 0,this.debugShowGeometricError=Object(o.default)(e.debugShowGeometricError,!1),this.debugShowRenderingStatistics=Object(o.default)(e.debugShowRenderingStatistics,!1),this.debugShowMemoryUsage=Object(o.default)(e.debugShowMemoryUsage,!1),this.debugShowUrl=Object(o.default)(e.debugShowUrl,!1);var i,r=this;Object(Ef.default)(e.url).then((function(e){var t;return i=pf.default.createIfNeeded(e),r._credits=i.credits,"json"===i.extension?t=i.getBaseUri(!0):i.isDataUri&&(t=""),r._url=i.url,r._basePath=t,Xw.loadJson(i)})).then((function(e){r._root=r.loadTileset(i,e);var t=Object(s.default)(e.asset.gltfUpAxis)?hf.fromName(e.asset.gltfUpAxis):hf.Y,n=e.asset;r._asset=n,r._properties=e.properties,r._geometricError=e.geometricError,r._extensionsUsed=e.extensionsUsed,r._gltfUpAxis=t,r._extras=e.extras;var o=n.extras;if(Object(s.default)(o)&&Object(s.default)(o.cesium)&&Object(s.default)(o.cesium.credits)){var l=o.cesium.credits,u=r._credits;Object(s.default)(u)||(u=[],r._credits=u);for(var d=0;d<l.length;++d){var f=l[d];u.push(new vf.default(f.html,f.showOnScreen))}}var c=r._root.createBoundingVolume(e.root.boundingVolume,nt.default.IDENTITY).boundingSphere.center,h=r._ellipsoid.cartesianToCartographic(c);Object(s.default)(h)&&h.height>a.a._defaultMinTerrainHeight&&(r._initialClippingPlanesOriginMatrix=Mt.default.eastNorthUpToFixedFrame(c)),r._clippingPlanesOriginMatrix=nt.default.clone(r._initialClippingPlanesOriginMatrix),r._readyPromise.resolve(r)})).otherwise((function(e){r._readyPromise.reject(e)}))}Object.defineProperties(Xw.prototype,{isCesium3DTileset:{get:function(){return!0}},asset:{get:function(){return this._asset}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){Nc.a.setOwner(e,this,"_clippingPlanes")}},properties:{get:function(){return this._properties}},ready:{get:function(){return Object(s.default)(this._root)}},readyPromise:{get:function(){return this._readyPromise.promise}},tilesLoaded:{get:function(){return this._tilesLoaded}},url:{get:function(){return this._url}},basePath:{get:function(){return Object(m_.default)("Cesium3DTileset.basePath","Cesium3DTileset.basePath has been deprecated. All tiles are relative to the url of the tileset JSON file that contains them. Use the url property instead."),this._basePath}},style:{get:function(){return this._styleEngine.style},set:function(e){this._styleEngine.style=e}},maximumScreenSpaceError:{get:function(){return this._maximumScreenSpaceError},set:function(e){this._maximumScreenSpaceError=e}},maximumMemoryUsage:{get:function(){return this._maximumMemoryUsage},set:function(e){this._maximumMemoryUsage=e}},root:{get:function(){return this._root}},boundingSphere:{get:function(){return this._root.updateTransform(this._modelMatrix),this._root.boundingSphere}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){this._modelMatrix=nt.default.clone(e,this._modelMatrix)}},timeSinceLoad:{get:function(){return this._timeSinceLoad}},totalMemoryUsageInBytes:{get:function(){var e=this._statistics;return e.texturesByteLength+e.geometryByteLength+e.batchTableByteLength}},clippingPlanesOriginMatrix:{get:function(){return Object(s.default)(this._clippingPlanesOriginMatrix)?(this._clippingPlanesOriginMatrixDirty&&(nt.default.multiply(this.root.computedTransform,this._initialClippingPlanesOriginMatrix,this._clippingPlanesOriginMatrix),this._clippingPlanesOriginMatrixDirty=!1),this._clippingPlanesOriginMatrix):nt.default.IDENTITY}},styleEngine:{get:function(){return this._styleEngine}},statistics:{get:function(){return this._statistics}},classificationType:{get:function(){return this._classificationType}},ellipsoid:{get:function(){return this._ellipsoid}},foveatedConeSize:{get:function(){return this._foveatedConeSize},set:function(e){this._foveatedConeSize=e}},foveatedMinimumScreenSpaceErrorRelaxation:{get:function(){return this._foveatedMinimumScreenSpaceErrorRelaxation},set:function(e){this._foveatedMinimumScreenSpaceErrorRelaxation=e}},extras:{get:function(){return this._extras}},imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(e){g.default.clone(e,this._imageBasedLightingFactor)}}}),Xw.loadJson=function(e){return pf.default.createIfNeeded(e).fetchJson()},Xw.prototype.makeStyleDirty=function(){this._styleEngine.makeDirty()},Xw.prototype.loadTileset=function(e,t,i){var a=t.asset;if(!Object(s.default)(a))throw new $f.default("Tileset must have an asset property.");if("0.0"!==a.version&&"1.0"!==a.version)throw new $f.default("The tileset must be 3D Tiles version 0.0 or 1.0.");var r=this._statistics,n=a.tilesetVersion;Object(s.default)(n)&&(this._basePath+="?v="+n,e.setQueryParameters({v:n}));var o=new Sw(this,e,t.root,i);Object(s.default)(i)&&(i.children.push(o),o._depth=i._depth+1);var l=[];for(l.push(o);l.length>0;){var u=l.pop();++r.numberOfTilesTotal,this._allTilesAdditive=this._allTilesAdditive&&u.refine===mb.a.ADD;var d=u._header.children;if(Object(s.default)(d))for(var f=d.length,c=0;c<f;++c){var h=d[c],p=new Sw(this,e,h,u);u.children.push(p),p._depth=u._depth+1,l.push(p)}this._cullWithChildrenBounds&&Dw.checkChildrenWithinParent(u)}return o};var Zw=new v.default,Jw=new Re.default,Qw=new nt.default,$w=new v.default,ex=new v.default,tx=new v.default;function ix(e,t){if(!t.hasEmptyContent){var i=e._statistics,a=t.contentExpired;t.requestContent()?(a&&(t.hasTilesetContent?function(e,t){var i=t,a=dx;a.push(t);for(;a.length>0;){for(var r=(t=a.pop()).children,n=r.length,o=0;o<n;++o)a.push(r[o]);t!==i&&(cx(e,t),--e._statistics.numberOfTilesTotal)}i.children=[]}(e,t):(i.decrementLoadCounts(t.content),--i.numberOfTilesWithContentReady)),++i.numberOfPendingRequests,e._requestedTilesInFlight.push(t),t.contentReadyToProcessPromise.then(function(e,t){return function(){e._processingQueue.push(t),--e._statistics.numberOfPendingRequests,++e._statistics.numberOfTilesProcessing}}(e,t)),t.contentReadyPromise.then(function(e,t){return function(){--e._statistics.numberOfTilesProcessing,t.hasTilesetContent||(e._statistics.incrementLoadCounts(t.content),++e._statistics.numberOfTilesWithContentReady,++e._statistics.numberOfLoadedTilesTotal,e._cache.add(t)),e.tileLoad.raiseEvent(t)}}(e,t)).otherwise(function(e,t){return function(i){var a=t._contentResource.url,r=Object(s.default)(i.message)?i.message:i.toString();e.tileFailed.numberOfListeners>0?e.tileFailed.raiseEvent({url:a,message:r}):(console.log("A 3D tile failed to load: "+a),console.log("Error: "+r))}}(e,t))):++i.numberOfAttemptedRequests}}function ax(e,t){return e._priority-t._priority}Xw.prototype.postPassesUpdate=function(e){this.ready&&(!function(e,t){for(var i=e._requestedTilesInFlight,a=0,r=i.length,n=0;n<r;++n){var o=i[n],s=t.frameNumber-o._touchedFrame>=1;o._contentState===XO.LOADING?s?(o._request.cancel(),++a):a>0&&(i[n-a]=o):++a}i.length-=a}(this,e),function(e,t){var i=e._statistics,a=e._statisticsLast,r=i.numberOfPendingRequests,n=i.numberOfTilesProcessing,o=a.numberOfPendingRequests,s=a.numberOfTilesProcessing;Ww.clone(i,a);var l=r!==o||n!==s;l&&t.afterRender.push((function(){e.loadProgress.raiseEvent(r,n)}));e._tilesLoaded=0===i.numberOfPendingRequests&&0===i.numberOfTilesProcessing&&0===i.numberOfAttemptedRequests,l&&e._tilesLoaded&&(t.afterRender.push((function(){e.allTilesLoaded.raiseEvent()})),e._initialTilesLoaded||(e._initialTilesLoaded=!0,t.afterRender.push((function(){e.initialTilesLoaded.raiseEvent()}))))}(this,e),this._cache.unloadTiles(this,fx))},Xw.prototype.prePassesUpdate=function(e){if(this.ready){!function(e,t){!function(e){for(var t=e._processingQueue,i=t.length,a=0,r=0;r<i;++r){var n=t[r];n._contentState===XO.PROCESSING?a>0&&(t[r-a]=n):++a}t.length-=a}(e);for(var i=e._processingQueue,a=i.length,r=0;r<a;++r)i[r].process(e,t)}(this,e);var t=this._clippingPlanes;this._clippingPlanesOriginMatrixDirty=!0,Object(s.default)(t)&&t.enabled&&t.update(e),Object(s.default)(this._loadTimestamp)||(this._loadTimestamp=fh.default.clone(e.time)),this._timeSinceLoad=Math.max(1e3*fh.default.secondsDifference(e.time,this._loadTimestamp),0),this._skipLevelOfDetail=this.skipLevelOfDetail&&!Object(s.default)(this._classificationType)&&!this._disableSkipLevelOfDetail&&!this._allTilesAdditive,this.dynamicScreenSpaceError&&function(e,t){var i,a,r,n,o,s=t.camera,l=e._root,u=l.contentBoundingVolume;if(u instanceof ew.default)i=v.default.normalize(s.positionWC,Zw),a=s.directionWC,r=s.positionCartographic.height,n=u.minimumHeight,o=u.maximumHeight;else{var d=nt.default.inverseTransformation(l.computedTransform,Qw),f=t.mapProjection.ellipsoid,c=u.boundingVolume,h=nt.default.multiplyByPoint(d,c.center,$w);if(v.default.magnitude(h)>f.minimumRadius){var p=Re.default.fromCartesian(h,f,Jw);i=v.default.normalize(s.positionWC,Zw),a=s.directionWC,r=s.positionCartographic.height,n=0,o=2*p.height}else{var m=nt.default.multiplyByPoint(d,s.positionWC,ex);if(i=v.default.UNIT_Z,a=nt.default.multiplyByPointAsVector(d,s.directionWC,tx),a=v.default.normalize(a,a),r=m.z,u instanceof cw){var _=l._header.boundingVolume.box[11];n=h.z-_,o=h.z+_}else if(u instanceof aw){var g=c.radius;n=h.z-g,o=h.z+g}}}var b=n+(o-n)*e.dynamicScreenSpaceErrorHeightFalloff,y=o,O=Ne.default.clamp((r-b)/(y-b),0,1),w=1-Math.abs(v.default.dot(a,i));w*=1-O;var x=e.dynamicScreenSpaceErrorDensity;x*=w,e._dynamicScreenSpaceErrorComputedDensity=x}(this,e),e.newFrame&&this._cache.reset()}};var rx=new v.default,nx={maximumFractionDigits:3};function ox(e){var t=e/1048576;return t<1?t.toLocaleString(void 0,nx):Math.round(t).toLocaleString()}function sx(e){var t=e.boundingVolume.boundingVolume,i=t.halfAxes,a=t.radius,r=v.default.clone(t.center,rx);if(Object(s.default)(i))r.x+=.75*(i[0]+i[3]+i[6]),r.y+=.75*(i[1]+i[4]+i[7]),r.z+=.75*(i[2]+i[5]+i[8]);else if(Object(s.default)(a)){var n=v.default.normalize(t.center,rx);n=v.default.multiplyByScalar(n,.75*a,rx),r=v.default.add(n,t.center,rx)}return r}function lx(e,t,i){var a="",r=0;(t.debugShowGeometricError&&(a+="\nGeometric error: "+e.geometricError,r++),t.debugShowRenderingStatistics)&&(a+="\nCommands: "+e.commandsLength,r++,e.content.pointsLength>0&&(a+="\nPoints: "+e.content.pointsLength,r++),e.content.trianglesLength>0&&(a+="\nTriangles: "+e.content.trianglesLength,r++),a+="\nFeatures: "+e.content.featuresLength,r++);t.debugShowMemoryUsage&&(a+="\nTexture Memory: "+ox(e.content.texturesByteLength),a+="\nGeometry Memory: "+ox(e.content.geometryByteLength),r+=2),t.debugShowUrl&&(a+="\nUrl: "+e._header.content.uri,r++);var n={text:a.substring(1),position:i,font:19-r+"px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY};return t._tileDebugLabels.add(n)}function ux(e,t,i){e._styleEngine.applyStyle(e,i);var a,r,n=i.isRender,o=e._statistics,l=t.commandList,u=l.length,d=e._selectedTiles,f=d.length,c=e._emptyTiles,h=c.length,p=e.tileVisible,m=e._skipLevelOfDetail&&e._hasMixedContent&&t.context.stencilBuffer&&f>0;e._backfaceCommands.length=0,m&&(Object(s.default)(e._stencilClearCommand)||(e._stencilClearCommand=new g_.a({stencil:0,pass:Lf.a.CESIUM_3D_TILE,renderState:Df.a.fromCache({stencilMask:L_.a.SKIP_LOD_MASK})})),l.push(e._stencilClearCommand));var _=l.length;for(a=0;a<f;++a)r=d[a],n&&p.raiseEvent(r),r.update(e,t,i),o.incrementSelectionCounts(r.content),++o.selected;for(a=0;a<h;++a)(r=c[a]).update(e,t,i);var v=l.length-_;if(e._backfaceCommands.trim(),m){var b=e._backfaceCommands.values,y=b.length;for(l.length+=y,a=v-1;a>=0;--a)l[_+y+a]=l[_+a];for(a=0;a<y;++a)l[_+a]=b[a]}v=l.length-u,o.numberOfCommands=v,n&&e.pointCloudShading.attenuation&&e.pointCloudShading.eyeDomeLighting&&v>0&&e._pointCloudEyeDomeLighting.update(t,u,e.pointCloudShading,e.boundingSphere),n&&(e.debugShowGeometricError||e.debugShowRenderingStatistics||e.debugShowMemoryUsage||e.debugShowUrl?(Object(s.default)(e._tileDebugLabels)||(e._tileDebugLabels=new fy.a),function(e,t){var i,a,r=e._selectedTiles,n=r.length,o=e._emptyTiles,l=o.length;if(e._tileDebugLabels.removeAll(),e.debugPickedTileLabelOnly){if(Object(s.default)(e.debugPickedTile)){var u=Object(s.default)(e.debugPickPosition)?e.debugPickPosition:sx(e.debugPickedTile);lx(e.debugPickedTile,e,u).pixelOffset=new g.default(15,-15)}}else{for(i=0;i<n;++i)lx(a=r[i],e,sx(a));for(i=0;i<l;++i)(a=o[i]).hasTilesetContent&&lx(a,e,sx(a))}e._tileDebugLabels.update(t)}(e,t)):e._tileDebugLabels=e._tileDebugLabels&&e._tileDebugLabels.destroy())}var dx=[];function fx(e,t){e.tileUnload.raiseEvent(t),e._statistics.decrementLoadCounts(t.content),--e._statistics.numberOfTilesWithContentReady,t.unloadContent()}function cx(e,t){e._cache.unloadTile(e,t,fx),t.destroy()}function hx(e,t,i,a){if(t.mode===Ve.a.MORPHING)return!1;if(!e.ready)return!1;var r=e._statistics;r.clear();var n=a.isRender;++e._updatedVisibilityFrame,function(e){e._heatmap.resetMinimumMaximum(),e._minimumPriority.depth=Number.MAX_VALUE,e._maximumPriority.depth=-Number.MAX_VALUE,e._minimumPriority.foveatedFactor=Number.MAX_VALUE,e._maximumPriority.foveatedFactor=-Number.MAX_VALUE,e._minimumPriority.distance=Number.MAX_VALUE,e._maximumPriority.distance=-Number.MAX_VALUE,e._minimumPriority.reverseScreenSpaceError=Number.MAX_VALUE,e._maximumPriority.reverseScreenSpaceError=-Number.MAX_VALUE}(e),function(e,t){t.frameNumber===e._updatedModelMatrixFrame&&Object(s.default)(e._previousModelMatrix)||(e._updatedModelMatrixFrame=t.frameNumber,e._modelMatrixChanged=!nt.default.equals(e.modelMatrix,e._previousModelMatrix),e._previousModelMatrix=nt.default.clone(e.modelMatrix,e._previousModelMatrix))}(e,t),e._cullRequestsWhileMoving=e.cullRequestsWhileMoving&&!e._modelMatrixChanged;var o=a.traversal.selectTiles(e,t);if(a.requestTiles&&function(e,t){var i=e._requestedTiles,a=i.length;i.sort(ax);for(var r=0;r<a;++r)ix(e,i[r])}(e),ux(e,t,a),Ww.clone(r,i),n){var l=e._credits;if(Object(s.default)(l)&&0!==r.selected)for(var u=l.length,d=0;d<u;++d)t.creditDisplay.addCredit(l[d])}return o}Xw.prototype.trimLoadedTiles=function(){this._cache.trim()},Xw.prototype.update=function(e){this.updateForPass(e,e.tilesetPassState)},Xw.prototype.updateForPass=function(e,t){var i=t.pass;if((i!==JO.a.PRELOAD||this.preloadWhenHidden&&!this.show)&&(i!==JO.a.PRELOAD_FLIGHT||this.preloadFlightDestinations&&(this.show||this.preloadWhenHidden))&&(i!==JO.a.REQUEST_RENDER_MODE_DEFER_CHECK||!(!this._cullRequestsWhileMoving&&this.foveatedTimeDelay<=0||!this.show))){var a=e.commandList,r=e.camera,n=e.cullingVolume;t.ready=!1;var s=JO.a.getPassOptions(i),l=s.ignoreCommands,u=Object(o.default)(t.commandList,a),d=u.length;e.commandList=u,e.camera=Object(o.default)(t.camera,r),e.cullingVolume=Object(o.default)(t.cullingVolume,n);var f=this._statisticsPerPass[i];(this.show||l)&&(this._pass=i,t.ready=hx(this,e,f,s)),l&&(u.length=d),e.commandList=a,e.camera=r,e.cullingVolume=n}},Xw.prototype.hasExtension=function(e){return!!Object(s.default)(this._extensionsUsed)&&this._extensionsUsed.indexOf(e)>-1},Xw.prototype.isDestroyed=function(){return!1},Xw.prototype.destroy=function(){if(this._tileDebugLabels=this._tileDebugLabels&&this._tileDebugLabels.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),Object(s.default)(this._root)){var e=dx;for(e.push(this._root);e.length>0;){var t=e.pop();t.destroy();for(var i=t.children,a=i.length,r=0;r<a;++r)e.push(i[r])}}return this._root=void 0,Object(l.default)(this)};var px=Xw,mx=new nt.default;function _x(e,t){t.collectionChanged.addEventListener(_x.prototype._onCollectionChanged,this),this._scene=e,this._primitives=e.primitives,this._entityCollection=t,this._tilesetHash={},this._entitiesToVisualize=new m.default,this._onCollectionChanged(t,t.values,[],[])}function gx(e,t,i,a){var r=i[t.id];Object(s.default)(r)&&(a.removeAndDestroy(r.tilesetPrimitive),delete i[t.id])}function vx(e,t,i){e.readyPromise.otherwise((function(e){console.error(e),i[t.id].loadFail=!0}))}_x.prototype.update=function(e){for(var t=this._entitiesToVisualize.values,i=this._tilesetHash,a=this._primitives,r=0,n=t.length;r<n;r++){var o,l,u=t[r],d=u._tileset,f=i[u.id],c=u.isShowing&&u.isAvailable(e)&&A.default.getValueOrDefault(d._show,e,!0);if(c&&(l=u.computeModelMatrix(e,mx),o=pf.default.createIfNeeded(A.default.getValueOrUndefined(d._uri,e))),c){var h=Object(s.default)(f)?f.tilesetPrimitive:void 0;Object(s.default)(h)&&o.url===f.url||(Object(s.default)(h)&&(a.removeAndDestroy(h),delete i[u.id]),(h=new px({url:o})).id=u,a.add(h),f={tilesetPrimitive:h,url:o.url,loadFail:!1},i[u.id]=f,vx(h,u,i)),h.show=!0,Object(s.default)(l)&&(h.modelMatrix=l),h.maximumScreenSpaceError=A.default.getValueOrDefault(d.maximumScreenSpaceError,e,h.maximumScreenSpaceError)}else Object(s.default)(f)&&(f.tilesetPrimitive.show=!1)}return!0},_x.prototype.isDestroyed=function(){return!1},_x.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(_x.prototype._onCollectionChanged,this);for(var e=this._entitiesToVisualize.values,t=this._tilesetHash,i=this._primitives,a=e.length-1;a>-1;a--)gx(this,e[a],t,i);return Object(l.default)(this)},_x.prototype.getBoundingSphere=function(e,t){var i=this._tilesetHash[e.id];if(!Object(s.default)(i)||i.loadFail)return C.default.FAILED;var a=i.tilesetPrimitive;return Object(s.default)(a)&&a.show?a.ready?(r.default.clone(a.boundingSphere,t),C.default.DONE):C.default.PENDING:C.default.FAILED},_x.prototype._onCollectionChanged=function(e,t,i,a){var r,n,o=this._entitiesToVisualize,l=this._tilesetHash,u=this._primitives;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._tileset)&&o.set(n.id,n);for(r=a.length-1;r>-1;r--)n=a[r],Object(s.default)(n._tileset)?o.set(n.id,n):(gx(this,n,l,u),o.remove(n.id));for(r=i.length-1;r>-1;r--)gx(this,n=i[r],l,u),o.remove(n.id)};var bx=_x,yx=i(175),Ox=i(72),wx=i(1705),xx=i(323),Ex=i(1706),Tx=i(765),Cx=i(1707),Ax=i(766),jx=new Ox.default,Px=new Ox.default,Sx=new Ox.default;function Ix(e){this.entity=e,this.polyline=void 0,this.index=void 0,this.updater=void 0}function Lx(e,t,i,a,r,n,o,l){for(;e instanceof Ex.a;)e=e.resolvedProperty;e instanceof Tx.default?o=function(e,t,i,a,r,n,o,l,u){var d,f=l;d=e.getValueInReferenceFrame(t,n,u[f]),Object(s.default)(d)&&(u[f++]=d);for(var c,h,p,m=!Object(s.default)(r)||fh.default.lessThanOrEquals(r,t)||fh.default.greaterThanOrEquals(r,i),_=0,g=a.length,v=a[_],b=i,y=!1;_<g;){if(!m&&fh.default.greaterThanOrEquals(v,r)&&(d=e.getValueInReferenceFrame(r,n,u[f]),Object(s.default)(d)&&(u[f++]=d),m=!0),fh.default.greaterThan(v,t)&&fh.default.lessThan(v,b)&&!v.equals(r)&&(d=e.getValueInReferenceFrame(v,n,u[f]),Object(s.default)(d)&&(u[f++]=d)),_<g-1){if(o>0&&!y){var O=a[_+1],w=fh.default.secondsDifference(O,v);(y=w>o)&&(c=Math.ceil(w/o),h=0,p=w/Math.max(c,2),c=Math.max(c-1,1))}if(y&&h<c){v=fh.default.addSeconds(v,p,new fh.default),h++;continue}}y=!1,v=a[++_]}return d=e.getValueInReferenceFrame(i,n,u[f]),Object(s.default)(d)&&(u[f++]=d),f}(e,t,i,e._property._times,a,r,n,o,l):o=e instanceof wx.a?function(e,t,i,a,r,n,o,s){Px.start=t,Px.stop=i;for(var l=o,u=e.intervals,d=0;d<u.length;d++){var f=u.get(d);if(!Ox.default.intersect(f,Px,jx).isEmpty){var c=f.start,h=f.stop,p=t;fh.default.greaterThan(c,p)&&(p=c);var m=i;fh.default.lessThan(h,m)&&(m=h),l=Lx(f.data,p,m,a,r,n,l,s)}}return l}(e,t,i,a,r,n,o,l):e instanceof Ax.default?function(e,t,i,a,r,n,o,l){Sx.start=t,Sx.stop=i;for(var u=o,d=e.intervals,f=0;f<d.length;f++){var c=d.get(f);if(!Ox.default.intersect(c,Sx,jx).isEmpty){var h=c.start;c.isStartIncluded||(h=c.isStopIncluded?c.stop:fh.default.addSeconds(c.start,fh.default.secondsDifference(c.stop,c.start)/2,new fh.default));var p=e.getValueInReferenceFrame(h,r,l[u]);Object(s.default)(p)&&(l[u]=p,u++)}}return u}(e,t,i,0,r,0,o,l):e instanceof xx.default||e instanceof Cx.a&&A.default.isConstant(e)?function(e,t,i,a,r,n,o,l){var u=e.getValueInReferenceFrame(t,r,l[o]);return Object(s.default)(u)&&(l[o++]=u),o}(e,t,0,0,r,0,o,l):function(e,t,i,a,r,n,o,l){for(var u,d=0,f=o,c=t,h=Math.max(n,60),p=!Object(s.default)(a)||fh.default.lessThanOrEquals(a,t)||fh.default.greaterThanOrEquals(a,i);fh.default.lessThan(c,i);)!p&&fh.default.greaterThanOrEquals(c,a)&&(p=!0,u=e.getValueInReferenceFrame(a,r,l[f]),Object(s.default)(u)&&(l[f]=u,f++)),u=e.getValueInReferenceFrame(c,r,l[f]),Object(s.default)(u)&&(l[f]=u,f++),d++,c=fh.default.addSeconds(t,h*d,new fh.default);return u=e.getValueInReferenceFrame(i,r,l[f]),Object(s.default)(u)&&(l[f]=u,f++),f}(e,t,i,a,r,n,o,l);return o}function Dx(e,t,i,a,r,n,o){Object(s.default)(o)||(o=[]);var l=Lx(e,t,i,a,r,n,0,o);return o.length=l,o}var Mx=new et.default;function Rx(e,t){this._unusedIndexes=[],this._polylineCollection=new pO,this._scene=e,this._referenceFrame=t,e.primitives.add(this._polylineCollection)}function Nx(e,t){t.collectionChanged.addEventListener(Nx.prototype._onCollectionChanged,this),this._scene=e,this._updaters={},this._entityCollection=t,this._items=new m.default,this._onCollectionChanged(t,t.values,[],[])}Rx.prototype.update=function(e){if(this._referenceFrame===yx.a.INERTIAL){var t=Mt.default.computeIcrfToFixedMatrix(e,Mx);Object(s.default)(t)||(t=Mt.default.computeTemeToPseudoFixedMatrix(e,Mx)),nt.default.fromRotationTranslation(t,v.default.ZERO,this._polylineCollection.modelMatrix)}},Rx.prototype.updateObject=function(e,t){var i,a,r=t.entity,n=r._path,o=r._position,l=n._show,u=t.polyline,d=r.isShowing&&(!Object(s.default)(l)||l.getValue(e));if(d){var f=A.default.getValueOrUndefined(n._leadTime,e),c=A.default.getValueOrUndefined(n._trailTime,e),h=r._availability,p=Object(s.default)(h),m=Object(s.default)(f),_=Object(s.default)(c);if(d=p||m&&_){if(_&&(i=fh.default.addSeconds(e,-c,new fh.default)),m&&(a=fh.default.addSeconds(e,f,new fh.default)),p){var g=h.start,v=h.stop;_&&!fh.default.greaterThan(g,i)||(i=g),m&&!fh.default.lessThan(v,a)||(a=v)}d=fh.default.lessThan(i,a)}}if(d){if(!Object(s.default)(u)){var b=this._unusedIndexes;if(b.length>0){var y=b.pop();u=this._polylineCollection.get(y),t.index=y}else t.index=this._polylineCollection.length,u=this._polylineCollection.add();u.id=r,t.polyline=u}var O=A.default.getValueOrDefault(n._resolution,e,60);u.show=!0,u.positions=Dx(o,i,a,e,this._referenceFrame,O,u.positions.slice()),u.material=ve.getValue(e,n._material,u.material),u.width=A.default.getValueOrDefault(n._width,e,1),u.distanceDisplayCondition=A.default.getValueOrUndefined(n._distanceDisplayCondition,e,u.distanceDisplayCondition)}else Object(s.default)(u)&&(this._unusedIndexes.push(t.index),t.polyline=void 0,u.show=!1,t.index=void 0)},Rx.prototype.removeObject=function(e){var t=e.polyline;Object(s.default)(t)&&(this._unusedIndexes.push(e.index),e.polyline=void 0,t.show=!1,t.id=void 0,e.index=void 0)},Rx.prototype.destroy=function(){return this._scene.primitives.remove(this._polylineCollection),Object(l.default)(this)},Nx.prototype.update=function(e){var t=this._updaters;for(var i in t)t.hasOwnProperty(i)&&t[i].update(e);var a=this._items.values;if(0===a.length&&Object(s.default)(this._updaters)&&Object.keys(this._updaters).length>0){for(var r in t)t.hasOwnProperty(r)&&t[r].destroy();this._updaters={}}for(var n=0,o=a.length;n<o;n++){var l=a[n],u=l.entity._position,d=l.updater,f=yx.a.FIXED;this._scene.mode===Ve.a.SCENE3D&&(f=u.referenceFrame);var c=this._updaters[f];d===c&&Object(s.default)(c)?c.updateObject(e,l):(Object(s.default)(d)&&d.removeObject(l),Object(s.default)(c)||((c=new Rx(this._scene,f)).update(e),this._updaters[f]=c),l.updater=c,Object(s.default)(c)&&c.updateObject(e,l))}return!0},Nx.prototype.isDestroyed=function(){return!1},Nx.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Nx.prototype._onCollectionChanged,this);var e=this._updaters;for(var t in e)e.hasOwnProperty(t)&&e[t].destroy();return Object(l.default)(this)},Nx.prototype._onCollectionChanged=function(e,t,i,a){var r,n,o,l=this._items;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._path)&&Object(s.default)(n._position)&&l.set(n.id,new Ix(n));for(r=a.length-1;r>-1;r--)n=a[r],Object(s.default)(n._path)&&Object(s.default)(n._position)?l.contains(n.id)||l.set(n.id,new Ix(n)):(o=l.get(n.id),Object(s.default)(o)&&(Object(s.default)(o.updater)&&o.updater.removeObject(o),l.remove(n.id)));for(r=i.length-1;r>-1;r--)n=i[r],o=l.get(n.id),Object(s.default)(o)&&(Object(s.default)(o.updater)&&o.updater.removeObject(o),l.remove(n.id))},Nx._subSample=Dx;var Vx=Nx,Bx=b.default.WHITE,Ux=b.default.BLACK,Fx=new b.default,Hx=new v.default,kx=new b.default,zx=new w.a,Gx=new w.a,qx=new O.a;function Wx(e){this.entity=e,this.pointPrimitive=void 0,this.billboard=void 0,this.color=void 0,this.outlineColor=void 0,this.pixelSize=void 0,this.outlineWidth=void 0}function Yx(e,t){t.collectionChanged.addEventListener(Yx.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new m.default,this._onCollectionChanged(t,t.values,[],[])}function Kx(e,t,i){if(Object(s.default)(e)){var a=e.pointPrimitive;if(Object(s.default)(a))return e.pointPrimitive=void 0,void i.removePoint(t);var r=e.billboard;Object(s.default)(r)&&(e.billboard=void 0,i.removeBillboard(t))}}Yx.prototype.update=function(e){for(var t=this._items.values,i=this._cluster,a=0,r=t.length;a<r;a++){var n,o=t[a],l=o.entity,u=l._point,d=o.pointPrimitive,f=o.billboard,c=A.default.getValueOrDefault(u._heightReference,e,x.default.NONE),h=l.isShowing&&l.isAvailable(e)&&A.default.getValueOrDefault(u._show,e,!0);if(h&&(n=A.default.getValueOrUndefined(l._position,e,Hx),h=Object(s.default)(n)),h){A.default.isConstant(l._position)||(i._clusterDirty=!0);var p=!1,m=!1;if(c===x.default.NONE||Object(s.default)(f)?c!==x.default.NONE||Object(s.default)(d)||(Object(s.default)(f)&&(Kx(o,l,i),f=void 0),(d=i.getPoint(l)).id=l,o.pointPrimitive=d):(Object(s.default)(d)&&(Kx(o,l,i),d=void 0),(f=i.getBillboard(l)).id=l,f.image=void 0,o.billboard=f,p=!0,m=v.default.equals(f.position,n)&&f.heightReference===c),Object(s.default)(d))d.show=!0,d.position=n,d.scaleByDistance=A.default.getValueOrUndefined(u._scaleByDistance,e,zx),d.translucencyByDistance=A.default.getValueOrUndefined(u._translucencyByDistance,e,Gx),d.color=A.default.getValueOrDefault(u._color,e,Bx,Fx),d.outlineColor=A.default.getValueOrDefault(u._outlineColor,e,Ux,kx),d.outlineWidth=A.default.getValueOrDefault(u._outlineWidth,e,0),d.pixelSize=A.default.getValueOrDefault(u._pixelSize,e,1),d.distanceDisplayCondition=A.default.getValueOrUndefined(u._distanceDisplayCondition,e,qx),d.disableDepthTestDistance=A.default.getValueOrDefault(u._disableDepthTestDistance,e,0);else if(Object(s.default)(f)){f.show=!0,f.position=n,f.scaleByDistance=A.default.getValueOrUndefined(u._scaleByDistance,e,zx),f.translucencyByDistance=A.default.getValueOrUndefined(u._translucencyByDistance,e,Gx),f.distanceDisplayCondition=A.default.getValueOrUndefined(u._distanceDisplayCondition,e,qx),f.disableDepthTestDistance=A.default.getValueOrDefault(u._disableDepthTestDistance,e,0),f.heightReference=c;var _=A.default.getValueOrDefault(u._color,e,Bx,Fx),g=A.default.getValueOrDefault(u._outlineColor,e,Ux,kx),y=Math.round(A.default.getValueOrDefault(u._outlineWidth,e,0)),O=Math.max(1,Math.round(A.default.getValueOrDefault(u._pixelSize,e,1)));if(y>0?(f.scale=1,p=p||y!==o.outlineWidth||O!==o.pixelSize||!b.default.equals(_,o.color)||!b.default.equals(g,o.outlineColor)):(f.scale=O/50,O=50,p=p||y!==o.outlineWidth||!b.default.equals(_,o.color)||!b.default.equals(g,o.outlineColor)),p){o.color=b.default.clone(_,o.color),o.outlineColor=b.default.clone(g,o.outlineColor),o.pixelSize=O,o.outlineWidth=y;var w=_.alpha,E=_.toCssColorString(),T=g.toCssColorString(),C=JSON.stringify([E,O,T,y]);f.setImage(C,oy(w,E,T,y,O))}m&&f._updateClamping()}}else Kx(o,l,i)}return!0},Yx.prototype.getBoundingSphere=function(e,t){var i=this._items.get(e.id);if(!Object(s.default)(i)||!Object(s.default)(i.pointPrimitive)&&!Object(s.default)(i.billboard))return C.default.FAILED;if(Object(s.default)(i.pointPrimitive))t.center=v.default.clone(i.pointPrimitive.position,t.center);else{var a=i.billboard;if(!Object(s.default)(a._clampedPosition))return C.default.PENDING;t.center=v.default.clone(a._clampedPosition,t.center)}return t.radius=0,C.default.DONE},Yx.prototype.isDestroyed=function(){return!1},Yx.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Yx.prototype._onCollectionChanged,this);for(var e=this._entityCollection.values,t=0;t<e.length;t++)this._cluster.removePoint(e[t]);return Object(l.default)(this)},Yx.prototype._onCollectionChanged=function(e,t,i,a){var r,n,o=this._items,l=this._cluster;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._point)&&Object(s.default)(n._position)&&o.set(n.id,new Wx(n));for(r=a.length-1;r>-1;r--)n=a[r],Object(s.default)(n._point)&&Object(s.default)(n._position)?o.contains(n.id)||o.set(n.id,new Wx(n)):(Kx(o.get(n.id),n,l),o.remove(n.id));for(r=i.length-1;r>-1;r--)n=i[r],Kx(o.get(n.id),n,l),o.remove(n.id)};var Xx=Yx,Zx=i(434),Jx=i(548),Qx=i(586),$x=i(269),eE=[];function tE(e,t,i,a,r){var n,o=eE;o.length=r;var s=i.red,l=i.green,u=i.blue,d=i.alpha,f=a.red,c=a.green,h=a.blue,p=a.alpha;if(b.default.equals(i,a)){for(n=0;n<r;n++)o[n]=b.default.clone(i);return o}var m=(f-s)/r,_=(c-l)/r,g=(h-u)/r,v=(p-d)/r;for(n=0;n<r;n++)o[n]=new b.default(s+n*m,l+n*_,u+n*g,d+n*v);return o}function iE(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,i=e.colors,a=Object(o.default)(e.width,1),r=Object(o.default)(e.colorsPerVertex,!1);this._positions=t,this._colors=i,this._width=a,this._colorsPerVertex=r,this._vertexFormat=J.default.clone(Object(o.default)(e.vertexFormat,J.default.DEFAULT)),this._arcType=Object(o.default)(e.arcType,ao.a.GEODESIC),this._granularity=Object(o.default)(e.granularity,Ne.default.RADIANS_PER_DEGREE),this._ellipsoid=tt.default.clone(Object(o.default)(e.ellipsoid,tt.default.WGS84)),this._workerName="createPolylineGeometry";var n=1+t.length*v.default.packedLength;n+=Object(s.default)(i)?1+i.length*b.default.packedLength:1,this.packedLength=n+tt.default.packedLength+J.default.packedLength+4}iE.pack=function(e,t,i){var a;i=Object(o.default)(i,0);var r=e._positions,n=r.length;for(t[i++]=n,a=0;a<n;++a,i+=v.default.packedLength)v.default.pack(r[a],t,i);var l=e._colors;for(n=Object(s.default)(l)?l.length:0,t[i++]=n,a=0;a<n;++a,i+=b.default.packedLength)b.default.pack(l[a],t,i);return tt.default.pack(e._ellipsoid,t,i),i+=tt.default.packedLength,J.default.pack(e._vertexFormat,t,i),i+=J.default.packedLength,t[i++]=e._width,t[i++]=e._colorsPerVertex?1:0,t[i++]=e._arcType,t[i]=e._granularity,t};var aE=tt.default.clone(tt.default.UNIT_SPHERE),rE=new J.default,nE={positions:void 0,colors:void 0,ellipsoid:aE,vertexFormat:rE,width:void 0,colorsPerVertex:void 0,arcType:void 0,granularity:void 0};iE.unpack=function(e,t,i){var a;t=Object(o.default)(t,0);var r=e[t++],n=new Array(r);for(a=0;a<r;++a,t+=v.default.packedLength)n[a]=v.default.unpack(e,t);var l=(r=e[t++])>0?new Array(r):void 0;for(a=0;a<r;++a,t+=b.default.packedLength)l[a]=b.default.unpack(e,t);var u=tt.default.unpack(e,t,aE);t+=tt.default.packedLength;var d=J.default.unpack(e,t,rE);t+=J.default.packedLength;var f=e[t++],c=1===e[t++],h=e[t++],p=e[t];return Object(s.default)(i)?(i._positions=n,i._colors=l,i._ellipsoid=tt.default.clone(u,i._ellipsoid),i._vertexFormat=J.default.clone(d,i._vertexFormat),i._width=f,i._colorsPerVertex=c,i._arcType=h,i._granularity=p,i):(nE.positions=n,nE.colors=l,nE.width=f,nE.colorsPerVertex=c,nE.arcType=h,nE.granularity=p,new iE(nE))};var oE=new v.default,sE=new v.default,lE=new v.default,uE=new v.default;iE.createGeometry=function(e){var t,i,a,n=e._width,o=e._vertexFormat,l=e._colors,u=e._colorsPerVertex,d=e._arcType,f=e._granularity,c=e._ellipsoid,h=Object(Qe.a)(e._positions,v.default.equalsEpsilon),p=h.length;if(!(p<2||n<=0)){if(d===ao.a.GEODESIC||d===ao.a.RHUMB){var m,_;d===ao.a.GEODESIC?(m=Ne.default.chordLength(f,c.maximumRadius),_=St.numberOfPoints):(m=f,_=St.numberOfPointsRhumbLine);var g=St.extractHeights(h,c);if(Object(s.default)(l)){var y=1;for(t=0;t<p-1;++t)y+=_(h[t],h[t+1],m);var O=new Array(y),w=0;for(t=0;t<p-1;++t){var x=h[t],E=h[t+1],T=l[t],C=_(x,E,m);if(u&&t<y){var A=tE(0,0,T,l[t+1],C),j=A.length;for(i=0;i<j;++i)O[w++]=A[i]}else for(i=0;i<C;++i)O[w++]=b.default.clone(T)}O[w]=b.default.clone(l[l.length-1]),l=O,eE.length=0}h=d===ao.a.GEODESIC?St.generateCartesianArc({positions:h,minDistance:m,ellipsoid:c,height:g}):St.generateCartesianRhumbArc({positions:h,granularity:m,ellipsoid:c,height:g})}var P,S=4*(p=h.length)-4,I=new Float64Array(3*S),L=new Float64Array(3*S),D=new Float64Array(3*S),M=new Float32Array(2*S),R=o.st?new Float32Array(2*S):void 0,N=Object(s.default)(l)?new Uint8Array(4*S):void 0,V=0,B=0,U=0,F=0;for(i=0;i<p;++i){var H,k;0===i?(P=oE,v.default.subtract(h[0],h[1],P),v.default.add(h[0],P,P)):P=h[i-1],v.default.clone(P,lE),v.default.clone(h[i],sE),i===p-1?(P=oE,v.default.subtract(h[p-1],h[p-2],P),v.default.add(h[p-1],P,P)):P=h[i+1],v.default.clone(P,uE),Object(s.default)(N)&&(H=0===i||u?l[i]:l[i-1],i!==p-1&&(k=l[i]));var z=i===p-1?2:4;for(a=0===i?2:0;a<z;++a){v.default.pack(sE,I,V),v.default.pack(lE,L,V),v.default.pack(uE,D,V),V+=3;var G=a-2<0?-1:1;if(M[B++]=a%2*2-1,M[B++]=G*n,o.st&&(R[U++]=i/(p-1),R[U++]=Math.max(M[B-2],0)),Object(s.default)(N)){var q=a<2?H:k;N[F++]=b.default.floatToByte(q.red),N[F++]=b.default.floatToByte(q.green),N[F++]=b.default.floatToByte(q.blue),N[F++]=b.default.floatToByte(q.alpha)}}}var W=new zi.a;W.position=new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:I}),W.prevPosition=new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:L}),W.nextPosition=new ki.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:D}),W.expandAndWidth=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:M}),o.st&&(W.st=new ki.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:R})),Object(s.default)(N)&&(W.color=new ki.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:4,values:N,normalize:!0}));var Y=Gi.a.createTypedArray(S,6*p-6),K=0,X=0,Z=p-1;for(i=0;i<Z;++i)Y[X++]=K,Y[X++]=K+2,Y[X++]=K+1,Y[X++]=K+1,Y[X++]=K+2,Y[X++]=K+3,K+=4;return new Hi.a({attributes:W,indices:Y,primitiveType:Wi.a.TRIANGLES,boundingSphere:r.default.fromPoints(h),geometryType:$x.a.POLYLINES})}};var dE=iE,fE=new we.a(0),cE={},hE=new b.default,pE=new me.default(b.default.WHITE),mE=new we.a(!0),_E=new we.a(ae.a.DISABLED),gE=new we.a(new O.a),vE=new we.a(Z.a.BOTH);function bE(){this.vertexFormat=void 0,this.positions=void 0,this.width=void 0,this.arcType=void 0,this.granularity=void 0}function yE(){this.positions=void 0,this.width=void 0,this.arcType=void 0,this.granularity=void 0}function OE(e,t){this._entity=e,this._scene=t,this._entitySubscription=e.definitionChanged.addEventListener(OE.prototype._onEntityPropertyChanged,this),this._fillEnabled=!1,this._dynamic=!1,this._geometryChanged=new X.default,this._showProperty=void 0,this._materialProperty=void 0,this._shadowsProperty=void 0,this._distanceDisplayConditionProperty=void 0,this._classificationTypeProperty=void 0,this._depthFailMaterialProperty=void 0,this._geometryOptions=new bE,this._groundGeometryOptions=new yE,this._id="polyline-"+e.id,this._clampToGround=!1,this._supportsPolylinesOnTerrain=xe.default.supportsPolylinesOnTerrain(t),this._zIndex=0,this._onEntityPropertyChanged(e,"polyline",e.polyline,void 0)}Object.defineProperties(OE.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!Object(s.default)(this._entity.availability)&&A.default.isConstant(this._showProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},depthFailMaterialProperty:{get:function(){return this._depthFailMaterialProperty}},outlineEnabled:{value:!1},hasConstantOutline:{value:!0},outlineColorProperty:{value:void 0},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},classificationTypeProperty:{get:function(){return this._classificationTypeProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{value:!1},geometryChanged:{get:function(){return this._geometryChanged}},arcType:{get:function(){return this._arcType}},clampToGround:{get:function(){return this._clampToGround&&this._supportsPolylinesOnTerrain}},zIndex:{get:function(){return this._zIndex}}}),OE.prototype.isOutlineVisible=function(e){return!1},OE.prototype.isFilled=function(e){var t=this._entity,i=this._fillEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e);return Object(o.default)(i,!1)},OE.prototype.createFillGeometryInstance=function(e){var t,i=this._entity,a=i.isAvailable(e),r=new pe.a(a&&i.isShowing&&this._showProperty.getValue(e)),n=this._distanceDisplayConditionProperty.getValue(e),o={show:r,distanceDisplayCondition:ue.fromDistanceDisplayCondition(n)};return this._materialProperty instanceof me.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(t=this._materialProperty.color.getValue(e,hE)),Object(s.default)(t)||(t=b.default.WHITE),o.color=oe.a.fromColor(t)),this.clampToGround?new de.a({id:i,geometry:new Qx.a(this._groundGeometryOptions),attributes:o}):(Object(s.default)(this._depthFailMaterialProperty)&&this._depthFailMaterialProperty instanceof me.default&&(Object(s.default)(this._depthFailMaterialProperty.color)&&(this._depthFailMaterialProperty.color.isConstant||a)&&(t=this._depthFailMaterialProperty.color.getValue(e,hE)),Object(s.default)(t)||(t=b.default.WHITE),o.depthFailColor=oe.a.fromColor(t)),new de.a({id:i,geometry:new dE(this._geometryOptions),attributes:o}))},OE.prototype.createOutlineGeometryInstance=function(e){},OE.prototype.isDestroyed=function(){return!1},OE.prototype.destroy=function(){this._entitySubscription(),Object(l.default)(this)},OE.prototype._onEntityPropertyChanged=function(e,t,i,a){if("availability"===t||"polyline"===t){var r=this._entity.polyline;if(Object(s.default)(r)){var n=r.positions,l=r.show;if(Object(s.default)(l)&&l.isConstant&&!l.getValue(ce.default.MINIMUM_VALUE)||!Object(s.default)(n))this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this));else{var u=r.zIndex,d=Object(o.default)(r.material,pE),f=d instanceof me.default;this._materialProperty=d,this._depthFailMaterialProperty=r.depthFailMaterial,this._showProperty=Object(o.default)(l,mE),this._shadowsProperty=Object(o.default)(r.shadows,_E),this._distanceDisplayConditionProperty=Object(o.default)(r.distanceDisplayCondition,gE),this._classificationTypeProperty=Object(o.default)(r.classificationType,vE),this._fillEnabled=!0,this._zIndex=Object(o.default)(u,fE);var c=r.width,h=r.arcType,p=r.clampToGround,m=r.granularity;if(n.isConstant&&A.default.isConstant(c)&&A.default.isConstant(h)&&A.default.isConstant(m)&&A.default.isConstant(p)&&A.default.isConstant(u)){var _,g=this._geometryOptions,v=n.getValue(ce.default.MINIMUM_VALUE,g.positions);if(!Object(s.default)(v)||v.length<2)return void(this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this)));_=f&&(!Object(s.default)(this._depthFailMaterialProperty)||this._depthFailMaterialProperty instanceof me.default)?Zx.a.VERTEX_FORMAT:Jx.a.VERTEX_FORMAT,g.vertexFormat=_,g.positions=v,g.width=Object(s.default)(c)?c.getValue(ce.default.MINIMUM_VALUE):void 0,g.arcType=Object(s.default)(h)?h.getValue(ce.default.MINIMUM_VALUE):void 0,g.granularity=Object(s.default)(m)?m.getValue(ce.default.MINIMUM_VALUE):void 0;var b=this._groundGeometryOptions;b.positions=v,b.width=g.width,b.arcType=g.arcType,b.granularity=g.granularity,this._clampToGround=!!Object(s.default)(p)&&p.getValue(ce.default.MINIMUM_VALUE),!this._clampToGround&&Object(s.default)(u)&&Object(Oe.a)("Entity polylines must have clampToGround: true when using zIndex.  zIndex will be ignored."),this._dynamic=!1,this._geometryChanged.raiseEvent(this)}else this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this))}}else this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this))}},OE.prototype.createDynamicUpdater=function(e,t){return new xE(e,t,this)};var wE={positions:void 0,granularity:void 0,height:void 0,ellipsoid:void 0};function xE(e,t,i){this._line=void 0,this._primitives=e,this._groundPrimitives=t,this._groundPolylinePrimitive=void 0,this._material=void 0,this._geometryUpdater=i,this._positions=[]}function EE(e){if(Object(s.default)(e._line))return e._line;var t=e._geometryUpdater._scene.id,i=cE[t],a=e._primitives;!Object(s.default)(i)||i.isDestroyed()?(i=new pO,cE[t]=i,a.add(i)):a.contains(i)||a.add(i);var r=i.add();return r.id=e._geometryUpdater._entity,e._line=r,r}xE.prototype.update=function(e){var t=this._geometryUpdater,i=t._entity,a=i.polyline,r=a.positions,n=A.default.getValueOrUndefined(r,e,this._positions);t._clampToGround=A.default.getValueOrDefault(a._clampToGround,e,!1),t._groundGeometryOptions.positions=n,t._groundGeometryOptions.width=A.default.getValueOrDefault(a._width,e,1),t._groundGeometryOptions.arcType=A.default.getValueOrDefault(a._arcType,e,ao.a.GEODESIC),t._groundGeometryOptions.granularity=A.default.getValueOrDefault(a._granularity,e,9999);var o=this._groundPrimitives;if(Object(s.default)(this._groundPolylinePrimitive)&&(o.remove(this._groundPolylinePrimitive),this._groundPolylinePrimitive=void 0),t.clampToGround){if(!i.isShowing||!i.isAvailable(e)||!A.default.getValueOrDefault(a._show,e,!0))return;if(!Object(s.default)(n)||n.length<2)return;var l,u=t.fillMaterialProperty;if(u instanceof me.default)l=new Zx.a;else{var f=ve.getValue(e,u,this._material);l=new Jx.a({material:f,translucent:f.isTranslucent()}),this._material=f}return this._groundPolylinePrimitive=o.add(new d.a({geometryInstances:t.createFillGeometryInstance(e),appearance:l,classificationType:t.classificationTypeProperty.getValue(e),asynchronous:!1}),A.default.getValueOrUndefined(t.zIndex,e)),void(Object(s.default)(this._line)&&(this._line.show=!1))}var c=EE(this);if(i.isShowing&&i.isAvailable(e)&&A.default.getValueOrDefault(a._show,e,!0))if(!Object(s.default)(n)||n.length<2)c.show=!1;else{var h=ao.a.GEODESIC;h=A.default.getValueOrDefault(a._arcType,e,h);var p=t._scene.globe;h!==ao.a.NONE&&Object(s.default)(p)&&(wE.ellipsoid=p.ellipsoid,wE.positions=n,wE.granularity=A.default.getValueOrUndefined(a._granularity,e),wE.height=St.extractHeights(n,p.ellipsoid),n=h===ao.a.GEODESIC?St.generateCartesianArc(wE):St.generateCartesianRhumbArc(wE)),c.show=!0,c.positions=n.slice(),c.material=ve.getValue(e,t.fillMaterialProperty,c.material),c.width=A.default.getValueOrDefault(a._width,e,1),c.distanceDisplayCondition=A.default.getValueOrUndefined(a._distanceDisplayCondition,e,c.distanceDisplayCondition)}else c.show=!1},xE.prototype.getBoundingSphere=function(e){if(this._geometryUpdater.clampToGround){var t=this._groundPolylinePrimitive;if(Object(s.default)(t)&&t.show&&t.ready){var i=t.getGeometryInstanceAttributes(this._geometryUpdater._entity);if(Object(s.default)(i)&&Object(s.default)(i.boundingSphere))return r.default.clone(i.boundingSphere,e),C.default.DONE}return Object(s.default)(t)&&!t.ready?C.default.PENDING:C.default.DONE}var a=EE(this);return a.show&&a.positions.length>0?(r.default.fromPoints(a.positions,e),C.default.DONE):C.default.FAILED},xE.prototype.isDestroyed=function(){return!1},xE.prototype.destroy=function(){var e=this._geometryUpdater._scene.id,t=cE[e];Object(s.default)(t)&&(t.remove(this._line),0===t.length&&(this._primitives.removeAndDestroy(t),delete cE[e])),Object(s.default)(this._groundPolylinePrimitive)&&this._groundPrimitives.remove(this._groundPolylinePrimitive),Object(l.default)(this)};var TE=OE,CE=new b.default,AE=new O.a,jE=new O.a;function PE(e,t,i,a,r){var n;n=i instanceof me.default?Zx.a:Jx.a,this.orderedGroundPrimitives=e,this.classificationType=t,this.appearanceType=n,this.materialProperty=i,this.updaters=new m.default,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new m.default,this.material=void 0,this.updatersWithAttributes=new m.default,this.attributes=new m.default,this.invalidated=!1,this.removeMaterialSubscription=i.definitionChanged.addEventListener(PE.prototype.onMaterialChanged,this),this.subscriptions=new m.default,this.showsUpdated=new m.default,this.zIndex=a,this._asynchronous=r}function SE(e,t,i){this._items=[],this._orderedGroundPrimitives=e,this._classificationType=t,this._asynchronous=Object(o.default)(i,!0)}PE.prototype.onMaterialChanged=function(){this.invalidated=!0},PE.prototype.isMaterial=function(e){var t=this.materialProperty,i=e.fillMaterialProperty;return i===t||i instanceof me.default&&t instanceof me.default||Object(s.default)(t)&&t.equals(i)},PE.prototype.add=function(e,t,i){var a=t.id;if(this.updaters.set(a,t),this.geometry.set(a,i),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&A.default.isConstant(t.distanceDisplayConditionProperty)){var r=this;this.subscriptions.set(a,t.entity.definitionChanged.addEventListener((function(e,i,a,n){"isShowing"===i&&r.showsUpdated.set(t.id,t)})))}else this.updatersWithAttributes.set(a,t);this.createPrimitive=!0},PE.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var i=this.subscriptions.get(t);return Object(s.default)(i)&&(i(),this.subscriptions.remove(t)),!0}return!1},PE.prototype.update=function(e){var t,i=!0,a=this.primitive,r=this.orderedGroundPrimitives,n=this.geometry.values;if(this.createPrimitive){if(n.length>0)Object(s.default)(a)&&(Object(s.default)(this.oldPrimitive)?r.remove(a):this.oldPrimitive=a),a=new d.a({show:!1,asynchronous:this._asynchronous,geometryInstances:n.slice(),appearance:new this.appearanceType,classificationType:this.classificationType}),this.appearanceType===Jx.a&&(this.material=ve.getValue(e,this.materialProperty,this.material),a.appearance.material=this.material),r.add(a,this.zIndex),i=!1;else{Object(s.default)(a)&&(r.remove(a),a=void 0);var o=this.oldPrimitive;Object(s.default)(o)&&(r.remove(o),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=a,this.createPrimitive=!1}else if(Object(s.default)(a)&&a.ready){a.show=!0,Object(s.default)(this.oldPrimitive)&&(r.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.appearanceType===Jx.a&&(this.material=ve.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material);var l=this.updatersWithAttributes.values,u=l.length;for(t=0;t<u;t++){var f=l[t],c=f.entity,h=this.geometry.get(f.id),p=this.attributes.get(h.id.id);if(Object(s.default)(p)||(p=a.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,p)),!f.fillMaterialProperty.isConstant){var m=f.fillMaterialProperty.color,_=A.default.getValueOrDefault(m,e,b.default.WHITE,CE);b.default.equals(p._lastColor,_)||(p._lastColor=b.default.clone(_,p._lastColor),p.color=oe.a.toValue(_,p.color))}var g=c.isShowing&&(f.hasConstantFill||f.isFilled(e));g!==(1===p.show[0])&&(p.show=pe.a.toValue(g,p.show));var v=f.distanceDisplayConditionProperty;if(!A.default.isConstant(v)){var y=A.default.getValueOrDefault(v,e,jE,AE);O.a.equals(y,p._lastDistanceDisplayCondition)||(p._lastDistanceDisplayCondition=O.a.clone(y,p._lastDistanceDisplayCondition),p.distanceDisplayCondition=ue.toValue(y,p.distanceDisplayCondition))}}this.updateShows(a)}else Object(s.default)(a)&&!a.ready&&(i=!1);return i},PE.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,i=t.length,a=0;a<i;a++){var r=t[a],n=r.entity,o=this.geometry.get(r.id),l=this.attributes.get(o.id.id);Object(s.default)(l)||(l=e.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,l));var u=n.isShowing;u!==(1===l.show[0])&&(l.show=pe.a.toValue(u,l.show),o.attributes.show.value[0]=l.show[0])}this.showsUpdated.removeAll()},PE.prototype.contains=function(e){return this.updaters.contains(e.id)},PE.prototype.getBoundingSphere=function(e,t){var i=this.primitive;if(!i.ready)return C.default.PENDING;var a=i.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(a)||!Object(s.default)(a.boundingSphere)||Object(s.default)(a.show)&&0===a.show[0]?C.default.FAILED:(a.boundingSphere.clone(t),C.default.DONE)},PE.prototype.destroy=function(){var e=this.primitive,t=this.orderedGroundPrimitives;Object(s.default)(e)&&t.remove(e);var i=this.oldPrimitive;Object(s.default)(i)&&t.remove(i),this.removeMaterialSubscription()},SE.prototype.add=function(e,t){for(var i=this._items,a=i.length,r=t.createFillGeometryInstance(e),n=A.default.getValueOrDefault(t.zIndex,0),o=0;o<a;++o){var s=i[o];if(s.isMaterial(t)&&s.zIndex===n)return void s.add(e,t,r)}var l=new PE(this._orderedGroundPrimitives,this._classificationType,t.fillMaterialProperty,n,this._asynchronous);l.add(e,t,r),i.push(l)},SE.prototype.remove=function(e){for(var t=this._items,i=t.length-1;i>=0;i--){var a=t[i];if(a.remove(e)){0===a.updaters.length&&(t.splice(i,1),a.destroy());break}}},SE.prototype.update=function(e){var t,i=this._items;for(t=i.length-1;t>=0;t--){var a=i[t];if(a.invalidated){i.splice(t,1);for(var r=a.updaters.values,n=r.length,o=0;o<n;o++)this.add(e,r[o]);a.destroy()}}var s=!0;for(t=0;t<i.length;t++)s=i[t].update(e)&&s;return s},SE.prototype.getBoundingSphere=function(e,t){for(var i=this._items,a=i.length,r=0;r<a;r++){var n=i[r];if(n.contains(e))return n.getBoundingSphere(e,t)}return C.default.FAILED},SE.prototype.removeAllPrimitives=function(){for(var e=this._items,t=e.length,i=0;i<t;i++)e[i].destroy();this._items.length=0};var IE=SE,LE=[];function DE(e,t){for(var i=e._batches,a=i.length,r=0;r<a;r++)i[r].remove(t)}function ME(e,t,i){if(i.isDynamic)e._dynamicBatch.add(t,i);else if(i.clampToGround&&i.fillEnabled){var a=i.classificationTypeProperty.getValue(t);e._groundBatches[a].add(t,i)}else{var r;i.fillEnabled&&(r=i.shadowsProperty.getValue(t));var n,o=0;Object(s.default)(i.depthFailMaterialProperty)&&(o=i.depthFailMaterialProperty instanceof me.default?1:2),Object(s.default)(r)&&(n=r+o*ae.a.NUMBER_OF_SHADOW_MODES),i.fillEnabled&&(i.fillMaterialProperty instanceof me.default?e._colorBatches[n].add(t,i):e._materialBatches[n].add(t,i))}}function RE(e,t,i,a){var r;a=Object(o.default)(a,e.groundPrimitives),i=Object(o.default)(i,e.primitives),this._scene=e,this._primitives=i,this._entityCollection=void 0,this._addedObjects=new m.default,this._removedObjects=new m.default,this._changedObjects=new m.default;var n=ae.a.NUMBER_OF_SHADOW_MODES;for(this._colorBatches=new Array(3*n),this._materialBatches=new Array(3*n),r=0;r<n;++r)this._colorBatches[r]=new au(i,Zx.a,void 0,!1,r),this._materialBatches[r]=new fu(i,Jx.a,void 0,!1,r),this._colorBatches[r+n]=new au(i,Zx.a,Zx.a,!1,r),this._materialBatches[r+n]=new fu(i,Jx.a,Zx.a,!1,r),this._colorBatches[r+2*n]=new au(i,Zx.a,Jx.a,!1,r),this._materialBatches[r+2*n]=new fu(i,Jx.a,Jx.a,!1,r);this._dynamicBatch=new fr(i,a);var s=Z.a.NUMBER_OF_CLASSIFICATION_TYPES;for(this._groundBatches=new Array(s),r=0;r<s;++r)this._groundBatches[r]=new IE(a,r);this._batches=this._colorBatches.concat(this._materialBatches,this._dynamicBatch,this._groundBatches),this._subscriptions=new m.default,this._updaters=new m.default,this._entityCollection=t,t.collectionChanged.addEventListener(RE.prototype._onCollectionChanged,this),this._onCollectionChanged(t,t.values,LE)}RE.prototype.update=function(e){var t,i,a,r,n=this._addedObjects,o=n.values,s=this._removedObjects,l=s.values,u=this._changedObjects,d=u.values;for(t=d.length-1;t>-1;t--)a=(i=d[t]).id,(r=this._updaters.get(a)).entity===i?(DE(this,r),ME(this,e,r)):(l.push(i),o.push(i));for(t=l.length-1;t>-1;t--)a=(i=l[t]).id,DE(this,r=this._updaters.get(a)),r.destroy(),this._updaters.remove(a),this._subscriptions.get(a)(),this._subscriptions.remove(a);for(t=o.length-1;t>-1;t--)a=(i=o[t]).id,r=new TE(i,this._scene),this._updaters.set(a,r),ME(this,e,r),this._subscriptions.set(a,r.geometryChanged.addEventListener(RE._onGeometryChanged,this));n.removeAll(),s.removeAll(),u.removeAll();var f=!0,c=this._batches,h=c.length;for(t=0;t<h;t++)f=c[t].update(e)&&f;return f};var NE=[],VE=new r.default;RE.prototype.getBoundingSphere=function(e,t){for(var i=NE,a=VE,n=0,o=C.default.DONE,s=this._batches,l=s.length,u=this._updaters.get(e.id),d=0;d<l;d++){if((o=s[d].getBoundingSphere(u,a))===C.default.PENDING)return C.default.PENDING;o===C.default.DONE&&(i[n]=r.default.clone(a,i[n]),n++)}return 0===n?C.default.FAILED:(i.length=n,r.default.fromBoundingSpheres(i,t),C.default.DONE)},RE.prototype.isDestroyed=function(){return!1},RE.prototype.destroy=function(){var e;this._entityCollection.collectionChanged.removeEventListener(RE.prototype._onCollectionChanged,this),this._addedObjects.removeAll(),this._removedObjects.removeAll();var t=this._batches,i=t.length;for(e=0;e<i;e++)t[e].removeAllPrimitives();var a=this._subscriptions.values;for(i=a.length,e=0;e<i;e++)a[e]();return this._subscriptions.removeAll(),Object(l.default)(this)},RE._onGeometryChanged=function(e){var t=this._removedObjects,i=this._changedObjects,a=e.entity,r=a.id;Object(s.default)(t.get(r))||Object(s.default)(i.get(r))||i.set(r,a)},RE.prototype._onCollectionChanged=function(e,t,i){var a,r,n,o=this._addedObjects,s=this._removedObjects,l=this._changedObjects;for(a=i.length-1;a>-1;a--)r=(n=i[a]).id,o.remove(r)||(s.set(r,n),l.remove(r));for(a=t.length-1;a>-1;a--)r=(n=t[a]).id,s.remove(r)?l.set(r,n):o.set(r,n)};var BE=RE;function UE(e){this._displayID=Object(n.default)(),f.a.initializeTerrainHeights(),d.a.initializeTerrainHeights();var t=e.scene,i=e.dataSourceCollection;this._eventHelper=new u.default,this._eventHelper.add(i.dataSourceAdded,this._onDataSourceAdded,this),this._eventHelper.add(i.dataSourceRemoved,this._onDataSourceRemoved,this),this._eventHelper.add(i.dataSourceMoved,this._onDataSourceMoved,this),this._eventHelper.add(t.postRender,this._postRender,this),this._dataSourceCollection=i,this._scene=t,this._visualizersCallback=Object(o.default)(e.visualizersCallback,UE.defaultVisualizersCallback);var a=!1,r=new c.a,s=new c.a;i.length>0&&(t.primitives.add(r),t.groundPrimitives.add(s),a=!0),this._primitives=r,this._groundPrimitives=s;for(var l=0,h=i.length;l<h;l++)this._onDataSourceAdded(i,i.get(l));var p,m,_=new K.default;if(this._onDataSourceAdded(void 0,_),this._defaultDataSource=_,!a){var g=this,v=function(){t.primitives.add(r),t.groundPrimitives.add(s),p(),m(),g._removeDefaultDataSourceListener=void 0,g._removeDataSourceCollectionListener=void 0};p=_.entities.collectionChanged.addEventListener(v),m=i.dataSourceAdded.addEventListener(v)}this._removeDefaultDataSourceListener=p,this._removeDataSourceCollectionListener=m,this._ready=!1}UE.defaultVisualizersCallback=function(e,t,i){var a=i.entities;return[new Y(t,a),new Bd(e,a,i._primitives,i._groundPrimitives),new ff(t,a),new p_(e,a),new bx(e,a),new Xx(t,a),new Vx(e,a),new BE(e,a,i._primitives,i._groundPrimitives)]},Object.defineProperties(UE.prototype,{scene:{get:function(){return this._scene}},dataSources:{get:function(){return this._dataSourceCollection}},defaultDataSource:{get:function(){return this._defaultDataSource}},ready:{get:function(){return this._ready}}}),UE.prototype.isDestroyed=function(){return!1},UE.prototype.destroy=function(){this._eventHelper.removeAll();for(var e=this._dataSourceCollection,t=0,i=e.length;t<i;++t)this._onDataSourceRemoved(this._dataSourceCollection,e.get(t));return this._onDataSourceRemoved(void 0,this._defaultDataSource),Object(s.default)(this._removeDefaultDataSourceListener)?(this._removeDefaultDataSourceListener(),this._removeDataSourceCollectionListener()):(this._scene.primitives.remove(this._primitives),this._scene.groundPrimitives.remove(this._groundPrimitives)),Object(l.default)(this)},UE.prototype.update=function(e){if(!a.a.initialized)return this._ready=!1,!1;var t,i,r,n,o=!0,l=this._dataSourceCollection,u=l.length;for(t=0;t<u;t++){var d=l.get(t);for(Object(s.default)(d.update)&&(o=d.update(e)&&o),n=(r=d._visualizersByDisplayID[this._displayID]).length,i=0;i<n;i++)o=r[i].update(e)&&o}for(n=(r=this._defaultDataSource._visualizersByDisplayID[this._displayID]).length,i=0;i<n;i++)o=r[i].update(e)&&o;return this._ready=o,o},UE.prototype._postRender=function(){for(var e=this._scene.frameState,t=this._dataSourceCollection,i=t.length,a=0;a<i;a++){var r=t.get(a),n=r.credit;Object(s.default)(n)&&e.creditDisplay.addCredit(n);var o=r._resourceCredits;if(Object(s.default)(o))for(var l=o.length,u=0;u<l;u++)e.creditDisplay.addCredit(o[u])}};var FE=[],HE=new r.default;UE.prototype.getBoundingSphere=function(e,t,i){if(!this._ready)return C.default.PENDING;var a,n,o=this._defaultDataSource;if(!o.entities.contains(e)){o=void 0;var l=this._dataSourceCollection;for(n=l.length,a=0;a<n;a++){var u=l.get(a);if(u.entities.contains(e)){o=u;break}}}if(!Object(s.default)(o))return C.default.FAILED;var d=FE,f=HE,c=0,h=C.default.DONE,p=o._visualizers,m=p.length;for(a=0;a<m;a++){var _=p[a];if(Object(s.default)(_.getBoundingSphere)){if(h=p[a].getBoundingSphere(e,f),!t&&h===C.default.PENDING)return C.default.PENDING;h===C.default.DONE&&(d[c]=r.default.clone(f,d[c]),c++)}}return 0===c?C.default.FAILED:(d.length=c,r.default.fromBoundingSpheres(d,i),C.default.DONE)},UE.prototype._onDataSourceAdded=function(e,t){var i=this._scene,a=this._primitives,r=this._groundPrimitives,n=a.add(new c.a),o=r.add(new p);t._primitives=n,t._groundPrimitives=o;var s=t.clustering;s._initialize(i),n.add(s);var l=this._visualizersCallback(i,s,t);t._visualizersByDisplayID=t._visualizersByDisplayID||{},t._visualizersByDisplayID[this._displayID]=l,t._visualizers=t._visualizers||[],t._visualizers=t._visualizers.concat(l)},UE.prototype._onDataSourceRemoved=function(e,t){var i=this._primitives,a=this._groundPrimitives,r=t._primitives,n=t._groundPrimitives,o=t.clustering;r.remove(o);var l=t._visualizersByDisplayID[this._displayID];if(Object(s.default)(l)){for(var u=l.length,d=0;d<u;d++){var f=l[d];f.destroy();var c=t._visualizers.indexOf(f);t._visualizers.splice(c,1)}delete t._visualizersByDisplayID[this._displayID],i.remove(r),a.remove(n)}},UE.prototype._onDataSourceMoved=function(e,t,i){var a=this._primitives,r=this._groundPrimitives,n=e._primitives,o=e._groundPrimitives;t===i+1?(a.raise(n),r.raise(o)):t===i-1?(a.lower(n),r.lower(o)):0===t?(a.lowerToBottom(n),r.lowerToBottom(o),a.raise(n),r.raise(o)):(a.raiseToTop(n),r.raiseToTop(o))};t.default=UE}}]);
//# sourceMappingURL=1.TerriaJS-specs.js.map